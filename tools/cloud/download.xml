<?xml version="1.0"?>

<tool id="download_to_cloud" name="Download dataset" version="0.1.0" workflow_compatible="false">
    <description>
        to Cloud
    </description>
    <requirements>
        <requirement type="package" version="0.3.3">cloudbridge</requirement>
    </requirements>
    <command><![CDATA[
        #set $authz_record=$__app__.authnz_manager.try_get_authz_config($__app__.obj.model.context.current, $__user_id__, $authz_id)
        #if $credentials_file == None
            #set $credentials_file = $__app__.authnz_manager.get_cloud_access_credentials_in_file($__app__.config.new_file_path, $authz_record, $__app__.obj.model.context.current, $__user_id__)
        #end if
        python $__tool_directory__/download.py
            --provider=$authz_record.provider
            --filename=$filename
            --credentials_file=$credentials_file
            --bucket=$bucket
            --object_label=$filename.name.replace(" ", "_")
            --overwrite_existing=$overwrite_existing
    ]]></command>
    <inputs>
        <param name="filename" type="data" label="Datasets to be downloaded to a cloud-based storage:" />
        <!--    ************************ NOTE ************************
                Any change, even order, to the following parameters
                (provider, provider options, and credential parameters
                of different providers), MUST be reflected in the
                CloudManager (lib/galaxy/managers/cloud.py).
                ******************************************************
        -->
        <param name="authz_id" type="text" label="Authz ID" />
        <param name="bucket" type="text" label="Bucket" />
        <param name="object_label" type="text" hidden="true" label="Object Label" />
        <param name="overwrite_existing" type="boolean" label="overwrite_existing" />
        <param name="credentials_file" type="hidden" label="Credentials File" />
    </inputs>
    <outputs>
        <data name="output" type="data" label="Output log" hidden="false"/>
    </outputs>
    <help>

**What it does**

Downloads a dataset from Galaxy to a cloud-based storage.

    </help>
</tool>
