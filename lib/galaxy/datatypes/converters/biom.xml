<tool id="CONVERTER_biom" name="Convert Biom datasets" version="2.1.5">
    <requirements>
        <requirement type="package" version="2.1.5">biom-format</requirement>
    </requirements>
    <command><![CDATA[
        biom convert -i '$input' -o '$output'
        #if $__target_datatype == 'biom2'
            --to-hdf5
        #elif $__target_datatype == 'biom1'
            --to-json
        #else
            >&2 echo "BIOM converter received unknown target datatype: $__target_datatype" &&
            exit 1
        #end if
    ]]></command>
    <configfiles>
        <configfile name="ext_config">{"output": {
  "name": "$input.name converted to $__target_datatype",
  "ext": "$__target_datatype"
}}</configfile>
    </configfiles>
    <inputs>
        <param name="input" type="data" format="biom1,biom2" label="Biom file"/>
        <!-- this hidden parameter is set automatically when the tool is called as
             converter and set manually when called from the tool test -->
        <param name="__target_datatype" type="hidden" label="Target data type"/>
    </inputs>
    <outputs>
        <data name="output" format="auto"/>
    </outputs>
    <tests>
        <test>
            <param name="input" ftype="biom2" value="input_taxonomy.biom2"/>
            <param name="__target_datatype" value="biom1"/>
            <output name="output_biom1">
                <assert_contents>
                    <has_text text="Biological Observation Matrix 1.0.0"/>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="biom2" ftype="biom1" value="input_taxonomy.biom1"/>
            <param name="__target_datatype" value="biom2"/>
            <output name="output_biom2" format="biom2" value="input_taxonomy.biom2" compare="sim_size"/>
        </test>
    </tests>
    <help>
    </help>
</tool>
