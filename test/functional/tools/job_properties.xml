<tool id="job_properties" name="Test Job Properties">
    <stdio>
        <exit_code range="127" level="fatal" description="Failing exit code." />
    </stdio>
    <command><![CDATA[
        #if $thebool
            echo "The bool is true" &&
            echo "The bool is really true" 1>&2 &&
            echo "This is a line of text." > '$out_file1' &&
            cp '$out_file1' '$one' &&
            cp '$out_file1' '$two'
        #else
            echo "The bool is not true" &&
            echo "The bool is very not true" 1>&2 &&
            echo "This is a different line of text." > '$out_file1' &&
            sh -c "exit 2"
        #end if
        #if $failbool
            ; sh -c "exit 127"
        #end if

    ]]></command>
    <inputs>
        <param name="thebool" type="boolean" label="The boolean property" />
        <param name="failbool" type="boolean" label="The failure property" checked="false" />
    </inputs>
    <outputs>
        <data name="out_file1" format="txt" />
        <collection name="list_output" type="list" label="A list output">
            <data name="one" format="txt" />
            <data name="two" format="txt" />
        </collection>
    </outputs>
    <tests>
        <!-- test for assert_command, -stdout, and stderr -->
        <test expect_exit_code="0">
            <param name="thebool" value="true" />
            <output name="out_file1" file="simple_line.txt" />
            <assert_command>
                <has_text text="really" />
                <not_has_text text="REALLY" />
                <has_text_matching text="r.a.ly" />
            </assert_command>
            <assert_stdout>
                <has_line line="The bool is true" />
            </assert_stdout>
            <assert_stderr>
                <has_line line="The bool is really true" />
            </assert_stderr>
        </test>
        <!-- same test with negated assert conditions -> should fail (using not_has_text instead of the nonexistent not_has_line) -->
        <test expect_exit_code="0">
            <param name="thebool" value="true" />
            <output name="out_file1" file="simple_line.txt" />
            <assert_command>
                <not_has_text text="really" />
                <has_text text="REALLY" />
                <has_text_matching text="R.A.LY" />
            </assert_command>
<!--            <assert_stdout>-->
<!--                <not_has_text text="The bool is true" />-->
<!--            </assert_stdout>-->
<!--            <assert_stderr>-->
<!--                <not_has_text text="The bool is really true" />-->
<!--            </assert_stderr>-->
        </test>
        <!-- test for expected exit code -->
        <test expect_exit_code="2">
            <param name="thebool" value="false" />
            <output name="out_file1" file="simple_line_alternative.txt" />
            <assert_command>
                <has_text text="very not" />
            </assert_command>
            <assert_stdout>
                <has_line line="The bool is not true" />
            </assert_stdout>
            <assert_stderr>
                <has_line line="The bool is very not true" />
            </assert_stderr>
        </test>
        <!-- ??? -->
        <test expect_exit_code="127" expect_failure="true">
            <param name="thebool" value="true" />
            <param name="failbool" value="true" />
        </test>
    </tests>
    <help>
    </help>
</tool>
