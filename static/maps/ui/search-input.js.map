{"version":3,"sources":["ui/search-input.js"],"names":["searchInput","parentNode","options","onsearch","event","minSearchLen","escWillClear","oninit","val","trigger","blur","onclear","search","searchTerms","clearSearchInput","$","this","firstSearch","inputTemplate","name","placeholder","$input","join","focus","KEYCODE_ESC","KEYCODE_RETURN","$parentNode","defaults","initialVal","classes","onfirstsearch","inputVal","_jquery2","default","type","find","toggle","extend","addClass","prepend","which","keyup","preventDefault","call","$loadingIndicator","_l","toggleLoadingIndicator","click","hide","tooltip","placement","window","s","fn","each"],"mappings":"6DAYA,SAAAA,EAAAC,EAAAC,GAqBQC,SAAAA,EAAUC,GACVC,EAAAA,MACAC,SACAC,SAAQ,SAUHC,IAAI,IAPbC,QAAA,qBACAC,OACAR,EAAAS,UASC,SAAAC,EAAAR,EAAAS,GAIG,IAAKA,EAFT,OAAAC,IAEIC,EAAAC,MAAIP,QAACI,gBAAaA,GACd,mBAAAX,EAAOY,eAAPG,GACHA,GAAA,EACDF,EAAQN,cAAQI,IAEZI,EAAAA,SAAAA,GAKP,SAAAC,IAED,OACA,4BACIhB,EAAAiB,KACA,kBAWHjB,EAAAkB,YANO,KAQR,uBACAlB,EAASmB,QACL,KAEQ,MADJC,KAEKC,IAlEb,IAAIC,EAAc,GACdC,EAAiB,GACjBC,EAAcX,EAAEd,GAChBgB,GAAc,EAEdU,GACAC,WAAY,GAPpBT,KAASnB,SACLoB,YAAII,SACJK,QAAIJ,GACJd,QAAIe,aACJI,cAAIb,KASAd,SAAU,SAAS4B,KAPvB1B,aAAIsB,EACAC,cAAAA,EACAT,OAAAA,cA+HJ,MAA6B,WAAzBa,EAAAC,QAAOC,KAAKhC,IACI,mBAAZA,IAPJwB,EAAYS,KAAK,mBAAmBC,SACpCV,EAAYS,KAAK,iBAAiBC,UAS3BV,IAIkB,WAAzBM,EAAAC,QAAOC,KAAKhC,KACZA,EAAU8B,EAAAC,QAAOI,QAAO,KAAUV,EAAUzB,IAGzCwB,EACFY,SAAS,gBACTC,SA5EWnC,EAAAA,KAEAmB,MAAA,SAAAnB,GACIA,EAAAA,MAAMoC,WAGNC,MAAA,SAAI5B,GASP,GARGT,EAAAsC,iBACAtC,EACIA,kBAMPA,EAAAoC,QAAAhB,GAAAtB,EAAAI,aAEAJ,EA1BbyC,KAAA3B,KAAAZ,OA4BH,CAbmB,IAAIS,EAAcE,EAAEC,MAAMR,OAiB9CJ,EAAqBoC,QAAAf,GAGTvB,EAAAG,cAQAS,EAA4BV,QAA5BF,EAAAG,eAEXO,EAAA+B,KAAA3B,KAAAZ,EAAAS,MAIQ+B,IAAAA,EAAAA,YAgBLlB,GAEH,iDA/BW,UAiCZmB,EAAA,sBACA,aACIvB,KAAA,KAEIwB,SAAAA,UAAAA,WACHC,MAAA,SAAA3C,GACDU,EAAA6B,KAAA3B,KAAAZ,KAOJW,GAIH,sDAjCe,UAmChB8B,EAAA,cACA,aACI7C,KAAAA,KAEQgD,OADGC,SAAPC,UAAA,yEA5KJnC,EAAAA,EAAAA,QACA8B,EACAM,OAAON,IACP,SAASO,GACL,OAAOA,GAsKfpB,EAAAC,QAAOoB,GAAGhB,QACNrC,YAAa,SAAsBE,GAC/B,OAAOc,KAAKsC,KAAK,WACb,OAAOtD,EAAYgB,KAAMd","file":"../../scripts/ui/search-input.js","sourcesContent":["import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\nvar _l =\n    window._l ||\n    function(s) {\n        return s;\n    };\n\n//TODO: consolidate with tool menu functionality, use there\n\n/** searchInput: (jQuery plugin)\n     *      Creates a search input, a clear button, and loading indicator\n     *      within the selected node.\n     *\n     *      When the user either presses return or enters some minimal number\n     *      of characters, a callback is called. Pressing ESC when the input\n     *      is focused will clear the input and call a separate callback.\n     */\nfunction searchInput(parentNode, options) {\n    var KEYCODE_ESC = 27;\n    var KEYCODE_RETURN = 13;\n    var $parentNode = $(parentNode);\n    var firstSearch = true;\n\n    var defaults = {\n        initialVal: \"\",\n        name: \"search\",\n        placeholder: \"search\",\n        classes: \"\",\n        onclear: function() {},\n        onfirstsearch: null,\n        onsearch: function(inputVal) {},\n        minSearchLen: 0,\n        escWillClear: true,\n        oninit: function() {}\n    };\n\n    // .................................................................... input rendering and events\n    // visually clear the search, trigger an event, and call the callback\n    function clearSearchInput(event) {\n        var $input = $(this)\n            .parent()\n            .children(\"input\");\n        $input\n            .val(\"\")\n            .trigger(\"searchInput.clear\")\n            .blur();\n        options.onclear();\n    }\n\n    // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n    function search(event, searchTerms) {\n        if (!searchTerms) {\n            return clearSearchInput();\n        }\n        $(this).trigger(\"search.search\", searchTerms);\n        if (typeof options.onfirstsearch === \"function\" && firstSearch) {\n            firstSearch = false;\n            options.onfirstsearch(searchTerms);\n        } else {\n            options.onsearch(searchTerms);\n        }\n    }\n\n    // .................................................................... input rendering and events\n    function inputTemplate() {\n        // class search-query is bootstrap 2.3 style that now lives in base.less\n        return [\n            '<input type=\"text\" name=\"',\n            options.name,\n            '\" placeholder=\"',\n            options.placeholder,\n            '\" ',\n            'class=\"search-query ',\n            options.classes,\n            '\" ',\n            \"/>\"\n        ].join(\"\");\n    }\n\n    // the search input that responds to keyboard events and displays the search value\n    function $input() {\n        return (\n            $(inputTemplate())\n                // select all text on a focus\n                .focus(function(event) {\n                    $(this).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup(function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n\n                    // esc key will clear if desired\n                    if (event.which === KEYCODE_ESC && options.escWillClear) {\n                        clearSearchInput.call(this, event);\n                    } else {\n                        var searchTerms = $(this).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if (\n                            event.which === KEYCODE_RETURN ||\n                            (options.minSearchLen &&\n                                searchTerms.length >= options.minSearchLen)\n                        ) {\n                            search.call(this, event, searchTerms);\n                        }\n                    }\n                })\n                .val(options.initialVal)\n        );\n    }\n\n    // .................................................................... clear button rendering and events\n    // a button for clearing the search bar, placed on the right hand side\n    function $clearBtn() {\n        return $(\n            [\n                '<span class=\"search-clear fa fa-times-circle\" ',\n                'title=\"',\n                _l(\"clear search (esc)\"),\n                '\"></span>'\n            ].join(\"\")\n        )\n            .tooltip({ placement: \"bottom\" })\n            .click(function(event) {\n                clearSearchInput.call(this, event);\n            });\n    }\n\n    // .................................................................... loadingIndicator rendering\n    // a button for clearing the search bar, placed on the right hand side\n    function $loadingIndicator() {\n        return $(\n            [\n                '<span class=\"search-loading fa fa-spinner fa-spin\" ',\n                'title=\"',\n                _l(\"loading...\"),\n                '\"></span>'\n            ].join(\"\")\n        )\n            .hide()\n            .tooltip({ placement: \"bottom\" });\n    }\n\n    // .................................................................... commands\n    // visually swap the load, clear buttons\n    function toggleLoadingIndicator() {\n        $parentNode.find(\".search-loading\").toggle();\n        $parentNode.find(\".search-clear\").toggle();\n    }\n\n    // .................................................................... init\n    // string command (not constructor)\n    if (jQuery.type(options) === \"string\") {\n        if (options === \"toggle-loading\") {\n            toggleLoadingIndicator();\n        }\n        return $parentNode;\n    }\n\n    // initial render\n    if (jQuery.type(options) === \"object\") {\n        options = jQuery.extend(true, {}, defaults, options);\n    }\n    //NOTE: prepended\n    return $parentNode\n        .addClass(\"search-input\")\n        .prepend([$input(), $clearBtn(), $loadingIndicator()]);\n}\n\n// as jq plugin\njQuery.fn.extend({\n    searchInput: function $searchInput(options) {\n        return this.each(function() {\n            return searchInput(this, options);\n        });\n    }\n});\n"]}