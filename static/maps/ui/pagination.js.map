{"version":3,"sources":["ui/pagination.js"],"names":["factory","define","amd","jQuery","$","Pagination","element","options","this","numPages","currPage","init","_make$Li","contents","join","prototype","DATA_KEY","defaults","startingPage","perPage","totalDataSize","currDataSize","$element","extend","Math","ceil","data","_render","_renderPages","_scrollToActivePage","_renderPrevNext","pagination","$prev","$next","$paginationContainer","addClass","click","prevPage","nextPage","html","append","$scrollingContainer","page$LiClick","ev","goToPage","i","$pageLi","attr","$container","find","length","$activePage","midpoint","width","scrollLeft","position","left","page","trigger","create","fn","nonOptionsArgs","makeArray","arguments","slice","type","map","$firstElement","previousControl","apply"],"mappings":"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","file":"../../scripts/ui/pagination.js","sourcesContent":["// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n// Uses AMD or browser globals to create a jQuery plugin.\n(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['jquery'], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function ($) {\n\n    /** Builds (twitter bootstrap styled) pagination controls.\n     *  If the totalDataSize is not null, a horizontal list of page buttons is displayed.\n     *  If totalDataSize is null, two links ('Prev' and 'Next) are displayed.\n     *  When pages are changed, a 'pagination.page-change' event is fired\n     *      sending the event and the (0-based) page requested.\n     */\n    function Pagination( element, options ){\n        /** the total number of pages */\n        this.numPages = null;\n        /** the current, active page */\n\t\tthis.currPage = 0;\n\t\treturn this.init( element, options );\n    }\n\n    /** data key under which this object will be stored in the element */\n\tPagination.prototype.DATA_KEY = 'pagination';\n    /** default options */\n    Pagination.prototype.defaults = {\n        /** which page to begin at */\n        startingPage    : 0,\n        /** number of data per page */\n        perPage         : 20,\n        /** the total number of data (null == unknown) */\n        totalDataSize   : null,\n        /** size of current data on current page */\n        currDataSize    : null\n\t};\n\n    /** init the control, calc numPages if possible, and render\n     *  @param {jQuery} the element that will contain the pagination control\n     *  @param {Object} options a map containing overrides to the pagination default options\n     */\n\tPagination.prototype.init = function _init( $element, options ){\n\t\toptions = options || {};\n\t\tthis.$element = $element;\n\t\tthis.options = jQuery.extend( true, {}, this.defaults, options );\n\n        this.currPage = this.options.startingPage;\n        if( this.options.totalDataSize !== null ){\n            this.numPages = Math.ceil( this.options.totalDataSize / this.options.perPage );\n            // limit currPage by numPages\n            if( this.currPage >= this.numPages ){\n                this.currPage = this.numPages - 1;\n            }\n        }\n        //console.debug( 'Pagination.prototype.init:', this.$element, this.currPage );\n        //console.debug( JSON.stringify( this.options ) );\n\n        // bind to data of element\n        this.$element.data( Pagination.prototype.DATA_KEY, this );\n\n        this._render();\n\t\treturn this;\n\t};\n\n    /** helper to create a simple li + a combo */\n    function _make$Li( contents ){\n        return $([\n            '<li><a href=\"javascript:void(0);\">', contents, '</a></li>'\n        ].join( '' ));\n    }\n\n    /** render previous and next pagination buttons */\n    Pagination.prototype._render = function __render(){\n        // no data - no pagination\n        if( this.options.totalDataSize === 0 ){ return this; }\n        // only one page\n        if( this.numPages === 1 ){ return this; }\n\n        // when the number of pages are known, render each page as a link\n        if( this.numPages > 0 ){\n            this._renderPages();\n            this._scrollToActivePage();\n\n        // when the number of pages is not known, render previous or next\n        } else {\n            this._renderPrevNext();\n        }\n\t\treturn this;\n    };\n\n    /** render previous and next pagination buttons */\n    Pagination.prototype._renderPrevNext = function __renderPrevNext(){\n        var pagination = this,\n            $prev = _make$Li( 'Prev' ),\n            $next = _make$Li( 'Next' ),\n            $paginationContainer = $( '<ul/>' ).addClass( 'pagination pagination-prev-next' );\n\n        // disable if it either end\n        if( this.currPage === 0 ){\n            $prev.addClass( 'disabled' );\n        } else {\n            $prev.click( function(){ pagination.prevPage(); });\n        }\n        if( ( this.numPages && this.currPage === ( this.numPages - 1 ) )\n        ||  ( this.options.currDataSize && this.options.currDataSize < this.options.perPage ) ){\n            $next.addClass( 'disabled' );\n        } else {\n            $next.click( function(){ pagination.nextPage(); });\n        }\n\n        this.$element.html( $paginationContainer.append([ $prev, $next ]) );\n        //console.debug( this.$element, this.$element.html() );\n        return this.$element;\n    };\n\n    /** render page links for each possible page (if we can) */\n    Pagination.prototype._renderPages = function __renderPages(){\n        // it's better to scroll the control and let the user see all pages\n        //  than to force her/him to change pages in order to find the one they want (as traditional << >> does)\n        var pagination = this,\n            $scrollingContainer = $( '<div>' ).addClass( 'pagination-scroll-container' ),\n            $paginationContainer = $( '<ul/>' ).addClass( 'pagination pagination-page-list' ),\n            page$LiClick = function( ev ){\n                pagination.goToPage( $( this ).data( 'page' ) );\n            };\n\n        for( var i=0; i<this.numPages; i+=1 ){\n            // add html5 data tag 'page' for later click event handler use\n            var $pageLi = _make$Li( i + 1 ).attr( 'data-page', i ).click( page$LiClick );\n            // highlight the current page\n            if( i === this.currPage ){\n                $pageLi.addClass( 'active' );\n            }\n            //console.debug( '\\t', $pageLi );\n            $paginationContainer.append( $pageLi );\n        }\n        return this.$element.html( $scrollingContainer.html( $paginationContainer ) );\n    };\n\n    /** scroll scroll-container (if any) to show the active page */\n    Pagination.prototype._scrollToActivePage = function __scrollToActivePage(){\n        // scroll to show active page in center of scrollable area\n        var $container = this.$element.find( '.pagination-scroll-container' );\n        // no scroll container : don't scroll\n        if( !$container.length ){ return this; }\n\n        var $activePage = this.$element.find( 'li.active' ),\n            midpoint = $container.width() / 2;\n        //console.debug( $container, $activePage, midpoint );\n        $container.scrollLeft( $container.scrollLeft() + $activePage.position().left - midpoint );\n        return this;\n    };\n\n    /** go to a certain page */\n    Pagination.prototype.goToPage = function goToPage( page ){\n        if( page <= 0 ){ page = 0; }\n        if( this.numPages && page >= this.numPages ){ page = this.numPages - 1; }\n        if( page === this.currPage ){ return this; }\n\n        //console.debug( '\\t going to page ' + page )\n        this.currPage = page;\n        this.$element.trigger( 'pagination.page-change', this.currPage );\n        //console.info( 'pagination:page-change', this.currPage );\n        this._render();\n        return this;\n    };\n\n    /** go to the previous page */\n    Pagination.prototype.prevPage = function prevPage(){\n        return this.goToPage( this.currPage - 1 );\n    };\n\n    /** go to the next page */\n    Pagination.prototype.nextPage = function nextPage(){\n        return this.goToPage( this.currPage + 1 );\n    };\n\n    /** return the current page */\n    Pagination.prototype.page = function page(){\n        return this.currPage;\n    };\n\n    // alternate constructor invocation\n    Pagination.create = function _create( $element, options ){\n        return new Pagination( $element, options );\n    };\n\n    // as jq plugin\n    jQuery.fn.extend({\n        pagination : function $pagination( options ){\n\t\t\tvar nonOptionsArgs = jQuery.makeArray( arguments ).slice( 1 );\n\n            // if passed an object - use that as an options map to create pagination for each selected\n            if( jQuery.type( options ) === 'object' ){\n                return this.map( function(){\n                    Pagination.create( $( this ), options );\n                    return this;\n                });\n            }\n\n            // (other invocations only work on the first element in selected)\n            var $firstElement = $( this[0] ),\n                previousControl = $firstElement.data( Pagination.prototype.DATA_KEY );\n            // if a pagination control was found for this element, either...\n            if( previousControl ){\n                // invoke a function on the pagination object if passed a string (the function name)\n                if( jQuery.type( options ) === 'string' ){\n                    var fn = previousControl[ options ];\n                    if( jQuery.type( fn ) === 'function' ){\n                        return fn.apply( previousControl, nonOptionsArgs );\n                    }\n\n                // if passed nothing, return the previously set control\n                } else {\n                    return previousControl;\n                }\n            }\n            // if there is no control already set, return undefined\n            return undefined;\n        }\n    });\n}));\n"]}