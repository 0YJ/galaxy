{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["View","Backbone","extend","initialize","this","setElement","model","Model","dataset_id","Galaxy","params","message","_uiMisc2","default","Message","persistent","tabs","_createTabs","$el","append","$","hide","render","self","ajax","success","update","response","_","each","forms","form","key","set","url","responseJSON","status","err_msg","_submit","operation","data","create","get","type","_reloadHistory","error","_getAttribute","conversion","_getConversion","attribute","_getDatatype","_getPermission","permission","add","id","title","icon","datatype","operations","ButtonIcon","submit_attributes","tooltip","submit_autodetect","onclick","submit_conversion","submit_datatype","submit_permission","window","loadCurrentHistory"],"mappings":"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","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["/** Dataset edit attributes view */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new Ui.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el\n            .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n            .append(this.message.$el)\n            .append(\"<p/>\")\n            .append(this.tabs.$el)\n            .hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: `${Galaxy.root}dataset/get_edit?dataset_id=${self.model.get(\n                \"dataset_id\"\n            )}`,\n            success: function(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, (form, key) => {\n                    form.model.set(\"inputs\", response[`${key}_inputs`]);\n                    form.model.set(\n                        \"hide_operations\",\n                        response[`${key}_disable`]\n                    );\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function(response) {\n                var err_msg =\n                    response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message:\n                        err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: `${Galaxy.root}dataset/set_edit`,\n            data: data,\n            success: function(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function(response) {\n                var err_msg =\n                    response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message:\n                        err_msg ||\n                        \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new Tabs.View();\n        tabs.add({\n            id: \"attribute\",\n            title: \"Attributes\",\n            icon: \"fa fa-bars\",\n            tooltip: \"Edit dataset attributes\",\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: \"Convert\",\n            icon: \"fa-gear\",\n            tooltip: \"Convert to new format\",\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: \"Datatypes\",\n            icon: \"fa-database\",\n            tooltip: \"Change data type\",\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: \"Permissions\",\n            icon: \"fa-user\",\n            tooltip: \"Permissions\",\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Edit attributes\",\n            operations: {\n                submit_attributes: new Ui.ButtonIcon({\n                    tooltip: \"Save attributes of the dataset.\",\n                    icon: \"fa-floppy-o\",\n                    title: \"Save\",\n                    onclick: function() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new Ui.ButtonIcon({\n                    tooltip:\n                        \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Convert to new format\",\n            operations: {\n                submit_conversion: new Ui.ButtonIcon({\n                    tooltip: \"Convert the datatype to a new format.\",\n                    title: \"Convert datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Change datatype\",\n            operations: {\n                submit_datatype: new Ui.ButtonIcon({\n                    tooltip: \"Change the datatype to a new type.\",\n                    title: \"Change datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Manage dataset permissions\",\n            operations: {\n                submit_permission: new Ui.ButtonIcon({\n                    tooltip: \"Save permissions.\",\n                    title: \"Save permissions\",\n                    icon: \"fa-floppy-o \",\n                    onclick: function() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}