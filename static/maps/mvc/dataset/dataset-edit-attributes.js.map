{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["_utils","require","_uiTabs","_uiMisc","_formView","View","Backbone","extend","initialize","this","setElement","model","Model","dataset_id","Galaxy","params","message","_uiMisc2","default","Message","persistent","tabs","_createTabs","$el","append","$","hide","render","self","root","success","response","initial_message","_","forms","form","key","set","url","error","each","responseJSON","err_msg","data","create","get","operation","ajax","type","_submit","update","_reloadHistory","attribute","_getAttribute","conversion","_getConversion","_getDatatype","permission","_getPermission","icon","datatype","title","id","tooltip","_formView2","ButtonIcon","operations","submit_attributes","onclick","submit_autodetect","submit_conversion","submit_datatype","submit_permission","window","currHistoryPanel","loadCurrentHistory"],"mappings":"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","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["/** Dataset edit attributes view */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new Ui.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el\n            .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n            .append(this.message.$el)\n            .append(\"<p/>\")\n            .append(this.tabs.$el)\n            .hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function() {\n        var self = this;\n        $.ajax({\n            url:\n                Galaxy.root +\n                \"dataset/get_edit?dataset_id=\" +\n                self.model.get(\"dataset_id\"),\n            success: function(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, function(form, key) {\n                    form.model.set(\"inputs\", response[key + \"_inputs\"]);\n                    form.model.set(\n                        \"hide_operations\",\n                        response[key + \"_disable\"]\n                    );\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function(response) {\n                var err_msg =\n                    response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message:\n                        err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: Galaxy.root + \"dataset/set_edit\",\n            data: data,\n            success: function(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function(response) {\n                var err_msg =\n                    response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message:\n                        err_msg ||\n                        \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new Tabs.View();\n        tabs.add({\n            id: \"attribute\",\n            title: \"Attributes\",\n            icon: \"fa fa-bars\",\n            tooltip: \"Edit dataset attributes\",\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: \"Convert\",\n            icon: \"fa-gear\",\n            tooltip: \"Convert to new format\",\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: \"Datatypes\",\n            icon: \"fa-database\",\n            tooltip: \"Change data type\",\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: \"Permissions\",\n            icon: \"fa-user\",\n            tooltip: \"Permissions\",\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Edit attributes\",\n            operations: {\n                submit_attributes: new Ui.ButtonIcon({\n                    tooltip: \"Save attributes of the dataset.\",\n                    icon: \"fa-floppy-o\",\n                    title: \"Save\",\n                    onclick: function() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new Ui.ButtonIcon({\n                    tooltip:\n                        \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Convert to new format\",\n            operations: {\n                submit_conversion: new Ui.ButtonIcon({\n                    tooltip: \"Convert the datatype to a new format.\",\n                    title: \"Convert datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Change datatype\",\n            operations: {\n                submit_datatype: new Ui.ButtonIcon({\n                    tooltip: \"Change the datatype to a new type.\",\n                    title: \"Change datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Manage dataset permissions\",\n            operations: {\n                submit_permission: new Ui.ButtonIcon({\n                    tooltip: \"Save permissions.\",\n                    title: \"Save permissions\",\n                    icon: \"fa-floppy-o \",\n                    onclick: function() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}