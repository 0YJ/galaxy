{"version":3,"sources":["mvc/citation/citation-model.js"],"names":["parseBibtex","_","extend","ENTRY_TYPES_","online","data","Citation","Backbone","Model","_baseMvc2","default","LoggableMixin","_logNamespace","defaults","content","initialize","parsed","bibtexParse","toJSON","this","attributes","err","log","_fields","entry","first","rawFields","entryTags","key","lowerKey","toLowerCase","value","entryType","undefined","fields","BaseCitationCollection","Collection","urlRoot","Galaxy","root","model","HistoryCitationCollection","url","history_id","ToolCitationCollection","tool_id"],"mappings":"+OAAYA,yKAMZC,EAAEC,OAAOF,EAAYG,cACjBC,OAPQJ,IAQRK,KAAM,MAGV,IAMIC,EAAWC,SAASC,MAAMN,OAAOO,EAAAC,QAAQC,eAAeT,QACxDU,cAPe,WASfC,UACIC,QAAS,IAGTC,WAAY,WACR,IAAIC,EACJ,IAEIA,EAASC,YAAYC,OAAOC,KAAKC,WAAWN,SAC9C,MAAOO,GACLF,KAAKG,IAAI,yBAA2BD,GAKxC,GAFAF,KAAKI,WACLJ,KAAKK,MAAQvB,EAAEwB,MAAMT,GACjBG,KAAKK,MAAO,CA/B5B,IAAAE,EAAAP,KAAAK,MAAAG,UAiCgB,IAAK,IAAIC,KAAOF,EAAW,CA/BlC1B,IAAAA,EAAYG,EAAcyB,GAClBC,EAAAD,EAAAE,cACHX,KAAAI,QAAAM,GAAAE,KAIdC,UAAA,WACA,OAAAb,KAAAK,MAAAL,KAAAK,MAAAQ,eAAAC,GAkCQC,OAAQ,WACJ,OAAOf,KAAKI,WAOpBY,EAAyB5B,SAAS6B,WAAWlC,OAAOO,EAAAC,QAAQC,eAAeT,QA/BvEa,cAbW,WAgBHsB,QAAAC,OAAAC,KAAA,MACAvB,SAAAA,EACHwB,MAAAlC,IAmCTmC,EAA4BN,EAAuBjC,QA9B3CwC,IAAA,WACA,OAAIvB,KAAKK,QAAT,cAAgBL,KAAAwB,WAAhB,gBAIQC,EAAIf,EAAJ3B,QAEHwC,IAAA,WACJ,OAAAvB,KAAAkB,QAAA,UAAAlB,KAAA0B,QAAA,cAELb,SAAAA,eA3B2D1B,SAAnEA,EAkEImC,0BAA2BA,EA/B/BG,uBAAAA","file":"../../../scripts/mvc/citation/citation-model.js","sourcesContent":["import * as parseBibtex from \"libs/bibtexParse\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n/* global Backbone */\n\n_.extend(parseBibtex.ENTRY_TYPES_, {\n    online: 998, // Galaxy MOD: Handle @online entries for preprints.\n    data: 999 // Galaxy MOD: Handle @data citations coming from figshare.\n});\n\nvar logNamespace = \"citation\";\n//==============================================================================\n/** @class model for tool citations.\n *  @name Citation\n *  @augments Backbone.Model\n */\nvar Citation = Backbone.Model.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    defaults: {\n        content: \"\"\n    },\n\n        initialize: function() {\n            var parsed;\n            try {\n                // TODO: to model.parse/.validate\n                parsed = bibtexParse.toJSON(this.attributes.content);\n            } catch (err) {\n                this.log(\"Error parsing bibtex: \" + err);\n            }\n\n            this._fields = {};\n            this.entry = _.first(parsed);\n            if (this.entry) {\n                var rawFields = this.entry.entryTags;\n                for (var key in rawFields) {\n                    var value = rawFields[key];\n                    var lowerKey = key.toLowerCase();\n                    this._fields[lowerKey] = value;\n                }\n            }\n        },\n        entryType: function() {\n            return this.entry ? this.entry.entryType : undefined;\n        },\n        fields: function() {\n            return this._fields;\n    }\n});\n\n//==============================================================================\n/** @class Backbone collection of citations.\n */\nvar BaseCitationCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    /** root api url */\n    urlRoot: `${Galaxy.root}api`,\n    partial: true, // Assume some tools in history/workflow may not be properly annotated yet.\n    model: Citation\n});\n\nvar HistoryCitationCollection = BaseCitationCollection.extend({\n    /** complete api url */\n    url: function() {\n        return `${this.urlRoot}/histories/${this.history_id}/citations`;\n    }\n});\n\nvar ToolCitationCollection = BaseCitationCollection.extend({\n    /** complete api url */\n    url: function() {\n        return `${this.urlRoot}/tools/${this.tool_id}/citations`;\n    },\n    partial: false // If a tool has citations, assume they are complete.\n});\n\n//==============================================================================\n\nexport default {\n    Citation: Citation,\n    HistoryCitationCollection: HistoryCitationCollection,\n    ToolCitationCollection: ToolCitationCollection\n};\n"]}