{"version":3,"sources":["mvc/library/library-libraryrow-view.js"],"names":["define","mod_masthead","mod_utils","LibraryRowView","Backbone","View","extend","events","click .edit_library_btn","click .cancel_library_btn","click .save_library_btn","click .delete_library_btn","click .undelete_library_btn","edit_mode","upload_library_btn","edit_library_btn","permission_library_btn","save_library_btn","cancel_library_btn","delete_library_btn","undelete_library_btn","initialize","library","this","render","Galaxy","libraries","libraryListView","collection","get","prepareButtons","button_config","tmpl","element_visibility_config","$el","show","repaint","$","hide","old_element","replaceWith","find","tooltip","vis_config","edit_button_clicked","cancel_library_modification","save_library_modification","new_name","length","is_changed","val","new_description","mod_toastr","warning","new_synopsis","set","success","row_view","error","err_msg","save","patch","delete_library","model","response","responseJSON","info","data","destroy","undelete_library","add","preferences","url","urlRoot","id","templateRow","_","template","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-libraryrow-view.js","sourcesContent":["// dependencies\ndefine([\"layout/masthead\", \"utils/utils\", \"libs/toastr\"], function(\n    mod_masthead,\n    mod_utils,\n    mod_toastr\n) {\n    // galaxy library row view\n    var LibraryRowView = Backbone.View.extend({\n        events: {\n            \"click .edit_library_btn\": \"edit_button_clicked\",\n            \"click .cancel_library_btn\": \"cancel_library_modification\",\n            \"click .save_library_btn\": \"save_library_modification\",\n            \"click .delete_library_btn\": \"delete_library\",\n            \"click .undelete_library_btn\": \"undelete_library\"\n        },\n\n        edit_mode: false,\n\n        element_visibility_config: {\n            upload_library_btn: false,\n            edit_library_btn: false,\n            permission_library_btn: false,\n            save_library_btn: false,\n            cancel_library_btn: false,\n            delete_library_btn: false,\n            undelete_library_btn: false\n        },\n\n        initialize: function(library) {\n            this.render(library);\n        },\n\n        render: function(library) {\n            if (typeof library === \"undefined\") {\n                library = Galaxy.libraries.libraryListView.collection.get(\n                    this.$el.data(\"id\")\n                );\n            }\n            this.prepareButtons(library);\n            var tmpl = this.templateRow();\n            this.setElement(\n                tmpl({\n                    library: library,\n                    button_config: this.element_visibility_config,\n                    edit_mode: this.edit_mode\n                })\n            );\n            this.$el.show();\n            return this;\n        },\n\n        repaint: function(library) {\n            /* need to hide manually because of the element removal in setElement\n    invoked in render() */\n            $(\".tooltip\").hide();\n            /* we need to store the old element to be able to replace it with\n    new one */\n            var old_element = this.$el;\n            /* if user canceled the library param is undefined,\n      if user saved and succeeded the updated library is rendered */\n            this.render();\n            old_element.replaceWith(this.$el);\n            /* now we attach new tooltips to the newly created row element */\n            this.$el.find(\"[data-toggle]\").tooltip();\n        },\n\n        /**\n   * Function modifies the visibility of buttons for\n   * the filling of the row template of given library.\n   */\n        prepareButtons: function(library) {\n            var vis_config = this.element_visibility_config;\n\n            if (this.edit_mode === false) {\n                vis_config.save_library_btn = false;\n                vis_config.cancel_library_btn = false;\n                vis_config.delete_library_btn = false;\n                if (library.get(\"deleted\") === true) {\n                    vis_config.undelete_library_btn = true;\n                    vis_config.upload_library_btn = false;\n                    vis_config.edit_library_btn = false;\n                    vis_config.permission_library_btn = false;\n                } else if (library.get(\"deleted\") === false) {\n                    vis_config.save_library_btn = false;\n                    vis_config.cancel_library_btn = false;\n                    vis_config.undelete_library_btn = false;\n                    if (library.get(\"can_user_add\") === true) {\n                        vis_config.upload_library_btn = true;\n                    }\n                    if (library.get(\"can_user_modify\") === true) {\n                        vis_config.edit_library_btn = true;\n                    }\n                    if (library.get(\"can_user_manage\") === true) {\n                        vis_config.permission_library_btn = true;\n                    }\n                }\n            } else if (this.edit_mode === true) {\n                vis_config.upload_library_btn = false;\n                vis_config.edit_library_btn = false;\n                vis_config.permission_library_btn = false;\n                vis_config.save_library_btn = true;\n                vis_config.cancel_library_btn = true;\n                vis_config.delete_library_btn = true;\n                vis_config.undelete_library_btn = false;\n            }\n\n            this.element_visibility_config = vis_config;\n        },\n\n        /* User clicked the 'edit' button on row so we render a new row\n    that allows editing */\n        edit_button_clicked: function() {\n            this.edit_mode = true;\n            this.repaint();\n        },\n\n        /* User clicked the 'cancel' button so we render normal rowView */\n        cancel_library_modification: function() {\n            // mod_toastr.info('Modifications canceled');\n            this.edit_mode = false;\n            this.repaint();\n        },\n\n        save_library_modification: function() {\n            var library = Galaxy.libraries.libraryListView.collection.get(\n                this.$el.data(\"id\")\n            );\n            var is_changed = false;\n\n            var new_name = this.$el.find(\".input_library_name\").val();\n            if (\n                typeof new_name !== \"undefined\" &&\n                new_name !== library.get(\"name\")\n            ) {\n                if (new_name.length > 2) {\n                    library.set(\"name\", new_name);\n                    is_changed = true;\n                } else {\n                    mod_toastr.warning(\n                        \"Library name has to be at least 3 characters long.\"\n                    );\n                    return;\n                }\n            }\n\n            var new_description = this.$el\n                .find(\".input_library_description\")\n                .val();\n            if (\n                typeof new_description !== \"undefined\" &&\n                new_description !== library.get(\"description\")\n            ) {\n                library.set(\"description\", new_description);\n                is_changed = true;\n            }\n\n            var new_synopsis = this.$el.find(\".input_library_synopsis\").val();\n            if (\n                typeof new_synopsis !== \"undefined\" &&\n                new_synopsis !== library.get(\"synopsis\")\n            ) {\n                library.set(\"synopsis\", new_synopsis);\n                is_changed = true;\n            }\n\n            if (is_changed) {\n                var row_view = this;\n                library.save(null, {\n                    patch: true,\n                    success: function(library) {\n                        row_view.edit_mode = false;\n                        row_view.repaint(library);\n                        mod_toastr.success(\"Changes to library saved.\");\n                    },\n                    error: function(model, response) {\n                        if (typeof response.responseJSON !== \"undefined\") {\n                            mod_toastr.error(response.responseJSON.err_msg);\n                        } else {\n                            mod_toastr.error(\n                                \"An error occured while attempting to update the library.\"\n                            );\n                        }\n                    }\n                });\n            } else {\n                this.edit_mode = false;\n                this.repaint(library);\n                mod_toastr.info(\"Nothing has changed.\");\n            }\n        },\n\n        delete_library: function() {\n            var library = Galaxy.libraries.libraryListView.collection.get(\n                this.$el.data(\"id\")\n            );\n            var row_view = this;\n            // mark the library deleted\n            library.destroy({\n                success: function(library) {\n                    library.set(\"deleted\", true);\n                    // add the new deleted library back to the collection (Galaxy specialty)\n                    Galaxy.libraries.libraryListView.collection.add(library);\n                    row_view.edit_mode = false;\n                    if (\n                        Galaxy.libraries.preferences.get(\"with_deleted\") ===\n                        false\n                    ) {\n                        $(\".tooltip\").hide();\n                        row_view.repaint(library);\n                        row_view.$el.remove();\n                    } else if (\n                        Galaxy.libraries.preferences.get(\"with_deleted\") ===\n                        true\n                    ) {\n                        row_view.repaint(library);\n                    }\n                    mod_toastr.success(\"Library has been marked deleted.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\n                            \"An error occured during deleting the library.\"\n                        );\n                    }\n                }\n            });\n        },\n\n        undelete_library: function() {\n            var library = Galaxy.libraries.libraryListView.collection.get(\n                this.$el.data(\"id\")\n            );\n            var row_view = this;\n\n            // mark the library undeleted\n            library.url = library.urlRoot + library.id + \"?undelete=true\";\n            library.destroy({\n                success: function(library) {\n                    // add the newly undeleted library back to the collection\n                    // backbone does not accept changes through destroy, so update it too\n                    library.set(\"deleted\", false);\n                    Galaxy.libraries.libraryListView.collection.add(library);\n                    row_view.edit_mode = false;\n                    row_view.repaint(library);\n                    mod_toastr.success(\"Library has been undeleted.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\n                            \"An error occured while undeleting the library.\"\n                        );\n                    }\n                }\n            });\n        },\n\n        templateRow: function() {\n            return _.template(\n                [\n                    '<tr class=\"<% if(library.get(\"deleted\") === true) { print(\"active\") } %>\" style=\"display:none;\" data-id=\"<%- library.get(\"id\") %>\">',\n                    \"<% if(!edit_mode) { %>\",\n                    '<% if(library.get(\"deleted\")) { %>',\n                    '<td style=\"color:grey;\"><span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Marked deleted\" style=\"color:grey;\" class=\"fa fa-ban fa-lg deleted_lib_ico\"> </span> <%- library.get(\"name\") %></td>',\n                    \"<% } else { %>\",\n                    '<td><a href=\"#folders/<%- library.get(\"root_folder_id\") %>\"><%- library.get(\"name\") %></a></td>',\n                    \"<% } %>\",\n                    '<% if(library.get(\"description\")) { %>',\n                    '<% if( (library.get(\"description\")).length> 80 ) { %>',\n                    '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"description\")) %>\"><%= _.escape(library.get(\"description\")).substring(0, 80) + \"...\" %></td>',\n                    \"<% } else { %>\",\n                    '<td><%= _.escape(library.get(\"description\"))%></td>',\n                    \"<% } %>\",\n                    \"<% } else { %>\",\n                    \"<td></td>\",\n                    \"<% } %>\",\n                    '<% if(library.get(\"synopsis\")) { %>',\n                    '<% if( (library.get(\"synopsis\")).length> 120 ) { %>',\n                    '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"synopsis\")) %>\"><%= _.escape(library.get(\"synopsis\")).substring(0, 120) + \"...\" %></td>',\n                    \"<% } else { %>\",\n                    '<td><%= _.escape(library.get(\"synopsis\"))%></td>',\n                    \"<% } %>\",\n                    \"<% } else { %>\",\n                    \"<td></td>\",\n                    \"<% } %>\",\n                    \"<% } else if(edit_mode){ %>\",\n                    '<td><textarea rows=\"4\" class=\"form-control input_library_name\" placeholder=\"name\" ><%- library.get(\"name\") %></textarea></td>',\n                    '<td><textarea rows=\"4\" class=\"form-control input_library_description\" placeholder=\"description\" ><%- library.get(\"description\") %></textarea></td>',\n                    '<td><textarea rows=\"4\" class=\"form-control input_library_synopsis\" placeholder=\"synopsis\" ><%- library.get(\"synopsis\") %></textarea></td>',\n                    \"<% } %>\",\n                    '<td class=\"right-center\">',\n                    '<% if( (library.get(\"public\")) && (library.get(\"deleted\") === false) ) { %>',\n                    '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Unrestricted library\" style=\"color:grey;\" class=\"fa fa-globe fa-lg public_lib_ico\"> </span>',\n                    \"<% }%>\",\n                    '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs edit_library_btn\" type=\"button\" style=\"<% if(button_config.edit_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-pencil\"></span></button>',\n                    '<a href=\"#library/<%- library.get(\"id\") %>/permissions\"><button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Manage \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs permission_library_btn\" type=\"button\" style=\"<% if(button_config.permission_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-group\"></span></button></a>',\n                    '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save changes\" class=\"primary-button btn-xs save_library_btn\" type=\"button\" style=\"<% if(button_config.save_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-floppy-o\"> Save</span></button>',\n                    '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Discard changes\" class=\"primary-button btn-xs cancel_library_btn\" type=\"button\" style=\"<% if(button_config.cancel_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-times\"> Cancel</span></button>',\n                    '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Delete <%- library.get(\"name\") %>\" class=\"primary-button btn-xs delete_library_btn\" type=\"button\" style=\"<% if(button_config.delete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-trash-o\"> Delete</span></button>',\n                    '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Undelete <%- library.get(\"name\") %> \" class=\"primary-button btn-xs undelete_library_btn\" type=\"button\" style=\"<% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-unlock\"> Undelete</span></button>',\n                    \"</td>\",\n                    \"</tr>\"\n                ].join(\"\")\n            );\n        }\n    });\n\n    return {\n        LibraryRowView: LibraryRowView\n    };\n});\n"]}