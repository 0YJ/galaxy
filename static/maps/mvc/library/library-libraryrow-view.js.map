{"version":3,"sources":["mvc/library/library-libraryrow-view.js"],"names":["LibraryRowView","Backbone","View","extend","events","click .edit_library_btn","click .cancel_library_btn","click .save_library_btn","click .delete_library_btn","click .undelete_library_btn","edit_mode","element_visibility_config","upload_library_btn","edit_library_btn","permission_library_btn","delete_library_btn","undelete_library_btn","initialize","library","this","render","libraryListView","collection","get","cancel_library_btn","tmpl","show","repaint","prepareButtons","old_element","$el","replaceWith","find","tooltip","vis_config","save_library_btn","cancel_library_modification","save_library_modification","libraries","data","is_changed","new_name","val","warning","Galaxy","new_description","set","new_synopsis","save","patch","success","row_view","error","model","response","responseJSON","_toastr2","default","err_msg","delete_library","destroy","$","preferences","hide","remove","undelete_library","url","urlRoot","id","add","templateRow","template","_","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-libraryrow-view.js","sourcesContent":["// dependencies\nimport mod_masthead from \"layout/masthead\";\nimport mod_utils from \"utils/utils\";\nimport mod_toastr from \"libs/toastr\";\n// galaxy library row view\nvar LibraryRowView = Backbone.View.extend({\n    events: {\n        \"click .edit_library_btn\": \"edit_button_clicked\",\n        \"click .cancel_library_btn\": \"cancel_library_modification\",\n        \"click .save_library_btn\": \"save_library_modification\",\n        \"click .delete_library_btn\": \"delete_library\",\n        \"click .undelete_library_btn\": \"undelete_library\"\n    },\n\n    edit_mode: false,\n\n    element_visibility_config: {\n        upload_library_btn: false,\n        edit_library_btn: false,\n        permission_library_btn: false,\n        save_library_btn: false,\n        cancel_library_btn: false,\n        delete_library_btn: false,\n        undelete_library_btn: false\n    },\n\n    initialize: function(library) {\n        this.render(library);\n    },\n\n    render: function(library) {\n        if (typeof library === \"undefined\") {\n            library = Galaxy.libraries.libraryListView.collection.get(\n                this.$el.data(\"id\")\n            );\n        }\n        this.prepareButtons(library);\n        var tmpl = this.templateRow();\n        this.setElement(\n            tmpl({\n                library: library,\n                button_config: this.element_visibility_config,\n                edit_mode: this.edit_mode\n            })\n        );\n        this.$el.show();\n        return this;\n    },\n\n    repaint: function(library) {\n        /* need to hide manually because of the element removal in setElement\n    invoked in render() */\n        $(\".tooltip\").hide();\n        /* we need to store the old element to be able to replace it with\n    new one */\n        var old_element = this.$el;\n        /* if user canceled the library param is undefined,\n      if user saved and succeeded the updated library is rendered */\n        this.render();\n        old_element.replaceWith(this.$el);\n        /* now we attach new tooltips to the newly created row element */\n        this.$el.find(\"[data-toggle]\").tooltip();\n    },\n\n    /**\n   * Function modifies the visibility of buttons for\n   * the filling of the row template of given library.\n   */\n    prepareButtons: function(library) {\n        var vis_config = this.element_visibility_config;\n\n        if (this.edit_mode === false) {\n            vis_config.save_library_btn = false;\n            vis_config.cancel_library_btn = false;\n            vis_config.delete_library_btn = false;\n            if (library.get(\"deleted\") === true) {\n                vis_config.undelete_library_btn = true;\n                vis_config.upload_library_btn = false;\n                vis_config.edit_library_btn = false;\n                vis_config.permission_library_btn = false;\n            } else if (library.get(\"deleted\") === false) {\n                vis_config.save_library_btn = false;\n                vis_config.cancel_library_btn = false;\n                vis_config.undelete_library_btn = false;\n                if (library.get(\"can_user_add\") === true) {\n                    vis_config.upload_library_btn = true;\n                }\n                if (library.get(\"can_user_modify\") === true) {\n                    vis_config.edit_library_btn = true;\n                }\n                if (library.get(\"can_user_manage\") === true) {\n                    vis_config.permission_library_btn = true;\n                }\n            }\n        } else if (this.edit_mode === true) {\n            vis_config.upload_library_btn = false;\n            vis_config.edit_library_btn = false;\n            vis_config.permission_library_btn = false;\n            vis_config.save_library_btn = true;\n            vis_config.cancel_library_btn = true;\n            vis_config.delete_library_btn = true;\n            vis_config.undelete_library_btn = false;\n        }\n\n        this.element_visibility_config = vis_config;\n    },\n\n    /* User clicked the 'edit' button on row so we render a new row\n    that allows editing */\n    edit_button_clicked: function() {\n        this.edit_mode = true;\n        this.repaint();\n    },\n\n    /* User clicked the 'cancel' button so we render normal rowView */\n    cancel_library_modification: function() {\n        // mod_toastr.info('Modifications canceled');\n        this.edit_mode = false;\n        this.repaint();\n    },\n\n    save_library_modification: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(\n            this.$el.data(\"id\")\n        );\n        var is_changed = false;\n\n        var new_name = this.$el.find(\".input_library_name\").val();\n        if (\n            typeof new_name !== \"undefined\" &&\n            new_name !== library.get(\"name\")\n        ) {\n            if (new_name.length > 2) {\n                library.set(\"name\", new_name);\n                is_changed = true;\n            } else {\n                mod_toastr.warning(\n                    \"Library name has to be at least 3 characters long.\"\n                );\n                return;\n            }\n        }\n\n        var new_description = this.$el.find(\".input_library_description\").val();\n        if (\n            typeof new_description !== \"undefined\" &&\n            new_description !== library.get(\"description\")\n        ) {\n            library.set(\"description\", new_description);\n            is_changed = true;\n        }\n\n        var new_synopsis = this.$el.find(\".input_library_synopsis\").val();\n        if (\n            typeof new_synopsis !== \"undefined\" &&\n            new_synopsis !== library.get(\"synopsis\")\n        ) {\n            library.set(\"synopsis\", new_synopsis);\n            is_changed = true;\n        }\n\n        if (is_changed) {\n            var row_view = this;\n            library.save(null, {\n                patch: true,\n                success: function(library) {\n                    row_view.edit_mode = false;\n                    row_view.repaint(library);\n                    mod_toastr.success(\"Changes to library saved.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\n                            \"An error occured while attempting to update the library.\"\n                        );\n                    }\n                }\n            });\n        } else {\n            this.edit_mode = false;\n            this.repaint(library);\n            mod_toastr.info(\"Nothing has changed.\");\n        }\n    },\n\n    delete_library: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(\n            this.$el.data(\"id\")\n        );\n        var row_view = this;\n        // mark the library deleted\n        library.destroy({\n            success: function(library) {\n                library.set(\"deleted\", true);\n                // add the new deleted library back to the collection (Galaxy specialty)\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                if (\n                    Galaxy.libraries.preferences.get(\"with_deleted\") === false\n                ) {\n                    $(\".tooltip\").hide();\n                    row_view.repaint(library);\n                    row_view.$el.remove();\n                } else if (\n                    Galaxy.libraries.preferences.get(\"with_deleted\") === true\n                ) {\n                    row_view.repaint(library);\n                }\n                mod_toastr.success(\"Library has been marked deleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\n                        \"An error occured during deleting the library.\"\n                    );\n                }\n            }\n        });\n    },\n\n    undelete_library: function() {\n        var library = Galaxy.libraries.libraryListView.collection.get(\n            this.$el.data(\"id\")\n        );\n        var row_view = this;\n\n        // mark the library undeleted\n        library.url = library.urlRoot + library.id + \"?undelete=true\";\n        library.destroy({\n            success: function(library) {\n                // add the newly undeleted library back to the collection\n                // backbone does not accept changes through destroy, so update it too\n                library.set(\"deleted\", false);\n                Galaxy.libraries.libraryListView.collection.add(library);\n                row_view.edit_mode = false;\n                row_view.repaint(library);\n                mod_toastr.success(\"Library has been undeleted.\");\n            },\n            error: function(model, response) {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\n                        \"An error occured while undeleting the library.\"\n                    );\n                }\n            }\n        });\n    },\n\n    templateRow: function() {\n        return _.template(\n            [\n                '<tr class=\"<% if(library.get(\"deleted\") === true) { print(\"active\") } %>\" style=\"display:none;\" data-id=\"<%- library.get(\"id\") %>\">',\n                \"<% if(!edit_mode) { %>\",\n                '<% if(library.get(\"deleted\")) { %>',\n                '<td style=\"color:grey;\"><span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Marked deleted\" style=\"color:grey;\" class=\"fa fa-ban fa-lg deleted_lib_ico\"> </span> <%- library.get(\"name\") %></td>',\n                \"<% } else { %>\",\n                '<td><a href=\"#folders/<%- library.get(\"root_folder_id\") %>\"><%- library.get(\"name\") %></a></td>',\n                \"<% } %>\",\n                '<% if(library.get(\"description\")) { %>',\n                '<% if( (library.get(\"description\")).length> 80 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"description\")) %>\"><%= _.escape(library.get(\"description\")).substring(0, 80) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"description\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\")) { %>',\n                '<% if( (library.get(\"synopsis\")).length> 120 ) { %>',\n                '<td data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"<%= _.escape(library.get(\"synopsis\")) %>\"><%= _.escape(library.get(\"synopsis\")).substring(0, 120) + \"...\" %></td>',\n                \"<% } else { %>\",\n                '<td><%= _.escape(library.get(\"synopsis\"))%></td>',\n                \"<% } %>\",\n                \"<% } else { %>\",\n                \"<td></td>\",\n                \"<% } %>\",\n                \"<% } else if(edit_mode){ %>\",\n                '<td><textarea rows=\"4\" class=\"form-control input_library_name\" placeholder=\"name\" ><%- library.get(\"name\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_description\" placeholder=\"description\" ><%- library.get(\"description\") %></textarea></td>',\n                '<td><textarea rows=\"4\" class=\"form-control input_library_synopsis\" placeholder=\"synopsis\" ><%- library.get(\"synopsis\") %></textarea></td>',\n                \"<% } %>\",\n                '<td class=\"right-center\">',\n                '<% if( (library.get(\"public\")) && (library.get(\"deleted\") === false) ) { %>',\n                '<span data-toggle=\"tooltip\" data-placement=\"top\" title=\"Unrestricted library\" style=\"color:grey;\" class=\"fa fa-globe fa-lg public_lib_ico\"> </span>',\n                \"<% }%>\",\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Modify \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs edit_library_btn\" type=\"button\" style=\"<% if(button_config.edit_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-pencil\"></span></button>',\n                '<a href=\"#library/<%- library.get(\"id\") %>/permissions\"><button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Manage \\'<%- library.get(\"name\") %>\\'\" class=\"primary-button btn-xs permission_library_btn\" type=\"button\" style=\"<% if(button_config.permission_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-group\"></span></button></a>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Save changes\" class=\"primary-button btn-xs save_library_btn\" type=\"button\" style=\"<% if(button_config.save_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-floppy-o\"> Save</span></button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Discard changes\" class=\"primary-button btn-xs cancel_library_btn\" type=\"button\" style=\"<% if(button_config.cancel_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-times\"> Cancel</span></button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Delete <%- library.get(\"name\") %>\" class=\"primary-button btn-xs delete_library_btn\" type=\"button\" style=\"<% if(button_config.delete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-trash-o\"> Delete</span></button>',\n                '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Undelete <%- library.get(\"name\") %> \" class=\"primary-button btn-xs undelete_library_btn\" type=\"button\" style=\"<% if(button_config.undelete_library_btn === false) { print(\"display:none;\") } %>\"><span class=\"fa fa-unlock\"> Undelete</span></button>',\n                \"</td>\",\n                \"</tr>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryRowView: LibraryRowView\n};\n"]}