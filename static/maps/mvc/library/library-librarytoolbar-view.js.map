{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["define","mod_toastr","mod_library_model","LibraryToolbarView","Backbone","View","extend","el","defaults","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #lib_page_size_prompt","keyup .library-search-input","initialize","options","this","_","render","toolbar_template","templateToolBar","is_admin","is_anonym","Galaxy","user","isAdmin","isAnonymous","$el","html","admin_user","anon_user","find","checked","libraries","preferences","get","renderPaginator","paginator_template","templatePaginator","show_page","parseInt","page_count","total_libraries_count","libraries_shown","createLibraryFromModal","event","preventDefault","stopPropagation","self","modal","show","closing_events","title","body","templateNewLibraryInModal","buttons","Create","createNewLibrary","Close","hide","libraryDetails","serializeNewLibrary","validateNewLibrary","library","Library","save","success","libraryListView","collection","add","clearLibraryModal","error","model","response","responseJSON","err_msg","showPageSizePrompt","library_page_size","prompt","set","$","val","name","description","synopsis","includeDeletedChecked","target","with_deleted","fetchDeleted","searchLibraries","template","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["define([\n  \"libs/toastr\",\n  \"mvc/library/library-model\"],\nfunction(mod_toastr,\n         mod_library_model) {\n/**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\nvar LibraryToolbarView = Backbone.View.extend({\n  el: '#center',\n\n  defaults: {\n    search_term: ''\n  },\n\n  events: {\n    'click #create_new_library_btn' : 'createLibraryFromModal',\n    'click #include_deleted_chk'    : 'includeDeletedChecked',\n    'click #lib_page_size_prompt'   : 'showPageSizePrompt',\n    'keyup .library-search-input'   : 'searchLibraries'\n  },\n\n  initialize: function( options ){\n    this.options = _.defaults( this.options || {}, options, this.defaults );\n    this.render();\n  },\n\n  render: function(){\n    var toolbar_template = this.templateToolBar();\n    var is_admin = false;\n    var is_anonym = true;\n    if ( Galaxy.user ){\n      is_admin = Galaxy.user.isAdmin();\n      is_anonym = Galaxy.user.isAnonymous();\n    }\n    this.$el.html(toolbar_template( { admin_user: is_admin, anon_user: is_anonym } ) );\n    if ( is_admin ){\n      this.$el.find( '#include_deleted_chk' )[0].checked = Galaxy.libraries.preferences.get( 'with_deleted' );\n    }\n  },\n\n  /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n  renderPaginator: function( options ){\n    this.options = _.extend( this.options, options );\n    var paginator_template = this.templatePaginator();\n    this.$el.find( '#library_paginator' ).html( paginator_template({\n      show_page: parseInt( this.options.show_page ),\n      page_count: parseInt( this.options.page_count ),\n      total_libraries_count: this.options.total_libraries_count,\n      libraries_shown: this.options.libraries_shown\n    }));\n  },\n\n  /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n  createLibraryFromModal : function (event){\n    event.preventDefault();\n    event.stopPropagation();\n    var self = this;\n    this.modal = Galaxy.modal;\n    this.modal.show({\n      closing_events  : true,\n      title           : 'Create New Library',\n      body            : this.templateNewLibraryInModal(),\n      buttons         : {\n        'Create'      : function() { self.createNewLibrary(); },\n        'Close'       : function() { self.modal.hide(); }\n      }\n    });\n  },\n\n  /**\n   * Create the new library using the API asynchronously.\n   */\n  createNewLibrary: function(){\n    var libraryDetails = this.serializeNewLibrary();\n    if (this.validateNewLibrary(libraryDetails)){\n      var library = new mod_library_model.Library();\n      var self = this;\n      library.save(libraryDetails, {\n        success: function (library) {\n          Galaxy.libraries.libraryListView.collection.add(library);\n          self.modal.hide();\n          self.clearLibraryModal();\n          Galaxy.libraries.libraryListView.render();\n          mod_toastr.success('Library created.');\n        },\n        error: function(model, response){\n          if (typeof response.responseJSON !== \"undefined\"){\n            mod_toastr.error(response.responseJSON.err_msg);\n          } else {\n            mod_toastr.error('An error occured.');\n          }\n        }\n      });\n    } else {\n      mod_toastr.error('Library\\'s name is missing.');\n    }\n    return false;\n  },\n\n  /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n  showPageSizePrompt: function(){\n    var library_page_size = prompt( 'How many libraries per page do you want to see?', Galaxy.libraries.preferences.get( 'library_page_size' ) );\n    if ( ( library_page_size != null ) && ( library_page_size == parseInt( library_page_size ) ) ) {\n      Galaxy.libraries.preferences.set( { 'library_page_size': parseInt( library_page_size ) } );\n      Galaxy.libraries.libraryListView.render( { show_page: 1 } );\n    }\n  },\n\n  /**\n   * Clear the library modal once it is saved.\n   */\n  clearLibraryModal : function(){\n    $(\"input[name='Name']\").val('');\n    $(\"input[name='Description']\").val('');\n    $(\"input[name='Synopsis']\").val('');\n  },\n\n  /**\n   * Prepare new library variables to be submitted to API.\n   */\n  serializeNewLibrary : function(){\n    return {\n      name: $(\"input[name='Name']\").val(),\n      description: $(\"input[name='Description']\").val(),\n      synopsis: $(\"input[name='Synopsis']\").val()\n    };\n  },\n\n  /**\n   * Check whether entered values are valid.\n   */\n  validateNewLibrary: function( libraryDetails ){\n      return libraryDetails.name !== '';\n  },\n\n  /**\n   * Include or exclude deleted libraries in the view.\n   */\n  includeDeletedChecked: function( event ){\n    if (event.target.checked){\n        Galaxy.libraries.preferences.set( { 'with_deleted': true } );\n        Galaxy.libraries.libraryListView.fetchDeleted();\n    } else{\n        Galaxy.libraries.preferences.set( { 'with_deleted': false } );\n        Galaxy.libraries.libraryListView.render();\n    }\n  },\n\n  /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n  searchLibraries: function(event){\n    var search_term = $(\".library-search-input\").val();\n    this.options.search_term = search_term;\n    Galaxy.libraries.libraryListView.searchLibraries(search_term);\n  },\n\n  templateToolBar: function(){\n    return _.template([\n      '<div class=\"library_style_container\">',\n        '<div id=\"toolbar_form\">',\n          '<div id=\"library_toolbar\">',\n            '<form class=\"form-inline\" role=\"form\">',\n              '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n              '<span id=\"library_paginator\" class=\"library-paginator\">',\n              // paginator will append here\n              '</span>',\n              '<div class=\"form-group toolbar-item\">',\n                '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n              '</div>',\n              // only admins see the following\n              '<% if(admin_user === true) { %>',\n                  '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                    '<label>',\n                      '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                        '&nbsp;include deleted ',\n                      '</input>',\n                    '</label>',\n                  '</div>',\n                  '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                    '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                '</span>',\n              '<% } %>',\n              '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Visit Libraries Wiki\">',\n                '<a href=\"https://wiki.galaxyproject.org/DataLibraries/screen/ListOfLibraries\" target=\"_blank\">',\n                  '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                '</a>',\n              '</span>',\n            '</form>',\n          '</div>',\n        '</div>',\n        '<div id=\"libraries_element\">',\n        // table with libraries will append here\n        '</div>',\n      '</div>'\n    ].join(''));\n  },\n\n  templatePaginator: function(){\n    return _.template([\n    '<ul class=\"pagination pagination-sm\">',\n      '<% if ( ( show_page - 1 ) > 0 ) { %>',\n      '<% if ( ( show_page - 1 ) > page_count ) { %>', // we are on higher page than total page count\n        '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } else { %>',\n        '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } %>',\n      '<% } else { %>', // we are on the first page\n        '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } %>',\n        '<li class=\"active\">',\n          '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n        '</li>',\n      '<% if ( ( show_page ) < page_count ) { %>',\n        '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } else { %>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } %>',\n    '</ul>',\n    '<span id=\"lib_page_size_prompt\">',\n      ' showing <a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Click to change the number of libraries on page\"><%- libraries_shown %></a> of <%- total_libraries_count %> libraries',\n    '</span>'\n    ].join(''));\n  },\n\n  templateNewLibraryInModal: function(){\n    return _.template([\n      '<div id=\"new_library_modal\">',\n        '<form>',\n          '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n          '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n          '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n        '</form>',\n      '</div>'\n    ].join(''));\n  }\n});\n\nreturn {\n  LibraryToolbarView: LibraryToolbarView\n};\n\n});\n"]}