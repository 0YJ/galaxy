{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["define","mod_toastr","mod_library_model","LibraryToolbarView","Backbone","View","el","defaults","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click #lib_page_size_prompt","keyup .library-search-input","initialize","options","this","render","is_admin","Galaxy","user","is_anonym","$el","isAdmin","isAnonymous","html","toolbar_template","admin_user","anon_user","find","renderPaginator","libraries","preferences","paginator_template","show_page","_","extend","templatePaginator","createLibraryFromModal","event","stopPropagation","self","parseInt","page_count","total_libraries_count","libraries_shown","hide","preventDefault","modal","show","closing_events","title","body","templateNewLibraryInModal","createNewLibrary","libraryDetails","validateNewLibrary","Close","library","save","Library","success","libraryListView","collection","add","clearLibraryModal","error","model","response","responseJSON","library_page_size","prompt","err_msg","$","get","serializeNewLibrary","description","set","synopsis","val","name","includeDeletedChecked","target","checked","with_deleted","fetchDeleted","excludeRestrictedChecked","without_restricted","template","searchLibraries","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["define([\"libs/toastr\", \"mvc/library/library-model\"], function(\n    mod_toastr,\n    mod_library_model\n) {\n    /**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\n    var LibraryToolbarView = Backbone.View.extend({\n        el: \"#center\",\n\n        defaults: {\n            search_term: \"\"\n        },\n\n        events: {\n            \"click #create_new_library_btn\": \"createLibraryFromModal\",\n            \"click #include_deleted_chk\": \"includeDeletedChecked\",\n            \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n            \"click #lib_page_size_prompt\": \"showPageSizePrompt\",\n            \"keyup .library-search-input\": \"searchLibraries\"\n        },\n\n        initialize: function(options) {\n            this.options = _.defaults(\n                this.options || {},\n                options,\n                this.defaults\n            );\n            this.render();\n        },\n\n        render: function() {\n            var toolbar_template = this.templateToolBar();\n            var is_admin = false;\n            var is_anonym = true;\n            if (Galaxy.user) {\n                is_admin = Galaxy.user.isAdmin();\n                is_anonym = Galaxy.user.isAnonymous();\n            }\n            this.$el.html(\n                toolbar_template({ admin_user: is_admin, anon_user: is_anonym })\n            );\n            if (is_admin) {\n                this.$el.find(\n                    \"#include_deleted_chk\"\n                )[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n                this.$el.find(\n                    \"#exclude_restricted_chk\"\n                )[0].checked = Galaxy.libraries.preferences.get(\n                    \"without_restricted\"\n                );\n            }\n        },\n\n        /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n        renderPaginator: function(options) {\n            this.options = _.extend(this.options, options);\n            var paginator_template = this.templatePaginator();\n            this.$el.find(\"#library_paginator\").html(\n                paginator_template({\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_libraries_count: this.options.total_libraries_count,\n                    libraries_shown: this.options.libraries_shown\n                })\n            );\n        },\n\n        /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n        createLibraryFromModal: function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var self = this;\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: \"Create New Library\",\n                body: this.templateNewLibraryInModal(),\n                buttons: {\n                    Create: function() {\n                        self.createNewLibrary();\n                    },\n                    Close: function() {\n                        self.modal.hide();\n                    }\n                }\n            });\n        },\n\n        /**\n   * Create the new library using the API asynchronously.\n   */\n        createNewLibrary: function() {\n            var libraryDetails = this.serializeNewLibrary();\n            if (this.validateNewLibrary(libraryDetails)) {\n                var library = new mod_library_model.Library();\n                var self = this;\n                library.save(libraryDetails, {\n                    success: function(library) {\n                        Galaxy.libraries.libraryListView.collection.add(\n                            library\n                        );\n                        self.modal.hide();\n                        self.clearLibraryModal();\n                        Galaxy.libraries.libraryListView.render();\n                        mod_toastr.success(\"Library created.\");\n                    },\n                    error: function(model, response) {\n                        if (typeof response.responseJSON !== \"undefined\") {\n                            mod_toastr.error(response.responseJSON.err_msg);\n                        } else {\n                            mod_toastr.error(\"An error occured.\");\n                        }\n                    }\n                });\n            } else {\n                mod_toastr.error(\"Library's name is missing.\");\n            }\n            return false;\n        },\n\n        /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n        showPageSizePrompt: function() {\n            var library_page_size = prompt(\n                \"How many libraries per page do you want to see?\",\n                Galaxy.libraries.preferences.get(\"library_page_size\")\n            );\n            if (\n                library_page_size != null &&\n                library_page_size == parseInt(library_page_size)\n            ) {\n                Galaxy.libraries.preferences.set({\n                    library_page_size: parseInt(library_page_size)\n                });\n                Galaxy.libraries.libraryListView.render({ show_page: 1 });\n            }\n        },\n\n        /**\n   * Clear the library modal once it is saved.\n   */\n        clearLibraryModal: function() {\n            $(\"input[name='Name']\").val(\"\");\n            $(\"input[name='Description']\").val(\"\");\n            $(\"input[name='Synopsis']\").val(\"\");\n        },\n\n        /**\n   * Prepare new library variables to be submitted to API.\n   */\n        serializeNewLibrary: function() {\n            return {\n                name: $(\"input[name='Name']\").val(),\n                description: $(\"input[name='Description']\").val(),\n                synopsis: $(\"input[name='Synopsis']\").val()\n            };\n        },\n\n        /**\n   * Check whether entered values are valid.\n   */\n        validateNewLibrary: function(libraryDetails) {\n            return libraryDetails.name !== \"\";\n        },\n\n        /**\n   * Include or exclude deleted libraries in the view.\n   */\n        includeDeletedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ with_deleted: true });\n                Galaxy.libraries.libraryListView.fetchDeleted();\n            } else {\n                Galaxy.libraries.preferences.set({ with_deleted: false });\n                Galaxy.libraries.libraryListView.render();\n            }\n        },\n\n        /**\n   * Include or exclude restricted libraries in the view.\n   */\n        excludeRestrictedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ without_restricted: true });\n            } else {\n                Galaxy.libraries.preferences.set({ without_restricted: false });\n            }\n            Galaxy.libraries.libraryListView.render();\n        },\n\n        /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n        searchLibraries: function(event) {\n            var search_term = $(\".library-search-input\").val();\n            this.options.search_term = search_term;\n            Galaxy.libraries.libraryListView.searchLibraries(search_term);\n        },\n\n        templateToolBar: function() {\n            return _.template(\n                [\n                    '<div class=\"library_style_container\">',\n                    '<div id=\"toolbar_form\">',\n                    '<div id=\"library_toolbar\">',\n                    '<form class=\"form-inline\" role=\"form\">',\n                    '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n                    '<span id=\"library_paginator\" class=\"library-paginator\">',\n                    // paginator will append here\n                    \"</span>\",\n                    '<div class=\"form-group toolbar-item\">',\n                    '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n                    \"</div>\",\n                    // only admins see the following\n                    \"<% if(admin_user === true) { %>\",\n                    '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                    \"<label>\",\n                    '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                    \"include deleted \",\n                    \"</input>\",\n                    \"</label>\",\n                    \"<label>\",\n                    '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                    \"exclude restricted\",\n                    \"</input>\",\n                    \"</label>\",\n                    \"</div>\",\n                    '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                    '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                    \"</span>\",\n                    \"<% } %>\",\n                    '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                    '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                    '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                    \"</a>\",\n                    \"</span>\",\n                    \"</form>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div id=\"libraries_element\">',\n                    // table with libraries will append here\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        },\n\n        templatePaginator: function() {\n            return _.template(\n                [\n                    '<ul class=\"pagination pagination-sm\">',\n                    \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                    \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } else { %>\",\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    \"<% } else { %>\", // we are on the first page\n                    '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    '<li class=\"active\">',\n                    '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                    \"</li>\",\n                    \"<% if ( ( show_page ) < page_count ) { %>\",\n                    '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } else { %>\",\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } %>\",\n                    \"</ul>\",\n                    '<span id=\"lib_page_size_prompt\">',\n                    ' showing <a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Click to change the number of libraries on page\"><%- libraries_shown %></a> of <%- total_libraries_count %> libraries',\n                    \"</span>\"\n                ].join(\"\")\n            );\n        },\n\n        templateNewLibraryInModal: function() {\n            return _.template(\n                [\n                    '<div id=\"new_library_modal\">',\n                    \"<form>\",\n                    '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                    '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                    '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                    \"</form>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        }\n    });\n\n    return {\n        LibraryToolbarView: LibraryToolbarView\n    };\n});\n"]}