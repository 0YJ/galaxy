{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["define","mod_toastr","mod_library_model","LibraryToolbarView","Backbone","View","extend","defaults","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click #lib_page_size_prompt","keyup .library-search-input","initialize","render","options","this","_","is_admin","toolbar_template","templateToolBar","user","Galaxy","is_anonym","isAdmin","html","$el","find","admin_user","checked","libraries","preferences","get","renderPaginator","paginator_template","show_page","page_count","total_libraries_count","libraries_shown","event","self","stopPropagation","modal","closing_events","title","show","body","templateNewLibraryInModal","buttons","Create","createNewLibrary","Close","hide","libraryDetails","serializeNewLibrary","validateNewLibrary","library","success","save","collection","add","libraryListView","clearLibraryModal","response","responseJSON","error","err_msg","showPageSizePrompt","library_page_size","prompt","parseInt","$","val","description","name","includeDeletedChecked","target","set","with_deleted","fetchDeleted","excludeRestrictedChecked","without_restricted","searchLibraries","template","templatePaginator","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["define([\n  \"libs/toastr\",\n  \"mvc/library/library-model\"],\nfunction(mod_toastr,\n         mod_library_model) {\n/**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\nvar LibraryToolbarView = Backbone.View.extend({\n  el: '#center',\n\n  defaults: {\n    search_term: ''\n  },\n\n  events: {\n    'click #create_new_library_btn' : 'createLibraryFromModal',\n    'click #include_deleted_chk'    : 'includeDeletedChecked',\n    'click #exclude_restricted_chk' : 'excludeRestrictedChecked',\n    'click #lib_page_size_prompt'   : 'showPageSizePrompt',\n    'keyup .library-search-input'   : 'searchLibraries'\n  },\n\n  initialize: function( options ){\n    this.options = _.defaults( this.options || {}, options, this.defaults );\n    this.render();\n  },\n\n  render: function(){\n    var toolbar_template = this.templateToolBar();\n    var is_admin = false;\n    var is_anonym = true;\n    if ( Galaxy.user ){\n      is_admin = Galaxy.user.isAdmin();\n      is_anonym = Galaxy.user.isAnonymous();\n    }\n    this.$el.html(toolbar_template( { admin_user: is_admin, anon_user: is_anonym } ) );\n    if ( is_admin ){\n      this.$el.find( '#include_deleted_chk' )[0].checked = Galaxy.libraries.preferences.get( 'with_deleted' );\n      this.$el.find( '#exclude_restricted_chk' )[0].checked = Galaxy.libraries.preferences.get( 'without_restricted' );\n    }\n  },\n\n  /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n  renderPaginator: function( options ){\n    this.options = _.extend( this.options, options );\n    var paginator_template = this.templatePaginator();\n    this.$el.find( '#library_paginator' ).html( paginator_template({\n      show_page: parseInt( this.options.show_page ),\n      page_count: parseInt( this.options.page_count ),\n      total_libraries_count: this.options.total_libraries_count,\n      libraries_shown: this.options.libraries_shown\n    }));\n  },\n\n  /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n  createLibraryFromModal : function (event){\n    event.preventDefault();\n    event.stopPropagation();\n    var self = this;\n    this.modal = Galaxy.modal;\n    this.modal.show({\n      closing_events  : true,\n      title           : 'Create New Library',\n      body            : this.templateNewLibraryInModal(),\n      buttons         : {\n        'Create'      : function() { self.createNewLibrary(); },\n        'Close'       : function() { self.modal.hide(); }\n      }\n    });\n  },\n\n  /**\n   * Create the new library using the API asynchronously.\n   */\n  createNewLibrary: function(){\n    var libraryDetails = this.serializeNewLibrary();\n    if (this.validateNewLibrary(libraryDetails)){\n      var library = new mod_library_model.Library();\n      var self = this;\n      library.save(libraryDetails, {\n        success: function (library) {\n          Galaxy.libraries.libraryListView.collection.add(library);\n          self.modal.hide();\n          self.clearLibraryModal();\n          Galaxy.libraries.libraryListView.render();\n          mod_toastr.success('Library created.');\n        },\n        error: function(model, response){\n          if (typeof response.responseJSON !== \"undefined\"){\n            mod_toastr.error(response.responseJSON.err_msg);\n          } else {\n            mod_toastr.error('An error occured.');\n          }\n        }\n      });\n    } else {\n      mod_toastr.error('Library\\'s name is missing.');\n    }\n    return false;\n  },\n\n  /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n  showPageSizePrompt: function(){\n    var library_page_size = prompt( 'How many libraries per page do you want to see?', Galaxy.libraries.preferences.get( 'library_page_size' ) );\n    if ( ( library_page_size != null ) && ( library_page_size == parseInt( library_page_size ) ) ) {\n      Galaxy.libraries.preferences.set( { 'library_page_size': parseInt( library_page_size ) } );\n      Galaxy.libraries.libraryListView.render( { show_page: 1 } );\n    }\n  },\n\n  /**\n   * Clear the library modal once it is saved.\n   */\n  clearLibraryModal : function(){\n    $(\"input[name='Name']\").val('');\n    $(\"input[name='Description']\").val('');\n    $(\"input[name='Synopsis']\").val('');\n  },\n\n  /**\n   * Prepare new library variables to be submitted to API.\n   */\n  serializeNewLibrary : function(){\n    return {\n      name: $(\"input[name='Name']\").val(),\n      description: $(\"input[name='Description']\").val(),\n      synopsis: $(\"input[name='Synopsis']\").val()\n    };\n  },\n\n  /**\n   * Check whether entered values are valid.\n   */\n  validateNewLibrary: function( libraryDetails ){\n      return libraryDetails.name !== '';\n  },\n\n  /**\n   * Include or exclude deleted libraries in the view.\n   */\n  includeDeletedChecked: function( event ){\n    if (event.target.checked){\n        Galaxy.libraries.preferences.set( { 'with_deleted': true } );\n        Galaxy.libraries.libraryListView.fetchDeleted();\n    } else{\n        Galaxy.libraries.preferences.set( { 'with_deleted': false } );\n        Galaxy.libraries.libraryListView.render();\n    }\n  },\n\n  /**\n   * Include or exclude restricted libraries in the view.\n   */\n  excludeRestrictedChecked: function( event ) {\n    if (event.target.checked){\n      Galaxy.libraries.preferences.set( { 'without_restricted': true } );\n    } else {\n      Galaxy.libraries.preferences.set( { 'without_restricted': false });\n    }\n    Galaxy.libraries.libraryListView.render();\n  },\n\n  /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n  searchLibraries: function(event){\n    var search_term = $(\".library-search-input\").val();\n    this.options.search_term = search_term;\n    Galaxy.libraries.libraryListView.searchLibraries(search_term);\n  },\n\n  templateToolBar: function(){\n    return _.template([\n      '<div class=\"library_style_container\">',\n        '<div id=\"toolbar_form\">',\n          '<div id=\"library_toolbar\">',\n            '<form class=\"form-inline\" role=\"form\">',\n              '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n              '<span id=\"library_paginator\" class=\"library-paginator\">',\n              // paginator will append here\n              '</span>',\n              '<div class=\"form-group toolbar-item\">',\n                '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n              '</div>',\n              // only admins see the following\n              '<% if(admin_user === true) { %>',\n                  '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                    '<label>',\n                      '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                        'include deleted ',\n                      '</input>',\n                    '</label>',\n                    '<label>',\n                      '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                        'exclude restricted',\n                      '</input>',\n                    '</label>',\n                  '</div>',\n                  '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                    '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                '</span>',\n              '<% } %>',\n              '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                  '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                '</a>',\n              '</span>',\n            '</form>',\n          '</div>',\n        '</div>',\n        '<div id=\"libraries_element\">',\n        // table with libraries will append here\n        '</div>',\n      '</div>'\n    ].join(''));\n  },\n\n  templatePaginator: function(){\n    return _.template([\n    '<ul class=\"pagination pagination-sm\">',\n      '<% if ( ( show_page - 1 ) > 0 ) { %>',\n      '<% if ( ( show_page - 1 ) > page_count ) { %>', // we are on higher page than total page count\n        '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } else { %>',\n        '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } %>',\n      '<% } else { %>', // we are on the first page\n        '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } %>',\n        '<li class=\"active\">',\n          '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n        '</li>',\n      '<% if ( ( show_page ) < page_count ) { %>',\n        '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } else { %>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } %>',\n    '</ul>',\n    '<span id=\"lib_page_size_prompt\">',\n      ' showing <a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Click to change the number of libraries on page\"><%- libraries_shown %></a> of <%- total_libraries_count %> libraries',\n    '</span>'\n    ].join(''));\n  },\n\n  templateNewLibraryInModal: function(){\n    return _.template([\n      '<div id=\"new_library_modal\">',\n        '<form>',\n          '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n          '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n          '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n        '</form>',\n      '</div>'\n    ].join(''));\n  }\n});\n\nreturn {\n  LibraryToolbarView: LibraryToolbarView\n};\n\n});\n"]}