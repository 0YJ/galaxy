{"version":3,"sources":["mvc/library/library-foldertoolbar-view.js"],"names":["define","el","events","mod_utils","mod_toastr","mod_library_model","mod_select","FolderToolbarView","Backbone","View","extend","defaults","click #toolbtn_create_folder","click #toolbtn_bulk_import","click #include_deleted_datasets_chk","click #toolbtn_bulk_delete","click .toolbtn-show-locinfo","click .page_size_prompt","modal","can_add_library_item","contains_file_or_folder","jstree","total_number","failed_number","disabled_jstree_element","histories","id","select_extension","list_genomes","auto","fetchExtAndGenomes","text","description","mutiple_add_dataset_options","initialize","Galaxy","options","template_defaults","is_admin","user","isAdmin","this","render","_","toolbar_template","templateToolBar","is_anonym","paginator_template","templatePaginator","$","html","config","allow_library_path_paste","library_import_dir","show_page","parseInt","items_shown","renderPaginator","find","page_count","total_items_count","isAnonymous","hide","show","$el","createFolderFromModal","event","preventDefault","closing_events","body","template","tooltip","self","templateNewFolderInModal","create_new_folder_event","title","validate_new_folder","buttons","url_items","fragment","indexOf","folder","folderDetails","success","FolderAsModel","history","split","folderListView","collection","error","model","response","length","url","responseJSON","save","set","type","libraries","add","err_msg","serialize_new_folder","modalBulkImport","val","checkedValues","templateBulkImportInModal","that","importAllIntoHistory","info","models","refreshUserHistoriesList","Close","GalaxyHistories","callback","new_history_name","post","root","name","done","history_id","last_used_history_id","history_name","new_history","fail","enableButton","always","processImportToHistory","folder_ids","parentElement","dataset_ids","push","datasets_to_import","historyItem","classList","contains","content","library_dataset_id","data","source","i","library_folder_id","HistoryItem","urlRoot","jQuery","chainCallImportingIntoHistory","initChainCallControl","progressStep","action","getJSON","txt_representation","updateProgress","download","width","Math","round","progress","folder_id","each","format","processDownload","method","param","inputs","addFilesFromHistoryModal","pair","full_path","submit","remove","template_modal","templateAddFilesFromHistory","folder_name","closing_callback","Add","addAllDatasetsFromHistory","fetchAndDisplayHistoryContents","change","target","value","importFromPathsClicked","templateImportPathModal","Import","library_router","navigate","trigger","renderSelectBoxes","list_extensions","get","datatypes","key","description_url","extension","sort","a","b","unshift","genomes","container","css","importFilesFromGalaxyFolderModal","templateBrowserModal","importFromJstreePath","bind","renderJstree","fetch","Jstree","require","core","plugins","types","icon","file","three_state","err_code","warning","preserve_dirs","is","file_type","dbkey","disableButton","paths","valid_paths","trimmed","chainCallImportingFolders","link_data","templateAddingDatasetsProgressBar","templateDeletingItemsProgressBar","templateImportIntoHistoryProgressBar","chain_call_control","all_nodes","get_selected","selected_nodes","select_genome","node","state","disabled","tag_using_filenames","selection_type","li_attr","full_source","chainCallImportingUserdirFiles","history_contents","history_contents_template","templateHistoryContents","contents","reverse","checked_hdas","history_item_types","items_to_add","hid","item_type","history_item_ids","history_item_id","folder_item","Item","from_hdca_id","chainCallAddingHdas","history_item_set","window","location","popped_item","onclick","promise","pop","when","Folder","added_hdas","from_hda_id","chainCallDeletingItems","items_to_delete","deleted_items","include_deleted","updated_item","item","model_class","checkIncludeDeleted","checked","fetchFolder","deleteSelectedItems","items_total","undefined","dataset","showLocInfo","library","libraryListView","showLocInfoModal","parent_library_id","Library","showImportModal","templateLocInfoInModal","importFilesFromPathModal","showPageSizePrompt","folder_page_size","back","prompt","preferences","join"],"mappings":"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UACEiO,KAAK,MAGT9N,yBAA0B,WACxB,OAAO9B,EAAE2B,UACT,8BACE,SACE,wEACA,4EACF,UACF,UACEiO,KAAK,MAIT9L,0BAA4B,WAC1B,OAAO9D,EAAE2B,UACT,QACE,mCACE,mBACA,iHACE,8CACE,mGACF,YACF,YACF,SACA,mCACE,kBACA,4GACA,WACF,SACF,UACEiO,KAAK,MAGTrE,qCAAuC,WACrC,OAAOvL,EAAE2B,UACT,4BACE,2EACF,SACA,yBACE,gJACE,mDACF,SACF,UACEiO,KAAK,MAGTvE,kCAAmC,WACjC,OAAOrL,EAAE2B,UACT,4BACE,iFACF,SACA,yBACE,gJACE,mDACF,SACF,UACEiO,KAAK,MAGTtE,iCAAkC,WAChC,OAAOtL,EAAE2B,UACT,4BACA,SACA,yBACE,gJACE,mDACF,SACF,UACEiO,KAAK,MAGThG,qBAAsB,WACpB,OAAO5J,EAAE2B,UACT,gCACE,0JACA,wLACA,mCACE,oFACE,yGACF,WACA,sFACA,uFACA,WACF,SACA,mCACE,kFACE,yFACA,+BACF,WACA,0EACE,mEACA,gCACF,WACF,SACA,qGACE,aACF,YACA,qGACE,cACF,YACA,SAEA,4BACA,SACA,SACA,kFACA,QACE,gFACA,4EACF,SACA,QACG,4CACG,oCACA,0FACH,WACH,SACF,UACEiO,KAAK,MAGTpH,wBAAyB,WACvB,OAAOxI,EAAE2B,UACT,gCACE,+JACA,sCACE,4DACE,yFACA,+BACF,WACA,oDACE,mEACA,gCACF,WACF,SACA,uKACA,SACA,kFACA,QACE,gFACA,4EACF,SACF,UACEiO,KAAK,MAGT9H,4BAA6B,WAC3B,OAAO9H,EAAE2B,UACT,6BACE,QACE,oBACA,8EACE,8CACE,mGACF,YACF,YACF,SACA,QACA,sCACA,SACF,UACEiO,KAAK,MAGTrD,wBAAyB,WACvB,OAAOvM,EAAE2B,UACT,kDACA,OACE,0DACE,oDACE,yDACI,kEACA,0CACE,+GACE,sJACF,QACD,iBACE,6FACG,2GACE,oKACF,UACF,QACF,UACN,iGACI,+GACE,iIACF,QACJ,UACF,UACF,YACF,SACEiO,KAAK,MAGTvP,kBAAmB,WACjB,OAAOL,EAAE2B,UACT,wCACE,uCACE,gDACE,iGACA,wHACF,iBACE,iGACA,2GACF,UACF,iBACE,kHACA,wHACF,UACA,sBACE,0FACF,QACA,4CACE,2GACA,0HACF,iBACE,yHACA,2IACF,UACF,QACA,SACE,sBACA,8HACE,qBACF,OACA,0CACF,WACEiO,KAAK","file":"../../../scripts/mvc/library/library-foldertoolbar-view.js","sourcesContent":["define([\n    \"layout/masthead\",\n    \"utils/utils\",\n    \"libs/toastr\",\n    \"mvc/library/library-model\",\n    \"mvc/ui/ui-select\"\n    ],\nfunction( mod_masthead,\n          mod_utils,\n          mod_toastr,\n          mod_library_model,\n          mod_select\n        ){\n\nvar FolderToolbarView = Backbone.View.extend({\n  el: '#center',\n\n  events: {\n    'click #toolbtn_create_folder'        : 'createFolderFromModal',\n    'click #toolbtn_bulk_import'          : 'modalBulkImport',\n    'click #include_deleted_datasets_chk' : 'checkIncludeDeleted',\n    'click #toolbtn_bulk_delete'          : 'deleteSelectedItems',\n    'click .toolbtn-show-locinfo'         : 'showLocInfo',\n    'click .page_size_prompt'             : 'showPageSizePrompt'\n\n  },\n\n  defaults: {\n    'can_add_library_item'    : false,\n    'contains_file_or_folder' : false,\n    'chain_call_control'      : {\n                                'total_number'  : 0,\n                                'failed_number' : 0\n                              },\n    'disabled_jstree_element' : 'folders'\n  },\n\n  modal : null,\n\n  // directory browsing object\n  jstree: null,\n\n  // user's histories\n  histories : null,\n\n  // genome select\n  select_genome : null,\n\n  // extension select\n  select_extension : null,\n\n  // extension types\n  list_extensions :[],\n\n  // datatype placeholder for extension auto-detection\n  auto: {\n      id          : 'auto',\n      text        : 'Auto-detect',\n      description : 'This system will try to detect the file type automatically.' +\n                    ' If your file is not detected properly as one of the known formats,' +\n                    ' it most likely means that it has some format problems (e.g., different' +\n                    ' number of columns on different rows). You can still coerce the system' +\n                    ' to set your data to the format you think it should be.' +\n                    ' You can also upload compressed files, which will automatically be decompressed.'\n  },\n\n  // genomes\n  list_genomes : [],\n\n  initialize: function(options){\n    this.options = _.defaults( options || {}, this.defaults );\n    this.fetchExtAndGenomes();\n    this.render();\n  },\n\n  render: function(options){\n    this.options = _.extend( this.options, options );\n    var toolbar_template = this.templateToolBar();\n    var template_defaults = {\n        id: this.options.id,\n        is_admin: false,\n        is_anonym: true,\n        mutiple_add_dataset_options: false\n    }\n    if (Galaxy.user){\n      template_defaults.is_admin = Galaxy.user.isAdmin();\n      template_defaults.is_anonym = Galaxy.user.isAnonymous();\n      if ( Galaxy.config.user_library_import_dir !== null || Galaxy.config.allow_library_path_paste !== false || Galaxy.config.library_import_dir !== null ){\n        template_defaults.mutiple_add_dataset_options = true;\n      }\n    }\n    this.$el.html(toolbar_template(template_defaults));\n  },\n\n  /**\n   * Called from FolderListView when needed.\n   * @param  {object} options common options\n   */\n  renderPaginator: function( options ){\n      this.options = _.extend( this.options, options );\n      var paginator_template = this.templatePaginator();\n      $(\"body\").find( '.folder-paginator' ).html( paginator_template({\n          id: this.options.id,\n          show_page: parseInt( this.options.show_page ),\n          page_count: parseInt( this.options.page_count ),\n          total_items_count: this.options.total_items_count,\n          items_shown: this.options.items_shown\n      }));\n  },\n\n  configureElements: function(options){\n    this.options = _.extend(this.options, options);\n\n    if (this.options.can_add_library_item === true){\n      $('.add-library-items').show();\n    } else{\n      $('.add-library-items').hide();\n    }\n    if (this.options.contains_file_or_folder === true){\n      if (Galaxy.user){\n        if (!Galaxy.user.isAnonymous()){\n          $('.logged-dataset-manipulation').show();\n          $('.dataset-manipulation').show();\n        } else {\n          $('.dataset-manipulation').show();\n          $('.logged-dataset-manipulation').hide();\n        }\n      } else {\n        $('.logged-dataset-manipulation').hide();\n        $('.dataset-manipulation').hide();\n      }\n    } else {\n      $('.logged-dataset-manipulation').hide();\n      $('.dataset-manipulation').hide();\n    }\n    this.$el.find('[data-toggle]').tooltip();\n  },\n\n  // shows modal for creating folder\n  createFolderFromModal: function( event ){\n    event.preventDefault();\n    event.stopPropagation();\n\n    // create modal\n    var self = this;\n    var template = this.templateNewFolderInModal();\n    this.modal = Galaxy.modal;\n    this.modal.show({\n        closing_events  : true,\n        title           : 'Create New Folder',\n        body            : template(),\n        buttons         : {\n            'Create'    : function() {self.create_new_folder_event();},\n            'Close'     : function() {Galaxy.modal.hide();}\n        }\n    });\n  },\n\n  // create the new folder from modal\n  create_new_folder_event: function(){\n      var folderDetails = this.serialize_new_folder();\n      if (this.validate_new_folder(folderDetails)){\n          var folder = new mod_library_model.FolderAsModel();\n          url_items = Backbone.history.fragment.split('/');\n          if(url_items.indexOf('page') > -1){\n            current_folder_id = url_items[url_items.length-3];\n          }else {\n            current_folder_id = url_items[url_items.length-1];\n          }\n          folder.url = folder.urlRoot + current_folder_id ;\n\n          folder.save(folderDetails, {\n            success: function (folder) {\n              Galaxy.modal.hide();\n              mod_toastr.success('Folder created.');\n              folder.set({'type' : 'folder'});\n              Galaxy.libraries.folderListView.collection.add(folder);\n            },\n            error: function(model, response){\n              Galaxy.modal.hide();\n              if (typeof response.responseJSON !== \"undefined\"){\n                mod_toastr.error(response.responseJSON.err_msg);\n              } else {\n                mod_toastr.error('An error ocurred.');\n              }\n            }\n          });\n      } else {\n          mod_toastr.error('Folder\\'s name is missing.');\n      }\n      return false;\n  },\n\n  // serialize data from the modal\n  serialize_new_folder : function(){\n      return {\n          name: $(\"input[name='Name']\").val(),\n          description: $(\"input[name='Description']\").val()\n      };\n  },\n\n  // validate new folder info\n  validate_new_folder: function(folderDetails){\n      return folderDetails.name !== '';\n  },\n\n\n  // show bulk import modal\n  modalBulkImport : function(){\n      var checkedValues = $('#folder_table').find(':checked');\n      if(checkedValues.length === 0){\n          mod_toastr.info('You must select some datasets first.');\n      } else {\n          this.refreshUserHistoriesList(function(that){\n            var template = that.templateBulkImportInModal();\n            that.modal = Galaxy.modal;\n            that.modal.show({\n                closing_events  : true,\n                title           : 'Import into History',\n                body            : template({histories : that.histories.models}),\n                buttons         : {\n                    'Import'    : function() {that.importAllIntoHistory();},\n                    'Close'     : function() {Galaxy.modal.hide();}\n                }\n            });\n          });\n      }\n  },\n\n  refreshUserHistoriesList: function(callback){\n    var that = this;\n    this.histories = new mod_library_model.GalaxyHistories();\n    this.histories.fetch({\n      success: function (){\n        callback(that);\n      },\n      error: function(model, response){\n        if (typeof response.responseJSON !== \"undefined\"){\n          mod_toastr.error(response.responseJSON.err_msg);\n        } else {\n          mod_toastr.error('An error ocurred.');\n        }\n      }\n    });\n  },\n\n  /**\n   * Import all selected datasets into history.\n   */\n  importAllIntoHistory : function (){\n    this.modal.disableButton('Import');\n    var new_history_name = this.modal.$('input[name=history_name]').val();\n    var that = this;\n    if (new_history_name !== ''){\n      $.post( Galaxy.root + 'api/histories', {name: new_history_name})\n        .done(function( new_history ) {\n          that.options.last_used_history_id = new_history.id;\n          that.processImportToHistory(new_history.id, new_history.name);\n        })\n        .fail(function( xhr, status, error ) {\n          mod_toastr.error('An error ocurred.');\n        })\n        .always(function() {\n          that.modal.enableButton('Import');\n        });\n    } else {\n      var history_id = $(\"select[name=dataset_import_bulk] option:selected\").val();\n      this.options.last_used_history_id = history_id;\n      var history_name = $(\"select[name=dataset_import_bulk] option:selected\").text();\n      this.processImportToHistory(history_id, history_name);\n      this.modal.enableButton('Import');\n    }\n  },\n\n  processImportToHistory: function( history_id, history_name ){\n    var dataset_ids = [];\n    var folder_ids = [];\n    $('#folder_table').find(':checked').each(function(){\n        if ($(this.parentElement.parentElement).data('id') !== '' && this.parentElement.parentElement.classList.contains('dataset_row') ) {\n            dataset_ids.push($(this.parentElement.parentElement).data('id'));\n        } else if ($(this.parentElement.parentElement).data('id') !== '' && this.parentElement.parentElement.classList.contains('folder_row') ) {\n            folder_ids.push($(this.parentElement.parentElement).data('id'));\n        }\n    });\n    // prepare the dataset objects to be imported\n    var datasets_to_import = [];\n    for (var i = dataset_ids.length - 1; i >= 0; i--) {\n        var library_dataset_id = dataset_ids[i];\n        var historyItem = new mod_library_model.HistoryItem();\n        historyItem.url = historyItem.urlRoot + history_id + '/contents';\n        historyItem.content = library_dataset_id;\n        historyItem.source = 'library';\n        datasets_to_import.push(historyItem);\n    }\n\n    // prepare the folder objects to be imported\n    var folders_to_import = [];\n    for (var i = folder_ids.length - 1; i >= 0; i--) {\n        var library_folder_id = folder_ids[i];\n        var historyItem = new mod_library_model.HistoryItem();\n        historyItem.url = historyItem.urlRoot + history_id + '/contents';\n        historyItem.content = library_folder_id;\n        historyItem.source = 'library_folder';\n        datasets_to_import.push(historyItem);\n    }\n\n    this.initChainCallControl( { length: datasets_to_import.length, action: 'to_history', history_name: history_name } );\n    // set the used history as current so user will see the last one\n    // that he imported into in the history panel on the 'analysis' page\n    jQuery.getJSON( Galaxy.root + 'history/set_as_current?id=' + history_id  );\n    this.chainCallImportingIntoHistory( datasets_to_import, history_name );\n  },\n\n  /**\n   * Update the progress bar in modal window.\n   */\n  updateProgress: function(){\n      this.progress += this.progressStep;\n      $( '.progress-bar-import' ).width( Math.round( this.progress ) + '%' );\n      txt_representation = Math.round( this.progress ) + '% Complete';\n      $( '.completion_span' ).text( txt_representation );\n  },\n\n  /**\n   * download selected datasets\n   * @param  {str} folder_id id of the current folder\n   * @param  {str} format    requested archive format\n   */\n  download : function( folder_id, format ){\n    var dataset_ids = [];\n    var folder_ids = [];\n        $( '#folder_table' ).find( ':checked' ).each( function(){\n            if ( $(this.parentElement.parentElement).data('id') !== '' && this.parentElement.parentElement.classList.contains('dataset_row') ) {\n                dataset_ids.push( $(this.parentElement.parentElement).data('id') );\n            } else if ( $(this.parentElement.parentElement).data('id') !== '' && this.parentElement.parentElement.classList.contains('folder_row') ) {\n                folder_ids.push( $(this.parentElement.parentElement).data('id') );\n            }\n        } );\n    var url = Galaxy.root + 'api/libraries/datasets/download/' + format;\n    var data = { 'ld_ids' : dataset_ids, 'folder_ids' : folder_ids };\n    this.processDownload( url, data, 'get' );\n  },\n\n  /**\n   * Create hidden form and submit it through POST\n   * to initialize the download.\n   * @param  {str} url    url to call\n   * @param  {obj} data   data to include in the request\n   * @param  {str} method method of the request\n   */\n  processDownload: function( url, data, method ){\n    if ( url && data ){\n      // data can be string of parameters or array/object\n      data = typeof data === 'string' ? data : $.param( data );\n      // split params into form inputs\n      var inputs = '';\n      $.each( data.split( '&' ), function(){\n              var pair = this.split( '=' );\n              inputs+='<input type=\"hidden\" name=\"'+ pair[0] +'\" value=\"'+ pair[1] +'\" />';\n      });\n      // send request\n      $('<form action=\"'+ url +'\" method=\"'+ (method||'post') +'\">'+inputs+'</form>')\n      .appendTo( 'body' ).submit().remove();\n      mod_toastr.info( 'Your download will begin soon.' );\n    } else {\n      mod_toastr.error( 'An error occurred.' );\n    }\n  },\n\n  addFilesFromHistoryModal: function(){\n    this.refreshUserHistoriesList( function( self ){\n      self.modal = Galaxy.modal;\n      var template_modal = self.templateAddFilesFromHistory();\n      var folder_name = self.options.full_path[self.options.full_path.length - 1][1]\n      self.modal.show({\n          closing_events  : true,\n          title           : 'Adding datasets from your history to folder ' + folder_name,\n          body            : template_modal({histories: self.histories.models}),\n          buttons         : {\n              'Add'       : function() {self.addAllDatasetsFromHistory();},\n              'Close'     : function() {Galaxy.modal.hide();}\n          },\n          closing_callback: function(){\n            Galaxy.libraries.library_router.back();\n          }\n      });\n\n      // user should always have a history, even anonymous user\n      if (self.histories.models.length > 0){\n        self.fetchAndDisplayHistoryContents(self.histories.models[0].id);\n        $( \"#dataset_add_bulk\" ).change(function(event) {\n          self.fetchAndDisplayHistoryContents(event.target.value);\n        });\n      } else {\n        mod_toastr.error( 'An error ocurred.' );\n      }\n    });\n  },\n\n  /**\n   * Create modal for importing from Galaxy path.\n   * This feature is admin-only.\n   */\n  importFilesFromPathModal: function(){\n    var that = this;\n    this.modal = Galaxy.modal;\n    var template_modal = this.templateImportPathModal();\n    this.modal.show({\n        closing_events  : true,\n        title           : 'Please enter paths to import',\n        body            : template_modal({}),\n        buttons         : {\n            'Import'    : function() { that.importFromPathsClicked(that); },\n            'Close'     : function() { Galaxy.modal.hide(); }\n        },\n        closing_callback: function(){\n          //  TODO: should not trigger routes outside of the router\n          Galaxy.libraries.library_router.navigate( 'folders/' + that.id, { trigger: true } );\n        }\n    });\n    this.renderSelectBoxes();\n  },\n\n  /**\n   * Request all extensions and genomes from Galaxy\n   * and save them sorted in arrays.\n   */\n  fetchExtAndGenomes: function(){\n    var that = this;\n    mod_utils.get({\n        url      :  Galaxy.root + \"api/datatypes?extension_only=False\",\n        success  :  function( datatypes ) {\n                        that.list_extensions = [];\n                        for (key in datatypes) {\n                            that.list_extensions.push({\n                                id              : datatypes[key].extension,\n                                text            : datatypes[key].extension,\n                                description     : datatypes[key].description,\n                                description_url : datatypes[key].description_url\n                            });\n                        }\n                        that.list_extensions.sort(function(a, b) {\n                            return a.id > b.id ? 1 : a.id < b.id ? -1 : 0;\n                        });\n                        that.list_extensions.unshift(that.auto);\n                    },\n        cache    : true\n      });\n    mod_utils.get({\n        url     :    Galaxy.root + \"api/genomes\",\n        success : function( genomes ) {\n                    that.list_genomes = [];\n                    for ( key in genomes ) {\n                        that.list_genomes.push({\n                            id      : genomes[key][1],\n                            text    : genomes[key][0]\n                        });\n                    }\n                    that.list_genomes.sort(function(a, b) {\n                        return a.id > b.id ? 1 : a.id < b.id ? -1 : 0;\n                    });\n                },\n        cache   : true\n    });\n  },\n\n  renderSelectBoxes: function(){\n    // This won't work properly unlesss we already have the data fetched.\n    // See this.fetchExtAndGenomes()\n    // TODO switch to common resources:\n    // https://trello.com/c/dIUE9YPl/1933-ui-common-resources-and-data-into-galaxy-object\n    var that = this;\n    this.select_genome = new mod_select.View( {\n        css: 'library-genome-select',\n        data: that.list_genomes,\n        container: Galaxy.modal.$el.find( '#library_genome_select' ),\n        value: '?'\n    } );\n    this.select_extension = new mod_select.View({\n      css: 'library-extension-select',\n      data: that.list_extensions,\n      container: Galaxy.modal.$el.find( '#library_extension_select' ),\n      value: 'auto'\n    });\n  },\n\n  /**\n   * Create modal for importing from given directory\n   * on Galaxy. Bind jQuery events.\n   */\n  importFilesFromGalaxyFolderModal: function( options ){\n    var that = this;\n    var template_modal = this.templateBrowserModal();\n    this.modal = Galaxy.modal;\n    this.modal.show({\n      closing_events  : true,\n      title           : 'Please select folders or files',\n      body            : template_modal({}),\n      buttons         : {\n          'Import'    : function() {\n            that.importFromJstreePath( that, options );\n          },\n          'Close'     : function() {\n            Galaxy.modal.hide();\n          }\n      },\n      closing_callback: function(){\n        //  TODO: should not trigger routes outside of the router\n        Galaxy.libraries.library_router.navigate('folders/' + that.id, {trigger: true});\n      }\n    });\n\n    $('.libimport-select-all').bind(\"click\", function(){\n      $('#jstree_browser').jstree(\"check_all\");\n    });\n    $('.libimport-select-none').bind(\"click\", function(){\n      $('#jstree_browser').jstree(\"uncheck_all\");\n    });\n\n    this.renderSelectBoxes();\n    options.disabled_jstree_element = 'folders';\n    this.renderJstree( options );\n\n    $( 'input[type=radio]' ).change( function( event ){\n        if (event.target.value ==='jstree-disable-folders') {\n          options.disabled_jstree_element = 'folders';\n          that.renderJstree( options );\n          $('.jstree-folders-message').hide();\n          $('.jstree-preserve-structure').hide();\n          $('.jstree-link-files').hide();\n          $('.jstree-files-message').show();\n        } else if ( event.target.value ==='jstree-disable-files' ){\n          $('.jstree-files-message').hide();\n          $('.jstree-folders-message').show();\n          $('.jstree-link-files').show();\n          $('.jstree-preserve-structure').show();\n          options.disabled_jstree_element = 'files';\n          that.renderJstree( options );\n        }\n      }\n    );\n  },\n\n  /**\n   * Fetch the contents of user directory on Galaxy\n   * and render jstree component based on received\n   * data.\n   * @param  {[type]} options [description]\n   */\n  renderJstree: function( options ){\n    var that = this;\n    this.options = _.extend( this.options, options );\n    var target = options.source || 'userdir';\n    var disabled_jstree_element = this.options.disabled_jstree_element;\n    this.jstree = new mod_library_model.Jstree();\n    this.jstree.url = this.jstree.urlRoot +\n                        '?target=' + target +\n                        '&format=jstree' +\n                        '&disable=' + disabled_jstree_element;\n    this.jstree.fetch({\n      success: function(model, response){\n        // This is to prevent double jquery load. I think. Carl is magician.\n        define( 'jquery', function(){ return jQuery; });\n        // Now we need jstree, time to lazy load it.\n        require([ 'libs/jquery/jstree' ], function(jstree){\n          $('#jstree_browser').jstree(\"destroy\");\n          $('#jstree_browser').jstree({\n            'core':{\n              'data': model\n            },\n            'plugins': ['types', 'checkbox'],\n            'types': {\n              \"folder\": {\n                \"icon\": \"jstree-folder\"\n              },\n              \"file\": {\n                \"icon\": \"jstree-file\"\n              }\n            },\n            'checkbox': {\n              three_state: false\n            }\n          });\n        });\n      },\n      error: function(model, response){\n        if (typeof response.responseJSON !== \"undefined\"){\n          if (response.responseJSON.err_code === 404001){\n            mod_toastr.warning(response.responseJSON.err_msg);\n          } else{\n            mod_toastr.error(response.responseJSON.err_msg);\n          }\n        } else {\n          mod_toastr.error('An error ocurred.');\n        }\n      }\n    })\n  },\n\n  /**\n   * Take the paths from the textarea, split it, create\n   * a request queue and call a function that starts sending\n   * one by one to be imported on the server.\n   */\n  importFromPathsClicked: function(){\n    var preserve_dirs = this.modal.$el.find('.preserve-checkbox').is(':checked');\n    var link_data = this.modal.$el.find('.link-checkbox').is(':checked');\n    var file_type = this.select_extension.value();\n    var dbkey = this.select_genome.value();\n    var paths = $('textarea#import_paths').val();\n    var valid_paths = [];\n    if (!paths){\n      mod_toastr.info('Please enter a path relative to Galaxy root.');\n    } else {\n      this.modal.disableButton('Import');\n      paths = paths.split('\\n');\n      for (var i = paths.length - 1; i >= 0; i--) {\n        trimmed = paths[i].trim();\n        if (trimmed.length!==0){\n          valid_paths.push(trimmed);\n        }\n      };\n      this.initChainCallControl( { length: valid_paths.length, action: 'adding_datasets' } );\n      this.chainCallImportingFolders( { paths: valid_paths,\n                                        preserve_dirs: preserve_dirs,\n                                        link_data: link_data,\n                                        source: 'admin_path',\n                                        file_type: file_type,\n                                        dbkey: dbkey } );\n    }\n  },\n\n  /**\n   * Initialize the control of chaining requests\n   * in the current modal.\n   * @param {int} length The number of items in the chain call.\n   */\n  initChainCallControl: function( options ){\n    var template;\n    switch( options.action ){\n      case \"adding_datasets\":\n        template = this.templateAddingDatasetsProgressBar();\n        this.modal.$el.find( '.modal-body' ).html( template( { folder_name : this.options.folder_name } ) );\n        break;\n      case \"deleting_datasets\":\n        template = this.templateDeletingItemsProgressBar();\n        this.modal.$el.find( '.modal-body' ).html( template() );\n        break;\n      case \"to_history\":\n        template = this.templateImportIntoHistoryProgressBar();\n        this.modal.$el.find( '.modal-body' ).html( template( { history_name : options.history_name } ) );\n        break;\n      default:\n        Galaxy.emit.error( 'Wrong action specified.', 'datalibs');\n        break;\n    }\n\n    // var progress_bar_tmpl = this.templateAddingDatasetsProgressBar();\n    // this.modal.$el.find( '.modal-body' ).html( progress_bar_tmpl( { folder_name : this.options.folder_name } ) );\n    this.progress = 0;\n    this.progressStep = 100 / options.length;\n    this.options.chain_call_control.total_number = options.length;\n    this.options.chain_call_control.failed_number = 0;\n  },\n\n  /**\n   * Take the selected items from the jstree, create a request queue\n   * and send them one by one to the server for importing into\n   * the current folder.\n   *\n   * jstree.js has to be loaded before\n   * @see renderJstree\n   */\n  importFromJstreePath: function ( that, options ){\n    var all_nodes = $( '#jstree_browser' ).jstree().get_selected( true );\n    // remove the disabled elements that could have been trigerred with the 'select all'\n    selected_nodes = _.filter(all_nodes, function(node){ return node.state.disabled == false; })\n    var preserve_dirs = this.modal.$el.find( '.preserve-checkbox' ).is( ':checked' );\n    var link_data = this.modal.$el.find( '.link-checkbox' ).is( ':checked' );\n    var file_type = this.select_extension.value();\n    var dbkey = this.select_genome.value();\n    var tag_using_filenames = this.modal.$el.find( '.tag-files' ).is( ':checked' );\n    var selection_type = selected_nodes[0].type;\n    var paths = [];\n    if ( selected_nodes.length < 1 ){\n      mod_toastr.info( 'Please select some items first.' );\n    } else {\n      this.modal.disableButton( 'Import' );\n      for ( var i = selected_nodes.length - 1; i >= 0; i-- ){\n        if ( selected_nodes[i].li_attr.full_path !== undefined ){\n          paths.push( selected_nodes[i].li_attr.full_path );\n        }\n      }\n      this.initChainCallControl( { length: paths.length, action: 'adding_datasets' } );\n      if ( selection_type === 'folder' ){\n        var full_source = options.source + '_folder';\n        this.chainCallImportingFolders( { paths: paths,\n                                          preserve_dirs: preserve_dirs,\n                                          link_data: link_data,\n                                          source: full_source,\n                                          file_type: file_type,\n                                          dbkey: dbkey,\n                                          tag_using_filenames: tag_using_filenames } );\n      } else if ( selection_type === 'file' ){\n        var full_source = options.source + '_file';\n        this.chainCallImportingUserdirFiles( { paths : paths,\n                                               file_type: file_type,\n                                               dbkey: dbkey,\n                                               source: full_source,\n                                               tag_using_filenames: tag_using_filenames } );\n      }\n    }\n  },\n\n  fetchAndDisplayHistoryContents: function(history_id){\n    var history_contents = new mod_library_model.HistoryContents({id:history_id});\n    var self = this;\n    history_contents.fetch({\n      success: function(history_contents){\n        var history_contents_template = self.templateHistoryContents();\n        self.histories.get(history_id).set({'contents' : history_contents});\n        self.modal.$el.find('#selected_history_content').html(history_contents_template({history_contents: history_contents.models.reverse()}));\n      },\n      error: function(model, response){\n        if (typeof response.responseJSON !== \"undefined\"){\n          mod_toastr.error(response.responseJSON.err_msg);\n        } else {\n          mod_toastr.error('An error ocurred.');\n        }\n      }\n    });\n  },\n\n  /**\n   * Import all selected datasets from history into the current folder.\n   */\n  addAllDatasetsFromHistory : function (){\n    var checked_hdas = this.modal.$el.find( '#selected_history_content' ).find( ':checked' );\n    var history_item_ids = [];  // can be hda or hdca\n    var history_item_types = [];\n    var items_to_add = [];\n    if ( checked_hdas.length < 1 ){\n      mod_toastr.info( 'You must select some datasets first.' );\n    } else {\n      this.modal.disableButton( 'Add' );\n      checked_hdas.each(function(){\n        var hid = $( this.parentElement ).data( 'id' );\n        if ( hid ) {\n          var item_type = $( this.parentElement ).data( 'name' );\n          history_item_ids.push( hid );\n          history_item_types.push( item_type );\n        }\n      });\n      for ( var i = history_item_ids.length - 1; i >= 0; i-- ) {\n        history_item_id = history_item_ids[i];\n        var folder_item = new mod_library_model.Item();\n        folder_item.url = Galaxy.root + 'api/folders/' + this.options.id + '/contents';\n        if (history_item_types[i] === 'collection') {\n          folder_item.set({'from_hdca_id': history_item_id});\n        } else {\n          folder_item.set({'from_hda_id': history_item_id});\n        }\n        items_to_add.push(folder_item);\n      }\n      this.initChainCallControl( { length: items_to_add.length, action: 'adding_datasets' } );\n      this.chainCallAddingHdas( items_to_add );\n    }\n  },\n\n  /**\n   * Take array of empty history items and make request for each of them\n   * to create it on server. Update progress in between calls.\n   * @param  {array} history_item_set array of empty history items\n   * @param  {str} history_name     name of the history to import to\n   */\n  chainCallImportingIntoHistory: function( history_item_set, history_name ){\n    var self = this;\n    var popped_item = history_item_set.pop();\n    if ( typeof popped_item == \"undefined\" ) {\n      if ( this.options.chain_call_control.failed_number === 0 ){\n        mod_toastr.success( 'Selected datasets imported into history. Click this to start analyzing it.', '', { onclick: function() { window.location=Galaxy.root } } );\n      } else if ( this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number ){\n        mod_toastr.error( 'There was an error and no datasets were imported into history.' );\n      } else if ( this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number ){\n        mod_toastr.warning( 'Some of the datasets could not be imported into history. Click this to see what was imported.', '', { onclick: function() { window.location=Galaxy.root } } );\n      }\n      Galaxy.modal.hide();\n      return true;\n    }\n    var promise = $.when( popped_item.save( { content: popped_item.content, source: popped_item.source } ) );\n\n    promise.done( function(){\n              self.updateProgress();\n              self.chainCallImportingIntoHistory( history_item_set, history_name );\n            } )\n            .fail( function(){\n              self.options.chain_call_control.failed_number += 1;\n              self.updateProgress();\n              self.chainCallImportingIntoHistory( history_item_set, history_name );\n            } );\n  },\n\n  /**\n   * Take the array of paths and create a request for each of them\n   * calling them in chain. Update the progress bar in between each.\n   * @param  {array} paths                    paths relative to user folder on Galaxy\n   * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n   */\n  chainCallImportingUserdirFiles: function( options ){\n\n    var that = this;\n    var popped_item = options.paths.pop();\n    if ( typeof popped_item === \"undefined\" ) {\n      if ( this.options.chain_call_control.failed_number === 0 ){\n        mod_toastr.success( 'Selected files imported into the current folder' );\n        Galaxy.modal.hide();\n      } else {\n        mod_toastr.error( 'An error occured.' );\n      }\n      return true;\n    }\n    var promise = $.when( $.post( Galaxy.root + 'api/libraries/datasets?encoded_folder_id=' + that.id +\n                                                       '&source=' + options.source +\n                                                       '&path=' + popped_item +\n                                                       '&file_type=' + options.file_type +\n                                                       '&dbkey=' + options.dbkey +\n                                                       '&tag_using_filenames=' + options.tag_using_filenames ) )\n    promise.done( function( response ){\n              that.updateProgress();\n              that.chainCallImportingUserdirFiles( options );\n            } )\n            .fail( function(){\n              that.options.chain_call_control.failed_number += 1;\n              that.updateProgress();\n              that.chainCallImportingUserdirFiles( options );\n            } );\n  },\n\n  /**\n   * Take the array of paths and createa request for each of them\n   * calling them in chain. Update the progress bar in between each.\n   * @param  {array} paths                    paths relative to Galaxy root folder\n   * @param  {boolean} preserve_dirs          indicates whether to preserve folder structure\n   * @param  {boolean} link_data              copy files to Galaxy or link instead\n   * @param  {str} source                     string representing what type of folder\n   *                                          is the source of import\n   * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n   */\n  chainCallImportingFolders: function( options ){\n    // TODO need to check which paths to call\n    var that = this;\n    var popped_item = options.paths.pop();\n    if (typeof popped_item == \"undefined\") {\n      if (this.options.chain_call_control.failed_number === 0){\n        mod_toastr.success('Selected folders and their contents imported into the current folder.');\n        Galaxy.modal.hide();\n      } else {\n        // TODO better error report\n        mod_toastr.error('An error occured.');\n      }\n      return true;\n    }\n    var promise = $.when( $.post( Galaxy.root + 'api/libraries/datasets?encoded_folder_id=' + that.id +\n                                                          '&source=' + options.source +\n                                                          '&path=' + popped_item +\n                                                          '&preserve_dirs=' + options.preserve_dirs +\n                                                          '&link_data=' + options.link_data +\n                                                          '&file_type=' + options.file_type +\n                                                          '&dbkey=' + options.dbkey +\n                                                          '&tag_using_filenames=' + options.tag_using_filenames ) )\n    promise.done(function(response){\n              that.updateProgress();\n              that.chainCallImportingFolders( options );\n            })\n            .fail(function(){\n              that.options.chain_call_control.failed_number += 1;\n              that.updateProgress();\n              that.chainCallImportingFolders( options );\n            });\n  },\n\n  /**\n   * Take the array of hdas and create a request for each.\n   * Call them in chain and update progress bar in between each.\n   * @param  {array} hdas_set array of empty hda objects\n   */\n  chainCallAddingHdas: function( hdas_set ){\n    var self = this;\n    this.added_hdas = new mod_library_model.Folder();\n    var popped_item = hdas_set.pop();\n    if ( typeof popped_item == \"undefined\" ) {\n      if ( this.options.chain_call_control.failed_number === 0 ){\n        mod_toastr.success( 'Selected datasets from history added to the folder' );\n      } else if ( this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number ){\n        mod_toastr.error( 'There was an error and no datasets were added to the folder.' );\n      } else if ( this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number ){\n        mod_toastr.warning( 'Some of the datasets could not be added to the folder' );\n      }\n      Galaxy.modal.hide();\n      return this.added_hdas;\n    }\n    var promise = $.when( popped_item.save( { from_hda_id: popped_item.get( 'from_hda_id' ) } ) );\n\n    promise.done( function( model ){\n              Galaxy.libraries.folderListView.collection.add( model );\n              self.updateProgress();\n              self.chainCallAddingHdas( hdas_set );\n            })\n            .fail( function(){\n              self.options.chain_call_control.failed_number += 1;\n              self.updateProgress();\n              self.chainCallAddingHdas( hdas_set );\n            });\n  },\n\n  /**\n   * Take the array of lddas, create request for each and\n   * call them in chain. Update progress bar in between each.\n   * @param  {array} lddas_set array of lddas to delete\n   */\n  chainCallDeletingItems: function( items_to_delete ){\n  var self = this;\n  this.deleted_items = new mod_library_model.Folder();\n  var popped_item = items_to_delete.pop();\n  if ( typeof popped_item === \"undefined\" ) {\n    if ( this.options.chain_call_control.failed_number === 0 ){\n      mod_toastr.success( 'Selected items were deleted.' );\n    } else if ( this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number ){\n      mod_toastr.error( 'There was an error and no items were deleted. Please make sure you have sufficient permissions.' );\n    } else if ( this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number ){\n      mod_toastr.warning( 'Some of the items could not be deleted. Please make sure you have sufficient permissions.' );\n    }\n    Galaxy.modal.hide();\n    return this.deleted_items;\n  }\n  var promise = $.when( popped_item.destroy() );\n\n  promise.done( function( item ){\n            Galaxy.libraries.folderListView.collection.remove( popped_item.id );\n            self.updateProgress();\n            // add the deleted item to collection, triggers rendering\n            if ( Galaxy.libraries.folderListView.options.include_deleted ){\n              var updated_item = null;\n              if (item.type === 'folder' || item.model_class === 'LibraryFolder'){\n                updated_item = new mod_library_model.FolderAsModel( item );\n              } else if (item.type === 'file' || item.model_class === 'LibraryDataset'){\n                updated_item = new mod_library_model.Item( item );\n              } else {\n                Galaxy.emit.error('Unknown library item type found.', 'datalibs');\n                Galaxy.emit.error(item.type || item.model_class, 'datalibs');\n              }\n              Galaxy.libraries.folderListView.collection.add( updated_item );\n            }\n            self.chainCallDeletingItems( items_to_delete );\n          })\n          .fail( function(){\n            self.options.chain_call_control.failed_number += 1;\n            self.updateProgress();\n            self.chainCallDeletingItems( items_to_delete );\n          });\n  },\n\n  /**\n   * Handles the click on 'show deleted' checkbox\n   */\n  checkIncludeDeleted: function(event){\n    if (event.target.checked){\n      Galaxy.libraries.folderListView.fetchFolder({include_deleted: true});\n    } else{\n      Galaxy.libraries.folderListView.fetchFolder({include_deleted: false});\n    }\n  },\n\n  /**\n   * Delete the selected items. Atomic. One by one.\n   */\n  deleteSelectedItems: function(){\n    var checkedValues = $('#folder_table').find(':checked');\n    if(checkedValues.length === 0){\n        mod_toastr.info('You must select at least one item for deletion.');\n    } else {\n      var template = this.templateDeletingItemsProgressBar();\n      this.modal = Galaxy.modal;\n      this.modal.show({\n          closing_events  : true,\n          title           : 'Deleting selected items',\n          body            : template({}),\n          buttons         : {\n              'Close'     : function() {Galaxy.modal.hide();}\n          }\n      });\n      // init the control counters\n      this.options.chain_call_control.total_number = 0;\n      this.options.chain_call_control.failed_number = 0;\n\n      var dataset_ids = [];\n      var folder_ids = [];\n      checkedValues.each(function(){\n          if ($(this.parentElement.parentElement).data('id') !== undefined) {\n              if ($(this.parentElement.parentElement).data('id').substring(0,1) == 'F'){\n                folder_ids.push($(this.parentElement.parentElement).data('id'));\n              } else {\n                dataset_ids.push($(this.parentElement.parentElement).data('id'));\n              }\n          }\n      });\n      // init the progress bar\n      var items_total = dataset_ids.length + folder_ids.length\n      this.progressStep = 100 / items_total;\n      this.progress = 0;\n\n      // prepare the dataset items to be added\n      var items_to_delete = [];\n      for (var i = dataset_ids.length - 1; i >= 0; i--) {\n          var dataset = new mod_library_model.Item({id:dataset_ids[i]});\n          items_to_delete.push(dataset);\n      }\n      for (var i = folder_ids.length - 1; i >= 0; i--) {\n          var folder = new mod_library_model.FolderAsModel({id:folder_ids[i]});\n          items_to_delete.push(folder);\n      }\n\n      this.options.chain_call_control.total_number = items_total.length;\n      // call the recursive function to call ajax one after each other (request FIFO queue)\n      this.chainCallDeletingItems(items_to_delete);\n    }\n  },\n\n\n  showLocInfo: function(){\n    var library = null;\n    var that = this;\n    if (Galaxy.libraries.libraryListView !== null){\n      library = Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id);\n      this.showLocInfoModal(library);\n    } else {\n      library = new mod_library_model.Library({id: this.options.parent_library_id});\n      library.fetch({\n        success: function(){\n          that.showLocInfoModal(library);\n        },\n        error: function(model, response){\n          if (typeof response.responseJSON !== \"undefined\"){\n            mod_toastr.error(response.responseJSON.err_msg);\n          } else {\n            mod_toastr.error('An error ocurred.');\n          }\n        }\n      })\n    }\n  },\n\n  showLocInfoModal: function(library){\n    var that = this;\n    var template = this.templateLocInfoInModal();\n    this.modal = Galaxy.modal;\n    this.modal.show({\n        closing_events  : true,\n        title           : 'Location Details',\n        body            : template({library: library, options: that.options}),\n        buttons         : {\n            'Close'     : function() {Galaxy.modal.hide();}\n        }\n    });\n  },\n\n  showImportModal: function(options){\n    switch(options.source){\n      case \"history\":\n        this.addFilesFromHistoryModal();\n        break;\n      case \"importdir\":\n        this.importFilesFromGalaxyFolderModal( { source: 'importdir' } );\n        break;\n      case \"path\":\n        this.importFilesFromPathModal();\n        break;\n      case \"userdir\":\n        this.importFilesFromGalaxyFolderModal( { source: 'userdir' } );\n        break;\n      default:\n        Galaxy.libraries.library_router.back();\n        mod_toastr.error('Invalid import source.');\n        break;\n    }\n  },\n\n  /**\n   * Show user the prompt to change the number of items shown on page.\n   */\n  showPageSizePrompt: function(){\n    var folder_page_size = prompt( 'How many items per page do you want to see?', Galaxy.libraries.preferences.get( 'folder_page_size' ) );\n    if ( ( folder_page_size != null ) && ( folder_page_size == parseInt( folder_page_size ) ) ) {\n        Galaxy.libraries.preferences.set( { 'folder_page_size': parseInt( folder_page_size ) } );\n        Galaxy.libraries.folderListView.render( { id: this.options.id, show_page: 1 } );\n    }\n  },\n\n  templateToolBar: function(){\n    return _.template([\n    // container start\n    '<div class=\"library_style_container\">',\n      // toolbar start\n      '<div id=\"library_toolbar\">',\n        '<form class=\"form-inline\" role=\"form\">',\n          '<span><strong>DATA LIBRARIES</strong></span>',\n          // paginator will append here\n          '<span class=\"library-paginator folder-paginator\"></span>',\n          '<div class=\"checkbox toolbar-item logged-dataset-manipulation\" style=\"height: 20px; display:none;\">',\n            '<label>',\n              '<input id=\"include_deleted_datasets_chk\" type=\"checkbox\">include deleted</input>',\n            '</label>',\n          '</div>',\n          '<button style=\"display:none;\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Folder\" id=\"toolbtn_create_folder\" class=\"btn btn-default primary-button add-library-items toolbar-item\" type=\"button\">',\n            '<span class=\"fa fa-plus\"></span><span class=\"fa fa-folder\"></span>',\n          '</button>',\n          '<% if(mutiple_add_dataset_options) { %>',\n          '<div class=\"btn-group add-library-items\" style=\"display:none;\">',\n            '<button title=\"Add Datasets to Current Folder\" id=\"\" type=\"button\" class=\"primary-button dropdown-toggle\" data-toggle=\"dropdown\">',\n              '<span class=\"fa fa-plus\"></span><span class=\"fa fa-file\"></span><span class=\"caret\"></span>',\n            '</button>',\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n              '<li><a href=\"#folders/<%= id %>/import/history\"> from History</a></li>',\n              '<% if(Galaxy.config.user_library_import_dir !== null) { %>',\n                '<li><a href=\"#folders/<%= id %>/import/userdir\"> from User Directory</a></li>',\n              '<% } %>',\n              '<% if(Galaxy.config.allow_library_path_paste) { %>',\n                '<li class=\"divider\"></li>',\n                '<li class=\"dropdown-header\">Admins only</li>',\n                '<% if(Galaxy.config.library_import_dir !== null) { %>',\n                  '<li><a href=\"#folders/<%= id %>/import/importdir\">from Import Directory</a></li>',\n                '<% } %>',\n                '<% if(Galaxy.config.allow_library_path_paste) { %>',\n                  '<li><a href=\"#folders/<%= id %>/import/path\">from Path</a></li>',\n                '<% } %>',\n              '<% } %>',\n            '</ul>',\n          '</div>',\n          '<% } else { %>',\n            '<a  data-placement=\"top\" title=\"Add Datasets to Current Folder\" style=\"display:none;\" class=\"btn btn-default add-library-items\" href=\"#folders/<%= id %>/import/history\" role=\"button\">',\n              '<span class=\"fa fa-plus\"></span><span class=\"fa fa-file\"></span>',\n            '</a>',\n          '<% } %>',\n          '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Import selected datasets into history\" id=\"toolbtn_bulk_import\" class=\"primary-button dataset-manipulation\" style=\"margin-left: 0.5em; display:none;\" type=\"button\">',\n            '<span class=\"fa fa-book\"></span>',\n            '&nbsp;to History',\n          '</button>',\n          '<div class=\"btn-group dataset-manipulation\" style=\"margin-left: 0.5em; display:none; \">',\n            '<button title=\"Download selected items as archive\" type=\"button\" class=\"primary-button dropdown-toggle\" data-toggle=\"dropdown\">',\n              '<span class=\"fa fa-download\"></span> Download <span class=\"caret\"></span>',\n            '</button>',\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n              '<li><a href=\"#/folders/<%= id %>/download/tgz\">.tar.gz</a></li>',\n              '<li><a href=\"#/folders/<%= id %>/download/tbz\">.tar.bz</a></li>',\n              '<li><a href=\"#/folders/<%= id %>/download/zip\">.zip</a></li>',\n            '</ul>',\n          '</div>',\n            '<button data-toggle=\"tooltip\" data-placement=\"top\" title=\"Mark selected items deleted\" id=\"toolbtn_bulk_delete\" class=\"primary-button logged-dataset-manipulation\" style=\"margin-left: 0.5em; display:none; \" type=\"button\">',\n            '<span class=\"fa fa-times\"></span> Delete</button>',\n            '<button data-id=\"<%- id %>\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Show location details\" class=\"primary-button toolbtn-show-locinfo\" style=\"margin-left: 0.5em;\" type=\"button\">',\n              '<span class=\"fa fa-info-circle\"></span>',\n              '&nbsp;Details',\n            '</button>',\n            '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Visit Libraries Wiki\">',\n              '<a href=\"https://galaxyproject.org/data-libraries/screen/folder-contents/\" target=\"_blank\">',\n                '<button class=\"primary-button\" type=\"button\">',\n                  '<span class=\"fa fa-question-circle\"></span>',\n                  '&nbsp;Help',\n                '</button>',\n              '</a>',\n            '</span>',\n          '</div>',\n        '</form>',\n      // toolbar end\n      '<div id=\"folder_items_element\">',\n      '</div>',\n      // paginator will append here\n      '<div class=\"folder-paginator paginator-bottom\"></div>',\n    // container end\n    '</div>',\n    ].join(''));\n  },\n\n  templateLocInfoInModal: function(){\n    return _.template([\n      '<div>',\n        '<table class=\"grid table table-condensed\">',\n          '<thead>',\n            '<th style=\"width: 25%;\">library</th>',\n            '<th></th>',\n          '</thead>',\n          '<tbody>',\n            '<tr>',\n              '<td>name</td>',\n              '<td><%- library.get(\"name\") %></td>',\n            '</tr>',\n            '<% if(library.get(\"description\") !== \"\") { %>',\n              '<tr>',\n                '<td>description</td>',\n                '<td><%- library.get(\"description\") %></td>',\n              '</tr>',\n            '<% } %>',\n            '<% if(library.get(\"synopsis\") !== \"\") { %>',\n              '<tr>',\n                '<td>synopsis</td>',\n                '<td><%- library.get(\"synopsis\") %></td>',\n              '</tr>',\n            '<% } %>',\n            '<% if(library.get(\"create_time_pretty\") !== \"\") { %>',\n              '<tr>',\n                '<td>created</td>',\n                '<td><span title=\"<%- library.get(\"create_time\") %>\"><%- library.get(\"create_time_pretty\") %></span></td>',\n              '</tr>',\n            '<% } %>',\n            '<tr>',\n              '<td>id</td>',\n              '<td><%- library.get(\"id\") %></td>',\n            '</tr>',\n          '</tbody>',\n        '</table>',\n        '<table class=\"grid table table-condensed\">',\n          '<thead>',\n            '<th style=\"width: 25%;\">folder</th>',\n            '<th></th>',\n          '</thead>',\n          '<tbody>',\n            '<tr>',\n              '<td>name</td>',\n              '<td><%- options.folder_name %></td>',\n            '</tr>',\n            '<% if(options.folder_description !== \"\") { %>',\n              '<tr>',\n                '<td>description</td>',\n                '<td><%- options.folder_description %></td>',\n              '</tr>',\n            '<% } %>',\n            '<tr>',\n              '<td>id</td>',\n              '<td><%- options.id %></td>',\n            '</tr>',\n            '</tbody>',\n        '</table>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateNewFolderInModal: function(){\n    return _.template([\n    '<div id=\"new_folder_modal\">',\n      '<form>',\n        '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n        '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n      '</form>',\n    '</div>'\n    ].join(''));\n  },\n\n\n  templateBulkImportInModal : function(){\n    return _.template([\n    '<div>',\n      '<div class=\"library-modal-item\">',\n        'Select history: ',\n        '<select id=\"dataset_import_bulk\" name=\"dataset_import_bulk\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n          '<% _.each(histories, function(history) { %>',\n            '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n          '<% }); %>',\n        '</select>',\n      '</div>',\n      '<div class=\"library-modal-item\">',\n        'or create new: ',\n        '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\">',\n        '</input>',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateImportIntoHistoryProgressBar : function (){\n    return _.template([\n    '<div class=\"import_text\">',\n      'Importing selected items to history <b><%= _.escape(history_name) %></b>',\n    '</div>',\n    '<div class=\"progress\">',\n      '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n        '<span class=\"completion_span\">0% Complete</span>',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateAddingDatasetsProgressBar: function (){\n    return _.template([\n    '<div class=\"import_text\">',\n      'Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>',\n    '</div>',\n    '<div class=\"progress\">',\n      '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n        '<span class=\"completion_span\">0% Complete</span>',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateDeletingItemsProgressBar: function (){\n    return _.template([\n    '<div class=\"import_text\">',\n    '</div>',\n    '<div class=\"progress\">',\n      '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n        '<span class=\"completion_span\">0% Complete</span>',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateBrowserModal: function(){\n    return _.template([\n    '<div id=\"file_browser_modal\">',\n      '<div class=\"alert alert-info jstree-files-message\">All files you select will be imported into the current folder ignoring their folder structure.</div>',\n      '<div class=\"alert alert-info jstree-folders-message\" style=\"display:none;\">All files within the selected folders and their subfolders will be imported into the current folder.</div>',\n      '<div style=\"margin-bottom:1em;\">',\n        '<label title=\"Switch to selecting files\" class=\"radio-inline import-type-switch\">',\n          '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-folders\" checked=\"checked\"> Choose Files',\n        '</label>',\n        '<label title=\"Switch to selecting folders\" class=\"radio-inline import-type-switch\">',\n        '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-files\"> Choose Folders',\n        '</label>',\n      '</div>',\n      '<div style=\"margin-bottom:1em;\">',\n        '<label class=\"checkbox-inline jstree-preserve-structure\" style=\"display:none;\">',\n          '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n          'Preserve directory structure',\n        '</label>',\n        '<label class=\"checkbox-inline jstree-link-files\" style=\"display:none;\">',\n          '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n          'Link files instead of copying',\n        '</label>',\n      '</div>',\n      '<button title=\"Select all files\" type=\"button\" class=\"button primary-button libimport-select-all\">',\n        'Select all',\n      '</button>',\n      '<button title=\"Select no files\" type=\"button\" class=\"button primary-button libimport-select-none\">',\n        'Select none',\n      '</button>',\n      '<hr />',\n      // append jstree object here\n      '<div id=\"jstree_browser\">',\n      '</div>',\n      '<hr />',\n      '<p>You can set extension type and genome for all imported datasets at once:</p>',\n      '<div>',\n        'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n        'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n      '</div>',\n      '<div>',\n         '<label class=\"checkbox-inline tag-files\">',\n            'Tag datasets based on file names.',\n            '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\" checked=\"checked\">',\n         '</label>',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateImportPathModal: function(){\n    return _.template([\n    '<div id=\"file_browser_modal\">',\n      '<div class=\"alert alert-info jstree-folders-message\">All files within the given folders and their subfolders will be imported into the current folder.</div>',\n      '<div style=\"margin-bottom: 0.5em;\">',\n        '<label class=\"checkbox-inline jstree-preserve-structure\">',\n          '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n          'Preserve directory structure',\n        '</label>',\n        '<label class=\"checkbox-inline jstree-link-files\">',\n          '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n          'Link files instead of copying',\n        '</label>',\n      '</div>',\n      '<textarea id=\"import_paths\" class=\"form-control\" rows=\"5\" placeholder=\"Absolute paths (or paths relative to Galaxy root) separated by newline\" autofocus></textarea>',\n      '<hr />',\n      '<p>You can set extension type and genome for all imported datasets at once:</p>',\n      '<div>',\n        'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n        'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateAddFilesFromHistory: function (){\n    return _.template([\n    '<div id=\"add_files_modal\">',\n      '<div>',\n        'Select history:  ',\n        '<select id=\"dataset_add_bulk\" name=\"dataset_add_bulk\" style=\"width:66%; \"> ',\n          '<% _.each(histories, function(history) { %>', //history select box\n            '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n          '<% }); %>',\n        '</select>',\n      '</div>',\n      '<br/>',\n      '<div id=\"selected_history_content\">',\n      '</div>',\n    '</div>'\n    ].join(''));\n  },\n\n  templateHistoryContents: function (){\n    return _.template([\n    '<strong>Choose the datasets to import:</strong>',\n    '<ul>',\n      '<% _.each(history_contents, function(history_item) { %>',\n        '<% if (history_item.get(\"deleted\") != true ) { %>',\n          '<% if (history_item.get(\"type\") === \"collection\") { %>',\n              '<% var collection_type = history_item.get(\"collection_type\") %>',\n              '<% if (collection_type === \"list\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                  '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: <%= _.escape(history_item.get(\"name\")) %> (Dataset Collection)',\n                '</li>',\n               '<% } else { %>',\n                 '<li><input style=\"margin: 0;\" type=\"checkbox\" onclick=\"return false;\" disabled=\"disabled\">',\n                    '<span title=\"You can convert this collection into a collection of type list using the Collection Tools\">',\n                      ' <%= _.escape(history_item.get(\"hid\")) %>: <%= _.escape(history_item.get(\"name\")) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',\n                    '</span>',\n                  '</li>',\n                '<% } %>',\n          '<% } else if (history_item.get(\"visible\") === true && history_item.get(\"state\") === \"ok\") { %>',\n              '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: <%= _.escape(history_item.get(\"name\")) %>',\n              '</li>',\n          '<% } %>',\n        '<% } %>',\n      '<% }); %>',\n    '</ul>'\n    ].join(''));\n  },\n\n  templatePaginator: function(){\n    return _.template([\n    '<ul class=\"pagination pagination-sm\">',\n      '<% if ( ( show_page - 1 ) > 0 ) { %>',\n        '<% if ( ( show_page - 1 ) > page_count ) { %>', // we are on higher page than total page count\n          '<li><a href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n          '<li class=\"disabled\"><a href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n        '<% } else { %>',\n          '<li><a href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n          '<li><a href=\"#folders/<%= id %>/page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n        '<% } %>',\n      '<% } else { %>', // we are on the first page\n        '<li class=\"disabled\"><a href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n        '<li class=\"disabled\"><a href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n      '<% } %>',\n      '<li class=\"active\">',\n        '<a href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n      '</li>',\n      '<% if ( ( show_page ) < page_count ) { %>',\n        '<li><a href=\"#folders/<%= id %>/page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li><a href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } else { %>',\n        '<li class=\"disabled\"><a href=\"#folders/<%= id %>/page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n        '<li class=\"disabled\"><a href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n      '<% } %>',\n    '</ul>',\n    '<span>',\n      '&nbsp;showing&nbsp;',\n      '<a data-toggle=\"tooltip\" data-placement=\"top\" title=\"Click to change the number of items on page\" class=\"page_size_prompt\">',\n        '<%- items_shown %>',\n      '</a>',\n      '&nbsp;of <%- total_items_count %> items',\n    '</span>'\n    ].join(''));\n  },\n\n});\n\nreturn {\n    FolderToolbarView: FolderToolbarView\n};\n\n});\n"]}