{"version":3,"sources":["mvc/library/library-model.js"],"names":["define","Library","Backbone","Model","extend","urlRoot","Galaxy","root","isVisible","show_deleted","Libraries","Collection","model","sort_key","sort_order","options","search","search_term","this","lowercase_term","toLowerCase","data","lowercase_name","indexOf","getVisible","filters","item","sortByNameAsc","comparator","libraryA","libraryB","get","sort","sortByNameDesc","LibraryItem","Ldda","FolderAsModel","Folder","itemA","itemB","FolderContainer","defaults","folder","parse","obj","reset","i","folder_contents","length","type","folder_item","file_item","emit","error","HistoryItem","HistoryContents","initialize","id","url","GalaxyHistory","GalaxyHistories","Jstree","Item"],"mappings":"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","file":"../../../scripts/mvc/library/library-model.js","sourcesContent":["define([], function() {\n\n// ============================================================================\n// LIBRARY RELATED MODELS\n\n    var Library = Backbone.Model.extend({\n      urlRoot: Galaxy.root + 'api/libraries/',\n\n      /** based on show_deleted would this lib show in the list of lib's?\n       *  @param {Boolean} show_deleted are we including deleted libraries?\n       */\n      isVisible : function(show_deleted){\n          var isVisible = true;\n          if( (!show_deleted) && (this.get('deleted')) ){\n              isVisible = false;\n          }\n          return isVisible;\n      }\n    });\n\n    var Libraries = Backbone.Collection.extend({\n      urlRoot: Galaxy.root + 'api/libraries',\n\n      model: Library,\n\n      sort_key: 'name', // default\n\n      sort_order: null, // default\n\n      initialize : function(options){\n          options = options || {};\n      },\n\n      search : function(search_term){\n        /**\n         * Search the collection and return only the models that have\n         * the search term in their names.\n         * [the term to search]\n         * @type {string}\n         */\n        if (search_term == \"\") return this;\n        var lowercase_term = search_term.toLowerCase();\n        return this.filter(function(data) {\n          lowercase_name = data.get(\"name\").toLowerCase();\n          return lowercase_name.indexOf(lowercase_term) !== -1;\n        });\n      },\n\n      /** Get every 'shown' library in this collection based on deleted filter\n       *  @param {Boolean} show_deleted are we including deleted libraries?\n       *  @returns array of library models\n       */\n      getVisible : function(show_deleted, filters){\n          filters = filters || [];\n          var filteredLibraries = new Libraries( this.filter( function( item ){\n              return item.isVisible(show_deleted);\n          }));\n\n          return filteredLibraries;\n      },\n\n      /** Sort collection by library name (ascending) and return the sorted\n       *  collection\n       */\n      sortByNameAsc: function(){\n        this.comparator = function(libraryA, libraryB){\n          if (libraryA.get('name').toLowerCase() > libraryB.get('name').toLowerCase()) {\n            return 1; // after\n          }\n          if (libraryB.get('name').toLowerCase() > libraryA.get('name').toLowerCase()) {\n            return -1; // before\n          }\n          return 0; // equal\n        };\n        this.sort();\n        return this;\n      },\n\n      /** Sort collection by library name (descending) and return the sorted\n       *  collection\n       */\n      sortByNameDesc: function(){\n        this.comparator = function(libraryA, libraryB){\n          if (libraryA.get('name').toLowerCase() > libraryB.get('name').toLowerCase()) {\n            return -1; // before\n          }\n            if (libraryB.get('name').toLowerCase() > libraryA.get('name').toLowerCase()) {\n          return 1; // after\n          }\n          return 0; // equal\n        };\n        this.sort();\n        return this;\n      }\n\n    });\n\n// ============================================================================\n// FOLDER RELATED MODELS\n\n    var LibraryItem = Backbone.Model.extend({\n    });\n\n    var Ldda = LibraryItem.extend({\n      urlRoot : Galaxy.root + 'api/libraries/datasets/'\n    });\n\n    var FolderAsModel = LibraryItem.extend({\n      urlRoot: Galaxy.root + 'api/folders/'\n    });\n\n    var Folder = Backbone.Collection.extend({\n      model: LibraryItem,\n\n      /** Sort collection by item name (ascending) and return the sorted\n       *  collection. Folders go before datasets.\n       */\n      sortByNameAsc: function(){\n        this.comparator = function(itemA, itemB){\n          if (itemA.get('type') === itemB.get('type')){\n            if (itemA.get('name').toLowerCase() > itemB.get('name').toLowerCase()) {\n              return 1; // after\n            }\n            if (itemB.get('name').toLowerCase() > itemA.get('name').toLowerCase()) {\n              return -1; // before\n            }\n            return 0; // equal\n          } else {\n            if (itemA.get('type') === 'folder'){\n              return -1; // folder is always before dataset\n            } else {\n              return 1;\n            }\n          }\n        };\n        this.sort();\n        return this;\n      },\n\n      /** Sort collection by item name (descending) and return the sorted\n       *  collection. Folders go before datasets.\n       */\n      sortByNameDesc: function(){\n        this.comparator = function(itemA, itemB){\n          if (itemA.get('type') === itemB.get('type')){\n            if (itemA.get('name').toLowerCase() > itemB.get('name').toLowerCase()) {\n              return -1; // after\n            }\n            if (itemB.get('name').toLowerCase() > itemA.get('name').toLowerCase()) {\n              return 1; // before\n            }\n            return 0; // equal\n          } else {\n            if (itemA.get('type') === 'folder'){\n              return -1; // folder is always before dataset\n            } else {\n              return 1;\n            }\n          }\n        };\n        this.sort();\n        return this;\n      }\n    });\n\n    var FolderContainer = Backbone.Model.extend({\n      defaults : {\n          folder : new Folder(),\n          urlRoot : Galaxy.root + 'api/folders/',\n          id : \"unknown\"\n      },\n      parse : function(obj) {\n        // empty the collection\n        this.get(\"folder\").reset();\n        // response is not a simple array, it contains metadata\n        // this will update the inner collection\n          for (var i = 0; i < obj.folder_contents.length; i++) {\n            if (obj.folder_contents[i].type === 'folder'){\n              var folder_item = new FolderAsModel(obj.folder_contents[i])\n              this.get(\"folder\").add(folder_item);\n            } else if(obj.folder_contents[i].type === 'file'){\n              var file_item = new Ldda(obj.folder_contents[i])\n              this.get(\"folder\").add(file_item);\n            } else{\n              Galaxy.emit.error('Unknown folder item type encountered while parsing response.');\n            }\n          };\n        return obj;\n      }\n    });\n\n\n// ============================================================================\n// HISTORY RELATED MODELS\n// TODO UNITE\n\n    var HistoryItem = Backbone.Model.extend({\n      urlRoot : Galaxy.root + 'api/histories/'\n    });\n\n    var HistoryContents = Backbone.Collection.extend({\n      urlRoot : Galaxy.root + 'api/histories/',\n      initialize: function(options){\n        this.id = options.id;\n      },\n      url : function(){\n        return this.urlRoot + this.id + '/contents';\n      },\n      model : HistoryItem\n    });\n\n    var GalaxyHistory = Backbone.Model.extend({\n      urlRoot : Galaxy.root + 'api/histories/'\n    });\n\n    var GalaxyHistories = Backbone.Collection.extend({\n      url : Galaxy.root + 'api/histories',\n      model : GalaxyHistory\n    });\n\n// ============================================================================\n// JSTREE MODEL\n    /** Represents folder structure parsable by the jstree component.\n     *\n     */\n\n    var Jstree = Backbone.Model.extend({\n      urlRoot: Galaxy.root + 'api/remote_files'\n    });\n\nreturn {\n    Library: Library,\n    Libraries : Libraries,\n    Item : Ldda,\n    Ldda : Ldda,\n    FolderAsModel : FolderAsModel,\n    Folder : Folder,\n    FolderContainer : FolderContainer,\n    HistoryItem : HistoryItem,\n    HistoryContents : HistoryContents,\n    GalaxyHistory : GalaxyHistory,\n    GalaxyHistories : GalaxyHistories,\n    Jstree: Jstree\n};\n\n});\n"]}