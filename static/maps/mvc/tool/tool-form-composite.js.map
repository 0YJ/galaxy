{"version":3,"sources":["mvc/tool/tool-form-composite.js"],"names":["View","Backbone","extend","initialize","options","self","this","modal","parent","Galaxy","_uiModal2","default","model","Model","deferred","_deferred2","setElement","$","addClass","append","$message","$header","$steps","$el","_configure","render","window","resize","_refresh","step_index","margin","_","reduce","child","memo","outerHeight","height","input","step_linked","match","re","exec","String","value","wp_name","callback","wp_inputs","label","wp_count","_handleWorkflowParameter","forms","steps","links","parms","get","i","icon","step","title","step_label","step_name","annotation","step_version","merge","escape","emit","parseInt","_isDataStep","sustain_repeats","text_enable","index","fixed_title","help","citations","collapsible","collapsed","sustain_version","step_type","sustain_conditionals","text_disable","cls_enable","cls","hide_operations","inputs","name","needs_refresh","each","output_connections","output_connection","sub_step","j","input_step_index","push","connection","connections_by_name","input_name","type","output_name","color","wp_input","style","backdrop","arg","pja","action_arguments","data_resolved","_formData2","visitInputs","context","is_runtime_value","__class__","is_data_input","indexOf","data_ref","length","wp_linked","default_value","flavor","reset","_renderMessage","_renderParameters","_renderHistory","_renderResourceParameters","_renderHeader","execute_btn","_uiMisc2","Button","empty","message","status","persistent","fade","step_version_changes","Message","wp_form","isEmpty","_formView2","_append","onchange","input_list","input_def","_refreshStep","cases","workflow_resource_parameters_form","history_form","postchange","current_state","tool_version","_renderStep","url","data","form","success","process","tool_id","id","error","version","create","wait","debug","_utils2","request","post_job_actions","portlet","update","is_simple_input","response","hide_label","reject","link","html","show_progress","short_str","promise","field_list","new_value","values","ignore","set","percentage","setTimeout","field","_refreshHistory","history","undefined","_refresh_history","refresh","source_step","numOfUnfinishedShownContents","UPDATE_DELAY","v","multiple","execute","_submit","resolve","wp_field","wp_value","split","join","history_form_data","parameters","batch","validated","currHistoryPanel","job_inputs","trigger","job_input_id","_enabled","job_def","resource_params","isArray","WebhookApp","urlRoot","toolId","toolVersion","input_value","input_id","input_found","step_related_errors","err_data","buttons","root","complete","children","hide","_templateSuccess","$container","WebhookView","wait_text","enabled","error_messages","matchResponse","show","body","_templateError","err_msg","Close","lst","startsWith","sanitize","text","JSON","stringify"],"mappings":"ubAUIA,EAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjB,IAAIC,EAAOC,KACXA,KAAKC,MAAQC,OAAOC,OAAOF,OAAS,IAAIG,EAAAC,QAAMX,KAC9CM,KAAKM,MAASR,GAAWA,EAAQQ,OAAU,IAAIX,SAASY,MAAMT,GAC9DE,KAAKQ,SAAW,IAAAC,EAAAJ,QAChBL,KAAKU,WACDC,EAAE,UACGC,SAAS,qBACTC,OAAQb,KAAKc,SAAWH,EAAE,WAC1BE,OAAQb,KAAKe,QAAUJ,EAAE,WACzBE,OAAQb,KAAKgB,OAASL,EAAE,YAEjCA,EAAE,QAAQE,OAAOb,KAAKiB,KACtBjB,KAAKkB,aACLlB,KAAKmB,SACLR,EAAES,QAAQC,OAAO,WACbtB,EAAKuB,cAhBbzB,SAAAA,SAAY0B,GACR,IAAAC,EACAC,EAAAC,OAAKzB,KAAQC,IAAAA,WAAcD,SAAAA,EAAS0B,GAAT1B,OAAa2B,EAAAjB,EAAAgB,GAAJE,eAApC,GACA7B,KAAKM,OAALwB,SACA,GACA9B,KAAAgB,OAAKN,IAAAA,SACCC,EAAAS,QACGR,SAASY,IAQlBb,WAAES,WA6FcW,SAAAA,EAAMC,EAAcD,GAG3B,IAFOA,IACHE,EADGF,EAAAA,eAEPE,EATDC,EAAAC,KAAAC,OAAAC,KAAA,CAUH,IAhBDC,EAAAL,EAAA,GADJM,EA6BaxC,EAAKyC,UAAUF,GAAWvC,EAAKyC,UAAUF,KATtDG,MAAAH,EACII,KAAJJ,EACKE,KAAY,OACRG,MAAAA,QAAT,MAASA,EAAAA,eACDT,MAAK,oBACLD,YAxGJlC,IAAAA,EAAAA,KACHC,KAFD4C,SAGH5C,KAnB2B6C,SAmCxB7C,KAAK8C,SAdT9C,KAAA+C,SACAzB,EAAAA,KAAAA,KAAUhB,MAAA0C,IAAA,SAASzB,SAAAA,EAAT0B,GACN9C,OAAIqB,KAAAA,MACEE,oCAA4BuB,EADlC,+BACkC,IAAAC,EAAiBtB,EAAAA,QAAOuB,EAAStB,WAA/DuB,EACKpC,SAAOc,EADZ,GAAA,MADJqB,EAAAE,YAAAF,EAAAG,WAIAH,EAAKnC,aA3BmBoC,GAAAA,MAAAD,EAAAI,YA8B5BJ,EAAAK,eACAtC,GAAAA,oBAAuBiC,EAAAK,aAAvBtC,KAEIiC,EAAKP,EAAAA,QAAQa,OAERX,MAALG,EACKF,YAALtB,EAAAiC,OAAAN,GACOF,KAAK5C,GAAU,GAClBH,KAAOwD,KACHT,UAAO,KACPE,aAAWQ,EACXT,UAAKI,EAAT,IAAqBxD,EAAA8D,YAAAV,GACjBC,iBAAeD,EAClBW,iBAAA,EACGX,sBAAmB,EACnBC,QAAAA,EACHW,YAAA,OACDZ,aAAO,OAECa,WADJ,aAEIC,YAAaxC,aACbyB,OAAMA,EAAAA,SACNgB,gBAJJ,EAKIC,IAAAA,oBACAC,iBANJ,EAOIC,eAAe,EACfC,eARJ,QAQIA,EARJC,WAUIC,GAEAT,EAAAA,MAAAA,GAAAA,EACAU,EAAAA,MAAAA,MACAC,EAAAA,MAAAA,QAIAC,EAAAA,KAAAA,KAAAA,MAAK,SAAAxB,EAAAF,GACL2B,EAAAA,QAAAA,YAAAA,EAAiBC,OAnBrB,SAAA9C,EAAA+C,GAoBIC,EAAAA,MAAAA,GAAAA,GAAehD,MAOvBhC,EAAAA,KAAAA,KAAAA,MAAWkD,SAAXE,EAAAF,GACHxB,EAvCDuD,KAAA7B,EAAA8B,mBAAA,SAAAC,GAmDQzD,EAAEuD,KAAKjF,EAAK8C,MAAO,SAACsC,EAAUC,GAVtCD,EAAA5D,aAAA2D,EAAAG,kBAAAtF,EAAA+C,MAAAG,GAAAqC,KAAAH,SAOA1D,EAAAuD,KAAAhF,KAAA6C,MAAA,SAAAM,EAAAF,GACAxB,EAAEuD,KAAKjF,EAAK8C,MAAO,SAAAsC,EAAChC,GAChB1B,IAAEuD,KACEvD,EAAAA,KAAEuD,EAAKjF,mBAAY,SAAAwF,GACfJ,EAAAA,aAAAI,EAAwBL,mBAD5BM,EAAAD,EAAAE,YAAAF,KAFR9D,EAAAuD,KAAAjF,EAAAgD,MAAAqC,GAAA,SAAArD,EAAA+C,GAkBY,IAAIS,EAAaC,EAAoBV,GAVjDS,IACAxD,EAAA2D,KAAA,SACY7C,EAAZqB,KAAmBnC,EAACoB,YAAYpB,EAAAmC,KAAb,KAAa,GACrBnE,EAAK8C,MAAL9C,mBAAYwF,EAAiBI,YAA7B5F,gBAA6B6D,SAAAX,GAAA,GAC5BuC,EAAAA,YAAAA,EAAJxD,gBACEgD,EAAK7B,YAAK8B,KAAAA,UAQJlD,IAAAA,EAAAA,EACAA,KAAAA,aAmBA+C,EAAAA,KAAAA,KAAAA,MAAAA,SAAAA,EAAMxC,GACNoD,EAAAA,KAAAA,EAAAA,MAAMzC,GAAA,SAAAlB,EAH4C+C,GAIlDc,EAAe7D,EAAEW,MAAW,SAAAmD,GAC5BC,EAAAA,MAAOR,KAAAnC,GACPL,EAAAA,WAAO,EAN2Cf,EAD1D2D,KAAA,OAUH3D,EAAAgE,UAAA,EACJhE,EAAA+D,MAAA,wBAGOnD,EAAAA,KAAAA,EAAAA,iBAAAA,SAAAA,GACIkD,EAAAA,KAAAA,EAAAA,iBAAoB1C,SAAAA,GACpBpB,EAAkBiE,EAAlB,oBAOJvE,EAAAA,KAAAA,KAAAA,MAAOwE,SAAAA,EAAIC,GACPvD,GAAAA,QAAAA,EAAAA,UAAAA,CACH,IAAAwD,GAFD,EAGHC,EAAA/F,QAJDgG,YAAAlD,EAAA0B,OAAA,SAAA9C,EAAA+C,EAAAwB,GAVJ,IAAAC,EAAAxE,EAAAM,OAAA,gBAAAN,EAAAM,MAAAmE,UAwBgBC,GAAoE,IAAnD,OAAQ,mBAAmBC,QAAQ3E,EAAM2D,MAP1EiB,EAAAL,EAAAvE,EAAA4E,UACA5E,EAAAC,cAAAjC,EAAA8D,YAAA9B,EAAAC,eAAAmE,GAAA,GACOpE,EAAKc,UACsB,GAArB0B,EAAAA,QAAaqC,SAAQT,GAAApE,EAAA8E,aACtBV,EAAAA,aAAJ,GACAQ,IACI5E,EAAIwE,YACAE,EAAAA,cAAyB1G,EAAA8D,YAAT8C,EAAoC5E,cAAxDA,EAAA8E,YACAJ,GAAeH,EAAAA,OAAf,gBAA6BK,EAAAA,MAA7BH,YAAAzE,EAAAC,eACAD,EAAMC,WAAN,GACAD,IAAAA,EACMA,MAAAA,EAAc6E,eAEpBD,EAAAA,OAAAA,WAGCF,GAAkB1E,GAAe,WAAMM,EAAMmE,MAAazE,EAAxC8E,YAEnBN,EAAAA,WAAqBxE,EAAAA,QAAMM,QAAQN,EAAM+E,QAAzC,KAAA/E,EAAAM,SACAN,EAAMgF,kBAANhF,EAAAM,MACIN,EAACwE,qBAAqBE,SAQrCtF,OAAA,WACJ,IAtL2BpB,EAAAC,KA0LxBA,KAAKQ,SAASwG,QAFlB7F,KAAAA,gBACInB,KAAAiH,iBACAjH,KAAAkH,oBACAlH,KAAAmH,iBACAnH,KAAAoH,4BACA3F,EAAAuD,KAAAhF,KAAKkH,MAAAA,SAAAA,GACLnH,EAAKoH,YAAAA,MAKRE,cAnM2B,WAuMxB,IAAItH,EAAOC,KAFfA,KAAAsH,YAAA,IAAAC,EAAAlH,QAAAmH,QACAH,KAAAA,WACIjE,MAAIrD,eACJ4E,IAAK2C,kBACDpE,QAAAA,WACAE,EAAAA,cAGIrD,KAAAA,QACHa,SAAA,kBANc6G,QAQnB5G,OAKYuC,IAAAA,EAAAA,QAAAA,OAGPvC,MAAAA,aAAYyG,KAAYrG,MAR7B+B,IAAA,UAhNwB/B,KA2N5BJ,OAAAb,KAAAsH,YAAArG,MAIQgG,eAAA,WAEQS,KAAAA,SAAAA,QAEAC,KAAAA,MAAAA,IAAAA,yBACAC,KAAAA,SAAAA,OACAC,IAAAA,EAAAA,QAAAA,SACD5G,QAEV,qRACG6G,OAAAA,UACAA,YAAAA,EACAD,MAAK/G,IAEG4G,KAIAG,IAAAA,EAAM7H,KAAAM,MAAA0C,IAAA,wBALK8E,GADnBA,EAAAlB,OAAA,GASH5G,KAAAc,SAAAD,OApPuB,IAAA0G,EAAAlH,QAAA0H,SA6OZL,QAUhB,oSACAR,OAAmB,UACXnH,YAAJ,EACKiI,MAAL,IACOC,MAMKxG,kBAAAA,WACIA,IAAAA,EAAAA,KACI1B,KAAAA,QAAAA,KACH0B,EAAAwG,QAAAjI,KAAAwC,aACJxC,KAAAgI,QAJD,IAAAE,EAAA7H,SAKH+C,MAAA,6BAVmByB,OAAxB7E,KAAAwC,UAYAmC,IAAKwD,oBACRC,SAAA,WAzQuB3G,EAAAuD,KAAAjF,EAAAiI,QAAAK,WAAA,SAAAC,EAAArF,GAkQRxB,EAAEuD,KAAKsD,EAAUxF,MAAO,SAAAK,GAU5CpD,EAAAwI,aAAApF,UAKQ0B,KAAAA,QACI7E,KAAAgB,OAAAyG,QAAAzH,KAAAgI,QAAA/G,OAKQwB,eAAAA,WACAiD,KAAAA,aAAAA,IAAAA,EAAAA,SACArD,IAAAA,oBACA6B,MAAAA,yBALQW,SASJxC,KAAAA,cACAwC,KAAAA,cAEQC,YACArC,KAAAA,QACAiD,MAAAA,gCACArD,KAAAA,UAJJA,MADI,QAHT6B,KAAA,IAdnBsE,QA9QwBnG,MAAA,OA+RJwC,SAiBGC,KAAA,OAClB2D,MAAAA,eACcnI,KAAU,OACpBmI,MAAAA,KAAAA,MAALzF,IAAyC,gBAP7ChD,KAAKmI,QAAQnI,KAAKgB,OAAQhB,KAAK0I,aAAazH,MAmB5CmG,0BAAA,WACApH,KAAAyI,kCAAsB,KAClB1I,EAAAA,QAAKiB,KAALV,MAAYM,IAAS,mCACrBZ,KAAAyI,kCAA8B,IAAAP,EAAA7H,SAC1B8C,IAAKwF,oBACDvF,MAAA,mCACAyB,OAAA7E,KAAI4I,MAAAA,IAAAA,kCAEAC,KAAAA,QAAAA,KAAAA,OAAAA,KAAc1F,kCAFElC,OAOpB6H,YAAA,SAAA3F,GACIuC,IAAAA,EAAAA,KACAqD,EAAAA,KACAC,KAAAA,SAAAA,QAAAA,SAAAA,GAEIC,GADJC,EAAAA,OAAAA,SAAAA,YACID,QAAAA,EAAAA,UACAA,EAAAA,WAAAA,SAAUE,EAAVF,GACA9I,IACAgJ,GACHC,QATSjG,EAAAkG,GAUVC,aAAOnG,EAAAoG,QACHpJ,OAAAA,EAAAA,QAAOwD,KAAWsF,EAAAD,KAAAQ,WAErBP,EAAAQ,MAAA,GAbStJ,OAAdwD,KAAA+F,MAAA,oCAAA,yBAAAd,GAeHe,EAAAtJ,QAxBDuJ,SAyBAX,KAAO,OACH9F,IAAK0G,OAAAA,KAAL1G,aAA8B0G,EAAAA,GAA9B1G,SACA8F,KAAKa,EAcmBZ,QAAA,SAAAF,GACAC,EAfxBc,OAAAf,GAoBHC,EAAAQ,MAAA,GACEtJ,OAAAwD,KAAA+F,MAAA,oCAAA,sBAAAV,GACCgB,EAAAA,WAEAjI,MAAMgF,SAASkD,GACflI,OAAMmI,KAANR,MAAmBM,oCAAnB,0BAAAC,GAFJd,EAAAgB,aASgB1I,EAAAA,IAAAA,EAAAA,QAAYqB,GACR/C,EAAAA,kBAAKwI,EAAa6B,iBAAlBxD,QACHqC,EAAAa,QAFDjJ,OAGHF,EANL,UAOIkE,SACSA,4BAISa,OACAZ,EAAM,UACElE,SAAA,iBAJhByJ,KAAA,4BAWzBxJ,OACemD,EAAAA,UACEhD,SAAQiI,mBAC1BoB,KACsBtK,EAAAA,OACHuK,EAANT,iBAEJvC,SAAAA,EAAAA,GAAAA,OAAL1F,EAAK0F,IAAsBjF,EAAAkI,WAAA,WAO3BC,CACH,IAFDR,GAAA,IAAA,aAAA,yBAAAtD,QAAAvD,EAAAoB,WA7FJ9C,EAAAuD,KAAA7B,EAAA0B,OAAA,SAAA9C,GAhUwBA,EAAAgF,OAAA,SAuXZhF,EAAMmI,WAAaF,IA6CnCzB,EAAc,IAAAL,EAAA7H,QACNN,EAAAA,QAAO0D,OAEDL,MAAAD,EAAAc,YACMlB,SAAMI,WACJnB,EAAAA,KAAAA,EAANc,MAAqBf,EAAM8E,OAAW,SAAAuD,GAC1BnB,EAAKwB,aAAWxB,MAGxBpE,OACI6F,EAAAA,QAAcC,EAAAA,OAAd/D,OAAA,EACAzD,EAAOpB,SAGCM,KACM2C,SACE0F,KAAAA,wBAFRE,OAAA,QAOJF,IAIP3K,EAAA6C,MAAAO,EAAAa,OAAMiF,EACHyB,EAAAA,QAAAA,EAAAA,OAAAA,EAAAA,KACA3K,EAAAuB,WACA6B,EAAA4B,eAAAhF,EAAIkC,aAAJkB,GACA8F,EAAAa,QAAA/J,EAAAuK,cAAwBvI,UAARG,YACZnC,EAAAuK,eACAvK,EAAAuH,YAAAhH,MAAAuK,KACApB,MAAA,EACIiB,UAAAA,eACHI,WAAA,KAAA3H,EAAAa,MAAA,GAAAjE,EAAA8C,MAAA+D,SAERzG,OAAAwD,KAAA+F,MAAA,oCAAAvG,EAAAa,MAAA,gCAAAb,GACD4H,WAAA,WACIC,EAAAA,WACH,MAKhBzC,aAzCD,SAyCOpF,GACHA,IAAAA,EAAAA,KACH8F,EAAAjJ,KAAA4C,MAAAO,EAAAa,OAlduBiF,GAwapBxH,EAAEuD,KAAKjF,EAAKgD,MAAMI,EAAKa,OAAQ,SAACjC,EAAO+C,GA6C/C,GAAA/C,EAAAC,aAAAD,EAAA8E,UAAA,CACAoE,IAAAA,EAAiBhC,EAAAwB,WAAAxB,EAAWD,KAAA/G,MAAA6C,IACpB/E,GAAOiL,EAAX,CACIE,IAAUhL,OAAAiL,EACTC,GAAAA,EAALpJ,YACa0I,GAAAC,WACDU,EAAAA,KAAUnC,EAAlBlH,YAAgC,SAAAsJ,GAChBC,GAAAA,EAAAA,YAAAA,GAAmC,CACtCH,IAAAA,EAAmBL,EAAAA,MAAWO,EAAMtH,OAAAgF,KAAAQ,SAAAzH,MAChCkJ,GACEO,EAAAA,KAFanJ,EAAxBsI,OAAA,SAAAc,GAGHf,EAAAC,OAAArF,KAAAmG,SAxCgB1J,EAAM2J,UAAYhB,EAAUC,OAAO/D,OAAS,IA6CzE8D,GACUC,QAAWD,EAAAC,OAAA,WAGjB,GAAA5I,EAAA8E,UAAA,CACc8E,EAAQ5J,EAAAM,MAGTuJ,IAFE,IACCC,EADD3J,EAAA,eAEPD,EAAAC,EAAAC,KAAAJ,EAAAM,QAAA,CAFJ,IAAAyJ,EAAA/L,EAAAiI,QAAAyC,WAAA1K,EAAAiI,QAAAgB,KAAA/G,MAAAA,EAAA,KADJ8J,EAAAD,GAAAA,EAAAzJ,QA1ewB0J,IAqcIrB,EAAYA,EAAUsB,MAAM/J,EAAM,IAAIgK,KAAKF,UAgD1CrD,IAAzBwD,GACUlB,EAAA3I,MAAAqI,OAKVyB,EAAAA,QAAAA,WAEAhJ,EAAA4B,eAAA,GAKAqH,gBAAAA,WAZU,IAAArM,EAAdC,KAcAkL,EAAImB,OAAYlM,QAAhBD,OAAAC,OAAAmM,kBAAApM,OAAAC,OAAAmM,iBAAAhM,MACAN,KAAAoL,kBAAmBxI,aAAO5C,KAAAoL,kBACtBF,GACAA,EAAIqB,UAAAA,QAAkBvD,WACtB,IAAI7F,EAAOpD,iCACPwB,EAAAA,iBAAkBA,WAAtB,WACKiL,EAAQvB,mBACRC,EAAIuB,kBAOGJ,SAAAA,WACH,IAAAtM,EAAAC,KACGqM,KAAAA,eAAAA,EAIHrM,KAAA0M,UAAA,GACD1M,KAAAQ,SAAAmL,QAAKU,SAAAA,GACDpD,WAAAA,WACAuB,EAAAqB,UACH9L,EAAA6L,WACDe,MAKJf,QAAA,WACH,IAAA7L,EAAAC,KACJkM,EAAAlM,KAAA0I,aAAAM,KAAAQ,SACDmD,GACI5M,iBAAcmM,EAAd,oBAAAA,EAAA,oBAAA,KACA/L,WAAOwD,EAAW,oBAAlB,KAAA3D,KAAmDM,MAAA0C,IAAA,cACtD4J,gBAAM5M,KAAAyI,kCAAAzI,KAAAyI,kCAAAO,KAAAQ,YACHrJ,mBAAYuJ,KAAM1B,QAAAhI,KAAAgI,QAAAgB,KAAlBQ,YACA2C,cAIIjD,uBAAS,EAGLnJ,OAAAA,GAEAsM,GAAA,EACA,IAAA,IAAApJ,KAAAjD,KAAA4C,MAAMiK,CACF9M,IAAAA,EAAAA,KAAAA,MAAKkB,GACLsL,EAAAtD,EAAI6D,KAAAA,SACAC,EAAAA,EAAAA,MAAAA,GACAC,EAAAA,EAAAA,WACAC,EAAAA,QAAAA,SAHsC,IAAA,IAAAR,KAA1CF,EAAA,CAKH,IAAAW,EAAAX,EAAAE,GA9CDU,EAAWlE,EAAKD,KAAK/G,MAAMwK,GAiD9BnE,GADQ2C,EAAAA,WAALkC,GAnBMlE,EAAAZ,WAAA8E,IAqBV7D,IAAAA,EAAOtH,YAASiI,CASA,KAPZoC,EADAlM,KAAAA,YAAAgD,GACIiK,GAAJF,EAAAvC,QAAAuC,EAAAvC,OAAA/D,OAAA,EAGQ0B,EAAIW,UACJX,EAAI+E,aAA+BC,KAA/BD,IACJ/E,EAAI+E,aAAqB,OAAzBH,GAEI,CACIjE,EAAAA,UAAAA,GACAmE,MAEHT,EAAAR,WAAA5K,GAAAoL,EAAAR,WAAA5K,OACJoL,EAAAR,WAAA5K,GAAAkL,GAAAF,EAAAE,IAGT,IAAAJ,EACItM,MAGIwN,GAASpN,OAAAwD,KAAA+F,MAAA,gCAAA,uBAAAiD,GAHGhD,EAAAtJ,QAAAuJ,SASnBlE,KAAA,OACJqD,IAjDS5I,OAAAqN,KAiDT,iBAjDSxN,KAAAM,MAAA+I,GAiDT,eACDoE,KAAAA,EACI1N,QAAAA,SAAK2M,GAMrB,GALavM,OAAAwD,KAAA+F,MAAA,8BAAA,yBAAAO,GApDLlK,EAAAkB,IAAAyM,WAAAC,OAsDH5N,EAAAkB,IAAAJ,OAAAd,EAAA6N,iBAAA3D,IAGLtJ,EAAAkM,QAAA5C,IAAAA,EAAArD,OAAA,EAAA,CACS7G,EAAAkB,IAAAJ,OAASgN,EAAAA,UAAiBxE,GAAA,kBACLxI,IAAOI,EAAAA,QAAjC6M,aArmBwBf,QAAA5M,OAAAqN,KAAA,wBAwjBJR,OAAQL,EAAQvD,QAgDxC6D,YAAAN,EAAA9D,eAIQkF,EAAAA,mBAFJzE,MAAA,SAAAW,GAKKjC,OAALrE,KAAgB+F,MAAK1B,8BAAgB,qBAArCiC,GACKvB,IAAAA,GAAqBA,EACnB,GAAK9F,GAAOqH,EAAAqD,SACPrE,IAAKa,IAAAA,KAAQkE,EAAAA,MAAU,CADnC,IAAA/E,EAAAlJ,EAAA6C,MAAAK,GAjnBwBoK,EAAApD,EAAAqD,SAAArE,EAAA3I,MAAA0C,IAAA,eAskBJ,GAAIqK,EAAqB,CAgDjD,IAAAY,EAAAhF,EAAAD,KAAAkF,cAAAb,GACa,IAAA,IAAAF,KAAgBc,EAAA,CACLpL,EAASA,UAASA,EAAtCoL,EAAAd,IACwBvG,GAAa,EACjC,QAKJwG,GA/nBwBrN,EAAAE,MAAAkO,MAklBJ/K,MAAO,6BAgD/BgL,KAAArO,EAAAsO,eAAA1B,EAAA1C,GAAAA,EAAAqE,SACkBf,SACAtD,MAAaA,WAElBrJ,EAAAA,MAAS+M,YAoBtBU,SAAgB,WACL1N,EAAE+L,UACJ9L,QAvEmB2N,EAAAA,UAAAA,GACIxO,OAAAA,KAAAA,MAAAA,gCAAA,qBAAA4M,KAchCxE,QAAS,SAAS0F,EAAY5M,GAC1B4M,EAAWhN,OAAO,QAAQA,OAAOI,IAIrCyL,SAAU,SAASsB,GACfhO,KAAKsH,YAAYhH,MAAMuK,KACnBpB,MAAOuE,EACPD,UAAW,aACXjD,YAAa,IAEjB9K,KAAKgI,SAAWhI,KAAKgI,QAAQ8B,QAAQkE,EAAU,SAAW,aAC1DhO,KAAK0I,cAAgB1I,KAAK0I,aAAaoB,QAAQkE,EAAU,SAAW,aACpEvM,EAAEuD,KAAKhF,KAAK4C,MAAO,SAAAqG,GACfA,GAAQA,EAAKa,QAAQkE,EAAU,SAAW,gBAKlDnK,YAAa,SAAShB,GAElB,IAAK,IADD2L,EAAM7N,EAAEkM,QAAQhK,GAASA,GAASA,GAC7BI,EAAI,EAAGA,EAAIuL,EAAI5H,OAAQ3D,IAAK,CACjC,IAAIE,EAAOqL,EAAIvL,GACf,IAAKE,IAASA,EAAKoB,YAAcpB,EAAKoB,UAAUkK,WAAW,QACvD,OAAO,EAGf,OAAO,GAIXb,iBAAkB,SAAS3D,GACvB,OAAItJ,EAAEkM,QAAQ5C,IAAaA,EAASrD,OAAS,EAClCjG,EAAE,UACJC,SAAS,oBACTC,OACGF,EAAE,QAAQ0J,KAAV,oCACwCV,EAAAtJ,QAAMqO,SAAS1O,KAAKM,MAAM0C,IAAI,SADtE,QAEQiH,EAASrD,OAAS,EAAlB,OAA6BqD,EAASrD,OAAtC,aAA2D,IAFnE,MAMH/F,OACGF,EAAE,QACGE,OAAO,QACP8N,KACG,yPAIT3O,KAAKqO,eAAepE,EAAU,oDAI7CoE,eAAgB,SAASpE,EAAUqE,GAC/B,OAAO3N,EAAE,UACJC,SAAS,qBACTC,OACGF,EAAE,QAAQgO,KAAV,sGACyGC,KAAKC,UACtGP,IACC,MAGZzN,OAAOF,EAAE,UAAUgO,KAAKC,KAAKC,UAAU5E,EAAU,KAAM,mBAIhEvK,KAAMA","file":"../../../scripts/mvc/tool/tool-form-composite.js","sourcesContent":["/** This is the run workflow tool form view. */\nimport Utils from \"utils/utils\";\nimport Deferred from \"utils/deferred\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nimport FormData from \"mvc/form/form-data\";\nimport ToolFormBase from \"mvc/tool/tool-form-base\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Webhooks from \"mvc/webhooks\";\nimport WorkflowIcons from \"mvc/workflow/workflow-icons\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.modal = parent.Galaxy.modal || new Modal.View();\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.deferred = new Deferred();\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"ui-form-composite\")\n                .append((this.$message = $(\"<div/>\")))\n                .append((this.$header = $(\"<div/>\")))\n                .append((this.$steps = $(\"<div/>\")))\n        );\n        $(\"body\").append(this.$el);\n        this._configure();\n        this.render();\n        $(window).resize(() => {\n            self._refresh();\n        });\n    },\n\n    /** Refresh height of scrollable div below header, handle scrolling by lazy loading steps */\n    _refresh: function(step_index) {\n        var margin =\n            _.reduce(this.$el.children(), (memo, child) => memo + $(child).outerHeight(), 0) -\n            this.$steps.height() +\n            90;\n        this.$steps.css(\"height\", $(window).height() - margin);\n    },\n\n    /** Configures form/step options for each workflow step */\n    _configure: function() {\n        var self = this;\n        this.forms = [];\n        this.steps = [];\n        this.links = [];\n        this.parms = [];\n        _.each(this.model.get(\"steps\"), (step, i) => {\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", `${i} : Preparing workflow step.`);\n            var icon = WorkflowIcons[step.step_type];\n            var title = `${parseInt(i + 1)}: ${step.step_label || step.step_name}`;\n            if (step.annotation) {\n                title += ` - ${step.annotation}`;\n            }\n            if (step.step_version) {\n                title += ` (Galaxy Version ${step.step_version})`;\n            }\n            step = Utils.merge(\n                {\n                    index: i,\n                    fixed_title: _.escape(title),\n                    icon: icon || \"\",\n                    help: null,\n                    citations: null,\n                    collapsible: true,\n                    collapsed: i > 0 && !self._isDataStep(step),\n                    sustain_version: true,\n                    sustain_repeats: true,\n                    sustain_conditionals: true,\n                    narrow: true,\n                    text_enable: \"Edit\",\n                    text_disable: \"Undo\",\n                    cls_enable: \"fa fa-edit\",\n                    cls_disable: \"fa fa-undo\",\n                    errors: step.messages,\n                    initial_errors: true,\n                    cls: \"ui-portlet-narrow\",\n                    hide_operations: true,\n                    needs_refresh: false,\n                    always_refresh: step.step_type != \"tool\"\n                },\n                step\n            );\n            self.steps[i] = step;\n            self.links[i] = [];\n            self.parms[i] = {};\n        });\n\n        // build linear index of step input pairs\n        _.each(this.steps, (step, i) => {\n            FormData.visitInputs(step.inputs, (input, name) => {\n                self.parms[i][name] = input;\n            });\n        });\n\n        // iterate through data input modules and collect linked sub steps\n        _.each(this.steps, (step, i) => {\n            _.each(step.output_connections, output_connection => {\n                _.each(self.steps, (sub_step, j) => {\n                    sub_step.step_index === output_connection.input_step_index && self.links[i].push(sub_step);\n                });\n            });\n        });\n\n        // convert all connected data inputs to hidden fields with proper labels,\n        // and track the linked source step\n        _.each(this.steps, (step, i) => {\n            _.each(self.steps, (sub_step, j) => {\n                var connections_by_name = {};\n                _.each(step.output_connections, connection => {\n                    sub_step.step_index === connection.input_step_index &&\n                        (connections_by_name[connection.input_name] = connection);\n                });\n                _.each(self.parms[j], (input, name) => {\n                    var connection = connections_by_name[name];\n                    if (connection) {\n                        input.type = \"hidden\";\n                        input.help = input.step_linked ? `${input.help}, ` : \"\";\n                        input.help += `Output dataset '${connection.output_name}' from step ${parseInt(i) + 1}`;\n                        input.step_linked = input.step_linked || [];\n                        input.step_linked.push(step);\n                    }\n                });\n            });\n        });\n\n        // identify and configure workflow parameters\n        var wp_count = 0;\n        this.wp_inputs = {};\n        function _handleWorkflowParameter(value, callback) {\n            var re = /\\$\\{(.+?)\\}/g;\n            var match;\n            while ((match = re.exec(String(value)))) {\n                var wp_name = match[1];\n                callback(\n                    (self.wp_inputs[wp_name] = self.wp_inputs[wp_name] || {\n                        label: wp_name,\n                        name: wp_name,\n                        type: \"text\",\n                        color: `hsl( ${++wp_count * 100}, 70%, 30% )`,\n                        style: \"ui-form-wp-source\",\n                        links: []\n                    })\n                );\n            }\n        }\n        _.each(this.steps, (step, i) => {\n            _.each(self.parms[i], (input, name) => {\n                _handleWorkflowParameter(input.value, wp_input => {\n                    wp_input.links.push(step);\n                    input.wp_linked = true;\n                    input.type = \"text\";\n                    input.backdrop = true;\n                    input.style = \"ui-form-wp-target\";\n                });\n            });\n            _.each(step.post_job_actions, pja => {\n                _.each(pja.action_arguments, arg => {\n                    _handleWorkflowParameter(arg, () => {});\n                });\n            });\n        });\n\n        // select fields are shown for dynamic fields if all putative data inputs are available,\n        // or if an explicit reference is specified as data_ref and available\n        _.each(this.steps, (step, i) => {\n            if (step.step_type == \"tool\") {\n                var data_resolved = true;\n                FormData.visitInputs(step.inputs, (input, name, context) => {\n                    var is_runtime_value = input.value && input.value.__class__ == \"RuntimeValue\";\n                    var is_data_input = [\"data\", \"data_collection\"].indexOf(input.type) != -1;\n                    var data_ref = context[input.data_ref];\n                    input.step_linked && !self._isDataStep(input.step_linked) && (data_resolved = false);\n                    input.options &&\n                        ((input.options.length == 0 && !data_resolved) || input.wp_linked) &&\n                        (input.is_workflow = true);\n                    data_ref &&\n                        (input.is_workflow =\n                            (data_ref.step_linked && !self._isDataStep(data_ref.step_linked)) || input.wp_linked);\n                    (is_data_input || (input.value && input.value.__class__ == \"RuntimeValue\" && !input.step_linked)) &&\n                        (step.collapsed = false);\n                    is_runtime_value && (input.value = input.default_value);\n                    input.flavor = \"workflow\";\n                    if (!is_runtime_value && !is_data_input && input.type !== \"hidden\" && !input.wp_linked) {\n                        if (input.optional || (!Utils.isEmpty(input.value) && input.value !== \"\")) {\n                            input.collapsible_value = input.value;\n                            input.collapsible_preview = true;\n                        }\n                    }\n                });\n            }\n        });\n    },\n\n    render: function() {\n        var self = this;\n        this.deferred.reset();\n        this._renderHeader();\n        this._renderMessage();\n        this._renderParameters();\n        this._renderHistory();\n        this._renderResourceParameters();\n        _.each(this.steps, step => {\n            self._renderStep(step);\n        });\n    },\n\n    /** Render header */\n    _renderHeader: function() {\n        var self = this;\n        this.execute_btn = new Ui.Button({\n            icon: \"fa-check\",\n            title: \"Run workflow\",\n            cls: \"btn btn-primary\",\n            onclick: function() {\n                self._execute();\n            }\n        });\n        this.$header\n            .addClass(\"ui-form-header\")\n            .empty()\n            .append(\n                new Ui.Label({\n                    title: `Workflow: ${this.model.get(\"name\")}`\n                }).$el\n            )\n            .append(this.execute_btn.$el);\n    },\n\n    /** Render message */\n    _renderMessage: function() {\n        this.$message.empty();\n        if (this.model.get(\"has_upgrade_messages\")) {\n            this.$message.append(\n                new Ui.Message({\n                    message:\n                        \"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.\",\n                    status: \"warning\",\n                    persistent: true,\n                    fade: false\n                }).$el\n            );\n        }\n        var step_version_changes = this.model.get(\"step_version_changes\");\n        if (step_version_changes && step_version_changes.length > 0) {\n            this.$message.append(\n                new Ui.Message({\n                    message:\n                        \"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.\",\n                    status: \"warning\",\n                    persistent: true,\n                    fade: false\n                }).$el\n            );\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderParameters: function() {\n        var self = this;\n        this.wp_form = null;\n        if (!_.isEmpty(this.wp_inputs)) {\n            this.wp_form = new Form({\n                title: \"<b>Workflow Parameters</b>\",\n                inputs: this.wp_inputs,\n                cls: \"ui-portlet-narrow\",\n                onchange: function() {\n                    _.each(self.wp_form.input_list, (input_def, i) => {\n                        _.each(input_def.links, step => {\n                            self._refreshStep(step);\n                        });\n                    });\n                }\n            });\n            this._append(this.$steps.empty(), this.wp_form.$el);\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderHistory: function() {\n        this.history_form = new Form({\n            cls: \"ui-portlet-narrow\",\n            title: \"<b>History Options</b>\",\n            inputs: [\n                {\n                    type: \"conditional\",\n                    name: \"new_history\",\n                    test_param: {\n                        name: \"check\",\n                        label: \"Send results to a new history\",\n                        type: \"boolean\",\n                        value: \"false\",\n                        help: \"\"\n                    },\n                    cases: [\n                        {\n                            value: \"true\",\n                            inputs: [\n                                {\n                                    name: \"name\",\n                                    label: \"History name\",\n                                    type: \"text\",\n                                    value: this.model.get(\"name\")\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        });\n        this._append(this.$steps, this.history_form.$el);\n    },\n    \n    /** Render Workflow Options */\n    _renderResourceParameters: function() {\n        this.workflow_resource_parameters_form = null;\n        if(!_.isEmpty(this.model.get('workflow_resource_parameters'))){\n            this.workflow_resource_parameters_form = new Form({\n                cls    : 'ui-portlet-narrow',\n                title  : '<b>Workflow Resource Options</b>',\n                inputs : this.model.get('workflow_resource_parameters')\n            });\n            this._append( this.$steps, this.workflow_resource_parameters_form.$el );\n        }\n    },\n\n    /** Render step */\n    _renderStep: function(step) {\n        var self = this;\n        var form = null;\n        this.deferred.execute(promise => {\n            self.$steps.addClass(\"ui-steps\");\n            if (step.step_type == \"tool\") {\n                step.postchange = function(process, form) {\n                    var self = this;\n                    var current_state = {\n                        tool_id: step.id,\n                        tool_version: step.version,\n                        inputs: $.extend(true, {}, form.data.create())\n                    };\n                    form.wait(true);\n                    Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Sending current state.\", current_state);\n                    Utils.request({\n                        type: \"POST\",\n                        url: `${Galaxy.root}api/tools/${step.id}/build`,\n                        data: current_state,\n                        success: function(data) {\n                            form.update(data);\n                            form.wait(false);\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Received new model.\", data);\n                            process.resolve();\n                        },\n                        error: function(response) {\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Refresh request failed.\", response);\n                            process.reject();\n                        }\n                    });\n                };\n                form = new ToolFormBase(step);\n                if (step.post_job_actions && step.post_job_actions.length) {\n                    form.portlet.append(\n                        $(\"<div/>\")\n                            .addClass(\"ui-form-element-disabled\")\n                            .append(\n                                $(\"<div/>\")\n                                    .addClass(\"ui-form-title\")\n                                    .html(\"<b>Job Post Actions</b>\")\n                            )\n                            .append(\n                                $(\"<div/>\")\n                                    .addClass(\"ui-form-preview\")\n                                    .html(\n                                        _.reduce(\n                                            step.post_job_actions,\n                                            (memo, value) => `${memo} ${value.short_str}`,\n                                            \"\"\n                                        )\n                                    )\n                            )\n                    );\n                }\n            } else {\n                var is_simple_input = [\"data_input\", \"data_collection_input\"].indexOf(step.step_type) != -1;\n                _.each(step.inputs, input => {\n                    input.flavor = \"module\";\n                    input.hide_label = is_simple_input;\n                });\n                form = new Form(\n                    Utils.merge(\n                        {\n                            title: step.fixed_title,\n                            onchange: function() {\n                                _.each(self.links[step.index], link => {\n                                    self._refreshStep(link);\n                                });\n                            },\n                            inputs:\n                                step.inputs && step.inputs.length > 0\n                                    ? step.inputs\n                                    : [\n                                          {\n                                              type: \"hidden\",\n                                              name: \"No options available.\",\n                                              ignore: null\n                                          }\n                                      ]\n                        },\n                        step\n                    )\n                );\n            }\n            self.forms[step.index] = form;\n            self._append(self.$steps, form.$el);\n            self._refresh();\n            step.needs_refresh && self._refreshStep(step);\n            form.portlet[!self.show_progress ? \"enable\" : \"disable\"]();\n            self.show_progress &&\n                self.execute_btn.model.set({\n                    wait: true,\n                    wait_text: \"Preparing...\",\n                    percentage: (step.index + 1) * 100.0 / self.steps.length\n                });\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", `${step.index} : Workflow step state ready.`, step);\n            setTimeout(() => {\n                promise.resolve();\n            }, 0);\n        });\n    },\n\n    /** Refreshes step values from source step values */\n    _refreshStep: function(step) {\n        var self = this;\n        var form = this.forms[step.index];\n        if (form) {\n            _.each(self.parms[step.index], (input, name) => {\n                if (input.step_linked || input.wp_linked) {\n                    var field = form.field_list[form.data.match(name)];\n                    if (field) {\n                        var new_value = undefined;\n                        if (input.step_linked) {\n                            new_value = { values: [] };\n                            _.each(input.step_linked, source_step => {\n                                if (self._isDataStep(source_step)) {\n                                    var value = self.forms[source_step.index].data.create().input;\n                                    value &&\n                                        _.each(value.values, v => {\n                                            new_value.values.push(v);\n                                        });\n                                }\n                            });\n                            if (!input.multiple && new_value.values.length > 0) {\n                                new_value = {\n                                    values: [new_value.values[0]]\n                                };\n                            }\n                        } else if (input.wp_linked) {\n                            new_value = input.value;\n                            var re = /\\$\\{(.+?)\\}/g;\n                            var match;\n                            while ((match = re.exec(input.value))) {\n                                var wp_field = self.wp_form.field_list[self.wp_form.data.match(match[1])];\n                                var wp_value = wp_field && wp_field.value();\n                                if (wp_value) {\n                                    new_value = new_value.split(match[0]).join(wp_value);\n                                }\n                            }\n                        }\n                        if (new_value !== undefined) {\n                            field.value(new_value);\n                        }\n                    }\n                }\n            });\n            form.trigger(\"change\");\n        } else {\n            step.needs_refresh = true;\n        }\n    },\n\n    /** Refresh the history after job submission while form is shown */\n    _refreshHistory: function() {\n        var self = this;\n        var history = parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.model;\n        this._refresh_history && clearTimeout(this._refresh_history);\n        if (history) {\n            history.refresh().success(() => {\n                if (history.numOfUnfinishedShownContents() === 0) {\n                    self._refresh_history = setTimeout(() => {\n                        self._refreshHistory();\n                    }, history.UPDATE_DELAY);\n                }\n            });\n        }\n    },\n\n    /** Build remaining steps */\n    _execute: function() {\n        var self = this;\n        this.show_progress = true;\n        this._enabled(false);\n        this.deferred.execute(promise => {\n            setTimeout(() => {\n                promise.resolve();\n                self._submit();\n            }, 0);\n        });\n    },\n\n    /** Validate and submit workflow */\n    _submit: function() {\n        var self = this;\n        var history_form_data = this.history_form.data.create();\n        var job_def = {\n            new_history_name: history_form_data[\"new_history|name\"] ? history_form_data[\"new_history|name\"] : null,\n            history_id: !history_form_data[\"new_history|name\"] ? this.model.get(\"history_id\") : null,\n            resource_params: this.workflow_resource_parameters_form ? this.workflow_resource_parameters_form.data.create() : {},\n            replacement_params: this.wp_form ? this.wp_form.data.create() : {},\n            parameters: {},\n            // Tool form will submit flat maps for each parameter\n            // (e.g. \"repeat_0|cond|param\": \"foo\" instead of nested\n            // data structures).\n            parameters_normalized: true,\n            // Tool form always wants a list of invocations back\n            // so that inputs can be batched.\n            batch: true\n        };\n        var validated = true;\n        for (var i in this.forms) {\n            var form = this.forms[i];\n            var job_inputs = form.data.create();\n            var step = self.steps[i];\n            var step_index = step.step_index;\n            form.trigger(\"reset\");\n            for (var job_input_id in job_inputs) {\n                var input_value = job_inputs[job_input_id];\n                var input_id = form.data.match(job_input_id);\n                var input_field = form.field_list[input_id];\n                var input_def = form.input_list[input_id];\n                if (!input_def.step_linked) {\n                    if (this._isDataStep(step)) {\n                        validated = input_value && input_value.values && input_value.values.length > 0;\n                    } else {\n                        validated =\n                            input_def.optional ||\n                            (input_def.is_workflow && input_value !== \"\") ||\n                            (!input_def.is_workflow && input_value !== null);\n                    }\n                    if (!validated) {\n                        form.highlight(input_id);\n                        break;\n                    }\n                    job_def.parameters[step_index] = job_def.parameters[step_index] || {};\n                    job_def.parameters[step_index][job_input_id] = job_inputs[job_input_id];\n                }\n            }\n            if (!validated) {\n                break;\n            }\n        }\n        if (!validated) {\n            self._enabled(true);\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation failed.\", job_def);\n        } else {\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation complete.\", job_def);\n            Utils.request({\n                type: \"POST\",\n                url: `${Galaxy.root}api/workflows/${this.model.id}/invocations`,\n                data: job_def,\n                success: function(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission successful.\", response);\n                    self.$el.children().hide();\n                    self.$el.append(self._templateSuccess(response));\n\n                    // Show Webhook if job is running\n                    if ($.isArray(response) && response.length > 0) {\n                        self.$el.append($(\"<div/>\", { id: \"webhook-view\" }));\n                        var WebhookApp = new Webhooks.WebhookView({\n                            urlRoot: `${Galaxy.root}api/webhooks/workflow`,\n                            toolId: job_def.tool_id,\n                            toolVersion: job_def.tool_version\n                        });\n                    }\n\n                    self._refreshHistory();\n                },\n                error: function(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission failed.\", response);\n                    var input_found = false;\n                    if (response && response.err_data) {\n                        for (var i in self.forms) {\n                            var form = self.forms[i];\n                            var step_related_errors = response.err_data[form.model.get(\"step_index\")];\n                            if (step_related_errors) {\n                                var error_messages = form.data.matchResponse(step_related_errors);\n                                for (var input_id in error_messages) {\n                                    form.highlight(input_id, error_messages[input_id]);\n                                    input_found = true;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                    if (!input_found) {\n                        self.modal.show({\n                            title: \"Workflow submission failed\",\n                            body: self._templateError(job_def, response && response.err_msg),\n                            buttons: {\n                                Close: function() {\n                                    self.modal.hide();\n                                }\n                            }\n                        });\n                    }\n                },\n                complete: function() {\n                    self._enabled(true);\n                }\n            });\n        }\n    },\n\n    /** Append new dom to body */\n    _append: function($container, $el) {\n        $container.append(\"<p/>\").append($el);\n    },\n\n    /** Set enabled/disabled state */\n    _enabled: function(enabled) {\n        this.execute_btn.model.set({\n            wait: !enabled,\n            wait_text: \"Sending...\",\n            percentage: -1\n        });\n        this.wp_form && this.wp_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        this.history_form && this.history_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        _.each(this.forms, form => {\n            form && form.portlet[enabled ? \"enable\" : \"disable\"]();\n        });\n    },\n\n    /** Is data input module/step */\n    _isDataStep: function(steps) {\n        var lst = $.isArray(steps) ? steps : [steps];\n        for (var i = 0; i < lst.length; i++) {\n            var step = lst[i];\n            if (!step || !step.step_type || !step.step_type.startsWith(\"data\")) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    /** Templates */\n    _templateSuccess: function(response) {\n        if ($.isArray(response) && response.length > 0) {\n            return $(\"<div/>\")\n                .addClass(\"donemessagelarge\")\n                .append(\n                    $(\"<p/>\").html(\n                        `Successfully invoked workflow <b>${Utils.sanitize(this.model.get(\"name\"))}</b>${\n                            response.length > 1 ? ` <b>${response.length} times</b>` : \"\"\n                        }.`\n                    )\n                )\n                .append(\n                    $(\"<p/>\")\n                        .append(\"<b/>\")\n                        .text(\n                            \"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"\n                        )\n                );\n        } else {\n            return this._templateError(response, \"Invalid success response. No invocations found.\");\n        }\n    },\n\n    _templateError: function(response, err_msg) {\n        return $(\"<div/>\")\n            .addClass(\"errormessagelarge\")\n            .append(\n                $(\"<p/>\").text(\n                    `The server could not complete the request. Please contact the Galaxy Team if this error persists. ${JSON.stringify(\n                        err_msg\n                    ) || \"\"}`\n                )\n            )\n            .append($(\"<pre/>\").text(JSON.stringify(response, null, 4)));\n    }\n});\nexport default {\n    View: View\n};\n"]}