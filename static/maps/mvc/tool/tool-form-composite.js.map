{"version":3,"sources":["mvc/tool/tool-form-composite.js"],"names":["define","View","initialize","$","self","Ui","Form","FormData","ToolFormBase","_refresh","Webhooks","WorkflowIcons","$steps","extend","options","this","modal","parent","Galaxy","Modal","_configure","model","Backbone","Model","forms","Deferred","steps","links","addClass","$message","emit","$header","icon","step_type","annotation","$el","title","render","window","step_version","help","citations","collapsible","children","collapsed","i","child","sustain_version","outerHeight","sustain_conditionals","text_enable","text_disable","cls_enable","height","margin","cls","_handleWorkflowParameter","value","callback","deferred","match","re","reset","exec","String","_renderHeader","_renderMessage","_renderParameters","wp_inputs","wp_name","label","name","type","color","wp_count","style","hide_operations","needs_refresh","always_refresh","step","get","debug","step_label","step_name","output_connections","each","sub_step","Utils","merge","index","fixed_title","_","escape","connections_by_name","_isDataStep","parms","connection","input","messages","step_linked","output_connection","j","step_index","wp_input","post_job_actions","pja","action_arguments","input_step_index","input_name","data_resolved","visitInputs","is_runtime_value","is_data_input","data_ref","context","parseInt","optional","push","onclick","wp_linked","execute_btn","backdrop","empty","arg","step_version_changes","Message","message","inputs","persistent","__class__","indexOf","length","wp_form","input_def","_refreshStep","is_workflow","default_value","flavor","isEmpty","collapsible_value","collapsible_preview","_renderWorkflowOptions","workflow_options_form","Button","_renderStep","form","execute","current_state","tool_id","tool_version","request","success","process","error","reject","fade","append","is_simple_input","ignore","show_progress","setTimeout","_renderHistory","history_form","field","new_value","cases","multiple","values","_append","wp_field","undefined","trigger","_refreshHistory","promise","_refresh_history","history","clearTimeout","postchange","refresh","numOfUnfinishedShownContents","id","version","UPDATE_DELAY","data","create","wait","url","root","update","history_form_data","workflow_options","response","parameters_normalized","job_inputs","job_input_id","field_list","input_value","html","memo","job_def","parameters","_enabled","hide_label","onchange","link","err_data","input_found","portlet","set","body","buttons","complete","resolve","$container","enabled","source_step","v","_templateError","err_msg","wp_value","split","join","currHistoryPanel","_execute","_submit","new_history_name","history_id","replacement_params","batch","validated","input_id","input_list","highlight","hide","_templateSuccess","isArray","WebhookView","urlRoot","toolId","toolVersion","step_related_errors","error_messages","matchResponse","show","Close","wait_text","percentage","lst","startsWith","sanitize","text","JSON","stringify"],"mappings":"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","file":"../../../scripts/mvc/tool/tool-form-composite.js","sourcesContent":["/** This is the run workflow tool form view. */\ndefine(\n    [\n        \"utils/utils\",\n        \"utils/deferred\",\n        \"mvc/ui/ui-misc\",\n        \"mvc/form/form-view\",\n        \"mvc/form/form-data\",\n        \"mvc/tool/tool-form-base\",\n        \"mvc/ui/ui-modal\",\n        \"mvc/webhooks\",\n        \"mvc/workflow/workflow-icons\"\n    ],\n    function(\n        Utils,\n        Deferred,\n        Ui,\n        Form,\n        FormData,\n        ToolFormBase,\n        Modal,\n        Webhooks,\n        WorkflowIcons\n    ) {\n        var View = Backbone.View.extend({\n            initialize: function(options) {\n                var self = this;\n                this.modal = parent.Galaxy.modal || new Modal.View();\n                this.model =\n                    (options && options.model) || new Backbone.Model(options);\n                this.deferred = new Deferred();\n                this.setElement(\n                    $(\"<div/>\")\n                        .addClass(\"ui-form-composite\")\n                        .append((this.$message = $(\"<div/>\")))\n                        .append((this.$header = $(\"<div/>\")))\n                        .append((this.$steps = $(\"<div/>\")))\n                );\n                $(\"body\").append(this.$el);\n                this._configure();\n                this.render();\n                $(window).resize(function() {\n                    self._refresh();\n                });\n            },\n\n            /** Refresh height of scrollable div below header, handle scrolling by lazy loading steps */\n            _refresh: function(step_index) {\n                var margin =\n                    _.reduce(\n                        this.$el.children(),\n                        function(memo, child) {\n                            return memo + $(child).outerHeight();\n                        },\n                        0\n                    ) -\n                    this.$steps.height() +\n                    90;\n                this.$steps.css(\"height\", $(window).height() - margin);\n            },\n\n            /** Configures form/step options for each workflow step */\n            _configure: function() {\n                var self = this;\n                this.forms = [];\n                this.steps = [];\n                this.links = [];\n                this.parms = [];\n                _.each(this.model.get(\"steps\"), function(step, i) {\n                    Galaxy.emit.debug(\n                        \"tool-form-composite::initialize()\",\n                        i + \" : Preparing workflow step.\"\n                    );\n                    var icon = WorkflowIcons[step.step_type];\n                    var title =\n                        parseInt(i + 1) +\n                        \": \" +\n                        (step.step_label || step.step_name);\n                    if (step.annotation) {\n                        title += \" - \" + step.annotation;\n                    }\n                    if (step.step_version) {\n                        title += \" (Galaxy Version \" + step.step_version + \")\";\n                    }\n                    step = Utils.merge(\n                        {\n                            index: i,\n                            fixed_title: _.escape(title),\n                            icon: icon || \"\",\n                            help: null,\n                            citations: null,\n                            collapsible: true,\n                            collapsed: i > 0 && !self._isDataStep(step),\n                            sustain_version: true,\n                            sustain_repeats: true,\n                            sustain_conditionals: true,\n                            narrow: true,\n                            text_enable: \"Edit\",\n                            text_disable: \"Undo\",\n                            cls_enable: \"fa fa-edit\",\n                            cls_disable: \"fa fa-undo\",\n                            errors: step.messages,\n                            initial_errors: true,\n                            cls: \"ui-portlet-narrow\",\n                            hide_operations: true,\n                            needs_refresh: false,\n                            always_refresh: step.step_type != \"tool\"\n                        },\n                        step\n                    );\n                    self.steps[i] = step;\n                    self.links[i] = [];\n                    self.parms[i] = {};\n                });\n\n                // build linear index of step input pairs\n                _.each(this.steps, function(step, i) {\n                    FormData.visitInputs(step.inputs, function(input, name) {\n                        self.parms[i][name] = input;\n                    });\n                });\n\n                // iterate through data input modules and collect linked sub steps\n                _.each(this.steps, function(step, i) {\n                    _.each(step.output_connections, function(\n                        output_connection\n                    ) {\n                        _.each(self.steps, function(sub_step, j) {\n                            sub_step.step_index ===\n                                output_connection.input_step_index &&\n                                self.links[i].push(sub_step);\n                        });\n                    });\n                });\n\n                // convert all connected data inputs to hidden fields with proper labels,\n                // and track the linked source step\n                _.each(this.steps, function(step, i) {\n                    _.each(self.steps, function(sub_step, j) {\n                        var connections_by_name = {};\n                        _.each(step.output_connections, function(connection) {\n                            sub_step.step_index ===\n                                connection.input_step_index &&\n                                (connections_by_name[\n                                    connection.input_name\n                                ] = connection);\n                        });\n                        _.each(self.parms[j], function(input, name) {\n                            var connection = connections_by_name[name];\n                            if (connection) {\n                                input.type = \"hidden\";\n                                input.help = input.step_linked\n                                    ? input.help + \", \"\n                                    : \"\";\n                                input.help +=\n                                    \"Output dataset '\" +\n                                    connection.output_name +\n                                    \"' from step \" +\n                                    (parseInt(i) + 1);\n                                input.step_linked = input.step_linked || [];\n                                input.step_linked.push(step);\n                            }\n                        });\n                    });\n                });\n\n                // identify and configure workflow parameters\n                var wp_count = 0;\n                this.wp_inputs = {};\n                function _handleWorkflowParameter(value, callback) {\n                    var re = /\\$\\{(.+?)\\}/g,\n                        match;\n                    while ((match = re.exec(String(value)))) {\n                        var wp_name = match[1];\n                        callback(\n                            (self.wp_inputs[wp_name] = self.wp_inputs[\n                                wp_name\n                            ] || {\n                                label: wp_name,\n                                name: wp_name,\n                                type: \"text\",\n                                color:\n                                    \"hsl( \" + ++wp_count * 100 + \", 70%, 30% )\",\n                                style: \"ui-form-wp-source\",\n                                links: []\n                            })\n                        );\n                    }\n                }\n                _.each(this.steps, function(step, i) {\n                    _.each(self.parms[i], function(input, name) {\n                        _handleWorkflowParameter(input.value, function(\n                            wp_input\n                        ) {\n                            wp_input.links.push(step);\n                            input.wp_linked = true;\n                            input.type = \"text\";\n                            input.backdrop = true;\n                            input.style = \"ui-form-wp-target\";\n                        });\n                    });\n                    _.each(step.post_job_actions, function(pja) {\n                        _.each(pja.action_arguments, function(arg) {\n                            _handleWorkflowParameter(arg, function() {});\n                        });\n                    });\n                });\n\n                // select fields are shown for dynamic fields if all putative data inputs are available,\n                // or if an explicit reference is specified as data_ref and available\n                _.each(this.steps, function(step, i) {\n                    if (step.step_type == \"tool\") {\n                        var data_resolved = true;\n                        FormData.visitInputs(step.inputs, function(\n                            input,\n                            name,\n                            context\n                        ) {\n                            var is_runtime_value =\n                                input.value &&\n                                input.value.__class__ == \"RuntimeValue\";\n                            var is_data_input =\n                                [\"data\", \"data_collection\"].indexOf(\n                                    input.type\n                                ) != -1;\n                            var data_ref = context[input.data_ref];\n                            input.step_linked &&\n                                !self._isDataStep(input.step_linked) &&\n                                (data_resolved = false);\n                            input.options &&\n                                ((input.options.length == 0 &&\n                                    !data_resolved) ||\n                                    input.wp_linked) &&\n                                (input.is_workflow = true);\n                            data_ref &&\n                                (input.is_workflow =\n                                    (data_ref.step_linked &&\n                                        !self._isDataStep(\n                                            data_ref.step_linked\n                                        )) ||\n                                    input.wp_linked);\n                            (is_data_input ||\n                                (input.value &&\n                                    input.value.__class__ == \"RuntimeValue\" &&\n                                    !input.step_linked)) &&\n                                (step.collapsed = false);\n                            is_runtime_value &&\n                                (input.value = input.default_value);\n                            input.flavor = \"workflow\";\n                            if (\n                                !is_runtime_value &&\n                                !is_data_input &&\n                                input.type !== \"hidden\" &&\n                                !input.wp_linked\n                            ) {\n                                if (\n                                    input.optional ||\n                                    (!Utils.isEmpty(input.value) &&\n                                        input.value !== \"\")\n                                ) {\n                                    input.collapsible_value = input.value;\n                                    input.collapsible_preview = true;\n                                }\n                            }\n                        });\n                    }\n                });\n            },\n\n            render: function() {\n                var self = this;\n                this.deferred.reset();\n                this._renderHeader();\n                this._renderMessage();\n                this._renderParameters();\n                this._renderHistory();\n                this._renderWorkflowOptions();\n                _.each(this.steps, function(step) {\n                    self._renderStep(step);\n                });\n            },\n\n            /** Render header */\n            _renderHeader: function() {\n                var self = this;\n                this.execute_btn = new Ui.Button({\n                    icon: \"fa-check\",\n                    title: \"Run workflow\",\n                    cls: \"btn btn-primary\",\n                    onclick: function() {\n                        self._execute();\n                    }\n                });\n                this.$header\n                    .addClass(\"ui-form-header\")\n                    .empty()\n                    .append(\n                        new Ui.Label({\n                            title: \"Workflow: \" + this.model.get(\"name\")\n                        }).$el\n                    )\n                    .append(this.execute_btn.$el);\n            },\n\n            /** Render message */\n            _renderMessage: function() {\n                this.$message.empty();\n                if (this.model.get(\"has_upgrade_messages\")) {\n                    this.$message.append(\n                        new Ui.Message({\n                            message:\n                                \"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.\",\n                            status: \"warning\",\n                            persistent: true,\n                            fade: false\n                        }).$el\n                    );\n                }\n                var step_version_changes = this.model.get(\n                    \"step_version_changes\"\n                );\n                if (step_version_changes && step_version_changes.length > 0) {\n                    this.$message.append(\n                        new Ui.Message({\n                            message:\n                                \"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.\",\n                            status: \"warning\",\n                            persistent: true,\n                            fade: false\n                        }).$el\n                    );\n                }\n            },\n\n            /** Render workflow parameters */\n            _renderParameters: function() {\n                var self = this;\n                this.wp_form = null;\n                if (!_.isEmpty(this.wp_inputs)) {\n                    this.wp_form = new Form({\n                        title: \"<b>Workflow Parameters</b>\",\n                        inputs: this.wp_inputs,\n                        cls: \"ui-portlet-narrow\",\n                        onchange: function() {\n                            _.each(self.wp_form.input_list, function(\n                                input_def,\n                                i\n                            ) {\n                                _.each(input_def.links, function(step) {\n                                    self._refreshStep(step);\n                                });\n                            });\n                        }\n                    });\n                    this._append(this.$steps.empty(), this.wp_form.$el);\n                }\n            },\n\n            /** Render workflow parameters */\n            _renderHistory: function() {\n                this.history_form = new Form({\n                    cls: \"ui-portlet-narrow\",\n                    title: \"<b>History Options</b>\",\n                    inputs: [\n                        {\n                            type: \"conditional\",\n                            name: \"new_history\",\n                            test_param: {\n                                name: \"check\",\n                                label: \"Send results to a new history\",\n                                type: \"boolean\",\n                                value: \"false\",\n                                help: \"\"\n                            },\n                            cases: [\n                                {\n                                    value: \"true\",\n                                    inputs: [\n                                        {\n                                            name: \"name\",\n                                            label: \"History name\",\n                                            type: \"text\",\n                                            value: this.model.get(\"name\")\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n                    ]\n                });\n                this._append(this.$steps, this.history_form.$el);\n            },\n\n            /** Render Workflow Options */\n            _renderWorkflowOptions: function() {\n                this.workflow_options_form = null;\n                if(!_.isEmpty(this.model.get('workflow_options'))){\n                    this.workflow_options_form = new Form({\n                        cls    : 'ui-portlet-narrow',\n                        title  : '<b>Workflow Options</b>',\n                        inputs : this.model.get('workflow_options')\n                    });\n\n                    this._append( this.$steps, this.workflow_options_form.$el );\n                }\n            },\n\n            /** Render step */\n            _renderStep: function(step) {\n                var self = this;\n                var form = null;\n                this.deferred.execute(function(promise) {\n                    self.$steps.addClass(\"ui-steps\");\n                    if (step.step_type == \"tool\") {\n                        step.postchange = function(process, form) {\n                            var self = this;\n                            var current_state = {\n                                tool_id: step.id,\n                                tool_version: step.version,\n                                inputs: $.extend(true, {}, form.data.create())\n                            };\n                            form.wait(true);\n                            Galaxy.emit.debug(\n                                \"tool-form-composite::postchange()\",\n                                \"Sending current state.\",\n                                current_state\n                            );\n                            Utils.request({\n                                type: \"POST\",\n                                url:\n                                    Galaxy.root +\n                                    \"api/tools/\" +\n                                    step.id +\n                                    \"/build\",\n                                data: current_state,\n                                success: function(data) {\n                                    form.update(data);\n                                    form.wait(false);\n                                    Galaxy.emit.debug(\n                                        \"tool-form-composite::postchange()\",\n                                        \"Received new model.\",\n                                        data\n                                    );\n                                    process.resolve();\n                                },\n                                error: function(response) {\n                                    Galaxy.emit.debug(\n                                        \"tool-form-composite::postchange()\",\n                                        \"Refresh request failed.\",\n                                        response\n                                    );\n                                    process.reject();\n                                }\n                            });\n                        };\n                        form = new ToolFormBase(step);\n                        if (\n                            step.post_job_actions &&\n                            step.post_job_actions.length\n                        ) {\n                            form.portlet.append(\n                                $(\"<div/>\")\n                                    .addClass(\"ui-form-element-disabled\")\n                                    .append(\n                                        $(\"<div/>\")\n                                            .addClass(\"ui-form-title\")\n                                            .html(\"<b>Job Post Actions</b>\")\n                                    )\n                                    .append(\n                                        $(\"<div/>\")\n                                            .addClass(\"ui-form-preview\")\n                                            .html(\n                                                _.reduce(\n                                                    step.post_job_actions,\n                                                    function(memo, value) {\n                                                        return (\n                                                            memo +\n                                                            \" \" +\n                                                            value.short_str\n                                                        );\n                                                    },\n                                                    \"\"\n                                                )\n                                            )\n                                    )\n                            );\n                        }\n                    } else {\n                        var is_simple_input =\n                            [\"data_input\", \"data_collection_input\"].indexOf(\n                                step.step_type\n                            ) != -1;\n                        _.each(step.inputs, function(input) {\n                            input.flavor = \"module\";\n                            input.hide_label = is_simple_input;\n                        });\n                        form = new Form(\n                            Utils.merge(\n                                {\n                                    title: step.fixed_title,\n                                    onchange: function() {\n                                        _.each(self.links[step.index], function(\n                                            link\n                                        ) {\n                                            self._refreshStep(link);\n                                        });\n                                    },\n                                    inputs:\n                                        step.inputs && step.inputs.length > 0\n                                            ? step.inputs\n                                            : [\n                                                  {\n                                                      type: \"hidden\",\n                                                      name:\n                                                          \"No options available.\",\n                                                      ignore: null\n                                                  }\n                                              ]\n                                },\n                                step\n                            )\n                        );\n                    }\n                    self.forms[step.index] = form;\n                    self._append(self.$steps, form.$el);\n                    self._refresh();\n                    step.needs_refresh && self._refreshStep(step);\n                    form.portlet[!self.show_progress ? \"enable\" : \"disable\"]();\n                    self.show_progress &&\n                        self.execute_btn.model.set({\n                            wait: true,\n                            wait_text: \"Preparing...\",\n                            percentage:\n                                (step.index + 1) * 100.0 / self.steps.length\n                        });\n                    Galaxy.emit.debug(\n                        \"tool-form-composite::initialize()\",\n                        step.index + \" : Workflow step state ready.\",\n                        step\n                    );\n                    setTimeout(function() {\n                        promise.resolve();\n                    }, 0);\n                });\n            },\n\n            /** Refreshes step values from source step values */\n            _refreshStep: function(step) {\n                var self = this;\n                var form = this.forms[step.index];\n                if (form) {\n                    _.each(self.parms[step.index], function(input, name) {\n                        if (input.step_linked || input.wp_linked) {\n                            var field = form.field_list[form.data.match(name)];\n                            if (field) {\n                                var new_value = undefined;\n                                if (input.step_linked) {\n                                    new_value = { values: [] };\n                                    _.each(input.step_linked, function(\n                                        source_step\n                                    ) {\n                                        if (self._isDataStep(source_step)) {\n                                            var value = self.forms[\n                                                source_step.index\n                                            ].data.create().input;\n                                            value &&\n                                                _.each(value.values, function(\n                                                    v\n                                                ) {\n                                                    new_value.values.push(v);\n                                                });\n                                        }\n                                    });\n                                    if (\n                                        !input.multiple &&\n                                        new_value.values.length > 0\n                                    ) {\n                                        new_value = {\n                                            values: [new_value.values[0]]\n                                        };\n                                    }\n                                } else if (input.wp_linked) {\n                                    new_value = input.value;\n                                    var re = /\\$\\{(.+?)\\}/g,\n                                        match;\n                                    while ((match = re.exec(input.value))) {\n                                        var wp_field =\n                                            self.wp_form.field_list[\n                                                self.wp_form.data.match(\n                                                    match[1]\n                                                )\n                                            ];\n                                        var wp_value =\n                                            wp_field && wp_field.value();\n                                        if (wp_value) {\n                                            new_value = new_value\n                                                .split(match[0])\n                                                .join(wp_value);\n                                        }\n                                    }\n                                }\n                                if (new_value !== undefined) {\n                                    field.value(new_value);\n                                }\n                            }\n                        }\n                    });\n                    form.trigger(\"change\");\n                } else {\n                    step.needs_refresh = true;\n                }\n            },\n\n            /** Refresh the history after job submission while form is shown */\n            _refreshHistory: function() {\n                var self = this;\n                var history =\n                    parent.Galaxy &&\n                    parent.Galaxy.currHistoryPanel &&\n                    parent.Galaxy.currHistoryPanel.model;\n                this._refresh_history && clearTimeout(this._refresh_history);\n                if (history) {\n                    history.refresh().success(function() {\n                        if (history.numOfUnfinishedShownContents() === 0) {\n                            self._refresh_history = setTimeout(function() {\n                                self._refreshHistory();\n                            }, history.UPDATE_DELAY);\n                        }\n                    });\n                }\n            },\n\n            /** Build remaining steps */\n            _execute: function() {\n                var self = this;\n                this.show_progress = true;\n                this._enabled(false);\n                this.deferred.execute(function(promise) {\n                    setTimeout(function() {\n                        promise.resolve();\n                        self._submit();\n                    }, 0);\n                });\n            },\n\n            /** Validate and submit workflow */\n            _submit: function() {\n                var self = this;\n                var history_form_data = this.history_form.data.create();\n                var job_def = {\n                    new_history_name: history_form_data[\"new_history|name\"]\n                        ? history_form_data[\"new_history|name\"]\n                        : null,\n                    history_id: !history_form_data[\"new_history|name\"]\n                        ? this.model.get(\"history_id\")\n                        : null,\n                    workflow_options: this.workflow_options_form\n                        ? this.workflow_options_form.data.create()\n                        : {},\n                    replacement_params: this.wp_form\n                        ? this.wp_form.data.create()\n                        : {},\n                    parameters: {},\n                    // Tool form will submit flat maps for each parameter\n                    // (e.g. \"repeat_0|cond|param\": \"foo\" instead of nested\n                    // data structures).\n                    parameters_normalized: true,\n                    // Tool form always wants a list of invocations back\n                    // so that inputs can be batched.\n                    batch: true\n                };\n                var validated = true;\n                for (var i in this.forms) {\n                    var form = this.forms[i];\n                    var job_inputs = form.data.create();\n                    var step = self.steps[i];\n                    var step_index = step.step_index;\n                    form.trigger(\"reset\");\n                    for (var job_input_id in job_inputs) {\n                        var input_value = job_inputs[job_input_id];\n                        var input_id = form.data.match(job_input_id);\n                        var input_field = form.field_list[input_id];\n                        var input_def = form.input_list[input_id];\n                        if (!input_def.step_linked) {\n                            if (this._isDataStep(step)) {\n                                validated =\n                                    input_value &&\n                                    input_value.values &&\n                                    input_value.values.length > 0;\n                            } else {\n                                validated =\n                                    input_def.optional ||\n                                    (input_def.is_workflow &&\n                                        input_value !== \"\") ||\n                                    (!input_def.is_workflow &&\n                                        input_value !== null);\n                            }\n                            if (!validated) {\n                                form.highlight(input_id);\n                                break;\n                            }\n                            job_def.parameters[step_index] =\n                                job_def.parameters[step_index] || {};\n                            job_def.parameters[step_index][job_input_id] =\n                                job_inputs[job_input_id];\n                        }\n                    }\n                    if (!validated) {\n                        break;\n                    }\n                }\n                if (!validated) {\n                    self._enabled(true);\n                    Galaxy.emit.debug(\n                        \"tool-form-composite::submit()\",\n                        \"Validation failed.\",\n                        job_def\n                    );\n                } else {\n                    Galaxy.emit.debug(\n                        \"tool-form-composite::submit()\",\n                        \"Validation complete.\",\n                        job_def\n                    );\n                    Utils.request({\n                        type: \"POST\",\n                        url:\n                            Galaxy.root +\n                            \"api/workflows/\" +\n                            this.model.id +\n                            \"/invocations\",\n                        data: job_def,\n                        success: function(response) {\n                            Galaxy.emit.debug(\n                                \"tool-form-composite::submit\",\n                                \"Submission successful.\",\n                                response\n                            );\n                            self.$el.children().hide();\n                            self.$el.append(self._templateSuccess(response));\n\n                            // Show Webhook if job is running\n                            if ($.isArray(response) && response.length > 0) {\n                                self.$el.append(\n                                    $(\"<div/>\", { id: \"webhook-view\" })\n                                );\n                                var WebhookApp = new Webhooks.WebhookView({\n                                    urlRoot:\n                                        Galaxy.root + \"api/webhooks/workflow\",\n                                    toolId: job_def.tool_id,\n                                    toolVersion: job_def.tool_version\n                                });\n                            }\n\n                            self._refreshHistory();\n                        },\n                        error: function(response) {\n                            Galaxy.emit.debug(\n                                \"tool-form-composite::submit\",\n                                \"Submission failed.\",\n                                response\n                            );\n                            var input_found = false;\n                            if (response && response.err_data) {\n                                for (var i in self.forms) {\n                                    var form = self.forms[i];\n                                    var step_related_errors =\n                                        response.err_data[\n                                            form.model.get(\"step_index\")\n                                        ];\n                                    if (step_related_errors) {\n                                        var error_messages = form.data.matchResponse(\n                                            step_related_errors\n                                        );\n                                        for (var input_id in error_messages) {\n                                            form.highlight(\n                                                input_id,\n                                                error_messages[input_id]\n                                            );\n                                            input_found = true;\n                                            break;\n                                        }\n                                    }\n                                }\n                            }\n                            if (!input_found) {\n                                self.modal.show({\n                                    title: \"Workflow submission failed\",\n                                    body: self._templateError(\n                                        job_def,\n                                        response && response.err_msg\n                                    ),\n                                    buttons: {\n                                        Close: function() {\n                                            self.modal.hide();\n                                        }\n                                    }\n                                });\n                            }\n                        },\n                        complete: function() {\n                            self._enabled(true);\n                        }\n                    });\n                }\n            },\n\n            /** Append new dom to body */\n            _append: function($container, $el) {\n                $container.append(\"<p/>\").append($el);\n            },\n\n            /** Set enabled/disabled state */\n            _enabled: function(enabled) {\n                this.execute_btn.model.set({\n                    wait: !enabled,\n                    wait_text: \"Sending...\",\n                    percentage: -1\n                });\n                this.wp_form &&\n                    this.wp_form.portlet[enabled ? \"enable\" : \"disable\"]();\n                this.history_form &&\n                    this.history_form.portlet[enabled ? \"enable\" : \"disable\"]();\n                _.each(this.forms, function(form) {\n                    form && form.portlet[enabled ? \"enable\" : \"disable\"]();\n                });\n            },\n\n            /** Is data input module/step */\n            _isDataStep: function(steps) {\n                var lst = $.isArray(steps) ? steps : [steps];\n                for (var i = 0; i < lst.length; i++) {\n                    var step = lst[i];\n                    if (\n                        !step ||\n                        !step.step_type ||\n                        !step.step_type.startsWith(\"data\")\n                    ) {\n                        return false;\n                    }\n                }\n                return true;\n            },\n\n            /** Templates */\n            _templateSuccess: function(response) {\n                if ($.isArray(response) && response.length > 0) {\n                    return $(\"<div/>\")\n                        .addClass(\"donemessagelarge\")\n                        .append(\n                            $(\"<p/>\").html(\n                                \"Successfully invoked workflow <b>\" +\n                                    Utils.sanitize(this.model.get(\"name\")) +\n                                    \"</b>\" +\n                                    (response.length > 1\n                                        ? \" <b>\" +\n                                          response.length +\n                                          \" times</b>\"\n                                        : \"\") +\n                                    \".\"\n                            )\n                        )\n                        .append(\n                            $(\"<p/>\")\n                                .append(\"<b/>\")\n                                .text(\n                                    \"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"\n                                )\n                        );\n                } else {\n                    return this._templateError(\n                        response,\n                        \"Invalid success response. No invocations found.\"\n                    );\n                }\n            },\n\n            _templateError: function(response, err_msg) {\n                return $(\"<div/>\")\n                    .addClass(\"errormessagelarge\")\n                    .append(\n                        $(\"<p/>\").text(\n                            \"The server could not complete the request. Please contact the Galaxy Team if this error persists. \" +\n                                (JSON.stringify(err_msg) || \"\")\n                        )\n                    )\n                    .append(\n                        $(\"<pre/>\").text(JSON.stringify(response, null, 4))\n                    );\n            }\n        });\n        return {\n            View: View\n        };\n    }\n);\n"]}