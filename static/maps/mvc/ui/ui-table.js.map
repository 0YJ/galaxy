{"version":3,"sources":["mvc/ui/ui-table.js"],"names":["define","Utils","View","Backbone","extend","row","row_count","optionsDefault","content","onchange","ondblclick","onconfirm","events","click","initialize","options","merge","$el","$","this","_template","$thead","find","$tbody","$tmessage","setElement","_row","addHeader","wrapper","appendHeader","add","width","align","css","append","id","fade","_commit","prepend","get","del","item","length","delAll","empty","_refresh","value","new_value","attr","undefined","removeClass","addClass","after","before","size","hide","fadeIn","cls_tr","_onclick","e","target","closest","old_value","_ondblclick","show","cls"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-table.js","sourcesContent":["// dependencies\ndefine(['utils/utils'], function(Utils) {\n\n/**\n *  This class creates a ui table element.\n */\nvar View = Backbone.View.extend({\n    // current row\n    row: null,\n    \n    // count rows\n    row_count: 0,\n    \n    // defaults options\n    optionsDefault: {\n        content     : 'No content available.',\n        onchange    : null,\n        ondblclick  : null,\n        onconfirm   : null,\n        cls         : 'ui-table',\n        cls_tr      : ''\n    },\n    \n    // events\n    events : {\n        'click'     : '_onclick',\n        'dblclick'  : '_ondblclick'\n    },\n    \n    // initialize\n    initialize : function(options) {\n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n        \n        // create new element\n        var $el = $(this._template(this.options));\n        \n        // link sub-elements\n        this.$thead = $el.find('thead');\n        this.$tbody = $el.find('tbody');\n        this.$tmessage = $el.find('tmessage');\n        \n        // set element\n        this.setElement($el);\n                \n        // initialize row\n        this.row = this._row();\n    },\n    \n    // add header cell\n    addHeader: function($el) {\n        var wrapper = $('<th></th>');\n        wrapper.append($el);\n        this.row.append(wrapper);\n    },\n    \n    // header\n    appendHeader: function() {\n        // append header row\n        this.$thead.append(this.row);\n\n        // row\n        this.row = $('<tr></tr>');\n    },\n    \n    // add row cell\n    add: function($el, width, align) {\n        var wrapper = $('<td></td>');\n        if (width) {\n            wrapper.css('width', width);\n        }\n        if (align) {\n            wrapper.css('text-align', align);\n        }\n        wrapper.append($el);\n        this.row.append(wrapper);\n    },\n    \n    // append\n    append: function(id, fade) {\n        this._commit(id, fade, false);\n    },\n    \n    // prepend\n    prepend: function(id, fade) {\n        this._commit(id, fade, true);\n    },\n    \n    // get element\n    get: function(id) {\n        return this.$el.find('#' + id);\n    },\n    \n    // delete\n    del: function(id) {\n        var item = this.$tbody.find('#' + id);\n        if (item.length > 0) {\n            item.remove();\n            this.row_count--;\n            this._refresh();\n        }\n    },\n\n    // delete all\n    delAll: function() {\n        this.$tbody.empty();\n        this.row_count = 0;\n        this._refresh();\n    },\n        \n    // value\n    value: function(new_value) {\n        // get current id/value\n        this.before = this.$tbody.find('.current').attr('id');\n        \n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this.$tbody.find('tr').removeClass('current');\n            if (new_value) {\n                this.$tbody.find('#' + new_value).addClass('current');\n            }\n        }\n        \n        // get current id/value\n        var after = this.$tbody.find('.current').attr('id');\n        if(after === undefined) {\n            return null;\n        } else {\n            // fire onchange\n            if (after != this.before && this.options.onchange) {\n                this.options.onchange(new_value);\n            }\n            \n            // return current value\n            return after;\n        }\n    },\n    \n    // size\n    size: function() {\n        return this.$tbody.find('tr').length;\n    },\n    \n    // commit\n    _commit: function(id, fade, prepend) {\n        // remove previous item with same id\n        this.del(id);\n        \n        // add\n        this.row.attr('id', id);\n        \n        // add row\n        if (prepend) {\n            this.$tbody.prepend(this.row);\n        } else {\n            this.$tbody.append(this.row);\n        }\n        \n        // fade mode\n        if (fade) {\n            this.row.hide();\n            this.row.fadeIn();\n        }\n        \n        // row\n        this.row = this._row();\n        \n        // row count\n        this.row_count++;\n        this._refresh();\n    },\n    \n    // create new row\n    _row: function() {\n        return $('<tr class=\"' + this.options.cls_tr + '\"></tr>');\n    },\n    \n    // onclick\n    _onclick: function(e) {\n        // get values\n        var old_value = this.value();\n        var new_value = $(e.target).closest('tr').attr('id');\n        if (new_value != ''){\n            // check equality\n            if (new_value && old_value != new_value) {\n                if (this.options.onconfirm) {\n                    this.options.onconfirm(new_value);\n                } else {\n                    this.value(new_value);\n                }\n            }\n        }\n    },\n\n    // ondblclick\n    _ondblclick: function(e) {\n        var value = this.value();\n        if (value && this.options.ondblclick) {\n            this.options.ondblclick(value);\n        }\n    },\n        \n    // refresh\n    _refresh: function() {\n        if (this.row_count == 0) {\n            this.$tmessage.show();\n        } else {\n            this.$tmessage.hide();\n        }\n    },\n        \n    // load html template\n    _template: function(options) {\n        return  '<div>' +\n                    '<table class=\"' + options.cls + '\">' +\n                        '<thead></thead>' +\n                        '<tbody></tbody>' +\n                    '</table>' +\n                    '<tmessage>' + options.content + '</tmessage>' +\n                '<div>';\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n"]}