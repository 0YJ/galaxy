{"version":3,"sources":["mvc/ui/ui-select-default.js"],"names":["define","Utils","Buttons","View","Backbone","extend","options","initialize","this","data2","model","Model","id","uid","cls","error_text","empty_text","visible","wait","multiple","searchable","optional","disabled","onchange","value","selectall","pagesize","self","get","listenTo","_changeData","_changeDisabled","_changeVisible","_changeValue","render","_renderSearchable","_renderClassic","$el","addClass","attr","$select","empty","_getValue","trigger","_changeWait","append","$","$dropdown","$resize_icon","$resize","removeClass","currentY","currentHeight","minHeight","show","on","off","event","pageY","height","hide","Math","max","all_button","onclick","new_value","select2","each","ButtonCheck","_","option","push","term","prepend","_match","data","text","label","toUpperCase","index","length","matched_tags","closeOnSelect","query","order","q","tags","found","results","filter","e","callback","tag","more","page","result","slice","formatResult","escape","find","remove","memo","prop","html","_setValue","first","isArray","exists","undefined","set","findWhere","d","v","unwait","keep","enable","disable","add","sorter","update","val","selected","sort","a","b","isEmpty"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-select-default.js","sourcesContent":["/**\n *  This class creates/wraps a default html select field as backbone class.\n */\ndefine([ 'utils/utils', 'mvc/ui/ui-buttons' ], function( Utils, Buttons ) {\nvar View = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.data  = [];\n        this.data2 = [];\n        this.model = options && options.model || new Backbone.Model({\n            id          : Utils.uid(),\n            cls         : 'ui-select',\n            error_text  : 'No options available',\n            empty_text  : 'Nothing selected',\n            visible     : true,\n            wait        : false,\n            multiple    : false,\n            searchable  : true,\n            optional    : false,\n            disabled    : false,\n            onchange    : function(){},\n            value       : null,\n            selectall   : true,\n            pagesize    : 20\n        }).set( options );\n        this.on( 'change', function() { self.model.get( 'onchange' ) && self.model.get( 'onchange' )( self.value() ) } );\n        this.listenTo( this.model, 'change:data', this._changeData, this );\n        this.listenTo( this.model, 'change:disabled', this._changeDisabled, this );\n        this.listenTo( this.model, 'change:wait', this._changeWait, this );\n        this.listenTo( this.model, 'change:visible', this._changeVisible, this );\n        this.listenTo( this.model, 'change:value', this._changeValue, this );\n        this.listenTo( this.model, 'change:multiple change:searchable change:cls change:id', this.render, this );\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        this.model.get( 'searchable' ) ? this._renderSearchable() : this._renderClassic();\n        this.$el.addClass( this.model.get( 'cls' ) )\n                .attr( 'id', this.model.get( 'id' ) );\n        this.$select.empty().addClass( 'select' )\n                    .attr( 'id', this.model.get( 'id' ) + '_select' )\n                    .prop( 'multiple', this.model.get( 'multiple' ) )\n                    .on( 'change', function() {\n                        self.value( self._getValue() );\n                        self.trigger( 'change' );\n                    });\n        this._changeData();\n        this._changeWait();\n        this._changeVisible();\n        this._changeDisabled();\n    },\n\n    /** Renders the classic selection field */\n    _renderClassic: function() {\n        var self = this;\n        this.$el.addClass( this.model.get( 'multiple' ) ? 'ui-select-multiple' : 'ui-select' )\n                .append( this.$select      = $( '<select/>' ) )\n                .append( this.$dropdown    = $( '<div/>' ) )\n                .append( this.$resize      = $( '<div/>' )\n                .append( this.$resize_icon = $( '<i/>' ) ) );\n        if ( this.model.get( 'multiple' ) ) {\n            this.$dropdown.hide();\n            this.$resize_icon.addClass( 'fa fa-angle-double-right fa-rotate-45' ).show();\n            this.$resize.removeClass()\n                        .addClass( 'icon-resize' )\n                        .show()\n                        .off( 'mousedown' ).on( 'mousedown', function( event ) {\n                            var currentY = event.pageY;\n                            var currentHeight = self.$select.height();\n                            self.minHeight = self.minHeight || currentHeight;\n                            $( '#dd-helper' ).show().on( 'mousemove', function( event ) {\n                                self.$select.height( Math.max( currentHeight + ( event.pageY - currentY ), self.minHeight ) );\n                            }).on( 'mouseup mouseleave', function() {\n                                $( '#dd-helper' ).hide().off();\n                            });\n                        });\n        } else {\n            this.$dropdown.show();\n            this.$resize.hide();\n            this.$resize_icon.hide();\n        }\n    },\n\n    /** Renders the default select2 field */\n    _renderSearchable: function() {\n        var self = this;\n        this.$el.append( this.$select   = $( '<div/>' ) )\n                .append( this.$dropdown = $( '<div/>' ) );\n        this.$dropdown.hide();\n        if ( !this.model.get( 'multiple' ) ) {\n            this.$dropdown.show().on( 'click', function() {\n                self.$select.select2 && self.$select.select2( 'open' );\n            });\n        }\n        this.all_button = null;\n        if ( this.model.get( 'multiple' ) && this.model.get( 'selectall' ) ) {\n            this.all_button = new Buttons.ButtonCheck({\n                onclick: function() {\n                    var new_value = [];\n                    self.all_button.value() !== 0 && _.each( self.model.get( 'data' ), function( option ) {\n                        new_value.push( option.value );\n                    });\n                    self.value( new_value );\n                    self.trigger( 'change' );\n                }\n            });\n            this.$el.prepend( this.all_button.$el );\n        }\n    },\n\n    /** Matches a search term with a given text */\n    _match: function( term, text ) {\n        return !term || term == '' || String( text ).toUpperCase().indexOf( term.toUpperCase() ) >= 0\n    },\n\n    /** Updates the selection options */\n    _changeData: function() {\n        var self = this;\n        this.data = [];\n        if ( !this.model.get( 'multiple' ) && this.model.get( 'optional' ) ) {\n            this.data.push( { value: '__null__', label: self.model.get( 'empty_text' ) } );\n        }\n        _.each( this.model.get( 'data' ), function( option ) {\n            self.data.push( option );\n        });\n        if ( this.length() == 0 ) {\n            this.data.push( { value: '__null__', label: this.model.get( 'error_text' ) } );\n        }\n        if ( this.model.get( 'searchable' ) ) {\n            this.data2 = [];\n            _.each( this.data, function( option, index ) {\n                self.data2.push( { order: index, id: option.value, text: option.label, tags: option.tags } );\n            });\n            this.$select.data( 'select2' ) && this.$select.select2( 'destroy' );\n            this.matched_tags = {};\n            this.$select.select2({\n                data            : self.data2,\n                closeOnSelect   : !this.model.get( 'multiple' ),\n                multiple        : this.model.get( 'multiple' ),\n                query           : function( q ) {\n                    self.matched_tags = {};\n                    var pagesize = self.model.get( 'pagesize' );\n                    var results = _.filter( self.data2, function ( e ) {\n                        var found = false;\n                        _.each( e.tags, function( tag ) {\n                            if ( self._match( q.term, tag ) ) {\n                                found = self.matched_tags[ tag ] = true;\n                            }\n                        });\n                        return found || self._match( q.term, e.text );\n                    });\n                    q.callback({\n                        results: results.slice( ( q.page - 1 ) * pagesize, q.page * pagesize ),\n                        more   : results.length >= q.page * pagesize\n                    });\n                },\n                formatResult    : function( result ) {\n                    return _.escape( result.text ) +\n                        '<div class=\"ui-tags\">' +\n                            _.reduce( result.tags, function( memo, tag ) {\n                                if ( self.matched_tags[ tag ] ) {\n                                    return memo + '&nbsp;' +\n                                        '<div class=\"label label-info\">' +\n                                            _.escape( tag ) +\n                                        '</div>'\n                                }\n                                return memo;\n                            }, '' ) +\n                        '</div>';\n                }\n            });\n            this.$( '.select2-container .select2-search input' ).off( 'blur' );\n        } else {\n            this.$select.find( 'option' ).remove();\n            _.each( this.data, function( option ) {\n                self.$select.append( $( '<option/>' ).attr( 'value', option.value ).html( _.escape( option.label ) ) );\n            });\n        }\n        this.model.set( 'disabled', this.length() == 0 );\n        this._changeValue();\n    },\n\n    /** Handles field enabling/disabling, usually used when no options are available */\n    _changeDisabled: function() {\n        if ( this.model.get( 'searchable' ) ) {\n            this.$select.select2( this.model.get( 'disabled' ) ? 'disable' : 'enable' );\n        } else {\n            this.$select.prop( 'disabled', this.model.get( 'disabled' ) );\n        }\n    },\n\n    /** Searchable fields may display a spinner e.g. while waiting for a server response */\n    _changeWait: function() {\n        this.$dropdown.removeClass()\n                      .addClass( 'icon-dropdown fa' )\n                      .addClass( this.model.get( 'wait' ) ? 'fa-spinner fa-spin' : 'fa-caret-down' );\n    },\n\n    /** Handles field visibility */\n    _changeVisible: function() {\n        this.$el[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n        this.$select[ this.model.get( 'visible' ) ? 'show' : 'hide' ]();\n    },\n\n    /** Synchronizes the model value with the actually selected field value */\n    _changeValue: function() {\n        this._setValue( this.model.get( 'value' ) );\n        if ( this.model.get( 'multiple' ) ) {\n            if ( this.all_button ) {\n                var value = this._getValue();\n                this.all_button.value( $.isArray( value ) ? value.length : 0, this.length() );\n            }\n        } else if ( this._getValue() === null && !this.model.get( 'optional' ) ) {\n            this._setValue( this.first() );\n        }\n    },\n\n    /** Return/Set current selection */\n    value: function ( new_value ) {\n        new_value !== undefined && this.model.set( 'value', new_value );\n        return this._getValue();\n    },\n\n    /** Return the first select option */\n    first: function() {\n        return this.data.length > 0 ? this.data[ 0 ].value : null;\n    },\n\n    /** Check if a value is an existing option */\n    exists: function( value ) {\n        return _.findWhere( this.data, { value: value } );\n    },\n\n    /** Return the label/text of the current selection */\n    text: function () {\n        var v = this._getValue();\n        var d = this.exists( $.isArray( v ) ? v[ 0 ] : v );\n        return d ? d.label : '';\n    },\n\n    /** Show the select field */\n    show: function() {\n        this.model.set( 'visible', true );\n    },\n\n    /** Hide the select field */\n    hide: function() {\n        this.model.set( 'visible', false );\n    },\n\n    /** Show a spinner indicating that the select options are currently loaded */\n    wait: function() {\n        this.model.set( 'wait', true );\n    },\n\n    /** Hide spinner indicating that the request has been completed */\n    unwait: function() {\n        this.model.set( 'wait', false );\n    },\n\n    /** Returns true if the field is disabled */\n    disabled: function() {\n        return this.model.get( 'disabled' );\n    },\n\n    /** Enable the select field */\n    enable: function() {\n        this.model.set( 'disabled', false );\n    },\n\n    /** Disable the select field */\n    disable: function() {\n        this.model.set( 'disabled', true );\n    },\n\n    /** Update all available options at once */\n    add: function( options, sorter ) {\n        _.each( this.model.get( 'data' ), function( v ) {\n            v.keep && !_.findWhere( options, { value: v.value } ) && options.push( v );\n        });\n        sorter && options && options.sort( sorter );\n        this.model.set( 'data', options );\n    },\n\n    /** Update available options */\n    update: function( options ) {\n        this.model.set( 'data', options );\n    },\n\n    /** Set the custom onchange callback function */\n    setOnChange: function( callback ) {\n        this.model.set( 'onchange', callback );\n    },\n\n    /** Number of available options */\n    length: function() {\n        return $.isArray( this.model.get( 'data' ) ) ? this.model.get( 'data' ).length : 0;\n    },\n\n    /** Set value to dom */\n    _setValue: function( new_value ) {\n        var self = this;\n        if( new_value === null || new_value === undefined ) {\n            new_value = '__null__';\n        }\n        if ( this.model.get( 'multiple' ) ) {\n            new_value = $.isArray( new_value ) ? new_value : [ new_value ];\n        } else if ( $.isArray( new_value ) ) {\n            if ( new_value.length > 0 ) {\n                new_value = new_value[ 0 ];\n            } else {\n                new_value = '__null__';\n            }\n        }\n        if ( this.model.get( 'searchable' ) ) {\n            if ( $.isArray( new_value ) ) {\n                val = [];\n                _.each( new_value, function( v ) {\n                    var d = _.findWhere( self.data2, { id: v } );\n                    d && val.push( d );\n                });\n                new_value = val;\n            } else {\n                var d = _.findWhere( this.data2, { id: new_value } );\n                new_value = d;\n            }\n            this.$select.select2( 'data', new_value );\n        } else {\n            this.$select.val( new_value );\n        }\n    },\n\n    /** Get value from dom */\n    _getValue: function() {\n        var val = null;\n        if ( this.model.get( 'searchable' ) ) {\n            var selected = this.$select.select2( 'data' );\n            if ( selected ) {\n                if ( $.isArray( selected ) ) {\n                    val = [];\n                    selected.sort( function( a, b ) { return a.order - b.order } );\n                    _.each( selected, function( v ) { val.push( v.id ) } );\n                } else {\n                    val = selected.id;\n                }\n            }\n        } else {\n            val = this.$select.val();\n        }\n        return Utils.isEmpty( val ) ? null : val;\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n"]}