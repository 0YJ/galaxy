{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["define","Utils","Ui","Tabs","View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","Model","collection","Collection","get","tabs","setElement","$el","addClass","render","listenTo","first","delAll","_renderDefault","_renderList","self","$","each","indexOf","title","append","_templateThumbnailItem","id","length","substr","title_icon","image_src","tooltip","placement","children","add","uid","_templateRegularItem","attributes","value","new_value","undefined","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\ndefine( [ 'utils/utils', 'mvc/ui/ui-misc', 'mvc/ui/ui-tabs' ], function( Utils, Ui, Tabs ) {\n    var View = Backbone.View.extend({\n        events : {\n            'click .ui-thumbnails-item'    : '_onclick',\n            'dblclick .ui-thumbnails-item' : '_ondblclick'\n        },\n\n        initialize : function( options ) {\n            this.model = options.model || new Backbone.Model( options );\n            this.collection = new Backbone.Collection( this.model.get( 'collection' ) );\n            this.tabs = new Tabs.View({});\n            this.setElement( this.tabs.$el.addClass( 'ui-thumbnails' ) );\n            this.render();\n            this.listenTo( this.model, 'change', this.render, this );\n            this.listenTo( this.collection, 'reset change add remove', this.render, this );\n        },\n\n        render: function() {\n            this.first = null;\n            this.tabs.delAll();\n            this._renderDefault();\n            this._renderList();\n        },\n\n        _renderDefault: function() {\n            var self = this;\n            var index = [];\n            var title_length = 20;\n            var $el = $( '<div/>' ).addClass( 'ui-thumbnails-grid' );\n            this.collection.each( function( model ) {\n                if ( model.get( 'keywords' ).indexOf( 'default' ) !== -1 ) {\n                    var title = model.get( 'title' );\n                    $el.append( $( self._templateThumbnailItem( {\n                        id          : model.id,\n                        title       : title.length < title_length ? title : title.substr( 0, title_length ) + '...',\n                        title_icon  : model.get( 'title_icon' ),\n                        image_src   : model.get( 'image_src' )\n                    })).tooltip( { title: model.get( 'description' ), placement: 'bottom' } ) );\n                }\n            });\n            if ( $el.children().length > 0 ) {\n                this.tabs.add( { id: Utils.uid(), title: self.model.get( 'title_default' ), $el: $el } );\n            }\n        },\n\n        _renderList: function() {\n            var self = this;\n            if ( this.collection.length > 0 ) {\n                this.first = this.first || this.collection.first().id;\n                var $el = $( '<div/>' ).addClass( 'ui-thumbnails-grid' );\n                this.collection.each( function( model ) {\n                    $el.append( self._templateRegularItem( model.attributes ) );\n                });\n                this.tabs.add( { id: Utils.uid(), title: self.model.get( 'title_list' ), $el: $el } );\n            }\n        },\n\n        /** Set/Get value */\n        value: function( new_value ) {\n            if ( new_value !== undefined ) {\n                new_value = new_value == '__first' ? this.first : new_value;\n                var before = this.$( '.ui-thumbnail-current' ).attr( 'value' );\n                this.$( '.ui-thumbnail-current' ).removeClass( 'ui-thumbnail-current' );\n                this.$( '[value=\"' + new_value + '\"]' ).addClass( 'ui-thumbnail-current' );\n                var after = this.$( '.ui-thumbnail-current' ).attr( 'value' );\n                var change_handler = this.model.get( 'onchange' );\n                after != before && change_handler && change_handler( after );\n            }\n            return this.$( '.ui-thumbnail-current' ).attr( 'value' );\n        },\n\n        /** Add click handler */\n        _onclick: function( e ) {\n            this.value( $( e.target ).closest( '.ui-thumbnails-item' ).attr( 'value' ) );\n        },\n\n        /** Add double click handler */\n        _ondblclick: function( e ) {\n            this.model.get( 'ondblclick' ) && this.model.get( 'ondblclick' )( this.value() );\n        },\n\n        /* Thumbnail template with image */\n        _templateThumbnailItem: function( options ) {\n            return  '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' + options.id + '\">' +\n                        '<img class=\"ui-thumbnails-image\" src=\"' + options.image_src + '\">' +\n                        '<div class=\"ui-thumbnails-title ui-form-info\">' +\n                            '<span class=\"fa ' + options.title_icon + '\"/>' + options.title +\n                        '</div>' +\n                    '<div>';\n        },\n\n        /* Thumbnail template with image and description */\n        _templateRegularItem: function( options ) {\n            return  '<div class=\"ui-thumbnails-item\" value=\"' + options.id + '\">' +\n                        '<table>' +\n                            '<tr>' +\n                                '<td>' +\n                                    '<img class=\"ui-thumbnails-image\" src=\"' + options.image_src + '\">' +\n                                '</td>' +\n                                '<td>' +\n                                    '<div class=\"ui-thumbnails-description-title ui-form-info\">' + options.title + '</div>' +\n                                    '<div class=\"ui-thumbnails-description-text ui-form-info\">' + options.description + '</div>' +\n                                '</td>' +\n                            '</tr>' +\n                    '<div>';\n        }\n    });\n\n    return { View: View }\n});"]}