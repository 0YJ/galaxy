{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["define","Utils","Ui","View","events","extend","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","collection","Backbone","Collection","Tabs","setElement","tabs","listenTo","render","first","_renderDefault","index","title_length","_renderList","$el","id","image_src","tooltip","title","get","placement","append","$","self","_templateThumbnailItem","length","add","uid","title_icon","_templateRegularItem","value","new_value","undefined","before","removeClass","attributes","after","change_handler","attr","_ondblclick","addClass","_onclick","e","target","closest","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\ndefine([\"utils/utils\", \"mvc/ui/ui-misc\", \"mvc/ui/ui-tabs\"], function(\n    Utils,\n    Ui,\n    Tabs\n) {\n    var View = Backbone.View.extend({\n        events: {\n            \"click .ui-thumbnails-item\": \"_onclick\",\n            \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n        },\n\n        initialize: function(options) {\n            this.model = options.model || new Backbone.Model(options);\n            this.collection = new Backbone.Collection(\n                this.model.get(\"collection\")\n            );\n            this.tabs = new Tabs.View({});\n            this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n            this.render();\n            this.listenTo(this.model, \"change\", this.render, this);\n            this.listenTo(\n                this.collection,\n                \"reset change add remove\",\n                this.render,\n                this\n            );\n        },\n\n        render: function() {\n            this.first = null;\n            this.tabs.delAll();\n            this._renderDefault();\n            this._renderList();\n        },\n\n        _renderDefault: function() {\n            var self = this;\n            var index = [];\n            var title_length = 20;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(function(model) {\n                if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                    var title = model.get(\"title\");\n                    $el.append(\n                        $(\n                            self._templateThumbnailItem({\n                                id: model.id,\n                                title:\n                                    title.length < title_length\n                                        ? title\n                                        : title.substr(0, title_length) + \"...\",\n                                title_icon: model.get(\"title_icon\"),\n                                image_src: model.get(\"image_src\")\n                            })\n                        ).tooltip({\n                            title: model.get(\"description\"),\n                            placement: \"bottom\"\n                        })\n                    );\n                }\n            });\n            if ($el.children().length > 0) {\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_default\"),\n                    $el: $el\n                });\n            }\n        },\n\n        _renderList: function() {\n            var self = this;\n            if (this.collection.length > 0) {\n                this.first = this.first || this.collection.first().id;\n                var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n                this.collection.each(function(model) {\n                    $el.append(self._templateRegularItem(model.attributes));\n                });\n                this.tabs.add({\n                    id: Utils.uid(),\n                    title: self.model.get(\"title_list\"),\n                    $el: $el\n                });\n            }\n        },\n\n        /** Set/Get value */\n        value: function(new_value) {\n            if (new_value !== undefined) {\n                new_value = new_value == \"__first\" ? this.first : new_value;\n                var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                this.$(\".ui-thumbnail-current\").removeClass(\n                    \"ui-thumbnail-current\"\n                );\n                this.$('[value=\"' + new_value + '\"]').addClass(\n                    \"ui-thumbnail-current\"\n                );\n                var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n                var change_handler = this.model.get(\"onchange\");\n                after != before && change_handler && change_handler(after);\n            }\n            return this.$(\".ui-thumbnail-current\").attr(\"value\");\n        },\n\n        /** Add click handler */\n        _onclick: function(e) {\n            this.value(\n                $(e.target)\n                    .closest(\".ui-thumbnails-item\")\n                    .attr(\"value\")\n            );\n        },\n\n        /** Add double click handler */\n        _ondblclick: function(e) {\n            this.model.get(\"ondblclick\") &&\n                this.model.get(\"ondblclick\")(this.value());\n        },\n\n        /* Thumbnail template with image */\n        _templateThumbnailItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' +\n                options.id +\n                '\">' +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                '<div class=\"ui-thumbnails-title ui-form-info\">' +\n                '<span class=\"fa ' +\n                options.title_icon +\n                '\"/>' +\n                options.title +\n                \"</div>\" +\n                \"<div>\"\n            );\n        },\n\n        /* Thumbnail template with image and description */\n        _templateRegularItem: function(options) {\n            return (\n                '<div class=\"ui-thumbnails-item\" value=\"' +\n                options.id +\n                '\">' +\n                \"<table>\" +\n                \"<tr>\" +\n                \"<td>\" +\n                '<img class=\"ui-thumbnails-image\" src=\"' +\n                options.image_src +\n                '\">' +\n                \"</td>\" +\n                \"<td>\" +\n                '<div class=\"ui-thumbnails-description-title ui-form-info\">' +\n                options.title +\n                \"</div>\" +\n                '<div class=\"ui-thumbnails-description-text ui-form-info\">' +\n                options.description +\n                \"</div>\" +\n                \"</td>\" +\n                \"</tr>\" +\n                \"<div>\"\n            );\n        }\n    });\n\n    return { View: View };\n});\n"]}