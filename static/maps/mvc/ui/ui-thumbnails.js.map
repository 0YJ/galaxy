{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","Model","collection","Collection","get","tabs","_uiTabs2","default","setElement","$el","addClass","render","listenTo","first","_renderDefault","_renderList","self","delAll","indexOf","append","$","_templateThumbnailItem","id","title","length","title_icon","children","add","_utils2","uid","_templateRegularItem","value","new_value","undefined","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","image_src","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nvar View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(\n            this.collection,\n            \"reset change add remove\",\n            this.render,\n            this\n        );\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderDefault();\n        this._renderList();\n    },\n\n    _renderDefault: function() {\n        var self = this;\n        var index = [];\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(function(model) {\n            if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        self._templateThumbnailItem({\n                            id: model.id,\n                            title:\n                                title.length < title_length\n                                    ? title\n                                    : title.substr(0, title_length) + \"...\",\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(function(model) {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$('[value=\"' + new_value + '\"]').addClass(\n                \"ui-thumbnail-current\"\n            );\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            after != before && change_handler && change_handler(after);\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n    },\n\n    /** Add double click handler */\n    _ondblclick: function(e) {\n        this.model.get(\"ondblclick\") &&\n            this.model.get(\"ondblclick\")(this.value());\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return (\n            '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' +\n            options.id +\n            '\">' +\n            '<img class=\"ui-thumbnails-image\" src=\"' +\n            options.image_src +\n            '\">' +\n            '<div class=\"ui-thumbnails-title ui-form-info\">' +\n            '<span class=\"fa ' +\n            options.title_icon +\n            '\"/>' +\n            options.title +\n            \"</div>\" +\n            \"<div>\"\n        );\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return (\n            '<div class=\"ui-thumbnails-item\" value=\"' +\n            options.id +\n            '\">' +\n            \"<table>\" +\n            \"<tr>\" +\n            \"<td>\" +\n            '<img class=\"ui-thumbnails-image\" src=\"' +\n            options.image_src +\n            '\">' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"ui-thumbnails-description-title ui-form-info\">' +\n            options.title +\n            \"</div>\" +\n            '<div class=\"ui-thumbnails-description-text ui-form-info\">' +\n            options.description +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\" +\n            \"<div>\"\n        );\n    }\n});\n\nexport default { View: View };\n"]}