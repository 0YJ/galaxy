{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","Model","collection","Collection","get","tabs","_uiTabs2","default","setElement","$el","addClass","render","listenTo","first","_renderDefault","_renderList","self","delAll","indexOf","append","$","_templateThumbnailItem","id","title","length","substr","title_icon","children","add","_utils2","uid","_templateRegularItem","value","new_value","undefined","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","image_src","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nvar View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(\n            this.collection,\n            \"reset change add remove\",\n            this.render,\n            this\n        );\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderDefault();\n        this._renderList();\n    },\n\n    _renderDefault: function() {\n        var self = this;\n        var index = [];\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(model => {\n            if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        self._templateThumbnailItem({\n                            id: model.id,\n                            title:\n                                title.length < title_length\n                                    ? title\n                                    : title.substr(0, title_length) + \"...\",\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(model => {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$('[value=\"' + new_value + '\"]').addClass(\n                \"ui-thumbnail-current\"\n            );\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            after != before && change_handler && change_handler(after);\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n    },\n\n    /** Add double click handler */\n    _ondblclick: function(e) {\n        this.model.get(\"ondblclick\") &&\n            this.model.get(\"ondblclick\")(this.value());\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return (\n            '<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"' +\n            options.id +\n            '\">' +\n            '<img class=\"ui-thumbnails-image\" src=\"' +\n            options.image_src +\n            '\">' +\n            '<div class=\"ui-thumbnails-title ui-form-info\">' +\n            '<span class=\"fa ' +\n            options.title_icon +\n            '\"/>' +\n            options.title +\n            \"</div>\" +\n            \"<div>\"\n        );\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return (\n            '<div class=\"ui-thumbnails-item\" value=\"' +\n            options.id +\n            '\">' +\n            \"<table>\" +\n            \"<tr>\" +\n            \"<td>\" +\n            '<img class=\"ui-thumbnails-image\" src=\"' +\n            options.image_src +\n            '\">' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"ui-thumbnails-description-title ui-form-info\">' +\n            options.title +\n            \"</div>\" +\n            '<div class=\"ui-thumbnails-description-text ui-form-info\">' +\n            options.description +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\" +\n            \"<div>\"\n        );\n    }\n});\n\nexport default { View: View };\n"]}