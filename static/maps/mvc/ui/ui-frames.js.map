{"version":3,"sources":["mvc/ui/ui-frames.js"],"names":["define","FrameView","Backbone","View","extend","initialize","options","this","model","Model","setElement","$","addClass","$el","append","tooltip","title","placement","$header","$title","$content","render","listenTo","self","attributes","html","find","remove","_","each","menu","option","$option","icon","isFunction","disabled","attr","on","onclick","url","indexOf","content","defaultOptions","frame","cols","rows","cell","margin","scroll","top_min","frame_max","visible","top","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","event","defaults","el","_frameInit","_frameResize","width","height","show","hide","_panelRefresh","window","resize","add","Galaxy","modal","body","buttons","Close","frame_id","length","_toPixelCoord","parseInt","css","_frameInsert","left","trigger","del","$frame","fadeOut","id","_panelAnimationComplete","fadeIn","type","events","mousemove","mouseup","mouseleave","mousewheel","DOMMouseScroll","mousedown .frame","mousedown .frame-background","mousedown .frame-scroll-up","mousedown .frame-scroll-down","mousedown .f-close","_eventFrameMouseDown","e","target","hasClass","preventDefault","_frameIdentify","xy","x","originalEvent","pageX","y","pageY","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","p","_frameScreen","min_dim","Math","max","_toGridCoord","_frameOffset","l","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","srcElement","parents","stopPropagation","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","closest","_frameFocus","_frameGrid","grid_location","px","sign","g","_toGrid","_toPixel","_isCollision","i","a","b","_locationRank","loc","animate","promise","done","delta","top_new","min","screen_location","grid_rank","substring","new_loc","place_list","push","f","sort","place","_framePlace","j","console","log","has_focus"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-frames.js","sourcesContent":["define([], function() {\n\n/** Frame view */\nvar FrameView = Backbone.View.extend({\n    initialize: function( options ) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model( options );\n        this.setElement( $( '<div/>' ).addClass( 'corner frame' ) );\n        this.$el.append( $( '<div/>' ).addClass( 'f-header corner' )\n                                      .append( $( '<div/>' ).addClass( 'f-title' ) )\n                                      .append( $( '<div/>' ).addClass( 'f-icon f-close fa fa-close' )\n                                                            .tooltip( { title: 'Close', placement: 'bottom' } ) ) )\n                .append( $( '<div/>' ).addClass( 'f-content' ) )\n                .append( $( '<div/>' ).addClass( 'f-resize f-icon corner fa fa-expand' ).tooltip( { title: 'Resize' } ) )\n                .append( $( '<div/>' ).addClass( 'f-cover' ) );\n        this.$header  = this.$( '.f-header' );\n        this.$title   = this.$( '.f-title' );\n        this.$content = this.$( '.f-content' );\n        this.render();\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html( options.title || '' );\n        this.$header.find( '.f-icon-left' ).remove();\n        _.each( options.menu, function( option ) {\n            var $option = $( '<div/>' ).addClass( 'f-icon-left' ).addClass( option.icon );\n            if ( _.isFunction( option.disabled ) && option.disabled() ) {\n                $option.attr( 'disabled', true );\n            } else {\n                $option.on( 'click', function() { option.onclick( self ) } )\n                       .tooltip( { title: option.tooltip, placement: 'bottom' } );\n            }\n            self.$header.append( $option );\n        } );\n        if ( options.url ) {\n            this.$content.html( $ ( '<iframe/>' ).addClass( 'f-iframe' )\n                                                 .attr( 'scrolling', 'auto' )\n                                                 .attr( 'src', options.url + ( options.url.indexOf( '?' ) === -1 ? '?' : '&' ) + 'widget=True' ) );\n        } else if ( options.content ) {\n            _.isFunction( options.content ) ? options.content( self.$content ) : self.$content.html( options.content );\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {             // default frame size in cells\n            cols : 6,\n            rows : 3\n        },\n        rows        : 1000,  // maximum number of rows\n        cell        : 130,   // cell size in px\n        margin      : 5,     // margin between frames\n        scroll      : 5,     // scroll speed\n        top_min     : 40,    // top margin\n        frame_max   : 9,     // maximum number of frames\n        visible     : true,  // initial visibility\n    },\n\n    cols            : 0,     // number of columns\n    top             : 0,     // scroll/element top\n    top_max         : 0,     // viewport scrolling state\n    frame_z         : 0,     // frame z-index\n    frame_counter   : 0,     // frame counter\n    frame_uid       : 0,     // unique frame id counter\n    frame_list      : {},    // list of all frames\n    frame_shadow    : null,  // frame shown as placeholder when moving active frames\n    visible         : false, // flag indicating if scratchbook viewer is visible or not\n    event           : {},    // dictionary keeping track of current event\n\n    initialize : function( options ) {\n        var self = this;\n        this.options = _.defaults( options || {}, this.defaultOptions );\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement( $( '<div/>' ).addClass( 'galaxy-frame' )\n                            .append( $( '<div/>' ).addClass( 'frame-background' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-up fa fa-chevron-up fa-2x' ) )\n                            .append( $( '<div/>' ).addClass( 'frame-menu frame-scroll-down fa fa-chevron-down fa-2x' ) ) );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({ el: $( '<div/>' ).addClass( 'corner frame-shadow' ) } );\n        this.$el.append( this.frame_shadow.$el );\n        this._frameInit( this.frame_shadow, '#frame-shadow' );\n        this._frameResize( this.frame_shadow, { width: 0, height: 0 } );\n        this.frame_list[ '#frame-shadow' ] = this.frame_shadow;\n\n        // initialize panel\n        this.visible ? this.show() : this.hide();\n        this._panelRefresh();\n        $( window ).resize( function() { self.visible && self._panelRefresh() } );\n    },\n\n    /** Render */\n    render: function() {\n        this.$( '.frame-scroll-up' ) [ this.top != this.options.top_min && 'show' || 'hide' ]();\n        this.$( '.frame-scroll-down')[ this.top != this.top_max && 'show' || 'hide' ]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function( options ) {\n        if ( this.frame_counter >= this.options.frame_max ) {\n            Galaxy.modal.show( {\n                title   : 'Warning',\n                body    : 'You have reached the maximum number of allowed frames (' + this.options.frame_max + ').',\n                buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n            });\n\n        } else {\n            var frame_id = '#frame-' + ( this.frame_uid++ );\n            if ( $ ( frame_id ).length !== 0 ) {\n                Galaxy.modal.show( {\n                    title   : 'Error',\n                    body    : 'This frame already exists. This page might contain multiple frame managers.',\n                    buttons : { 'Close' : function() { Galaxy.modal.hide() } }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView( options );\n                this.$el.append( frame.$el );\n\n                // set dimensions\n                options.width   = this._toPixelCoord( 'width', this.options.frame.cols );\n                options.height  = this._toPixelCoord( 'height', this.options.frame.rows );\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt( frame.$el.css( 'z-index' ) );\n                this.frame_list[ frame_id ] = frame;\n                this.frame_counter++;\n                this._frameInit( frame, frame_id );\n                this._frameResize( frame, { width: options.width, height: options.height } );\n                this._frameInsert( frame, { top: 0, left: 0 }, true );\n                !this.visible && this.show();\n                this.trigger( 'add' );\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function( frame ) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut( 'fast', function() {\n            $frame.remove();\n            delete self.frame_list[ frame.id ];\n            self.frame_counter--;\n            self._panelRefresh( true );\n            self._panelAnimationComplete();\n            self.trigger( 'remove' );\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn( 'fast' );\n        this.trigger( 'show' );\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if ( !this.event.type ) {\n            this.visible = false;\n            this.$el.fadeOut('fast', function() { $( this ).hide() });\n            this.trigger( 'hide' );\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        'mousemove'                         : '_eventFrameMouseMove',\n        'mouseup'                           : '_eventFrameMouseUp',\n        'mouseleave'                        : '_eventFrameMouseUp',\n        'mousewheel'                        : '_eventPanelScroll',\n        'DOMMouseScroll'                    : '_eventPanelScroll',\n\n        // events fixed to elements\n        'mousedown .frame'                  : '_eventFrameMouseDown',\n        'mousedown .frame-background'       : '_eventHide',\n        'mousedown .frame-scroll-up'        : '_eventPanelScroll_up',\n        'mousedown .frame-scroll-down'      : '_eventPanelScroll_down',\n        'mousedown .f-close'                : '_eventFrameClose'\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function ( e ) {\n        $( '.tooltip' ).hide();\n        if ( !this.event.type ) {\n            if ( $( e.target ).hasClass( 'f-header' ) || $( e.target ).hasClass( 'f-title' ) ) {\n                this.event.type = 'drag';\n            }\n            if ( $( e.target ).hasClass( 'f-resize' ) ) {\n                this.event.type = 'resize';\n            }\n            if ( this.event.type ) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify( e.target );\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart( this.event.target );\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function ( e ) {\n        if ( this.event.type ) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x : e.originalEvent.pageX,\n                y : e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x : event_xy_new.x - this.event.xy.x,\n                y : event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen ( this.event.target );\n\n            // drag/resize event\n            if ( this.event.type == 'resize' ) {\n                p.width  += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max( p.width, min_dim );\n                p.height = Math.max( p.height, min_dim );\n                this._frameResize( this.event.target, p );\n                p.width = this._toGridCoord( 'width', p.width ) + 1;\n                p.height = this._toGridCoord( 'height', p.height ) + 1;\n                p.width = this._toPixelCoord( 'width', p.width );\n                p.height = this._toPixelCoord( 'height', p.height );\n                this._frameResize( this.frame_shadow, p );\n                this._frameInsert( this.frame_shadow, {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                });\n            } else if ( this.event.type == 'drag' ) {\n                p.left  += event_xy_delta.x;\n                p.top   += event_xy_delta.y;\n                this._frameOffset( this.event.target, p );\n                var l = {\n                    top     : this._toGridCoord( 'top', p.top ),\n                    left    : this._toGridCoord( 'left', p.left )\n                };\n                l.left !== 0 && l.left++;\n                this._frameInsert( this.frame_shadow, l );\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function ( e ) {\n        if ( this.event.type ) {\n            this._frameDragStop( this.event.target );\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function ( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this.del( this._frameIdentify( e.target ) );\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function ( e ) {\n        !this.event.type && this.hide();\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function( e ) {\n        if ( !this.event.type && this.visible ) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $( e.srcElement ).parents( '.frame' );\n            if ( frames.length !== 0 ) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll( e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3 );\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function( e ) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( -this.options.scroll );\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if ( !this.event.type ) {\n            e.preventDefault();\n            this._panelScroll( this.options.scroll );\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function( target ) {\n        return this.frame_list[ '#' + $( target ).closest( '.frame' ).attr( 'id' ) ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart : function ( frame ) {\n        this._frameFocus( frame, true );\n        var p = this._frameScreen( frame );\n        this._frameResize( this.frame_shadow, p );\n        this._frameGrid( this.frame_shadow, frame.grid_location );\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $( '.f-cover' ).show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop : function ( frame ) {\n        this._frameFocus( frame, false );\n        var p = this._frameScreen( this.frame_shadow );\n        this._frameResize( frame, p );\n        this._frameGrid( frame, this.frame_shadow.grid_location, true );\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $( '.f-cover' ).hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function ( type, px ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        type == 'top' && ( px -= this.top );\n        return parseInt( ( px + sign * this.options.margin ) / this.options.cell, 10 );\n    },\n    \n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function ( type, g ) {\n        var sign = ( type == 'width' || type == 'height' ) ? 1 : -1;\n        var px = ( g * this.options.cell ) - sign * this.options.margin;\n        type == 'top' && ( px += this.top );\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function ( px ) {\n        return {\n            top     : this._toGridCoord( 'top', px.top ),\n            left    : this._toGridCoord( 'left', px.left ),\n            width   : this._toGridCoord( 'width', px.width ),\n            height  : this._toGridCoord( 'height', px.height )\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function( g ) {\n        return {\n            top     : this._toPixelCoord( 'top', g.top ),\n            left    : this._toPixelCoord( 'left', g.left ),\n            width   : this._toPixelCoord( 'width', g.width ),\n            height  : this._toPixelCoord( 'height', g.height )\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function( g ) {\n        function is_collision_pair ( a, b ) {\n            return !( a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left ||\n                      a.top > b.top + b.height  - 1 || a.top + a.height - 1 < b.top );\n        }\n        for ( var i in this.frame_list ) {\n            var frame = this.frame_list[ i ];\n            if ( frame.grid_location !== null && is_collision_pair ( g, frame.grid_location ) ) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function( loc ) {\n        return ( loc.top * this.cols ) + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function( animate ) {\n        this.cols = parseInt( $( window ).width() / this.options.cell, 10 ) + 1;\n        this._frameInsert( null, null, animate );\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $( '.frame' ).promise().done( function() { self._panelScroll( 0, true ) } );\n    },\n\n    /** Scroll panel */\n    _panelScroll: function( delta, animate ) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max( top_new, this.top_max );\n        top_new = Math.min( top_new, this.options.top_min );\n        if ( this.top != top_new ) {\n            for ( var i in this.frame_list ) {\n                var frame = this.frame_list[ i ];\n                if ( frame.grid_location !== null ) {\n                    var screen_location = {\n                        top  : frame.screen_location.top - ( this.top - top_new ),\n                        left : frame.screen_location.left\n                    }\n                    this._frameOffset( frame, screen_location, animate );\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function( frame, id ) {\n        frame.id              = id\n        frame.screen_location = {};\n        frame.grid_location   = {};\n        frame.grid_rank       = null;\n        frame.$el.attr( 'id', id.substring( 1 ) );\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function( frame, new_loc, animate ) {\n        var self = this;\n        var place_list = [];\n        if ( frame ) {\n            frame.grid_location = null;\n            place_list.push( [ frame, this._locationRank( new_loc ) ] );\n        }\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                f.grid_location = null;\n                place_list.push( [ f, f.grid_rank ] );\n            }\n        });\n        place_list.sort( function( a, b ) {\n            return a[ 1 ] < b[ 1 ] ? -1 : ( a[ 1 ] > b[ 1 ] ? 1 : 0 );\n        });\n        _.each( place_list, function( place ) {\n            self._framePlace( place[ 0 ], animate );\n        });\n        this.top_max = 0;\n        _.each( this.frame_list, function( f ) {\n            if ( f.grid_location !== null ) {\n                self.top_max = Math.max( self.top_max, f.grid_location.top + f.grid_location.height );\n            }\n        });\n        this.top_max = $( window ).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min( this.top_max, this.options.top_min );\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function( frame, animate ) {\n        frame.grid_location = null;\n        var g = this._toGrid( this._frameScreen( frame ) );\n        var done = false;\n        for ( var i = 0; i < this.options.rows; i++ ) {\n            for ( var j = 0; j < Math.max(1, this.cols - g.width ); j++ ) {\n                g.top   = i;\n                g.left  = j;\n                if ( !this._isCollision( g ) ) {\n                    done = true;\n                    break;\n                }\n            }\n            if ( done ) {\n                break;\n            }\n        }\n        if ( done ) {\n            this._frameGrid( frame, g, animate );\n        } else {\n            console.log( 'Grid dimensions exceeded.' );\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function( frame, has_focus ) {\n        frame.$el.css( 'z-index', this.frame_z + ( has_focus ? 1 : 0 ) );\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function( frame, p, animate ) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if ( animate ) {\n            this._frameFocus( frame, true );\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, 'fast', function() {\n                self._frameFocus( frame, false );\n            });\n        } else {\n            frame.$el.css( { top: p.top, left: p.left } );\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function( frame, p ) {\n        frame.$el.css( { width: p.width, height: p.height } );\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function ( frame, l, animate ) {\n        frame.grid_location = l;\n        this._frameOffset( frame, this._toPixel( l ), animate );\n        frame.grid_rank = this._locationRank( l );\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function( frame ) {\n        var p = frame.screen_location;\n        return { top: p.top, left: p.left, width: p.width, height: p.height };\n    }\n});\n\nreturn {\n    View: View\n}\n\n});\n"]}