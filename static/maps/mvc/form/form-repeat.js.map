{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["_utils","require","_uiPortlet","_uiMisc","View","Backbone","extend","initialize","options","this","list","_utils2","default","merge","title","empty_text","max","min","button_new","_uiMisc2","ButtonIcon","icon","tooltip","cls","onclick","onnew","$","$list","append","$el","id","button_delete","ondel","portlet","_uiPortlet2","addClass","hide","fadeIn","disable","operations","Galaxy","emit","debug","setElement","del","find","remove","enable","_refresh","delAll","_","each","hideOperation","isEmpty","hideOptions","index"],"mappings":"4IACA,IAAAA,OAAAC,QAAA,sDACAC,WAAAD,QAAA,oEACAE,QAAAF,QAAA,2DACIG,KAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GAJzBC,KAAAC,QAMQD,KAAKD,QAAUG,QAAAC,QAAMC,MAAML,GACvBM,MAAO,SACPC,WAAY,iBAPxBC,IAAA,KASYC,IAAK,OAETR,KAAKS,WAAa,IAAIC,SAAAP,QAAGQ,YAVjCC,KAAA,UAYYP,MAAO,UAAYL,KAAKD,QAAQM,MAChCQ,QAAS,WAAab,KAAKD,QAAQM,MAAQ,SAC3CS,IAAK,gDACLC,QAAS,WACLhB,EAAQiB,OAASjB,EAAQiB,WAbjChB,KAAKC,WACLgB,EAAKlB,UACDM,OAAOL,KADyBkB,MAAAD,EAAA,WAEhCX,OAAYW,EAAA,UAAAE,OAFoBnB,KAAAS,WAAAW,QAOhCR,KAAAA,WACAP,OAAAA,EAAAA,KAAOL,KAAAC,OAIHF,IAAAA,SAAAA,GACH,GAAAA,EAAAsB,KAAArB,KAAAC,KAAAF,EAAAsB,IAAA,CAWL,IAAAC,EAAmBrB,IAAnBS,SAAAP,QAAAQ,YA3BwBC,KAAA,aAyCpBC,QAAS,2BAXjBC,IAAA,0CACKC,QAAA,WACIhB,EAADwB,OAAoBtB,EAAKF,WAM5ByB,EAAA,IAAAC,YAAAtB,QAAAR,MACG2B,GAAAA,EAAAA,GACAV,MAAM,cACNC,IAAAA,EAASC,KAAA,oBACTA,YAAKQ,cAAAA,KAEDvB,EAAAA,OAAAA,EAAAqB,KACHI,EAAAJ,IAAAM,SAAA,eAAAC,OANiC3B,KAAtCC,KAAAF,EAAAsB,IAAAG,EAQAxB,KAAIwB,MAAAA,OAAcA,EAAAJ,IAAAQ,OAAA,SACdP,KAAAA,QAAItB,IADuB,GAE3BM,KAAAA,QAAOL,KAFoBD,QAAAQ,KAG3BO,KAAKf,WAAA8B,UACLC,KAAAA,gBA1CJC,OAAAC,KAAAC,MASKC,qBAlBmB,0CAuDxBC,IAAA,SAAUpC,GACLmB,KAALjB,KAAWkB,IAaXnB,KAAKkB,MAAMkB,KAAK,IAAMf,GAAIgB,gBAN9BrC,KAAAC,KAAAoB,GACAc,KAAK1B,WAAA6B,SACDtC,KAAKuC,YARLR,OAAKhC,KAALkC,MAAA,qBACwBlC,6BAWxByC,OAAA,WACA,IAAA,IAAOnB,KAAKpB,KAAZA,KACAD,KAAKS,IAAAA,IAKT+B,YAAQ,WACJxC,KAAKS,WAAUW,IAAKnB,OAChBwC,EAAAC,KAAA1C,KAAAC,KAAA,SAAAuB,GACHA,EAAAmB,cAAA,mBASDF,EAAEG,QAAQ5C,KAAKC,OANnBD,KAAAoB,IAAAD,OACA0B,EAAa,UACJpC,SAAekB,gBACR1B,KAAMD,KAAAD,QAASyB,cAY/Be,SAAU,WADV,IAAAO,EAAA,EACAP,IAAAA,IAAUlB,KAAArB,KAAAC,KAAW,CACb6C,IAAAA,EAAJ9C,KAAAC,KAAAoB,GACAG,EAAAnB,QAAoBJ,EAAM,KAAAD,KAAAD,QAAAM,OACtBmB,EACAA,KAAQnB,OAAQyC,KAAF/C,QAAiBS,IAE3B,gBAIP,iBACJ,sCAIDb,KAAMA","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["/** This class creates a ui component which enables the dynamic creation of portlets */\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.list = {};\n        this.options = Utils.merge(options, {\n            title: \"Repeat\",\n            empty_text: \"Not available.\",\n            max: null,\n            min: null\n        });\n        this.button_new = new Ui.ButtonIcon({\n            icon: \"fa-plus\",\n            title: \"Insert \" + this.options.title,\n            tooltip: \"Add new \" + this.options.title + \" block\",\n            cls: \"ui-button-icon ui-clear-float form-repeat-add\",\n            onclick: function() {\n                options.onnew && options.onnew();\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$list = $(\"<div/>\")))\n                .append($(\"<div/>\").append(this.button_new.$el))\n        );\n    },\n\n    /** Number of repeat blocks */\n    size: function() {\n        return _.size(this.list);\n    },\n\n    /** Add new repeat block */\n    add: function(options) {\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug(\n                \"form-repeat::add()\",\n                \"Duplicate or invalid repeat block id.\"\n            );\n            return;\n        }\n        var button_delete = new Ui.ButtonIcon({\n            icon: \"fa-trash-o\",\n            tooltip: \"Delete this repeat block\",\n            cls: \"ui-button-icon-plain form-repeat-delete\",\n            onclick: function() {\n                options.ondel && options.ondel();\n            }\n        });\n        var portlet = new Portlet.View({\n            id: options.id,\n            title: \"placeholder\",\n            cls: options.cls || \"ui-portlet-repeat\",\n            operations: { button_delete: button_delete }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass(\"section-row\").hide();\n        this.list[options.id] = portlet;\n        this.$list.append(portlet.$el.fadeIn(\"fast\"));\n        this.options.max > 0 &&\n            this.size() >= this.options.max &&\n            this.button_new.disable();\n        this._refresh();\n    },\n\n    /** Delete repeat block */\n    del: function(id) {\n        if (!this.list[id]) {\n            Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n            return;\n        }\n        this.$list.find(\"#\" + id).remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Remove all */\n    delAll: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n\n    /** Hides add/del options */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each(this.list, function(portlet) {\n            portlet.hideOperation(\"button_delete\");\n        });\n        _.isEmpty(this.list) &&\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-info\")\n                    .html(this.options.empty_text)\n            );\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(++index + \": \" + this.options.title);\n            portlet[\n                this.size() > this.options.min\n                    ? \"showOperation\"\n                    : \"hideOperation\"\n            ](\"button_delete\");\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}