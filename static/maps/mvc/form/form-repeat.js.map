{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["define","Utils","Portlet","Ui","portlet","Backbone","View","extend","initialize","this","list","merge","options","title","empty_text","max","button_new","ButtonIcon","icon","tooltip","floating","cls","onnew","$list","$","append","$el","size","_","add","id","Galaxy","emit","button_delete","ondel","onclick","hide","operations","fadeIn","disable","del","_refresh","debug","remove","enable","delAll","hideOptions","each","hideOperation","isEmpty","addClass","html","index","min"],"mappings":"YACAA,SAAU,cAAe,oBAAqB,kBAD9C,SAAAC,EAAAC,EAAAC,GAsFgBC,OACAA,KAtFNC,SAAeC,KAAAC,QAEjBD,WAAOD,SAAcE,GACrBC,KAAAA,QACIC,KAAKC,QAALT,EAAAU,MAAAC,GACAC,MAAeZ,SACXY,WAAc,iBACdC,IAAc,KACdC,IAHiC,OAAAN,KAArCO,WAAA,GAAAb,GAAAc,YAMAC,KAAKF,UACDE,MAAU,UADsBT,KAAAG,QAAAC,MAEhCA,QAAU,WAAYJ,KAAKG,QAAQC,MAFH,SAGhCM,SAAU,QACVC,IAAU,iCACVC,QAAU,WAAAT,EAAAU,OALsBV,EAAAU,WAMTV,KAAAA,WAAQU,EAAAA,UAASV,OAAAH,KAAjBc,MAAAC,EAAA,WAAkCC,OAAAD,EAAA,UAAAC,OAAAhB,KAAAO,WAAAU,QAOjEC,KAAM,WADN,MAAAC,GAAAD,KAAAlB,KAAAC,OAMAmB,IAAK,SAAUjB,GADf,IAAAA,EAAAkB,IAAArB,KAAAC,KAAAE,EAAAkB,IAES,WADJC,QAAAC,KAAUpB,MAAU,qBAAA,wCAGjB,IAAAqB,GAAA,GAAA9B,GAAAc,YACHC,KAAA,aACGe,QAAAA,2BACAf,IAAU,0CACVC,QAAU,WAAAP,EAAAsB,OAFwBtB,EAAAsB,WAIlCC,EAAU,GAAAjC,GAAAI,MAAaM,GAAAA,EAAiBA,GAAiBC,MAAA,cAJ7DQ,IAAAT,EAAAS,KAAA,oBAMIjB,YAAcF,cAAa+B,IAE3BpB,GAAAA,OAAkBD,EAFSc,KAG3BL,EAAAA,IAAkBT,SAAA,eAAewB,OACjCC,KAAAA,KAAAA,EAAoBJ,IAAAA,EAJOxB,KAA/Bc,MAAAE,OAAArB,EAAAsB,IAAAY,OAAA,SAMAlC,KAAAA,QAAQqB,IAAQb,GAAQc,KAAxBC,QAAAlB,KAAAG,QAAAG,KAAAN,KAAAO,WAAAuB,UACAnC,KAAAA,YAIAoC,IAAA,SAAKC,GAjDmB,IAAAhC,KAAAC,KAAAoB,GAoD5B,WAGQC,QAAOC,KAAKU,MAAO,qBAAsB,2BAD7CjC,MAAMc,MAAKb,KAAL,IAAkBoB,GAAAa,eACpBZ,MAAOC,KAAKU,GACZjC,KAAAO,WAAA4B,SACHnC,KAAAgC,YAIDI,OAAA,WA7DwB,IAAA,GAAAf,KAAArB,MAAAC,KAmEpBD,KAAK+B,IAAKV,IACbgB,YAAA,WApEuBrC,KAAAO,WAAAU,IAAAU,OA0ExBR,EAAEmB,KAAMtC,KAAKC,KAAM,SAAUN,GAAYA,EAAQ4C,cAAe,mBAHpEpB,EAAAqB,QAAAxC,KAAAC,OAAAD,KAAAiB,IAAAD,OAAAD,EAAA,UAAA0B,SAAA,gBAAAC,KAAA1C,KAAAG,QAAAE,cAG6CV,SAAAA,WAA0C,GAAnFgD,GAAA,CACAxB,KAAEqB,GAASnB,KAAKpB,MAAhBA,KAA0B,CA3EF,GAAAN,GAAAK,KAAAC,KAAAoB,EAmFpB1B,GAAQS,QAASuC,EAAQ,KAAO3C,KAAKG,QAAQC,OALrDT,EAAAK,KAAAkB,OAAAlB,KAAAG,QAAAyC,IAAA,gBAAA,iBAAA","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["/** This class creates a ui component which enables the dynamic creation of portlets */\ndefine( [ 'utils/utils', 'mvc/ui/ui-portlet', 'mvc/ui/ui-misc' ],\nfunction( Utils, Portlet, Ui ) {\n    var View = Backbone.View.extend({\n        initialize: function( options ) {\n            this.list = {};\n            this.options = Utils.merge( options, {\n                title       : 'Repeat',\n                empty_text  : 'Not available.',\n                max         : null,\n                min         : null\n            });\n            this.button_new = new Ui.ButtonIcon({\n                icon    : 'fa-plus',\n                title   : 'Insert ' + this.options.title,\n                tooltip : 'Add new ' + this.options.title + ' block',\n                floating: 'clear',\n                cls     : 'ui-button-icon form-repeat-add',\n                onclick : function() { options.onnew && options.onnew() }\n            });\n            this.setElement( $( '<div/>' ).append( this.$list = $( '<div/>' ) )\n                                          .append( $( '<div/>' ).append( this.button_new.$el ) ) );\n        },\n\n        /** Number of repeat blocks */\n        size: function() {\n            return _.size( this.list );\n        },\n\n        /** Add new repeat block */\n        add: function( options ) {\n            if ( !options.id || this.list[ options.id ] ) {\n                Galaxy.emit.debug( 'form-repeat::add()', 'Duplicate or invalid repeat block id.' );\n                return;\n            }\n            var button_delete = new Ui.ButtonIcon({\n                icon    : 'fa-trash-o',\n                tooltip : 'Delete this repeat block',\n                cls     : 'ui-button-icon-plain form-repeat-delete',\n                onclick : function() { options.ondel && options.ondel() }\n            });\n            var portlet = new Portlet.View({\n                id              : options.id,\n                title           : 'placeholder',\n                cls             : options.cls || 'ui-portlet-repeat',\n                operations      : { button_delete: button_delete }\n            });\n            portlet.append( options.$el );\n            portlet.$el.addClass( 'section-row' ).hide();\n            this.list[ options.id ] = portlet;\n            this.$list.append( portlet.$el.fadeIn( 'fast' ) );\n            this.options.max > 0 && this.size() >= this.options.max && this.button_new.disable();\n            this._refresh();\n        },\n\n        /** Delete repeat block */\n        del: function( id ) {\n            if ( !this.list[ id ] ) {\n                Galaxy.emit.debug( 'form-repeat::del()', 'Invalid repeat block id.' );\n                return;\n            }\n            this.$list.find( '#' + id ).remove();\n            delete this.list[ id ];\n            this.button_new.enable();\n            this._refresh();\n        },\n\n        /** Remove all */\n        delAll: function() {\n            for( var id in this.list ) {\n                this.del( id );\n            }\n        },\n\n        /** Hides add/del options */\n        hideOptions: function() {\n            this.button_new.$el.hide();\n            _.each( this.list, function( portlet ) { portlet.hideOperation( 'button_delete' ) } );\n            _.isEmpty( this.list ) && this.$el.append( $( '<div/>' ).addClass( 'ui-form-info' ).html( this.options.empty_text ) );\n        },\n\n        /** Refresh view */\n        _refresh: function() {\n            var index = 0;\n            for ( var id in this.list ) {\n                var portlet = this.list[ id ];\n                portlet.title( ++index + ': ' + this.options.title );\n                portlet[ this.size() > this.options.min ? 'showOperation' : 'hideOperation' ]( 'button_delete' );\n            }\n        }\n    });\n\n    return {\n        View : View\n    }\n});\n"]}