{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["define","Utils","Portlet","Ui","View","Backbone","extend","initialize","options","this","list","merge","title","empty_text","max","min","button_new","ButtonIcon","icon","tooltip","floating","cls","onclick","onnew","setElement","$","append","$list","$el","size","_","add","id","Galaxy","emit","debug","button_delete","ondel","portlet","operations","addClass","hide","fadeIn","disable","_refresh","del","find","remove","enable","delAll","hideOptions","each","hideOperation","isEmpty","html","index"],"mappings":"AACAA,QAAU,cAAe,oBAAqB,kBAC9C,SAAUC,EAAOC,EAASC,GA0FtB,OACIC,KA1FOC,SAASD,KAAKE,QACrBC,WAAY,SAAUC,GAClBC,KAAKC,QACLD,KAAKD,QAAUP,EAAMU,MAAOH,GACxBI,MAAc,SACdC,WAAc,iBACdC,IAAc,KACdC,IAAc,OAElBN,KAAKO,WAAa,GAAIb,GAAGc,YACrBC,KAAU,UACVN,MAAU,UAAYH,KAAKD,QAAQI,MACnCO,QAAU,WAAaV,KAAKD,QAAQI,MAAQ,SAC5CQ,SAAU,QACVC,IAAU,iCACVC,QAAU,WAAad,EAAQe,OAASf,EAAQe,WAEpDd,KAAKe,WAAYC,EAAG,UAAWC,OAAQjB,KAAKkB,MAAQF,EAAG,WACxBC,OAAQD,EAAG,UAAWC,OAAQjB,KAAKO,WAAWY,QAIjFC,KAAM,WACF,MAAOC,GAAED,KAAMpB,KAAKC,OAIxBqB,IAAK,SAAUvB,GACX,IAAMA,EAAQwB,IAAMvB,KAAKC,KAAMF,EAAQwB,IAEnC,WADAC,QAAOC,KAAKC,MAAO,qBAAsB,wCAG7C,IAAIC,GAAgB,GAAIjC,GAAGc,YACvBC,KAAU,aACVC,QAAU,2BACVE,IAAU,0CACVC,QAAU,WAAad,EAAQ6B,OAAS7B,EAAQ6B,WAEhDC,EAAU,GAAIpC,GAAQE,MACtB4B,GAAkBxB,EAAQwB,GAC1BpB,MAAkB,cAClBS,IAAkBb,EAAQa,KAAO,oBACjCkB,YAAoBH,cAAeA,IAEvCE,GAAQZ,OAAQlB,EAAQoB,KACxBU,EAAQV,IAAIY,SAAU,eAAgBC,OACtChC,KAAKC,KAAMF,EAAQwB,IAAOM,EAC1B7B,KAAKkB,MAAMD,OAAQY,EAAQV,IAAIc,OAAQ,SACvCjC,KAAKD,QAAQM,IAAM,GAAKL,KAAKoB,QAAUpB,KAAKD,QAAQM,KAAOL,KAAKO,WAAW2B,UAC3ElC,KAAKmC,YAITC,IAAK,SAAUb,GACX,IAAMvB,KAAKC,KAAMsB,GAEb,WADAC,QAAOC,KAAKC,MAAO,qBAAsB,2BAG7C1B,MAAKkB,MAAMmB,KAAM,IAAMd,GAAKe,eACrBtC,MAAKC,KAAMsB,GAClBvB,KAAKO,WAAWgC,SAChBvC,KAAKmC,YAITK,OAAQ,WACJ,IAAK,GAAIjB,KAAMvB,MAAKC,KAChBD,KAAKoC,IAAKb,IAKlBkB,YAAa,WACTzC,KAAKO,WAAWY,IAAIa,OACpBX,EAAEqB,KAAM1C,KAAKC,KAAM,SAAU4B,GAAYA,EAAQc,cAAe,mBAChEtB,EAAEuB,QAAS5C,KAAKC,OAAUD,KAAKmB,IAAIF,OAAQD,EAAG,UAAWe,SAAU,gBAAiBc,KAAM7C,KAAKD,QAAQK,cAI3G+B,SAAU,WACN,GAAIW,GAAQ,CACZ,KAAM,GAAIvB,KAAMvB,MAAKC,KAAO,CACxB,GAAI4B,GAAU7B,KAAKC,KAAMsB,EACzBM,GAAQ1B,QAAS2C,EAAQ,KAAO9C,KAAKD,QAAQI,OAC7C0B,EAAS7B,KAAKoB,OAASpB,KAAKD,QAAQO,IAAM,gBAAkB,iBAAmB","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["/** This class creates a ui component which enables the dynamic creation of portlets */\ndefine( [ 'utils/utils', 'mvc/ui/ui-portlet', 'mvc/ui/ui-misc' ],\nfunction( Utils, Portlet, Ui ) {\n    var View = Backbone.View.extend({\n        initialize: function( options ) {\n            this.list = {};\n            this.options = Utils.merge( options, {\n                title       : 'Repeat',\n                empty_text  : 'Not available.',\n                max         : null,\n                min         : null\n            });\n            this.button_new = new Ui.ButtonIcon({\n                icon    : 'fa-plus',\n                title   : 'Insert ' + this.options.title,\n                tooltip : 'Add new ' + this.options.title + ' block',\n                floating: 'clear',\n                cls     : 'ui-button-icon form-repeat-add',\n                onclick : function() { options.onnew && options.onnew() }\n            });\n            this.setElement( $( '<div/>' ).append( this.$list = $( '<div/>' ) )\n                                          .append( $( '<div/>' ).append( this.button_new.$el ) ) );\n        },\n\n        /** Number of repeat blocks */\n        size: function() {\n            return _.size( this.list );\n        },\n\n        /** Add new repeat block */\n        add: function( options ) {\n            if ( !options.id || this.list[ options.id ] ) {\n                Galaxy.emit.debug( 'form-repeat::add()', 'Duplicate or invalid repeat block id.' );\n                return;\n            }\n            var button_delete = new Ui.ButtonIcon({\n                icon    : 'fa-trash-o',\n                tooltip : 'Delete this repeat block',\n                cls     : 'ui-button-icon-plain form-repeat-delete',\n                onclick : function() { options.ondel && options.ondel() }\n            });\n            var portlet = new Portlet.View({\n                id              : options.id,\n                title           : 'placeholder',\n                cls             : options.cls || 'ui-portlet-repeat',\n                operations      : { button_delete: button_delete }\n            });\n            portlet.append( options.$el );\n            portlet.$el.addClass( 'section-row' ).hide();\n            this.list[ options.id ] = portlet;\n            this.$list.append( portlet.$el.fadeIn( 'fast' ) );\n            this.options.max > 0 && this.size() >= this.options.max && this.button_new.disable();\n            this._refresh();\n        },\n\n        /** Delete repeat block */\n        del: function( id ) {\n            if ( !this.list[ id ] ) {\n                Galaxy.emit.debug( 'form-repeat::del()', 'Invalid repeat block id.' );\n                return;\n            }\n            this.$list.find( '#' + id ).remove();\n            delete this.list[ id ];\n            this.button_new.enable();\n            this._refresh();\n        },\n\n        /** Remove all */\n        delAll: function() {\n            for( var id in this.list ) {\n                this.del( id );\n            }\n        },\n\n        /** Hides add/del options */\n        hideOptions: function() {\n            this.button_new.$el.hide();\n            _.each( this.list, function( portlet ) { portlet.hideOperation( 'button_delete' ) } );\n            _.isEmpty( this.list ) && this.$el.append( $( '<div/>' ).addClass( 'ui-form-info' ).html( this.options.empty_text ) );\n        },\n\n        /** Refresh view */\n        _refresh: function() {\n            var index = 0;\n            for ( var id in this.list ) {\n                var portlet = this.list[ id ];\n                portlet.title( ++index + ': ' + this.options.title );\n                portlet[ this.size() > this.options.min ? 'showOperation' : 'hideOperation' ]( 'button_delete' );\n            }\n        }\n    });\n\n    return {\n        View : View\n    }\n});\n"]}