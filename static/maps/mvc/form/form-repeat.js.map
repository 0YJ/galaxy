{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["View","Backbone","extend","initialize","options","this","list","_utils2","default","merge","title","empty_text","max","min","button_new","_uiMisc2","ButtonIcon","icon","tooltip","cls","onclick","onnew","setElement","$list","$","append","$el","add","id","button_delete","Galaxy","emit","ondel","portlet","addClass","hide","fadeIn","operations","disable","_refresh","del","find","remove","delAll","enable","hideOptions","_","each","hideOperation","isEmpty","index","size"],"mappings":"kOAIIA,EAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjBC,KAAKC,QACLD,KAAKD,QAAUG,EAAAC,QAAMC,MAAML,GACvBM,MAAO,SACPC,WAAY,iBACZC,IAAK,KACLC,IAAK,OAETR,KAAKS,WAAa,IAAIC,EAAAP,QAAGQ,YACrBC,KAAM,UACNP,MAAO,UAAYL,KAAKD,QAAQM,MAChCQ,QAAS,WAAab,KAAKD,QAAQM,MAAQ,SAC3CS,IAAK,gDACLC,QAAS,WAdVnB,EAASD,OAAKE,EAAOmB,WAGxBhB,KAAAiB,WACIZ,EAAAA,UACAC,OAAAA,KAAYY,MAAAC,EAAA,WACZZ,OAAKY,EAH2B,UAAAC,OAAApB,KAAAS,WAAAY,QAQhChB,KAAAA,WACAQ,OAAAA,EAAAA,KAAAA,KAASZ,OAIRqB,IAAA,SAAAvB,GAP+B,GAAlBA,EAAlBwB,KAAAvB,KAAAC,KAAAF,EAAAwB,IAAoC,CAmBvC,IA5B2BC,EAAA,IAAAd,EAAAP,QAAAQ,YAwCpBC,KAAM,aAVdC,QAAA,2BACAS,IAAK,0CACDP,QAAKhB,WACD0B,EAAOC,OAAP3B,EACI4B,WAKRC,EAAIJ,IAAAA,EAAAA,QAAgB7B,MAChBiB,GAAAA,EAAMW,GACNV,MAAAA,cACAC,IAAAA,EAAKA,KAAA,oBACLC,YAASS,cAAAA,KAERI,EAAAR,OAAArB,EAAAsB,KANiCO,EAAtCP,IAAAQ,SAAA,eAAAC,OAQA9B,KAAAC,KAAI2B,EAAUL,IAAIK,EACdL,KAAAA,MAAAA,OAAIxB,EADuBsB,IAAAU,OAAA,SAE3B1B,KAAAA,QAAAA,IAAO,GACPS,KAAAA,QAAKf,KAAAA,QAAeQ,KACpByB,KAAAA,WAAYC,UAJejC,KAAjBkC,gBA7BdT,OAAKR,KAAAA,MAlBmB,qBAmChB,0CAqBRkB,IAAA,SAAKjB,GACLlB,KAAKD,KAAAA,IAMTC,KAAAkB,MAAAkB,KAAA,IAAAb,GAAAc,gBACKrC,KAAAC,KAAAsB,GACDvB,KAAAS,WAAUR,SACNwB,KAAAA,YANJA,OAAKS,KAAAA,MAAL,qBAAA,6BAUAI,OAAA,WACA,IAAA,IAAK7B,KAAAA,KAAW8B,KAChBvC,KAAKkC,IAAAA,IAKLM,YAAK,WACDxC,KAAAS,WAAAY,IAAAS,OACHW,EAAAC,KAAA1C,KAAAC,KAAA,SAAA2B,GA/EuBA,EAAAe,cAAA,mBAkF5BF,EAAAG,QAAA5C,KAAAC,OACAuC,KAAAA,IAAapB,OACTD,EAAKV,UACEoB,SAAW,gBACdD,KAAQe,KAAAA,QAAcrC,cAU9B4B,SAAA,WACAA,IAAAA,EAAU,EACN,IAAA,IAAIW,KAAAA,KAAJ5C,KAAA,CACA,IAAA2B,EAAA5B,KAAeC,KAAfsB,GACIK,EAAIA,QAAAA,EAAe3B,KAAnBD,KAAAD,QAAAM,OACAuB,EACAA,KAAAA,OACSkB,KAAL/C,QAAmBA,IAI1B,gBACJ,iBAhHL,gCAoHIJ,KAAMA","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["/** This class creates a ui component which enables the dynamic creation of portlets */\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.list = {};\n        this.options = Utils.merge(options, {\n            title: \"Repeat\",\n            empty_text: \"Not available.\",\n            max: null,\n            min: null\n        });\n        this.button_new = new Ui.ButtonIcon({\n            icon: \"fa-plus\",\n            title: \"Insert \" + this.options.title,\n            tooltip: \"Add new \" + this.options.title + \" block\",\n            cls: \"ui-button-icon ui-clear-float form-repeat-add\",\n            onclick: function() {\n                options.onnew && options.onnew();\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$list = $(\"<div/>\")))\n                .append($(\"<div/>\").append(this.button_new.$el))\n        );\n    },\n\n    /** Number of repeat blocks */\n    size: function() {\n        return _.size(this.list);\n    },\n\n    /** Add new repeat block */\n    add: function(options) {\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug(\n                \"form-repeat::add()\",\n                \"Duplicate or invalid repeat block id.\"\n            );\n            return;\n        }\n        var button_delete = new Ui.ButtonIcon({\n            icon: \"fa-trash-o\",\n            tooltip: \"Delete this repeat block\",\n            cls: \"ui-button-icon-plain form-repeat-delete\",\n            onclick: function() {\n                options.ondel && options.ondel();\n            }\n        });\n        var portlet = new Portlet.View({\n            id: options.id,\n            title: \"placeholder\",\n            cls: options.cls || \"ui-portlet-repeat\",\n            operations: { button_delete: button_delete }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass(\"section-row\").hide();\n        this.list[options.id] = portlet;\n        this.$list.append(portlet.$el.fadeIn(\"fast\"));\n        this.options.max > 0 &&\n            this.size() >= this.options.max &&\n            this.button_new.disable();\n        this._refresh();\n    },\n\n    /** Delete repeat block */\n    del: function(id) {\n        if (!this.list[id]) {\n            Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n            return;\n        }\n        this.$list.find(\"#\" + id).remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Remove all */\n    delAll: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n\n    /** Hides add/del options */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each(this.list, function(portlet) {\n            portlet.hideOperation(\"button_delete\");\n        });\n        _.isEmpty(this.list) &&\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-info\")\n                    .html(this.options.empty_text)\n            );\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(++index + \": \" + this.options.title);\n            portlet[\n                this.size() > this.options.min\n                    ? \"showOperation\"\n                    : \"hideOperation\"\n            ](\"button_delete\");\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}