{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["View","Backbone","extend","initialize","options","this","model","Model","url","get","redirect","setElement","render","self","$","ajax","Galaxy","root","type","attributes","response","_formView2","default","title","status","icon","inputs","buttons","submit","_uiMisc2","Button","tooltip","submit_tooltip","submit_title","cls","onclick","form","$el","append","_submit","message","persistent","done","params","id","JSON","stringify","param","data","matchModel","input","input_id","field_list","value","success_message","fail","window","location","err_msg","_showMessage","indexOf","css","first","animate","scrollTop","update","$panel"],"mappings":"oOAGIA,EAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjBC,KAAKC,MAAQ,IAAIL,SAASM,MAAMH,GAChCC,KAAKG,IAAMH,KAAKC,MAAMG,IAAI,OAC1BJ,KAAKK,SAAWL,KAAKC,MAAMG,IAAI,YAC/BJ,KAAKM,WAAW,UAChBN,KAAKO,UAGTA,OAAQ,WACJ,IAAIC,EAAOR,KACXS,EAAEC,MACEP,IAAKQ,OAAOC,KAAOZ,KAAKG,IACxBU,KAAM,QAbdlB,KAAOC,SAAAA,GACPE,IAAYC,EAAAU,EAAAZ,UAASE,EAATE,MAAkBa,WAAAC,GACrBd,EAAQ,IAAAe,EAAAC,SACbC,MAAWnB,EAAWK,MACjBC,QAAWN,EAAKE,QAChBK,OAAWP,EAAhBoB,QAAA,UACKZ,KAALR,EAAAqB,KANwBC,OAAAtB,EAAAsB,OAuBZC,SAdRC,OAAA,IAAWC,EAAAP,QAAAQ,QACfC,QAAA3B,EAAA4B,eACOT,MAAAnB,EAAA6B,cAAA,OACShB,KAAPb,EAAmBI,aADrB,UAEG0B,IAAA,iCAEAC,QAAA,WACcjC,EAAAA,QAAWW,SAKvBY,EAAAA,IAAAA,QAAMrB,OAJUgC,EAAAC,OAMhBV,KAAAA,SAAAA,GACIC,EAAAA,IAAAA,QAAQU,OACJP,IAAAA,EAAAA,QAAAA,SACAR,QAAAA,2BAA+BV,EAFbL,IAElBe,IACAE,OAAAA,SACAS,YAAK,IACLC,QAZQI,QAAA,SAApBH,GAkBAvB,IAAAA,EAAAA,KACHC,EAAAC,MAEGF,IAAAA,OAAAI,KAAAJ,EAAiByB,IAETE,KAAAA,KAAAA,UAAAA,EAAAA,KAAAA,UACAhB,KAAAA,MACAiB,YAAAA,qBA/BhBC,KAAA,SAAAtB,GAXwB,IAAAuB,KA0DZvB,EAASwB,GAVhBD,EAAAC,GAAAxB,EAAewB,GAEbD,GACE3B,QAAAI,EAAmBZ,QAClBqC,OAAKC,UACLL,YAHH,GAOKE,EAAAA,SACAvB,OAAAA,SAAaJ,OAAAC,KAAAJ,EAAAH,SAAbU,IAAaN,EAAAiC,MAAAJ,IAAjBP,EAEOY,KAAAC,WAAA7B,EAAA,SAAA8B,EAAAC,GACHR,EAASS,WAAAD,GAAAE,MAAAH,EAAAG,SAEL7B,EAAAA,aAAQY,EAFHkB,oBAKZC,KAAA,SAAAnC,GACDP,EAAIA,aAAJuB,GACIoB,QAAOC,EAAczC,aAAA0C,QADzBlC,OAEO,SACHY,YAAUa,OAKjBU,aACAJ,SAAKnB,EAAAhC,GACGuD,EAAAA,IACDnB,UACAhB,OAAAA,WACAiB,OAAY,IAAZA,OAAY,UAAAmB,QAAA9C,EAAAT,MAAAwD,IAAA,eA9BxBC,QAlDwBC,SAAAC,UAAA,GAAA,KA6FxB5B,EAAKI,QAAQyB,OAAO7D,iBADpB8D,KAAAA","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(response => {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(response => {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: `Failed to load resource ${self.url}.`,\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(response => {\n                var params = {};\n                if (response.id) {\n                    params.id = response.id;\n                } else {\n                    params = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    }\n                }\n                if (self.redirect) {\n                    window.location = `${Galaxy.root + self.redirect}?${$.param(params)}`;\n                } else {\n                    form.data.matchModel(response, (input, input_id) => {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(response => {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n"]}