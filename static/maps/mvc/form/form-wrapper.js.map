{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["_formView","require","_uiMisc","View","Backbone","extend","initialize","options","this","model","Model","url","get","redirect","setElement","render","self","$","ajax","Galaxy","root","type","response","attributes","form","message","status","icon","inputs","buttons","submit","_uiMisc2","default","Button","tooltip","submit_tooltip","title","submit_title","submit_icon","_submit","$el","cls","onclick","empty","fail","data","create","persistent","contentType","done","success_message","JSON","stringify","window","location","matchModel","input","input_id","field_list","value","_showMessage","responseJSON","parents","filter","indexOf","css","$panel","update"],"mappings":"4IACA,IAAAA,UAAAC,QAAA,mEACAC,QAAAD,QAAA,2DACIE,KAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjBC,KAAKC,MAAQ,IAAIL,SAASM,MAAMH,GAJxCC,KAAAG,IAAAH,KAAAC,MAAAG,IAAA,OAMQJ,KAAKK,SAAWL,KAAKC,MAAMG,IAAI,YAC/BJ,KAAKM,WAAW,UAChBN,KAAKO,UAGTA,OAAQ,WACJ,IAAIC,EAAOR,KACXS,EAAEC,MACEP,IAAKQ,OAAOC,KAAOZ,KAAKG,IAfpCU,KAAA,QAIIf,KAAY,SAAAgB,GACHb,IAALF,EAAiBH,EAAAA,UAAeG,EAAhCE,MAAAc,WAAAD,GACWE,EAAKf,IAAAA,WAAAA,SACXI,MAAWN,EAAWK,MACtBE,QAAWP,EAAhBkB,QACAC,OAAAnB,EAAAmB,QAAA,UANwBC,KAAApB,EAAAoB,KAsBZC,OAAQrB,EAAQqB,OAbxBC,SACJC,OAAA,IAAAC,SAAAC,QAAAC,QACOC,QAAA3B,EAAA4B,eACEC,MAAc7B,EADhB8B,cAAA,OAEGV,KAAApB,EAAA+B,aAAA,UAEShB,IAAAA,iCACKjB,QAAF,WACHW,EAAAuB,QAAAf,SAKPI,EAAAA,IAAQrB,QAAQqB,OALAJ,EAAAgB,OAOZV,KAAAA,SAAAA,GACII,EAAAA,IAAAA,QAAS3B,OACT6B,IAAAA,SAAAA,QAAAA,SACAT,QAAMpB,2BAHYS,EAAAL,IAAA,IAIlB8B,OAAK,SACLC,YAAS,IACL1B,QAKhBA,QAAAA,SAAS2B,GACZ,IACAC,EAAKpC,KACFQ,EAAAA,MAEQS,IAAAA,OAAAA,KAAST,EAAAL,IACTe,KAAAA,KAAAA,UAFWF,EAAAqB,KAAAC,UAGXC,KAAAA,MAHWC,YADnB,qBAtCgBC,KAAA,SAAA3B,GAyDhB,IAAI4B,GATPzB,QAAAH,EAAeG,QACTC,OAAX,UACOqB,YAAA,GAEGI,EAAKC,SACLC,OAHHC,SAIHN,OAAa5B,KAEPJ,EAASM,SACP4B,IACAzB,EAASH,MAAAA,IAETyB,EAAAA,KAAYQ,WAAAjC,EAAA,SAAAkC,EAAAC,GAHhBjC,EAAAkC,WAAAD,GAAAE,MAAAH,EAAAG,SAMIN,EAAOC,aACHnC,EAAOC,MAMPI,KAAAA,SAAKkC,GACR1C,EAFD4C,aAAApC,GAGAR,QAAK4C,EAALC,aAAwBX,QAC3BxB,OAAA,SAECqB,YAASzB,OACasC,aAAxB,SAAApC,EAAAjB,GA1BRiB,EAAAgB,IAlDwBsB,UAuFnBC,OAAO,WAHhBH,OAG2B,IAFVpC,OAAA,UAAAwC,QAED/C,EAAAT,MAAAyD,IAAW,eAMvBC,QACKzC,SAAQ0C,UAAb,GAAA,KACH3C,EAAAC,QAAA0C,OAAA5D,uBAIDJ,KAAMA","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(function(response) {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(function(response) {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: \"Failed to load resource \" + self.url + \".\",\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(function(response) {\n                var success_message = {\n                    message: response.message,\n                    status: \"success\",\n                    persistent: false\n                };\n                if (self.redirect) {\n                    window.location =\n                        Galaxy.root +\n                        self.redirect +\n                        \"?\" +\n                        $.param(success_message);\n                } else {\n                    form.data.matchModel(response, function(input, input_id) {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(function(response) {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return (\n                    [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1\n                );\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n"]}