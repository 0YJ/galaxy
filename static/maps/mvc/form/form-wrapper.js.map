{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["define","Form","Ui","form","View","Backbone","extend","this","model","Model","options","initialize","get","url","redirect","render","self","Galaxy","root","ajax","type","$","attributes","response","message","title","status","icon","inputs","buttons","submit_tooltip","submit_title","tooltip","submit_icon","_submit","$el","empty","append","fail","Message","persistent","JSON","data","create","contentType","param","success_message","input_id","value","input","_showMessage","field_list","responseJSON","err_msg","parents","filter","indexOf","css","first","scrollTop","$panel"],"mappings":"YACAA,SAAU,qBAAsB,kBAAoB,SAAUC,EAAMC,GAwExDC,OACHC,KAzECC,SAAAD,KAAFE,QAEAF,WAAOC,SAAcC,GAGjBC,KAAKC,MAAQ,GAAIH,UAASI,MAAOC,GADrCC,KAAAA,IAAYJ,KAAAC,MAAAI,IAAA,OACRL,KAAKC,SAAQD,KAAIF,MAASI,IAAOC,YACjCH,KAAKM,WAAWL,UAChBD,KAAKO,UAGRC,OAR2B,WAWxB,GAAIC,GAAOT,IADfQ,GAAAA,MACQC,IAAOC,OAAXC,KAAAX,KAAAM,IACEM,KAAK,QACHN,KAAUI,SAAOC,GACjBE,GAAAA,GAAUC,EAAAf,UAAAU,EAAAR,MAAAc,WAAAC,GACLpB,EAAA,GAAUoB,IACXb,MAAAA,EAAYJ,MACZH,QAAOO,EAASc,QAChBC,OAASf,EAAQe,QADD,UAEhBD,KAASd,EAAQc,KACjBE,OAAShB,EAAQgB,OACjBC,SACAC,OAASlB,GAAQkB,GAAAA,QACjBC,QAASnB,EAAAoB,eACLL,MAAcvB,EAAJ6B,cAAc,gBACpBC,KAAWtB,EAAQoB,aADC,UAEpBL,IAAWf,iCACXiB,QAAWjB,WAAQuB,EAAeC,QAHd/B,QAK0Ba,GAAAmB,IAAAC,QAAAC,OAAAlC,EAAAgC,OAL1BG,KAAA,SAAdf,GADLP,EAAAmB,IAAAC,QAAAC,OAAA,GAAAnC,GAAAqC,SANbf,QAAA,2BAAAR,EAAAH,IAAA,IAgBAG,OAAiBqB,SACZG,YAAUjB,IACfP,QAAwCkB,QAAf,SAAzB/B,GAKH,GA5BDa,GAAAT,IAZwBc,GAAAF,MA8CpBN,IAAcI,OAAOC,KAAOF,EAAKH,IAHzCqB,KAASO,KAAUtC,UAAOA,EAAAuC,KAAAC,UAClB3B,KAAJ,MACEG,YAAM,qBACJN,KAAcI,SAAOC,GACrBwB,GAAAA,IAA8BvC,QAAUwC,EAFpCnB,QAAAE,OAAA,UAAAc,YAAA,EAGJpB,GAAcN,SACd8B,OAAAA,SAAc3B,OAAAC,KAAAF,EAAAF,SAAA,IAAAO,EAAAwB,MAAAC,IAEVA,EAAAA,KAAAA,WAAoBtB,EAASD,SAASC,EAASE,GAC9CV,EAAKF,WAAWiC,GAAAC,MAAAC,EAAAD,SAArBhC,EAEOkC,aAAA/C,EAAA2C,MAEC3C,KAAAA,SAAKgD,GACRnC,EAFDkC,aAAA/C,GAAAqB,QAAAD,EAAA6B,aAAAC,QAAA3B,OAAA,SAAAc,YAAA,OAMJxB,aAAKkC,SAAAA,EAALxC,GAhBJP,EAAAgC,IAAAmB,UAAAC,OAAA,WA7CwB,OAAA,IAAA,OAAA,UAAAC,QAAAnC,EAAAd,MAAAkD,IAAA,eAoErBC,QAHPR,SAAcS,UAAA,GAAUxD,KACpBA,EAAIyD,QAASzD,OAAAO","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\ndefine( [ 'mvc/form/form-view', 'mvc/ui/ui-misc' ], function( Form, Ui ) {\n\n    var View = Backbone.View.extend({\n\n        initialize: function( options ) {\n            this.model = new Backbone.Model( options );\n            this.url = this.model.get( 'url' );\n            this.redirect = this.model.get( 'redirect' );\n            this.setElement( '<div/>' );\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            $.ajax({\n                url     : Galaxy.root + this.url,\n                type    : 'GET'\n            }).done( function( response ) {\n                var options = $.extend( {}, self.model.attributes, response );\n                var form = new Form({\n                    title  : options.title,\n                    message: options.message,\n                    status : options.status || 'warning',\n                    icon   : options.icon,\n                    inputs : options.inputs,\n                    buttons: {\n                        'submit': new Ui.Button({\n                            tooltip  : options.submit_tooltip,\n                            title    : options.submit_title || 'Save settings',\n                            icon     : options.submit_icon || 'fa-save',\n                            cls      : 'btn btn-primary ui-clear-float',\n                            onclick  : function() { self._submit( form ) }\n                        })\n                    }\n                });\n                self.$el.empty().append( form.$el );\n            }).fail( function( response ) {\n                self.$el.empty().append( new Ui.Message({\n                    message     : 'Failed to load resource ' + self.url + '.',\n                    status      : 'danger',\n                    persistent  : true\n                }).$el );\n            });\n        },\n\n        _submit: function( form ) {\n            var self = this;\n            $.ajax( {\n                url         : Galaxy.root + self.url,\n                data        : JSON.stringify( form.data.create() ),\n                type        : 'PUT',\n                contentType : 'application/json'\n            }).done( function( response ) {\n                var success_message = { message: response.message, status: 'success', persistent: false };\n                if ( self.redirect ) {\n                    window.location = Galaxy.root + self.redirect + '?' + $.param( success_message );\n                } else {\n                    form.data.matchModel( response, function ( input, input_id ) {\n                        form.field_list[ input_id ].value( input.value );\n                    });\n                    self._showMessage( form, success_message );\n                }\n            }).fail( function( response ) {\n                self._showMessage( form, { message: response.responseJSON.err_msg, status: 'danger', persistent: false } );\n            });\n        },\n\n        _showMessage: function( form, options ) {\n            var $panel = form.$el.parents().filter(function() {\n                return [ 'auto', 'scroll' ].indexOf( $( this ).css( 'overflow' ) ) != -1;\n            }).first();\n            $panel.animate( { scrollTop : 0 }, 500 );\n            form.message.update( options );\n        }\n    });\n\n    return {\n        View  : View\n    };\n});\n"]}