{"version":3,"sources":["mvc/toolshed/repo-status-view.js"],"names":["define","toolshed_model","toolshed_util","RepoStatus","Backbone","View","extend","ToolShedRepoStatusView","el","options","initialize","_","defaults","this","self","render","model","url","repositories","join","listenTo","timer","setInterval","some","terminal_states","repository","all_done","get","models","toLowerCase","repo_id","repo_status","clearInterval","fetch","close","repo_status_template","templateRepoStatus","queue","queueLength","$","css","bindEvents","reDraw","$el","empty","template"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SAASC,EAAgBC,GAiIlF,OACIC,WAlIAC,SAA+BC,KAAAC,QAE/BC,GAAAA,UAEAC,WAAI,SAF0CC,GAI9CC,KAAAA,QAAYC,EAAAC,SAAAC,KAASJ,cAASA,EAAAI,KAAAD,UAC1BC,KAAIC,MAAO,IAAXb,EAAAE,WACAU,KAAKJ,SAALI,KAAiBD,MAAS,OAAKH,KAALM,QAC1BF,KAAKG,MAALC,KAAiBhB,iBAAeE,KAAnBM,QAAbS,aAAAC,KAAA,KACAN,KAAKO,MAAAA,QACLP,KAAKG,MAAMC,YAAO,SAAAH,GAClB,IAAKE,GAAL,YAAA,SACKK,GAAQC,EACTX,EAAAY,KAAIC,EAAAA,MAAAA,OAAmB,SAADC,GAClBC,QAAAA,EAAJC,IAAA,MACEJ,IAAKT,EAAWc,EAAQD,IAASF,UAATI,cACtBC,IAAA,IAAAA,EAAUL,QAAeM,GAErBP,OADAO,GAAAA,GACAP,IAGHE,EANLM,cAAAlB,EAAAO,OAQAP,EAGKE,MAAAiB,SAEJ,IAAApB,OAITqB,MAAO,WAAPA,cAAOrB,KAAAQ,QAIPN,OAAQ,SAASN,GAAjBM,KAAQN,QAAAE,EAAAL,OAASG,KAASA,QAAAA,GACtB,IAAA0B,EAAwBtB,KAAKJ,mBAC7BI,KAAIsB,IAAAA,KAAAA,GAA4BC,MAAAA,oBAAhClB,aAAAL,KAAAG,MAAAY,OAAAS,MAAAnC,EAAAoC,iBACAC,EAAA,WAAAC,IAAcL,WAAAA,QACdI,KAAEE,cAINA,WAAY,aAIZC,OAAQ,SAASjC,GAAjBiC,KAAQC,IAAAC,QACJ/B,KAAK8B,WAALlC,IAIJ2B,mBAAoBzB,EAAEkC,UAAtBT,yEApDJ,6DAuDY,wJAwEL,SACHjC,0BADJ,oBAjIJ,4BA8DgB,qEACA,wBACA,sCACA,mDACA,6CACA,0FACA,sEACA,kEACJ,WACA,uCACI,iCACI,OACI,iEACA,wEACA,kEACA,qEACA,gFACJ,QACJ,WACA,+BACI,oDACI,OACI,OACI,uBACI,uFACI,gCACJ,WACJ,SACJ,QACA,OACI,uBACI,uFACI,uCACJ,WACJ,SACJ,QACA,OACI,uBACI,uFACI,iCACJ,WACJ,SACJ,QACA,OACI,uBACI,4FACI,8CACJ,WACJ,SACJ,QACA,OACI,uBACI,8FACI,qKACI,kCACJ,SACJ,WACJ,SACJ,QACJ,QACJ,YACJ,WACA,yCACJ,YACFgB,KAAK","file":"../../../scripts/mvc/toolshed/repo-status-view.js","sourcesContent":["define(['mvc/toolshed/toolshed-model', 'mvc/toolshed/util'], function(toolshed_model, toolshed_util) {\n\n    var ToolShedRepoStatusView = Backbone.View.extend({\n\n        el: '#center',\n\n        initialize: function(options) {\n            var self = this;\n            this.options = _.defaults(this.options || [{}], options, this.defaults);\n            this.model = new toolshed_model.RepoStatus();\n            this.listenTo(this.model, 'sync', this.render);\n            this.model.url += '?repositories=' + this.options.repositories.join('|');\n            this.model.fetch();\n            this.timer = setInterval(function(self) {\n                var terminal_states = ['installed', 'error'];\n                var all_done = true;\n                _.some(self.model.models, function(repository) {\n                    repo_id = repository.get('id');\n                    var repo_status = repository.get('status').toLowerCase();\n                    if (terminal_states.indexOf(repo_status) === -1) {\n                        all_done = false;\n                        return true;\n                    }\n                });\n                if (all_done) {\n                    clearInterval(self.timer);\n                }\n                else {\n                    self.model.fetch();\n                }\n            }, 2000, this);\n        },\n\n        close: function() {\n            clearInterval(this.timer);\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var repo_status_template = this.templateRepoStatus;\n            this.$el.html(repo_status_template({title: 'Repository Status', repositories: this.model.models, queue: toolshed_util.queueLength()}));\n            $(\"#center\").css('overflow', 'auto');\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n        },\n\n        reDraw: function(options){\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateRepoStatus: _.template([\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            '</div>',\n            '<style type=\"text/css\">',\n                '.state-color-new,',\n                '.state-color-deactivated,',\n                '.state-color-uninstalled { border-color:#bfbfbf; background:#eee }',\n                '.state-color-cloning,',\n                '.state-color-setting-tool-versions,',\n                '.state-color-installing-repository-dependencies,',\n                '.state-color-installing-tool-dependencies,',\n                '.state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }',\n                '.state-color-installed { border-color:#20b520; background:#b0f1b0 }',\n                '.state-color-error { border-color:#dd1b15; background:#f9c7c5 }',\n            '</style>',\n            '<table id=\"grid-table\" class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                    '<tr>',\n                        '<th id=\"null-header\">Name<span class=\"sort-arrow\"></span></th>',\n                        '<th id=\"null-header\">Description<span class=\"sort-arrow\"></span></th>',\n                        '<th id=\"null-header\">Owner<span class=\"sort-arrow\"></span></th>',\n                        '<th id=\"null-header\">Revision<span class=\"sort-arrow\"></span></th>',\n                        '<th id=\"null-header\">Installation Status<span class=\"sort-arrow\"></span></th>',\n                    '</tr>',\n                '</thead>',\n                '<tbody id=\"grid-table-body\">',\n                    '<% _.each(repositories, function(repository) { %>',\n                        '<tr>',\n                            '<td>',\n                                '<div id=\"\" class=\"\">',\n                                    '<label id=\"repo-name-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                                        '<%= repository.get(\"name\") %>',\n                                    '</label>',\n                                '</div>',\n                            '</td>',\n                            '<td>',\n                                '<div id=\"\" class=\"\">',\n                                    '<label id=\"repo-desc-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                                        '<%= repository.get(\"description\") %>',\n                                    '</label>',\n                                '</div>',\n                            '</td>',\n                            '<td>',\n                                '<div id=\"\" class=\"\">',\n                                    '<label id=\"repo-user-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                                        '<%= repository.get(\"owner\") %>',\n                                    '</label>',\n                                '</div>',\n                            '</td>',\n                            '<td>',\n                                '<div id=\"\" class=\"\">',\n                                    '<label id=\"repo-changeset-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                                        '<%= repository.get(\"changeset_revision\") %>',\n                                    '</label>',\n                                '</div>',\n                            '</td>',\n                            '<td>',\n                                '<div id=\"\" class=\"\">',\n                                    '<label id=\"RepositoryStatus-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                                        '<div class=\"repo-status count-box state-color-<%= repository.get(\"status\").toLowerCase().replace(/ /g, \"-\") %>\" id=\"RepositoryStatus-<%= repository.get(\"id\") %>\">',\n                                            '<%= repository.get(\"status\") %>',\n                                        '</div>',\n                                    '</label>',\n                                '</div>',\n                            '</td>',\n                        '</tr>',\n                    '<% }); %>',\n                '</tbody>',\n                '<tfoot id=\"grid-table-footer\"></tfoot>',\n            '</table>'\n        ].join(''))\n    });\n\n    return {\n        RepoStatus: ToolShedRepoStatusView,\n    };\n\n});"]}