{"version":3,"sources":["mvc/toolshed/repo-status-view.js"],"names":["define","toolshed_model","toolshed_util","RepoStatus","ToolShedRepoStatusView","Backbone","View","el","initialize","options","this","defaults","model","timer","setInterval","listenTo","terminal_states","render","url","_","models","repositories","repository","repo_id","self","all_done","some","get","clearInterval","toLowerCase","indexOf","repo_status","fetch","close","$","css","bindEvents","extend","repo_status_template","templateRepoStatus","$el","html","title","queue","queueLength","template","reDraw","empty","join"],"mappings":"kEAAAA,QAAQ,8BAA+B,qBAAsB,SACzDC,EACAC,GAkJA,OACIC,WAjJAC,SAAyBC,KAASC,QAClCC,GAAAA,UAEAC,WAAAA,SAAYC,GAERC,KAAAD,QAAKA,EAALE,SAKAD,KAAKE,cACLH,EACAC,KAAKE,UAGLF,KAAAE,MAAKC,IAAQC,EACTX,WACIO,KAAAK,SAAIC,KAAAA,MAAAA,OAAmBN,KAAAO,QACvBP,KAAAE,MAAAM,KACAC,iBAAYP,KAAMQ,QAAQC,aAASC,KAAT,KACtBC,KAAAA,MAAAA,QACAb,KAAAG,MAAAC,YAGA,SAAAU,GACIC,IAAAA,GAAW,YAAX,SACAA,GAAO,EACVN,EAAAO,KAAAF,EAAAZ,MAAAQ,OAAA,SAAAE,GARLC,QAAAD,EAAAK,IAAA,MAUIF,IAAAA,EAAUH,EACVM,IAAAA,UACGC,cACHL,IAAA,IAAAA,EAAAM,QAAAC,GAIR,OAHKN,GAAA,GAlBT,IAyBGA,EACHG,cAAmBf,EAAnBA,OATYW,EAAKZ,MAAMoB,SAcvB,IACAtB,OACyBuB,MAAA,WAMzBC,cAAExB,KAAWyB,QAVjBlB,OAAQ,SAASR,GAcjB2B,KAAAA,QAAYjB,EAAAkB,OAAA3B,KAAAD,QAAWA,GACnB,IAAA6B,EAAA5B,KAAA6B,mBACH7B,KA5D6C8B,IAAAC,KAgDtCH,GAcAI,MAAA,oBACJrB,aAAAX,KAAAE,MAAAQ,OACAuB,MAAKnC,EAALoC,iBAGJL,EAAAA,WAAAA,IAAAA,WAAsBM,QAnE1BnC,KAAA0B,cAiJIjC,WAAAA,aAnFA2C,OAAQ,SAASrC,GACbC,KAAK8B,IAAIO,QACTrC,KAAKF,WAAWC,IAGpB8B,mBAAoBpB,EAAE0B,UAEd,yEACA,6DACA,wJACA,SACA,0BACA,oBACA,4BACA,qEACA,wBACA,sCACA,mDACA,6CACA,0FACA,sEACA,kEACA,WACA,uCACA,iCACA,OACA,iEACA,wEACA,kEACA,qEACA,gFACA,QACA,WACA,+BACA,oDACA,OACA,OACA,uBACA,uFACA,gCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,uCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,iCACA,WACA,SACA,QACA,OACA,uBACA,4FACA,8CACA,WACA,SACA,QACA,OACA,uBACA,8FACA,qKACA,kCACA,SACA,WACA,SACA,QACA,QACA,YACA,WACA,yCACA,YACFG,KAAK","file":"../../../scripts/mvc/toolshed/repo-status-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(\n    toolshed_model,\n    toolshed_util\n) {\n    var ToolShedRepoStatusView = Backbone.View.extend({\n        el: \"#center\",\n\n        initialize: function(options) {\n            var self = this;\n            this.options = _.defaults(\n                this.options || [{}],\n                options,\n                this.defaults\n            );\n            this.model = new toolshed_model.RepoStatus();\n            this.listenTo(this.model, \"sync\", this.render);\n            this.model.url +=\n                \"?repositories=\" + this.options.repositories.join(\"|\");\n            this.model.fetch();\n            this.timer = setInterval(\n                function(self) {\n                    var terminal_states = [\"installed\", \"error\"];\n                    var all_done = true;\n                    _.some(self.model.models, function(repository) {\n                        repo_id = repository.get(\"id\");\n                        var repo_status = repository\n                            .get(\"status\")\n                            .toLowerCase();\n                        if (terminal_states.indexOf(repo_status) === -1) {\n                            all_done = false;\n                            return true;\n                        }\n                    });\n                    if (all_done) {\n                        clearInterval(self.timer);\n                    } else {\n                        self.model.fetch();\n                    }\n                },\n                2000,\n                this\n            );\n        },\n\n        close: function() {\n            clearInterval(this.timer);\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var repo_status_template = this.templateRepoStatus;\n            this.$el.html(\n                repo_status_template({\n                    title: \"Repository Status\",\n                    repositories: this.model.models,\n                    queue: toolshed_util.queueLength()\n                })\n            );\n            $(\"#center\").css(\"overflow\", \"auto\");\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateRepoStatus: _.template(\n            [\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<style type=\"text/css\">',\n                \".state-color-new,\",\n                \".state-color-deactivated,\",\n                \".state-color-uninstalled { border-color:#bfbfbf; background:#eee }\",\n                \".state-color-cloning,\",\n                \".state-color-setting-tool-versions,\",\n                \".state-color-installing-repository-dependencies,\",\n                \".state-color-installing-tool-dependencies,\",\n                \".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }\",\n                \".state-color-installed { border-color:#20b520; background:#b0f1b0 }\",\n                \".state-color-error { border-color:#dd1b15; background:#f9c7c5 }\",\n                \"</style>\",\n                '<table id=\"grid-table\" class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                '<th id=\"null-header\">Name<span class=\"sort-arrow\"></span></th>',\n                '<th id=\"null-header\">Description<span class=\"sort-arrow\"></span></th>',\n                '<th id=\"null-header\">Owner<span class=\"sort-arrow\"></span></th>',\n                '<th id=\"null-header\">Revision<span class=\"sort-arrow\"></span></th>',\n                '<th id=\"null-header\">Installation Status<span class=\"sort-arrow\"></span></th>',\n                \"</tr>\",\n                \"</thead>\",\n                '<tbody id=\"grid-table-body\">',\n                \"<% _.each(repositories, function(repository) { %>\",\n                \"<tr>\",\n                \"<td>\",\n                '<div id=\"\" class=\"\">',\n                '<label id=\"repo-name-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                '<%= repository.get(\"name\") %>',\n                \"</label>\",\n                \"</div>\",\n                \"</td>\",\n                \"<td>\",\n                '<div id=\"\" class=\"\">',\n                '<label id=\"repo-desc-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                '<%= repository.get(\"description\") %>',\n                \"</label>\",\n                \"</div>\",\n                \"</td>\",\n                \"<td>\",\n                '<div id=\"\" class=\"\">',\n                '<label id=\"repo-user-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                '<%= repository.get(\"owner\") %>',\n                \"</label>\",\n                \"</div>\",\n                \"</td>\",\n                \"<td>\",\n                '<div id=\"\" class=\"\">',\n                '<label id=\"repo-changeset-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                '<%= repository.get(\"changeset_revision\") %>',\n                \"</label>\",\n                \"</div>\",\n                \"</td>\",\n                \"<td>\",\n                '<div id=\"\" class=\"\">',\n                '<label id=\"RepositoryStatus-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n                '<div class=\"repo-status count-box state-color-<%= repository.get(\"status\").toLowerCase().replace(/ /g, \"-\") %>\" id=\"RepositoryStatus-<%= repository.get(\"id\") %>\">',\n                '<%= repository.get(\"status\") %>',\n                \"</div>\",\n                \"</label>\",\n                \"</div>\",\n                \"</td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</tbody>\",\n                '<tfoot id=\"grid-table-footer\"></tfoot>',\n                \"</table>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        RepoStatus: ToolShedRepoStatusView\n    };\n});\n"]}