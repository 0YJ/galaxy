{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["define","toolshed_model","toolshed_util","Category","Backbone","View","extend","ToolShedCategoryContentsView","el","params","initialize","this","self","model","render","shed","CategoryCollection","listenTo","category_id","tool_shed","url","options","_","category_contents_template","templateCategoryContents","models","queue","queueLength","$","$el","bindEvents","that","autocomplete","source","request","response","shed_url","replace","base_url","Galaxy","post","root","data","term","tool_shed_url","minLength","select","event","ui","item","value","new_route","tsr_id","trigger","reDraw","empty","template","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SAASC,EAAgBC,GAgGlF,OACIC,SAjG+BC,SAAAC,KAAAC,QAE/BC,GAAAA,UAEAC,WAAI,SAFgDC,GAIpDC,KAAAA,MAAY,IAAAT,EAASQ,mBACjBE,KAAIC,SAAOD,KAAXE,MAAA,OAAAF,KAAAG,QACA,IAAAC,EAAAN,EAAiBR,UAAAA,QAAee,MAAAA,OAChCL,KAAKM,MAAAA,KAAS,kBAAoBF,EAAlC,gBAAAN,EAAAS,YACAP,KAAII,MAAON,UAAOU,EAClBR,KAAKE,MAAMO,SAAOX,EAAAS,YAClBP,KAAKE,MAAMM,SAGdL,OAbmD,SAAAO,GAgBhDV,KAAKU,QAAUC,EAAEhB,OAAOK,KAAKU,QAASA,GAD1CP,IAAQS,EAAkBZ,KAAAa,yBACtBb,KAAKU,IAAAA,KAALE,GAAsCF,SAAtCV,KAAAE,MAAAY,OAAA,GAAAN,UAAAR,KAAAE,MAAAM,UAAAO,MAAAxB,EAAAyB,iBACAC,EAAA,WAAIL,IAAAA,WAAAA,QACJZ,KAAKkB,cAGRC,WArBmD,WAwBhD,IAAIC,EAAOpB,KADfmB,SAAY,yBAAW,WACfC,EAAAA,eAAJC,cACQC,OAAC,SAAAC,EAATC,GACM,IAAAC,EAAeJ,EAAAA,MAAab,UAAAkB,QAAA,OAAA,KAClBC,EAAAC,OAASL,KAASC,uBAClBC,GAAAA,KAAgBvB,EAAMM,KAAAA,cAAkBiB,GAC5CR,EAAAY,KAAIF,EAAWC,EAAOE,SAAOC,GACzBjC,YAAUkC,EAAcA,WAAMC,GAChCJ,EAAKF,gBAGNO,UAHD,EAIHC,OATyB,SAAAC,EAAAC,GAU1BH,IAAAA,EAV0BG,EAAAC,KAAAC,MAWlBC,EAAA,gBAAoBpB,EAAAlB,MAAAM,UAAA,MAAAiC,EACxBhD,SAAIgD,QAAYH,SAAhBE,GAAAE,SAAA,EAAAhB,SAAA,UAMfiB,OA5CmD,SAAAjC,GA+ChDV,KAAKkB,IAAI0B,QADbD,KAAQ5C,WAAAW,IAGPG,yBAjDmDF,EAAAkC,UAoDhD,0BADJhC,+CAnDJ,6CAuDQ,WAuCD,yEACHrB,4FADJ,wJAhGJ,SA8DY,0DACI,+DACI,4BACI,8LACJ,UACJ,SACA,8CACI,uBACI,iCACI,OACI,qCACA,oCACA,oBACA,oCACJ,QACJ,WACA,oEACI,OACI,mCACA,OACI,wEACI,8FACJ,SACJ,QACA,yCACA,kCACJ,QACJ,YACJ,WACJ,SACJ,UACFsD,KAAK","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["define(['mvc/toolshed/toolshed-model', 'mvc/toolshed/util'], function(toolshed_model, toolshed_util) {\n\n    var ToolShedCategoryContentsView = Backbone.View.extend({\n\n        el: '#center',\n\n        initialize: function(params) {\n            var self = this;\n            this.model = new toolshed_model.CategoryCollection();\n            this.listenTo(this.model, 'sync', this.render);\n            var shed = params.tool_shed.replace(/\\//g, '%2f');\n            this.model.url += '?tool_shed_url=' + shed + '&category_id=' + params.category_id;\n            this.model.tool_shed = shed;\n            this.model.category = params.category_id;\n            this.model.fetch();\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var category_contents_template = this.templateCategoryContents;\n            this.$el.html(category_contents_template({category: this.model.models[0], tool_shed: this.model.tool_shed, queue: toolshed_util.queueLength()}));\n            $(\"#center\").css('overflow', 'auto');\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n            require(['libs/jquery/jquery-ui'], function() {\n                $(\"#search_box\").autocomplete({\n                    source: function(request, response) {\n                        var shed_url = that.model.tool_shed.replace(/%2f/g, '/');\n                        var base_url = Galaxy.root + 'api/tool_shed/search';\n                        var params = {term: request.term, tool_shed_url: shed_url};\n                        $.post(base_url, params, function(data) {\n                            result_list = toolshed_util.shedParser(data);\n                            response(result_list);\n                        });\n                    },\n                    minLength: 3,\n                    select: function(event, ui) {\n                        var tsr_id = ui.item.value;\n                        var new_route = 'repository/s/' + that.model.tool_shed + '/r/' + tsr_id;\n                        Backbone.history.navigate(new_route, {trigger: true, replace:true});\n                    },\n                });\n            });\n        },\n\n        reDraw: function(options){\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateCategoryContents: _.template([\n            '<style type=\"text/css\">',\n                '.ui-autocomplete { background-color: #fff; }',\n                'li.ui-menu-item { list-style-type: none; }',\n            '</style>',\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            '</div>',\n            '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n                '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n                    '<span class=\"ui-widget\" >',\n                        '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n                    '</span>',\n                '</div>',\n                '<div style=\"clear: both; margin-top: 1em;\">',\n                    '<table class=\"grid\">',\n                        '<thead id=\"grid-table-header\">',\n                            '<tr>',\n                                '<th style=\"width: 10%;\">Owner</th>',\n                                '<th style=\"width: 15%;\">Name</th>',\n                                '<th>Synopsis</th>',\n                                '<th style=\"width: 10%;\">Type</th>',\n                            '</tr>',\n                        '</thead>',\n                        '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n                            '<tr>',\n                                '<td><%= repository.owner %></td>',\n                                '<td>',\n                                    '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n                                        '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n                                    '</div>',\n                                '</td>',\n                                '<td><%= repository.description %></td>',\n                                '<td><%= repository.type %></td>',\n                            '</tr>',\n                        '<% }); %>',\n                    '</table>',\n                '</div>',\n            '</div>'\n        ].join(''))\n    });\n\n    return {\n        Category: ToolShedCategoryContentsView,\n    };\n\n});"]}