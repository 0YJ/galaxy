{"version":3,"sources":["mvc/toolshed/repositories-view.js"],"names":["define","toolshed_model","toolshed_util","Category","ToolShedCategoryContentsView","Backbone","View","el","initialize","params","this","model","listenTo","render","shed","tool_shed","replace","category_id","fetch","options","category_contents_template","category","queue","queueLength","$","css","bindEvents","source","require","that","base_url","response","term","request","tool_shed_url","result_list","shed_url","select","event","data","tsr_id","item","shedParser","new_route","ui","value","history","navigate","reDraw","$el","empty","templateCategoryContents","_","template","join"],"mappings":"kCAAAA,QAAQ,8BAA+B,qBAAsB,SACzDC,EACAC,GAqHA,OACIC,SApHAC,SAA+BC,KAASC,QACxCC,GAAAA,UAEAC,WAAAA,SAAYC,GAERC,KAAAC,MAAKA,IAAQV,EAAIA,mBACjBS,KAAAE,SAAKA,KAASD,MAAKA,OAAOD,KAAQG,QAClC,IAAAC,EAAIA,EAAOL,UAAOM,QAAUC,MAAQ,OACpCN,KAAAC,MAAKA,KAEL,kBAAAG,EAAA,gBAAAL,EAAAQ,YACAP,KAAAC,MAAKA,UAALG,EACAJ,KAAAC,MAAKA,SAALF,EAAAQ,YACHP,KAbmDC,MAAAO,SAgBhDL,OAAA,SAAKM,GACLT,KAAAS,QAAIC,EAAAA,OAAAA,KAAAA,QAA6BD,GACjC,IAAAC,EACIA,KAAAA,yBACIC,KAAAA,IAAAA,KACAN,GACAO,SAAOpB,KAAAA,MAAcqB,OAAAA,GAJ7BR,UAAAL,KAAAC,MAAAI,UAOEO,MAAFpB,EAAiBqB,iBAAjBC,EAAE,WAAWC,IAAI,WAAY,QAIjCC,KAAAA,cAGQF,WAAAA,WACIG,IAAAA,EAAAA,KACIC,SAAA,yBAAeC,WAIfL,EAAA,eAAIM,cACJH,OAAA,SAAIlB,EAASsB,GACTC,IAAAA,EAAMC,EAAAA,MADGlB,UAAAC,QAETkB,OAFS,KAKTJ,EAAIK,OAAAA,KAAcjC,uBAClB6B,GACHC,KAHDC,EAAAD,KAXsBE,cAAAE,GAiB1BC,EAAAA,KAAAA,EAAQ5B,EAAS6B,SAATC,GACJ,IAAIC,EAAYC,EAAhBC,WAAAH,GACAR,EAAIY,MAOA3B,UAAAA,EAFiCqB,OAAA,SAArCC,EAAAM,GAIH,IAAAJ,EAAAI,EAAAH,KAAAI,MA5BLF,EADJ,gBA/BgDd,EAAAlB,MAAAI,UAsDhC,MAWZyB,EACJnC,SAAAyC,QAAAC,SAAAJ,GACKnC,SAAWW,EAnEgCH,SAAA,UAmHjDgC,OAAP,SAAA7B,GAvHJT,KAAAuC,IAAAC,QAuEYxC,KAAKF,WAAWW,IAGpBgC,yBAA0BC,EAAEC,UAEpB,0BACA,+CACA,6CACA,WACA,yEACA,4FACA,wJACA,SACA,0DACA,+DACA,4BACA,8LACA,UACA,SACA,8CACA,uBACA,iCACA,OACA,qCACA,oCACA,oBACA,oCACA,QACA,WACA,oEACA,OACA,mCACA,OACA,wEACA,8FACA,SACA,QACA,yCACA,kCACA,QACA,YACA,WACA,SACA,UACFC,KAAK","file":"../../../scripts/mvc/toolshed/repositories-view.js","sourcesContent":["define([\"mvc/toolshed/toolshed-model\", \"mvc/toolshed/util\"], function(\n    toolshed_model,\n    toolshed_util\n) {\n    var ToolShedCategoryContentsView = Backbone.View.extend({\n        el: \"#center\",\n\n        initialize: function(params) {\n            var self = this;\n            this.model = new toolshed_model.CategoryCollection();\n            this.listenTo(this.model, \"sync\", this.render);\n            var shed = params.tool_shed.replace(/\\//g, \"%2f\");\n            this.model.url +=\n                \"?tool_shed_url=\" + shed + \"&category_id=\" + params.category_id;\n            this.model.tool_shed = shed;\n            this.model.category = params.category_id;\n            this.model.fetch();\n        },\n\n        render: function(options) {\n            this.options = _.extend(this.options, options);\n            var category_contents_template = this.templateCategoryContents;\n            this.$el.html(\n                category_contents_template({\n                    category: this.model.models[0],\n                    tool_shed: this.model.tool_shed,\n                    queue: toolshed_util.queueLength()\n                })\n            );\n            $(\"#center\").css(\"overflow\", \"auto\");\n            this.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this;\n            require([\"libs/jquery/jquery-ui\"], function() {\n                $(\"#search_box\").autocomplete({\n                    source: function(request, response) {\n                        var shed_url = that.model.tool_shed.replace(\n                            /%2f/g,\n                            \"/\"\n                        );\n                        var base_url = Galaxy.root + \"api/tool_shed/search\";\n                        var params = {\n                            term: request.term,\n                            tool_shed_url: shed_url\n                        };\n                        $.post(base_url, params, function(data) {\n                            var result_list = toolshed_util.shedParser(data);\n                            response(result_list);\n                        });\n                    },\n                    minLength: 3,\n                    select: function(event, ui) {\n                        var tsr_id = ui.item.value;\n                        var new_route =\n                            \"repository/s/\" +\n                            that.model.tool_shed +\n                            \"/r/\" +\n                            tsr_id;\n                        Backbone.history.navigate(new_route, {\n                            trigger: true,\n                            replace: true\n                        });\n                    }\n                });\n            });\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateCategoryContents: _.template(\n            [\n                '<style type=\"text/css\">',\n                \".ui-autocomplete { background-color: #fff; }\",\n                \"li.ui-menu-item { list-style-type: none; }\",\n                \"</style>\",\n                '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">Repositories in <%= category.get(\"name\") %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n                \"</div>\",\n                '<div class=\"unified-panel-body\" id=\"list_repositories\">',\n                '<div id=\"standard-search\" style=\"height: 2em; margin: 1em;\">',\n                '<span class=\"ui-widget\" >',\n                '<input class=\"search-box-input\" id=\"search_box\" name=\"search\" data-shedurl=\"<%= tool_shed.replace(/%2f/g, \"/\") %>\" placeholder=\"Search repositories by name or id\" size=\"60\" type=\"text\" />',\n                \"</span>\",\n                \"</div>\",\n                '<div style=\"clear: both; margin-top: 1em;\">',\n                '<table class=\"grid\">',\n                '<thead id=\"grid-table-header\">',\n                \"<tr>\",\n                '<th style=\"width: 10%;\">Owner</th>',\n                '<th style=\"width: 15%;\">Name</th>',\n                \"<th>Synopsis</th>\",\n                '<th style=\"width: 10%;\">Type</th>',\n                \"</tr>\",\n                \"</thead>\",\n                '<% _.each(category.get(\"repositories\"), function(repository) { %>',\n                \"<tr>\",\n                \"<td><%= repository.owner %></td>\",\n                \"<td>\",\n                '<div style=\"float: left; margin-left: 1px;\" class=\"menubutton split\">',\n                '<a href=\"#/repository/s/<%= tool_shed %>/r/<%= repository.id %>\"><%= repository.name %></a>',\n                \"</div>\",\n                \"</td>\",\n                \"<td><%= repository.description %></td>\",\n                \"<td><%= repository.type %></td>\",\n                \"</tr>\",\n                \"<% }); %>\",\n                \"</table>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    });\n\n    return {\n        Category: ToolShedCategoryContentsView\n    };\n});\n"]}