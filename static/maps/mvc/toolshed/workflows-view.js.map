{"version":3,"sources":["mvc/toolshed/workflows-view.js"],"names":["define","toolshed_model","toolshed_util","Workflows","Backbone","View","extend","el","defaults","options","that","this","initialize","model","render","fetch","listenTo","workflows_missing_tools","templateWorkflows","models","workflows","queue","queueLength","$","$el","bindEvents","repository_id","on","attr","api_url","Galaxy","root","tool_ids","get","toolshed","data","repository","id","params","replace","history","navigate","new_route","trigger","elem","tool_shed_url","metadata","current_changeset","current_metadata","Object","changesets","loadWorkflows","empty","_","join"],"mappings":"aAAAA,QAAQ,8BAA+B,qBAAsB,SAASC,EAAgBC,GAqHlF,OACIC,UAtHAC,SAAAC,KAAAC,QAEAD,GAAAA,UAEAE,cAEAC,WAAW,SAJiBC,GAOxB,IAAIC,EAAOC,KADfC,KAAAA,MAAY,IAAAX,EAASQ,cACjBE,KAAID,SAAOC,KAAXE,MAAA,OAAAF,KAAAG,QACAH,KAAKE,MAALE,QACAL,EAAKM,UAGRF,OAZ2B,SAAAL,GAexB,IAAIC,EAAOC,KADPM,EAAkBP,EAAAQ,kBAClBR,EAAJA,EAAAG,MAAAM,OACAT,EAAIO,IAAAA,KAAAA,GAA+BC,MAAAA,0BAAnCE,UAAAA,EAAAC,MAAAnB,EAAAoB,iBACAC,EAAA,WAAIH,IAAYV,WAAWS,QAC3BT,EAAKc,cAGRC,WArB2B,WAwBxB,IAAiBC,EAAbhB,EAAOC,KADfc,EAAAA,iBAAYE,GAAA,QAAW,WACfjB,IAAAA,EAAJa,EAAAZ,MAAAiB,KAAA,gBAAiBF,EAAjBH,EAAAZ,MAAAiB,KAAA,aACEC,EAAFC,OAAsBC,KAAS,2BACvBC,GAAAA,SAAmBJ,GACvBL,EAAAU,IAAIC,EAAWX,EAAQK,SAAKO,GACxBN,EAAUC,EAAAM,WAAcC,GACxBC,IAAAA,EAAU,gBAAdJ,EAAAK,QAAA,KAAA,OAAAA,QAAA,MAAA,OAAA,MAAAJ,EAAAC,WAAAC,GACEJ,SAAFO,QAAAC,SAAuBC,GAAeC,SAAA,EAAAJ,SAAA,QAGlCnC,EAAAA,kBAASoC,GAAAA,QAAQC,WACpB,IAJDG,EAAArB,EAAAZ,MALJqB,EAAAY,EAAAhB,KAAA,gBAWEM,EAAFU,EAAuBhB,KAAA,aACfgB,EAASd,OAAbC,KAAA,2BACIC,GAAAA,SAAqBA,GACzBT,EAAAU,IAAIC,EAAWU,EAAKhB,SAAKO,GACrBN,EAAUC,EAAAM,WAAcC,GACxBC,GAASO,cAAab,EAA1BN,cAAAA,GACEO,EAAIJ,IAAAA,EAASS,EAAQ,SAASH,GAC5BT,IACAY,EADqBF,OAAAA,KAAWC,EAAhCD,WAAAU,UACmCpB,GAC7BG,EAAiBM,EAAAC,WAAeU,SAAAC,GAClCC,EAAiBC,cAAYd,EAC7BjC,EAAI6C,WAAoBG,GACxBN,EAAII,eAIPzB,EAAA,kBAPDI,GAAA,QAAAjB,EAAAyC,gBAUR5B,OAAE,SAAAd,GAvDsBE,KAAAa,IAAA4B,QA4DxBzC,KAAKC,WAAWH,IAAhBS,kBAAAmC,EAAgB5C,UA5DQ,yEAiEpB,6DAFRS,wJA/DJ,SAoEQ,0BA+CD,2HACHf,WADJ,4GArHJ,iCA2EoB,OACI,wCACA,uCACA,mCACA,mCACA,oCACA,sCACJ,QACJ,WACA,UACI,+CACI,OACI,0BACI,8BACI,2DACI,8CACJ,YACJ,QACJ,QACA,0BACI,8BACI,uDACI,8CACJ,YACJ,QACJ,QACA,0DACA,gEACA,2DACA,0BACI,8BACI,8BACI,kRACR,QACJ,QACJ,QACJ,YACJ,QACJ,UACEmD,KAAK","file":"../../../scripts/mvc/toolshed/workflows-view.js","sourcesContent":["define(['mvc/toolshed/toolshed-model', 'mvc/toolshed/util'], function(toolshed_model, toolshed_util) {\n\n    var View = Backbone.View.extend({\n\n        el: '#center',\n\n        defaults: [{}],\n\n        initialize: function(options) {\n            var that = this;\n            this.model = new toolshed_model.WorkflowTools();\n            this.listenTo(this.model, 'sync', this.render);\n            this.model.fetch();\n            that.render();\n        },\n\n        render: function(options) {\n            var that = this;\n            var workflows_missing_tools = that.templateWorkflows;\n            var workflows = that.model.models;\n            that.$el.html(workflows_missing_tools({title: 'Workflows Missing Tools', workflows: workflows, queue: toolshed_util.queueLength()}));\n            $(\"#center\").css('overflow', 'auto');\n            that.bindEvents();\n        },\n\n        bindEvents: function() {\n            var that = this, repository_id;\n            $('.show_wf_repo').on('click', function() {\n                var tool_ids = $(this).attr('data-toolids');\n                var toolshed = $(this).attr('data-shed');\n                var api_url = Galaxy.root + 'api/tool_shed/repository'\n                var params = {'tool_ids': tool_ids};\n                $.get(api_url, params, function(data) {\n                    repository_id = data.repository.id;\n                    var new_route = 'repository/s/' + toolshed.replace(/:/g, '%3a').replace(/\\//g, '%2f') + '/r/' + data.repository.id;\n                    Backbone.history.navigate(new_route, {trigger: true, replace:true});\n                });\n             });\n            $('.queue_wf_repo').on('click', function() {\n                var elem = $(this);\n                var tool_ids = elem.attr('data-toolids');\n                var toolshed = elem.attr('data-shed');\n                var api_url = Galaxy.root + 'api/tool_shed/repository'\n                var params = {'tool_ids': tool_ids};\n                $.get(api_url, params, function(data) {\n                    repository_id = data.repository.id;\n                    params = {tool_shed_url: toolshed, repository_id: repository_id};\n                    $.get(api_url, params, function(data) {\n                        var changesets = Object.keys(data.repository.metadata);\n                        var current_changeset = changesets[0];\n                        var current_metadata = data.repository.metadata[current_changeset];\n                        current_metadata.tool_shed_url = toolshed;\n                        toolshed_util.addToQueue(current_metadata);\n                        elem.remove();\n                    });\n                });\n            });\n            $('#from_workflow').on('click', that.loadWorkflows);\n        },\n\n        reDraw: function(options) {\n            this.$el.empty();\n            this.initialize(options);\n        },\n\n        templateWorkflows: _.template([\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n                '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            '</div>',\n            '<style type=\"text/css\">',\n                '.workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }',\n            '</style>',\n            '<table id=\"workflows_missing_tools\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n                '<thead id=\"grid-table-header\">',\n                    '<tr>',\n                        '<th class=\"datasetRow\">Workflows</th>',\n                        '<th class=\"datasetRow\">Tool IDs</th>',\n                        '<th class=\"datasetRow\">Shed</th>',\n                        '<th class=\"datasetRow\">Name</th>',\n                        '<th class=\"datasetRow\">Owner</th>',\n                        '<th class=\"datasetRow\">Actions</th>',\n                    '</tr>',\n                '</thead>',\n                '<tbody>',\n                    '<% _.each(workflows, function(workflow) { %>',\n                        '<tr>',\n                            '<td class=\"datasetRow\">',\n                                '<ul class=\"workflow_names\">',\n                                    '<% _.each(workflow.get(\"workflows\"), function(name) { %>',\n                                        '<li class=\"workflow_names\"><%= name %></li>',\n                                    '<% }); %>',\n                                '</ul>',\n                            '</td>',\n                            '<td class=\"datasetRow\">',\n                                '<ul class=\"workflow_tools\">',\n                                    '<% _.each(workflow.get(\"tools\"), function(tool) { %>',\n                                        '<li class=\"workflow_tools\"><%= tool %></li>',\n                                    '<% }); %>',\n                                '</ul>',\n                            '</td>',\n                            '<td class=\"datasetRow\"><%= workflow.get(\"shed\") %></td>',\n                            '<td class=\"datasetRow\"><%= workflow.get(\"repository\") %></td>',\n                            '<td class=\"datasetRow\"><%= workflow.get(\"owner\") %></td>',\n                            '<td class=\"datasetRow\">',\n                                '<ul class=\"workflow_tools\">',\n                                    '<li class=\"workflow_tools\">',\n                                        '<input type=\"button\" class=\"show_wf_repo btn btn-primary\" data-shed=\"<%= workflow.get(\"shed\") %>\" data-owner=\"<%= workflow.get(\"owner\") %>\" data-repo=\"<%= workflow.get(\"repository\") %>\" data-toolids=\"<%= workflow.get(\"tools\").join(\",\") %>\" value=\"Show Repository\" /></li>',\n                                '</ul>',\n                            '</td>',\n                        '</tr>',\n                    '<% }); %>',\n                '</ul>',\n            '</div>',\n            ].join(''))\n    });\n\n    return {\n        Workflows: View,\n    };\n\n});"]}