{"version":3,"sources":["mvc/workflow/workflow.js"],"names":["define","Utils","build_messages","self","$el_message","$el","find","status","getQueryString","message","addClass","_","escape","html","View","Backbone","extend","initialize","this","setElement","render","$","getJSON","min_query_length","workflows","empty","append","_templateHeader","$el_workflow","_templateActionButtons","length","_templateWorkflowTable","each","wf","search_workflow","_templateNoWorkflow","confirm_delete","workflow","$el_wf_link","id","$el_shared_wf_link","click","confirm","name","$el_searchinput","min_querylen","on","query","val","regular_expression","RegExp","$el_tabletr","hide","filter","test","text","show","css","Galaxy","root","tableHtml","trHtml","_templateActions","owner","user","attributes","username","number_of_steps","published","_mainTemplate","ImportWorkflowView","slug","options","url","myexperiment_target_url"],"mappings":"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","file":"../../../scripts/mvc/workflow/workflow.js","sourcesContent":["/** Workflow view */\ndefine( [ 'utils/utils' ], function( Utils ) {\n\n    /** Build messages after user action */\n    function build_messages( self ) {\n        var $el_message = self.$el.find( '.response-message' ),\n            status = Utils.getQueryString( 'status' ),\n            message = Utils.getQueryString( 'message' );\n\n        if( message && message !== null && message !== \"\" ) {\n            $el_message.addClass( status + 'message' );\n            $el_message.html( '<p>' + _.escape( message ) + '</p>' );\n        }\n        else {\n            $el_message.html(\"\");\n        }\n    }\n \n    /** View of the main workflow list page */\n    var View = Backbone.View.extend({\n\n        initialize: function() {\n            this.setElement( '<div/>' );\n            this.render();\n        },\n\n        render: function() {\n            var self = this,\n                min_query_length = 3;\n            $.getJSON( Galaxy.root + 'api/workflows/', function( workflows ) {\n                var $el_workflow = null;\n                // Add workflow header\n                self.$el.empty().append( self._templateHeader() );\n                // Add user actions message if any\n                build_messages( self );\n                $el_workflow = self.$el.find( '.user-workflows' );\n                // Add the actions buttons\n                $el_workflow.append( self._templateActionButtons() );\n                if( workflows.length > 0) {\n                    $el_workflow.append( self._templateWorkflowTable( self, workflows) );\n                    self.adjust_actiondropdown( $el_workflow );\n                    // Register delete and run workflow events\n                    _.each( workflows, function( wf ) {\n                        self.confirm_delete( self, wf );\n                    });\n                    // Register search workflow event\n                    self.search_workflow( self, self.$el.find( '.search-wf' ), self.$el.find( '.workflow-search tr' ), min_query_length );\n                }\n                else {\n                    $el_workflow.append( self._templateNoWorkflow() );\n                }\n            });\n        },\n\n        /** Add confirm box before removing/unsharing workflow */\n        confirm_delete: function( self, workflow ) {\n            var $el_wf_link = self.$el.find( '.link-confirm-' + workflow.id ),\n                $el_shared_wf_link = self.$el.find( '.link-confirm-shared-' + workflow.id );\n            $el_wf_link.click( function() {\n                return confirm( \"Are you sure you want to delete workflow '\" + workflow.name + \"'?\" );\n            });\n            $el_shared_wf_link.click( function() {\n                return confirm( \"Are you sure you want to remove the shared workflow '\" + workflow.name + \"'?\" );\n            });\n        },\n\n        /** Implement client side workflow search/filtering */\n        search_workflow: function( self, $el_searchinput, $el_tabletr, min_querylen ) {\n            $el_searchinput.on( 'keyup', function () {\n                var query = $( this ).val();\n                // Filter when query is at least 3 characters\n                // otherwise show all rows\n                if( query.length >= min_querylen ) {\n                    // Ignore the query's case using 'i'\n                    var regular_expression = new RegExp( query, 'i' );\n                    $el_tabletr.hide();\n                    $el_tabletr.filter(function () {\n                        // Apply regular expression on each row's text\n                        // and show when there is a match\n                        return regular_expression.test( $( this ).text() );\n                    }).show();\n                }\n                else {\n                    $el_tabletr.show();\n                }\n            });\n        },\n\n        /** Ajust the position of dropdown with respect to table */\n        adjust_actiondropdown: function( $el ) {\n            $el.on( 'show.bs.dropdown', function () {\n                $el.css( \"overflow\", \"inherit\" );\n            });\n\n            $el.on( 'hide.bs.dropdown', function () {\n                $el.css( \"overflow\", \"auto\" );\n            });\n        },\n\n        /** Template for no workflow */\n        _templateNoWorkflow: function() {\n            return '<div class=\"wf-nodata\"> You have no workflows. </div>';\n        },\n\n        /** Template for actions buttons */\n        _templateActionButtons: function() {\n           return '<ul class=\"manage-table-actions\">' +\n                '<li>' +\n                    '<input class=\"search-wf form-control\" type=\"text\" autocomplete=\"off\" placeholder=\"search for workflow...\">' +\n                '</li>' +\n                '<li>' +\n                    '<a class=\"action-button fa fa-plus wf-action\" id=\"new-workflow\" title=\"Create new workflow\" href=\"'+ Galaxy.root +'workflow/create\">' +\n                    '</a>' +\n                '</li>' +\n                '<li>' +\n                    '<a class=\"action-button fa fa-upload wf-action\" id=\"import-workflow\" title=\"Upload or import workflow\" href=\"'+ Galaxy.root +'workflow/import_workflow\">' +\n                    '</a>' +\n                '</li>' +\n            '</ul>';\n        },\n\n        /** Template for workflow table */\n        _templateWorkflowTable: function( self, workflows ) {\n            var tableHtml = \"\", trHtml = \"\";\n            tableHtml = tableHtml + '<table class=\"table colored\"><thead>' +\n                    '<tr class=\"header\">' +\n                        '<th>Name</th>' +\n                        '<th>Owner</th>' +\n                        '<th># of Steps</th>' +\n                        '<th>Published</th>' +\n                    '</tr></thead>';\n            _.each( workflows, function( wf ) {\n                trHtml = trHtml + '<tr>' +\n                             '<td>' +\n                                 '<div class=\"dropdown\">' +\n                                     '<button class=\"menubutton\" type=\"button\" data-toggle=\"dropdown\">' +\n                                         _.escape( wf.name ) + '<span class=\"caret\"></span>' +\n                                     '</button>' +\n                                     self._templateActions( wf ) +\n                                 '</div>' +\n                              '</td>' +\n                              '<td>' + ( wf.owner === Galaxy.user.attributes.username ? \"You\" : wf.owner ) +'</td>' +\n                              '<td>' + wf.number_of_steps + '</td>' +\n                              '<td>' + ( wf.published ? \"Yes\" : \"No\" ) + '</td>' +\n                         '</tr>';\n            });\n            return tableHtml + '<tbody class=\"workflow-search\">' + trHtml + '</tbody></table>';\n        },\n\n        /** Template for user actions for workflows */\n        _templateActions: function( workflow ) {\n            if( workflow.owner === Galaxy.user.attributes.username ) {\n                return '<ul class=\"dropdown-menu action-dpd\">' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/editor?id='+ workflow.id +'\">Edit</a></li>' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/run?id='+ workflow.id +'\">Run</a></li>' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/sharing?id='+ workflow.id +'\">Share or Download</a></li>' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/copy?id='+ workflow.id +'\">Copy</a></li>' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/rename?id='+ workflow.id +'\">Rename</a></li>' +\n                           '<li><a href=\"'+ Galaxy.root +'workflow/display_by_id?id='+ workflow.id +'\">View</a></li>' +\n                           '<li><a class=\"link-confirm-'+ workflow.id +'\" href=\"'+ Galaxy.root +'workflow/delete?id='+ workflow.id +'\">Delete</a></li>' +\n                      '</ul>';\n            }\n            else {\n                return '<ul class=\"dropdown-menu action-dpd\">' +\n                         '<li><a href=\"'+ Galaxy.root +'workflow/display_by_username_and_slug?username='+ workflow.owner +'&slug='+ workflow.slug +'\">View</a></li>' +\n                         '<li><a href=\"'+ Galaxy.root +'workflow/run?id='+ workflow.id +'\">Run</a></li>' +\n                         '<li><a href=\"'+ Galaxy.root +'workflow/copy?id='+ workflow.id +'\">Copy</a></li>' +\n                         '<li><a class=\"link-confirm-shared-'+ workflow.id +'\" href=\"'+ Galaxy.root +'workflow/sharing?unshare_me=True&id='+ workflow.id +'\">Remove</a></li>' +\n                      '</ul>';\n            }\n        },\n\n        /** Main template */\n        _templateHeader: function() {\n            return '<div class=\"page-container\">' +\n                       '<div class=\"user-workflows wf\">' +\n                           '<div class=\"response-message\"></div>' +\n                           '<h2>Your workflows</h2>' +\n                       '</div>'+\n                   '</div>';\n        }\n    });\n\n    var ImportWorkflowView = Backbone.View.extend({\n\n        initialize: function() {\n            this.setElement( '<div/>' );\n            this.render();\n        },\n\n        /** Open page to import workflow */\n        render: function() {\n            var self = this;\n            $.getJSON( Galaxy.root + 'workflow/upload_import_workflow', function( options ) {\n                self.$el.empty().append( self._mainTemplate( self, options ) );\n            });\n        },\n\n        /** Template for the import workflow page */\n        _mainTemplate: function( self, options ) {\n            return \"<div class='toolForm'>\" +\n                       \"<div class='toolFormTitle'>Import Galaxy workflow</div>\" +\n                        \"<div class='toolFormBody'>\" +\n                            \"<form name='import_workflow' id='import_workflow' action='\"+ Galaxy.root + 'workflow/upload_import_workflow' +\"' enctype='multipart/form-data' method='POST'>\" +\n                            \"<div class='form-row'>\" +\n                                \"<label>Galaxy workflow URL:</label>\" + \n                                \"<input type='text' name='url' class='input-url' value='\"+ options.url +\"' size='40'>\" +\n                                \"<div class='toolParamHelp' style='clear: both;'>\" +\n                                    \"If the workflow is accessible via a URL, enter the URL above and click <b>Import</b>.\" +\n                                \"</div>\" +\n                                \"<div style='clear: both'></div>\" +\n                            \"</div>\" +\n                            \"<div class='form-row'>\" +\n                                \"<label>Galaxy workflow file:</label>\" +\n                            \"<div class='form-row-input'>\" +\n                                \"<input type='file' name='file_data' class='input-file'/>\" +\n                            \"</div>\" +\n                            \"<div class='toolParamHelp' style='clear: both;'>\" +\n                                \"If the workflow is in a file on your computer, choose it and then click <b>Import</b>.\" +\n                            \"</div>\" +\n                            \"<div style='clear: both'></div>\" +\n                            \"</div>\" +\n                            \"<div class='form-row'>\" +\n                                \"<input type='submit' class='primary-button wf-import' name='import_button' value='Import'>\" +\n                            \"</div>\" +\n                            \"</form>\" +\n                           \"<hr/>\" +\n                           \"<div class='form-row'>\" +\n                               \"<label>Import a Galaxy workflow from myExperiment:</label>\" +\n                               \"<div class='form-row-input'>\" +\n                                   \"<a href='\" + options.myexperiment_target_url + \"'> Visit myExperiment</a>\" +\n                               \"</div>\" +\n                               \"<div class='toolParamHelp' style='clear: both;'>\" +\n                                   \"Click the link above to visit myExperiment and browse for Galaxy workflows.\" +\n                               \"</div>\" +\n                               \"<div style='clear: both'></div>\" +\n                           \"</div>\" +\n                       \"</div>\" +\n                   \"</div>\";\n        },\n\n    });\n\n    return {\n        View  : View,\n        ImportWorkflowView : ImportWorkflowView\n    };\n});\n"]}