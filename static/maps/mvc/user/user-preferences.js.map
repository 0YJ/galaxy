{"version":3,"sources":["mvc/user/user-preferences.js"],"names":["define","Form","Ui","QueryStringParsing","Model","Backbone","extend","initialize","options","user_id","Galaxy","user","id","information","title","description","url","redirect","icon","submit_icon","location","href","root","custom_builds","logout","modal","show","onclick","body","hide","buttons","window","session_csrf_token","View","this","model","setElement","render","self","config","$","getJSON","data","$preferences","addClass","append","_","escape","email","$table","get","message","Message","status","$el","_addLink","enable_communication_server","has_user_tool_filters","use_remote_user","_templateFooter","action","$row","_templateLink","find","$a","nice_total_disk_usage","enable_quotas","quota"],"mappings":"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","file":"../../../scripts/mvc/user/user-preferences.js","sourcesContent":["/** User Preferences view */\ndefine( [ 'mvc/form/form-view', 'mvc/ui/ui-misc', 'utils/query-string-parsing' ], function( Form, Ui, QueryStringParsing ) {\n\n    /** Contains descriptive dictionaries describing user forms */\n    var Model = Backbone.Model.extend({\n        initialize: function( options ) {\n            options = options || {};\n            options.user_id = options.user_id || Galaxy.user.id;\n            this.set({\n                'user_id'           : options.user_id,\n                'information': {\n                    title           : 'Manage information',\n                    description     : 'Edit your email, addresses and custom parameters or change your username.',\n                    url             : 'api/users/' + options.user_id + '/information/inputs',\n                    icon            : 'fa-user',\n                    redirect        : 'user'\n                },\n                'password': {\n                    title           : 'Change password',\n                    description     : 'Allows you to change your login credentials.',\n                    icon            : 'fa-unlock-alt',\n                    url             : 'api/users/' + options.user_id + '/password/inputs',\n                    submit_title    : 'Save password',\n                    redirect        : 'user'\n                },\n                'communication': {\n                    title           : 'Change communication settings',\n                    description     : 'Enable or disable the communication feature to chat with other users.',\n                    url             : 'api/users/' + options.user_id + '/communication/inputs',\n                    icon            : 'fa-comments-o',\n                    redirect        : 'user'\n                },\n                'permissions': {\n                    title           : 'Set dataset permissions for new histories',\n                    description     : 'Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.',\n                    url             : 'api/users/' + options.user_id + '/permissions/inputs',\n                    icon            : 'fa-users',\n                    submit_title    : 'Save permissions',\n                    redirect        : 'user'\n                },\n                'api_key': {\n                    title           : 'Manage API key',\n                    description     : 'Access your current API key or create a new one.',\n                    url             : 'api/users/' + options.user_id + '/api_key/inputs',\n                    icon            : 'fa-key',\n                    submit_title    : 'Create a new key',\n                    submit_icon     : 'fa-check'\n                },\n                'toolbox_filters': {\n                    title           : 'Manage Toolbox filters',\n                    description     : 'Customize your Toolbox by displaying or omitting sets of Tools.',\n                    url             : 'api/users/' + options.user_id + '/toolbox_filters/inputs',\n                    icon            : 'fa-filter',\n                    submit_title    : 'Save filters',\n                    redirect        : 'user'\n                },\n                'openids': {\n                    title           : 'Manage OpenIDs',\n                    description     : 'Associate OpenIDs with your account.',\n                    icon            : 'fa-openid',\n                    onclick         : function() {\n                        window.location.href = Galaxy.root + 'user/openid_manage?cntrller=user&use_panels=True';\n                    }\n                },\n                'custom_builds': {\n                    title           : 'Manage custom builds',\n                    description     : 'Add or remove custom builds using history datasets.',\n                    icon            : 'fa-cubes',\n                    onclick         : function() {\n                        window.location.href = Galaxy.root + 'custom_builds';\n                    }\n                },\n                'logout': {\n                    title           : 'Sign out',\n                    description     : 'Click here to sign out of all sessions.',\n                    icon            : 'fa-sign-out',\n                    onclick         : function() {\n                        Galaxy.modal.show({\n                            title   : 'Sign out',\n                            body    : 'Do you want to continue and sign out of all active sessions?',\n                            buttons : {\n                                'Cancel'    : function() { Galaxy.modal.hide(); },\n                                'Sign out'  : function() { window.location.href = Galaxy.root + 'user/logout?session_csrf_token=' + Galaxy.session_csrf_token; }\n                            }\n                        });\n                    }\n                }\n            });\n        }\n    });\n\n    /** View of the main user preference panel with links to individual user forms */\n    var View = Backbone.View.extend({\n        title: \"User Preferences\",\n        initialize: function() {\n            this.model = new Model();\n            this.setElement( '<div/>' );\n            this.render();\n        },\n\n        render: function() {\n            var self = this;\n            var config = Galaxy.config;\n            $.getJSON( Galaxy.root + 'api/users/' + Galaxy.user.id, function( data ) {\n                self.$preferences = $( '<div/>' ).addClass( 'ui-panel' )\n                                                 .append( $( '<h2/>' ).append( 'User preferences' ) )\n                                                 .append( $( '<p/>' ).append( 'You are logged in as <strong>' +  _.escape( data.email ) + '</strong>.' ) )\n                                                 .append( self.$table = $( '<table/>' ).addClass( 'ui-panel-table' ) );\n                var message = QueryStringParsing.get( 'message' );\n                var status  = QueryStringParsing.get( 'status' );\n                if( message && status ) {\n                    self.$preferences.prepend( ( new Ui.Message( { message: message, status: status } ) ).$el );\n                }\n                if( !config.use_remote_user ) {\n                    self._addLink( 'information' );\n                    self._addLink( 'password' );\n                }\n                if( config.enable_communication_server ) {\n                    self._addLink( 'communication' );\n                }\n                self._addLink( 'custom_builds' );\n                self._addLink( 'permissions' );\n                self._addLink( 'api_key' );\n                if( config.has_user_tool_filters ) {\n                    self._addLink( 'toolbox_filters' );\n                }\n                if( config.enable_openid && !config.use_remote_user ) {\n                    self._addLink( 'openids' );\n                }\n                if(Galaxy.session_csrf_token) {\n                    self._addLink( 'logout' );\n                }\n                self.$preferences.append( self._templateFooter( data ) );\n                self.$el.empty().append( self.$preferences );\n            });\n        },\n\n        _addLink: function( action ) {\n            var options = this.model.get( action );\n            var $row =   $( this._templateLink( options ) );\n            var $a = $row.find( 'a' );\n            if ( options.onclick ) {\n                $a.on( 'click', function() { options.onclick() } );\n            } else {\n                $a.attr( 'href', Galaxy.root + 'user/' + action );\n            }\n            this.$table.append( $row );\n        },\n\n        _templateLink: function( options ) {\n            return  '<tr>' +\n                        '<td>' +\n                            '<div class=\"ui-panel-icon fa ' + options.icon + '\">' +\n                        '</td>' +\n                        '<td>' +\n                            '<a class=\"ui-panel-anchor\" href=\"javascript:void(0)\">' + options.title + '</a>' +\n                            '<div class=\"ui-form-info\">' + options.description + '</div>' +\n                        '</td>' +\n                    '</tr>';\n        },\n\n        _templateFooter: function( options ) {\n            return  '<p class=\"ui-panel-footer\">' +\n                        'You are using <strong>' + options.nice_total_disk_usage + '</strong> of disk space in this Galaxy instance. ' +\n                        ( Galaxy.config.enable_quotas ? 'Your disk quota is: <strong>' + options.quota + '</strong>. ' : '' ) +\n                        'Is your usage more than expected? See the <a href=\"https://galaxyproject.org/learn/managing-datasets/\" target=\"_blank\">documentation</a> for tips on how to find all of the data in your account.' +\n                    '</p>';\n        }\n    });\n\n    return {\n        View  : View,\n        Model : Model\n    };\n});\n"]}