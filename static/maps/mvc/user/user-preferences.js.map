{"version":3,"sources":["mvc/user/user-preferences.js"],"names":["_formView","require","_uiMisc","_queryStringParsing","Model","Backbone","extend","initialize","options","user_id","Galaxy","user","id","this","set","information","title","description","url","icon","redirect","password","submit_title","communication","permissions","api_key","submit_icon","toolbox_filters","location","href","root","openids","onclick","logout","custom_builds","modal","show","window","body","buttons","Cancel","hide","Sign out","session_csrf_token","View","model","setElement","render","self","config","$","getJSON","data","$preferences","addClass","append","escape","email","$table","_addLink","get","message","status","enable_communication_server","$el","has_user_tool_filters","enable_openid","use_remote_user","$a","$row","_templateFooter","action","_templateLink","on","attr","nice_total_disk_usage","enable_quotas","quota"],"mappings":"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","file":"../../../scripts/mvc/user/user-preferences.js","sourcesContent":["/** User Preferences view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport QueryStringParsing from \"utils/query-string-parsing\";\n/** Contains descriptive dictionaries describing user forms */\nvar Model = Backbone.Model.extend({\n    initialize: function(options) {\n        options = options || {};\n        options.user_id = options.user_id || Galaxy.user.id;\n        this.set({\n            user_id: options.user_id,\n            information: {\n                title: \"Manage information\",\n                description:\n                    \"Edit your email, addresses and custom parameters or change your username.\",\n                url: \"api/users/\" + options.user_id + \"/information/inputs\",\n                icon: \"fa-user\",\n                redirect: \"user\"\n            },\n            password: {\n                title: \"Change password\",\n                description: \"Allows you to change your login credentials.\",\n                icon: \"fa-unlock-alt\",\n                url: \"api/users/\" + options.user_id + \"/password/inputs\",\n                submit_title: \"Save password\",\n                redirect: \"user\"\n            },\n            communication: {\n                title: \"Change communication settings\",\n                description:\n                    \"Enable or disable the communication feature to chat with other users.\",\n                url: \"api/users/\" + options.user_id + \"/communication/inputs\",\n                icon: \"fa-comments-o\",\n                redirect: \"user\"\n            },\n            permissions: {\n                title: \"Set dataset permissions for new histories\",\n                description:\n                    \"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.\",\n                url: \"api/users/\" + options.user_id + \"/permissions/inputs\",\n                icon: \"fa-users\",\n                submit_title: \"Save permissions\",\n                redirect: \"user\"\n            },\n            api_key: {\n                title: \"Manage API key\",\n                description: \"Access your current API key or create a new one.\",\n                url: \"api/users/\" + options.user_id + \"/api_key/inputs\",\n                icon: \"fa-key\",\n                submit_title: \"Create a new key\",\n                submit_icon: \"fa-check\"\n            },\n            toolbox_filters: {\n                title: \"Manage Toolbox filters\",\n                description:\n                    \"Customize your Toolbox by displaying or omitting sets of Tools.\",\n                url: \"api/users/\" + options.user_id + \"/toolbox_filters/inputs\",\n                icon: \"fa-filter\",\n                submit_title: \"Save filters\",\n                redirect: \"user\"\n            },\n            openids: {\n                title: \"Manage OpenIDs\",\n                description: \"Associate OpenIDs with your account.\",\n                icon: \"fa-openid\",\n                onclick: function() {\n                    window.location.href =\n                        Galaxy.root +\n                        \"user/openid_manage?cntrller=user&use_panels=True\";\n                }\n            },\n            custom_builds: {\n                title: \"Manage custom builds\",\n                description:\n                    \"Add or remove custom builds using history datasets.\",\n                icon: \"fa-cubes\",\n                onclick: function() {\n                    window.location.href = Galaxy.root + \"custom_builds\";\n                }\n            },\n            logout: {\n                title: \"Sign out\",\n                description: \"Click here to sign out of all sessions.\",\n                icon: \"fa-sign-out\",\n                onclick: function() {\n                    Galaxy.modal.show({\n                        title: \"Sign out\",\n                        body:\n                            \"Do you want to continue and sign out of all active sessions?\",\n                        buttons: {\n                            Cancel: function() {\n                                Galaxy.modal.hide();\n                            },\n                            \"Sign out\": function() {\n                                window.location.href =\n                                    Galaxy.root +\n                                    \"user/logout?session_csrf_token=\" +\n                                    Galaxy.session_csrf_token;\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    }\n});\n\n/** View of the main user preference panel with links to individual user forms */\nvar View = Backbone.View.extend({\n    title: \"User Preferences\",\n    initialize: function() {\n        this.model = new Model();\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        var config = Galaxy.config;\n        $.getJSON(Galaxy.root + \"api/users/\" + Galaxy.user.id, function(data) {\n            self.$preferences = $(\"<div/>\")\n                .addClass(\"ui-panel\")\n                .append($(\"<h2/>\").append(\"User preferences\"))\n                .append(\n                    $(\"<p/>\").append(\n                        \"You are logged in as <strong>\" +\n                            _.escape(data.email) +\n                            \"</strong>.\"\n                    )\n                )\n                .append(\n                    (self.$table = $(\"<table/>\").addClass(\"ui-panel-table\"))\n                );\n            var message = QueryStringParsing.get(\"message\");\n            var status = QueryStringParsing.get(\"status\");\n            if (message && status) {\n                self.$preferences.prepend(\n                    new Ui.Message({ message: message, status: status }).$el\n                );\n            }\n            if (!config.use_remote_user) {\n                self._addLink(\"information\");\n                self._addLink(\"password\");\n            }\n            if (config.enable_communication_server) {\n                self._addLink(\"communication\");\n            }\n            self._addLink(\"custom_builds\");\n            self._addLink(\"permissions\");\n            self._addLink(\"api_key\");\n            if (config.has_user_tool_filters) {\n                self._addLink(\"toolbox_filters\");\n            }\n            if (config.enable_openid && !config.use_remote_user) {\n                self._addLink(\"openids\");\n            }\n            if (Galaxy.session_csrf_token) {\n                self._addLink(\"logout\");\n            }\n            self.$preferences.append(self._templateFooter(data));\n            self.$el.empty().append(self.$preferences);\n        });\n    },\n\n    _addLink: function(action) {\n        var options = this.model.get(action);\n        var $row = $(this._templateLink(options));\n        var $a = $row.find(\"a\");\n        if (options.onclick) {\n            $a.on(\"click\", function() {\n                options.onclick();\n            });\n        } else {\n            $a.attr(\"href\", Galaxy.root + \"user/\" + action);\n        }\n        this.$table.append($row);\n    },\n\n    _templateLink: function(options) {\n        return (\n            \"<tr>\" +\n            \"<td>\" +\n            '<div class=\"ui-panel-icon fa ' +\n            options.icon +\n            '\">' +\n            \"</td>\" +\n            \"<td>\" +\n            '<a class=\"ui-panel-anchor\" href=\"javascript:void(0)\">' +\n            options.title +\n            \"</a>\" +\n            '<div class=\"ui-form-info\">' +\n            options.description +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    },\n\n    _templateFooter: function(options) {\n        return (\n            '<p class=\"ui-panel-footer\">' +\n            \"You are using <strong>\" +\n            options.nice_total_disk_usage +\n            \"</strong> of disk space in this Galaxy instance. \" +\n            (Galaxy.config.enable_quotas\n                ? \"Your disk quota is: <strong>\" + options.quota + \"</strong>. \"\n                : \"\") +\n            'Is your usage more than expected? See the <a href=\"https://galaxyproject.org/learn/managing-datasets/\" target=\"_blank\">documentation</a> for tips on how to find all of the data in your account.' +\n            \"</p>\"\n        );\n    }\n});\n\nexport default {\n    View: View,\n    Model: Model\n};\n"]}