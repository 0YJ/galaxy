{"version":3,"sources":["mvc/upload/composite/composite-row.js"],"names":["_utils","require","_uploadSettings","_uploadFtp","_uiPopover","_uiMisc","_uiSelect","Backbone","View","extend","status_classes","init","ready","running","success","error","initialize","app","options","self","this","model","setElement","_template","$source","$","$settings","$status","$text","$text_content","$info_text","$info_progress","$file_name","$file_desc","$file_size","$progress_bar","$percentage","$el","uploadinput","get","addClass","removeClass","files","length","reset","file_data","file_name","name","size","file_mode","mode","_refreshReady","button_menu","_uiMisc2","default","ButtonMenu","icon","ondragover","ondragleave","onchange","onclick","file_size","_showFtp","addMenu","title","pull","ftp","_uiPopover2","container","find","settings","placement","e","target","val","on","preventDefault","_refreshPercentage","listenTo","url_paste","_refreshFileName","remove","render","_refreshInfo","id","html","_","escape","bytesToString","prototype","apply","collection","each","attr","height","css","width","top","show","trigger","hide","info","percentage","parseInt","offsetHeight","_refreshStatus","status","set","_refreshFileSize","visible","empty","append","_uploadFtp2","ftp_upload_site","ftp_file","path","file_path","_showSettings","_uploadSettings2"],"mappings":"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","file":"../../../../scripts/mvc/upload/composite/composite-row.js","sourcesContent":["/** Renders the composite upload row view */\nimport Utils from \"utils/utils\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport UploadFtp from \"mvc/upload/upload-ftp\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Select from \"mvc/ui/ui-select\";\nimport \"utils/uploadbox\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-mode fa fa-exclamation text-primary\",\n        ready: \"upload-mode fa fa-check text-success\",\n        running: \"upload-mode fa fa-spinner fa-spin\",\n        success: \"upload-mode fa fa-check\",\n        error: \"upload-mode fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$source = this.$(\".upload-source\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$status = this.$(\".upload-status\");\n        this.$text = this.$(\".upload-text\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$file_name = this.$(\".upload-file-name\");\n        this.$file_desc = this.$(\".upload-file-desc\");\n        this.$file_size = this.$(\".upload-file-size\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // build upload functions\n        this.uploadinput = this.$el.uploadinput({\n            ondragover: function() {\n                self.model.get(\"enabled\") && self.$el.addClass(\"warning\");\n            },\n            ondragleave: function() {\n                self.$el.removeClass(\"warning\");\n            },\n            onchange: function(files) {\n                if (\n                    self.model.get(\"status\") != \"running\" &&\n                    files &&\n                    files.length > 0\n                ) {\n                    self.model.reset({\n                        file_data: files[0],\n                        file_name: files[0].name,\n                        file_size: files[0].size,\n                        file_mode: files[0].mode || \"local\"\n                    });\n                    self._refreshReady();\n                }\n            }\n        });\n\n        // source selection popup\n        this.button_menu = new Ui.ButtonMenu({\n            icon: \"fa-caret-down\",\n            title: \"Select\",\n            pull: \"left\"\n        });\n        this.$source.append(this.button_menu.$el);\n        this.button_menu.addMenu({\n            icon: \"fa-laptop\",\n            title: \"Choose local file\",\n            onclick: function() {\n                self.uploadinput.dialog();\n            }\n        });\n        if (this.app.ftp_upload_site) {\n            this.button_menu.addMenu({\n                icon: \"fa-folder-open-o\",\n                title: \"Choose FTP file\",\n                onclick: function() {\n                    self._showFtp();\n                }\n            });\n        }\n        this.button_menu.addMenu({\n            icon: \"fa-edit\",\n            title: \"Paste/Fetch data\",\n            onclick: function() {\n                self.model.reset({\n                    file_mode: \"new\",\n                    file_name: \"New File\"\n                });\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title: \"Choose FTP file:\",\n            container: this.$source.find(\".ui-button-menu\"),\n            placement: \"right\"\n        });\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$settings,\n            placement: \"bottom\"\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function(e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n            self._refreshReady();\n        });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", function(e) {\n                self._showSettings();\n            })\n            .on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function() {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function() {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function() {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_name\", function() {\n            self._refreshFileName();\n        });\n        this.listenTo(this.model, \"change:file_mode\", function() {\n            self._refreshMode();\n        });\n        this.listenTo(this.model, \"change:file_size\", function() {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", function() {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", function() {\n            self.remove();\n        });\n    },\n\n    render: function() {\n        this.$el.attr(\"id\", \"upload-row-\" + this.model.id);\n        this.$file_name.html(_.escape(this.model.get(\"file_name\") || \"-\"));\n        this.$file_desc.html(this.model.get(\"file_desc\") || \"Unavailable\");\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n        this.$status.removeClass().addClass(this.status_classes.init);\n    },\n\n    /** Remove view */\n    remove: function() {\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    /** Refresh ready or not states */\n    _refreshReady: function() {\n        this.app.collection.each(function(model) {\n            model.set(\n                \"status\",\n                (model.get(\"file_size\") > 0 && \"ready\") || \"init\"\n            );\n        });\n    },\n\n    /** Refresh mode and e.g. show/hide textarea field */\n    _refreshMode: function() {\n        var file_mode = this.model.get(\"file_mode\");\n        if (file_mode == \"new\") {\n            this.height = this.$el.height();\n            this.$text\n                .css({\n                    width: this.$el.width() - 16 + \"px\",\n                    top: this.$el.height() - 8 + \"px\"\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$text_content.val(\"\").trigger(\"keyup\");\n        } else {\n            this.$el.height(this.height);\n            this.$text.hide();\n        }\n    },\n\n    /** Refresh information */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        if (percentage != 0) {\n            this.$progress_bar.css({ width: percentage + \"%\" });\n        } else {\n            this.$progress_bar.addClass(\"no-transition\");\n            this.$progress_bar.css({ width: \"0%\" });\n            this.$progress_bar[0].offsetHeight;\n            this.$progress_bar.removeClass(\"no-transition\");\n        }\n        this.$percentage.html(\n            percentage != 100 ? percentage + \"%\" : \"Adding to history...\"\n        );\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$status.removeClass().addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status != \"running\");\n        this.$text_content.attr(\"disabled\", !this.model.get(\"enabled\"));\n        this.$el.removeClass(\"success danger warning\");\n        if (status == \"running\" || status == \"ready\") {\n            this.model.set(\"percentage\", 0);\n        }\n        this.$source\n            .find(\".button\")\n            [status == \"running\" ? \"addClass\" : \"removeClass\"](\"disabled\");\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.model.set(\"percentage\", 100);\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.model.set(\"percentage\", 0);\n            this.$info_progress.hide();\n            this.$info_text.show();\n        } else {\n            this.$info_progress.show();\n            this.$info_text.hide();\n        }\n    },\n\n    /** File name */\n    _refreshFileName: function() {\n        this.$file_name.html(this.model.get(\"file_name\") || \"-\");\n    },\n\n    /** File size */\n    _refreshFileSize: function() {\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Show/hide ftp popup */\n    _showFtp: function() {\n        if (!this.ftp.visible) {\n            var self = this;\n            this.ftp.empty();\n            this.ftp.append(\n                new UploadFtp({\n                    ftp_upload_site: this.app.ftp_upload_site,\n                    onchange: function(ftp_file) {\n                        self.ftp.hide();\n                        if (self.model.get(\"status\") != \"running\" && ftp_file) {\n                            self.model.reset({\n                                file_mode: \"ftp\",\n                                file_name: ftp_file.path,\n                                file_size: ftp_file.size,\n                                file_path: ftp_file.path\n                            });\n                            self._refreshReady();\n                        }\n                    }\n                }).$el\n            );\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Show/hide settings popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<tr class=\"upload-row\">' +\n            \"<td>\" +\n            '<div class=\"upload-source\"/>' +\n            '<div class=\"upload-text-column\">' +\n            '<div class=\"upload-text\">' +\n            '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n            '<textarea class=\"upload-text-content form-control\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-status\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-desc upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-name upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-size upload-size\"/>' +\n            \"</td>\" +\n            '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n            \"<td>\" +\n            '<div class=\"upload-info\">' +\n            '<div class=\"upload-info-text\"/>' +\n            '<div class=\"upload-info-progress progress\">' +\n            '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n            '<div class=\"upload-percentage\">0%</div>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    }\n});\n"]}