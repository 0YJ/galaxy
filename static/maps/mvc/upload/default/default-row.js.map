{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["define","Utils","UploadModel","UploadSettings","Popover","Select","Backbone","View","extend","status_classes","init","queued","running","success","initialize","app","options","this","self","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","$progress_bar","settings","title","container","default_genome","select_genome","value","css","list_genomes","data","genome","set","select_extension","list_extensions","default_extension","extension","on","_removeRow","e","showExtensionInfo","target","text","preventDefault","$el","_showSettings","url_paste","val","file_size","length","_refreshPercentage","listenTo","_refreshStatus","_refreshInfo","_refreshGenome","_refreshExtension","_refreshFileSize","remove","render","attributes","_","file_name","removeClass","addClass","file_mode","width","top","height","show","prototype","apply","get","escape","info","percentage","parseInt","status","enabled","attr","enable","disable","html","$percentage","hide","bytesToString","indexOf","visible","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\ndefine( [ 'utils/utils', 'mvc/upload/upload-model', 'mvc/upload/upload-settings', 'mvc/ui/ui-popover', 'mvc/ui/ui-select' ],\nfunction( Utils, UploadModel, UploadSettings, Popover, Select ) {\n    return Backbone.View.extend({\n        /** Dictionary of upload states and associated icons */\n        status_classes : {\n            init    : 'upload-icon-button fa fa-trash-o',\n            queued  : 'upload-icon fa fa-spinner fa-spin',\n            running : 'upload-icon fa fa-spinner fa-spin',\n            success : 'upload-icon-button fa fa-check',\n            error   : 'upload-icon-button fa fa-exclamation-triangle'\n        },\n\n        initialize: function( app, options ) {\n            var self = this;\n            this.app = app;\n            this.model = options.model;\n            this.setElement( this._template( options.model ) );\n            this.$mode          = this.$( '.upload-mode' );\n            this.$title         = this.$( '.upload-title' );\n            this.$text          = this.$( '.upload-text' );\n            this.$size          = this.$( '.upload-size' );\n            this.$info_text     = this.$( '.upload-info-text' );\n            this.$info_progress = this.$( '.upload-info-progress' );\n            this.$text_content  = this.$( '.upload-text-content' );\n            this.$settings      = this.$( '.upload-settings' );\n            this.$symbol        = this.$( '.upload-symbol' );\n            this.$progress_bar  = this.$( '.upload-progress-bar' );\n            this.$percentage    = this.$( '.upload-percentage' );\n\n            // append popup to settings icon\n            this.settings = new Popover.View({\n                title       : 'Upload configuration',\n                container   : this.$( '.upload-settings' ),\n                placement   : 'bottom'\n            });\n\n            // identify default genome and extension values\n            var default_genome      = this.app.select_genome.value();\n            var default_extension   = this.app.select_extension.value();\n\n            // create select genomes\n            this.select_genome = new Select.View({\n                css         : 'upload-genome',\n                data        : self.app.list_genomes,\n                container   : this.$( '.upload-genome' ),\n                value       : default_genome,\n                onchange    : function( genome ) { self.model.set( 'genome', genome ) }\n            });\n\n            // create select extension\n            this.select_extension = new Select.View({\n                css         : 'upload-extension',\n                data        : self.app.list_extensions,\n                container   : this.$( '.upload-extension' ),\n                value       : default_extension,\n                onchange    : function( extension ) { self.model.set('extension', extension) }\n            });\n\n            // initialize genome and extension values\n            this.model.set( { 'genome': default_genome, 'extension': default_extension } );\n\n            // handle click event\n            this.$symbol.on('click', function() { self._removeRow(); });\n\n            // handle extension info popover\n            this.$( '.upload-extension-info' ).on( 'click' , function( e ) {\n                self.app.showExtensionInfo({\n                    $el         : $( e.target ),\n                    title       : self.select_extension.text(),\n                    extension   : self.select_extension.value()\n                });\n            }).on( 'mousedown', function( e ) { e.preventDefault() } );\n\n            // handle settings popover\n            this.$settings.on( 'click' ,    function( e ) { self._showSettings() } )\n                          .on( 'mousedown', function( e ) { e.preventDefault() });\n\n            // handle text editing event\n            this.$text_content.on( 'change input', function( e ) {\n                self.model.set( { 'url_paste': $( e.target ).val(),\n                                  'file_size': $( e.target ).val().length } );\n            });\n\n            // model events\n            this.listenTo( this.model, 'change:percentage',  function() { self._refreshPercentage() } );\n            this.listenTo( this.model, 'change:status',      function() { self._refreshStatus() } );\n            this.listenTo( this.model, 'change:info',        function() { self._refreshInfo() } );\n            this.listenTo( this.model, 'change:genome',      function() { self._refreshGenome() } );\n            this.listenTo( this.model, 'change:extension',   function() { self._refreshExtension() } );\n            this.listenTo( this.model, 'change:file_size',   function() { self._refreshFileSize() } );\n            this.listenTo( this.model, 'remove',             function() { self.remove() } );\n            this.app.collection.on('reset', function() { self.remove() } );\n        },\n\n        render: function() {\n            var options = this.model.attributes;\n            this.$title.html( _.escape( options.file_name ) );\n            this.$size.html( Utils.bytesToString ( options.file_size ) );\n            this.$mode.removeClass().addClass( 'upload-mode' ).addClass( 'text-primary' );\n            if ( options.file_mode == 'new' ) {\n                this.$text.css( { 'width' : this.$el.width() - 16 + 'px', 'top'  : this.$el.height() - 8 + 'px' } ).show();\n                this.$el.height( this.$el.height() - 8 + this.$text.height() + 16 );\n                this.$mode.addClass( 'fa fa-edit' );\n            } else if ( options.file_mode == 'local' ) {\n                this.$mode.addClass( 'fa fa-laptop' );\n            } else if ( options.file_mode == 'ftp' ) {\n                this.$mode.addClass( 'fa fa-folder-open-o' );\n            }\n        },\n\n        /** Remove view */\n        remove: function() {\n            this.select_genome.remove();\n            this.select_extension.remove();\n            Backbone.View.prototype.remove.apply( this );\n        },\n\n        /** Update extension */\n        _refreshExtension: function() {\n            this.select_extension.value( this.model.get( 'extension' ) );\n        },\n\n        /** Update genome */\n        _refreshGenome: function() {\n            this.select_genome.value( this.model.get( 'genome' ) );\n        },\n\n        /** Refresh info text */\n        _refreshInfo: function() {\n            var info = this.model.get( 'info' );\n            if ( info ) {\n                this.$info_text.html( '<strong>Failed: </strong>' + info ).show();\n            } else {\n                this.$info_text.hide();\n            }\n        },\n\n        /** Refresh percentage status */\n        _refreshPercentage : function() {\n            var percentage = parseInt( this.model.get( 'percentage' ) );\n            this.$progress_bar.css( { width : percentage + '%' } );\n            this.$percentage.html( percentage != 100 ? percentage + '%' : 'Adding to history...' );\n        },\n\n        /** Refresh status */\n        _refreshStatus : function() {\n            var status = this.model.get( 'status' );\n            this.$symbol.removeClass().addClass( 'upload-symbol' ).addClass( this.status_classes[ status ] );\n            this.model.set( 'enabled', status == 'init' );\n            var enabled = this.model.get( 'enabled' );\n            this.$text_content.attr( 'disabled', !enabled );\n            if ( enabled ) {\n                this.select_genome.enable();\n                this.select_extension.enable();\n            } else {\n                this.select_genome.disable();\n                this.select_extension.disable();\n            }\n            if ( status == 'success' ) {\n                this.$el.addClass( 'success' );\n                this.$percentage.html( '100%' );\n            }\n            if ( status == 'error' ) {\n                this.$el.addClass( 'danger' );\n                this.$info_progress.hide();\n            }\n        },\n\n        /** Refresh file size */\n        _refreshFileSize: function() {\n            this.$size.html( Utils.bytesToString ( this.model.get( 'file_size' ) ) );\n        },\n\n        /** Remove row */\n        _removeRow: function() {\n            if ( [ 'init', 'success', 'error' ].indexOf( this.model.get( 'status' ) ) !== -1 ) {\n                this.app.collection.remove( this.model );\n            }\n        },\n\n        /** Attach file info popup */\n        _showSettings : function() {\n            if ( !this.settings.visible ) {\n                this.settings.empty();\n                this.settings.append( ( new UploadSettings( this ) ).$el );\n                this.settings.show();\n            } else {\n                this.settings.hide();\n            }\n        },\n\n        /** View template */\n        _template: function( options ) {\n            return  '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' +\n                        '<td>' +\n                            '<div class=\"upload-text-column\">' +\n                                '<div class=\"upload-mode\"/>' +\n                                '<div class=\"upload-title\"/>' +\n                                '<div class=\"upload-text\">' +\n                                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                                    '<textarea class=\"upload-text-content form-control\"/>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-size\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                            '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-genome\"/>' +\n                        '</td>' +\n                        '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                        '<td>' +\n                            '<div class=\"upload-info\">' +\n                                '<div class=\"upload-info-text\"/>' +\n                                '<div class=\"upload-info-progress progress\">' +\n                                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                                    '<div class=\"upload-percentage\">0%</div>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-symbol ' + this.status_classes.init + '\"/>' +\n                        '</td>' +\n                    '</tr>';\n        }\n    });\n});\n"]}