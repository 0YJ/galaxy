{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["define","Utils","UploadModel","UploadSettings","Popover","Select","Backbone","View","extend","status_classes","init","queued","running","success","initialize","app","options","this","self","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","$progress_bar","settings","title","container","default_genome","select_genome","value","css","list_genomes","data","genome","set","select_extension","list_extensions","default_extension","extension","on","_removeRow","e","showExtensionInfo","target","text","preventDefault","$el","_showSettings","url_paste","val","file_size","length","_refreshPercentage","listenTo","_refreshStatus","_refreshInfo","_refreshGenome","_refreshExtension","_refreshFileSize","render","_refreshType","remove","apply","attributes","file_name","html","bytesToString","removeClass","addClass","file_mode","width","top","height","show","get","info","percentage","parseInt","$percentage","status","enabled","attr","enable","disable","hide","indexOf","visible","id"],"mappings":"aACAA,QAAU,cAAe,0BAA2B,6BAA8B,oBAAqB,oBADvG,SAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GACAL,OAAUM,SAAAC,KAAeC,QAGjBC,gBACAA,KAAAA,mCACIC,OAAU,oCACVC,QAAU,oCACVC,QAAU,iCACVC,MAAU,iDAIdC,WAAY,SAAUC,EAAKC,GAA3BF,IAAAA,EAAYG,KACRA,KAAIC,IAAOH,EACXE,KAAKF,MAAMA,EAAXI,MACAF,KAAKE,WAAQH,KAAQG,UAArBH,EAAAG,QACAF,KAAKG,MAAiBC,KAAAA,EAAL,gBACjBJ,KAAKK,OAAyBL,KAAAM,EAAA,iBAC9BN,KAAKO,MAAyBP,KAAAM,EAAA,gBAC9BN,KAAKQ,MAAyBR,KAAAM,EAAA,gBAC9BN,KAAKS,WAAyBT,KAAAM,EAAA,qBAC9BN,KAAKU,eAAiBV,KAAQM,EAAA,yBAC9BN,KAAKW,cAAiBX,KAAKM,EAAG,wBAC9BN,KAAKY,UAAiBZ,KAAAM,EAAQ,oBAC9BN,KAAKa,QAAsBP,KAAGA,EAAA,kBAC9BN,KAAKc,cAAyBd,KAAAM,EAAA,wBAC9BN,KAAKe,YAAiBf,KAAAM,EAAQ,sBAG9BN,KAAAgB,SAAA,IAAA7B,EAAAG,MACA2B,MAAgB,uBACZA,UAAcjB,KAAAM,EAAA,oBACdY,UAAc,WAIlB,IAAAC,EAAAnB,KAAAF,IAAAsB,cAAAC,QACIF,EAA2BrB,KAAIsB,IAAAA,iBAAnCC,QAGArB,KAAAoB,cAAA,IAAAhC,EAAAE,MACAgC,IAAA,gBACIA,KAAcrB,EAAAH,IADmByB,aAEjCC,UAAcxB,KAASuB,EAAAA,kBACvBL,MAAcC,EACdE,SAAcF,SAJmBM,GAAAxB,EAAAC,MAAAwB,IAAA,SAAAD,MAAAzB,KAArC2B,iBAAA,IAAAvC,EAAAE,MAUIgC,IAAc,mBAFlBE,KAAAvB,EAAAH,IAAA8B,gBACAV,UAAKS,KAALrB,EAAwB,qBACpBgB,MAAcO,EACdL,SAAc,SAASI,GAFa3B,EAAAC,MAAAwB,IAAA,YAAAI,MAKE7B,KAAAA,MAAAA,KAAAwB,OAAeN,EAAaW,UAA5BD,IAO1C7B,KAAKc,QAAQiB,GAAG,QAAS,WAAa9B,EAAK+B,eAG3ChC,KAAKM,EAAG,0BAA2ByB,GAAI,QAAU,SAAUE,GAJ3DhC,EAAAH,IAAAoC,mBACKpB,IAAWR,EAAS2B,EAAAE,QAAalC,MAAAA,EAAA0B,iBAAAS,OAAtCN,UAAA7B,EAAA0B,iBAAAN,YAEAU,GAAA,YAAA,SAAAE,GAAAA,EAAAI,mBAGQC,KAAAA,UAAiBL,GAAEE,QADI,SAAAF,GAAAhC,EAAAsC,kBAETtC,GAAAA,YAAK0B,SAALM,GAFSA,EAAAI,mBAK9BrC,KANDY,cAMoBmB,GAAA,eAAc,SAAAE,GAAEA,EAAEI,MAAAA,KAAFG,UAAAlC,EAAA2B,EAAAE,QAAAM,MANpCC,UAAApC,EAAA2B,EAAAE,QAAAM,MAAAE,WASgD1C,KAAAA,SAAKsC,KAAAA,MAAL,oBAAA,WAAAtC,EAAA2C,uBAAsB5C,KAAtE6C,SACmB7C,KAAaE,MAAA,gBAAc,WAAAD,EAAA6C,mBAAEb,KAAAA,SAAEI,KAAFnC,MAAA,cAAA,WAAAD,EAAA8C,iBAAoB/C,KADpE6C,SAAA7C,KAAAE,MAAA,gBAAA,WAAAD,EAAA+C,mBAcAhD,KAAK6C,SAAU7C,KAAKE,MAAO,mBAAsB,WAAaD,EAAKgD,sBAXnEjD,KAAA6C,SAAA7C,KAAAE,MAAA,mBAAA,WAAAD,EAAAiD,sBAGsBC,OAAA,WACrBnD,KAHDoD,eAgBApD,KAAK4C,qBAXL5C,KAAA8C,iBACA9C,KAAK6C,eAAyD5C,KAAAA,iBAA2BD,KAAzFiD,oBACAjD,KAAK6C,oBACyD5C,OAAAA,WAAqBD,KAAnFoB,cAAAiC,SACArD,KAAK6C,iBAAe3C,SAA0CD,SAAK+C,KAAAA,UAALK,OAAAC,MAAAtD,OAC0BoD,aAAxF,WACA,IAAArD,EAAeC,KAAKE,MAApBqD,WAA8DtD,KAAAA,OAAKiD,KAAAA,EAAAA,OAALnD,EAAAyD,YAAyBxD,KAAvFS,MAAAgD,KAAAzE,EAAA0E,cAAA3D,EAAA2C,YAvFoB1C,KAAAK,MAAAsD,cAAAC,SAAA,eAAAA,SAAA,gBAiHM,OAArB7D,EAAQ8D,WAvBT7D,KAAAQ,MAAAc,KAAWwC,MAAA9D,KAAAsC,IAAAwB,QAAA,GAAA,KAAAC,IAAA/D,KAAAsC,IAAA0B,SAAA,EAAA,OAAAC,OACfjE,KAAKoD,IAAAA,OAALpD,KAAAsC,IAAA0B,SAAA,EAAAhE,KAAAQ,MAAAwD,SAAA,IACAhE,KAAK4C,MAAAA,SAAL,eACA,SAAKE,EAALe,UACA7D,KAAK+C,MAAAA,SAAL,gBACA,OAAKC,EAALa,WACA7D,KAAKiD,MAAAA,SAAL,wBAKJI,kBAAQ,WACJrD,KAAKoB,iBAAciC,MAAnBrD,KAAAE,MAAAgE,IAAA,eA4BJlB,eAAgB,WAvBhBhD,KAAAoB,cAAAC,MAAArB,KAAAE,MAAAgE,IAAA,YAIInB,aAAA,WACA,IAAAoB,EAAWR,KAAAA,MAAXO,IAAyBN,QACpB7D,EACDC,KAAKQ,WAAWiD,KAAE,4BAAkCU,GAAMF,OAE1DjE,KAAKK,WAAMuD,QAKdhB,mBAAA,WAzHmB,IAAAwB,EAAAC,SAAArE,KAAAE,MAAAgE,IAAA,eAmJpBlE,KAAKe,cAAcO,KAAOwC,MAAQM,EAAa,MAvBnDpE,KAAAsE,YAAAb,KAAA,KAAAW,EAAAA,EAAA,IAAA,yBA4BAtB,eAAiB,WAvBjB,IAAAyB,EAAAvE,KAAAE,MAAAgE,IAAA,UACAlB,KAAAA,QAAgBW,cAAAC,SAAA,iBAAWA,SAAA5D,KAAAR,eAAA+E,IACvBvE,KAAKoB,MAAAA,IAAAA,UAAgC8C,QAAXK,GAnIN,IAAAC,EAAAxE,KAAAE,MAAAgE,IAAA,WA6JpBlE,KAAKY,cAAc6D,KAAM,YAAaD,GAvB1CA,GACAzB,KAAAA,cAAc2B,SACNP,KAAAA,iBAAuBO,WAEvB1E,KAAKU,cAAW+C,UADpBzD,KAEO2B,iBAAAgD,WAEN,WAAAJ,IA7ImBvE,KAAAsC,IAAAsB,SAAA,WAuKhB5D,KAAKsE,YAAYb,KAAM,SAtB/Bb,SAAAA,IACQwB,KAAAA,IAAAA,SAAaC,UACjBrE,KAAKe,eAAmB6D,SAK5B9B,iBAAiB,WACb9C,KAAIuE,MAAAA,KAASvF,EAAA0E,cAAb1D,KAAAE,MAAAgE,IAAA,gBAIAlC,WAAKpB,YACU,KAAV4D,OAAU,UAAA,SAAAK,QAAA7E,KAAAE,MAAAgE,IAAA,YACXlE,KAAKoB,IAAAA,WAAcsD,OAAnB1E,KAAAE,QAKHqC,cAAA,WACIgC,KAAAA,SAAUO,QAKX9E,KAAKsC,SAAIsB,QAJT5D,KAAKsC,SAAIsB,QACT5D,KAAKsE,SAAAA,OAAkB,IAAvBpF,EAAAc,MAAAsC,KACHtC,KAAAgB,SAAAiD,SAOL7D,UAAA,SAAAL,GACAmD,MAAAA,sBAAkBnD,EAAAgF,GAAW,05BAwDsB/E,KAAKR,eAAeC,KAAO","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\ndefine( [ 'utils/utils', 'mvc/upload/upload-model', 'mvc/upload/upload-settings', 'mvc/ui/ui-popover', 'mvc/ui/ui-select' ],\nfunction( Utils, UploadModel, UploadSettings, Popover, Select ) {\n    return Backbone.View.extend({\n        /** Dictionary of upload states and associated icons */\n        status_classes : {\n            init    : 'upload-icon-button fa fa-trash-o',\n            queued  : 'upload-icon fa fa-spinner fa-spin',\n            running : 'upload-icon fa fa-spinner fa-spin',\n            success : 'upload-icon-button fa fa-check',\n            error   : 'upload-icon-button fa fa-exclamation-triangle'\n        },\n\n        initialize: function( app, options ) {\n            var self = this;\n            this.app = app;\n            this.model = options.model;\n            this.setElement( this._template( options.model ) );\n            this.$mode          = this.$( '.upload-mode' );\n            this.$title         = this.$( '.upload-title' );\n            this.$text          = this.$( '.upload-text' );\n            this.$size          = this.$( '.upload-size' );\n            this.$info_text     = this.$( '.upload-info-text' );\n            this.$info_progress = this.$( '.upload-info-progress' );\n            this.$text_content  = this.$( '.upload-text-content' );\n            this.$settings      = this.$( '.upload-settings' );\n            this.$symbol        = this.$( '.upload-symbol' );\n            this.$progress_bar  = this.$( '.upload-progress-bar' );\n            this.$percentage    = this.$( '.upload-percentage' );\n\n            // append popup to settings icon\n            this.settings = new Popover.View({\n                title       : 'Upload configuration',\n                container   : this.$( '.upload-settings' ),\n                placement   : 'bottom'\n            });\n\n            // identify default genome and extension values\n            var default_genome      = this.app.select_genome.value();\n            var default_extension   = this.app.select_extension.value();\n\n            // create select genomes\n            this.select_genome = new Select.View({\n                css         : 'upload-genome',\n                data        : self.app.list_genomes,\n                container   : this.$( '.upload-genome' ),\n                value       : default_genome,\n                onchange    : function( genome ) { self.model.set( 'genome', genome ) }\n            });\n\n            // create select extension\n            this.select_extension = new Select.View({\n                css         : 'upload-extension',\n                data        : self.app.list_extensions,\n                container   : this.$( '.upload-extension' ),\n                value       : default_extension,\n                onchange    : function( extension ) { self.model.set('extension', extension) }\n            });\n\n            // initialize genome and extension values\n            this.model.set( { 'genome': default_genome, 'extension': default_extension } );\n\n            // handle click event\n            this.$symbol.on('click', function() { self._removeRow(); });\n\n            // handle extension info popover\n            this.$( '.upload-extension-info' ).on( 'click' , function( e ) {\n                self.app.showExtensionInfo({\n                    $el         : $( e.target ),\n                    title       : self.select_extension.text(),\n                    extension   : self.select_extension.value()\n                });\n            }).on( 'mousedown', function( e ) { e.preventDefault() } );\n\n            // handle settings popover\n            this.$settings.on( 'click' ,    function( e ) { self._showSettings() } )\n                          .on( 'mousedown', function( e ) { e.preventDefault() });\n\n            // handle text editing event\n            this.$text_content.on( 'change input', function( e ) {\n                self.model.set( { 'url_paste': $( e.target ).val(),\n                                  'file_size': $( e.target ).val().length } );\n            });\n\n            // model events\n            this.listenTo( this.model, 'change:percentage',  function() { self._refreshPercentage() } );\n            this.listenTo( this.model, 'change:status',      function() { self._refreshStatus() } );\n            this.listenTo( this.model, 'change:info',        function() { self._refreshInfo() } );\n            this.listenTo( this.model, 'change:genome',      function() { self._refreshGenome() } );\n            this.listenTo( this.model, 'change:extension',   function() { self._refreshExtension() } );\n            this.listenTo( this.model, 'change:file_size',   function() { self._refreshFileSize() } );\n        },\n\n        render: function() {\n            this._refreshType();\n            this._refreshPercentage();\n            this._refreshStatus();\n            this._refreshInfo()\n            this._refreshGenome();\n            this._refreshExtension();\n            this._refreshFileSize()\n        },\n\n        /** Remove view */\n        remove: function() {\n            this.select_genome.remove();\n            this.select_extension.remove();\n            Backbone.View.prototype.remove.apply( this );\n        },\n\n        /** Render type */\n        _refreshType: function() {\n            var options = this.model.attributes;\n            this.$title.html( _.escape( options.file_name ) );\n            this.$size.html( Utils.bytesToString ( options.file_size ) );\n            this.$mode.removeClass().addClass( 'upload-mode' ).addClass( 'text-primary' );\n            if ( options.file_mode == 'new' ) {\n                this.$text.css( { 'width' : this.$el.width() - 16 + 'px', 'top'  : this.$el.height() - 8 + 'px' } ).show();\n                this.$el.height( this.$el.height() - 8 + this.$text.height() + 16 );\n                this.$mode.addClass( 'fa fa-edit' );\n            } else if ( options.file_mode == 'local' ) {\n                this.$mode.addClass( 'fa fa-laptop' );\n            } else if ( options.file_mode == 'ftp' ) {\n                this.$mode.addClass( 'fa fa-folder-open-o' );\n            }\n        },\n\n        /** Update extension */\n        _refreshExtension: function() {\n            this.select_extension.value( this.model.get( 'extension' ) );\n        },\n\n        /** Update genome */\n        _refreshGenome: function() {\n            this.select_genome.value( this.model.get( 'genome' ) );\n        },\n\n        /** Refresh info text */\n        _refreshInfo: function() {\n            var info = this.model.get( 'info' );\n            if ( info ) {\n                this.$info_text.html( '<strong>Failed: </strong>' + info ).show();\n            } else {\n                this.$info_text.hide();\n            }\n        },\n\n        /** Refresh percentage status */\n        _refreshPercentage : function() {\n            var percentage = parseInt( this.model.get( 'percentage' ) );\n            this.$progress_bar.css( { width : percentage + '%' } );\n            this.$percentage.html( percentage != 100 ? percentage + '%' : 'Adding to history...' );\n        },\n\n        /** Refresh status */\n        _refreshStatus : function() {\n            var status = this.model.get( 'status' );\n            this.$symbol.removeClass().addClass( 'upload-symbol' ).addClass( this.status_classes[ status ] );\n            this.model.set( 'enabled', status == 'init' );\n            var enabled = this.model.get( 'enabled' );\n            this.$text_content.attr( 'disabled', !enabled );\n            if ( enabled ) {\n                this.select_genome.enable();\n                this.select_extension.enable();\n            } else {\n                this.select_genome.disable();\n                this.select_extension.disable();\n            }\n            if ( status == 'success' ) {\n                this.$el.addClass( 'success' );\n                this.$percentage.html( '100%' );\n            }\n            if ( status == 'error' ) {\n                this.$el.addClass( 'danger' );\n                this.$info_progress.hide();\n            }\n        },\n\n        /** Refresh file size */\n        _refreshFileSize: function() {\n            this.$size.html( Utils.bytesToString ( this.model.get( 'file_size' ) ) );\n        },\n\n        /** Remove row */\n        _removeRow: function() {\n            if ( [ 'init', 'success', 'error' ].indexOf( this.model.get( 'status' ) ) !== -1 ) {\n                this.app.collection.remove( this.model );\n            }\n        },\n\n        /** Attach file info popup */\n        _showSettings : function() {\n            if ( !this.settings.visible ) {\n                this.settings.empty();\n                this.settings.append( ( new UploadSettings( this ) ).$el );\n                this.settings.show();\n            } else {\n                this.settings.hide();\n            }\n        },\n\n        /** View template */\n        _template: function( options ) {\n            return  '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' +\n                        '<td>' +\n                            '<div class=\"upload-text-column\">' +\n                                '<div class=\"upload-mode\"/>' +\n                                '<div class=\"upload-title\"/>' +\n                                '<div class=\"upload-text\">' +\n                                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                                    '<textarea class=\"upload-text-content form-control\"/>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-size\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                            '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-genome\"/>' +\n                        '</td>' +\n                        '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                        '<td>' +\n                            '<div class=\"upload-info\">' +\n                                '<div class=\"upload-info-text\"/>' +\n                                '<div class=\"upload-info-progress progress\">' +\n                                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                                    '<div class=\"upload-percentage\">0%</div>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-symbol ' + this.status_classes.init + '\"/>' +\n                        '</td>' +\n                    '</tr>';\n        }\n    });\n});\n"]}