{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["define","Utils","UploadModel","UploadSettings","Popover","Select","Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","$progress_bar","$percentage","settings","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","css","data","list_genomes","onchange","genome","set","list_extensions","extension","on","_removeRow","e","showExtensionInfo","$el","target","text","preventDefault","_showSettings","url_paste","val","file_size","length","listenTo","_refreshPercentage","_refreshStatus","_refreshInfo","_refreshGenome","_refreshExtension","_refreshFileSize","remove","collection","render","attributes","html","_","escape","file_name","bytesToString","removeClass","addClass","file_mode","width","top","height","show","prototype","apply","get","info","hide","percentage","parseInt","status","enabled","attr","enable","disable","indexOf","visible","empty","append","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\ndefine( [ 'utils/utils', 'mvc/upload/upload-model', 'mvc/upload/upload-settings', 'mvc/ui/ui-popover', 'mvc/ui/ui-select' ],\nfunction( Utils, UploadModel, UploadSettings, Popover, Select ) {\n    return Backbone.View.extend({\n        /** Dictionary of upload states and associated icons */\n        status_classes : {\n            init    : 'upload-icon-button fa fa-trash-o',\n            queued  : 'upload-icon fa fa-spinner fa-spin',\n            running : 'upload-icon fa fa-spinner fa-spin',\n            success : 'upload-icon-button fa fa-check',\n            error   : 'upload-icon-button fa fa-exclamation-triangle'\n        },\n\n        initialize: function( app, options ) {\n            var self = this;\n            this.app = app;\n            this.model = options.model;\n            this.setElement( this._template( options.model ) );\n            this.$mode          = this.$( '.upload-mode' );\n            this.$title         = this.$( '.upload-title' );\n            this.$text          = this.$( '.upload-text' );\n            this.$size          = this.$( '.upload-size' );\n            this.$info_text     = this.$( '.upload-info-text' );\n            this.$info_progress = this.$( '.upload-info-progress' );\n            this.$text_content  = this.$( '.upload-text-content' );\n            this.$settings      = this.$( '.upload-settings' );\n            this.$symbol        = this.$( '.upload-symbol' );\n            this.$progress_bar  = this.$( '.upload-progress-bar' );\n            this.$percentage    = this.$( '.upload-percentage' );\n\n            // append popup to settings icon\n            this.settings = new Popover.View({\n                title       : 'Upload configuration',\n                container   : this.$( '.upload-settings' ),\n                placement   : 'bottom'\n            });\n\n            // identify default genome and extension values\n            var default_genome      = this.app.select_genome.value();\n            var default_extension   = this.app.select_extension.value();\n\n            // create select genomes\n            this.select_genome = new Select.View({\n                css         : 'upload-genome',\n                data        : self.app.list_genomes,\n                container   : this.$( '.upload-genome' ),\n                value       : default_genome,\n                onchange    : function( genome ) { self.model.set( 'genome', genome ) }\n            });\n\n            // create select extension\n            this.select_extension = new Select.View({\n                css         : 'upload-extension',\n                data        : self.app.list_extensions,\n                container   : this.$( '.upload-extension' ),\n                value       : default_extension,\n                onchange    : function( extension ) { self.model.set('extension', extension) }\n            });\n\n            // initialize genome and extension values\n            this.model.set( { 'genome': default_genome, 'extension': default_extension } );\n\n            // handle click event\n            this.$symbol.on('click', function() { self._removeRow(); });\n\n            // handle extension info popover\n            this.$( '.upload-extension-info' ).on( 'click' , function( e ) {\n                self.app.showExtensionInfo({\n                    $el         : $( e.target ),\n                    title       : self.select_extension.text(),\n                    extension   : self.select_extension.value()\n                });\n            }).on( 'mousedown', function( e ) { e.preventDefault() } );\n\n            // handle settings popover\n            this.$settings.on( 'click' ,    function( e ) { self._showSettings() } )\n                          .on( 'mousedown', function( e ) { e.preventDefault() });\n\n            // handle text editing event\n            this.$text_content.on( 'change input', function( e ) {\n                self.model.set( { 'url_paste': $( e.target ).val(),\n                                  'file_size': $( e.target ).val().length } );\n            });\n\n            // model events\n            this.listenTo( this.model, 'change:percentage',  function() { self._refreshPercentage() } );\n            this.listenTo( this.model, 'change:status',      function() { self._refreshStatus() } );\n            this.listenTo( this.model, 'change:info',        function() { self._refreshInfo() } );\n            this.listenTo( this.model, 'change:genome',      function() { self._refreshGenome() } );\n            this.listenTo( this.model, 'change:extension',   function() { self._refreshExtension() } );\n            this.listenTo( this.model, 'change:file_size',   function() { self._refreshFileSize() } );\n            this.listenTo( this.model, 'remove',             function() { self.remove() } );\n            this.app.collection.on('reset', function() { self.remove() } );\n        },\n\n        render: function() {\n            var options = this.model.attributes;\n            this.$title.html( _.escape( options.file_name ) );\n            this.$size.html( Utils.bytesToString ( options.file_size ) );\n            this.$mode.removeClass().addClass( 'upload-mode' ).addClass( 'text-primary' );\n            if ( options.file_mode == 'new' ) {\n                this.$text.css( { 'width' : this.$el.width() - 16 + 'px', 'top'  : this.$el.height() - 8 + 'px' } ).show();\n                this.$el.height( this.$el.height() - 8 + this.$text.height() + 16 );\n                this.$mode.addClass( 'fa fa-edit' );\n            } else if ( options.file_mode == 'local' ) {\n                this.$mode.addClass( 'fa fa-laptop' );\n            } else if ( options.file_mode == 'ftp' ) {\n                this.$mode.addClass( 'fa fa-folder-open-o' );\n            }\n        },\n\n        /** Remove view */\n        remove: function() {\n            this.select_genome.remove();\n            this.select_extension.remove();\n            Backbone.View.prototype.remove.apply( this );\n        },\n\n        /** Update extension */\n        _refreshExtension: function() {\n            this.select_extension.value( this.model.get( 'extension' ) );\n        },\n\n        /** Update genome */\n        _refreshGenome: function() {\n            this.select_genome.value( this.model.get( 'genome' ) );\n        },\n\n        /** Refresh info text */\n        _refreshInfo: function() {\n            var info = this.model.get( 'info' );\n            if ( info ) {\n                this.$info_text.html( '<strong>Failed: </strong>' + info ).show();\n            } else {\n                this.$info_text.hide();\n            }\n        },\n\n        /** Refresh percentage status */\n        _refreshPercentage : function() {\n            var percentage = parseInt( this.model.get( 'percentage' ) );\n            this.$progress_bar.css( { width : percentage + '%' } );\n            this.$percentage.html( percentage != 100 ? percentage + '%' : 'Adding to history...' );\n        },\n\n        /** Refresh status */\n        _refreshStatus : function() {\n            var status = this.model.get( 'status' );\n            this.$symbol.removeClass().addClass( 'upload-symbol' ).addClass( this.status_classes[ status ] );\n            this.model.set( 'enabled', status == 'init' );\n            var enabled = this.model.get( 'enabled' );\n            this.$text_content.attr( 'disabled', !enabled );\n            if ( enabled ) {\n                this.select_genome.enable();\n                this.select_extension.enable();\n            } else {\n                this.select_genome.disable();\n                this.select_extension.disable();\n            }\n            if ( status == 'success' ) {\n                this.$el.addClass( 'success' );\n                this.$percentage.html( '100%' );\n            }\n            if ( status == 'error' ) {\n                this.$el.addClass( 'danger' );\n                this.$info_progress.hide();\n            }\n        },\n\n        /** Refresh file size */\n        _refreshFileSize: function() {\n            this.$size.html( Utils.bytesToString ( this.model.get( 'file_size' ) ) );\n        },\n\n        /** Remove row */\n        _removeRow: function() {\n            if ( [ 'init', 'success', 'error' ].indexOf( this.model.get( 'status' ) ) !== -1 ) {\n                this.app.collection.remove( this.model );\n            }\n        },\n\n        /** Attach file info popup */\n        _showSettings : function() {\n            if ( !this.settings.visible ) {\n                this.settings.empty();\n                this.settings.append( ( new UploadSettings( this ) ).$el );\n                this.settings.show();\n            } else {\n                this.settings.hide();\n            }\n        },\n\n        /** View template */\n        _template: function( options ) {\n            return  '<tr id=\"upload-row-' + options.id + '\" class=\"upload-row\">' +\n                        '<td>' +\n                            '<div class=\"upload-text-column\">' +\n                                '<div class=\"upload-mode\"/>' +\n                                '<div class=\"upload-title\"/>' +\n                                '<div class=\"upload-text\">' +\n                                    '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n                                    '<textarea class=\"upload-text-content form-control\"/>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-size\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n                            '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-genome\"/>' +\n                        '</td>' +\n                        '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n                        '<td>' +\n                            '<div class=\"upload-info\">' +\n                                '<div class=\"upload-info-text\"/>' +\n                                '<div class=\"upload-info-progress progress\">' +\n                                    '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n                                    '<div class=\"upload-percentage\">0%</div>' +\n                                '</div>' +\n                            '</div>' +\n                        '</td>' +\n                        '<td>' +\n                            '<div class=\"upload-symbol ' + this.status_classes.init + '\"/>' +\n                        '</td>' +\n                    '</tr>';\n        }\n    });\n});\n"]}