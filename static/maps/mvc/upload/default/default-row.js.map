{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["_utils","require","_uploadModel","_uploadSettings","_uiPopover","_uiSelect","Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","_uiPopover2","default","container","placement","default_genome","select_genome","value","default_extension","_uiSelect2","css","data","list_genomes","onchange","genome","set","settings","title","list_extensions","extension","_removeRow","select_extension","e","target","text","on","preventDefault","_showSettings","showExtensionInfo","$el","val","listenTo","_refreshPercentage","_refreshInfo","url_paste","file_size","_refreshFileSize","render","_refreshStatus","_refreshExtension","remove","apply","_refreshType","attributes","file_name","bytesToString","_refreshGenome","file_mode","width","height","addClass","html","escape","top","get","info","show","hide","percentage","parseInt","$progress_bar","status","removeClass","enabled","$percentage","attr","enable","_utils2","indexOf","collection","visible","empty","append","_uploadSettings2","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new Select.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new Select.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", function() {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\")\n            .on(\"click\", function(e) {\n                self.app.showExtensionInfo({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value()\n                });\n            })\n            .on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", function(e) {\n                self._showSettings();\n            })\n            .on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function(e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function() {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function() {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function() {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", function() {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", function() {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", function() {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: this.$el.width() - 16 + \"px\",\n                    top: this.$el.height() - 8 + \"px\"\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: percentage + \"%\" });\n        this.$percentage.html(\n            percentage != 100 ? percentage + \"%\" : \"Adding to history...\"\n        );\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if (\n            [\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !==\n            -1\n        ) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return (\n            '<tr id=\"upload-row-' +\n            options.id +\n            '\" class=\"upload-row\">' +\n            \"<td>\" +\n            '<div class=\"upload-text-column\">' +\n            '<div class=\"upload-mode\"/>' +\n            '<div class=\"upload-title\"/>' +\n            '<div class=\"upload-text\">' +\n            '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n            '<textarea class=\"upload-text-content form-control\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-size\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n            '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-genome\"/>' +\n            \"</td>\" +\n            '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n            \"<td>\" +\n            '<div class=\"upload-info\">' +\n            '<div class=\"upload-info-text\"/>' +\n            '<div class=\"upload-info-progress progress\">' +\n            '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n            '<div class=\"upload-percentage\">0%</div>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-symbol ' +\n            this.status_classes.init +\n            '\"/>' +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    }\n});\n"]}