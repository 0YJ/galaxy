{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$percentage","settings","_uiPopover2","default","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","_uiSelect2","css","$symbol","data","$progress_bar","onchange","genome","set","extension","e","showExtensionInfo","$el","target","text","preventDefault","on","_showSettings","$text_content","val","file_size","length","listenTo","_refreshStatus","url_paste","_refreshGenome","_refreshType","_refreshPercentage","_refreshInfo","_refreshFileSize","remove","render","apply","_refreshExtension","file_name","html","_utils2","bytesToString","removeClass","addClass","width","top","height","escape","file_mode","get","info","show","$info_text","hide","percentage","status","enabled","attr","$info_progress","_removeRow","indexOf","collection","append","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["/** Renders the default uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new Select.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new Select.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", function() {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\")\n            .on(\"click\", function(e) {\n                self.app.showExtensionInfo({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value()\n                });\n            })\n            .on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", function(e) {\n                self._showSettings();\n            })\n            .on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function(e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function() {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function() {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function() {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", function() {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", function() {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", function() {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: this.$el.width() - 16 + \"px\",\n                    top: this.$el.height() - 8 + \"px\"\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: percentage + \"%\" });\n        this.$percentage.html(\n            percentage != 100 ? percentage + \"%\" : \"Adding to history...\"\n        );\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if (\n            [\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !==\n            -1\n        ) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return (\n            '<tr id=\"upload-row-' +\n            options.id +\n            '\" class=\"upload-row\">' +\n            \"<td>\" +\n            '<div class=\"upload-text-column\">' +\n            '<div class=\"upload-mode\"/>' +\n            '<div class=\"upload-title\"/>' +\n            '<div class=\"upload-text\">' +\n            '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n            '<textarea class=\"upload-text-content form-control\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-size\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp' +\n            '<div class=\"upload-extension-info upload-icon-button fa fa-search\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-genome\"/>' +\n            \"</td>\" +\n            '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n            \"<td>\" +\n            '<div class=\"upload-info\">' +\n            '<div class=\"upload-info-text\"/>' +\n            '<div class=\"upload-info-progress progress\">' +\n            '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n            '<div class=\"upload-percentage\">0%</div>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-symbol ' +\n            this.status_classes.init +\n            '\"/>' +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    }\n});\n"]}