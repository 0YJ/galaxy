{"version":3,"sources":["mvc/upload/upload-ftp.js"],"names":["define","Utils","Backbone","View","extend","initialize","options","merge","self","class_remove","class_add","class_partial","collection","onchange","onremove","this","setElement","_template","url","Galaxy","root","ftp_files","_fill","length","$","html","_templateTable","size","index","rows","push","_add","bytesToString","show","$select_all","addClass","on","add","ftp_file","model_index","_find","trigger","_refresh","_templateInfo","hide","$it","_templateRow","$icon","find","append","removeClass","onadd","file_mode","enabled","filtered","item","file_path","path","get","_","escape","ctime","ftp_upload_site"],"mappings":"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","file":"../../../scripts/mvc/upload/upload-ftp.js","sourcesContent":["/** This renders the content of the ftp popup **/\ndefine( [ 'utils/utils' ], function( Utils ) {\n    return Backbone.View.extend({\n        initialize: function( options ) {\n            var self = this;\n            this.options = Utils.merge( options, {\n                class_add       : 'upload-icon-button fa fa-square-o',\n                class_remove    : 'upload-icon-button fa fa-check-square-o',\n                class_partial   : 'upload-icon-button fa fa-minus-square-o',\n                collection      : null,\n                onchange        : function() {},\n                onadd           : function() {},\n                onremove        : function() {}\n            } );\n            this.collection = this.options.collection;\n            this.setElement( this._template() );\n            this.rows = [];\n            Utils.get({\n                url     : Galaxy.root + 'api/remote_files',\n                success : function( ftp_files ) { self._fill( ftp_files ) },\n                error   : function() { self._fill(); }\n            });\n        },\n\n        /** Fill table with ftp entries */\n        _fill: function( ftp_files ) {\n            if ( ftp_files && ftp_files.length > 0 ) {\n                this.$( '.upload-ftp-content' ).html( $( this._templateTable() ) );\n                var size = 0;\n                for (var index in ftp_files ) {\n                    this.rows.push( this._add( ftp_files[ index ] ) );\n                    size += ftp_files[ index ].size;\n                }\n                this.$( '.upload-ftp-number' ).html( ftp_files.length + ' files' );\n                this.$( '.upload-ftp-disk' ).html( Utils.bytesToString ( size, true ) );\n                if ( this.collection ) {\n                    var self = this;\n                    this.$( '._has_collection' ).show();\n                    this.$select_all = this.$( '.upload-selectall' ).addClass( this.options.class_add );\n                    this.$select_all.on( 'click', function() {\n                        var add = self.$select_all.hasClass( self.options.class_add );\n                        for (var index in ftp_files ) {\n                            var ftp_file = ftp_files[ index ];\n                            var model_index = self._find( ftp_file );\n                            if( !model_index && add || model_index && !add ) {\n                                self.rows[ index ].trigger( 'click' );\n                            }\n                        }\n                    });\n                    this._refresh();\n                }\n            } else {\n                this.$( '.upload-ftp-content' ).html( $( this._templateInfo() ) );\n            }\n            this.$( '.upload-ftp-wait' ).hide();\n        },\n\n        /** Add file to table */\n        _add: function( ftp_file ) {\n            var self = this;\n            var $it = $( this._templateRow( ftp_file ) );\n            var $icon = $it.find( '.icon' );\n            this.$( 'tbody' ).append( $it );\n            if ( this.collection ) {\n                $icon.addClass( this._find( ftp_file ) ? this.options.class_remove : this.options.class_add );\n                $it.on('click', function() {\n                    var model_index = self._find( ftp_file );\n                    $icon.removeClass();\n                    if ( !model_index ) {\n                        self.options.onadd( ftp_file );\n                        $icon.addClass( self.options.class_remove );\n                    } else {\n                        self.options.onremove( model_index );\n                        $icon.addClass( self.options.class_add );\n                    }\n                    self._refresh();\n                });\n            } else {\n                $it.on('click', function() { self.options.onchange( ftp_file ) } );\n            }\n            return $it;\n        },\n\n        /** Refresh select all button state */\n        _refresh: function() {\n            var filtered = this.collection.where( { file_mode: 'ftp', enabled: true } );\n            this.$select_all.removeClass();\n            if ( filtered.length == 0 ) {\n                this.$select_all.addClass( this.options.class_add );\n            } else {\n                this.$select_all.addClass( filtered.length == this.rows.length ? this.options.class_remove : this.options.class_partial );\n            }\n        },\n\n        /** Get model index */\n        _find: function( ftp_file ) {\n            var item = this.collection.findWhere({\n                file_path   : ftp_file.path,\n                file_mode   : 'ftp',\n                enabled     : true\n            });\n            return item && item.get('id');\n        },\n\n        /** Template of row */\n        _templateRow: function( options ) {\n            return  '<tr class=\"upload-ftp-row\">' +\n                        '<td class=\"_has_collection\" style=\"display: none;\"><div class=\"icon\"/></td>' +\n                        '<td class=\"ftp-name\">' + _.escape(options.path) + '</td>' +\n                        '<td class=\"ftp-size\">' + Utils.bytesToString( options.size ) + '</td>' +\n                        '<td class=\"ftp-time\">' + options.ctime + '</td>' +\n                    '</tr>';\n        },\n\n        /** Template of table */\n        _templateTable: function() {\n            return  '<span style=\"whitespace: nowrap; float: left;\">Available files: </span>' +\n                    '<span style=\"whitespace: nowrap; float: right;\">' +\n                        '<span class=\"upload-icon fa fa-file-text-o\"/>' +\n                        '<span class=\"upload-ftp-number\"/>&nbsp;&nbsp;' +\n                        '<span class=\"upload-icon fa fa-hdd-o\"/>' +\n                        '<span class=\"upload-ftp-disk\"/>' +\n                    '</span>' +\n                    '<table class=\"grid\" style=\"float: left;\">' +\n                        '<thead>' +\n                            '<tr>' +\n                                '<th class=\"_has_collection\" style=\"display: none;\"><div class=\"upload-selectall\"></th>' +\n                                '<th>Name</th>' +\n                                '<th>Size</th>' +\n                                '<th>Created</th>' +\n                            '</tr>' +\n                        '</thead>' +\n                        '<tbody/>' +\n                    '</table>';\n        },\n\n        /** Template of info message */\n        _templateInfo: function() {\n            return  '<div class=\"upload-ftp-warning warningmessage\">' +\n                        'Your FTP directory does not contain any files.' +\n                    '</div>';\n        },\n\n        /** Template of main view */\n        _template: function() {\n            return  '<div class=\"upload-ftp\">' +\n                        '<div class=\"upload-ftp-wait fa fa-spinner fa-spin\"/>' +\n                        '<div class=\"upload-ftp-help\">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>' + this.options.ftp_upload_site + '</strong> using your Galaxy credentials (email address and password).</div>' +\n                        '<div class=\"upload-ftp-content\"/>' +\n                    '<div>';\n        }\n    });\n});\n"]}