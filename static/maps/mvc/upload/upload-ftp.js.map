{"version":3,"sources":["mvc/upload/upload-ftp.js"],"names":["define","Utils","Backbone","View","extend","initialize","options","self","this","merge","class_add","class_remove","class_partial","collection","onchange","onadd","onremove","setElement","_template","rows","get","url","Galaxy","root","success","ftp_files","_fill","error","length","$","html","_templateTable","size","index","push","_add","bytesToString","show","$select_all","addClass","on","add","hasClass","ftp_file","model_index","_find","trigger","_refresh","_templateInfo","hide","$it","_templateRow","$icon","find","append","removeClass","filtered","where","file_mode","enabled","item","findWhere","file_path","path","_","escape","ctime","ftp_upload_site"],"mappings":"AACAA,QAAU,eAAiB,SAAUC,GACjC,MAAOC,UAASC,KAAKC,QACjBC,WAAY,SAAUC,GAClB,GAAIC,GAAOC,IACXA,MAAKF,QAAUL,EAAMQ,MAAOH,GACxBI,UAAkB,oCAClBC,aAAkB,0CAClBC,cAAkB,0CAClBC,WAAkB,KAClBC,SAAkB,aAClBC,MAAkB,aAClBC,SAAkB,eAEtBR,KAAKK,WAAaL,KAAKF,QAAQO,WAC/BL,KAAKS,WAAYT,KAAKU,aACtBV,KAAKW,QACLlB,EAAMmB,KACFC,IAAUC,OAAOC,KAAO,mBACxBC,QAAU,SAAUC,GAAclB,EAAKmB,MAAOD,IAC9CE,MAAU,WAAapB,EAAKmB,YAKpCA,MAAO,SAAUD,GACb,GAAKA,GAAaA,EAAUG,OAAS,EAAI,CACrCpB,KAAKqB,EAAG,uBAAwBC,KAAMD,EAAGrB,KAAKuB,kBAC9C,IAAIC,GAAO,CACX,KAAMC,QAASR,GACXjB,KAAKW,KAAKe,KAAM1B,KAAK2B,KAAMV,EAAWQ,SACtCD,GAAQP,EAAWQ,OAAQD,IAI/B,IAFAxB,KAAKqB,EAAG,sBAAuBC,KAAML,EAAUG,OAAS,UACxDpB,KAAKqB,EAAG,oBAAqBC,KAAM7B,EAAMmC,cAAgBJ,GAAM,IAC1DxB,KAAKK,WAAa,CACnB,GAAIN,GAAOC,IACXA,MAAKqB,EAAG,oBAAqBQ,OAC7B7B,KAAK8B,YAAc9B,KAAKqB,EAAG,qBAAsBU,SAAU/B,KAAKF,QAAQI,WACxEF,KAAK8B,YAAYE,GAAI,QAAS,WAC1B,GAAIC,GAAMlC,EAAK+B,YAAYI,SAAUnC,EAAKD,QAAQI,UAClD,KAAMuB,QAASR,GAAY,CACvB,GAAIkB,GAAWlB,EAAWQ,OACtBW,EAAcrC,EAAKsC,MAAOF,KACzBC,GAAeH,GAAOG,IAAgBH,IACvClC,EAAKY,KAAMc,OAAQa,QAAS,YAIxCtC,KAAKuC,gBAGTvC,MAAKqB,EAAG,uBAAwBC,KAAMD,EAAGrB,KAAKwC,iBAElDxC,MAAKqB,EAAG,oBAAqBoB,QAIjCd,KAAM,SAAUQ,GACZ,GAAIpC,GAAOC,KACP0C,EAAMrB,EAAGrB,KAAK2C,aAAcR,IAC5BS,EAAQF,EAAIG,KAAM,QAmBtB,OAlBA7C,MAAKqB,EAAG,SAAUyB,OAAQJ,GACrB1C,KAAKK,YACNuC,EAAMb,SAAU/B,KAAKqC,MAAOF,GAAanC,KAAKF,QAAQK,aAAeH,KAAKF,QAAQI,WAClFwC,EAAIV,GAAG,QAAS,WACZ,GAAII,GAAcrC,EAAKsC,MAAOF,EAC9BS,GAAMG,cACAX,GAIFrC,EAAKD,QAAQU,SAAU4B,GACvBQ,EAAMb,SAAUhC,EAAKD,QAAQI,aAJ7BH,EAAKD,QAAQS,MAAO4B,GACpBS,EAAMb,SAAUhC,EAAKD,QAAQK,eAKjCJ,EAAKwC,cAGTG,EAAIV,GAAG,QAAS,WAAajC,EAAKD,QAAQQ,SAAU6B,KAEjDO,GAIXH,SAAU,WACN,GAAIS,GAAWhD,KAAKK,WAAW4C,OAASC,UAAW,MAAOC,SAAS,GACnEnD,MAAK8B,YAAYiB,cACO,GAAnBC,EAAS5B,OACVpB,KAAK8B,YAAYC,SAAU/B,KAAKF,QAAQI,WAExCF,KAAK8B,YAAYC,SAAUiB,EAAS5B,QAAUpB,KAAKW,KAAKS,OAASpB,KAAKF,QAAQK,aAAeH,KAAKF,QAAQM,gBAKlHiC,MAAO,SAAUF,GACb,GAAIiB,GAAOpD,KAAKK,WAAWgD,WACvBC,UAAcnB,EAASoB,KACvBL,UAAc,MACdC,SAAc,GAElB,OAAOC,IAAQA,EAAKxC,IAAI,OAI5B+B,aAAc,SAAU7C,GACpB,MAAQ,8HAE8B0D,EAAEC,OAAO3D,EAAQyD,MAAQ,6BACzB9D,EAAMmC,cAAe9B,EAAQ0B,MAAS,6BACtC1B,EAAQ4D,MAAQ,cAK1DnC,eAAgB,WACZ,MAAQ,mfAqBZiB,cAAe,WACX,MAAQ,uGAMZ9B,UAAW,WACP,MAAQ,6NAEuJV,KAAKF,QAAQ6D,gBAAkB","file":"../../../scripts/mvc/upload/upload-ftp.js","sourcesContent":["/** This renders the content of the ftp popup **/\ndefine( [ 'utils/utils' ], function( Utils ) {\n    return Backbone.View.extend({\n        initialize: function( options ) {\n            var self = this;\n            this.options = Utils.merge( options, {\n                class_add       : 'upload-icon-button fa fa-square-o',\n                class_remove    : 'upload-icon-button fa fa-check-square-o',\n                class_partial   : 'upload-icon-button fa fa-minus-square-o',\n                collection      : null,\n                onchange        : function() {},\n                onadd           : function() {},\n                onremove        : function() {}\n            } );\n            this.collection = this.options.collection;\n            this.setElement( this._template() );\n            this.rows = [];\n            Utils.get({\n                url     : Galaxy.root + 'api/remote_files',\n                success : function( ftp_files ) { self._fill( ftp_files ) },\n                error   : function() { self._fill(); }\n            });\n        },\n\n        /** Fill table with ftp entries */\n        _fill: function( ftp_files ) {\n            if ( ftp_files && ftp_files.length > 0 ) {\n                this.$( '.upload-ftp-content' ).html( $( this._templateTable() ) );\n                var size = 0;\n                for ( index in ftp_files ) {\n                    this.rows.push( this._add( ftp_files[ index ] ) );\n                    size += ftp_files[ index ].size;\n                }\n                this.$( '.upload-ftp-number' ).html( ftp_files.length + ' files' );\n                this.$( '.upload-ftp-disk' ).html( Utils.bytesToString ( size, true ) );\n                if ( this.collection ) {\n                    var self = this;\n                    this.$( '._has_collection' ).show();\n                    this.$select_all = this.$( '.upload-selectall' ).addClass( this.options.class_add );\n                    this.$select_all.on( 'click', function() {\n                        var add = self.$select_all.hasClass( self.options.class_add );\n                        for ( index in ftp_files ) {\n                            var ftp_file = ftp_files[ index ];\n                            var model_index = self._find( ftp_file );\n                            if( !model_index && add || model_index && !add ) {\n                                self.rows[ index ].trigger( 'click' );\n                            }\n                        }\n                    });\n                    this._refresh();\n                }\n            } else {\n                this.$( '.upload-ftp-content' ).html( $( this._templateInfo() ) );\n            }\n            this.$( '.upload-ftp-wait' ).hide();\n        },\n\n        /** Add file to table */\n        _add: function( ftp_file ) {\n            var self = this;\n            var $it = $( this._templateRow( ftp_file ) );\n            var $icon = $it.find( '.icon' );\n            this.$( 'tbody' ).append( $it );\n            if ( this.collection ) {\n                $icon.addClass( this._find( ftp_file ) ? this.options.class_remove : this.options.class_add );\n                $it.on('click', function() {\n                    var model_index = self._find( ftp_file );\n                    $icon.removeClass();\n                    if ( !model_index ) {\n                        self.options.onadd( ftp_file );\n                        $icon.addClass( self.options.class_remove );\n                    } else {\n                        self.options.onremove( model_index );\n                        $icon.addClass( self.options.class_add );\n                    }\n                    self._refresh();\n                });\n            } else {\n                $it.on('click', function() { self.options.onchange( ftp_file ) } );\n            }\n            return $it;\n        },\n\n        /** Refresh select all button state */\n        _refresh: function() {\n            var filtered = this.collection.where( { file_mode: 'ftp', enabled: true } );\n            this.$select_all.removeClass();\n            if ( filtered.length == 0 ) {\n                this.$select_all.addClass( this.options.class_add );\n            } else {\n                this.$select_all.addClass( filtered.length == this.rows.length ? this.options.class_remove : this.options.class_partial );\n            }\n        },\n\n        /** Get model index */\n        _find: function( ftp_file ) {\n            var item = this.collection.findWhere({\n                file_path   : ftp_file.path,\n                file_mode   : 'ftp',\n                enabled     : true\n            });\n            return item && item.get('id');\n        },\n\n        /** Template of row */\n        _templateRow: function( options ) {\n            return  '<tr class=\"upload-ftp-row\">' +\n                        '<td class=\"_has_collection\" style=\"display: none;\"><div class=\"icon\"/></td>' +\n                        '<td class=\"ftp-name\">' + _.escape(options.path) + '</td>' +\n                        '<td class=\"ftp-size\">' + Utils.bytesToString( options.size ) + '</td>' +\n                        '<td class=\"ftp-time\">' + options.ctime + '</td>' +\n                    '</tr>';\n        },\n\n        /** Template of table */\n        _templateTable: function() {\n            return  '<span style=\"whitespace: nowrap; float: left;\">Available files: </span>' +\n                    '<span style=\"whitespace: nowrap; float: right;\">' +\n                        '<span class=\"upload-icon fa fa-file-text-o\"/>' +\n                        '<span class=\"upload-ftp-number\"/>&nbsp;&nbsp;' +\n                        '<span class=\"upload-icon fa fa-hdd-o\"/>' +\n                        '<span class=\"upload-ftp-disk\"/>' +\n                    '</span>' +\n                    '<table class=\"grid\" style=\"float: left;\">' +\n                        '<thead>' +\n                            '<tr>' +\n                                '<th class=\"_has_collection\" style=\"display: none;\"><div class=\"upload-selectall\"></th>' +\n                                '<th>Name</th>' +\n                                '<th>Size</th>' +\n                                '<th>Created</th>' +\n                            '</tr>' +\n                        '</thead>' +\n                        '<tbody/>' +\n                    '</table>';\n        },\n\n        /** Template of info message */\n        _templateInfo: function() {\n            return  '<div class=\"upload-ftp-warning warningmessage\">' +\n                        'Your FTP directory does not contain any files.' +\n                    '</div>';\n        },\n\n        /** Template of main view */\n        _template: function() {\n            return  '<div class=\"upload-ftp\">' +\n                        '<div class=\"upload-ftp-wait fa fa-spinner fa-spin\"/>' +\n                        '<div class=\"upload-ftp-help\">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>' + this.options.ftp_upload_site + '</strong> using your Galaxy credentials (email address and password).</div>' +\n                        '<div class=\"upload-ftp-content\"/>' +\n                    '<div>';\n        }\n    });\n});\n"]}