{"version":3,"file":"history-contents.js","sources":["../../../src/mvc/history/history-contents.js"],"names":["define","CONTROLLED_FETCH_COLLECTION","HDA_MODEL","HDCA_MODEL","HISTORY_PREFS","BASE_MVC","AJAX_QUEUE","_super","ControlledFetchCollection","HistoryContents","extend","LoggableMixin","_logNamespace","model","attrs","options","history_content_type","HistoryDatasetAssociation","collection_type","HistoryListDatasetCollection","HistoryPairDatasetCollection","HistoryListPairedDatasetCollection","validationError","limitOnFirstFetch","limitPerFetch","order","initialize","models","prototype","call","this","history","historyId","idAttribute","includeDeleted","includeHidden","on","args","_","toArray","arguments","test","console","log","apply","concat","urlRoot","Galaxy","root","url","comparators","clone","name","buildComparator","ascending","name-dsc","hid","hid-asc","running","filter","c","inReadyState","runningAndActive","get","getByHid","first","haveDetails","all","hasDetails","hidden","deleted","visibleAndUndeleted","setIncludeDeleted","setting","isBoolean","trigger","setIncludeHidden","fetch","details","prefs","HistoryPrefs","toJSON","values","expandedIds","join","_buildFetchData","v","_fetchParams","_buildFetchFilters","superFilters","filters","purged","visible","defaults","fetchUpdated","since","remove","update_time-ge","toISOString","fetchDeleted","self","undefined","always","fetchHidden","fetchAllDetails","detailsFlag","data","_filterAndUpdate","filterParams","updateWhat","updateArgs","then","fetched","reduce","modelArray","currJson","ajaxQueue","ajaxFn","collection","AjaxQueue","slice","reverse","map","content","fn","isString","start","limitPerProgressiveFetch","progressivelyFetchDetails","_notifyAndContinue","response","offset","deferred","notify","limit","allFetched","resolve","_recursivelyFetch","_options","view","keys","detailKeys","reset","fetchFn","fetchFirst","fetchMore","defer","fail","reject","done","r","jQuery","Deferred","limitPerCall","searchAttributes","isCopyable","contentsJSON","copyableModelClasses","isObject","id","contains","model_class","copy","json","type","contentType","LibraryDatasetDatasetAssociation","HistoryDatasetCollectionAssociation","xhr","post","source","add","parse","createHDCA","elementIdentifiers","collectionType","hdca","create","history_id","element_identifiers","wait","haveSearchDetails","has","attributes","matches","matchesWhat","Backbone","Collection","toString","length","HidSectionedHistoryContents","currentSection","sectionsFetched","_getLastHid","_mapSectionRanges","mapFn","sectionCount","_countSections","sectionNumbers","range","sectionNumber","_getSectionRange","number","Math","max","floor","hidsPerSection","_lastSection","_lastFullSection","count","hasNonFullSection","lastHid","last","_filterSectionCollection","section","filterFn","_sectionCollection","descending","subcollection","startingIndex","_indexOfHid","index","at","push","_indexOfHidInModelArray","otherHid","result","_binarySearch","low","high","testFn","mid","_indexOfHidInSection","lastSection","pastEndOfClosedSection","_getCurrentSectionRange","_filterCurrentSectionCollection","silent","fetchSection","bypassCache","when","hid-ge","hid-le","sort","fetchDeletedInSection","fetchHiddenInSection"],"mappings":"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"}