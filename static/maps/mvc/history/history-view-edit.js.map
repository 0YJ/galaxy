{"version":3,"sources":["mvc/history/history-view-edit.js"],"names":["_super","_historyView2","default","HistoryView","HistoryViewEdit","extend","HDAViewClass","_hdaLiEdit2","HDAListItemEdit","HDCAViewClass","_hdcaLiEdit2","HDCAListItemEdit","initialize","attributes","prototype","call","this","tagsEditor","dragItems","annotationEditor","purgeAllowed","annotationEditorShown","tagsEditorShown","_setUpListeners","ev","data","dataDropped","dropTargetOff","view:attached view:removed","_renderCounts","search:loading-progress","_renderSearchProgress","search:searching","_renderSearchFindings","_setUpModelListeners","updateHistoryDiskSize","_setUpCollectionListeners","listenTo","change:deleted","_handleItemDeletedChange","change:visible","_handleItemVisibleChange","change:purged","model","fetch","fetching-deleted","collection","$","html","_localization2","fetching-deleted-done fetching-hidden-done","_buildNewRender","$newRender","Galaxy","user","id","get","_renderTags","_renderAnnotation","text","renderItems","views","$whereTo","searchFor","$el","$where","panel","_tag2","TagsEditor","el","find","onshow","toggleHDATagEditors","fxSpeed","onshowFirstTime","faIcon","render","appendTo","onhide","AnnotationEditor","$activator","title","classes","toggleHDAAnnotationEditors","_setUpBehaviors","isAnonymous","tooltip","placement","make_text_editable","on_finish","newName","previousName","nameSelector","attr","save","fail","multiselectActions","actions","action","HistoryDatasetAssociation","getSelectedModels","ajaxQueue","func","_hdaModel2","unhide","push","confirm","buildCollection","purge","concat","_collectionActions","selection","hideSourceItems","createFunc","collectionType","options","_getItemViewOptions","_","_listCollectionCreator2","createListCollection","_pairCollectionCreator2","createPairCollection","_listOfPairsCollectionCreator2","createListOfPairsCollection","itemModel","done","contentsShown","active","contents","includeDeleted","_handleItemUndeletion","hidden","_handleItemHidden","_handleItemDeletion","removeItemView","_handleItemUnhidden","each","view","includeHidden","set","events","clone","toggleShowDeleted","toggleShowHidden","showOrHide","speed","stop","limit","toggle","templates","toJSON","click .show-selectors-btn","click .toggle-deleted-link","dragenter","dragover","_renderDropTarget","offset","evName","$dropTarget","join","jQuery","found","_renderDropTargetHelp","dropTarget","dropHandlers","_dropHandlers","hasOwnProperty","off","dragleave","bind","drop","$list","before","dropTargetToggle","remove","preventDefault","addClass","stopPropagation","self","dataTransfer","originalEvent","getData","dropEffect","dropTargetOn","copy","when","css","countsTemplate","counts","JSON","parse","err","warn","trigger","isObject","model_class","currentPage","fetchPage","then","toString","_baseMvc2","wrapTemplate","foundTemplate"],"mappings":"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","file":"../../../scripts/mvc/history/history-view-edit.js","sourcesContent":["import HISTORY_VIEW from \"mvc/history/history-view\";\nimport HISTORY_CONTENTS from \"mvc/history/history-contents\";\nimport STATES from \"mvc/dataset/states\";\nimport HDA_MODEL from \"mvc/history/hda-model\";\nimport HDA_LI_EDIT from \"mvc/history/hda-li-edit\";\nimport HDCA_LI_EDIT from \"mvc/history/hdca-li-edit\";\nimport TAGS from \"mvc/tag\";\nimport ANNOTATIONS from \"mvc/annotation\";\nimport LIST_COLLECTION_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_COLLECTION_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport LIST_OF_PAIRS_COLLECTION_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport PopupMenu from \"mvc/ui/popup-menu\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// base class for history-view-edit-current and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryView allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryViewEdit = _super.extend(\n    /** @lends HistoryViewEdit.prototype */ {\n        /** class to use for constructing the HistoryDatasetAssociation views */\n        HDAViewClass: HDA_LI_EDIT.HDAListItemEdit,\n        /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n        HDCAViewClass: HDCA_LI_EDIT.HDCAListItemEdit,\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes\n     */\n        initialize: function(attributes) {\n            attributes = attributes || {};\n            _super.prototype.initialize.call(this, attributes);\n\n            // ---- set up instance vars\n            /** editor for tags - sub-view */\n            this.tagsEditor = null;\n\n            /** enable drag and drop - sub-view */\n            this.dragItems = true;\n\n            /** editor for annotations - sub-view */\n            this.annotationEditor = null;\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n\n            // states/modes the panel can be in\n            /** is the panel currently showing the dataset selection controls? */\n            this.annotationEditorShown =\n                attributes.annotationEditorShown || false;\n            this.tagsEditorShown = attributes.tagsEditorShown || false;\n        },\n\n        /** Override to handle history as drag-drop target */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            return this.on({\n                \"droptarget:drop\": function(ev, data) {\n                    // process whatever was dropped and re-hide the drop target\n                    this.dataDropped(data);\n                    this.dropTargetOff();\n                },\n                \"view:attached view:removed\": function() {\n                    this._renderCounts();\n                },\n                \"search:loading-progress\": this._renderSearchProgress,\n                \"search:searching\": this._renderSearchFindings\n            });\n        },\n\n        // ------------------------------------------------------------------------ listeners\n        /** listening for history and HDA events */\n        _setUpModelListeners: function() {\n            _super.prototype._setUpModelListeners.call(this);\n            this.listenTo(\n                this.model,\n                \"change:size\",\n                this.updateHistoryDiskSize\n            );\n            return this;\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            this.listenTo(this.collection, {\n                \"change:deleted\": this._handleItemDeletedChange,\n                \"change:visible\": this._handleItemVisibleChange,\n                \"change:purged\": function(model) {\n                    // hafta get the new nice-size w/o the purged model\n                    this.model.fetch();\n                },\n                // loading indicators for deleted/hidden\n                \"fetching-deleted\": function(collection) {\n                    this.$(\"> .controls .deleted-count\").html(\n                        \"<i>\" + _l(\"loading...\") + \"</i>\"\n                    );\n                },\n                \"fetching-hidden\": function(collection) {\n                    this.$(\"> .controls .hidden-count\").html(\n                        \"<i>\" + _l(\"loading...\") + \"</i>\"\n                    );\n                },\n                \"fetching-deleted-done fetching-hidden-done\": this._renderCounts\n            });\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n        _buildNewRender: function() {\n            // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            if (!this.model) {\n                return $newRender;\n            }\n\n            if (\n                Galaxy &&\n                Galaxy.user &&\n                Galaxy.user.id &&\n                Galaxy.user.id === this.model.get(\"user_id\")\n            ) {\n                this._renderTags($newRender);\n                this._renderAnnotation($newRender);\n            }\n            return $newRender;\n        },\n\n        /** Update the history size display (curr. upper right of panel). */\n        updateHistoryDiskSize: function() {\n            this.$(\".history-size\").text(this.model.get(\"nice_size\"));\n        },\n\n        /** override to render counts when the items are rendered */\n        renderItems: function($whereTo) {\n            var views = _super.prototype.renderItems.call(this, $whereTo);\n            if (!this.searchFor) {\n                this._renderCounts($whereTo);\n            } else {\n                this._renderSearchFindings($whereTo);\n            }\n            return views;\n        },\n\n        /** override to show counts, what's deleted/hidden, and links to toggle those */\n        _renderCounts: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.counts(this.model.toJSON(), this);\n            return $whereTo.find(\"> .controls .subtitle\").html(html);\n        },\n\n        /** render the tags sub-view controller */\n        _renderTags: function($where) {\n            var panel = this;\n            this.tagsEditor = new TAGS.TagsEditor({\n                model: this.model,\n                el: $where.find(\".controls .tags-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // show hide sub-view tag editors when this is shown/hidden\n                onshow: function() {\n                    panel.toggleHDATagEditors(true, panel.fxSpeed);\n                },\n                onhide: function() {\n                    panel.toggleHDATagEditors(false, panel.fxSpeed);\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit history tags\"),\n                    classes: \"history-tag-btn\",\n                    faIcon: \"fa-tags\"\n                }).appendTo($where.find(\".controls .actions\"))\n            });\n        },\n        /** render the annotation sub-view controller */\n        _renderAnnotation: function($where) {\n            var panel = this;\n            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n                model: this.model,\n                el: $where.find(\".controls .annotation-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // show hide sub-view view annotation editors when this is shown/hidden\n                onshow: function() {\n                    panel.toggleHDAAnnotationEditors(true, panel.fxSpeed);\n                },\n                onhide: function() {\n                    panel.toggleHDAAnnotationEditors(false, panel.fxSpeed);\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit history annotation\"),\n                    classes: \"history-annotate-btn\",\n                    faIcon: \"fa-comment\"\n                }).appendTo($where.find(\".controls .actions\"))\n            });\n        },\n\n        /** Set up HistoryViewEdit js/widget behaviours\n     *  In this override, make the name editable\n     */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            _super.prototype._setUpBehaviors.call(this, $where);\n            if (!this.model) {\n                return;\n            }\n\n            // anon users shouldn't have access to any of the following\n            if (\n                !Galaxy.user ||\n                Galaxy.user.isAnonymous() ||\n                Galaxy.user.id !== this.model.get(\"user_id\")\n            ) {\n                return;\n            }\n\n            var panel = this;\n            var nameSelector = \"> .controls .name\";\n            $where\n                .find(nameSelector)\n                .attr(\"title\", _l(\"Click to rename history\"))\n                .tooltip({ placement: \"bottom\" })\n                .make_text_editable({\n                    on_finish: function(newName) {\n                        var previousName = panel.model.get(\"name\");\n                        if (newName && newName !== previousName) {\n                            panel.$el.find(nameSelector).text(newName);\n                            panel.model.save({ name: newName }).fail(() => {\n                                panel.$el\n                                    .find(nameSelector)\n                                    .text(panel.model.previous(\"name\"));\n                            });\n                        } else {\n                            panel.$el.find(nameSelector).text(previousName);\n                        }\n                    }\n                });\n        },\n\n        /** return a new popup menu for choosing a multi selection action\n     *  ajax calls made for multiple datasets are queued\n     */\n        multiselectActions: function() {\n            var panel = this;\n\n            var actions = [\n                {\n                    html: _l(\"Hide datasets\"),\n                    func: function() {\n                        var action =\n                            HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Unhide datasets\"),\n                    func: function() {\n                        var action =\n                            HDA_MODEL.HistoryDatasetAssociation.prototype\n                                .unhide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Delete datasets\"),\n                    func: function() {\n                        var action =\n                            HDA_MODEL.HistoryDatasetAssociation.prototype[\n                                \"delete\"\n                            ];\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Undelete datasets\"),\n                    func: function() {\n                        var action =\n                            HDA_MODEL.HistoryDatasetAssociation.prototype\n                                .undelete;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                }\n            ];\n\n            if (panel.purgeAllowed) {\n                actions.push({\n                    html: _l(\"Permanently delete datasets\"),\n                    func: function() {\n                        if (\n                            confirm(\n                                _l(\n                                    \"This will permanently remove the data in your datasets. Are you sure?\"\n                                )\n                            )\n                        ) {\n                            var action =\n                                HDA_MODEL.HistoryDatasetAssociation.prototype\n                                    .purge;\n                            panel.getSelectedModels().ajaxQueue(action);\n                        }\n                    }\n                });\n            }\n            actions = actions.concat(panel._collectionActions());\n            return actions;\n        },\n\n        /**   */\n        _collectionActions: function() {\n            var panel = this;\n            return [\n                {\n                    html: _l(\"Build Dataset List\"),\n                    func: function() {\n                        panel.buildCollection(\"list\");\n                    }\n                },\n                // TODO: Only show quick pair if two things selected.\n                {\n                    html: _l(\"Build Dataset Pair\"),\n                    func: function() {\n                        panel.buildCollection(\"paired\");\n                    }\n                },\n                {\n                    html: _l(\"Build List of Dataset Pairs\"),\n                    func: function() {\n                        panel.buildCollection(\"list:paired\");\n                    }\n                }\n            ];\n        },\n\n        buildCollection: function(collectionType, selection, hideSourceItems) {\n            var panel = this;\n            var selection = selection || panel.getSelectedModels();\n            var hideSourceItems = hideSourceItems || false;\n            var createFunc;\n            if (collectionType == \"list\") {\n                createFunc = LIST_COLLECTION_CREATOR.createListCollection;\n            } else if (collectionType == \"paired\") {\n                createFunc = PAIR_COLLECTION_CREATOR.createPairCollection;\n            } else if (collectionType == \"list:paired\") {\n                createFunc =\n                    LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection;\n            } else {\n                console.warn(\n                    \"Unknown collectionType encountered \" + collectionType\n                );\n            }\n            createFunc(selection, hideSourceItems).done(() => {\n                panel.model.refresh();\n            });\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(\n                this,\n                model\n            );\n            _.extend(options, {\n                purgeAllowed: this.purgeAllowed,\n                tagsEditorShown: this.tagsEditor && !this.tagsEditor.hidden,\n                annotationEditorShown:\n                    this.annotationEditor && !this.annotationEditor.hidden\n            });\n            return options;\n        },\n\n        /** If this item is deleted and we're not showing deleted items, remove the view\n     *  @param {Model} the item model to check\n     */\n        _handleItemDeletedChange: function(itemModel) {\n            if (itemModel.get(\"deleted\")) {\n                this._handleItemDeletion(itemModel);\n            } else {\n                this._handleItemUndeletion(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemDeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeDeleted) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUndeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted -= 1;\n            if (!this.model.contents.includeDeleted) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** If this item is hidden and we're not showing hidden items, remove the view\n     *  @param {Model} the item model to check\n     */\n        _handleItemVisibleChange: function(itemModel) {\n            if (itemModel.hidden()) {\n                this._handleItemHidden(itemModel);\n            } else {\n                this._handleItemUnhidden(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemHidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeHidden) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUnhidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden -= 1;\n            if (!this.model.contents.includeHidden) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n        toggleHDATagEditors: function(showOrHide, speed) {\n            _.each(this.views, view => {\n                if (view.tagsEditor) {\n                    view.tagsEditor.toggle(showOrHide, speed);\n                }\n            });\n        },\n\n        /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n        toggleHDAAnnotationEditors: function(showOrHide, speed) {\n            _.each(this.views, view => {\n                if (view.annotationEditor) {\n                    view.annotationEditor.toggle(showOrHide, speed);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click .toggle-deleted-link\": function(ev) {\n                this.toggleShowDeleted();\n            },\n            \"click .toggle-hidden-link\": function(ev) {\n                this.toggleShowHidden();\n            }\n        }),\n\n        // ------------------------------------------------------------------------ search\n        _renderSearchProgress: function(limit, offset) {\n            var stop = limit + offset;\n            return this.$(\"> .controls .subtitle\").html(\n                [\n                    \"<i>\",\n                    _l(\"Searching \"),\n                    stop,\n                    \"/\",\n                    this.model.contentsShown(),\n                    \"</i>\"\n                ].join(\"\")\n            );\n        },\n\n        /** override to display number found in subtitle */\n        _renderSearchFindings: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.found(this.model.toJSON(), this);\n            $whereTo.find(\"> .controls .subtitle\").html(html);\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ as drop target\n        /** turn all the drag and drop handlers on and add some help text above the drop area */\n        dropTargetOn: function() {\n            if (this.dropTarget) {\n                return this;\n            }\n            this.dropTarget = true;\n\n            //TODO: to init\n            var dropHandlers = {\n                dragenter: _.bind(this.dragenter, this),\n                dragover: _.bind(this.dragover, this),\n                dragleave: _.bind(this.dragleave, this),\n                drop: _.bind(this.drop, this)\n            };\n\n            var $dropTarget = this._renderDropTarget();\n            this.$list().before([this._renderDropTargetHelp(), $dropTarget]);\n            for (var evName in dropHandlers) {\n                if (dropHandlers.hasOwnProperty(evName)) {\n                    //console.debug( evName, dropHandlers[ evName ] );\n                    $dropTarget.on(evName, dropHandlers[evName]);\n                }\n            }\n            return this;\n        },\n\n        /** render a box to serve as a 'drop here' area on the history */\n        _renderDropTarget: function() {\n            this.$(\".history-drop-target\").remove();\n            return $(\"<div/>\").addClass(\"history-drop-target\");\n        },\n\n        /** tell the user how it works  */\n        _renderDropTargetHelp: function() {\n            this.$(\".history-drop-target-help\").remove();\n            return $(\"<div/>\")\n                .addClass(\"history-drop-target-help\")\n                .text(\n                    _l(\"Drag datasets here to copy them to the current history\")\n                );\n        },\n\n        /** shut down drag and drop event handlers and remove drop target */\n        dropTargetOff: function() {\n            if (!this.dropTarget) {\n                return this;\n            }\n            //this.log( 'dropTargetOff' );\n            this.dropTarget = false;\n            var dropTarget = this.$(\".history-drop-target\").get(0);\n            for (var evName in this._dropHandlers) {\n                if (this._dropHandlers.hasOwnProperty(evName)) {\n                    dropTarget.off(evName, this._dropHandlers[evName]);\n                }\n            }\n            this.$(\".history-drop-target\").remove();\n            this.$(\".history-drop-target-help\").remove();\n            return this;\n        },\n        /** toggle the target on/off */\n        dropTargetToggle: function() {\n            if (this.dropTarget) {\n                this.dropTargetOff();\n            } else {\n                this.dropTargetOn();\n            }\n            return this;\n        },\n\n        dragenter: function(ev) {\n            //console.debug( 'dragenter:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"2px solid black\");\n        },\n        dragover: function(ev) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        },\n        dragleave: function(ev) {\n            //console.debug( 'dragleave:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"1px dashed black\");\n        },\n        /** when (text) is dropped try to parse as json and trigger an event */\n        drop: function(ev) {\n            ev.preventDefault();\n            //ev.stopPropagation();\n\n            var self = this;\n            var dataTransfer = ev.originalEvent.dataTransfer;\n            var data = dataTransfer.getData(\"text\");\n\n            dataTransfer.dropEffect = \"move\";\n            try {\n                data = JSON.parse(data);\n            } catch (err) {\n                self.warn(\"error parsing JSON from drop:\", data);\n            }\n\n            self.trigger(\"droptarget:drop\", ev, data, self);\n            return false;\n        },\n\n        /** handler that copies data into the contents */\n        dataDropped: function(data) {\n            var self = this;\n            // HDA: dropping will copy it to the history\n            if (\n                _.isObject(data) &&\n                data.model_class === \"HistoryDatasetAssociation\" &&\n                data.id\n            ) {\n                if (self.contents.currentPage !== 0) {\n                    return self.contents\n                        .fetchPage(0)\n                        .then(() => self.model.contents.copy(data.id));\n                }\n                return self.model.contents.copy(data.id);\n            }\n            return jQuery.when();\n        },\n\n        // ........................................................................ misc\n        /** Return a string rep of the history */\n        toString: function() {\n            return (\n                \"HistoryViewEdit(\" +\n                (this.model ? this.model.get(\"name\") : \"\") +\n                \")\"\n            );\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryViewEdit.prototype.templates = (() => {\n    var countsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% var shown = Math.max( view.views.length, history.contents_active.active ) %>\",\n            \"<% if( shown ){ %>\",\n            '<span class=\"shown-count\">',\n            \"<%- shown %> \",\n            _l(\"shown\"),\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            '<span class=\"deleted-count\">',\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.deleted %> \",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"deleted\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            '<span class=\"hidden-count\">',\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.hidden %> \",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    var foundTemplate = BASE_MVC.wrapTemplate(\n        [\n            _l(\"Found\"),\n            \" <%- view.views.length %>, \",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>, \",\n            \"<% } else { %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"show deleted\"),\n            \"</a>, \",\n            \"<% } %>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"show hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        counts: countsTemplate,\n        found: foundTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HistoryViewEdit: HistoryViewEdit\n};\n"]}