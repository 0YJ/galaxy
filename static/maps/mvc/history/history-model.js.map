{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","HISTORY_PREFS","CONTROLLED_FETCH_COLLECTION","UTILS","BASE_MVC","_l","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_active","contents_states","urlRoot","Galaxy","root","contentsClass","HistoryContents","searchAttributes","searchAliases","title","tag","initialize","historyJSON","options","this","logger","log","contents","history","historyId","get","order","_setUpListeners","_setUpCollectionListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","listenTo","trigger","apply","jQuery","makeArray","arguments","contentsShown","contentsActive","shown","active","includeDeleted","includeHidden","hidden","nice_size","size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","runningAndActive","_fetchContentRelatedAttributes","contentRelatedAttrs","fetch","data","$","param","keys","join","refresh","self","lastUpdateTime","allFetched","fetchFn","currentPage","console","fetchPage","fetchUpdated","done","response","status","xhr","serverResponseDatetime","Date","getResponseHeader","err","checkForUpdates","_delayThenUpdate","setTimeout","delay","nonReadyContentCount","clearTimeout","parse","parsed","create_time","update_time","fetchWithContents","contentsOptions","view","then","setHistoryId","fetchContents","fetchCurrentPage","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","newHistory","setAsCurrent","getJSON","toString","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","models","currentHistoryId","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","filters","fetchFirst","silent","limit","encoded_id-in","offset","fetchMore","comparators","clone","buildComparator","ascending","name-dsc","size-asc","sort","currentHistory","unshift","create","hdas","historyOptions","collection"],"mappings":"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"}