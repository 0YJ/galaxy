{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","HISTORY_PREFS","CONTROLLED_FETCH_COLLECTION","UTILS","BASE_MVC","_l","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_active","contents_states","urlRoot","Galaxy","root","contentsClass","HistoryContents","initialize","historyJSON","options","this","logger","log","contents","history","historyId","get","order","_setUpListeners","_setUpCollectionListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","listenTo","trigger","apply","jQuery","makeArray","arguments","contentsShown","contentsActive","shown","active","includeDeleted","includeHidden","hidden","nice_size","size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","runningAndActive","searchAttributes","searchAliases","title","tag","_fetchContentRelatedAttributes","contentRelatedAttrs","fetch","data","$","param","keys","join","refresh","self","lastUpdateTime","allFetched","fetchFn","currentPage","fetchPage","fetchUpdated","done","response","status","xhr","serverResponseDatetime","Date","getResponseHeader","err","checkForUpdates","_delayThenUpdate","setTimeout","delay","nonReadyContentCount","clearTimeout","parse","parsed","create_time","update_time","fetchWithContents","contentsOptions","view","then","setHistoryId","fetchContents","fetchCurrentPage","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","newHistory","setAsCurrent","getJSON","toString","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","models","currentHistoryId","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","filters","fetchFirst","silent","limit","encoded_id-in","offset","fetchMore","comparators","clone","buildComparator","ascending","name-dsc","size-asc","sort","currentHistory","unshift","create","hdas","historyOptions","collection"],"mappings":"AACAA,QACI,+BACA,kCACA,uCACA,cACA,eACA,sBACD,SAAUC,EAAkBC,EAAeC,EAA6BC,EAAOC,EAAUC,GAC5F,YAQA,IAAIC,GAAUC,SAASC,MACdC,OAAQL,EAASM,eACjBD,OAAQL,EAASO,MAAOP,EAASQ,sBACtCC,cAAgB,UAGhBC,aAAe,IAGfC,UACIC,YAAkB,UAClBC,GAAkB,KAClBC,KAAkB,kBAClBC,MAAkB,MAElBC,SAAkB,EAClBC,mBACAC,oBAGJC,QAASC,OAAOC,KAAO,gBAEvBC,cAAgB1B,EAAiB2B,gBAOjCC,WAAa,SAAUC,EAAaC,GAChCA,EAAUA,MACVC,KAAKC,OAASF,EAAQE,QAAU,KAChCD,KAAKE,IAAKF,KAAO,eAAgBF,EAAaC,GAG9CC,KAAKG,SAAW,GAAIH,MAAKL,kBACrBS,QAAcJ,KACdK,UAAcL,KAAKM,IAAK,MACxBC,MAAcR,EAAQQ,QAG1BP,KAAKQ,kBACLR,KAAKS,4BAGLT,KAAKU,gBAAkB,MAM3BF,gBAAkB,WAEd,MAAOR,MAAKW,IACRC,MAAU,WACNZ,KAAKa,sBAETC,YAAc,SAAUC,EAAOC,GACvBhB,KAAKG,WACLH,KAAKG,SAASE,UAAYW,OAO1CP,0BAA4B,WACxB,MAAKT,MAAKG,SAEHH,KAAKiB,SAAUjB,KAAKG,UACvBS,MAAU,WACNZ,KAAKkB,QAAQC,MAAOnB,KAAMoB,OAAOC,UAAWC,eAJvBtB,MAWjCuB,cAAgB,WACZ,GAAIC,GAAiBxB,KAAKM,IAAK,mBAC3BmB,EAAQD,EAAeE,QAAU,CAGrC,OAFAD,IAASzB,KAAKG,SAASwB,eAAgBH,EAAenC,QAAU,EAChEoC,GAASzB,KAAKG,SAASyB,cAAgBJ,EAAeK,OAAU,GAKpEC,UAAY,WACR,GAAIC,GAAO/B,KAAKM,IAAK,OACrB,OAAOyB,GAAM3D,EAAM4D,cAAeD,GAAM,EAAM,GAAMzD,EAAI,YAI5D2D,OAAS,WACL,MAAOC,GAAExD,OAAQF,SAASC,MAAM0D,UAAUF,OAAOG,KAAMpC,OACnD8B,UAAY9B,KAAK8B,eAKzBxB,IAAM,SAAU+B,GACZ,MAAY,cAARA,EACOrC,KAAK8B,YAETtD,SAASC,MAAM0D,UAAU7B,IAAIa,MAAOnB,KAAMsB,YAOrDgB,gBAAkB,WAEd,MAAK7C,SAAWA,OAAO8C,KAInB9C,OAAO8C,KAAKC,eAAiB/C,OAAO8C,KAAKrD,KAAOc,KAAKM,IAAK,YACnD,GAEJ,GANI,GAUfmC,oBAAsB,WAClB,GAAIC,GAAmB1C,KAAKM,IAAK,iBACjC,OAAOoC,GAAkBA,EAAiBC,OAAS,GAIvDC,6BAA+B,WAC3B,MAAO5C,MAAKG,SAAS0C,mBAAmBF,QAAU,GAKtDG,kBACI,OAAQ,aAAc,QAI1BC,eACIC,MAAc,OACdC,IAAc,QAIlBC,+BAAiC,WAC7B,GAAIC,IAAwB,OAAQ,iBAAkB,kBAAmB,cACzE,OAAOnD,MAAKoD,OAAQC,KAAOC,EAAEC,OAAQC,KAAOL,EAAoBM,KAAM,UAI1EC,QAAU,SAAU3D,GAEhBA,EAAUA,KACV,IAAI4D,GAAO3D,KAGP4D,EAAiBD,EAAKC,cAE1B5D,MAAKG,SAAS0D,YAAa,CAC3B,IAAIC,GAAwC,IAA9BH,EAAKxD,SAAS4D,YACtB,WAAY,MAAOJ,GAAKxD,SAAS6D,UAAW,IAC5C,WAAY,MAAOL,GAAKxD,SAAS8D,aAAcL,GAErD,OAAOE,KACFI,KAAM,SAAUC,EAAUC,EAAQC,GAC/B,GAAIC,EACJ,KACIA,EAAyB,GAAIC,MAAMF,EAAIG,kBAAmB,SAC5D,MAAOC,IACTd,EAAKC,eAAiBU,GAA0B,GAAIC,MACpDZ,EAAKe,gBAAiB3E,MAKlC2E,gBAAkB,SAAU3E,GAOxB,QAAS4E,KAELhB,EAAK9C,qBACL8C,EAAKjD,gBAAkBkE,WAAY,WAC/BjB,EAAKD,QAAS3D,IACf8E,GAVP9E,EAAUA,KACV,IAAI8E,GAAQ7E,KAAKjB,aACb4E,EAAO3D,IACX,IAAK2D,EAAKzE,GAAV,CAWA,GAAI4F,GAAuB9E,KAAK4C,8BAE5BkC,GAAuB,EACvBH,IAMAhB,EAAKT,iCACAgB,KAAM,WAECP,EAAKlB,sBAAwB,EAC7BkC,IAIAhB,EAAKzC,QAAS,aAOlCL,mBAAqB,WACbb,KAAKU,kBACLqE,aAAc/E,KAAKU,iBACnBV,KAAKU,gBAAkB,OAM/BsE,MAAQ,SAAUb,EAAUpE,GACxB,GAAIkF,GAASzG,SAASC,MAAM0D,UAAU6C,MAAM5C,KAAMpC,KAAMmE,EAAUpE,EAOlE,OANIkF,GAAOC,cACPD,EAAOC,YAAc,GAAIX,MAAMU,EAAOC,cAEtCD,EAAOE,cACPF,EAAOE,YAAc,GAAIZ,MAAMU,EAAOE,cAEnCF,GAIXG,kBAAoB,SAAUrF,EAASsF,GACnCtF,EAAUA,KACV,IAAI4D,GAAO3D,IAOX,OAHAD,GAAQuF,KAAO,eAGRtF,KAAKoD,MAAOrD,GAAUwF,KAAM,SAAsBnF,GAGrD,MAFAuD,GAAKxD,SAASC,QAAUuD,EACxBA,EAAKxD,SAASqF,aAAcpF,EAAQlB,IAC7ByE,EAAK8B,cAAeJ,MAKnCI,cAAgB,SAAU1F,GACtBA,EAAUA,KACV,IAAI4D,GAAO3D,IAIX,OADA2D,GAAKC,eAAiB,GAAIW,MACnBZ,EAAKxD,SAASuF,iBAAkB3F,IAI3C4F,QAAU,SAAU5F,GAChB,MAAIC,MAAKM,IAAK,WAAsBc,OAAOwE,OACpC5F,KAAK6F,MAAQxG,SAAS,GAAQU,IAGzC+F,MAAQ,SAAU/F,GACd,MAAIC,MAAKM,IAAK,UAAqBc,OAAOwE,OACnC5F,KAAK6F,MAAQxG,SAAS,EAAM0G,QAAQ,GAAQhG,IAGvDiG,SAAW,SAAUjG,GACjB,MAAKC,MAAKM,IAAK,WACRN,KAAK6F,MAAQxG,SAAS,GAASU,GADDqB,OAAOwE,QAUhDK,KAAO,SAAUC,EAAS/G,EAAMgH,GAE5B,GADAD,EAAwBE,SAAZF,EAAwB,GAAY,GAC3ClG,KAAKd,GACN,KAAM,IAAImH,OAAO,iDAGrB,IAAIC,IAAaC,WAAcvG,KAAKd,GAChCgH,KACAI,EAASJ,SAAU,GAEnB/G,IACAmH,EAASnH,KAAOA,GAEfgH,IACDG,EAASE,cAAe,GAE5BF,EAAShB,KAAO,cAEhB,IAAIlF,GAAUJ,KACViG,EAAO7E,OAAOqF,KAAMzG,KAAKR,QAAS8G,EAEtC,OAAIJ,GACOD,EAAKV,KAAM,SAAUpB,GACxB,GAAIuC,GAAa,GAAInI,GAAS4F,EAC9B,OAAOuC,GAAWC,eACbzC,KAAM,WACH9D,EAAQc,QAAS,SAAUd,EAAS+D,OAI7C8B,EAAK/B,KAAM,SAAUC,GACxB/D,EAAQc,QAAS,SAAUd,EAAS+D,MAI5CwC,aAAe,WACX,GAAIvG,GAAUJ,KACVqE,EAAMjD,OAAOwF,QAASnH,OAAOC,KAAO,6BAA+BM,KAAKd,GAK5E,OAHAmF,GAAIH,KAAM,WACN9D,EAAQc,QAAS,iBAAkBd,KAEhCiE,GAIXwC,SAAW,WACP,MAAO,WAAa7G,KAAKM,IAAK,MAAS,IAAMN,KAAKM,IAAK,QAAW,QAMtEwG,EAAmB3I,EAA4B4I,8BAK/CC,EAAoBF,EAAiBpI,OAAQL,EAASM,eAAgBD,QACtEI,cAAsB,UAEtBiC,MAAsBxC,EAEtBgC,MAAsB,cAEtB0G,kBAAsB,GAEtBC,cAAsB,GAEtBrH,WAAa,SAAUsH,EAAQpH,GAC3BA,EAAUA,MACVC,KAAKE,IAAK,+BAAgCiH,EAAQpH,GAClD+G,EAAiB3E,UAAUtC,WAAWuC,KAAMpC,KAAMmH,EAAQpH,GAG1DC,KAAK2B,eAAiB5B,EAAQ4B,iBAAkB,EAGhD3B,KAAKoH,iBAAmBrH,EAAQqH,iBAEhCpH,KAAKqH,kBAKT7H,QAAUC,OAAOC,KAAO,gBACxB4H,IAAU,WAAY,MAAOtH,MAAKR,SAGlC6H,eAAiB,WACb,MAAOrH,MAAKW,IAER4G,iBAAmB,SAAUnH,GAEzBJ,KAAKwH,MAAO,iBAAkBxH,KAAK2B,eAAgBvB,EAAQE,IAAK,aAC3DN,KAAK2B,gBAAkBvB,EAAQE,IAAK,YACrCN,KAAKyH,OAAQrH,IAIrBsH,OAAW,SAAUC,EAAUC,GAC3B5H,KAAK6H,WAAY,GAAItJ,GAASqJ,QAGlCE,iBAAmB,SAAU1H,GACzB,GAAI2H,GAAe/H,KAAKoH,gBACxBpH,MAAKkB,QAAS,oBAAqB6G,GACnC/H,KAAKoH,iBAAmBhH,EAAQlB,OAM5C8I,gBAAkB,SAAUjI,GACxB,MAAOmC,GAAExD,OAAQoI,EAAiB3E,UAAU6F,gBAAgB5F,KAAMpC,KAAMD,IACpEuF,KAAO,kBAKf2C,mBAAqB,SAAUlI,GAC3B,GAAImI,GAAepB,EAAiB3E,UAAU8F,mBAAmB7F,KAAMpC,KAAMD,OACzEoI,IASJ,OARKnI,MAAK2B,eAMNwG,EAAQ9I,QAAU,MALlB8I,EAAQ9I,SAAU,EAClB8I,EAAQpC,QAAS,GAMd7D,EAAElD,SAAUkJ,EAAcC,IAIrCC,WAAa,SAAUrI,GACnB,GAAI4D,GAAO3D,KAEPqE,EAAMf,EAAEsC,MAaZ,OAZI5F,MAAKoH,mBACL/C,EAAMyC,EAAiB3E,UAAUiG,WAAWhG,KAAMuB,GAC9C0E,QAAQ,EACRC,MAAQ,EACRH,SAEIpC,OAAkB,GAClB1G,QAAkB,GAClBkJ,gBAAkBvI,KAAKoH,qBAI5B/C,EAAIkB,KAAM,WAGb,MAFAxF,GAAUA,MACVA,EAAQyI,OAAS,EACV7E,EAAK8E,UAAW1I,MAK/B2I,YAAcxG,EAAExD,OAAQwD,EAAEyG,MAAO7B,EAAiB3E,UAAUuG,cACxDvJ,KAAed,EAASuK,gBAAiB,QAAUC,WAAW,IAC9DC,WAAezK,EAASuK,gBAAiB,QAAUC,WAAW,IAC9D9G,KAAe1D,EAASuK,gBAAiB,QAAUC,WAAW,IAC9DE,WAAe1K,EAASuK,gBAAiB,QAAUC,WAAW,MAIlEG,KAAO,SAAUjJ,GACbA,EAAUA,KACV,IAAIsI,GAAStI,EAAQsI,OACjBY,EAAiBjJ,KAAKyH,OAAQzH,KAAKM,IAAKN,KAAKoH,kBAMjD,OALAN,GAAiB3E,UAAU6G,KAAK5G,KAAMpC,KAAMkC,EAAElD,UAAWqJ,QAAQ,GAAQtI,IACzEC,KAAKkJ,QAASD,GAAkBZ,QAAQ,IACnCA,GACDrI,KAAKkB,QAAS,OAAQlB,KAAMD,GAEzBC,MAIXmJ,OAAS,SAAiB9F,EAAM+F,EAAMC,GAElC,GAAIC,GAAatJ,KACbqE,EAAMjD,OAAOwF,QAASnH,OAAOC,KAAO,6BACxC,OAAO2E,GAAIH,KAAM,SAAU0D,GACvB0B,EAAWzB,WAAY,GAAItJ,GAASqJ,KAAayB,WAQzDxB,WAAa,SAAUzH,EAASL,GAQ5B,MAPAA,GAAUA,MAEVC,KAAKkJ,QAAS9I,EAASL,GACvBC,KAAKoH,iBAAmBhH,EAAQE,IAAK,MAChCP,EAAQsI,QACTrI,KAAKkB,QAAS,cAAed,EAASJ,MAEnCA,MAGX6G,SAAU,WACN,MAAO,qBAAuB7G,KAAK2C,OAAS,YAAc3C,KAAKoH,iBAAmB,MAM1F,QACI7I,QAAoBA,EACpByI,kBAAoBA"}