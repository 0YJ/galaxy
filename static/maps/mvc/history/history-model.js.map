{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","UTILS","BASE_MVC","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_shown","urlRoot","Galaxy","root","initialize","historyJSON","contentsJSON","options","this","logger","log","contents","HistoryContents","historyId","get","_setUpListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","_setUpCollectionListeners","listenTo","trigger","apply","jQuery","makeArray","arguments","nice_size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","running","visibleAndUndeleted","searchAttributes","searchAliases","title","tag","_getSizeAndRunning","fetch","data","$","param","keys","refresh","self","lastUpdateTime","Date","fetchUpdated","done","bind","checkForUpdates","_delayThenUpdate","setTimeout","delay","clearTimeout","fetchWithContents","contentsOptions","view","pipe","history","fetchFirst","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","then","response","newHistory","setAsCurrent","xhr","getJSON","toString","ControlledFetchMixin","_buildFetchData","traditional","Collection","_fetchOptions","fetchDefaults","_fetchDefaults","pick","filters","has","isEmpty","_buildFetchFilters","filterMap","q","qv","each","v","k","push","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size","size-asc","models","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","collection","sortOrder","isUndefined","comparator","a","b","fetchOptions","offset","limit","fetchData","numFetched","isArray","create","hdas","historyOptions","unshift","silent","reset"],"mappings":"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"}