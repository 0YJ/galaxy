{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","HISTORY_PREFS","CONTROLLED_FETCH_COLLECTION","UTILS","BASE_MVC","_l","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_active","contents_states","urlRoot","Galaxy","root","contentsClass","HistoryContents","initialize","historyJSON","options","this","logger","log","contents","history","historyId","get","order","_setUpListeners","_setUpCollectionListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","listenTo","trigger","apply","jQuery","makeArray","arguments","contentsShown","contentsActive","shown","active","includeDeleted","includeHidden","hidden","nice_size","size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","runningAndActive","searchAttributes","searchAliases","title","tag","_fetchContentRelatedAttributes","contentRelatedAttrs","fetch","data","$","param","keys","join","refresh","self","lastUpdateTime","allFetched","fetchUpdated","done","response","status","xhr","serverResponseDatetime","Date","getResponseHeader","err","checkForUpdates","_delayThenUpdate","setTimeout","delay","nonReadyContentCount","clearTimeout","parse","parsed","create_time","update_time","fetchWithContents","contentsOptions","view","then","setHistoryId","fetchContents","fetchCurrentPage","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","newHistory","setAsCurrent","getJSON","toString","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","models","currentHistoryId","setUpListeners","url","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","filters","fetchFirst","silent","limit","encoded_id-in","offset","fetchMore","comparators","clone","buildComparator","ascending","name-dsc","size-asc","sort","currentHistory","unshift","create","hdas","historyOptions","collection"],"mappings":"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"}