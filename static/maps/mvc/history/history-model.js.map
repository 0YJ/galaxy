{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","UTILS","BASE_MVC","logNamespace","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","UPDATE_DELAY","defaults","model_class","id","name","state","deleted","contents_shown","urlRoot","Galaxy","root","initialize","historyJSON","contentsJSON","options","this","logger","log","contents","HistoryContents","historyId","get","_setUpListeners","updateTimeoutId","on","error","clearUpdateTimeout","change:id","model","newId","_setUpCollectionListeners","listenTo","trigger","apply","jQuery","makeArray","arguments","nice_size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","running","visibleAndUndeleted","searchAttributes","searchAliases","title","tag","_getSizeAndRunning","fetch","data","$","param","keys","refresh","self","lastUpdateTime","Date","fetchUpdated","done","bind","checkForUpdates","_delayThenUpdate","setTimeout","delay","clearTimeout","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","history","post","then","response","newHistory","setAsCurrent","xhr","getJSON","toString","getHistoryData","getHistory","ajax","isEmpty","historyData","empty","getContents","isFunction","detailIdsFn","hdcaDetailIds","v","details","join","df","Deferred","historyFn","contentsFn","historyXHR","json","notify","status","fail","reject","contentsXHR","resolve","ControlledFetchMixin","_buildFetchData","traditional","Collection","_fetchOptions","fetchDefaults","_fetchDefaults","pick","filters","has","_buildFetchFilters","filterMap","q","qv","each","k","push","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size","size-asc","models","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","url","view","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","collection","sortOrder","isUndefined","comparator","a","b","fetchOptions","offset","limit","fetchData","numFetched","isArray","create","hdas","historyOptions","unshift","silent","reset"],"mappings":"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"}