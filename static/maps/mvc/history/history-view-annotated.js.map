{"version":3,"sources":["mvc/history/history-view-annotated.js"],"names":["define","HISTORY_VIEW","HDA_LI","HDCA_LI","BASE_MVC","_l","_super","HistoryView","AnnotatedHistoryView","extend","className","prototype","_buildNewRender","$newRender","call","this","renderHistoryAnnotation","annotation","model","get","find","text","renderItems","$whereTo","$el","$controls","remove","$","append","appendTo","self","views","_renderItemView$el","view","render","events","_","clone","click .contents-container","ev","stopPropagation","currentTarget","click","click .icon-btn","$currTarget","length","attr","dropdown","_clickSectionLink","sectionNumber","parent","data","openSection","toString"],"mappings":"AAAAA,QACI,2BACA,qBACA,sBACA,eACA,sBACD,SAAUC,EAAcC,EAAQC,EAASC,EAAUC,GAEtD,YAMA,IAAIC,GAASL,EAAaM,WAwFtB,QACIC,qBAhFmBF,EAAOG,QAE9BC,UAAeJ,EAAOK,UAAUD,UAAY,2BAI5CE,gBAAkB,WAEd,GAAIC,GAAaP,EAAOK,UAAUC,gBAAgBE,KAAMC,KAExD,OADAA,MAAKC,wBAAyBH,GACvBA,GAIXG,wBAA0B,SAAUH,GAChC,GAAII,GAAaF,KAAKG,MAAMC,IAAK,aAC5BF,IACLJ,EAAWO,KAAM,yBAA0BC,KAAMJ,IAIrDK,YAAc,SAAUC,GACpBA,EAAWA,GAAYR,KAAKS,IAC5BlB,EAAOK,UAAUW,YAAYR,KAAMC,KAAMQ,EAEzC,IAAIE,GAAYF,EAASH,KAAM,cAC/BK,GAAUL,KAAM,+BAAgCM,QAEjCC,GAAG,6CACbC,QACGD,EAAG,yCAA0CN,KAAMhB,EAAI,YACvDsB,EAAG,yCAA0CN,KAAMhB,EAAI,iBACxDwB,SAAUJ,EAEjB,OAAOK,MAAKC,OAKhBC,mBAAqB,SAAUC,GAC3B,MAAON,GAAG,qCAAsCC,QAC5CK,EAAKC,OAAO,GAAGV,IACfG,EAAG,kCAAmCN,KAAMY,EAAKf,MAAMC,IAAK,eAAkB,OAKtFgB,OAASC,EAAE3B,OAAQ2B,EAAEC,MAAO/B,EAAOK,UAAUwB,SAEzCG,4BAA8B,SAAUC,GACpCA,EAAGC,kBACHb,EAAGY,EAAGE,eAAgBrB,KAAM,yBAA0BsB,SAG1DC,kBAAoB,SAAUJ,GAC1BA,EAAGC,iBAGH,IAAII,GAAcjB,EAAGY,EAAGE,cACpBG,GAAYC,QAAgD,aAAtCD,EAAYE,KAAM,gBACxCF,EAAYG,SAAU,aAKlCC,kBAAoB,SAAUT,GAC1B,GAAIU,GAAgBtB,EAAGY,EAAGE,eAAgBS,SAASA,SAASC,KAAM,UAClEpC,MAAKqC,YAAaH,IAKtBI,SAAc,WACV,MAAO,yBAA6BtC,KAAW,MAAIA,KAAKG,MAAMC,IAAK,QAAU,IAAU","file":"../../../scripts/mvc/history/history-view-annotated.js","sourcesContent":["define([\n    \"mvc/history/history-view\",\n    \"mvc/history/hda-li\",\n    \"mvc/history/hdca-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_VIEW, HDA_LI, HDCA_LI, BASE_MVC, _l ){\n\n'use strict';\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// used in history/display.mako and history/embed.mako\n/** @class View/Controller for a tabular view of the history model.\n *\n *  As ReadOnlyHistoryView, but with:\n *      history annotation always shown\n *      datasets displayed in a table:\n *          datasets in left cells, dataset annotations in the right\n */\nvar AnnotatedHistoryView = _super.extend(/** @lends AnnotatedHistoryView.prototype */{\n\n    className    : _super.prototype.className + ' annotated-history-panel',\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add the history annotation */\n    _buildNewRender : function(){\n        //TODO: shouldn't this display regardless (on all non-current panels)?\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        this.renderHistoryAnnotation( $newRender );\n        return $newRender;\n    },\n\n    /** render the history's annotation as its own field */\n    renderHistoryAnnotation : function( $newRender ){\n        var annotation = this.model.get( 'annotation' );\n        if( !annotation ){ return; }\n        $newRender.find( '> .controls .subtitle' ).text( annotation );\n    },\n\n    /** override to add headers to indicate the dataset, annotation columns */\n    renderItems : function( $whereTo ){\n        $whereTo = $whereTo || this.$el;\n        _super.prototype.renderItems.call( this, $whereTo );\n\n        var $controls = $whereTo.find( '> .controls' );\n        $controls.find( '.contents-container.headers' ).remove();\n\n        var $headers = $( '<div class=\"contents-container headers\"/>' )\n            .append([\n                $( '<div class=\"history-content header\"/>' ).text( _l( 'Dataset' ) ),\n                $( '<div class=\"additional-info header\"/>' ).text( _l( 'Annotation' ) )\n            ]).appendTo( $controls );\n\n        return self.views;\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** override to wrap each subview */\n    _renderItemView$el : function( view ){\n        return $( '<div class=\"contents-container\"/>' ).append([\n            view.render(0).$el,\n            $( '<div class=\"additional-info\"/>' ).text( view.model.get( 'annotation' ) || '' )\n        ]);\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    events : _.extend( _.clone( _super.prototype.events ), {\n        // clicking on any part of the row will expand the items\n        'click .contents-container' : function( ev ){\n            ev.stopPropagation();\n            $( ev.currentTarget ).find( '.list-item .title-bar' ).click();\n        },\n        // prevent propagation on icon btns so they won't bubble up to tr and toggleBodyVisibility\n        'click .icon-btn' : function( ev ){\n            ev.stopPropagation();\n            // stopProp will prevent bootstrap from getting the click needed to open a dropdown\n            //  in the case of metafile download buttons - workaround here\n            var $currTarget = $( ev.currentTarget );\n            if( $currTarget.length && $currTarget.attr( 'data-toggle' ) === 'dropdown' ){\n                $currTarget.dropdown( 'toggle' );\n            }\n        }\n    }),\n\n    _clickSectionLink : function( ev ){\n        var sectionNumber = $( ev.currentTarget ).parent().parent().data( 'section' );\n        this.openSection( sectionNumber );\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString    : function(){\n        return 'AnnotatedHistoryView(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        AnnotatedHistoryView        : AnnotatedHistoryView\n    };\n});\n"]}