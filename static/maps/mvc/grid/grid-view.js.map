{"version":3,"sources":["mvc/grid/grid-view.js"],"names":["jQuery","ajaxSettings","traditional","define","Backbone","extend","PopupMenu","grid","View","initialize","window","add_tag_to_grid_filter","this","dict_format","grid_config","self","tag_name","is","$","slideToggle","tag_value","add_filter_condition","tag","url_data","_","items","ajax","filters","v","k","url","url_base","response","init_grid","embedded","setElement","overflow","css","padding","handle_refresh","Galaxy","top","inArray","refresh_frames","currHistoryPanel","loadCurrentHistory","options","get","replace","$el","html","Templates","find","header","body","footer","use_hide_message","setTimeout","message","init_grid_elements","init_grid_controls","init_refresh_on_change","each","off","submit_operation","select","keyup","click","set_sort_condition","attr","submit","column_key","text_input_obj","text_input","val","remove","remove_filter_condition","set_categorical_filter","on","checkboxes","check_count","update_checked","filter","length","change","rating","attributes","set_page","e","execute","href","items_length","item","button","index","popup","operation","_add_operation","settings","operation_config","label","url_args","target","confirmation_text","func","onclick","findItemByHtml","name","value","add_filter","t","filter_element","container","append","go_page_one","remove_filter","col_key","cur_sort","new_sort","indexOf","substring","sort_arrow","addClass","set","new_value","category_filter","cur_value","text","trim","filter_value","empty","removeClass","new_page","cur_page","id","page_num","parseInt","split","children","operation_button","operation_name","number_of_checked_ids","findWhere","operations","item_ids","push","check_all_items","check","state","prop","c","href_parts","href_parms_str","href_parms","confirm","toLowerCase","update_grid","param","get_url_data","can_async_op","go_to","async","advanced_search","undefined","$div","load","closest","location","method","show","type","data","error","alert","success","response_text","insert","json","parseJSON","hide","complete"],"mappings":"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","file":"../../../scripts/mvc/grid/grid-view.js","sourcesContent":["// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\njQuery.ajaxSettings.traditional = true;\n\n// dependencies\ndefine([\n    'utils/utils',\n    'mvc/grid/grid-model',\n    'mvc/grid/grid-template',\n    'mvc/ui/popup-menu'\n], function(Utils, GridModel, Templates, PopupMenu) {\n\n// grid view\nreturn Backbone.View.extend({\n\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function(grid_config) {\n        this.dict_format = grid_config.dict_format;\n        var self = this;\n        window.add_tag_to_grid_filter = function( tag_name, tag_value ){\n            // Put tag name and value together.\n            var tag = tag_name + ( tag_value !== undefined && tag_value !== \"\" ? \":\" + tag_value : \"\" );\n            var advanced_search = $( '#advanced-search').is(\":visible\" );\n            if( !advanced_search ){\n                $('#standard-search').slideToggle('fast');\n                $('#advanced-search').slideToggle('fast');\n            }\n            self.add_filter_condition( \"tags\", tag );\n        };\n\n        // set element\n        if ( this.dict_format ) {\n            this.setElement('<div/>');\n            if ( grid_config.url_base && !grid_config.items ) {\n                var url_data = grid_config.url_data || {};\n                _.each(grid_config.filters, function(v, k) {\n                    url_data['f-' + k] = v;\n                });\n                $.ajax({\n                    url     : grid_config.url_base + '?' + $.param( url_data ),\n                    success : function( response ) {\n                        response.embedded = grid_config.embedded;\n                        response.filters  = grid_config.filters;\n                        self.init_grid( response );\n                    }\n                });\n            } else {\n                this.init_grid(grid_config);\n            }\n        } else {\n            this.setElement('#grid-container');\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $('#center').css ({\n                padding     : '10px',\n                overflow    : 'auto'\n            });\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function (refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray('history', refresh_frames) > -1) {\n                if( top.Galaxy && top.Galaxy.currHistoryPanel ){\n                    top.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function(grid_config) {\n        // link grid model\n        this.grid = new GridModel(grid_config);\n\n        // get options\n        var options = this.grid.attributes;\n\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get('url_base');\n        url = url.replace(/^.*\\/\\/[^\\/]+/, '');\n        this.grid.set('url_base', url);\n\n        // append main template\n        this.$el.html(Templates.grid(options));\n\n        // update div contents\n        this.$el.find('#grid-table-header').html(Templates.header(options));\n        this.$el.find('#grid-table-body').html(Templates.body(options));\n        this.$el.find('#grid-table-footer').html(Templates.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find('#grid-message').html(Templates.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                setTimeout( function() { self.$el.find('#grid-message').html(''); }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function() {\n\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find('.operation-button').each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find('input[type=text]').each(function() {\n            $(this).off();\n            $(this).click(function() { $(this).select(); } )\n                   .keyup(function () { $(this).css('font-style', 'normal'); });\n        });\n\n        // Initialize sort links.\n        this.$el.find('.sort-link').each( function() {\n            $(this).off();\n            $(this).click( function() {\n               self.set_sort_condition( $(this).attr('sort_key') );\n               return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find('.text-filter-form').each( function() {\n            $(this).off();\n            $(this).submit( function() {\n                var column_key = $(this).attr('column_key');\n                var text_input_obj = $('#input-' + column_key + '-filter');\n                var text_input = text_input_obj.val();\n                text_input_obj.val('');\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find('.text-filter-val > a').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                // Remove visible element.\n                $(this).parent().remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition ($(this).attr('filter_key'), $(this).attr('filter_val'));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find('.categorical-filter > a').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                self.set_categorical_filter( $(this).attr('filter_key'), $(this).attr('filter_val') );\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find('.advanced-search-toggle').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                self.$el.find('#standard-search').slideToggle('fast');\n                self.$el.find('#advanced-search').slideToggle('fast');\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find('#check_all').off();\n        this.$el.find('#check_all').on('click', function() {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements : function() {\n        // Initialize grid selection checkboxes.\n        this.$el.find('.grid').each( function() {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = function() {\n                check_count.text( $(checkboxes).filter(\":checked\").length );\n            };\n\n            $(checkboxes).each( function() {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find('.community_rating_star').length !== 0)\n            this.$el.find('.community_rating_star').rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find('.page-link > a').each( function() {\n            $(this).click( function() {\n               self.set_page( $(this).attr('page_num') );\n               return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find('.use-target').each( function() {\n            $(this).click( function(e) {\n                self.execute({\n                    href : $(this).attr('href'),\n                    target : $(this).attr('target')\n                });\n                return false;\n\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length == 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each( options.items, function( item, index ) {\n            var button = self.$( '#grid-' + index + '-popup' ).off();\n            var popup = new PopupMenu( button );\n            _.each( options[ 'operations' ], function( operation ) {\n                self._add_operation( popup, operation, item );\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    _add_operation: function( popup, operation, item ) {\n        var self = this;\n        var settings = item.operation_config[ operation.label ];\n        if ( settings.allowed && operation.allow_popup ) {\n            popup.addItem({\n                html                : operation.label,\n                href                : settings.url_args,\n                target              : settings.target,\n                confirmation_text   : operation.confirm,\n                func                : function( e ) {\n                    e.preventDefault();\n                    var label = $( e.target ).html();\n                    if ( operation.onclick ) {\n                        operation.onclick( item.encode_id );\n                    } else {\n                        self.execute( this.findItemByHtml( label ) );\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function (name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(Templates.filter_element(name, value));\n        var self = this;\n        t.click(function() {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find('#' + name + '-filtering-criteria');\n        container.append(t);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function (name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function (col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get('sort_key');\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== '-') {\n                new_sort = '-' + col_key;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find('.sort-arrow').remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = (new_sort.substring(0,1) == '-') ? '&uarr;' : '&darr;';\n        var t = $('<span>' + sort_arrow + '</span>').addClass('sort-arrow');\n\n        // Add to header\n        this.$el.find('#' + col_key + '-header').append(t);\n\n        // Update grid.\n        this.grid.set('sort_key', new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function (name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get('categorical_filters')[name],\n            cur_value = this.grid.get('filters')[name];\n        var self = this;\n        this.$el.find('.' + name + '-filter').each( function() {\n            var text = $.trim( $(this).text() );\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass('current-filter');\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $('<a href=\"#\">' + text + '</a>');\n                t.click(function() {\n                    self.set_categorical_filter( name, filter_value );\n                });\n                $(this).removeClass('current-filter');\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function (new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find('.page-link').each( function() {\n            var id = $(this).attr('id'),\n                page_num = parseInt( id.split('-')[2], 10 ), // Id has form 'page-link-<page_num>\n                cur_page = self.grid.get('cur_page'),\n                text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this).children().text();\n                $(this).empty();\n                $(this).addClass('inactive-link');\n                $(this).text(text);\n            }\n            else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass('inactive-link');\n                var t = $('<a href=\"#\">' + text + '</a>');\n                t.click(function() {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === 'all') {\n            this.grid.set('cur_page', new_page);\n        } else {\n            this.grid.set('cur_page', parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function (operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify in any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (!number_of_checked_ids > 0) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {label: operation_name});\n        if (operation && !confirmation_text){\n            confirmation_text = operation.confirm || '';\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find('input[name=id]:checked').each(function() {\n            item_ids.push( $(this).val() );\n        });\n\n        // execute operation\n        var options = {\n            operation           : operation_name,\n            id                  : item_ids,\n            confirmation_text   : confirmation_text\n        };\n        if ( operation.target == 'top' ) {\n            options = _.extend( options, {\n                href   : operation.href,\n                target : operation.target\n            });\n        }\n        this.execute( options );\n        return true;\n    },\n\n    check_all_items: function () {\n        var check = this.$('.grid-row-select-checkbox');\n        var state = this.$( '#check_all' ).prop( 'checked' );\n        _.each( check, function( c ) {\n            $( c ).prop( 'checked', state );\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function () {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get('cur_page');\n        if (cur_page !== null && cur_page !== undefined && cur_page !== 'all') {\n            this.grid.set('cur_page', 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function (options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf('operation=') != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf('operation') != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split('=')[1];\n                            operation = operation.replace (/\\+/g, ' ');\n                        } else if (href_parms[index].indexOf('id') != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split('=')[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (confirmation_text && confirmation_text != '' && confirmation_text != 'None' && confirmation_text != 'null')\n                if(!confirm(confirmation_text))\n                    return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if ( target == 'top' ) {\n                window.top.location = href + '?' + $.param( this.grid.get_url_data() );\n            } else if ( this.grid.can_async_op(operation) || this.dict_format ) {\n                this.update_grid();\n            } else {\n                this.go_to(target, href);\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        if (this.grid.get('async') || this.dict_format) {\n            this.update_grid();\n        } else {\n            this.go_to(target, href);\n        }\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function (target, href) {\n        // get aysnc status\n        var async = this.grid.get('async');\n        this.grid.set('async', false);\n\n        // get slide status\n        advanced_search = this.$el.find('#advanced-search').is(':visible');\n        this.grid.set('advanced_search', advanced_search);\n\n        // get default url\n        if(!href) {\n            href = this.grid.get('url_base') + '?' + $.param(this.grid.get_url_data());\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined,\n            async: async\n        });\n        switch (target) {\n            case 'inbound':\n                // this currently assumes that there is only a single grid shown at a time\n                var $div = $('.grid-header').closest('.inbound');\n                if ($div.length !== 0) {\n                    $div.load(href);\n                    return;\n                }\n                break;\n            case 'top':\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function () {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = (this.grid.get('operation') ? 'POST' : 'GET' );\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find('.loading-elt-overlay').show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get('url_base'),\n            data: self.grid.get_url_data(),\n            error: function(response) { alert( 'Grid refresh failed' );},\n            success: function(response_text) {\n\n                // backup\n                var embedded = self.grid.get('embedded');\n                var insert = self.grid.get('insert');\n\n                // request new configuration\n                var json = self.dict_format ? response_text : $.parseJSON(response_text);\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find('.loading-elt-overlay').hide();\n            },\n            complete: function() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    }\n});\n\n});\n"]}