{"version":3,"sources":["mvc/grid/grid-view.js"],"names":["jQuery","ajaxSettings","traditional","define","Backbone","extend","PopupMenu","grid","View","initialize","grid_config","this","self","GridModel","window","add_tag_to_grid_filter","title","tag_name","is","$","slideToggle","tag_value","add_filter_condition","tag","dict_format","url_data","_","items","ajax","filters","v","k","url","url_base","response","init_grid","embedded","setElement","overflow","css","padding","handle_refresh","Galaxy","top","inArray","refresh_frames","currHistoryPanel","loadCurrentHistory","options","Utils","setWindowTitle","allow_title_display","get","replace","$el","html","Templates","find","header","body","footer","use_hide_message","setTimeout","message","init_grid_elements","init_grid_controls","init_refresh_on_change","each","off","submit_operation","select","keyup","click","set_sort_condition","attr","submit","column_key","text_input_obj","text_input","val","remove","remove_filter_condition","set_categorical_filter","on","checkboxes","check_count","update_checked","filter","length","change","rating","attributes","set_page","e","execute","href","items_length","item","index","popup","button","operation","_add_operation","settings","operation_config","label","url_args","target","confirm","confirmation_text","func","preventDefault","onclick","encode_id","findItemByHtml","name","value","add_filter","t","filter_element","container","go_page_one","remove_filter","col_key","cur_sort","new_sort","substring","sort_arrow","addClass","append","set","new_value","category_filter","cur_value","text","trim","filter_value","empty","removeClass","new_page","id","page_num","parseInt","split","cur_page","children","operation_button","operation_name","number_of_checked_ids","findWhere","operations","item_ids","check_all_items","state","check","prop","c","undefined","indexOf","href_parts","href_parms","href_parms_str","toLowerCase","location","can_async_op","update_grid","go_to","async","advanced_search","param","get_url_data","method","show","type","data","error","alert","success","response_text","insert","json","parseJSON","hide","complete"],"mappings":"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","file":"../../../scripts/mvc/grid/grid-view.js","sourcesContent":["// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\njQuery.ajaxSettings.traditional = true;\n\n// dependencies\ndefine([\n    'utils/utils',\n    'mvc/grid/grid-model',\n    'mvc/grid/grid-template',\n    'mvc/ui/popup-menu'\n], function(Utils, GridModel, Templates, PopupMenu) {\n\n// grid view\nreturn Backbone.View.extend({\n\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function(grid_config) {\n        this.grid = new GridModel();\n        this.dict_format = grid_config.dict_format;\n        this.title = grid_config.title;\n        var self = this;\n        window.add_tag_to_grid_filter = function( tag_name, tag_value ){\n            // Put tag name and value together.\n            var tag = tag_name + ( tag_value !== undefined && tag_value !== \"\" ? \":\" + tag_value : \"\" );\n            var advanced_search = $( '#advanced-search').is(\":visible\" );\n            if( !advanced_search ){\n                $('#standard-search').slideToggle('fast');\n                $('#advanced-search').slideToggle('fast');\n            }\n            self.add_filter_condition( \"tags\", tag );\n        };\n\n        // set element\n        if ( this.dict_format ) {\n            this.setElement('<div/>');\n            if ( grid_config.url_base && !grid_config.items ) {\n                var url_data = grid_config.url_data || {};\n                _.each(grid_config.filters, function(v, k) {\n                    url_data['f-' + k] = v;\n                });\n                $.ajax({\n                    url     : grid_config.url_base + '?' + $.param( url_data ),\n                    success : function( response ) {\n                        response.embedded = grid_config.embedded;\n                        response.filters  = grid_config.filters || {};\n                        self.init_grid( response );\n                    }\n                });\n            } else {\n                this.init_grid(grid_config);\n            }\n        } else {\n            this.setElement('#grid-container');\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $('#center').css ({\n                padding     : '10px',\n                overflow    : 'auto'\n            });\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function (refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray('history', refresh_frames) > -1) {\n                if( top.Galaxy && top.Galaxy.currHistoryPanel ){\n                    top.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function(grid_config) {\n        this.grid.set( grid_config );\n\n        // get options\n        var options = this.grid.attributes;\n\n        if (this.allow_title_display && options.title){\n            Utils.setWindowTitle(options.title);\n        }\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get('url_base');\n        url = url.replace(/^.*\\/\\/[^\\/]+/, '');\n        this.grid.set('url_base', url);\n\n        // append main template\n        this.$el.html(Templates.grid(options));\n\n        // update div contents\n        this.$el.find('#grid-table-header').html(Templates.header(options));\n        this.$el.find('#grid-table-body').html(Templates.body(options));\n        this.$el.find('#grid-table-footer').html(Templates.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find('#grid-message').html(Templates.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                setTimeout( function() { self.$el.find('#grid-message').html(''); }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function() {\n\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find('.operation-button').each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find('input[type=text]').each(function() {\n            $(this).off();\n            $(this).click(function() { $(this).select(); } )\n                   .keyup(function () { $(this).css('font-style', 'normal'); });\n        });\n\n        // Initialize sort links.\n        this.$el.find('.sort-link').each( function() {\n            $(this).off();\n            $(this).click( function() {\n               self.set_sort_condition( $(this).attr('sort_key') );\n               return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find('.text-filter-form').each( function() {\n            $(this).off();\n            $(this).submit( function() {\n                var column_key = $(this).attr('column_key');\n                var text_input_obj = $('#input-' + column_key + '-filter');\n                var text_input = text_input_obj.val();\n                text_input_obj.val('');\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find('.text-filter-val > a').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                // Remove visible element.\n                $(this).parent().remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition ($(this).attr('filter_key'), $(this).attr('filter_val'));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find('.categorical-filter > a').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                self.set_categorical_filter( $(this).attr('filter_key'), $(this).attr('filter_val') );\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find('.advanced-search-toggle').each( function() {\n            $(this).off();\n            $(this).click( function() {\n                self.$el.find('#standard-search').slideToggle('fast');\n                self.$el.find('#advanced-search').slideToggle('fast');\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find('#check_all').off();\n        this.$el.find('#check_all').on('click', function() {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements : function() {\n        // Initialize grid selection checkboxes.\n        this.$el.find('.grid').each( function() {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = function() {\n                check_count.text( $(checkboxes).filter(\":checked\").length );\n            };\n\n            $(checkboxes).each( function() {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find('.community_rating_star').length !== 0)\n            this.$el.find('.community_rating_star').rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find('.page-link > a').each( function() {\n            $(this).click( function() {\n               self.set_page( $(this).attr('page_num') );\n               return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find('.use-target').each( function() {\n            $(this).click( function(e) {\n                self.execute({\n                    href : $(this).attr('href'),\n                    target : $(this).attr('target')\n                });\n                return false;\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length == 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each( options.items, function( item, index ) {\n            var button = self.$( '#grid-' + index + '-popup' ).off();\n            var popup = new PopupMenu( button );\n            _.each( options[ 'operations' ], function( operation ) {\n                self._add_operation( popup, operation, item );\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    _add_operation: function( popup, operation, item ) {\n        var self = this;\n        var settings = item.operation_config[ operation.label ];\n        if ( settings.allowed && operation.allow_popup ) {\n            popup.addItem({\n                html                : operation.label,\n                href                : settings.url_args,\n                target              : settings.target,\n                confirmation_text   : operation.confirm,\n                func                : function( e ) {\n                    e.preventDefault();\n                    var label = $( e.target ).html();\n                    if ( operation.onclick ) {\n                        operation.onclick( item.encode_id );\n                    } else {\n                        self.execute( this.findItemByHtml( label ) );\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function (name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(Templates.filter_element(name, value));\n        var self = this;\n        t.click(function() {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find('#' + name + '-filtering-criteria');\n        container.append(t);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function (name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function (col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get('sort_key');\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== '-') {\n                new_sort = '-' + col_key;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find('.sort-arrow').remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = (new_sort.substring(0,1) == '-') ? '&uarr;' : '&darr;';\n        var t = $('<span>' + sort_arrow + '</span>').addClass('sort-arrow');\n\n        // Add to header\n        this.$el.find('#' + col_key + '-header').append(t);\n\n        // Update grid.\n        this.grid.set('sort_key', new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function (name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get('categorical_filters')[name],\n            cur_value = this.grid.get('filters')[name];\n        var self = this;\n        this.$el.find('.' + name + '-filter').each( function() {\n            var text = $.trim( $(this).text() );\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass('current-filter');\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $('<a href=\"#\">' + text + '</a>');\n                t.click(function() {\n                    self.set_categorical_filter( name, filter_value );\n                });\n                $(this).removeClass('current-filter');\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function (new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find('.page-link').each( function() {\n            var id = $(this).attr('id'),\n                page_num = parseInt( id.split('-')[2], 10 ), // Id has form 'page-link-<page_num>\n                cur_page = self.grid.get('cur_page'),\n                text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this).children().text();\n                $(this).empty();\n                $(this).addClass('inactive-link');\n                $(this).text(text);\n            }\n            else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass('inactive-link');\n                var t = $('<a href=\"#\">' + text + '</a>');\n                t.click(function() {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === 'all') {\n            this.grid.set('cur_page', new_page);\n        } else {\n            this.grid.set('cur_page', parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function (operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify in any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (!number_of_checked_ids > 0) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {label: operation_name});\n        if (operation && !confirmation_text){\n            confirmation_text = operation.confirm || '';\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find('input[name=id]:checked').each(function() {\n            item_ids.push( $(this).val() );\n        });\n\n        // execute operation\n        var options = {\n            operation           : operation_name,\n            id                  : item_ids,\n            confirmation_text   : confirmation_text\n        };\n        if ( operation.target == 'top' ) {\n            options = _.extend( options, {\n                href   : operation.href,\n                target : operation.target\n            });\n        }\n        this.execute( options );\n        return true;\n    },\n\n    check_all_items: function () {\n        var check = this.$('.grid-row-select-checkbox');\n        var state = this.$( '#check_all' ).prop( 'checked' );\n        _.each( check, function( c ) {\n            $( c ).prop( 'checked', state );\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function () {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get('cur_page');\n        if (cur_page !== null && cur_page !== undefined && cur_page !== 'all') {\n            this.grid.set('cur_page', 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function (options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf('operation=') != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf('operation') != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split('=')[1];\n                            operation = operation.replace (/\\+/g, ' ');\n                        } else if (href_parms[index].indexOf('id') != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split('=')[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (confirmation_text && confirmation_text != '' && confirmation_text != 'None' && confirmation_text != 'null')\n                if(!confirm(confirmation_text))\n                    return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if ( target == 'top' ) {\n                window.top.location = href + '?' + $.param( this.grid.get_url_data() );\n            } else if ( this.grid.can_async_op(operation) || this.dict_format ) {\n                this.update_grid();\n            } else {\n                this.go_to(target, href);\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        if (this.grid.get('async') || this.dict_format) {\n            this.update_grid();\n        } else {\n            this.go_to(target, href);\n        }\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function (target, href) {\n        // get aysnc status\n        var async = this.grid.get('async');\n        this.grid.set('async', false);\n\n        // get slide status\n        var advanced_search = this.$el.find('#advanced-search').is(':visible');\n        this.grid.set('advanced_search', advanced_search);\n\n        // get default url\n        if(!href) {\n            href = this.grid.get('url_base') + '?' + $.param(this.grid.get_url_data());\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined,\n            async: async\n        });\n        switch (target) {\n            case 'center':\n                $( '#galaxy_main' ).attr( 'src', href );\n                break;\n            case 'top':\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function () {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = (this.grid.get('operation') ? 'POST' : 'GET' );\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find('.loading-elt-overlay').show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get('url_base'),\n            data: self.grid.get_url_data(),\n            error: function(response) { alert( 'Grid refresh failed' );},\n            success: function(response_text) {\n\n                // backup\n                var embedded = self.grid.get('embedded');\n                var insert = self.grid.get('insert');\n                var advanced_search = self.$el.find('#advanced-search').is(':visible');\n\n                // request new configuration\n                var json = self.dict_format ? response_text : $.parseJSON(response_text);\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n                json.advanced_search = advanced_search;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find('.loading-elt-overlay').hide();\n            },\n            complete: function() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    }\n});\n\n});\n"]}