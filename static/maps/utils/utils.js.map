{"version":3,"sources":["utils/utils.js"],"names":["define","iframe","src","deepeach","dict","callback","i","_","isObject","d","new_dict","linkify","inputText","replacedText","replacePattern1","replacePattern2","replacePattern3","replace","clone","obj","JSON","parse","stringify","isJSON","text","test","sanitize","content","html","isEmpty","value","Array","length","undefined","indexOf","textify","lst","$","isArray","toString","pos","substr","get","options","top","__utils__get__","cache_key","cache","debug","url","request","data","response","success","error","status","ajaxConfig","contentType","type","isEmptyObject","param","dataType","ajax","done","jQuery","parseJSON","e","console","fail","response_text","responseText","always","complete","cssGetAttribute","classname","name","el","appendTo","css","remove","cssLoadFile","Galaxy","root","merge","optionsDefault","defaults","placesMultiplier","number","numPlaces","Math","round","numberPlaces","size","tb","unit","gb","mb","kb","rounded","roundToDecimalPlaces","uid","__utils__uid__","hours","getHours","minutes","getMinutes","datetime","getDate","getMonth","getFullYear","Date","appendScriptStyle","script","styles","getQueryString","key","decodeURIComponent","window","location","search","RegExp","encodeURIComponent","bytesToString","time"],"mappings":"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","file":"../../scripts/utils/utils.js","sourcesContent":["/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n*/\ndefine( [], function() {\n\n    /** Builds a basic iframe */\n    function iframe( src ) {\n        return '<iframe src=\"' + src + '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>';\n    }\n\n    /** Traverse through json */\n    function deepeach( dict, callback ) {\n        for( var i in dict ) {\n            var d = dict[ i ];\n            if( _.isObject( d ) ) {\n                var new_dict = callback( d );\n                new_dict && ( dict[ i ] = new_dict );\n                deepeach( d, callback );\n            }\n        }\n    }\n\n    /** Identifies urls and replaces them with anchors */\n    function linkify( inputText ) {\n        var replacedText, replacePattern1, replacePattern2, replacePattern3;\n\n        // URLs starting with http://, https://, or ftp://\n        replacePattern1 = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n        replacedText = inputText.replace(replacePattern1, '<a href=\"$1\" target=\"_blank\">$1</a>');\n\n        // URLs starting with \"www.\" (without // before it, or it'd re-link the ones done above).\n        replacePattern2 = /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim;\n        replacedText = replacedText.replace(replacePattern2, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\n\n        // Change email addresses to mailto:: links.\n        replacePattern3 = /(([a-zA-Z0-9\\-\\_\\.])+@[a-zA-Z\\_]+?(\\.[a-zA-Z]{2,6})+)/gim;\n        replacedText = replacedText.replace(replacePattern3, '<a href=\"mailto:$1\">$1</a>');\n\n        return replacedText;\n    }\n\n    /** Clone */\n    function clone( obj ) {\n        return JSON.parse( JSON.stringify( obj ) || null );\n    }\n\n    /**\n     * Check if a string is a json string\n     * @param{String}   text - Content to be validated\n     */\n    function isJSON(text) {\n        return /^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').\n            replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').\n            replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''));\n    };\n\n    /**\n     * Sanitize/escape a string\n     * @param{String}   content - Content to be sanitized\n     */\n    function sanitize(content) {\n        return $('<div/>').text(content).html();\n    };\n\n    /**\n     * Checks if a value or list of values is `empty`\n     * usually used for selectable options\n     * @param{String}   value - Value or list to be validated\n     */\n    function isEmpty ( value ) {\n        if ( !( value instanceof Array ) ) {\n            value = [ value ];\n        }\n        if ( value.length === 0 ) {\n            return true;\n        }\n        for( var i in value ) {\n            if ( [ '__null__', '__undefined__', null, undefined ].indexOf( value[ i ] ) > -1 ) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    /**\n     * Convert list to pretty string\n     * @param{String}   lst - List of strings to be converted in human readable list sentence\n     */\n    function textify( lst ) {\n        if ( $.isArray( lst ) ) {\n            var lst = lst.toString().replace( /,/g, ', ' );\n            var pos = lst.lastIndexOf( ', ' );\n            if ( pos != -1 ) {\n                lst = lst.substr( 0, pos ) + ' or ' + lst.substr( pos + 2 );\n            }\n            return lst;\n        }\n        return '';\n    };\n\n    /**\n     * Request handler for GET\n     * @param{String}   url     - Url request is made to\n     * @param{Function} success - Callback on success\n     * @param{Function} error   - Callback on error\n     * @param{Boolean}  cache   - Use cached data if available\n     */\n    function get (options) {\n        top.__utils__get__ = top.__utils__get__ || {};\n        var cache_key = JSON.stringify( options );\n        if (options.cache && top.__utils__get__[cache_key]) {\n            options.success && options.success(top.__utils__get__[cache_key]);\n            window.console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n        } else {\n            request({\n                url     : options.url,\n                data    : options.data,\n                success : function(response) {\n                    top.__utils__get__[cache_key] = response;\n                    options.success && options.success(response);\n                },\n                error : function(response, status) {\n                    options.error && options.error(response, status);\n                }\n            });\n        }\n    };\n\n    /**\n     * Request handler\n     * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n     * @param{String}   url     - Url request is made to\n     * @param{Object}   data    - Data send to url\n     * @param{Function} success - Callback on success\n     * @param{Function} error   - Callback on error\n     */\n    function request (options) {\n        // prepare ajax\n        var ajaxConfig = {\n            contentType : 'application/json',\n            type        : options.type || 'GET',\n            data        : options.data || {},\n            url         : options.url\n        }\n        // encode data into url\n        if ( ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE' ) {\n            if ( !$.isEmptyObject(ajaxConfig.data) ) {\n                ajaxConfig.url += ajaxConfig.url.indexOf('?') == -1 ? '?' : '&';\n                ajaxConfig.url += $.param(ajaxConfig.data, true);\n            }\n            ajaxConfig.data = null;\n        } else {\n            ajaxConfig.dataType = 'json';\n            ajaxConfig.url      = ajaxConfig.url;\n            ajaxConfig.data     = JSON.stringify(ajaxConfig.data);\n        }\n\n        // make request\n        $.ajax(ajaxConfig).done(function(response) {\n            if (typeof response === 'string') {\n                try {\n                    response = response.replace('Infinity,', '\"Infinity\",');\n                    response = jQuery.parseJSON(response);\n                } catch (e) {\n                    console.debug(e);\n                }\n            }\n            options.success && options.success(response);\n        }).fail(function(response) {\n            var response_text = null;\n            try {\n                response_text = jQuery.parseJSON(response.responseText);\n            } catch (e) {\n                response_text = response.responseText;\n            }\n            options.error && options.error(response_text, response.status);\n        }).always(function() {\n            options.complete && options.complete();\n        });\n    };\n\n    /**\n     * Read a property value from CSS\n     * @param{String}   classname   - CSS class\n     * @param{String}   name        - CSS property\n     */\n    function cssGetAttribute (classname, name) {\n        var el = $('<div class=\"' + classname + '\"></div>');\n        el.appendTo(':eq(0)');\n        var value = el.css(name);\n        el.remove();\n        return value;\n    };\n\n    /**\n     * Load a CSS file\n     * @param{String}   url - Url of CSS file\n     */\n    function cssLoadFile (url) {\n        if (!$('link[href^=\"' + url + '\"]').length) {\n            $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n        }\n    };\n\n    /**\n     * Safely merge to dictionaries\n     * @param{Object}   options         - Target dictionary\n     * @param{Object}   optionsDefault  - Source dictionary\n     */\n    function merge (options, optionsDefault) {\n        if (options) {\n            return _.defaults(options, optionsDefault);\n        } else {\n            return optionsDefault;\n        }\n    };\n\n\n    /**\n     * Round floaing point 'number' to 'numPlaces' number of decimal places.\n     * @param{Object}   number      a floaing point number\n     * @param{Object}   numPlaces   number of decimal places\n     */\n    function roundToDecimalPlaces( number, numPlaces ){\n        var placesMultiplier = 1;\n        for( var i=0; i<numPlaces; i++ ){\n            placesMultiplier *= 10;\n        }\n        return Math.round( number * placesMultiplier ) / placesMultiplier;\n    }\n\n    // calculate on import\n    var kb = 1024,\n        mb = kb * kb,\n        gb = mb * kb,\n        tb = gb * kb;\n    /**\n     * Format byte size to string with units\n     * @param{Integer}   size           - Size in bytes\n     * @param{Boolean}   normal_font    - Switches font between normal and bold\n     */\n    function bytesToString (size, normal_font, numberPlaces) {\n        numberPlaces = numberPlaces !== undefined? numberPlaces: 1;\n        // identify unit\n        var unit = \"\";\n        if (size >= tb){ size = size / tb; unit = 'TB'; } else\n        if (size >= gb){ size = size / gb; unit = 'GB'; } else\n        if (size >= mb){ size = size / mb; unit = 'MB'; } else\n        if (size >= kb){ size = size / kb; unit = 'KB'; } else\n        if (size >  0){ unit = 'b'; }\n        else { return normal_font? '0 b': '<strong>-</strong>'; }\n        // return formatted string\n        var rounded = unit == 'b'? size: roundToDecimalPlaces( size, numberPlaces );\n        if (normal_font) {\n           return  rounded + ' ' + unit;\n        } else {\n            return '<strong>' + rounded + '</strong> ' + unit;\n        }\n    };\n\n    /** Create a unique id */\n    function uid(){\n        top.__utils__uid__ = top.__utils__uid__ || 0;\n        return 'uid-' + top.__utils__uid__++;\n    };\n\n    /** Create a time stamp */\n    function time() {\n        var d = new Date();\n        var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n        var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes()\n        return datetime = d.getDate() + \"/\"\n                    + (d.getMonth() + 1)  + \"/\"\n                    + d.getFullYear() + \", \"\n                    + hours + \":\"\n                    + minutes;\n    };\n\n    /** Append script and style tags to Galaxy main application */\n    function appendScriptStyle( data ) {\n        // create a script tag inside head tag\n        if( data.script && data.script !== \"\" ) {\n            $(  '<script/>', { type: 'text/javascript' } ).text( data.script ).appendTo( 'head' );\n        }\n        // create a style tag inside head tag\n        if( data.styles && data.styles !== \"\" ) {\n            $( '<style/>', { type: 'text/css' } ).text( data.styles ).appendTo( 'head' );\n        }\n    };\n\n    /** Get querystrings from url */\n    function getQueryString( key ) {\n        return decodeURIComponent( window.location.search.replace(new RegExp(\"^(?:.*[&\\\\?]\" + encodeURIComponent( key ).replace(/[\\.\\+\\*]/g, \"\\\\$&\") + \"(?:\\\\=([^&]*))?)?.*$\", \"i\"), \"$1\") );\n    };\n\n    return {\n        cssLoadFile: cssLoadFile,\n        cssGetAttribute: cssGetAttribute,\n        get: get,\n        merge: merge,\n        iframe: iframe,\n        bytesToString: bytesToString,\n        uid: uid,\n        time: time,\n        request: request,\n        sanitize: sanitize,\n        textify: textify,\n        isEmpty: isEmpty,\n        deepeach: deepeach,\n        isJSON: isJSON,\n        clone: clone,\n        linkify: linkify,\n        appendScriptStyle: appendScriptStyle,\n        getQueryString: getQueryString\n    };\n});\n"]}