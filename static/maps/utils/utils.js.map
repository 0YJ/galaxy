{"version":3,"sources":["utils/utils.js"],"names":["deepeach","dict","callback","iframe","d","i","_","isObject","new_dict","request","options","ajaxConfig","url","done","$","response","isEmptyObject","data","indexOf","dataType","success","response_text","error","jQuery","parseJSON","complete","console","debug","e","fail","cssGetAttribute","classname","responseText","el","appendTo","remove","status","always","roundToDecimalPlaces","size","normal_font","numberPlaces","numPlaces","placesMultiplier","unit","mb","kb","cssLoadFile","length","Galaxy","root","name","value","css","get","top","cache_key","JSON","stringify","__utils__get__","window","merge","Math","round","defaults","optionsDefault","src","bytesToString","undefined","rounded","gb","uid","__utils__uid__","time","getMinutes","minutes","styles","Date","hours","getQueryString","getHours","decodeURIComponent","location","search","datetime","getDate","getMonth","getFullYear","sanitize","content","text","html","textify","lst","isArray","pos","toString","replace","lastIndexOf","substr","isEmpty","Array","isJSON","test","clone","obj","linkify","replacedText","replacePattern2","replacePattern3","inputText","replacePattern1","appendScriptStyle","script","type","setWindowTitle","RegExp","encodeURIComponent","key","title","document","config","brand","_localization2","default"],"mappings":"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","file":"../../scripts/utils/utils.js","sourcesContent":["/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n*/\nimport _l from \"utils/localization\";\n/** Builds a basic iframe */\nfunction iframe(src) {\n    return (\n        '<iframe src=\"' +\n        src +\n        '\" frameborder=\"0\" style=\"width: 100%; height: 100%;\"/>'\n    );\n}\n\n/** Traverse through json */\nfunction deepeach(dict, callback) {\n    for (var i in dict) {\n        var d = dict[i];\n        if (_.isObject(d)) {\n            var new_dict = callback(d);\n            new_dict && (dict[i] = new_dict);\n            deepeach(d, callback);\n        }\n    }\n}\n\n/** Identifies urls and replaces them with anchors */\nfunction linkify(inputText) {\n    var replacedText, replacePattern1, replacePattern2, replacePattern3;\n\n    // URLs starting with http://, https://, or ftp://\n    replacePattern1 = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim;\n    replacedText = inputText.replace(\n        replacePattern1,\n        '<a href=\"$1\" target=\"_blank\">$1</a>'\n    );\n\n    // URLs starting with \"www.\" (without // before it, or it'd re-link the ones done above).\n    replacePattern2 = /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim;\n    replacedText = replacedText.replace(\n        replacePattern2,\n        '$1<a href=\"http://$2\" target=\"_blank\">$2</a>'\n    );\n\n    // Change email addresses to mailto:: links.\n    replacePattern3 = /(([a-zA-Z0-9\\-\\_\\.])+@[a-zA-Z\\_]+?(\\.[a-zA-Z]{2,6})+)/gim;\n    replacedText = replacedText.replace(\n        replacePattern3,\n        '<a href=\"mailto:$1\">$1</a>'\n    );\n\n    return replacedText;\n}\n\n/** Clone */\nfunction clone(obj) {\n    return JSON.parse(JSON.stringify(obj) || null);\n}\n\n/**\n     * Check if a string is a json string\n     * @param{String}   text - Content to be validated\n     */\nfunction isJSON(text) {\n    return /^[\\],:{}\\s]*$/.test(\n        text\n            .replace(/\\\\[\"\\\\\\/bfnrtu]/g, \"@\")\n            .replace(\n                /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,\n                \"]\"\n            )\n            .replace(/(?:^|:|,)(?:\\s*\\[)+/g, \"\")\n    );\n}\n\n/**\n     * Sanitize/escape a string\n     * @param{String}   content - Content to be sanitized\n     */\nfunction sanitize(content) {\n    return $(\"<div/>\")\n        .text(content)\n        .html();\n}\n\n/**\n     * Checks if a value or list of values is `empty`\n     * usually used for selectable options\n     * @param{String}   value - Value or list to be validated\n     */\nfunction isEmpty(value) {\n    if (!(value instanceof Array)) {\n        value = [value];\n    }\n    if (value.length === 0) {\n        return true;\n    }\n    for (var i in value) {\n        if (\n            [\"__null__\", \"__undefined__\", null, undefined].indexOf(value[i]) >\n            -1\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n     * Convert list to pretty string\n     * @param{String}   lst - List of strings to be converted in human readable list sentence\n     */\nfunction textify(lst) {\n    if ($.isArray(lst)) {\n        var lst = lst.toString().replace(/,/g, \", \");\n        var pos = lst.lastIndexOf(\", \");\n        if (pos != -1) {\n            lst = lst.substr(0, pos) + \" or \" + lst.substr(pos + 2);\n        }\n        return lst;\n    }\n    return \"\";\n}\n\n/**\n     * Request handler for GET\n     * @param{String}   url     - Url request is made to\n     * @param{Function} success - Callback on success\n     * @param{Function} error   - Callback on error\n     * @param{Boolean}  cache   - Use cached data if available\n     */\nfunction get(options) {\n    top.__utils__get__ = top.__utils__get__ || {};\n    var cache_key = JSON.stringify(options);\n    if (options.cache && top.__utils__get__[cache_key]) {\n        options.success && options.success(top.__utils__get__[cache_key]);\n        window.console.debug(\n            \"utils.js::get() - Fetching from cache [\" + options.url + \"].\"\n        );\n    } else {\n        request({\n            url: options.url,\n            data: options.data,\n            success: function(response) {\n                top.__utils__get__[cache_key] = response;\n                options.success && options.success(response);\n            },\n            error: function(response, status) {\n                options.error && options.error(response, status);\n            }\n        });\n    }\n}\n\n/**\n     * Request handler\n     * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n     * @param{String}   url     - Url request is made to\n     * @param{Object}   data    - Data send to url\n     * @param{Function} success - Callback on success\n     * @param{Function} error   - Callback on error\n     */\nfunction request(options) {\n    // prepare ajax\n    var ajaxConfig = {\n        contentType: \"application/json\",\n        type: options.type || \"GET\",\n        data: options.data || {},\n        url: options.url\n    };\n    // encode data into url\n    if (ajaxConfig.type == \"GET\" || ajaxConfig.type == \"DELETE\") {\n        if (!$.isEmptyObject(ajaxConfig.data)) {\n            ajaxConfig.url += ajaxConfig.url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            ajaxConfig.url += $.param(ajaxConfig.data, true);\n        }\n        ajaxConfig.data = null;\n    } else {\n        ajaxConfig.dataType = \"json\";\n        ajaxConfig.url = ajaxConfig.url;\n        ajaxConfig.data = JSON.stringify(ajaxConfig.data);\n    }\n\n    // make request\n    $.ajax(ajaxConfig)\n        .done(function(response) {\n            if (typeof response === \"string\") {\n                try {\n                    response = response.replace(\"Infinity,\", '\"Infinity\",');\n                    response = jQuery.parseJSON(response);\n                } catch (e) {\n                    console.debug(e);\n                }\n            }\n            options.success && options.success(response);\n        })\n        .fail(function(response) {\n            var response_text = null;\n            try {\n                response_text = jQuery.parseJSON(response.responseText);\n            } catch (e) {\n                response_text = response.responseText;\n            }\n            options.error && options.error(response_text, response.status);\n        })\n        .always(function() {\n            options.complete && options.complete();\n        });\n}\n\n/**\n     * Read a property value from CSS\n     * @param{String}   classname   - CSS class\n     * @param{String}   name        - CSS property\n     */\nfunction cssGetAttribute(classname, name) {\n    var el = $('<div class=\"' + classname + '\"></div>');\n    el.appendTo(\":eq(0)\");\n    var value = el.css(name);\n    el.remove();\n    return value;\n}\n\n/**\n     * Load a CSS file\n     * @param{String}   url - Url of CSS file\n     */\nfunction cssLoadFile(url) {\n    if (!$('link[href^=\"' + url + '\"]').length) {\n        $('<link href=\"' + Galaxy.root + url + '\" rel=\"stylesheet\">').appendTo(\n            \"head\"\n        );\n    }\n}\n\n/**\n     * Safely merge to dictionaries\n     * @param{Object}   options         - Target dictionary\n     * @param{Object}   optionsDefault  - Source dictionary\n     */\nfunction merge(options, optionsDefault) {\n    if (options) {\n        return _.defaults(options, optionsDefault);\n    } else {\n        return optionsDefault;\n    }\n}\n\n/**\n     * Round floaing point 'number' to 'numPlaces' number of decimal places.\n     * @param{Object}   number      a floaing point number\n     * @param{Object}   numPlaces   number of decimal places\n     */\nfunction roundToDecimalPlaces(number, numPlaces) {\n    var placesMultiplier = 1;\n    for (var i = 0; i < numPlaces; i++) {\n        placesMultiplier *= 10;\n    }\n    return Math.round(number * placesMultiplier) / placesMultiplier;\n}\n\n// calculate on import\nvar kb = 1024,\n    mb = kb * kb,\n    gb = mb * kb,\n    tb = gb * kb;\n/**\n     * Format byte size to string with units\n     * @param{Integer}   size           - Size in bytes\n     * @param{Boolean}   normal_font    - Switches font between normal and bold\n     */\nfunction bytesToString(size, normal_font, numberPlaces) {\n    numberPlaces = numberPlaces !== undefined ? numberPlaces : 1;\n    // identify unit\n    var unit = \"\";\n    if (size >= tb) {\n        size = size / tb;\n        unit = \"TB\";\n    } else if (size >= gb) {\n        size = size / gb;\n        unit = \"GB\";\n    } else if (size >= mb) {\n        size = size / mb;\n        unit = \"MB\";\n    } else if (size >= kb) {\n        size = size / kb;\n        unit = \"KB\";\n    } else if (size > 0) {\n        unit = \"b\";\n    } else {\n        return normal_font ? \"0 b\" : \"<strong>-</strong>\";\n    }\n    // return formatted string\n    var rounded = unit == \"b\" ? size : roundToDecimalPlaces(size, numberPlaces);\n    if (normal_font) {\n        return rounded + \" \" + unit;\n    } else {\n        return \"<strong>\" + rounded + \"</strong> \" + unit;\n    }\n}\n\n/** Create a unique id */\nfunction uid() {\n    top.__utils__uid__ = top.__utils__uid__ || 0;\n    return \"uid-\" + top.__utils__uid__++;\n}\n\n/** Create a time stamp */\nfunction time() {\n    var d = new Date();\n    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes();\n    return (datetime =\n        d.getDate() +\n        \"/\" +\n        (d.getMonth() + 1) +\n        \"/\" +\n        d.getFullYear() +\n        \", \" +\n        hours +\n        \":\" +\n        minutes);\n}\n\n/** Append script and style tags to Galaxy main application */\nfunction appendScriptStyle(data) {\n    // create a script tag inside head tag\n    if (data.script && data.script !== \"\") {\n        $(\"<script/>\", { type: \"text/javascript\" })\n            .text(data.script)\n            .appendTo(\"head\");\n    }\n    // create a style tag inside head tag\n    if (data.styles && data.styles !== \"\") {\n        $(\"<style/>\", { type: \"text/css\" })\n            .text(data.styles)\n            .appendTo(\"head\");\n    }\n}\n\n/** Get querystrings from url */\nfunction getQueryString(key) {\n    return decodeURIComponent(\n        window.location.search.replace(\n            new RegExp(\n                \"^(?:.*[&\\\\?]\" +\n                    encodeURIComponent(key).replace(/[\\.\\+\\*]/g, \"\\\\$&\") +\n                    \"(?:\\\\=([^&]*))?)?.*$\",\n                \"i\"\n            ),\n            \"$1\"\n        )\n    );\n}\n\nfunction setWindowTitle(title) {\n    if (title) {\n        window.document.title =\n            \"Galaxy \" +\n            (window.Galaxy.config.brand\n                ? \" | \" + window.Galaxy.config.brand\n                : \"\") +\n            \" | \" +\n            _l(title);\n    } else {\n        window.document.title =\n            \"Galaxy \" +\n            (window.Galaxy.config.brand\n                ? \" | \" + window.Galaxy.config.brand\n                : \"\");\n    }\n}\n\nexport default {\n    cssLoadFile: cssLoadFile,\n    cssGetAttribute: cssGetAttribute,\n    get: get,\n    merge: merge,\n    iframe: iframe,\n    bytesToString: bytesToString,\n    uid: uid,\n    time: time,\n    request: request,\n    sanitize: sanitize,\n    textify: textify,\n    isEmpty: isEmpty,\n    deepeach: deepeach,\n    isJSON: isJSON,\n    clone: clone,\n    linkify: linkify,\n    appendScriptStyle: appendScriptStyle,\n    getQueryString: getQueryString,\n    setWindowTitle: setWindowTitle\n};\n"]}