{"version":3,"sources":["utils/async-save-text.js"],"names":["define","jQuery","async_save_text","click_to_edit_elt","text_elt_id","save_url","text_parm_name","num_cols","use_textarea","num_rows","on_start","on_finish","undefined","$","click","length","t","text_elt","old_text","text","attr","rows","cols","trim","value","size","blur","this","remove","show","keyup","e","keyCode","trigger","ajax_data","val","ajax","url","data","error","alert","success","processed_text","html","hide","insertAfter","focus","select"],"mappings":"AAAAA,QAAS,UAAY,SAAUC,GAC/B,YAOA,SAASC,GAAiBC,EAAmBC,EAAaC,EAChCC,EAAgBC,EAAUC,EAAcC,EAAUC,EAAUC,OAEjEC,KAAbL,IACAA,EAAW,QAEEK,KAAbH,IACAA,EAAW,GAIfI,EAAE,IAAMV,GAAmBW,MAAM,WAE7B,KAAKD,EAAE,oBAAoBE,OAAS,GAApC,CAGA,GAEIC,GAFAC,EAAWJ,EAAE,IAAMT,GACnBc,EAAWD,EAASE,MAIpBH,GADAR,EACIK,EAAE,yBAAyBO,MAAOC,KAAMZ,EAAUa,KAAMf,IAAYY,KAAMN,EAAEU,KAAKL,IAEjFL,EAAE,+BAA+BO,MAAOI,MAAOX,EAAEU,KAAKL,GAAWO,KAAMlB,IAE/ES,EAAEI,KAAK,KAAM,mBACbJ,EAAEU,KAAM,WACJb,EAAEc,MAAMC,SACRX,EAASY,OACLlB,GACAA,EAAUK,KAGlBA,EAAEc,MAAO,SAAUC,GACf,GAAmB,KAAdA,EAAEC,QAEHnB,EAAEc,MAAMM,QAAS,YACd,IAAmB,KAAdF,EAAEC,QAAiB,CAE3B,GAAIE,KACJA,GAAU5B,GAAkBO,EAAEc,MAAMQ,MACpCtB,EAAEc,MAAMM,QAAS,QACjBpB,EAAEuB,MACEC,IAAKhC,EACLiC,KAAMJ,EACNK,MAAO,WACHC,MAAO,wBAA0BpC,EAAc,YAGnDqC,QAAS,SAASC,GAES,KAAnBA,EACAzB,EAASE,KAAKuB,GAEdzB,EAAS0B,KAAK,iBAEdhC,GACAA,EAAUK,SAO1BN,GACAA,EAASM,GAGbC,EAAS2B,OACT5B,EAAE6B,YAAY5B,GACdD,EAAE8B,QACF9B,EAAE+B,YA5EV,GAAIlC,GAAIZ,CAmFJ,OAAOC","file":"../../scripts/utils/async-save-text.js","sourcesContent":["define([ 'jquery' ], function( jQuery ){\n'use_strict';\n\nvar $ = jQuery;\n// ============================================================================\n/**\n * Edit and save text asynchronously.\n */\nfunction async_save_text( click_to_edit_elt, text_elt_id, save_url,\n                          text_parm_name, num_cols, use_textarea, num_rows, on_start, on_finish ) {\n    // Set defaults if necessary.\n    if (num_cols === undefined) {\n        num_cols = 30;\n    }\n    if (num_rows === undefined) {\n        num_rows = 4;\n    }\n\n    // Set up input element.\n    $(\"#\" + click_to_edit_elt).click(function() {\n        // Check if this is already active\n        if ( $(\"#renaming-active\").length > 0) {\n            return;\n        }\n        var text_elt = $(\"#\" + text_elt_id),\n            old_text = text_elt.text(),\n            t;\n\n        if (use_textarea) {\n            t = $(\"<textarea></textarea>\").attr({ rows: num_rows, cols: num_cols }).text( $.trim(old_text) );\n        } else {\n            t = $(\"<input type='text'></input>\").attr({ value: $.trim(old_text), size: num_cols });\n        }\n        t.attr(\"id\", \"renaming-active\");\n        t.blur( function() {\n            $(this).remove();\n            text_elt.show();\n            if (on_finish) {\n                on_finish(t);\n            }\n        });\n        t.keyup( function( e ) {\n            if ( e.keyCode === 27 ) {\n                // Escape key\n                $(this).trigger( \"blur\" );\n            } else if ( e.keyCode === 13 ) {\n                // Enter key submits\n                var ajax_data = {};\n                ajax_data[text_parm_name] = $(this).val();\n                $(this).trigger( \"blur\" );\n                $.ajax({\n                    url: save_url,\n                    data: ajax_data,\n                    error: function() {\n                        alert( \"Text editing for elt \" + text_elt_id + \" failed\" );\n                        // TODO: call finish or no? For now, let's not because error occurred.\n                    },\n                    success: function(processed_text) {\n                        // Set new text and call finish method.\n                        if (processed_text !== \"\") {\n                            text_elt.text(processed_text);\n                        } else {\n                            text_elt.html(\"<em>None</em>\");\n                        }\n                        if (on_finish) {\n                            on_finish(t);\n                        }\n                    }\n                });\n            }\n        });\n\n        if (on_start) {\n            on_start(t);\n        }\n        // Replace text with input object and focus & select.\n        text_elt.hide();\n        t.insertAfter(text_elt);\n        t.focus();\n        t.select();\n\n        return;\n    });\n}\n\n// ============================================================================\n    return async_save_text;\n});\n\n"]}