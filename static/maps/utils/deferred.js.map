{"version":3,"sources":["utils/deferred.js"],"names":["define","Utils","Backbone","Model","extend","initialize","this","active","last","execute","callback","self","id","uid","has_deferred","length","process","$","Deferred","promise","always","Galaxy","emit","debug","state","charAt","toUpperCase","slice","when","resolve","reject","reset","i","ready","isEmptyObject"],"mappings":"AAGAA,QAAQ,eAAgB,SAAUC,GAClC,MAAOC,UAASC,MAAMC,QAClBC,WAAY,WACRC,KAAKC,UACLD,KAAKE,KAAO,MAMhBC,QAAS,SAAUC,GACf,GAAIC,GAAOL,KACPM,EAAKX,EAAMY,MACXC,EAAeJ,EAASK,OAAS,CAGrCT,MAAKC,OAAQK,IAAO,CAGpB,IAAII,GAAUC,EAAEC,UAChBF,GAAQG,UAAUC,OAAO,iBACdT,GAAKJ,OAAQK,GACpBE,GAAgBO,OAAOC,KAAKC,MAAO,sBAAuBjB,KAAKkB,QAAQC,OAAO,GAAGC,cAAgBpB,KAAKkB,QAAQG,MAAM,GAAK,IAAMf,KAInIK,EAAEW,KAAMtB,KAAKE,MAAOY,OAAO,WAClBT,EAAKJ,OAAQK,IACdE,GAAgBO,OAAOC,KAAKC,MAAO,sBAAuB,WAAaX,GACvEF,EAAUM,IACTF,GAAgBE,EAAQa,WAEzBb,EAAQc,WAGhBxB,KAAKE,KAAOQ,EAAQG,WAKxBY,MAAO,WACHV,OAAOC,KAAKC,MAAM,sBAAuB,QACzC,KAAM,GAAIS,KAAK1B,MAAKC,OAChBD,KAAKC,OAAQyB,IAAM,GAM3BC,MAAO,WACH,MAAOhB,GAAEiB,cAAe5B,KAAKC","file":"../../scripts/utils/deferred.js","sourcesContent":["/**\n *  This class defines a queue to ensure that multiple deferred callbacks are executed sequentially.\n */\ndefine(['utils/utils'], function( Utils ) {\nreturn Backbone.Model.extend({\n    initialize: function(){\n        this.active = {};\n        this.last = null;\n    },\n\n    /** Adds a callback to the queue. Upon execution a deferred object is parsed to the callback i.e. callback( deferred ).\n     *  If the callback does not take any arguments, the deferred is resolved instantly.\n    */\n    execute: function( callback ) {\n        var self = this;\n        var id = Utils.uid();\n        var has_deferred = callback.length > 0;\n\n        // register process\n        this.active[ id ] = true;\n\n        // deferred process\n        var process = $.Deferred();\n        process.promise().always(function() {\n            delete self.active[ id ];\n            has_deferred && Galaxy.emit.debug( 'deferred::execute()', this.state().charAt(0).toUpperCase() + this.state().slice(1) + ' ' + id );\n        });\n\n        // deferred queue\n        $.when( this.last ).always(function() {\n            if ( self.active[ id ] ) {\n                has_deferred && Galaxy.emit.debug( 'deferred::execute()', 'Running ' + id );\n                callback( process );\n                !has_deferred && process.resolve();\n            } else {\n                process.reject();\n            }\n        });\n        this.last = process.promise();\n    },\n\n    /** Resets the promise queue. All currently queued but unexecuted callbacks/promises will be rejected.\n    */\n    reset: function() {\n        Galaxy.emit.debug('deferred::execute()', 'Reset');\n        for ( var i in this.active ) {\n            this.active[ i ] = false;\n        }\n    },\n\n    /** Returns true if all processes are done.\n    */\n    ready: function() {\n        return $.isEmptyObject( this.active );\n    }\n});\n\n});"]}