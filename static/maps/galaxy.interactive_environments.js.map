{"version":3,"sources":["galaxy.interactive_environments.js"],"names":["append_notebook","url","clear_main_area","$","children","remove","display_spinner","galaxy_root","not_ready","timeout","timeout_values","timeout_time_max","timeout_time_step","toastr","closeButton","tapToDismiss","time","console","log","count","window","setTimeout","ajax_timeout_max","success_callback","ajax_timeout_step","test_ie_availability","xhrFields","withCredentials","type","dataType","success","ajax_timeout","data","clear","error","textStatus","jqXHR","errorThrown","clearInterval","interval","setInterval","request_count","jqxhr","status","timeOut"],"mappings":"aAIA,SAASA,gBAAgBC,GACrBC,kBADJC,EAAA,SAASH,OAAAA,uHAAoBC,EAAA,eAM7B,SAASC,kBAATC,EAAA,YAASD,SACLC,EAAE,SAAAC,WAAFC,SAIJ,SAASC,kBAATH,EAASG,SAAAA,OAAT,0BAA0BC,YAAA,wGAI1B,SAASC,UAAUC,EAASC,EAAgBC,EAAkBC,GAAlCF,GAA5BA,EAAmBD,QACZC,kBACCJ,OAAAA,KACAO,gGAIHC,aAAA,EAAAC,cAAA,KAGGL,EAAAA,QACHA,EAAAM,KAAAL,IACDM,EAAYD,MAAAJ,GAEfK,QAAAC,IAAA,qBAAAR,EAAAS,MAAA,aAAAT,EAAAM,KAAA,IAAA,KADGI,OAAOC,WAAWZ,EAASC,EAAeM,MAQ1C,SAAIM,gBAAAA,EAAmBC,GACvB,IAAIC,EAAAA,IAGAZ,GAAAA,KAAJ,IAAAO,MAAA,GA0DJC,OAASK,WAvDQxB,SAALA,IACAyB,EAAAA,MACIC,IAAAA,EADOD,WAGXE,iBALG,GAOHC,KAAAA,MACAC,QAASC,EACLF,SAAGG,OACCf,QAAAA,SAAQC,GACRhB,GAAAA,GACAW,QAAOoB,IAAP,gDACAV,kBAJJV,OAKSmB,QACLxB,KACC,GAAAwB,EACD9B,UAAAA,EAAAA,EAlBZO,KACO,MAmBKI,kBAKHA,OAAAoB,QAxBFpB,OAAAqB,MA0BI,gHACAC,SACIJ,aAAeT,EAAAA,cAAiB,MAItCY,MALD,SAKKE,EAAAD,EAAAE,GACDnC,WAAAA,GACAW,EAtCOG,MAuCPH,GAtCO,KA4CdL,UAAAC,EAAAC,EA1CLD,KACO,OADXP,kBA6COmB,OAAWZ,QACrBI,OAAAqB,MATuB,uIAaxB,SAXyBpB,aAAe,EAAMC,cAAgB,SAkBhCd,EAAKsB,MAYnBN,SAAAA,qBAAYhB,EAAAsB,GACZe,IAAAA,EAAAA,EACAf,kBACHgB,SAXEC,YAAA,WAYHN,EAAAA,MACIO,IAAAA,EACAxB,WACAU,iBAAGc,GAECvC,KAAAA,MACAW,QAAAA,IAKHiB,QAAA,WACJb,QAAAC,IAAA,8BAxBLoB,cAAAC,UADJhB,KAaQW,MAAO,SAASQ,EAAOC,EAAQT,GAC3BO,IACAxB,QAAQC,IAAI,wBAA0BuB,GACnCA,EAAgB,KACfH,cAAcC,UACdrC,kBACAW,OAAOqB,MACH,sDACA,SACCpB,aAAe,EAAM8B,QAAW,IAAO7B,cAAgB,SAKzE","file":"../scripts/galaxy.interactive_environments.js","sourcesContent":["/**\n * Internal function to remove content from the main area and add the notebook.\n * Not idempotent\n */\nfunction append_notebook(url){\n    clear_main_area();\n    $('#main').append('<iframe frameBorder=\"0\" seamless=\"seamless\" style=\"width: 100%; height: 100%; overflow:hidden;\" scrolling=\"no\" src=\"'+ url +'\"></iframe>'\n    );\n}\n\nfunction clear_main_area(){\n    $('#spinner').remove();\n    $('#main').children().remove();\n}\n\nfunction display_spinner(){\n        $('#main').append('<img id=\"spinner\" src=\"' + galaxy_root + 'static/style/largespinner.gif\" style=\"position:absolute;margin:auto;top:0;left:0;right:0;bottom:0;\">');\n}\n\nfunction not_ready(timeout, timeout_values, timeout_time_max, timeout_time_step) {\n    if(timeout_values.count == 0){\n        display_spinner();\n        toastr.info(\n            \"Galaxy is launching a container in which to run this interactive environment. Please wait...\",\n            {'closeButton': true, 'tapToDismiss': false}\n        );\n    }\n    timeout_values.count++;\n    if(timeout_values.time < timeout_time_max){\n        timeout_values.time += timeout_time_step;\n    }\n    console.log(\"Readiness request \" + timeout_values.count + \" sleeping \" + timeout_values.time / 1000 + \"s\");\n    window.setTimeout(timeout, timeout_values.time)\n}\n\n/**\n * Check a URL for a boolean true/false and call a callback when done.\n */\nfunction load_when_ready(url, success_callback){\n    var ajax_timeout = 500;\n    var ajax_timeout_max = 10000;\n    var ajax_timeout_step = 250;\n    var timeout_values = { time: 1000, count: 0 };\n    var timeout_time_max = 15000;\n    var timeout_time_step = 1000;\n    var timeout = function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: ajax_timeout,\n            dataType: \"json\",\n            success: function(data){\n                if(data == true){\n                    console.log(\"Galaxy reports IE container ready, returning\");\n                    clear_main_area();\n                    toastr.clear();\n                    success_callback();\n                }else if(data == false){\n                    not_ready(timeout, timeout_values, timeout_time_max, timeout_time_step);\n                }else{\n                    clear_main_area();\n                    toastr.clear();\n                    toastr.error(\n                        \"Galaxy failed to launch a container in which to run this interactive environment, contact your administrator.\",\n                        \"Error\",\n                        {'closeButton': true, 'tapToDismiss': false}\n                    );\n                }\n            },\n            error: function(jqXHR, textStatus, errorThrown){\n                if(textStatus == \"timeout\"){\n                    if(ajax_timeout < ajax_timeout_max){\n                        ajax_timeout += ajax_timeout_step;\n                    }\n                    not_ready(timeout, timeout_values, timeout_time_max, timeout_time_step);\n                }else{\n                    clear_main_area();\n                    toastr.clear();\n                    toastr.error(\n                        \"Galaxy encountered an error while attempting to determine the readiness of this interactive environment, contact your administrator.\",\n                        \"Error\",\n                        {'closeButton': true, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }\n    window.setTimeout(timeout, timeout_values.time);\n}\n\n\n\n/**\n * Test availability of a URL, and call a callback when done.\n * http://stackoverflow.com/q/25390206/347368\n * @param {String} url: URL to test availability of. Must return a 200 (302->200 is OK).\n * @param {String} callback: function to call once successfully connected.\n *\n */\nfunction test_ie_availability(url, success_callback){\n    var request_count = 0;\n    display_spinner();\n    interval = setInterval(function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: 500,\n            success: function(){\n                console.log(\"Connected to IE, returning\");\n                clearInterval(interval);\n                success_callback();\n            },\n            error: function(jqxhr, status, error){\n                request_count++;\n                console.log(\"Availability request \" + request_count);\n                if(request_count > 30){\n                    clearInterval(interval);\n                    clear_main_area();\n                    toastr.error(\n                        \"Could not connect to IE, contact your administrator\",\n                        \"Error\",\n                        {'closeButton': true, 'timeOut': 20000, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }, 1000);\n}\n"]}