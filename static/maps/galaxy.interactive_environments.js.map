{"version":3,"sources":["galaxy.interactive_environments.js"],"names":["append_notebook","url","clear_main_area","$","children","remove","display_spinner","galaxy_root","load_when_ready","success_callback","request_count","timeout_time_step","timeout","ajax","xhrFields","type","dataType","data","success","log","console","toastr","closeButton","tapToDismiss","timeout_time","clear","error","window","setTimeout","test_ie_availability","clearInterval","withCredentials","jqxhr","status","interval","timeOut"],"mappings":"YAIA,SAASA,iBAAgBC,GACrBC,kBADJC,EAAA,SAASH,OAAAA,uHAAoBC,EAAA,eAM7B,QAASC,mBAATC,EAAA,YAASD,SACLC,EAAE,SAAAC,WAAFC,SAIJ,QAASC,mBAATH,EAASG,SAAAA,OAAT,0BAA0BC,YAAA,wGAO1B,QAASC,iBAAgBP,EAAKQ,GAA9B,GAAAC,GAAA,EACQA,EAAAA,IAGAC,EAAAA,QAAAA,KACAC,EAAAA,MACEC,IAAKZ,EACHA,WACAa,iBAAW,GAAAC,KAFR,MAKHA,QAAM,IACNH,SAAS,OACTI,QAAAA,SAPGC,GAQM,GAATC,GACOD,QAAQE,IAAX,gDACIC,kBACAlB,OAAAA,QACAmB,KACAZ,GAAAA,GACE,GAAAC,IACCA,kBACCJ,OAAAA,KACAe,gGAIHC,aAAA,EAAAC,cAAA,KAGGC,IACHA,EA7BjB,OA8BgBJ,GA7BO,KAiBLA,QAcDD,IAAA,qBAAAT,EAAA,aAAAc,EAAA,IAAA,KACDtB,OAAAA,WAAAA,EAAAA,KAEAmB,kBAKHA,OAAAI,QACJJ,OAAAK,MArCL,gHADJ,SAyCkBd,aAASY,EAA3BD,cAAA,QAAAI,QAAOC,WAAWhB,EAASY,GAkBR,QAAAK,sBAFR5B,EAAAQ,GAKHM,GAAAA,GALG,CAMHH,mBACAM,SAAAA,YAAS,WACLE,EAAAA,MACAU,IAAAA,EACArB,WAVDsB,iBAAA,GAaCrB,KAAAA,MACAU,QAAAA,IACAF,QAAGR,WACCoB,QAAAA,IAAAA,8BACA5B,cAAAA,UACAmB,KAMPK,MAAA,SAAAM,EAAAC,EAAAP,GAxBLhB,IADJU,QAAAD,IAAA,wBAAAT,GA4BHA,EAAA,KAXmBoB,cAAcI,UACdhC,kBACAmB,OAAOK,MACH,sDACA,SACCJ,aAAe,EAAMa,QAAW,IAAOZ,cAAgB,SAKzE","file":"../scripts/galaxy.interactive_environments.js","sourcesContent":["/**\n * Internal function to remove content from the main area and add the notebook.\n * Not idempotent\n */\nfunction append_notebook(url){\n    clear_main_area();\n    $('#main').append('<iframe frameBorder=\"0\" seamless=\"seamless\" style=\"width: 100%; height: 100%; overflow:hidden;\" scrolling=\"no\" src=\"'+ url +'\"></iframe>'\n    );\n}\n\nfunction clear_main_area(){\n    $('#spinner').remove();\n    $('#main').children().remove();\n}\n\nfunction display_spinner(){\n        $('#main').append('<img id=\"spinner\" src=\"' + galaxy_root + 'static/style/largespinner.gif\" style=\"position:absolute;margin:auto;top:0;left:0;right:0;bottom:0;\">');\n}\n\n/**\n * Check a URL for a boolean true/false and call a callback when done.\n */\nfunction load_when_ready(url, success_callback){\n    var request_count = 0;\n    var timeout_time = 1000;\n    var timeout_time_max = 15000;\n    var timeout_time_step = 1000;\n    var timeout = function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: 500,\n            dataType: \"json\",\n            success: function(data){\n                if(data == true){\n                    console.log(\"Galaxy reports IE container ready, returning\");\n                    clear_main_area();\n                    toastr.clear();\n                    success_callback();\n                }else if(data == false){\n                    if(request_count == 0){\n                        display_spinner();\n                        toastr.info(\n                            \"Galaxy is launching a container in which to run this interactive environment. Please wait...\",\n                            {'closeButton': true, 'tapToDismiss': false}\n                        );\n                    }\n                    request_count++;\n                    if(timeout_time < timeout_time_max){\n                        timeout_time += timeout_time_step;\n                    }\n                    console.log(\"Readiness request \" + request_count + \" sleeping \" + timeout_time / 1000 + \"s\");\n                    window.setTimeout(timeout, timeout_time)\n                }else{\n                    clear_main_area();\n                    toastr.clear();\n                    toastr.error(\n                        \"Galaxy failed to launch a container in which to run this interactive environment, contact your administrator.\",\n                        \"Error\",\n                        {'closeButton': true, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }\n    window.setTimeout(timeout, timeout_time);\n}\n\n\n\n/**\n * Test availability of a URL, and call a callback when done.\n * http://stackoverflow.com/q/25390206/347368\n * @param {String} url: URL to test availability of. Must return a 200 (302->200 is OK).\n * @param {String} callback: function to call once successfully connected.\n *\n */\nfunction test_ie_availability(url, success_callback){\n    var request_count = 0;\n    display_spinner();\n    interval = setInterval(function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: 500,\n            success: function(){\n                console.log(\"Connected to IE, returning\");\n                clearInterval(interval);\n                success_callback();\n            },\n            error: function(jqxhr, status, error){\n                request_count++;\n                console.log(\"Availability request \" + request_count);\n                if(request_count > 30){\n                    clearInterval(interval);\n                    clear_main_area();\n                    toastr.error(\n                        \"Could not connect to IE, contact your administrator\",\n                        \"Error\",\n                        {'closeButton': true, 'timeOut': 20000, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }, 1000);\n}\n"]}