{"version":3,"sources":["galaxy.interactive_environments.js"],"names":["append_notebook","url","clear_main_area","$","append","remove","children","display_spinner","galaxy_root","load_when_ready","success_callback","request_count","timeout_time","timeout","ajax","xhrFields","withCredentials","type","dataType","success","data","console","log","toastr","clear","info","closeButton","tapToDismiss","window","setTimeout","error","test_ie_availability","interval","setInterval","clearInterval","jqxhr","status","timeOut"],"mappings":"AAIA,QAASA,iBAAgBC,GACrBC,kBACAC,EAAE,SAASC,OAAO,uHAAwHH,EAAK,eAInJ,QAASC,mBACLC,EAAE,YAAYE,SACdF,EAAE,SAASG,WAAWD,SAG1B,QAASE,mBACDJ,EAAE,SAASC,OAAO,0BAA4BI,YAAc,wGAMpE,QAASC,iBAAgBR,EAAKS,GAC1B,GAAIC,GAAgB,EAChBC,EAAe,IAGfC,EAAU,WACVV,EAAEW,MACEb,IAAKA,EACLc,WACIC,iBAAiB,GAErBC,KAAM,MACNJ,QAAS,IACTK,SAAU,OACVC,QAAS,SAASC,GACH,GAARA,GACCC,QAAQC,IAAI,gDACZpB,kBACAqB,OAAOC,QACPd,KACa,GAARU,GACe,GAAjBT,IACCJ,kBACAgB,OAAOE,KACH,gGACCC,aAAe,EAAMC,cAAgB,KAG9ChB,IACGC,EA1BI,OA2BHA,GA1BI,KA4BRS,QAAQC,IAAI,qBAAuBX,EAAgB,aAAeC,EAAe,IAAO,KACxFgB,OAAOC,WAAWhB,EAASD,KAE3BV,kBACAqB,OAAOC,QACPD,OAAOO,MACH,gHACA,SACCJ,aAAe,EAAMC,cAAgB,QAM1DC,QAAOC,WAAWhB,EAASD,GAY/B,QAASmB,sBAAqB9B,EAAKS,GAC/B,GAAIC,GAAgB,CACpBJ,mBACAyB,SAAWC,YAAY,WACnB9B,EAAEW,MACEb,IAAKA,EACLc,WACIC,iBAAiB,GAErBC,KAAM,MACNJ,QAAS,IACTM,QAAS,WACLE,QAAQC,IAAI,8BACZY,cAAcF,UACdtB,KAEJoB,MAAO,SAASK,EAAOC,EAAQN,GAC3BnB,IACAU,QAAQC,IAAI,wBAA0BX,GACnCA,EAAgB,KACfuB,cAAcF,UACd9B,kBACAqB,OAAOO,MACH,sDACA,SACCJ,aAAe,EAAMW,QAAW,IAAOV,cAAgB,SAKzE","file":"../scripts/galaxy.interactive_environments.js","sourcesContent":["/**\n * Internal function to remove content from the main area and add the notebook.\n * Not idempotent\n */\nfunction append_notebook(url){\n    clear_main_area();\n    $('#main').append('<iframe frameBorder=\"0\" seamless=\"seamless\" style=\"width: 100%; height: 100%; overflow:hidden;\" scrolling=\"no\" src=\"'+ url +'\"></iframe>'\n    );\n}\n\nfunction clear_main_area(){\n    $('#spinner').remove();\n    $('#main').children().remove();\n}\n\nfunction display_spinner(){\n        $('#main').append('<img id=\"spinner\" src=\"' + galaxy_root + 'static/style/largespinner.gif\" style=\"position:absolute;margin:auto;top:0;left:0;right:0;bottom:0;\">');\n}\n\n/**\n * Check a URL for a boolean true/false and call a callback when done.\n */\nfunction load_when_ready(url, success_callback){\n    var request_count = 0;\n    var timeout_time = 1000;\n    var timeout_time_max = 15000;\n    var timeout_time_step = 1000;\n    var timeout = function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: 500,\n            dataType: \"json\",\n            success: function(data){\n                if(data == true){\n                    console.log(\"Galaxy reports IE container ready, returning\");\n                    clear_main_area();\n                    toastr.clear();\n                    success_callback();\n                }else if(data == false){\n                    if(request_count == 0){\n                        display_spinner();\n                        toastr.info(\n                            \"Galaxy is launching a container in which to run this interactive environment. Please wait...\",\n                            {'closeButton': true, 'tapToDismiss': false}\n                        );\n                    }\n                    request_count++;\n                    if(timeout_time < timeout_time_max){\n                        timeout_time += timeout_time_step;\n                    }\n                    console.log(\"Readiness request \" + request_count + \" sleeping \" + timeout_time / 1000 + \"s\");\n                    window.setTimeout(timeout, timeout_time)\n                }else{\n                    clear_main_area();\n                    toastr.clear();\n                    toastr.error(\n                        \"Galaxy failed to launch a container in which to run this interactive environment, contact your administrator.\",\n                        \"Error\",\n                        {'closeButton': true, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }\n    window.setTimeout(timeout, timeout_time);\n}\n\n\n\n/**\n * Test availability of a URL, and call a callback when done.\n * http://stackoverflow.com/q/25390206/347368\n * @param {String} url: URL to test availability of. Must return a 200 (302->200 is OK).\n * @param {String} callback: function to call once successfully connected.\n *\n */\nfunction test_ie_availability(url, success_callback){\n    var request_count = 0;\n    display_spinner();\n    interval = setInterval(function(){\n        $.ajax({\n            url: url,\n            xhrFields: {\n                withCredentials: true\n            },\n            type: \"GET\",\n            timeout: 500,\n            success: function(){\n                console.log(\"Connected to IE, returning\");\n                clearInterval(interval);\n                success_callback();\n            },\n            error: function(jqxhr, status, error){\n                request_count++;\n                console.log(\"Availability request \" + request_count);\n                if(request_count > 30){\n                    clearInterval(interval);\n                    clear_main_area();\n                    toastr.error(\n                        \"Could not connect to IE, contact your administrator\",\n                        \"Error\",\n                        {'closeButton': true, 'timeOut': 20000, 'tapToDismiss': false}\n                    );\n                }\n            }\n        });\n    }, 1000);\n}\n"]}