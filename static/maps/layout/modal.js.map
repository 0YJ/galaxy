{"version":3,"sources":["layout/modal.js"],"names":["define","jQuery","body","buttons","$","Modal","options","this","overlay","$dialog","dialog","$header","find","$footer","$overlay","$backdrop","$body","proxy","hide","extend","prototype","setContent","title","show","closeButton","$buttons","html","each","name","value","append","$extraButtons","extra_buttons","click","callback","is","css","backdrop","addClass","removeClass","width","modal","outerHeight","parseInt","fadeOut","children","remove","undefined","hide_modal","show_modal","init_fn","show_in_overlay","bind","show_message","unbind","url","height","scroll"],"mappings":"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","file":"../../scripts/layout/modal.js","sourcesContent":["define([\"jquery\"], function(jQuery) {\n    \"use strict\";\n    // ============================================================================\n    //TODO: (the older version) unify with ui-modal (the newer version)\n    var $ = jQuery;\n\n    // Modal dialog boxes\n    var Modal = function(options) {\n        this.$overlay = options.overlay;\n        this.$dialog = options.dialog;\n        this.$header = this.$dialog.find(\".modal-header\");\n        this.$body = this.$dialog.find(\".modal-body\");\n        this.$footer = this.$dialog.find(\".modal-footer\");\n        this.$backdrop = options.backdrop;\n        // Close button\n        this.$header.find(\".close\").on(\"click\", $.proxy(this.hide, this));\n    };\n\n    $.extend(Modal.prototype, {\n        setContent: function(options) {\n            this.$header.hide();\n            // Title\n            if (options.title) {\n                this.$header.find(\".title\").html(options.title);\n                this.$header.show();\n            }\n            if (options.closeButton) {\n                this.$header.find(\".close\").show();\n                this.$header.show();\n            } else {\n                this.$header.find(\".close\").hide();\n            }\n            // Buttons\n            this.$footer.hide();\n            var $buttons = this.$footer.find(\".buttons\").html(\"\");\n            if (options.buttons) {\n                $.each(options.buttons, function(name, value) {\n                    $buttons\n                        .append(\n                            $(\"<button></button> \")\n                                .text(name)\n                                .click(value)\n                        )\n                        .append(\" \");\n                });\n                this.$footer.show();\n            }\n            var $extraButtons = this.$footer.find(\".extra_buttons\").html(\"\");\n            if (options.extra_buttons) {\n                $.each(options.extra_buttons, function(name, value) {\n                    $extraButtons\n                        .append(\n                            $(\"<button></button>\")\n                                .text(name)\n                                .click(value)\n                        )\n                        .append(\" \");\n                });\n                this.$footer.show();\n            }\n            // Body\n            var body = options.body;\n            if (body == \"progress\") {\n                body = $(\n                    \"<div class='progress progress-striped active'><div class='progress-bar' style='width: 100%'></div></div>\"\n                );\n            }\n            this.$body.html(body);\n        },\n        show: function(options, callback) {\n            if (!this.$dialog.is(\":visible\")) {\n                if (options.backdrop) {\n                    this.$backdrop.addClass(\"in\");\n                } else {\n                    this.$backdrop.removeClass(\"in\");\n                }\n                this.$overlay.show();\n                this.$dialog.show();\n                this.$overlay.addClass(\"in\");\n                // Fix min-width so that modal cannot shrink considerably if new content is loaded.\n                this.$body.css(\"min-width\", this.$body.width());\n                // Set max-height so that modal does not exceed window size and is in middle of page.\n                // TODO: this could perhaps be handled better using CSS.\n                this.$body.css(\n                    \"max-height\",\n                    $(window).height() -\n                        this.$footer.outerHeight() -\n                        this.$header.outerHeight() -\n                        parseInt(this.$dialog.css(\"padding-top\"), 10) -\n                        parseInt(this.$dialog.css(\"padding-bottom\"), 10)\n                );\n            }\n            // Callback on init\n            if (callback) {\n                callback();\n            }\n        },\n        hide: function() {\n            var modal = this;\n            modal.$dialog.fadeOut(function() {\n                modal.$overlay.hide();\n                modal.$backdrop.removeClass(\"in\");\n                modal.$body.children().remove();\n                // Clear min-width to allow for modal to take size of new body.\n                modal.$body.css(\"min-width\", undefined);\n            });\n        }\n    });\n\n    var modal;\n\n    $(function() {\n        modal = new Modal({\n            overlay: $(\"#top-modal\"),\n            dialog: $(\"#top-modal-dialog\"),\n            backdrop: $(\"#top-modal-backdrop\")\n        });\n    });\n\n    // Backward compatibility\n    function hide_modal() {\n        modal.hide();\n    }\n\n    function show_modal(title, body, buttons, extra_buttons, init_fn) {\n        modal.setContent({\n            title: title,\n            body: body,\n            buttons: buttons,\n            extra_buttons: extra_buttons\n        });\n        modal.show({ backdrop: true }, init_fn);\n    }\n\n    function show_message(title, body, buttons, extra_buttons, init_fn) {\n        modal.setContent({\n            title: title,\n            body: body,\n            buttons: buttons,\n            extra_buttons: extra_buttons\n        });\n        modal.show({ backdrop: false }, init_fn);\n    }\n\n    function show_in_overlay(options) {\n        var width = options.width || \"600\";\n        var height = options.height || \"400\";\n        var scroll = options.scroll || \"auto\";\n        $(\"#overlay-background\").bind(\"click.overlay\", function() {\n            hide_modal();\n            $(\"#overlay-background\").unbind(\"click.overlay\");\n        });\n        modal.setContent({\n            closeButton: true,\n            title: \"&nbsp;\",\n            body: $(\n                \"<div style='margin: -5px;'><iframe style='margin: 0; padding: 0;' src='\" +\n                    options.url +\n                    \"' width='\" +\n                    width +\n                    \"' height='\" +\n                    height +\n                    \"' scrolling='\" +\n                    scroll +\n                    \"' frameborder='0'></iframe></div>\"\n            )\n        });\n        modal.show({ backdrop: true });\n    }\n\n    // ============================================================================\n    return {\n        Modal: Modal,\n        hide_modal: hide_modal,\n        show_modal: show_modal,\n        show_message: show_message,\n        show_in_overlay: show_in_overlay\n    };\n});\n"]}