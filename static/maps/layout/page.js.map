{"version":3,"sources":["layout/page.js"],"names":["define","Masthead","Panel","Modal","BaseMVC","PageLayoutView","Backbone","View","extend","LoggableMixin","_logNamespace","el","className","_panelIds","defaultOptions","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","initialize","options","this","log","_","pick","defaults","omit","config","Galaxy","modal","masthead","$el","attr","html","_template","append","frame","$","replaceWith","$messagebox","$inactivebox","render","remove","renderMessageBox","renderInactivityBox","renderPanels","_checkCommunicationServerOnline","content","level","addClass","toggle","show","removeClass","hide","verificationLink","root","text","page","forEach","panelId","has","setElement","left","center","css","right","join","hideSidePanels","toString","host","window","communication_server_host","port","communication_server_port","preferences","user","attributes","$chat_icon_element","indexOf","communication_server","ajax","url","success","data","id","error"],"mappings":"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","file":"../../scripts/layout/page.js","sourcesContent":["define([\n    'layout/masthead',\n    'layout/panel',\n    'mvc/ui/ui-modal',\n    'mvc/base-mvc'\n], function( Masthead, Panel, Modal, BaseMVC ) {\n\n// ============================================================================\nvar PageLayoutView = Backbone.View.extend( BaseMVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    el : 'body',\n    className : 'full-content',\n\n    _panelIds : [\n        'left', 'center', 'right'\n    ],\n\n    defaultOptions : {\n        message_box_visible     : false,\n        message_box_content     : '',\n        message_box_class       : 'info',\n        show_inactivity_warning : false,\n        inactivity_box_content  : ''\n    },\n\n    initialize : function( options ) {\n        // TODO: remove globals\n        this.log( this + '.initialize:', options );\n        _.extend( this, _.pick( options, this._panelIds ) );\n        this.options = _.defaults( _.omit( options.config, this._panelIds ), this.defaultOptions );\n        Galaxy.modal = this.modal = new Modal.View();\n        this.masthead = new Masthead.View( this.options );\n        this.$el.attr( 'scroll', 'no' );\n        this.$el.html( this._template() );\n        this.$el.append( this.masthead.frame.$el );\n        this.$( '#masthead' ).replaceWith( this.masthead.$el );\n        this.$el.append( this.modal.$el );\n        this.$messagebox = this.$( '#messagebox' );\n        this.$inactivebox = this.$( '#inactivebox' );\n    },\n\n    render : function() {\n        // TODO: Remove this line after select2 update\n        $( '.select2-hidden-accessible' ).remove();\n        this.log( this + '.render:' );\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox : function() {\n        if ( this.options.message_box_visible ){\n            var content = this.options.message_box_content || '';\n            var level = this.options.message_box_class || 'info';\n            this.$el.addClass( 'has-message-box' );\n            this.$messagebox\n                .attr( 'class', 'panel-' + level + '-message' )\n                .html( content )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-message-box' );\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox : function() {\n        if( this.options.show_inactivity_warning ){\n            var content = this.options.inactivity_box_content || '';\n            var verificationLink = $( '<a/>' ).attr( 'href', Galaxy.root + 'user/resend_verification' ).text( 'Resend verification' );\n            this.$el.addClass( 'has-inactivity-box' );\n            this.$inactivebox\n                .html( content + ' ' )\n                .append( verificationLink )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-inactivity-box' );\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels : function() {\n        var page = this;\n        this._panelIds.forEach( function( panelId ){\n            if( _.has( page, panelId ) ){\n                page[ panelId ].setElement( '#' + panelId );\n                page[ panelId ].render();\n            }\n        });\n        if( !this.left ){\n            this.center.$el.css( 'left', 0 );\n        }\n        if( !this.right ){\n            this.center.$el.css( 'right', 0 );\n        }\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n                '<div id=\"background\"/>',\n                '<div id=\"masthead\"/>',\n                '<div id=\"messagebox\"/>',\n                '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n                this.left?   '<div id=\"left\" />' : '',\n                this.center? '<div id=\"center\" class=\"inbound\" />' : '',\n                this.right?  '<div id=\"right\" />' : '',\n            '</div>',\n            '<div id=\"dd-helper\" />',\n        ].join('');\n    },\n\n    /** hide both side panels if previously shown */\n    hideSidePanels : function(){\n        if( this.left ){\n            this.left.hide();\n        }\n        if( this.right ){\n            this.right.hide();\n        }\n    },\n\n    toString : function() { return 'PageLayoutView'; },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function(){\n        var host = window.Galaxy.config.communication_server_host,\n            port = window.Galaxy.config.communication_server_port,\n            preferences = window.Galaxy.user.attributes.preferences,\n            $chat_icon_element = $( \"#show-chat-online\" );\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if ( preferences && [ '1', 'true' ].indexOf( preferences.communication_server ) != -1 ) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: host + \":\" + port,\n            })\n            .success( function( data ) {\n                    // enable communication only when a user is logged in\n                    if( window.Galaxy.user.id !== null ) {\n                        if( $chat_icon_element.css( \"visibility\")  === \"hidden\" ) {\n                            $chat_icon_element.css( \"visibility\", \"visible\" ); \n                        }\n                    }\n            })\n            .error( function( data ) { \n                // hide the communication icon if the communication server is not available\n                $chat_icon_element.css( \"visibility\", \"hidden\" ); \n            });\n        } else {\n            $chat_icon_element.css( \"visibility\", \"hidden\" ); \n        }\n    },\n});\n\n// ============================================================================\n    return {\n        PageLayoutView: PageLayoutView\n    };\n});\n"]}