{"version":3,"sources":["layout/page.js"],"names":["define","PageLayoutView","Backbone","View","extend","BaseMVC","LoggableMixin","className","_panelIds","message_box_visible","message_box_content","inactivity_box_content","initialize","show_inactivity_warning","Galaxy","options","this","log","$el","_","html","pick","_template","append","masthead","frame","config","defaultOptions","modal","replaceWith","Masthead","$messagebox","$inactivebox","$","render","remove","_checkCommunicationServerOnline","renderMessageBox","renderInactivityBox","renderPanels","content","removeClass","level","message_box_class","addClass","attr","toggle","verificationLink","root","text","page","hide","forEach","panelId","has","setElement","left","center","css","right","toString","host","window","communication_server_host","port","preferences","attributes","join","hideSidePanels","success","$chat_icon_element","communication_server_port","user","indexOf","communication_server","ajax","url","data","id","error"],"mappings":"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","file":"../../scripts/layout/page.js","sourcesContent":["define([\n    'layout/masthead',\n    'layout/panel',\n    'mvc/ui/ui-modal',\n    'mvc/base-mvc'\n], function( Masthead, Panel, Modal, BaseMVC ) {\n\n// ============================================================================\nvar PageLayoutView = Backbone.View.extend( BaseMVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    el : 'body',\n    className : 'full-content',\n\n    _panelIds : [\n        'left', 'center', 'right'\n    ],\n\n    defaultOptions : {\n        message_box_visible     : false,\n        message_box_content     : '',\n        message_box_class       : 'info',\n        show_inactivity_warning : false,\n        inactivity_box_content  : ''\n    },\n\n    initialize : function( options ) {\n        // TODO: remove globals\n        this.log( this + '.initialize:', options );\n        _.extend( this, _.pick( options, this._panelIds ) );\n        this.options = _.defaults( _.omit( options.config, this._panelIds ), this.defaultOptions );\n        Galaxy.modal = this.modal = new Modal.View();\n        this.masthead = new Masthead.View( this.options );\n        this.$el.attr( 'scroll', 'no' );\n        this.$el.html( this._template() );\n        this.$el.append( this.masthead.frame.$el );\n        this.$( '#masthead' ).replaceWith( this.masthead.$el );\n        this.$el.append( this.modal.$el );\n        this.$messagebox = this.$( '#messagebox' );\n        this.$inactivebox = this.$( '#inactivebox' );\n    },\n\n    render : function() {\n        // TODO: Remove this line after select2 update\n        $( '.select2-hidden-accessible' ).remove();\n        this.log( this + '.render:' );\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox : function() {\n        if ( this.options.message_box_visible ){\n            var content = this.options.message_box_content || '';\n            var level = this.options.message_box_class || 'info';\n            this.$el.addClass( 'has-message-box' );\n            this.$messagebox\n                .attr( 'class', 'panel-' + level + '-message' )\n                .html( content )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-message-box' );\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox : function() {\n        if( this.options.show_inactivity_warning ){\n            var content = this.options.inactivity_box_content || '';\n            var verificationLink = $( '<a/>' ).attr( 'href', Galaxy.root + 'user/resend_verification' ).text( 'Resend verification' );\n            this.$el.addClass( 'has-inactivity-box' );\n            this.$inactivebox\n                .html( content + ' ' )\n                .append( verificationLink )\n                .toggle( !!content )\n                .show();\n        } else {\n            this.$el.removeClass( 'has-inactivity-box' );\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels : function() {\n        var page = this;\n        this._panelIds.forEach( function( panelId ){\n            if( _.has( page, panelId ) ){\n                page[ panelId ].setElement( '#' + panelId );\n                page[ panelId ].render();\n            }\n        });\n        if( !this.left ){\n            this.center.$el.css( 'left', 0 );\n        }\n        if( !this.right ){\n            this.center.$el.css( 'right', 0 );\n        }\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n                '<div id=\"background\"/>',\n                '<div id=\"masthead\"/>',\n                '<div id=\"messagebox\"/>',\n                '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n                this.left?   '<div id=\"left\" />' : '',\n                this.center? '<div id=\"center\" class=\"inbound\" />' : '',\n                this.right?  '<div id=\"right\" />' : '',\n            '</div>',\n            '<div id=\"dd-helper\" />',\n        ].join('');\n    },\n\n    /** hide both side panels if previously shown */\n    hideSidePanels : function(){\n        if( this.left ){\n            this.left.hide();\n        }\n        if( this.right ){\n            this.right.hide();\n        }\n    },\n\n    toString : function() { return 'PageLayoutView'; },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function(){\n        var host = window.Galaxy.config.communication_server_host,\n            port = window.Galaxy.config.communication_server_port,\n            preferences = window.Galaxy.user.attributes.preferences,\n            $chat_icon_element = $( \"#show-chat-online\" );\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if ( preferences && [ '1', 'true' ].indexOf( preferences.communication_server ) != -1 ) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: host + \":\" + port,\n            })\n            .success( function( data ) {\n                    // enable communication only when a user is logged in\n                    if( window.Galaxy.user.id !== null ) {\n                        if( $chat_icon_element.css( \"visibility\")  === \"hidden\" ) {\n                            $chat_icon_element.css( \"visibility\", \"visible\" ); \n                        }\n                    }\n            })\n            .error( function( data ) { \n                // hide the communication icon if the communication server is not available\n                $chat_icon_element.css( \"visibility\", \"hidden\" ); \n            });\n        } else {\n            $chat_icon_element.css( \"visibility\", \"hidden\" ); \n        }\n    },\n});\n\n// ============================================================================\n    return {\n        PageLayoutView: PageLayoutView\n    };\n});\n"]}