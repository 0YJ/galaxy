{"version":3,"sources":["layout/masthead.js"],"names":["View","Backbone","extend","initialize","options","self","this","setElement","_template","$navbarBrandLink","$","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","collection","_menu2","default","Collection","on","model","append","Tab","render","$el","m","fetch","Galaxy","frame","_scratchbook2","callback","quotaMeter","_userQuotameter2","UserQuotaMeter","user","el","e","$download_link","target","closest","length","hide","attr","preventDefault","text","each","q","get","logo_src","logo_url"],"mappings":"oRAKIA,EAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjB,IAAIC,EAAOC,KACXA,KAAKF,QAAUA,EACfE,KAAKC,WAAWD,KAAKE,aACrBF,KAAKG,iBAAmBH,KAAKI,EAAE,sBAC/BJ,KAAKK,kBAAoBL,KAAKI,EAAE,uBAChCJ,KAAKM,kBAAoBN,KAAKI,EAAE,uBAChCJ,KAAKO,YAAcP,KAAKI,EAAE,gBAC1BJ,KAAKQ,YAAcR,KAAKI,EAAE,0BAG1BJ,KAAKS,WAAa,IAAIC,EAAAC,QAAKC,WAC3BZ,KAAKS,WACAI,GAAG,MAAO,SAAAC,GACPf,EAAKQ,YAAYQ,OAhBjC,IAAAL,EAAAC,QAAAK,KAAAF,MAAAA,IAAAG,SAAAC,OAGQL,GAAId,QAAO,WACXA,EAAKD,YAAUA,UAEfe,GAAA,WAAKV,SAAAA,GACLJ,EAAKM,WAAAA,KAAoB,SAAAc,GACpBb,EAAAA,OAoBAc,MAAMpB,KAAKF,SAdhBuB,OAAAC,MAAKb,KACAI,MADL,IAAAU,EAAAZ,SAEQZ,WAAKQ,KAAAA,aASDiB,OAAAA,WAAAA,KAAAC,WAAA,IAAAC,EAAAf,QAAAgB,gBACHb,MAFDO,OAAAO,KAGHC,GACAT,KAAMZ,cAIPC,EAAAA,QADwBI,GAA5B,QAAA,SAAAiB,GAcQ,IAAIC,EAAiB3B,EAAE0B,EAAEE,QAAQC,QAAQ,eAVjD,GAAAF,EAAAG,SACA,IAAA9B,EAAA,uBAAA8B,QACOT,EAAAA,QAAaV,OACTM,EAAOO,aACLpB,KAAAA,KAAAA,YAFb2B,QAMA/B,EACKS,uBAAYuB,KACLL,MACAA,EAAeG,KAAf,SAEI9B,EAAAA,oBAUJ0B,GAAAA,eAAEO,WACL,IAAAC,EAAA,GAUD,GARHzB,EAAGJ,WAlBR8B,KAkBwB,SAAAzB,GACZwB,IAAAA,EACC7B,EAAAA,IAAW8B,mBACRC,EACA1B,IAAM2B,iBADND,GAGJA,IAAMF,GAAQE,EAAI,OAET,KAATF,EACA,OAAOA,KAKvBrB,OAAAA,WAWA,OAVIjB,KAAAM,kBAAKA,KAIL,WACKD,KAAAA,QAAAA,OAAuB,KAAOL,KAAKF,QAAQ4C,OAAhD,KAEA1C,KAAAG,iBAAAiC,KAAA,OAAApC,KAAAF,QAAA6C,UACH3C,KAnF2BK,kBAAA+B,KAAA,MAAApC,KAAAF,QAAA4C,UAiFxB1C,KAAKyB,WAAWR,SAIpBjB,MArF4BE,UAAhC,WAuFQ,MACI,uVAkBRR,KAAMA","file":"../../scripts/layout/masthead.js","sourcesContent":["import Utils from \"utils/utils\";\nimport Menu from \"layout/menu\";\nimport Scratchbook from \"layout/scratchbook\";\nimport QuotaMeter from \"mvc/user/user-quotameter\";\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.options = options;\n        this.setElement(this._template());\n        this.$navbarBrandLink = this.$(\".navbar-brand-link\");\n        this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n        this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n        this.$navbarTabs = this.$(\".navbar-tabs\");\n        this.$quoteMeter = this.$(\".quota-meter-container\");\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection\n            .on(\"add\", model => {\n                self.$navbarTabs.append(\n                    new Menu.Tab({ model: model }).render().$el\n                );\n            })\n            .on(\"reset\", () => {\n                self.$navbarTabs.empty();\n            })\n            .on(\"dispatch\", callback => {\n                self.collection.each(m => {\n                    callback(m);\n                });\n            })\n            .fetch(this.options);\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook({\n            collection: this.collection\n        });\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model: Galaxy.user,\n            el: this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $(window)\n            .on(\"click\", e => {\n                var $download_link = $(e.target).closest(\"a[download]\");\n                if ($download_link.length == 1) {\n                    if ($(\"iframe[id=download]\").length === 0) {\n                        $(\"body\").append(\n                            $(\"<iframe/>\")\n                                .attr(\"id\", \"download\")\n                                .hide()\n                        );\n                    }\n                    $(\"iframe[id=download]\").attr(\n                        \"src\",\n                        $download_link.attr(\"href\")\n                    );\n                    e.preventDefault();\n                }\n            })\n            .on(\"beforeunload\", () => {\n                var text = \"\";\n                self.collection.each(model => {\n                    var q =\n                        model.get(\"onbeforeunload\") &&\n                        model.get(\"onbeforeunload\")();\n                    q && (text += q + \" \");\n                });\n                if (text !== \"\") {\n                    return text;\n                }\n            });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html(\n            \"Galaxy \" +\n                ((this.options.brand && \"/ \" + this.options.brand) || \"\")\n        );\n        this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n        this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n        this.quotaMeter.render();\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return (\n            '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n            '<div class=\"navbar-header\">' +\n            '<div class=\"navbar-tabs\"/>' +\n            \"</div>\" +\n            '<div class=\"navbar-brand\">' +\n            '<a class=\"navbar-brand-link\">' +\n            '<img class=\"navbar-brand-image\"/>' +\n            '<span class=\"navbar-brand-title\"/>' +\n            \"</a>\" +\n            \"</div>\" +\n            '<div class=\"quota-meter-container\"/>' +\n            '<div class=\"navbar-icons\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n"]}