{"version":3,"sources":["layout/menu.js"],"names":["Collection","Backbone","extend","model","Model","defaults","visible","target","fetch","options","this","reset","extendedNavItem","_genericNavView2","default","GenericNavView","add","render","id","title","_localization2","tooltip","self","disabled","Galaxy","user","url","menu","user_requests","lims_doc_url","_webhooks2","callback","ready","webhooks","models","index","document","toJSON","$","each","webhook","activate","icon","obj","config","onclick","function","page","masthead","collection","_utils2","appendScriptStyle","get","cls","support_url","search_url","screencasts_url","wiki_url","terms_url","helpTab","biostar_url","biostar_url_redirect","unshift","userTab","noscratchbook","divider","activeView","jQuery","session_csrf_token","setElement","listenTo","$el","visibility","active_view","set","Deferred","resolve","_formatUrl","Tab","initialize","$dropdown","$menu","show","$note","events","click .dropdown-toggle","removeClass","menuItem","remove","addClass","css","$toggle","append","html","_buildMenuItem","e","frame","attr","placement","_toggleClick","preventDefault","hide","trigger","off","buildLink","empty","_","popover","content","setTimeout","_template","on","m","label","root","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\nimport GenericNav from \"layout/generic-nav-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function(options) {\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: _l(\"Analyze Data\"),\n            url: \"\",\n            tooltip: _l(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: _l(\"Workflow\"),\n            tooltip: _l(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflow\"\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: _l(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: _l(\"Access published resources\"),\n            menu: [\n                {\n                    title: _l(\"Data Libraries\"),\n                    url: \"library/list\"\n                },\n                {\n                    title: _l(\"Histories\"),\n                    url: \"histories/list_published\"\n                },\n                {\n                    title: _l(\"Workflows\"),\n                    url: \"workflows/list_published\"\n                },\n                {\n                    title: _l(\"Visualizations\"),\n                    url: \"visualizations/list_published\"\n                },\n                {\n                    title: _l(\"Pages\"),\n                    url: \"pages/list_published\"\n                }\n            ]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests &&\n            this.add({\n                id: \"lab\",\n                title: \"Lab\",\n                menu: [\n                    {\n                        title: \"Sequencing Requests\",\n                        url: \"requests/index\"\n                    },\n                    {\n                        title: \"Find Samples\",\n                        url: \"requests/find_samples_index\"\n                    },\n                    {\n                        title: \"Help\",\n                        url: options.lims_doc_url\n                    }\n                ]\n            });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: _l(\"Visualization\"),\n            url: \"visualizations/list\",\n            tooltip: _l(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [\n                {\n                    title: _l(\"New Track Browser\"),\n                    url: \"visualization/trackster\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Saved Visualizations\"),\n                    url: \"visualizations/list\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Interactive Environments\"),\n                    url: \"visualization/gie_list\",\n                    target: \"galaxy_main\"\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: \"api/webhooks/masthead/all\",\n            callback: function(webhooks) {\n                $(document).ready(function() {\n                    $.each(webhooks.models, function(index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.name,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                onclick:\n                                    webhook.config.function &&\n                                    new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get(\"is_admin\") &&\n            this.add({\n                id: \"admin\",\n                title: _l(\"Admin\"),\n                url: \"admin\",\n                tooltip: _l(\"Administer this Galaxy\"),\n                cls: \"admin-only\"\n            });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: _l(\"Help\"),\n            tooltip: _l(\"Support, contact, and community\"),\n            menu: [\n                {\n                    title: _l(\"Support\"),\n                    url: options.support_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Search\"),\n                    url: options.search_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Mailing Lists\"),\n                    url: options.mailing_lists,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Videos\"),\n                    url: options.screencasts_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Wiki\"),\n                    url: options.wiki_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"How to Cite Galaxy\"),\n                    url: options.citation_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Interactive Tours\"),\n                    url: \"tours\"\n                }\n            ]\n        };\n        options.terms_url &&\n            helpTab.menu.push({\n                title: _l(\"Terms and Conditions\"),\n                url: options.terms_url,\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Ask a question\"),\n                url: \"biostar/biostar_question_redirect\",\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Galaxy Biostar\"),\n                url: options.biostar_url_redirect,\n                target: \"_blank\"\n            });\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Account registration or login\"),\n                    menu: [\n                        {\n                            title: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        },\n                        {\n                            title: _l(\"Register\"),\n                            url: \"user/create\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: _l(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: _l(\"Account and saved data\"),\n                menu: [\n                    {\n                        title:\n                            _l(\"Logged in as\") + \" \" + Galaxy.user.get(\"email\")\n                    },\n                    {\n                        title: _l(\"Preferences\"),\n                        url: \"user\"\n                    },\n                    {\n                        title: _l(\"Custom Builds\"),\n                        url: \"custom_builds\"\n                    },\n                    {\n                        title: _l(\"Logout\"),\n                        url:\n                            \"user/logout?session_csrf_token=\" +\n                            Galaxy.session_csrf_token,\n                        target: \"_top\",\n                        divider: true\n                    },\n                    {\n                        title: _l(\"Saved Histories\"),\n                        url: \"histories/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Datasets\"),\n                        url: \"datasets/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Pages\"),\n                        url: \"pages/list\",\n                        target: \"_top\"\n                    }\n                ]\n            };\n        }\n        this.add(userTab);\n        var activeView = this.get(options.active_view);\n        activeView && activeView.set(\"active\", true);\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$dropdown = this.$(\".dropdown\");\n        this.$toggle = this.$(\".dropdown-toggle\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.$note = this.$(\".dropdown-note\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .dropdown-toggle\": \"_toggleClick\"\n    },\n\n    render: function() {\n        var self = this;\n        $(\".tooltip\").remove();\n        this.$el.attr(\"id\", this.model.id).css({\n            visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n        });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note\n            .html(this.model.get(\"note\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-note\")\n            .addClass(this.model.get(\"note_cls\"))\n            .css({\n                display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n            });\n        this.$toggle\n            .html(this.model.get(\"title\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-toggle\")\n            .addClass(this.model.get(\"cls\"))\n            .addClass(\n                this.model.get(\"icon\") &&\n                    \"dropdown-icon fa \" + this.model.get(\"icon\")\n            )\n            .addClass(this.model.get(\"toggle\") && \"toggle\")\n            .attr(\"target\", this.model.get(\"target\"))\n            .attr(\"href\", this.model.get(\"url\"))\n            .attr(\"title\", this.model.get(\"tooltip\"))\n            .tooltip(\"destroy\");\n        this.model.get(\"tooltip\") &&\n            this.$toggle.tooltip({ placement: \"bottom\" });\n        this.$dropdown\n            .removeClass()\n            .addClass(\"dropdown\")\n            .addClass(this.model.get(\"disabled\") && \"disabled\")\n            .addClass(this.model.get(\"active\") && \"active\");\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\")\n                .show()\n                .off()\n                .on(\"click\", function() {\n                    $(\"#dd-helper\").hide();\n                    self.model.set(\"show_menu\", false);\n                });\n        } else {\n            self.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass(\"dropdown-menu\");\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), function(menuItem) {\n                self.$menu.append(self._buildMenuItem(menuItem));\n                menuItem.divider &&\n                    self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n            });\n            self.$menu.addClass(\"dropdown-menu\");\n            self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function(options) {\n        var self = this;\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = self._formatUrl(options.url);\n        return $(\"<li/>\").append(\n            $(\"<a/>\")\n                .attr(\"href\", options.url)\n                .attr(\"target\", options.target)\n                .html(options.title)\n                .on(\"click\", function(e) {\n                    e.preventDefault();\n                    self.model.set(\"show_menu\", false);\n                    if (options.onclick) {\n                        options.onclick();\n                    } else {\n                        Galaxy.frame.add(options);\n                    }\n                })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function(e) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", function(m) {\n            model.id !== m.id && m.get(\"menu\") && m.set(\"show_menu\", false);\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                model.get(\"onclick\")\n                    ? model.get(\"onclick\")()\n                    : Galaxy.frame.add(model.attributes);\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            function buildLink(label, url) {\n                return $(\"<div/>\")\n                    .append(\n                        $(\"<a/>\")\n                            .attr(\"href\", Galaxy.root + url)\n                            .html(label)\n                    )\n                    .html();\n            }\n            this.$toggle.popover && this.$toggle.popover(\"destroy\");\n            this.$toggle\n                .popover({\n                    html: true,\n                    placement: \"bottom\",\n                    content:\n                        \"Please \" +\n                        buildLink(\"login\", \"user/login?use_panels=True\") +\n                        \" or \" +\n                        buildLink(\"register\", \"user/create?use_panels=True\") +\n                        \" to use this feature.\"\n                })\n                .popover(\"show\");\n            setTimeout(function() {\n                self.$toggle.popover(\"destroy\");\n            }, 5000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function(url) {\n        return typeof url == \"string\" &&\n            url.indexOf(\"//\") === -1 &&\n            url.charAt(0) != \"/\"\n            ? Galaxy.root + url\n            : url;\n    },\n\n    /** body tempate */\n    _template: function() {\n        return (\n            '<ul class=\"nav navbar-nav\">' +\n            '<li class=\"dropdown\">' +\n            '<a class=\"dropdown-toggle\"/>' +\n            '<ul class=\"dropdown-menu\"/>' +\n            '<div class=\"dropdown-note\"/>' +\n            \"</li>\" +\n            \"</ul>\"\n        );\n    }\n});\n\nexport default {\n    Collection: Collection,\n    Tab: Tab\n};\n"]}