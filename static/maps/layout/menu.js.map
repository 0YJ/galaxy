{"version":3,"sources":["layout/menu.js"],"names":["define","GenericNav","Webhooks","_l","Utils","Collection","Backbone","extend","Model","model","defaults","fetch","options","this","reset","extendedNavItem","GenericNavView","add","render","id","title","Galaxy","user","tooltip","disabled","url","window","location","root","menu","user_requests","lims_doc_url","target","webhooks","callback","ready","$","document","index","each","models","webhook","name","icon","config","Function","function","page","collection","obj","masthead","appendScriptStyle","get","cls","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","onclick","router","navigate","trigger","terms_url","biostar_url_redirect","userTab","push","divider","noscratchbook","activeView","active_view","Deferred","jQuery","resolve","promise","Tab","initialize","setElement","$dropdown","_template","$toggle","$menu","$note","listenTo","events","click .dropdown-toggle","self","attr","$el","set","_formatUrl","html","removeClass","addClass","css","display","show","hide","placement","_","append","_buildMenuItem","menuItem","on","frame","e","_toggleClick","preventDefault","m","content","popover","setTimeout","buildLink","label","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(['layout/generic-nav-view', 'mvc/webhooks', 'utils/localization', 'utils/utils'], function( GenericNav, Webhooks, _l, Utils ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : _l('Analyze Data'),\n            url             : '',\n            tooltip         : _l('Analysis home view')\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : _l('Workflow'),\n            tooltip         : _l('Chain tools into workflows'),\n            disabled        : !Galaxy.user.id,\n            url             : 'workflow',\n            target          : 'galaxy_main',\n            onclick         : function() {\n                                  window.location = Galaxy.root + 'workflow';\n                            }\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : _l('Shared Data'),\n            url             : 'library/index',\n            tooltip         : _l('Access published resources'),\n            menu            : [{\n                    title   : _l('Data Libraries'),\n                    url     : 'library/list'\n                },{\n                    title   : _l('Histories'),\n                    url     : 'histories/list_published'\n                },{\n                    title   : _l('Workflows'),\n                    url     : 'workflows/list_published'\n                },{\n                    title   : _l('Visualizations'),\n                    url     : 'visualizations/list_published'\n                },{\n                    title   : _l('Pages'),\n                    url     : 'pages/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : _l('Visualization'),\n            url             : 'visualization/list',\n            tooltip         : _l('Visualize datasets'),\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : _l('New Track Browser'),\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : _l('Saved Visualizations'),\n                    url     : 'visualization/list',\n                    target  : '_frame'\n                },{\n                    title   : _l('Interactive Environments'),\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: 'api/webhooks/masthead/all',\n            callback: function(webhooks) {\n                $(document).ready(function() {\n                    $.each(webhooks.models, function(index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id      : webhook.name,\n                                icon    : webhook.config.icon,\n                                url     : webhook.config.url,\n                                tooltip : webhook.config.tooltip,\n                                onclick : webhook.config.function && new Function(webhook.config.function),\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if( Galaxy.page ) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            }\n                            else if( Galaxy.masthead ) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n                            \n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle( webhook );\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : _l('Admin'),\n            url             : 'admin',\n            tooltip         : _l('Administer this Galaxy'),\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : _l('Help'),\n            tooltip         : _l('Support, contact, and community'),\n            menu            : [{\n                    title   : _l('Support'),\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Search'),\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Mailing Lists'),\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : _l('Videos'),\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Wiki'),\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('How to Cite Galaxy'),\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Interactive Tours'),\n                    url     : 'tours',\n                    onclick : function(){\n                        if (Galaxy.router){\n                            Galaxy.router.navigate('tours', {'trigger': true});\n                        } else {\n                            // Redirect and use clientside routing to go to tour index\n                            window.location = Galaxy.root + \"tours\";\n                        }\n                    }\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : _l('Terms and Conditions'),\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Ask a question'),\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Galaxy Biostar'),\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if ( !Galaxy.user.id ){\n            if ( options.allow_user_creation ) {\n                userTab = {\n                    id              : 'user',\n                    title           : _l('Login or Register'),\n                    cls             : 'loggedout-only',\n                    tooltip         : _l('Account registration or login'),\n                    menu            : [{\n                            title           : _l('Login'),\n                            url             : 'user/login',\n                            target          : 'galaxy_main',\n                            noscratchbook   : true\n                        }, {\n                            title: _l('Register'),\n                            url: 'user/create',\n                            target: 'galaxy_main',\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: 'user',\n                    title: _l('Login'),\n                    cls: 'loggedout-only',\n                    tooltip: _l('Login'),\n                    url: 'user/login',\n                    target: 'galaxy_main',\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedin-only',\n                tooltip         : _l('Account and saved data'),\n                menu            : [{\n                        title   : _l('Logged in as') + ' ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : _l('Preferences'),\n                        url     : 'user',\n                        target  : 'galaxy_main',\n                        onclick : function() {\n                            if ( Galaxy.router ) {\n                                Galaxy.router.push( 'user' );\n                            } else {\n                                window.location = Galaxy.root + 'user';\n                            }\n                        }\n                    },{\n                        title   : _l('Custom Builds'),\n                        url     : 'custom_builds',\n                        target  : 'galaxy_main',\n                        onclick : function() {\n                            if ( Galaxy.router ) {\n                                Galaxy.router.push( 'custom_builds' );\n                            } else {\n                                window.location = Galaxy.root + 'custom_builds';\n                            }\n                        }\n                    },{\n                        title   : _l('Logout'),\n                        url     : 'user/logout',\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : _l('Saved Histories'),\n                        url     : 'histories/list',\n                        target  : '_top'\n                    },{\n                        title   : _l('Saved Datasets'),\n                        url     : 'datasets/list',\n                        target  : '_top'\n                    },{\n                        title   : _l('Saved Pages'),\n                        url     : 'pages/list',\n                        target  : '_top'\n                    }]\n            };\n        }\n        this.add( userTab );\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } );\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title           : '',\n            url             : '',\n            target          : '_parent',\n            noscratchbook   : false\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html();\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n"]}