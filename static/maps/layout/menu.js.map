{"version":3,"sources":["layout/menu.js"],"names":["define","GenericNav","Webhooks","_l","Collection","Backbone","extend","model","Model","defaults","visible","target","fetch","options","this","reset","extendedNavItem","GenericNavView","add","render","id","title","url","tooltip","disabled","Galaxy","user","menu","user_requests","lims_doc_url","callback","webhooks","$","document","ready","each","models","index","webhook","toJSON","activate","page","masthead","collection","name","icon","config","onclick","function","Function","get","cls","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","router","navigate","trigger","window","location","root","terms_url","push","biostar_url","unshift","biostar_url_redirect","userTab","divider","noscratchbook","allow_user_creation","activeView","active_view","set","jQuery","Deferred","resolve","promise","Tab","View","initialize","setElement","_template","$dropdown","$toggle","$menu","$note","listenTo","events","click .dropdown-toggle","self","remove","$el","attr","css","visibility","_formatUrl","html","removeClass","addClass","display","placement","show","off","on","hide","empty","_","menuItem","append","_buildMenuItem","e","preventDefault","frame","_toggleClick","buildLink","label","m","popover","content","setTimeout","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(['layout/generic-nav-view', 'mvc/webhooks', 'utils/localization'], function( GenericNav, Webhooks, _l ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : _l('Analyze Data'),\n            url             : '',\n            tooltip         : 'Analysis home view'\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : _l('Workflow'),\n            url             : 'workflow',\n            tooltip         : 'Chain tools into workflows',\n            disabled        : !Galaxy.user.id\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : _l('Shared Data'),\n            url             : 'library/index',\n            tooltip         : 'Access published resources',\n            menu            : [{\n                    title   : _l('Data Libraries'),\n                    url     : 'library/list'\n                },{\n                    title   : _l('Histories'),\n                    url     : 'history/list_published'\n                },{\n                    title   : _l('Workflows'),\n                    url     : 'workflow/list_published'\n                },{\n                    title   : _l('Visualizations'),\n                    url     : 'visualization/list_published'\n                },{\n                    title   : _l('Pages'),\n                    url     : 'page/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : _l('Visualization'),\n            url             : 'visualization/list',\n            tooltip         : 'Visualize datasets',\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : _l('New Track Browser'),\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : _l('Saved Visualizations'),\n                    url     : 'visualization/list',\n                    target  : '_frame'\n                },{\n                    title   : _l('Interactive Environments'),\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: 'api/webhooks/masthead/all',\n            callback: function(webhooks) {\n                $(document).ready(function() {\n                    $.each(webhooks.models, function(index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if( Galaxy.page ) {\n                                Galaxy.page.masthead.collection.add({\n                                    id      : webhook.name,\n                                    icon    : webhook.config.icon,\n                                    url     : webhook.config.url,\n                                    tooltip : webhook.config.tooltip,\n                                    onclick : webhook.config.function && new Function(webhook.config.function),\n                                });\n                            }\n                            else if( Galaxy.masthead ) {\n                                Galaxy.masthead.collection.add({\n                                    id      : webhook.name,\n                                    icon    : webhook.config.icon,\n                                    url     : webhook.config.url,\n                                    tooltip : webhook.config.tooltip,\n                                    onclick : webhook.config.function && new Function(webhook.config.function),\n                                });\n                            }\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : _l('Admin'),\n            url             : 'admin',\n            tooltip         : 'Administer this Galaxy',\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : _l('Help'),\n            tooltip         : 'Support, contact, and community',\n            menu            : [{\n                    title   : _l('Support'),\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Search'),\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Mailing Lists'),\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : _l('Videos'),\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Wiki'),\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('How to Cite Galaxy'),\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Interactive Tours'),\n                    url     : 'tours',\n                    onclick : function(){\n                        if (Galaxy.router){\n                            Galaxy.router.navigate('tours', {'trigger': true});\n                        } else {\n                            // Redirect and use clientside routing to go to tour index\n                            window.location = Galaxy.root + \"tours\";\n                        }\n                    }\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : _l('Terms and Conditions'),\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Ask a question'),\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Galaxy Biostar'),\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        if ( !Galaxy.user.id ){\n            var userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedout-only',\n                tooltip         : 'Account registration or login',\n                menu            : [{\n                    title           : _l('Login'),\n                    url             : 'user/login',\n                    target          : 'galaxy_main',\n                    noscratchbook   : true\n                }]\n            };\n            options.allow_user_creation && userTab.menu.push({\n                title           : _l('Register'),\n                url             : 'user/create',\n                target          : 'galaxy_main',\n                noscratchbook   : true\n            });\n            this.add( userTab );\n        } else {\n            var userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedin-only',\n                tooltip         : 'Account and saved data',\n                menu            : [{\n                        title   : _l('Logged in as') + ' ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : _l('Preferences'),\n                        url     : 'user',\n                        target  : 'galaxy_main',\n                        onclick : function() {\n                            if ( Galaxy.router ) {\n                                Galaxy.router.push( 'user' );\n                            } else {\n                                window.location = Galaxy.root + 'user';\n                            }\n                        }\n                    },{\n                        title   : _l('Custom Builds'),\n                        url     : 'user/dbkeys',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Logout'),\n                        url     : 'user/logout',\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : _l('Saved Histories'),\n                        url     : 'history/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Saved Datasets'),\n                        url     : 'dataset/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Saved Pages'),\n                        url     : 'page/list',\n                        target  : '_top'\n                    }]\n            };\n            this.add( userTab );\n        }\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } )\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title           : '',\n            url             : '',\n            target          : '_parent',\n            noscratchbook   : false\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html()\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n"]}