{"version":3,"sources":["layout/menu.js"],"names":["define","model","visible","_l","Utils","Collection","target","extend","Backbone","Model","defaults","self","fetch","options","this","reset","extendedNavItem","GenericNav","GenericNavView","add","render","tooltip","id","title","url","disabled","Galaxy","user","menu","lims_doc_url","$","webhooks","webhook","icon","callback","document","ready","appendScriptStyle","toJSON","activate","obj","name","config","onclick","function","Function","page","masthead","collection","cls","terms_url","helpTab","biostar_url","screencasts_url","userTab","wiki_url","citation_url","noscratchbook","biostar_url_redirect","View","setElement","$dropdown","get","remove","session_csrf_token","html","show","hide","removeClass","allow_user_creation","divider","activeView","jQuery","$toggle","active_view","set","Deferred","resolve","promise","Tab","_","_template","_formatUrl","$note","append","e","preventDefault","click .dropdown-toggle","$el","attr","css","_toggleClick","trigger","m","addClass","popover","placement","content","buildLink","setTimeout","indexOf","$menu","off","on","empty","each","menuItem","_buildMenuItem","frame","label","root","attributes","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(\n    [\n        \"layout/generic-nav-view\",\n        \"mvc/webhooks\",\n        \"utils/localization\",\n        \"utils/utils\"\n    ],\n    function(GenericNav, Webhooks, _l, Utils) {\n        var Collection = Backbone.Collection.extend({\n            model: Backbone.Model.extend({\n                defaults: {\n                    visible: true,\n                    target: \"_parent\"\n                }\n            }),\n            fetch: function(options) {\n                var self = this;\n                options = options || {};\n                this.reset();\n\n                //\n                // Chat server tab\n                //\n                var extendedNavItem = new GenericNav.GenericNavView();\n                this.add(extendedNavItem.render());\n\n                //\n                // Analyze data tab.\n                //\n                this.add({\n                    id: \"analysis\",\n                    title: _l(\"Analyze Data\"),\n                    url: \"\",\n                    tooltip: _l(\"Analysis home view\")\n                });\n\n                //\n                // Workflow tab.\n                //\n                this.add({\n                    id: \"workflow\",\n                    title: _l(\"Workflow\"),\n                    tooltip: _l(\"Chain tools into workflows\"),\n                    disabled: !Galaxy.user.id,\n                    url: \"workflow\"\n                });\n\n                //\n                // 'Shared Items' or Libraries tab.\n                //\n                this.add({\n                    id: \"shared\",\n                    title: _l(\"Shared Data\"),\n                    url: \"library/index\",\n                    tooltip: _l(\"Access published resources\"),\n                    menu: [\n                        {\n                            title: _l(\"Data Libraries\"),\n                            url: \"library/list\"\n                        },\n                        {\n                            title: _l(\"Histories\"),\n                            url: \"histories/list_published\"\n                        },\n                        {\n                            title: _l(\"Workflows\"),\n                            url: \"workflows/list_published\"\n                        },\n                        {\n                            title: _l(\"Visualizations\"),\n                            url: \"visualizations/list_published\"\n                        },\n                        {\n                            title: _l(\"Pages\"),\n                            url: \"pages/list_published\"\n                        }\n                    ]\n                });\n\n                //\n                // Lab menu.\n                //\n                options.user_requests &&\n                    this.add({\n                        id: \"lab\",\n                        title: \"Lab\",\n                        menu: [\n                            {\n                                title: \"Sequencing Requests\",\n                                url: \"requests/index\"\n                            },\n                            {\n                                title: \"Find Samples\",\n                                url: \"requests/find_samples_index\"\n                            },\n                            {\n                                title: \"Help\",\n                                url: options.lims_doc_url\n                            }\n                        ]\n                    });\n\n                //\n                // Visualization tab.\n                //\n                this.add({\n                    id: \"visualization\",\n                    title: _l(\"Visualization\"),\n                    url: \"visualizations/list\",\n                    tooltip: _l(\"Visualize datasets\"),\n                    disabled: !Galaxy.user.id,\n                    menu: [\n                        {\n                            title: _l(\"New Track Browser\"),\n                            url: \"visualization/trackster\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Saved Visualizations\"),\n                            url: \"visualizations/list\",\n                            target: \"_frame\"\n                        },\n                        {\n                            title: _l(\"Interactive Environments\"),\n                            url: \"visualization/gie_list\",\n                            target: \"galaxy_main\"\n                        }\n                    ]\n                });\n\n                //\n                // Webhooks\n                //\n                Webhooks.add({\n                    url: \"api/webhooks/masthead/all\",\n                    callback: function(webhooks) {\n                        $(document).ready(function() {\n                            $.each(webhooks.models, function(index, model) {\n                                var webhook = model.toJSON();\n                                if (webhook.activate) {\n                                    var obj = {\n                                        id: webhook.name,\n                                        icon: webhook.config.icon,\n                                        url: webhook.config.url,\n                                        tooltip: webhook.config.tooltip,\n                                        onclick:\n                                            webhook.config.function &&\n                                            new Function(\n                                                webhook.config.function\n                                            )\n                                    };\n\n                                    // Galaxy.page is undefined for data libraries, workflows pages\n                                    if (Galaxy.page) {\n                                        Galaxy.page.masthead.collection.add(\n                                            obj\n                                        );\n                                    } else if (Galaxy.masthead) {\n                                        Galaxy.masthead.collection.add(obj);\n                                    }\n\n                                    // Append masthead script and styles to Galaxy main\n                                    Utils.appendScriptStyle(webhook);\n                                }\n                            });\n                        });\n                    }\n                });\n\n                //\n                // Admin.\n                //\n                Galaxy.user.get(\"is_admin\") &&\n                    this.add({\n                        id: \"admin\",\n                        title: _l(\"Admin\"),\n                        url: \"admin\",\n                        tooltip: _l(\"Administer this Galaxy\"),\n                        cls: \"admin-only\"\n                    });\n\n                //\n                // Help tab.\n                //\n                var helpTab = {\n                    id: \"help\",\n                    title: _l(\"Help\"),\n                    tooltip: _l(\"Support, contact, and community\"),\n                    menu: [\n                        {\n                            title: _l(\"Support\"),\n                            url: options.support_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Search\"),\n                            url: options.search_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Mailing Lists\"),\n                            url: options.mailing_lists,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Videos\"),\n                            url: options.screencasts_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Wiki\"),\n                            url: options.wiki_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"How to Cite Galaxy\"),\n                            url: options.citation_url,\n                            target: \"_blank\"\n                        },\n                        {\n                            title: _l(\"Interactive Tours\"),\n                            url: \"tours\"\n                        }\n                    ]\n                };\n                options.terms_url &&\n                    helpTab.menu.push({\n                        title: _l(\"Terms and Conditions\"),\n                        url: options.terms_url,\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Ask a question\"),\n                        url: \"biostar/biostar_question_redirect\",\n                        target: \"_blank\"\n                    });\n                options.biostar_url &&\n                    helpTab.menu.unshift({\n                        title: _l(\"Galaxy Biostar\"),\n                        url: options.biostar_url_redirect,\n                        target: \"_blank\"\n                    });\n                this.add(helpTab);\n\n                //\n                // User tab.\n                //\n                var userTab = {};\n                if (!Galaxy.user.id) {\n                    if (options.allow_user_creation) {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login or Register\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Account registration or login\"),\n                            menu: [\n                                {\n                                    title: _l(\"Login\"),\n                                    url: \"user/login\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                },\n                                {\n                                    title: _l(\"Register\"),\n                                    url: \"user/create\",\n                                    target: \"galaxy_main\",\n                                    noscratchbook: true\n                                }\n                            ]\n                        };\n                    } else {\n                        userTab = {\n                            id: \"user\",\n                            title: _l(\"Login\"),\n                            cls: \"loggedout-only\",\n                            tooltip: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        };\n                    }\n                } else {\n                    userTab = {\n                        id: \"user\",\n                        title: _l(\"User\"),\n                        cls: \"loggedin-only\",\n                        tooltip: _l(\"Account and saved data\"),\n                        menu: [\n                            {\n                                title:\n                                    _l(\"Logged in as\") +\n                                    \" \" +\n                                    Galaxy.user.get(\"email\")\n                            },\n                            {\n                                title: _l(\"Preferences\"),\n                                url: \"user\"\n                            },\n                            {\n                                title: _l(\"Custom Builds\"),\n                                url: \"custom_builds\"\n                            },\n                            {\n                                title: _l(\"Logout\"),\n                                url:\n                                    \"user/logout?session_csrf_token=\" +\n                                    Galaxy.session_csrf_token,\n                                target: \"_top\",\n                                divider: true\n                            },\n                            {\n                                title: _l(\"Saved Histories\"),\n                                url: \"histories/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Datasets\"),\n                                url: \"datasets/list\",\n                                target: \"_top\"\n                            },\n                            {\n                                title: _l(\"Saved Pages\"),\n                                url: \"pages/list\",\n                                target: \"_top\"\n                            }\n                        ]\n                    };\n                }\n                this.add(userTab);\n                var activeView = this.get(options.active_view);\n                activeView && activeView.set(\"active\", true);\n                return new jQuery.Deferred().resolve().promise();\n            }\n        });\n\n        /** Masthead tab **/\n        var Tab = Backbone.View.extend({\n            initialize: function(options) {\n                this.model = options.model;\n                this.setElement(this._template());\n                this.$dropdown = this.$(\".dropdown\");\n                this.$toggle = this.$(\".dropdown-toggle\");\n                this.$menu = this.$(\".dropdown-menu\");\n                this.$note = this.$(\".dropdown-note\");\n                this.listenTo(this.model, \"change\", this.render, this);\n            },\n\n            events: {\n                \"click .dropdown-toggle\": \"_toggleClick\"\n            },\n\n            render: function() {\n                var self = this;\n                $(\".tooltip\").remove();\n                this.$el.attr(\"id\", this.model.id).css({\n                    visibility:\n                        (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n                });\n                this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n                this.$note\n                    .html(this.model.get(\"note\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-note\")\n                    .addClass(this.model.get(\"note_cls\"))\n                    .css({\n                        display:\n                            (this.model.get(\"show_note\") && \"block\") || \"none\"\n                    });\n                this.$toggle\n                    .html(this.model.get(\"title\") || \"\")\n                    .removeClass()\n                    .addClass(\"dropdown-toggle\")\n                    .addClass(this.model.get(\"cls\"))\n                    .addClass(\n                        this.model.get(\"icon\") &&\n                            \"dropdown-icon fa \" + this.model.get(\"icon\")\n                    )\n                    .addClass(this.model.get(\"toggle\") && \"toggle\")\n                    .attr(\"target\", this.model.get(\"target\"))\n                    .attr(\"href\", this.model.get(\"url\"))\n                    .attr(\"title\", this.model.get(\"tooltip\"))\n                    .tooltip(\"destroy\");\n                this.model.get(\"tooltip\") &&\n                    this.$toggle.tooltip({ placement: \"bottom\" });\n                this.$dropdown\n                    .removeClass()\n                    .addClass(\"dropdown\")\n                    .addClass(this.model.get(\"disabled\") && \"disabled\")\n                    .addClass(this.model.get(\"active\") && \"active\");\n                if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n                    this.$menu.show();\n                    $(\"#dd-helper\")\n                        .show()\n                        .off()\n                        .on(\"click\", function() {\n                            $(\"#dd-helper\").hide();\n                            self.model.set(\"show_menu\", false);\n                        });\n                } else {\n                    self.$menu.hide();\n                    $(\"#dd-helper\").hide();\n                }\n                this.$menu.empty().removeClass(\"dropdown-menu\");\n                if (this.model.get(\"menu\")) {\n                    _.each(this.model.get(\"menu\"), function(menuItem) {\n                        self.$menu.append(self._buildMenuItem(menuItem));\n                        menuItem.divider &&\n                            self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n                    });\n                    self.$menu.addClass(\"dropdown-menu\");\n                    self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n                }\n                return this;\n            },\n\n            /** Add new menu item */\n            _buildMenuItem: function(options) {\n                var self = this;\n                options = _.defaults(options || {}, {\n                    title: \"\",\n                    url: \"\",\n                    target: \"_parent\",\n                    noscratchbook: false\n                });\n                options.url = self._formatUrl(options.url);\n                return $(\"<li/>\").append(\n                    $(\"<a/>\")\n                        .attr(\"href\", options.url)\n                        .attr(\"target\", options.target)\n                        .html(options.title)\n                        .on(\"click\", function(e) {\n                            e.preventDefault();\n                            self.model.set(\"show_menu\", false);\n                            if (options.onclick) {\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add(options);\n                            }\n                        })\n                );\n            },\n\n            /** Handle click event */\n            _toggleClick: function(e) {\n                var self = this;\n                var model = this.model;\n                e.preventDefault();\n                $(\".tooltip\").hide();\n                model.trigger(\"dispatch\", function(m) {\n                    model.id !== m.id &&\n                        m.get(\"menu\") &&\n                        m.set(\"show_menu\", false);\n                });\n                if (!model.get(\"disabled\")) {\n                    if (!model.get(\"menu\")) {\n                        model.get(\"onclick\")\n                            ? model.get(\"onclick\")()\n                            : Galaxy.frame.add(model.attributes);\n                    } else {\n                        model.set(\"show_menu\", true);\n                    }\n                } else {\n                    function buildLink(label, url) {\n                        return $(\"<div/>\")\n                            .append(\n                                $(\"<a/>\")\n                                    .attr(\"href\", Galaxy.root + url)\n                                    .html(label)\n                            )\n                            .html();\n                    }\n                    this.$toggle.popover && this.$toggle.popover(\"destroy\");\n                    this.$toggle\n                        .popover({\n                            html: true,\n                            placement: \"bottom\",\n                            content:\n                                \"Please \" +\n                                buildLink(\n                                    \"login\",\n                                    \"user/login?use_panels=True\"\n                                ) +\n                                \" or \" +\n                                buildLink(\n                                    \"register\",\n                                    \"user/create?use_panels=True\"\n                                ) +\n                                \" to use this feature.\"\n                        })\n                        .popover(\"show\");\n                    setTimeout(function() {\n                        self.$toggle.popover(\"destroy\");\n                    }, 5000);\n                }\n            },\n\n            /** Url formatting */\n            _formatUrl: function(url) {\n                return typeof url == \"string\" &&\n                    url.indexOf(\"//\") === -1 &&\n                    url.charAt(0) != \"/\"\n                    ? Galaxy.root + url\n                    : url;\n            },\n\n            /** body tempate */\n            _template: function() {\n                return (\n                    '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                    '<a class=\"dropdown-toggle\"/>' +\n                    '<ul class=\"dropdown-menu\"/>' +\n                    '<div class=\"dropdown-note\"/>' +\n                    \"</li>\" +\n                    \"</ul>\"\n                );\n            }\n        });\n\n        return {\n            Collection: Collection,\n            Tab: Tab\n        };\n    }\n);\n"]}