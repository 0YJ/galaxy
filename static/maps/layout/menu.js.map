{"version":3,"sources":["layout/menu.js"],"names":["define","GenericNav","Webhooks","_l","Collection","Backbone","extend","Model","model","defaults","fetch","options","extendedNavItem","GenericNavView","this","add","render","id","title","url","Galaxy","user","tooltip","menu","user_requests","lims_doc_url","disabled","target","webhooks","callback","ready","$","document","index","each","models","webhook","page","collection","masthead","name","icon","config","Function","function","onclick","get","cls","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","router","navigate","trigger","window","location","root","terms_url","biostar_url_redirect","userTab","push","divider","noscratchbook","activeView","set","jQuery","Deferred","resolve","Tab","View","initialize","setElement","_template","$dropdown","$toggle","$menu","$note","listenTo","events","click .dropdown-toggle","self","e","remove","$el","attr","_formatUrl","html","removeClass","addClass","css","display","show","on","hide","empty","placement","append","_buildMenuItem","menuItem","off","_","preventDefault","m","frame","_toggleClick","content","popover","setTimeout","buildLink","label","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(['layout/generic-nav-view', 'mvc/webhooks', 'utils/localization'], function( GenericNav, Webhooks, _l ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : _l('Analyze Data'),\n            url             : '',\n            tooltip         : 'Analysis home view'\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : _l('Workflow'),\n            url             : 'workflow',\n            tooltip         : 'Chain tools into workflows',\n            disabled        : !Galaxy.user.id\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : _l('Shared Data'),\n            url             : 'library/index',\n            tooltip         : 'Access published resources',\n            menu            : [{\n                    title   : _l('Data Libraries'),\n                    url     : 'library/list'\n                },{\n                    title   : _l('Histories'),\n                    url     : 'history/list_published'\n                },{\n                    title   : _l('Workflows'),\n                    url     : 'workflow/list_published'\n                },{\n                    title   : _l('Visualizations'),\n                    url     : 'visualization/list_published'\n                },{\n                    title   : _l('Pages'),\n                    url     : 'page/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : _l('Visualization'),\n            url             : 'visualization/list',\n            tooltip         : 'Visualize datasets',\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : _l('New Track Browser'),\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : _l('Saved Visualizations'),\n                    url     : 'visualization/list',\n                    target  : '_frame'\n                },{\n                    title   : _l('Interactive Environments'),\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: 'api/webhooks/masthead/all',\n            callback: function(webhooks) {\n                $(document).ready(function() {\n                    $.each(webhooks.models, function(index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if( Galaxy.page ) {\n                                Galaxy.page.masthead.collection.add({\n                                    id      : webhook.name,\n                                    icon    : webhook.config.icon,\n                                    url     : webhook.config.url,\n                                    tooltip : webhook.config.tooltip,\n                                    onclick : webhook.config.function && new Function(webhook.config.function),\n                                });\n                            }\n                            else if( Galaxy.masthead ) {\n                                Galaxy.masthead.collection.add({\n                                    id      : webhook.name,\n                                    icon    : webhook.config.icon,\n                                    url     : webhook.config.url,\n                                    tooltip : webhook.config.tooltip,\n                                    onclick : webhook.config.function && new Function(webhook.config.function),\n                                });\n                            }\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : _l('Admin'),\n            url             : 'admin',\n            tooltip         : 'Administer this Galaxy',\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : _l('Help'),\n            tooltip         : 'Support, contact, and community',\n            menu            : [{\n                    title   : _l('Support'),\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Search'),\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Mailing Lists'),\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : _l('Videos'),\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Wiki'),\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('How to Cite Galaxy'),\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Interactive Tours'),\n                    url     : 'tours',\n                    onclick : function(){\n                        if (Galaxy.router){\n                            Galaxy.router.navigate('tours', {'trigger': true});\n                        } else {\n                            // Redirect and use clientside routing to go to tour index\n                            window.location = Galaxy.root + \"tours\";\n                        }\n                    }\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : _l('Terms and Conditions'),\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Ask a question'),\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Galaxy Biostar'),\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        if ( !Galaxy.user.id ){\n            var userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedout-only',\n                tooltip         : 'Account registration or login',\n                menu            : [{\n                    title           : _l('Login'),\n                    url             : 'user/login',\n                    target          : 'galaxy_main',\n                    noscratchbook   : true\n                }]\n            };\n            options.allow_user_creation && userTab.menu.push({\n                title           : _l('Register'),\n                url             : 'user/create',\n                target          : 'galaxy_main',\n                noscratchbook   : true\n            });\n            this.add( userTab );\n        } else {\n            var userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedin-only',\n                tooltip         : 'Account and saved data',\n                menu            : [{\n                        title   : _l('Logged in as') + ' ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : _l('Preferences'),\n                        url     : 'user',\n                        target  : 'galaxy_main',\n                        onclick : function() {\n                            if ( Galaxy.router ) {\n                                Galaxy.router.push( 'user' );\n                            } else {\n                                window.location = Galaxy.root + 'user';\n                            }\n                        }\n                    },{\n                        title   : _l('Custom Builds'),\n                        url     : 'user/dbkeys',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Logout'),\n                        url     : 'user/logout',\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : _l('Saved Histories'),\n                        url     : 'history/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Saved Datasets'),\n                        url     : 'dataset/list',\n                        target  : 'galaxy_main'\n                    },{\n                        title   : _l('Saved Pages'),\n                        url     : 'page/list',\n                        target  : '_top'\n                    }]\n            };\n            this.add( userTab );\n        }\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } )\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title           : '',\n            url             : '',\n            target          : '_parent',\n            noscratchbook   : false\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html()\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n"]}