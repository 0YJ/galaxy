{"version":3,"sources":["layout/menu.js"],"names":["define","GenericNav","Webhooks","_l","Utils","Collection","Backbone","extend","Model","model","defaults","fetch","options","this","reset","extendedNavItem","GenericNavView","add","render","id","title","Galaxy","user","tooltip","url","menu","user_requests","lims_doc_url","disabled","target","webhooks","callback","ready","$","document","index","each","models","webhook","name","icon","config","Function","function","page","collection","obj","masthead","appendScriptStyle","get","cls","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","biostar_url_redirect","userTab","session_csrf_token","divider","noscratchbook","activeView","active_view","Deferred","jQuery","resolve","promise","Tab","initialize","setElement","$dropdown","_template","$toggle","$menu","$note","listenTo","events","click .dropdown-toggle","self","attr","$el","set","_formatUrl","html","removeClass","addClass","css","display","show","hide","placement","_","append","_buildMenuItem","menuItem","on","frame","e","_toggleClick","preventDefault","trigger","m","onclick","content","popover","setTimeout","buildLink","label","root","attributes","indexOf","charAt"],"mappings":"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","file":"../../scripts/layout/menu.js","sourcesContent":["/** Masthead Collection **/\ndefine(['layout/generic-nav-view', 'mvc/webhooks', 'utils/localization', 'utils/utils'], function( GenericNav, Webhooks, _l, Utils ) {\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible         : true,\n            target          : '_parent'\n        }\n    }),\n    fetch: function( options ){\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id              : 'analysis',\n            title           : _l('Analyze Data'),\n            url             : '',\n            tooltip         : _l('Analysis home view')\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id              : 'workflow',\n            title           : _l('Workflow'),\n            tooltip         : _l('Chain tools into workflows'),\n            disabled        : !Galaxy.user.id,\n            url             : 'workflow'\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id              : 'shared',\n            title           : _l('Shared Data'),\n            url             : 'library/index',\n            tooltip         : _l('Access published resources'),\n            menu            : [{\n                    title   : _l('Data Libraries'),\n                    url     : 'library/list'\n                },{\n                    title   : _l('Histories'),\n                    url     : 'histories/list_published'\n                },{\n                    title   : _l('Workflows'),\n                    url     : 'workflows/list_published'\n                },{\n                    title   : _l('Visualizations'),\n                    url     : 'visualizations/list_published'\n                },{\n                    title   : _l('Pages'),\n                    url     : 'pages/list_published'\n            }]\n        });\n\n        //\n        // Lab menu.\n        //\n        options.user_requests && this.add({\n            id              : 'lab',\n            title           : 'Lab',\n            menu            : [{\n                    title   : 'Sequencing Requests',\n                    url     : 'requests/index'\n                },{\n                    title   : 'Find Samples',\n                    url     : 'requests/find_samples_index'\n                },{\n                    title   : 'Help',\n                    url     : options.lims_doc_url\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id              : 'visualization',\n            title           : _l('Visualization'),\n            url             : 'visualizations/list',\n            tooltip         : _l('Visualize datasets'),\n            disabled        : !Galaxy.user.id,\n            menu            : [{\n                    title   : _l('New Track Browser'),\n                    url     : 'visualization/trackster',\n                    target  : '_frame'\n                },{\n                    title   : _l('Saved Visualizations'),\n                    url     : 'visualizations/list',\n                    target  : '_frame'\n                },{\n                    title   : _l('Interactive Environments'),\n                    url     : 'visualization/gie_list',\n                    target  : 'galaxy_main'\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: 'api/webhooks/masthead/all',\n            callback: function(webhooks) {\n                $(document).ready(function() {\n                    $.each(webhooks.models, function(index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id      : webhook.name,\n                                icon    : webhook.config.icon,\n                                url     : webhook.config.url,\n                                tooltip : webhook.config.tooltip,\n                                onclick : webhook.config.function && new Function(webhook.config.function),\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if( Galaxy.page ) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            }\n                            else if( Galaxy.masthead ) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n                            \n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle( webhook );\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get( 'is_admin' ) && this.add({\n            id              : 'admin',\n            title           : _l('Admin'),\n            url             : 'admin',\n            tooltip         : _l('Administer this Galaxy'),\n            cls             : 'admin-only'\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id              : 'help',\n            title           : _l('Help'),\n            tooltip         : _l('Support, contact, and community'),\n            menu            : [{\n                    title   : _l('Support'),\n                    url     : options.support_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Search'),\n                    url     : options.search_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Mailing Lists'),\n                    url     : options.mailing_lists,\n                    target  : '_blank'\n                },{\n                    title   : _l('Videos'),\n                    url     : options.screencasts_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Wiki'),\n                    url     : options.wiki_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('How to Cite Galaxy'),\n                    url     : options.citation_url,\n                    target  : '_blank'\n                },{\n                    title   : _l('Interactive Tours'),\n                    url     : 'tours'\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title   : _l('Terms and Conditions'),\n            url     : options.terms_url,\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Ask a question'),\n            url     : 'biostar/biostar_question_redirect',\n            target  : '_blank'\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title   : _l('Galaxy Biostar'),\n            url     : options.biostar_url_redirect,\n            target  : '_blank'\n        });\n        this.add( helpTab );\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if ( !Galaxy.user.id ){\n            if ( options.allow_user_creation ) {\n                userTab = {\n                    id              : 'user',\n                    title           : _l('Login or Register'),\n                    cls             : 'loggedout-only',\n                    tooltip         : _l('Account registration or login'),\n                    menu            : [{\n                            title           : _l('Login'),\n                            url             : 'user/login',\n                            target          : 'galaxy_main',\n                            noscratchbook   : true\n                        }, {\n                            title: _l('Register'),\n                            url: 'user/create',\n                            target: 'galaxy_main',\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: 'user',\n                    title: _l('Login'),\n                    cls: 'loggedout-only',\n                    tooltip: _l('Login'),\n                    url: 'user/login',\n                    target: 'galaxy_main',\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id              : 'user',\n                title           : _l('User'),\n                cls             : 'loggedin-only',\n                tooltip         : _l('Account and saved data'),\n                menu            : [{\n                        title   : _l('Logged in as') + ' ' + Galaxy.user.get( 'email' )\n                    },{\n                        title   : _l('Preferences'),\n                        url     : 'user'\n                    },{\n                        title   : _l('Custom Builds'),\n                        url     : 'custom_builds'\n                    },{\n                        title   : _l('Logout'),\n                        url     : 'user/logout?session_csrf_token=' + Galaxy.session_csrf_token,\n                        target  : '_top',\n                        divider : true\n                    },{\n                        title   : _l('Saved Histories'),\n                        url     : 'histories/list',\n                        target  : '_top'\n                    },{\n                        title   : _l('Saved Datasets'),\n                        url     : 'datasets/list',\n                        target  : '_top'\n                    },{\n                        title   : _l('Saved Pages'),\n                        url     : 'pages/list',\n                        target  : '_top'\n                    }]\n            };\n        }\n        this.add( userTab );\n        var activeView = this.get( options.active_view );\n        activeView && activeView.set( 'active', true );\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function ( options ) {\n        this.model = options.model;\n        this.setElement( this._template() );\n        this.$dropdown  = this.$( '.dropdown' );\n        this.$toggle    = this.$( '.dropdown-toggle' );\n        this.$menu      = this.$( '.dropdown-menu' );\n        this.$note      = this.$( '.dropdown-note' );\n        this.listenTo( this.model, 'change', this.render, this );\n    },\n\n    events: {\n        'click .dropdown-toggle' : '_toggleClick'\n    },\n\n    render: function() {\n        var self = this;\n        $( '.tooltip' ).remove();\n        this.$el.attr( 'id', this.model.id )\n                .css( { visibility : this.model.get( 'visible' ) && 'visible' || 'hidden' } );\n        this.model.set( 'url', this._formatUrl( this.model.get( 'url' ) ) );\n        this.$note.html( this.model.get( 'note' ) || '' )\n                  .removeClass().addClass( 'dropdown-note' )\n                  .addClass( this.model.get( 'note_cls' ) )\n                  .css( { 'display' : this.model.get( 'show_note' ) && 'block' || 'none' } );\n        this.$toggle.html( this.model.get( 'title' ) || '' )\n                    .removeClass().addClass( 'dropdown-toggle' )\n                    .addClass( this.model.get( 'cls' ) )\n                    .addClass( this.model.get( 'icon' ) && 'dropdown-icon fa ' + this.model.get( 'icon' ) )\n                    .addClass( this.model.get( 'toggle' ) && 'toggle' )\n                    .attr( 'target', this.model.get( 'target' ) )\n                    .attr( 'href', this.model.get( 'url' ) )\n                    .attr( 'title', this.model.get( 'tooltip' ) )\n                    .tooltip( 'destroy' );\n        this.model.get( 'tooltip' ) && this.$toggle.tooltip( { placement: 'bottom' } );\n        this.$dropdown.removeClass().addClass( 'dropdown' )\n                      .addClass( this.model.get( 'disabled' ) && 'disabled' )\n                      .addClass( this.model.get( 'active' ) && 'active' );\n        if ( this.model.get( 'menu' ) && this.model.get( 'show_menu' ) ) {\n            this.$menu.show();\n            $( '#dd-helper' ).show().off().on( 'click',  function() {\n                $( '#dd-helper' ).hide();\n                self.model.set( 'show_menu', false );\n            });\n        } else {\n            self.$menu.hide();\n            $( '#dd-helper' ).hide();\n        }\n        this.$menu.empty().removeClass( 'dropdown-menu' );\n        if ( this.model.get( 'menu' ) ) {\n            _.each( this.model.get( 'menu' ), function( menuItem ) {\n                self.$menu.append( self._buildMenuItem( menuItem ) );\n                menuItem.divider && self.$menu.append( $( '<li/>' ).addClass( 'divider' ) );\n            });\n            self.$menu.addClass( 'dropdown-menu' );\n            self.$toggle.append( $( '<b/>' ).addClass( 'caret' ) );\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function ( options ) {\n        var self = this;\n        options = _.defaults( options || {}, {\n            title           : '',\n            url             : '',\n            target          : '_parent',\n            noscratchbook   : false\n        });\n        options.url = self._formatUrl( options.url );\n        return $( '<li/>' ).append(\n            $( '<a/>' ).attr( 'href', options.url )\n                       .attr( 'target', options.target )\n                       .html( options.title )\n                       .on( 'click', function( e ) {\n                            e.preventDefault();\n                            self.model.set( 'show_menu', false );\n                            if (options.onclick){\n                                options.onclick();\n                            } else {\n                                Galaxy.frame.add( options );\n                            }\n                       })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function( e ) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $( '.tooltip' ).hide();\n        model.trigger( 'dispatch', function( m ) {\n            model.id !== m.id && m.get( 'menu' ) && m.set( 'show_menu', false );\n        });\n        if ( !model.get( 'disabled' ) ) {\n            if ( !model.get( 'menu' ) ) {\n                model.get( 'onclick' ) ? model.get( 'onclick' )() : Galaxy.frame.add( model.attributes );\n            } else {\n                model.set( 'show_menu', true );\n            }\n        } else {\n            function buildLink( label, url ) {\n                return $( '<div/>' ).append( $( '<a/>' ).attr( 'href', Galaxy.root + url ).html( label ) ).html();\n            }\n            this.$toggle.popover && this.$toggle.popover( 'destroy' );\n            this.$toggle.popover({\n                html        : true,\n                placement   : 'bottom',\n                content     : 'Please ' + buildLink( 'login', 'user/login?use_panels=True' ) + ' or ' +\n                                          buildLink( 'register', 'user/create?use_panels=True' ) + ' to use this feature.'\n            }).popover( 'show' );\n            setTimeout( function() { self.$toggle.popover( 'destroy' ) }, 5000 );\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function( url ) {\n        return typeof url == 'string' && url.indexOf( '//' ) === -1 && url.charAt( 0 ) != '/' ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function () {\n        return  '<ul class=\"nav navbar-nav\">' +\n                    '<li class=\"dropdown\">' +\n                        '<a class=\"dropdown-toggle\"/>' +\n                        '<ul class=\"dropdown-menu\"/>' +\n                        '<div class=\"dropdown-note\"/>' +\n                    '</li>' +\n                '</ul>';\n    }\n});\n\nreturn {\n    Collection  : Collection,\n    Tab         : Tab\n};\n\n});\n"]}