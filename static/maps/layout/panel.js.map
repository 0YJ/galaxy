{"version":3,"sources":["layout/panel.js"],"names":["define","jQuery","_","Backbone","BASE_MVC","$","MIN_PANEL_WIDTH","MAX_PANEL_WIDTH","SidePanel","View","extend","LoggableMixin","_logNamespace","initialize","attributes","this","log","title","hidden","savedSize","hiddenByTool","$center","$el","siblings","$toggleButton","render","html","template","id","_templateHeader","_templateBody","_templateFooter","join","data","escape","events","mousedown .unified-panel-footer > .drag","click .unified-panel-footer > .panel-collapse","_mousedownDragHandler","ev","move","e","delta","pageX","prevX","oldWidth","self","width","newWidth","draggingLeft","Math","min","max","resize","show","on","one","hide","off","newSize","css","animation","whichSide","animate","removeClass","addClass","toggle","handle_minwidth_hint","hint","force_panel","op","toString","LeftPanel","RightPanel","CenterPanel","options","prev","bind","_iframeChangeHandler","iframe","currentTarget","location","contentWindow","host","remove","Galaxy","trigger","fullpath","pathname","search","hash","display","view","message","onbeforeunload","confirm","undefined","attr","scrollTop","append"],"mappings":"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","file":"../../scripts/layout/panel.js","sourcesContent":["define([\n    'jquery',\n    'libs/underscore',\n    'libs/backbone',\n    'mvc/base-mvc',\n], function( jQuery, _, Backbone, BASE_MVC ){\n\n\"use strict\";\n// ============================================================================\nvar $ = jQuery;\n\nvar MIN_PANEL_WIDTH = 160,\n    MAX_PANEL_WIDTH = 800;\n\n// ----------------------------------------------------------------------------\n/**\n *\n */\nvar SidePanel = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    initialize: function( attributes ){\n        this.log( this + '.initialize:', attributes );\n        this.title = attributes.title || this.title || '';\n\n        this.hidden = false;\n        this.savedSize = null;\n        this.hiddenByTool = false;\n    },\n\n    $center : function(){\n        return this.$el.siblings( '#center' );\n    },\n\n    $toggleButton : function(){\n        return this.$( '.unified-panel-footer > .panel-collapse' );\n    },\n\n    render: function(){\n        this.log( this + '.render:' );\n        this.$el.html( this.template( this.id ) );\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    template: function(){\n        return [\n            this._templateHeader(),\n            this._templateBody(),\n            this._templateFooter(),\n        ].join('');\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateHeader: function( data ){\n        return [\n            '<div class=\"unified-panel-header\" unselectable=\"on\">',\n                '<div class=\"unified-panel-header-inner\">',\n                    '<div class=\"panel-header-buttons\" style=\"float: right\"/>',\n                    '<div class=\"panel-header-text\">', _.escape( this.title ), '</div>',\n                '</div>',\n            '</div>',\n        ].join('');\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateBody: function( data ){\n        return '<div class=\"unified-panel-body\"/>';\n    },\n\n    /** panel dom template. id is 'right' or 'left' */\n    _templateFooter: function( data ){\n        return [\n            '<div class=\"unified-panel-footer\">',\n                '<div class=\"panel-collapse ', _.escape( this.id ), '\"/>',\n                '<div class=\"drag\"/>',\n            '</div>',\n        ].join('');\n    },\n\n    // ..............................................................\n    events : {\n        'mousedown .unified-panel-footer > .drag'       : '_mousedownDragHandler',\n        'click .unified-panel-footer > .panel-collapse' : 'toggle'\n    },\n\n    _mousedownDragHandler : function( ev ){\n        var self = this,\n            draggingLeft = this.id === 'left',\n            prevX = ev.pageX;\n\n        function move( e ){\n            var delta = e.pageX - prevX;\n            prevX = e.pageX;\n\n            var oldWidth = self.$el.width(),\n                newWidth = draggingLeft?( oldWidth + delta ):( oldWidth - delta );\n            // Limit range\n            newWidth = Math.min( MAX_PANEL_WIDTH, Math.max( MIN_PANEL_WIDTH, newWidth ) );\n            self.resize( newWidth );\n        }\n\n        // this is a page wide overlay that assists in capturing the move and release of the mouse\n        // if not provided, progress and end wouldn't fire if the mouse moved out of the drag button area\n        $( '#dd-helper' )\n            .show()\n            .on( 'mousemove', move )\n            .one( 'mouseup', function( e ){\n                $( this ).hide().off( 'mousemove', move );\n            });\n    },\n\n    //TODO: the following three could be simplified I think\n    resize : function( newSize ){\n        this.$el.css( 'width', newSize );\n        // if panel is 'right' (this.id), move center right newSize number of pixels\n        this.$center().css( this.id, newSize );\n        return self;\n    },\n\n    show : function(){\n        if( !this.hidden ){ return; }\n        var self = this,\n            animation = {},\n            whichSide = this.id;\n\n        animation[ whichSide ] = 0;\n        self.$el\n            .css( whichSide, -this.savedSize )\n            .show()\n            .animate( animation, \"fast\", function(){\n                self.resize( self.savedSize );\n            });\n\n        self.hidden = false;\n        self.$toggleButton().removeClass( \"hidden\" );\n        return self;\n    },\n\n    hide : function(){\n        if( this.hidden ){ return; }\n        var self = this,\n            animation = {},\n            whichSide = this.id;\n\n        self.savedSize = this.$el.width();\n        animation[ whichSide ] = -this.savedSize;\n        this.$el.animate( animation, \"fast\" );\n        this.$center().css( whichSide, 0 );\n\n        self.hidden = true;\n        self.$toggleButton().addClass( \"hidden\" );\n        return self;\n    },\n\n    toggle: function( ev ){\n        var self = this;\n        if( self.hidden ){\n            self.show();\n        } else {\n            self.hide();\n        }\n        self.hiddenByTool = false;\n        return self;\n    },\n\n    // ..............................................................\n    //TODO: only used in message.mako?\n    /**   */\n    handle_minwidth_hint: function( hint ){\n        var space = this.$center().width() - ( this.hidden ? this.savedSize : 0 );\n        if( space < hint ){\n            if( !this.hidden ){\n                this.toggle();\n                this.hiddenByTool = true;\n            }\n        } else {\n            if( this.hiddenByTool ){\n                this.toggle();\n                this.hiddenByTool = false;\n            }\n        }\n        return self;\n    },\n\n    /**   */\n    force_panel : function( op ){\n        if( op == 'show' ){ return this.show(); }\n        if( op == 'hide' ){ return this.hide(); }\n        return self;\n    },\n\n    toString : function(){ return 'SidePanel(' + this.id + ')'; }\n});\n\n// ----------------------------------------------------------------------------\n// TODO: side should be defined by page - not here\nvar LeftPanel = SidePanel.extend({\n    id : 'left',\n});\n\nvar RightPanel = SidePanel.extend({\n    id : 'right',\n});\n\n\n// ----------------------------------------------------------------------------\n/**\n *\n */\nvar CenterPanel = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n    _logNamespace : 'layout',\n\n    initialize : function( options ){\n        this.log( this + '.initialize:', options );\n        /** previous view contained in the center panel - cached for removal later */\n        this.prev = null;\n    },\n\n    render : function(){\n        this.log( this + '.render:' );\n        this.$el.html( this.template() );\n        // ?: doesn't work/listen in events map\n        this.$( '#galaxy_main' ).on( 'load', _.bind( this._iframeChangeHandler, this ) );\n    },\n\n    /**   */\n    _iframeChangeHandler : function( ev ){\n        var iframe = ev.currentTarget;\n        var location = iframe.contentWindow && iframe.contentWindow.location;\n        if( location && location.host ){\n            // show the iframe and hide MVCview div, remove any views in the MVCview div\n            $( iframe ).show();\n            if( this.prev ){\n                this.prev.remove();\n            }\n            this.$( '#center-panel' ).hide();\n            // TODO: move to Galaxy\n            Galaxy.trigger( 'galaxy_main:load', {\n                fullpath: location.pathname + location.search + location.hash,\n                pathname: location.pathname,\n                search  : location.search,\n                hash    : location.hash\n            });\n        }\n    },\n\n    /**   */\n    display: function( view ){\n        // we need to display an MVC view: hide the iframe and show the other center panel\n        // first checking for any onbeforeunload handlers on the iframe\n        var contentWindow = this.$( '#galaxy_main' )[ 0 ].contentWindow || {};\n        var message = contentWindow.onbeforeunload && contentWindow.onbeforeunload();\n        if ( !message || confirm( message ) ) {\n            contentWindow.onbeforeunload = undefined;\n            // remove any previous views\n            if( this.prev ){\n                this.prev.remove();\n            }\n            this.prev = view;\n            this.$( '#galaxy_main' ).attr( 'src', 'about:blank' ).hide();\n            this.$( '#center-panel' ).scrollTop( 0 ).append( view.$el ).show();\n            Galaxy.trigger( 'center-panel:load', view );\n\n        } else {\n            if( view ){\n                view.remove();\n            }\n        }\n    },\n\n    template: function(){\n        return [\n            //TODO: remove inline styling\n            '<div style=\"position: absolute; width: 100%; height: 100%\">',\n                '<iframe name=\"galaxy_main\" id=\"galaxy_main\" frameborder=\"0\" ',\n                        'style=\"position: absolute; width: 100%; height: 100%;\"/>',\n                '<div id=\"center-panel\" ',\n                     'style=\"display: none; position: absolute; width: 100%; height: 100%; padding: 10px; overflow: auto;\"/>',\n            '</div>'\n        ].join('');\n    },\n\n    toString : function(){ return 'CenterPanel'; }\n});\n\n\n// ============================================================================\n    return {\n        LeftPanel : LeftPanel,\n        RightPanel : RightPanel,\n        CenterPanel : CenterPanel\n    };\n});\n"]}