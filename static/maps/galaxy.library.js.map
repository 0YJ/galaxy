{"version":3,"sources":["galaxy.library.js"],"names":["define","initialize","Backbone","mod_utils","mod_toastr","mod_baseMVC","mod_library_model","mod_folderlist_view","mod_librarylist_view","routes","mod_foldertoolbar_view","mod_library_dataset_view","mod_library_library_view","mod_library_folder_view","LibraryRouter","Router","extend","this","routesHit","history","on","bind","trackPageview","window","","page/:show_page","library/:library_id/permissions","folders/:folder_id/permissions","folders/:id","folders/:id/page/:show_page","folders/:folder_id/datasets/:dataset_id","folders/:folder_id/datasets/:dataset_id/permissions","folders/:folder_id/download/:format","folders/:folder_id/import/:source","back","defaults","trigger","replace","url","getFragment","test","ga","GalaxyLibrary","root","folderListView","SessionStorageModel","datasetView","with_deleted","sort_by","library_page_size","folder_page_size","Galaxy","GalaxyApp","View","libraryToolbarView","libraryListView","preferences","library_router","libraryView","folderToolbarView","config","ga_code","i","s","o","g","r","a","m","arguments","l","Date","show_page","getElementsByTagName","src","parentNode","insertBefore","libraries","mod_librarytoolbar_view","LibraryPrefs","id","$el","unbind","LibraryListView","render","LibraryToolbarView","folder_id","navigate","FolderToolbarView","FolderListView","LibraryDatasetView","dataset_id","$","find","length","info","format","library_id","show_permissions","ldda_id","folderView","show_version","source","showImportModal","LibraryView","FolderView","start","pushState"],"mappings":"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","file":"../scripts/galaxy.library.js","sourcesContent":["// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n// === MAIN GALAXY LIBRARY MODULE ====\n// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n\ndefine([\n  \"layout/masthead\",\n  \"utils/utils\",\n  \"libs/toastr\",\n  \"mvc/base-mvc\",\n  \"mvc/library/library-model\",\n  \"mvc/library/library-folderlist-view\",\n  \"mvc/library/library-librarylist-view\",\n  \"mvc/library/library-librarytoolbar-view\",\n  \"mvc/library/library-foldertoolbar-view\",\n  \"mvc/library/library-dataset-view\",\n  \"mvc/library/library-library-view\",\n  \"mvc/library/library-folder-view\"\n  ],\n  function(mod_masthead,\n    mod_utils,\n    mod_toastr,\n    mod_baseMVC,\n    mod_library_model,\n    mod_folderlist_view,\n    mod_librarylist_view,\n    mod_librarytoolbar_view,\n    mod_foldertoolbar_view,\n    mod_library_dataset_view,\n    mod_library_library_view,\n    mod_library_folder_view\n   ) {\n\n// ============================================================================\n/**\n * The Data Libraries router. Takes care about triggering routes\n * and sends users to proper pieces of the application.\n */\nvar LibraryRouter = Backbone.Router.extend({\n\n  initialize: function() {\n    this.routesHit = 0;\n    // keep count of number of routes handled by the application\n    Backbone.history.on( 'route', function() { this.routesHit++; }, this );\n\n    this.bind( 'route', this.trackPageview );\n  },\n\n  routes: {\n    \"\"                                                              : \"libraries\",\n    \"page/:show_page\"                                               : \"libraries_page\",\n    \"library/:library_id/permissions\"                               : \"library_permissions\",\n    \"folders/:folder_id/permissions\"                                : \"folder_permissions\",\n    \"folders/:id\"                                                   : \"folder_content\",\n    \"folders/:id/page/:show_page\"                                   : \"folder_page\",\n    \"folders/:folder_id/datasets/:dataset_id\"                       : \"dataset_detail\",\n    \"folders/:folder_id/datasets/:dataset_id/permissions\"           : \"dataset_permissions\",\n    \"folders/:folder_id/datasets/:dataset_id/versions/:ldda_id\"     : \"dataset_version\",\n    \"folders/:folder_id/download/:format\"                           : \"download\",\n    \"folders/:folder_id/import/:source\"                             : \"import_datasets\"\n  },\n\n  /**\n   * If more than one route has been hit the user did not land on current\n   * page directly so we can go back safely. Otherwise go to the home page.\n   * Use replaceState if available so the navigation doesn't create an\n   * extra history entry\n   */\n  back: function() {\n    if( this.routesHit > 1 ) {\n      window.history.back();\n    } else {\n      this.navigate( '#', { trigger:true, replace:true } );\n    }\n  },\n\n  /**\n   * Track every route change as a page view in Google Analytics.\n   */\n  trackPageview: function () {\n    var url = Backbone.history.getFragment();\n    //prepend slash\n    if (!/^\\//.test(url) && url != \"\") {\n      url = \"/\" + url;\n    }\n    if ( typeof ga !== 'undefined' ) {\n      ga( 'send', 'pageview', Galaxy.root + 'library/list' + url );\n    }\n  }\n});\n\n// ============================================================================\n/** session storage for library preferences */\nvar LibraryPrefs = mod_baseMVC.SessionStorageModel.extend({\n    defaults : {\n        with_deleted      : false,\n        sort_order        : 'asc',\n        sort_by           : 'name',\n        library_page_size : 20,\n        folder_page_size  : 15\n    }\n});\n\n// ============================================================================\n/**\n * Main view of the Galaxy Data Libraries. Stores pointers to other subviews\n * and defines what router should do on the route triggers.\n */\nvar GalaxyLibrary = Backbone.View.extend({\n\n    libraryToolbarView: null,\n    libraryListView: null,\n    library_router: null,\n    libraryView: null,\n    folderToolbarView: null,\n    folderListView: null,\n    datasetView: null,\n\n    initialize : function(){\n\n      // This should go upstream in the js app once available\n      if ( window.Galaxy.config.ga_code ){\n      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n            ga('create', window.Galaxy.config.ga_code, 'auto');\n            ga('send', 'pageview');\n      }\n\n        Galaxy.libraries = this;\n\n        this.preferences = new LibraryPrefs( { id: 'global-lib-prefs' } );\n\n        this.library_router = new LibraryRouter();\n\n        this.library_router.on( 'route:libraries', function() {\n            if ( Galaxy.libraries.libraryToolbarView){\n                Galaxy.libraries.libraryToolbarView.$el.unbind('click');\n            }\n            Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n            Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView();\n        });\n\n        this.library_router.on('route:libraries_page', function( show_page ) {\n            if ( Galaxy.libraries.libraryToolbarView === null ){\n                Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n                Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView( { show_page: show_page } );\n            } else {\n                Galaxy.libraries.libraryListView.render( { show_page: show_page } );\n            }\n        });\n\n        this.library_router.on( 'route:folder_content', function( id ) {\n            if (Galaxy.libraries.folderToolbarView){\n                Galaxy.libraries.folderToolbarView.$el.unbind( 'click' );\n            }\n            Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( { id: id } );\n            Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: id } );\n        });\n\n        this.library_router.on( 'route:folder_page', function( id, show_page ) {\n            if ( Galaxy.libraries.folderToolbarView === null ){\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( {id: id} );\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: id, show_page: show_page } );\n            } else {\n                Galaxy.libraries.folderListView.render( { id: id, show_page: parseInt( show_page ) } );\n            }\n        });\n\n        this.library_router.on( 'route:download', function( folder_id, format ) {\n            if ( $( '#folder_list_body' ).find( ':checked' ).length === 0 ) {\n                mod_toastr.info( 'You must select at least one dataset to download' );\n                Galaxy.libraries.library_router.navigate( 'folders/' + folder_id, { trigger: true, replace: true } );\n            } else {\n                Galaxy.libraries.folderToolbarView.download( folder_id, format );\n                Galaxy.libraries.library_router.navigate( 'folders/' + folder_id, { trigger: false, replace: true } );\n            }\n        });\n\n        this.library_router.on( 'route:dataset_detail', function(folder_id, dataset_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, show_version: false, show_permissions: false});\n        });\n\n        this.library_router.on( 'route:dataset_version', function(folder_id, dataset_id, ldda_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, ldda_id: ldda_id, show_version: true});\n        });\n\n        this.library_router.on( 'route:dataset_permissions', function(folder_id, dataset_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:library_permissions', function(library_id){\n            if (Galaxy.libraries.libraryView){\n                Galaxy.libraries.libraryView.$el.unbind('click');\n            }\n            Galaxy.libraries.libraryView = new mod_library_library_view.LibraryView({id: library_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:folder_permissions', function(folder_id){\n            if (Galaxy.libraries.folderView){\n                Galaxy.libraries.folderView.$el.unbind('click');\n            }\n            Galaxy.libraries.folderView = new mod_library_folder_view.FolderView({id: folder_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:import_datasets', function( folder_id, source ){\n            if ( Galaxy.libraries.folderToolbarView && Galaxy.libraries.folderListView ){\n                Galaxy.libraries.folderToolbarView.showImportModal( { source:source } );\n            } else {\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( { id: folder_id } );\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: folder_id } );\n                Galaxy.libraries.folderToolbarView.showImportModal( { source: source } );\n            }\n        });\n\n        Backbone.history.start({pushState: false});\n    }\n});\n\nreturn {\n    GalaxyApp: GalaxyLibrary\n};\n\n});\n"]}