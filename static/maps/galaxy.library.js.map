{"version":3,"sources":["galaxy.library.js"],"names":["define","mod_masthead","mod_utils","mod_toastr","mod_baseMVC","mod_library_model","mod_folderlist_view","mod_librarylist_view","mod_librarytoolbar_view","mod_foldertoolbar_view","mod_library_dataset_view","mod_library_library_view","mod_library_folder_view","LibraryRouter","Backbone","Router","extend","initialize","this","routesHit","history","on","bind","trackPageview","routes","","page/:show_page","library/:library_id/permissions","folders/:folder_id/permissions","folders/:id","folders/:id/page/:show_page","folders/:folder_id/datasets/:dataset_id","folders/:folder_id/datasets/:dataset_id/permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id","folders/:folder_id/download/:format","folders/:folder_id/import/:source","back","window","navigate","trigger","replace","url","getFragment","test","ga","Galaxy","root","LibraryPrefs","SessionStorageModel","defaults","with_deleted","sort_order","sort_by","library_page_size","folder_page_size","GalaxyApp","View","libraryToolbarView","libraryListView","library_router","libraryView","folderToolbarView","folderListView","datasetView","config","ga_code","i","s","o","g","r","a","m","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","libraries","preferences","id","$el","unbind","LibraryToolbarView","LibraryListView","show_page","render","FolderToolbarView","FolderListView","parseInt","folder_id","format","$","find","length","info","download","dataset_id","LibraryDatasetView","show_version","show_permissions","ldda_id","library_id","LibraryView","folderView","FolderView","source","showImportModal","start","pushState"],"mappings":"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","file":"../scripts/galaxy.library.js","sourcesContent":["// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n// === MAIN GALAXY LIBRARY MODULE ====\n// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\n\ndefine([\n  \"layout/masthead\",\n  \"utils/utils\",\n  \"libs/toastr\",\n  \"mvc/base-mvc\",\n  \"mvc/library/library-model\",\n  \"mvc/library/library-folderlist-view\",\n  \"mvc/library/library-librarylist-view\",\n  \"mvc/library/library-librarytoolbar-view\",\n  \"mvc/library/library-foldertoolbar-view\",\n  \"mvc/library/library-dataset-view\",\n  \"mvc/library/library-library-view\",\n  \"mvc/library/library-folder-view\"\n  ],\n  function(mod_masthead,\n    mod_utils,\n    mod_toastr,\n    mod_baseMVC,\n    mod_library_model,\n    mod_folderlist_view,\n    mod_librarylist_view,\n    mod_librarytoolbar_view,\n    mod_foldertoolbar_view,\n    mod_library_dataset_view,\n    mod_library_library_view,\n    mod_library_folder_view\n   ) {\n\n// ============================================================================\n/**\n * The Data Libraries router. Takes care about triggering routes\n * and sends users to proper pieces of the application.\n */\nvar LibraryRouter = Backbone.Router.extend({\n\n  initialize: function() {\n    this.routesHit = 0;\n    // keep count of number of routes handled by the application\n    Backbone.history.on( 'route', function() { this.routesHit++; }, this );\n\n    this.bind( 'route', this.trackPageview );\n  },\n\n  routes: {\n    \"\"                                                              : \"libraries\",\n    \"page/:show_page\"                                               : \"libraries_page\",\n    \"library/:library_id/permissions\"                               : \"library_permissions\",\n    \"folders/:folder_id/permissions\"                                : \"folder_permissions\",\n    \"folders/:id\"                                                   : \"folder_content\",\n    \"folders/:id/page/:show_page\"                                   : \"folder_page\",\n    \"folders/:folder_id/datasets/:dataset_id\"                       : \"dataset_detail\",\n    \"folders/:folder_id/datasets/:dataset_id/permissions\"           : \"dataset_permissions\",\n    \"folders/:folder_id/datasets/:dataset_id/versions/:ldda_id\"     : \"dataset_version\",\n    \"folders/:folder_id/download/:format\"                           : \"download\",\n    \"folders/:folder_id/import/:source\"                             : \"import_datasets\"\n  },\n\n  /**\n   * If more than one route has been hit the user did not land on current\n   * page directly so we can go back safely. Otherwise go to the home page.\n   * Use replaceState if available so the navigation doesn't create an\n   * extra history entry\n   */\n  back: function() {\n    if( this.routesHit > 1 ) {\n      window.history.back();\n    } else {\n      this.navigate( '#', { trigger:true, replace:true } );\n    }\n  },\n\n  /**\n   * Track every route change as a page view in Google Analytics.\n   */\n  trackPageview: function () {\n    var url = Backbone.history.getFragment();\n    //prepend slash\n    if (!/^\\//.test(url) && url != \"\") {\n      url = \"/\" + url;\n    }\n    if ( typeof ga !== 'undefined' ) {\n      ga( 'send', 'pageview', Galaxy.root + 'library/list' + url );\n    }\n  }\n});\n\n// ============================================================================\n/** session storage for library preferences */\nvar LibraryPrefs = mod_baseMVC.SessionStorageModel.extend({\n    defaults : {\n        with_deleted      : false,\n        sort_order        : 'asc',\n        sort_by           : 'name',\n        library_page_size : 20,\n        folder_page_size  : 15\n    }\n});\n\n// ============================================================================\n/**\n * Main view of the Galaxy Data Libraries. Stores pointers to other subviews\n * and defines what router should do on the route triggers.\n */\nvar GalaxyLibrary = Backbone.View.extend({\n\n    libraryToolbarView: null,\n    libraryListView: null,\n    library_router: null,\n    libraryView: null,\n    folderToolbarView: null,\n    folderListView: null,\n    datasetView: null,\n\n    initialize : function(){\n\n      // This should go upstream in the js app once available\n      if ( window.Galaxy.config.ga_code ){\n      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n            ga('create', window.Galaxy.config.ga_code, 'auto');\n            ga('send', 'pageview');\n      }\n\n        Galaxy.libraries = this;\n\n        this.preferences = new LibraryPrefs( { id: 'global-lib-prefs' } );\n\n        this.library_router = new LibraryRouter();\n\n        this.library_router.on( 'route:libraries', function() {\n            if ( Galaxy.libraries.libraryToolbarView){\n                Galaxy.libraries.libraryToolbarView.$el.unbind('click');\n            }\n            Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n            Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView();\n        });\n\n        this.library_router.on('route:libraries_page', function( show_page ) {\n            if ( Galaxy.libraries.libraryToolbarView === null ){\n                Galaxy.libraries.libraryToolbarView = new mod_librarytoolbar_view.LibraryToolbarView();\n                Galaxy.libraries.libraryListView = new mod_librarylist_view.LibraryListView( { show_page: show_page } );\n            } else {\n                Galaxy.libraries.libraryListView.render( { show_page: show_page } );\n            }\n        });\n\n        this.library_router.on( 'route:folder_content', function( id ) {\n            if (Galaxy.libraries.folderToolbarView){\n                Galaxy.libraries.folderToolbarView.$el.unbind( 'click' );\n            }\n            Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( { id: id } );\n            Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: id } );\n        });\n\n        this.library_router.on( 'route:folder_page', function( id, show_page ) {\n            if ( Galaxy.libraries.folderToolbarView === null ){\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( {id: id} );\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: id, show_page: show_page } );\n            } else {\n                Galaxy.libraries.folderListView.render( { id: id, show_page: parseInt( show_page ) } );\n            }\n        });\n\n        this.library_router.on( 'route:download', function( folder_id, format ) {\n            if ( $( '#folder_list_body' ).find( ':checked' ).length === 0 ) {\n                mod_toastr.info( 'You must select at least one dataset to download' );\n                Galaxy.libraries.library_router.navigate( 'folders/' + folder_id, { trigger: true, replace: true } );\n            } else {\n                Galaxy.libraries.folderToolbarView.download( folder_id, format );\n                Galaxy.libraries.library_router.navigate( 'folders/' + folder_id, { trigger: false, replace: true } );\n            }\n        });\n\n        this.library_router.on( 'route:dataset_detail', function(folder_id, dataset_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, show_version: false, show_permissions: false});\n        });\n\n        this.library_router.on( 'route:dataset_version', function(folder_id, dataset_id, ldda_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, ldda_id: ldda_id, show_version: true});\n        });\n\n        this.library_router.on( 'route:dataset_permissions', function(folder_id, dataset_id){\n            if (Galaxy.libraries.datasetView){\n                Galaxy.libraries.datasetView.$el.unbind('click');\n            }\n            Galaxy.libraries.datasetView = new mod_library_dataset_view.LibraryDatasetView({id: dataset_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:library_permissions', function(library_id){\n            if (Galaxy.libraries.libraryView){\n                Galaxy.libraries.libraryView.$el.unbind('click');\n            }\n            Galaxy.libraries.libraryView = new mod_library_library_view.LibraryView({id: library_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:folder_permissions', function(folder_id){\n            if (Galaxy.libraries.folderView){\n                Galaxy.libraries.folderView.$el.unbind('click');\n            }\n            Galaxy.libraries.folderView = new mod_library_folder_view.FolderView({id: folder_id, show_permissions: true});\n        });\n\n        this.library_router.on( 'route:import_datasets', function( folder_id, source ){\n            if ( Galaxy.libraries.folderToolbarView && Galaxy.libraries.folderListView ){\n                Galaxy.libraries.folderToolbarView.showImportModal( { source:source } );\n            } else {\n                Galaxy.libraries.folderToolbarView = new mod_foldertoolbar_view.FolderToolbarView( { id: folder_id } );\n                Galaxy.libraries.folderListView = new mod_folderlist_view.FolderListView( { id: folder_id } );\n                Galaxy.libraries.folderToolbarView.showImportModal( { source: source } );\n            }\n        });\n\n        Backbone.history.start({pushState: false});\n    }\n});\n\nreturn {\n    GalaxyApp: GalaxyLibrary\n};\n\n});\n"]}