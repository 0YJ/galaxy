{"version":3,"sources":["galaxy.pages.js"],"names":["range","selectNodeContents","item_singular","selection","window","item_class","item_plural","item_controller","CONTROLS","ITEM_DATASET","dialog_type","item_list_action","ITEM_VISUALIZATION","singular","plural","controller","iclass","list_ajax_url","replace","item_id","item_type","$","ajax","type","url","ajax_url","data","id","accessible","error","make_item_importable","set_accessible_url","document","ajaxError","e","x","message","responseText","statusText","show_modal","Ignore error","hide_modal","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","WYMeditor","TOOLS","IFRAME","STATUS","toolsItems","name","title","css","editor","wymeditors","save","callback","save_url","page_id","content","xhtml","annotations","JSON","stringify","Object","_","success","click","location","page_list_url","containers_menu","append","items","each","_options","containersItems","k","v","tagname","container","make_popupmenu","insert_link_menu_button","addClass","Insert History Link","dialog","DIALOG_HISTORY_LINK","Insert Dataset Link","DIALOG_DATASET_LINK","Insert Workflow Link","DIALOG_WORKFLOW_LINK","Insert Page Link","DIALOG_PAGE_LINK","Insert Visualization Link","DIALOG_VISUALIZATION_LINK","embed_object_button","Embed History","DIALOG_EMBED_HISTORY","Embed Dataset","DIALOG_EMBED_DATASET","Embed Workflow","DIALOG_EMBED_WORKFLOW","Embed Visualization","DIALOG_EMBED_VISUALIZATION","ITEM_HISTORY","ITEM_WORKFLOW","ITEM_PAGE","alert","dialogType","dialogFeatures","bodyHtml","wym","this","prototype","selected","DIALOG_LINK","attr","HREF","srcSelector","val","SRC","hrefSelector","TITLE","altSelector","curURL","undefined","curTitle","_exec","sUrl","sId","link","sStamp","text","CREATE_LINK","indexOf","sName","set_link_id","attribute_input","removeClass","remove","DIALOG_IMAGE","item_info","Cancel","dialogImageSelector","_selected_image","titleSelector","Insert","iCols","iRows","_doc","createElement","table","INSERT_IMAGE","body","node","findUp","DIALOG_TABLE","closing_events","buttons","rowsSelector","colsSelector","make_importable","TABLE","newRow","grid","captionSelector","createCaption","sCaption","url_template","get_name_and_link_url","getJSON","y","insertCell","link_text","summarySelector","MAIN_CONTAINERS","Galaxy","parentNode","modal","hide","get_item_info","url_base","dict_format","embedded","show","_gridView2","default","$el","toLowerCase","Close","Array","editor_onload","returned_item_info","insert","changed","do_close","DIALOG_EMBED_PAGE","onbeforeunload","item_name","item_embed_html","join"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["import \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jstorage\";\nimport \"libs/jquery/jquery.wymeditor\";\nimport \"libs/jquery/jquery.autocomplete\";\nimport GridView from \"mvc/grid/grid-view\";\n\nvar CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular, item_plural, item_controller, item_class;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action =\n        \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\n        \"ITEM_CONTROLLER\",\n        item_controller\n    );\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(\"Making \" + item_type + \" accessible failed\");\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(\n    dialogType,\n    dialogFeatures,\n    bodyHtml\n) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val(\n                $(selected).attr(WYMeditor.TITLE)\n            );\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" +\n                curURL +\n                \"' size='40' /></div>\" +\n                \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" +\n                curTitle +\n                \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\",\n                        sId = $(\".wym_id\").val() || \"\",\n                        sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.srcSelector\n            ).val($(wym._selected_image).attr(WYMeditor.SRC));\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.titleSelector\n            ).val($(wym._selected_image).attr(WYMeditor.TITLE));\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.altSelector\n            ).val($(wym._selected_image).attr(WYMeditor.ALT));\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(\n                                WYMeditor.TITLE,\n                                $(wym._options.titleSelector).val()\n                            )\n                            .attr(\n                                WYMeditor.ALT,\n                                $(wym._options.altSelector).val()\n                            );\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\n                            \"summary\",\n                            $(wym._options.summarySelector).val()\n                        );\n\n                        //append the table after the selected container\n                        var node = $(\n                            wym.findUp(\n                                wym.container(),\n                                WYMeditor.MAIN_CONTAINERS\n                            )\n                        ).get(0);\n                        if (!node || !node.parentNode)\n                            $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: \"Insert Link to \" + item_info.singular,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append(\n                            '<input id=\"make-importable\" type=\"checkbox\" checked/>'\n                        )\n                        .append(\n                            \"Make the selected \" +\n                                item_info.plural.toLowerCase() +\n                                \" accessible so that they can viewed by everyone.\"\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Insert: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null)\n                        make_importable = true;\n\n                    // Insert links to history for each checked item.\n                    var item_ids = new Array();\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var item_id = $(this).val();\n\n                        // Make item importable?\n                        if (make_importable)\n                            make_item_importable(\n                                item_info.controller,\n                                item_id,\n                                item_info.singular\n                            );\n\n                        // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                        var url_template = get_name_and_link_url + item_id;\n                        var ajax_url = url_template.replace(\n                            \"ITEM_CONTROLLER\",\n                            item_info.controller\n                        );\n                        $.getJSON(ajax_url, function(returned_item_info) {\n                            // Get link text.\n                            wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                            var link_text = $(\n                                \"a[href=\" + sStamp + \"]\",\n                                wym._doc.body\n                            ).text();\n\n                            // Insert link: need to do different actions depending on link text.\n                            if (\n                                link_text == \"\" || // Firefox.\n                                link_text == sStamp // Safari\n                            ) {\n                                // User selected no text; create link from scratch and use default text.\n                                wym.insert(\n                                    \"<a href='\" +\n                                        returned_item_info.link +\n                                        \"'>\" +\n                                        item_info.singular +\n                                        \" '\" +\n                                        returned_item_info.name +\n                                        \"'</a>\"\n                                );\n                            } else {\n                                // Link created from selected text; add href and title.\n                                $(\"a[href=\" + sStamp + \"]\", wym._doc.body)\n                                    .attr(\n                                        WYMeditor.HREF,\n                                        returned_item_info.link\n                                    )\n                                    .attr(\n                                        WYMeditor.TITLE,\n                                        item_info.singular + item_id\n                                    );\n                            }\n                        });\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: \"Insert Link to \" + item_info.singular,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append(\n                            '<input id=\"make-importable\" type=\"checkbox\" checked/>'\n                        )\n                        .append(\n                            \"Make the selected \" +\n                                item_info.plural.toLowerCase() +\n                                \" accessible so that they can viewed by everyone.\"\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Embed: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null)\n                        make_importable = true;\n\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        // Get item ID and name.\n                        var item_id = $(this).val();\n                        // Use ':first' because there are many labels in table; the first one is the item name.\n                        var item_name = $(\n                            \"label[for='\" + item_id + \"']:first\"\n                        ).text();\n\n                        if (make_importable)\n                            make_item_importable(\n                                item_info.controller,\n                                item_id,\n                                item_info.singular\n                            );\n\n                        // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                        // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                        // item_class='History').\n                        var item_elt_id = item_info.iclass + \"-\" + item_id;\n                        var item_embed_html = [\n                            \"<div id='\",\n                            item_elt_id,\n                            \"' class='embedded-item \",\n                            item_info.singular.toLowerCase(),\n                            \" placeholder'>\",\n                            \"<p class='title'>\",\n                            \"Embedded Galaxy \",\n                            item_info.singular,\n                            \" '\",\n                            item_name,\n                            \"'\",\n                            \"</p>\",\n                            \"<p class='content'>\",\n                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                            item_info.singular.toLowerCase(),\n                            \" when it is displayed.]\",\n                            \"</p>\",\n                            \"</div>\"\n                        ].join(\"\");\n\n                        // Insert embedded item into document.\n                        wym.insert(item_embed_html);\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n};\n\nexport default function editor_onload() {\n    // Generic error handling\n    $(document).ajaxError(function(e, x) {\n        // console.log( e, x );\n        var message =\n            x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:\n            \"<table class='wym_box' width='100%' height='100%'>\" +\n            \"<tr><td><div class='wym_area_top'>\" +\n            WYMeditor.TOOLS +\n            \"</div></td></tr>\" +\n            \"<tr height='100%'><td>\" +\n            \"<div class='wym_area_main' style='height: 100%;'>\" +\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME +\n            WYMeditor.STATUS +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td></tr></table>\",\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: \"Superscript\",\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: \"Subscript\",\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function(callback) {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(function() {\n        save(function() {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, function(k, v) {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = function() {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n"]}