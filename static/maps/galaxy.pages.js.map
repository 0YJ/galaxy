{"version":3,"sources":["galaxy.pages.js"],"names":["init_galaxy_elts","wym","$","_doc","body","each","this","range","selection","window","addRange","getSelection","removeAllRanges","get_item_info","ITEM_HISTORY","item_plural","item_controller","item_class","dialog_type","item_singular","CONTROLS","ITEM_VISUALIZATION","item_list_action","ajax_url","list_objects_url","controller","toLowerCase","iclass","replace","singular","plural","make_item_importable","set_accessible_url","ajax","alert","item_type","item_id","type","url","WYMeditor","editor","prototype","dialog","error","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_PAGE_LINK","DIALOG_VISUALIZATION_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","dialogType","dialogFeatures","bodyHtml","set_link_id","attribute_input","text","addClass","removeClass","selected","val","attr","_options","uniqueStamp","DIALOG_LINK","curURL","undefined","HREF","curTitle","SRC","TITLE","altSelector","ALT","sName","sUrl","_exec","show_modal","link","hrefSelector","hide_modal","titleSelector","CREATE_LINK","sStamp","DIALOG_IMAGE","_selected_image","dialogImageSelector","indexOf","srcSelector","iRows","rowsSelector","iCols","colsSelector","newRow","length","INSERT_IMAGE","item_info","Insert","list_ajax_url","table","createElement","TABLE","sCaption","captionSelector","newCaption","createCaption","innerHTML","x","insertRow","y","insertCell","url_template","MAIN_CONTAINERS","get","node","parentNode","after","append","Cancel","data","success","table_html","make_importable","Array","item_name","get_name_and_link_url","getJSON","returned_item_info","item_embed_html","item_elt_id","link_text","insert","name","save","save_url","id","page_id","content","annotations","callback","list_html","changed","do_close","onbeforeunload","Embed","location","page_list_url","containers_menu","items","join","insert_link_menu_button","document","ajaxError","e","message","responseText","statusText","Ignore error","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","embed_object_button","TOOLS","IFRAME","toolsItems","title","css","wymeditors","xhtml","JSON","stringify","Object","_","click","containersItems","k","v","tagname","container","make_popupmenu","Insert History Link","Insert Dataset Link","Insert Workflow Link","Insert Page Link","Insert Visualization Link","Embed History","Embed Dataset","Embed Workflow","Embed Visualization"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["\nvar CONTROLS =\n{\n    // Item types.\n    ITEM_HISTORY : \"item_history\",\n    ITEM_DATASET : \"item_dataset\",\n    ITEM_WORKFLOW : \"item_workflow\",\n    ITEM_PAGE : \"item_page\",\n    ITEM_VISUALIZATION : \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK : \"link_history\",\n    DIALOG_DATASET_LINK : \"link_dataset\",\n    DIALOG_WORKFLOW_LINK : \"link_workflow\",\n    DIALOG_PAGE_LINK : \"link_page\",\n    DIALOG_VISUALIZATION_LINK : \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY : \"embed_history\",\n    DIALOG_EMBED_DATASET : \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW : \"embed_workflow\",\n    DIALOG_EMBED_PAGE : \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION : \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym)\n{\n    // Set up events to make annotation easy.\n    $('.annotation', wym._doc.body).each( function()\n    {\n         $(this).click( function() {\n             // Works in Safari, not in Firefox.\n             var range = wym._doc.createRange();\n             range.selectNodeContents( this );\n             var selection = window.getSelection();\n             selection.removeAllRanges();\n             selection.addRange(range);\n             var t = \"\";\n         });\n    });\n\n};\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info( dialog_type )\n{\n    var\n        item_singular,\n        item_plural,\n        item_controller;\n    switch( dialog_type ) {\n        case( CONTROLS.ITEM_HISTORY ):\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case( CONTROLS.ITEM_DATASET ):\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case( CONTROLS.ITEM_WORKFLOW ):\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case( CONTROLS.ITEM_PAGE ):\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case( CONTROLS.ITEM_VISUALIZATION ):\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace( \"LIST_ACTION\", item_list_action );\n\n    // Set up and return dict.\n    return {\n        singular : item_singular,\n        plural : item_plural,\n        controller : item_controller,\n        iclass : item_class,\n        list_ajax_url : ajax_url\n    };\n};\n\n// Make an item importable.\nfunction make_item_importable( item_controller, item_id, item_type )\n{\n    ajax_url = set_accessible_url.replace( \"ITEM_CONTROLLER\", item_controller );\n    $.ajax({\n      type: \"POST\",\n      url: ajax_url,\n      data: { id: item_id, accessible: 'True' },\n      error: function() { alert(\"Making \" + item_type + \" accessible failed\"); }\n    });\n};\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function( dialogType, dialogFeatures, bodyHtml ) {\n\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id()\n    {\n        // When \"set link id\" link clicked, update UI.\n        $('#set_link_id').click( function()\n        {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected)\n                attribute_input.val( $(selected).attr('id') );\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if ( dialogType == WYMeditor.DIALOG_LINK ) {\n        if(selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected)\n        {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined)\n                curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined)\n                curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" + curURL + \"' size='40' /></div>\"\n                + \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" + curTitle + \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || '',\n                        sId = $(\".wym_id\").val() || '',\n                        sName = $(wym._options.titleSelector).val() || '';\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link.attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf('wym-') === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_IMAGE ) {\n        if(wym._selected_image) {\n            $(wym._options.dialogImageSelector + \" \" + wym._options.srcSelector)\n              .val($(wym._selected_image).attr(WYMeditor.SRC));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.titleSelector)\n              .val($(wym._selected_image).attr(WYMeditor.TITLE));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.altSelector)\n              .val($(wym._selected_image).attr(WYMeditor.ALT));\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\"\n                + \"<label>URL</label><br>\"\n                + \"<input type='text' class='wym_src' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Alt text</label><br>\"\n                + \"<input type='text' class='wym_alt' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Title</label><br>\"\n                + \"<input type='text' class='wym_title' value='' size='40' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if(sUrl.length > 0) {\n                      wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                      $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                          .attr(WYMeditor.SRC, sUrl)\n                          .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                          .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_TABLE ) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\"\n                + \"<label>Caption</label><br>\"\n                + \"<input type='text' class='wym_caption' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Summary</label><br>\"\n                + \"<input type='text' class='wym_summary' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Rows<br></label>\"\n                + \"<input type='text' class='wym_rows' value='3' size='3' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Cols<br></label>\"\n                + \"<input type='text' class='wym_cols' value='2' size='3' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if(iRows > 0 && iCols > 0) {\n\n                      var table = wym._doc.createElement(WYMeditor.TABLE);\n                      var newRow = null;\n                              var newCol = null;\n\n                              var sCaption = $(wym._options.captionSelector).val();\n\n                              //we create the caption\n                              var newCaption = table.createCaption();\n                              newCaption.innerHTML = sCaption;\n\n                              //we create the rows and cells\n                              for(x=0; x<iRows; x++) {\n                                      newRow = table.insertRow(x);\n                                      for(y=0; y<iCols; y++) {newRow.insertCell(y);}\n                              }\n\n                      //set the summary attr\n                      $(table).attr('summary',\n                          $(wym._options.summarySelector).val());\n\n                      //append the table after the selected container\n                      var node = $(wym.findUp(wym.container(),\n                        WYMeditor.MAIN_CONTAINERS)).get(0);\n                      if(!node || !node.parentNode) $(wym._doc.body).append(table);\n                      else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if ( dialogType == CONTROLS.DIALOG_HISTORY_LINK || dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n         dialogType == CONTROLS.DIALOG_WORKFLOW_LINK || dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n         dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_HISTORY_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_DATASET_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_WORKFLOW_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_PAGE_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_VISUALIZATION_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        $.ajax(\n        {\n            url: item_info.list_ajax_url,\n            data: {},\n            error: function() { alert( \"Failed to list \"  + item_info.plural.toLowerCase() + \" for selection\"); },\n            success: function(table_html)\n            {\n                show_modal(\n                    \"Insert Link to \" + item_info.singular,\n                    table_html +\n                    \"<div><input id='make-importable' type='checkbox' checked/>\" +\n                    \"Make the selected \" + item_info.plural.toLowerCase() + \" accessible so that they can viewed by everyone.</div>\"\n                    ,\n                    {\n                        \"Insert\": function()\n                        {\n                            // Make selected items accessible (importable) ?\n                            var make_importable = false;\n                            if ( $('#make-importable:checked').val() !== null )\n                                make_importable = true;\n\n                            // Insert links to history for each checked item.\n                            var item_ids = new Array();\n                            $('input[name=id]:checked').each(function() {\n                                var item_id = $(this).val();\n\n                                // Make item importable?\n                                if (make_importable)\n                                    make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                                // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                                url_template = get_name_and_link_url + item_id;\n                                ajax_url = url_template.replace( \"ITEM_CONTROLLER\", item_info.controller);\n                                $.getJSON( ajax_url, function( returned_item_info ) {\n                                    // Get link text.\n                                    wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                                    var link_text = $(\"a[href=\" + sStamp + \"]\", wym._doc.body).text();\n\n                                    // Insert link: need to do different actions depending on link text.\n                                    if (\n                                        link_text == \"\" // Firefox.\n                                        ||\n                                        link_text == sStamp // Safari\n                                        )\n                                    {\n                                        // User selected no text; create link from scratch and use default text.\n                                        wym.insert(\"<a href='\" + returned_item_info.link + \"'>\" + item_info.singular + \" '\" + returned_item_info.name + \"'</a>\");\n                                    }\n                                    else\n                                    {\n                                        // Link created from selected text; add href and title.\n                                        $(\"a[href=\" + sStamp + \"]\", wym._doc.body).attr(WYMeditor.HREF, returned_item_info.link).attr(WYMeditor.TITLE, item_info.singular + item_id);\n                                    }\n                                });\n                            });\n\n                            hide_modal();\n                        },\n                        \"Cancel\": function()\n                        {\n                            hide_modal();\n                        }\n                    }\n                );\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if ( dialogType == CONTROLS.DIALOG_EMBED_HISTORY || dialogType == CONTROLS.DIALOG_EMBED_DATASET || dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW || dialogType == CONTROLS.DIALOG_EMBED_PAGE || dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_EMBED_HISTORY):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_EMBED_DATASET):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_EMBED_WORKFLOW):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_EMBED_PAGE):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_EMBED_VISUALIZATION):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        $.ajax(\n        {\n            url: item_info.list_ajax_url,\n            data: {},\n            error: function() { alert( \"Failed to list \"  + item_info.plural.toLowerCase() + \" for selection\"); },\n            success: function(list_html)\n            {\n                // Can make histories, workflows importable; cannot make datasets importable.\n                if (dialogType == CONTROLS.DIALOG_EMBED_HISTORY || dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW\n                    || dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION)\n                    list_html = list_html + \"<div><input id='make-importable' type='checkbox' checked/>\" +\n                                \"Make the selected \" + item_info.plural.toLowerCase() + \" accessible so that they can viewed by everyone.</div>\";\n                show_modal(\n                    \"Embed \" + item_info.plural,\n                    list_html,\n                    {\n                        \"Embed\": function()\n                        {\n                            // Make selected items accessible (importable) ?\n                            var make_importable = false;\n                            if ( $('#make-importable:checked').val() != null )\n                                make_importable = true;\n\n                            $('input[name=id]:checked').each(function() {\n                                // Get item ID and name.\n                                var item_id = $(this).val();\n                                // Use ':first' because there are many labels in table; the first one is the item name.\n                                var item_name = $(\"label[for='\" + item_id + \"']:first\").text();\n\n                                if (make_importable)\n                                    make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                                // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                                // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                                // item_class='History').\n                                var item_elt_id = item_info.iclass + \"-\"  + item_id;\n                                var item_embed_html = [\n                                    \"<div id='\", item_elt_id, \"' class='embedded-item \",\n                                            item_info.singular.toLowerCase(), \" placeholder'>\",\n                                        \"<p class='title'>\",\n                                            \"Embedded Galaxy \", item_info.singular, \" '\", item_name, \"'\",\n                                        \"</p>\",\n                                        \"<p class='content'>\",\n                                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                                            item_info.singular.toLowerCase(), \" when it is displayed.]\",\n                                        \"</p>\",\n                                    \"</div>\" ].join( '' );\n\n                                // Insert embedded item into document.\n                                wym.insert(item_embed_html);\n\n                            });\n                            hide_modal();\n                        },\n                        \"Cancel\": function()\n                        {\n                            hide_modal();\n                        }\n                    }\n                );\n            }\n        });\n    }\n};\n\n$(function(){\n    // Generic error handling\n    $(document).ajaxError( function ( e, x ) {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal( \"Server error\", message, { \"Ignore error\" : hide_modal } );\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor( {\n        skin: 'galaxy',\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:   \"<table class='wym_box' width='100%' height='100%'>\"\n                    + \"<tr><td><div class='wym_area_top'>\"\n                    + WYMeditor.TOOLS\n                    + \"</div></td></tr>\"\n                    + \"<tr height='100%'><td>\"\n                    + \"<div class='wym_area_main' style='height: 100%;'>\"\n                    // + WYMeditor.HTML\n                    + WYMeditor.IFRAME\n                    + WYMeditor.STATUS\n                    + \"</div>\"\n                    + \"</div>\"\n                    + \"</td></tr></table>\",\n        toolsItems: [\n            {'name': 'Bold', 'title': 'Strong', 'css': 'wym_tools_strong'},\n            {'name': 'Italic', 'title': 'Emphasis', 'css': 'wym_tools_emphasis'},\n            {'name': 'Superscript', 'title': 'Superscript', 'css': 'wym_tools_superscript'},\n            {'name': 'Subscript', 'title': 'Subscript', 'css': 'wym_tools_subscript'},\n            {'name': 'InsertOrderedList', 'title': 'Ordered_List', 'css': 'wym_tools_ordered_list'},\n            {'name': 'InsertUnorderedList', 'title': 'Unordered_List', 'css': 'wym_tools_unordered_list'},\n            {'name': 'Indent', 'title': 'Indent', 'css': 'wym_tools_indent'},\n            {'name': 'Outdent', 'title': 'Outdent', 'css': 'wym_tools_outdent'},\n            {'name': 'Undo', 'title': 'Undo', 'css': 'wym_tools_undo'},\n            {'name': 'Redo', 'title': 'Redo', 'css': 'wym_tools_redo'},\n            {'name': 'CreateLink', 'title': 'Link', 'css': 'wym_tools_link'},\n            {'name': 'Unlink', 'title': 'Unlink', 'css': 'wym_tools_unlink'},\n            {'name': 'InsertImage', 'title': 'Image', 'css': 'wym_tools_image'},\n            {'name': 'InsertTable', 'title': 'Table', 'css': 'wym_tools_table'},\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function ( callback ) {\n        show_modal( \"Saving page\", \"progress\" );\n\n        // Do save.\n        $.ajax( {\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                \"_\": \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    }\n    // Save button\n    $(\"#save-button\").click( function() {\n        save( function() { hide_modal(); } )\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if ( changed ) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal( \"Close editor\",\n                        \"There are unsaved changes to your page which will be lost.\",\n                        {\n                            \"Cancel\" : hide_modal,\n                            \"Save Changes\" : function() {\n                                save( do_close );\n                            }\n                        }, {\n                            \"Don't Save\": do_close\n                        } );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\");\n    $(\".wym_area_top\").append( containers_menu );\n\n    // Add menu options.\n    var items = {}\n    $.each( editor._options.containersItems, function( k, v ) {\n        var tagname = v.name;\n        items[ v.title.replace( '_', ' ' ) ] = function() { editor.container( tagname ) }\n    });\n    make_popupmenu( containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu( insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        },\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu( embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        },\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n});\n"]}