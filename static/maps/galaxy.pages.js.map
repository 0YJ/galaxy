{"version":3,"sources":["galaxy.pages.js"],"names":["selection","item_singular","t","item_controller","dialog_type","CONTROLS","ITEM_HISTORY","item_plural","item_class","get_item_info","ITEM_WORKFLOW","ITEM_DATASET","ITEM_PAGE","ITEM_VISUALIZATION","replace","item_list_action","singular","plural","controller","ajax_url","iclass","list_ajax_url","item_id","item_type","$","ajax","type","make_item_importable","url","id","accessible","document","ajaxError","e","x","message","responseText","statusText","show_modal","Ignore error","hide_modal","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","WYMeditor","TOOLS","IFRAME","STATUS","toolsItems","name","title","css","editor","wymeditors","save","callback","save_url","data","page_id","content","xhtml","annotations","JSON","stringify","Object","_","success","click","window","location","page_list_url","containers_menu","append","items","each","_options","containersItems","k","v","tagname","container","make_popupmenu","insert_link_menu_button","addClass","Insert History Link","dialog","DIALOG_HISTORY_LINK","Insert Dataset Link","DIALOG_DATASET_LINK","Insert Workflow Link","DIALOG_WORKFLOW_LINK","Insert Page Link","DIALOG_PAGE_LINK","Insert Visualization Link","DIALOG_VISUALIZATION_LINK","embed_object_button","Embed History","DIALOG_EMBED_HISTORY","Embed Dataset","DIALOG_EMBED_DATASET","Embed Workflow","DIALOG_EMBED_WORKFLOW","Embed Visualization","DIALOG_EMBED_VISUALIZATION","editor_onload","prototype","dialogType","dialogFeatures","wym","sStamp","selected","DIALOG_LINK","srcSelector","val","attr","titleSelector","TITLE","curURL","curTitle","ALT","undefined","Make link","link","sUrl","hrefSelector","sId","sName","text","set_link_id","HREF","_selected_image","indexOf","dialogImageSelector","Insert","attribute_input","this","remove","DIALOG_IMAGE","item_info","DIALOG_TABLE","SRC","iCols","table","newCol","node","_exec","parentNode","_doc","body","altSelector","Cancel","iRows","rowsSelector","make_importable","createElement","TABLE","newRow","item_ids","sCaption","captionSelector","createCaption","innerHTML","getJSON","insertRow","insertCell","link_text","findUp","Galaxy","hide","Close","modal","after","require","url_base","dict_format","embedded","closing_events","grid","GridView","show","item_name","$el","toLowerCase","insert","Array","get_name_and_link_url","returned_item_info","CREATE_LINK","changed","do_close","onbeforeunload","DIALOG_EMBED_PAGE","buttons","join","item_embed_html"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["var CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular, item_plural, item_controller;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action =\n        \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\n        \"ITEM_CONTROLLER\",\n        item_controller\n    );\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(\"Making \" + item_type + \" accessible failed\");\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(\n    dialogType,\n    dialogFeatures,\n    bodyHtml\n) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val(\n                $(selected).attr(WYMeditor.TITLE)\n            );\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" +\n                curURL +\n                \"' size='40' /></div>\" +\n                \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" +\n                curTitle +\n                \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\",\n                        sId = $(\".wym_id\").val() || \"\",\n                        sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.srcSelector\n            ).val($(wym._selected_image).attr(WYMeditor.SRC));\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.titleSelector\n            ).val($(wym._selected_image).attr(WYMeditor.TITLE));\n            $(\n                wym._options.dialogImageSelector +\n                    \" \" +\n                    wym._options.altSelector\n            ).val($(wym._selected_image).attr(WYMeditor.ALT));\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(\n                                WYMeditor.TITLE,\n                                $(wym._options.titleSelector).val()\n                            )\n                            .attr(\n                                WYMeditor.ALT,\n                                $(wym._options.altSelector).val()\n                            );\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\n                            \"summary\",\n                            $(wym._options.summarySelector).val()\n                        );\n\n                        //append the table after the selected container\n                        var node = $(\n                            wym.findUp(\n                                wym.container(),\n                                WYMeditor.MAIN_CONTAINERS\n                            )\n                        ).get(0);\n                        if (!node || !node.parentNode)\n                            $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require([\"mvc/grid/grid-view\"], function(GridView) {\n            var grid = new GridView({\n                url_base: item_info.list_ajax_url,\n                dict_format: true,\n                embedded: true\n            });\n            Galaxy.modal.show({\n                title: \"Insert Link to \" + item_info.singular,\n                body: $(\"<div/>\")\n                    .append(grid.$el)\n                    .append(\n                        $(\"<div/>\")\n                            .append(\n                                '<input id=\"make-importable\" type=\"checkbox\" checked/>'\n                            )\n                            .append(\n                                \"Make the selected \" +\n                                    item_info.plural.toLowerCase() +\n                                    \" accessible so that they can viewed by everyone.\"\n                            )\n                    ),\n                closing_events: true,\n                buttons: {\n                    Insert: function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ($(\"#make-importable:checked\").val() != null)\n                            make_importable = true;\n\n                        // Insert links to history for each checked item.\n                        var item_ids = new Array();\n                        grid.$(\"input[name=id]:checked\").each(function() {\n                            var item_id = $(this).val();\n\n                            // Make item importable?\n                            if (make_importable)\n                                make_item_importable(\n                                    item_info.controller,\n                                    item_id,\n                                    item_info.singular\n                                );\n\n                            // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                            var url_template = get_name_and_link_url + item_id;\n                            var ajax_url = url_template.replace(\n                                \"ITEM_CONTROLLER\",\n                                item_info.controller\n                            );\n                            $.getJSON(ajax_url, function(returned_item_info) {\n                                // Get link text.\n                                wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                                var link_text = $(\n                                    \"a[href=\" + sStamp + \"]\",\n                                    wym._doc.body\n                                ).text();\n\n                                // Insert link: need to do different actions depending on link text.\n                                if (\n                                    link_text == \"\" || // Firefox.\n                                    link_text == sStamp // Safari\n                                ) {\n                                    // User selected no text; create link from scratch and use default text.\n                                    wym.insert(\n                                        \"<a href='\" +\n                                            returned_item_info.link +\n                                            \"'>\" +\n                                            item_info.singular +\n                                            \" '\" +\n                                            returned_item_info.name +\n                                            \"'</a>\"\n                                    );\n                                } else {\n                                    // Link created from selected text; add href and title.\n                                    $(\"a[href=\" + sStamp + \"]\", wym._doc.body)\n                                        .attr(\n                                            WYMeditor.HREF,\n                                            returned_item_info.link\n                                        )\n                                        .attr(\n                                            WYMeditor.TITLE,\n                                            item_info.singular + item_id\n                                        );\n                                }\n                            });\n                        });\n                        Galaxy.modal.hide();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require([\"mvc/grid/grid-view\"], function(GridView) {\n            var grid = new GridView({\n                url_base: item_info.list_ajax_url,\n                dict_format: true,\n                embedded: true\n            });\n            Galaxy.modal.show({\n                title: \"Insert Link to \" + item_info.singular,\n                body: $(\"<div/>\")\n                    .append(grid.$el)\n                    .append(\n                        $(\"<div/>\")\n                            .append(\n                                '<input id=\"make-importable\" type=\"checkbox\" checked/>'\n                            )\n                            .append(\n                                \"Make the selected \" +\n                                    item_info.plural.toLowerCase() +\n                                    \" accessible so that they can viewed by everyone.\"\n                            )\n                    ),\n                closing_events: true,\n                buttons: {\n                    Embed: function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ($(\"#make-importable:checked\").val() != null)\n                            make_importable = true;\n\n                        grid.$(\"input[name=id]:checked\").each(function() {\n                            // Get item ID and name.\n                            var item_id = $(this).val();\n                            // Use ':first' because there are many labels in table; the first one is the item name.\n                            var item_name = $(\n                                \"label[for='\" + item_id + \"']:first\"\n                            ).text();\n\n                            if (make_importable)\n                                make_item_importable(\n                                    item_info.controller,\n                                    item_id,\n                                    item_info.singular\n                                );\n\n                            // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                            // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                            // item_class='History').\n                            var item_elt_id = item_info.iclass + \"-\" + item_id;\n                            var item_embed_html = [\n                                \"<div id='\",\n                                item_elt_id,\n                                \"' class='embedded-item \",\n                                item_info.singular.toLowerCase(),\n                                \" placeholder'>\",\n                                \"<p class='title'>\",\n                                \"Embedded Galaxy \",\n                                item_info.singular,\n                                \" '\",\n                                item_name,\n                                \"'\",\n                                \"</p>\",\n                                \"<p class='content'>\",\n                                \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                                item_info.singular.toLowerCase(),\n                                \" when it is displayed.]\",\n                                \"</p>\",\n                                \"</div>\"\n                            ].join(\"\");\n\n                            // Insert embedded item into document.\n                            wym.insert(item_embed_html);\n                        });\n                        Galaxy.modal.hide();\n                    },\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n};\n\nexport default function editor_onload() {\n    // Generic error handling\n    $(document).ajaxError(function(e, x) {\n        // console.log( e, x );\n        var message =\n            x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:\n            \"<table class='wym_box' width='100%' height='100%'>\" +\n            \"<tr><td><div class='wym_area_top'>\" +\n            WYMeditor.TOOLS +\n            \"</div></td></tr>\" +\n            \"<tr height='100%'><td>\" +\n            \"<div class='wym_area_main' style='height: 100%;'>\" +\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME +\n            WYMeditor.STATUS +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td></tr></table>\",\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: \"Superscript\",\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: \"Subscript\",\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function(callback) {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(function() {\n        save(function() {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, function(k, v) {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = function() {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n"]}