{"version":3,"sources":["galaxy.pages.js"],"names":["init_galaxy_elts","wym","$","_doc","body","each","this","click","range","createRange","selectNodeContents","selection","window","getSelection","removeAllRanges","addRange","get_item_info","dialog_type","item_singular","item_plural","item_controller","CONTROLS","item_class","item_list_action","toLowerCase","ajax_url","list_objects_url","replace","singular","plural","controller","iclass","list_ajax_url","make_item_importable","item_id","item_type","set_accessible_url","ajax","type","url","data","id","accessible","error","alert","ITEM_HISTORY","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","ITEM_VISUALIZATION","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_PAGE_LINK","DIALOG_VISUALIZATION_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","WYMeditor","editor","prototype","dialog","dialogType","dialogFeatures","bodyHtml","set_link_id","text","attribute_input","addClass","removeClass","selected","val","attr","remove","sStamp","uniqueStamp","DIALOG_LINK","_options","hrefSelector","HREF","srcSelector","SRC","titleSelector","TITLE","altSelector","ALT","curURL","curTitle","undefined","show_modal","Make link","sUrl","sId","sName","_exec","CREATE_LINK","link","indexOf","hide_modal","Cancel","DIALOG_IMAGE","_selected_image","dialogImageSelector","Insert","length","INSERT_IMAGE","DIALOG_TABLE","iRows","rowsSelector","iCols","colsSelector","table","createElement","TABLE","newRow","sCaption","captionSelector","newCaption","createCaption","innerHTML","x","insertRow","y","insertCell","summarySelector","node","findUp","container","MAIN_CONTAINERS","get","parentNode","after","append","item_info","success","table_html","make_importable","Array","url_template","get_name_and_link_url","getJSON","returned_item_info","link_text","insert","name","list_html","Embed","item_name","item_elt_id","item_embed_html","join","document","ajaxError","e","message","responseText","statusText","Ignore error","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","boxHtml","TOOLS","IFRAME","STATUS","toolsItems","title","css","wymeditors","save","callback","save_url","page_id","content","xhtml","annotations","JSON","stringify","Object","_","location","page_list_url","containers_menu","items","containersItems","k","v","tagname","make_popupmenu","insert_link_menu_button","Insert History Link","Insert Dataset Link","Insert Workflow Link","Insert Page Link","Insert Visualization Link","embed_object_button","Embed History","Embed Dataset","Embed Workflow","Embed Visualization"],"mappings":"AA0BA,QAASA,kBAAiBC,GAGtBC,EAAE,cAAeD,EAAIE,KAAKC,MAAMC,KAAM,WAEjCH,EAAEI,MAAMC,MAAO,WAEX,GAAIC,GAAQP,EAAIE,KAAKM,aACrBD,GAAME,mBAAoBJ,KAC1B,IAAIK,GAAYC,OAAOC,cACvBF,GAAUG,kBACVH,EAAUI,SAASP,OAQhC,QAASQ,eAAeC,GAEpB,GACIC,GACAC,EACAC,CACJ,QAAQH,GACJ,IAAMI,UAAsB,aACxBH,EAAgB,UAChBC,EAAc,YACdC,EAAkB,UAClBE,WAAa,SACb,MACJ,KAAMD,UAAsB,aACxBH,EAAgB,UAChBC,EAAc,WACdC,EAAkB,UAClBE,WAAa,2BACb,MACJ,KAAMD,UAAuB,cACzBH,EAAgB,WAChBC,EAAc,YACdC,EAAkB,WAClBE,WAAa,gBACb,MACJ,KAAMD,UAAmB,UACrBH,EAAgB,OAChBC,EAAc,QACdC,EAAkB,OAClBE,WAAa,MACb,MACJ,KAAMD,UAA4B,mBAC9BH,EAAgB,gBAChBC,EAAc,iBACdC,EAAkB,gBAClBE,WAAa,gBAKrB,GAAIC,GAAmB,QAAUJ,EAAYK,cAAgB,iBACzDC,EAAWC,iBAAiBC,QAAS,cAAeJ,EAGxD,QACIK,SAAWV,EACXW,OAASV,EACTW,WAAaV,EACbW,OAAST,WACTU,cAAgBP,GAKxB,QAASQ,sBAAsBb,EAAiBc,EAASC,GAErDV,SAAWW,mBAAmBT,QAAS,kBAAmBP,GAC1DlB,EAAEmC,MACAC,KAAM,OACNC,IAAKd,SACLe,MAAQC,GAAIP,EAASQ,WAAY,QACjCC,MAAO,WAAaC,MAAM,UAAYT,EAAY,yBAzGxD,GAAId,WAGAwB,aAAe,eACfC,aAAe,eACfC,cAAgB,gBAChBC,UAAY,YACZC,mBAAqB,qBAGrBC,oBAAsB,eACtBC,oBAAsB,eACtBC,qBAAuB,gBACvBC,iBAAmB,YACnBC,0BAA4B,qBAG5BC,qBAAuB,gBACvBC,qBAAuB,gBACvBC,sBAAwB,iBACxBC,kBAAoB,aACpBC,2BAA6B,sBAyFjCC,WAAUC,OAAOC,UAAUC,OAAS,SAAUC,EAAYC,EAAgBC,GAOtE,QAASC,KAGLjE,EAAE,gBAAgBK,MAAO,WAGrBL,EAAE,yBAAyBkE,KAAK,UAGhC,IAAIC,GAAkBnE,EAAE,YACxBmE,GAAgBC,SAAS,UAAUC,YAAY,YAC3CC,GACAH,EAAgBI,IAAKvE,EAAEsE,GAAUE,KAAK,OAG1CxE,EAAEI,MAAMqE,WApBhB,GAAI1E,GAAMK,KACNsE,EAAS3E,EAAI4E,cACbL,EAAWvE,EAAIuE,UAuBnB,IAAKR,GAAcJ,UAAUkB,YAAc,CACpCN,IACCtE,EAAED,EAAI8E,SAASC,cAAcP,IAAIvE,EAAEsE,GAAUE,KAAKd,UAAUqB,OAC5D/E,EAAED,EAAI8E,SAASG,aAAaT,IAAIvE,EAAEsE,GAAUE,KAAKd,UAAUuB,MAC3DjF,EAAED,EAAI8E,SAASK,eAAeX,IAAIvE,EAAEsE,GAAUE,KAAKd,UAAUyB,QAC7DnF,EAAED,EAAI8E,SAASO,aAAab,IAAIvE,EAAEsE,GAAUE,KAAKd,UAAU2B,MAG/D,IAAIC,GAAQC,CACRjB,KAEAgB,EAAStF,EAAEsE,GAAUE,KAAK,YACZgB,IAAVF,IACAA,EAAS,QAEGE,KADhBD,EAAWvF,EAAEsE,GAAUE,KAAK,YAExBe,EAAW,KAEnBE,WACI,cACA,iNAAmNH,EAAS,gGACxIC,EAAW,6BAE3FG,YAAa,WAET,GAAIC,GAAO3F,EAAED,EAAI8E,SAASC,cAAcP,OAAS,GAC7CqB,EAAM5F,EAAE,WAAWuE,OAAS,GAC5BsB,EAAQ7F,EAAED,EAAI8E,SAASK,eAAeX,OAAS,EAEnD,IAAIoB,GAAQC,EAAK,CAEb7F,EAAI+F,MAAMpC,UAAUqC,YAAarB,EAGjC,IAAIsB,GAAOhG,EAAE,UAAY0E,EAAS,IAAK3E,EAAIE,KAAKC,KAChD8F,GAAKxB,KAAKd,UAAUqB,KAAMY,GACrBnB,KAAKd,UAAUyB,MAAOU,GACtBrB,KAAK,KAAMoB,GAGoB,IAAhCI,EAAK9B,OAAO+B,QAAQ,SACpBD,EAAK9B,KAAK2B,GAGlBK,cAEJC,OAAU,WACND,kBAIRjC,GAKR,GAAKH,GAAcJ,UAAU0C,aAwCzB,MAvCGrG,GAAIsG,kBACHrG,EAAED,EAAI8E,SAASyB,oBAAsB,IAAMvG,EAAI8E,SAASG,aACrDT,IAAIvE,EAAED,EAAIsG,iBAAiB7B,KAAKd,UAAUuB,MAC7CjF,EAAED,EAAI8E,SAASyB,oBAAsB,IAAMvG,EAAI8E,SAASK,eACrDX,IAAIvE,EAAED,EAAIsG,iBAAiB7B,KAAKd,UAAUyB,QAC7CnF,EAAED,EAAI8E,SAASyB,oBAAsB,IAAMvG,EAAI8E,SAASO,aACrDb,IAAIvE,EAAED,EAAIsG,iBAAiB7B,KAAKd,UAAU2B,WAEjDI,YACI,QACA,4TAaIc,OAAU,WACN,GAAIZ,GAAO3F,EAAED,EAAI8E,SAASG,aAAaT,KACpCoB,GAAKa,OAAS,IACfzG,EAAI+F,MAAMpC,UAAU+C,aAAc/B,GAClC1E,EAAE,YAAc0E,EAAS,IAAK3E,EAAIE,KAAKC,MAClCsE,KAAKd,UAAUuB,IAAKU,GACpBnB,KAAKd,UAAUyB,MAAOnF,EAAED,EAAI8E,SAASK,eAAeX,OACpDC,KAAKd,UAAU2B,IAAKrF,EAAED,EAAI8E,SAASO,aAAab,QAEvD2B,cAEJC,OAAU,WACND,eAsEhB,IA9DKpC,GAAcJ,UAAUgD,cACzBjB,WACI,QACA,gcAiBIc,OAAU,WACN,GAAII,GAAQ3G,EAAED,EAAI8E,SAAS+B,cAAcrC,MACrCsC,EAAQ7G,EAAED,EAAI8E,SAASiC,cAAcvC,KAEzC,IAAGoC,EAAQ,GAAKE,EAAQ,EAAG,CAEzB,GAAIE,GAAQhH,EAAIE,KAAK+G,cAActD,UAAUuD,OACzCC,EAAS,KAGDC,EAAWnH,EAAED,EAAI8E,SAASuC,iBAAiB7C,MAG3C8C,EAAaN,EAAMO,eAIvB,KAHAD,EAAWE,UAAYJ,EAGnBK,EAAE,EAAGA,EAAEb,EAAOa,IAEV,IADAN,EAASH,EAAMU,UAAUD,GACrBE,EAAE,EAAGA,EAAEb,EAAOa,IAAMR,EAAOS,WAAWD,EAI1D1H,GAAE+G,GAAOvC,KAAK,UACVxE,EAAED,EAAI8E,SAAS+C,iBAAiBrD,MAGpC,IAAIsD,GAAO7H,EAAED,EAAI+H,OAAO/H,EAAIgI,YAC1BrE,UAAUsE,kBAAkBC,IAAI,EAC9BJ,IAASA,EAAKK,WACblI,EAAE6H,GAAMM,MAAMpB,GADW/G,EAAED,EAAIE,KAAKC,MAAMkI,OAAOrB,GAGxDb,cAEJC,OAAU,WACND,gBAOXpC,GAAc3C,SAAS6B,qBAAuBc,GAAc3C,SAAS8B,qBACrEa,GAAc3C,SAAS+B,sBAAwBY,GAAc3C,SAASgC,kBACtEW,GAAc3C,SAASiC,0BAA4B,CAEpD,GAAIiF,EACJ,QAAOvE,GAEH,IAAK3C,UAA4B,oBAC7BkH,EAAYvH,cAAcK,SAASwB,aACnC,MACJ,KAAKxB,UAA4B,oBAC7BkH,EAAYvH,cAAcK,SAASyB,aACnC,MACJ,KAAKzB,UAA6B,qBAC9BkH,EAAYvH,cAAcK,SAAS0B,cACnC,MACJ,KAAK1B,UAAyB,iBAC1BkH,EAAYvH,cAAcK,SAAS2B,UACnC,MACJ,KAAK3B,UAAkC,0BACnCkH,EAAYvH,cAAcK,SAAS4B,oBAI3C/C,EAAEmC,MAEEE,IAAKgG,EAAUvG,cACfQ,QACAG,MAAO,WAAaC,MAAO,kBAAqB2F,EAAU1G,OAAOL,cAAgB,mBACjFgH,QAAS,SAASC,GAEd9C,WACI,kBAAoB4C,EAAU3G,SAC9B6G,EACA,+EACuBF,EAAU1G,OAAOL,cAAgB,0DAGpDiF,OAAU,WAGN,GAAIiC,IAAkB,CACuB,QAAxCxI,EAAE,4BAA4BuE,QAC/BiE,GAAkB,EAGP,IAAIC,MACnBzI,GAAE,0BAA0BG,KAAK,WAC7B,GAAI6B,GAAUhC,EAAEI,MAAMmE,KAGlBiE,IACAzG,qBAAqBsG,EAAUzG,WAAYI,EAASqG,EAAU3G,UAGlEgH,aAAeC,sBAAwB3G,EACvCT,SAAWmH,aAAajH,QAAS,kBAAmB4G,EAAUzG,YAC9D5B,EAAE4I,QAASrH,SAAU,SAAUsH,GAE3B9I,EAAI+F,MAAMpC,UAAUqC,YAAarB,EACjC,IAAIoE,GAAY9I,EAAE,UAAY0E,EAAS,IAAK3E,EAAIE,KAAKC,MAAMgE,MAI1C,KAAb4E,GAEAA,GAAapE,EAIb3E,EAAIgJ,OAAO,YAAcF,EAAmB7C,KAAO,KAAOqC,EAAU3G,SAAW,KAAOmH,EAAmBG,KAAO,SAKhHhJ,EAAE,UAAY0E,EAAS,IAAK3E,EAAIE,KAAKC,MAAMsE,KAAKd,UAAUqB,KAAM8D,EAAmB7C,MAAMxB,KAAKd,UAAUyB,MAAOkD,EAAU3G,SAAWM,OAKhJkE,cAEJC,OAAU,WAEND,mBAQxB,GAAKpC,GAAc3C,SAASkC,sBAAwBS,GAAc3C,SAASmC,sBAAwBQ,GAAc3C,SAASoC,uBAAyBO,GAAc3C,SAASqC,mBAAqBM,GAAc3C,SAASsC,2BAA6B,CAE/O,GAAI4E,EACJ,QAAOvE,GAEH,IAAK3C,UAA6B,qBAC9BkH,EAAYvH,cAAcK,SAASwB,aACnC,MACJ,KAAKxB,UAA6B,qBAC9BkH,EAAYvH,cAAcK,SAASyB,aACnC,MACJ,KAAKzB,UAA8B,sBAC/BkH,EAAYvH,cAAcK,SAAS0B,cACnC,MACJ,KAAK1B,UAA0B,kBAC3BkH,EAAYvH,cAAcK,SAAS2B,UACnC,MACJ,KAAK3B,UAAmC,2BACpCkH,EAAYvH,cAAcK,SAAS4B,oBAI3C/C,EAAEmC,MAEEE,IAAKgG,EAAUvG,cACfQ,QACAG,MAAO,WAAaC,MAAO,kBAAqB2F,EAAU1G,OAAOL,cAAgB,mBACjFgH,QAAS,SAASW,GAGVnF,GAAc3C,SAASkC,sBAAwBS,GAAc3C,SAASoC,uBACnEO,GAAc3C,SAASsC,6BAC1BwF,EAAYA,EAAY,+EACWZ,EAAU1G,OAAOL,cAAgB,0DACxEmE,WACI,SAAW4C,EAAU1G,OACrBsH,GAEIC,MAAS,WAGL,GAAIV,IAAkB,CACsB,OAAvCxI,EAAE,4BAA4BuE,QAC/BiE,GAAkB,GAEtBxI,EAAE,0BAA0BG,KAAK,WAE7B,GAAI6B,GAAUhC,EAAEI,MAAMmE,MAElB4E,EAAYnJ,EAAE,cAAgBgC,EAAU,YAAYkC,MAEpDsE,IACAzG,qBAAqBsG,EAAUzG,WAAYI,EAASqG,EAAU3G,SAKlE,IAAI0H,GAAcf,EAAUxG,OAAS,IAAOG,EACxCqH,GACA,YAAaD,EAAa,0BAClBf,EAAU3G,SAASJ,cAAe,iBACtC,oBACI,mBAAoB+G,EAAU3G,SAAU,KAAMyH,EAAW,IAC7D,OACA,sBACI,sEACAd,EAAU3G,SAASJ,cAAe,0BACtC,OACJ,UAAWgI,KAAM,GAGrBvJ,GAAIgJ,OAAOM,KAGfnD,cAEJC,OAAU,WAEND,qBAS5BlG,EAAE,WAEEA,EAAEuJ,UAAUC,UAAW,SAAWC,EAAGjC,GAEjC,GAAIkC,GAAUlC,EAAEmC,cAAgBnC,EAAEoC,YAAc,6BAEhD,OADAnE,YAAY,eAAgBiE,GAAWG,eAAiB3D,cACjD,IAGXlG,EAAE,uBAAuB8J,WACrBC,KAAM,SACNC,SAAUC,iBACVC,eAAgBC,iBAChBC,QAAW,uFAEG1G,UAAU2G,MACV,0FAIA3G,UAAU4G,OACV5G,UAAU6G,OACV,iCAGdC,aACKxB,KAAQ,OAAQyB,MAAS,SAAUC,IAAO,qBAC1C1B,KAAQ,SAAUyB,MAAS,WAAYC,IAAO,uBAC9C1B,KAAQ,cAAeyB,MAAS,cAAeC,IAAO,0BACtD1B,KAAQ,YAAayB,MAAS,YAAaC,IAAO,wBAClD1B,KAAQ,oBAAqByB,MAAS,eAAgBC,IAAO,2BAC7D1B,KAAQ,sBAAuByB,MAAS,iBAAkBC,IAAO,6BACjE1B,KAAQ,SAAUyB,MAAS,SAAUC,IAAO,qBAC5C1B,KAAQ,UAAWyB,MAAS,UAAWC,IAAO,sBAC9C1B,KAAQ,OAAQyB,MAAS,OAAQC,IAAO,mBACxC1B,KAAQ,OAAQyB,MAAS,OAAQC,IAAO,mBACxC1B,KAAQ,aAAcyB,MAAS,OAAQC,IAAO,mBAC9C1B,KAAQ,SAAUyB,MAAS,SAAUC,IAAO,qBAC5C1B,KAAQ,cAAeyB,MAAS,QAASC,IAAO,oBAChD1B,KAAQ,cAAeyB,MAAS,QAASC,IAAO,qBAIzD,IAAI/G,GAAS3D,EAAE2K,WAAW,GACtBC,EAAO,SAAWC,GAClBpF,WAAY,cAAe,YAG3BzF,EAAEmC,MACEE,IAAKyI,SACL1I,KAAM,OACNE,MACIC,GAAIwI,QACJC,QAASrH,EAAOsH,QAChBC,YAAaC,KAAKC,UAAU,GAAIC,SAEhCC,EAAK,QAEThD,QAAS,WACLuC,OAKZ7K,GAAE,gBAAgBK,MAAO,WACrBuK,EAAM,WAAa1E,iBAGvBlG,EAAE,iBAAiBK,MAAM,WAoBjBK,OAAO6I,SAASgC,SAAWC,eAUnC,IAAIC,GAAkBzL,EAAE,kIACxBA,GAAE,iBAAiBoI,OAAQqD,EAG3B,IAAIC,KACJ1L,GAAEG,KAAMwD,EAAOkB,SAAS8G,gBAAiB,SAAUC,EAAGC,GAClD,GAAIC,GAAUD,EAAE7C,IAChB0C,GAAOG,EAAEpB,MAAMhJ,QAAS,IAAK,MAAU,WAAakC,EAAOoE,UAAW+D,MAE1EC,eAAgBN,EAAiBC,EAOjC,IAAIM,GAA0BhM,EAAE,+GAA+GoE,SAAS,4BACxJpE,GAAE,iBAAiBoI,OAAO4D,GAG1BD,eAAgBC,GACZC,sBAAuB,WACnBtI,EAAOE,OAAO1C,SAAS6B,sBAE3BkJ,sBAAuB,WACnBvI,EAAOE,OAAO1C,SAAS8B,sBAE3BkJ,uBAAwB,WACpBxI,EAAOE,OAAO1C,SAAS+B,uBAE3BkJ,mBAAoB,WAChBzI,EAAOE,OAAO1C,SAASgC,mBAE3BkJ,4BAA6B,WACzB1I,EAAOE,OAAO1C,SAASiC,6BAS/B,IAAIkJ,GAAsBtM,EAAE,uGAAuGoE,SAAS,4BAC5IpE,GAAE,iBAAiBoI,OAAOkE,GAG1BP,eAAgBO,GACZC,gBAAiB,WACb5I,EAAOE,OAAO1C,SAASkC,uBAE3BmJ,gBAAiB,WACb7I,EAAOE,OAAO1C,SAASmC,uBAE3BmJ,iBAAkB,WACd9I,EAAOE,OAAO1C,SAASoC,wBAE3BmJ,sBAAuB,WACnB/I,EAAOE,OAAO1C,SAASsC","file":"../scripts/galaxy.pages.js","sourcesContent":["\nvar CONTROLS =\n{\n    // Item types.\n    ITEM_HISTORY : \"item_history\",\n    ITEM_DATASET : \"item_dataset\",\n    ITEM_WORKFLOW : \"item_workflow\",\n    ITEM_PAGE : \"item_page\",\n    ITEM_VISUALIZATION : \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK : \"link_history\",\n    DIALOG_DATASET_LINK : \"link_dataset\",\n    DIALOG_WORKFLOW_LINK : \"link_workflow\",\n    DIALOG_PAGE_LINK : \"link_page\",\n    DIALOG_VISUALIZATION_LINK : \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY : \"embed_history\",\n    DIALOG_EMBED_DATASET : \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW : \"embed_workflow\",\n    DIALOG_EMBED_PAGE : \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION : \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym)\n{\n    // Set up events to make annotation easy.\n    $('.annotation', wym._doc.body).each( function()\n    {\n         $(this).click( function() {\n             // Works in Safari, not in Firefox.\n             var range = wym._doc.createRange();\n             range.selectNodeContents( this );\n             var selection = window.getSelection();\n             selection.removeAllRanges();\n             selection.addRange(range);\n             var t = \"\";\n         });\n    });\n\n};\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info( dialog_type )\n{\n    var\n        item_singular,\n        item_plural,\n        item_controller;\n    switch( dialog_type ) {\n        case( CONTROLS.ITEM_HISTORY ):\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case( CONTROLS.ITEM_DATASET ):\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case( CONTROLS.ITEM_WORKFLOW ):\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case( CONTROLS.ITEM_PAGE ):\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case( CONTROLS.ITEM_VISUALIZATION ):\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace( \"LIST_ACTION\", item_list_action );\n\n    // Set up and return dict.\n    return {\n        singular : item_singular,\n        plural : item_plural,\n        controller : item_controller,\n        iclass : item_class,\n        list_ajax_url : ajax_url\n    };\n};\n\n// Make an item importable.\nfunction make_item_importable( item_controller, item_id, item_type )\n{\n    ajax_url = set_accessible_url.replace( \"ITEM_CONTROLLER\", item_controller );\n    $.ajax({\n      type: \"POST\",\n      url: ajax_url,\n      data: { id: item_id, accessible: 'True' },\n      error: function() { alert(\"Making \" + item_type + \" accessible failed\"); }\n    });\n};\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function( dialogType, dialogFeatures, bodyHtml ) {\n\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id()\n    {\n        // When \"set link id\" link clicked, update UI.\n        $('#set_link_id').click( function()\n        {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected)\n                attribute_input.val( $(selected).attr('id') );\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if ( dialogType == WYMeditor.DIALOG_LINK ) {\n        if(selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected)\n        {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined)\n                curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined)\n                curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" + curURL + \"' size='40' /></div>\"\n                + \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" + curTitle + \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || '',\n                        sId = $(\".wym_id\").val() || '',\n                        sName = $(wym._options.titleSelector).val() || '';\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link.attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf('wym-') === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_IMAGE ) {\n        if(wym._selected_image) {\n            $(wym._options.dialogImageSelector + \" \" + wym._options.srcSelector)\n              .val($(wym._selected_image).attr(WYMeditor.SRC));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.titleSelector)\n              .val($(wym._selected_image).attr(WYMeditor.TITLE));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.altSelector)\n              .val($(wym._selected_image).attr(WYMeditor.ALT));\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\"\n                + \"<label>URL</label><br>\"\n                + \"<input type='text' class='wym_src' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Alt text</label><br>\"\n                + \"<input type='text' class='wym_alt' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Title</label><br>\"\n                + \"<input type='text' class='wym_title' value='' size='40' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if(sUrl.length > 0) {\n                      wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                      $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                          .attr(WYMeditor.SRC, sUrl)\n                          .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                          .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_TABLE ) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\"\n                + \"<label>Caption</label><br>\"\n                + \"<input type='text' class='wym_caption' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Summary</label><br>\"\n                + \"<input type='text' class='wym_summary' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Rows<br></label>\"\n                + \"<input type='text' class='wym_rows' value='3' size='3' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Cols<br></label>\"\n                + \"<input type='text' class='wym_cols' value='2' size='3' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if(iRows > 0 && iCols > 0) {\n\n                      var table = wym._doc.createElement(WYMeditor.TABLE);\n                      var newRow = null;\n                              var newCol = null;\n\n                              var sCaption = $(wym._options.captionSelector).val();\n\n                              //we create the caption\n                              var newCaption = table.createCaption();\n                              newCaption.innerHTML = sCaption;\n\n                              //we create the rows and cells\n                              for(x=0; x<iRows; x++) {\n                                      newRow = table.insertRow(x);\n                                      for(y=0; y<iCols; y++) {newRow.insertCell(y);}\n                              }\n\n                      //set the summary attr\n                      $(table).attr('summary',\n                          $(wym._options.summarySelector).val());\n\n                      //append the table after the selected container\n                      var node = $(wym.findUp(wym.container(),\n                        WYMeditor.MAIN_CONTAINERS)).get(0);\n                      if(!node || !node.parentNode) $(wym._doc.body).append(table);\n                      else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if ( dialogType == CONTROLS.DIALOG_HISTORY_LINK || dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n         dialogType == CONTROLS.DIALOG_WORKFLOW_LINK || dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n         dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_HISTORY_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_DATASET_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_WORKFLOW_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_PAGE_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_VISUALIZATION_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        $.ajax(\n        {\n            url: item_info.list_ajax_url,\n            data: {},\n            error: function() { alert( \"Failed to list \"  + item_info.plural.toLowerCase() + \" for selection\"); },\n            success: function(table_html)\n            {\n                show_modal(\n                    \"Insert Link to \" + item_info.singular,\n                    table_html +\n                    \"<div><input id='make-importable' type='checkbox' checked/>\" +\n                    \"Make the selected \" + item_info.plural.toLowerCase() + \" accessible so that they can viewed by everyone.</div>\"\n                    ,\n                    {\n                        \"Insert\": function()\n                        {\n                            // Make selected items accessible (importable) ?\n                            var make_importable = false;\n                            if ( $('#make-importable:checked').val() !== null )\n                                make_importable = true;\n\n                            // Insert links to history for each checked item.\n                            var item_ids = new Array();\n                            $('input[name=id]:checked').each(function() {\n                                var item_id = $(this).val();\n\n                                // Make item importable?\n                                if (make_importable)\n                                    make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                                // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                                url_template = get_name_and_link_url + item_id;\n                                ajax_url = url_template.replace( \"ITEM_CONTROLLER\", item_info.controller);\n                                $.getJSON( ajax_url, function( returned_item_info ) {\n                                    // Get link text.\n                                    wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                                    var link_text = $(\"a[href=\" + sStamp + \"]\", wym._doc.body).text();\n\n                                    // Insert link: need to do different actions depending on link text.\n                                    if (\n                                        link_text == \"\" // Firefox.\n                                        ||\n                                        link_text == sStamp // Safari\n                                        )\n                                    {\n                                        // User selected no text; create link from scratch and use default text.\n                                        wym.insert(\"<a href='\" + returned_item_info.link + \"'>\" + item_info.singular + \" '\" + returned_item_info.name + \"'</a>\");\n                                    }\n                                    else\n                                    {\n                                        // Link created from selected text; add href and title.\n                                        $(\"a[href=\" + sStamp + \"]\", wym._doc.body).attr(WYMeditor.HREF, returned_item_info.link).attr(WYMeditor.TITLE, item_info.singular + item_id);\n                                    }\n                                });\n                            });\n\n                            hide_modal();\n                        },\n                        \"Cancel\": function()\n                        {\n                            hide_modal();\n                        }\n                    }\n                );\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if ( dialogType == CONTROLS.DIALOG_EMBED_HISTORY || dialogType == CONTROLS.DIALOG_EMBED_DATASET || dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW || dialogType == CONTROLS.DIALOG_EMBED_PAGE || dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_EMBED_HISTORY):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_EMBED_DATASET):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_EMBED_WORKFLOW):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_EMBED_PAGE):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_EMBED_VISUALIZATION):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        $.ajax(\n        {\n            url: item_info.list_ajax_url,\n            data: {},\n            error: function() { alert( \"Failed to list \"  + item_info.plural.toLowerCase() + \" for selection\"); },\n            success: function(list_html)\n            {\n                // Can make histories, workflows importable; cannot make datasets importable.\n                if (dialogType == CONTROLS.DIALOG_EMBED_HISTORY || dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW\n                    || dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION)\n                    list_html = list_html + \"<div><input id='make-importable' type='checkbox' checked/>\" +\n                                \"Make the selected \" + item_info.plural.toLowerCase() + \" accessible so that they can viewed by everyone.</div>\";\n                show_modal(\n                    \"Embed \" + item_info.plural,\n                    list_html,\n                    {\n                        \"Embed\": function()\n                        {\n                            // Make selected items accessible (importable) ?\n                            var make_importable = false;\n                            if ( $('#make-importable:checked').val() != null )\n                                make_importable = true;\n\n                            $('input[name=id]:checked').each(function() {\n                                // Get item ID and name.\n                                var item_id = $(this).val();\n                                // Use ':first' because there are many labels in table; the first one is the item name.\n                                var item_name = $(\"label[for='\" + item_id + \"']:first\").text();\n\n                                if (make_importable)\n                                    make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                                // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                                // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                                // item_class='History').\n                                var item_elt_id = item_info.iclass + \"-\"  + item_id;\n                                var item_embed_html = [\n                                    \"<div id='\", item_elt_id, \"' class='embedded-item \",\n                                            item_info.singular.toLowerCase(), \" placeholder'>\",\n                                        \"<p class='title'>\",\n                                            \"Embedded Galaxy \", item_info.singular, \" '\", item_name, \"'\",\n                                        \"</p>\",\n                                        \"<p class='content'>\",\n                                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                                            item_info.singular.toLowerCase(), \" when it is displayed.]\",\n                                        \"</p>\",\n                                    \"</div>\" ].join( '' );\n\n                                // Insert embedded item into document.\n                                wym.insert(item_embed_html);\n\n                            });\n                            hide_modal();\n                        },\n                        \"Cancel\": function()\n                        {\n                            hide_modal();\n                        }\n                    }\n                );\n            }\n        });\n    }\n};\n\n$(function(){\n    // Generic error handling\n    $(document).ajaxError( function ( e, x ) {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal( \"Server error\", message, { \"Ignore error\" : hide_modal } );\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor( {\n        skin: 'galaxy',\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:   \"<table class='wym_box' width='100%' height='100%'>\"\n                    + \"<tr><td><div class='wym_area_top'>\"\n                    + WYMeditor.TOOLS\n                    + \"</div></td></tr>\"\n                    + \"<tr height='100%'><td>\"\n                    + \"<div class='wym_area_main' style='height: 100%;'>\"\n                    // + WYMeditor.HTML\n                    + WYMeditor.IFRAME\n                    + WYMeditor.STATUS\n                    + \"</div>\"\n                    + \"</div>\"\n                    + \"</td></tr></table>\",\n        toolsItems: [\n            {'name': 'Bold', 'title': 'Strong', 'css': 'wym_tools_strong'},\n            {'name': 'Italic', 'title': 'Emphasis', 'css': 'wym_tools_emphasis'},\n            {'name': 'Superscript', 'title': 'Superscript', 'css': 'wym_tools_superscript'},\n            {'name': 'Subscript', 'title': 'Subscript', 'css': 'wym_tools_subscript'},\n            {'name': 'InsertOrderedList', 'title': 'Ordered_List', 'css': 'wym_tools_ordered_list'},\n            {'name': 'InsertUnorderedList', 'title': 'Unordered_List', 'css': 'wym_tools_unordered_list'},\n            {'name': 'Indent', 'title': 'Indent', 'css': 'wym_tools_indent'},\n            {'name': 'Outdent', 'title': 'Outdent', 'css': 'wym_tools_outdent'},\n            {'name': 'Undo', 'title': 'Undo', 'css': 'wym_tools_undo'},\n            {'name': 'Redo', 'title': 'Redo', 'css': 'wym_tools_redo'},\n            {'name': 'CreateLink', 'title': 'Link', 'css': 'wym_tools_link'},\n            {'name': 'Unlink', 'title': 'Unlink', 'css': 'wym_tools_unlink'},\n            {'name': 'InsertImage', 'title': 'Image', 'css': 'wym_tools_image'},\n            {'name': 'InsertTable', 'title': 'Table', 'css': 'wym_tools_table'},\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function ( callback ) {\n        show_modal( \"Saving page\", \"progress\" );\n\n        // Do save.\n        $.ajax( {\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                \"_\": \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    }\n    // Save button\n    $(\"#save-button\").click( function() {\n        save( function() { hide_modal(); } )\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if ( changed ) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal( \"Close editor\",\n                        \"There are unsaved changes to your page which will be lost.\",\n                        {\n                            \"Cancel\" : hide_modal,\n                            \"Save Changes\" : function() {\n                                save( do_close );\n                            }\n                        }, {\n                            \"Don't Save\": do_close\n                        } );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\");\n    $(\".wym_area_top\").append( containers_menu );\n\n    // Add menu options.\n    var items = {}\n    $.each( editor._options.containersItems, function( k, v ) {\n        var tagname = v.name;\n        items[ v.title.replace( '_', ' ' ) ] = function() { editor.container( tagname ) }\n    });\n    make_popupmenu( containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu( insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        },\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu( embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        },\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n});\n"]}