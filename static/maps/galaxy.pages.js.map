{"version":3,"sources":["galaxy.pages.js"],"names":["init_galaxy_elts","wym","$","_doc","body","each","this","range","selection","window","addRange","getSelection","removeAllRanges","get_item_info","ITEM_HISTORY","item_plural","item_controller","item_class","dialog_type","item_singular","CONTROLS","ITEM_VISUALIZATION","item_list_action","ajax_url","list_objects_url","controller","toLowerCase","iclass","replace","singular","plural","make_item_importable","set_accessible_url","ajax","alert","item_type","item_id","type","url","WYMeditor","editor","prototype","dialog","error","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","DIALOG_HISTORY_LINK","DIALOG_DATASET_LINK","DIALOG_WORKFLOW_LINK","DIALOG_PAGE_LINK","DIALOG_VISUALIZATION_LINK","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","DIALOG_EMBED_WORKFLOW","DIALOG_EMBED_PAGE","DIALOG_EMBED_VISUALIZATION","dialogType","dialogFeatures","bodyHtml","uniqueStamp","selected","DIALOG_LINK","curURL","undefined","attr","HREF","curTitle","val","SRC","TITLE","_options","altSelector","ALT","sName","sUrl","_exec","show_modal","link","text","hrefSelector","hide_modal","titleSelector","set_link_id","CREATE_LINK","sStamp","DIALOG_IMAGE","_selected_image","dialogImageSelector","indexOf","attribute_input","addClass","removeClass","srcSelector","iRows","rowsSelector","iCols","colsSelector","newRow","length","INSERT_IMAGE","item_info","Insert","GridView","url_base","list_ajax_url","title","closing_events","createElement","TABLE","make_importable","captionSelector","table","createCaption","innerHTML","sCaption","x","insertRow","y","getJSON","returned_item_info","node","link_text","container","MAIN_CONTAINERS","get","parentNode","after","append","Galaxy","modal","require","grid","dict_format","embedded","$el","Array","item_name","url_template","get_name_and_link_url","item_elt_id","item_embed_html","insert","name","hide","Close","toolsItems","wymeditors","save_url","data","id","page_id","content","annotations","show","buttons","Embed","do_close","document","location","page_list_url","join","containersItems","tagname","insert_link_menu_button","e","message","responseText","statusText","make_popupmenu","Ignore error","wymeditor","skin","iframeBasePath","iframe_base_path","boxHtml","TOOLS","STATUS","css","embed_object_button","xhtml","JSON","stringify","Object","_","success","callback","click","save","containers_menu","items","k","v","Insert History Link","Insert Dataset Link","Insert Workflow Link","Insert Page Link","Insert Visualization Link","Embed History","Embed Dataset","Embed Workflow","Embed Visualization"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["\nvar CONTROLS =\n{\n    // Item types.\n    ITEM_HISTORY : \"item_history\",\n    ITEM_DATASET : \"item_dataset\",\n    ITEM_WORKFLOW : \"item_workflow\",\n    ITEM_PAGE : \"item_page\",\n    ITEM_VISUALIZATION : \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK : \"link_history\",\n    DIALOG_DATASET_LINK : \"link_dataset\",\n    DIALOG_WORKFLOW_LINK : \"link_workflow\",\n    DIALOG_PAGE_LINK : \"link_page\",\n    DIALOG_VISUALIZATION_LINK : \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY : \"embed_history\",\n    DIALOG_EMBED_DATASET : \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW : \"embed_workflow\",\n    DIALOG_EMBED_PAGE : \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION : \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym)\n{\n    // Set up events to make annotation easy.\n    $('.annotation', wym._doc.body).each( function()\n    {\n         $(this).click( function() {\n             // Works in Safari, not in Firefox.\n             var range = wym._doc.createRange();\n             range.selectNodeContents( this );\n             var selection = window.getSelection();\n             selection.removeAllRanges();\n             selection.addRange(range);\n             var t = \"\";\n         });\n    });\n\n};\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info( dialog_type )\n{\n    var\n        item_singular,\n        item_plural,\n        item_controller;\n    switch( dialog_type ) {\n        case( CONTROLS.ITEM_HISTORY ):\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case( CONTROLS.ITEM_DATASET ):\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case( CONTROLS.ITEM_WORKFLOW ):\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case( CONTROLS.ITEM_PAGE ):\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case( CONTROLS.ITEM_VISUALIZATION ):\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = \"list_\" + item_plural.toLowerCase() + \"_for_selection\";\n    var ajax_url = list_objects_url.replace( \"LIST_ACTION\", item_list_action );\n\n    // Set up and return dict.\n    return {\n        singular : item_singular,\n        plural : item_plural,\n        controller : item_controller,\n        iclass : item_class,\n        list_ajax_url : ajax_url\n    };\n};\n\n// Make an item importable.\nfunction make_item_importable( item_controller, item_id, item_type )\n{\n    ajax_url = set_accessible_url.replace( \"ITEM_CONTROLLER\", item_controller );\n    $.ajax({\n      type: \"POST\",\n      url: ajax_url,\n      data: { id: item_id, accessible: 'True' },\n      error: function() { alert(\"Making \" + item_type + \" accessible failed\"); }\n    });\n};\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function( dialogType, dialogFeatures, bodyHtml ) {\n\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id()\n    {\n        // When \"set link id\" link clicked, update UI.\n        $('#set_link_id').click( function()\n        {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected)\n                attribute_input.val( $(selected).attr('id') );\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if ( dialogType == WYMeditor.DIALOG_LINK ) {\n        if(selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n        // Get current URL, title.\n        var curURL, curTitle;\n        if (selected)\n        {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined)\n                curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined)\n                curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            \"<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='\" + curURL + \"' size='40' /></div>\"\n                + \"<div><label>Title</label><br><input type='text' class='wym_title' value='\" + curTitle + \"' size='40' /></div><div>\",\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || '',\n                        sId = $(\".wym_id\").val() || '',\n                        sName = $(wym._options.titleSelector).val() || '';\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(\"a[href=\" + sStamp + \"]\", wym._doc.body);\n                        link.attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf('wym-') === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_IMAGE ) {\n        if(wym._selected_image) {\n            $(wym._options.dialogImageSelector + \" \" + wym._options.srcSelector)\n              .val($(wym._selected_image).attr(WYMeditor.SRC));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.titleSelector)\n              .val($(wym._selected_image).attr(WYMeditor.TITLE));\n            $(wym._options.dialogImageSelector + \" \" + wym._options.altSelector)\n              .val($(wym._selected_image).attr(WYMeditor.ALT));\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\"\n                + \"<label>URL</label><br>\"\n                + \"<input type='text' class='wym_src' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Alt text</label><br>\"\n                + \"<input type='text' class='wym_alt' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Title</label><br>\"\n                + \"<input type='text' class='wym_title' value='' size='40' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if(sUrl.length > 0) {\n                      wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                      $(\"img[src$=\" + sStamp + \"]\", wym._doc.body)\n                          .attr(WYMeditor.SRC, sUrl)\n                          .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                          .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if ( dialogType == WYMeditor.DIALOG_TABLE ) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\"\n                + \"<label>Caption</label><br>\"\n                + \"<input type='text' class='wym_caption' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Summary</label><br>\"\n                + \"<input type='text' class='wym_summary' value='' size='40' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Rows<br></label>\"\n                + \"<input type='text' class='wym_rows' value='3' size='3' />\"\n                + \"</div>\"\n                + \"<div class='row'>\"\n                + \"<label>Number Of Cols<br></label>\"\n                + \"<input type='text' class='wym_cols' value='2' size='3' />\"\n                + \"</div>\",\n            {\n                \"Insert\": function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if(iRows > 0 && iCols > 0) {\n\n                      var table = wym._doc.createElement(WYMeditor.TABLE);\n                      var newRow = null;\n                              var newCol = null;\n\n                              var sCaption = $(wym._options.captionSelector).val();\n\n                              //we create the caption\n                              var newCaption = table.createCaption();\n                              newCaption.innerHTML = sCaption;\n\n                              //we create the rows and cells\n                              for(x=0; x<iRows; x++) {\n                                      newRow = table.insertRow(x);\n                                      for(y=0; y<iCols; y++) {newRow.insertCell(y);}\n                              }\n\n                      //set the summary attr\n                      $(table).attr('summary',\n                          $(wym._options.summarySelector).val());\n\n                      //append the table after the selected container\n                      var node = $(wym.findUp(wym.container(),\n                        WYMeditor.MAIN_CONTAINERS)).get(0);\n                      if(!node || !node.parentNode) $(wym._doc.body).append(table);\n                      else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                \"Cancel\": function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if ( dialogType == CONTROLS.DIALOG_HISTORY_LINK || dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n         dialogType == CONTROLS.DIALOG_WORKFLOW_LINK || dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n         dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_HISTORY_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_DATASET_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_WORKFLOW_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_PAGE_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_VISUALIZATION_LINK):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require( [ 'mvc/grid/grid-view' ], function( GridView ) {\n            var grid = new GridView( { url_base: item_info.list_ajax_url, dict_format: true, embedded: true } );\n            Galaxy.modal.show({\n                title           : 'Insert Link to ' + item_info.singular,\n                body            : $( '<div/>' ).append( grid.$el )\n                                               .append( $( '<div/>' ).append( '<input id=\"make-importable\" type=\"checkbox\" checked/>' )\n                                                                     .append( 'Make the selected ' + item_info.plural.toLowerCase() + ' accessible so that they can viewed by everyone.' ) ),\n                closing_events  : true,\n                buttons         : {\n                    'Insert': function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ( $('#make-importable:checked').val() != null )\n                            make_importable = true;\n\n                        // Insert links to history for each checked item.\n                        var item_ids = new Array();\n                        grid.$('input[name=id]:checked').each(function() {\n                            var item_id = $(this).val();\n\n                            // Make item importable?\n                            if (make_importable)\n                                make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                            // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                            url_template = get_name_and_link_url + item_id;\n                            ajax_url = url_template.replace( \"ITEM_CONTROLLER\", item_info.controller);\n                            $.getJSON( ajax_url, function( returned_item_info ) {\n                                // Get link text.\n                                wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                                var link_text = $(\"a[href=\" + sStamp + \"]\", wym._doc.body).text();\n\n                                // Insert link: need to do different actions depending on link text.\n                                if (\n                                    link_text == \"\" // Firefox.\n                                    ||\n                                    link_text == sStamp // Safari\n                                    )\n                                {\n                                    // User selected no text; create link from scratch and use default text.\n                                    wym.insert(\"<a href='\" + returned_item_info.link + \"'>\" + item_info.singular + \" '\" + returned_item_info.name + \"'</a>\");\n                                }\n                                else\n                                {\n                                    // Link created from selected text; add href and title.\n                                    $(\"a[href=\" + sStamp + \"]\", wym._doc.body).attr(WYMeditor.HREF, returned_item_info.link).attr(WYMeditor.TITLE, item_info.singular + item_id);\n                                }\n                            });\n                        });\n                        Galaxy.modal.hide();\n\n                    },\n                    'Close' : function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if ( dialogType == CONTROLS.DIALOG_EMBED_HISTORY || dialogType == CONTROLS.DIALOG_EMBED_DATASET || dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW || dialogType == CONTROLS.DIALOG_EMBED_PAGE || dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch(dialogType)\n        {\n            case(CONTROLS.DIALOG_EMBED_HISTORY):\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case(CONTROLS.DIALOG_EMBED_DATASET):\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case(CONTROLS.DIALOG_EMBED_WORKFLOW):\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case(CONTROLS.DIALOG_EMBED_PAGE):\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case(CONTROLS.DIALOG_EMBED_VISUALIZATION):\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        require( [ 'mvc/grid/grid-view' ], function( GridView ) {\n            var grid = new GridView( { url_base: item_info.list_ajax_url, dict_format: true, embedded: true } );\n            Galaxy.modal.show({\n                title           : 'Insert Link to ' + item_info.singular,\n                body            : $( '<div/>' ).append( grid.$el )\n                                               .append( $( '<div/>' ).append( '<input id=\"make-importable\" type=\"checkbox\" checked/>' )\n                                                                     .append( 'Make the selected ' + item_info.plural.toLowerCase() + ' accessible so that they can viewed by everyone.' ) ),\n                closing_events  : true,\n                buttons         : {\n                    'Embed': function() {\n                        // Make selected items accessible (importable) ?\n                        var make_importable = false;\n                        if ( $('#make-importable:checked').val() != null )\n                            make_importable = true;\n\n                        grid.$('input[name=id]:checked').each(function() {\n                            // Get item ID and name.\n                            var item_id = $(this).val();\n                            // Use ':first' because there are many labels in table; the first one is the item name.\n                            var item_name = $(\"label[for='\" + item_id + \"']:first\").text();\n\n                            if (make_importable)\n                                make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                            // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                            // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                            // item_class='History').\n                            var item_elt_id = item_info.iclass + \"-\"  + item_id;\n                            var item_embed_html = [\n                                \"<div id='\", item_elt_id, \"' class='embedded-item \",\n                                        item_info.singular.toLowerCase(), \" placeholder'>\",\n                                    \"<p class='title'>\",\n                                        \"Embedded Galaxy \", item_info.singular, \" '\", item_name, \"'\",\n                                    \"</p>\",\n                                    \"<p class='content'>\",\n                                        \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                                        item_info.singular.toLowerCase(), \" when it is displayed.]\",\n                                    \"</p>\",\n                                \"</div>\" ].join( '' );\n\n                            // Insert embedded item into document.\n                            wym.insert(item_embed_html);\n                        });\n                        Galaxy.modal.hide();\n                    },\n                    'Close' : function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    }\n};\n\n$(function(){\n    // Generic error handling\n    $(document).ajaxError( function ( e, x ) {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal( \"Server error\", message, { \"Ignore error\" : hide_modal } );\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor( {\n        skin: 'galaxy',\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        boxHtml:   \"<table class='wym_box' width='100%' height='100%'>\"\n                    + \"<tr><td><div class='wym_area_top'>\"\n                    + WYMeditor.TOOLS\n                    + \"</div></td></tr>\"\n                    + \"<tr height='100%'><td>\"\n                    + \"<div class='wym_area_main' style='height: 100%;'>\"\n                    // + WYMeditor.HTML\n                    + WYMeditor.IFRAME\n                    + WYMeditor.STATUS\n                    + \"</div>\"\n                    + \"</div>\"\n                    + \"</td></tr></table>\",\n        toolsItems: [\n            {'name': 'Bold', 'title': 'Strong', 'css': 'wym_tools_strong'},\n            {'name': 'Italic', 'title': 'Emphasis', 'css': 'wym_tools_emphasis'},\n            {'name': 'Superscript', 'title': 'Superscript', 'css': 'wym_tools_superscript'},\n            {'name': 'Subscript', 'title': 'Subscript', 'css': 'wym_tools_subscript'},\n            {'name': 'InsertOrderedList', 'title': 'Ordered_List', 'css': 'wym_tools_ordered_list'},\n            {'name': 'InsertUnorderedList', 'title': 'Unordered_List', 'css': 'wym_tools_unordered_list'},\n            {'name': 'Indent', 'title': 'Indent', 'css': 'wym_tools_indent'},\n            {'name': 'Outdent', 'title': 'Outdent', 'css': 'wym_tools_outdent'},\n            {'name': 'Undo', 'title': 'Undo', 'css': 'wym_tools_undo'},\n            {'name': 'Redo', 'title': 'Redo', 'css': 'wym_tools_redo'},\n            {'name': 'CreateLink', 'title': 'Link', 'css': 'wym_tools_link'},\n            {'name': 'Unlink', 'title': 'Unlink', 'css': 'wym_tools_unlink'},\n            {'name': 'InsertImage', 'title': 'Image', 'css': 'wym_tools_image'},\n            {'name': 'InsertTable', 'title': 'Table', 'css': 'wym_tools_table'},\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = function ( callback ) {\n        show_modal( \"Saving page\", \"progress\" );\n\n        // Do save.\n        $.ajax( {\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                \"_\": \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    }\n    // Save button\n    $(\"#save-button\").click( function() {\n        save( function() { hide_modal(); } )\n    });\n    // Close button\n    $(\"#close-button\").click(function() {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if ( changed ) {\n            var do_close = function() {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal( \"Close editor\",\n                        \"There are unsaved changes to your page which will be lost.\",\n                        {\n                            \"Cancel\" : hide_modal,\n                            \"Save Changes\" : function() {\n                                save( do_close );\n                            }\n                        }, {\n                            \"Don't Save\": do_close\n                        } );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\");\n    $(\".wym_area_top\").append( containers_menu );\n\n    // Add menu options.\n    var items = {}\n    $.each( editor._options.containersItems, function( k, v ) {\n        var tagname = v.name;\n        items[ v.title.replace( '_', ' ' ) ] = function() { editor.container( tagname ) }\n    });\n    make_popupmenu( containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu( insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        },\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\").addClass('galaxy-page-editor-button');\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu( embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        },\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n});\n"]}