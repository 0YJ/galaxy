webpackJsonp([5],{137:function(t,e,n){"use strict";(function(t){function n(t,e){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#D8B365",t&&e&&this.connect(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),t.extend(n.prototype,{connect:function(t,e){this.handle1=t,this.handle1&&this.handle1.connect(this),this.handle2=e,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),t(this.canvas).remove()},destroyIfInvalid:function(){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&this.destroy()},redraw:function(){var e=t("#canvas-container");this.canvas||(this.canvas=document.createElement("canvas"),e.append(t(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300"));var n=function(n){return t(n).offset().left-e.offset().left},o=function(n){return t(n).offset().top-e.offset().top};if(this.handle1&&this.handle2){var i=n(this.handle1.element)+5,a=o(this.handle1.element)+5,s=n(this.handle2.element)+5,l=o(this.handle2.element)+5,r=Math.min(i,s),c=Math.max(i,s),u=Math.min(a,l),d=Math.max(a,l),p=Math.min(Math.max(Math.abs(d-u)/2,100),300),h=r-100,f=u-100,w=c-r+200,_=d-u+200;this.canvas.style.left=h+"px",this.canvas.style.top=f+"px",this.canvas.setAttribute("width",w),this.canvas.setAttribute("height",_),i-=h,a-=f,s-=h,l-=f;var m=(this.canvas.getContext("2d"),null),v=null,g=1;if(this.handle1&&this.handle1.isMappedOver()){var m=[-6,-3,0,3,6];g=5}else var m=[0];if(this.handle2&&this.handle2.isMappedOver()){var v=[-6,-3,0,3,6];g=5}else var v=[0];for(var y=this,b=0;b<g;b++){var k=5,x=7;(m.length>1||v.length>1)&&(k=1,x=3),y.draw_outlined_curve(i,a,s,l,p,k,x,m[b%m.length],v[b%v.length])}}},draw_outlined_curve:function(t,e,n,o,i,a,s,l,r){var l=l||0,r=r||0,c=this.canvas.getContext("2d");c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=s,c.beginPath(),c.moveTo(t,e+l),c.bezierCurveTo(t+i,e+l,n-i,o+r,n,o+r),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=a,c.beginPath(),c.moveTo(t,e+l),c.bezierCurveTo(t+i,e+l,n-i,o+r,n,o+r),c.stroke()}}),e.default=n}).call(e,n(0))},273:function(t,e,n){"use strict";function o(t){new a.default(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var i=n(274),a=function(t){return t&&t.__esModule?t:{default:t}}(i);window.workflowApp=o},274:function(t,e,n){"use strict";(function(t,o,i){function a(t){return t&&t.__esModule?t:{default:t}}function s(e){var n=t("#galaxy_tools").contents();if(0===n.length&&(n=t(document),t(this).removeClass("search_active"),n.find(".toolTitle").removeClass("search_match"),n.find(".toolSectionBody").hide(),n.find(".toolTitle").show(),n.find(".toolPanelLabel").show(),n.find(".toolSectionWrapper").each(function(){"recently_used_wrapper"!==t(this).attr("id")?t(this).show():t(this).hasClass("user_pref_visible")&&t(this).show()}),n.find("#search-no-results").hide(),n.find("#search-spinner").hide(),e)){n.find("#tool-search-query").val("search tools")}}function l(e,n){var o=m.default[n];if(o){var i=t('<i class="icon fa">&nbsp;</i>').addClass(o);e.before(i)}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),c=a(r),u=n(275),d=a(u),p=n(276),h=a(p),f=n(277),w=a(f),_=n(81),m=a(_),v=n(282),g=a(v),y=n(6),b=a(y),k=n(93),x=a(k),O=n(65);!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t}(O);n(15),window.workflow_globals=window.workflow_globals||{},e.default=o.View.extend({initialize:function(e){function n(){var e=t('<form><label style="display:inline-block; width: 100%;">Save as name: </label><input type="text" id="workflow_rename" style="width: 80%;" autofocus/><br><label style="display:inline-block; width: 100%;">Annotation: </label><input type="text" id="wf_annotation" style="width: 80%;" /></form>');window.show_modal("Save As a New Workflow",e,{OK:function(){var e=t("#workflow_rename").val().length>0?t("#workflow_rename").val():"SavedAs_"+r.workflow.name,n=t("#wf_annotation").val().length>0?t("#wf_annotation").val():"";t.ajax({url:r.urls.workflow_save_as,type:"POST",data:{workflow_name:e,workflow_annotation:n,workflow_data:function(){return JSON.stringify(r.workflow.to_simple())}}}).done(function(t){window.onbeforeunload=void 0,window.location=Galaxy.root+"workflow/editor?id="+t,hide_modal()}).fail(function(){hide_modal(),alert("Saving this workflow failed. Please contact this site's administrator.")})},Cancel:hide_modal})}function o(){r.workflow.layout(),r.workflow.fit_canvas_to_nodes(),r.scroll_to_nodes(),r.canvas_manager.draw_overview()}function a(){t.jStorage.set("overview-off",!1),t("#overview-border").css("right","0px"),t("#close-viewport").css("background-position","0px 0px")}function l(){t.jStorage.set("overview-off",!0),t("#overview-border").css("right","20000px"),t("#close-viewport").css("background-position","12px 0px")}var r=window.workflow_globals.app=this;this.options=e,this.urls=e&&e.urls||{};var u=function(){if(r.workflow.check_changes_in_active_form(),workflow&&r.workflow.has_changes){var t=function(){window.onbeforeunload=void 0,window.document.location=r.urls.workflow_index};window.show_modal("Close workflow editor","There are unsaved changes to your workflow which will be lost.",{Cancel:hide_modal,"Save Changes":function(){d(null,t)}},{"Don't Save":t})}else window.document.location=r.urls.workflow_index},d=function(e,n){if(show_message("Saving workflow","progress"),r.workflow.check_changes_in_active_form(),!r.workflow.has_changes)return hide_modal(),void(n&&n());r.workflow.rectify_workflow_outputs(),c.default.request({url:Galaxy.root+"api/workflows/"+r.options.id,type:"PUT",data:{workflow:r.workflow.to_simple()},success:function(e){var o=t("<div/>").text(e.message);if(e.errors){o.addClass("warningmark");var i=t("<ul/>");t.each(e.errors,function(e,n){t("<li/>").text(n).appendTo(i)}),o.append(i)}else o.addClass("donemark");r.workflow.name=e.name,r.workflow.has_changes=!1,r.workflow.stored=!0,r.showWorkflowParameters(),e.errors?window.show_modal("Saving workflow",o,{Ok:hide_modal}):(n&&n(),hide_modal())},error:function(t){window.show_modal("Saving workflow failed.",t.err_msg,{Ok:hide_modal})}})};t("#tool-search-query").click(function(){t(this).focus(),t(this).select()}).keyup(function(){if(t(this).css("font-style","normal"),this.value.length<3)s(!1);else if(this.value!=this.lastValue){t(this).addClass("search_active");var e=this.value;this.timer&&clearTimeout(this.timer),t("#search-spinner").show(),this.timer=setTimeout(function(){t.get(r.urls.tool_search,{q:e},function(e){if(t("#search-no-results").hide(),t(".toolSectionWrapper").hide(),t(".toolSectionWrapper").find(".toolTitle").hide(),0!=e.length){var n=t.map(e,function(t,e){return"link-"+t});t(n).each(function(e,n){t("[id='"+n+"']").parent().addClass("search_match"),t("[id='"+n+"']").parent().show().parent().parent().show().parent().show()}),t(".toolPanelLabel").each(function(){for(var e=t(this),n=e.next(),o=!0;0!==n.length&&n.hasClass("toolTitle");){if(n.is(":visible")){o=!1;break}n=n.next()}o&&e.hide()})}else t("#search-no-results").show();t("#search-spinner").hide()},"json")},400)}this.lastValue=this.value}),this.canvas_manager=window.workflow_globals.canvas_manager=new h.default(this,t("#canvas-viewport"),t("#overview")),this.reset(),this.datatypes=JSON.parse(t.ajax({url:Galaxy.root+"api/datatypes",async:!1}).responseText),this.datatypes_mapping=JSON.parse(t.ajax({url:Galaxy.root+"api/datatypes/mapping",async:!1}).responseText),this.ext_to_type=this.datatypes_mapping.ext_to_class_name,this.type_to_type=this.datatypes_mapping.class_to_classes,this._workflowLoadAjax(r.options.id,{success:function(t){r.reset(),r.workflow.from_simple(t,!0),r.workflow.has_changes=!1,r.workflow.fit_canvas_to_nodes(),r.scroll_to_nodes(),r.canvas_manager.draw_overview();var e="";i.each(t.steps,function(n,o){var a="";n.errors&&(a+="<li>"+n.errors+"</li>"),i.each(t.upgrade_messages[o],function(t){a+="<li>"+t+"</li>"}),a&&(e+="<li>Step "+(parseInt(o,10)+1)+": "+r.workflow.nodes[o].name+"<ul>"+a+"</ul></li>")}),e?window.show_modal("Issues loading this workflow","Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>"+e+"</ul></p>",{Continue:hide_modal}):hide_modal(),r.showWorkflowParameters()},beforeSubmit:function(t){show_message("Loading workflow","progress")}}),window.make_popupmenu&&make_popupmenu(t("#workflow-options-button"),{Save:d,"Save As":n,Run:function(){window.location=Galaxy.root+"workflow/run?id="+r.options.id},"Edit Attributes":function(){r.workflow.clear_active_node()},"Auto Re-layout":o,Close:u});var p=t.jStorage.get("overview-size");void 0!==p&&t("#overview-border").css({width:p,height:p}),t.jStorage.get("overview-off")?l():a(),t("#overview-border").bind("dragend",function(e,n){var o=t(this).offsetParent(),i=o.offset(),a=Math.max(o.width()-(n.offsetX-i.left),o.height()-(n.offsetY-i.top));t.jStorage.set("overview-size",a+"px")}),t("#close-viewport").click(function(){"0px"===t("#overview-border").css("right")?l():a()}),window.onbeforeunload=function(){if(workflow&&r.workflow.has_changes)return"There are unsaved changes to your workflow which will be lost."},this.options.workflows.length>0&&t("#left").find(".toolMenu").append(this._buildToolPanelWorkflows()),t("div.toolSectionBody").hide(),t("div.toolSectionTitle > span").wrap("<a href='#'></a>");var f=null;t("div.toolSectionTitle").each(function(){var e=t(this).next("div.toolSectionBody");t(this).click(function(){e.is(":hidden")?(f&&f.slideUp("fast"),f=e,e.slideDown("fast")):(e.slideUp("fast"),f=null)})}),(0,x.default)("workflow-name","workflow-name",r.urls.rename_async,"new_name"),t("#workflow-tag").click(function(){return t(".tag-area").click(),!1}),(0,x.default)("workflow-annotation","workflow-annotation",r.urls.annotate_async,"new_annotation",25,!0,4)},_buildToolPanelWorkflows:function(){var e=this,n=t('<div class="toolSectionWrapper"><div class="toolSectionTitle"><a href="#"><span>Workflows</span></a></div><div class="toolSectionBody"><div class="toolSectionBg"/></div></div>');return i.each(this.options.workflows,function(o){if(o.id!==e.options.id){var i=new b.default.ButtonIcon({icon:"fa fa-copy",cls:"ui-button-icon-plain",tooltip:"Copy and insert individual steps",onclick:function(){o.step_count<2?e.copy_into_workflow(o.id,o.name):Galaxy.modal.show({title:"Warning",body:"This will copy "+o.step_count+" new steps into your workflow.",buttons:{Cancel:function(){Galaxy.modal.hide()},Copy:function(){Galaxy.modal.hide(),e.copy_into_workflow(o.id,o.name)}}})}}),a=t("<a/>").attr("href","#").html(o.name).on("click",function(){e.add_node_for_subworkflow(o.latest_id,o.name)});n.find(".toolSectionBg").append(t("<div/>").addClass("toolTitle").append(a).append(i.$el))}}),n},copy_into_workflow:function(e){var n=this;this._workflowLoadAjax(e,{success:function(e){n.workflow.from_simple(e,!1);var o="";t.each(e.upgrade_messages,function(e,i){o+="<li>Step "+(parseInt(e,10)+1)+": "+n.workflow.nodes[e].name+"<ul>",t.each(i,function(t,e){o+="<li>"+e+"</li>"}),o+="</ul></li>"}),o?window.show_modal("Subworkflow embedded with changes","Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>"+o+"</ul>",{Continue:hide_modal}):hide_modal()},beforeSubmit:function(t){show_message("Importing workflow","progress")}})},reset:function(){this.workflow&&this.workflow.remove_all(),this.workflow=window.workflow_globals.workflow=new d.default(this,t("#canvas-container"))},scroll_to_nodes:function(){var e,n,o=t("#canvas-viewport"),i=t("#canvas-container");n=i.width()<o.width()?(o.width()-i.width())/2:0,e=i.height()<o.height()?(o.height()-i.height())/2:0,i.css({left:n,top:e})},_workflowLoadAjax:function(e,n){t.ajax(c.default.merge(n,{url:this.urls.load_workflow,data:{id:e,_:"true"},dataType:"json",cache:!1}))},_moduleInitAjax:function(t,e){var n=this;c.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:e,success:function(e){t.init_field_data(e),t.update_field_data(e),n.workflow.activate_node(t)}})},add_node_for_tool:function(t,e){var n=this.workflow.create_node("tool",e,t);this._moduleInitAjax(n,{type:"tool",tool_id:t,_:"true"})},add_node_for_subworkflow:function(t,e){var n=this.workflow.create_node("subworkflow",e,t);this._moduleInitAjax(n,{type:"subworkflow",content_id:t,_:"true"})},add_node_for_module:function(t,e){var n=this.workflow.create_node(t,e);this._moduleInitAjax(n,{type:t,_:"true"})},display_file_list:function(t){var e="<select id='node_data_list' name='node_data_list'>";for(var n in t.output_terminals)e+="<option value='"+n+"'>"+n+"</option>";return e+="</select>"},showWorkflowParameters:function(){var e=/\$\{.+?\}/g,n=[],o=t("#workflow-parameters-container"),i=t("#workflow-parameters-box"),a="",s=[];t.each(this.workflow.nodes,function(o,i){i.config_form&&i.config_form.inputs&&c.default.deepeach(i.config_form.inputs,function(t){if("string"==typeof t.value){var n=t.value.match(e);n&&(s=s.concat(n))}}),i.post_job_actions&&t.each(i.post_job_actions,function(n,o){o.action_arguments&&t.each(o.action_arguments,function(t,n){var o=n.match(e);o&&(s=s.concat(o))})}),s&&t.each(s,function(e,o){-1===t.inArray(o,n)&&n.push(o)})}),n&&0!==n.length?(t.each(n,function(t,e){a+="<div>"+e.substring(2,e.length-1)+"</div>"}),o.html(a),i.show()):(o.html(a),i.hide())},showAttributes:function(){t(".right-content").hide(),t("#edit-attributes").show()},showForm:function(e,n){var o="right-content",i=o+"-"+n.id,a=t("#"+o);if(e&&0==a.find("#"+i).length){var s=t('<div id="'+i+'" class="'+o+'"/>');if(e.node=n,e.workflow=this.workflow,e.datatypes=this.datatypes,e.icon=m.default[n.type],e.cls="ui-portlet-narrow",n){var l="tool"==n.type?"Tool":"Default";s.append(new g.default[l](e).form.$el),a.append(s)}else Galaxy.emit.debug("workflow-view::initialize()","Node not found in workflow.")}t("."+o).hide(),a.find("#"+i).show(),a.show(),a.scrollTop()},isSubType:function(t,e){return t=this.ext_to_type[t],e=this.ext_to_type[e],this.type_to_type[t]&&e in this.type_to_type[t]},prebuildNode:function(e,n,o){var i=this,a=t("<div class='toolForm toolFormInCanvas'/>"),s=t("<div class='toolFormTitle unselectable'><span class='nodeTitle'>"+n+"</div></div>");l(s.find(".nodeTitle"),e),a.append(s),a.css("left",t(window).scrollLeft()+20),a.css("top",t(window).scrollTop()+20),a.append(t("<div class='toolFormBody'></div>"));var r=new w.default(this,{element:a});r.type=e,r.content_id=o;var c="<div><img height='16' align='middle' src='"+Galaxy.root+"static/images/loading_small_white_bg.gif'/> loading tool info...</div>";a.find(".toolFormBody").append(c);var u=t("<div class='buttons' style='float: right;'></div>");u.append(t("<div/>").addClass("fa-icon-button fa fa-times").click(function(t){r.destroy()})),a.appendTo("#canvas-container");var d=t("#canvas-container").position(),p=t("#canvas-container").parent(),h=a.width(),f=a.height();return a.css({left:-d.left+p.width()/2-h/2,top:-d.top+p.height()/2-f/2}),u.prependTo(a.find(".toolFormTitle")),h+=u.width()+10,a.css("width",h),a.bind("dragstart",function(){i.workflow.activate_node(r)}).bind("dragend",function(){i.workflow.node_changed(this),i.workflow.fit_canvas_to_nodes(),i.canvas_manager.draw_overview()}).bind("dragclickonly",function(){i.workflow.activate_node(r)}).bind("drag",function(e,n){var o=t(this).offsetParent().offset(),i=n.offsetX-o.left,a=n.offsetY-o.top;t(this).css({left:i,top:a}),t(this).find(".terminal").each(function(){this.terminal.redraw()})}),r}})}).call(e,n(0),n(2),n(1))},275:function(t,e,n){"use strict";(function(t){function o(t,e){this.app=t,this.canvas_container=e,this.id_counter=0,this.nodes={},this.name=null,this.has_changes=!1,this.active_form_has_changes=!1,this.workflowOutputLabels={}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(137),a=function(t){return t&&t.__esModule?t:{default:t}}(i),s=n(65),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(s);t.extend(o.prototype,{canLabelOutputWith:function(t){return!t||!(t in this.workflowOutputLabels)},registerOutputLabel:function(t){t&&(this.workflowOutputLabels[t]=!0)},unregisterOutputLabel:function(t){t&&delete this.workflowOutputLabels[t]},updateOutputLabel:function(t,e){t&&this.unregisterOutputLabel(t),this.canLabelOutputWith(e)||l.warning("Workflow contains duplicate workflow output labels "+e+". This must be fixed before it can be saved."),e&&this.registerOutputLabel(e)},attemptUpdateOutputLabel:function(t,e,n){return!!this.canLabelOutputWith(n)&&(t.labelWorkflowOutput(e,n),t.nodeView.redrawWorkflowOutputs(),!0)},create_node:function(t,e,n){var o=this.app.prebuildNode(t,e,n);return this.add_node(o),this.fit_canvas_to_nodes(),this.app.canvas_manager.draw_overview(),this.activate_node(o),o},add_node:function(t){t.id=this.id_counter,t.element.attr("id","wf-node-step-"+t.id),this.id_counter++,this.nodes[t.id]=t,this.has_changes=!0,t.workflow=this},remove_node:function(t){this.active_node==t&&this.clear_active_node(),delete this.nodes[t.id],this.has_changes=!0},remove_all:function(){var e=this;t.each(this.nodes,function(t,n){n.destroy(),e.remove_node(n)})},rectify_workflow_outputs:function(){var e=!1,n=!1;if(t.each(this.nodes,function(o,i){i.workflow_outputs&&i.workflow_outputs.length>0&&(e=!0),t.each(i.post_job_actions,function(t,e){"HideDatasetAction"===e.action_type&&(n=!0)})}),!1!==e||!1!==n){var o=this;t.each(this.nodes,function(n,i){if("tool"===i.type){var a=!1;null===i.post_job_actions&&(i.post_job_actions={},a=!0);var s=[];t.each(i.post_job_actions,function(t,e){"HideDatasetAction"==e.action_type&&s.push(t)}),s.length>0&&t.each(s,function(t,e){a=!0,delete i.post_job_actions[e]}),e&&t.each(i.output_terminals,function(t,e){if(!0==!i.isWorkflowOutput(e.name)){a=!0;var n={action_type:"HideDatasetAction",output_name:e.name,action_arguments:{}};i.post_job_actions["HideDatasetAction"+e.name]=null,i.post_job_actions["HideDatasetAction"+e.name]=n}}),o.active_node==i&&!0===a&&o.reload_active_node()}})}},to_simple:function(){var e={};return t.each(this.nodes,function(n,o){var i={};t.each(o.input_terminals,function(e,n){i[n.name]=null;var o=[];t.each(n.connectors,function(t,e){if(e.handle1){var a={id:e.handle1.node.id,output_name:e.handle1.name},s=n.attributes.input.input_subworkflow_step_id;void 0!==s&&(a.input_subworkflow_step_id=s),o[t]=a,i[n.name]=o}})});var a={};o.post_job_actions&&t.each(o.post_job_actions,function(t,e){var n={action_type:e.action_type,output_name:e.output_name,action_arguments:e.action_arguments};a[e.action_type+e.output_name]=null,a[e.action_type+e.output_name]=n}),o.workflow_outputs||(o.workflow_outputs=[]);var s={id:o.id,type:o.type,content_id:o.content_id,tool_version:o.config_form.version,tool_state:o.tool_state,errors:o.errors,input_connections:i,position:t(o.element).position(),annotation:o.annotation,post_job_actions:o.post_job_actions,uuid:o.uuid,label:o.label,workflow_outputs:o.workflow_outputs};e[o.id]=s}),{steps:e}},from_simple:function(e,n){var o=void 0===n||n,i=this,s=0;o?i.name=e.name:s=Object.keys(i.nodes).length;var l=s,r=!1;t.each(e.steps,function(e,n){var a=i.app.prebuildNode(n.type,n.name,n.content_id);o||(n.uuid=null,t.each(n.workflow_outputs,function(t,e){e.uuid=null})),a.init_field_data(n),n.position&&a.element.css({top:n.position.top,left:n.position.left}),a.id=parseInt(n.id)+s,i.nodes[a.id]=a,l=Math.max(l,parseInt(e)+s),r||(a.workflow_outputs.length>0?r=!0:t.each(a.post_job_actions||[],function(t,e){"HideDatasetAction"===e.action_type&&(r=!0)}))}),i.id_counter=l+1,t.each(e.steps,function(e,n){var o=i.nodes[parseInt(e)+s];t.each(n.input_connections,function(e,n){n&&(t.isArray(n)||(n=[n]),t.each(n,function(t,n){var l=i.nodes[parseInt(n.id)+s],r=new a.default;r.connect(l.output_terminals[n.output_name],o.input_terminals[e]),r.redraw()}))}),r&&t.each(o.output_terminals,function(e,n){if(void 0===o.post_job_actions["HideDatasetAction"+n.name]){o.addWorkflowOutput(n.name);t(o.element).find(".callout."+n.name).find("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"),i.has_changes=!0}})})},check_changes_in_active_form:function(){this.active_form_has_changes&&(this.has_changes=!0,t("#right-content").find("form").submit(),this.active_form_has_changes=!1)},reload_active_node:function(){if(this.active_node){var t=this.active_node;this.clear_active_node(),this.activate_node(t)}},clear_active_node:function(){this.active_node&&(this.active_node.make_inactive(),this.active_node=null),this.app.showAttributes()},activate_node:function(t){this.active_node!=t&&(this.check_changes_in_active_form(),this.clear_active_node(),this.app.showForm(t.config_form,t),t.make_active(),this.active_node=t)},node_changed:function(t,e){this.has_changes=!0,this.active_node==t&&e&&(this.check_changes_in_active_form(),this.app.showForm(t.config_form,t)),this.app.showWorkflowParameters()},layout:function(){this.check_changes_in_active_form(),this.has_changes=!0;var e={},n={};t.each(this.nodes,function(t,o){void 0===e[t]&&(e[t]=0),void 0===n[t]&&(n[t]=[])}),t.each(this.nodes,function(o,i){t.each(i.input_terminals,function(o,a){t.each(a.connectors,function(t,o){var a=o.handle1.node;e[i.id]+=1,n[a.id].push(i.id)})})});for(var o=[];;){var i=[];for(var a in e)0===e[a]&&i.push(a);if(0===i.length)break;o.push(i);for(var s in i){var l=i[s];delete e[l];for(var r in n[l])e[n[l][r]]-=1}}if(!e.length){var c=this.nodes,u=80;t.each(o,function(e,n){n.sort(function(e,n){return t(c[e].element).position().top-t(c[n].element).position().top});var o=0,i=30;t.each(n,function(e,n){var a=c[n],s=t(a.element);t(s).css({top:i,left:u}),o=Math.max(o,t(s).width()),i+=t(s).height()+30}),u+=o+80}),t.each(c,function(t,e){e.redraw()})}},bounds_for_all_nodes:function(){var e,n=1/0,o=-1/0,i=1/0,a=-1/0;return t.each(this.nodes,function(s,l){var r=t(l.element);e=r.position(),n=Math.min(n,e.left),o=Math.max(o,e.left+r.width()),i=Math.min(i,e.top),a=Math.max(a,e.top+r.width())}),{xmin:n,xmax:o,ymin:i,ymax:a}},fit_canvas_to_nodes:function(){function e(t,e){return Math.ceil(t/e)*e}function n(t,e){if(t<e||t>3*e){return-(t-(Math.ceil(t%e/e)+1)*e)}return 0}var o=this.bounds_for_all_nodes(),i=this.canvas_container.position(),a=this.canvas_container.parent(),s=n(o.xmin,100),l=n(o.ymin,100);s=Math.max(s,i.left),l=Math.max(l,i.top);var r=i.left-s,c=i.top-l,u=e(o.xmax+100,100)+s,d=e(o.ymax+100,100)+l;u=Math.max(u,-r+a.width()),d=Math.max(d,-c+a.height()),this.canvas_container.css({left:r,top:c,width:u,height:d}),this.canvas_container.children().each(function(){var e=t(this).position();t(this).css("left",e.left+s),t(this).css("top",e.top+l)})}}),e.default=o}).call(e,n(0))},276:function(t,e,n){"use strict";(function(t){function n(t,e,n){this.app=t,this.cv=e,this.cc=this.cv.find("#canvas-container"),this.overview=n,this.oc=n.find("#overview-canvas"),this.ov=n.find("#overview-viewport"),this.init_drag()}function o(t){this.panel=t}Object.defineProperty(e,"__esModule",{value:!0}),t.extend(n.prototype,{init_drag:function(){var e=this,n=function(t,n){t=Math.min(t,e.cv.width()/2),t=Math.max(t,-e.cc.width()+e.cv.width()/2),n=Math.min(n,e.cv.height()/2),n=Math.max(n,-e.cc.height()+e.cv.height()/2),e.cc.css({left:t,top:n}),e.cv.css({"background-position-x":t,"background-position-y":n}),e.update_viewport_overlay()};this.cc.each(function(){this.scroll_panel=new o(this)});var i,a;this.cv.bind("dragstart",function(){var n=t(this).offset(),o=e.cc.position();a=o.top-n.top,i=o.left-n.left}).bind("drag",function(t,e){n(e.offsetX+i,e.offsetY+a)}).bind("dragend",function(){e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}),this.overview.click(function(t){if(e.overview.hasClass("blockaclick"))e.overview.removeClass("blockaclick");else{var o=e.cc.width(),i=e.cc.height(),a=e.oc.width(),s=e.oc.height(),l=t.pageX-e.oc.offset().left-e.ov.width()/2,r=t.pageY-e.oc.offset().top-e.ov.height()/2;n(-l/a*o,-r/s*i),e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}}),this.ov.bind("drag",function(t,o){var i=e.cc.width(),a=e.cc.height(),s=e.oc.width(),l=e.oc.height(),r=o.offsetX-e.overview.offset().left,c=o.offsetY-e.overview.offset().top;n(-r/s*i,-c/l*a)}).bind("dragend",function(){e.overview.addClass("blockaclick"),e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}),t("#overview-border").bind("drag",function(n,o){var i=t(this).offsetParent(),a=i.offset(),s=Math.max(i.width()-(o.offsetX-a.left),i.height()-(o.offsetY-a.top));t(this).css({width:s,height:s}),e.draw_overview()}),t("#overview-border div").bind("drag",function(){})},update_viewport_overlay:function(){var t=this.cc,e=this.cv,n=this.oc,o=this.ov,i=t.width(),a=t.height(),s=n.width(),l=n.height(),r=t.position();o.css({left:-r.left/i*s,top:-r.top/a*l,width:e.width()/i*s-2,height:e.height()/a*l-2})},draw_overview:function(){var e,n,o,i,a=t("#overview-canvas"),s=a.parent().parent().width(),l=a.get(0).getContext("2d"),r=t("#canvas-container").width(),c=t("#canvas-container").height(),u=this.cv.width(),d=this.cv.height();r<u&&c<d?(o=r/u*s,i=(s-o)/2,e=c/d*s,n=(s-e)/2):r<c?(n=0,e=s,o=Math.ceil(e*r/c),i=(s-o)/2):(o=s,i=0,e=Math.ceil(o*c/r),n=(s-e)/2),a.parent().css({left:i,top:n,width:o,height:e}),a.attr("width",o),a.attr("height",e),t.each(this.app.workflow.nodes,function(n,i){l.fillStyle="#D2C099",l.strokeStyle="#D8B365",l.lineWidth=1;var a=t(i.element),s=a.position(),u=s.left/r*o,d=s.top/c*e,p=a.width()/r*o,h=a.height()/c*e;i.errors?(l.fillStyle="#FFCCCC",l.strokeStyle="#AA6666"):void 0!==i.workflow_outputs&&i.workflow_outputs.length>0&&(l.fillStyle="#E8A92D",l.strokeStyle="#E8A92D"),l.fillRect(u,d,p,h),l.strokeRect(u,d,p,h)}),this.update_viewport_overlay()}}),t.extend(o.prototype,{test:function(e,n){clearTimeout(this.timeout);var o=e.pageX,i=e.pageY,a=t(this.panel),s=a.position(),l=a.width(),r=a.height(),c=a.parent(),u=c.width(),d=c.height(),p=c.offset(),h=p.left,f=p.top,w=h+c.width(),_=f+c.height(),m=-(l-u/2),v=-(r-d/2),g=u/2,y=d/2,b=!1;if(o-5<h){if(s.left<g){var k=Math.min(23,g-s.left);a.css("left",s.left+k),b=!0}}else if(o+5>w){if(s.left>m){var k=Math.min(23,s.left-m);a.css("left",s.left-k),b=!0}}else if(i-5<f){if(s.top<y){var k=Math.min(23,y-s.top);a.css("top",s.top+k),b=!0}}else if(i+5>_&&s.top>v){var k=Math.min(23,s.top-m);a.css("top",s.top-k+"px"),b=!0}if(b){n();var a=this;this.timeout=setTimeout(function(){a.test(e,n)},50)}},stop:function(t,e){clearTimeout(this.timeout)}}),e.default=n}).call(e,n(0))},277:function(t,e,n){"use strict";(function(t,o,i){Object.defineProperty(e,"__esModule",{value:!0});var a=n(278),s=function(t){return t&&t.__esModule?t:{default:t}}(a),l=t.Model.extend({initialize:function(t,e){this.app=t,this.element=e.element,this.input_terminals={},this.output_terminals={},this.errors={},this.workflow_outputs=[]},getWorkflowOutput:function(t){return o.findWhere(this.workflow_outputs,{output_name:t})},isWorkflowOutput:function(t){return void 0!=this.getWorkflowOutput(t)},removeWorkflowOutput:function(t){for(;this.isWorkflowOutput(t);)this.workflow_outputs.splice(this.getWorkflowOutput(t),1)},addWorkflowOutput:function(t,e){if(!this.isWorkflowOutput(t)){var n={output_name:t};return e&&(n.label=e),this.workflow_outputs.push(n),!0}return!1},labelWorkflowOutput:function(t,e){var n=!1,o=null;if(this.isWorkflowOutput(t)){var i=this.getWorkflowOutput(t);o=i.label,i.label=e,n=o!=e}else n=this.addWorkflowOutput(t,e);return n&&(this.app.workflow.updateOutputLabel(o,e),this.markChanged(),this.nodeView.redrawWorkflowOutputs()),n},connectedOutputTerminals:function(){return this._connectedTerminals(this.output_terminals)},_connectedTerminals:function(t){var e=[];return i.each(t,function(t,n){n.connectors.length>0&&e.push(n)}),e},hasConnectedOutputTerminals:function(){var t=this.output_terminals;for(var e in t)if(t[e].connectors.length>0)return!0;return!1},connectedMappedInputTerminals:function(){return this._connectedMappedTerminals(this.input_terminals)},hasConnectedMappedInputTerminals:function(){var t=this.input_terminals;for(var e in t){var n=t[e];if(n.connectors.length>0&&n.isMappedOver())return!0}return!1},_connectedMappedTerminals:function(t){var e=[];return i.each(t,function(t,n){n.mapOver().isCollection&&n.connectors.length>0&&e.push(n)}),e},mappedInputTerminals:function(){return this._mappedTerminals(this.input_terminals)},_mappedTerminals:function(t){var e=[];return i.each(t,function(t,n){n.mapOver().isCollection&&e.push(n)}),e},hasMappedOverInputTerminals:function(){var t=!1;return o.each(this.input_terminals,function(e){e.mapOver().isCollection&&(t=!0)}),t},redraw:function(){i.each(this.input_terminals,function(t,e){e.redraw()}),i.each(this.output_terminals,function(t,e){e.redraw()})},destroy:function(){i.each(this.input_terminals,function(t,e){e.destroy()}),i.each(this.output_terminals,function(t,e){e.destroy()}),this.app.workflow.remove_node(this),i(this.element).remove()},make_active:function(){i(this.element).addClass("toolForm-active")},make_inactive:function(){var t=this.element.get(0);!function(e){e.removeChild(t),e.appendChild(t)}(t.parentNode),i(t).removeClass("toolForm-active")},init_field_data:function(t){t.type&&(this.type=t.type),this.name=t.name,this.config_form=t.config_form,this.tool_version=this.config_form&&this.config_form.version,this.tool_state=t.tool_state,this.errors=t.errors,this.tooltip=t.tooltip?t.tooltip:"",this.annotation=t.annotation,this.post_job_actions=t.post_job_actions?t.post_job_actions:{},this.label=t.label,this.uuid=t.uuid,this.workflow_outputs=t.workflow_outputs?t.workflow_outputs:[];var e=this,n=new s.default({el:this.element[0],node:e});e.nodeView=n,i.each(t.data_inputs,function(t,e){n.addDataInput(e)}),t.data_inputs.length>0&&t.data_outputs.length>0&&n.addRule(),i.each(t.data_outputs,function(t,e){n.addDataOutput(e)}),n.render(),this.app.workflow.node_changed(this,!0)},update_field_data:function(t){var e=this,n=e.nodeView,a=[];if(i.each(n.outputViews,function(e,n){var i=n.output.name,s=t.data_outputs,l=!1;o.each(s,function(t){t.name==i&&(l=!0)}),!1===l&&a.push(i)}),o.each(a,function(t){o.each(n.outputViews[t].terminalElement.terminal.connectors,function(t){t&&t.destroy()}),n.outputViews[t].remove(),delete n.outputViews[t],delete e.output_terminals[t]}),i.each(e.workflow_outputs,function(t,n){n&&!e.output_terminals[n.output_name]&&e.workflow_outputs.splice(t,1)}),i.each(t.data_outputs,function(t,o){n.outputViews[o.name]?(e.output_terminals[o.name].datatypes=o.extensions,e.output_terminals[o.name].destroyInvalidConnections()):n.addDataOutput(o)}),this.tool_state=t.tool_state,this.config_form=t.config_form,this.tool_version=this.config_form&&this.config_form.version,this.errors=t.errors,this.annotation=t.annotation,this.label=t.label,"post_job_actions"in t){var s=t.post_job_actions;this.post_job_actions=s||{}}e.nodeView.renderToolErrors();var l=n.$("div.inputs"),r=n.newInputsDiv(),c={};o.each(t.data_inputs,function(t){var n=e.nodeView.addDataInput(t,r);c[t.name]=n}),o.each(o.difference(o.values(n.terminalViews),o.values(c)),function(t){t.el.terminal.destroy()}),n.terminalViews=c,e.nodeView.render(),1==t.data_outputs.length&&"collection_type"in t.data_outputs[0]&&n.updateDataOutput(t.data_outputs[0]),l.replaceWith(r),"workflow_outputs"in t&&(this.workflow_outputs=workflow_outputs||[]),this.markChanged(),this.redraw()},error:function(t){var e=i(this.element).find(".toolFormBody");e.find("div").remove();var n="<div style='color: red; text-style: italic;'>"+t+"</div>";this.config_form=n,e.html(n),this.app.workflow.node_changed(this)},markChanged:function(){this.app.workflow.node_changed(this)}});e.default=l}).call(e,n(2),n(1),n(0))},278:function(t,e,n){"use strict";(function(t,o){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),l=n(279),r=i(l),c=n(281),u=i(c);e.default=t.View.extend({initialize:function(t){this.node=t.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return o("<div/>").addClass("inputs")},updateMaxWidth:function(t){this.output_width=Math.max(this.output_width,t)},addRule:function(){this.tool_body.append(o("<div/>").addClass("rule"))},addDataInput:function(t,e){var n=!0;e||(e=this.$(".inputs"),n=!1);var o=this.terminalViews[t.name],i="dataset_collection"==t.input_type?r.default.InputCollectionTerminalView:r.default.InputTerminalView;if(!o||o instanceof i||(o.el.terminal.destroy(),o=null),o){var a=o.el.terminal;a.update(t),a.destroyInvalidConnections()}else o=new i({node:this.node,input:t});this.terminalViews[t.name]=o;var s=o.el,l=new u.default.DataInputView({terminalElement:s,input:t,nodeView:this,skipResize:n}),c=l.$el;return e.append(c.prepend(o.terminalElements())),o},addDataOutput:function(t){var e=t.collection?r.default.OutputCollectionTerminalView:r.default.OutputTerminalView,n=new e({node:this.node,output:t}),o=new u.default.DataOutputView({output:t,terminalElement:n.el,nodeView:this});this.outputViews[t.name]=o,this.tool_body.append(o.$el.append(n.terminalElements()))},redrawWorkflowOutputs:function(){s.each(this.outputViews,function(t){t.redrawWorkflowOutput()})},updateDataOutput:function(t){this.node.output_terminals[t.name].update(t)}})}).call(e,n(2),n(0))},279:function(t,e,n){"use strict";(function(t,o,i){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(280),l=a(s),r=n(137),c=a(r);window.workflow_globals=window.workflow_globals||{};var u=t.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(t){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",o.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),d=u.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(t){this.$el.css("color","black")},onClick:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&e.terminal.resetMapping()}}),p=t.View.extend({setupMappingView:function(t){var e=new this.terminalMappingClass({terminal:t}),n=new this.terminalMappingViewClass({model:e});n.render(),t.terminalMappingView=n,this.terminalMappingView=n},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),h=p.extend({className:"terminal input-terminal",initialize:function(t){var e=t.node,n=t.input,o=n.name,i=this.terminalForInput(n);i.multiple||this.setupMappingView(i),this.el.terminal=i,i.node=e,i.name=o,e.input_terminals[o]=i},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(t,e){var n=this.el.terminal;return i(e.drag).hasClass("output-terminal")&&n.canAccept(e.drag.terminal)},onDropStart:function(t,e){e.proxy.terminal&&(e.proxy.terminal.connectors[0].inner_color="#BBFFBB")},onDropEnd:function(t,e){e.proxy.terminal&&(e.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(t,e){var n=this.el.terminal;new c.default(e.drag.terminal,n).redraw()},onHover:function(){var t=this.el,e=t.terminal;if(e.connectors.length>0){var n=i("<div class='callout'></div>").css({display:"none"}).appendTo("body").append(i("<div class='button'></div>").append(i("<div/>").addClass("fa-icon-button fa fa-times").click(function(){i.each(e.connectors,function(t,e){e&&e.destroy()}),n.remove()}))).bind("mouseleave",function(){i(this).remove()});n.css({top:i(t).offset().top-2,left:i(t).offset().left-n.width(),"padding-right":i(t).width()}).show()}}}),f=h.extend({terminalMappingClass:l.default.TerminalMapping,terminalMappingViewClass:d,terminalForInput:function(t){return new l.default.InputTerminal({element:this.el,input:t})}}),w=h.extend({terminalMappingClass:l.default.TerminalMapping,terminalMappingViewClass:d,terminalForInput:function(t){return new l.default.InputCollectionTerminal({element:this.el,input:t})}}),_=p.extend({className:"terminal output-terminal",initialize:function(t){var e=t.node,n=t.output,o=n.name,i=this.terminalForOutput(n);this.setupMappingView(i),this.el.terminal=i,i.node=e,i.name=o,e.output_terminals[o]=i},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(t,e){var n=function(){var t=i(e.proxy).offsetParent().offset(),n=e.offsetX-t.left,o=e.offsetY-t.top;i(e.proxy).css({left:n,top:o}),e.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};n(),i("#canvas-container").get(0).scroll_panel.test(t,n)},onDragStart:function(t,e){i(e.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var n=i('<div class="drag-terminal" style="position: absolute;"></div>').appendTo("#canvas-container").get(0);n.terminal=new l.default.OutputTerminal({element:n});var o=new c.default;return o.dragging=!0,o.connect(this.el.terminal,n.terminal),n},onDragEnd:function(t,e){var n=e.proxy.terminal.connectors[0];n&&n.destroy(),i(e.proxy).remove(),i(e.available).removeClass("input-terminal-active"),i("#canvas-container").get(0).scroll_panel.stop()}}),m=_.extend({terminalMappingClass:l.default.TerminalMapping,terminalMappingViewClass:u,terminalForOutput:function(t){var e=t.extensions;return new l.default.OutputTerminal({element:this.el,datatypes:e})}}),v=_.extend({terminalMappingClass:l.default.TerminalMapping,terminalMappingViewClass:u,terminalForOutput:function(t){var e=t.collection_type,n=t.collection_type_source;return new l.default.OutputCollectionTerminal({element:this.el,collection_type:e,collection_type_source:n,datatypes:t.extensions})}});e.default={InputTerminalView:f,OutputTerminalView:m,InputCollectionTerminalView:w,OutputCollectionTerminalView:v}}).call(e,n(2),n(1),n(0))},280:function(t,e,n){"use strict";(function(t,n,o){function i(t){this.collectionType=t,this.isCollection=!0,this.rank=t.split(":").length}Object.defineProperty(e,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var a={isCollection:!1,canMatch:function(t){return!1},canMapOver:function(t){return!1},toString:function(){return"NullCollectionType[]"},append:function(t){return t},equal:function(t){return t===this}},s={isCollection:!0,canMatch:function(t){return a!==t},canMapOver:function(t){return!1},toString:function(){return"AnyCollectionType[]"},append:function(t){throw"Cannot append to ANY_COLLECTION_TYPE_DESCRIPTION"},equal:function(t){return t===this}};t.extend(i.prototype,{append:function(t){return t===a?this:t===s?otherCollectionType:new i(this.collectionType+":"+t.collectionType)},canMatch:function(t){return t!==a&&(t===s||t.collectionType==this.collectionType)},canMapOver:function(t){if(t===a)return!1;if(t===s)return!1;if(this.rank<=t.rank)return!1;var e=t.collectionType;return this._endsWith(this.collectionType,e)},effectiveMapOver:function(t){var e=t.collectionType;return new i(this.collectionType.substring(0,this.collectionType.length-e.length-1))},equal:function(t){return t.collectionType==this.collectionType},toString:function(){return"CollectionType["+this.collectionType+"]"},_endsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)}});var l=n.Model.extend({initialize:function(t){this.mapOver=t.mapOver||a,this.terminal=t.terminal,this.terminal.terminalMapping=this},disableMapOver:function(){this.setMapOver(a)},setMapOver:function(t){this.mapOver=t,this.trigger("change")}}),r=n.Model.extend({initialize:function(t){this.element=t.element,this.connectors=[]},connect:function(t){this.connectors.push(t),this.node&&this.node.markChanged()},disconnect:function(e){this.connectors.splice(t.inArray(e,this.connectors),1),this.node&&(this.node.markChanged(),this.resetMappingIfNeeded())},redraw:function(){t.each(this.connectors,function(t,e){e.redraw()})},destroy:function(){t.each(this.connectors.slice(),function(t,e){e.destroy()})},destroyInvalidConnections:function(){o.each(this.connectors,function(t){t&&t.destroyIfInvalid()})},setMapOver:function(t){this.multiple||this.mapOver().equal(t)||(this.terminalMapping.setMapOver(t),o.each(this.node.output_terminals,function(e){e.setMapOver(t)}))},mapOver:function(){return this.terminalMapping?this.terminalMapping.mapOver:a},isMappedOver:function(){return this.terminalMapping&&this.terminalMapping.mapOver.isCollection},resetMapping:function(){this.terminalMapping.disableMapOver()},resetMappingIfNeeded:function(){}}),c=r.extend({initialize:function(t){r.prototype.initialize.call(this,t),this.datatypes=t.datatypes},resetMappingIfNeeded:function(){this.node.hasConnectedOutputTerminals()||this.node.hasConnectedMappedInputTerminals()||o.each(this.node.mappedInputTerminals(),function(t){t.resetMappingIfNeeded()}),!this.node.hasMappedOverInputTerminals()&&this.resetMapping()},resetMapping:function(){this.terminalMapping.disableMapOver(),o.each(this.connectors,function(t){var e=t.handle2;e&&(e.resetMappingIfNeeded(),t.destroyIfInvalid())})}}),u=r.extend({initialize:function(t){r.prototype.initialize.call(this,t),this.update(t.input)},canAccept:function(t){return!this._inputFilled()&&this.attachable(t)},resetMappingIfNeeded:function(){this.mapOver().isCollection&&((this.node.hasConnectedMappedInputTerminals()||!this.node.hasConnectedOutputTerminals())&&this.resetMapping())},resetMapping:function(){this.terminalMapping.disableMapOver(),this.node.hasMappedOverInputTerminals()||o.each(this.node.output_terminals,function(t){t.resetMapping()})},connected:function(){return 0!==this.connectors.length},_inputFilled:function(){var t;return this.connected()?this.multiple?this._collectionAttached()?inputsFilled=!0:t=!1:t=!0:t=!1,t},_collectionAttached:function(){if(this.connected()){var t=this.connectors[0].handle1;return!!t&&!!(t.isCollection||t.isMappedOver()||t.datatypes.indexOf("input_collection")>0)}return!1},_mappingConstraints:function(){if(!this.node)return[];var t=this.mapOver();if(t.isCollection)return[t];var e=[];return this.node.hasConnectedOutputTerminals()?e.push(o.first(o.values(this.node.output_terminals)).mapOver()):o.each(this.node.connectedMappedInputTerminals(),function(t){e.push(t.mapOver())}),e},_producesAcceptableDatatype:function(t){for(var e in this.datatypes){var n=this.datatypes[e];if("input"==n)return!0;var o=new Array;if(o=o.concat(t.datatypes),t.node.post_job_actions)for(var i in t.node.post_job_actions){var a=t.node.post_job_actions[i];"ChangeDatatypeAction"!=a.action_type||""!=a.output_name&&a.output_name!=t.name||!a.action_arguments||o.push(a.action_arguments.newtype)}for(var s in o){var l=o[s];if("input"==l||"_sniff_"==l||"input_collection"==l||window.workflow_globals.app.isSubType(o[s],n))return!0}}return!1},_otherCollectionType:function(t){var e=a;t.isCollection&&(e=t.collectionType);var n=t.mapOver();return n.isCollection&&(e=n.append(e)),e}}),d=u.extend({update:function(t){this.datatypes=t.extensions,this.multiple=t.multiple,this.collection=!1},connect:function(t){u.prototype.connect.call(this,t);var e=t.handle1;if(e){var n=this._otherCollectionType(e);n.isCollection&&this.setMapOver(n)}},attachable:function(t){var e=this._otherCollectionType(t),n=this.mapOver();if(e.isCollection){if(this.multiple)return!(this.connected()&&!this._collectionAttached())&&(1==e.rank&&this._producesAcceptableDatatype(t));if(n.isCollection&&n.canMatch(e))return this._producesAcceptableDatatype(t);return!!this._mappingConstraints().every(o.bind(e.canMatch,e))&&this._producesAcceptableDatatype(t)}return!n.isCollection&&this._producesAcceptableDatatype(t)}}),p=u.extend({update:function(t){this.multiple=!1,this.collection=!0,this.datatypes=t.extensions;var e=[];t.collection_types?o.each(t.collection_types,function(t){e.push(new i(t))}):e.push(s),this.collectionTypes=e},connect:function(t){u.prototype.connect.call(this,t);var e=t.handle1;if(e){var n=this._effectiveMapOver(e);this.setMapOver(n)}},_effectiveMapOver:function(t){var e=this.collectionTypes,n=this._otherCollectionType(t);if(!o.some(e,function(t){return t.canMatch(n)}))for(var i in e){var s=e[i];if(n.canMapOver(s)){var l=n.effectiveMapOver(s);if(l!=a)return l}}return a},_effectiveCollectionTypes:function(){var t=this.mapOver();return o.map(this.collectionTypes,function(e){return t.append(e)})},attachable:function(t){var e=this._otherCollectionType(t);if(e.isCollection){var n=this._effectiveCollectionTypes(),i=this.mapOver();if(o.some(n,function(t){return t.canMatch(e)}))return this._producesAcceptableDatatype(t);if(i.isCollection)return!1;if(o.some(this.collectionTypes,function(t){return e.canMapOver(t)})){var a=this._effectiveMapOver(t);if(!a.isCollection)return!1;if(this._mappingConstraints().every(a.canMatch))return this._producesAcceptableDatatype(t)}}return!1}}),h=r.extend({initialize:function(t){if(r.prototype.initialize.call(this,t),this.datatypes=t.datatypes,t.collection_type)this.collectionType=new i(t.collection_type);else{t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),this.collectionType=s}this.isCollection=!0},update:function(t){var e;if(t.collection_type)e=new i(t.collection_type);else{t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),e=s}e.collectionType!=this.collectionType.collectionType&&o.each(this.connectors,function(t){t.destroy()}),this.collectionType=e}});e.default={InputTerminal:d,OutputTerminal:c,InputCollectionTerminal:p,OutputCollectionTerminal:h,TerminalMapping:l,CollectionTypeDescription:i,NULL_COLLECTION_TYPE_DESCRIPTION:a,ANY_COLLECTION_TYPE_DESCRIPTION:s}}).call(e,n(0),n(2),n(1))},281:function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var o=t.View.extend({className:"form-row dataRow input-data-row",initialize:function(t){this.input=t.input,this.nodeView=t.nodeView,this.terminalElement=t.terminalElement,this.$el.attr("name",this.input.name).html(this.input.label),t.skipResize||(this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()),this.$el.css({position:"",left:"",top:"",display:""}),this.$el.remove())}}),i=t.View.extend({className:"form-row dataRow",initialize:function(t){this.output=t.output,this.terminalElement=t.terminalElement,this.nodeView=t.nodeView;var e=this.output,o=e.name,i=this.nodeView.node;if(e.extensions.indexOf("input")>=0||e.extensions.indexOf("input_collection")>=0||(o=o+" ("+e.extensions.join(", ")+")"),this.$el.html(o),this.calloutView=null,["tool","subworkflow"].indexOf(i.type)>=0){var s=new a({label:o,output:e,node:i});this.calloutView=s,this.$el.append(s.el),this.$el.hover(function(){s.hoverImage()},function(){s.resetImage()})}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),a=t.View.extend({tagName:"div",initialize:function(t){this.label=t.label,this.node=t.node,this.output=t.output;var e=this,o=this.node;this.$el.attr("class","callout "+this.label).css({display:"none"}).append(n("<div class='buttons'></div>").append(n("<img/>").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png").click(function(){var t=e.output.name;o.isWorkflowOutput(t)?(o.removeWorkflowOutput(t),e.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")):(o.addWorkflowOutput(t),e.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png")),window.workflow_globals.workflow.has_changes=!0,window.workflow_globals.canvas_manager.draw_overview()}))).tooltip({delay:500,title:"Mark dataset as a workflow output. All unmarked datasets will be hidden."}),this.$el.css({top:"50%",margin:"-8px 0px 0px 0px",right:8}),this.$el.show(),this.resetImage()},resetImage:function(){this.node.isWorkflowOutput(this.output.name)?this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"):this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")},hoverImage:function(){this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-yellow.png")}});e.default={DataInputView:o,DataOutputView:i}}).call(e,n(2),n(0))},282:function(t,e,n){"use strict";(function(t,o){function i(t){return t&&t.__esModule?t:{default:t}}function a(t){var e=t.model.attributes,n=e.workflow,o=e.node;e.inputs.unshift({type:"text",name:"__annotation",label:"Annotation",fixed:!0,value:o.annotation,area:!0,help:"Add an annotation or notes to this step. Annotations are available when a workflow is viewed."}),e.inputs.unshift({type:"text",name:"__label",label:"Label",value:o.label,help:"Add a step label.",fixed:!0,onchange:function(e){var i=!1;for(var a in n.nodes){var s=n.nodes[a];if(s.label&&s.label==e&&s.id!=o.id){i=!0;break}}var l=t.data.match("__label");t.element_list[l].model.set("error_text",i&&"Duplicate label. Please fix this before saving the workflow."),t.trigger("change")}})}function s(t){function e(t,n){n=n||[],n.push(t);for(var o in t.inputs){var i=t.inputs[o];if(i.action){if(i.name="pja__"+r+"__"+i.action,i.pja_arg&&(i.name+="__"+i.pja_arg),i.payload)for(var a in i.payload)i.payload[i.name+"__"+a]=i.payload[a],delete i.payload[a];var s=l[i.action+r];if(s){for(var c in n)n[c].expanded=!0;i.pja_arg?i.value=s.action_arguments&&s.action_arguments[i.pja_arg]||i.value:i.value="true"}}i.inputs&&e(i,n.slice(0))}}var n=t.model.attributes,o=n.inputs,i=n.datatypes,a=n.node,s=n.workflow,l=a.post_job_actions,r=a.output_terminals&&Object.keys(a.output_terminals)[0];if(r){o.push({name:"pja__"+r+"__EmailAction",label:"Email notification",type:"boolean",value:String(Boolean(l["EmailAction"+r])),ignore:"false",help:"An email notification will be sent when the job has completed.",payload:{host:window.location.host}}),o.push({name:"pja__"+r+"__DeleteIntermediatesAction",label:"Output cleanup",type:"boolean",value:String(Boolean(l["DeleteIntermediatesAction"+r])),ignore:"false",help:"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs."});for(var c in a.output_terminals)o.push(function(t,n){var o=[],i=[];for(var l in n)o.push({0:n[l],1:n[l]});for(l in a.input_terminals)i.push(a.input_terminals[l].name);o.sort(function(t,e){return t.label>e.label?1:t.label<e.label?-1:0}),o.unshift({0:"Sequences",1:"Sequences"}),o.unshift({0:"Roadmaps",1:"Roadmaps"}),o.unshift({0:"Leave unchanged",1:"__empty__"});var r,c={title:"Configure Output: '"+t+"'",type:"section",flat:!0,inputs:[{label:"Label",type:"text",value:(r=a.getWorkflowOutput(t))&&r.label||"",help:"This will provide a short name to describe the output - this must be unique across workflows.",onchange:function(e){s.attemptUpdateOutputLabel(a,t,e)}},{action:"RenameDatasetAction",pja_arg:"newname",label:"Rename dataset",type:"text",value:"",ignore:"",help:'This action will rename the output dataset. Click <a href="https://galaxyproject.org/learn/advanced-workflow/variables/">here</a> for more information. Valid inputs are: <strong>'+i.join(", ")+"</strong>."},{action:"ChangeDatatypeAction",pja_arg:"newtype",label:"Change datatype",type:"select",ignore:"__empty__",value:"__empty__",options:o,help:"This action will change the datatype of the output to the indicated value."},{action:"TagDatasetAction",pja_arg:"tags",label:"Add Tags",type:"text",value:"",ignore:"",help:"This action will set tags for the dataset."},{action:"RemoveTagDatasetAction",pja_arg:"tags",label:"Remove Tags",type:"text",value:"",ignore:"",help:"This action will remove tags for the dataset."},{title:"Assign columns",type:"section",flat:!0,inputs:[{action:"ColumnSetAction",pja_arg:"chromCol",label:"Chrom column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"startCol",label:"Start column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"endCol",label:"End column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"strandCol",label:"Strand column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"nameCol",label:"Name column",type:"integer",value:"",ignore:""}],help:"This action will set column assignments in the output dataset. Blank fields are ignored."}]};return e(c),c}(c,i))}}Object.defineProperty(e,"__esModule",{value:!0});var l=n(3),r=i(l),c=n(32),u=i(c),d=n(44),p=i(d),h=t.View.extend({initialize:function(t){var e=this,n=t.node;this.form=new u.default(r.default.merge(t,{onchange:function(){r.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{id:n.id,type:n.type,content_id:n.content_id,inputs:e.form.data.create()},success:function(t){n.update_field_data(t)}})}})),a(this.form),this.form.render()}}),f=t.View.extend({initialize:function(t){var e=this,n=t.node;this.form=new p.default(r.default.merge(t,{text_enable:"Set in Advance",text_disable:"Set at Runtime",narrow:!0,initial_errors:!0,cls:"ui-portlet-narrow",initialmodel:function(t,n){e._customize(n),t.resolve()},buildmodel:function(t,e){e.model.get("postchange")(t,e)},postchange:function(t,i){var a=i.model.attributes,s={tool_id:a.id,tool_version:a.version,type:"tool",inputs:o.extend(!0,{},i.data.create())};Galaxy.emit.debug("tool-form-workflow::postchange()","Sending current state.",s),r.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:s,success:function(o){i.model.set(o.config_form),e._customize(i),i.update(o.config_form),i.errors(o.config_form),n.update_field_data(o),Galaxy.emit.debug("tool-form-workflow::postchange()","Received new model.",o),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form-workflow::postchange()","Refresh request failed.",e),t.reject()}})}}))},_customize:function(t){var e=t.model.attributes;r.default.deepeach(e.inputs,function(t){t.type&&(-1!=["data","data_collection"].indexOf(t.type)?(t.type="hidden",t.info="Data input '"+t.name+"' ("+r.default.textify(t.extensions)+")",t.value={__class__:"RuntimeValue"}):t.fixed||(t.collapsible_value={__class__:"RuntimeValue"},t.is_workflow=t.options&&0==t.options.length||-1!=["integer","float"].indexOf(t.type)))}),r.default.deepeach(e.inputs,function(t){"conditional"==t.type&&(t.test_param.collapsible_value=void 0)}),s(t),a(t)}});e.default={Default:h,Tool:f}}).call(e,n(2),n(0))},81:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",pause:"fa-pause"}}},[273]);
//# sourceMappingURL=workflow.bundled.js.map