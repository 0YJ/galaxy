{"version":3,"sources":["webpack:///analysis.bundled.js","webpack:///./galaxy/scripts/mvc/base-mvc.js","webpack:///./galaxy/scripts/viz/visualization.js","webpack:///./galaxy/scripts/viz/trackster/util.js","webpack:///./galaxy/scripts/mvc/dataset/data.js","webpack:///./galaxy/scripts/utils/config.js","webpack:///./galaxy/scripts/mvc/grid/grid-view.js","webpack:///./galaxy/scripts/mvc/webhooks.js","webpack:///./galaxy/scripts/mvc/ui/icon-button.js","webpack:///./galaxy/scripts/mvc/ui/ui-frames.js","webpack:///./galaxy/scripts/mvc/ui/popup-menu.js","webpack:///./galaxy/scripts/mvc/ui/ui-tabs.js","webpack:///./galaxy/scripts/utils/add-logging.js","webpack:///./galaxy/scripts/mvc/tool/tools.js","webpack:///./galaxy/scripts/mvc/tool/tool-form.js","webpack:///./galaxy/scripts/mvc/grid/grid-model.js","webpack:///./galaxy/scripts/mvc/grid/grid-template.js","webpack:///./galaxy/scripts/viz/trackster.js","webpack:///./galaxy/scripts/viz/trackster/tracks.js","webpack:///./galaxy/scripts/viz/viz_views.js","webpack:///./galaxy/scripts/viz/trackster/slotting.js","webpack:///./galaxy/scripts/viz/trackster/painters.js","webpack:///./galaxy/scripts/viz/trackster/filters.js","webpack:///./galaxy/scripts/viz/bbi-data-manager.js","webpack:///./galaxy/scripts/libs/bbi/bigwig.js","webpack:///./galaxy/scripts/libs/bbi/spans.js","webpack:///./galaxy/scripts/libs/bbi/jszlib.js","webpack:///./galaxy/scripts/libs/bbi/jquery-ajax-native.js","webpack:///./galaxy/scripts/mvc/user/user-model.js","webpack:///./galaxy/scripts/layout/masthead.js","webpack:///./galaxy/scripts/layout/menu.js","webpack:///./galaxy/scripts/layout/generic-nav-view.js","webpack:///./galaxy/scripts/layout/scratchbook.js","webpack:///./galaxy/scripts/mvc/user/user-quotameter.js","webpack:///./galaxy/scripts/mvc/ui/ui-popover.js","webpack:///./galaxy/scripts/mvc/dataset/states.js","webpack:///./galaxy/scripts/mvc/ui/ui-select.js","webpack:///./galaxy/scripts/ui/fa-icon-button.js","webpack:///./galaxy/scripts/galaxy.js","webpack:///./galaxy/scripts/utils/metrics-logger.js","webpack:///./galaxy/scripts/layout/page.js","webpack:///./galaxy/scripts/mvc/upload/upload-model.js","webpack:///./galaxy/scripts/mvc/tag.js","webpack:///./galaxy/scripts/layout/router.js","webpack:///./galaxy/scripts/mvc/upload/upload-settings.js","webpack:///./galaxy/scripts/mvc/upload/upload-ftp.js","webpack:///./galaxy/scripts/mvc/upload/upload-extension.js","webpack:///./galaxy/scripts/utils/uploadbox.js","webpack:///./galaxy/scripts/mvc/collection/list-collection-creator.js","webpack:///./galaxy/scripts/mvc/history/hdca-model.js","webpack:///./galaxy/scripts/mvc/collection/collection-model.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-icons.js","webpack:///./galaxy/scripts/mvc/history/history-model.js","webpack:///./galaxy/scripts/mvc/history/history-contents.js","webpack:///./galaxy/scripts/mvc/history/history-preferences.js","webpack:///./galaxy/scripts/mvc/list/list-item.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li.js","webpack:///./galaxy/scripts/mvc/collection/collection-li.js","webpack:///./galaxy/scripts/mvc/form/form-wrapper.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-model.js","webpack:///./galaxy/scripts/mvc/history/history-content-model.js","webpack:///./galaxy/scripts/mvc/collection/base-creator.js","webpack:///./galaxy/scripts/utils/natural-sort.js","webpack:///./galaxy/scripts/ui/hoverhighlight.js","webpack:///./galaxy/scripts/mvc/tool/tool-form-composite.js","webpack:///./galaxy/scripts/mvc/history/copy-dialog.js","webpack:///./galaxy/scripts/mvc/ui/error-modal.js","webpack:///./galaxy/scripts/mvc/base/controlled-fetch-collection.js","webpack:///./galaxy/scripts/mvc/history/hda-model.js","webpack:///./galaxy/scripts/mvc/list/list-view.js","webpack:///./galaxy/scripts/ui/search-input.js","webpack:///./galaxy/scripts/mvc/history/hda-li.js","webpack:///./galaxy/scripts/mvc/history/history-item-li.js","webpack:///./galaxy/scripts/mvc/history/hdca-li.js","webpack:///./galaxy/scripts/mvc/collection/collection-view.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-li-edit.js","webpack:///./galaxy/scripts/mvc/annotation.js","webpack:///./galaxy/scripts/apps/analysis.js","webpack:///./galaxy/scripts/apps/panels/tool-panel.js","webpack:///./galaxy/scripts/mvc/upload/upload-view.js","webpack:///./galaxy/scripts/mvc/upload/upload-button.js","webpack:///./galaxy/scripts/mvc/upload/default/default-view.js","webpack:///./galaxy/scripts/mvc/upload/default/default-row.js","webpack:///./galaxy/scripts/mvc/lazy/lazy-limited.js","webpack:///./galaxy/scripts/mvc/upload/composite/composite-view.js","webpack:///./galaxy/scripts/mvc/upload/composite/composite-row.js","webpack:///./galaxy/scripts/mvc/upload/collection/collection-view.js","webpack:///./galaxy/scripts/mvc/upload/collection/collection-row.js","webpack:///./galaxy/scripts/apps/panels/history-panel.js","webpack:///./galaxy/scripts/mvc/history/options-menu.js","webpack:///./galaxy/scripts/mvc/history/history-view-edit-current.js","webpack:///./galaxy/scripts/utils/ajax-queue.js","webpack:///./galaxy/scripts/mvc/history/history-view-edit.js","webpack:///./galaxy/scripts/mvc/history/history-view.js","webpack:///./galaxy/scripts/ui/loading-indicator.js","webpack:///./galaxy/scripts/mvc/history/hda-li-edit.js","webpack:///./galaxy/scripts/mvc/history/hdca-li-edit.js","webpack:///./galaxy/scripts/mvc/collection/collection-view-edit.js","webpack:///./galaxy/scripts/mvc/collection/collection-li-edit.js","webpack:///./galaxy/scripts/mvc/collection/pair-collection-creator.js","webpack:///./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js","webpack:///./galaxy/scripts/utils/levenshtein.js","webpack:///./galaxy/scripts/mvc/user/user-preferences.js","webpack:///./galaxy/scripts/mvc/user/user-custom-builds.js","webpack:///./galaxy/scripts/mvc/grid/grid-shared.js","webpack:///./galaxy/scripts/mvc/workflow/workflow.js","webpack:///./galaxy/scripts/mvc/workflow/workflow-model.js","webpack:///./galaxy/scripts/mvc/history/history-list.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-error.js","webpack:///./galaxy/scripts/mvc/dataset/dataset-edit-attributes.js"],"names":["webpackJsonp","module","exports","__webpack_require__","jQuery","_interopRequireDefault","obj","__esModule","default","_interopRequireWildcard","newObj","key","Object","prototype","hasOwnProperty","call","mixin","mixinHash1","propsHash","args","Array","slice","arguments","lastArg","pop","unshift","_","defaults","apply","wrapTemplate","template","jsonNamespace","templateFn","join","json","view","templateVars","_l","buildComparator","attribute_name","options","ascending","a","b","get","defineProperty","value","_underscore","_backbone","Backbone","_addLogging","_addLogging2","_localization","_localization2","LoggableMixin","logger","_logNamespace","SessionStorageModel","Model","extend","initialize","initialAttrs","this","_checkEnabledSessionStorage","id","Error","existing","isNew","_read","clear","silent","save","on","window","sessionStorage","length","err","alert","sync","method","model","trigger","returned","_create","_update","_delete","undefined","success","error","toJSON","set","setItem","JSON","stringify","DOMException","navigator","userAgent","indexOf","parse","getItem","removeItem","_log","toString","omit","SearchableModelMixin","searchAttributes","searchAliases","searchAttribute","attrKey","searchFor","attrVal","isArray","_searchArrayAttribute","toLowerCase","array","any","elem","search","filter","matches","term","split","matchesAll","terms","match","s","all","replace","HiddenUntilActivatedViewMixin","hiddenUntilActivated","$activator","HUAVOptions","$elementShown","$el","showFn","toggle","showSpeed","hasBeenShown","is","hidden","isHidden","ev","isFunction","onshowFirstTime","onshow","onhide","DraggableViewMixin","attributes","draggable","$dragHandle","$","toggleDraggable","draggableOff","draggableOn","dragStartHandler","bind","_dragStartHandler","dragEndHandler","_dragEndHandler","handle","attr","addEventListener","removeEventListener","event","dataTransfer","effectAllowed","setData","SelectableViewMixin","selectable","selected","$selector","_renderSelected","find","toggleClass","toggleSelector","hideSelector","showSelector","speed","fxSpeed","show","hide","toggleSelect","deselect","select","_data","_data2","_util","_util2","_config","_config2","_gridView","_gridView2","_uiTabs","_uiTabs2","_uiMisc","CustomToJSON","self","each","constructor","to_json_keys","k","val","to_json_mappers","select_datasets","filters","success_fn","history_grid","url_base","Galaxy","root","dict_format","embedded","library_grid","tabs","View","add","title","append","modal","body","closing_events","buttons","Cancel","Add","requests","console","log","ajax","url","dataType","data","data_type","hda_ldda","current","when","then","track_defs","map","arg","CanvasManager","default_font","dummy_canvas","new_canvas","dummy_context","getContext","font","char_width_px","measureText","width","patterns","load_pattern","path","image","Image","src","onload","createPattern","get_pattern","canvas","manager","Cache","num_elements","obj_cache","key_ary","get_elt","key_str","index","stale","splice","move_key_to_end","set_elt","shift","push","size","most_recently_added","GenomeDataManager","dataset","genome","init_data","min_region_size","filters_manager","data_mode_compatible","entry","mode","can_subset","initial_entries","add_data","entries","set_data","region","data_is_ready","ready_deferred","Deferred","query_type","ss_deferred","ServerStateDeferred","ajax_settings","interval","response","go","resolve","search_features","query","params","getJSON","load_data","resolution","extra_params","chrom","low","high","filter_names","i","name","filter_cols","result","get_data","is_deferred","entry_region","is_subregion","contains","subset_entry","copy","last_request","trim","DEEP_DATA_REQ","BROAD_DATA_REQ","get_more_data","req_type","cur_data","_mark_stale","query_low","start_val","max_high","query_region","data_manager","new_data_request","new_data_available","concat","max_low","message","can_get_more_detailed_data","dataset_type","get_more_detailed_data","detail_multiplier","num_samples","get_genome_wide_data","all_data_available","gw_data","chrom_info","chrom_data","GenomeRegion","start","end","len","deferred","genome_wide_data","subregion","subset_fns","bigwig","data_point","refseq","seq_start","subregion_data","same","GenomeReferenceDataManager","dataset_placeholder","urlRoot","data_url","Genome","chroms_info","dbkey","get_chroms_info","get_chrom_region","chr_name","get_chrom_len","str_val","from_str","pieces","start_end","parseInt","compute_overlap","a_region","first_chrom","second_chrom","first_start","second_start","first_end","second_end","overlap_results","DIF_CHROMS","BEFORE","OVERLAP_START","CONTAINS","AFTER","CONTAINED_BY","OVERLAP_END","chrom_len","overlaps","intersection","GenomeRegionCollection","Collection","BrowserBookmark","note","BrowserBookmarkCollection","BackboneTrack","Dataset","models","default_value","label","type","ConfigSettingCollection","from_models_and_saved_values","prefs","preloaded_data","p","color","d","BackboneTrackCollection","Visualization","vis_json","GenomeVisualization","drawables","bookmarks","viewport","tracks","unset","add_tracks","dummy","obj_type","content_visible","TrackBrowserRouter","Router","route","new_loc","navigate","change_location","go_to","commatize","number","rgx","test","_go","setTimeout","get_random_color","colors","new_color","nr","ng","nb","other_color","or","og","ob","n_brightness","o_brightness","diff","brightness","r","g","ok","num_tries","Math","round","random","r1","g1","b1","r2","g2","b2","max","min","abs","substr","_uiModal","_uiFrames","_iconButton","_iconButton2","DatasetMetadata","metadata","_set_metadata","keys","new_key","get_metadata","attribute","TabularDataset","chunk_url","first_data_chunk","offset","at_eof","url_viz","get_next_chunk","next_chunk","chunk","rval","ck_data","DatasetCollection","TabularDatasetChunkedView","row_count","loading_chunk","TabularButtonTracksterView","expand_to_container","height","scroll_elt","attempt_to_fetch","func","scrolled_to_bottom","loading_indicator","_renderChunk","render","data_table","cellpadding","column_names","header_container","appendTo","header_row","j","first_chunk","scroll","_renderCell","cell_contents","colspan","$cell","text","column_types","addClass","_renderRow","line","cells","row","num_columns","range","TopLevelTabularDatasetChunkedView","parents","css","scrollTop","EmbeddedTabularDatasetChunkedView","position","overflow","innerHeight","el","scrollHeight","col","dataset_id","genome_build","file_ext","parent","frame","str","btn_viz","IconButtonView","IconButton","icon_class","setElement","events","mouseover tr","mouseleave","e","target","children","eq","html","n","isNaN","parseFloat","isFinite","btn_viz_pars","gene_region","left","top","off","click","param","createTabularDatasetChunkedView","dataset_config","parent_elt","ConfigSetting","set_value","to_key_value_dict","setting","get_value","set_default_value","saved_values","m","ConfigSettingCollectionView","className","container","collection","option","container_div","input","removeClass","tip","siblings","stopPropagation","document","unbind","new_color_icon","tooltip","tip_inner","farb_obj","farbtastic","callback","fixed_farb_obj","setColor","help","render_in_modal","cancel_fn","ok_fn","update_from_form","check_enter_esc","keyCode","which","OK","_utils","_utils2","_gridModel","_gridModel2","_gridTemplate","_gridTemplate2","_popupMenu","_popupMenu2","ajaxSettings","traditional","grid","grid_config","add_tag_to_grid_filter","tag_name","tag_value","tag","slideToggle","add_filter_condition","items","url_data","v","init_grid","use_panels","padding","handle_refresh","refresh_frames","inArray","currHistoryPanel","loadCurrentHistory","allow_title_display","setWindowTitle","header","footer","use_hide_message","init_grid_elements","init_grid_controls","init_refresh_on_change","submit_operation","keyup","set_sort_condition","submit","column_key","text_input_obj","text_input","remove","remove_filter_condition","set_categorical_filter","check_all_items","checkboxes","check_count","update_checked","change","rating","set_page","execute","href","item","button","popup","operation","_add_operation","settings","operation_config","allowed","allow_popup","addItem","url_args","confirmation_text","confirm","preventDefault","onclick","encode_id","findItemByHtml","add_filter","t","filter_element","go_page_one","remove_filter","col_key","cur_sort","new_sort","substring","sort_arrow","new_value","category_filter","cur_value","filter_value","empty","new_page","page_num","cur_page","operation_button","operation_name","findWhere","operations","item_ids","check","state","prop","c","href_parts","href_parms_str","href_parms","location","get_url_data","can_async_op","update_grid","async","advanced_search","response_text","insert","parseJSON","complete","WebhookModel","activate","Webhooks","WebhookView","me","toolId","toolVersion","fetch","webhook","styles","script","webhooks","on_click","menu_options","is_menu_button","enabled","visible","tooltip_config","placement","new_elem","replaceWith","buffer","IconButtonCollection","IconButtonMenuView","tagName","elt","make_popupmenu","create_icon_buttons_menu","config","global_config","button_config","FrameView","$header","$title","$content","listenTo","menu","$option","icon","disabled","content","defaultOptions","cols","rows","cell","margin","top_min","frame_max","top_max","frame_z","frame_counter","frame_uid","frame_list","frame_shadow","_frameInit","_frameResize","_panelRefresh","resize","Close","frame_id","_toPixelCoord","_frameInsert","del","$frame","fadeOut","_panelAnimationComplete","fadeIn","mousemove","mouseup","mousewheel","DOMMouseScroll","mousedown .frame","mousedown .frame-background","mousedown .frame-scroll-up","mousedown .frame-scroll-down","mousedown .f-close","_eventFrameMouseDown","hasClass","_frameIdentify","xy","x","originalEvent","pageX","y","pageY","_frameDragStart","_eventFrameMouseMove","event_xy_new","event_xy_delta","_frameScreen","min_dim","_toGridCoord","_frameOffset","l","_eventFrameMouseUp","_frameDragStop","_eventFrameClose","_eventHide","_eventPanelScroll","srcElement","_panelScroll","detail","wheelDelta","_eventPanelScroll_up","_eventPanelScroll_down","closest","_frameFocus","_frameGrid","grid_location","px","sign","_toGrid","_toPixel","_isCollision","_locationRank","loc","animate","promise","done","delta","top_new","screen_location","grid_rank","place_list","f","sort","place","_framePlace","has_focus","PopupMenu","$button","_renderAndShow","clickEvent","_getShownPosition","_setUpCloseBehavior","li","_templateOptions","divider","checked","menuWidth","scrollLeft","closePopup","contents","one","findIndexByHtml","has","create","button_element","initial_options","convertedOptions","optionVal","optionKey","newOption","convertLinksToOptions","$parent","selector","$link","linkHref","linkTarget","confirmText","fromExistingDom","$buttonElement","$menuElement","menuElementLinkSelector","make_popup_menus","menuSelector","buttonSelectorBuildFn","popupMenusCreated","fromDom","onchange","_template","$nav","_add","_remove","_change","_reset","first","delAll","reset","showTab","hideTab","tab_model","_template_tab","$tmpl","$href","addLogging","namespace","addTo","LOGGING_FNS","forEach","logFn","emit","_toolForm","VisibilityMixin","is_visible","ToolParameter","unescape","ToolParameterCollection","DataToolParameter","IntegerToolParameter","get_samples","d3","scale","linear","domain","ticks","FloatToolParameter","SelectToolParameter","subModelTypes","integer","float","Tool","description","inputs","outputs","remove_inputs","types","tool","incompatible_inputs","only_samplable_inputs","valid_inputs","apply_search_results","results","set_input_value","set_input_values","inputs_dict","input_name","run","_run","rerun","target_dataset","regions","action","target_dataset_id","get_inputs_dict","input_dict","additional_params","payload","tool_id","run_deferred","contentType","ToolCollection","ToolSectionLabel","ToolSection","elems","open","clear_search_results","cur_label","all_hidden","ToolSearch","search_hint_string","min_chars_for_search","clear_btn_url","clear_key","do_search","q","timer","clearTimeout","ga","clear_search","ToolPanel","tool_search","tools","layout","parse_elt","elt_dict","model_class","panel_elt","BaseView","update_visible","ToolLinkView","templates","tool_link","formStyle","upload","router","version","ToolSectionLabelView","ToolSectionView","update_open","panel_section","section_body","tool_view","label_view","click .toolSectionTitle > a","slideDown","slideUp","ToolSearchView","keyup :input","change :input","click #search-clear-btn","focus_and_select","focus","query_changed","evData","ToolPanelView","handle_search_results","search_view","section_title_view","ToolFormView","tool_form","tool_panel_view","tool_form_view","show_tool","variable","_uiMisc2","_uiModal2","_toolFormBase","_toolFormBase2","_webhooks","_webhooks2","form","merge","listen_to_history","always_refresh","buildmodel","process","build_url","build_data","job_id","display","_customize","debug","status","error_message","err_msg","redirect","prepend","Message","persistent","large","reject","postchange","current_state","tool_version","wait","request","update","execute_button","Button","cls","wait_cls","portlet","disable","unwait","enable","job_remap","ignore","job_def","validate","$f","enctype","_templateSuccess","jobs","refreshContents","input_found","err_data","error_messages","matchResponse","input_id","highlight","_templateError","job_inputs","batch_n","batch_src","job_input_id","input_value","input_field","field_list","input_def","input_list","optional","batch","values","njobs","njobs_text","$message","output","hid","async_ops","categorical_filters","sort_key","show_item_checkboxes","num_pages","op","new_val","cur_val","condition","condition_index","page","pairs","get_url","tmpl","grid_header","grid_table","info_text","global_actions","show_popup","grid_filters","columns","column","extra","num_rows_rendered","encoded_id","current_item_id","nowrap","column_settings","column_config","link","attach_popup","label_id_prefix","use_paging","num_page_links","cur_page_num","page_link_range","min_page","min_offset","max_offset","max_range","max_page","page_index","allow_multiple","found_global","global_operation","legend","escape","default_filter_dict","advanced_search_display","show_advanced_search_link","filterable","f_key","d_key","standard_search_display","grid_column_filter","column_label","is_text","temp_column","column_filter","seperator","cf_label","cf","cf_key","cf_arg","filter_key","sanitize","_tracks","_tracks2","_visualization","_visualization2","_queryStringParsing","_queryStringParsing2","ui","Base","TracksterUI","baseURL","cssLoadFile","save_viz","annotation","overview_track_name","overview_drawable","viz_config","to_dict","overview","vis_id","vis_info","has_changes","history","pushState","hash","createButtonMenu","new_tracks","track","add_drawable","object_from_template","DrawableGroup","force_right_panel","handle_unsaved_changes","buttonMenu","add_bookmark","editable","bookmarks_container","new_bookmark","position_div","annotation_div","delete_icon_container","prependTo","make_text_editable","num_rows","use_textarea","help_text","create_visualization","view_config","viewport_config","drawables_config","bookmarks_config","TracksterView","editor","load_chroms_deferred","overview_drawable_name","change_chrom","set_overview","bookmark","set_up_router","init_keyboard_nav","move_fraction","viewport_container","Leave without Saving","Save","resize_window","galaxy_config","app","view_existing","choose_existing_or_new","view_new","listTracksParams","dataset_params","View in saved visualization","view_in_saved","View in new visualization","tracks_grid","Add to visualization","init_editor","template_view_new","Create","create_browser","dbkeys_in_genomes","default_dbkey","select2","add_dataset","track_data","GalaxyApp","num","places","pow","supportsByteRanges","beforeSend","xhr","setRequestHeader","_viz_views","_viz_views2","_slotting","_slotting2","_painters","_painters2","_filters","_filters2","_tools","_tools2","_bbiDataManager","_bbiDataManager2","html_elt_js_obj_dict","is_container","element","moveable","handle_class","container_selector","element_js_obj","relative","child","bottom","this_obj","outerHeight","cur_container","offsetY","insertBefore","remove_drawable","add_drawable_before","insertAfter","move_drawable","deltaY","DATA_NOCONVERTER","CONTINUOUS_DATA_MODES","Drawable","obj_dict","id_counter","drag_handle_class","is_overview","action_icons","config_params","config_onchange","build_container_div","header_div","header_view","TrackHeaderView","icons_div","hover","action_icons_def","css_class","on_click_fn","drawable","toggle_icon","hide_contents","show_contents","init","changed","can_draw","request_draw","_draw","set_name","new_name","old_name","revert_name","update_intro_div","update_icons","get_drawables","DrawableCollection","unpack_drawables","drawables_array","dictified_drawables","other","replace_drawable","old_drawable","new_drawable","update_html","new_position","get_tracks","track_type","queue","content_div","FiltersManager","after","parent_div","saved_filters_managers","old_manager","setup_multitrack_filtering","group","show_composite_track","clear_filters","_restore_filter_managers","clear_tile_cache","tiles_div","num_drawables","composite_icon","filters_icon","CompositeTrack","a_type","get_type","num_feature_tracks","can_composite","FeatureTrack","LineTrack","shared_filters","remove_all","new_filter","filter_name","NumberFilter","init_filters","composite_track","stand_alone","label_tracks","tracks_to_be_redrawn","zoom_factor","min_separation","canvas_manager","ownerDocument","requested_redraw","parent_element","top_container","browser_content_div","bottom_container","top_labeltrack","intro_div","nav_container","nav","overview_viewport","overview_close","overview_highlight","overview_box_background","overview_box","default_overview_height","nav_controls","chrom_select","submit_nav","location_span","nav_input","autocomplete","source","all_features","feature_search_deferreds","dataset_features","feature","minLength","hidden_input","zo_link","zoom_out","zi_link","zoom_in","load_chroms","current_x","offsetX","delta_chrom","move_delta","reset_overview","clientX","original_low","current_height","clientY","new_scroll","proxy","startX","span","update_location","old_low","request_redraw","add_label_track","LabelTrack","resize_timer","redraw","get_base_color","base","trigger_navigate","new_chrom","new_low","new_high","delay","url_parms","reference","ref_track","ReferenceTrack","reference_track","chrom_option","prev_chroms","next_chroms","chrom_start_index","start_index","found","grep","chrom_pos","fraction","current_chrom_span","data_fetch","redraw_on_move_fn","label_track","track_list","track_options","to","requestAnimationFrame","_redraw","floor","ceil","resolution_px_b","left_px","width_px","point","cur_center","new_half","resize_viewport","postdraw_actions","TracksterTool","tool_state","state_dict","ToolParameterView","param_div","update_value","update_event","TracksterToolView","set_visible","keydown","param_view","run_tool_row","run_on_dataset_button","run_on_region","run_on_dataset","update_params","url_params","current_track","track_name","tool_region_and_parameters_str","new_track","init_for_tool_data","change_mode","set_filters_manager","set_dataset","success_callback","FilterScaler","default_val","Scaler","gen_val","feature_data","Number","MAX_VALUE","Tile","w_scale","html_elt","predisplay_actions","LineTrackTile","FeatureTrackTile","all_slotted","feature_mapper","incomplete_features","seq_data","has_icons","other_tiles_features_drawn","Track","dataset_check_type","data_url_extra_params","data_query_wait","data_and_mode_compatible","min_height_px","max_height_px","visible_height_px","add_resize_handle","regions_to_use","view_region","bookmarked_regions","No","Yes","on_resize","in_handle","in_drag","drag_control","original_height","new_height","tile_cache","ReadTrack","VariantTrack","show_message","msg_html","retry","init_deferred","kind","valid_chroms","predraw_init","msg_elt","stats","min_value","max_value","mean","sd","TiledTrack","filters_available","left_offset","dynamic_tool_div","overlay_div","slotters","max_rows","set_min_max","new_mode","mode_icon","tools_icon","param_space_viz_icon","_gen_tile_cache_key","tile_region","before_draw","clear_after","tile_promise","tile_width","tile_index","tile_promises","tiles","draw_helper","tile","_add_yaxis_label","on_change","pref_name","num_cols","on_finish","force","get_mode","update_auto_mode","display_mode","_get_drawables","o","show_tile","get_tile_data","data_mode","tile_data","tile_drawn","tracks_data","drawing_modes","drawing_heights","get_canvas_height","tile_low","tile_high","ctx","translate","globalAlpha","globalCompositeOperation","draw_tile","canvas_width","_draw_line_track_tile","LinePainter","draw","ref_seq","tile_element","track_height","extra_info","tickDistance","new_div","screenPosition","display_modes","build_config_params","union","show_group","visible_height","init_deferreds","update_all_min_max","max_height","new_visible","cur_visible","subset","textAlign","str_len","fillStyle","fillText","BBIDataManager","DiagonalHeatmapTrack","DiagonalHeatmapPainter","summary_draw_height","start_end_dct","set_painter_from_config","painter","ArcLinkedFeaturePainter","LinkedFeaturePainter","all_incomplete_features","pluck","inc_features","tile_incomplete_features","features","new_canvas_ctx","drawImage","new_tile","update_ui_elt","example_feature","applies_to","show_more_rows_icon","incremental_slots","level","slotter","FeatureSlotter","slot_features","rows_required","dummy_painter","get_required_height","cur_tile","filtered","slots","hide_feature","flen","update_attrs","keep","filter_alpha_scaler","alpha_filter","filter_height_scaler","height_filter","draw_results","translation","VariantPainter","deferreds","line_track_tiles","sample_names","font_size","font-size","samples_div_html","line-height","ReadPainter","addable_objects","VcfTrack","drawable_type","update_name","render_action_icons","dblclick","icon_dict","add_action_icon","set_display_modes","new_modes","init_mode","mode_mapping","SlottedInfo","slot","include_label","_get_draw_coords","draw_start","draw_end","f_name","text_len","_find_slot","draw_coords","slot_num","has_overlap","k_len","s_e","feature_uid","undone","highest_slot","slotted_info","old_draw_coords","new_draw_coords","slotted_coords","dc","first_region","second_region","is_overlap","overlap","dashedLine","x1","y1","x2","y2","dashLen","dX","dY","dashes","sqrt","dashX","dashY","fillRect","drawDownwardEquilateralTriangle","down_vertex_x","down_vertex_y","side_len","beginPath","moveTo","lineTo","strokeStyle","fill","stroke","closePath","DrawResults","Painter","view_start","view_end","default_prefs","get_start_draw_pos","_chrom_pos_to_draw_pos","get_end_draw_pos","get_draw_pos","overflow_color","in_path","vertical_range","height_px","y_zero","x_scaled","delta_x_pxs","delta_x_px","painter_color","block_color","pref_color","pref_r","pref_g","pref_b","top_overflow","bot_overflow","saturation","new_r","new_g","new_b","overflow_x","restore","FeaturePositionMapper","slot_height","feature_positions","y_translation","map_feature_data","x_start","x_end","get_feature_data","feature_dict","FeaturePainter","alpha_scaler","height_scaler","max_label_length","connector_color","required_height","get_row_height","y_scale","get_top_padding","x_draw_coords","feature_start","feature_end","draw_element","draw_background_connector","draw_individual_connectors","y_start","feature_name","feature_strand","f_start","f_end","thick_start","thick_end","reverse_strand_color","label_color","feature_ts","feature_te","feature_blocks","full_height","thin_height","thick_height","cur_y_start","cur_height","SQUISH_FEATURE_HEIGHT","last_block_start","last_block_end","block","block_start","block_end","block_thick_start","block_thick_end","draw_connector","hscale_factor","ws_height","base_color_fn","show_insertions","_parse_cigar","cigar_str","cigar_ops","blocks","cur_block","base_pos","parsed_cigar","op_len","op_char","cigar","draw_read","strand","read_seq","get_draw_coord","sequence_coord","s_start","s_end","base_offset","seq_offset","gap","detail_block_color","pack_mode","draw_height","rect_y","paint_utils","ReadPainterUtils","drawing_blocks","draw_last","cig_id","cig","cig_op","cig_len","cur_seq","start_pos","show_differences","c_start","draw_deletion","insert_x_coord","seq","x_center","connector","b1_end","b2_start","line_height","longest_feature_length","calculate_longest_feature_length","view_range","block1_start","block1_end","block2_start","block2_end","radius","PI","arc","Color","rgb","alpha","eval","toCSS","toHSL","h","toARGB","mix","color2","weight","color1","w","w1","w2","LinearRamp","start_color","end_color","start_value","end_value","value_range","map_value","SplitRamp","middle_color","positive_ramp","negative_ramp","Infinity","pos_color","neg_color","s1","e1","s2","e2","invsqrt2","ramp","rotate","row_height","px_per_base","draw_details","delete_details_thickness","thickness","divider_height","summary_height","show_sample_data","locus_data","pos","ref","alt","sample_gts","allele_counts","variant","draw_x_start","draw_y_start","genotype","get_indel_info","ref_len","alt_len","base_px","feature_height","draw_summary","flatten","alt_info","indel_info","allele_frac","snp","Filter","tool_exp_name","create_action_icon","slider","slider_label","filter_label","values_span","values_span_container","slider_div","control_element","step","get_slider_step","slide","input_size","multi_value","slider_row","blur","slider_min","slider_max","invalid","a_val","display_controls_div","transparency_icon","height_icon","_keep_val","to_filter","returnVal","updated","alpha_filter_name","height_filter_name","filters_dict","run_buttons_row","filter_manager","filter_dicts","tool_filter_conditions","get_or_create_dict_item","dict","new_item","active_filters","active_filters_list","run_filter","input_dataset_id","filter_tuple","tool_filters","tool_filter_str","cond","run_tool_url","_bigwig","makeBwg","bb","readWigData","prev","MIN_VALUE","score","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","spans","jszlib","DASFeature","DASGroup","readInt","ba","read","timeout","xhrObj","xhrFields","responseType","bwg_readOffset","M1","M2","M3","M4","BigWig","BigWigView","bwg","cirTreeOffset","cirTreeLength","isSummary","Uint8Array","sa","Int16Array","la","Int32Array","magic","BIG_WIG_MAGIC","BIG_BED_MAGIC","BIG_WIG_MAGIC_BE","BIG_BED_MAGIC_BE","numZoomLevels","chromTreeOffset","unzoomedDataOffset","unzoomedIndexOffset","fieldCount","definedFieldCount","asOffset","totalSummaryOffset","uncompressBufSize","extHeaderOffset","zoomLevels","zl","zlReduction","zlData","zlIndex","reduction","dataOffset","indexOffset","readChromTree","getAutoSQL","as","schema","BBIExtraIndex","bbi","field","Range","jszlib_inflate_buffer","inflateBuffer","arrayCopy","BED_COLOR_REGEXP","RegExp","thisB","chromsToIDs","idsToChroms","maxID","udo","bpt","keySize","bptReadNode","nodeType","cnt","childOffset","ki","charCode","String","fromCharCode","chromId","chrName","chr","readWigDataById","cirHeader","cirBlockSize","blocksToFetch","outstanding","Date","now","fmin","fmax","toks","cirFobRecur","instrument","cachedCirRoot","cirFobRecur2","fetchFeatures","maxCirBlockSpan","blockSpan","fetchRanges","ranges","fr","cirFobStartFetch","attempts","resultBuffer","cirBlockData","isLeaf","lo","startChrom","startBase","endChrom","endBase","blockOffset","blockSize","recurOffsets","b0","createFeature","opts","_chromId","segment","tramp","parseFeatures","fetchStart","fetchSize","bi","fb","tmp","fa","Float32Array","itemCount","byteLength","validCnt","maxVal","sumData","summaryOpts","maxScore","blockStart","itemStep","itemSpan","blockType","dfc","rest","ch","bedColumns","featureOpts","orientation","itemRgb","fields","thickStart","thickEnd","blockCount","blockSizes","blockStarts","exonFrames","grp","notes","groups","geneId","geneName","geneName2","gg","spanList","bmin","bmax","tsList","ts","codingRegion","tl","tlList","readingFrame","tlOffset","readframe","brf","readframeExplicit","getFirstAdjacent","dir","getFirstAdjacentById","blockToFetch","bestBlockChr","bestBlockOffset","chrx","bestFeature","bestChr","bestPos","fi","exec","bestRecur","getUnzoomedView","getZoomedView","unzoomedView","cirLen","z","zh","_tsFetch","zoom","topLevelReductionCache","feats","thresholdSearch","referencePoint","threshold","fbThresholdSearchRecur","candidates","c1","c2","chrOrd","candidate","rp","fromRef","initialChr","chrId","header_re","field_re","headerMatch","declType","comment","getExtraIndices","extraIndexCount","extraIndexListOffset","eil","indices","ii","eiType","eiFieldCount","eiOffset","eiField","lookup","nodeOffset","valSize","node","Uint16Array","Uint32Array","lastChildOffset","localeCompare","_min","_max","_Compound","sorted","_rangeOrder","merged","_ranges","s0","insertRange","r0","l0","l1","i0","i1","lapMin","lapMax","coverage","tot","rl","ri","rangeOrder","isContiguous","_pushRanges","lower_bound","lb","ub","rangeOver","ZStream","Inflate","was","InfBlocks","checkfn","hufts","MANY","IB_TYPE","table","blens","tb","codes","InfCodes","last","bitk","bitb","write","inftree","InfTree","inflate_trees_fixed","bl","bd","td","fixed_bl","fixed_bd","fixed_tl","fixed_td","Z_OK","srcOffset","dest","destOffset","count","arrayCopy_fast","hasSubarray","subarray","BYTES_PER_ELEMENT","byteOffset","arrayCopy_slow","afterUncOffset","inflateInit","DEF_WBITS","next_in","next_in_index","avail_in","oBlockList","totalSize","obuf","next_out","next_out_index","avail_out","inflate","Z_NO_FLUSH","Z_STREAM_END","Z_BUF_ERROR","msg","newob","out","cursor","inflate_mask","cplens","cplext","cpdist","cpdext","istate","inflateEnd","ret","inflateSync","inflateSetDictionary","dictionary","dictLength","inflateReset","total_in","total_out","free","wbits","marker","need","adler","proc","_adler","adler32","set_dictionary","mark","inflateSyncPoint","sync_point","INFBLOCKS_BORDER","inflate_flush","inflate_trees_bits","inflate_trees_dynamic","tl_index","td_index","lbits","dbits","ltree","ltree_index","dtree","dtree_index","tree","tindex","inflate_fast","tree_index","lit","dist","tp","tp_index","ml","md","tp_index_t_3","huft_build","bindex","hp","hn","mask","xp","u","initWorkArea","nl","nd","vsize","BMAX","testArray","__WEBPACK_AMD_DEFINE_FACTORY__","factory","responseFields","native","converters","support","xhrId","xhrSuccessStatus","0","1223","xhrCallbacks","xhrSupported","ActiveXObject","cors","ajaxTransport","crossDomain","send","headers","responses","username","password","mimeType","overrideMimeType","onerror","abort","statusText","getAllResponseHeaders","hasContent","getNative","_baseMvc","_baseMvc2","User","email","total_disk_usage","nice_total_disk_usage","quota_percent","is_admin","resp","changes","isAnonymous","isAdmin","loadFromApi","idOrCurrent","CURRENT_ID_STR","userFn","newModel","clearSessionStorage","userInfo","getCurrentUserFromApi","currentUser","_menu","_menu2","_scratchbook","_scratchbook2","_userQuotameter","_userQuotameter2","$navbarBrandLink","$navbarBrandImage","$navbarBrandTitle","$navbarTabs","$quoteMeter","Tab","quotaMeter","UserQuotaMeter","user","$download_link","brand","logo_url","logo_src","_genericNavView","_genericNavView2","extendedNavItem","GenericNavView","ready","function","Function","masthead","appendScriptStyle","helpTab","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","biostar_url","biostar_url_redirect","userTab","session_csrf_token","allow_user_creation","noscratchbook","activeView","active_view","$dropdown","$toggle","$menu","$note","click .dropdown-toggle","visibility","_formatUrl","menuItem","_buildMenuItem","_toggleClick","buildLink","popover","charAt","makeModalIframe","host","communication_server_host","port","communication_server_port","persistent_communication_rooms","query_string","$el_chat_modal_header","$el_chat_modal_body","iframe_template","title_separator","removeAttr","frame_width","frame_height","_uiFrames2","_trackster","_trackster2","frames","buttonActive","active","show_note","note_cls","onbeforeunload","buttonLoad","history_cache","addDataset","current_dataset","history_id","historyId","dataset_ids","_findDataset","history_details","dataset_list","_loadDatasetOffset","new_dataset_id","_loadDataset","new_dataset","is_tabular","addTrackster","viz_id","viz","frame_config","latest_revision","$galaxy_main","warnAtPercent","errorAtPercent","isOverQuota","_render_quota","modelJson","percent","$meter","_templateQuotaMeter","$bar","_render_usage","usage","_templateUsage","meterHtml","optionsDefault","with_close","uid","$close","$body","_get_placement","newTitle","_get_width","$container","container_width","container_height","_get_height","container_position","STATES","UPLOAD","QUEUED","RUNNING","SETTING_METADATA","NEW","EMPTY","PAUSED","FAILED_METADATA","NOT_VIEWABLE","DISCARDED","ERROR","READY_STATES","NOT_READY_STATES","placeholder","multiple","minimumInputLength","initialData","select_data","_refresh","_setValue","before","_getValue","_getIndex","select_opt","containerCssClass","dropdownCssClass","escapeMarkup","formatResult","formatSelection","initSelection","dropdownAutoWidth","findIndex","_jquery","_jquery2","faIconButton","tooltipConfig","classes","faIcon","bootstrapped","_init","_userModel","_userModel2","_metricsLogger","_metricsLogger2","NAMESPACE_KEY","DEBUGGING_KEY","localDebugging","localStorage","storageErr","Events","_processOptions","_initConfig","_patchGalaxy","_initLogger","loggerOptions","_initLocale","localize","_initUser","_setUpListeners","patchExisting","patchWith","consoleLogger","consoleLevel","MetricsLogger","ALL","consoleNamespaceWhitelist","consoleFlattenMessages","userJSON","lastAjax","debugging","debuggingNamespaces","namespaces","csv","newSettings","userId","usefulToString","asStr","LoggingCache","_typeof","Symbol","iterator","LOG","DEBUG","INFO","WARN","METRIC","NONE","logLevel","defaultNamespace","clientPrefix","maxCacheSize","postSize","addTime","cacheKeyPrefix","postUrl","delayPostInMs","getPingData","onServerResponse","_parseLevel","_sending","_waiting","_postSize","_initCache","cache","maxSize","_emitToConsole","upper","toUpperCase","logArguments","_addToCache","_buildEntry","_postCache","time","toISOString","entriesLength","postData","metrics","post","always","fail","readyState","responseJSON","responseText","_delayPost","whitelist","info","warn","metric","_hasStorage","_initStorage","_cache","_fetchAndParse","overage","_unparseAndStore","removed","print","_masthead","_masthead2","_panel","_panel2","_panelids","message_box_visible","message_box_content","message_box_class","show_inactivity_warning","inactivity_box_content","center","CenterPanel","$messagebox","$inactivebox","panels","panel_id","panel_class_name","panel_class","panel_instance","SidePanel","renderMessageBox","renderInactivityBox","renderPanels","_checkCommunicationServerOnline","verificationLink","panel","preferences","$chat_icon_element","communication_server","extension","url_paste","file_name","file_mode","file_size","file_type","file_path","file_data","percentage","space_to_tab","to_posix_lines","TagsEditor","select_width","show_editor","usePrompt","workflow_mode","_workflowTemplate","_defaultTemplate","$input","tags","_getTagsUsed","_setUpBehaviors","_hashToName","startsWith","_nameToHash","_renderEditor","_renderTags","keydownHandler","hideEditor","showEditor","tagsToCSV","renderedArray","renderString","tagsArray","isEmpty","added","_addNewTagToTagsUsed","newTag","tagsUsed","stopListening","__identifer","isEmptyObject","queryObj","authenticate","access_denied","class_check","class_uncheck","parameters","$cover","$table","parameter","$checkbox","class_add","class_remove","class_partial","help_enabled","ftp_upload_site","onadd","onremove","$wait","$help","$number","$disk","$warning","$select","ftp_files","_index","_renderTable","ftp_file","bytesToString","_all","$it","_templateRow","$icon","model_index","ftp_index","_switch","new_index","counts","reduce","memo","ctime","_uiPopover","_uiPopover2","list","extension_popup","_templateDescription","description_url","props","uploadpost","cnf","progress","maxfilesize","error_filesize","error_default","error_server","error_login","FormData","sizes","files","file","XMLHttpRequest","onreadystatechange","DONE","lengthComputable","loaded","total","fn","uploadinput","ondragover","ondragleave","dialog","uploadbox","queue_running","duplicate","queue_index","announce","queue_length","queue_stop","stop","configure","compatible","File","FileList","dragover","dragleave","createListCollection","defaultHideSourceItems","elements","listCollectionCreatorModal","creationFn","hideSourceItems","history_content_type","createHDCA","_hdcaModel","_hdcaModel2","_states","_states2","_baseCreator","_baseCreator2","_naturalSort","DatasetCollectionElementView","_dragstart","_dragend","discard","parentWidth","margin-right","destroy","click .name","click .discard","drop","_click","_clickName","prompt","_clickDiscard","_sendToParent","ListCollectionCreator","CollectionCreatorMixin","elementViewClass","collectionClass","HistoryListDatasetCollection","minElements","defaultAttributes","TypeError","oncreate","oncancel","autoscrollDist","highlightClr","footerSettings",".hide-originals","creator","initialElements","_setUpCommonSettings","_instanceSetUp","_elementsSetUp","selectedIds","$dragging","blocking","invalidElements","workingElements","elementViews","_ensureElementIds","_validateElements","_mangleDuplicateNames","_sortElements","uniqueId","problem","_isElementInvalid","deleted","purged","counter","existingNames","currName","_renderInvalid","main","_renderHeader","_renderMiddle","_renderFooter","_addPluginComponents","invalidInitial","problems","helpContent","_invalidElementsAlert","$middle","middle","_renderList","hoverhighlight","_showAlert","_disableNameAndCreate","isUndefined","$list","_renderClearSelected","$tmp","removeElementView","elementView","_createElementView","invoke","_listenToElementView","addElementView","without","_renderNoElementsLeft","noElementsLeft","_elementToJSON","createList","hideOriginals","_errorHandler","once","click .more-help","click .less-help","click .main-help","click .header .alert button","click .reset","click .clear-selected","click .collection-elements","dragover .collection-elements","drop .collection-elements","collection-element.dragstart .collection-elements","collection-element.dragend   .collection-elements","change .collection-name","keydown .collection-name","change .hide-originals","click .cancel-create","click .create-collection","clearSelectedElements","_dragoverElements","_checkForAutoscroll","$nearest","_getNearestElement","$placeholder","$element","upperDist","lowerDist","lis","toArray","$li","halfHeight","_dropElements","dropEffect","_syncOrderToDom","newElements","_elementDragstart","_elementDragend","_creatorTemplates","collectionCreatorModal","CreatorClass","_collectionCreator","buildHDCASave","_super","_collectionModel","_collectionModel2","_historyContentModel","_historyContentModel2","hcontentMixin","HistoryContentMixin","ListDC","ListDatasetCollection","PairDC","PairDatasetCollection","ListPairedDC","ListPairedDatasetCollection","ListOfListsDC","ListOfListsDatasetCollection","clone","collection_type","HistoryPairDatasetCollection","HistoryListPairedDatasetCollection","HistoryListOfListsDatasetCollection","_datasetModel","_datasetModel2","DatasetCollectionElementMixin","element_identifier","element_index","element_type","_mergeObject","object","element_id","idAttribute","DatasetCollectionElement","DCECollection","DatasetDCE","DatasetAssociation","_downloadQueryParameters","fileExt","elementIdentifier","hasDetails","DatasetDCECollection","_createElementsModel","parent_hdca_id","inReadyState","populated","isDeletedOrPurged","getVisibleContents","parsed","create_time","update_time","delete","undelete","NestedDCDCE","NestedDCDCECollection","NestedPairDCDCE","NestedPairDCDCECollection","NestedListDCDCE","NestedListDCDCECollection","data_input","data_collection_input","subworkflow","pause","_historyContents","_historyContents2","_historyPreferences","_controlledFetchCollection","_controlledFetchCollection2","History","UPDATE_DELAY","contents_active","contents_states","contentsClass","HistoryContents","historyJSON","order","_setUpCollectionListeners","updateTimeoutId","details","clearUpdateTimeout","change:id","newId","makeArray","contentsShown","contentsActive","shown","includeDeleted","includeHidden","nice_size","ownedByCurrUser","numOfUnfinishedJobs","unfinishedJobIds","numOfUnfinishedShownContents","runningAndActive","_fetchContentRelatedAttributes","contentRelatedAttrs","refresh","_this","lastUpdateTime","allFetched","currentPage","fetchPage","fetchUpdated","serverResponseDatetime","getResponseHeader","checkForUpdates","_this2","_delayThenUpdate","historyData","fetchWithContents","contentsOptions","setHistoryId","fetchContents","fetchCurrentPage","purge","allDatasets","all_datasets","setAsCurrent","_collectionSuper","InfinitelyScrollingCollection","HistoryCollection","limitOnFirstFetch","limitPerFetch","currentHistoryId","setUpListeners","change:deleted","copied","original","newData","setCurrent","set-as-current","oldCurrentId","_buildFetchData","_buildFetchFilters","superFilters","fetchFirst","limit","encoded_id-in","fetchMore","comparators","name-dsc","size-asc","currentHistory","hdas","historyOptions","xhrOptions","_hdaModel","_hdaModel2","_historyPreferences2","_ajaxQueue","_ajaxQueue2","PaginatedCollection","limitPerPage","limitPerProgressiveFetch","attrs","HistoryDatasetAssociation","validationError","_setUpWebStorage","initialSettings","storage","HistoryPrefs","historyStorageKey","include-deleted","newVal","include-hidden","hid-asc","running","getByHid","haveDetails","visibleAndUndeleted","setIncludeDeleted","isBoolean","setIncludeHidden","expandedIds","_fetchParams","getTotalItemCount","since","update_time-ge","fetchDeleted","fetchHidden","fetchAllDetails","detailsFlag","fetchCollectionCounts","_filterAndUpdate","filterParams","updateWhat","updateArgs","fetched","modelArray","currJson","ajaxQueue","ajaxFn","AjaxQueue","reverse","isString","progressivelyFetchDetails","_recursivelyFetch","_options","detailKeys","defer","notify","limitPerCall","isCopyable","contentsJSON","copyableModelClasses","isObject","LibraryDatasetDatasetAssociation","HistoryDatasetCollectionAssociation","elementIdentifiers","collectionType","hide_source_items","element_identifiers","haveSearchDetails","matchesWhat","show_deleted","show_hidden","addExpanded","removeExpanded","isExpanded","contentId","allExpanded","clearExpanded","storageKeyPrefix","clearAll","ExpandableView","expanded","$newRender","_buildNewRender","_queueNewRender","$details","_renderDetails","_swapNewRender","next","$where","$newDetails","toggleExpanded","expand","collapse","_fetchModelDetails","_expand","ListItemView","isSelectable","_renderWarnings","_renderTitleBar","_renderPrimaryActions","_renderSubtitle","$warnings","warnings","titleBar","subtitle","click .title-bar","keydown .title-bar","click .selector","_clickTitleBar","altKey","_keyDownTitleBar","FoldoutListItemView","foldoutStyle","foldoutPanelClass","foldout","_createFoldoutPanel","_attachFoldout","FoldoutClass","_getFoldoutPanelClass","_getFoldoutPanelOptions","$whereTo","_expandByDrilldown","detailsTemplate","_listItem","_listItem2","_faIconButton","_faIconButton2","DatasetListItemView","changedAttributes","_renderNametags","_renderDisplayButton","displayBtnData","urls","noAccess","_renderSecondaryActions","_renderSummary","_renderDetailMessages","_renderDisplayApplications","summaryRenderFn","summaries","unknown","detailMessages","displayApplications","_renderDownloadButton","_renderShowParamsButton","show_params","hasData","download","_renderMetaFileDownloadButton","meta_file","meta_download","click .display-btn","click .params-btn","click .download-btn","failed_metadata","noAccessTemplate","summaryTemplates","detailMessageTemplates","resubmitted","displayApplicationsTemplate","_datasetLi","_datasetLi2","DCListItemView","hasUser","titleBarTemplate","subtitleTemplate","DCEListItemView","DatasetDCEListItemView","NestedDCDCEListItemView","_formView","_formView2","submit_tooltip","submit_title","submit_icon","_submit","success_message","matchModel","_showMessage","searchableMixin","accessible","meta_files","misc_blurb","misc_info","_generateUrls","edit","report_error","visualization","currModel","newState","previous","hda","responseObj","format","database","blurb","nameAndId","DatasetAssociationCollection","ids","notReady","startingLength","ajaxFns","chain","curr","isVisible","historyContentType","historyContentId","unhide","_validationWarning","what","_changeHideOriginals","_changeName","_getName","_nameCheckForEnter","_clickCreate","_clickMoreHelp","_clickLessHelp","_toggleHelp","alertClass","_hideAlert","_cancelCreate","$footer","property","naturalSort","re","nC","xN","yN","xD","getTime","yD","oFxNcL","oFyNcL","cLoc","numS","scope","$this","targetSelector","mouseover","background","mouseout","_deferred","_deferred2","_formData","_formData2","_workflowIcons","_workflowIcons2","$steps","_configure","step_index","_handleWorkflowParameter","wp_name","wp_inputs","wp_count","style","links","forms","steps","parms","step_type","step_label","step_name","step_version","fixed_title","citations","collapsible","collapsed","_isDataStep","sustain_version","sustain_repeats","sustain_conditionals","narrow","text_enable","text_disable","cls_enable","cls_disable","errors","messages","initial_errors","hide_operations","needs_refresh","visitInputs","output_connections","output_connection","sub_step","input_step_index","connections_by_name","connection","step_linked","output_name","wp_input","wp_linked","backdrop","post_job_actions","pja","action_arguments","data_resolved","context","is_runtime_value","__class__","is_data_input","data_ref","is_workflow","flavor","collapsible_value","collapsible_preview","_renderMessage","_renderParameters","_renderHistory","_renderStep","execute_btn","_execute","Label","fade","step_version_changes","wp_form","_refreshStep","_append","history_form","test_param","cases","short_str","is_simple_input","hide_label","show_progress","wait_text","source_step","wp_field","wp_value","_refreshHistory","_refresh_history","_enabled","history_form_data","new_history_name","replacement_params","parameters_normalized","validated","step_related_errors","lst","_errorModal","_errorModal2","CopyDialog","defaultName","submitLabel","errorMessage","progressive","activeLabel","allLabel","anonWarning","_showAjaxIndicator","indicator","margin-top","checkNameAndCopy","copyAllDatasets","ajaxErrorModal","rejectWith","autoClose","defaultCopyNameFn","nameFn","defaultCopyName","defaultCopyWhat","allowAll","originalClosingCallback","closing_callback","isAnon","copyWhat","cancelled","ImportDialog","historyCopyDialog","useImport","Ok","DETAILS_MSG","errorModal","offlineErrorModal","badGatewayErrorModal","CONTACT_MSG","DEFAULT_AJAX_ERR_MSG","_ajaxDetails","raven","Raven","onLine","functions","ControlledFetchCollection","setOrder","changed-order","_buildFetchOptions","_fetchFiltersToAjaxData","pick","filterMap","qv","update_time-asc","create_time-asc","comparator","shouldPaginate","getLastPage","getPageCount","getPageLimitOffset","pageNum","constrainPageNum","fetchPrevPage","fetchNextPage","lastFetched","fetchedData","numFetched","fetchAll","_loadingIndicator","_loadingIndicator2","ListPanel","viewClass","emptyMsg","noneFoundMsg","searchPlaceholder","selecting","lastSelected","dragItems","views","_createDefaultCollection","$scrollContainer","loading","_showLoadingIndicator","loading-done","_hideLoadingIndicator","_setUpViewListeners","renderAll","renderItems","addItemView","removeItemView","view:selected","shiftKey","lastSelectedView","viewFromModelId","selectRange","showSelectors","view:de-selected","_renderControls","_renderTitle","_renderSearch","$controls","controls","_renderMultiselectActionMenu","actions","multiselectActions","$newMenu","$actions","$messages","$emptyMessage","freeViews","shownModels","_filterCollection","itemModel","_createItemView","_attachItems","_renderEmptyMessage","_filterItem","every","ViewClass","_getItemViewClass","_getItemViewOptions","_setUpItemViewListeners","_destroyItemView","_destroyItemViews","getSelectedModels","_renderItemView$el","expandAll","collapseAll","modelIndex","_attachView","useFx","_insertIntoListAt","$what","viewFromModel","viewsWhereModel","properties","isMatch","viewRange","viewA","viewB","indexA","indexB","searchInput","initialVal","onfirstsearch","_firstSearch","onsearch","searchItems","onclear","clearSearch","$search","THROTTLE_SELECTOR_FX_AT","hideSelectors","toggleSelectors","selectAll","deselectAll","getSelectedViews","scrollPosition","scrollTo","scrollToTop","scrollToItem","scrollToId","click .select-all","click .deselect-all","ModelListPanel","modelCollectionKey","setModel","freeModel","oldModelId","_setUpModelListeners","controlsTemplate","parentNode","clearSearchInput","searchTerms","firstSearch","inputTemplate","KEYCODE_ESC","KEYCODE_RETURN","$parentNode","inputVal","minSearchLen","escWillClear","oninit","_historyItemLi","_historyItemLi2","HDAListItemView","nametagTemplate","_labelIfName","historyItem","sortBy","uniq","_collectionLi","_collectionLi2","_collectionView","_collectionView2","HDCAListItemView","change:tags change:populated change:visible","ListCollectionView","PairCollectionView","ListOfPairsCollectionView","ListOfListsCollectionView","_listView","_listView2","CollectionView","DatasetDCEViewClass","NestedDCDCEViewClass","panelStack","parentName","downloadUrl","expanded:drilldown","drilldown","_expandDrilldownPanel","collapsed:drilldown","_collapseDrilldownPanel","click .navigation .back","close","_tag","_tag2","_annotation","_annotation2","DatasetListItemEdit","purgeAllowed","tagsEditorShown","annotationEditorShown","_renderEditButton","_renderDeleteButton","editBtnData","deletedAlready","_renderAnnotation","_makeDbkeyEditLink","_renderToolHelpButton","datasetID","jobID","creating_job","parseToolBuild","helpString","parseHTML","parseToolID","_renderErrButton","_renderRerunButton","_renderVisualizationsButton","visualizations","$visualizations","_addScratchBookFn","addBack","$links","tagsEditor","annotationEditor","AnnotationEditor","editableDbkey","click .undelete-link","click .purge-link","click .edit-btn","click .delete-btn","click .rerun-btn","click .report-err-btn","click .visualization-btn","click .dbkey a","_clickUndeleteLink","_clickPurgeLink","visualizationsTemplate","$annotation","newAnnotation","_galaxy","_galaxy2","_router","_router2","_toolPanel","_toolPanel2","_historyPanel","_historyPanel2","_page","_page2","_toolForm2","_formWrapper","_formWrapper2","_userPreferences","_userPreferences2","_userCustomBuilds","_userCustomBuilds2","_tours","_tours2","_gridShared","_gridShared2","_workflow","_workflow2","_historyList","_historyList2","_toolFormComposite","_toolFormComposite2","_datasetError","_datasetError2","_datasetEditAttributes","_datasetEditAttributes2","_citations","_citations2","_vue","_vue2","AnalysisRouter","routes","(/)","(/)root*","(/)tours(/)(:tour_id)","(/)user(/)","(/)user(/)(:form_id)","(/)workflow(/)","(/)workflow/run(/)","(/)pages(/)create(/)","(/)pages(/)edit(/)","(/)pages(/)(:action_id)","(/)visualizations(/)edit(/)","(/)visualizations/(:action_id)","(/)workflows/list_published(/)","(/)histories(/)citations(/)","(/)histories(/)rename(/)","(/)histories(/)permissions(/)","(/)histories(/)(:action_id)","(/)datasets(/)list(/)","(/)workflow/import_workflow","(/)custom_builds","(/)datasets/edit","(/)datasets/error","require_login","show_tours","tour_id","giveTour","ToursView","show_user","show_user_form","form_id","user_id","show_visualizations","action_id","plural","show_visualizations_edit","show_workflows_published","show_histories","show_history_citations","citationInstance","vm","createElement","propsData","$mount","show_histories_rename","show_histories_permissions","show_datasets","show_pages","show_pages_create","show_pages_edit","show_workflows","show_run","_loadWorkflow","show_import_workflow","ImportWorkflowView","show_custom_builds","historyPanel","historyView","show_dataset_edit_attributes","show_dataset_error","home","toolPanel","_loadCenterIframe","_loadToolForm","workflow_id","m_c","m_a","decodeURIComponent","getQueryString","error_msg","Left","Right","_uploadView","_uploadView2","stored_workflow_menu_entries","toolbox","tool_panel","toolbox_in_panel","upload_button","nginx_upload_path","default_genome","default_extension","_templateAllWorkflow","menu_entry","_templateWorkflowLink","stored_workflow","encoded_stored_workflow_id","_templateTool","wf","_uploadButton","_uploadButton2","_defaultView","_defaultView2","_compositeView","_compositeView2","auto","list_extensions","list_genomes","ui_button","onunload","datatypes","composite_files","a_text","b_text","datatypes_disable_auto","genomes","current_user","default_view","composite_view","collection_view","currentFtp","toData","file_count","it","prefix","$progress","_uploadModel","_uploadModel2","_defaultRow","_defaultRow2","_uploadFtp2","_uploadFtp3","_uploadExtension","_uploadExtension2","_uiSelect","_uiSelect2","_lazyLimited","_lazyLimited2","upload_size","$uploadbox","$uploadtable","btnLocal","btnFtp","_eventFtp","btnCreate","_eventCreate","btnStart","_eventStart","btnStop","_eventStop","btnReset","_eventReset","btnClose","_eventAnnounce","_eventProgress","_eventSuccess","_eventError","_eventComplete","ftp","select_extension","ext","_changeExtension","select_genome","_changeGenome","loader","new_content","upload_row","_eventRemove","enable_reset","enable_start","enable_sources","show_table","new_model","_uploadPercentage","upload_completed","_uploadFtp","defaults_only","_uploadSettings","_uploadSettings2","status_classes","queued","$mode","$text","$size","$info_text","$info_progress","$text_content","$settings","$symbol","$progress_bar","$percentage","_removeRow","showExtensionInfo","_showSettings","_refreshPercentage","_refreshStatus","_refreshInfo","_refreshGenome","_refreshExtension","_refreshFileSize","_refreshType","content_list","_done","model_id","_compositeRow","_compositeRow2","file_desc","where","$source","$status","$file_name","$file_desc","$file_size","_refreshReady","button_menu","ButtonMenu","pull","addMenu","_showFtp","_refreshFileName","_refreshMode","offsetHeight","_collectionRow","_collectionRow2","_listCollectionCreator","btnBuild","_eventBuild","updateExtension","select_collection","updateCollectionType","updateGenome","_updateScreen","hids","allHids","selection","buildCollection","enable_build","_optionsMenu","_optionsMenu2","_historyViewEditCurrent","_historyViewEditCurrent2","HistoryPanel","userIsAnonymous","allow_user_dataset_purge","CurrentHistoryView","listenToGalaxy","buttonRefresh","ButtonLink","buttonOptions","buttonViewMulti","connectToQuotaMeter","optionsMenu","anonymous","buildMenu","menuOption","anon","galaxy_main","_copyDialog","_copyDialog2","createNewHistory","user_action","webhooks_menu","_historyModel","_historyViewEdit","_historyViewEdit2","HistoryViewPrefs","storageKey","HistoryViewEdit","HDCAViewClass","currentContentId","loadHistory","switchToHistory","change:nice_size change:size","oldState","_debouncedScrollCaptureHandler","debounce","_renderQuotaMessage","quotaMsg","_setCurrentContentById","setCurrentContent","delegateEvents","click .uploader-link","click .get-data-link","$toolMenu","galaxy","center-frame:load","pathToMatch","fullpath","hdaId","useToURLRegexMap","regex","use","center-panel:load","showQuotaMessage","hideQuotaMessage","clearMessages","$target","currentTarget","not","$msg","unhideHidden","deleteHidden","quotaMsgTemplate","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","enumerable","writable","configurable","setPrototypeOf","__proto__","_classCallCheck","instance","Constructor","_get","receiver","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","_createClass","defineProperties","descriptor","protoProps","staticProps","initialFunctions","numToProcess","fnIndex","causeFail","NamedAjaxQueue","_AjaxQueue","_this3","names","_historyView","_historyView2","_hdaLiEdit","_hdaLiEdit2","_hdcaLiEdit","_hdcaLiEdit2","_listCollectionCreator2","_pairCollectionCreator","_pairCollectionCreator2","_listOfPairsCollectionCreator","_listOfPairsCollectionCreator2","HistoryView","HDAViewClass","HDAListItemEdit","HDCAListItemEdit","droptarget:drop","dataDropped","dropTargetOff","view:attached view:removed","_renderCounts","search:loading-progress","_renderSearchProgress","search:searching","_renderSearchFindings","updateHistoryDiskSize","_handleItemDeletedChange","change:visible","_handleItemVisibleChange","change:purged","fetching-deleted","fetching-hidden","fetching-deleted-done fetching-hidden-done","toggleHDATagEditors","toggleHDAAnnotationEditors","newName","previousName","_collectionActions","createFunc","createPairCollection","createListOfPairsCollection","_handleItemDeletion","_handleItemUndeletion","_handleItemHidden","_handleItemUnhidden","showOrHide","click .show-selectors-btn","click .toggle-deleted-link","toggleShowDeleted","click .toggle-hidden-link","toggleShowHidden","dropTargetOn","dropTarget","dropHandlers","dragenter","$dropTarget","_renderDropTarget","_renderDropTargetHelp","evName","_dropHandlers","dropTargetToggle","getData","countsTemplate","foundTemplate","_historyModel2","_hdaLi","_hdaLi2","_hdcaLi","_hdcaLi2","FETCH_COLLECTION_COUNTS_DELAY","detailedFetchTimeoutId","_clearDetailedFetchTimeout","errorHandler","views:ready view:attached view:removed","_renderSelectButton","view:attached","fetching-more","_toggleContentsLoadingIndicator","fetching-more-done","$indicator","$existing","$emptyMsg","_renderPagination","_renderSomeItems","$paginationControls","pagination","click > .controls .prev","click > .controls .next","change > .controls .pages","click .messages [class$=message]","_clickPrevPage","_clickNextPage","_changePageSelect","store","_this4","_this5","scrollToHid","ordinalIndicator","numStr","mainTemplate","paginationTemplate","LoadingIndicator","cover","z-index","right","opacity","background-color","text-align","font-style","_datasetLiEdit","_datasetLiEdit2","click .unhide-link","_collectionViewEdit","_collectionViewEdit2","ListCollectionViewEdit","PairCollectionViewEdit","ListOfPairsCollectionViewEdit","ListOfListsCollectionViewEdit","_collectionLiEdit","_collectionLiEdit2","CollectionViewEdit","DatasetDCEListItemEdit","NestedDCDCEListItemEdit","NestedPairCollectionViewEdit","DCListItemEdit","DCEListItemEdit","pairCollectionCreatorModal","PairedDatasetCollectionElementView","identifier","PairCollectionCreator","_createForwardElementView","_createReverseElementView","swap","click .swap","autoPairFnBuilder","getRegExps","_regexps","createPair","listA","listB","aInBIndex","bInAIndex","_pair","preprocessMatch","regexps","matchTo","possible","bestMatch","paired","scoreThreshold","pairedCollectionCreatorModal","_levenshtein","_levenshtein2","_naturalSort2","PairView","pair","PairedCollectionCreator","datasets","DEFAULT_FILTERS","automaticallyPair","strategy","matchPercentage","twoPassAutopairing","initialList","commonFilters","strategies","DEFAULT_STRATEGY","removeExtensions","unpairedPanelHidden","pairedPanelHidden","_dataSetUp","illumina","Rs","simple","lcs","levenshtein","unpaired","_sortInitialList","_ensureIds","autoPair","_sortDatasetList","_splitByFilters","_filter","regexFilters","stringFilter","_addToUnpaired","binSearchSortedIndex","hi","mid","compared","autopairSimple","autopairLevenshtein","distance","autopairLCS","_naiveStartingAndEndingLCS","fwdLCS","revLCS","fwd","rev","_createPair","_guessNameForPair","forward","fwdName","revName","lastDotIndex","lastIndexOf","_unpair","unpairAll","_pairToJSON","ajaxData","_ajaxErrHandler","_renderFilters","_renderUnpaired","_renderPaired","$fwd","$rev","$prd","_renderUnpairedDisplayStr","_renderUnpairedEmpty","_renderPairButton","_renderUnpairedDataset","_adjUnpairedOnScrollbar","_renderUnpairedNotShown","numFiltered","$unpairedColumns","$firstDataset","ucRight","outerWidth","dsRight","rightDiff","_renderPairedEmpty","pairView",".remove-extensions","_chooseFiltersPopover","filterChoice","val1","val2","$popoverContent","filterSet","splitView","msgClass","hideUnpaired","click .forward-column .column-title","click .reverse-column .column-title","click .unpair-all-link","change .forward-unpaired-filter input","focus .forward-unpaired-filter input","click .autopair-link","click .choose-filters .filter-choice","click .clear-filters-link","change .reverse-unpaired-filter input","focus .reverse-unpaired-filter input","click .forward-column .dataset.unpaired","click .reverse-column .dataset.unpaired","click .paired-column .dataset.unpaired","click .unpaired-columns","mousedown .unpaired-columns .dataset","click .paired-column-title","mousedown .flexible-partition-drag","click .paired-columns .dataset.paired","click .paired-columns","click .paired-columns .pair-name","click .unpair-btn","dragover .paired-columns .column-datasets","drop .paired-columns .column-datasets","pair.dragstart .paired-columns .column-datasets","pair.dragend   .paired-columns .column-datasets","change .remove-extensions","toggleExtensions","_clickShowOnlyUnpaired","hidePaired","_clickShowOnlyPaired","_clickUnpairAll","_clickAutopair","_clickFilterChoice","$selected","_hideChooseFilters","_clearFilters","_clickUnpairedDataset","toggleSelectUnpaired","$dataset","waitToPair","pairAllSelected","fwds","revs","clearSelectedUnpaired","_mousedownUnpaired","$startTarget","moveListener","_clickPairRow","rowIndex","_startPartitionDrag","endDrag","trackMouse","startingY","adjPartition","adj","$unpaired","$paired","unpairedHi","pairedHi","movingUpwards","flex","selectPair","clearSelectedPaired","_clickPairName","$name","$pair","customizedName","_clickUnpair","pairIndex","_dragoverPairedColumns","_getNearestPairedDatasetLi","_dropPairedColumns","_syncPairsToDom","newPaired","_pairDragstart","_pairDragend","_printList","_printPair","levenshteinDistance","matrix","information","communication","permissions","api_key","toolbox_filters","openids","custom_builds","logout","Sign out","$preferences","use_remote_user","_addLink","enable_communication_server","has_user_tool_filters","enable_openid","_templateFooter","$row","_templateLink","$a","enable_quotas","quota","_uiTable","_uiTable2","installed_builds","Select","empty_text","error_text","addHeader","appendHeader","$installed","$form","_renderForm","ButtonIcon","area","_renderHelp","len_type","_templateFasta","_templateLen","_templateShared","shared_by_others","display_url","slug","_toastr","mod_toastr","_workflowModel","_workflowModel2","WorkflowItemView","bindAll","timeOut","click #show-in-tool-panel","click #delete-workflow","click #rename-workflow","click #copy-workflow","_rowTemplate","showInToolPanel","removeWorkflow","wfName","renameWorkflow","oldName","copyWorkflow","wfJson","currentOwner","at","errorThrown","jqXHR","textStatus","wfId","checkboxHtml","trHtml","_templateActions","renderTagEditor","TagEditor","WorkflowListView","WorkflowCollection","appendItem","unhighlightDropZone","readWorkflowFiles","reader","FileReader","theFile","wf_json","readAsText","_showArgErrors","msg_text","_templateHeader","templateActions","_templateActionButtons","tableTemplate","_templateWorkflowTable","confirmDelete","searchWorkflow","adjustActiondropdown","workflowItemView","workflow","$el_searchinput","$el_tabletr","min_querylen","regular_expression","_templateNoWorkflow","tableHtml","_mainTemplate","myexperiment_target_url","WorkflowItem","_showCopyDialog","reload","job_url","job","render_error_page","error_response","display_message","stderr","_getBugFormTemplate","doNotClear","safe","UnescapedMessage","floating","form_data","_createTabs","initial_message","_reloadHistory","_getAttribute","conversion","_getConversion","datatype","_getDatatype","permission","_getPermission","submit_attributes","submit_autodetect","submit_conversion","submit_datatype","submit_permission"],"mappings":"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H,UACAxP,GAAAqP,EAAA,EAAAS,EAAA,EAAAT,EAAA5rE,OAAAykE,EAAAsH,WACAH,EAAAS,EAIA,GAFAX,EAAAr/D,KAAAu/D,GACAD,GAAAC,EAAA5rE,OACAg9B,GAAAkvC,GAAAlvC,GAAAmvC,EACA,MAQA,GAJAf,IACAA,EAAA,IAAA/5D,GAAA,GAAAozD,EAAA+G,eAGA,GAAAE,EAAA1rE,OACA,MAAA0rE,GAAA,GAAAxhD,MAIA,QAFAoiD,GAAA,GAAArS,YAAA0R,GACAY,EAAA,EACA19D,EAAA,EAAuBA,EAAA68D,EAAA1rE,SAAuB6O,EAAA,CAC9C,GAAA7Q,GAAA0tE,EAAA78D,EACA0tD,GAAAv+D,EAAA,EAAAsuE,EAAAC,EAAAvuE,EAAAgC,QACAusE,GAAAvuE,EAAAgC,OAEA,MAAAssE,GAAApiD,OAxlEA,GACAohD,GADA,GAGAlC,EAAA,KAMA6C,EAAA,EAQAxB,EAAA,EACAyB,EAAA,EAMAC,GAAA,EAkBAK,GAAA,oEAEAnD,EAAA,EAWAgB,EAAA,EACAC,EAAA,EAEAC,GACA,gCACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,6BACA,8BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,8BACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,8BACA,6BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,gCACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,6BACA,8BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,8BACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,8BACA,6BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,gCACA,+BAEA,8BACA,6BACA,6BACA,+BACA,+BACA,6BACA,8BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,8BACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,8BACA,6BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,gCACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,6BACA,8BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,8BACA,8BACA,+BACA,8BACA,6BACA,6BACA,+BACA,+BACA,8BACA,6BACA,+BACA,+BACA,6BACA,6BACA,+BACA,+BACA,+BAEAC,GACA,kCACA,oCACA,kCACA,sCACA,kCACA,oCACA,mCACA,wCAIAiC,GACA,yCACA,kDAIAC,GACA,gCACA,mCAGAC,GACA,2CACA,8CACA,wBAGAC,GACA,gCACA,wBACA,YAUA9D,GAAA5sE,UAAAmvE,YAAA,SAAAvZ,EAAA5vB,GAQA,MAPA4vB,KACAA,EAAAwZ,GAEAppC,IACAA,GAAA,GAEA/iC,KAAA0tE,OAAA,GAAA9D,GACA5pE,KAAA0tE,OAAAxB,YAAAlsE,KAAA+iC,GAAA4vB,MAGAgX,EAAA5sE,UAAA8vE,QAAA,SAAAv7C,GACA,aAAAtxB,KAAA0tE,QA9NA,EA+NA1tE,KAAA0tE,OAAAb,QAAA7sE,KAAAsxB,IAGAq4C,EAAA5sE,UAAA4wE,WAAA,WACA,SAAA3tE,KAAA0tE,OAAA,OAnOA,CAoOA,IAAAE,GAAAF,OAAAC,WAAA3tE,KAEA,OADAA,MAAA0tE,OAAA,KACAE,GAEAjE,EAAA5sE,UAAA8wE,YAAA,WAEA,MAAAH,QAAAG,YAAA7tE,OAEA2pE,EAAA5sE,UAAA+wE,qBAAA,SAAAC,EAAAC,GAEA,MAAAN,QAAAI,qBAAA9tE,KAAA+tE,EAAAC,IAmHApE,EAAA7sE,UAAAkxE,aAAA,SAAA3I,GACA,aAAAA,GAAA,MAAAA,EAAAoI,QAlWA,GAoWApI,EAAA4I,SAAA5I,EAAA6I,UAAA,EACA7I,EAAA2H,IAAA,KACA3H,EAAAoI,OAAA7/D,KAAA,GAAAy3D,EAAAoI,OAAA3qC,OAzVA,EAPA,EAiWAuiC,EAAAoI,OAAA9e,OAAAh6B,MAAA0wC,EAAA,MACAgG,IAGA1B,EAAA7sE,UAAA4wE,WAAA,SAAArI,GAIA,MAHA,OAAAtlE,KAAA4uD,QACA5uD,KAAA4uD,OAAAwf,KAAA9I,GACAtlE,KAAA4uD,OAAA,KACA0c,GAGA1B,EAAA7sE,UAAAmvE,YAAA,SAAA5G,EAAA3S,GAYA,MAXA2S,GAAA2H,IAAA,KACAjtE,KAAA4uD,OAAA,KAGA7rB,OAAA,EACA4vB,EAAA,IACAA,KACA5vB,OAAA,GAIA4vB,EAAA,GAAAA,EAAA,IACA3yD,KAAA2tE,WAAArI,IA/XA,IAkYAtlE,KAAAquE,MAAA1b,EAEA2S,EAAAoI,OAAA9e,OAAA,GAAAkb,GAAAxE,EACA,GAAAA,EAAAoI,OAAA3qC,OAAA,KAAA/iC,KACA,GAAA2yD,GAGA3yD,KAAAiuE,aAAA3I,GACAgG,IAGA1B,EAAA7sE,UAAA8vE,QAAA,SAAAvH,EAAAh0C,GACA,GAAA1Y,GAAA/Z,CAEA,UAAAymE,GAAA,MAAAA,EAAAoI,QAAA,MAAApI,EAAA8G,QACA,OAjZA,CAoZA,KAFA96C,EA1ZA,GA0ZAA,EAAA07C,EAAA1B,EACA1yD,EAAAo0D,IAEA,OAAA1H,EAAAoI,OAAA7/D,MACA,IAhZA,GAkZA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAGA,IAHkCA,EAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WAharB,IAiaA,IAAA5I,EAAAoI,OAAAzsE,OAAAqkE,EAAA8G,QAAA9G,EAAA+G,mBAAA,CACA/G,EAAAoI,OAAA7/D,KAzYA,GA0YAy3D,EAAA2H,IAAA,6BACA3H,EAAAoI,OAAAY,OAAA,CACA,OAEA,MAAAhJ,EAAAoI,OAAAzsE,QAAA,GAAAqkE,EAAAoI,OAAAW,MAAA,CACA/I,EAAAoI,OAAA7/D,KA/YA,GAgZAy3D,EAAA2H,IAAA,sBACA3H,EAAAoI,OAAAY,OAAA,CACA,OAEAhJ,EAAAoI,OAAA7/D,KAhaA,CAiaA,KAjaA,GAmaA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAKA,IALkCA,EAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrBrvE,EAAA,IAAAymE,EAAA8G,QAAA9G,EAAA+G,mBAEA/G,EAAAoI,OAAAzsE,QAAA,GAAApC,GAAA,OACAymE,EAAAoI,OAAA7/D,KA7ZA,GA8ZAy3D,EAAA2H,IAAA,yBACA3H,EAAAoI,OAAAY,OAAA,CACA,OAGA,OApcA,GAocAzvE,GAAA,CACAymE,EAAAoI,OAAA7/D,KA1aA,CA2aA,OAEAy3D,EAAAoI,OAAA7/D,KAlbA,CAmbA,KAnbA,GAqbA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,MAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,cACA/G,EAAAoI,OAAA7/D,KAxbA,CAybA,KAzbA,GA2bA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,OAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,YACA/G,EAAAoI,OAAA7/D,KA9bA,CA+bA,KA/bA,GAicA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,OAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,QACA/G,EAAAoI,OAAA7/D,KApcA,CAqcA,KArcA,GAucA,UAAAy3D,EAAAgH,SAAA1zD,GAAkCA,EAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,MAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,iBACA/G,EAAAkJ,MAAAlJ,EAAAoI,OAAAa,KACAjJ,EAAAoI,OAAA7/D,KA3cA,EAdA,EA2dA,KA7cA,GAidA,MAHAy3D,GAAAoI,OAAA7/D,KAvcA,GAwcAy3D,EAAA2H,IAAA,kBACA3H,EAAAoI,OAAAY,OAAA,GA5dA,CA8dA,KAjdA,GAodA,IAheA,IA+dA11D,EAAA0sD,EAAAoI,OAAA9e,OAAA6f,KAAAnJ,EAAA1sD,IACA,CACA0sD,EAAAoI,OAAA7/D,KA/cA,GAgdAy3D,EAAAoI,OAAAY,OAAA,CACA,OAKA,GAHA11D,GAAA0yD,IACA1yD,EAAA0Y,GAEA1Y,GAAAm0D,EACA,MAAAn0D,EAIA,IAFAA,EAAA0Y,EACAg0C,EAAAoI,OAAA9e,OAAAh6B,MAAA0wC,IAAAoI,OAAA7D,KACA,GAAAvE,EAAAoI,OAAA3qC,OAAA,CACAuiC,EAAAoI,OAAA7/D,KA7dA,EA8dA,OAEAy3D,EAAAoI,OAAA7/D,KApeA,CAqeA,KAreA,GAueA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,MAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,cACA/G,EAAAoI,OAAA7/D,KA1eA,CA2eA,KA3eA,GA6eA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,OAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,YACA/G,EAAAoI,OAAA7/D,KAhfA,EAifA,KAjfA,IAmfA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAAkCA,GAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,OAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,mBAAA,QACA/G,EAAAoI,OAAA7/D,KAtfA,EAufA,KAvfA,IAyfA,MAAAy3D,EAAAgH,SAAA,MAAA1zD,EAKA,IALkCA,EAAA0Y,EAElCg0C,EAAAgH,WAAqBhH,EAAA4I,WACrB5I,EAAAoI,OAAAa,MAAA,IAAAjJ,EAAA8G,QAAA9G,EAAA+G,iBAEA/G,EAAAoI,OAAA7D,IAAA,IAAAvE,EAAAoI,OAAA,MACApI,EAAAoI,OAAA7/D,KA7fA,GA8fAy3D,EAAA2H,IAAA,uBACA3H,EAAAoI,OAAAY,OAAA,CACA,OAGAhJ,EAAAoI,OAAA7/D,KApgBA,EAqgBA,KArgBA,IAsgBA,MAAAk/D,EACA,KAtgBA,IAugBA,OAzhBA,CA0hBA,SACA,OA5hBA,IAkiBAnD,EAAA7sE,UAAA+wE,qBAAA,SAAAxI,EAAAyI,EAAAC,GACA,GAAAphE,GAAA,EACA/L,EAAAmtE,CACA,cAAA1I,GAAA,MAAAA,EAAAoI,QAzhBA,GAyhBApI,EAAAoI,OAAA7/D,MAriBA,EAwiBAy3D,EAAAoJ,OAAAC,QAAA,EAAAZ,EAAA,EAAAC,IAAA1I,EAAAkJ,OAviBA,GA2iBAlJ,EAAAkJ,MAAAlJ,EAAAoJ,OAAAC,QAAA,YAEA9tE,GAAA,GAAAykE,EAAAoI,OAAAW,QACAxtE,GAAA,GAAAykE,EAAAoI,OAAAW,OAAA,EACAzhE,EAAAohE,EAAAntE,GAEAykE,EAAAoI,OAAA9e,OAAAggB,eAAAb,EAAAnhE,EAAA/L,GACAykE,EAAAoI,OAAA7/D,KAtiBA,EAuiBAy9D,GAIA,IAAAuD,IAAA,YAEAjF,GAAA7sE,UAAA8wE,YAAA,SAAAvI,GACA,GAAAjmD,GACApJ,EACAyK,EACA9H,EAAA+5C,CAGA,UAAA2S,GAAA,MAAAA,EAAAoI,OACA,OAlkBA,CAukBA,IApjBA,IAgjBApI,EAAAoI,OAAA7/D,OACAy3D,EAAAoI,OAAA7/D,KAjjBA,GAkjBAy3D,EAAAoI,OAAAY,OAAA,GAEA,IAAAjvD,EAAAimD,EAAAgH,UACA,MAAAU,EAKA,KAJA/2D,EAAAqvD,EAAA+G,cACA3rD,EAAA4kD,EAAAoI,OAAAY,OAGA,GAAAjvD,GAAAqB,EAAA,GACA4kD,EAAA8G,QAAAn2D,IAAA44D,EAAAnuD,GACAA,IAGAA,EADA,GAAA4kD,EAAA8G,QAAAn2D,GACA,EAGA,EAAAyK,EAEAzK,IAAUoJ,GAUV,OANAimD,GAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cACA/G,EAAA+G,cAAAp2D,EACAqvD,EAAAgH,SAAAjtD,EACAimD,EAAAoI,OAAAY,OAAA5tD,EAGA,GAAAA,GAhmBA,GAmmBA9H,EAAA0sD,EAAA4I,SAAiBvb,EAAA2S,EAAA6I,UACjBnuE,KAAAiuE,aAAA3I,GACAA,EAAA4I,SAAAt1D,EAAiB0sD,EAAA6I,UAAAxb,EACjB2S,EAAAoI,OAAA7/D,KA1lBA,EA2lBAy9D,IASA1B,EAAA7sE,UAAA+xE,iBAAA,SAAAxJ,GACA,aAAAA,GAAA,MAAAA,EAAAoI,QAAA,MAAApI,EAAAoI,OAAA9e,QAlnBA,EAonBA0W,EAAAoI,OAAA9e,OAAAmgB,aAQA,IAAAC,IAAA,+CAmCAlF,GAAA/sE,UAAA63B,MAAA,SAAA0wC,EAAA18C,GACAA,MAAA,GAAA5oB,KAAAyoB,OAnoBA,GAooBAzoB,KAAA6N,MACA7N,KAAAsqE,MAAA8D,KAAA9I,GAEAtlE,KAAA6N,KAAAq8D,EACAlqE,KAAAyqE,KAAA,EACAzqE,KAAA0qE,KAAA,EACA1qE,KAAA85D,KAAA95D,KAAA2qE,MAAA,EAEA3qE,KAAA+pE,UACAzE,EAAAkJ,MAAAxuE,KAAAyoB,MAAA68C,EAAAoJ,OAAAC,QAAA,cAGA7E,EAAA/sE,UAAA0xE,KAAA,SAAAnJ,EAAA1sD,GACA,GAAAuO,GACAtoB,EACA6J,EACAuN,EACAoJ,EACAoa,EACA/Y,CAOA,KAJKzK,EAAAqvD,EAAA+G,cAAkBhtD,EAAAimD,EAAAgH,SAAaztE,EAAAmB,KAAA0qE,KAAYhiE,EAAA1I,KAAAyqE,KAC3ChxC,EAAAz5B,KAAA2qE,MAAajqD,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,IAIlB,OAAAz5B,KAAA6N,MACA,IAAAq8D,GAEA,KAAAxhE,EAAA,IACA,MAAA2W,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAiBmB,KAAAyqE,KAAA/hE,EACjB48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAmC/G,EAAA+G,cAAAp2D,EACnCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAKA,OAHAye,EAAA,EAAAtoB,EACAmB,KAAAwqE,KAAA,EAAArjD,EAEAA,IAAA,GACA,OACWtoB,KAAA,EAAS6J,GAAA,EACpBye,EAAA,EAAAze,EAEW7J,KAAA,EAAS6J,GAAA,EACpB1I,KAAA6N,KA/rBA,CAgsBA,MACA,QAEA,GAAAk9D,GAAA,GAAA7P,YAAA,GACA8P,EAAA,GAAA9P,YAAA,GACA4I,KACAmH,IAEAH,GAAAC,EAAAC,EAAAlH,EAAAmH,EAAA3F,GACAtlE,KAAAsqE,MAAA37B,KAAAo8B,EAAA,GAAAC,EAAA,GAAAlH,EAAA,KAAAmH,EAAA,KAAA3F,GAGWzmE,KAAA,EAAS6J,GAAA,EAEpB1I,KAAA6N,KAzsBA,CA0sBA,MACA,QAEWhP,KAAA,EAAS6J,GAAA,EAEpB1I,KAAA6N,KAltBA,CAmtBA,MACA,QAUA,MARWhP,MAAA,EAAS6J,GAAA,EACpB1I,KAAA6N,KA9tBA,GA+tBAy3D,EAAA2H,IAAA,qBACAr0D,GAlvBA,EAovBA5Y,KAAA0qE,KAAA7rE,EAAemB,KAAAyqE,KAAA/hE,EACf48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,GAEA,KACA,KAnuBA,GAouBA,KAAAlQ,EAAA,KACA,MAAA2W,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAiBmB,KAAAyqE,KAAA/hE,EACjB48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAmC/G,EAAA+G,cAAAp2D,EACnCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAGA,KAAA7J,IAAA,kBAAAA,GAQA,MAPAmB,MAAA6N,KA1vBA,GA2vBAy3D,EAAA2H,IAAA,+BACAr0D,GA9wBA,EAgxBA5Y,KAAA0qE,KAAA7rE,EAAemB,KAAAyqE,KAAA/hE,EACf48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAEA5Y,MAAA2f,KAAA,MAAA9gB,EACAA,EAAA6J,EAAA,EACA1I,KAAA6N,KAAA,GAAA7N,KAAA2f,KA/vBA,EA+vBA,GAAA3f,KAAAwqE,KA1vBA,EA0vBAN,CACA,MACA,KAjwBA,GAkwBA,MAAA7qD,EAIA,MAHArf,MAAA0qE,KAAA7rE,EAAemB,KAAAyqE,KAAA/hE,EACf48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9C00D,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAGA,OAAA8H,IACA+Y,GAAAtnB,KAAA,GAAA2nD,OACArgC,EAAA,EAAS/Y,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,GAET,GAAA/Y,IACA1gB,KAAA2qE,MAAAlxC,EACA7gB,EAAA5Y,KAAAivE,cAAA3J,EAAA1sD,GACA6gB,EAAAz5B,KAAA2qE,MAAkBjqD,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,EAClBA,GAAAz5B,KAAAmS,KAAA,GAAAnS,KAAA85D,OACArgC,EAAA,EAAW/Y,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,GAEX,GAAA/Y,IAIA,MAHA1gB,MAAA0qE,KAAA7rE,EAAmBmB,KAAAyqE,KAAA/hE,EACnB48D,EAAAgH,SAAAjtD,EAAoBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAClDjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAYA,IARAA,EAAA0yD,EAEAnkD,EAAAnnB,KAAA2f,KACAwH,EAAA9H,IAAA8H,EAAA9H,GACA8H,EAAAzG,IAAAyG,EAAAzG,GACA08C,EAAAkI,EAAA8G,QAAAn2D,EAAAjW,KAAAW,OAAA84B,EAAAtS,GACAlR,GAAAkR,EAAQ9H,GAAA8H,EACRsS,GAAAtS,EAAQzG,GAAAyG,EACR,IAAAnnB,KAAA2f,MAAAwH,GACA,KACAnnB,MAAA6N,KAAA,GAAA7N,KAAAwqE,KAjyBA,EAiyBAN,CACA,MACA,KAvyBA,GAyyBA,KAAAxhE,EAAA,KACA,MAAA2W,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAiBmB,KAAAyqE,KAAA/hE,EACjB48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAmC/G,EAAA+G,cAAAp2D,EACnCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAIA,GADA1I,KAAAmqE,MAAAhjD,EAAA,MAAAtoB,GACA,GAAAsoB,GAAA,KAAAA,GAAA,SASA,MAPAnnB,MAAA6N,KAtzBA,EAuzBAy3D,EAAA2H,IAAA,sCACAr0D,GAv1BA,EAy1BA5Y,KAAA0qE,KAAA7rE,EAAiBmB,KAAAyqE,KAAA/hE,EACjB48D,EAAAgH,SAAAjtD,EAAkBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAChDjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAGA,IADAuO,EAAA,QAAAA,OAAA,MACA,MAAAnnB,KAAAoqE,OAAApqE,KAAAoqE,MAAAvpE,OAAAsmB,EACAnnB,KAAAoqE,MAAA,GAAAlP,YAAA/zC,OAGA,QAAAzX,GAAA,EAAeA,EAAAyX,EAAKzX,IACpB1P,KAAAoqE,MAAA16D,GAAA,CAIE7Q,MAAA,GAAU6J,GAAA,GAEZ1I,KAAA4M,MAAA,EACAiB,KAj1BA,CAk1BA,KAl1BA,GAm1BA,KAAA7N,KAAA4M,MAAA,GAAA5M,KAAAmqE,QAAA,MACA,KAAAzhE,EAAA,IACA,MAAA2W,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAmBmB,KAAAyqE,KAAA/hE,EACnB48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAqC/G,EAAA+G,cAAAp2D,EACrCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAGA1I,KAAAoqE,MAAA4E,EAAAhvE,KAAA4M,UAAA,EAAA/N,EAEIA,KAAA,EAAS6J,GAAA,EAGb,KAAA1I,KAAA4M,MAAA,IACA5M,KAAAoqE,MAAA4E,EAAAhvE,KAAA4M,UAAA,CAKA,IAFA5M,KAAAi5D,GAAA,MACA9xC,EAAAnnB,KAAA4qE,QAAAsE,mBAAAlvE,KAAAoqE,MAAApqE,KAAAi5D,GAAAj5D,KAAAqqE,GAAArqE,KAAAgqE,MAAA1E,KACAgG,EAUA,MATA1yD,GAAAuO,GA14BA,GA24BAvO,IACA5Y,KAAAoqE,MAAA,KACApqE,KAAA6N,KA92BA,GAi3BA7N,KAAA0qE,KAAA7rE,EAAemB,KAAAyqE,KAAA/hE,EACf48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9C00D,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAGA5Y,MAAA4M,MAAA,EACA5M,KAAA6N,KA53BA,CA63BA,KA73BA,GA83BA,QAEA,GADAsZ,EAAAnnB,KAAAmqE,QACAnqE,KAAA4M,MAAA,QAAAua,OAAA,OACA,KAGA,IACAzX,GAAA6M,EAAAqM,CAIA,KAFAzB,EAAAnnB,KAAAi5D,GAAA,GAEAvwD,EAAA,IACA,MAAA2W,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAmBmB,KAAAyqE,KAAA/hE,EACnB48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAqC/G,EAAA+G,cAAAp2D,EACrCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAUA,GAHAye,EAAAnnB,KAAAgqE,MAAA,GAAAhqE,KAAAqqE,GAAA,IAAAxrE,EAAAwuE,EAAAlmD,KAAA,IACAyB,EAAA5oB,KAAAgqE,MAAA,GAAAhqE,KAAAqqE,GAAA,IAAAxrE,EAAAwuE,EAAAlmD,KAAA,IAEA,GACAtoB,KAAA,EAAc6J,GAAA,EACd1I,KAAAoqE,MAAApqE,KAAA4M,SAAAgc,MAEA,CAIA,IAHAlZ,EAAA,IAAAkZ,EAAA,EAAAA,EAAA,GACArM,EAAA,IAAAqM,EAAA,KAEAlgB,EAAAye,EAAAzX,GAAA,CACA,MAAA2P,EAQA,MAJArf,MAAA0qE,KAAA7rE,EAAcmB,KAAAyqE,KAAA/hE,EACd48D,EAAAgH,SAAAjtD,EACAimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAAgC/G,EAAA+G,cAAAp2D,EAChCjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAPAA,GAAA0yD,EASAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAWA,GARA7J,KAAA,EAAc6J,GAAA,EAEd6T,GAAA1d,EAAAwuE,EAAA39D,GAEA7Q,KAAA,EAAc6J,GAAA,EAEdgH,EAAA1P,KAAA4M,MACAua,EAAAnnB,KAAAmqE,MACAz6D,EAAA6M,EAAA,QAAA4K,OAAA,OACA,IAAAyB,GAAAlZ,EAAA,EASA,MARA1P,MAAAoqE,MAAA,KACApqE,KAAA6N,KA/7BA,EAg8BAy3D,EAAA2H,IAAA,4BACAr0D,GAh+BA,EAk+BA5Y,KAAA0qE,KAAA7rE,EAAmBmB,KAAAyqE,KAAA/hE,EACnB48D,EAAAgH,SAAAjtD,EAAoBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAClDjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAGAgQ,GAAA,IAAAA,EAAA5oB,KAAAoqE,MAAA16D,EAAA,IACA,IACA1P,KAAAoqE,MAAA16D,KAAAkZ,QAEA,KAAArM,EACAvc,MAAA4M,MAAA8C,GAIA1P,KAAAqqE,GAAA,KAEA,IAAAU,GAAA,GAAA7P,YAAA,GACA8P,EAAA,GAAA9P,YAAA,GACA4I,EAAA,GAAA5I,YAAA,GACA+P,EAAA,GAAA/P,YAAA,EASA,IARA6P,EAAA,KACAC,EAAA,KAEA7jD,EAAAnnB,KAAAmqE,OACAhjD,EAAAnnB,KAAA4qE,QAAAuE,sBAAA,QAAAhoD,GACA,GAAAA,GAAA,MACAnnB,KAAAoqE,MAAAW,EAAAC,EAAAlH,EAAAmH,EAAAjrE,KAAAgqE,MAAA1E,KAEAgG,EAUA,OAzgCA,GAggCAnkD,IACAnnB,KAAAoqE,MAAA,KACApqE,KAAA6N,KAh/BA,IAk/BA+K,EAAAuO,EAEAnnB,KAAA0qE,KAAA7rE,EAAqBmB,KAAAyqE,KAAA/hE,EACrB48D,EAAAgH,SAAAjtD,EAAsBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EACpDjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAEA5Y,MAAAsqE,MAAA37B,KAAAo8B,EAAA,GAAAC,EAAA,GAAAhrE,KAAAgqE,MAAAlG,EAAA,GAAA9jE,KAAAgqE,MAAAiB,EAAA,GAAA3F,GAEAtlE,KAAA6N,KAj/BA,CAk/BA,KAl/BA,GAu/BA,GAJA7N,KAAA0qE,KAAA7rE,EAAamB,KAAAyqE,KAAA/hE,EACb48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA+B/G,EAAA+G,cAAAp2D,EAC7CjW,KAAA2qE,MAAAlxC,GAEA7gB,EAAA5Y,KAAAsqE,MAAAmE,KAAAzuE,KAAAslE,EAAA1sD,KAAAm0D,EACA,MAAA/sE,MAAAivE,cAAA3J,EAAA1sD,EAQA,IANAA,EAAA0yD,EACAtrE,KAAAsqE,MAAA8D,KAAA9I,GAEArvD,EAAAqvD,EAAA+G,cAAmBhtD,EAAAimD,EAAAgH,SAAcztE,EAAAmB,KAAA0qE,KAAYhiE,EAAA1I,KAAAyqE,KAC7ChxC,EAAAz5B,KAAA2qE,MAAcjqD,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,EAEd,GAAAz5B,KAAAwqE,KAAA,CACAxqE,KAAA6N,KAAAq8D,CACA,OAEAlqE,KAAA6N,KAngCA,CAogCA,KApgCA,GAwgCA,GAHA7N,KAAA2qE,MAAAlxC,EACA7gB,EAAA5Y,KAAAivE,cAAA3J,EAAA1sD,GACA6gB,EAAAz5B,KAAA2qE,MAAcjqD,EAAA+Y,EAAAz5B,KAAA85D,KAAA95D,KAAA85D,KAAArgC,EAAA,EAAAz5B,KAAAmS,IAAAsnB,EACdz5B,KAAA85D,MAAA95D,KAAA2qE,MAIA,MAHA3qE,MAAA0qE,KAAA7rE,EAAemB,KAAAyqE,KAAA/hE,EACf48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAEA/K,MA1hCA,EA2hCA,KA9gCA,GAohCA,MALA+K,GAAAm0D,EAEA/sE,KAAA0qE,KAAA7rE,EAAamB,KAAAyqE,KAAA/hE,EACb48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EACA,KAphCA,GA0hCA,MALAA,IApjCA,EAsjCA5Y,KAAA0qE,KAAA7rE,EAAamB,KAAAyqE,KAAA/hE,EACb48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,EAEA,SAMA,MALAA,IA7jCA,EA+jCA5Y,KAAA0qE,KAAA7rE,EAAamB,KAAAyqE,KAAA/hE,EACb48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5CjW,KAAA2qE,MAAAlxC,EACAz5B,KAAAivE,cAAA3J,EAAA1sD,KAKAkxD,EAAA/sE,UAAAqxE,KAAA,SAAA9I,GACAtlE,KAAA40B,MAAA0wC,EAAA,MACAtlE,KAAAW,OAAA,KACAX,KAAAgqE,MAAA,MAGAF,EAAA/sE,UAAA6xE,eAAA,SAAAz4D,EAAAjE,EAAAmN,GACA+9C,EAAAjnD,EAAAjE,EAAAvR,OAAA,EAAA0e,GACArf,KAAA85D,KAAA95D,KAAA2qE,MAAAtrD,GAKAyqD,EAAA/sE,UAAAgyE,WAAA,WACA,MA7jCA,IA6jCA/uE,KAAA6N,MAIAi8D,EAAA/sE,UAAAkyE,cAAA,SAAA3J,EAAA1sD,GACA,GAAAyG,GACApJ,EACAwjB,CAuDA,OApDAxjB,GAAAqvD,EAAAqH,eACAlzC,EAAAz5B,KAAA85D,KAGAz6C,GAAAoa,GAAAz5B,KAAA2qE,MAAA3qE,KAAA2qE,MAAA3qE,KAAAmS,KAAAsnB,EACApa,EAAAimD,EAAAsH,YAAAvtD,EAAAimD,EAAAsH,WACA,GAAAvtD,GAAAzG,GAAAo0D,IAAAp0D,EAAA0yD,GAGAhG,EAAAsH,WAAAvtD,EACAimD,EAAA6I,WAAA9uD,EAGA,MAAArf,KAAA+pE,UACAzE,EAAAkJ,MAAAxuE,KAAAyoB,MAAA68C,EAAAoJ,OAAAC,QAAA3uE,KAAAyoB,MAAAzoB,KAAAW,OAAA84B,EAAApa,IAGA+9C,EAAAp9D,KAAAW,OAAA84B,EAAA6rC,EAAAoH,SAAAz2D,EAAAoJ,GACApJ,GAAAoJ,EACAoa,GAAApa,EAGAoa,GAAAz5B,KAAAmS,MAEAsnB,EAAA,EACAz5B,KAAA2qE,OAAA3qE,KAAAmS,MACAnS,KAAA2qE,MAAA,GAGAtrD,EAAArf,KAAA2qE,MAAAlxC,EACApa,EAAAimD,EAAAsH,YAAAvtD,EAAAimD,EAAAsH,WACA,GAAAvtD,GAAAzG,GAAAo0D,IAAAp0D,EAAA0yD,GAGAhG,EAAAsH,WAAAvtD,EACAimD,EAAA6I,WAAA9uD,EAGA,MAAArf,KAAA+pE,UACAzE,EAAAkJ,MAAAxuE,KAAAyoB,MAAA68C,EAAAoJ,OAAAC,QAAA3uE,KAAAyoB,MAAAzoB,KAAAW,OAAA84B,EAAApa,IAGA+9C,EAAAp9D,KAAAW,OAAA84B,EAAA6rC,EAAAoH,SAAAz2D,EAAAoJ,GACApJ,GAAAoJ,EACAoa,GAAApa,GAIAimD,EAAAqH,eAAA12D,EACAjW,KAAA85D,KAAArgC,EAGA7gB,EAqBA2xD,GAAAxtE,UAAA4xC,KAAA,SAAAo8B,EAAAC,EAAAlH,EAAAsL,EAAAnE,EAAAoE,EAAA/J,GACAtlE,KAAA6N,KAfA,EAgBA7N,KAAAsvE,MAAAvE,EACA/qE,KAAAuvE,MAAAvE,EACAhrE,KAAAwvE,MAAA1L,EACA9jE,KAAAyvE,YAAAL,EACApvE,KAAA0vE,MAAAzE,EACAjrE,KAAA2vE,YAAAN,EACArvE,KAAA4vE,KAAA,MAGArF,EAAAxtE,UAAA0xE,KAAA,SAAA1qE,EAAAuhE,EAAA1sD,GACA,GAAA2D,GAEAszD,EACA7wD,EAIAK,EACAoa,EACA/Y,EACA4Q,EANAzyB,EAAA,EACA6J,EAAA,EACAuN,EAAA,CAWA,KAJAA,EAAAqvD,EAAA+G,cAAsBhtD,EAAAimD,EAAAgH,SAAaztE,EAAAkF,EAAA2mE,KAAShiE,EAAA3E,EAAA0mE,KAC5ChxC,EAAA11B,EAAA4mE,MAAcjqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,IAId,OAAAz5B,KAAA6N,MAEA,IA9CA,GA+CA,GAAA6S,GAAA,KAAArB,GAAA,KAEAtb,EAAA2mE,KAAA7rE,EAAYkF,EAAA0mE,KAAA/hE,EACZ48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9ClS,EAAA4mE,MAAAlxC,EACA7gB,EAAA5Y,KAAA8vE,aAAA9vE,KAAAsvE,MAAAtvE,KAAAuvE,MACAvvE,KAAAwvE,MAAAxvE,KAAAyvE,YACAzvE,KAAA0vE,MAAA1vE,KAAA2vE,YACA5rE,EAAAuhE,GAEArvD,EAAAqvD,EAAA+G,cAAqBhtD,EAAAimD,EAAAgH,SAAaztE,EAAAkF,EAAA2mE,KAAShiE,EAAA3E,EAAA0mE,KAC3ChxC,EAAA11B,EAAA4mE,MAAajqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,EAEb7gB,GAAA0yD,GAAA,CACAtrE,KAAA6N,KAAA+K,GAAAm0D,EAtDA,EAEA,CAqDA,OAGA/sE,KAAAuuE,KAAAvuE,KAAAsvE,MACAtvE,KAAA4vE,KAAA5vE,KAAAwvE,MACAxvE,KAAA+vE,WAAA/vE,KAAAyvE,YAEAzvE,KAAA6N,KApEA,CAqEA,KArEA,GAwEA,IAFA0O,EAAAvc,KAAAuuE,KAEA7lE,EAAA,IACA,MAAA2W,EAMA,MAHAtb,GAAA2mE,KAAA7rE,EAAckF,EAAA0mE,KAAA/hE,EACd48D,EAAAgH,SAAAjtD,EAAkBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAChDlS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EANAA,GAAA0yD,EAQAjsD,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACAA,GAAA,EAUA,GAPAmnE,EAAA,GAAA7vE,KAAA+vE,YAAAlxE,EAAAwuE,EAAA9wD,KAEA1d,KAAAmB,KAAA4vE,KAAAC,EAAA,GACAnnE,GAAA1I,KAAA4vE,KAAAC,EAAA,GAIA,IAFA7wD,EAAAhf,KAAA4vE,KAAAC,IAEA,CACA7vE,KAAAgwE,IAAAhwE,KAAA4vE,KAAAC,EAAA,GACA7vE,KAAA6N,KA1FA,CA2FA,OAEA,UAAAmR,GAAA,CACAhf,KAAAlB,IAAA,GAAAkgB,EACAhf,KAAAoS,IAAApS,KAAA4vE,KAAAC,EAAA,GACA7vE,KAAA6N,KApGA,CAqGA,OAEA,UAAAmR,GAAA,CACAhf,KAAAuuE,KAAAvvD,EACAhf,KAAA+vE,WAAAF,EAAA,EAAA7vE,KAAA4vE,KAAAC,EAAA,EACA,OAEA,UAAA7wD,GAAA,CACAhf,KAAA6N,KAxGA,CAyGA,OASA,MAPA7N,MAAA6N,KAzGA,EA0GAy3D,EAAA2H,IAAA,8BACAr0D,GA7wCA,EA+wCA7U,EAAA2mE,KAAA7rE,EAAUkF,EAAA0mE,KAAA/hE,EACV48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAEA,KAzHA,GA4HA,IAFA2D,EAAAvc,KAAAlB,IAEA4J,EAAA,IACA,MAAA2W,EAMA,MAHAtb,GAAA2mE,KAAA7rE,EAAckF,EAAA0mE,KAAA/hE,EACd48D,EAAAgH,SAAAjtD,EAAkBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAChDlS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EANAA,GAAA0yD,EAQAjsD,IAAOxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACPA,GAAA,EAGA1I,KAAAoS,KAAAvT,EAAAwuE,EAAA9wD,GAEA1d,IAAA0d,EACA7T,GAAA6T,EAEAvc,KAAAuuE,KAAAvuE,KAAAuvE,MACAvvE,KAAA4vE,KAAA5vE,KAAA0vE,MACA1vE,KAAA+vE,WAAA/vE,KAAA2vE,YACA3vE,KAAA6N,KAhJA,CAiJA,KAjJA,GAoJA,IAFA0O,EAAAvc,KAAAuuE,KAEA7lE,EAAA,IACA,MAAA2W,EAMA,MAHAtb,GAAA2mE,KAAA7rE,EAAckF,EAAA0mE,KAAA/hE,EACd48D,EAAAgH,SAAAjtD,EAAkBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAChDlS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EANAA,GAAA0yD,EAQAjsD,IAAOxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACPA,GAAA,EASA,GANAmnE,EAAA,GAAA7vE,KAAA+vE,YAAAlxE,EAAAwuE,EAAA9wD,KAEA1d,IAAAmB,KAAA4vE,KAAAC,EAAA,GACAnnE,GAAA1I,KAAA4vE,KAAAC,EAAA,GAGA,QADA7wD,EAAAhf,KAAA4vE,KAAAC,KACA,CACA7vE,KAAAlB,IAAA,GAAAkgB,EACAhf,KAAAiwE,KAAAjwE,KAAA4vE,KAAAC,EAAA,GACA7vE,KAAA6N,KAzKA,CA0KA,OAEA,UAAAmR,GAAA,CACAhf,KAAAuuE,KAAAvvD,EACAhf,KAAA+vE,WAAAF,EAAA,EAAA7vE,KAAA4vE,KAAAC,EAAA,EACA,OASA,MAPA7vE,MAAA6N,KA5KA,EA6KAy3D,EAAA2H,IAAA,wBACAr0D,GAh1CA,EAk1CA7U,EAAA2mE,KAAA7rE,EAAUkF,EAAA0mE,KAAA/hE,EACV48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAEA,KA1LA,GA6LA,IAFA2D,EAAAvc,KAAAlB,IAEA4J,EAAA,IACA,MAAA2W,EAMA,MAHAtb,GAAA2mE,KAAA7rE,EAAckF,EAAA0mE,KAAA/hE,EACd48D,EAAAgH,SAAAjtD,EAAkBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAChDlS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EANAA,GAAA0yD,EAQAjsD,IAAOxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EACPA,GAAA,EAGA1I,KAAAiwE,MAAApxE,EAAAwuE,EAAA9wD,GAEA1d,IAAA0d,EACA7T,GAAA6T,EAEAvc,KAAA6N,KA9MA,CA+MA,KA/MA,GAiNA,IADAyjB,EAAAmI,EAAAz5B,KAAAiwE,KACA3+C,EAAA,GACAA,GAAAvtB,EAAAoO,GAEA,SAAAnS,KAAAoS,KAAA,CAEA,MAAAsO,IACA+Y,GAAA11B,EAAAoO,KAAA,GAAApO,EAAA+1D,OAA6BrgC,EAAA,EAAI/Y,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,GACjC,GAAA/Y,IACA3c,EAAA4mE,MAAAlxC,EAAiB7gB,EAAA7U,EAAAkrE,cAAA3J,EAAA1sD,GACjB6gB,EAAA11B,EAAA4mE,MAAiBjqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,EAEjBA,GAAA11B,EAAAoO,KAAA,GAAApO,EAAA+1D,OAA+BrgC,EAAA,EAAI/Y,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,GAEnC,GAAA/Y,IAIA,MAHA3c,GAAA2mE,KAAA7rE,EAAWkF,EAAA0mE,KAAA/hE,EACX48D,EAAAgH,SAAAjtD,EAAeimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC7ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAKA7U,GAAApD,OAAA84B,KAAA11B,EAAApD,OAAA2wB,KAA+B5Q,IAE/B4Q,GAAAvtB,EAAAoO,MACAmf,EAAA,GACAtxB,KAAAoS,MAEApS,KAAA6N,KAlPA,CAmPA,MACA,KA9OA,GA+OA,MAAA6S,IACA+Y,GAAA11B,EAAAoO,KAAA,GAAApO,EAAA+1D,OAA2BrgC,EAAA,EAAI/Y,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,GAC/B,GAAA/Y,IACA3c,EAAA4mE,MAAAlxC,EAAe7gB,EAAA7U,EAAAkrE,cAAA3J,EAAA1sD,GACf6gB,EAAA11B,EAAA4mE,MAAejqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,EAEfA,GAAA11B,EAAAoO,KAAA,GAAApO,EAAA+1D,OAA6BrgC,EAAA,EAAI/Y,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,GACjC,GAAA/Y,IAIA,MAHA3c,GAAA2mE,KAAA7rE,EAAgBkF,EAAA0mE,KAAA/hE,EAChB48D,EAAAgH,SAAAjtD,EAAoBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAClDlS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAIAA,GAAA0yD,EAEAvnE,EAAApD,OAAA84B,KAAAz5B,KAAAgwE,IAAwBtvD,IAExB1gB,KAAA6N,KAxQA,CAyQA,MACA,KAnQA,GA6QA,GATAnF,EAAA,IACAA,GAAA,EACA2W,IACApJ,KAGAlS,EAAA4mE,MAAAlxC,EAAW7gB,EAAA7U,EAAAkrE,cAAA3J,EAAA1sD,GACX6gB,EAAA11B,EAAA4mE,MAAWjqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,EAEX11B,EAAA+1D,MAAA/1D,EAAA4mE,MAIA,MAHA5mE,GAAA2mE,KAAA7rE,EAAYkF,EAAA0mE,KAAA/hE,EACZ48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAEA5Y,MAAA6N,KAlRA,CAmRA,KAnRA,GAwRA,MAJA+K,GAAAm0D,EACAhpE,EAAA2mE,KAAA7rE,EAAUkF,EAAA0mE,KAAA/hE,EACV48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAEA,KAzRA,GAgSA,MALAA,IA77CA,EA+7CA7U,EAAA2mE,KAAA7rE,EAAUkF,EAAA0mE,KAAA/hE,EACV48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,EAEA,SAMA,MALAA,IAt8CA,EAw8CA7U,EAAA2mE,KAAA7rE,EAAUkF,EAAA0mE,KAAA/hE,EACV48D,EAAAgH,SAAAjtD,EAAcimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC5ClS,EAAA4mE,MAAAlxC,EACA11B,EAAAkrE,cAAA3J,EAAA1sD,KAKA2xD,EAAAxtE,UAAAqxE,KAAA,SAAA9I,KASAiF,EAAAxtE,UAAA+yE,aAAA,SAAA/E,EAAAC,EAAAlH,EAAAsL,EAAAnE,EAAAoE,EAAAtrE,EAAAuhE,GACA,GAAAn+C,GACA+oD,EACAC,EACAnxD,EACAngB,EACA6J,EACAuN,EACAoJ,EACAoa,EACA/Y,EACA0vD,EACAC,EACAznD,EACAzS,EACAyC,EAEA03D,CAGAr6D,GAAAqvD,EAAA+G,cAAsBhtD,EAAAimD,EAAAgH,SAAaztE,EAAAkF,EAAA2mE,KAAShiE,EAAA3E,EAAA0mE,KAC5ChxC,EAAA11B,EAAA4mE,MAAcjqD,EAAA+Y,EAAA11B,EAAA+1D,KAAA/1D,EAAA+1D,KAAArgC,EAAA,EAAA11B,EAAAoO,IAAAsnB,EAGd22C,EAAA/C,EAAAtC,GACAsF,EAAAhD,EAAArC,EAGA,IAEA,KAAAtiE,EAAA,IACA2W,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EAA6BA,GAAA,CAO7B,IAJAye,EAAAtoB,EAAAuxE,EACAF,EAAApM,EACAqM,EAAAf,EACAkB,EAAA,GAAAH,EAAAhpD,GACA,IAAAnI,EAAAkxD,EAAAI,IAOA,QAIA,GAFAzxE,IAAAqxE,EAAAI,EAAA,GAA0B5nE,GAAAwnE,EAAAI,EAAA,GAE1B,OAAAtxD,GAAA,CAOA,IANAA,GAAA,GACA4J,EAAAsnD,EAAAI,EAAA,IAAAzxE,EAAAwuE,EAAAruD,IAEAngB,IAAAmgB,EAAStW,GAAAsW,EAGTtW,EAAA,IACA2W,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EAAiCA,GAAA,CASjC,KANAye,EAAAtoB,EAAAwxE,EACAH,EAAAjF,EACAkF,EAAAd,EACAiB,EAAA,GAAAH,EAAAhpD,GACAnI,EAAAkxD,EAAAI,KAEA,CAIA,GAFAzxE,IAAAqxE,EAAAI,EAAA,GAA8B5nE,GAAAwnE,EAAAI,EAAA,GAE9B,OAAAtxD,GAAA,CAGA,IADAA,GAAA,GACAtW,EAAA,GACA2W,IACAxgB,IAAA,IAAAymE,EAAA8G,QAAAn2D,OAAAvN,EAA8BA,GAAA,CAS9B,IANAyN,EAAA+5D,EAAAI,EAAA,IAAAzxE,EAAAwuE,EAAAruD,IAEAngB,IAAA,EAAe6J,GAAA,EAGfgY,GAAAkI,EACA6Q,GAAAtjB,EAEAyC,EAAA6gB,EAAAtjB,EAEApS,EAAApD,OAAA84B,KAAA11B,EAAApD,OAAAiY,KACA7U,EAAApD,OAAA84B,KAAA11B,EAAApD,OAAAiY,KACAgQ,GAAA,MAQA,CACAhQ,EAAA6gB,EAAAtjB,CACA,IACAyC,GAAA7U,EAAAoO,UACiByG,EAAA,EAEjB,IADAoG,EAAAjb,EAAAoO,IAAAyG,EACAgQ,EAAA5J,EAAA,CAEA,GADA4J,GAAA5J,EACAya,EAAA7gB,EAAA,GAAAoG,EAAAya,EAAA7gB,EACA,GAAS7U,EAAApD,OAAA84B,KAAA11B,EAAApD,OAAAiY,WACT,KAAAoG,OAGAo+C,GAAAr5D,EAAApD,OAAAiY,EAAA7U,EAAApD,OAAA84B,EAAAza,GACAya,GAAAza,EAAWpG,GAAAoG,EAAMA,EAAA,CAEjBpG,GAAA,GAMA,GAAiB7U,EAAApD,OAAA84B,KAAA11B,EAAApD,OAAAiY,WACjB,KAAAgQ,EACA,OAEA,UAAA5J,GAeA,MARAsmD,GAAA2H,IAAA,wBAEArkD,EAAA08C,EAAAgH,SAAAjtD,EAAsBuJ,EAAAlgB,GAAA,EAAAkgB,EAAAlgB,GAAA,EAAAkgB,EAAkBvJ,GAAAuJ,EAAK3S,GAAA2S,EAAKlgB,GAAAkgB,GAAA,EAElD7kB,EAAA2mE,KAAA7rE,EAAgBkF,EAAA0mE,KAAA/hE,EAChB48D,EAAAgH,SAAAjtD,EAAoBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAClDlS,EAAA4mE,MAAAlxC,GAnmDA,CAulDAtS,IAAA+oD,EAAAI,EAAA,GACAnpD,GAAAtoB,EAAAwuE,EAAAruD,GACAsxD,EAAA,GAAAH,EAAAhpD,GACAnI,EAAAkxD,EAAAI,GAeA,MAGA,UAAAtxD,GAaA,cAAAA,IAEA4J,EAAA08C,EAAAgH,SAAAjtD,EAAkBuJ,EAAAlgB,GAAA,EAAAkgB,EAAAlgB,GAAA,EAAAkgB,EAAkBvJ,GAAAuJ,EAAK3S,GAAA2S,EAAKlgB,GAAAkgB,GAAA,EAE9C7kB,EAAA2mE,KAAA7rE,EAAYkF,EAAA0mE,KAAA/hE,EACZ48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9ClS,EAAA4mE,MAAAlxC,EAEAszC,IAGAzH,EAAA2H,IAAA,8BAEArkD,EAAA08C,EAAAgH,SAAAjtD,EAAkBuJ,EAAAlgB,GAAA,EAAAkgB,EAAAlgB,GAAA,EAAAkgB,EAAkBvJ,GAAAuJ,EAAK3S,GAAA2S,EAAKlgB,GAAAkgB,GAAA,EAE9C7kB,EAAA2mE,KAAA7rE,EAAYkF,EAAA0mE,KAAA/hE,EACZ48D,EAAAgH,SAAAjtD,EAAgBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC9ClS,EAAA4mE,MAAAlxC,GA1oDA,EAgnDA,IAHAtS,GAAA+oD,EAAAI,EAAA,GACAnpD,GAAAtoB,EAAAwuE,EAAAruD,GACAsxD,EAAA,GAAAH,EAAAhpD,GACA,IAAAnI,EAAAkxD,EAAAI,IAAA,CAEAzxE,IAAAqxE,EAAAI,EAAA,GAA8B5nE,GAAAwnE,EAAAI,EAAA,GAE9BvsE,EAAApD,OAAA84B,KAAAy2C,EAAAI,EAAA,GACA5vD,GACA,YAtHA7hB,KAAAqxE,EAAAI,EAAA,GAA0B5nE,GAAAwnE,EAAAI,EAAA,GAE1BvsE,EAAApD,OAAA84B,KAAAy2C,EAAAI,EAAA,GACA5vD,UA8IAA,GAAA,KAAArB,GAAA,GASA,OANAuJ,GAAA08C,EAAAgH,SAAAjtD,EAAmBuJ,EAAAlgB,GAAA,EAAAkgB,EAAAlgB,GAAA,EAAAkgB,EAAkBvJ,GAAAuJ,EAAK3S,GAAA2S,EAAKlgB,GAAAkgB,GAAA,EAE/C7kB,EAAA2mE,KAAA7rE,EAAakF,EAAA0mE,KAAA/hE,EACb48D,EAAAgH,SAAAjtD,EAAiBimD,EAAA4I,UAAAj4D,EAAAqvD,EAAA+G,cAA8B/G,EAAA+G,cAAAp2D,EAC/ClS,EAAA4mE,MAAAlxC,EAEA6xC,GAUAT,EAAA9tE,UAAAwzE,WAAA,SAAA1xE,EAAA2xE,EAAAnxD,EAAAtb,EAAAoS,EAAA6I,EAAAmI,EAAAzG,EAAA+vD,EAAAC,EAAA7sD,GAQA,GAAAjlB,GACA0yB,EACAzY,EACAw5C,EACA3iD,EACA6M,EACA7T,EACA6mB,EACAohD,EACA16D,EACAwjB,EACAk5B,EACAie,EACA/hD,EACAy2C,CAIArvD,GAAA,EAAUvG,EAAA2P,CACV,IACArf,KAAA4oB,EAAA/pB,EAAA2xE,EAAAv6D,MAA4BA,IAAKvG,UAC5B,GAAAA,EAEL,IAAA1P,KAAA4oB,EAAA,IAAAvJ,EAGA,MAFA8H,GAAA,MACAzG,EAAA,KACA4qD,CAKA,KADA/7C,EAAA7O,EAAA,GACAnE,EAAA,EAAeA,GA7tDf,IA8tDA,GAAAvc,KAAA4oB,EAAArM,GAD0BA,KAM1B,IAJA7T,EAAA6T,EACAgT,EAAAhT,IACAgT,EAAAhT,GAEA7M,EAnuDA,GAmuDkB,GAAAA,GAClB,GAAA1P,KAAA4oB,EAAAlZ,GADwBA,KAUxB,IAPAmJ,EAAAnJ,EACA6f,EAAA7f,IACA6f,EAAA7f,GAEAgR,EAAA,GAAA6O,EAGAV,EAAA,GAAAtS,EAAoBA,EAAA7M,EAAO6M,IAAAsS,IAAA,EAC3B,IAAAA,GAAA7uB,KAAA4oB,EAAArM,IAAA,EACA,OA7tDA,CAguDA,KAAAsS,GAAA7uB,KAAA4oB,EAAAlZ,IAAA,EACA,OAjuDA,CAwuDA,KALA1P,KAAA4oB,EAAAlZ,IAAAmf,EAGA7uB,KAAA0uB,EAAA,GAAAnS,EAAA,EACAtG,EAAA,EAAU26D,EAAA,EACV,KAAAlhE,GACA1P,KAAA0uB,EAAAkiD,GAAAr0D,GAAAvc,KAAA4oB,EAAA3S,GACA26D,IACA36D,GAIAvG,GAAA,EAAUuG,EAAA,CACV,IACA,IAAAsG,EAAA1d,EAAA2xE,EAAAv6D,MACAjW,KAAA6jB,EAAA7jB,KAAA0uB,EAAAnS,MAAA7M,GAEAuG,YAEAvG,EAAA2P,EAaA,KAZAA,EAAArf,KAAA0uB,EAAA7V,GAGA7Y,KAAA0uB,EAAA,GAAAhf,EAAA,EACAuG,EAAA,EACAo8C,GAAA,EACAM,GAAApjC,EACAvvB,KAAA6wE,EAAA,KACAp3C,EAAA,EACA6rC,EAAA,EAGU58D,GAAAmQ,EAAQnQ,IAElB,IADA9J,EAAAoB,KAAA4oB,EAAAlgB,GACA,GAAA9J,KAAA,CAGA,KAAA8J,EAAAiqD,EAAApjC,GAAA,CAMA,GALA8iC,IACAM,GAAApjC,EAEA+1C,EAAAzsD,EAAA85C,EACA2S,IAAA/1C,IAAA+1C,GACAh0C,EAAA,IAAA/U,EAAA7T,EAAAiqD,IAAA/zD,EAAA,IAEA0yB,GAAA1yB,EAAA,EACAgyE,EAAAloE,EACA6T,EAAA+oD,GACA,OAAA/oD,EAAA+oD,MACAh0C,IAAA,IAAAtxB,KAAA4oB,IAAAgoD,KAEAt/C,GAAAtxB,KAAA4oB,EAAAgoD,EAOA,IAHAtL,EAAA,GAAA/oD,EAGAvc,KAAA0wE,GAAA,GAAApL,EAAA2E,EACA,OA9xDA,CAgyDAjqE,MAAA6wE,EAAAxe,GAAA54B,EAAAz5B,KAAA0wE,GAAA,GACA1wE,KAAA0wE,GAAA,IAAApL,EAGA,GAAAjT,GACAryD,KAAA0uB,EAAA2jC,GAAA3iD,EACA1P,KAAA4Y,EAAA,GAAA2D,EACAvc,KAAA4Y,EAAA,GAAA2W,EACAhT,EAAA7M,IAAAijD,EAAApjC,EACAvvB,KAAA4Y,EAAA,GAAA6gB,EAAAz5B,KAAA6wE,EAAAxe,EAAA,GAAA91C,EACA6gD,EAAAp9D,KAAA4Y,EAAA,EAAA63D,EAAA,GAAAzwE,KAAA6wE,EAAAxe,EAAA,GAAA91C,GAAA,IAGA4K,EAAA,GAAAsS,EAoBA,IAfAz5B,KAAA4Y,EAAA,GAAAlQ,EAAAiqD,EACA18C,GAAAoJ,EACArf,KAAA4Y,EAAA,OAEAiL,EAAA5N,GAAAlS,GACA/D,KAAA4Y,EAAA,GAAA5Y,KAAA6jB,EAAA5N,GAAA,SACAjW,KAAA4Y,EAAA,GAAA5Y,KAAA6jB,EAAA5N,OAGAjW,KAAA4Y,EAAA,GAAAoG,EAAAhf,KAAA6jB,EAAA5N,GAAAlS,GAAA,MACA/D,KAAA4Y,EAAA,GAAAzC,EAAAnW,KAAA6jB,EAAA5N,KAAAlS,IAIAutB,EAAA,GAAA5oB,EAAAiqD,EACAp2C,EAAA7M,IAAAijD,EAAqBp2C,EAAA+oD,EAAI/oD,GAAA+U,EACzB8rC,EAAAp9D,KAAA4Y,EAAA,EAAA63D,EAAA,GAAAh3C,EAAAld,GAAA,EAIA,KAAAA,EAAA,GAAA7T,EAAA,EAA8B,IAAAgH,EAAA6M,GAAYA,KAAA,EAC1C7M,GAAA6M,CAMA,KAJA7M,GAAA6M,EAGAo0D,GAAA,GAAAhe,GAAA,GACAjjD,EAAAihE,IAAA3wE,KAAA0uB,EAAA2jC,IACAA,IACAM,GAAApjC,EACAohD,GAAA,GAAAhe,GAAA,EAKA,UAAA9jC,GAAA,GAAAhW,EAAAm0D,EAAA1B,GAGAT,EAAA9tE,UAAAmyE,mBAAA,SAAAtmD,EAAAqwC,EAAAoR,EAAAoG,EAAAnL,GACA,GAAAz1D,EAYA,OAXA7P,MAAA8wE,aAAA,IACA9wE,KAAA0wE,GAAA,KACA7gE,EAAA7P,KAAAuwE,WAAA3nD,EAAA,kBAAAyhD,EAAApR,EAAAwX,EAAAzwE,KAAA0wE,GAAA1wE,KAAA6jB,IA51DA,GA81DAhU,EACAy1D,EAAA2H,IAAA,0CAEAp9D,GAAAm9D,GAAA,GAAA/T,EAAA,KACAqM,EAAA2H,IAAA,sCACAp9D,GAn2DA,GAq2DAA,GAGAg7D,EAAA9tE,UAAAoyE,sBAAA,SAAA4B,EAAAC,EAAApoD,EAAAmiD,EAAAC,EAAAlH,EAAAmH,EAAAwF,EAAAnL,GACA,GAAAz1D,EAMA,OAHA7P,MAAA8wE,aAAA,KACA9wE,KAAA0wE,GAAA,MACA7gE,EAAA7P,KAAAuwE,WAAA3nD,EAAA,EAAAmoD,EAAA,IAAAzD,EAAAC,EAAAzJ,EAAAiH,EAAA0F,EAAAzwE,KAAA0wE,GAAA1wE,KAAA6jB,KACAynD,GAAA,GAAAP,EAAA,KA/2DA,GAg3DAl7D,EACAy1D,EAAA2H,IAAA,sCAh3DA,GAk3DAp9D,IACAy1D,EAAA2H,IAAA,iCACAp9D,GAr3DA,GAu3DAA,IAIA7P,KAAA8wE,aAAA,KACAjhE,EAAA7P,KAAAuwE,WAAA3nD,EAAAmoD,EAAAC,EAAA,EAAAxD,EAAAC,EAAAxC,EAAAD,EAAAyF,EAAAzwE,KAAA0wE,GAAA1wE,KAAA6jB,GAEAhU,GAAAy7D,GAAA,GAAAN,EAAA,IAAA+F,EAAA,MA93DA,GA+3DAlhE,EACAy1D,EAAA2H,IAAA,+BAEAp9D,GAAAm9D,GACA1H,EAAA2H,IAAA,2BACAp9D,GAp4DA,IACA,GAq4DAA,IACAy1D,EAAA2H,IAAA,mCACAp9D,GAx4DA,GA04DAA,GAGAy7D,IAoBAT,EAAA9tE,UAAA+zE,aAAA,SAAAG,GACA,MAAAjxE,KAAA0wE,KACA1wE,KAAA0wE,GAAA,GAAAxV,YAAA,GACAl7D,KAAA6jB,EAAA,GAAAq3C,YAAA+V,GACAjxE,KAAA4oB,EAAA,GAAAsyC,YAAAgW,IACAlxE,KAAA4Y,EAAA,GAAAsiD,YAAA,GACAl7D,KAAA6wE,EAAA,GAAA3V,YAz7DA,IA07DAl7D,KAAA0uB,EAAA,GAAAwsC,YAAAgW,KAEAlxE,KAAA6jB,EAAAhjB,OAAAowE,IACAjxE,KAAA6jB,EAAA,GAAAq3C,YAAA+V,GAEA,QAAAvhE,GAAA,EAAgBA,EAAAuhE,EAASvhE,IAAM1P,KAAA6jB,EAAAnU,GAAA,CAC/B,QAAAA,GAAA,EAAgBA,EAAAwhE,GAAUxhE,IAAM1P,KAAA4oB,EAAAlZ,GAAA,CAChC,QAAAA,GAAA,EAAgBA,EAAA,EAAKA,IAAM1P,KAAA4Y,EAAAlJ,GAAA,CAE3B0tD,GAAAp9D,KAAA4oB,EAAA,EAAA5oB,KAAA6wE,EAAA,EAn8DA,IAq8DAzT,EAAAp9D,KAAA4oB,EAAA,EAAA5oB,KAAA0uB,EAAA,EAAAwiD,IAGA,IAAAC,GAAA,GAAArW,YAAA,GACA8Q,EAAA,kBAAAuF,GAAAtF,QA+IA,QACA1O,cAAAD,EACAE,cAECt/D,MAAA1B,EAAAk9D,MAAAn9D,EAAAC,QAAAm9D,I1By8fK,SAAUp9D,EAAQC,EAASC,IAEL,SAASC,G2B7jkBrC,GAAA80E,GAAA9X,EAAAC,GAIA,SAAApwD,EAAAkoE,GAGA/X,GAAAj9D,EAAA,IAAA+0E,EAAA,MAAA5vE,MAAA+3D,EAAA,kBAAA6X,KAAAtzE,MAAA1B,EAAAk9D,GAAA8X,KAAAj1E,EAAAC,QAAAm9D,IAUCv5D,EAAA,SAAAwF,GACD,GAAAyd,GAAAzd,EAAAyd,YACAA,GAAAquD,eAAAC,OAAA,iBACAtuD,EAAAuuD,WAAA,cACA,IAAAC,MACAC,EAAA,EACAC,GAEAC,EAAA,IAGAC,KAAA,KAEAC,KACAC,EAAAz1E,EAAA2mB,aAAAioB,KAGAvqC,QAAAqxE,eACAxsE,EAAA7E,QAAAD,GAAA,oBACA,OAAA7D,KAAAi1E,GACAA,EAAAj1E,OAIA40E,EAAAQ,OAAAF,GAAA,mBAAAA,GACAN,EAAApnE,KAAA0nE,MAGAvsE,EAAA0sE,cAAA,kBAAAxzE,GACA,GAAAmjB,EAEA,IAAA4vD,EAAAQ,MAAAF,IAAArzE,EAAAyzE,YACA,OACAC,KAAA,SAAAC,EAAA5oD,GACA,GAAA/Z,GACAw7B,EAAAxsC,EAAAwsC,MACAhrC,IAAAwxE,EACAY,IAKA,IAHApnC,EAAAnS,KAAAr6B,EAAAkX,KAAAlX,EAAA4L,IAAA5L,EAAA0qB,MAAA1qB,EAAA6zE,SAAA7zE,EAAA8zE,UAGA9zE,EAAAu7D,UACA,IAAAvqD,IAAAhR,GAAAu7D,UACA/uB,EAAAx7B,GAAAhR,EAAAu7D,UAAAvqD,EAKAhR,GAAA+zE,UAAAvnC,EAAAwnC,kBACAxnC,EAAAwnC,iBAAAh0E,EAAA+zE,UAQA/zE,EAAAyzE,aAAAE,EAAA,sBACAA,EAAA,qCAIA,KAAA3iE,IAAA2iE,GACAnnC,EAAAC,iBAAAz7B,EAAA2iE,EAAA3iE,GAIAmS,GAAA,SAAAjM,GACA,kBACAiM,UACAiwD,GAAA5xE,GACA2hB,EAAAqpB,EAAAj/B,OAAAi/B,EAAAynC,QAAA,KAEA,UAAA/8D,EACAs1B,EAAA0nC,QACiC,UAAAh9D,EACjC6T,EAEAyhB,EAAArN,OACAqN,EAAA2nC,aAKA3nC,EAAAt8B,WACA0jE,EAAAf,OAAArmC,EAAAt8B,UAGA6a,EACAkoD,EAAAzmC,EAAArN,SAAAqN,EAAArN,OACAqN,EAAA2nC,WACAP,EACApnC,EAAA4nC,6BAQA5nC,EAAAj/B,OAAA4V,IACAqpB,EAAAynC,QAAA9wD,EAAA,SAGAA,EAAAiwD,EAAA5xE,GAAA2hB,EAAA,QAEA,KAEAqpB,EAAAknC,KAAA1zE,EAAAq0E,YAAAr0E,EAAA8L,MAAA,MACqB,MAAAwU,GAErB,GAAA6C,EACA,KAAA7C,KAKA4zD,MAAA,WACA/wD,GACAA,QASArc,EAAAwtE,UAAA,SAAA1oE,EAAAuX,GACA,MAAArc,GAAA6E,MACAE,SAAA,SACAD,MACA2vD,WACAC,aAAA,eAEAz4D,QAAAogB,S3BqkkB6B5kB,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,YAuBA,SAASE,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAwBH,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAII,KAAa,IAAW,MAAPJ,EAAe,IAAK,GAAIK,KAAOL,GAAWM,OAAOC,UAAUC,eAAeC,KAAKT,EAAKK,KAAMD,EAAOC,GAAOL,EAAIK,GAAgC,OAAtBD,GAAOF,QAAUF,EAAYI,EAtBlQE,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G4BxukBX,IAAAC,GAAA5C,EAAA,GACA6C,G5B4ukBQvC,EAAwBsC,G4B5ukBhC5C,EAAA,IAAY8C,E5BgvkBGxC,EAAwBuC,G4B/ukBvC+zE,EAAA52E,EAAA,G5BmvkBI62E,EAAY32E,EAAuB02E,G4BlvkBvC3zE,EAAAjD,EAAA,G5BsvkBIkD,EAAiBhD,EAAuB+C,G4B/ukBxC6zE,EAAOh0E,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAQ8C,eAAeK,QAEhDH,cAPW,OAUXuT,QAAS,WACL,MAAU/J,QAAOC,KAAjB,aAOJtL,UACIqC,GAAI,KACJqyE,cAAc,EAAAhzE,EAAA7C,SAAG,kBAAjB,IACA02E,MAAO,GACPC,iBAAkB,EAClBC,sBAAuB,GACvBC,cAAe,KACfC,UAAU,GAMd1zE,WAAY,SAAS0K,GACjBxK,KAAKoK,IAAI,mBAAoBI,GAE7BxK,KAAKU,GAAG,SAAU,SAASQ,EAAOuyE,GAC9BzzE,KAAKoK,IAAOpK,KAAZ,eAAgCkB,EAAOuyE,KAE3CzzE,KAAKU,GAAG,SAAU,SAASQ,EAAOsJ,GAC9BxK,KAAKoK,IAAOpK,KAAZ,gBAAiCkB,EAAOsJ,EAAKkpE,YAIrDC,YAAa,WACT,OAAQ3zE,KAAKlB,IAAI,UAGrB80E,QAAS,WACL,MAAO5zE,MAAKlB,IAAI,aAUpB+0E,YAAa,SAASC,EAAap1E,GAC/Bo1E,EAAcA,GAAeX,EAAKY,eAElCr1E,EAAUA,KACV,IAAIwC,GAAQlB,KACRg0E,EAASt1E,EAAQ+C,OAcrB,OAXA/C,GAAQ+C,QAAU,SAACwyE,EAAUrlE,GACzB1N,EAAMC,QAAQ,SAAU8yE,EAAUrlE,GAC9BolE,GACAA,EAAOC,EAAUrlE,IAKrBklE,IAAgBX,EAAKY,iBACrBr1E,EAAQ4L,IAAStK,KAAKiT,QAAtB,IAAiCkgE,EAAKY,gBAEnC50E,EAASS,MAAM7C,UAAUktB,MAAMhtB,KAAK+C,KAAMtB,IAKrDw1E,oBAAqB,WACjB,IAAK,GAAIr3E,KAAO+D,gBAGoB,IAA5B/D,EAAIsF,QAAQ,YACZvB,eAAe0B,WAAWzF,GACX,kBAARA,GACP+D,eAAe0B,WAAWzF,IAMtC2F,SAAU,WACN,GAAI2xE,IAAYn0E,KAAKlB,IAAI,YAKzB,OAJIkB,MAAKlB,IAAI,QACTq1E,EAASx2E,QAAQqC,KAAKlB,IAAI,OAC1Bq1E,EAASjnE,KAAKlN,KAAKlB,IAAI,WAE3B,QAAeq1E,EAASh2E,KAAK,KAA7B,MAMZg1E,GAAKY,eAAiB,UAGtBZ,EAAKiB,sBAAwB,SAAA11E,GACzB,GAAI21E,GAAc,GAAIlB,EAEtB,OADAkB,GAAYR,YAAYV,EAAKY,eAAgBr1E,GACtC21E,EAIUl1E,GAASgW,WAAWtV,OAAOqzE,EAAAx2E,QAAQ8C,eAAeK,QACnEqB,MAAOiyE,EACPlgE,QAAS,WACL,MAAU/J,QAAOC,KAAjB,c5B+vkBR/M,GAAQM,S4BxvkBJy2E,KAAMA,I5B6vkBF,CAEF,SAAUh3E,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,GAsB/C,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G6Bx4kBX,IAAAyjB,GAAApmB,EAAA,GACAi4E,G7B44kBc/3E,EAAuBkmB,G6B54kBrCpmB,EAAA,K7Bg5kBIk4E,EAASh4E,EAAuB+3E,G6B/4kBpCE,EAAAn4E,EAAA,I7Bm5kBIo4E,EAAgBl4E,EAAuBi4E,G6Bl5kB3CE,EAAAr4E,EAAA,I7Bs5kBIs4E,EAAmBp4E,EAAuBm4E,G6Bp5kB1ClrE,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXA,MAAKtB,QAAUA,EACfsB,KAAK4e,WAAW5e,KAAKo0B,aACrBp0B,KAAK40E,iBAAmB50E,KAAKwF,EAAE,sBAC/BxF,KAAK60E,kBAAoB70E,KAAKwF,EAAE,uBAChCxF,KAAK80E,kBAAoB90E,KAAKwF,EAAE,uBAChCxF,KAAK+0E,YAAc/0E,KAAKwF,EAAE,gBAC1BxF,KAAKg1E,YAAch1E,KAAKwF,EAAE,0BAG1BxF,KAAK8gB,WAAa,GAAIyzD,GAAA73E,QAAKyY,WAC3BnV,KAAK8gB,WACApgB,GAAG,MAAO,SAAAQ,GACPoH,EAAKysE,YAAYprE,OAAO,GAAI4qE,GAAA73E,QAAKu4E,KAAM/zE,MAAOA,IAAS8a,SAASzX,OAEnE7D,GAAG,QAAS,WACT4H,EAAKysE,YAAY/sD,UAEpBtnB,GAAG,WAAY,SAAAmhB,GACZvZ,EAAKwY,WAAWvY,KAAK,SAAAmY,GACjBmB,EAASnB,OAGhBuJ,MAAMjqB,KAAKtB,SAGhBwK,OAAOoV,MAAQte,KAAKse,MAAQ,GAAAm2D,GAAA/3E,SACxBokB,WAAY9gB,KAAK8gB,aAKrB5X,OAAOgsE,WAAal1E,KAAKk1E,WAAa,GAAIP,GAAAj4E,QAAWy4E,gBACjDj0E,MAAOgI,OAAOksE,KACdr3D,GAAI/d,KAAKg1E,cAIbxvE,EAAE7E,QACGD,GAAG,QAAS,SAAAse,GACT,GAAIq2D,GAAiB7vE,EAAEwZ,EAAEC,QAAQkR,QAAQ,cACZ,IAAzBklD,EAAex0E,SACyB,IAApC2E,EAAE,uBAAuB3E,QACzB2E,EAAE,QAAQmE,OACNnE,EAAE,aACGU,KAAK,KAAM,YACXoB,QAGb9B,EAAE,uBAAuBU,KAAK,MAAOmvE,EAAenvE,KAAK,SACzD8Y,EAAE8H,oBAGTpmB,GAAG,eAAgB,WAChB,GAAIoc,GAAO,EAKX,IAJAxU,EAAKwY,WAAWvY,KAAK,SAAArH,GACjB,GAAIu4B,GAAIv4B,EAAMpC,IAAI,mBAAqBoC,EAAMpC,IAAI,mBACjD26B,KAAM3c,GAAW2c,EAAX,OAEG,KAAT3c,EACA,MAAOA,MAKvBd,OAAQ,WAKJ,MAJAhc,MAAK80E,kBAAkB11D,KAAvB,WAAuCpf,KAAKtB,QAAQ42E,OAAb,KAA2Bt1E,KAAKtB,QAAQ42E,OAAY,KAC3Ft1E,KAAK40E,iBAAiB1uE,KAAK,OAAQlG,KAAKtB,QAAQ62E,UAChDv1E,KAAK60E,kBAAkB3uE,KAAK,MAAOlG,KAAKtB,QAAQ82E,UAChDx1E,KAAKk1E,WAAWl5D,SACThc,MAIXo0B,UAAW,WACP,MACI,2U7Bk5kBZh4B,GAAQM,S6Bh4kBJ8M,KAAMA,K7Bm4kBmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAGlJ,EAAQsB,GAsB1D,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G8Bj/kBX,IAAAy2E,GAAAp5E,EAAA,I9Bs/kBIq5E,EAAmBn5E,EAAuBk5E,G8Br/kB9C14C,EAAA1gC,EAAA,I9By/kBI2gC,EAAazgC,EAAuBwgC,G8Bx/kBxCz9B,EAAAjD,EAAA,G9B4/kBIkD,EAAiBhD,EAAuB+C,G8B3/kB5CmjB,EAAApmB,EAAA,G9B+/kBIqmB,EAAUnmB,EAAuBkmB,G8B9/kBjCtN,EAAahW,EAASgW,WAAWtV,QACjCqB,MAAO/B,EAASS,MAAMC,QAClBhC,UACI6sB,SAAS,EACTzL,OAAQ,aAGhBgL,MAAO,SAASvrB,GAEZA,EAAUA,MACVsB,KAAK40B,OAKL,IAAI+gD,GAAkB,GAAID,GAAAh5E,QAAWk5E,cACrC51E,MAAKyJ,IAAIksE,EAAgB35D,UAKzBhc,KAAKyJ,KACDvJ,GAAI,WACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,gBACV4N,IAAK,GACLmX,SAAS,EAAAliB,EAAA7C,SAAG,wBAMhBsD,KAAKyJ,KACDvJ,GAAI,WACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,YACV+kB,SAAS,EAAAliB,EAAA7C,SAAG,8BACZuvB,UAAW/iB,OAAOksE,KAAKl1E,GACvBoK,IAAK,aAMTtK,KAAKyJ,KACDvJ,GAAI,SACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,eACV4N,IAAK,gBACLmX,SAAS,EAAAliB,EAAA7C,SAAG,8BACZovB,OAEQpiB,OAAO,EAAAnK,EAAA7C,SAAG,kBACV4N,IAAK,iBAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,aACV4N,IAAK,6BAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,aACV4N,IAAK,6BAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,kBACV4N,IAAK,kCAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,SACV4N,IAAK,2BAQjBtK,KAAKyJ,KACDvJ,GAAI,gBACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,iBACV4N,IAAK,sBACLmX,SAAS,EAAAliB,EAAA7C,SAAG,sBACZuvB,UAAW/iB,OAAOksE,KAAKl1E,GACvB4rB,OAEQpiB,OAAO,EAAAnK,EAAA7C,SAAG,qBACV4N,IAAK,0BACL2U,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,wBACV4N,IAAK,sBACL2U,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,4BACV4N,IAAK,yBACL2U,OAAQ,kBAQpB+d,EAAAtgC,QAAS+M,KACLa,IAAK,4BACLuX,SAAU,SAASwI,GACf7kB,EAAE8b,UAAUu0D,MAAM,WACdrwE,EAAE+C,KAAK8hB,EAAS5U,OAAQ,SAAC7I,EAAO1L,GAC5B,GAAIgpB,GAAUhpB,EAAMS,QACpB,IAAIuoB,EAAQP,SAAU,CAClB,GAAIntB,IACA0D,GAAIgqB,EAAQva,KACZqc,KAAM9B,EAAQoB,OAAOU,KACrB1hB,IAAK4f,EAAQoB,OAAOhhB,IACpBmX,QAASyI,EAAQoB,OAAO7J,QACxBsF,QAASmD,EAAQoB,OAAOwqD,UAAY,GAAIC,UAAS7rD,EAAQoB,OAAOwqD,UAIhE5sE,QAAO64B,KACP74B,OAAO64B,KAAKi0C,SAASl1D,WAAWrX,IAAIjN,GAC7B0M,OAAO8sE,UACd9sE,OAAO8sE,SAASl1D,WAAWrX,IAAIjN,GAInCkmB,EAAAhmB,QAAMu5E,kBAAkB/rD,WAU5ChhB,OAAOksE,KAAKt2E,IAAI,aACZkB,KAAKyJ,KACDvJ,GAAI,QACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,SACV4N,IAAK,QACLmX,SAAS,EAAAliB,EAAA7C,SAAG,0BACZoiC,IAAK,cAMb,IAAIo3C,IACAh2E,GAAI,OACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,QACV+kB,SAAS,EAAAliB,EAAA7C,SAAG,mCACZovB,OAEQpiB,OAAO,EAAAnK,EAAA7C,SAAG,WACV4N,IAAK5L,EAAQy3E,YACbl3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,UACV4N,IAAK5L,EAAQ03E,WACbn3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,iBACV4N,IAAK5L,EAAQ23E,cACbp3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,UACV4N,IAAK5L,EAAQ43E,gBACbr3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,QACV4N,IAAK5L,EAAQ63E,SACbt3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,sBACV4N,IAAK5L,EAAQ83E,aACbv3D,OAAQ,WAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,qBACV4N,IAAK,UAIjB5L,GAAQ+3E,WACJP,EAAQpqD,KAAK5e,MACTxD,OAAO,EAAAnK,EAAA7C,SAAG,wBACV4N,IAAK5L,EAAQ+3E,UACbx3D,OAAQ,WAEhBvgB,EAAQg4E,aACJR,EAAQpqD,KAAKnuB,SACT+L,OAAO,EAAAnK,EAAA7C,SAAG,kBACV4N,IAAK,oCACL2U,OAAQ,WAEhBvgB,EAAQg4E,aACJR,EAAQpqD,KAAKnuB,SACT+L,OAAO,EAAAnK,EAAA7C,SAAG,kBACV4N,IAAK5L,EAAQi4E,qBACb13D,OAAQ,WAEhBjf,KAAKyJ,IAAIysE,EAKT,IAAIU,KAmCAA,GAlCC1tE,OAAOksE,KAAKl1E,IAmCTA,GAAI,OACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,QACVoiC,IAAK,gBACLrd,SAAS,EAAAliB,EAAA7C,SAAG,0BACZovB,OAEQpiB,OAAU,EAAAnK,EAAA7C,SAAG,gBAAb,IAAgCwM,OAAOksE,KAAKt2E,IAAI,WAGhD4K,OAAO,EAAAnK,EAAA7C,SAAG,eACV4N,IAAK,SAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,iBACV4N,IAAK,kBAGLZ,OAAO,EAAAnK,EAAA7C,SAAG,UACV4N,sCAAuCpB,OAAO2tE,mBAC9C53D,OAAQ,OACRkT,SAAS,IAGTzoB,OAAO,EAAAnK,EAAA7C,SAAG,mBACV4N,IAAK,iBACL2U,OAAQ,SAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,kBACV4N,IAAK,gBACL2U,OAAQ,SAGRvV,OAAO,EAAAnK,EAAA7C,SAAG,eACV4N,IAAK,aACL2U,OAAQ,UArEhBvgB,EAAQo4E,qBAEJ52E,GAAI,OACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,qBACVoiC,IAAK,iBACLrd,SAAS,EAAAliB,EAAA7C,SAAG,iCACZovB,OAEQpiB,OAAO,EAAAnK,EAAA7C,SAAG,SACV4N,IAAK,aACL2U,OAAQ,cACR83D,eAAe,IAGfrtE,OAAO,EAAAnK,EAAA7C,SAAG,YACV4N,IAAK,cACL2U,OAAQ,cACR83D,eAAe,MAMvB72E,GAAI,OACJwJ,OAAO,EAAAnK,EAAA7C,SAAG,SACVoiC,IAAK,iBACLrd,SAAS,EAAAliB,EAAA7C,SAAG,SACZ4N,IAAK,aACL2U,OAAQ,cACR83D,eAAe,GA6C3B/2E,KAAKyJ,IAAImtE,EACT,IAAII,GAAah3E,KAAKlB,IAAIJ,EAAQu4E,YAElC,OADAD,IAAcA,EAAWp1E,IAAI,UAAU,IAChC,GAAItF,GAAOgS,UAAWQ,UAAUiiB,aAK3CkkD,EAAM91E,EAASqK,KAAK3J,QACpBC,WAAY,SAASpB,GACjBsB,KAAKkB,MAAQxC,EAAQwC,MACrBlB,KAAK4e,WAAW5e,KAAKo0B,aACrBp0B,KAAKk3E,UAAYl3E,KAAKwF,EAAE,aACxBxF,KAAKm3E,QAAUn3E,KAAKwF,EAAE,oBACtBxF,KAAKo3E,MAAQp3E,KAAKwF,EAAE,kBACpBxF,KAAKq3E,MAAQr3E,KAAKwF,EAAE,kBACpBxF,KAAK6rB,SAAS7rB,KAAKkB,MAAO,SAAUlB,KAAKgc,OAAQhc,OAGrD6e,QACIy4D,yBAA0B,gBAG9Bt7D,OAAQ,WACJ,GAAI1T,GAAOtI,IAqDX,OApDAwF,GAAE,YAAY6f,SACdrlB,KAAKuE,IAAI2B,KAAK,KAAMlG,KAAKkB,MAAMhB,IAAIud,KAC/B85D,WAAav3E,KAAKkB,MAAMpC,IAAI,YAAc,WAAc,WAE5DkB,KAAKkB,MAAMU,IAAI,MAAO5B,KAAKw3E,WAAWx3E,KAAKkB,MAAMpC,IAAI,SACrDkB,KAAKq3E,MACAj4D,KAAKpf,KAAKkB,MAAMpC,IAAI,SAAW,IAC/BoiB,cACAlE,SAAS,iBACTA,SAAShd,KAAKkB,MAAMpC,IAAI,aACxB2e,KACGigB,QAAU19B,KAAKkB,MAAMpC,IAAI,cAAgB,SAAY,SAE7DkB,KAAKm3E,QACA/3D,KAAKpf,KAAKkB,MAAMpC,IAAI,UAAY,IAChCoiB,cACAlE,SAAS,mBACTA,SAAShd,KAAKkB,MAAMpC,IAAI,QACxBke,SAAShd,KAAKkB,MAAMpC,IAAI,SAAf,oBAA8CkB,KAAKkB,MAAMpC,IAAI,SACtEke,SAAShd,KAAKkB,MAAMpC,IAAI,WAAa,UACrCoH,KAAK,SAAUlG,KAAKkB,MAAMpC,IAAI,WAC9BoH,KAAK,OAAQlG,KAAKkB,MAAMpC,IAAI,QAC5BoH,KAAK,QAASlG,KAAKkB,MAAMpC,IAAI,YAC7B2iB,QAAQ,WACbzhB,KAAKkB,MAAMpC,IAAI,YAAckB,KAAKm3E,QAAQ11D,SAAUmJ,UAAW,WAC/D5qB,KAAKk3E,UACAh2D,cACAlE,SAAS,YACTA,SAAShd,KAAKkB,MAAMpC,IAAI,aAAe,YACvCke,SAAShd,KAAKkB,MAAMpC,IAAI,WAAa,UACtCkB,KAAKkB,MAAMpC,IAAI,SAAWkB,KAAKkB,MAAMpC,IAAI,cACzCkB,KAAKo3E,MAAM/vE,OACX7B,EAAE,cACG6B,OACAwY,MACAnf,GAAG,QAAS,WACT8E,EAAE,cAAc8B,OAChBgB,EAAKpH,MAAMU,IAAI,aAAa,OAGpC0G,EAAK8uE,MAAM9vE,OACX9B,EAAE,cAAc8B,QAEpBtH,KAAKo3E,MAAMpvD,QAAQ9G,YAAY,iBAC3BlhB,KAAKkB,MAAMpC,IAAI,UACflB,EAAE2K,KAAKvI,KAAKkB,MAAMpC,IAAI,QAAS,SAAA24E,GAC3BnvE,EAAK8uE,MAAMztE,OAAOrB,EAAKovE,eAAeD,IACtCA,EAAStlD,SAAW7pB,EAAK8uE,MAAMztE,OAAOnE,EAAE,SAASwX,SAAS,cAE9D1U,EAAK8uE,MAAMp6D,SAAS,iBACpB1U,EAAK6uE,QAAQxtE,OAAOnE,EAAE,QAAQwX,SAAS,WAEpChd,MAIX03E,eAAgB,SAASh5E,GACrB,GAAI4J,GAAOtI,IAQX,OAPAtB,GAAUd,EAAEC,SAASa,OACjBgL,MAAO,GACPY,IAAK,GACL2U,OAAQ,UACR83D,eAAe,IAEnBr4E,EAAQ4L,IAAMhC,EAAKkvE,WAAW94E,EAAQ4L,KAC/B9E,EAAE,SAASmE,OACdnE,EAAE,QACGU,KAAK,OAAQxH,EAAQ4L,KACrBpE,KAAK,SAAUxH,EAAQugB,QACvBG,KAAK1gB,EAAQgL,OACbhJ,GAAG,QAAS,SAAAse,GACTA,EAAE8H,iBACFxe,EAAKpH,MAAMU,IAAI,aAAa,GACxBlD,EAAQqoB,QACRroB,EAAQqoB,UAER7d,OAAOoV,MAAM7U,IAAI/K,OAOrCi5E,aAAc,SAAS34D,GACnB,GAAI1W,GAAOtI,KACPkB,EAAQlB,KAAKkB,KAMjB,IALA8d,EAAE8H,iBACFthB,EAAE,YAAY8B,OACdpG,EAAMC,QAAQ,WAAY,SAAAuf,GACtBxf,EAAMhB,KAAOwgB,EAAExgB,IAAMwgB,EAAE5hB,IAAI,SAAW4hB,EAAE9e,IAAI,aAAa,KAExDV,EAAMpC,IAAI,YAMR,IACM84E,GAAT,SAAmBjiE,EAAOrL,GACtB,MAAO9E,GAAE,UACJmE,OACGnE,EAAE,QACGU,KAAK,OAAQgD,OAAOC,KAAOmB,GAC3B8U,KAAKzJ,IAEbyJ,OAETpf,MAAKm3E,QAAQU,SAAW73E,KAAKm3E,QAAQU,QAAQ,WAC7C73E,KAAKm3E,QACAU,SACGz4D,MAAM,EACNwL,UAAW,SACXsB,kBAAmB0rD,EAAU,QAAS,8BAAtC,OAA0EA,EACtE,WACA,+BAFJ,0BAKHC,QAAQ,QACbhgE,WAAW,WACPvP,EAAK6uE,QAAQU,QAAQ,YACtB,SA5BE32E,GAAMpC,IAAI,QAGXoC,EAAMU,IAAI,aAAa,GAFvBV,EAAMpC,IAAI,WAAaoC,EAAMpC,IAAI,aAAeoK,OAAOoV,MAAM7U,IAAIvI,EAAMmE,aAgCnFmyE,WAAY,SAASltE,GACjB,MAAqB,gBAAPA,KAA0C,IAAvBA,EAAInI,QAAQ,OAAiC,KAAjBmI,EAAIwtE,OAAO,GAAY5uE,OAAOC,KAAOmB,EAAMA,GAI5G8pB,UAAW,WACP,MACI,kJ9B+7kBZh4B,GAAQM,S8Bn7kBJyY,WAAYA,EACZ8/D,IAAKA,K9Bs7kBoBh4E,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,GAE/C1I,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G+B74lBX,IAAA6a,GAAAxd,EAAA,G/Bk5lBIugC,EAEJ,SAAgCpgC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFhDqd,G+Bj5lBnC+7D,EAAiBz2E,EAASqK,KAAK3J,QAC/BC,WAAY,WACRE,KAAK4J,MAAQ,MAIjBmuE,gBAAiB,SAAS/4D,GAEtB,GAAIg5D,GAAOr3E,OAAOuI,OAAOoiB,OAAO2sD,0BAE5BC,EAAOv3E,OAAOuI,OAAOoiB,OAAO6sD,0BAC5B5F,EAAWpuC,OAAOxjC,OAAOuI,OAAOksE,KAAK/vE,WAAWktE,UAEhD6F,EAAiCj0C,OAAOxjC,OAAOuI,OAAOoiB,OAAO8sD,gCAE7DC,eAA4B9F,EAA5B,mCAAuE6F,EAEvEpsE,EAASgsE,EAAT,IAAiBE,EAAOG,EACxBC,EAAwB,KACxBC,EAAsB,KAEtBC,gEAAgFxsE,EAAhF,cA2DJ,OA/CIxG,GAAE,eAAe3E,OAAS,GAC1B2E,EAAE,eAAe6f,SAGrBuwD,EAAehsE,MAAQ,GAAIgzB,GAAAlgC,QAAM8M,MAC7BK,KAAM2uE,EACN/8D,OAXe,IAYf/P,MAXc,IAYd5B,gBAAgB,EAChB2uE,iBAAiB,EACjB35C,IAbc,wBAiBlB82C,EAAehsE,MAAMvC,OACrBixE,EAAwB9yE,EAAE,6BAC1B+yE,EAAsB/yE,EAAE,2BAExB8yE,EAAsBt7D,SAAS,qBAC/Bu7D,EAAoBv7D,SAAS,qBAC7Bs7D,EAAsBxxE,KAAK,MAAMue,SACjCizD,EAAsBI,WAAW,6BACjCJ,EAAsB3uE,OA/BlB,uPAiCJnE,EAAE,gBAAgBsa,MAAM,SAAAd,GACpBxZ,EAAE,eAAeiY,IAAI,UAAW,UAGpCjY,EAAE,0BAA0Bsa,MAAM,SAAAd,GAC1BxZ,EAAE,0BAA0B+oB,SAAS,cACrC/oB,EAAE,6BAA6BkG,MAAM,UACrClG,EAAE,2BAA2BiW,OAAO,SACpCjW,EAAE,0BACG0b,YAAY,aACZlE,SAAS,eACdxX,EAAE,0BAA0BU,KAAK,QAAS,YAC1CV,EAAE,0BAA0BiY,IAAI,cAAe,WAE/CjY,EAAE,6BAA6BkG,MAASitE,SACxCnzE,EAAE,2BAA2BiW,OAAUm9D,SACvCpzE,EAAE,0BACG0b,YAAY,eACZlE,SAAS,aACdxX,EAAE,0BAA0BU,KAAK,QAAS,YAC1CV,EAAE,0BAA0BiY,IAAI,cAAe,YAGhDzd,MAIXgc,OAAQ,WACJ,GAAI1T,GAAOtI,IASX,QANIE,GAAI,mBACJ8rB,KAAM,eACNvK,QAAS,cACTiJ,SAAS,EACT3D,QAASze,EAAKyvE,mB/Bm5lB1B37E,GAAQM,S+B54lBJk5E,eAAgBA,K/B+4lBS34E,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GA0BlD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAxBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GgC7/lBX,IAAA8a,GAAAzd,EAAA,IhCkgmBIw8E,EAAat8E,EAAuBud,GgCjgmBxCpS,EAAArL,EAAA,IhCqgmBIsL,EAASpL,EAAuBmL,GgCpgmBpC+9B,EAAAppC,EAAA,GhCwgmBIqpC,EAAkBnpC,EAAuBkpC,GgCvgmB7CqzC,EAAAz8E,EAAA,IhC2gmBI08E,EAAcx8E,EAAuBu8E,GgC1gmBzCx5E,EAAAjD,EAAA,GhC8gmBIkD,EAAiBhD,EAAuB+C,EAI5ClD,GAAQM,QgCjhmBOyC,EAASqK,KAAK3J,QACzBC,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXtB,GAAUA,MACVsB,KAAKg5E,OAAS,GAAIH,GAAAn8E,QAAO8M,MAAOkhB,SAAS,IACzC1qB,KAAK4e,WAAW5e,KAAKg5E,OAAOz0E,KAC5BvE,KAAKi5E,aAAev6E,EAAQoiB,WAAWrX,KACnCvJ,GAAI,qBACJ8rB,KAAM,QACNvK,SAAS,EAAAliB,EAAA7C,SAAG,8BACZqqB,QAAS,WACLze,EAAK4wE,QAAU5wE,EAAK4wE,OACpB5wE,EAAK2wE,aAAar3E,KACd6C,OAAQ6D,EAAK4wE,OACbC,UAAW7wE,EAAK4wE,OAChBE,SAAU9wE,EAAK4wE,QAAU,iBAE5B5wE,EAAK4wE,QAAU5wE,EAAK0wE,OAAO1xE,QAEhC+xE,eAAgB,WACZ,GAAI/wE,EAAK0wE,OAAOn4E,SAAW,EACvB,oBAAqByH,EAAK0wE,OAAOn4E,SAAjC,mCAIZb,KAAKs5E,WAAa56E,EAAQoiB,WAAWrX,KACjCvJ,GAAI,mBACJ8rB,KAAM,SACNvK,SAAS,EAAAliB,EAAA7C,SAAG,yBACZy8E,WAAW,EACXzuD,SAAS,EACT3D,QAAS,SAAS/H,GACd1W,EAAK0wE,OAAOtuD,QAAUpiB,EAAK0wE,OAAO1xE,OAASgB,EAAK0wE,OAAO3xE,UAG/DrH,KAAKg5E,OACAt4E,GAAG,aAAc,WACdV,KAAK0qB,SAA4B,GAAjB1qB,KAAKa,UAAiBb,KAAKsH,OAC3CgB,EAAKgxE,WAAW13E,KACZyT,KAAMrV,KAAKa,SACX6pB,QAAS1qB,KAAKa,SAAW,MAGhCH,GAAG,aAAc,WACd4H,EAAKgxE,WAAW13E,KACZ6C,OAAQzE,KAAK0qB,QACbsB,KAAOhsB,KAAK0qB,SAAW,UAAa,mBAGhD1qB,KAAKu5E,kBAITC,WAAY,SAASt7D,GACjB,GAAI5V,GAAOtI,KACPy5E,EAAkB,IACtB,IAAIvwE,QAAUA,OAAOkb,iBAAkB,CACnC,GAAIs1D,GAAaxwE,OAAOkb,iBAAiBtD,WAAW64D,SACpD35E,MAAKu5E,cAAcG,IACf/pE,KAAMzG,OAAOkb,iBAAiBljB,MAAMpC,IAAI,QACxC86E,gBAEJ1wE,OAAOkb,iBAAiBtD,WAAWvY,KAAK,SAAArH,IACnCA,EAAMpC,IAAI,YACPoC,EAAMpC,IAAI,YACVwJ,EAAKixE,cAAcG,GAAYE,YAAY1sE,KAAKhM,EAAMpC,IAAI,SAGtE,GAAI+6E,GAAe,SAACvsE,EAASqN,GACzB,GAAIrN,EAAS,CACT,GAAIwsE,GAAkBxxE,EAAKixE,cAAcjsE,EAAQxO,IAAI,cACrD,IAAIg7E,GAAmBA,EAAgBF,YAAa,CAChD,GAAIG,GAAeD,EAAgBF,YAC/BhlB,EAAMmlB,EAAa53E,QAAQmL,EAAQxO,IAAI,MAC3C,KAAa,IAAT81D,GAAcA,EAAMj6C,GAAU,GAAKi6C,EAAMj6C,EAASo/D,EAAal5E,OAC/D,MAAOk5E,GAAanlB,EAAMj6C,MAKtCq/D,EAAqB,SAAC1sE,EAASqN,EAAQ2D,GACvC,GAAI27D,GAAiBJ,EAAavsE,EAASqN,EACvCs/D,GACA3xE,EAAK4xE,aAAaD,EAAgB,SAACE,EAAa7uD,GAC5CmuD,EAAkBU,EAClB77D,EAAMpd,MAAMU,IAAI0pB,KAGpBhN,EAAMpd,MAAMC,QAAQ,UAG5BnB,MAAKk6E,aAAah8D,EAAY,SAAC5Q,EAASge,GACpCmuD,EAAkBnsE,EAClBhF,EAAKmB,IACD7L,EAAEiC,QAEMisB,OAEQE,KAAM,4BACNvK,QAAS,sBACTsF,QAAS,SAASzI,GACd07D,EAAmBP,GAAkB,EAAGn7D,IAE5C2N,SAAU,WACN,OAAQ4tD,EAAaJ,GAAkB,MAI3CztD,KAAM,6BACNvK,QAAS,kBACTsF,QAAS,SAASzI,GACd07D,EAAmBP,EAAiB,EAAGn7D,IAE3C2N,SAAU,WACN,OAAQ4tD,EAAaJ,EAAiB,OAKtDnuD,OAMhB4uD,aAAc,SAASh8D,EAAY2D,GAC/B,GAAIvZ,GAAOtI,KACPsN,EAAU,GAAI3F,GAAAjL,QAAK8Y,SAAUtV,GAAIge,GACrC1Y,GAAEoF,KAAK0C,EAAQ2c,SAASpf,KAAK,WACzB,GAAIuvE,GAAax8E,EAAEkJ,MACd,UAAW,YACZ,SAAA2D,GAAA,OAA8D,IAAjD6C,EAAQxO,IAAI,aAAaqD,QAAQsI,KAE9Cf,EAAQ4D,EAAQxO,IAAI,QACpBg7E,EAAkBxxE,EAAKixE,cAAcjsE,EAAQxO,IAAI,cACjDg7E,KACApwE,EAAWowE,EAAgBnqE,KAA3B,KAAoCjG,GAExCmY,EACIvU,EACA8sE,GAEU1wE,MAAOA,EACPY,IAAK,KACL4hB,QAASvkB,EAAAjL,QAAKsjB,iCACV9e,MAAO,GAAIyG,GAAAjL,QAAK8d,eAAelN,EAAQ3L,UACvC0H,UAAU,EACVoS,OAAQ,SACTlX,MAGHmF,MAAOA,EACPY,IAAQpB,OAAOC,KAAf,YAA+B+U,EAA/B,yBACAgO,QAAS,UAO/BmuD,aAAc,SAASC,GACnB,GAAIhyE,GAAOtI,KACPu6E,EAAM,GAAI70C,GAAAhpC,QAAc2Z,eAAgBnW,GAAIo6E,GAChD90E,GAAEoF,KAAK2vE,EAAItwD,SAASpf,KAAK,WACrB,GAAIg7B,GAAK,GAAIkzC,GAAAr8E,QAAUqpC,YAAY78B,OAAOC,MAGtCqxE,GACA9wE,MAAO6wE,EAAIz7E,IAAI,QACf8W,KAAM,QACNsW,QAAS,SAAShM,GAEd,GAAImoB,IACAxnB,UAAWX,EACXvQ,KAAM4qE,EAAIz7E,IAAI,SACdoB,GAAIq6E,EAAIr6E,GAERmT,MAAOknE,EAAIz7E,IAAI,SACfozC,aAAa,GAGbuoC,EAAkBF,EAAIz7E,IAAI,mBAC1B0X,EAAYikE,EAAgBnvD,OAAOjtB,KAAKmY,SAG5C5Y,GAAE2K,KAAKiO,EAAW,SAAAL,GACdA,EAAE7I,SACE5C,SAAUyL,EAAEzL,SACZxK,GAAIiW,EAAE+H,cAGd7f,KAAOwnC,EAAGuC,qBACNC,EACAoyC,EAAgBnvD,OAAO5U,SACvB+jE,EAAgBnvD,OAAOjtB,KAAKmY,UAC5BikE,EAAgBnvD,OAAO7U,WACvB,IAIZnO,GAAKmB,IAAI+wE,MAKjB/wE,IAAK,SAAS/K,GACV,GAAsB,UAAlBA,EAAQugB,OACRte,OAAOo4B,KAAKr6B,EAAQ4L,SACjB,IAAsB,QAAlB5L,EAAQugB,QAAsC,WAAlBvgB,EAAQugB,QAAyC,SAAlBvgB,EAAQugB,OAC1Ete,OAAOqoB,SAAWtqB,EAAQ4L,QACvB,KAAKtK,KAAKk5E,QAAUx6E,EAAQq4E,cAAe,CAC9C,GAAI2D,GAAel1E,EAAE7E,OAAO0d,OAAOiD,UAAUxa,KAAK,eAC5B,gBAAlBpI,EAAQugB,QAA6C,UAAlBvgB,EAAQugB,OACf,IAAxBy7D,EAAa75E,OACbF,OAAOqoB,SAActqB,EAAQ4L,MAAoC,GAA7B5L,EAAQ4L,IAAInI,QAAQ,KAAa,IAAM,KAA3E,kBAEAu4E,EAAax0E,KAAK,MAAOxH,EAAQ4L,KAElC3J,OAAOqoB,SAAWtqB,EAAQ4L,QAEjCtK,MAAKg5E,OAAOvvE,IAAI/K,QhC6/lBCzB,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAGvG,CAEF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GAclD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAZvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GiC1umBX,IAAAi0E,GAAA52E,EAAA,GjC+umBI62E,EAAY32E,EAAuB02E,GiC9umBvC3zE,EAAAjD,EAAA,GjCkvmBIkD,EAAiBhD,EAAuB+C,GiCxumBxC61E,EAAiBh2E,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAQ8C,eAAeK,QAEzDH,cAVW,OAaXhB,SACIi8E,cAAe,GACfC,eAAgB,KAIpB96E,WAAY,SAASpB,GACjBsB,KAAKoK,IAAOpK,KAAZ,eAAgCtB,GAChCd,EAAEiC,OAAOG,KAAKtB,QAASA,GAGvBsB,KAAK6rB,SAAS7rB,KAAKkB,MAAO,+CAAgDlB,KAAKgc,SAInF2iB,OAAQ,SAASjgC,GAGb,MAFAsB,MAAKoK,IAAOpK,KAAZ,yBAA0CtB,GAC1CsB,KAAKkB,MAAM2yE,YAAY7zE,KAAKkB,MAAMpC,IAAI,MAAOJ,GACtCsB,MAMX66E,YAAa,WACT,MACwC,QAApC76E,KAAKkB,MAAMpC,IAAI,kBACfkB,KAAKkB,MAAMpC,IAAI,kBAAoBkB,KAAKtB,QAAQk8E,gBAYxDE,cAAe,WACX,GAAIC,GAAY/6E,KAAKkB,MAAMS,SAG3Bq5E,EAAUD,EAAUxH,cAGpB0H,EAASz1E,EAAExF,KAAKk7E,oBAAoBH,IAEhCI,EAAOF,EAAOn0E,KAAK,gBAwBvB,OApBI9G,MAAK66E,eAELM,EAAKj1E,KAAK,QAAS,oCACnB+0E,EAAOn0E,KAAK,qBAAqB2W,IAAI,QAAS,SAE9Czd,KAAKmB,QAAQ,aAAc45E,IAGpBC,GAAWh7E,KAAKtB,QAAQi8E,eAE/BQ,EAAKj1E,KAAK,QAAS,qCAEnBlG,KAAKmB,QAAQ,sCAAuC45E,KAIpDI,EAAKj1E,KAAK,QAAS,qCAEnBlG,KAAKmB,QAAQ,6BAA8B45E,IAExCE,GAOXG,cAAe,WAEX,GAAIC,GAAQ71E,EAAExF,KAAKs7E,eAAet7E,KAAKkB,MAAMS,UAE7C,OADA3B,MAAKoK,IAAOpK,KAAZ,oBAAqCq7E,GAC9BA,GAOXr/D,OAAQ,WAEJ,GAAIu/D,GAAY,IAgBhB,OAbAv7E,MAAKoK,IAAOpK,KAAZ,wBAAyCA,KAAKkB,MAAMpC,IAAI,kBAEpDy8E,EADoC,OAApCv7E,KAAKkB,MAAMpC,IAAI,sBAAiE0C,KAApCxB,KAAKkB,MAAMpC,IAAI,iBAC/CkB,KAAKo7E,gBAILp7E,KAAK86E,gBAKrB96E,KAAKuE,IAAI6a,KAAKm8D,GACdv7E,KAAKuE,IAAIuC,KAAK,qBAAqB2a,UAC5BzhB,MAGXk7E,oBAAqB,SAAS1wE,GAC1B,OACI,sDACA,2CACAA,EAAK+oE,cACL,YACA,uEACA/oE,EAAK8oE,sBAAL,iBACuB9oE,EAAK8oE,sBAD5B,oDAEM,KACN,EAAA/zE,EAAA7C,SAAG,SACH,IACA8N,EAAK+oE,cACL,IACA,SACA,UACFp1E,KAAK,KAGXm9E,eAAgB,SAAS9wE,GACrB,OACI,mFACA,yJACAA,EAAK8oE,uBAAwB,EAAA/zE,EAAA7C,SAAG,UAAY8N,EAAK8oE,sBAAwB,GACzE,SACA,UACFn1E,KAAK,KAGXqE,SAAU,WACN,wBAAyBxC,KAAKkB,MAA9B,MjCiumBZ9E,GAAQM,SiC1tmBJy4E,eAAgBA,KjC6tmBSl4E,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GAElD1I,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GkCx4mBX,IAAAyjB,GAAApmB,EAAA,GlC64mBIqmB,EAEJ,SAAgClmB,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFlDimB,GkC54mBjCjZ,EAAOrK,EAASqK,KAAK3J,QACrB27E,gBACIC,YAAY,EACZ/xE,MAAO,KACPkhB,UAAW,MACX/J,UAAW,OACXhX,KAAM,MAGV/J,WAAY,SAASpB,GACjBsB,KAAK4e,WAAW5e,KAAKo0B,aACrBp0B,KAAK07E,IAAMh5D,EAAAhmB,QAAMg/E,MACjB17E,KAAKtB,QAAUd,EAAEC,SAASa,MAAesB,KAAKw7E,gBAC9Cx7E,KAAKtB,QAAQmiB,UAAUxC,SAAS1U,OAAO3J,KAAK+d,IAC5C/d,KAAK2rB,OAAS3rB,KAAKwF,EAAE,wBACrBxF,KAAK27E,OAAS37E,KAAKwF,EAAE,kBACrBxF,KAAK47E,MAAQ57E,KAAKwF,EAAE,oBAGpBxF,KAAKtB,QAAQmL,MAAQ7J,KAAK2J,OAAO3J,KAAKtB,QAAQmL,KAG9C,IAAIvB,GAAOtI,IACXwF,GAAE,QAAQ9E,GAAV,aAA0BV,KAAK07E,IAAO,SAAA18D,GAGlC1W,EAAKoiB,UACAllB,EAAE8C,EAAK5J,QAAQmiB,WAAWjc,GAAGoa,EAAEC,UAC/BzZ,EAAE8C,EAAKyV,IAAInZ,GAAGoa,EAAEC,SACmB,IAApCzZ,EAAE8C,EAAKyV,IAAI4U,IAAI3T,EAAEC,QAAQpe,QACzByH,EAAKhB,UAOjB0U,OAAQ,WACJhc,KAAK2rB,OAAOvM,KAAKpf,KAAKtB,QAAQgL,OAC9B1J,KAAKuE,IACA2c,cACAlE,SAAS,8BACTA,SAAShd,KAAKtB,QAAQksB,WAC3B5qB,KAAKuE,IAAIkZ,IAAIzd,KAAK67E,eAAe77E,KAAKtB,QAAQksB,WAG9C,IAAItiB,GAAOtI,IACPA,MAAKtB,QAAQ+8E,WACbz7E,KAAK27E,OACAj7E,GAAG,QAAS,WACT4H,EAAKhB,SAERD,OAELrH,KAAK27E,OAAO97D,MAAMvY,QAQ1BoC,MAAO,SAASoyE,OACKt6E,KAAbs6E,IACA97E,KAAKtB,QAAQgL,MAAQoyE,EACrB97E,KAAK2rB,OAAOvM,KAAK08D,KAOzBz0E,KAAM,WACFrH,KAAKgc,SACLhc,KAAKuE,IAAI8C,OACTrH,KAAK0qB,SAAU,GAMnBpjB,KAAM,WACFtH,KAAKuE,IAAI+C,OACTtH,KAAK0qB,SAAU,GAOnB/gB,OAAQ,SAASpF,GACbvE,KAAK47E,MAAMjyE,OAAOpF,IAMtByjB,MAAO,WACHhoB,KAAK47E,MAAM5zD,SAMf3C,OAAQ,WACJ7f,EAAE,QAAQqa,IAAV,aAA2B7f,KAAK07E,KAChC17E,KAAKuE,IAAI8gB,UAMbw2D,eAAgB,SAASjxD,GAErB,GAUIhL,GAEAD,EAZAjU,EAAQ1L,KAAK+7E,WAAW/7E,KAAKuE,KAC7BkX,EAASzb,KAAKuE,IAAIkX,SAGlBugE,EAAah8E,KAAKtB,QAAQmiB,UAC1Bo7D,EAAkBj8E,KAAK+7E,WAAWC,GAClCE,EAAmBl8E,KAAKm8E,YAAYH,GACpCI,EAAqBJ,EAAWp+D,UAOpC,IADAgC,EAAMD,EAAO,GACgC,IAAxC,MAAO,UAAUxd,QAAQyoB,GAE1B,OADAjL,EAAOy8D,EAAmBz8D,KAAOjU,GAASuwE,EAAkBvwE,GAAS,EAC7Dkf,GACJ,IAAK,MACDhL,EAAMw8D,EAAmBx8D,IAAMnE,EAAS,CACxC,MACJ,KAAK,SACDmE,EAAMw8D,EAAmBx8D,IAAMs8D,EAAmB,MAK1D,QADAt8D,EAAMw8D,EAAmBx8D,IAAMnE,GAAUygE,EAAmBzgE,GAAU,EAC9DmP,GACJ,IAAK,QACDjL,EAAOy8D,EAAmBz8D,KAAOs8D,EAI7C,OAASr8D,IAAKA,EAAKD,KAAMA,IAM7Bo8D,WAAY,SAASx3E,GACjB,MACIA,GAAImH,QACJoI,SAASvP,EAAIkZ,IAAI,iBACjB3J,SAASvP,EAAIkZ,IAAI,gBACjB3J,SAASvP,EAAIkZ,IAAI,kBACjB3J,SAASvP,EAAIkZ,IAAI,kBAOzB0+D,YAAa,SAAS53E,GAClB,MAAOA,GAAIkX,SAAW3H,SAASvP,EAAIkZ,IAAI,gBAAkB3J,SAASvP,EAAIkZ,IAAI,oBAM9E2W,UAAW,SAAS11B,GAChB,MACI,uNlCq4mBZtC,GAAQM,SkCx3mBJ8M,KAAMA,KlC23mBmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,YAGAS,QAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GmChknBX,IAAIq9E,IAGAC,OAAQ,SAERC,OAAQ,SAERC,QAAS,UAETC,iBAAkB,mBAIlBC,IAAK,MAELC,MAAO,QAEPn6D,GAAI,KAGJo6D,OAAQ,SAERC,gBAAiB,kBAGjBC,aAAc,eAEdC,UAAW,YAEXC,MAAO,QAGXX,GAAOY,cACHZ,EAAO75D,GACP65D,EAAOM,MACPN,EAAOO,OACPP,EAAOQ,gBACPR,EAAOS,aACPT,EAAOU,UACPV,EAAOW,OAGXX,EAAOa,kBAAoBb,EAAOC,OAAQD,EAAOE,OAAQF,EAAOG,QAASH,EAAOI,iBAAkBJ,EAAOK,KnCiknBzGtgF,EAAQM,QmC9jnBO2/E,GnCiknBP,CACA,CACA,CACA,CACA,CACA,CACA,CAEF,SAAUlgF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,GAE/Cd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GoC/nnBX,IAAAyjB,GAAApmB,EAAA,GpCoonBIqmB,EAEJ,SAAgClmB,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFlDimB,GoC7nnBjCjZ,EAAOrK,EAASqK,KAAK3J,QAErB27E,gBACI/9D,IAAK,GACL0/D,YAAa,oBACb3yE,QACAxL,MAAO,KACPo+E,UAAU,EACVC,mBAAoB,EAEpBC,YAAa,IAIjBx9E,WAAY,SAASpB,GAQjB,GANAsB,KAAKtB,QAAUgkB,EAAAhmB,QAAMwgC,MAAMx+B,EAASsB,KAAKw7E,gBAGzCx7E,KAAK4e,WAAW5e,KAAKo0B,UAAUp0B,KAAKtB,WAG/BsB,KAAKtB,QAAQmiB,UAEd,WADA1W,SAAQC,IAAI,qDAahB,IARApK,KAAKtB,QAAQmiB,UAAUlX,OAAO3J,KAAKuE,KAGnCvE,KAAKu9E,YAAcv9E,KAAKtB,QAAQ8L,KAGhCxK,KAAKw9E,YAEAx9E,KAAKtB,QAAQ0+E,SAAU,CAEpBp9E,KAAKtB,QAAQM,OACbgB,KAAKy9E,UAAUz9E,KAAKtB,QAAQM,MAIhC,IAAIsJ,GAAOtI,IACPA,MAAKtB,QAAQy1B,UACbn0B,KAAKuE,IAAI7D,GAAG,SAAU,WAClB4H,EAAK5J,QAAQy1B,SAAS7rB,EAAKtJ,aAO3CA,MAAO,SAAS4oB,GAEZ,GAAI81D,GAAS19E,KAAK29E,gBAGAn8E,KAAdomB,GACA5nB,KAAKy9E,UAAU71D,EAInB,IAAI0oB,GAAQtwC,KAAK29E,WAQjB,OALIrtC,IAASotC,GAAU19E,KAAKtB,QAAQy1B,UAChCn0B,KAAKtB,QAAQy1B,SAASmc,GAInBA,GAIXxzB,KAAM,WACF,MAAO9c,MAAKuE,IAAIkmC,QAAQ,QAAQ3tB,MAIpCmP,SAAU,WACN,OAAQjsB,KAAKuE,IAAIkmC,QAAQ,WAI7BtL,OAAQ,WACJn/B,KAAKuE,IAAIkmC,QAAQ,UAAU,IAI/BxL,QAAS,WACLj/B,KAAKuE,IAAIkmC,QAAQ,UAAU,IAI/BhhC,IAAK,SAAS/K,GAEVsB,KAAKu9E,YAAYrwE,MACbhN,GAAIxB,EAAQwB,GACZ4c,KAAMpe,EAAQoe,OAIlB9c,KAAKw9E,YAIThwD,IAAK,SAASttB,GAEV,GAAI0M,GAAQ5M,KAAK49E,UAAU19E,IAGb,GAAV0M,IAEA5M,KAAKu9E,YAAYzwE,OAAOF,EAAO,GAG/B5M,KAAKw9E,aAKbn4D,OAAQ,WACJrlB,KAAKuE,IAAIkmC,QAAQ,YAIrB9L,OAAQ,SAASjgC,GAEbsB,KAAKu9E,cACL,KAAK,GAAI1gF,KAAO6B,GAAQ8L,KACpBxK,KAAKu9E,YAAYrwE,KAAKxO,EAAQ8L,KAAK3N,GAIvCmD,MAAKw9E,YAITA,SAAU,WAEN,GAAKx9E,KAAKtB,QAAQ0+E,SAWX,CACH,GAAIS,IACAT,SAAUp9E,KAAKtB,QAAQ0+E,SACvBU,kBAAmB99E,KAAKtB,QAAQ+e,IAChC0/D,YAAan9E,KAAKtB,QAAQy+E,YAC1BE,mBAAoBr9E,KAAKtB,QAAQ2+E,mBACjChzE,KAAMrK,KAAKtB,QAAQ2L,KACnB0zE,iBAAkB/9E,KAAKtB,QAAQq/E,iBAC/BC,aAAch+E,KAAKtB,QAAQs/E,aAC3BC,aAAcj+E,KAAKtB,QAAQu/E,aAC3BC,gBAAiBl+E,KAAKtB,QAAQw/E,gBAC9BC,cAAen+E,KAAKtB,QAAQy/E,cAC5Bb,YAAat9E,KAAKtB,QAAQ4+E,YAE9Bt9E,MAAKuE,IAAIkmC,QAAQozC,OAzBO,CACxB,GAAIl3E,GAAW3G,KAAK29E,YAChBE,GACArzE,KAAMxK,KAAKu9E,YACXO,kBAAmB99E,KAAKtB,QAAQ+e,IAChC0/D,YAAan9E,KAAKtB,QAAQy+E,YAC1BiB,mBAAmB,EAEvBp+E,MAAKuE,IAAIkmC,QAAQozC,GAEjB79E,KAAKy9E,UAAU92E,KAoBvBi3E,UAAW,SAAS5+E,GAEhBpB,EAAEygF,UAAUr+E,KAAKu9E,aAAer9E,GAAIlB,KAIxC2+E,UAAW,WACP,MAAO39E,MAAKuE,IAAIkmC,QAAQ,QAI5BgzC,UAAW,SAAS71D,IAEF,GADF5nB,KAAK49E,UAAUh2D,IAEnB5nB,KAAKu9E,YAAY18E,OAAS,IAC1B+mB,EAAY5nB,KAAKu9E,YAAY,GAAGr9E,IAGxCF,KAAKuE,IAAIkmC,QAAQ,MAAO7iB,IAI5BwM,UAAW,SAAS11B,GAChB,qCAAsCsB,KAAKtB,QAAQ4+E,YAAnD,QpC0onBRlhF,GAAQM,SoCronBJ8M,KAAMA,KpCwonBmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAErCd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GqCj2nBX,IAAAs/E,GAAAjiF,EAAA,GrCs2nBIkiF,EAEJ,SAAgC/hF,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFjD8hF,GqCn2nBlC94E,YAaAg5E,EAAe,SAAA9/E,GACfA,EAAUA,MACVA,EAAQ+/E,cAAgB//E,EAAQ+/E,gBAC5B7zD,UAAW,UAGflsB,EAAQggF,SAAW,YAAYttE,OAAO1S,EAAQggF,aAC1ChgF,EAAQutB,UACRvtB,EAAQggF,QAAQxxE,KAAK,WAGzB,IAAIkS,IACA,aACA1gB,EAAQggF,QAAQvgF,KAAK,KACrB,IACAO,EAAQgL,MAAR,WAA2BhL,EAAQgL,MAAnC,IAA8C,IAC7ChL,EAAQutB,UAAYvtB,EAAQugB,OAA7B,YAAkDvgB,EAAQugB,OAA1D,IAAsE,GACtE,WACCvgB,EAAQutB,UAAYvtB,EAAQsnB,KAAOtnB,EAAQsnB,KAAO,sBACnD,KAEA,mBACAtnB,EAAQigF,OACR,YACA,QACFxgF,KAAK,IACHyzB,EAAUpsB,EAAE4Z,GAAMqC,QAAQ/iB,EAAQ+/E,cAItC,OAHI7gF,GAAEoH,WAAWtG,EAAQqoB,UACrB6K,EAAQ9R,MAAMphB,EAAQqoB,SAEnB6K,ErCi2nBXx1B,GAAQM,QqC71nBO8hF,IrC81nBcvhF,KAAKb,EAASC,EAAoB,KAGvD,CAEF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASmJ,GAkCrC,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAEvF,QAASG,GAAwBH,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAII,KAAa,IAAW,MAAPJ,EAAe,IAAK,GAAIK,KAAOL,GAAWM,OAAOC,UAAUC,eAAeC,KAAKT,EAAKK,KAAMD,EAAOC,GAAOL,EAAIK,GAAgC,OAAtBD,GAAOF,QAAUF,EAAYI,EsC36nBlQ,QAASguC,GAAUlsC,EAASkgF,GAExB,MADW5+E,MACC6+E,MAAMngF,MAAekgF,OtCu4nBrC9hF,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GsC35nBX,IAAAC,GAAA5C,EAAA,GAAYuB,EtCg6nBJjB,EAAwBsC,GsC/5nBhCC,EAAA7C,EAAA,GAAY8C,EtCm6nBGxC,EAAwBuC,GsCl6nBvC+zE,EAAA52E,EAAA,GtCs6nBI62E,EAAY32E,EAAuB02E,GsCr6nBvC6L,EAAAziF,EAAA,ItCy6nBI0iF,EAAcxiF,EAAuBuiF,GsCx6nBzCE,EAAA3iF,EAAA,ItC46nBI4iF,EAAkB1iF,EAAuByiF,GsC36nB7C5/E,EAAA/C,EAAA,ItC+6nBIgD,EAAe9C,EAAuB6C,GsC96nB1CE,EAAAjD,EAAA,GtCk7nBIkD,EAAiBhD,EAAuB+C,IsCj6nB5C,EAAAD,EAAA3C,SAAWkuC,EAAW,YAGtB,IAEIs0C,GAAmBC,0BAGnBC,GAAiB,CACrB,KACIA,EAAwD,QAAvCC,aAAah9E,QAPd,gBAQlB,MAAOi9E,GACLn1E,QAAQC,KAAI,EAAA7K,EAAA7C,SAAS,wDAIzBkuC,EAAU7tC,UAAU8hF,MAAQ,SAAgBngF,EAASkgF,GACjD,GAAIt2E,GAAOtI,IAmCX,OAlCApC,GAAEiC,OAAOyI,EAAMnJ,EAASogF,QACpBH,IACA92E,EAAK7I,OAAS0K,QACdA,QAAQyzB,MAAM,oBAAqB,WAAYl/B,EAAS,gBAAiBkgF,IAG7Et2E,EAAKk3E,gBAAgB9gF,GAGrB4J,EAAKa,KAAOzK,EAAQyK,MAAQ,IAC5Bb,EAAK2G,OAASvQ,EAAQuQ,WACtB3G,EAAKuuE,mBAAqBn4E,EAAQm4E,oBAAsB,KAExDvuE,EAAKm3E,YAAY/gF,EAAQ4sB,YACzBhjB,EAAKo3E,aAAa/+E,OAAOuI,QAEzBZ,EAAKq3E,YAAYr3E,EAAK5J,QAAQkhF,mBAE9Bt3E,EAAKs1B,MAAM,sBAAuBt1B,EAAK5J,SACvC4J,EAAKs1B,MAAM,qBAAsBt1B,EAAKgjB,QACtChjB,EAAKs1B,MAAM,qBAAsBt1B,EAAK7I,QAEtC6I,EAAKu3E,cACLv3E,EAAKs1B,MAAM,uBAAwBt1B,EAAKw3E,UAExCx3E,EAAKgjB,OAAS5sB,EAAQ4sB,WACtBhjB,EAAKs1B,MAAM,qBAAsBt1B,EAAKgjB,QAEtChjB,EAAKy3E,UAAUrhF,EAAQ02E,UACvB9sE,EAAKs1B,MAAM,mBAAoBt1B,EAAK8sE,MAEpC9sE,EAAK03E,kBACL13E,EAAKnH,QAAQ,QAASmH,GAEfA,GAIXsiC,EAAU7tC,UAAUovB,gBAEhB8zD,eAAe,EAEf92E,KAAM,IACN0tE,mBAAoB,MAIxBjsC,EAAU7tC,UAAUyiF,gBAAkB,SAAyB9gF,GAC3D,GAAI4J,GAAOtI,KACPnC,EAAWyK,EAAK6jB,cAEpB7jB,GAAK5J,UACL,KAAK,GAAIgK,KAAK7K,GACNA,EAASb,eAAe0L,KACxBJ,EAAK5J,QAAQgK,GAAKhK,EAAQ1B,eAAe0L,GAAKhK,EAAQgK,GAAK7K,EAAS6K,GAG5E,OAAOJ,IAIXsiC,EAAU7tC,UAAU0iF,YAAc,SAAqBn0D,GACnD,GAAIhjB,GAAOtI,IAMX,OALAsI,GAAKgjB,OAASA,EAGdhjB,EAAKgjB,OAAOsS,MAAQwhD,GAAkB92E,EAAKgjB,OAAOsS,MAE3Ct1B,GAIXsiC,EAAU7tC,UAAU2iF,aAAe,SAAsBQ,GACrD,GAAI53E,GAAOtI,IAEX,IAAIsI,EAAK5J,QAAQuhF,eAAiBC,EAI9B,IAAK,GAAIx3E,KAAKw3E,GACNA,EAAUljF,eAAe0L,KAEzBJ,EAAKI,GAAKw3E,EAAUx3E,KAOpCkiC,EAAU7tC,UAAU4iF,YAAc,SAAqBC,GACnD,GAAIt3E,GAAOtI,IAGX,IAAIsI,EAAKgjB,OAAOsS,MAAO,CACnBgiD,EAAcO,cAAgBP,EAAcO,eAAiBh2E,QAC7Dy1E,EAAcQ,aAAeR,EAAcQ,cAAgBnB,EAAAviF,QAAc2jF,cAAcC,GAEvF,KACIV,EAAcW,0BAA4BlB,aAAah9E,QAAQ68E,GAAev7E,MAAM,KACtF,MAAO27E,IACT,IACIM,EAAcY,uBAA2E,QAAlDnB,aAAah9E,QAjH9B88E,wBAkHxB,MAAOG,IACTn1E,QAAQC,IAAIw1E,EAAcY,wBAe9B,MAZAl4E,GAAK7I,OAAS,GAAIw/E,GAAAviF,QAAc2jF,cAAcT,GAC9Ct3E,EAAKmtB,SACJ,MAAO,QAAS,OAAQ,OAAQ,QAAS,UAAU1qB,IAAI,SAAA2E,GACpDpH,EAAKmtB,KAAK/lB,GAAK,SAASlF,GACpBlC,EAAK7I,OAAOg2B,KAAK/lB,EAAGlS,UAAU,GAAIF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,OAI5E8K,EAAKgjB,OAAOsS,QAEZs1C,EAAAx2E,QAAS8C,cAAcC,OAAS6I,EAAK7I,QAElC6I,GAIXsiC,EAAU7tC,UAAU8iF,YAAc,SAAqBnhF,GACnD,GAAI4J,GAAOtI,IAMX,OALAsI,GAAKs1B,MAAM,eAAgBl/B,GAC3B4J,EAAKw3E,SAALvgF,EAAA7C,QAGAiE,OAAOpC,GAAK+J,EAAKw3E,SACVx3E,GAIXsiC,EAAU7tC,UAAUgjF,UAAY,SAAmBU,GAC/C,GAAIn4E,GAAOtI,IAIX,OAHAsI,GAAKs1B,MAAM,aAAc6iD,GACzBn4E,EAAK8sE,KAAO,GAAI2J,GAAAriF,QAAUy2E,KAAKsN,GAC/Bn4E,EAAK8sE,KAAK31E,OAAS6I,EAAK7I,OACjB6I,GAIXsiC,EAAU7tC,UAAUijF,gBAAkB,WAClC,GAAI13E,GAAOtI,IAiBX,OAbAsI,GAAKo4E,YACLl7E,EAAE8b,UAAUzb,KAAK,WAAY,SAACd,EAAImmC,EAAKxsC,GACnC,GAAI8L,GAAO9L,EAAQ8L,IACnB,KACIA,EAAO1I,KAAKM,MAAMoI,GACpB,MAAO1J,IAETwH,EAAKo4E,UACDp2E,IAAK0e,SAAShD,KAAKzoB,MAAM,GAAI,GAAKmB,EAAQ4L,IAC1CE,KAAMA,KAIPlC,GAIXsiC,EAAU7tC,UAAU4jF,UAAY,SAAoBrgE,GAChD,GAAIhY,GAAOtI,IACX,KACI,OAAgBwB,KAAZ8e,EACA,MAA+C,SAAxC++D,aAAah9E,QAvLZ,eAyLZ,IAAIie,EAEA,MADA++D,cAAax9E,QA1LL,gBA0L4B,IAC7B,CAGXw9E,cAAa/8E,WA9LD,gBAgMZgG,EAAKs4E,oBAAoB,MAC3B,MAAOtB,GACLn1E,QAAQC,KAAI,EAAA7K,EAAA7C,SAAS,wDAEzB,OAAO,GASXkuC,EAAU7tC,UAAU6jF,oBAAsB,SAA8BC,GACpE,GAAIv4E,GAAOtI,IACX,KACI,OAAmBwB,KAAfq/E,EAA0B,CAC1B,GAAIC,GAAMzB,aAAah9E,QAAQ68E,EAC/B,OAAsB,gBAAR4B,GAAmBA,EAAIn9E,MAAM,QACrB,OAAfk9E,EACPxB,aAAa/8E,WAAW48E,GAExBG,aAAax9E,QAAQq9E,EAAe2B,EAExC,IAAIE,GAAcz4E,EAAKs4E,qBAIvB,OAHIt4E,GAAK7I,SACL6I,EAAK7I,OAAOf,QAAQ6hF,0BAA4BQ,GAE7CA,EACT,MAAOzB,GACLn1E,QAAQC,KAAI,EAAA7K,EAAA7C,SAAS,+DAK7BkuC,EAAU7tC,UAAUyF,SAAW,WAE3B,oBADgBxC,KAAKo1E,KAAOp1E,KAAKo1E,KAAKt2E,IAAI,UAAY,cAAgB,iBACtE,KtC27nBJ1C,EAAQM,SsCt7nBJkuC,UAAWA,KtCy7nBc3tC,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASC,GuCvqoBrC,QAAS+jF,GAAc3hF,GACnBA,EAAUA,KACV,IAAI4J,GAAOtI,IAUX,OAPAsI,GAAK04E,OAASrgF,OAAOi+E,cAAgBj+E,OAAOi+E,aAAaxJ,KAAOz0E,OAAOi+E,aAAaxJ,KAAKl1E,GAAK,KAC9FoI,EAAK04E,OAAS14E,EAAK04E,QAAUtiF,EAAQsiF,QAAU,KAG/C14E,EAAK63E,cAAgBzhF,EAAQyhF,eAAiB,KAE9C73E,EAAKu2E,MAAMngF,GACJ4J,EAsPX,QAAS24E,GAAej2E,GACpB,GAAIk2E,GAAQ9iB,OAAOpzD,EAInB,OAHa,mBAATk2E,IACAA,EAAQp/E,KAAKC,UAAUiJ,IAEpBk2E,EAoFX,QAASC,GAAaziF,GAElB,MADWsB,MACC6+E,MAAMngF,OvC40nBtB5B,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GAGX,IAAIoiF,GAA4B,kBAAXC,SAAoD,gBAApBA,QAAOC,SAAwB,SAAU9kF,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAX6kF,SAAyB7kF,EAAIgM,cAAgB64E,QAAU7kF,IAAQ6kF,OAAOtkF,UAAY,eAAkBP,GuC5poBtQ6jF,GAAcC,IAAM,EACpBD,EAAckB,IAAM,EACpBlB,EAAcmB,MAAQ,GACtBnB,EAAcoB,KAAO,GACrBpB,EAAcqB,KAAO,GACrBrB,EAAcrD,MAAQ,GAItBqD,EAAcsB,OAAS,GACvBtB,EAAcuB,KAAO,IAGrBvB,EAAcl0D,gBAEV01D,SAAUxB,EAAcuB,KAExBxB,aAAcC,EAAcuB,KAE5BE,iBAAkB,SAIlBvB,0BAA2B,KAE3BC,wBAAwB,EAExBuB,aAAc,UAGdC,aAAc,IAEdC,SAAU,IAEVC,SAAS,EAETC,eAAgB,QAGhBC,QAAS,eAETC,cAAe,IAGfC,gBAAa9gF,GAEb+gF,qBAAkB/gF,IAKtB6+E,EAActjF,UAAU8hF,MAAQ,SAAengF,GAC3C,GAAI4J,GAAOtI,IACXsI,GAAK5J,UACL,KAAK,GAAIgK,KAAK23E,GAAcl0D,eACpBk0D,EAAcl0D,eAAenvB,eAAe0L,KAC5CJ,EAAK5J,QAAQgK,GAAKhK,EAAQ1B,eAAe0L,GAAKhK,EAAQgK,GAAK23E,EAAcl0D,eAAezjB,GAgBhG,OAbAJ,GAAK5J,QAAQmjF,SAAWv5E,EAAKk6E,YAAYl6E,EAAK5J,QAAQmjF,UACtDv5E,EAAK5J,QAAQ0hF,aAAe93E,EAAKk6E,YAAYl6E,EAAK5J,QAAQ0hF,cAI1D93E,EAAKm6E,UAAW,EAEhBn6E,EAAKo6E,SAAW,KAEhBp6E,EAAKq6E,UAAYr6E,EAAK5J,QAAQujF,SAE9B35E,EAAKs6E,aAEEt6E,GAIX+3E,EAActjF,UAAU6lF,WAAa,WACjC,IACI5iF,KAAK6iF,MAAQ,GAAI1B,IACb2B,QAAS9iF,KAAKtB,QAAQsjF,aACtBnlF,IAAKmD,KAAKtB,QAAQyjF,eAAiBniF,KAAKghF,SAE9C,MAAOlgF,GACLd,KAAK+iF,eAAe,OAAQ,iBAAkB,uCAAwCjiF,IACtFd,KAAKtB,QAAQmjF,SAAWxB,EAAcuB,OAK9CvB,EAActjF,UAAUylF,YAAc,SAAqB/+B,GACvD,GAAI7tC,OAAA,KAAc6tC,EAAd,YAAA29B,EAAc39B,EAClB,IAAa,WAAT7tC,EACA,MAAO6tC,EAEX,IAAa,WAAT7tC,EAAmB,CACnB,GAAIotE,GAAQv/B,EAAMw/B,aAClB,IAAI5C,EAAcrjF,eAAegmF,GAC7B,MAAO3C,GAAc2C,GAG7B,KAAM,IAAI7iF,OAAJ,sBAAgCsjD,IAK1C48B,EAActjF,UAAU04B,KAAO,SAAcguB,EAAOruB,EAAW8tD,GAE3D,GAAI56E,GAAOtI,IAEX,OADAo1B,GAAYA,GAAa9sB,EAAK5J,QAAQojF,iBACjCr+B,GAAUy/B,GAMfz/B,EAAQn7C,EAAKk6E,YAAY/+B,GACrBA,GAASn7C,EAAK5J,QAAQmjF,UACtBv5E,EAAK66E,YAAY1/B,EAAOruB,EAAW8tD,GAGnC56E,EAAK63E,eAAiB18B,GAASn7C,EAAK5J,QAAQ0hF,cAC5C93E,EAAKy6E,eAAet/B,EAAOruB,EAAW8tD,GAEnC56E,GAbIA,GAkBf+3E,EAActjF,UAAUomF,YAAc,SAAqB1/B,EAAOruB,EAAW8tD,GACzEljF,KAAK+iF,eAAe,QAAS,iBACzB,eACAvlF,UACAwC,KAAKtB,QAAQwjF,QACbliF,KAAK6iF,MAAMhiF,UAGf,IAAIyH,GAAOtI,IAEX,KACoBsI,EAAKu6E,MAAMp5E,IAAInB,EAAK86E,YAAY3/B,EAAOruB,EAAW8tD,KACjD56E,EAAKq6E,WAClBr6E,EAAK+6E,aAGX,MAAOviF,GACLwH,EAAKy6E,eAAe,OAAQ,iBACxB,mDACA3tD,EACA8tD,IAEJ56E,EAAKy6E,eAAe,QAAS,iBAAkBjiF,IAEnD,MAAOwH,IAIX+3E,EAActjF,UAAUqmF,YAAc,SAAqB3/B,EAAOruB,EAAW8tD,GACzEljF,KAAK+iF,eAAe,QAAS,iBAAkB,eAAgBvlF,WAC/D,IAAIoQ,IACA61C,MAAOA,EACPruB,UAAWp1B,KAAKtB,QAAQqjF,aAAe3sD,EACvC/3B,KAAM6lF,EAKV,OAHIljF,MAAKtB,QAAQwjF,UACbt0E,EAAM01E,MAAO,GAAIxkB,OAAOykB,eAErB31E,GAQXyyE,EAActjF,UAAUsmF,WAAa,SAAoB3kF,GAKrD,GAJAA,EAAUA,MACVsB,KAAK+iF,eAAe,OAAQ,iBAAkB,aAAcrkF,EAASsB,KAAK2iF,aAGrE3iF,KAAKtB,QAAQ0jF,SAAWpiF,KAAKyiF,SAC9B,MAAOnmF,GAAOsO,QAGlB,IAAItC,GAAOtI,KACPiiF,EAAWvjF,EAAQgtE,OAASpjE,EAAKq6E,UAGrC10E,EAAU3F,EAAKu6E,MAAM/jF,IAAImjF,GAErBuB,EAAgBv1E,EAAQpN,OAG5B4iF,EAA+C,kBAA7Bn7E,GAAK5J,QAAQ4jF,YAA6Bh6E,EAAK5J,QAAQ4jF,gBAQzE,OAHAmB,GAASC,QAAU5hF,KAAKC,UAAUkM,GAElC3F,EAAKm6E,UAAW,EACTnmF,EACFqnF,KAAKr7E,EAAK5J,QAAQ0jF,QAASqB,GAC3BG,OAAO,WACJt7E,EAAKm6E,UAAW,IAEnBoB,KAAK,SAAC34C,EAAKrN,EAAQvsB,GAEhBhJ,EAAKq6E,UAAYr6E,EAAK5J,QAAQsjF,aAG9B15E,EAAKmtB,KAAK,QAAS,iBACf,oBACAyV,EAAI44C,WACJ54C,EAAIrN,OACJqN,EAAI64C,cAAgB74C,EAAI84C,iBAK/BhzD,KAAK,SAAApiB,GAC2C,kBAAlCtG,GAAK5J,QAAQ6jF,kBACpBj6E,EAAK5J,QAAQ6jF,iBAAiB3zE,GAGlCtG,EAAKu6E,MAAMx9D,OAAOm+D,GAGlBl7E,EAAKq6E,UAAYr6E,EAAK5J,QAAQujF,YAM1C5B,EAActjF,UAAUknF,WAAa,WAEjC,GAAI37E,GAAOtI,IACXsI,GAAKo6E,SAAW7qE,WAAW,WACvBvP,EAAKo6E,SAAW,MACjBp6E,EAAK5J,QAAQ2jF,gBAapBhC,EAActjF,UAAUgmF,eAAiB,SAAwBt/B,EAAOruB,EAAW8tD,GAE/E,GAAI56E,GAAOtI,KAEPkkF,EAAY57E,EAAK5J,QAAQ6hF,yBAC7B,KAAKj4E,EAAK63E,cACN,MAAO73E,EAGX,IAAI47E,IAA+C,IAAlCA,EAAU/hF,QAAQizB,GAC/B,MAAO9sB,EAGX,IAAIjL,GAAOC,MAAMP,UAAUQ,MAAMN,KAAKimF,EAAc,EAOpD,OANA7lF,GAAKM,QAAQy3B,GACT9sB,EAAK5J,QAAQ8hF,yBACbnjF,GAAQA,EAAK0N,IAAIk2E,GAAgB9iF,KAAK,OAItCslD,GAAS48B,EAAcsB,QAA6C,kBAA5Br5E,GAAK63E,cAAcgE,KACpD77E,EAAK63E,cAAcgE,KAAKrmF,MAAMwK,EAAK63E,cAAe9iF,GAClDomD,GAAS48B,EAAcrD,OAA6C,kBAA7B10E,GAAK63E,cAAcz+E,MAC1D4G,EAAK63E,cAAcz+E,MAAM5D,MAAMwK,EAAK63E,cAAe9iF,IACnDomD,GAAS48B,EAAcqB,MAA2C,kBAA5Bp5E,GAAK63E,cAAciE,KAChE97E,EAAK63E,cAAciE,KAAKtmF,MAAMwK,EAAK63E,cAAe9iF,GAC3ComD,GAAS48B,EAAcoB,MAA2C,kBAA5Bn5E,GAAK63E,cAAcgE,KAChE77E,EAAK63E,cAAcgE,KAAKrmF,MAAMwK,EAAK63E,cAAe9iF,GAC3ComD,GAAS48B,EAAcmB,OAA6C,kBAA7Bl5E,GAAK63E,cAAcviD,MACjEt1B,EAAK63E,cAAcviD,MAAM9/B,MAAMwK,EAAK63E,cAAe9iF,GACV,kBAA3BiL,GAAK63E,cAAc/1E,KACjC9B,EAAK63E,cAAc/1E,IAAItM,MAAMwK,EAAK63E,cAAe9iF,GAE9CiL,IAMX+3E,EAActjF,UAAUqN,IAAM,WAC1BpK,KAAKy1B,KAAK,EAAGz1B,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAItF6iF,EAActjF,UAAU6gC,MAAQ,WAC5B59B,KAAKy1B,KAAK4qD,EAAcmB,MAAOxhF,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAIxG6iF,EAActjF,UAAUonF,KAAO,WAC3BnkF,KAAKy1B,KAAK4qD,EAAcoB,KAAMzhF,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAIvG6iF,EAActjF,UAAUqnF,KAAO,WAC3BpkF,KAAKy1B,KAAK4qD,EAAcqB,KAAM1hF,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAIvG6iF,EAActjF,UAAU2E,MAAQ,WAC5B1B,KAAKy1B,KAAK4qD,EAAcrD,MAAOh9E,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAIxG6iF,EAActjF,UAAUsnF,OAAS,WAC7BrkF,KAAKy1B,KAAK4qD,EAAcsB,OAAQ3hF,KAAKtB,QAAQojF,iBAAkBxkF,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,KAoBzG2jF,EAAah1D,gBAET22D,QAAS,KAIb3B,EAAapkF,UAAU8hF,MAAQ,SAAengF,GAC1C,IAAKsB,KAAKskF,cAEN,KAAM,IAAInkF,OAAM,kCAEpB,KAAKzB,EAAQ7B,IACT,KAAM,IAAIsD,OAAM,0CAMpB,OAJAH,MAAKnD,IAAM6B,EAAQ7B,IACnBmD,KAAKukF,eAELvkF,KAAK8iF,QAAUpkF,EAAQokF,SAAW3B,EAAah1D,eAAe22D,QACvD9iF,MAIXmhF,EAAapkF,UAAUunF,YAAc,WAGjC,IAGI,MAFAjF,cAAax9E,QAFN,eAGPw9E,aAAa/8E,WAHN,SAIA,EACT,MAAO0c,GACL,OAAO,IAKfmiE,EAAapkF,UAAUwnF,aAAe,WAClC,MAAuC,QAAnClF,aAAah9E,QAAQrC,KAAKnD,KACnBmD,KAAKgoB,QAEThoB,MAIXmhF,EAAapkF,UAAU0M,IAAM,SAAamE,GACtC,GAAItF,GAAOtI,KACPwkF,EAASl8E,EAAKm8E,iBACdC,EAAUF,EAAO3jF,OAAS,EAAIyH,EAAKw6E,OAMvC,OALI4B,GAAU,GACVF,EAAO13E,OAAO,EAAG43E,GAErBF,EAAOt3E,KAAKU,GACZtF,EAAKq8E,iBAAiBH,GACfA,EAAO3jF,QAIlBsgF,EAAapkF,UAAU0nF,eAAiB,WACpC,GAAIn8E,GAAOtI,IACX,OAAO8B,MAAKM,MAAMi9E,aAAah9E,QAAQiG,EAAKzL,OAIhDskF,EAAapkF,UAAU4nF,iBAAmB,SAA0B12E,GAChE,GAAI3F,GAAOtI,IACX,OAAOq/E,cAAax9E,QAAQyG,EAAKzL,IAAKiF,KAAKC,UAAUkM,KASzDkzE,EAAapkF,UAAU8D,OAAS,WAC5B,MAAOb,MAAKykF,iBAAiB5jF,QAIjCsgF,EAAapkF,UAAU+B,IAAM,SAAa4sE,GACtC,MAAO1rE,MAAKykF,iBAAiBlnF,MAAM,EAAGmuE,IAI1CyV,EAAapkF,UAAUsoB,OAAS,SAAgBqmD,GAC5C,GAAI8Y,GAASxkF,KAAKykF,iBACdG,EAAUJ,EAAO13E,OAAO,EAAG4+D,EAE/B,OADA1rE,MAAK2kF,iBAAiBH,GACfI,GAIXzD,EAAapkF,UAAUirB,MAAQ,WAE3B,MADAq3D,cAAax9E,QAAQ7B,KAAKnD,IAAK,MACxBmD,MAIXmhF,EAAapkF,UAAUgF,UAAY,SAAmB2pE,GAClD,MAAO5pE,MAAKC,UAAU/B,KAAKlB,IAAI4sE,KAInCyV,EAAapkF,UAAU8nF,MAAQ,WAE3B16E,QAAQC,IAAItI,KAAKC,UAAU/B,KAAKykF,iBAAkB,KAAM,QvC8roB5DroF,EAAQM,SuCzroBJ2jF,cAAeA,EACfc,aAAcA,KvC4roBWlkF,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GAsBlD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GwClrpBX,IAAA8lF,GAAAzoF,EAAA,IxCurpBI0oF,EAAaxoF,EAAuBuoF,GwCtrpBxCE,EAAA3oF,EAAA,IxC0rpBI4oF,EAAU1oF,EAAuByoF,GwCzrpBrCnrE,EAAAxd,EAAA,GxC6rpBIugC,EAAYrgC,EAAuBsd,GwC5rpBvC4I,EAAApmB,EAAA,GxCgspBIqmB,EAAUnmB,EAAuBkmB,GwC/rpBjCjZ,EAAOrK,EAASqK,KAAK3J,QACrBke,GAAI,OACJ6C,UAAW,eACXskE,WAAY,OAAQ,SAEpBplF,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXA,MAAKsrB,OAAS1tB,EAAEC,SAASa,EAAQ4sB,YAC7B65D,qBAAqB,EACrBC,oBAAqB,GACrBC,kBAAmB,OACnBC,yBAAyB,EACzBC,uBAAwB,KAI5Br8E,OAAOU,MAAQ5J,KAAK4J,MAAQ,GAAIgzB,GAAAlgC,QAAM8M,KACtCN,OAAOw0B,QAAU19B,KAAK09B,QAAU,SAAAr/B,GACxBA,EAAKqL,OACLgZ,EAAAhmB,QAAM6nB,eAAelmB,EAAKqL,OAC1BrL,EAAKimB,qBAAsB,IAE3B5B,EAAAhmB,QAAM6nB,iBACNlmB,EAAKimB,qBAAsB,GAE/Bhc,EAAKk9E,OAAO9nD,QAAQr/B,IAExB6K,OAAO2xB,OAAS76B,KAAK66B,OAASn8B,EAAQwY,QAAU,GAAIxY,GAAQwY,OAAO5O,EAAM5J,GACzEsB,KAAKg2E,SAAW,GAAI+O,GAAAroF,QAAS8M,KAAKxJ,KAAKsrB,QACvCtrB,KAAKwlF,OAAS,GAAIP,GAAAvoF,QAAM+oF,YAGxBzlF,KAAKuE,IAAI2B,KAAK,SAAU,MACxBlG,KAAKuE,IAAI6a,KAAKpf,KAAKo0B,aACnBp0B,KAAKwF,EAAE,aAAaslB,YAAY9qB,KAAKg2E,SAASzxE,KAC9CvE,KAAKwF,EAAE,WAAWmE,OAAO3J,KAAKwlF,OAAOjhF,KACrCvE,KAAKuE,IAAIoF,OAAO3J,KAAKg2E,SAAS13D,MAAM/Z,KACpCvE,KAAKuE,IAAIoF,OAAO3J,KAAK4J,MAAMrF,KAC3BvE,KAAK0lF,YAAc1lF,KAAKwF,EAAE,eAC1BxF,KAAK2lF,aAAe3lF,KAAKwF,EAAE,gBAG3BxF,KAAK4lF,UACLhoF,EAAE2K,KAAKvI,KAAKklF,UAAW,SAAAW,GACnB,GAAIC,GAAmBD,EAAS/N,OAAO,GAAGmL,cAAgB4C,EAAStoF,MAAM,GACrEwoF,EAAcrnF,EAAQonF,EAC1B,IAAIC,EAAa,CACb,GAAIC,GAAiB,GAAID,GAAYz9E,EAAM5J,EAC3C4J,GAAK09E,EAAexjF,YAAcwjF,EAClC19E,EAAKs9E,OAAOC,GAAY,GAAIZ,GAAAvoF,QAAMupF,WAC9B/lF,GAAI2lF,EACJ9nE,GAAIzV,EAAK9C,EAAL,IAAWqgF,GACfxnF,KAAM2nF,OAIlBhmF,KAAKgc,SAGLhc,KAAK66B,QACD17B,EAASynC,QAAQ10B,OACb/I,KAAMD,OAAOC,KACb09B,WAAW,KAIvB7qB,OAAQ,WAQJ,MANAxW,GAAE,8BAA8B6f,SAChCrlB,KAAKg2E,SAASh6D,SACdhc,KAAKkmF,mBACLlmF,KAAKmmF,sBACLnmF,KAAKomF,eACLpmF,KAAKqmF,kCACErmF,MAIXkmF,iBAAkB,WACd,GAAIlmF,KAAKsrB,OAAO65D,oBAAqB,CACjC,GAAIj5D,GAAUlsB,KAAKsrB,OAAO85D,qBAAuB,GAC7C3hC,EAAQzjD,KAAKsrB,OAAO+5D,mBAAqB,MAC7CrlF,MAAKuE,IAAIyY,SAAS,mBAClBhd,KAAK0lF,YACAx/E,KAAK,QADV,SAC4Bu9C,EAD5B,YAEKrkC,KAAK8M,GACLznB,SAASynB,GACT7kB,WAELrH,MAAKuE,IAAI2c,YAAY,mBACrBlhB,KAAK0lF,YAAYp+E,MAErB,OAAOtH,OAIXmmF,oBAAqB,WACjB,GAAInmF,KAAKsrB,OAAOg6D,wBAAyB,CACrC,GAAIp5D,GAAUlsB,KAAKsrB,OAAOi6D,wBAA0B,GAChDe,EAAmB9gF,EAAE,QACpBU,KAAK,OAAWgD,OAAOC,KADL,4BAElB2T,KAAK,sBACV9c,MAAKuE,IAAIyY,SAAS,sBAClBhd,KAAK2lF,aACAvmE,KAAQ8M,EADb,KAEKviB,OAAO28E,GACP7hF,SAASynB,GACT7kB,WAELrH,MAAKuE,IAAI2c,YAAY,sBACrBlhB,KAAK2lF,aAAar+E,MAEtB,OAAOtH,OAIXomF,aAAc,WACV,GAAI99E,GAAOtI,IAUX,OATApC,GAAE2K,KAAKvI,KAAKklF,UAAW,SAAAW,GACnB,GAAIU,GAAQj+E,EAAKs9E,OAAOC,EACpBU,GACAA,EAAMvqE,UAEN1T,EAAK9C,EAAE,WAAWiY,IAAIooE,EAAU,GAChCv9E,EAAK9C,EAAL,IAAWqgF,GAAYv+E,UAGxBtH,MAIXo0B,UAAW,WACP,OACI,wBACA,yBACA,uBACA,yBACA,yDACA,oBACA,sBACA,qBACA,SACA,0BACFj2B,KAAK,KAGXqE,SAAU,WACN,MAAO,kBAIX6jF,gCAAiC,WAC7B,GAAIrO,GAAOr3E,OAAOuI,OAAOoiB,OAAO2sD,0BAC5BC,EAAOv3E,OAAOuI,OAAOoiB,OAAO6sD,0BAC5BqO,EAAc7lF,OAAOuI,OAAOksE,KAAK/vE,WAAWmhF,YAC5CC,EAAqBjhF,EAAE,oBAEvBghF,KAA2E,IAA3D,IAAK,QAAQrkF,QAAQqkF,EAAYE,sBAEjDlhF,EAAE6E,MACEC,IAAQ0tE,EAAR,IAAgBE,IAEfz2E,QAAQ,SAAA+I,GAEyB,OAA1B7J,OAAOuI,OAAOksE,KAAKl1E,IAC0B,WAAzCumF,EAAmBhpE,IAAI,eACvBgpE,EAAmBhpE,IAAI,aAAc,aAIhD/b,MAAM,SAAA8I,GAEHi8E,EAAmBhpE,IAAI,aAAc,YAG7CgpE,EAAmBhpE,IAAI,aAAc,YxCgrpBjDrhB,GAAQM,SwC3qpBS8M,KAAMA,KxC4qpBMvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAGvG,CAEF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,GAErCrC,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GyC/2pBX,IAAIY,GAAQT,EAASS,MAAMC,QACvBhC,UACI8oF,UAAW,OACXp5E,OAAQ,IACRq5E,UAAW,GACX/oD,OAAQ,OACRsmD,KAAM,KACN0C,UAAW,GACXC,UAAW,GACXC,UAAW,EACXC,UAAW,KACXC,UAAW,GACXC,UAAW,KACXC,WAAY,EACZC,cAAc,EACdC,gBAAgB,EAChB58D,SAAS,GAEbmK,MAAO,SAAS1uB,GACZlG,KAAKO,QACAqB,IAAI5B,KAAKnC,UACT+D,IAAIsE,MAGbiP,EAAahW,EAASgW,WAAWtV,QAASqB,MAAOtB,GzCg3pBrDxD,GAAQM,SyC/2pBSkD,MAAOA,EAAOuV,WAAYA,KzCg3pBdlY,KAAKb,EAASC,EAAoB,KAGvD,CACA,CACA,CAEF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,GAc/C,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAZvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G0Ct5pBX,IAAAi0E,GAAA52E,EAAA,G1C25pBI62E,EAAY32E,EAAuB02E,G0C15pBvC3zE,EAAAjD,EAAA,G1C85pBIkD,EAAiBhD,EAAuB+C,G0Cx5pBxCgoF,EAAanoF,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAQ8C,eACzCK,OAAOqzE,EAAAx2E,QAAQwH,+BACfrE,QACGqrB,QAAS,MACTtK,UAAW,eACX2mE,aAAc,OACd1oE,UAGA/e,WAAY,SAASpB,GAGjBsB,KAAKwnF,aAAc,GACO,IAAtB9oF,EAAQ+oF,UACRznF,KAAK2V,MAAQ,GAEb3V,KAAK2V,MAAL,0BAAsC,EAAApW,EAAA7C,SAAG,QAAzC,WAEJsD,KAAK0nF,cAAgBhpF,EAAQgpF,gBAAiB,EAC1C1nF,KAAK0nF,gBACL1nF,KAAK6e,OAAOiB,MAAQ,aACpB9f,KAAK6e,OAAOk6B,QAAU,kBAE1B/4C,KAAKmE,qBAAqBzF,EAAQ0F,WAAY1F,IAIlDsd,OAAQ,WACJ,GAAI1T,GAAOtI,IAgBX,OAfIA,MAAK0nF,cACL1nF,KAAKuE,IAAI6a,KAAKpf,KAAK2nF,qBAEnB3nF,KAAKuE,IAAI6a,KAAKpf,KAAK4nF,oBAEvB5nF,KAAK6nF,SAASp9C,SACV0yC,YAAa,WACbzxE,MAAO1L,KAAK0nF,cAAgB1nF,KAAK0L,MAAQ1L,KAAKunF,aAC9CO,KAAM,WAEF,MAAOx/E,GAAKy/E,kBAIpB/nF,KAAKgoF,kBACEhoF,MAGXioF,YAAa,SAASzkE,GAClB,MAAIA,GAAI0kE,WAAW,KACf,QAAe1kE,EAAIjmB,MAAM,GAEtBimB,GAGX2kE,YAAa,SAAS3kE,GAIlB,MAHIA,GAAI0kE,WAAW,WACf1kE,MAAUA,EAAIjmB,MAAM,IAEjBimB,GAIXokE,iBAAkB,WACd,OAAQ5nF,KAAK2V,MAAO3V,KAAKooF,iBAAiBjqF,KAAK,KAGnDwpF,kBAAmB,WAEf,OAAQ3nF,KAAKwnF,YAAcxnF,KAAKooF,gBAAkBpoF,KAAKqoF,eAAelqF,KAAK,MAG/EmqF,eAAgB,SAAStpE,GACrB,OAAQA,EAAEuD,OAEN,IAAK,IAEDviB,KAAKuoF,eAKjBC,WAAY,WACRxoF,KAAKwnF,aAAc,EACnBxnF,KAAKgc,UAGTusE,WAAY,WACRvoF,KAAKwnF,aAAc,EACnBxnF,KAAKgc,UAGTosE,cAAe,WAEX,0CAA2CpoF,KAAKyoF,YAAhD,OAGJJ,YAAa,WACT,GAAIP,GAAO9nF,KAAKkB,MAAMpC,IAAI,QAEtB4pF,IAUJ,OATA9qF,GAAE2K,KAAKu/E,EAAM,SAAAtkE,GACTA,EAA8B,GAAxBA,EAAIrhB,QAAQ,SAAgBqhB,EAAIjmB,MAAM,GAAKimB,CACjD,IAAImlE,qCAAiDnlE,EAAjD,SACJklE,GAAcx7E,KAAKy7E,KAEM,IAAzBD,EAAc7nF,QAEd6nF,EAAcx7E,KAAd,wFAEGw7E,EAAcvqF,KAAK,MAI9BsqF,UAAW,WACP,GAAIngF,GAAOtI,KACP4oF,EAAY5oF,KAAKkB,MAAMpC,IAAI,OAC/B,QAAKlB,EAAEqF,QAAQ2lF,IAAchrF,EAAEirF,QAAQD,GAC5B,GAEJA,EACF79E,IAAI,SAAAyY,GAAA,MAAO5lB,GAAEumC,OAAO77B,EAAK6/E,YAAY3kE,MACrC+N,OACApzB,KAAK,MAId0pF,OAAQ,WACJ,MAAO7nF,MAAKuE,IAAIuC,KAAK,qBAIzBihF,aAAc,WAEV,GAAIz/E,GAAOtI,IACX,OAAOpC,GAAEmN,IAAI7B,OAAOksE,KAAKt2E,IAAI,aAAcwJ,EAAK6/E,cAIpDH,gBAAiB,WACb,GAAI1/E,GAAOtI,IACXA,MAAK6nF,SAASnnF,GAAG,SAAU,SAAA2F,GAEvBA,EAAMsC,IAAM/K,EAAEmN,IAAI1E,EAAMsC,IAAKL,EAAK2/E,aAElC3/E,EAAKpH,MAAMT,MAAOqnF,KAAMzhF,EAAMsC,MAE1BtC,EAAMyiF,OAGNxgF,EAAKygF,qBAAL,GAA6B1iF,EAAMyiF,MAAMhsE,SAQrDisE,qBAAsB,SAASC,GAE3B,GAAIC,GAAW//E,OAAOksE,KAAKt2E,IAAI,YAC1BlB,GAAEsS,SAAS+4E,EAAUD,KACtBC,EAAS/7E,KAAK87E,GACdC,EAAS13D,OACTroB,OAAOksE,KAAKxzE,IAAI,YAAaqnF,KAKrC5jE,OAAQ,WACJrlB,KAAK6nF,OAAOhoE,MACZ7f,KAAKkpF,cAAclpF,KAAKkB,OACxB/B,EAASqK,KAAKzM,UAAUsoB,OAAOpoB,KAAK+C,OAIxCwC,SAAU,WACN,OAAQ,cAAD,GAAmBxC,KAAKkB,MAAS,KAAK/C,KAAK,M1Ck6pB9D/B,GAAQM,S0C75pBJ4qF,WAAYA,K1Cg6pBarqF,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAG/E,CACA,CACA,CACA,CACA,CAEF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,GAkBrC,QAAS5C,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G2C3mqBX,IAAAs/E,GAAAjiF,EAAA,G3CgnqBIkiF,EAAWhiF,EAAuB+hF,G2C9mqBtC34C,EAAAtpC,EAAA,I3CknqBIupC,EAAuBrpC,EAAuBopC,G2CjnqBlDv9B,EAAA/L,EAAA,G3CqnqBIsgC,EAAWpgC,EAAuB6L,G2CvnqBlC5C,YAIA0R,EAAS/X,EAAS+X,OAAOrX,QAGzBC,WAAY,SAASiiC,EAAMrjC,GACvBsB,KAAK+hC,KAAOA,EACZ/hC,KAAKtB,QAAUA,GAInBwO,KAAM,SAAS5C,EAAKE,GAChBA,EAAOA,MACPA,EAAK2+E,YAAcnwE,KAAKE,SACnB1W,SAAS,IACToX,OAAO,GACPpU,EAAE4jF,cAAc5+E,KACjBF,IAA4B,GAArBA,EAAInI,QAAQ,KAAa,IAAM,IACtCmI,GAAO9E,EAAEua,MAAMvV,GAAM,IAEzBtB,OAAO+F,OAASzE,EAChBxK,KAAKqX,SAAS/M,GAAOnJ,SAAS,KAIlC4kB,QAAS,SAASlE,EAAUxkB,EAAMsS,GAC9BzG,OAAO00B,MAAM,kBAAmB/b,EAAUxkB,EAAMsS,EAChD,IAAI05E,GAAWzjD,EAAAlpC,QAAa0F,MAAM/E,EAAKK,MACvCL,GAAK6P,KAAKm8E,GACNxnE,IACI7hB,KAAKspF,aAAajsF,EAAMsS,GACxBkS,EAAS/jB,MAAMkC,KAAM3C,GAErB2C,KAAKupF,kBAKjBD,aAAc,SAASjsF,EAAMsS,GACzB,OAAO,GAGX45E,cAAe,WACXvpF,KAAK+hC,KAAKrE,QACN,GAAIf,GAAAjgC,QAAGwhC,SACHL,OAAQ,SACRvsB,QAAS,sEACT6sB,YAAY,O3C4nqB5B/hC,GAAQM,Q2CtnqBOwa,I3CunqBcja,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAElDd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G4CxrqBX,IAAAyjB,GAAApmB,EAAA,I5C+rqBA,SAAgCG,GAAcA,GAAOA,EAAIC,YAFpBgmB,EAIrCrmB,GAAQM,Q4ChsqBOyC,EAASqK,KAAK3J,QACzBnB,SACI8qF,YAAa,oBACbC,cAAe,cACfC,aAEQxpF,GAAI,eACJwJ,MAAO,2BAGPxJ,GAAI,iBACJwJ,MAAO,wBAKnB5J,WAAY,SAASpB,GAEjBsB,KAAKkB,MAAQxC,EAAQwC,MACrBlB,KAAK4e,WAAWpZ,EAAE,UAAUwX,SAAS,oBACrChd,KAAKuE,IAAIoF,OAAOnE,EAAE,UAAUwX,SAAS,0BACrChd,KAAKuE,IAAIoF,OACLnE,EAAE,YACGwX,SAAS,0CACTrT,OAAO,aAEhB3J,KAAK2pF,OAAS3pF,KAAKwF,EAAE,0BACrBxF,KAAK4pF,OAAS5pF,KAAKwF,EAAE,kCACrBxF,KAAK6rB,SAAS7rB,KAAKkB,MAAO,SAAUlB,KAAKgc,OAAQhc,MACjDA,KAAKkB,MAAMC,QAAQ,WAGvB6a,OAAQ,WACJ,GAAI1T,GAAOtI,IACXA,MAAK4pF,OAAO5hE,QACZpqB,EAAE2K,KAAKvI,KAAKtB,QAAQgrF,WAAY,SAAAG,GAC5B,GAAIC,GAAYtkF,EAAE,UACbwX,SADW,UACQ6sE,EAAU3pF,GADlB,0BAEX8c,SAAU1U,EAAKpH,MAAMpC,IAAI+qF,EAAU3pF,KAAOoI,EAAK5J,QAAQ8qF,aAAgBlhF,EAAK5J,QAAQ+qF,eACpF/oF,GAAG,QAAS,WACT4H,EAAKpH,MAAMpC,IAAI,YAAcwJ,EAAKpH,MAAMU,IAAIioF,EAAU3pF,IAAKoI,EAAKpH,MAAMpC,IAAI+qF,EAAU3pF,MAE5FoI,GAAKshF,OAAOjgF,OACRnE,EAAE,SACGmE,OAAOnE,EAAE,SAASmE,OAAOmgF,IACzBngF,OAAOnE,EAAE,SAASmE,OAAOkgF,EAAUngF,WAGhD1J,KAAK2pF,OAAQ3pF,KAAKkB,MAAMpC,IAAI,YAAc,QAAW,e5CqrqBhC7B,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAElDd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G6ChvqBX,IAAAyjB,GAAApmB,EAAA,G7CqvqBIqmB,EAEJ,SAAgClmB,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFlDimB,EAIrCrmB,GAAQM,Q6CxvqBOyC,EAASqK,KAAK3J,QACzBC,WAAY,SAASpB,GAEjBsB,KAAKkB,MAAQ,GAAI/B,GAASS,OACtBk/B,IAAK,aACLirD,UAAW,oCACXC,aAAc,0CACdC,cAAe,0CACfC,cAAc,EACd/hD,8HACIzpC,EAAQyrF,gBADZ,2CAGArpE,WAAY,KACZqT,SAAU,aACVi2D,MAAO,aACPC,SAAU,eACXzoF,IAAIlD,GACPsB,KAAK8gB,WAAa9gB,KAAKkB,MAAMpC,IAAI,cACjCkB,KAAK4e,WAAW5e,KAAKo0B,aACrBp0B,KAAK4rB,SAAW5rB,KAAKwF,EAAE,uBACvBxF,KAAKsqF,MAAQtqF,KAAKwF,EAAE,oBACpBxF,KAAKuqF,MAAQvqF,KAAKwF,EAAE,oBACpBxF,KAAKwqF,QAAUxqF,KAAKwF,EAAE,sBACtBxF,KAAKyqF,MAAQzqF,KAAKwF,EAAE,oBACpBxF,KAAK47E,MAAQ57E,KAAKwF,EAAE,oBACpBxF,KAAK0qF,SAAW1qF,KAAKwF,EAAE,uBACvBxF,KAAK2qF,QAAU3qF,KAAKwF,EAAE,0BACtBxF,KAAKgc,UAGTA,OAAQ,WACJ,GAAI1T,GAAOtI,IACXA,MAAKsqF,MAAMjjF,OACXrH,KAAK4rB,SAAStkB,OACdtH,KAAK0qF,SAASpjF,OACdtH,KAAKuqF,MAAMjjF,OACX9B,EAAE6E,MACEC,IAAQpB,OAAOC,KAAf,mBACAlI,OAAQ,MACRQ,QAAS,SAASmpF,GACdtiF,EAAKpH,MAAMU,IAAI,YAAagpF,GAC5BtiF,EAAKuiF,SACLviF,EAAKwiF,gBAETppF,MAAO,WACH4G,EAAKwiF,mBAMjBA,aAAc,WACV,GAAIxiF,GAAOtI,KACP4qF,EAAY5qF,KAAKkB,MAAMpC,IAAI,YAE/B,IADAkB,KAAKqsB,QACDu+D,GAAaA,EAAU/pF,OAAS,EAAG,CACnCb,KAAK47E,MAAM5zD,OACX,IAAI7a,GAAO,CACXvP,GAAE2K,KAAKqiF,EAAW,SAAAG,GACdziF,EAAK+jB,KAAKnf,KAAK5E,EAAK2U,WAAW8tE,IAC/B59E,GAAQ49E,EAAS59E,OAErBnN,KAAKwqF,QAAQprE,KAAQwrE,EAAU/pF,OAA/B,UACAb,KAAKyqF,MAAMrrE,KAAKsD,EAAAhmB,QAAMsuF,cAAc79E,GAAM,IACtCnN,KAAK8gB,aACL9gB,KAAKwF,EAAE,oBAAoB6B,OAC3BrH,KAAK2qF,QACA3tE,SAAShd,KAAKkB,MAAMpC,IAAI,cACxB+gB,MACAnf,GAAG,QAAS,WACT4H,EAAK2iF,SAEbjrF,KAAKw9E,YAETx9E,KAAK4rB,SAASvkB,WAEdrH,MAAK0qF,SAASrjF,MAElBrH,MAAKkB,MAAMpC,IAAI,iBAAmBkB,KAAKuqF,MAAMljF,OAC7CrH,KAAKsqF,MAAMhjF,QAIf2V,WAAY,SAAS8tE,GACjB,GAAIziF,GAAOtI,KACPtB,EAAUsB,KAAKkB,MAAMmE,WACrB6lF,EAAM1lF,EAAExF,KAAKmrF,aAAaJ,IAC1BK,EAAQF,EAAIpkF,KAAK,QAErB,IADA9G,KAAK47E,MAAMjyE,OAAOuhF,GACdlrF,KAAK8gB,WAAY,CACjB,GAAIuqE,GAAcrrF,KAAKsrF,UAAUP,EAASl/E,KAC1Cu/E,GAAMpuE,aAAyBxb,KAAhB6pF,EAA4B3sF,EAAQqrF,UAAYrrF,EAAQsrF,cACvEkB,EAAIxqF,GAAG,QAAS,WACZ4H,EAAKijF,QAAQH,EAAOL,GACpBziF,EAAKk1E,iBAGT0N,GAAIxqF,GAAG,QAAS,WACZhC,EAAQy1B,SAAS42D,IAGzB,OAAOK,IAIXP,OAAQ,WACJ,GAAIviF,GAAOtI,IACXA,MAAKsrF,aACLtrF,KAAK8gB,YACD9gB,KAAK8gB,WAAWvY,KAAK,SAAArH,GACa,OAA1BA,EAAMpC,IAAI,eACVwJ,EAAKgjF,UAAUpqF,EAAMpC,IAAI,cAAgBoC,EAAMhB,OAM/D+qF,KAAM,WACF,GAAIvsF,GAAUsB,KAAKkB,MAAMmE,WACrBulF,EAAY5qF,KAAKkB,MAAMpC,IAAI,aAC3B2K,EAAMzJ,KAAK2qF,QAAQp8D,SAAS7vB,EAAQqrF,UACxC,KAAK,GAAIn9E,KAASg+E,GAAW,CACzB,GAAIG,GAAWH,EAAUh+E,GACrBy+E,EAAcrrF,KAAKsrF,UAAUP,EAASl/E,WACrBrK,KAAhB6pF,GAA6B5hF,OAAyBjI,KAAhB6pF,IAA8B5hF,IACrEzJ,KAAKurF,QAAQvrF,KAAKqsB,KAAKzf,GAAQm+E,GAGvC/qF,KAAKw9E,YAIT+N,QAAS,SAASH,EAAOL,GACrBK,EAAMlqE,aACN,IAAIxiB,GAAUsB,KAAKkB,MAAMmE,WACrBgmF,EAAcrrF,KAAKsrF,UAAUP,EAASl/E,KAC1C,QAAoBrK,KAAhB6pF,EAA2B,CAC3B,GAAIG,GAAY9sF,EAAQ0rF,MAAMW,EAC9BK,GAAMpuE,SAASte,EAAQsrF,cACvBhqF,KAAKsrF,UAAUP,EAASl/E,MAAQ2/E,MAEhC9sF,GAAQ2rF,SAASgB,GACjBD,EAAMpuE,SAASte,EAAQqrF,WACvB/pF,KAAKsrF,UAAUP,EAASl/E,UAAQrK,IAKxCg8E,SAAU,WACN,GAAIiO,GAAS7tF,EAAE8tF,OACX1rF,KAAKsrF,UACL,SAACK,EAAMz/C,GAEH,WADY1qC,KAAZ0qC,GAAyBy/C,IAClBA,GAEX,EAEJ3rF,MAAK2qF,QAAQzpE,cACC,GAAVuqE,EACAzrF,KAAK2qF,QAAQ3tE,SAAShd,KAAKkB,MAAMpC,IAAI,cAErCkB,KAAK2qF,QAAQ3tE,SACTyuE,GAAUzrF,KAAKqsB,KAAKxrB,OAASb,KAAKkB,MAAMpC,IAAI,gBAAkBkB,KAAKkB,MAAMpC,IAAI,mBAMzFqsF,aAAc,SAASzsF,GACnB,oIAAqId,EAAEumC,OACnIzlC,EAAQmN,MADZ,6BAE8B6W,EAAAhmB,QAAMsuF,cAActsF,EAAQyO,MAF1D,6BAGIzO,EAAQktF,MAHZ,cAQJx3D,UAAW,WACP,qBAAsBp0B,KAAKkB,MAAMpC,IAC7B,OADJ,sFAEuFkB,KAAKkB,MAAMpC,IAC9F,aAHJ,mqB7C4uqBqB7B,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,GAc/C,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAZvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G8Cz6qBX,IAAAyjB,GAAApmB,EAAA,GACAwvF,G9C66qBctvF,EAAuBkmB,G8C76qBrCpmB,EAAA,K9Ci7qBIyvF,EAAcvvF,EAAuBsvF,EAKzCzvF,GAAQM,Q8Cr7qBOyC,EAASqK,KAAK3J,QACzBC,WAAY,SAASpB,GACjBsB,KAAKkB,MAAQ,GAAI/B,GAASS,MAAMlB,GAChCsB,KAAK4e,WAAW,UAChB5e,KAAKgc,UAGTA,OAAQ,WACJ,GACItd,GAAUsB,KAAKkB,MAAMmE,WACrByxB,EAAcl5B,EAAE0qB,UAAU5pB,EAAQqtF,MAClC7rF,GAAIxB,EAAQioF,WAEhB3mF,MAAKgsF,iBAAmBhsF,KAAKgsF,gBAAgB3mE,SAC7CrlB,KAAKgsF,gBAAkB,GAAIF,GAAApvF,QAAQ8M,MAC/BohB,UAAWlsB,EAAQksB,WAAa,SAChC/J,UAAWniB,EAAQ6F,MAEvBvE,KAAKgsF,gBAAgBtiF,MAAMhL,EAAQgL,OACnC1J,KAAKgsF,gBAAgBhkE,QACrBhoB,KAAKgsF,gBAAgBriF,OAAO3J,KAAKisF,qBAAqBn1D,IACtD92B,KAAKgsF,gBAAgB3kF,QAIzB4kF,qBAAsB,SAASvtF,GAC3B,GAAIA,EAAQo4B,YAAa,CACrB,GAAIoL,GAAOxjC,EAAQo4B,WAInB,OAHIp4B,GAAQwtF,kBACRhqD,sBAA2BxjC,EAAQwtF,gBAAnC,oCAEGhqD,EAEP,MAAO,kE9Cy7qBUjlC,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASC,EAAQsB,I+Cj+qB7C,SAAC4H,GAEGlJ,EAAO+J,MAAM8lF,MAAMj/E,KAAK,gBAKxB1H,EAAE4mF,WAAa,SAAA9gE,GAEX,GAAI+gE,GAAM7mF,EAAE3F,WAGJ2K,QACA/I,QAAS,aACTC,MAAO,aACP4qF,SAAU,aACVhiF,IAAK,KACLiiF,YAAa,KACbC,eAAgB,6CAChBC,cAAe,0CACfC,aAAc,yBACdC,YAAa,kCAEjBrhE,GAIA9gB,EAAO6hF,EAAI7hF,IAGf,IAAIA,EAAKszB,cAEL,WADAuuD,GAAI3qF,MAAM8I,EAAKszB,cAKnB,IAAIb,GAAO,GAAI2vD,SACf,KAAK,GAAI/vF,KAAO2N,GAAK+tB,QACjB0E,EAAKtzB,OAAO9M,EAAK2N,EAAK+tB,QAAQ17B,GAIlC,IAAIgwF,GAAQ,CACZ,KAAK,GAAIhwF,KAAO2N,GAAKsiF,MAAO,CACxB,GAAI32E,GAAI3L,EAAKsiF,MAAMjwF,EACnBogC,GAAKtzB,OAAOwM,EAAExG,KAAMwG,EAAE42E,KAAM52E,EAAE42E,KAAKp9E,MACnCk9E,GAAS12E,EAAE42E,KAAK5/E,KAIpB,GAAI0/E,EAAQ,QAAUR,EAAIE,YAEtB,WADAF,GAAI3qF,MAAM2qF,EAAIG,eAKlB,IAAIthD,GAAM,GAAI8hD,eACd9hD,GAAInS,KAAK,OAAQszD,EAAI/hF,KAAK,GAC1B4gC,EAAIC,iBAAiB,SAAU,oBAC/BD,EAAIC,iBAAiB,gBAAiB,YACtCD,EAAIC,iBAAiB,mBAAoB,kBAGzCD,EAAI+hD,mBAAqB,WAErB,GAAI/hD,EAAI44C,YAAc54C,EAAIgiD,KAAM,CAE5B,GAAIt+E,GAAW,KACXoyC,EAAa,EACjB,IAAI9V,EAAI84C,aACJ,IACIp1E,EAAWtS,EAAOktB,UAAU0hB,EAAI84C,cAChChjC,EAAapyC,EAASmvB,QACxB,MAAO/e,GACLpQ,EAAWs8B,EAAI84C,aACfhjC,EAAapyC,EAIrB,GAAIs8B,EAAIrN,OAAS,KAAOqN,EAAIrN,OAAS,IAAK,CACtC,GAAI/gB,GAAOouB,EAAI2nC,UACG,MAAd3nC,EAAIrN,OACJ/gB,EAAOuvE,EAAIM,YACU,GAAdzhD,EAAIrN,OACX/gB,EAAOuvE,EAAIK,aACH5vE,IACRA,EAAOuvE,EAAII,eAEfJ,EAAI3qF,MAASob,EAAb,KAAsBouB,EAAIrN,OAA1B,MAAsCmjB,OAEtCqrC,GAAI5qF,QAAQmN,KAMxBs8B,EAAItQ,OAAOz0B,iBACP,WACA,SAAA6Y,GACQA,EAAEmuE,kBACFd,EAAIC,SAAStzE,KAAKC,MAAiB,IAAX+F,EAAEouE,OAAepuE,EAAEquE,UAGnD,GAIJnkF,OAAOusB,KAAKmI,MAAM,0BAA2B,0BAA2ByuD,GACxEnhD,EAAIknC,KAAKn1C,IAMbz3B,EAAE8nF,GAAGC,YAAc,SAAS7uF,GAExB,GAAIqf,GAAK/d,KACL4gE,EAAOp7D,EAAE3F,WAGL2tF,WAAY,aACZC,YAAa,aACbt5D,SAAU,aACVipD,UAAU,GAEd1+E,GAIAmpF,EAASriF,+CAA+Co7D,EAAKwc,UAAY,YAAe,IAA/E,KA0Bb,OAzBAr/D,GAAGpU,OACCk+E,EAAOjiE,OAAO,SAAS5G,GACnB4hD,EAAKzsC,SAASnV,EAAEC,OAAO6tE,OACvBtnF,EAAExF,MAAM2I,IAAI,OAKpBoV,EAAGrd,GAAG,OAAQ,SAAAse,GACV4hD,EAAK6sB,YAAYzuE,GACbA,EAAE1Y,eACFs6D,EAAKzsC,SAASnV,EAAE1Y,aAAawmF,OAC7B9tE,EAAE8H,oBAGV/I,EAAGrd,GAAG,WAAY,SAAAse,GACdA,EAAE8H,iBACF85C,EAAK4sB,WAAWxuE,KAEpBjB,EAAGrd,GAAG,YAAa,SAAAse,GACfA,EAAEqC,kBACFu/C,EAAK6sB,YAAYzuE,MAKjB0uE,OAAQ,WACJ7F,EAAO1mF,QAAQ,YAQ3BqE,EAAE8nF,GAAGK,UAAY,SAASjvF,GAyCtB,QAAS+K,GAAIqjF,GACT,GAAIA,GAASA,EAAMjsF,SAAW+sF,EAAe,CACzC,GAAIhhF,OAAQpL,EAiBZ,OAhBA5D,GAAE2K,KAAKukF,EAAO,SAACC,EAAMlwF,GAEC,QAAdkwF,EAAKl/E,MACLjQ,EAAE4F,OAAO2sC,EAAO,SAAA7e,GAAA,MAAKA,GAAE3hB,OAASo9E,EAAKp9E,MAAQ2hB,EAAEnkB,OAAS4/E,EAAK5/E,OAAMtM,SAEnEksF,EAAKc,WAAY,KAGzBjwF,EAAE2K,KAAKukF,EAAO,SAAAC,GACLA,EAAKc,YACNjhF,EAAQwxD,OAAO0vB,KACf39C,EAAMvjC,GAASmgF,EACfnsB,EAAKmtB,SAASnhF,EAAOujC,EAAMvjC,IAC3BohF,OAGDphF,GAKf,QAASyY,GAAOzY,GACRujC,EAAMvjC,WACCujC,GAAMvjC,GACbohF,KAKR,QAAS1wD,KAEL,GAAoB,GAAhB0wD,GAAqBC,EAIrB,MAHAA,IAAa,EACbL,GAAgB,MAChBhtB,GAAKn3C,UAGLmkE,IAAgB,CAIpB,IAAIhhF,IAAS,CACb,KAAK,GAAI/P,KAAOszC,GAAO,CACnBvjC,EAAQ/P,CACR,OAIOszC,EAAMvjC,EAGjByY,GAAOzY,GAGPpH,EAAE4mF,YACE9hF,IAAKs2D,EAAKt2D,IACVE,KAAMo2D,EAAK9gE,WAAW8M,GACtBnL,QAAS,SAAS6P,GACdsvD,EAAKn/D,QAAQmL,EAAO0E,GACpBgsB,KAEJ57B,MAAO,SAAS4P,GACZsvD,EAAKl/D,MAAMkL,EAAO0E,GAClBgsB,KAEJgvD,SAAU,SAASnF,GACfvmB,EAAK0rB,SAAS1/E,EAAOu6E,MAUjC,QAAS1/E,KACL8lF,EAAYG,SAIhB,QAAS94D,GAAMhoB,GACX,IAAKA,IAASujC,GACV9qB,EAAOzY,GAKf,QAASsF,KACA07E,IACDA,GAAgB,EAChBtwD,KAKR,QAAS4wD,KACLD,GAAa,EAIjB,QAASE,GAAUzvF,GAEf,MADAkiE,GAAOp7D,EAAE3F,UAAW+gE,EAAMliE,GAK9B,QAAS0vF,KACL,MAAOztF,QAAO0tF,MAAQ1tF,OAAOisF,UAAYjsF,OAAOqsF,gBAAkBrsF,OAAO2tF,SAtJ7E,GAAI1tB,GAAOp7D,EAAE3F,WAGL0uF,SAAU,aACVC,UAAW,aACXT,SAAU,SAAS53E,KACnBrW,WAAY,SAASqW,KACrBm2E,SAAU,SAASn2E,EAAGuK,KACtBjf,QAAS,SAAS0U,EAAGuK,KACrBhf,MAAO,SAASyU,EAAGuK,GACf3f,MAAM2f,IAEV+I,SAAU,cAEd/qB,GAIAyxC,KAGA29C,EAAc,EACdE,EAAe,EAGfJ,GAAgB,EAChBK,GAAa,EAGbV,EAAc/nF,EAAExF,MAAMutF,aACtBnQ,UAAU,EACVjpD,SAAU,SAAS24D,GACfrjF,EAAIqjF,IAERU,WAAY9uF,EAAQ8uF,WACpBC,YAAa/uF,EAAQ+uF,aAuHzB,QACIhmF,OAAQA,EACRgC,IAAKA,EACL4b,OAAQA,EACRnT,MAAOA,EACPg8E,KAAMA,EACNt5D,MAAOA,EACPu5D,UAAWA,EACXC,WAAYA,KAGrB9xF,K/Co9qB0BW,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,EAAGlJ,GAoCrD,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GgD1ypBvF,QAASiyF,GAAqBj8D,EAAUk8D,GACpC,GAAIC,GAAWn8D,EAAS7wB,QAgBxB,OAdcitF,GAA2BD,GACrCD,uBAAwBA,EACxBG,WAAY,SAASF,EAAUh/E,EAAMm/E,GAQjC,MAPAH,GAAWA,EAAS5jF,IAAI,SAAAmhC,GAAA,OACpBhsC,GAAIgsC,EAAQhsC,GACZyP,KAAMu8B,EAAQv8B,KAGd3D,IAAsC,YAAjCkgC,EAAQ6iD,qBAAqC,MAAQ,UAEvDv8D,EAASw8D,WAAWL,EAAU,OAAQh/E,EAAMm/E,MhD2vpB/DhyF,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GgD7yrBX,IAAAiwF,GAAA5yF,EAAA,IhDkzrBI6yF,EAAc3yF,EAAuB0yF,GgDjzrBzCE,EAAA9yF,EAAA,IhDqzrBI+yF,EAAW7yF,EAAuB4yF,GgDpzrBtClc,EAAA52E,EAAA,GhDwzrBI62E,EAAY32E,EAAuB02E,GgDvzrBvCoc,EAAAhzF,EAAA,KhD2zrBIizF,EAAgB/yF,EAAuB8yF,GgD1zrB3Cx1E,EAAAxd,EAAA,GhD8zrBIugC,EAAYrgC,EAAuBsd,GgD7zrBvC01E,EAAAlzF,EAAA,KACAiD,GhDg0rBoB/C,EAAuBgzF,GgDh0rB3ClzF,EAAA,IhDo0rBIkD,EAAiBhD,EAAuB+C,EgDn0rB5CjD,GAAA,IAEA,IAaImzF,GAA+BrwF,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QAC5EH,cAde,cAiBfwrB,QAAS,KACTtK,UAAW,qBAEX9gB,WAAY,SAASuF,GACjBrF,KAAKksC,QAAU7mC,EAAW6mC,YAC1BlsC,KAAK2G,SAAWtB,EAAWsB,WAAY,GAG3CqV,OAAQ,WACJhc,KAAK4F,iBAAmBhI,EAAEiI,KAAK7F,KAAKyvF,WAAYzvF,MAChDA,KAAK+F,eAAiBnI,EAAEiI,KAAK7F,KAAK0vF,SAAU1vF,KAC5C,IAAIiG,GAASjG,KAAKuE,IACb2B,KAAK,kBAAmBlG,KAAKksC,QAAQhsC,IACrCgG,KAAK,aAAa,GAClBkZ,KAAKpf,KAAKhC,UAAWkuC,QAASlsC,KAAKksC,WACnCptC,IAAI,EAMT,OALAmH,GAAOE,iBAAiB,YAAanG,KAAK4F,kBAAkB,GAC5DK,EAAOE,iBAAiB,UAAWnG,KAAK+F,gBAAgB,GACpD/F,KAAK2G,UACL3G,KAAKuE,IAAIyY,SAAS,YAEfhd,MAIXhC,SAAUJ,EAAEI,UAEJ,2BACA,EAAAuB,EAAA7C,SAAG,mBACH,+BACA,sBACA,OACA,8CACA,EAAA6C,EAAA7C,SAAG,qCACH,MACA,EAAA6C,EAAA7C,SAAG,WACH,aACFyB,KAAK,KAIXsJ,OAAQ,SAAShD,GACbzE,KAAKuE,IAAIwC,YAAY,WAAYtC,GACjCzE,KAAKmB,QAAQ,UACT2yC,OAAQ9zC,KACR2G,SAAU3G,KAAKuE,IAAIgqB,SAAS,eAKpCohE,QAAS,WACL,GAAItxF,GAAO2B,KACP4vF,EAAc5vF,KAAKuE,IAAI8Z,SAAS3S,OACpC1L,MAAKuE,IAAIusB,SAAU++D,eAAgBD,GAAe,OAAQ,WACtDvxF,EAAK8C,QAAQ,WACT2yC,OAAQz1C,IAEZA,EAAKyxF,aAKbA,QAAS,WACL9vF,KAAK6f,MACL7f,KAAKuE,IAAI8gB,UAGbxG,QACIiB,MAAO,SACPiwE,cAAe,aACfC,iBAAkB,gBAElBzB,SAAU,gBACV0B,KAAM,iBAIVC,OAAQ,SAASnrF,GACbA,EAAGsc,kBACHrhB,KAAKyH,OAAO1C,IAIhBorF,WAAY,SAASprF,GACjBA,EAAGsc,kBACHtc,EAAG+hB,gBAEH,IAOIlY,MANA,EAAArP,EAAA7C,SAAG,oCACH,QACA,EAAA6C,EAAA7C,SAAG,gEACH,KACFyB,KAAK,IAEQiyF,QAAU,EAAA7wF,EAAA7C,SAAG,oCAAb,IAAqDsD,KAAKksC,QAAQv8B,MAE7Ef,KACA5O,KAAKksC,QAAQv8B,KAAOf,EACpB5O,KAAKgc,WAMbq0E,cAAe,SAAStrF,GACpBA,EAAGsc,kBACHrhB,KAAK2vF,WAITF,WAAY,SAAS1qF,GACbA,EAAG4pB,gBACH5pB,EAAKA,EAAG4pB,eAEZ5pB,EAAGuB,aAAaC,cAAgB,OAChCxB,EAAGuB,aAAaE,QAAQ,aAAc1E,KAAKC,UAAU/B,KAAKksC,UAE1DlsC,KAAKuE,IAAIyY,SAAS,YAClBhd,KAAKuE,IAAI8Z,SAASld,QAAQ,gCAAiCnB,QAI/D0vF,SAAU,SAAS3qF,GACf/E,KAAKuE,IAAI2c,YAAY,YACrBlhB,KAAKuE,IAAI8Z,SAASld,QAAQ,8BAA+BnB,QAI7DswF,cAAe,SAASvrF,GACpB/E,KAAKuE,IAAI8Z,SAASld,QAAQ4D,IAI9BvC,SAAU,WACN,MAAO,oCAOX+tF,EAAwBpxF,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAS8C,eACrDK,OAAOyvF,EAAA5yF,QAAY8zF,wBACnB3wF,QACGH,cAjKW,cAoKX+wF,iBAAkBjB,EAElBkB,gBAAiBxB,EAAAxyF,QAAKi0F,6BACtB/vE,UAAW,gEAGXgwE,YAAa,EAEbC,mBAGIhC,WAAY,WACR,KAAM,IAAIiC,WAAU,+BAGxBC,SAAU,aAEVC,SAAU,aAEVC,eAAgB,GAEhBC,aAAc,6BAGlBC,gBACIC,kBAAmB,iBAIvBtxF,WAAY,SAASuF,GACjBrF,KAAKqkF,OAAO,mCAAoCh/E,EAChD,IAAIgsF,GAAUrxF,IACdpC,GAAE2K,KAAKvI,KAAK6wF,kBAAmB,SAAC7xF,EAAOnC,GACnCmC,EAAQqG,EAAWxI,IAAQmC,EAC3BqyF,EAAQx0F,GAAOmC,IAInBqyF,EAAQC,gBAAkBjsF,EAAWspF,aAErC3uF,KAAKuxF,qBAAqBlsF,GAC1BrF,KAAKwxF,iBACLxxF,KAAKyxF,iBACLzxF,KAAKgoF,mBAITwJ,eAAgB,WAEZxxF,KAAK0xF,eAEL1xF,KAAK2xF,UAAY,KAEjB3xF,KAAK4xF,UAAW,GAKpBH,eAAgB,WAGZzxF,KAAK6xF,mBAGL7xF,KAAK8xF,mBAEL9xF,KAAK+xF,gBAGL/xF,KAAK8xF,gBAAkB9xF,KAAKsxF,gBAAgB/zF,MAAM,GAClDyC,KAAKgyF,oBACLhyF,KAAKiyF,oBACLjyF,KAAKkyF,wBACLlyF,KAAKmyF,iBAITH,kBAAmB,WAMf,MALAhyF,MAAK8xF,gBAAgBv8D,QAAQ,SAAA2W,GACpBA,EAAQlvC,eAAe,QACxBkvC,EAAQhsC,GAAKtC,EAAEw0F,cAGhBpyF,KAAK8xF,iBAIhBG,kBAAmB,WACf,GAAIZ,GAAUrxF,IAcd,OAZAqxF,GAAQQ,mBAER7xF,KAAK8xF,gBAAkB9xF,KAAK8xF,gBAAgBtuF,OAAO,SAAA0oC,GAC/C,GAAImmD,GAAUhB,EAAQiB,kBAAkBpmD,EAOxC,OANImmD,IACAhB,EAAQQ,gBAAgB3kF,MACpBg/B,QAASA,EACTpvB,KAAMu1E,KAGNA,IAELryF,KAAK8xF,iBAIhBQ,kBAAmB,SAASpmD,GACxB,MAAqC,YAAjCA,EAAQ6iD,sBACD,EAAAxvF,EAAA7C,SAAG,oBAEGwvC,EAAQxjB,QAAU0mE,EAAA1yF,QAAO8lB,IAAM5kB,EAAEsS,SAASk/E,EAAA1yF,QAAOwgF,iBAAkBhxC,EAAQxjB,OAIxFwjB,EAAQqmD,SAAWrmD,EAAQsmD,QACpB,EAAAjzF,EAAA7C,SAAG,8BAEP,MALI,EAAA6C,EAAA7C,SAAG,iDASlBw1F,sBAAuB,WACnB,GACIO,GAAU,EACVC,IACJ1yF,MAAK8xF,gBAAgBv8D,QAAQ,SAAA2W,GAEzB,IADA,GAAIymD,GAAWzmD,EAAQv8B,KAChB+iF,EAAc11F,eAAe21F,IAGhC,GAFAA,EAAczmD,EAAQv8B,KAAtB,KAA+B8iF,EAA/B,KACAA,GAAW,IAPN,IASD,KAAM,IAAItyF,OAAM,8CAGxB+rC,GAAQv8B,KAAOgjF,EACfD,EAAcxmD,EAAQv8B,OAAQ,KAKtCwiF,cAAe,SAASpG,KASxB/vE,OAAQ,SAAS7U,EAAO0a,GAEpB,MAAI7hB,MAAK8xF,gBAAgBjxF,OAASb,KAAK4wF,YAC5B5wF,KAAK4yF,eAAezrF,EAAO0a,IAGtC7hB,KAAKuE,IAAIyjB,QAAQ5I,KAAKpf,KAAKy6B,UAAUo4D,QACrC7yF,KAAK8yF,cAAc3rF,GACnBnH,KAAK+yF,cAAc5rF,GACnBnH,KAAKgzF,cAAc7rF,GACnBnH,KAAKizF,uBACLjzF,KAAKwF,EAAE,oBAAoBs2B,QAC3B97B,KAAKmB,QAAQ,WAAYnB,MAClBA,OAIX4yF,eAAgB,SAASzrF,EAAO0a,GAY5B,MAVA7hB,MAAKuE,IAAIyjB,QAAQ5I,KACbpf,KAAKy6B,UAAUy4D,gBACXC,SAAUnzF,KAAK6xF,gBACflD,SAAU3uF,KAAK8xF,mBAGM,kBAAlB9xF,MAAKgxF,UACZhxF,KAAKwF,EAAE,sBAAsB6B,OAEjCrH,KAAKmB,QAAQ,WAAYnB,MAClBA,MAIX8yF,cAAe,SAAS3rF,EAAO0a,GAC3B,GAAI6J,GAAU1rB,KAAKwF,EAAE,WAChBwiB,QACA5I,KAAKpf,KAAKy6B,UAAUjW,UACpB1d,KAAK,iBACLm3B,QAAQz4B,EAAExF,KAAKy6B,UAAU24D,eAK9B,OAHIpzF,MAAK6xF,gBAAgBhxF,QACrBb,KAAKqzF,wBAEF3nE,GAIXqnE,cAAe,SAAS5rF,EAAO0a,GAC3B,GAAIyxE,GAAUtzF,KAAKwF,EAAE,WAChBwiB,QACA5I,KAAKpf,KAAKy6B,UAAU84D,SAEzB,OADAvzF,MAAKwzF,YAAYrsF,GACVmsF,GAIXL,qBAAsB,WAClBjzF,KAAKwF,EAAE,mBAAmBiuF,eAAe,sBAAuBzzF,KAAKkxF,eAIzEmC,sBAAuB,WACnBrzF,KAAK0zF,WACD1zF,KAAKy6B,UAAUo3D,iBACXsB,SAAUnzF,KAAK6xF,kBAEnB,kBAIR8B,sBAAuB,SAAS10D,IAC5BA,IAAWrhC,EAAEg2F,YAAY30D,IAAWA,KAEhCj/B,KAAKwF,EAAE,oBAAoBmjB,KAAK,YAAY,GAC5C3oB,KAAKwF,EAAE,sBAAsBuB,YAAY,YAAY,KAS7D8sF,MAAO,WACH,MAAO7zF,MAAKwF,EAAE,yBAIlBsuF,qBAAsB,WACdl2F,EAAEuP,KAAKnN,KAAK0xF,aACZ1xF,KAAKwF,EAAE,mDAAmD6B,OAE1DrH,KAAKwF,EAAE,mDAAmD8B,QAKlEksF,YAAa,SAASrsF,EAAO0a,GAEzB,GAAIwvE,GAAUrxF,KAEV+zF,EAAOz3F,EAAO,UACdu3F,EAAQxC,EAAQwC,OAEpBj2F,GAAE2K,KAAKvI,KAAK+xF,aAAc,SAAA1zF,GACtBA,EAAKyxF,UACLuB,EAAQ2C,kBAAkB31F,KAQ9BgzF,EAAQS,gBAAgBv8D,QAAQ,SAAA2W,GAC5B,GAAI+nD,GAAc5C,EAAQ6C,mBAAmBhoD,EAC7C6nD,GAAKpqF,OAAOsqF,EAAY1vF,OAG5B8sF,EAAQyC,uBACRD,EAAM7rE,QAAQre,OAAOoqF,EAAK70E,YAC1BthB,EAAEu2F,OAAO9C,EAAQU,aAAc,UAE3B8B,EAAMp4E,SAAWo4E,EAAMp2E,IAAI,cAC3Bo2E,EAAMp2E,IAAI,eAAgB,mBAE1Bo2E,EAAMp2E,IAAI,eAAgB,QAKlCy2E,mBAAoB,SAAShoD,GACzB,GAAI+nD,GAAc,GAAIj0F,MAAKywF,kBAGvBvkD,QAASA,EACTvlC,SAAU/I,EAAE+0B,IAAI3yB,KAAK0xF,YAAaxlD,EAAQhsC,KAI9C,OAFAF,MAAK+xF,aAAa7kF,KAAK+mF,GACvBj0F,KAAKo0F,qBAAqBH,GACnBA,GAIXG,qBAAsB,SAAS/1F,GAC3B,GAAIgzF,GAAUrxF,IACdqxF,GAAQxlE,SAASxtB,GACboJ,OAAQ,SAAS+C,GACb,GAAI0hC,GAAU1hC,EAAKspC,OAAO5H,OACtB1hC,GAAK7D,SACL0qF,EAAQK,YAAYxlD,EAAQhsC,KAAM,QAE3BmxF,GAAQK,YAAYxlD,EAAQhsC,IAEvCmxF,EAAQlwF,QAAQ,kBAAmBqJ,IAEvCmlF,QAAS,SAASnlF,GACd6mF,EAAQlwF,QAAQ,mBAAoBqJ,OAMhD6pF,eAAgB,SAASnoD,KAQzB8nD,kBAAmB,SAAS31F,SACjB2B,MAAK0xF,YAAYrzF,EAAK6tC,QAAQhsC,IACrCF,KAAK8zF,uBAEL9zF,KAAK+xF,aAAen0F,EAAE02F,QAAQt0F,KAAK+xF,aAAc1zF,GACjD2B,KAAKkpF,cAAc7qF,IAIvBk2F,sBAAuB,WACnBv0F,KAAK2zF,uBAAsB,GAC3B3zF,KAAKwF,EAAE,wBAAwBmE,OAAO3J,KAAKy6B,UAAU+5D,mBAWzDC,eAAgB,SAASvoD,GAErB,MAAOA,IAMXwoD,WAAY,SAAS/kF,GACjB,IAAK3P,KAAK8xF,gBAAgBjxF,OAAQ,CAC9B,GAAIyQ,IAAa,EAAA/R,EAAA7C,SAAG,oCAAhB,IAKJ,OAJA4U,4DAAkE,EAAA/R,EAAA7C,SAAG,UAArE,QACA4U,IAAW,EAAA/R,EAAA7C,SAAG,MACd4U,oDAA2D,EAAA/R,EAAA7C,SAAG,cAA9D,YACAsD,MAAK0zF,WAAWpiF,GAIpB,GAAI+/E,GAAUrxF,KAEV2uF,EAAW3uF,KAAK8xF,gBAAgB/mF,IAAI,SAAAmhC,GAAA,MAAWmlD,GAAQoD,eAAevoD,IAG1E,OADAmlD,GAAQO,UAAW,EACZP,EACFxC,WAAWF,EAAUh/E,EAAM0hF,EAAQsD,eACnC/Q,OAAO,WACJyN,EAAQO,UAAW,IAEtB/N,KAAK,SAAC34C,EAAKrN,EAAQvsB,GAChB+/E,EAAQlwF,QAAQ,SACZ+pC,IAAKA,EACLrN,OAAQA,EACRvsB,SAAS,EAAA/R,EAAA7C,SAAG,wDAGnBs0B,KAAK,SAASpiB,EAAU0C,EAAS45B,GAC9BmmD,EAAQlwF,QAAQ,qBAAsByN,EAAU0C,EAAS45B,GACzDmmD,EAAQhN,OAAO,qBAAsBz1E,GACL,kBAArByiF,GAAQN,UACfM,EAAQN,SAAS9zF,KAAK+C,KAAM4O,EAAU0C,EAAS45B,MAO/D88C,gBAAiB,WAwBb,MAvBAhoF,MAAKU,GAAG,QAASV,KAAK40F,eAEtB50F,KAAK60F,KAAK,WAAY,WAClB70F,KAAKmB,QAAQ,mBAAoBnB,QAGrCA,KAAKU,GAAG,kBAAmB,SAAS8J,GAChCxK,KAAK8zF,yBAGT9zF,KAAKU,GAAG,mBAAoB,SAAS8J,GACjC,GAAI0hC,GAAU1hC,EAAKspC,OAAO5H,OAC1BlsC,MAAKg0F,kBAAkBxpF,EAAKspC,QAE5B9zC,KAAK8xF,gBAAkBl0F,EAAE02F,QAAQt0F,KAAK8xF,gBAAiB5lD,GAClDlsC,KAAK8xF,gBAAgBjxF,QACtBb,KAAKu0F,0BAONv0F,MAIX40F,cAAe,SAASpqF,GACpBxK,KAAK0B,MAAM8I,EAEX,IAAI6mF,GAAUrxF,KACVksB,EAAU1hB,EAAK8G,UAAW,EAAA/R,EAAA7C,SAAG,oBACjC,IAAI8N,EAAK0gC,IAAK,CACV,GAAIA,GAAM1gC,EAAK0gC,IACX55B,EAAU9G,EAAK8G,OACI,KAAnB45B,EAAI44C,YAAmC,IAAf54C,EAAIrN,OAC5B3R,SAAgB,EAAA3sB,EAAA7C,SAAG,qDAAsD,EAAA6C,EAAA7C,SACrE,gCAEGwuC,EAAI64C,aACX73D,kBAA0BpqB,KAAKC,UAAUmpC,EAAI64C,cAA7C,SAEA73D,QAAgB5a,EAGxB+/E,EAAQqC,WAAWxnE,EAAS,iBAGhCrN,QAEIi2E,mBAAoB,iBACpBC,mBAAoB,iBACpBC,mBAAoB,cACpBC,8BAA+B,aAE/BC,eAAgB,QAChBC,wBAAyB,wBAGzBC,6BAA8B,wBAK9BC,gCAAiC,oBACjCC,4BAA6B,gBAG7BC,oDAAqD,oBACrDC,oDAAqD,kBAGrDC,0BAA2B,cAC3BC,2BAA4B,qBAC5BC,yBAA0B,uBAC1BC,uBAAwB,gBACxBC,2BAA4B,gBAKhCjhE,MAAO,WACH50B,KAAKwxF,iBACLxxF,KAAKyxF,iBACLzxF,KAAKgc,UAIT85E,sBAAuB,SAAS/wF,GAC5B/E,KAAKwF,EAAE,4CAA4C0b,YAAY,YAC/DlhB,KAAKwF,EAAE,mDAAmD8B,QAY9DyuF,kBAAmB,SAAShxF,GAExBA,EAAG+hB,gBAEH,IAAI+sE,GAAQ7zF,KAAK6zF,OACjB7zF,MAAKg2F,oBAAoBnC,EAAO9uF,EAAG4pB,cAAcumB,QACjD,IAAI+gD,GAAWj2F,KAAKk2F,mBAAmBnxF,EAAG4pB,cAAcumB,QAGxDl1C,MAAKwF,EAAE,6BAA6B6f,QACpC,IAAI8wE,GAAe3wF,EAAE,+CAChBywF,GAASp1F,OAGVo1F,EAASvY,OAAOyY,GAFhBtC,EAAMlqF,OAAOwsF,IAOrBH,oBAAqB,SAASI,EAAUvnE,GACpC,GACIlU,GAASy7E,EAASz7E,SAClB+C,EAAY04E,EAAS14E,YACrB24E,EAAYxnE,EAAIlU,EAAOiF,IACvB02E,EAAY37E,EAAOiF,IAAMw2E,EAASzpD,cAAgB9d,CAClDwnE,IAAa,GAAKA,EAAYr2F,KAAKixF,eACnCmF,EAAS14E,UAAUA,EANA,GAOZ44E,GAAa,GAAKA,EAAYt2F,KAAKixF,gBAC1CmF,EAAS14E,UAAUA,EARA,IAe3Bw4E,mBAAoB,SAASrnE,GAKzB,IAAK,GAFD0nE,GAAMv2F,KAAKwF,EAAE,8CAA8CgxF,UAEtD9mF,EAAI,EAAGA,EAAI6mF,EAAI11F,OAAQ6O,IAAK,CACjC,GAAI+mF,GAAMjxF,EAAE+wF,EAAI7mF,IACZkQ,EAAM62E,EAAI97E,SAASiF,IACnB82E,EAAa19E,KAAK4+B,MAAM6+C,EAAI9pD,cAAgB,GAPvC,CAQT,IAAI/sB,EAAM82E,EAAa7nE,GAAKjP,EAAM82E,EAAa7nE,EAC3C,MAAO4nE,GAGf,MAAOjxF,MAIXmxF,cAAe,SAAS5xF,GAChBA,EAAG4pB,gBACH5pB,EAAKA,EAAG4pB,eAGZ5pB,EAAG+hB,iBACH/hB,EAAGuB,aAAaswF,WAAa,MAG7B,IAAIX,GAAWj2F,KAAKk2F,mBAAmBnxF,EAAGmwC,QAS1C,OARI+gD,GAASp1F,OACTb,KAAK2xF,UAAU7kD,aAAampD,GAG5Bj2F,KAAK2xF,UAAU1kD,YAAYjtC,KAAKwF,EAAE,4CAA4CglE,QAGlFxqE,KAAK62F,mBACE,GAIXA,gBAAiB,WACb,GAAIxF,GAAUrxF,KACV82F,IAEJ92F,MAAKwF,EAAE,4CAA4C+C,KAAK,WACpD,GAAIrI,GAAKsF,EAAExF,MAAMkG,KAAK,mBAElBgmC,EAAUtuC,EAAE0qB,UAAU+oE,EAAQS,iBAC9B5xF,GAAIA,GAGJgsC,GACA4qD,EAAY5pF,KAAKg/B,GAEjB/hC,QAAQzI,MAAM,oBAAqBxB,KAG3CF,KAAK8xF,gBAAkBgF,EACvB92F,KAAKwzF,eAITuD,kBAAmB,SAAShyF,EAAImnC,GAE5BA,EAAQzkC,QAAO,GACfzH,KAAK2xF,UAAY3xF,KAAKwF,EAAE,sDAI5BwxF,gBAAiB,SAASjyF,EAAImnC,GAC1B1mC,EAAE,6BAA6B6f,SAC/BrlB,KAAK2xF,UAAY,MAQrBl3D,UAAW78B,EAAEiC,UAAWyvF,EAAA5yF,QAAY8zF,uBAAuByG,mBAEvDzyE,OAAQ5mB,EAAEI,UAEF,qCACA,oDACA,EAAAuB,EAAA7C,SAAG,aACH,OACA,6BACA,oDACA,EAAA6C,EAAA7C,SAAG,QACH,OACA,SACA,SACA,wCACA,4DACA,WACA,EAAA6C,EAAA7C,SAAG,4BACH,wCACA,sCACA,UACFyB,KAAK,KAIXo1F,OAAQ31F,EAAEI,UAEF,6CACA,+CACA,WACA,EAAAuB,EAAA7C,SAAG,oCACH,MACA,EAAA6C,EAAA7C,SAAG,cACH,OACA,wDACA,WACA,EAAA6C,EAAA7C,SAAG,mCACH,MACA,EAAA6C,EAAA7C,SAAG,kBACH,OACA,SACA,8DACA,UACFyB,KAAK,KAIXsmB,OAAQ7mB,EAAEI,UAEF,iCACA,sBACA,6CACA,EAAAuB,EAAA7C,SAAG,0BACH,IACA,8DACA,WACA,SACA,sBACA,0DACA,iBACA,EAAA6C,EAAA7C,SAAG,wCACH,OACA,mDACA,EAAA6C,EAAA7C,SAAG,QACH,UACA,SACA,SAEA,gDACA,wCACA,oDACA,EAAA6C,EAAA7C,SAAG,UACH,YACA,8CACA,2EACA,EAAA6C,EAAA7C,SAAG,yCACH,+BACA,YACA,yCACA,oBACA,EAAA6C,EAAA7C,SAAG,+BACH,YACA,oBACA,EAAA6C,EAAA7C,SAAG,6CACH,YACA,QACA,SACA,SAEA,wCACA,sDACA,EAAA6C,EAAA7C,SAAG,eACH,YACA,SACA,UACFyB,KAAK,KAIXi1F,YAAax1F,EAAEI,UAEP,OACA,EAAAuB,EAAA7C,UAEQ,oGACA,sGACA,iEACFyB,KAAK,KAEX,OACA,OACA,QACA,EAAAoB,EAAA7C,UAEQ,8CACA,qEACFyB,KAAK,KAEX,QACA,QACA,EAAAoB,EAAA7C,UAEQ,mEACA,uEACFyB,KAAK,KAEX,QACA,QACA,EAAAoB,EAAA7C,UAEQ,+FACA,sGACA,yEACA,mEACFyB,KAAK,KAEX,QACA,QACA,EAAAoB,EAAA7C,UAEQ,oGACA,kBACFyB,KAAK,KAEX,QACA,QACA,EAAAoB,EAAA7C,UACK,wFAAwFyB,KACrF,KAGR,QACA,cACA,OACA,EAAAoB,EAAA7C,UAEQ,4FACA,gEACFyB,KAAK,KAEX,QACFA,KAAK,KAIX0zF,gBAAiBj0F,EAAEI,WAEX,EAAAuB,EAAA7C,SAAG,mEACH,mDACA,mEACA,kBACFyB,KAAK,KAIXq2F,eAAgB52F,EAAEI,UAEV,yCACA,EAAAuB,EAAA7C,SAAG,uBACH,EAAA6C,EAAA7C,SAAG,sBACH,+CACA,EAAA6C,EAAA7C,SAAG,cACH,QACA,SACFyB,KAAK,KAIX+0F,eAAgBt1F,EAAEI,UAEV,wCACA,2DACA,+BACA,mCACA,EAAAuB,EAAA7C,SAAG,kEACH,IACA,mDACA,mEACA,iBACA,8CACA,EAAA6C,EAAA7C,SAAG,6BACH,IACA,UACA,UACA,EAAA6C,EAAA7C,SAAG,qDACH,MACA,EAAA6C,EAAA7C,SAAG,oBACH,uDACA,EAAA6C,EAAA7C,SAAG,UACH,SACA,EAAA6C,EAAA7C,SAAG,6BACH,IACA,UACA,SACA,SACA,wCACA,gDACA,wCACA,oDACA,EAAA6C,EAAA7C,SAAG,UACH,YAEA,SACA,SACA,UACFyB,KAAK,OAMfqE,SAAU,WACN,MAAO,2BAQf00F,EAAyB,SAAiCvI,EAAUjwF,EAASy4F,GAC7E,GAEI9F,GAFAh/E,EAAW/V,EAAOgS,WAClB1E,EAAQV,OAAOU,OAAS,GAAIgzB,GAAAlgC,QAAS8M,IA2BzC,OAxBA9K,GAAUd,EAAEC,SAASa,OACjBiwF,SAAUA,EACVqC,SAAU,WACNpnF,EAAMtC,OACN+K,EAASgsB,OAAO,cAEpB0yD,SAAU,SAASM,EAASziF,GACxBhF,EAAMtC,OACN+K,EAASvD,QAAQF,MAIzByiF,EAAU,GAAI8F,GAAaz4F,GAC3BkL,EAAMvC,MACFqC,MAAOhL,EAAQgL,QAAS,EAAAnK,EAAA7C,SAAG,uBAC3BmN,KAAMwnF,EAAQ9sF,IACdmH,MAAO,MACP+P,OAAQ,OACR3R,gBAAgB,IAEpBunF,EAAQr1E,SACRrb,OAAOy2F,mBAAqB/F,EAGrBh/E,GAIPu8E,EAA6B,SAAqCD,EAAUjwF,GAG5E,MAFAA,GAAUA,MACVA,EAAQgL,OAAQ,EAAAnK,EAAA7C,SAAG,+CACZw6F,EAAuBvI,EAAUjwF,EAAS6xF,GhDknrBrDn0F,GAAQM,SgDrlrBJ8yF,6BAA8BA,EAC9Be,sBAAuBA,EAEvB2G,uBAAwBA,EACxBtI,2BAA4BA,EAC5BH,qBAAsBA,KhDwlrBGxxF,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAkBrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GiD1ptBvF,QAAS66F,GAAcC,GACnB,MAAO,UAAejyF,EAAY3G,GAO9B,MANIsB,MAAKK,UACL3B,EAAUA,MACVA,EAAQ4L,IAAStK,KAAKiT,QAAUjT,KAAKlB,IAAI,cAAzC,YACAuG,EAAaA,MACbA,EAAWuQ,KAAO,sBAEf0hF,EAAOr6F,KAAK+C,KAAMqF,EAAY3G,IjDkotB7C5B,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GiDjqtBX,IAAAu4F,GAAAl7F,EAAA,IjDsqtBIm7F,EAAoBj7F,EAAuBg7F,GiDrqtB/CE,EAAAp7F,EAAA,KjDyqtBIq7F,EAAwBn7F,EAAuBk7F,GiDxqtBnDn4F,EAAAjD,EAAA,GAWIs7F,GjDiqtBiBp7F,EAAuB+C,GiDjqtBxBo4F,EAAAh7F,QAAgBk7F,qBAEhCC,EAASL,EAAA96F,QAASo7F,sBAClBC,EAASP,EAAA96F,QAASs7F,sBAClBC,EAAeT,EAAA96F,QAASw7F,4BACxBC,EAAgBX,EAAA96F,QAAS07F,6BAmBzBzH,EAA+BkH,EAAOh4F,OAAO83F,GAAe93F,QAExDhC,SAAUD,EAAEiC,OAAOjC,EAAEy6F,MAAMR,EAAO96F,UAAUc,WACxCkxF,qBAAsB,qBACtBuJ,gBAAiB,OACjBl+D,YAAa,wCAIjB35B,KAAM42F,EAAcQ,EAAO96F,UAAU0D,MAGrC+B,SAAU,WACN,gBAAiBq1F,EAAO96F,UAAUyF,SAASvF,KAAK+C,SASxDu4F,EAA+BR,EAAOl4F,OAAO83F,GAAe93F,QAExDhC,SAAUD,EAAEiC,OAAOjC,EAAEy6F,MAAMN,EAAOh7F,UAAUc,WACxCkxF,qBAAsB,qBACtBuJ,gBAAiB,SACjBl+D,YAAa,wCAIjB35B,KAAM42F,EAAcU,EAAOh7F,UAAU0D,MAGrC+B,SAAU,WACN,gBAAiBu1F,EAAOh7F,UAAUyF,SAASvF,KAAK+C,SAOxDw4F,EAAqCP,EAAap4F,OAAO83F,GAAe93F,QACxEhC,SAAUD,EAAEiC,OAAOjC,EAAEy6F,MAAMJ,EAAal7F,UAAUc,WAC9CkxF,qBAAsB,qBACtBuJ,gBAAiB,cACjBl+D,YAAa,wCAIjB35B,KAAM42F,EAAcY,EAAal7F,UAAU0D,MAG3C+B,SAAU,WACN,gBAAiBy1F,EAAal7F,UAAUyF,SAASvF,KAAK+C,SAM1Dy4F,EAAsCN,EAAct4F,OAAO83F,GAAe93F,QAC1EhC,SAAUD,EAAEiC,OAAOjC,EAAEy6F,MAAMF,EAAcp7F,UAAUc,WAC/CkxF,qBAAsB,qBACtBuJ,gBAAiB,YACjBl+D,YAAa,wCAIjB35B,KAAM42F,EAAcc,EAAcp7F,UAAU0D,MAG5C+B,SAAU,WACN,6CAA8CxC,KAAKlB,IAAI,QAAvD,MjDirtBR1C,GAAQM,SiD3qtBJi0F,6BAA8BA,EAC9B4H,6BAA8BA,EAC9BC,mCAAoCA,EACpCC,oCAAqCA,KjD8qtBZx7F,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAGuB,EAAU7C,GAkBlD,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GkD9ytBX,IAAA05F,GAAAr8F,EAAA,KlDmztBIs8F,EAAiBp8F,EAAuBm8F,GkDlztB5CzlB,EAAA52E,EAAA,GlDsztBI62E,EAAY32E,EAAuB02E,GkDrztBvC3zE,EAAAjD,EAAA,GAgDIu8F,GlDywtBiBr8F,EAAuB+C,IkDvwtBxCzB,UACIu8B,YAAa,2BACby+D,mBAAoB,KACpBC,cAAe,KACfC,aAAc,MAIlBC,aAAc,SAAS3zF,GAOnB,MAJAzH,GAAEiC,OAAOwF,EAAYA,EAAW4zF,QAC5BC,WAAY7zF,EAAWnF,WAEpBmF,GAAW4zF,OACX5zF,GAIXmD,YAAa,SAASnD,EAAY3G,GAE9B2G,EAAarF,KAAKg5F,aAAa3zF,GAC/BrF,KAAKm5F,YAAc,aACnBh6F,EAASS,MAAM9B,MAAMkC,KAAMxC,YAI/B4E,MAAO,SAASwM,EAAUlQ,GACtB,GAAI2G,GAAauJ,CAEjB,OADAvJ,GAAarF,KAAKg5F,aAAa3zF,MAMnC+zF,EAA2Bj6F,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAS8C,eACzDK,OAAO+4F,GACP/4F,QAASH,cAAe,gBAIzB25F,EAAgBl6F,EAASgW,WAAWtV,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QAE/DH,cAAe,cAEfwB,MAAOk4F,EAGP52F,SAAU,WACN,OAAQ,sCAAuCxC,KAAKa,OAAQ,KAAK1C,KAAK,OAQ9Em7F,EAAaX,EAAAj8F,QAAc68F,mBAAmB15F,OAC9CqzE,EAAAx2E,QAASQ,MACL07F,GAGItuF,IAAK,WAED,MAAKtK,MAAK2yB,IAAI,cAKJzpB,OAAOC,KAAjB,iBAAsCnJ,KAAKlB,IAAI,cAA/C,aAAyEkB,KAAKlB,IAAI,OAJ9EqL,QAAQi6E,KAAK,oDAEHl7E,OAAOC,KAAjB,iBAKRtL,SAAUD,EAAEiC,UAER84F,EAAAj8F,QAAc68F,mBAAmBx8F,UAAUc,SAC3C+6F,EAA8B/6F,UAGlC27F,yBAA0B,WACtB,GAAIC,GAAUz5F,KAAKlB,IAAI,YACnB46F,EAAoB15F,KAAKlB,IAAI,qBAEjC,kBAAkB26F,EAAlB,YADmBz5F,KAAKlB,IAAI,kBAC5B,uBAAwE46F,GAO5ElxF,YAAa,SAASnD,EAAY3G,GAC9BsB,KAAK49B,MAAM,6BAA8Bv4B,EAAY3G,GAErDk6F,EAA8BpwF,YAAYvL,KAAK+C,KAAMqF,EAAY3G,IAIrEi7F,WAAY,WACR,MAAO35F,MAAK2uF,UAAY3uF,KAAK2uF,SAAS9tF,QAI1C2B,SAAU,WACOxC,KAAKlB,IAAI,qBACtB,kCASZ86F,EAAuBP,EAAcx5F,QAEjCqB,MAAOo4F,EAGP92F,SAAU,WACN,OAAQ,wBAAyBxC,KAAKa,OAAQ,KAAK1C,KAAK,OAchEgd,EAAoBhc,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAS8C,eAClDK,OAAOqzE,EAAAx2E,QAASgG,sBAChB7C,QAEOH,cAAe,cAGf7B,UAEIy6F,gBAAiB,KAEjB/F,SAAS,GAIb7B,gBAAiB2I,EAGjBv5F,WAAY,SAASoB,EAAOxC,GACxBsB,KAAK49B,MAAS59B,KAAd,kCAAqDkB,EAAOxC,EAASsB,MACrEA,KAAK2uF,SAAW3uF,KAAK65F,uBACrB75F,KAAKU,GAAG,kBAAmB,WACvBV,KAAKoK,IAAI,mBAETpK,KAAK2uF,SAAW3uF,KAAK65F,0BAK7BA,qBAAsB,WAClB75F,KAAK49B,MAAS59B,KAAd,wBAA2CA,KAAK0wF,gBAAiB1wF,KAAKlB,IAAI,YAAakB,KAAK2uF,SAE5F,IAAIA,GAAW3uF,KAAKlB,IAAI,eACxBkB,MAAK4W,MAAM,YAAcpW,QAAQ,GACjC,IAAI8H,GAAOtI,IAQX,OAPApC,GAAE2K,KAAKomF,EAAU,SAACziD,EAASt/B,GACvBhP,EAAEiC,OAAOqsC,GACL4tD,eAAgBxxF,EAAKxJ,IAAI,UAGjCkB,KAAK2uF,SAAW,GAAI3uF,MAAK0wF,gBAAgB/B,GAElC3uF,KAAK2uF,UAKhBhtF,OAAQ,WACJ,GAAIvD,GAAOe,EAASS,MAAM7C,UAAU4E,OAAO1E,KAAK+C,KAIhD,OAHIA,MAAK2uF,WACLvwF,EAAKuwF,SAAW3uF,KAAK2uF,SAAShtF,UAE3BvD,GAMX27F,aAAc,WACV,GAAIC,GAAYh6F,KAAKlB,IAAI,YACzB,OAAOkB,MAAKi6F,qBAAuBD,GAKvCL,WAAY,WACR,MAAgC,KAAzB35F,KAAK2uF,SAAS9tF,QAIzBq5F,mBAAoB,SAASpxF,GAEzB,MAAO9I,MAAK2uF,UAKhBvsF,MAAO,SAASwM,EAAUlQ,GACtB,GAAIy7F,GAASh7F,EAASS,MAAM7C,UAAUqF,MAAMnF,KAAK+C,KAAM4O,EAAUlQ,EAOjE,OANIy7F,GAAOC,cACPD,EAAOC,YAAc,GAAIt7B,MAAKq7B,EAAOC,cAErCD,EAAOE,cACPF,EAAOE,YAAc,GAAIv7B,MAAKq7B,EAAOE,cAElCF,GAIXG,OAAQ,SAAS57F,GACb,MAAIsB,MAAKlB,IAAI,WACFxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,GAAQ7zF,IAGxC67F,SAAU,SAAS77F,GACf,OAAKsB,KAAKlB,IAAI,YAAckB,KAAKlB,IAAI,UAC1BxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,GAAS7zF,IAIzCu7F,kBAAmB,WACf,MAAOj6F,MAAKlB,IAAI,YAAckB,KAAKlB,IAAI,WAK3C6D,kBAAmB,OAAQ,QAI3BH,SAAU,WAEN,4BADiBxC,KAAKlB,IAAI,MAAOkB,KAAKlB,IAAI,SAAWkB,KAAKlB,IAAI,uBACxBX,KAAK,KAA3C,OAQZ25F,EAAwB38E,EAAkBtb,QAGtC6wF,gBAAiBkJ,EAGjBp3F,SAAU,WACN,aAAc2Y,EAAkBpe,UAAUyF,SAASvF,KAAK+C,SAQhEg4F,EAAwBF,EAAsBj4F,QAG1C2C,SAAU,WACN,aAAc2Y,EAAkBpe,UAAUyF,SAASvF,KAAK+C,SAYhEw6F,EAAcr/E,EAAkBtb,OAChCqzE,EAAAx2E,QAASQ,MACL07F,GAMIpwF,YAAa,SAASnD,EAAY3G,GAC9BsB,KAAK49B,MAAM,8BAA+Bv4B,EAAY3G,GACtDk6F,EAA8BpwF,YAAYvL,KAAK+C,KAAMqF,EAAY3G,IAIrE8D,SAAU,WAEN,OAAQ,eADKxC,KAAKi5F,OAAL,GAAiBj5F,KAAKi5F,OAAWj5F,KAAKlB,IAAI,sBACvB,KAAKX,KAAK,QAStDs8F,EAAwBpB,EAAcx5F,QAGlCqB,MAAOs5F,EAGPh4F,SAAU,WACN,OAAQ,yBAA0BxC,KAAKa,OAAQ,KAAK1C,KAAK,OAQjEu8F,EAAkB1C,EAAsBn4F,OACxCqzE,EAAAx2E,QAASQ,MACL07F,GAQIpwF,YAAa,SAASnD,EAAY3G,GAC9BsB,KAAK49B,MAAM,kCAAmCv4B,EAAY3G,GAE1Dk6F,EAA8BpwF,YAAYvL,KAAK+C,KAAMqF,EAAY3G,IAIrE8D,SAAU,WAEN,OAAQ,mBADKxC,KAAKi5F,OAAL,GAAiBj5F,KAAKi5F,OAAWj5F,KAAKlB,IAAI,sBACnB,KAAKX,KAAK,QAS1Dw8F,EAA4BF,EAAsB56F,QAG9CqB,MAAOw5F,EAGPl4F,SAAU,WACN,OAAQ,6BAA8BxC,KAAKa,OAAQ,KAAK1C,KAAK,OAQrE+5F,EAA8B/8E,EAAkBtb,QAG5C6wF,gBAAiBiK,EAGjBn4F,SAAU,WACN,OAAQ,+BAAgCxC,KAAKlB,IAAI,QAAS,KAAKX,KAAK,OAO5Ey8F,EAAkB9C,EAAsBj4F,OACxCqzE,EAAAx2E,QAASQ,MACL07F,GAGIpwF,YAAa,SAASnD,EAAY3G,GAC9BsB,KAAK49B,MAAM,kCAAmCv4B,EAAY3G,GAC1Dk6F,EAA8BpwF,YAAYvL,KAAK+C,KAAMqF,EAAY3G,IAIrE8D,SAAU,WAEN,OAAQ,mBADKxC,KAAKi5F,OAAL,GAAiBj5F,KAAKi5F,OAAWj5F,KAAKlB,IAAI,sBACnB,KAAKX,KAAK,QAQ1D08F,EAA4BJ,EAAsB56F,QAElDqB,MAAO05F,EAGPp4F,SAAU,WACN,OAAQ,6BAA8BxC,KAAKa,OAAQ,KAAK1C,KAAK,OAMjEi6F,EAA+Bj9E,EAAkBtb,QAEjD6wF,gBAAiBmK,EAGjBr4F,SAAU,WACN,OAAQ,gCAAiCxC,KAAKlB,IAAI,QAAS,KAAKX,KAAK,MlDgytB7E/B,GAAQM,SkD1xtBJo7F,sBAAuBA,EACvBE,sBAAuBA,EACvBE,4BAA6BA,EAC7BE,6BAA8BA,KlD6xtBLn7F,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,YAGAS,QAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,IAEX5C,EAAQM,SmD5wuBJy6B,KAAM,YACN2jE,WAAY,YACZC,sBAAuB,cACvBC,YAAa,2BACbC,MAAO,anDkxuBL,SAAU9+F,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAU7C,EAAQsB,EAAG4H,GA8B1D,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GA5BvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GoD7xuBX,IAAAk8F,GAAA7+F,EAAA,IpDkyuBI8+F,EAAoB5+F,EAAuB2+F,GoDjyuB/CE,EAAA/+F,EAAA,IACAg/F,GpDoyuB2B9+F,EAAuB6+F,GoDpyuBlD/+F,EAAA,MpDwyuBIi/F,EAA8B/+F,EAAuB8+F,GoDvyuBzD54E,EAAApmB,EAAA,GpD2yuBIqmB,EAAUnmB,EAAuBkmB,GoD1yuBrCwwD,EAAA52E,EAAA,GpD8yuBI62E,EAAY32E,EAAuB02E,GoD7yuBvC3zE,EAAAjD,EAAA,GpDizuBIkD,EAAiBhD,EAAuB+C,GoDzyuBxCi8F,EAAUp8F,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,OACxDqzE,EAAAx2E,QAASQ,MACLg2E,EAAAx2E,QAASgG,sBAELhD,cAAe,UAGf87F,aAAc,IAGd39F,UACIu8B,YAAa,UACbl6B,GAAI,KACJyP,KAAM,kBACN+Y,MAAO,MAEP6pE,SAAS,EACTkJ,mBACAC,oBAGJzoF,QAAY/J,OAAOC,KAAnB,gBAEAwyF,cAAeR,EAAAz+F,QAAiBk/F,gBAGhCj5F,kBAAmB,OAAQ,aAAc,QAGzCC,eACI8G,MAAO,OACP8Z,IAAK,QAQT1jB,WAAY,SAAS+7F,EAAan9F,GAC9BA,EAAUA,MACVsB,KAAKP,OAASf,EAAQe,QAAU,KAChCO,KAAKoK,IAAOpK,KAAZ,eAAgC67F,EAAan9F,GAG7CsB,KAAKwyB,SAAW,GAAIxyB,MAAK27F,kBACrB/0D,QAAS5mC,KACT25E,UAAW35E,KAAKlB,IAAI,MACpBg9F,MAAOp9F,EAAQo9F,QAGnB97F,KAAKggF,kBACLhgF,KAAK+7F,4BAGL/7F,KAAKg8F,gBAAkB,MAM3Bhc,gBAAiB,WAEb,MAAOhgF,MAAKU,IACRgB,MAAO,SAASR,EAAOgqC,EAAKxsC,EAASuuE,EAAKgvB,GACtCj8F,KAAKk8F,sBAETC,YAAa,SAASj7F,EAAOk7F,GACrBp8F,KAAKwyB,WACLxyB,KAAKwyB,SAASmnD,UAAYyiB,OAO1CL,0BAA2B,WACvB,MAAK/7F,MAAKwyB,SAIHxyB,KAAK6rB,SAAS7rB,KAAKwyB,UACtB9wB,MAAO,WACH1B,KAAKmB,QAAQrD,MAAMkC,KAAM1D,EAAO+/F,UAAU7+F,eALvCwC,MAYfs8F,cAAe,WACX,GAAIC,GAAiBv8F,KAAKlB,IAAI,mBAC1B09F,EAAQD,EAAerjB,QAAU,CAGrC,OAFAsjB,IAASx8F,KAAKwyB,SAASiqE,eAAiBF,EAAehK,QAAU,EACjEiK,GAASx8F,KAAKwyB,SAASkqE,cAAgBH,EAAe13F,OAAS,GAKnE83F,UAAW,WACP,GAAIxvF,GAAOnN,KAAKlB,IAAI,OACpB,OAAOqO,GAAOuV,EAAAhmB,QAAMsuF,cAAc79E,GAAM,EAAM,IAAK,EAAA5N,EAAA7C,SAAG,YAI1DiF,OAAQ,WACJ,MAAO/D,GAAEiC,OAAOV,EAASS,MAAM7C,UAAU4E,OAAO1E,KAAK+C,OACjD28F,UAAW38F,KAAK28F,eAKxB79F,IAAK,SAASjC,GACV,MAAY,cAARA,EACOmD,KAAK28F,YAETx9F,EAASS,MAAM7C,UAAU+B,IAAIhB,MAAMkC,KAAMxC,YAOpDo/F,gBAAiB,WAEb,SAAK1zF,SAAWA,OAAOksE,SAInBlsE,OAAOksE,KAAKzB,eAAiBzqE,OAAOksE,KAAKl1E,KAAOF,KAAKlB,IAAI,aAOjE+9F,oBAAqB,WACjB,GAAIC,GAAmB98F,KAAKlB,IAAI,iBAChC,OAAOg+F,GAAmBA,EAAiBj8F,OAAS,GAIxDk8F,6BAA8B,WAC1B,MAAO/8F,MAAKwyB,SAASwqE,mBAAmBn8F,QAAU,GAItDo8F,+BAAgC,WAC5B,GAAIC,IAAuB,OAAQ,iBAAkB,kBAAmB,cACxE,OAAOl9F,MAAKiqB,OACRzf,KAAMhF,EAAEua,OACJ3F,KAAM8iF,EAAoB/+F,KAAK,UAM3Cg/F,QAAS,SAASz+F,GAAS,GAAA0+F,GAAAp9F,IAEvBtB,GAAUA,KAGV,IAAI2+F,GAAiBr9F,KAAKq9F,cAQ1B,OANAr9F,MAAKwyB,SAAS8qE,YAAa,GAEO,IAA9Bt9F,KAAKwyB,SAAS+qE,YACR,iBAAMH,GAAK5qE,SAASgrE,UAAUJ,EAAK5qE,SAAS+qE,cAC5C,iBAAMH,GAAK5qE,SAASirE,aAAaJ,OAE1BrsE,KAAK,SAACpiB,EAAUivB,EAAQqN,GACrC,GAAIwyD,EACJ,KACIA,EAAyB,GAAI5+B,MAAK5zB,EAAIyyD,kBAAkB,SAC1D,MAAO78F,IACTs8F,EAAKC,eAAiBK,GAA0B,GAAI5+B,MACpDs+B,EAAKQ,gBAAgBl/F,MAK7Bk/F,gBAAiB,SAASl/F,GAAS,GAAAm/F,GAAA79F,IAE/BtB,GAAUA,KACV,IAAI03C,GAAQp2C,KAAKw7F,YACjB,IAAKx7F,KAAKE,GAAV,CAIA,GAAI49F,GAAmB,WAEnBD,EAAK3B,qBACL2B,EAAK7B,gBAAkBnkF,WAAW,WAC9BgmF,EAAKV,QAAQz+F,IACd03C,GAIoBp2C,MAAK+8F,+BAEL,EACvBe,IAKA99F,KAAKi9F,iCAAiCjsE,KAAK,SAAA+sE,GAEnCF,EAAKhB,sBAAwB,EAC7BiB,IAGAD,EAAK18F,QAAQ,aAO7B+6F,mBAAoB,WACZl8F,KAAKg8F,kBACLriE,aAAa35B,KAAKg8F,iBAClBh8F,KAAKg8F,gBAAkB,OAM/B55F,MAAO,SAASwM,EAAUlQ,GACtB,GAAIy7F,GAASh7F,EAASS,MAAM7C,UAAUqF,MAAMnF,KAAK+C,KAAM4O,EAAUlQ,EAOjE,OANIy7F,GAAOC,cACPD,EAAOC,YAAc,GAAIt7B,MAAKq7B,EAAOC,cAErCD,EAAOE,cACPF,EAAOE,YAAc,GAAIv7B,MAAKq7B,EAAOE,cAElCF,GAIX6D,kBAAmB,SAASt/F,EAASu/F,GACjCv/F,EAAUA,KACV,IAAI4J,GAAOtI,IAOX,OAHAtB,GAAQL,KAAO,eAGR2B,KAAKiqB,MAAMvrB,GAASmM,KAAK,SAAqB+7B,GAGjD,MAFAt+B,GAAKkqB,SAASoU,QAAUt+B,EACxBA,EAAKkqB,SAAS0rE,aAAat3D,EAAQ1mC,IAC5BoI,EAAK61F,cAAcF,MAKlCE,cAAe,SAASz/F,GACpBA,EAAUA,KACV,IAAI4J,GAAOtI,IAIX,OADAsI,GAAK+0F,eAAiB,GAAIv+B,MACnBx2D,EAAKkqB,SAAS4rE,iBAAiB1/F,IAI1C6C,QAAS,SAAS7C,GACd,MAAIsB,MAAKlB,IAAI,WACFxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,GAAQ7zF,IAGxC2/F,MAAO,SAAS3/F,GACZ,MAAIsB,MAAKlB,IAAI,UACFxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,EAAMC,QAAQ,GAAQ9zF,IAGtD67F,SAAU,SAAS77F,GACf,MAAKsB,MAAKlB,IAAI,WAGPkB,KAAKS,MAAO8xF,SAAS,GAAS7zF,GAF1BpC,EAAOsO,QAWtBwF,KAAM,SAASzF,EAASgF,EAAM2uF,GAE1B,GADA3zF,MAAsBnJ,KAAZmJ,GAAwBA,GAC7B3K,KAAKE,GACN,KAAM,IAAIC,OAAM,iDAGpB,IAAIsjF,IAAa/J,WAAY15E,KAAKE,GAC9ByK,KACA84E,EAAS94E,SAAU,GAEnBgF,IACA8zE,EAAS9zE,KAAOA,GAEf2uF,IACD7a,EAAS8a,cAAe,GAE5B9a,EAASplF,KAAO,cAEhB,IAAIuoC,GAAU5mC,KACVoQ,EAAO9T,EAAOqnF,KAAK3jF,KAAKiT,QAASwwE,EAErC,OAAI94E,GACOyF,EAAKvF,KAAK,SAAA+D,GAEb,MADiB,IAAI2sF,GAAQ3sF,GACX4vF,eAAextE,KAAK,WAClC4V,EAAQzlC,QAAQ,SAAUylC,EAASh4B,OAIxCwB,EAAK4gB,KAAK,SAAApiB,GACbg4B,EAAQzlC,QAAQ,SAAUylC,EAASh4B,MAI3C4vF,aAAc,WACV,GAAI53D,GAAU5mC,KAEVkrC,EAAM5uC,EAAO4S,QAAWhG,OAAOC,KAAzB,6BAA0DnJ,KAAKE,GAKzE,OAHAgrC,GAAIla,KAAK,WACL4V,EAAQzlC,QAAQ,iBAAkBylC,KAE/BsE,GAIX1oC,SAAU,WACN,iBAAkBxC,KAAKlB,IAAI,MAA3B,IAAoCkB,KAAKlB,IAAI,QAA7C,QAOZ2/F,EAAmBnD,EAAA5+F,QAA4BgiG,8BAK/CC,EAAoBF,EAAiB5+F,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QACpEH,cAAe,UAEfwB,MAAOq6F,EAEPO,MAAO,cAEP8C,kBAAmB,GAEnBC,cAAe,GAEf/+F,WAAY,SAAS2V,EAAQ/W,GACzBA,EAAUA,MACVsB,KAAKoK,IAAI,+BAAgCqL,EAAQ/W,GACjD+/F,EAAiB1hG,UAAU+C,WAAW7C,KAAK+C,KAAMyV,EAAQ/W,GAGzDsB,KAAKy8F,eAAiB/9F,EAAQ+9F,iBAAkB,EAGhDz8F,KAAK8+F,iBAAmBpgG,EAAQogG,iBAEhC9+F,KAAK++F,kBAKT9rF,QAAY/J,OAAOC,KAAnB,gBACAmB,IAAK,WACD,MAAOtK,MAAKiT,SAIhB8rF,eAAgB,WACZ,MAAO/+F,MAAKU,IAERs+F,iBAAkB,SAASp4D,GAEvB5mC,KAAK49B,MAAM,iBAAkB59B,KAAKy8F,eAAgB71D,EAAQ9nC,IAAI,aACzDkB,KAAKy8F,gBAAkB71D,EAAQ9nC,IAAI,YACpCkB,KAAKqlB,OAAOuhB,IAIpBq4D,OAAQ,SAASC,EAAUC,GACvBn/F,KAAKo/F,WAAW,GAAI7D,GAAQ4D,QAGhCE,iBAAkB,SAASz4D,GACvB,GAAI04D,GAAet/F,KAAK8+F,gBACxB9+F,MAAKmB,QAAQ,oBAAqBm+F,GAClCt/F,KAAK8+F,iBAAmBl4D,EAAQ1mC,OAM5Cq/F,gBAAiB,SAAS7gG,GACtB,MAAOd,GAAEiC,OAAO4+F,EAAiB1hG,UAAUwiG,gBAAgBtiG,KAAK+C,KAAMtB,IAClEL,KAAM,kBAKdmhG,mBAAoB,SAAS9gG,GACzB,GAAI+gG,GAAehB,EAAiB1hG,UAAUyiG,mBAAmBviG,KAAK+C,KAAMtB,OACxEoK,IASJ,OARK9I,MAAKy8F,eAMN3zF,EAAQypF,QAAU,MALlBzpF,EAAQypF,SAAU,EAClBzpF,EAAQ0pF,QAAS,GAMd50F,EAAEC,SAAS4hG,EAAc32F,IAIpC42F,WAAY,SAAShhG,GACjB,GAAI4J,GAAOtI,KAEPkrC,EAAM1lC,EAAEoF,MAaZ,OAZI5K,MAAK8+F,mBACL5zD,EAAMuzD,EAAiB1hG,UAAU2iG,WAAWziG,KAAKqL,GAC7C9H,QAAQ,EACRm/F,MAAO,EACP72F,SAEI0pF,OAAQ,GACRD,QAAS,GACTqN,gBAAiB5/F,KAAK8+F,qBAI3B5zD,EAAIrgC,KAAK,WAGZ,MAFAnM,GAAUA,MACVA,EAAQic,OAAS,EACVrS,EAAKu3F,UAAUnhG,MAK9BohG,YAAaliG,EAAEiC,OAAOjC,EAAEy6F,MAAMoG,EAAiB1hG,UAAU+iG,cACrDnwF,KAAMujE,EAAAx2E,QAAS8B,gBAAgB,QAC3BG,WAAW,IAEfohG,WAAY7sB,EAAAx2E,QAAS8B,gBAAgB,QACjCG,WAAW,IAEfwO,KAAM+lE,EAAAx2E,QAAS8B,gBAAgB,QAC3BG,WAAW,IAEfqhG,WAAY9sB,EAAAx2E,QAAS8B,gBAAgB,QACjCG,WAAW,MAKnB4yB,KAAM,SAAS7yB,GACXA,EAAUA,KACV,IAAI8B,GAAS9B,EAAQ8B,OACjBy/F,EAAiBjgG,KAAKqlB,OAAOrlB,KAAKlB,IAAIkB,KAAK8+F,kBAM/C,OALAL,GAAiB1hG,UAAUw0B,KAAKt0B,KAAK+C,KAAMpC,EAAEC,UAAW2C,QAAQ,GAAQ9B,IACxEsB,KAAKrC,QAAQsiG,GAAkBz/F,QAAQ,IAClCA,GACDR,KAAKmB,QAAQ,OAAQnB,KAAMtB,GAExBsB,MAIX4yB,OAAQ,SAAgBpoB,EAAM01F,EAAMC,EAAgBC,GAEhD,GAAIt/E,GAAa9gB,IAGjB,OADU1D,GAAO4S,QAAWhG,OAAOC,KAAzB,8BACC6nB,KAAK,SAAAmuE,GACZr+E,EAAWs+E,WAAW,GAAI7D,GAAQ4D,KAAagB,WAQvDf,WAAY,SAASx4D,EAASloC,GAQ1B,MAPAA,GAAUA,MAEVsB,KAAKrC,QAAQipC,EAASloC,GACtBsB,KAAK8+F,iBAAmBl4D,EAAQ9nC,IAAI,MAC/BJ,EAAQ8B,QACTR,KAAKmB,QAAQ,cAAeylC,EAAS5mC,MAElCA,MAGXwC,SAAU,WACN,2BAA4BxC,KAAKa,OAAjC,YAAmDb,KAAK8+F,iBAAxD,MpDyzuBR1iG,GAAQM,SoDnzuBJ6+F,QAASA,EACToD,kBAAmBA,KpDszuBM1hG,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAGtB,EAAQ6C,GA8BhD,QAAS5C,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GA5BvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GqDn1vBX,IAAAq8F,GAAAh/F,EAAA,KrDw1vBIi/F,EAA8B/+F,EAAuB8+F,GqDv1vBzDgF,EAAAhkG,EAAA,KrD21vBIikG,EAAa/jG,EAAuB8jG,GqD11vBxCpR,EAAA5yF,EAAA,IrD81vBI6yF,EAAc3yF,EAAuB0yF,GqD71vBzCmM,EAAA/+F,EAAA,IrDi2vBIkkG,EAAuBhkG,EAAuB6+F,GqDh2vBlDnoB,EAAA52E,EAAA,GrDo2vBI62E,EAAY32E,EAAuB02E,GqDn2vBvCutB,EAAAnkG,EAAA,KrDu2vBIokG,EAAclkG,EAAuBikG,GqDp2vBrClJ,EAASgE,EAAA5+F,QAA4BgkG,oBASrC9E,EAAkBtE,EAAOz3F,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QACxDH,cAAe,UAGfihG,aAAc,IAGdC,yBAA0B,IAG1B9E,MAAO,MAGP7oF,QAAY/J,OAAOC,KAAnB,gBAGAmB,IAAK,WACD,MAAUtK,MAAKiT,QAAf,IAA0BjT,KAAK25E,UAA/B,aAIJ75E,WAAY,SAAS2V,EAAQ/W,GACzBA,EAAUA,MACV44F,EAAOv6F,UAAU+C,WAAW7C,KAAK+C,KAAMyV,EAAQ/W,GAE/CsB,KAAK4mC,QAAUloC,EAAQkoC,SAAW,KAClC5mC,KAAKk+F,aAAax/F,EAAQi7E,WAAa,MAEvC35E,KAAKy8F,eAAiB/9F,EAAQ+9F,gBAAkBz8F,KAAKy8F,eAErDz8F,KAAK08F,cAAgBh+F,EAAQg+F,eAAiB18F,KAAK08F,cAKnD18F,KAAKkB,MAAMnE,UAAUo8F,YAAc,WAKvCj4F,MAAO,SAAS2/F,EAAOniG,GACnB,GAAmC,YAA/BmiG,EAAM9R,qBACN,MAAO,IAAIuR,GAAA5jG,QAAUokG,0BAA0BD,EAAOniG,EACnD,IAAmC,uBAA/BmiG,EAAM9R,qBAA+C,CAC5D,OAAQ8R,EAAMvI,iBACV,IAAK,OACD,MAAO,IAAIpJ,GAAAxyF,QAAWi0F,6BAA6BkQ,EAAOniG,EAC9D,KAAK,SACD,MAAO,IAAIwwF,GAAAxyF,QAAW67F,6BAA6BsI,EAAOniG,EAC9D,KAAK,cACD,MAAO,IAAIwwF,GAAAxyF,QAAW87F,mCAAmCqI,EAAOniG,EACpE,KAAK,YACD,MAAO,IAAIwwF,GAAAxyF,QAAW+7F,oCAAoCoI,EAAOniG,GAMzE,GAAIuuE,+BAAkC4zB,EAAMvI,eAE5C,OADAnuF,SAAQi6E,KAAKnX,EAAK4zB,IACTE,gBAAiB9zB,GAE9B,OACI8zB,iDAAkDF,EAAM9R,uBAIhEmP,aAAc,SAAS9B,GACnBp8F,KAAK25E,UAAYyiB,EACjBp8F,KAAKghG,oBAITA,iBAAkB,SAASC,GAEvB,GAAKjhG,KAAK25E,UAmBV,MAhBA35E,MAAKkhG,QAAU,GAAIX,GAAA7jG,QAAcykG,cAC7BjhG,GAAIqgG,EAAA7jG,QAAcykG,aAAaC,kBAAkBphG,KAAK25E,aAE1D35E,KAAKmB,QAAQ,cAAenB,KAAKkhG,QAASlhG,MAE1CA,KAAKU,IACD2gG,kBAAmB,SAASC,GACxBthG,KAAKkhG,QAAQzE,eAAe6E,IAEhCC,iBAAkB,SAASD,GACvBthG,KAAKkhG,QAAQxE,cAAc4E,MAInCthG,KAAKy8F,eAAiBz8F,KAAKkhG,QAAQzE,mBAAoB,EACvDz8F,KAAK08F,cAAgB18F,KAAKkhG,QAAQxE,kBAAmB,EAC9C18F,MAKX8/F,YAAaliG,EAAEiC,OAAOjC,EAAEy6F,MAAMf,EAAOv6F,UAAU+iG,cAC3CnwF,KAAMujE,EAAAx2E,QAAS8B,gBAAgB,QAAUG,WAAW,IACpDohG,WAAY7sB,EAAAx2E,QAAS8B,gBAAgB,QACjCG,WAAW,IAEfyiC,IAAK8xC,EAAAx2E,QAAS8B,gBAAgB,OAASG,WAAW,IAClD6iG,UAAWtuB,EAAAx2E,QAAS8B,gBAAgB,OAASG,WAAW,MAI5D8iG,QAAS,WACL,MAAOzhG,MAAKwD,OAAO,SAAAolB,GAAA,OAAMA,EAAEmxE,kBAI/BiD,iBAAkB,WACd,MAAOh9F,MAAKwD,OACR,SAAAolB,GAAA,OACKA,EAAEmxE,gBACHnxE,EAAE9pB,IAAI,aAEL8pB,EAAE9pB,IAAI,cAQnB4iG,SAAU,SAAStgE,GAEf,MAAOphC,MAAKsoB,WAAY8Y,IAAKA,KAIjCugE,YAAa,WACT,MAAO3hG,MAAKgE,IAAI,SAAA4kB,GAAA,MAAKA,GAAE+wE,gBAK3B90F,OAAQ,WACJ,MAAO7E,MAAKwD,OAAO,SAAAolB,GAAA,MAAKA,GAAE/jB,YAI9B0tF,QAAS,WACL,MAAOvyF,MAAKwD,OAAO,SAAAolB,GAAA,MAAKA,GAAE9pB,IAAI,cAIlC8iG,oBAAqB,WACjB,MAAO5hG,MAAKwD,OACR,SAAAolB,GAAA,MACIA,GAAE9pB,IAAI,aAEL8pB,EAAE9pB,IAAI,cAKnB+iG,kBAAmB,SAASvhF,EAAS5hB,GACjC,GAAId,EAAEkkG,UAAUxhF,IAAYA,IAAYtgB,KAAKy8F,eAAgB,CAEzD,GADAz8F,KAAKy8F,eAAiBn8E,EAClB1iB,EAAEiS,OAAOnR,EAAS,UAClB,MAEJsB,MAAKmB,QAAQ,kBAAmBmf,EAAStgB,QAKjD+hG,iBAAkB,SAASzhF,EAAS5hB,GAChC,GAAId,EAAEkkG,UAAUxhF,IAAYA,IAAYtgB,KAAK08F,cAAe,CAGxD,GAFA18F,KAAK08F,cAAgBp8E,EACrB5hB,EAAUA,MACNd,EAAEiS,OAAOnR,EAAS,UAClB,MAEJsB,MAAKmB,QAAQ,iBAAkBmf,EAAStgB,QAOhDiqB,MAAO,SAASvrB,GAEZ,GADAA,EAAUA,MACNsB,KAAK25E,YAAcj7E,EAAQu9F,QAAS,CACpC,GAAIlmF,GAAQwqF,EAAA7jG,QAAcykG,aAAariG,IAAIkB,KAAK25E,WAAWh4E,QACtD/D,GAAEirF,QAAQ9yE,EAAMisF,eACjBtjG,EAAQu9F,QAAUr+F,EAAEmjC,OAAOhrB,EAAMisF,aAAa7jG,KAAK,MAG3D,MAAOm5F,GAAOv6F,UAAUktB,MAAMhtB,KAAK+C,KAAMtB,IAK7C6gG,gBAAiB,SAAS7gG,GACtB,MAAOd,GAAEiC,OAAOy3F,EAAOv6F,UAAUwiG,gBAAgBtiG,KAAK+C,KAAMtB,IACxDmlB,EAAG,SAKXo+E,aAAc3K,EAAOv6F,UAAUklG,aAAa7wF,QAGxC,IAEA,YAIJouF,mBAAoB,SAAS9gG,GACzB,GAAI+gG,GAAenI,EAAOv6F,UAAUyiG,mBAAmBviG,KAAK+C,KAAMtB,OAC9DoK,IAQJ,OAPK9I,MAAKy8F,iBACN3zF,EAAQypF,SAAU,EAClBzpF,EAAQ0pF,QAAS,GAEhBxyF,KAAK08F,gBACN5zF,EAAQ4hB,SAAU,GAEf9sB,EAAEC,SAAS4hG,EAAc32F,IAIpCo5F,kBAAmB,WACf,MAAOliG,MAAK4mC,QAAQ01D,iBAKxBmB,aAAc,SAAS0E,EAAOzjG,GAY1B,MAXIyjG,KACAzjG,EAAUA,IAAaoK,YACvBpK,EAAQ2mB,QAAS,EACjB3mB,EAAQoK,SACJs5F,iBAAkBD,EAAM5e,cAIxB74D,QAAS,KAGV1qB,KAAKiqB,MAAMvrB,IAItB2jG,aAAc,SAAS3jG,GAAS,GAAA0+F,GAAAp9F,IAU5B,OATAtB,GAAUA,MACVA,EAAQoK,QAAUlL,EAAEiC,OAAOnB,EAAQoK,SAE/BypF,SAAS,EACTC,WAAQhxF,KAEZ9C,EAAQ2mB,QAAS,EAEjBrlB,KAAKmB,QAAQ,mBAAoBnB,MAC1BA,KAAKiqB,MAAMvrB,GAASklF,OAAO,WAC9BwZ,EAAKj8F,QAAQ,wBAAbi8F,MAKRkF,YAAa,SAAS5jG,GAClBA,EAAUA,KACV,IAAI4J,GAAOtI,IAOX,OANAtB,GAAQoK,QAAUlL,EAAEiC,OAAOnB,EAAQoK,SAC/B4hB,SAAS,IAEbhsB,EAAQ2mB,QAAS,EAEjB/c,EAAKnH,QAAQ,kBAAmBmH,GACzBA,EAAK2hB,MAAMvrB,GAASklF,OAAO,WAC9Bt7E,EAAKnH,QAAQ,uBAAwBmH,MAK7Ci6F,gBAAiB,SAAS7jG,GACtBA,EAAUA,KACV,IAAI8jG,IAAgBvG,QAAS,MAE7B,OADAv9F,GAAQ8L,KAAO5M,EAAEiC,OAAOnB,EAAQ8L,SAAYg4F,GACrCxiG,KAAKiqB,MAAMvrB,IAItB+jG,sBAAuB,SAAS/jG,GAO5B,MANAA,GAAUA,MACVA,EAAQ0b,MAAQ,UAAW,iBAAiBjc,KAAK,KACjDO,EAAQoK,QAAUlL,EAAEiC,OAAOnB,EAAQoK,aAC/BimF,qBAAsB,uBAE1BrwF,EAAQ2mB,QAAS,EACVrlB,KAAKiqB,MAAMvrB,IAMtBgkG,iBAAkB,SAASC,EAAcC,GACrC,GAAIt6F,GAAOtI,KACPm5F,EAAc7wF,EAAKpH,MAAMnE,UAAUo8F,YACnC0J,GAAcD,EAElB,OAAOt6F,GAAK2hB,OAAQnhB,QAAS65F,EAAct9E,QAAQ,IAASxa,KAAK,SAAAi4F,GAM7D,MAJAA,GAAUA,EAAQpX,OAAO,SAACqX,EAAYC,EAAUtzF,GAC5C,GAAIxO,GAAQoH,EAAKxJ,IAAIkkG,EAAS7J,GAC9B,OAAOj4F,GAAQ6hG,EAAW3xF,OAAOlQ,GAAS6hG,OAEvCz6F,EAAK26F,UAAU,OAAQJ,EAAYC,MAKlDG,UAAW,SAASC,EAAQ7lG,EAAMyjB,GAE9B,MADAA,GAAaA,GAAc9gB,KAAKyV,OACzB,GAAIgrF,GAAA/jG,QAAWymG,UAClBriF,EACKvjB,QACA6lG,UACAr4F,IAAI,SAACmhB,EAASxc,GACX,GAAI49E,GAAK1vF,EAAEylG,SAASH,GAAUh3E,EAAQg3E,GAAUA,CAChD,OAAO,kBAAM5V,GAAGxvF,MAAMouB,EAAS7uB,OAEzCgV,UAINixF,0BAA2B,SAAS5kG,GAShC,QAAS6kG,GAAkB5oF,GACvBA,EAASA,GAAU,CACnB,IAAI6oF,GAAW5lG,EAAEiC,OAAOjC,EAAEy6F,MAAM35F,IAC5BL,KAAM,UACN+b,KAAMqpF,EACN9D,MAAOA,EACPhlF,OAAQA,EACRia,MAAkB,IAAXja,EACP0K,QAAQ,GAGZznB,GAAE8lG,MAAM,WACJp7F,EAAK2hB,MACAhtB,KAAKqL,EAAMk7F,GACX3f,KAAKxxE,EAASgsB,QACdrN,KAAK,SAAApiB,GACFyD,EAASsxF,OAAO/0F,EAAU+wF,EAAOhlF,GAC7B/L,EAAS/N,SAAW8+F,GACpBr3F,EAAKg1F,YAAa,EAClBjrF,EAASvD,QAAQF,EAAU+wF,EAAOhlF,IAElC4oF,EAAkB5oF,EAASglF,OA7B/CjhG,EAAUA,KACV,IAAI2T,GAAW/V,EAAOgS,WAClBhG,EAAOtI,KACP2/F,EAAQjhG,EAAQklG,cAAgBt7F,EAAKs4F,yBAErCj+F,EAAmB29F,EAAA5jG,QAAUokG,0BAA0B/jG,UAAU4F,iBACjE8gG,EAAa9gG,EAAiBxE,KAAK,IA6BvC,OADAolG,KACOlxF,GAIXwxF,WAAY,SAASC,GACjB,GAAIC,IAAwB,4BAA6B,sCACzD,OACInmG,GAAEomG,SAASF,IAAiBA,EAAa5jG,IAAMtC,EAAEsS,SAAS6zF,EAAsBD,EAAa1pE,cAKrGhqB,KAAM,SAAShS,GAEX,GAAI8B,GAEA0V,EACA8iB,CACA96B,GAAEylG,SAASjlG,IACX8B,EAAK9B,EACLs6B,EAAc,MACd9iB,EAAO,YAEP1V,EAAK9B,EAAK8B,GACVw4B,GAEQooE,0BAA2B,MAC3BmD,iCAAkC,OAClCC,oCAAqC,QACvC9lG,EAAKg8B,cAAgB,MAC3BxkB,EAAuB,SAAhB8iB,EAAyB,qBAAuB,UAE3D,IAAI5X,GAAa9gB,KAEbkrC,EAAM5uC,EACL+N,KAAKrK,KAAKsK,OACPrJ,OAAQ,OACRy3B,YAAa,mBACbluB,KAAM1I,KAAKC,WACPmqB,QAAShsB,EACT4zC,OAAQpb,EACR9iB,KAAMA,MAGbob,KAAK,SAAApiB,GACFkS,EAAWrX,KAAKmF,IAAaxM,OAAO,MAEvCyhF,KAAK,SAACniF,EAAOm8B,EAAQvsB,GAClBwP,EAAW3f,QAAQ,QAAS2f,EAAYoqB,KAAS,0BAC7Ct1B,KAAMA,EACN1V,GAAIA,EACJ4zC,OAAQpb,KAIpB,OAAOwS,IAIX8jD,WAAY,SAASmV,EAAoBC,EAAgBz0F,EAAMm/E,EAAiBpwF,GAe5E,MAXWsB,MAAKkB,OACZ6tF,qBAAsB,qBACtBuJ,gBAAiB8L,EACjB1qB,WAAY15E,KAAK25E,UACjBhqE,KAAMA,EACN00F,kBAAmBvV,IAAmB,EAGtCwV,oBAAqBH,IAGb1jG,KAAK/B,IAKrB6lG,kBAAmB,WACf,MACIvkG,MAAKs9F,YACLt9F,KAAKgE,IAAI,SACLkoB,GADK,MAKLtuB,GAAE+0B,IAAIzG,EAAQ7mB,WAAY,iBAMtC5B,QAAS,SAAS+gG,GACd,MAAOxkG,MAAKwD,OAAO,SAAA0oB,GAAA,MAAWA,GAAQzoB,QAAQ+gG,MAKlDnM,MAAO,WACH,GAAIA,GAAQl5F,EAASgW,WAAWpY,UAAUs7F,MAAMp7F,KAAK+C,KAErD,OADAq4F,GAAM1e,UAAY35E,KAAK25E,UAChB0e,GAIX71F,SAAU,WACN,OAAQ,oBAAqBxC,KAAK25E,UAAW35E,KAAKa,QAAQ1C,OAAQ,KAAKA,KAAK,MrDw2vBpF/B,GAAQM,SqDl2vBJk/F,gBAAiBA,KrDq2vBQ3+F,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAErCd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GsDj2wBX,IAAAi0E,GAAA52E,EAAA,GtDs2wBI62E,EAEJ,SAAgC12E,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFhDy2E,GsDh2wBnCkuB,EAAejuB,EAAAx2E,QAASiD,oBAAoBE,QAGxChC,UAEImkG,eACAyC,cAAc,EACdC,aAAa,GAIjBC,YAAa,SAASzjG,GAElB,GAAIyJ,GAAU3K,KAAKlB,IAAI,cACvB6L,GAAQzJ,EAAMhB,IAAMgB,EAAMpC,IAAI,MAC9BkB,KAAKS,KAAK,cAAekK,IAI7Bi6F,eAAgB,SAAS1jG,GACrB,GAAIyJ,GAAU3K,KAAKlB,IAAI,qBAChB6L,GAAQzJ,EAAMhB,IACrBF,KAAKS,KAAK,cAAekK,IAG7Bk6F,WAAY,SAASC,GACjB,MAAOlnG,GAAEiS,OAAO7P,KAAKlB,IAAI,eAAgBgmG,GAAW,IAGxDC,YAAa,WACT,MAAOnnG,GAAEmjC,OAAO/gC,KAAKlB,IAAI,iBAG7BkmG,cAAe,WACXhlG,KAAK4B,IAAI,mBAGb66F,eAAgB,SAAS9zF,GAMrB,MAHK/K,GAAEg2F,YAAYjrF,IACf3I,KAAK4B,IAAI,eAAgB+G,GAEtB3I,KAAKlB,IAAI,iBAGpB49F,cAAe,SAAS/zF,GAKpB,MAHK/K,GAAEg2F,YAAYjrF,IACf3I,KAAK4B,IAAI,cAAe+G,GAErB3I,KAAKlB,IAAI,gBAGpB0D,SAAU,WACN,sBAAuBxC,KAAKE,GAA5B,OAMJ+kG,iBAAkB,WAGlB7D,kBAAmB,SAA2BznB,GAC1C,IAAKA,EACD,KAAM,IAAIx5E,OAAJ,kDAA4Dw5E,EAGtE,OAAOwnB,GAAa8D,iBAAmBtrB,GAI3C76E,IAAK,SAAa66E,GACd,MAAO,IAAIwnB,IACPjhG,GAAIihG,EAAaC,kBAAkBznB,MAK3CurB,SAAU,SAAkBvrB,GACxB,IAAK,GAAI98E,KAAO+D,gBACuC,IAA/C/D,EAAIsF,QAAQg/F,EAAa8D,mBACzBrkG,eAAe0B,WAAWzF,KtD82wB9CT,GAAQM,SsDr2wBJykG,aAAcA,KtDw2wBWlkG,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,EAAGtB,GAcrD,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAZvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GuDp9wBX,IAAAi0E,GAAA52E,EAAA,GvDy9wBI62E,EAAY32E,EAAuB02E,GuDx9wBvC3zE,EAAAjD,EAAA,GAQI8oG,GvDo9wBiB5oG,EAAuB+C,GuDp9wBvBH,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QAC9DH,cAPe,OAafI,WAAY,SAASuF,GAEjBrF,KAAKolG,SAAW//F,EAAW+/F,WAAY,EACvCplG,KAAKoK,IAAI,eAAgBpK,KAAKolG,UAC9BplG,KAAKoH,YAAiC5F,KAAvB6D,EAAW+B,QAAwB/B,EAAW+B,QAAUpH,KAAKoH,SAKhFA,QAAS,OAKT4U,OAAQ,SAAS7U,GACb,GAAIk+F,GAAarlG,KAAKslG,iBAGtB,OAFAtlG,MAAKgoF,gBAAgBqd,GACrBrlG,KAAKulG,gBAAgBF,EAAYl+F,GAC1BnH,MAMXslG,gBAAiB,WAEb,GAAID,GAAa7/F,EAAExF,KAAKy6B,UAAU1c,GAAG/d,KAAKkB,MAAMS,SAAU3B,MAI1D,OAHIA,MAAKolG,UACLplG,KAAKwlG,SAASH,GAAYv6E,YAAY9qB,KAAKylG,iBAAiBp+F,QAEzDg+F,GAOXE,gBAAiB,SAASF,EAAYl+F,GAClCA,MAAkB3F,KAAV2F,EAAsBnH,KAAKoH,QAAUD,CAC7C,IAAI9I,GAAO2B,IAEG,KAAVmH,GACA9I,EAAKqnG,eAAeL,GACpBhnG,EAAK8C,QAAQ,WAAY9C,IAEzBmH,EAAEnH,GAAM8xC,MAAM,MACV,SAAAw1D,GACItnG,EAAKkG,IAAImpB,QAAQvmB,EAAOw+F,IAE5B,SAAAA,GACItnG,EAAKqnG,eAAeL,GACpBM,KAEJ,SAAAA,GACItnG,EAAKkG,IAAIqpB,OAAOzmB,EAAOw+F,IAE3B,SAAAA,GACItnG,EAAK8C,QAAQ,WAAY9C,GACzBsnG,QAOhBD,eAAgB,SAASL,GACrB,MAAOrlG,MAAKuE,IACPyjB,QACA9hB,KAAK,QAAStI,EAAEoH,WAAWhF,KAAK4gB,WAAa5gB,KAAK4gB,YAAc5gB,KAAK4gB,WACrEjX,OAAO07F,EAAWnmF,aAM3B8oE,gBAAiB,SAAS4d,GACtBA,EAASA,GAAU5lG,KAAKuE,IAGxBqhG,EAAO9+F,KAAK,WAAW2a,SAAUmJ,UAAW,YAKhD46E,SAAU,SAASI,GAEf,MADAA,GAASA,GAAU5lG,KAAKuE,IACjBqhG,EAAO9+F,KAAK,eAIvB2+F,eAAgB,WACZ,GAAII,GAAcrgG,EAAExF,KAAKy6B,UAAUwhE,QAAQj8F,KAAKkB,MAAMS,SAAU3B,MAEhE,OADAA,MAAKgoF,gBAAgB6d,GACdA,GAOXC,eAAgB,SAASC,GAOrB,MANAA,OAAoBvkG,KAAXukG,GAAwB/lG,KAAKolG,SAAWW,EAC7CA,EACA/lG,KAAK+lG,SAEL/lG,KAAKgmG,WAEFhmG,MAOX+lG,OAAQ,WACJ,GAAI1nG,GAAO2B,IACX,OAAO3B,GAAK4nG,qBAAqBriB,OAAO,WACpCvlF,EAAK6nG,aAObD,mBAAoB,WAChB,MAAKjmG,MAAKkB,MAAMy4F,aAGTr9F,EAAOsO,OAFH5K,KAAKkB,MAAM+oB,SAM1Bi8E,QAAS,WACL,GAAI7nG,GAAO2B,KACP6lG,EAAcxnG,EAAKonG,gBACvBpnG,GAAKmnG,WAAW16E,YAAY+6E,GAE5BxnG,EAAK+mG,UAAW,EAChB/mG,EAAKmnG,WAAWjqE,UAAUl9B,EAAK+I,QAAS,WACpC/I,EAAK8C,QAAQ,WAAY9C,MAOjC2nG,SAAU,WACNhmG,KAAK49B,MAAS59B,KAAd,4BACA,IAAI3B,GAAO2B,IACX3B,GAAK+mG,UAAW,EAChBplG,KAAKwlG,WAAWhqE,QAAQn9B,EAAK+I,QAAS,WAClC/I,EAAK8C,QAAQ,YAAa9C,SAiBlC8nG,EAAehB,EAAetlG,OAC9BqzE,EAAAx2E,QAASQ,MAAMg2E,EAAAx2E,QAAS+J,oBAAqBysE,EAAAx2E,QAAS0I,oBAClD8lB,QAAS,MACTtK,UAAW,YAGX9gB,WAAY,SAASuF,GACjB8/F,EAAepoG,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GAC/C6tE,EAAAx2E,QAAS+J,oBAAoB3G,WAAW7C,KAAK+C,KAAMqF,GACnD6tE,EAAAx2E,QAAS0I,mBAAmBtF,WAAW7C,KAAK+C,KAAMqF,GAClDrF,KAAKggF,mBAITA,gBAAiB,WAab,MAXAhgF,MAAKU,GACD,aACA,SAAS0lG,GACDA,EACApmG,KAAKwF,EAAE,oBAAoB8B,OAE3BtH,KAAKwF,EAAE,oBAAoB6B,QAGnCrH,MAEGA,MAKXslG,gBAAiB,WACb,GAAID,GAAaF,EAAepoG,UAAUuoG,gBAAgBroG,KAAK+C,KAK/D,OAJAqlG,GAAWnmF,SAAS,aAAa4L,YAAY9qB,KAAKqmG,mBAClDhB,EAAWnmF,SAAS,cAAc4L,YAAY9qB,KAAKsmG,mBACnDjB,EAAWnmF,SAAS,oBAAoBvV,OAAO3J,KAAKumG,yBACpDlB,EAAWv+F,KAAK,0BAA0BgkB,YAAY9qB,KAAKwmG,mBACpDnB,GAIXK,eAAgB,SAASL,GAQrB,MAPAF,GAAepoG,UAAU2oG,eAAezoG,KAAK+C,KAAMqlG,GAC/CrlG,KAAK0G,YACL1G,KAAKkH,aAAa,GAElBlH,KAAKsF,WACLtF,KAAK2F,cAEF3F,KAAKuE,KAIhB8hG,gBAAiB,WACb,GAAIhoG,GAAO2B,KACPymG,EAAYjhG,EAAE,gCACdpH,EAAOC,EAAK6C,MAAMS,QAKtB,OAHA/D,GAAE2K,KAAKlK,EAAKo8B,UAAUisE,SAAU,SAAAxoG,GAC5BuoG,EAAU98F,OAAOnE,EAAEtH,EAAWE,EAAMC,OAEjCooG,GAIXH,gBAAiB,WACb,MAAO9gG,GAAExF,KAAKy6B,UAAUksE,SAAS3mG,KAAKkB,MAAMS,SAAU3B,QAI1DumG,sBAAuB,WAEnB,UAIJC,gBAAiB,WACb,MAAOhhG,GAAExF,KAAKy6B,UAAUmsE,SAAS5mG,KAAKkB,MAAMS,SAAU3B,QAK1D6e,QAEIgoF,mBAAoB,iBACpBC,qBAAsB,mBACtBC,kBAAmB,gBAIvBC,eAAgB,SAAS3gG,GACrBA,EAAMgb,kBACFhb,EAAM4gG,QACNjnG,KAAKuH,aAAalB,GACbrG,KAAK0G,YACN1G,KAAKkH,gBAGTlH,KAAK8lG,kBAKboB,iBAAkB,SAAS7gG,GAKvB,OACIA,GACe,YAAfA,EAAMuP,MALU,KAMfvP,EAAMic,SAJU,KAImBjc,EAAMic,UAE1CtiB,KAAK8lG,iBACLz/F,EAAMgb,mBACC,IAOf7e,SAAU,WAEN,uBADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,OAOZilG,GAAappG,UAAU09B,UAAa,WA8ChC,OACI1c,GA9Cam1D,EAAAx2E,QAASqB,cACtB,6BAEA,+BAGA,yBACA,6CACA,SAEA,sCACA,gCAGA,8BACA,WAgCA2oG,YACAC,SA5BmBzzB,EAAAx2E,QAASqB,cAGxB,6CAEA,mCACA,sBACA,gDACA,SACA,+BACA,UAEJ,WAiBA6oG,SAdmB1zB,EAAAx2E,QAASqB,cAE5B,iCAaAk+F,QAVkB/oB,EAAAx2E,QAASqB,cAE3B,mCAuBR,IAAIopG,GAAsBhB,EAAatmG,QAKnCunG,aAAc,UAEdC,kBAAmB,KAMnBvnG,WAAY,SAASuF,GACS,cAAtBrF,KAAKonG,eACLpnG,KAAKolG,UAAW,GAEpBplG,KAAKonG,aAAe/hG,EAAW+hG,cAAgBpnG,KAAKonG,aACpDpnG,KAAKqnG,kBAAoBhiG,EAAWgiG,mBAAqBrnG,KAAKqnG,kBAE9DlB,EAAappG,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GAC7CrF,KAAKsnG,QAAUtnG,KAAKunG,uBAIxB9B,eAAgB,WACZ,GAA0B,cAAtBzlG,KAAKonG,aACL,MAAO5hG,IAEX,IAAIqgG,GAAcM,EAAappG,UAAU0oG,eAAexoG,KAAK+C,KAC7D,OAAOA,MAAKwnG,eAAexnG,KAAKsnG,QAASzB,IAI7C0B,oBAAqB,WACjB,GAAIrmG,GAAQlB,KAAKkB,MACbumG,EAAeznG,KAAK0nG,sBAAsBxmG,GAC1CxC,EAAUsB,KAAK2nG,wBAAwBzmG,EAQ3C,OANc,IAAIumG,GACd7pG,EAAEiC,OAAOnB,GACLwC,MAAOA,MAQnBwmG,sBAAuB,WAEnB,MAAO1nG,MAAKqnG,mBAIhBM,wBAAyB,WACrB,OAEIP,aAAcpnG,KAAKonG,aACnBhgG,QAASpH,KAAKoH,UAKtBogG,eAAgB,SAASF,EAASM,GAI9B,MAHAA,GAAWA,GAAY5nG,KAAKwF,EAAE,cAC9BxF,KAAKsnG,QAAUA,EAAQtrF,OAAO,GAC9BsrF,EAAQ9hG,EAAE,eAAe8B,OAClBsgG,EAASj+F,OAAO29F,EAAQ/iG,MAInCwhG,OAAQ,WACJ,GAAI1nG,GAAO2B,IACX,OAAO3B,GAAK4nG,qBAAqBriB,OAAO,WACV,YAAtBvlF,EAAK+oG,aACL/oG,EAAK6nG,UACwB,cAAtB7nG,EAAK+oG,cACZ/oG,EAAKwpG,wBASjBA,mBAAoB,WAChB,GAAIxpG,GAAO2B,IAEX3B,GAAKwtB,SAASxtB,EAAKipG,QAAS,QAAS,WACjCjpG,EAAK8C,QAAQ,sBAAuB9C,EAAMA,EAAKipG,WAEnDjpG,EAAK8C,QAAQ,qBAAsB9C,EAAMA,EAAKipG,WAMtDH,GAAoBpqG,UAAU09B,UAAa,WACvC,GAAIqtE,GAAkB50B,EAAAx2E,QAASqB,cAEvB,wBAEA,UAEJ,aAGJ,OAAOH,GAAEiC,UAAWsmG,EAAappG,UAAU09B,WACvCwhE,QAAS6L,OvDy7wBjB1rG,EAAQM,SuDn7wBJyoG,eAAgBA,EAChBgB,aAAcA,EACdgB,oBAAqBA,KvDs7wBIlqG,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAGtB,EAAQ6C,EAAUqG,GA0B1D,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAxBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GwDp7xBX,IAAA+oG,GAAA1rG,EAAA,IxDy7xBI2rG,EAAazrG,EAAuBwrG,GwDx7xBxC5Y,EAAA9yF,EAAA,IxD47xBI+yF,EAAW7yF,EAAuB4yF,GwD37xBtC8Y,EAAA5rG,EAAA,IxD+7xBI6rG,EAAiB3rG,EAAuB0rG,GwD97xB5Ch1B,EAAA52E,EAAA,GxDk8xBI62E,EAAY32E,EAAuB02E,GwDj8xBvC3zE,EAAAjD,EAAA,GxDq8xBIkD,EAAiBhD,EAAuB+C,GwD37xBxCg4F,EAAS0Q,EAAAtrG,QAAUypG,aAInBgC,EAAsB7Q,EAAOz3F,QAEzBH,cAdW,UAgBXkhB,UAAc02E,EAAOv6F,UAAU6jB,UAA/B,WAEA1gB,GAAI,WACA,OAAQ,UAAWF,KAAKkB,MAAMpC,IAAI,OAAOX,KAAK,MAIlD2B,WAAY,SAASuF,GACbA,EAAW5F,SACXO,KAAKP,OAASO,KAAKkB,MAAMzB,OAAS4F,EAAW5F,QAEjDO,KAAKoK,IAAOpK,KAAZ,eAAgCqF,GAChCiyF,EAAOv6F,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GAGvCrF,KAAKwzB,WAAanuB,EAAWmuB,YAAc,UAI/CwsD,gBAAiB,WACbsX,EAAOv6F,UAAUijF,gBAAgB/iF,KAAK+C,KACtC,IAAIsI,GAAOtI,IAGX,OAAOsI,GAAKujB,SAASvjB,EAAKpH,OACtB0kB,OAAQ,SAAS1kB,GAGToH,EAAKpH,MAAMknG,oBAAoB1/E,OAC/BpgB,EAAKpH,MAAM64F,gBACXzxF,EAAK88F,WACJ98F,EAAKpH,MAAMy4F,aAKZrxF,EAAKpH,MAAM+oB,OAAQzpB,QAAQ,IAAQwwB,KAAK,WACpC1oB,EAAK0T,WAGLpe,EAAE+0B,IAAIzxB,EAAM0tC,QAAS,SAA4C,IAAjChxC,EAAEwc,KAAKlZ,EAAM0tC,SAAS/tC,OAItDyH,EAAK9C,EAAE,aAAa4Z,KAAK9W,EAAK+/F,mBAE9B//F,EAAK0T,aAWzBiqF,mBAAoB,WAChB,GAAI5nG,GAAO2B,IACX,OAAI3B,GAAK6C,MAAM64F,iBAAmB17F,EAAK6C,MAAMy4F,aAClCt7F,EAAK6C,MAAM+oB,OAAQzpB,QAAQ,IAE/BlE,EAAOsO,QAQlBya,OAAQ,SAASle,EAAO0a,GACpB,GAAIxjB,GAAO2B,IACXmH,GAAQA,GAASnH,KAAKoH,QACtBpH,KAAKuE,IAAImpB,QAAQvmB,EAAO,WACpBhI,EAASqK,KAAKzM,UAAUsoB,OAAOpoB,KAAKoB,GAChCwjB,GACAA,EAAS5kB,KAAKoB,MAe1BqnG,eAAgB,SAASL,GAKrB,MAJA/N,GAAOv6F,UAAU2oG,eAAezoG,KAAK+C,KAAMqlG,GACvCrlG,KAAKkB,MAAMyxB,IAAI,UACf3yB,KAAKuE,IAAIyY,SAAT,SAA2Bhd,KAAKkB,MAAMpC,IAAI,UAEvCkB,KAAKuE,KAKhBgiG,sBAAuB,WAEnB,OAAQvmG,KAAKsoG,yBAIjBA,qBAAsB,WAElB,GAAI5/E,GAAQ1oB,KAAKkB,MAAMpC,IAAI,QAC3B,IAAI4pB,IAAU0mE,EAAA1yF,QAAOogF,cAAgBp0D,IAAU0mE,EAAA1yF,QAAOqgF,YAAc/8E,KAAKkB,MAAMpC,IAAI,cAC/E,MAAO,KAGX,IAAIypG,IACAtpF,OAAQjf,KAAKwzB,WACbkrD,QAAS,cAIb,IAAI1+E,KAAKkB,MAAMpC,IAAI,UACfypG,EAAet8E,UAAW,EAC1Bs8E,EAAe7+F,OAAQ,EAAAnK,EAAA7C,SAAG,iDAGvB,IAAIgsB,IAAU0mE,EAAA1yF,QAAO4/E,OACxBisB,EAAet8E,UAAW,EAC1Bs8E,EAAe7+F,OAAQ,EAAAnK,EAAA7C,SAAG,kEAGvB,IAAIgsB,IAAU0mE,EAAA1yF,QAAOggF,IACxB6rB,EAAet8E,UAAW,EAC1Bs8E,EAAe7+F,OAAQ,EAAAnK,EAAA7C,SAAG,wCACvB,CACH6rG,EAAe7+F,OAAQ,EAAAnK,EAAA7C,SAAG,aAG1B6rG,EAAeviF,KAAOhmB,KAAKkB,MAAMsnG,KAAK9qE,OAGtC,IAAIp1B,GAAOtI,IACXuoG,GAAexhF,QAAU,SAAAhiB,GACjBmE,OAAOoV,OAASpV,OAAOoV,MAAM46D,SAE7BhwE,OAAOoV,MAAMk7D,WAAWlxE,EAAKpH,MAAMpC,IAAI,OACvCiG,EAAG+hB,mBAKf,MADAyhF,GAAe5pB,OAAS,UACjB,EAAAupB,EAAAxrG,SAAa6rG,IAOxB9C,eAAgB,WAIZ,GAAIzlG,KAAKkB,MAAMpC,IAAI,WAAaswF,EAAA1yF,QAAOogF,aACnC,MAAOt3E,GAAExF,KAAKy6B,UAAUguE,SAASzoG,KAAKkB,MAAMS,SAAU3B,MAG1D,IAAIwlG,GAAWlO,EAAOv6F,UAAU0oG,eAAexoG,KAAK+C,KAYpD,OAXAwlG,GACK1+F,KAAK,kBACLkhB,QACAre,OAAO3J,KAAK0oG,2BACjBlD,EACK1+F,KAAK,YACLsY,KAAKpf,KAAK2oG,kBACV1qE,QAAQj+B,KAAK4oG,yBAClBpD,EAAS1+F,KAAK,yBAAyBsY,KAAKpf,KAAK6oG,8BAEjD7oG,KAAKgoF,gBAAgBwd,GACdA,GAIXmD,eAAgB,WACZ,GAAIvqG,GAAO4B,KAAKkB,MAAMS,SAClBmnG,EAAkB9oG,KAAKy6B,UAAUsuE,UAAU3qG,EAAKsqB,MAEpD,QADAogF,EAAkBA,GAAmB9oG,KAAKy6B,UAAUsuE,UAAUC,SACvC5qG,EAAM4B,OAIjC4oG,sBAAuB,WACnB,GAAIvqG,GAAO2B,KACPymG,EAAYjhG,EAAE,uCACdpH,EAAOC,EAAK6C,MAAMS,QAKtB,OAHA/D,GAAE2K,KAAKlK,EAAKo8B,UAAUwuE,eAAgB,SAAA/qG,GAClCuoG,EAAU98F,OAAOnE,EAAEtH,EAAWE,EAAMC,OAEjCooG,GAIXoC,2BAA4B,WACxB,MAAI7oG,MAAKkB,MAAM+4F,oBACJ,IAIPj6F,KAAKy6B,UAAUyuE,oBAAoBlpG,KAAKkB,MAAMpC,IAAI,gBAAiBkB,MACnEA,KAAKy6B,UAAUyuE,oBAAoBlpG,KAAKkB,MAAMpC,IAAI,iBAAkBkB,OACtE7B,KAAK,KAKXuqG,wBAAyB,WAErB,OADA1oG,KAAK49B,MAAM,2BACH59B,KAAKkB,MAAMpC,IAAI,UACnB,IAAKswF,GAAA1yF,QAAOogF,aACR,QACJ,KAAKsS,GAAA1yF,QAAO8lB,GACZ,IAAK4sE,GAAA1yF,QAAOmgF,gBACZ,IAAKuS,GAAA1yF,QAAOsgF,MACR,OAAQh9E,KAAKmpG,wBAAyBnpG,KAAKopG,2BAEnD,OAAQppG,KAAKopG,4BAMjBA,wBAAyB,WAErB,OAAO,EAAAlB,EAAAxrG,UACHgN,OAAO,EAAAnK,EAAA7C,SAAG,gBACVgiF,QAAS,aACT14D,KAAMhmB,KAAKkB,MAAMsnG,KAAKa,YACtBpqF,OAAQjf,KAAKwzB,WACbmrD,OAAQ,iBACR53D,QAAS,SAAShiB,GACVmE,OAAOoV,OAASpV,OAAOoV,MAAM46D,SAC7BhwE,OAAOoV,MAAM7U,KACTC,MAAO,kBACPY,IAAKtK,KAAKgmB,OAEdjhB,EAAG+hB,iBACH/hB,EAAGsc,uBASnB8nF,sBAAuB,WAEnB,MAAInpG,MAAKkB,MAAMpC,IAAI,YAAckB,KAAKkB,MAAMooG,UACjC,KAKN1rG,EAAEirF,QAAQ7oF,KAAKkB,MAAMpC,IAAI,eAIvB0G,GAEC,oCACA,SACAxF,KAAKkB,MAAMsnG,KAAKe,SAHpB,aAIgB,EAAAhqG,EAAA7C,SAAG,YAJnB,cAKI,uCACA,QACFyB,KAAK,KAXA6B,KAAKwpG,iCAgBpBA,8BAA+B,WAC3B,GAAIhB,GAAOxoG,KAAKkB,MAAMsnG,IACtB,OAAOhjG,IAEC,2CACA,oFAFJ,YAGe,EAAAjG,EAAA7C,SAAG,YAHlB,KAII,uCACA,OACA,kEANJ,gBAOoB8rG,EAAKe,SAPzB,eAQI,EAAAhqG,EAAA7C,SAAG,oBACH,YACAkB,EAAEmN,IAAI/K,KAAKkB,MAAMpC,IAAI,cAAe,SAAA2qG,GAAA,OAE5B,gBACAjB,EAAKkB,cAAgBD,EAAUziB,UAC/B,MACA,EAAAznF,EAAA7C,SAAG,YACH,IACA+sG,EAAUziB,UACV,aACF7oF,KAAK,MACTA,KAAK,MACP,QACA,UACFA,KAAK,QAIfkqG,gBAAiB,WAUb,MATUzqG,GAAEI,UAEJ,gFACA,wCACA,4DACA,UACA,aACFG,KAAK,MAEE2pF,KAAM9nF,KAAKkB,MAAMpC,IAAI,WAItC+f,OAAQjhB,EAAEiC,OAAOjC,EAAEy6F,MAAMf,EAAOv6F,UAAU8hB,SACtC8qF,qBAAsB,SAAS5kG,GAC3B/E,KAAKmB,QAAQ,UAAWnB,KAAM+E,IAElC6kG,oBAAqB,SAAS7kG,GAC1B/E,KAAKmB,QAAQ,SAAUnB,KAAM+E,IAEjC8kG,sBAAuB,SAAS9kG,GAC5B/E,KAAKmB,QAAQ,WAAYnB,KAAM+E,MAMvCvC,SAAU,WAEN,8BADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZinG,GAAoBprG,UAAU09B,UAAa,WAGvC,GAAIisE,GAAW9oG,EAAEiC,UAAWy3F,EAAOv6F,UAAU09B,UAAUisE,UACnDoD,gBAAiB52B,EAAAx2E,QAASqB,cAEtB,iDACA,qCACA,EAAAwB,EAAA7C,SAAG,2DACH,SACA,YAEJgF,MAAOwxE,EAAAx2E,QAASqB,cAEZ,2BACA,mCACA,EAAAwB,EAAA7C,SAAG,wDACH,uBACA,SACA,YAEJ81F,OAAQtf,EAAAx2E,QAASqB,cACb,4BACA,gDACA,EAAAwB,EAAA7C,SAAG,uDACH,SACA,YAEJ61F,QAASrf,EAAAx2E,QAASqB,cAEd,8CACA,iDACA,EAAAwB,EAAA7C,SAAG,iCACH,SACA,cAMJorG,EAAkB50B,EAAAx2E,QAASqB,cAEvB,wBACA,8BAEA,8BACA,2BACA,4BACA,SAGA,mDACA,mCACA,yCAEA,2CAEA,4BACA,sDACA,UACA,UACA,UAEJ,WAGAgsG,EAAmB72B,EAAAx2E,QAASqB,cAExB,wBACA,yBACA,EAAAwB,EAAA7C,SAAG,mDACH,SACA,UAEJ,WAIAstG,IACJA,GAAiB5a,EAAA1yF,QAAO8lB,IAAMwnF,EAAiB5a,EAAA1yF,QAAOmgF,iBAAmB3J,EAAAx2E,QAASqB,cAE1E,kCACA,sBACA,uDACA,SACA,UAEA,gCACA,yBACA,0BACA,EAAAwB,EAAA7C,SAAG,UACH,WACA,qDACA,SACA,UAEA,sCACA,sBACA,0BACA,EAAA6C,EAAA7C,SAAG,YACH,WACA,uBACA,gCACA,UACA,SACA,UAEA,iCACA,qBACA,sDACA,SACA,WAEJ,WAEJstG,EAAiB5a,EAAA1yF,QAAOggF,KAAOxJ,EAAAx2E,QAASqB,cACnC,SAAS,EAAAwB,EAAA7C,SAAG,mEAAoE,UACjF,WAEJstG,EAAiB5a,EAAA1yF,QAAOogF,cAAgB5J,EAAAx2E,QAASqB,cAC5C,SAAS,EAAAwB,EAAA7C,SAAG,mDAAoD,UACjE,WAEJstG,EAAiB5a,EAAA1yF,QAAOqgF,WAAa7J,EAAAx2E,QAASqB,cACzC,SAAS,EAAAwB,EAAA7C,SAAG,iEAAkE,UAC/E,WAEJstG,EAAiB5a,EAAA1yF,QAAO6/E,QAAUrJ,EAAAx2E,QAASqB,cACtC,SAAS,EAAAwB,EAAA7C,SAAG,8BAA+B,UAC5C,WAEJstG,EAAiB5a,EAAA1yF,QAAO8/E,SAAWtJ,EAAAx2E,QAASqB,cACvC,SAAS,EAAAwB,EAAA7C,SAAG,iCAAkC,UAC/C,WAEJstG,EAAiB5a,EAAA1yF,QAAO4/E,QAAUpJ,EAAAx2E,QAASqB,cACtC,SAAS,EAAAwB,EAAA7C,SAAG,uCAAwC,UACrD,WAEJstG,EAAiB5a,EAAA1yF,QAAO+/E,kBAAoBvJ,EAAAx2E,QAASqB,cAChD,SAAS,EAAAwB,EAAA7C,SAAG,mCAAoC,UACjD,WAEJstG,EAAiB5a,EAAA1yF,QAAOkgF,QAAU1J,EAAAx2E,QAASqB,cACtC,SAAS,EAAAwB,EAAA7C,SAAG,kFAAmF,UAChG,WAEJstG,EAAiB5a,EAAA1yF,QAAOsgF,OAAS9J,EAAAx2E,QAASqB,cAElC,+BACA,uCACA,UACA,4BACA,EAAAwB,EAAA7C,SAAG,uCACH,WACA,8DAEJ,WAEJstG,EAAiB5a,EAAA1yF,QAAOigF,OAASzJ,EAAAx2E,QAASqB,cACrC,SAAS,EAAAwB,EAAA7C,SAAG,WAAY,4CACzB,WAEJstG,EAAiBhB,QAAU91B,EAAAx2E,QAASqB,cAC/B,mEACD,UAIJ,IAAIksG,IACAC,YAAah3B,EAAAx2E,QAASqB,cAElB,iCACA,kDACA,EAAAwB,EAAA7C,SAAG,sDACH,SACA,aAKJytG,EAA8Bj3B,EAAAx2E,QAASqB,cAEnC,uCACA,oCACA,sEACA,2CACA,6CACA,0DACA,kCACA,QACA,YACA,UACA,SACA,aAEJ,OAGJ,OAAOH,GAAEiC,UAAWy3F,EAAOv6F,UAAU09B,WACjCisE,SAAUA,EACVzK,QAAS6L,EACTW,SAAUsB,EACVhB,UAAWiB,EACXf,eAAgBgB,EAChBf,oBAAqBiB,OxDgwxB7B/tG,EAAQM,SwD1vxBJyrG,oBAAqBA,KxD6vxBIlrG,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAG4H,EAAGlJ,GAsB3C,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GyD10yBX,IAAA+oG,GAAA1rG,EAAA,IzD+0yBI2rG,EAAazrG,EAAuBwrG,GyD90yBxCqC,EAAA/tG,EAAA,IzDk1yBIguG,EAAc9tG,EAAuB6tG,GyDj1yBzCn3B,EAAA52E,EAAA,GzDq1yBI62E,EAAY32E,EAAuB02E,GyDp1yBvC3zE,EAAAjD,EAAA,GzDw1yBIkD,EAAiBhD,EAAuB+C,GyDr1yBxC6nG,EAAsBa,EAAAtrG,QAAUyqG,oBAEhChB,EAAe6B,EAAAtrG,QAAUypG,aAGzBmE,EAAiBnD,EAAoBtnG,QAEjC+gB,UAAcumF,EAAoBpqG,UAAU6jB,UAA5C,sBACA1gB,GAAI,WACA,OAAQ,qBAAsBF,KAAKkB,MAAMpC,IAAI,OAAOX,KAAK,MAI7D2B,WAAY,SAASuF,GACjBrF,KAAKwzB,WAAanuB,EAAWmuB,YAAc,SAC3CxzB,KAAKuqG,QAAUllG,EAAWklG,QAC1BpD,EAAoBpqG,UAAU+C,WAAW7C,KAAK+C,KAAMqF,IAIxD26E,gBAAiB,WACbmnB,EAAoBpqG,UAAUijF,gBAAgB/iF,KAAK+C,MACnDA,KAAK6rB,SAAS7rB,KAAKkB,MAAO,SAAU,SAASA,EAAOxC,GAE5Cd,EAAE+0B,IAAIzxB,EAAM0tC,QAAS,WACrB5uC,KAAKgc,SAIEpe,EAAE+0B,IAAIzxB,EAAM0tC,QAAS,kBAC5B5uC,KAAKwF,EAAE,0BAA0BslB,YAAY9qB,KAAKwmG,sBAO9DA,gBAAiB,WACb,MAAOhhG,GAAExF,KAAKy6B,UAAUmsE,SAAS5mG,KAAKkB,MAAMS,SAAU3B,QAK1D2nG,wBAAyB,WACrB,GAAIjpG,GAAUyoG,EAAoBpqG,UAAU4qG,wBAAwB1qG,KAAK+C,KACzE,OAAOpC,GAAEiC,OAAOnB,GACZ80B,WAAYxzB,KAAKwzB,WACjB+2E,QAASvqG,KAAKuqG,WAKtB3jG,UAAW,WACP,MAAO5G,MAAKwF,EAAE,gBAKlBhD,SAAU,WAEN,yBADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZopG,GAAevtG,UAAU09B,UAAa,WAClC,GAAIisE,GAAW9oG,EAAEiC,UAAWsnG,EAAoBpqG,UAAU09B,UAAUisE,UAChEhlG,MAAOwxE,EAAAx2E,QAASqB,cAEZ,2BACA,mCACA,EAAAwB,EAAA7C,SAAG,2DACH,uBACA,SACA,YAEJ81F,OAAQtf,EAAAx2E,QAASqB,cACb,4BACA,gDACA,EAAAwB,EAAA7C,SAAG,0DACH,SACA,YAEJ61F,QAASrf,EAAAx2E,QAASqB,cAEd,8CACA,iDACA,EAAAwB,EAAA7C,SAAG,oCACH,SACA,cAKJ8tG,EAAmBt3B,EAAAx2E,QAASqB,cAExB,6CACA,sBACA,oFACA,SACA,+BACA,UAEJ,cAIA0sG,EAAmBv3B,EAAAx2E,QAASqB,cAExB,yBACA,2FACA,6DACA,EAAAwB,EAAA7C,SAAG,sCACH,+DACA,EAAA6C,EAAA7C,SAAG,sBACH,oEACA,EAAA6C,EAAA7C,SAAG,2CACH,kEACA,EAAA6C,EAAA7C,SAAG,2CACH,UACA,UAEJ,aAGJ,OAAOkB,GAAEiC,UAAWsnG,EAAoBpqG,UAAU09B,WAC9CisE,SAAUA,EACVC,SAAU6D,EACV5D,SAAU6D,MAOlB,IAAIC,GAAkBvE,EAAatmG,QAG3B+gB,UAAculF,EAAappG,UAAU6jB,UAArC,8BAGA9gB,WAAY,SAASuF,GACbA,EAAW5F,SACXO,KAAKP,OAASO,KAAKkB,MAAMzB,OAAS4F,EAAW5F,QAEjDO,KAAKoK,IAAI,8BAA+B/E,GACxC8gG,EAAappG,UAAU+C,WAAW7C,KAAK+C,KAAMqF,IAKjD7C,SAAU,WAEN,0BADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZwpG,GAAgB3tG,UAAU09B,UAAa,WAEnC,GAAI+vE,GAAmBt3B,EAAAx2E,QAASqB,cAExB,6CACA,sBACA,8DACA,SACA,+BACA,UAEJ,UAGJ,OAAOH,GAAEiC,UAAWsmG,EAAappG,UAAU09B,WACvCksE,SAAU6D,MAQlB,IAAIG,GAAyBN,EAAA3tG,QAAWyrG,oBAAoBtoG,QAEpD+gB,UAAcypF,EAAA3tG,QAAWyrG,oBAAoBprG,UAAU6jB,UAAvD,8BAGA9gB,WAAY,SAASuF,GACbA,EAAW5F,SACXO,KAAKP,OAASO,KAAKkB,MAAMzB,OAAS4F,EAAW5F,QAEjDO,KAAKoK,IAAI,qCAAsC/E,GAC/CglG,EAAA3tG,QAAWyrG,oBAAoBprG,UAAU+C,WAAW7C,KAAK+C,KAAMqF,IAMnE4gG,mBAAoB,WAChB,GAAI5nG,GAAO2B,IACX,OAAI3B,GAAK6C,MAAM64F,iBAAmB17F,EAAK6C,MAAMy4F,aAClCt7F,EAAK6C,MAAM+oB,OAAQzpB,QAAQ,IAE/BlE,EAAOsO,QAKlBpI,SAAU,WAEN,iCADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZypG,GAAuB5tG,UAAU09B,UAAa,WAG1C,GAAI+vE,GAAmBt3B,EAAAx2E,QAASqB,cAExB,6CACA,mCACA,sBACA,8DACA,SACA,UAEJ,UAGJ,OAAOH,GAAEiC,UAAWwqG,EAAA3tG,QAAWyrG,oBAAoBprG,UAAU09B,WACzDksE,SAAU6D,MAQlB,IAAII,GAA0BN,EAAezqG,QAErC+gB,UAAc0pF,EAAevtG,UAAU6jB,UAAvC,8BAGA8kF,eAAgB,SAASL,GACrBiF,EAAevtG,UAAU2oG,eAAezoG,KAAK+C,KAAMqlG,EACnD,IAAI38E,GAAQ1oB,KAAKkB,MAAMpC,IAAI,UAAY,IAEvC,OADAkB,MAAKuE,IAAIyY,SAAT,SAA2B0L,GACpB1oB,KAAKuE,KAKhB/B,SAAU,WAEN,kCADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MzD6xyBZ9E,GAAQM,SyDtxyBJ4tG,eAAgBA,EAChBI,gBAAiBA,EACjBC,uBAAwBA,EACxBC,wBAAyBA,KzDyxyBA3tG,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,GAc/C,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAZvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G0DtjzBX,IAAA6rG,GAAAxuG,EAAA,I1D2jzBIyuG,EAAavuG,EAAuBsuG,G0D1jzBxCziG,EAAA/L,EAAA,G1D8jzBIsgC,EAAWpgC,EAAuB6L,G0D7jzBlCoB,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,SAASpB,GACjBsB,KAAKkB,MAAQ,GAAI/B,GAASS,MAAMlB,GAChCsB,KAAKsK,IAAMtK,KAAKkB,MAAMpC,IAAI,OAC1BkB,KAAKg+B,SAAWh+B,KAAKkB,MAAMpC,IAAI,YAC/BkB,KAAK4e,WAAW,UAChB5e,KAAKgc,UAGTA,OAAQ,WACJ,GAAI1T,GAAOtI,IACXwF,GAAE6E,MACEC,IAAKpB,OAAOC,KAAOnJ,KAAKsK,IACxBsL,KAAM,QAELob,KAAK,SAAApiB,GACF,GAAIlQ,GAAU8G,EAAE3F,UAAWyI,EAAKpH,MAAMmE,WAAYuJ,GAC9CquB,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAOhL,EAAQgL,MACf4H,QAAS5S,EAAQ4S,QACjBusB,OAAQn/B,EAAQm/B,QAAU,UAC1B7R,KAAMttB,EAAQstB,KACd+K,OAAQr4B,EAAQq4B,OAChBhtB,SACIkb,OAAQ,GAAI0X,GAAAjgC,QAAGmiC,QACXpd,QAAS/iB,EAAQqsG,eACjBrhG,MAAOhL,EAAQssG,cAAgB,OAC/Bh/E,KAAMttB,EAAQusG,aAAe,UAC7BnsE,IAAK,iCACL/X,QAAS,WACLze,EAAK4iG,QAAQjuE,QAK7B30B,GAAK/D,IAAIyjB,QAAQre,OAAOszB,EAAK14B,OAEhCs/E,KAAK,SAAAj1E,GACFtG,EAAK/D,IAAIyjB,QAAQre,OACb,GAAIgzB,GAAAjgC,QAAGwhC,SACH5sB,mCAAoChJ,EAAKgC,IAAzC,IACAuzB,OAAQ,SACRM,YAAY,IACb55B,QAKnB2mG,QAAS,SAASjuE,GACd,GAAI30B,GAAOtI,IACXwF,GAAE6E,MACEC,IAAKpB,OAAOC,KAAOb,EAAKgC,IACxBE,KAAM1I,KAAKC,UAAUk7B,EAAKzyB,KAAKooB,UAC/Bhd,KAAM,MACN8iB,YAAa,qBAEZ1H,KAAK,SAAApiB,GACF,GAAIu8F,IACA75F,QAAS1C,EAAS0C,QAClBusB,OAAQ,UACRM,YAAY,EAEZ71B,GAAK01B,SACLr9B,OAAOqoB,SAAc9f,OAAOC,KAAOb,EAAK01B,SAAxC,IAAoDx4B,EAAEua,MAAMorF,IAE5DluE,EAAKzyB,KAAK4gG,WAAWx8F,EAAU,SAACqS,EAAOgf,GACnChD,EAAKyD,WAAWT,GAAUjhC,MAAMiiB,EAAMjiB,SAE1CsJ,EAAK+iG,aAAapuE,EAAMkuE,MAG/BtnB,KAAK,SAAAj1E,GACFtG,EAAK+iG,aAAapuE,GACd3rB,QAAS1C,EAASm1E,aAAahmD,QAC/BF,OAAQ,SACRM,YAAY,OAK5BktE,aAAc,SAASpuE,EAAMv+B,GACZu+B,EAAK14B,IACbiZ,UACAha,OAAO,WACJ,OAA+D,IAAvD,OAAQ,UAAUrB,QAAQqD,EAAExF,MAAMyd,IAAI,eAEjDiX,QACE5D,SAAUpT,UAAW,GAAK,KACjCuf,EAAK3rB,QAAQqtB,OAAOjgC,K1D6jzB5BtC,GAAQM,S0DxjzBJ8M,KAAMA,K1D2jzBmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAG/E,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACC,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CAEH,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAGtB,GAkBlD,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G2DnszBX,IAAAmwF,GAAA9yF,EAAA,I3DwszBI+yF,EAAW7yF,EAAuB4yF,G2DvszBtClc,EAAA52E,EAAA,G3D2szBI62E,EAAY32E,EAAuB02E,G2D1szBvC3zE,EAAAjD,EAAA,G3D8szBIkD,EAAiBhD,EAAuB+C,G2D1szBxCgsG,EAAkBp4B,EAAAx2E,QAASgG,qBAK3B62F,EAAqBp6F,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,OACnEqzE,EAAAx2E,QAASQ,MACLouG,GAEI5rG,cAXO,UAcP7B,UACI6qB,MAAO0mE,EAAA1yF,QAAOggF,IACd6V,SAAS,EACTC,QAAQ,EACR7iF,KAAM,oBACN47F,YAAY,EAEZ9gG,UAAW,GACX2T,SAAU,GACV2oE,UAAW,EAGXykB,cAEAC,WAAY,GACZC,UAAW,GAEX5jB,SAOJhoF,WAAY,SAASuF,EAAY3G,GAC7BsB,KAAK49B,MAAS59B,KAAd,uBAA0CqF,EAAY3G;;AAGjDsB,KAAKlB,IAAI,eACVkB,KAAK4B,IAAI,QAASwtF,EAAA1yF,QAAOogF,cAI7B98E,KAAKwoG,KAAOxoG,KAAK2rG,gBAEjB3rG,KAAKggF,mBAIT2rB,cAAe,WACX,GAAIzrG,GAAKF,KAAKlB,IAAI,KAClB,KAAKoB,EACD,QAEJ,IAAIsoG,IACAnK,kBAAmBn+F,EAAnB,eACAw9B,oBAAqBx9B,EAArB,yBACA0rG,iCAAkC1rG,EAClCqpG,qBAAsBrpG,EAAtB,WAAmCF,KAAKw5F,2BACxCqS,kCAAmC3rG,EACnC63B,8BAA+B73B,EAC/BmpG,wBAAyBnpG,EAAzB,eACA4rG,cAAe,gBACfpC,kDAAmDxpG,EAAnD,kBAMJ,OAJAtC,GAAE2K,KAAKigG,EAAM,SAACxpG,EAAOnC,GACjB2rG,EAAK3rG,GAAOqM,OAAOC,KAAOnK,IAE9BgB,KAAKwoG,KAAOA,EACLA,GAGXhP,yBAA0B,WACtB,iBAAkBx5F,KAAKlB,IAAI,aAM/BkhF,gBAAiB,WAEbhgF,KAAKU,GAAG,eAAgB,SAASqrG,EAAWC,GACxChsG,KAAKoK,IAAOpK,KAAZ,sBAAuC+rG,EAAWC,GAC9ChsG,KAAK+5F,gBACL/5F,KAAKmB,QAAQ,cAAe4qG,EAAWC,EAAUhsG,KAAKisG,SAAS,YAIvEjsG,KAAKU,GAAG,4BAA6B,SAASqrG,GAC1C/rG,KAAK2rG,mBAMbhqG,OAAQ,WACJ,GAAIvD,GAAOe,EAASS,MAAM7C,UAAU4E,OAAO1E,KAAK+C,KAGhD,OAAOpC,GAAEiC,OAAOzB,GACZoqG,KAAMxoG,KAAKwoG,QAKnBvO,kBAAmB,WACf,MAAOj6F,MAAKlB,IAAI,YAAckB,KAAKlB,IAAI,WAM3Ci7F,aAAc,WACV,GAAIlkB,GAAQj4E,EAAEsS,SAASk/E,EAAA1yF,QAAOugF,aAAcj9E,KAAKlB,IAAI,SACrD,OAAOkB,MAAKi6F,qBAAuBpkB,GAIvC8jB,WAAY,WAER,OAAK35F,KAAKlB,IAAI,eAGPkB,KAAK2yB,IAAI,eAIpB22E,QAAS,WACL,MAAOtpG,MAAKlB,IAAI,aAAe,GAInCmrB,MAAO,SAASvrB,GACZ,GAAI4O,GAAUtN,IACd,OAAOb,GAASS,MAAM7C,UAAUktB,MAAMhtB,KAAK+C,KAAMtB,GAASklF,OAAO,WAC7Dt2E,EAAQq+F,mBAKhBvpG,MAAO,SAASwM,EAAUlQ,GACtB,GAAIy7F,GAASh7F,EAASS,MAAM7C,UAAUqF,MAAMnF,KAAK+C,KAAM4O,EAAUlQ,EAOjE,OANIy7F,GAAOC,cACPD,EAAOC,YAAc,GAAIt7B,MAAKq7B,EAAOC,cAErCD,EAAOE,cACPF,EAAOE,YAAc,GAAIv7B,MAAKq7B,EAAOE,cAElCF,GAIX15F,KAAM,SAASogG,EAAOniG,GAGlB,MAFAA,GAAUA,MACVA,EAAQ+/B,OAAO7gC,EAAEg2F,YAAYl1F,EAAQ+/B,OAAe//B,EAAQ+/B,KACrDt/B,EAASS,MAAM7C,UAAU0D,KAAKxD,KAAK+C,KAAM6gG,EAAOniG,IAK3D47F,OAAQ,SAAS57F,GACb,MAAIsB,MAAKlB,IAAI,WACFxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,GAAQ7zF,IAGxC67F,SAAU,SAAS77F,GACf,OAAKsB,KAAKlB,IAAI,YAAckB,KAAKlB,IAAI,UAC1BxC,EAAOsO,OAEX5K,KAAKS,MAAO8xF,SAAS,GAAS7zF,IAIzC2/F,MAAO,SAAgB3/F,GAEnB,GAAIsB,KAAKlB,IAAI,UACT,MAAOxC,GAAOsO,MAElBlM,GAAUA,MACVA,EAAQ4L,IAAMtK,KAAKwoG,KAAKnK,KAIxB,IAAI6N,GAAMlsG,KAENkrC,EAAM5uC,EAAO+N,KAAK3L,EAoBtB,OAnBAwsC,GAAIla,KAAK,SAAC1f,EAASusB,EAAQsuE,GACvBD,EAAItqG,KAAM2wF,SAAS,EAAMC,QAAQ,MAErCtnD,EAAI24C,KAAK,SAAC34C,EAAKrN,EAAQvsB,GAGnB,GAAI5P,IAAQ,EAAAnC,EAAA7C,SAAG,0BAGXwuC,GAAI64C,cAAgB74C,EAAI64C,aAAariF,MACrCA,EAAQwpC,EAAI64C,aAAariF,OACwD,IAA1EwpC,EAAI84C,aAAa7hF,QAHxB,yEAIAT,EAJA,uEAMJwpC,EAAI84C,aAAetiF,EACnBwqG,EAAI/qG,QAAQ,QAAS+qG,EAAKhhE,EAAKxsC,GAAS,EAAAa,EAAA7C,SAAGgF,IACvCA,MAAOA,MAGRwpC,GAKXvoC,kBAAmB,OAAQ,WAAY,eAAgB,aAAc,YAAa,aAAc,QAMhGC,eACI8G,MAAO,OACP0iG,OAAQ,WACRC,SAAU,eACVC,MAAO,aACPx1E,YAAa,aACbqtD,KAAM,YACN3gE,IAAK,QAKThhB,SAAU,WACN,GAAI+pG,GAAYvsG,KAAKlB,IAAI,OAAS,EAIlC,OAHIkB,MAAKlB,IAAI,UACTytG,MAAgBvsG,KAAKlB,IAAI,QAAzB,KAAqCytG,GAEzC,WAAkBA,EAAlB,QASZC,EAA+BrtG,EAASgW,WAAWtV,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QAE9EH,cA1PW,UA4PXwB,MAAOq4F,EAGPtmF,QAAY/J,OAAOC,KAAnB,eAGAmB,IAAK,WACD,MAAOtK,MAAKiT,SAOhBw5F,IAAK,WACD,MAAOzsG,MAAK+K,IAAI,SAAAkb,GAAA,MAAQA,GAAKnnB,IAAI,SAMrC4tG,SAAU,WACN,MAAO1sG,MAAKwD,OAAO,SAAA0oB,GAAA,OAAYA,EAAQ6tE,kBAI3C4H,YAAa,WACT,MAAO3hG,MAAKgE,IAAI,SAAAsJ,GAAA,MAAWA,GAAQqsF,gBAKvCsJ,UAAW,SAASC,EAAQxkG,GACxB,GAAI2T,GAAW/V,EAAOgS,WAClBq+F,EAAiB3sG,KAAKa,OACtByxE,IAEJ,KAAKq6B,EAED,MADAt6F,GAASvD,YACFuD,CAIX,IAAIu6F,GAAU5sG,KAAK6sG,QACdzJ,UACAr4F,IAAI,SAACuC,EAASoC,GAAV,MAAgB,YACjB,GAAIw7B,GAAMg4D,EAAOjmG,KAAKqQ,EAAS5O,EAE/BwsC,GAAIla,KAAK,SAAApiB,GACLyD,EAASsxF,QACLmJ,KAAMp9F,EACN29E,MAAOsf,EACP/9F,SAAUA,EACV1N,MAAOoM,MAKf49B,EAAI04C,OAAO,SAAAh1E,GACP0jE,EAAUplE,KAAK0B,GACXg+F,EAAQ/rG,OACR+rG,EAAQ3/F,UAERoF,EAASvD,QAAQwjE,QAI5BtzE,OAIL,OAFA4tG,GAAQ3/F,UAEDoF,GAKX5O,QAAS,SAAS+gG,GACd,MAAOxkG,MAAKwD,OAAO,SAAA8J,GAAA,MAAWA,GAAQ7J,QAAQ+gG,MAIlDhiG,SAAU,WACN,OAAQ,gCAAiCxC,KAAKa,OAAQ,KAAK1C,KAAK,M3DutzB5E/B,GAAQM,S2DhtzBJ68F,mBAAoBA,EACpBiT,6BAA8BA,K3DmtzBLvvG,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASC,GAkBrC,QAASC,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G4Dvj0BX,IAAAmwF,GAAA9yF,EAAA,IACA42E,G5D2j0Be12E,EAAuB4yF,G4D3j0BtC9yF,EAAA,IACAiD,G5D8j0BgB/C,EAAuB02E,G4D9j0BvC52E,EAAA,IAKIu7F,G5D6j0BiBr7F,EAAuB+C,I4D3j0BxCzB,UAEI67E,WAAY,KAEZqV,qBAAsB,KAEtB3tD,IAAK,KAEL1W,SAAS,GAObyuE,YAAa,UAIbt0F,OAAQ,WACJ,OAAQ7E,KAAKlB,IAAI,YASrBiuG,UAAW,SAAStQ,EAAgBC,GAChC,GAAIqQ,IAAY,CAOhB,OANKtQ,KAAmBz8F,KAAKlB,IAAI,aAAckB,KAAKlB,IAAI,YACpDiuG,GAAY,GAEXrQ,GAAkB18F,KAAKlB,IAAI,aAC5BiuG,GAAY,GAETA,GAMX95F,QAAY/J,OAAOC,KAAnB,iBAGAmB,IAAK,WACD,GAAI0iG,GAAqBhtG,KAAKlB,IAAI,wBAC9B66E,EAAY35E,KAAKlB,IAAI,cACrBmuG,EAAmBjtG,KAAKlB,IAAI,KAEhC,OADIwL,GAAStK,KAAKiT,QAAU0mE,EAAxB,aAA8CqzB,EAA9C,KAAqEC,GAK7E3lG,KAAM,SAAS5I,GACX,MAAKsB,MAAKlB,IAAI,WAGPkB,KAAKS,MAAOiqB,SAAS,GAAShsB,GAF1BpC,EAAOsO,QAKtBsiG,OAAQ,SAASxuG,GACb,MAAIsB,MAAKlB,IAAI,WACFxC,EAAOsO,OAEX5K,KAAKS,MAAOiqB,SAAS,GAAQhsB,IAIxC8D,SAAU,WACN,OAAQxC,KAAKlB,IAAI,WAAYkB,KAAKlB,IAAI,OAAQkB,KAAKlB,IAAI,SAASX,KAAK,O5Dyk0B7E/B,GAAQM,S4Dnk0BJk7F,oBAAqBA,K5Dsk0BI36F,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAErCd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G6Dnq0BX,IAAIwxF,IAEA2c,mBAAoB,SAASC,EAAM7sG,GAElB,SAAT6sG,IACAA,EAAOptG,KAAKwF,EAAE,oBAAoBiE,IAAIzJ,KAAKwF,EAAE,4BAC7CxF,KAAKwF,EAAE,oBACFs2B,QACAr0B,UAELlH,GACA6sG,EAAOA,GAAQptG,KAAKwF,EAAL,uBACf4nG,EAAKlsF,YATc,uBAWnBksF,EAAKpwF,SAXc,uBAe3BqwF,qBAAsB,SAAStoG,GAC3B/E,KAAK20F,cAAgB30F,KAAKwF,EAAE,mBAAmBmjB,KAAK,YAKxD2kF,YAAa,SAASvoG,GAClB/E,KAAKmtG,mBAAmB,SAAUntG,KAAKutG,aAI3CC,mBAAoB,SAASzoG,GACN,KAAfA,EAAGud,SAAmBtiB,KAAK4xF,UAC3B5xF,KAAKytG,gBAKbF,SAAU,WACN,MAAO3vG,GAAEumC,OAAOnkC,KAAKwF,EAAE,oBAAoBmD,QAK/C+kG,eAAgB,SAAS3oG,GACrBA,EAAGsc,kBACHrhB,KAAKwF,EAAE,cAAcwX,SAAS,YAC9Bhd,KAAKwF,EAAE,cAAc8B,QAGzBqmG,eAAgB,SAAS5oG,GACrBA,EAAGsc,kBACHrhB,KAAKwF,EAAE,cAAc0b,YAAY,YACjClhB,KAAKwF,EAAE,cAAc6B,QAGzBumG,YAAa,SAAS7oG,GAClBA,EAAGsc,kBACHrhB,KAAKwF,EAAE,cAAcuB,YAAY,YACjC/G,KAAKwF,EAAE,cAAcf,UAIzBivF,WAAY,SAASpiF,EAASu8F,GAC1BA,EAAaA,GAAc,eAC3B7tG,KAAKwF,EAAE,cAAc8B,OACrBtH,KAAKwF,EAAE,kBACFU,KAAK,QAAS,2BACd8W,SAAS6wF,GACTxmG,OACAP,KAAK,kBACLsY,KAAK9N,IAGdw8F,WAAY,SAASx8F,GACjBtR,KAAKwF,EAAE,cAAc6B,OACrBrH,KAAKwF,EAAE,kBAAkB8B,QAG7BymG,cAAe,SAAShpG,GACS,kBAAlB/E,MAAKgxF,UACZhxF,KAAKgxF,SAAS/zF,KAAK+C,OAK3BytG,aAAc,SAAS1oG,GACnB,GAAI4K,GAAO3P,KAAKutG,UACX59F,GAEO3P,KAAK4xF,UACb5xF,KAAK00F,WAAW/kF,GAFhB3P,KAAKmtG,mBAAmB,SAMhC5b,qBAAsB,SAASlsF,GAC3BrF,KAAK20F,cAAgBtvF,EAAWqpF,yBAA0B,GAI9DsE,cAAe,SAAS7rF,EAAO0a,GAC3B,GAAIvZ,GAAOtI,KACPguG,EAAUhuG,KAAKwF,EAAE,WAChBwiB,QACA5I,KAAKpf,KAAKy6B,UAAUhW,SAOzB,OANA7mB,GAAE2K,KAAKvI,KAAKmxF,eAAgB,SAAC8c,EAAU56E,GACnC/qB,EAAK9C,EAAE6tB,GAAU1K,KAAK,UAAWrgB,EAAK2lG,MAEb,kBAAlBjuG,MAAKgxF,UACZhxF,KAAKwF,EAAE,sBAAsB6B,OAE1B2mG,GAGX/W,mBACIpE,KAAMj1F,EAAEI,UAEA,8CACA,yDACA,+CACFG,KAAK,M7D+p0BnB/B,GAAQM,S6Dxp0BJ8zF,uBAAwBA,K7D2p0BCvzF,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,Y8Dhy0BA,SAAS6xG,GAAYtvG,EAAGC,GAEpB,GAAIsvG,GAAK,gBAELz/E,EAAI9vB,EAAE4D,WAAWW,eAAiB,GAClC0rB,EAAIhwB,EAAE2D,WAAWW,eAAiB,GAClCirG,EAAKhwC,OAAOC,aAAa,GACzBgwC,EAAK3/E,EAAEzqB,QAAQkqG,EAAOC,EAAjB,KAAwBA,GAAMzqG,MAAMyqG,GACzCE,EAAKz/E,EAAE5qB,QAAQkqG,EAAOC,EAAjB,KAAwBA,GAAMzqG,MAAMyqG,GACzCG,EAAK,GAAIzvC,MAAKpwC,GAAG8/E,UACjBC,EAAKF,EAAK,GAAIzvC,MAAKjwC,GAAG2/E,UAAY,IAEtC,IAAIC,EAAI,CACJ,GAAIF,EAAKE,EACL,OAAQ,CACL,IAAIF,EAAKE,EACZ,MAAO,GAQf,IAAK,GAHDC,GAEAC,EACKC,EAAO,EAAGC,EAAO71F,KAAKS,IAAI40F,EAAGxtG,OAAQytG,EAAGztG,QAAS+tG,EAAOC,EAAMD,IAAQ,CAG3E,GAFAF,EAASnvF,WAAW8uF,EAAGO,KAAUP,EAAGO,GACpCD,EAASpvF,WAAW+uF,EAAGM,KAAUN,EAAGM,GAChCF,EAASC,EACT,OAAQ,CACL,IAAID,EAASC,EAChB,MAAO,GAGf,MAAO,G9Dkw0BX7xG,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,IAuCX5C,EAAQM,Q8Dvy0BOwxG,G9D2y0BT,SAAU/xG,EAAQC,EAASC,GAEjC,Y+Dl10BA,IAAAiiF,GAAAjiF,EAAA,G/Du10BIkiF,EAEJ,SAAgC/hF,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFjD8hF,G+Dp10BlC94E,WAGJ+4E,GAAA7hF,QAAO4wF,GAAGztF,QACN4zF,eAAgB,SAAyBqb,EAAO54F,GAE5C,MADA44F,GAAQA,GAAS,OACZ9uG,KAAKa,QAIV2E,EAAExF,MAAMuI,KAAK,WACT,GAAIwmG,GAAQvpG,EAAExF,MACVgvG,EAAiBD,EAAMvkG,KAAK,SAE5BwkG,IACAD,EACKE,UAAU,SAAAlqG,GACPS,EAAEwpG,EAAgBF,GAAOrxF,KACrByxF,WAAYh5F,MAGnBi5F,SAAS,SAAApqG,GACNS,EAAEwpG,GAAgBvxF,KACdyxF,WAAY,SAKzBlvG,MArBIA,S/Dm30Bb,SAAU7D,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GA0ClD,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAxCvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GgEl40BX,IAAAyjB,GAAApmB,EAAA,GhEu40BIqmB,EAAUnmB,EAAuBkmB,GgEt40BrC2sF,EAAA/yG,EAAA,IhE040BIgzG,EAAa9yG,EAAuB6yG,GgEz40BxChnG,EAAA/L,EAAA,GhE640BIsgC,EAAWpgC,EAAuB6L,GgE540BtCyiG,EAAAxuG,EAAA,IhEg50BIyuG,EAAavuG,EAAuBsuG,GgE/40BxCyE,EAAAjzG,EAAA,KhEm50BIkzG,EAAahzG,EAAuB+yG,GgEl50BxCzyE,EAAAxgC,EAAA,IhEs50BIygC,EAAiBvgC,EAAuBsgC,GgEr50B5ChjB,EAAAxd,EAAA,GhEy50BIugC,EAAYrgC,EAAuBsd,GgEx50BvCkjB,EAAA1gC,EAAA,IhE450BI2gC,EAAazgC,EAAuBwgC,GgE350BxCyyE,EAAAnzG,EAAA,IhE+50BIozG,EAAkBlzG,EAAuBizG,GgE950BzChmG,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXA,MAAK4J,MAAQyU,OAAOnV,OAAOU,OAAS,GAAIgzB,GAAAlgC,QAAM8M,KAC9CxJ,KAAKkB,MAASxC,GAAWA,EAAQwC,OAAU,GAAI/B,GAASS,MAAMlB,GAC9DsB,KAAKqS,SAAW,GAAAg9F,GAAA3yG,QAChBsD,KAAK4e,WACDpZ,EAAE,UACGwX,SAAS,qBACTrT,OAAQ3J,KAAKkhC,SAAW17B,EAAE,WAC1BmE,OAAQ3J,KAAK0rB,QAAUlmB,EAAE,WACzBmE,OAAQ3J,KAAK0vG,OAASlqG,EAAE,YAEjCA,EAAE,QAAQmE,OAAO3J,KAAKuE,KACtBvE,KAAK2vG,aACL3vG,KAAKgc,SACLxW,EAAE7E,QAAQwsB,OAAO,WACb7kB,EAAKk1E,cAKbA,SAAU,SAASoyB,GACf,GAAIrjF,GACA3uB,EAAE8tF,OAAO1rF,KAAKuE,IAAI2a,WAAY,SAACysE,EAAMn/C,GAAP,MAAiBm/C,GAAOnmF,EAAEgnC,GAAOG,eAAe,GAC9E3sC,KAAK0vG,OAAOj0F,SACZ,EACJzb,MAAK0vG,OAAOjyF,IAAI,SAAUjY,EAAE7E,QAAQ8a,SAAW8Q,IAInDojF,WAAY,WAwFR,QAASE,GAAyB7wG,EAAO6iB,GAGrC,IAFA,GACI/d,GADAqqG,EAAK,eAEDrqG,EAAQqqG,EAAGnpC,KAAK5G,OAAOp/D,KAAU,CACrC,GAAI8wG,GAAUhsG,EAAM,EACpB+d,GACKvZ,EAAKynG,UAAUD,GAAWxnG,EAAKynG,UAAUD,KACtCn6F,MAAOm6F,EACPngG,KAAMmgG,EACNl6F,KAAM,OACNM,cAA4B,MAAX85F,EAAjB,eACAC,MAAO,oBACPC,YAnGhB,GAAI5nG,GAAOtI,IACXA,MAAKmwG,SACLnwG,KAAKowG,SACLpwG,KAAKkwG,SACLlwG,KAAKqwG,SACLzyG,EAAE2K,KAAKvI,KAAKkB,MAAMpC,IAAI,SAAU,SAAC43D,EAAMhnD,GACnCxG,OAAOusB,KAAKmI,MAAM,oCAAwCluB,EAA1D,8BACA,IAAIsc,GAAOyjF,EAAA/yG,QAAcg6D,EAAK45C,WAC1B5mG,EAAWoK,SAASpE,EAAI,GAAxB,MAA+BgnD,EAAK65C,YAAc75C,EAAK85C,UACvD95C,GAAKvwB,aACLz8B,SAAegtD,EAAKvwB,YAEpBuwB,EAAK+5C,eACL/mG,uBAA6BgtD,EAAK+5C,aAAlC,KAEJ/5C,EAAOh0C,EAAAhmB,QAAMwgC,OAELtwB,MAAO8C,EACPghG,YAAa9yG,EAAEumC,OAAOz6B,GACtBsiB,KAAMA,GAAQ,GACdhK,KAAM,KACN2uF,UAAW,KACXC,aAAa,EACbC,UAAWnhG,EAAI,IAAMpH,EAAKwoG,YAAYp6C,GACtCq6C,iBAAiB,EACjBC,iBAAiB,EACjBC,sBAAsB,EACtBC,QAAQ,EACRC,YAAa,OACbC,aAAc,OACdC,WAAY,aACZC,YAAa,aACbC,OAAQ76C,EAAK86C,SACbC,gBAAgB,EAChB3yE,IAAK,oBACL4yE,iBAAiB,EACjBC,eAAe,EACfv0E,eAAkC,QAAlBs5B,EAAK45C,WAEzB55C,GAEJpuD,EAAK8nG,MAAM1gG,GAAKgnD,EAChBpuD,EAAK4nG,MAAMxgG,MACXpH,EAAK+nG,MAAM3gG,QAIf9R,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAC15C,EAAMhnD,GACtB6/F,EAAA7yG,QAASk1G,YAAYl7C,EAAK3/B,OAAQ,SAAC9V,EAAOtR,GACtCrH,EAAK+nG,MAAM3gG,GAAGC,GAAQsR,MAK9BrjB,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAC15C,EAAMhnD,GACtB9R,EAAE2K,KAAKmuD,EAAKm7C,mBAAoB,SAAAC,GAC5Bl0G,EAAE2K,KAAKD,EAAK8nG,MAAO,SAAC2B,EAAUx1F,GAC1Bw1F,EAASnC,aAAekC,EAAkBE,kBAAoB1pG,EAAK4nG,MAAMxgG,GAAGxC,KAAK6kG,SAO7Fn0G,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAC15C,EAAMhnD,GACtB9R,EAAE2K,KAAKD,EAAK8nG,MAAO,SAAC2B,EAAUx1F,GAC1B,GAAI01F,KACJr0G,GAAE2K,KAAKmuD,EAAKm7C,mBAAoB,SAAAK,GAC5BH,EAASnC,aAAesC,EAAWF,mBAC9BC,EAAoBC,EAAWt6E,YAAcs6E,KAEtDt0G,EAAE2K,KAAKD,EAAK+nG,MAAM9zF,GAAI,SAAC0E,EAAOtR,GAC1B,GAAIuiG,GAAaD,EAAoBtiG,EACjCuiG,KACAjxF,EAAMrL,KAAO,SACbqL,EAAMe,KAAOf,EAAMkxF,YAAiBlxF,EAAMe,KAA7B,KAAwC,GACrDf,EAAMe,MAAN,mBAAiCkwF,EAAWE,YAA5C,gBAAsEt+F,SAASpE,GAAK,GACpFuR,EAAMkxF,YAAclxF,EAAMkxF,gBAC1BlxF,EAAMkxF,YAAYjlG,KAAKwpD,SAOvC,IAAIs5C,GAAW,CACfhwG,MAAK+vG,aAkBLnyG,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAC15C,EAAMhnD,GACtB9R,EAAE2K,KAAKD,EAAK+nG,MAAM3gG,GAAI,SAACuR,EAAOtR,GAC1BkgG,EAAyB5uF,EAAMjiB,MAAO,SAAAqzG,GAClCA,EAASnC,MAAMhjG,KAAKwpD,GACpBz1C,EAAMqxF,WAAY,EAClBrxF,EAAMrL,KAAO,OACbqL,EAAMsxF,UAAW,EACjBtxF,EAAMgvF,MAAQ,wBAGtBryG,EAAE2K,KAAKmuD,EAAK87C,iBAAkB,SAAAC,GAC1B70G,EAAE2K,KAAKkqG,EAAIC,iBAAkB,SAAA1nG,GACzB6kG,EAAyB7kG,EAAK,oBAO1CpN,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAC15C,EAAMhnD,GACtB,GAAsB,QAAlBgnD,EAAK45C,UAAqB,CAC1B,GAAIqC,IAAgB,CACpBpD,GAAA7yG,QAASk1G,YAAYl7C,EAAK3/B,OAAQ,SAAC9V,EAAOtR,EAAMijG,GAC5C,GAAIC,GAAmB5xF,EAAMjiB,OAAkC,gBAAzBiiB,EAAMjiB,MAAM8zG,UAC9CC,GAAoE,IAAnD,OAAQ,mBAAmB5wG,QAAQ8e,EAAMrL,MAC1Do9F,EAAWJ,EAAQ3xF,EAAM+xF,SAC7B/xF,GAAMkxF,cAAgB7pG,EAAKwoG,YAAY7vF,EAAMkxF,eAAiBQ,GAAgB,GAC9E1xF,EAAMviB,UACwB,GAAxBuiB,EAAMviB,QAAQmC,SAAgB8xG,GAAkB1xF,EAAMqxF,aACvDrxF,EAAMgyF,aAAc,GACzBD,IACK/xF,EAAMgyF,YACFD,EAASb,cAAgB7pG,EAAKwoG,YAAYkC,EAASb,cAAiBlxF,EAAMqxF,YAClFS,GAAkB9xF,EAAMjiB,OAAkC,gBAAzBiiB,EAAMjiB,MAAM8zG,YAAgC7xF,EAAMkxF,eAC/Ez7C,EAAKm6C,WAAY,GACtBgC,IAAqB5xF,EAAMjiB,MAAQiiB,EAAMvL,eACzCuL,EAAMiyF,OAAS,WACVL,GAAqBE,GAAgC,WAAf9xF,EAAMrL,MAAsBqL,EAAMqxF,YACrErxF,EAAM4f,WAAcne,EAAAhmB,QAAMmsF,QAAQ5nE,EAAMjiB,QAA0B,KAAhBiiB,EAAMjiB,SACxDiiB,EAAMkyF,kBAAoBlyF,EAAMjiB,MAChCiiB,EAAMmyF,qBAAsB,SAQpDp3F,OAAQ,WACJ,GAAI1T,GAAOtI,IACXA,MAAKqS,SAASuiB,QACd50B,KAAK8yF,gBACL9yF,KAAKqzG,iBACLrzG,KAAKszG,oBACLtzG,KAAKuzG,iBACL31G,EAAE2K,KAAKvI,KAAKowG,MAAO,SAAA15C,GACfpuD,EAAKkrG,YAAY98C,MAKzBo8B,cAAe,WACX,GAAIxqF,GAAOtI,IACXA,MAAKyzG,YAAc,GAAI92E,GAAAjgC,QAAGmiC,QACtB7S,KAAM,WACNtiB,MAAO,eACPo1B,IAAK,kBACL/X,QAAS,WACLze,EAAKorG,cAGb1zG,KAAK0rB,QACA1O,SAAS,kBACTgL,QACAre,OACG,GAAIgzB,GAAAjgC,QAAGi3G,OACHjqG,mBAAoB1J,KAAKkB,MAAMpC,IAAI,UACpCyF,KAENoF,OAAO3J,KAAKyzG,YAAYlvG,MAIjC8uG,eAAgB,WACZrzG,KAAKkhC,SAASlZ,QACVhoB,KAAKkB,MAAMpC,IAAI,yBACfkB,KAAKkhC,SAASv3B,OACV,GAAIgzB,GAAAjgC,QAAGwhC,SACH5sB,QACI,qRACJusB,OAAQ,UACRM,YAAY,EACZy1E,MAAM,IACPrvG,IAGX,IAAIsvG,GAAuB7zG,KAAKkB,MAAMpC,IAAI,uBACtC+0G,IAAwBA,EAAqBhzG,OAAS,GACtDb,KAAKkhC,SAASv3B,OACV,GAAIgzB,GAAAjgC,QAAGwhC,SACH5sB,QACI,oSACJusB,OAAQ,UACRM,YAAY,EACZy1E,MAAM,IACPrvG,MAMf+uG,kBAAmB,WACf,GAAIhrG,GAAOtI,IACXA,MAAK8zG,QAAU,KACVl2G,EAAEirF,QAAQ7oF,KAAK+vG,aAChB/vG,KAAK8zG,QAAU,GAAAhJ,GAAApuG,SACXgN,MAAO,6BACPqtB,OAAQ/2B,KAAK+vG,UACbjxE,IAAK,oBACL3K,SAAU,WACNv2B,EAAE2K,KAAKD,EAAKwrG,QAAQlzE,WAAY,SAACD,EAAWjxB,GACxC9R,EAAE2K,KAAKo4B,EAAUuvE,MAAO,SAAAx5C,GACpBpuD,EAAKyrG,aAAar9C,UAKlC12D,KAAKg0G,QAAQh0G,KAAK0vG,OAAO1nF,QAAShoB,KAAK8zG,QAAQvvG,OAKvDgvG,eAAgB,WACZvzG,KAAKi0G,aAAe,GAAAnJ,GAAApuG,SAChBoiC,IAAK,oBACLp1B,MAAO,yBACPqtB,SAEQnhB,KAAM,cACNjG,KAAM,cACNukG,YACIvkG,KAAM,QACNgG,MAAO,gCACPC,KAAM,UACN5W,MAAO,QACPgjB,KAAM,IAEVmyF,QAEQn1G,MAAO,OACP+3B,SAEQpnB,KAAM,OACNgG,MAAO,eACPC,KAAM,OACN5W,MAAOgB,KAAKkB,MAAMpC,IAAI,gBAQlDkB,KAAKg0G,QAAQh0G,KAAK0vG,OAAQ1vG,KAAKi0G,aAAa1vG,MAIhDivG,YAAa,SAAS98C,GAClB,GAAIpuD,GAAOtI,KACPi9B,EAAO,IACXj9B,MAAKqS,SAAS0T,QAAQ,SAAAgL,GAElB,GADAzoB,EAAKonG,OAAO1yF,SAAS,YACC,QAAlB05C,EAAK45C,UACL55C,EAAKp4B,WAAa,SAAShB,EAASL,GAChC,GACIsB,IACA/F,QAASk+B,EAAKx2D,GACds+B,aAAck4B,EAAK57B,QACnB/D,OAAQvxB,EAAE3F,QAAO,KAAUo9B,EAAKzyB,KAAKooB,UAEzCqK,GAAKwB,MAAK,GACVv1B,OAAOusB,KAAKmI,MAAM,oCAAqC,yBAA0BW,GACjF7b,EAAAhmB,QAAMgiC,SACF9oB,KAAM,OACNtL,IAAQpB,OAAOC,KAAf,aAAgCutD,EAAKx2D,GAArC,SACAsK,KAAM+zB,EACN98B,QAAS,SAAS+I,GACdyyB,EAAK0B,OAAOn0B,GACZyyB,EAAKwB,MAAK,GACVv1B,OAAOusB,KAAKmI,MAAM,oCAAqC,sBAAuBpzB,GAC9E8yB,EAAQxuB,WAEZpN,MAAO,SAASkN,GACZ1F,OAAOusB,KAAKmI,MAAM,oCAAqC,0BAA2BhvB,GAClF0uB,EAAQe,aAIpBpB,EAAO,GAAAH,GAAApgC,QAAiBg6D,GACpBA,EAAK87C,kBAAoB97C,EAAK87C,iBAAiB3xG,QAC/Co8B,EAAK+B,QAAQr1B,OACTnE,EAAE,UACGwX,SAAS,4BACTrT,OACGnE,EAAE,UACGwX,SAAS,iBACToC,KAAK,4BAEbzV,OACGnE,EAAE,UACGwX,SAAS,mBACToC,KACGxhB,EAAE8tF,OACEh1B,EAAK87C,iBACL,SAAC7mB,EAAM3sF,GAAP,MAAoB2sF,GAApB,IAA4B3sF,EAAMo1G,WAClC,WAMzB,CACH,GAAIC,IAAsF,IAAnE,aAAc,yBAAyBlyG,QAAQu0D,EAAK45C,UAC3E1yG,GAAE2K,KAAKmuD,EAAK3/B,OAAQ,SAAA9V,GAChBA,EAAMiyF,OAAS,SACfjyF,EAAMqzF,WAAaD,IAEvBp3E,EAAO,GAAA6tE,GAAApuG,QACHgmB,EAAAhmB,QAAMwgC,OAEExzB,MAAOgtD,EAAKg6C,YACZv8E,SAAU,WACNv2B,EAAE2K,KAAKD,EAAK4nG,MAAMx5C,EAAK9pD,OAAQ,SAAAs2B,GAC3B56B,EAAKyrG,aAAa7wE,MAG1BnM,OACI2/B,EAAK3/B,QAAU2/B,EAAK3/B,OAAOl2B,OAAS,EAC9B61D,EAAK3/B,SAGGnhB,KAAM,SACNjG,KAAM,wBACN0vB,OAAQ,QAI9Bq3B,IAIZpuD,EAAK6nG,MAAMz5C,EAAK9pD,OAASqwB,EACzB30B,EAAK0rG,QAAQ1rG,EAAKonG,OAAQzyE,EAAK14B,KAC/B+D,EAAKk1E,WACL9mB,EAAKi7C,eAAiBrpG,EAAKyrG,aAAar9C,GACxCz5B,EAAK+B,QAAS12B,EAAKisG,cAA2B,UAAX,YACnCjsG,EAAKisG,eACDjsG,EAAKmrG,YAAYvyG,MAAMU,KACnB68B,MAAM,EACN+1E,UAAW,eACXrtB,WAA+B,KAAlBzwB,EAAK9pD,MAAQ,GAAatE,EAAK8nG,MAAMvvG,SAE1DqI,OAAOusB,KAAKmI,MAAM,oCAAwC84B,EAAK9pD,MAA/D,gCAAqG8pD,GACrG7+C,WAAW,WACPkZ,EAAQjiB,WACT,MAKXilG,aAAc,SAASr9C,GACnB,GAAIpuD,GAAOtI,KACPi9B,EAAOj9B,KAAKmwG,MAAMz5C,EAAK9pD,MACvBqwB,IACAr/B,EAAE2K,KAAKD,EAAK+nG,MAAM35C,EAAK9pD,OAAQ,SAACqU,EAAOtR,GACnC,GAAIsR,EAAMkxF,aAAelxF,EAAMqxF,UAAW,CACtC,GAAIt1C,GAAQ//B,EAAKyD,WAAWzD,EAAKzyB,KAAK1G,MAAM6L,GAC5C,IAAIqtD,EAAO,CACP,GAAIp1C,OAAYpmB,EAChB,IAAIyf,EAAMkxF,YACNvqF,GAAcmZ,WACdnjC,EAAE2K,KAAK0Y,EAAMkxF,YAAa,SAAAsC,GACtB,GAAInsG,EAAKwoG,YAAY2D,GAAc,CAC/B,GAAIz1G,GAAQsJ,EAAK6nG,MAAMsE,EAAY7nG,OAAOpC,KAAKooB,SAAS3R,KACxDjiB,IACIpB,EAAE2K,KAAKvJ,EAAM+hC,OAAQ,SAAAld,GACjB+D,EAAUmZ,OAAO7zB,KAAK2W,SAIjC5C,EAAMm8D,UAAYx1D,EAAUmZ,OAAOlgC,OAAS,IAC7C+mB,GACImZ,QAASnZ,EAAUmZ,OAAO,UAG/B,IAAI9f,EAAMqxF,UAAW,CACxB1qF,EAAY3G,EAAMjiB,KAGlB,KAFA,GACI8E,GADAqqG,EAAK,eAEDrqG,EAAQqqG,EAAGnpC,KAAK/jD,EAAMjiB,QAAS,CACnC,GAAI01G,GAAWpsG,EAAKwrG,QAAQpzE,WAAWp4B,EAAKwrG,QAAQtpG,KAAK1G,MAAMA,EAAM,KACjE6wG,EAAWD,GAAYA,EAAS11G,OAChC21G,KACA/sF,EAAYA,EAAUjkB,MAAMG,EAAM,IAAI3F,KAAKw2G,SAIrCnzG,KAAdomB,GACAo1C,EAAMh+D,MAAM4oB,OAK5BqV,EAAK97B,QAAQ,WAEbu1D,EAAKi7C,eAAgB,GAK7BiD,gBAAiB,WACb,GAAItsG,GAAOtI,KACP4mC,EAAUvoB,OAAOnV,QAAUmV,OAAOnV,OAAOkb,kBAAoB/F,OAAOnV,OAAOkb,iBAAiBljB,KAChGlB,MAAK60G,kBAAoBl7E,aAAa35B,KAAK60G,kBACvCjuE,GACAA,EAAQu2D,UAAU17F,QAAQ,WACyB,IAA3CmlC,EAAQm2D,iCACRz0F,EAAKusG,iBAAmBh9F,WAAW,WAC/BvP,EAAKssG,mBACNhuE,EAAQ40D,kBAO3BkY,SAAU,WACN,GAAIprG,GAAOtI,IACXA,MAAKu0G,eAAgB,EACrBv0G,KAAK80G,UAAS,GACd90G,KAAKqS,SAAS0T,QAAQ,SAAAgL,GAClBlZ,WAAW,WACPkZ,EAAQjiB,UACRxG,EAAK4iG,WACN,MAKXA,QAAS,WACL,GAAI5iG,GAAOtI,KACP+0G,EAAoB/0G,KAAKi0G,aAAazpG,KAAKooB,SAC3C0M,GACA01E,iBAAkBD,EAAkB,oBAAsBA,EAAkB,oBAAsB,KAClGr7B,WAAaq7B,EAAkB,oBAAqD,KAA/B/0G,KAAKkB,MAAMpC,IAAI,cACpEm2G,mBAAoBj1G,KAAK8zG,QAAU9zG,KAAK8zG,QAAQtpG,KAAKooB,YACrD82D,cAIAwrB,uBAAuB,EAGvBp0E,OAAO,GAEPq0E,GAAY,CAChB,KAAK,GAAIzlG,KAAK1P,MAAKmwG,MAAO,CACtB,GAAIlzE,GAAOj9B,KAAKmwG,MAAMzgG,GAClB0wB,EAAanD,EAAKzyB,KAAKooB,SACvB8jC,EAAOpuD,EAAK8nG,MAAM1gG,GAClBkgG,EAAal5C,EAAKk5C,UACtB3yE,GAAK97B,QAAQ,QACb,KAAK,GAAIo/B,KAAgBH,GAAY,CACjC,GAAII,GAAcJ,EAAWG,GACzBN,EAAWhD,EAAKzyB,KAAK1G,MAAMy8B,GAE3BI,GADc1D,EAAKyD,WAAWT,GAClBhD,EAAK2D,WAAWX,GAChC,KAAKU,EAAUwxE,YAAa,CASxB,KAPIgD,EADAn1G,KAAK8wG,YAAYp6C,GACLl2B,GAAeA,EAAYO,QAAUP,EAAYO,OAAOlgC,OAAS,EAGzE8/B,EAAUE,UACTF,EAAUsyE,aAA+B,KAAhBzyE,IACxBG,EAAUsyE,aAA+B,OAAhBzyE,GAEnB,CACZvD,EAAKiD,UAAUD,EACf,OAEJX,EAAQoqD,WAAWkmB,GAActwE,EAAQoqD,WAAWkmB,OACpDtwE,EAAQoqD,WAAWkmB,GAAYrvE,GAAgBH,EAAWG,IAGlE,IAAK40E,EACD,MAGHA,GAIDjsG,OAAOusB,KAAKmI,MAAM,gCAAiC,uBAAwB0B,GAC3E5c,EAAAhmB,QAAMgiC,SACF9oB,KAAM,OACNtL,IAAQpB,OAAOC,KAAf,iBAAoCnJ,KAAKkB,MAAMhB,GAA/C,eACAsK,KAAM80B,EACN79B,QAAS,SAASmN,GAMd,GALA1F,OAAOusB,KAAKmI,MAAM,8BAA+B,yBAA0BhvB,GAC3EtG,EAAK/D,IAAI2a,WAAW5X,OACpBgB,EAAK/D,IAAIoF,OAAOrB,EAAKo3B,iBAAiB9wB,IAGlCpJ,EAAEvC,QAAQ2L,IAAaA,EAAS/N,OAAS,EAAG,CAC5CyH,EAAK/D,IAAIoF,OAAOnE,EAAE,UAAYtF,GAAI,iBACjB,IAAI88B,GAAAtgC,QAASmtB,aAC1B5W,QAAY/J,OAAOC,KAAnB,wBACA4gB,OAAQuV,EAAQ9G,QAChBxO,YAAasV,EAAQd,eAI7Bl2B,EAAKssG,mBAETlzG,MAAO,SAASkN,GACZ1F,OAAOusB,KAAKmI,MAAM,8BAA+B,qBAAsBhvB,EACvE,IAAIixB,IAAc,CAClB,IAAIjxB,GAAYA,EAASkxB,SACrB,IAAK,GAAIpwB,KAAKpH,GAAK6nG,MAAO,CACtB,GAAIlzE,GAAO30B,EAAK6nG,MAAMzgG,GAClB0lG,EAAsBxmG,EAASkxB,SAAS7C,EAAK/7B,MAAMpC,IAAI,cAC3D,IAAIs2G,EAAqB,CACrB,GAAIr1E,GAAiB9C,EAAKzyB,KAAKw1B,cAAco1E,EAC7C,KAAK,GAAIn1E,KAAYF,GAAgB,CACjC9C,EAAKiD,UAAUD,EAAUF,EAAeE,IACxCJ,GAAc,CACd,SAKXA,GACDv3B,EAAKsB,MAAMvC,MACPqC,MAAO,6BACPG,KAAMvB,EAAK63B,eAAeb,EAAS1wB,GAAYA,EAASmvB,SACxDh0B,SACIqjB,MAAO,WACH9kB,EAAKsB,MAAMtC,YAM/BmiB,SAAU,WACNnhB,EAAKwsG,UAAS,QAvDtBxsG,EAAKwsG,UAAS,GACd5rG,OAAOusB,KAAKmI,MAAM,gCAAiC,qBAAsB0B,KA6DjF00E,QAAS,SAASh4B,EAAYz3E,GAC1By3E,EAAWryE,OAAO,QAAQA,OAAOpF,IAIrCuwG,SAAU,SAASrqF,GACfzqB,KAAKyzG,YAAYvyG,MAAMU,KACnB68B,MAAOhU,EACP+pF,UAAW,aACXrtB,YAAa,IAEjBnnF,KAAK8zG,SAAW9zG,KAAK8zG,QAAQ90E,QAAQvU,EAAU,SAAW,aAC1DzqB,KAAKi0G,cAAgBj0G,KAAKi0G,aAAaj1E,QAAQvU,EAAU,SAAW,aACpE7sB,EAAE2K,KAAKvI,KAAKmwG,MAAO,SAAAlzE,GACfA,GAAQA,EAAK+B,QAAQvU,EAAU,SAAW,gBAKlDqmF,YAAa,SAASV,GAElB,IAAK,GADDiF,GAAM7vG,EAAEvC,QAAQmtG,GAASA,GAASA,GAC7B1gG,EAAI,EAAGA,EAAI2lG,EAAIx0G,OAAQ6O,IAAK,CACjC,GAAIgnD,GAAO2+C,EAAI3lG,EACf,KAAKgnD,IAASA,EAAK45C,YAAc55C,EAAK45C,UAAUpoB,WAAW,QACvD,OAAO,EAGf,OAAO,GAIXxoD,iBAAkB,SAAS9wB,GACvB,MAAIpJ,GAAEvC,QAAQ2L,IAAaA,EAAS/N,OAAS,EAClC2E,EAAE,UACJwX,SAAS,oBACTrT,OACGnE,EAAE,QAAQ4Z,KAAV,oCACwCsD,EAAAhmB,QAAM4oC,SAAStlC,KAAKkB,MAAMpC,IAAI,SADtE,QAEQ8P,EAAS/N,OAAS,EAAlB,OAA6B+N,EAAS/N,OAAtC,aAA2D,IAFnE,MAMH8I,OACGnE,EAAE,QACGmE,OAAO,QACPmT,KACG,yPAIT9c,KAAKmgC,eAAevxB,EAAU,oDAI7CuxB,eAAgB,SAASvxB,EAAUmvB,GAC/B,MAAOv4B,GAAE,UACJwX,SAAS,qBACTrT,OACGnE,EAAE,QAAQsX,KAAV,sGACyGhb,KAAKC,UACtGg8B,IACC,MAGZp0B,OAAOnE,EAAE,UAAUsX,KAAKhb,KAAKC,UAAU6M,EAAU,KAAM,OhEy00BpExS,GAAQM,SgEr00BJ8M,KAAMA,KhEw00BmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAGtB,EAAQkJ,GAkBhD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GiEr/1BX,IAAA6a,GAAAxd,EAAA,GjE0/1BIugC,EAAYrgC,EAAuBsd,GiEz/1BvCy7F,EAAAj5G,EAAA,KjE6/1BIk5G,EAAeh5G,EAAuB+4G,GiE5/1B1Ch2G,EAAAjD,EAAA,GjEgg2BIkD,EAAiBhD,EAAuB+C,GiEx/1BxCk2G,GAEAC,YAAa73G,EAAEI,SAAS,yBACxB0L,MAAO9L,EAAEI,UAAY,EAAAuB,EAAA7C,SAAG,mBAAjB,kBACPg5G,aAAa,EAAAn2G,EAAA7C,SAAG,QAChBi5G,cAAc,EAAAp2G,EAAA7C,SAAG,gCACjBk5G,aAAa,EAAAr2G,EAAA7C,SAAG,mBAChBm5G,aAAa,EAAAt2G,EAAA7C,SAAG,8CAChBo5G,UAAU,EAAAv2G,EAAA7C,SAAG,4CACbq5G,aACI,EAAAx2G,EAAA7C,SAAG,4FACH,EAAA6C,EAAA7C,SAAG,gCAGP03B,UAAWx2B,EAAEI,UAIL,sBACA,+BACA,sBACA,EAAAuB,EAAA7C,SAAG,WACH,2BACA,EAAA6C,EAAA7C,SAAG,cACH,SACA,EAAA6C,EAAA7C,SAAG,MACH,IACA,4BACA,EAAA6C,EAAA7C,SAAG,iBACH,QACA,SACA,UACA,SACA,kCACA,EAAA6C,EAAA7C,SAAG,qCACH,IACA,iBAGA,+FACA,kGACA,EAAA6C,EAAA7C,SAAG,sCACH,OAEA,wBACA,SACA,OACA,EAAA6C,EAAA7C,SAAG,+DACH,OAEA,uFACA,uEACA,4DACA,SACA,uEACA,+DACA,iDACA,UACA,WACFyB,KAAK,KAIX63G,mBAAoB,WAChB,GAAIC,qDAA8Dj2G,KAAK41G,YAAnE,SACJ51G,MAAK4J,MACApE,EAAE,eACFwiB,QACAre,OAAOssG,GACPx4F,KAAMy4F,aAAc,SAK7BxoB,OAAQ,SAAiB9jF,EAAOg9B,EAASloC,GAuBrC,QAASy3G,KACL,GAAIxmG,GAAO/F,EAAMpE,EAAE,qBAAqBmD,KACxC,KAAKgH,EAED,WADA/F,GAAMpE,EAAE,kBAAkB6B,MAI9B,IAAI+uG,GAAuE,aAArDxsG,EAAMpE,EAAE,mCAAmCmD,KACjEiB,GAAMpE,EAAE,UAAUmjB,KAAK,YAAY,GACnC+kE,EAAOsoB,qBACPpvE,EACKx2B,MAAK,EAAMT,EAAMymG,GACjBplF,KAAK,SAAApiB,GACFyD,EAASvD,QAAQF,KAEpBi1E,KAAK,SAAS34C,EAAKrN,EAAQvsB,GACxB,GAAI5S,IACAiR,KAAMA,EACNymG,gBAAiBA,EAErBb,GAAA74G,QAAY25G,eAAezvE,EAASsE,EAAKxsC,EAASgvF,EAAOioB,cACzDtjG,EAASikG,WAAWjkG,EAAU7U,aAEjCwzB,KAAK,WACEulF,GACA3sG,EAAMtC,SA/CtB5I,EAAUA,KAEV,IAAIgvF,GAAS1tF,KACTqS,EAAW/V,EAAOgS,WAGtBkoG,EAAoB93G,EAAQ+3G,QAAUz2G,KAAKy1G,YAEvCiB,EAAkBF,GAClB7mG,KAAMi3B,EAAQ9nC,IAAI,UAItB63G,EAAkBj4G,EAAQ4/F,YAAc,WAAa,mBAEjDsY,IAAYh5G,EAAEg2F,YAAYl1F,EAAQk4G,WAAYl4G,EAAQk4G,SAEtDL,IAAa34G,EAAEg2F,YAAYl1F,EAAQ63G,YAAa73G,EAAQ63G,SAE5Dv2G,MAAK4J,MAAQA,CAiCb,IAAIitG,GAA0Bn4G,EAAQo4G,gBAiDtC,OAhDAltG,GAAMvC,KACFzJ,EAAEiC,OAAOnB,GACLgL,MAAO1J,KAAK0J,OAAQiG,KAAMi3B,EAAQ9nC,IAAI,UACtC+K,KAAMrE,EACFkoF,EAAOt5D,WACHzkB,KAAM+mG,EACNK,OAAQ7tG,OAAOksE,KAAKzB,cACpBijC,SAAUA,EACVI,SAAUL,EACVd,YAAa71G,KAAK61G,YAClBC,SAAU91G,KAAK81G,SACfC,YAAa/1G,KAAK+1G,eAG1BhsG,QAASnM,EAAEq7F,UAEH,EAAA15F,EAAA7C,SAAG,UACH,WACIkN,EAAMtC,UAGbtH,KAAK01G,YAAaS,KAEvB16F,OAAQ,OACR3R,gBAAgB,EAChBgtG,iBAAkB,SAA2BG,GACrCA,GACA5kG,EAASgsB,QAAS44E,WAAW,IAE7BJ,GACAA,EAAwBI,OAOxCrtG,EACKpE,EAAE,qBACFs2B,QACAr0B,SACLmC,EAAMpE,EAAE,qBAAqB9E,GAAG,UAAW,SAAAqE,GACpB,KAAfA,EAAGud,UACHvd,EAAG+hB,iBACHqvF,OAID9jG,IASX6kG,EAAet5G,EAAEiC,UAAW21G,GAC5BC,YAAa73G,EAAEI,SAAS,yBACxB0L,MAAO9L,EAAEI,UAAY,EAAAuB,EAAA7C,SAAG,qBAAjB,kBACPg5G,aAAa,EAAAn2G,EAAA7C,SAAG,UAChBi5G,cAAc,EAAAp2G,EAAA7C,SAAG,kCACjBk5G,aAAa,EAAAr2G,EAAA7C,SAAG,qBAChBm5G,aAAa,EAAAt2G,EAAA7C,SAAG,gDAChBo5G,UAAU,EAAAv2G,EAAA7C,SAAG,8CACbq5G,aACI,EAAAx2G,EAAA7C,SAAG,4FACH,EAAA6C,EAAA7C,SAAG,oCAmBPy6G,EAAoB,SAACvwE,EAASloC,GAC9BA,EAAUA,KAEV,IAAIkL,GAAQjJ,OAAO0d,OAAOnV,OAAOU,OAAS,GAAIgzB,GAAAlgC,QAAM8M,QACpD,OAAO9K,GAAQ04G,UACTF,EAAaxpB,OAAO9jF,EAAOg9B,EAASloC,GACpC82G,EAAW9nB,OAAO9jF,EAAOg9B,EAASloC,GjEu81B5CtC,GAAQM,QiEn81BOy6G,IjEo81Bcl6G,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASmJ,EAAG5H,GkEpp2BxC,QAAS03G,GAAYhkG,EAAS5H,EAAOuyF,GA+BjC,MA7BA/yF,QAAOU,MAAMvC,MACTqC,MAAOA,EACPG,KAAMyH,EACNxH,gBAAgB,EAChBC,SACIstG,GAAI,WACAnuG,OAAOU,MAAMtC,WAIzB4B,OAAOU,MAAMrF,IAAIyY,SAAS,eAEtBi/E,IACA/yF,OAAOU,MACFpE,EAAE,kBACFiE,IAAIP,OAAOU,MAAMpE,EAAE,+BACnB6f,SACL7f,EAAE,UACGwX,SAAS,iBACT1V,OACA+U,SAASnT,OAAOU,MAAMpE,EAAE,mBACxBmE,QAAQnE,EAAE,QAAQsX,KAAKw6F,GAAc9xG,EAAE,UAAUsX,KAAKhb,KAAKC,UAAUk6F,EAAS,KAAM,SAEzFz2F,8CAA6C,EAAAjG,EAAA7C,SAAG,WAAhD,aACK2f,SAASnT,OAAOU,MAAMpE,EAAE,aACxBsa,MAAM,WACH5W,OAAOU,MAAMpE,EAAE,kBAAkBf,YAGtCyE,OAAOU,MAIlB,QAAS2tG,GAAWjmG,EAAS5H,EAAOuyF,GAChC,GAAK3qF,EAAL,CAMA,GAFAA,GAAU,EAAA/R,EAAA7C,SAAG4U,GACb5H,GAAQ,EAAAnK,EAAA7C,SAAGgN,KAAU,EAAAnK,EAAA7C,SAAG,UACpBiE,OAAOuI,QAAUA,OAAOU,MACxB,MAAO0rG,GAAYhkG,EAAS5H,EAAOuyF,EAGvCl7F,OAAS2I,EAAT,OAAqB4H,GACrBnH,QAAQC,IAAI,iBAAkBtI,KAAKC,UAAUk6F,KAKjD,QAASub,KACL,MAAOD,IAAW,EAAAh4G,EAAA7C,SAAG,0EAA0E,EAAA6C,EAAA7C,SAAG,aAKtG,QAAS+6G,KACL,MAAOF,IACA,EAAAh4G,EAAA7C,SAAG,uEADH,IAC6Eg7G,GAChF,EAAAn4G,EAAA7C,SAAG,6BAMX,QAAS25G,GAAen1G,EAAOgqC,EAAKxsC,EAAS4S,EAAS5H,GAKlD,MAJA4H,GAAUA,GAAWqmG,EACrBrmG,OAAeomG,EACfhuG,EAAQA,IAAS,EAAAnK,EAAA7C,SAAG,qBAEb66G,EAAWjmG,EAAS5H,EADbkuG,EAAa12G,EAAOgqC,EAAKxsC,IAK3C,QAASk5G,GAAa12G,EAAOgqC,EAAKxsC,GAC9B,OAEIm5G,MAAOj6G,EAAEiS,OAAOlP,OAAOm3G,MAAO,eAC9B51G,UAAWD,UAAUC,UACrB61G,OAAQ91G,UAAU81G,OAClBj9E,QAASl9B,EAAEiS,OAAO3G,OAAOoiB,OAAQ,iBACjC4f,IAAKttC,EAAE6E,KAAKyoC,EAAKttC,EAAEo6G,UAAU9sE,IAC7BxsC,QAASd,EAAE6E,KAAK/D,EAAS,OAEzB4L,IAAK1M,EAAEiS,OAAO3G,OAAOw3E,SAAU,OAC/Bl2E,KAAM5M,EAAEiS,OAAO3G,OAAOw3E,SAAU,QAEhCx/E,MAAOtD,EAAEiS,OAAO3O,EAAO,SAAhB,GAA6BA,GACpCk0E,KAAMx3E,EAAE6E,KAAK7E,EAAEiS,OAAO3G,OAAOksE,KAAM,UAAW,UlE4j2BtDt4E,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GkExr2BX,IAAAM,GAAAjD,EAAA,GlE6r2BIkD,EAEJ,SAAgC/C,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAF3C8C,GkEjq2BxCo4G,GAAc,EAAAn4G,EAAA7C,SAAG,kEACjBi7G,GAAuB,EAAAp4G,EAAA7C,SAAG,iEAC1B46G,GAAc,EAAA/3G,EAAA7C,SAAG,0FlEqx2BrBN,GAAQM,SkElr2BJ66G,WAAYA,EACZC,kBAAmBA,EACnBC,qBAAsBA,EACtBpB,eAAgBA,KlEqr2BSp5G,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASC,GAoBrC,QAASK,GAAwBH,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAII,KAAa,IAAW,MAAPJ,EAAe,IAAK,GAAIK,KAAOL,GAAWM,OAAOC,UAAUC,eAAeC,KAAKT,EAAKK,KAAMD,EAAOC,GAAOL,EAAIK,GAAgC,OAAtBD,GAAOF,QAAUF,EAAYI,EAlBlQE,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GmEn02BX,IAAAC,GAAA5C,EAAA,GAAYuB,EnEw02BJjB,EAAwBsC,GmEv02BhCC,EAAA7C,EAAA,GAAY8C,EnE202BGxC,EAAwBuC,GmE102BvC+zE,EAAA52E,EAAA,GnE802BI62E,EAEJ,SAAgC12E,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFhDy2E,GmEv02BnCglC,EAA4B94G,EAASgW,WAAWtV,QAEhDC,WAAY,SAAS2V,EAAQ/W,GACzBS,EAASgW,WAAWpY,UAAU+C,WAAW7C,KAAK+C,KAAMyV,EAAQ/W,GAC5DsB,KAAKk4G,SAASx5G,EAAQo9F,OAAS97F,KAAK87F,OAASt7F,QAAQ,KAIzDw/E,gBAAiB,WACb,MAAOhgF,MAAKU,IACRy3G,gBAAiBn4G,KAAKuxB,QAO9BtH,MAAO,SAASvrB,GAGZ,MAFAA,GAAUsB,KAAKo4G,mBAAmB15G,GAClCwK,OAAO00B,MAAM,iBAAkBl/B,GACxBS,EAASgW,WAAWpY,UAAUktB,MAAMhtB,KAAK+C,KAAMtB,IAI1D05G,mBAAoB,SAAS15G,GAGzBA,EAAUd,EAAEy6F,MAAM35F,MAClB,IAAI4J,GAAOtI,IAGXtB,GAAQwkB,aAAc,EAStBxkB,EAAQ8L,KAAO9L,EAAQ8L,MAAQlC,EAAKi3F,gBAAgB7gG,GACpDwK,OAAO00B,MAAM,QAASl/B,EAAQ8L,KAG9B,IAAI1B,GAAU9I,KAAKw/F,mBAAmB9gG,EAMtC,OALAwK,QAAO00B,MAAM,WAAY90B,GACpBlL,EAAEirF,QAAQ//E,IACXlL,EAAEiC,OAAOnB,EAAQ8L,KAAMxK,KAAKq4G,wBAAwBvvG,IAExDI,OAAO00B,MAAM,QAASl/B,EAAQ8L,MACvB9L,GAIX6gG,gBAAiB,SAAS7gG,GACtB,GAAIb,KAIJ,OAHImC,MAAK87F,QACLj+F,EAASi+F,MAAQ97F,KAAK87F,OAEnBl+F,EAAEC,SAASD,EAAE06G,KAAK55G,EAASsB,KAAKiiG,cAAepkG,IAI1DokG,cAEI,QAEA,QAEA,SAEA,OAEA,QAIJzC,mBAAoB,SAAS9gG,GAEzB,MAAOd,GAAEy6F,MAAM35F,EAAQoK,cAI3BuvG,wBAAyB,SAASvvG,GAE9B,GAAIyvG,IACA9+E,KACA++E,MAqBJ,OAnBA56G,GAAE2K,KAAKO,EAAS,SAAC+a,EAAGnb,OAENlH,KAANqiB,GAAyB,KAANA,KAIb,IAANA,IACAA,EAAI,SAEE,IAANA,IACAA,EAAI,SAEE,OAANA,IACAA,EAAI,QAGR00F,EAAU9+E,EAAEvsB,KAAKxE,GACjB6vG,EAAUC,GAAGtrG,KAAK2W,MAEf00F,GAIX3jF,MAAO,SAASnf,EAAQ/W,GAEpB,MADAsB,MAAKs9F,YAAa,EACXn+F,EAASgW,WAAWpY,UAAU63B,MAAM33B,KAAK+C,KAAMyV,EAAQ/W,IAIlEo9F,MAAO,KAGPgE,aACIzF,YAAannB,EAAAx2E,QAAS8B,gBAAgB,eAClCG,WAAW,IAEf85G,kBAAmBvlC,EAAAx2E,QAAS8B,gBAAgB,eACxCG,WAAW,IAEfy7F,YAAalnB,EAAAx2E,QAAS8B,gBAAgB,eAClCG,WAAW,IAEf+5G,kBAAmBxlC,EAAAx2E,QAAS8B,gBAAgB,eACxCG,WAAW,KAOnBu5G,SAAU,SAASpc,EAAOp9F,GACtBA,EAAUA,KACV,IAAIoiB,GAAa9gB,KACb24G,EAAa73F,EAAWg/E,YAAYhE,EACxC,IAAIl+F,EAAEg2F,YAAY+kB,GACd,KAAM,IAAIx4G,OAAJ,kBAA4B27F,EAGtC,IAAI6c,IAAe73F,EAAW63F,WAU9B,MANA73F,GAAWg7E,MAAQA,EACnBh7E,EAAW63F,WAAaA,EAEnBj6G,EAAQ8B,QACTsgB,EAAW3f,QAAQ,gBAAiBzC,GAEjCoiB,KAQX4/E,EAAsBuX,EAA0Bp4G,QAEhD8gG,aAAc,IAEd7gG,WAAY,SAAS2V,EAAQ/W,GACzBu5G,EAA0Bl7G,UAAU+C,WAAW7C,KAAK+C,KAAMyV,EAAQ/W,GAClEsB,KAAKu9F,YAAc7+F,EAAQ6+F,aAAe,GAG9C2E,kBAAmB,WACf,MAAOliG,MAAKa,QAGhB+3G,eAAgB,WACZ,MAAO54G,MAAKkiG,qBAAuBliG,KAAK2gG,cAG5CkY,YAAa,WACT,MAAO7/F,MAAK4+B,MAAM53C,KAAKkiG,oBAAsBliG,KAAK2gG,eAGtDmY,aAAc,WACV,MAAO94G,MAAK64G,cAAgB,GAGhCE,mBAAoB,SAASC,GAEzB,MADAA,GAAUh5G,KAAKi5G,iBAAiBD,IAE5BrZ,MAAO3/F,KAAK2gG,aACZhmF,OAAQq+F,EAAUh5G,KAAK2gG,eAI/BsY,iBAAkB,SAASD,GACvB,MAAOhgG,MAAKS,IAAI,EAAGT,KAAKU,IAAIs/F,EAASh5G,KAAK64G,iBAI9Crb,UAAW,SAASwb,EAASt6G,GACzB,GAAI4J,GAAOtI,IAMX,OALAg5G,GAAU1wG,EAAK2wG,iBAAiBD,GAChC1wG,EAAKi1F,YAAcyb,EACnBt6G,EAAUd,EAAEC,SAASa,MAAe4J,EAAKywG,mBAAmBC,IAE5D1wG,EAAKnH,QAAQ,iBACNmH,EAAK2hB,MAAMvrB,GAASklF,OAAO,WAC9Bt7E,EAAKnH,QAAQ,yBAIrBi9F,iBAAkB,SAAS1/F,GACvB,MAAOsB,MAAKw9F,UAAUx9F,KAAKu9F,YAAa7+F,IAG5Cw6G,cAAe,SAASx6G,GACpB,MAAOsB,MAAKw9F,UAAUx9F,KAAKu9F,YAAc,EAAG7+F,IAGhDy6G,cAAe,SAASz6G,GACpB,MAAOsB,MAAKw9F,UAAUx9F,KAAKu9F,YAAc,EAAG7+F,MAQhDggG,EAAgCuZ,EAA0Bp4G,QAE1D++F,kBAAmB,KAEnBC,cAAe,IAEf/+F,WAAY,SAAS2V,EAAQ/W,GACzBu5G,EAA0Bl7G,UAAU+C,WAAW7C,KAAK+C,KAAMyV,EAAQ/W,GAElEsB,KAAK4+F,kBAAoBlgG,EAAQkgG,mBAAqB5+F,KAAK4+F,kBAE3D5+F,KAAK6+F,cAAgBngG,EAAQmgG,eAAiB7+F,KAAK6+F,cAEnD7+F,KAAKs9F,YAAa,EAElBt9F,KAAKo5G,YAAc16G,EAAQ06G,aAAe,GAI9ChB,mBAAoB,SAAS15G,GAIzB,MADAA,GAAQ2mB,OAAS3mB,EAAQ2mB,SAAU,EAC5B4yF,EAA0Bl7G,UAAUq7G,mBAAmBn7G,KAAK+C,KAAMtB,IAI7EghG,WAAY,SAAShhG,GAKjB,MAJAwK,QAAO00B,MAAM,wCAAyCl/B,GACtDA,EAAUA,EAAUd,EAAEy6F,MAAM35F,MAC5BsB,KAAKs9F,YAAa,EAClBt9F,KAAKo5G,YAAc,EACZp5G,KAAK6/F,UACRjiG,EAAEC,SAASa,GACPk2B,OAAO,EACP+qE,MAAO3/F,KAAK4+F,sBAMxBiB,UAAW,SAASnhG,GAChBwK,OAAO00B,MAAM,uCAAwCl/B,GACrDA,EAAUd,EAAEy6F,MAAM35F,MAClB,IAAIoiB,GAAa9gB,IAGjB,IADAkJ,OAAO00B,MAAM,4BAA6Bl/B,EAAQk2B,QAC7Cl2B,EAAQk2B,OAAS9T,EAAWw8E,WAC7B,MAAOhhG,GAAOsO,MAKdlM,GAAQk2B,MACRl2B,EAAQic,OAAS,MACSnZ,KAAnB9C,EAAQic,SACfjc,EAAQic,OAASmG,EAAWs4F,YAEhC,IAAIzZ,GAASjhG,EAAQihG,MAAQjhG,EAAQihG,OAAS7+E,EAAW+9E,eAAiB,IAI1E,OAHA31F,QAAO00B,MAAM,oBAAqB+hE,EAAO,UAAWjhG,EAAQic,QAE5DmG,EAAW3f,QAAQ,iBAEf2f,EACKmJ,MAAMvrB,GACNklF,OAAO,WACJ9iE,EAAW3f,QAAQ,wBAGtB6vB,KAAK,SAAwBqoF,GAC1B,GAAIC,GAAa17G,EAAEqF,QAAQo2G,GAAeA,EAAYx4G,OAAS,CAC/DigB,GAAWs4F,aAAeE,EAC1BpwG,OAAO00B,MAAM,0BAA2B9c,EAAWs4F,eAE9CzZ,GAAS2Z,EAAa3Z,KACvB7+E,EAAWw8E,YAAa,EACxBx8E,EAAW3f,QAAQ,cAAenB,UAOtDu5G,SAAU,SAAS76G,GAGfA,EAAUA,KACV,IAAI4J,GAAOtI,IAGX,OAFAtB,GAAUd,EAAE06G,KAAK55G,EAAS,UAC1BA,EAAQoK,WACDR,EAAK2hB,MAAMvrB,GAASsyB,KAAK,WAC5B1oB,EAAKg1F,YAAa,EAClBh1F,EAAKnH,QAAQ,cAAemH,OnEi12BxClM,GAAQM,SmE102BJu7G,0BAA2BA,EAC3BvX,oBAAqBA,EACrBhC,8BAA+BA,KnE602BNzhG,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAsBrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GoE7q3BX,IAAA05F,GAAAr8F,EAAA,KpEkr3BIs8F,EAAiBp8F,EAAuBm8F,GoEjr3B5CjB,EAAAp7F,EAAA,KpEqr3BIq7F,EAAwBn7F,EAAuBk7F,GoEpr3BnDxkB,EAAA52E,EAAA,GpEwr3BI62E,EAAY32E,EAAuB02E,GoEvr3BvC3zE,EAAAjD,EAAA,GAGIi7F,GpEwr3BiB/6F,EAAuB+C,GoExr3B/Bq5F,EAAAj8F,QAAQ68F,oBAEjB5B,EAAgBD,EAAAh7F,QAAgBk7F,oBAGhCkJ,EAA4BxJ,EAAOz3F,OACnCqzE,EAAAx2E,QAASQ,MACLy6F,GAGI95F,SAAUD,EAAEiC,UAAWy3F,EAAOv6F,UAAUc,SAAU85F,EAAc95F,UAC5DkxF,qBAAsB,UACtB30D,YAAa,gCpEgs3B7Bh+B,GAAQM,SoExr3BJokG,0BAA2BA,KpE2r3BF7jG,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GAwBlD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAtBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GqE/t3BX,IAAA+oG,GAAA1rG,EAAA,IrEou3BI2rG,EAAazrG,EAAuBwrG,GqEnu3BxCyR,EAAAn9G,EAAA,KrEuu3BIo9G,EAAqBl9G,EAAuBi9G,GqEtu3BhDvmC,EAAA52E,EAAA,GrE0u3BI62E,EAAY32E,EAAuB02E,GqEzu3BvC3zE,EAAAjD,EAAA,GrE6u3BIkD,EAAiBhD,EAAuB+C,EqE5u3B5CjD,GAAA,IAEA,IAkBIq9G,GAAYv6G,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAS8C,eAAeK,QAErDH,cApBW,OAuBXi6G,UAAW3R,EAAAtrG,QAAUypG,aAErBzV,gBAAiBvxF,EAASgW,WAE1B+V,QAAS,MACTtK,UAAW,aAGXxZ,QAAS,OAGTwyG,UAAU,EAAAr6G,EAAA7C,SAAG,sBAEbm9G,cAAc,EAAAt6G,EAAA7C,SAAG,2BAEjBo9G,mBAAmB,EAAAv6G,EAAA7C,SAAG,UAMtBoD,WAAY,SAASuF,EAAY3G,GAC7B2G,EAAaA,MAETA,EAAW5F,SACXO,KAAKP,OAAS4F,EAAW5F,QAE7BO,KAAKoK,IAAOpK,KAAZ,eAAgCqF,GAIhCrF,KAAKoH,QAAUxJ,EAAE+0B,IAAIttB,EAAY,WAAaA,EAAW+B,QAAUpH,KAAKoH,QAGxEpH,KAAK8I,WAEL9I,KAAK+C,UAAYsC,EAAWtC,WAAa,GAMzC/C,KAAK+5G,cAAqCv4G,KAAzB6D,EAAW00G,WAA0B10G,EAAW00G,UAIjE/5G,KAAK2G,SAAWtB,EAAWsB,aAE3B3G,KAAKg6G,aAAe,KAGpBh6G,KAAKi6G,UAAY50G,EAAW40G,YAAa,EAGzCj6G,KAAK25G,UAAYt0G,EAAWs0G,WAAa35G,KAAK25G,UAG9C35G,KAAKk6G,SAELl6G,KAAK8gB,WAAazb,EAAWyb,YAAc9gB,KAAKm6G,2BAGhDn6G,KAAK8I,QAAUzD,EAAWyD,YAG1B9I,KAAKo6G,iBAAmB/0G,EAAW+0G,kBAAoBp6G,KAAKo6G,iBAG5Dp6G,KAAK0J,MAAQrE,EAAWqE,OAAS,GAEjC1J,KAAK4mG,SAAWvhG,EAAWuhG,UAAY,GAEvC5mG,KAAKggF,mBAKTA,gBAAiB,WA0Bb,MAzBAhgF,MAAK6f,MAIL7f,KAAKU,IACDgB,MAAO,SAASR,EAAOgqC,EAAKxsC,EAASuuE,EAAKgvB,GAEtC9xF,QAAQzI,MAAMR,EAAOgqC,EAAKxsC,EAASuuE,EAAKgvB,IAG5Coe,QAAS,WACLr6G,KAAKs6G,sBAAsB,aAAc,KAE7CC,eAAgB,WACZv6G,KAAKw6G,sBAAsB,OAKnCx6G,KAAK60F,KAAK,WAAY,WAClB70F,KAAKmB,QAAQ,mBAAoBnB,QAGrCA,KAAK+7F,4BACL/7F,KAAKy6G,sBACEz6G,MAIXm6G,yBAA0B,WAEtB,MAAO,IAAIn6G,MAAK0wF,qBAIpBqL,0BAA2B,WAyBvB,MAxBA/7F,MAAKoK,IAAOpK,KAAZ,6BAA8CA,KAAK8gB,YACnD9gB,KAAKkpF,cAAclpF,KAAK8gB,YAGxB9gB,KAAK6rB,SAAS7rB,KAAK8gB,YACfpf,MAAO,SAASR,EAAOgqC,EAAKxsC,EAASuuE,EAAKgvB,GACtCj8F,KAAKmB,QAAQ,QAASD,EAAOgqC,EAAKxsC,EAASuuE,EAAKgvB,IAEpDt9D,OAAQ,SAAS7d,EAAYpiB,GACzB,GAAIg1E,GAAUh1E,EAAQg1E,OAGtB,OAAIh1E,GAAQg8G,WAAahnC,EAAQoV,MAAMjoF,OAAS6yE,EAAQkR,QAAQ/jF,OAAS,EAC9Db,KAAK26G,cAGa,IAAzBjnC,EAAQoV,MAAMjoF,OACPb,KAAK46G,YAAYh9G,EAAE82B,MAAMg/C,EAAQoV,OAAQhoE,EAAYpiB,GAEjC,IAA3Bg1E,EAAQkR,QAAQ/jF,OACTb,KAAK66G,eAAej9G,EAAE82B,MAAMg/C,EAAQkR,SAAU9jE,EAAYpiB,OADrE,MAKDsB,MAIXy6G,oBAAqB,WACjBz6G,KAAKoK,IAAOpK,KAAZ,wBAGAA,KAAKU,IACDo6G,gBAAiB,SAASz8G,EAAM0G,GAC5B,GAAIA,GAAMA,EAAGg2G,UAAY/6G,KAAKg6G,aAAc,CACxC,GAAIgB,GAAmBh7G,KAAKi7G,gBAAgBj7G,KAAKg6G,aAC7CgB,IACAh7G,KAAKk7G,YAAY78G,EAAM28G,OAEpBj2G,IAAMA,EAAGkiG,SAAWjnG,KAAK+5G,WAChC/5G,KAAKm7G,eAETn7G,MAAK2G,SAASuG,KAAK7O,EAAK6C,MAAMhB,IAC9BF,KAAKg6G,aAAe37G,EAAK6C,MAAMhB,IAGnCk7G,mBAAoB,SAAS/8G,EAAM0G,GAC/B/E,KAAK2G,SAAW/I,EAAE02F,QAAQt0F,KAAK2G,SAAUtI,EAAK6C,MAAMhB,QAShE8b,OAAQ,SAAS7U,GACbnH,KAAKoK,IAAOpK,KAAZ,UAA2BmH,EAC3B,IAAIk+F,GAAarlG,KAAKslG,iBAGtB,OAFAtlG,MAAKgoF,gBAAgBqd,GACrBrlG,KAAKulG,gBAAgBF,EAAYl+F,GAC1BnH,MAIXslG,gBAAiB,WACbtlG,KAAK49B,MAAS59B,KAAd,8BACA,IAAIqlG,GAAa7/F,EAAExF,KAAKy6B,UAAU1c,MAAO/d,MAMzC,OALAA,MAAKq7G,gBAAgBhW,GACrBrlG,KAAKs7G,aAAajW,GAClBrlG,KAAKwmG,gBAAgBnB,GACrBrlG,KAAKu7G,cAAclW,GACnBrlG,KAAK26G,YAAYtV,GACVA,GAIXgW,gBAAiB,SAAShW,GACtBrlG,KAAK49B,MAAS59B,KAAd,8BACA,IAAIw7G,GAAYh2G,EAAExF,KAAKy6B,UAAUghF,YAAaz7G,MAE9C,OADAqlG,GAAWv+F,KAAK,aAAagkB,YAAY0wF,GAClCA,GAIXF,aAAc,SAAS1V,KAMvBY,gBAAiB,SAASZ,KAS1BL,gBAAiB,SAASF,EAAYl+F,GAClCA,MAAkB3F,KAAV2F,EAAsBnH,KAAKoH,QAAUD,CAC7C,IAAIo/E,GAAQvmF,IACZumF,GAAMn8E,IAAI,mBAAoBi7F,EAAYl+F,GAE1C3B,EAAE+gF,GAAOp2C,MAAM,MACX,SAAAw1D,GACIpf,EAAMhiF,IAAImpB,QAAQvmB,EAAOw+F,IAE7B,SAAAA,GACIpf,EAAMmf,eAAeL,GACrBM,KAEJ,SAAAA,GACIpf,EAAMhiF,IAAIqpB,OAAOzmB,EAAOw+F,IAE5B,SAAAA,GACIpf,EAAMplF,QAAQ,WAAYolF,GAC1Bof,QAMZD,eAAgB,SAASL,GAQrB,MAPArlG,MAAKuE,IACAyjB,QACA9hB,KAAK,QAASlG,KAAK4gB,WACnBjX,OAAO07F,EAAWnmF,YACnBlf,KAAK+5G,WACL/5G,KAAKm7G,cAAc,GAEhBn7G,MAMXgoF,gBAAiB,SAAS4d,GAOtB,MANAA,GAASA,GAAU5lG,KAAKuE,IACxBvE,KAAKw7G,UAAU5V,GACV9+F,KAAK,WACL2a,UAELzhB,KAAK07G,6BAA6B9V,GAC3B5lG,MAIX07G,6BAA8B,SAAS9V,GACnCA,EAASA,GAAU5lG,KAAKuE,GACxB,IAAI6yE,GAAQwuB,EAAO9+F,KAAK,qBACpB60G,EAAU37G,KAAK47G,oBACnB,KAAKD,EAAQ96G,OACT,MAAOu2E,GAAMpvD,OAGjB,IAAI6zF,GAAWr2G,GAEP,2CACA,gGACA,EAAAjG,EAAA7C,SAAG,oBACH,MACA,YACA,oDACA,QACA,UACFyB,KAAK,KAEP29G,EAAWH,EAAQ5wG,IAAI,SAAAmtB,GACvB,GAAI9Y,IAAQ,qCAAsC8Y,EAAO9Y,KAAM,aAAajhB,KAAK,GACjF,OAAOqH,GAAE4Z,GAAMU,MAAM,SAAA/a,GAEjB,MADAA,GAAG+hB,iBACIoR,EAAOtc,KAAK7W,MAK3B,OAFA82G,GAAS/0G,KAAK,MAAM6C,OAAOmyG,GAC3B1kC,EAAMtsD,YAAY+wF,GACXA,GAOXD,mBAAoB,WAChB,UAKJxB,iBAAkB,SAASxU,GAEvB,OAAQA,GAAU5lG,KAAKuE,KAAK8Z,SAASA,UAGzCm9F,UAAW,SAAS5V,GAChB,OAAQA,GAAU5lG,KAAKuE,KAAKuC,KAAK,gBAGrC+sF,MAAO,SAAS+R,GACZ,OAAQA,GAAU5lG,KAAKuE,KAAKuC,KAAK,kBAGrCi1G,UAAW,SAASnW,GAEhB,OAAQA,GAAU5lG,KAAKuE,KAAKuC,KAAK,0BAGrCk1G,cAAe,SAASpW,GACpB,OAAQA,GAAU5lG,KAAKuE,KAAKuC,KAAK,qBAKrC6zG,YAAa,SAAS/S,GAClBA,EAAWA,GAAY5nG,KAAKuE,GAC5B,IAAIgiF,GAAQvmF,IACZumF,GAAMn8E,IAAOpK,KAAb,eAAiC4nG,EAEjC,IAAI/T,GAAQtN,EAAMsN,MAAM+T,EACxBrhB,GAAM01B,WAGN,IAAIC,GAAc31B,EAAM41B,mBAkBxB,OAfA51B,GAAM2zB,MAAQgC,EAAYnxG,IAAI,SAAAqxG,GAE1B,MADW71B,GAAM81B,gBAAgBD,KAIrCvoB,EAAM7rE,QAEFu+D,EAAM2zB,MAAMr5G,QACZ0lF,EAAM+1B,aAAa1U,GAGvBrhB,EAAMg2B,oBAAoB3U,GAAUnjG,QAAQ8hF,EAAM2zB,MAAMr5G,QACxD0lF,EAAMplF,QAAQ,cAAeolF,EAAM2zB,OAG5B3zB,EAAM2zB,OAIjBiC,kBAAmB,WAEf,GAAI51B,GAAQvmF,IACZ,OAAOumF,GAAMzlE,WAAWtd,OAAO5F,EAAEiI,KAAK0gF,EAAMi2B,YAAaj2B,KAM7Di2B,YAAa,SAASt7G,GAElB,GAAIqlF,GAAQvmF,IACZ,OACIpC,GAAE6+G,MAAMl2B,EAAMz9E,QAAQiC,IAAI,SAAAuiF,GAAA,MAAMA,GAAGrwF,KAAKiE,SACtCqlF,EAAMxjF,WAAa7B,EAAM0C,WAAW2iF,EAAMxjF,aAKpDs5G,gBAAiB,SAASn7G,GACtB,GAAIw7G,GAAY18G,KAAK28G,kBAAkBz7G,GACnCxC,EAAUd,EAAEiC,OAAOG,KAAK48G,oBAAoB17G,IAC5CA,MAAOA,IAEP7C,EAAO,GAAIq+G,GAAUh+G,EAEzB,OADAsB,MAAK68G,wBAAwBx+G,GACtBA,GAIXy+G,iBAAkB,SAASz+G,GACvB2B,KAAKkpF,cAAc7qF,GACnB2B,KAAKk6G,MAAQt8G,EAAE02F,QAAQt0F,KAAKk6G,MAAO77G,IAGvC0+G,kBAAmB,SAAS1+G,GACxB,GAAIiK,GAAOtI,IAKX,OAJAsI,GAAK4xG,MAAM3kF,QAAQ,SAAA1R,GACfvb,EAAK4gF,cAAcrlE,KAEvBvb,EAAK4xG,SACE5xG,GAIX2zG,UAAW,WACP,MAAOj8G,MAAK+8G,qBAIhBJ,kBAAmB,SAASz7G,GAExB,MAAOlB,MAAK25G,WAIhBiD,oBAAqB,SAAS17G,GAE1B,OAEIkG,QAASpH,KAAKoH,QACdg+F,UAAU,EACV1+F,WAAY1G,KAAK+5G,UACjBpzG,SAAU/I,EAAEsS,SAASlQ,KAAK2G,SAAUzF,EAAMhB,IAC1CoF,UAAWtF,KAAKi6G,YAKxB4C,wBAAyB,SAASx+G,GAC9B,GAAIkoF,GAAQvmF,IA4BZ,OA1BAA,MAAK6rB,SAASxtB,EAAM,MAAO,WACvB,GAAIhB,GAAOC,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,EACjDH,GAAK,GAAL,QAAkBA,EAAK,GACvBkpF,EAAMplF,QAAQrD,MAAMyoF,EAAOlpF,KAI/B2C,KAAK6rB,SACDxtB,EACA,sBACA,SAAS0G,EAAI8e,GAET,GAAIzlB,MAEAuI,EAAW3G,KAAKg9G,mBAEhB5+G,GADAuI,EAAS9F,OACF8F,EAAShF,UAERkiB,EAAE3iB,MAAMS,UAEpBoD,EAAGuB,aAAaE,QAAQ,OAAQ1E,KAAKC,UAAU3D,KAGnD4B,MAGGumF,GAIX+1B,aAAc,SAAS1U,GACnB,GAAIt/F,GAAOtI,IAIX,OADAA,MAAK6zF,MAAM+T,GAAUj+F,OAAO3J,KAAKk6G,MAAMnvG,IAAI,SAAA1M,GAAA,MAAQiK,GAAK20G,mBAAmB5+G,MACpE2B,MAIXi9G,mBAAoB,SAAS5+G,GAEzB,MAAOA,GAAK2d,OAAO,GAAGzX,KAI1Bg4G,oBAAqB,SAAS3U,GAC1B5nG,KAAK49B,MAAM,sBAAuBgqE,EAAU5nG,KAAK+C,UACjD,IAAI+Z,GAAO9c,KAAK+C,UAAY/C,KAAK65G,aAAe75G,KAAK45G,QACrD,OAAO55G,MAAKg8G,cAAcpU,GAAU9qF,KAAKA,IAI7CogG,UAAW,WACPt/G,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAK0nG,YAKboX,YAAa,WACTv/G,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAK2nG,cAMb4U,YAAa,SAAS15G,EAAO4f,EAAYpiB,GAErC,GAAI6nF,GAAQvmF,KAIRo9G,EAAa72B,EAAM41B,oBAAoBh6G,QAAQjB,EACnD,KAAoB,IAAhBk8G,EAAJ,CAGA,GAAI/+G,GAAOkoF,EAAM81B,gBAAgBn7G,EAiBjC,OAdAsE,GAAEnH,GAAM8xC,MAAM,MACV,SAAAw1D,GAEQpf,EAAMy1B,gBAAgBp3G,GAAG,YACzB2hF,EAAMy1B,gBAAgBtuF,QAAQ64D,EAAMn/E,QAASu+F,GAE7CA,KAGR,SAAAA,GACIpf,EAAM82B,YAAYh/G,EAAM++G,GACxBzX,OAGDtnG,IAIXg/G,YAAa,SAASh/G,EAAM++G,EAAYE,GAEpCA,IAAQ1/G,EAAEg2F,YAAY0pB,IAAgBA,EACtCF,EAAaA,GAAc,CAC3B,IAAI72B,GAAQvmF,IAeZ,OAZAumF,GAAM2zB,MAAMptG,OAAOswG,EAAY,EAAG/+G,GAClCkoF,EAAMg3B,kBAAkBH,EAAY72B,EAAM02B,mBAAmB5+G,GAAMiJ,QAEnEi/E,EAAMplF,QAAQ,gBAAiB9C,GAC3Bi/G,EACAj/G,EAAKkG,IAAIg3B,UAAUgrD,EAAMn/E,QAAS,WAC9Bm/E,EAAMplF,QAAQ,6BAGlB9C,EAAKkG,IAAI8C,OACTk/E,EAAMplF,QAAQ,2BAEX9C,GAIXk/G,kBAAmB,SAAS3wG,EAAO4wG,GAE/B,GAAI3pB,GAAQ7zF,KAAK6zF,OASjB,OARc,KAAVjnF,EACAinF,EAAM51D,QAAQu/E,GAEd3pB,EACK30E,WACAC,GAAGvS,EAAQ,GACX0jC,MAAMktE,GAERA,GAIX3C,eAAgB,SAAS35G,EAAO4f,EAAYpiB,GACxC,GAAI6nF,GAAQvmF,KACR3B,EAAOT,EAAEkJ,KAAKy/E,EAAM2zB,MAAO,SAAAr2F,GAAA,MAAKA,GAAE3iB,QAAUA,GAChD,IAAK7C,EAsBL,MAnBAkoF,GAAM2zB,MAAQt8G,EAAE02F,QAAQ/N,EAAM2zB,MAAO77G,GACrCkoF,EAAMplF,QAAQ,eAAgB9C,GAI9BmH,MAAM2qC,MAAM,MACR,SAAAw1D,GACItnG,EAAKkG,IAAImpB,QAAQ64D,EAAMn/E,QAASu+F,IAEpC,SAAAA,GACItnG,EAAKgnB,SACLkhE,EAAMplF,QAAQ,yBACTolF,EAAM2zB,MAAMr5G,OAGb8kG,IAFApf,EAAMg2B,sBAAsB3uF,OAAO24D,EAAMn/E,QAASu+F,MAMvDtnG,GAIX48G,gBAAiB,SAAS/6G,GACtB,MAAOtC,GAAEkJ,KAAK9G,KAAKk6G,MAAO,SAAAr2F,GAAA,MAAKA,GAAE3iB,MAAMhB,KAAOA,KAIlDu9G,cAAe,SAASv8G,GACpB,MAAOA,GAAQlB,KAAKi7G,gBAAgB/5G,EAAMhB,QAAMsB,IAIpDk8G,gBAAiB,SAASC,GACtB,MAAO39G,MAAKk6G,MAAM12G,OAAO,SAAAnF,GAAA,MAAQT,GAAEggH,QAAQv/G,EAAK6C,MAAMmE,WAAYs4G,MAItEE,UAAW,SAASC,EAAOC,GACvB,GAAID,IAAUC,EACV,MAAOD,IAASA,KAGpB,IAAIE,GAASh+G,KAAKk6G,MAAM/3G,QAAQ27G,GAC5BG,EAASj+G,KAAKk6G,MAAM/3G,QAAQ47G,EAGhC,QAAgB,IAAZC,IAA6B,IAAZC,EACbD,IAAWC,MAGI,IAAZD,GAAiBD,IAAUD,GAI/BE,EAASC,EAASj+G,KAAKk6G,MAAM38G,MAAMygH,EAAQC,EAAS,GAAKj+G,KAAKk6G,MAAM38G,MAAM0gH,EAAQD,EAAS,IAWtGzC,cAAe,SAAS3V,GAQpB,MAPAA,GAAO9+F,KAAK,2BAA2Bo3G,aACnC/gC,YAAan9E,KAAK85G,kBAClBqE,WAAYn+G,KAAK+C,UACjBq7G,cAAexgH,EAAEiI,KAAK7F,KAAKq+G,aAAcr+G,MACzCs+G,SAAU1gH,EAAEiI,KAAK7F,KAAKu+G,YAAav+G,MACnCw+G,QAAS5gH,EAAEiI,KAAK7F,KAAKy+G,YAAaz+G,QAE/B4lG,GAIXyY,aAAc,SAASt7G,GAGnB,MADA/C,MAAKoK,IAAI,gBAAiBrH,GACnB/C,KAAKu+G,YAAYx7G,IAI5Bw7G,YAAa,SAASx7G,EAAWo8C,GAE7B,GADAn/C,KAAKoK,IAAI,cAAerH,EAAW/C,KAAK+C,UAAWo8C,IAC9CA,GAASn/C,KAAK+C,YAAcA,EAC7B,MAAO/C,KAEXA,MAAK+C,UAAYA,EACjB/C,KAAK26G,cACL36G,KAAKmB,QAAQ,mBAAoB4B,EAAW/C,KAC5C,IAAI0+G,GAAU1+G,KAAKwF,EAAE,4BAIrB,OAHIk5G,GAAQ/1G,QAAU5F,GAClB27G,EAAQ/1G,IAAI5F,GAET/C,MAIXy+G,YAAa,SAAS17G,GAMlB,MAJA/C,MAAK+C,UAAY,GACjB/C,KAAKmB,QAAQ,eAAgBnB,MAC7BA,KAAKwF,EAAE,6BAA6BmD,IAAI,IACxC3I,KAAK26G,cACE36G,MAKX2+G,wBAAyB,GAGzBxD,cAAe,SAASh0G,GACpBA,MAAkB3F,KAAV2F,EAAsBA,EAAQnH,KAAKoH,QAC3CpH,KAAK+5G,WAAY,EACjB/5G,KAAKwF,EAAE,iBAAiB+1B,UAAUp0B,GAClCA,EAAQnH,KAAKk6G,MAAMr5G,QAAUb,KAAK2+G,wBAA0B,EAAIx3G,EAChEvJ,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAK6I,aAAaC,MAO1By3G,cAAe,SAASz3G,GACpBA,MAAkB3F,KAAV2F,EAAsBA,EAAQnH,KAAKoH,QAC3CpH,KAAK+5G,WAAY,EACjB/5G,KAAKwF,EAAE,iBAAiBg2B,QAAQr0B,GAChCA,EAAQnH,KAAKk6G,MAAMr5G,QAAUb,KAAK2+G,wBAA0B,EAAIx3G,EAChEvJ,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAK4I,aAAaE,KAEtBnH,KAAK2G,YACL3G,KAAKg6G,aAAe,MAIxB6E,gBAAiB,WACR7+G,KAAK+5G,UAGN/5G,KAAK4+G,gBAFL5+G,KAAKm7G,iBAOb2D,UAAW,SAASz4G,GAChBzI,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAKoJ,OAAOpB,MAKpB04G,YAAa,SAAS14G,GAClBrG,KAAKg6G,aAAe,KACpBp8G,EAAE2K,KAAKvI,KAAKk6G,MAAO,SAAA77G,GACfA,EAAKmJ,SAASnB,MAKtB60G,YAAa,SAAS4C,EAAOC,GACzB,GAAIzgG,GAAQtd,KAAK69G,UAAUC,EAAOC,EAIlC,OAHAngH,GAAE2K,KAAK+U,EAAO,SAAAjf,GACVA,EAAKoJ,WAEF6V,GAIX0hG,iBAAkB,WACd,MAAOphH,GAAE4F,OAAOxD,KAAKk6G,MAAO,SAAAr2F,GAAA,MAAKA,GAAEld,YAIvCq2G,kBAAmB,WAEf,MAAO,IAAIh9G,MAAK8gB,WAAWtY,YAAY5K,EAAEmN,IAAI/K,KAAKg/G,mBAAoB,SAAA3gH,GAAA,MAAQA,GAAK6C,UAKvFo5G,sBAAuB,SAASrtC,EAAK9lE,EAAO0a,GACxC7hB,KAAK49B,MAAM,wBAAyB59B,KAAKi2G,UAAWhpC,EAAK9lE,EAAO0a,GAChE1a,MAAkB3F,KAAV2F,EAAsBA,EAAQnH,KAAKoH,QACtCpH,KAAKi2G,YACNj2G,KAAKi2G,UAAY,GAAAwD,GAAA/8G,QAAqBsD,KAAKuE,KAC3CvE,KAAK49B,MAAM,aAAc59B,KAAKi2G,YAE7Bj2G,KAAKuE,IAAIK,GAAG,aAGb5E,KAAKuE,IAAImpB,QAAQvmB,GACjBnH,KAAKi2G,UAAU5uG,KAAK4lE,EAAK9lE,EAAO0a,IAHhC7hB,KAAKi2G,UAAU5uG,KAAK,EAAGwa,IAQ/B24F,sBAAuB,SAASrzG,EAAO0a,GACnC7hB,KAAK49B,MAAM,wBAAyB59B,KAAKi2G,UAAW9uG,EAAO0a,GAC3D1a,MAAkB3F,KAAV2F,EAAsBA,EAAQnH,KAAKoH,QACvCpH,KAAKi2G,WACLj2G,KAAKi2G,UAAU3uG,KAAKH,EAAO0a,IAMnCo9F,eAAgB,WACZ,MAAOj/G,MAAKo6G,mBAAmB18F,aAInCwhG,SAAU,SAAStqD,EAAKztD,GAGpB,MAFAA,GAAQA,GAAS,EACjBnH,KAAKo6G,mBAAmBtpF,SAAUpT,UAAWk3C,GAAOztD,GAC7CnH,MAIXm/G,YAAa,SAASh4G,GAClB,MAAOnH,MAAKk/G,SAAS,EAAG/3G,IAI5Bi4G,aAAc,SAAS/gH,EAAM8I,GACzB,MAGOnH,OAIXq/G,WAAY,SAASn/G,EAAIiH,GACrB,MAAOnH,MAAKo/G,aAAap/G,KAAKi7G,gBAAgB/6G,GAAKiH,IAKvD0X,QACIygG,oBAAqB,YACrBC,sBAAuB,eAK3B/8G,SAAU,WACN,mBAAoBxC,KAAK8gB,WAAzB,MAOZ44F,GAAU38G,UAAU09B,UAAa,WA2C7B,OACI1c,GA3Cam1D,EAAAx2E,QAASqB,cAEtB,QACA,+BACA,iCACA,qDACA,WAsCA09G,SAnCmBvoC,EAAAx2E,QAASqB,cAC5B,yBACA,sBACA,4CACA,SACA,mDAEA,8BAEA,+BAEA,uBACA,mCACA,SAGA,6BACA,0BACA,6CACA,uBACA,EAAAwB,EAAA7C,SAAG,OACH,YACA,+CACA,uBACA,EAAA6C,EAAA7C,SAAG,QACH,YACA,SACA,2CACA,SACA,SACA,cAgBR,IAAI8iH,GAAiB9F,EAAU75G,QAE3B4/G,mBAAoB,WAEpB3/G,WAAY,SAASuF,GACjBq0G,EAAU38G,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GAC1CrF,KAAK+5G,cAAqCv4G,KAAzB6D,EAAW00G,WAA0B10G,EAAW00G,UAEjE/5G,KAAK0/G,SAAS1/G,KAAKkB,MAAOmE,IAM9Bq6G,SAAU,SAASx+G,EAAOmE,GAOtB,GANAA,EAAaA,MACbrF,KAAK49B,MAAS59B,KAAd,aAAgCkB,EAAOmE,GAEvCrF,KAAK2/G,YACL3/G,KAAKi8G,YAED/6G,EAAO,CACP,GAAI0+G,GAAa5/G,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,MAAQ,IAGrDkB,MAAKkB,MAAQA,EACTlB,KAAKP,SACLO,KAAKkB,MAAMzB,OAASO,KAAKP,QAE7BO,KAAK6/G,uBAKL7/G,KAAKkpF,cAAclpF,KAAK8gB,YACxB9gB,KAAK8gB,WACD9gB,KAAKkB,MAAMlB,KAAKy/G,qBAAuBp6G,EAAWyb,YAAc9gB,KAAKm6G,2BACzEn6G,KAAK+7F,4BAED6jB,GAAc1+G,EAAMpC,IAAI,QAAU8gH,GAClC5/G,KAAKmB,QAAQ,YAAanB,MAGlC,MAAOA,OAIX2/G,UAAW,WAQP,MANI3/G,MAAKkB,OACLlB,KAAKkpF,cAAclpF,KAAKkB,OAKrBlB,MAKX6/G,qBAAsB,WAsBlB,MApBA7/G,MAAKoK,IAAOpK,KAAZ,wBAAyCA,KAAKkB,OAE9ClB,KAAK6rB,SACD7rB,KAAKkB,MACL,QACA,WACI,GAAI7D,GAAOC,MAAMP,UAAUQ,MAAMN,KAAKO,UAAW,EAEjDH,GAAKM,QAAQ,SACbqC,KAAKmB,QAAQrD,MAAMkC,KAAM3C,IAE7B2C,MAIAA,KAAKP,QACLO,KAAK6rB,SAAS7rB,KAAKkB,MAAO,MAAO,SAASmF,GACtCrG,KAAKmkF,KAAQnkF,KAAb,UAA4BqG,EAAO7I,aAGpCwC,MAKXq7G,gBAAiB,SAAShW,GACtBrlG,KAAK49B,MAAS59B,KAAd,mCACA,IAAI5B,GAAO4B,KAAKkB,MAAQlB,KAAKkB,MAAMS,YAC/B65G,EAAYh2G,EAAExF,KAAKy6B,UAAUghF,SAASr9G,EAAM4B,MAEhD,OADAqlG,GAAWv+F,KAAK,aAAagkB,YAAY0wF,GAClCA,GAKXh5G,SAAU,WACN,wBAAyBxC,KAAKkB,MAA9B,MAMRs+G,GAAeziH,UAAU09B,UAAa,WAClC,GAAIqlF,GAAmB5sC,EAAAx2E,QAASqB,cAC5B,yBACA,sBAEA,4CACA,SACA,mDACA,8BACA,+BAEA,uBACA,mCACA,SAEA,6BACA,0BACA,6CACA,uBACA,EAAAwB,EAAA7C,SAAG,OACH,YACA,+CACA,uBACA,EAAA6C,EAAA7C,SAAG,QACH,YACA,SACA,2CACA,SACA,SACA,UAGJ,OAAOkB,GAAEiC,OAAOjC,EAAEy6F,MAAMqhB,EAAU38G,UAAU09B,YACxCghF,SAAUqE,OrE8p3BlB1jH,EAAQM,SqExp3BJg9G,UAAWA,EACX8F,eAAgBA,KrE2p3BSviH,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,YsEtr5BA,SAAS6hH,GAAY6B,EAAYrhH,GAqB7B,QAASshH,GAAiB35G,GACTb,EAAExF,MACVqe,SACAa,SAAS,SAETvW,IAAI,IACJxH,QAAQ,qBACR61D,OACLt4D,EAAQ8/G,UAIZ,QAASj7G,GAAO8C,EAAO45G,GACnB,IAAKA,EACD,MAAOD,IAEXx6G,GAAExF,MAAMmB,QAAQ,gBAAiB8+G,GACI,kBAA1BvhH,GAAQ0/G,eAAgC8B,GAC/CA,GAAc,EACdxhH,EAAQ0/G,cAAc6B,IAEtBvhH,EAAQ4/G,SAAS2B,GAKzB,QAASE,KAEL,OACI,4BACAzhH,EAAQiR,KACR,kBACAjR,EAAQy+E,YACR,KACA,uBACAz+E,EAAQggF,QACR,KACA,MACFvgF,KAAK,IA1DX,GAAIiiH,GAAc,GACdC,EAAiB,GACjBC,EAAc96G,EAAEu6G,GAChBG,GAAc,EAEdriH,GACAsgH,WAAY,GACZxuG,KAAM,SACNwtE,YAAa,SACbuB,QAAS,GACT8/B,QAAS,aACTJ,cAAe,KACfE,SAAU,SAASiC,KACnBC,aAAc,EACdC,cAAc,EACdC,OAAQ,aA8GZ,OAA6B,WAAzBniC,EAAA7hF,QAAOkZ,KAAKlX,IACI,mBAAZA,GARR,WACI4hH,EAAYx5G,KAAK,mBAAmBrC,SACpC67G,EAAYx5G,KAAK,iBAAiBrC,YAS3B67G,IAIkB,WAAzB/hC,EAAA7hF,QAAOkZ,KAAKlX,KACZA,EAAU6/E,EAAA7hF,QAAOmD,QAAO,KAAUhC,EAAUa,IAGzC4hH,EAAYtjG,SAAS,gBAAgBihB,SA3E5C,WACI,MACIz4B,GAAE26G,KAEGrkF,MAAM,SAASz1B,GACZb,EAAExF,MAAMyH,WAGXsd,MAAM,SAAS1e,GAKZ,GAJAA,EAAMygB,iBACNzgB,EAAMgb,kBAGFhb,EAAMkc,QAAU69F,GAAe1hH,EAAQ+hH,aACvCT,EAAiB/iH,KAAK+C,KAAMqG,OACzB,CACH,GAAI45G,GAAcz6G,EAAExF,MAAM2I,OAGtBtC,EAAMkc,QAAU89F,GACf3hH,EAAQ8hH,cAAgBP,EAAYp/G,QAAUnC,EAAQ8hH,eAEvDj9G,EAAOtG,KAAK+C,KAAMqG,EAAO45G,MAIpCt3G,IAAIjK,EAAQy/G,eAMzB,WACI,MAAO34G,IACF,iDAAkD,UAAWjH,EAAG,sBAAuB,aAAaJ,KACjG,KAGHsjB,SAAUmJ,UAAW,WACrB9K,MAAM,SAASzZ,GACZ25G,EAAiB/iH,KAAK+C,KAAMqG,QAMxC,WACI,MAAOb,IACF,sDAAuD,UAAWjH,EAAG,cAAe,aAAaJ,KAAK,KAEtGmJ,OACAma,SAAUmJ,UAAW,iBAlIlC,GAAA0zD,GAAAjiF,EAAA,GtE2s5BIkiF,EAEJ,SAAgC/hF,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFjD8hF,GsExs5BlC94E,YACAjH,EAAKoC,OAAOpC,IAAO,SAAAwF,GAAA,MAAKA,GA0J5Bw6E,GAAA7hF,QAAO4wF,GAAGztF,QACNq+G,YAAa,SAAsBx/G,GAC/B,MAAOsB,MAAKuI,KAAK,WACb,MAAO21G,GAAYl+G,KAAMtB,StEwr5B/B,SAAUvC,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GAsBrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GuE/15BX,IAAAorG,GAAA/tG,EAAA,IvEo25BIguG,EAAc9tG,EAAuB6tG,GuEn25BzCn3B,EAAA52E,EAAA,GvEu25BI62E,EAAY32E,EAAuB02E,GuEt25BvC0tC,EAAAtkH,EAAA,KvE025BIukH,EAAkBrkH,EAAuBokH,GuEz25B7CrhH,EAAAjD,EAAA,GvE625BIkD,EAAiBhD,EAAuB+C,GuE125BxCg4F,EAAS+S,EAAA3tG,QAAWyrG,oBAMpB0Y,EAAkBvpB,EAAOz3F,QAErB+gB,UAAc02E,EAAOv6F,UAAU6jB,UAA/B,mBAEA9gB,WAAY,SAASuF,EAAY3G,GAC7B44F,EAAOv6F,UAAU+C,WAAW7C,KAAK+C,KAAMqF,EAAY3G,IAKvD8D,SAAU,WAEN,0BADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZ2/G,GAAgB9jH,UAAU09B,UAAa,WACnC,GAAI+vE,GAAmB,SAAAl9F,GAAA,gLAISA,EAAQ8zB,IAJjB,+CAKUxjC,EAAEumC,OAAO72B,EAAQqC,MAL3B,+DAQbixG,EAAAlkH,QAAgBokH,gBAAgBxzG,GARnB,0BAYnBo5F,EAAW9oG,EAAEiC,UAAWy3F,EAAOv6F,UAAU09B,UAAUisE,UACnD7hG,OAAQquE,EAAAx2E,QAASqB,cAGT,gCACA,gDACA,EAAAwB,EAAA7C,SAAG,gCACH,SACA,WAEJ,YAIR,OAAOkB,GAAEiC,UAAWy3F,EAAOv6F,UAAU09B,WACjCksE,SAAU6D,EACV9D,SAAUA,OvEm25BlBtqG,EAAQM,SuE715BJmkH,gBAAiBA,KvEg25BQ5jH,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GwEz65BrC,QAASmjH,GAAav9F,GAClB,MAA4B,IAAxBA,EAAIrhB,QAAQ,SACZ,kCAAyCvE,EAAEumC,OAAO3gB,EAAIjmB,MAAM,IAA5D,UAEO,GAIf,QAASujH,GAAgBE,GACrB,gCAAiCpjH,EAAEqjH,OAAOrjH,EAAEsjH,KAAKF,EAAYl5B,OACxD/8E,IAAIg2G,GACJ5iH,KAAK,IAFV,UxEk65BJrB,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,IAcX5C,EAAQM,SwE365BJokH,gBAAiBA,KxE865BQ7jH,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GA8BrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GA5BvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GyEv85BX,IAAAmwF,GAAA9yF,EAAA,IzE485BI+yF,EAAW7yF,EAAuB4yF,GyE385BtCgyB,EAAA9kH,EAAA,IzE+85BI+kH,EAAiB7kH,EAAuB4kH,GyE985B5CE,EAAAhlH,EAAA,KzEk95BIilH,EAAmB/kH,EAAuB8kH,GyEj95B9CpuC,EAAA52E,EAAA,GACAskH,GzEo95BgBpkH,EAAuB02E,GyEp95BvC52E,EAAA,MzEw95BIukH,EAAkBrkH,EAAuBokH,GyEv95B7CrhH,EAAAjD,EAAA,GzE295BIkD,EAAiBhD,EAAuB+C,GyEx95BxCg4F,EAAS8pB,EAAA1kH,QAAM4tG,eAGfiX,EAAmBjqB,EAAOz3F,QAEtB+gB,UAAc02E,EAAOv6F,UAAU6jB,UAA/B,mBAGAo/D,gBAAiB,WACbsX,EAAOv6F,UAAUijF,gBAAgB/iF,KAAK+C,MACtCA,KAAK6rB,SAAS7rB,KAAKkB,OACfsgH,8CAA+C,SAAStgH,EAAOxC,GAC3DsB,KAAKgc,aAMjB0rF,sBAAuB,WACnB,GAAItD,GAAiBpkG,KAAKkB,MAAMpC,IAAI,kBACpC,QAAQslG,GACJ,IAAK,OACD,MAAOkd,GAAA5kH,QAAQ+kH,kBACnB,KAAK,SACD,MAAOH,GAAA5kH,QAAQglH,kBACnB,KAAK,cACD,MAAOJ,GAAA5kH,QAAQilH,yBACnB,KAAK,YACD,MAAOL,GAAA5kH,QAAQklH,0BAEvB,KAAM,IAAI9wB,WAAJ,4BAA0CsT,IAIpDsB,eAAgB,SAASL,GACrB/N,EAAOv6F,UAAU2oG,eAAezoG,KAAK+C,KAAMqlG,EAE3C,IAAI38E,GAAS1oB,KAAKkB,MAAMpC,IAAI,aAAgCswF,EAAA1yF,QAAO8lB,GAAxB4sE,EAAA1yF,QAAO8/E,OAIlD,OAFAx8E,MAAKuE,IAAIyY,SAAT,SAA2B0L,GAEpB1oB,KAAKuE,KAKhB/B,SAAU,WAEN,2BADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAMZqgH,GAAiBxkH,UAAU09B,UAAa,WACpC,GAAIisE,GAAW9oG,EAAEiC,UAAWy3F,EAAOv6F,UAAU09B,UAAUisE,UACnD7hG,OAAQ,SAAAic,GACJA,EAAW4J,UAE0C,EAAAnrB,EAAA7C,SAAG,sCAK5D8tG,EAAmB,SAAA1pF,GAAA,gLAISA,EAAWsgB,IAJpB,+CAKUxjC,EAAEumC,OAAOrjB,EAAWnR,MAL9B,sFAQbixG,EAAAlkH,QAAgBokH,gBAAgBhgG,GARnB,yBAYvB,OAAOljB,GAAEiC,UAAWy3F,EAAOv6F,UAAU09B,WACjCisE,SAAUA,EACVC,SAAU6D,OzEu95BlBpuG,EAAQM,SyEj95BJ6kH,iBAAkBA,KzEo95BOtkH,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GA0BrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAxBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G0E1j6BX,IAAA6iH,GAAAxlH,EAAA,K1E+j6BIylH,EAAavlH,EAAuBslH,G0E9j6BxCtqB,EAAAl7F,EAAA,IACA8kH,G1Eik6BwB5kH,EAAuBg7F,G0Ejk6B/Cl7F,EAAA,K1Eqk6BI+kH,EAAiB7kH,EAAuB4kH,G0Epk6B5CluC,EAAA52E,EAAA,G1Ewk6BI62E,EAAY32E,EAAuB02E,G0Evk6BvC3zE,EAAAjD,EAAA,G1E2k6BIkD,EAAiBhD,EAAuB+C,G0Elk6BxCg4F,EAASwqB,EAAAplH,QAAU8iH,eACnBuC,EAAiBzqB,EAAOz3F,QAGpBH,cAXW,cAaXkhB,UAAc02E,EAAOv6F,UAAU6jB,UAA/B,4BAGAohG,oBAAqBZ,EAAA1kH,QAAMiuG,uBAE3BsX,qBAAsBb,EAAA1kH,QAAMkuG,wBAE5B6U,mBAAoB,WAMpB3/G,WAAY,SAASuF,GACjBiyF,EAAOv6F,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GACvCrF,KAAKwzB,WAAanuB,EAAWmuB,YAAc,SAE3CxzB,KAAKuqG,QAAUllG,EAAWklG,QAE1BvqG,KAAKkiH,cAELliH,KAAKmiH,WAAa98G,EAAW88G,WAE7BniH,KAAKonG,aAAe/hG,EAAW+hG,cAAgB,UAC/CpnG,KAAKoiH,YAAiBl5G,OAAOC,KAA7B,2BAA4DnJ,KAAKkB,MAAMmE,WAAWnF,GAAlF,aAGJqlG,gBAAiB,SAASF,EAAYl+F,GAClCA,MAAkB3F,KAAV2F,EAAsBnH,KAAKoH,QAAUD,CAC7C,IAAIo/E,GAAQvmF,IACZumF,GAAMn8E,IAAI,mBAAoBi7F,EAAYl+F,GAK1Co/E,EAAMmf,eAAeL,GACrB9e,EAAMplF,QAAQ,WAAYolF,IAK9B41B,kBAAmB,WAEf,MAAOn8G,MAAKkB,MAAMg5F,sBAItByiB,kBAAmB,SAASz7G,GAGxB,OAAQA,EAAMpC,IAAI,iBACd,IAAK,MACD,MAAOkB,MAAKgiH,mBAChB,KAAK,qBACD,MAAOhiH,MAAKiiH,qBAEpB,KAAM,IAAInxB,WAAU,wBAAyB5vF,EAAMpC,IAAI,kBAI3D89G,oBAAqB,SAAS17G,GAC1B,GAAIxC,GAAU44F,EAAOv6F,UAAU6/G,oBAAoB3/G,KAAK+C,KAAMkB,EAC9D,OAAOtD,GAAEiC,OAAOnB,GACZ80B,WAAYxzB,KAAKwzB,WACjB+2E,QAASvqG,KAAKuqG,QAEdnD,aAAcpnG,KAAKonG,gBAM3ByV,wBAAyB,SAASx+G,GAC9B,GAAIkoF,GAAQvmF,IAYZ,OAXAs3F,GAAOv6F,UAAU8/G,wBAAwB5/G,KAAKspF,EAAOloF,GAGrDkoF,EAAM16D,SAASxtB,GACXgkH,qBAAsB,SAASx+F,EAAGy+F,GAC9BtiH,KAAKuiH,sBAAsBD,IAE/BE,sBAAuB,SAAS3+F,EAAGy+F,GAC/BtiH,KAAKyiH,wBAAwBH,MAG9BtiH,MAIXuiH,sBAAuB,SAASD,GAC5BtiH,KAAKkiH,WAAWh1G,KAAKo1G,GAErBtiH,KAAKwF,EAAE,eACFiE,IAAIzJ,KAAK6zF,SACTvsF,OACLg7G,EAAUH,WAAaniH,KAAKkB,MAAMpC,IAAI,QACtCkB,KAAKuE,IAAIoF,OAAO24G,EAAUtmG,SAASzX,MAIvCk+G,wBAAyB,SAASH,GAC9BtiH,KAAKkiH,WAAWxkH,MAChBsC,KAAKgc,UAKT6C,QACI6jG,0BAA2B,SAI/BC,MAAO,SAASt8G,GACZrG,KAAKqlB,SACLrlB,KAAKmB,QAAQ,UAKjBqB,SAAU,WACN,yBAAyBxC,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,QAAU,IAA/D,MAMZijH,GAAehlH,UAAU09B,UAAa,WAClC,GAAIqlF,GAAmB5sC,EAAAx2E,QAASqB,cAExB,yBACA,2BACA,6CACA,kDACA,EAAAwB,EAAA7C,SAAG,YACH,yBACA,OACA,SAEA,sBACA,kFACA,yBACA,sDACA,EAAA6C,EAAA7C,SAAG,sBACH,+DACA,EAAA6C,EAAA7C,SAAG,sBACH,oEACA,EAAA6C,EAAA7C,SAAG,6BACH,kEACA,EAAA6C,EAAA7C,SAAG,2BACH,UACA,SACA,SAEA,mCAEA,wBACA,oCACA,gCACA,oEACA,uCACA,OACA,SACA,UAEJ,aAGJ,OAAOkB,GAAEiC,OAAOjC,EAAEy6F,MAAMf,EAAOv6F,UAAU09B,YACrCghF,SAAUqE,MAMlB,IAAI2B,GAAqBM,EAAeliH,QAIhCmiH,oBAAqBZ,EAAA1kH,QAAMiuG,uBAI3BnoG,SAAU,WACN,6BAA6BxC,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,QAAU,IAAnE,OAOR4iH,EAAqBD,EAAmB5hH,QAIpC2C,SAAU,WACN,6BAA6BxC,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,QAAU,IAAnE,OAOR6iH,EAA4BI,EAAeliH,QAIvCoiH,qBAAsBb,EAAA1kH,QAAMkuG,wBAAwB/qG,QAChDwnG,kBAAmBqa,IAKvBl/G,SAAU,WACN,oCAAoCxC,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,QAAU,IAA1E,OAOR8iH,EAA4BG,EAAeliH,QAE3CoiH,qBAAsBb,EAAA1kH,QAAMkuG,wBAAwB/qG,QAChDwnG,kBAAmBqa,IAIvBl/G,SAAU,WACN,oCAAoCxC,KAAKkB,MAAQlB,KAAKkB,MAAMpC,IAAI,QAAU,IAA1E,M1Esi6BR1C,GAAQM,S0Ehi6BJqlH,eAAgBA,EAChBN,mBAAoBA,EACpBC,mBAAoBA,EACpBC,0BAA2BA,EAC3BC,0BAA2BA,K1Emi6BF3kH,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,EAAG4H,GAkCxC,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhCvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G2E9y6BX,IAAAmwF,GAAA9yF,EAAA,I3Emz6BI+yF,EAAW7yF,EAAuB4yF,G2Elz6BtCib,EAAA/tG,EAAA,I3Esz6BIguG,EAAc9tG,EAAuB6tG,G2Erz6BzCwY,EAAAvmH,EAAA,I3Eyz6BIwmH,EAAQtmH,EAAuBqmH,G2Exz6BnCE,EAAAzmH,EAAA,K3E4z6BI0mH,EAAexmH,EAAuBumH,G2E3z6B1C7a,EAAA5rG,EAAA,I3E+z6BI6rG,EAAiB3rG,EAAuB0rG,G2E9z6B5Ch1B,EAAA52E,EAAA,G3Ek06BI62E,EAAY32E,EAAuB02E,G2Ej06BvC3zE,EAAAjD,EAAA,G3Eq06BIkD,EAAiBhD,EAAuB+C,G2El06BxCg4F,EAAS+S,EAAA3tG,QAAWyrG,oBAGpB6a,EAAsB1rB,EAAOz3F,QAGzBC,WAAY,SAASuF,GACjBiyF,EAAOv6F,UAAU+C,WAAW7C,KAAK+C,KAAMqF,GACvCrF,KAAKuqG,QAAUllG,EAAWklG,QAG1BvqG,KAAKijH,aAAe59G,EAAW49G,eAAgB,EAI/CjjH,KAAKkjH,gBAAkB79G,EAAW69G,kBAAmB,EAErDljH,KAAKmjH,sBAAwB99G,EAAW89G,wBAAyB,GAKrE5c,sBAAuB,WACnB,GAAIoV,GAAUrkB,EAAOv6F,UAAUwpG,sBAAsBtpG,KAAK+C,KAC1D,OAAIA,MAAKkB,MAAMpC,IAAI,WAAaswF,EAAA1yF,QAAOogF,aAC5B6+B,EAGJrkB,EAAOv6F,UAAUwpG,sBACnBtpG,KAAK+C,MACLoR,QAAQpR,KAAKojH,oBAAqBpjH,KAAKqjH,yBAMhDD,kBAAmB,WACf,GAAI96G,GAAOtI,IAGX,IAAIA,KAAKkB,MAAMpC,IAAI,WAAaswF,EAAA1yF,QAAOqgF,YAAc/8E,KAAKkB,MAAMpC,IAAI,cAChE,MAAO,KAEX,IAAI0zF,GAASxyF,KAAKkB,MAAMpC,IAAI,UACxByzF,EAAUvyF,KAAKkB,MAAMpC,IAAI,WAEzBwkH,GACA55G,OAAO,EAAAnK,EAAA7C,SAAG,mBACVspB,KAAS9c,OAAOC,KAAhB,4BAAgDnJ,KAAKkB,MAAMmE,WAAWnF,GACtEy+E,OAAQ,YACRD,QAAS,WACT33D,QAAS,SAAShiB,GACVmE,OAAO2xB,SACP91B,EAAG+hB,iBACH5d,OAAO2xB,OAAO3tB,KAAK,iBACfgR,WAAY5V,EAAKpH,MAAMmE,WAAWnF,OAoBlD,OAbIqyF,IAAWC,GACX8wB,EAAYr3F,UAAW,EACnBumE,EACA8wB,EAAY55G,OAAQ,EAAAnK,EAAA7C,SAAG,wDAChB61F,IACP+wB,EAAY55G,OAAQ,EAAAnK,EAAA7C,SAAG,yCAIpBkB,EAAEsS,UAAUk/E,EAAA1yF,QAAO4/E,OAAQ8S,EAAA1yF,QAAOggF,KAAM18E,KAAKkB,MAAMpC,IAAI,YAC9DwkH,EAAYr3F,UAAW,EACvBq3F,EAAY55G,OAAQ,EAAAnK,EAAA7C,SAAG,sCAEpB,EAAAwrG,EAAAxrG,SAAa4mH,IAIxBD,oBAAqB,WAEjB,IAAKrjH,KAAKkB,MAAMpC,IAAI,cAChB,MAAO,KAGX,IAAIwJ,GAAOtI,KACPujH,EAAiBvjH,KAAKkB,MAAM+4F,mBAChC,QAAO,EAAAiO,EAAAxrG,UACHgN,MAAQ65G,GAAgC,EAAAhkH,EAAA7C,SAAG,+BAAlB,EAAA6C,EAAA7C,SAAG,UAC5BuvB,SAAUs3F,EACV5kC,OAAQ,WACRD,QAAS,aACT33D,QAAS,WAELze,EAAK/D,IAAIuC,KAAK,wBAAwB3F,QAAQ,YAC9CmH,EAAKpH,MAAL,aAOZukG,eAAgB,WAEZ,GAAID,GAAWlO,EAAOv6F,UAAU0oG,eAAexoG,KAAK+C,MAEhD0oB,EAAQ1oB,KAAKkB,MAAMpC,IAAI,QAS3B,QAPKkB,KAAKkB,MAAM+4F,qBAAuBr8F,EAAEsS,UAAUk/E,EAAA1yF,QAAO8lB,GAAI4sE,EAAA1yF,QAAOmgF,iBAAkBn0D,KACnF1oB,KAAKqoF,YAAYmd,GACjBxlG,KAAKwjH,kBAAkBhe,GACvBxlG,KAAKyjH,mBAAmBje,IAG5BxlG,KAAKgoF,gBAAgBwd,GACdA,GAOXke,sBAAuB,WACnB,GAAIC,GAAY3jH,KAAKkB,MAAMmE,WAAW6Y,WAClC0lG,EAAQ5jH,KAAKkB,MAAMmE,WAAWw+G,aAC9Bv7G,EAAOtI,KAEP8jH,EAAiB,SAAAt5G,GACjB,GAAIu5G,qBAA+BJ,EAA/B,qBACAn5G,GAAKmF,MAAQnF,EAAKwX,MAClB+hG,4BAAuCv5G,EAAKmF,KAA5C,iBACAo0G,GAAcv5G,EAAKwX,MAEnB+hG,GAAc,mEAElBA,GAAc,SACdz7G,EAAK/D,IAAIuC,KAAK,YAAY6C,OAAOnE,EAAEw+G,UAAUD,KAE7CE,EAAc,SAAAz5G,GACdhF,EAAE6E,MACEC,IAAQpB,OAAOC,KAAf,aAAgCqB,EAAKguB,QAArC,WAECxH,KAAK,SAAAxmB,GACFs5G,EAAet5G,KAElBq5E,KAAK,WACFigC,QAGZ,OAAuB,QAAnB56G,OAAOksE,KAAKl1E,GACL,MAEJ,EAAAgoG,EAAAxrG,UACHgN,OAAO,EAAAnK,EAAA7C,SAAG,aACVgiF,QAAS,WACT14D,KAAM,IACN24D,OAAQ,cACR53D,QAAS,WAEDze,EAAK/D,IAAIuC,KAAK,aAAajG,OAAS,EACpCyH,EAAK/D,IAAIuC,KAAK,aAAarC,SAE3Be,EAAE6E,MACEC,IAAQpB,OAAOC,KAAf,YAA+By6G,IAE9B5yF,KAAK,SAAAxmB,GACFy5G,EAAYz5G,KAEfq5E,KAAK,WACF15E,QAAQC,IAAR,yEAC6Ew5G,EAD7E,YAWxBlb,wBAAyB,WACrB,GAAIiT,GAAUrkB,EAAOv6F,UAAU2rG,wBAAwBzrG,KAAK+C,KAC5D,QAAQA,KAAKkB,MAAMpC,IAAI,UACnB,IAAKswF,GAAA1yF,QAAO4/E,OACZ,IAAK8S,GAAA1yF,QAAOogF,aACR,MAAO6+B,EACX,KAAKvsB,GAAA1yF,QAAOsgF,MAGR,MADA2+B,GAAQh+G,QAAQqC,KAAKkkH,oBACdvI,EAAQvqG,QAAQpR,KAAKmkH,qBAAsBnkH,KAAK0jH,yBAC3D,KAAKt0B,GAAA1yF,QAAO8lB,GACZ,IAAK4sE,GAAA1yF,QAAOmgF,gBACR,MAAO8+B,GAAQvqG,QACXpR,KAAKmkH,qBACLnkH,KAAKokH,8BACLpkH,KAAK0jH,0BAGjB,MAAO/H,GAAQvqG,QAAQpR,KAAKmkH,qBAAsBnkH,KAAK0jH,2BAI3DQ,iBAAkB,WACd,GAAI57G,GAAOtI,IACX,QAAO,EAAAkoG,EAAAxrG,UACHgN,OAAO,EAAAnK,EAAA7C,SAAG,6BACVspB,KAAS9c,OAAOC,KAAhB,6BAAiDnJ,KAAKkB,MAAMmE,WAAWnF,GACvEw+E,QAAS,mBACTC,OAAQ,SACR53D,QAAS,SAAShiB,GACVmE,OAAO2xB,SACP91B,EAAG+hB,iBACH5d,OAAO2xB,OAAO3tB,KAAK,kBACfgR,WAAY5V,EAAKpH,MAAMmE,WAAWnF,UAQtDikH,mBAAoB,WAChB,GAAIN,GAAe7jH,KAAKkB,MAAMpC,IAAI,eAClC,IAAIkB,KAAKkB,MAAMpC,IAAI,cACf,OAAO,EAAAopG,EAAAxrG,UACHgN,OAAO,EAAAnK,EAAA7C,SAAG,sBACVspB,KAAMhmB,KAAKkB,MAAMsnG,KAAKzwE,MACtB2mD,QAAS,YACTz/D,OAAQjf,KAAKwzB,WACbmrD,OAAQ,aACR53D,QAAS,SAAShiB,GACVmE,OAAO2xB,SACP91B,EAAG+hB,iBACH5d,OAAO2xB,OAAO3tB,KAAK,KACfuwB,OAAQomF,SAShCO,4BAA6B,WAEzB,GAAIC,GAAiBrkH,KAAKkB,MAAMpC,IAAI,iBACpC,IAAIkB,KAAKkB,MAAM+4F,sBAAwBj6F,KAAKuqG,UAAYvqG,KAAKkB,MAAMooG,WAAa1rG,EAAEirF,QAAQw7B,GACtF,MAAO,KAEX,KAAKzmH,EAAEomG,SAASqgB,EAAe,IAE3B,MADArkH,MAAKokF,KAAK,yCACH,IAGX,IAAIkgC,GAAkB9+G,EAAExF,KAAKy6B,UAAU4pF,eAAeA,EAAgBrkH,MAKtE,OAHAskH,GAAgBx9G,KAAK,0BAA0BZ,KAAK,SAAUlG,KAAKwzB,YAEnExzB,KAAKukH,kBAAkBD,EAAgBx9G,KAAK,uBAAuB09G,QAAQ,wBACpEF,GAIXC,kBAAmB,SAASE,GAExBA,EAAO3kG,MAAM,SAAS/a,GACdmE,OAAOoV,OAASpV,OAAOoV,MAAM46D,SAC7BhwE,OAAOoV,MAAM7U,KACTC,MAAO,gBACPY,IAAK9E,EAAExF,MAAMkG,KAAK,UAEtBnB,EAAG+hB,iBACH/hB,EAAGsc,sBAOfgnE,YAAa,SAASud,GAClB,GAAK5lG,KAAKuqG,QAAV,CAGA,GAAIlsG,GAAO2B,IACXA,MAAK0kH,WAAa,GAAI7B,GAAAnmH,QAAK4qF,YACvBpmF,MAAOlB,KAAKkB,MACZ6c,GAAI6nF,EAAO9+F,KAAK,iBAChB7B,gBAAiB,WACbjF,KAAKgc,UAGT9W,OAAQ,WACJ7G,EAAK6kH,iBAAkB,GAE3B/9G,OAAQ,WACJ9G,EAAK6kH,iBAAkB,GAE3B9+G,YAAY,EAAA8jG,EAAAxrG,UACRgN,OAAO,EAAAnK,EAAA7C,SAAG,qBACVgiF,QAAS,UACTC,OAAQ,YACTtiE,SAASupF,EAAO9+F,KAAK,sBAExB9G,KAAKkjH,iBACLljH,KAAK0kH,WAAWjgH,QAAO,KAK/B++G,kBAAmB,SAAS5d,GACxB,GAAK5lG,KAAKuqG,QAAV,CAGA,GAAIlsG,GAAO2B,IACXA,MAAK2kH,iBAAmB,GAAI5B,GAAArmH,QAAYkoH,kBACpC1jH,MAAOlB,KAAKkB,MACZ6c,GAAI6nF,EAAO9+F,KAAK,uBAChB7B,gBAAiB,WACbjF,KAAKgc,UAGT9W,OAAQ,WACJ7G,EAAK8kH,uBAAwB,GAEjCh+G,OAAQ,WACJ9G,EAAK8kH,uBAAwB,GAEjC/+G,YAAY,EAAA8jG,EAAAxrG,UACRgN,OAAO,EAAAnK,EAAA7C,SAAG,2BACVgiF,QAAS,eACTC,OAAQ,eACTtiE,SAASupF,EAAO9+F,KAAK,sBAExB9G,KAAKmjH,uBACLnjH,KAAK2kH,iBAAiBlgH,QAAO,KAKrCg/G,mBAAoB,SAASje,GAEzB,GAAyC,MAArCxlG,KAAKkB,MAAMpC,IAAI,oBAA8BkB,KAAKkB,MAAM+4F,oBAAqB,CAC7E,GAAI4qB,GAAgBr/G,EAAE,0BACjBU,KAAK,OAAQlG,KAAKkB,MAAMsnG,KAAKoD,MAC7B1lG,KAAK,SAAU,OACpBs/F,GAAS1+F,KAAK,iBAAiBgkB,YAAY+5F,KAMnDhmG,OAAQjhB,EAAEiC,OAAOjC,EAAEy6F,MAAMf,EAAOv6F,UAAU8hB,SACtCimG,uBAAwB,qBACxBC,oBAAqB,kBAErBC,kBAAmB,SAASjgH,GACxB/E,KAAKmB,QAAQ,OAAQnB,KAAM+E,IAE/BkgH,oBAAqB,SAASlgH,GAC1B/E,KAAKmB,QAAQ,SAAUnB,KAAM+E,IAEjCmgH,mBAAoB,SAASngH,GACzB/E,KAAKmB,QAAQ,QAASnB,KAAM+E,IAEhCogH,wBAAyB,SAASpgH,GAC9B/E,KAAKmB,QAAQ,aAAcnB,KAAM+E,IAErCqgH,2BAA4B,SAASrgH,GACjC/E,KAAKmB,QAAQ,YAAanB,KAAM+E,IAEpCsgH,iBAAkB,SAAStgH,GACvB/E,KAAKmB,QAAQ,OAAQnB,KAAM+E,MAKnCugH,mBAAoB,SAASvgH,GAEzB,MADA/E,MAAKkB,MAAMq5F,YACJ,GAIXgrB,gBAAiB,SAASxgH,GAItB,MAHI8hB,UAAQ,EAAAtnB,EAAA7C,SAAG,0EACXsD,KAAKkB,MAAMm9F,SAER,GAKX77F,SAAU,WAEN,sBADkBxC,KAAKkB,MAAL,GAAgBlB,KAAKkB,MAAU,cACjD,MAOZ8hH,GAAoBjmH,UAAU09B,UAAa,WACvC,GAAIisE,GAAW9oG,EAAEiC,UAAWy3F,EAAOv6F,UAAU09B,UAAUisE,UACnDoD,gBAAiB52B,EAAAx2E,QAASqB,cAGlB,mDACA,6DACA,EAAAwB,EAAA7C,SAAG,2DACH,2DACA,EAAA6C,EAAA7C,SAAG,2CACH,OACA,SACA,WAEJ,WAGJ61F,QAASrf,EAAAx2E,QAASqB,cAGV,kDAEA,iDACA,EAAAwB,EAAA7C,SAAG,iCACH,8DACA,EAAA6C,EAAA7C,SAAG,eACH,OACA,iCACA,2DACA,EAAA6C,EAAA7C,SAAG,mCACH,OACA,UACA,SACA,WAEJ,aAIJ8oH,EAAyBtyC,EAAAx2E,QAASqB,cAE9B,2CACA,8EACA,qDACA,EAAAwB,EAAA7C,SAAG,gBACH,mCACA,0CACA,OAEA,iBACA,0DACA,qCACA,EAAA6C,EAAA7C,SAAG,aACH,KACA,0CACA,OACA,yCACA,2DACA,qEACA,yCACA,4BACA,YACA,YACA,QACA,SACA,WAEJ,iBAGJ,OAAOkB,GAAEiC,UAAWy3F,EAAOv6F,UAAU09B,WACjCisE,SAAUA,EACV2d,eAAgBmB,O3Esw6BxBppH,EAAQM,S2Ehw6BJsmH,oBAAqBA,K3Emw6BI/lH,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,GAgB/C,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAdvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G4Epv7BX,IAAAi0E,GAAA52E,EAAA,G5Eyv7BI62E,EAAY32E,EAAuB02E,G4Exv7BvC3zE,EAAAjD,EAAA,G5E4v7BIkD,EAAiBhD,EAAuB+C,E4E3v7B5CjD,GAAA,GAIA,IAAIuoH,GAAmBzlH,EAASqK,KAAK3J,OAAOqzE,EAAAx2E,QAAQ8C,eAC/CK,OAAOqzE,EAAAx2E,QAAQwH,+BACfrE,QACGqrB,QAAS,MACTtK,UAAW,qBAGX9gB,WAAY,SAASpB,GACjBA,EAAUA,MACVsB,KAAKy+E,cAAgB//E,EAAQ+/E,gBACzB7zD,UAAW,UAIf5qB,KAAK6rB,SAAS7rB,KAAKkB,MAAO,oBAAqB,WAC3ClB,KAAKgc,WAEThc,KAAKmE,qBAAqBzF,EAAQ0F,WAAY1F,IAIlDsd,OAAQ,WACJ,GAAI3d,GAAO2B,IAaX,OAZAA,MAAKuE,IAAI6a,KAAKpf,KAAKo0B,aAGnBp0B,KAAKylH,cAAcz9E,oBACfE,cAAc,EACdgX,UAAW,SAASwmE,GAChBrnH,EAAKonH,cAAc3oG,KAAK4oG,GACxBrnH,EAAK6C,MAAMT,MAAO0lC,WAAYu/E,IAAmBllH,QAAQ,IAAQqjF,KAAK,WAClExlF,EAAKonH,cAAc3oG,KAAKze,EAAK6C,MAAM+qG,SAAS,oBAIjDjsG,MAIXo0B,UAAW,WACP,GAAI+R,GAAanmC,KAAKkB,MAAMpC,IAAI,aAChC,QAEI,0BACA,EAAAS,EAAA7C,SAAG,cACH,WAEA,2BACAkB,EAAEumC,OAAOgC,GACT,UACFhoC,KAAK,KAIXsnH,YAAa,WACT,MAAOzlH,MAAKuE,IAAIuC,KAAK,gBAIzBue,OAAQ,WACJrlB,KAAKylH,YAAY5lG,MACjB7f,KAAKkpF,cAAclpF,KAAKkB,OACxB/B,EAASqK,KAAKzM,UAAUsoB,OAAOpoB,KAAK+C,OAIxCwC,SAAU,WACN,OAAQ,oBAAD,GAAyBxC,KAAKkB,MAAS,KAAK/C,KAAK,M5E6v7BpE/B,GAAQM,S4Exv7BJkoH,iBAAkBA,K5E2v7BO3nH,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAG9E,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CACA,CAEH,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAASuB,GA8FrC,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,G6E9g8BvF,GAAA8hF,GAAAjiF,EAAA,G7Eo77BIkiF,EAAWhiF,EAAuB+hF,G6El77BtCqnC,EAAAtpH,EAAA,I7Es77BIupH,EAAWrpH,EAAuBopH,G6Er77BtCE,EAAAxpH,EAAA,I7Ey77BIypH,EAAWvpH,EAAuBspH,G6Ex77BtCE,EAAA1pH,EAAA,K7E477BI2pH,EAAczpH,EAAuBwpH,G6E377BzCE,EAAA5pH,EAAA,K7E+77BI6pH,EAAiB3pH,EAAuB0pH,G6E977B5CE,EAAA9pH,EAAA,I7Ek87BI+pH,EAAS7pH,EAAuB4pH,G6Ej87BpCzwF,EAAAr5B,EAAA,I7Eq87BIgqH,EAAa9pH,EAAuBm5B,G6Ep87BxC4wF,EAAAjqH,EAAA,I7Ew87BIkqH,EAAgBhqH,EAAuB+pH,G6Ev87B3CE,EAAAnqH,EAAA,K7E287BIoqH,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EI,UAEF,iCACA,sBACA,6CACA,EAAAuB,EAAA7C,SAAG,0BACH,IACA,8DACA,WACA,6CACA,EAAA6C,EAAA7C,SAAG,0CACH,IACA,iEACA,WACA,SACA,sBACA,0DACA,iBACA,EAAA6C,EAAA7C,SAAG,kCACH,OACA,mDACA,EAAA6C,EAAA7C,SAAG,QACH,UACA,SACA,SAEA,gDACA,wCACA,oDACA,EAAA6C,EAAA7C,SAAG,UACH,YACA,8CACA,2EACA,EAAA6C,EAAA7C,SAAG,yCACH,+BACA,YACA,yCACA,oBACA,EAAA6C,EAAA7C,SAAG,+BACH,YACA,oBACA,EAAA6C,EAAA7C,SAAG,6CACH,YACA,QACA,SACA,SAEA,wCACA,sDACA,EAAA6C,EAAA7C,SAAG,eACH,YACA,SACA,UACFyB,KAAK,KAIXi1F,YAAax1F,EAAEI,UAEP,OACA,EAAAuB,EAAA7C,UAEQ,wGACA,2GACA,yGACA,sCACFyB,KAAK,KAEX,OACA,OACA,EAAAoB,EAAA7C,UAEQ,8FACA,yDACA,wFACA,iCACA,8BACA,sEACA,yDACA,4CACA,sEACA,yDACA,QACA,6DACA,qEACA,uDACA,4CACA,QACA,6DACA,4DACA,QACA,SACFyB,KAAK,KAEX,OACA,OACA,EAAAoB,EAAA7C,UAEQ,gEACA,oDACA,yEACA,sEACA,QACA,8DACA,mEACA,QACA,iEACA,8FACA,uEACA,6CACA,QACA,4CACA,iEACA,QACA,SACFyB,KAAK,KAEX,OACA,OACA,EAAAoB,EAAA7C,UAEQ,iDACA,2FACA,0FACFyB,KAAK,KAEX,OACA,OACA,EAAAoB,EAAA7C,UAEQ,sGACA,qGACFyB,KAAK,KAEX,OACA,OACA,EAAAoB,EAAA7C,UAEQ,4FACA,gEACA,oEACFyB,KAAK,KAEX,QACFA,KAAK,SAOnBsnI,EAA+B,SAAuCO,EAAUtnI,GAChF,GACI2yF,GADAh/E,EAAW/V,EAAOgS,UAetB,IAZA5P,EAAUd,EAAEC,SAASa,OACjBsnI,SAAUA,EACVh1C,SAAU,WACN9nF,OAAOU,MAAMtC,OACb+K,EAASgsB,OAAO,cAEpB0yD,SAAU,SAASM,EAASziF,GACxB1F,OAAOU,MAAMtC,OACb+K,EAASvD,QAAQF,OAIpBjO,OAAOuI,SAAWA,OAAOU,MAC1B,KAAM,IAAIzJ,OAAM,mCAepB,OAZAkxF,GAAU,GAAI00C,GAAwBrnI,GACtCwK,OAAOU,MAAMvC,MACTqC,MAAO,yCACPG,KAAMwnF,EAAQ9sF,IACdmH,MAAO,MACP+P,OAAQ,QACR3R,gBAAgB,IAEpBunF,EAAQr1E,SACRrb,OAAO0wF,QAAUA,EAGVh/E,EpG47mCXjW,GAAQM,SoG76mCJqpI,wBAAyBA,EACzBN,6BAA8BA,EAC9B9G,4BAA6BA,KpGg7mCJ1hI,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIjI,SAAUF,EAAQC,EAASC,GAEjC,YqG7sqCA,SAAS8zI,GAAoBvxI,EAAGC,GAC5B,GAAiB,IAAbD,EAAEiC,OACF,MAAOhC,GAAEgC,MAEb,IAAiB,IAAbhC,EAAEgC,OACF,MAAOjC,GAAEiC,MAGb,IAGI6O,GAHA0gI,IAIJ,KAAK1gI,EAAI,EAAGA,GAAK7Q,EAAEgC,OAAQ6O,IACvB0gI,EAAO1gI,IAAMA,EAIjB,IAAI6M,EACJ,KAAKA,EAAI,EAAGA,GAAK3d,EAAEiC,OAAQ0b,IACvB6zH,EAAO,GAAG7zH,GAAKA,CAInB,KAAK7M,EAAI,EAAGA,GAAK7Q,EAAEgC,OAAQ6O,IACvB,IAAK6M,EAAI,EAAGA,GAAK3d,EAAEiC,OAAQ0b,IACnB1d,EAAEi5E,OAAOpoE,EAAI,KAAO9Q,EAAEk5E,OAAOv7D,EAAI,GACjC6zH,EAAO1gI,GAAG6M,GAAK6zH,EAAO1gI,EAAI,GAAG6M,EAAI,GAEjC6zH,EAAO1gI,GAAG6M,GAAKvD,KAAKU,IAChB02H,EAAO1gI,EAAI,GAAG6M,EAAI,GAAK,EACvBvD,KAAKU,IACD02H,EAAO1gI,GAAG6M,EAAI,GAAK,EACnB6zH,EAAO1gI,EAAI,GAAG6M,GAAK,GAQvC,OAAO6zH,GAAOvxI,EAAEgC,QAAQjC,EAAEiC,QrGwqqC9B/D,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,IA8DX5C,EAAQM,QqGnuqCOyzI,GrGuuqCT,SAAUh0I,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAkBlD,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GsG5yqCX,IAAA6rG,GAAAxuG,EAAA,IACA+L,GtGgzqCiB7L,EAAuBsuG,GsGhzqCxCxuG,EAAA,ItGozqCIsgC,EAAWpgC,EAAuB6L,GsGnzqCtCu9B,EAAAtpC,EAAA,ItGuzqCIupC,EAAuBrpC,EAAuBopC,GsGrzqC9C/lC,EAAQT,EAASS,MAAMC,QACvBC,WAAY,SAASpB,GACjBA,EAAUA,MACVA,EAAQorH,QAAUprH,EAAQorH,SAAW5gH,OAAOksE,KAAKl1E,GACjDF,KAAK4B,KACDkoH,QAASprH,EAAQorH,QACjBumB,aACI3mI,MAAO,qBACPotB,YAAa,4EACbxsB,iBAAkB5L,EAAQorH,QAA1B,sBACA99F,KAAM,UACNgS,SAAU,QAEdw0C,UACI9oE,MAAO,kBACPotB,YAAa,+CACb9K,KAAM,gBACN1hB,iBAAkB5L,EAAQorH,QAA1B,mBACA9e,aAAc,gBACdhtE,SAAU,QAEdsyG,eACI5mI,MAAO,gCACPotB,YAAa,wEACbxsB,iBAAkB5L,EAAQorH,QAA1B,wBACA99F,KAAM,gBACNgS,SAAU,QAEduyG,aACI7mI,MAAO,4CACPotB,YACI,sJACJxsB,iBAAkB5L,EAAQorH,QAA1B,sBACA99F,KAAM,WACNg/E,aAAc,mBACdhtE,SAAU,QAEdwyG,SACI9mI,MAAO,iBACPotB,YAAa,mDACbxsB,iBAAkB5L,EAAQorH,QAA1B,kBACA99F,KAAM,SACNg/E,aAAc,mBACdC,YAAa,YAEjBwlC,iBACI/mI,MAAO,yBACPotB,YAAa,kEACbxsB,iBAAkB5L,EAAQorH,QAA1B,0BACA99F,KAAM,YACNg/E,aAAc,eACdhtE,SAAU,QAEd0yG,SACIhnI,MAAO,iBACPotB,YAAa,uCACb9K,KAAM,YACNjF,QAAS,WACLpmB,OAAOqoB,SAAShD,KAAU9c,OAAOC,KAAjC,qDAGRwnI,eACIjnI,MAAO,uBACPotB,YAAa,sDACb9K,KAAM,WACNjF,QAAS,WACLpmB,OAAOqoB,SAAShD,KAAU9c,OAAOC,KAAjC,kBAGRynI,QACIlnI,MAAO,WACPotB,YAAa,0CACb9K,KAAM,cACNjF,QAAS,WACL7d,OAAOU,MAAMvC,MACTqC,MAAO,WACPG,KAAM,+DACNE,SACIC,OAAQ,WACJd,OAAOU,MAAMtC,QAEjBupI,WAAY,WACRlwI,OAAOqoB,SAAShD,KAAU9c,OAAOC,KAAjC,kCACID,OAAO2tE,8BAYvCrtE,EAAOrK,EAASqK,KAAK3J,QACrB6J,MAAO,mBACP5J,WAAY,WACRE,KAAKkB,MAAQ,GAAItB,GACjBI,KAAK4e,WAAW,UAChB5e,KAAKgc,UAGTA,OAAQ,WACJ,GAAI1T,GAAOtI,KACPsrB,EAASpiB,OAAOoiB,MACpB9lB,GAAE0J,QAAWhG,OAAOC,KAApB,aAAqCD,OAAOksE,KAAKl1E,GAAM,SAAAsK,GACnDlC,EAAKwoI,aAAetrI,EAAE,UACjBwX,SAAS,YACTrT,OAAOnE,EAAE,SAASmE,OAAO,qBACzBA,OAAOnE,EAAE,QAAQmE,OAAV,gCAAiD/L,EAAEumC,OAAO35B,EAAK4oE,OAA/D,eACPzpE,OAAQrB,EAAKshF,OAASpkF,EAAE,YAAYwX,SAAS,kBAClD,IAAI1L,GAAUs0B,EAAAlpC,QAAmBoC,IAAI,WACjC++B,EAAS+H,EAAAlpC,QAAmBoC,IAAI,SAChCwS,IAAWusB,GACXv1B,EAAKwoI,aAAa7yG,QAAQ,GAAItB,GAAAjgC,QAAGwhC,SAAU5sB,QAASA,EAASusB,OAAQA,IAAUt5B,KAE9E+mB,EAAOylH,kBACRzoI,EAAK0oI,SAAS,eACd1oI,EAAK0oI,SAAS,aAEd1lH,EAAO2lH,6BACP3oI,EAAK0oI,SAAS,iBAElB1oI,EAAK0oI,SAAS,iBACd1oI,EAAK0oI,SAAS,eACd1oI,EAAK0oI,SAAS,WACV1lH,EAAO4lH,uBACP5oI,EAAK0oI,SAAS,mBAEd1lH,EAAO6lH,gBAAkB7lH,EAAOylH,iBAChCzoI,EAAK0oI,SAAS,WAEd9nI,OAAO2tE,oBACPvuE,EAAK0oI,SAAS,UAElB1oI,EAAKwoI,aAAannI,OAAOrB,EAAK8oI,gBAAgB5mI,IAC9ClC,EAAK/D,IAAIyjB,QAAQre,OAAOrB,EAAKwoI,iBAIrCE,SAAU,SAAS94G,GACf,GAAIx5B,GAAUsB,KAAKkB,MAAMpC,IAAIo5B,GACzBm5G,EAAO7rI,EAAExF,KAAKsxI,cAAc5yI,IAC5B6yI,EAAKF,EAAKvqI,KAAK,IACfpI,GAAQqoB,QACRwqH,EAAG7wI,GAAG,QAAS,WACXhC,EAAQqoB,YAGZwqH,EAAGrrI,KAAK,OAAWgD,OAAOC,KAA1B,QAAsC+uB,GAE1Cl4B,KAAK4pF,OAAOjgF,OAAO0nI,IAGvBC,cAAe,SAAS5yI,GACpB,8CACIA,EAAQstB,KADZ,mEAGIttB,EAAQgL,MAHZ,iCAIiChL,EAAQo4B,YAJzC,oBAOJs6G,gBAAiB,SAAS1yI,GACtB,0DACIA,EAAQ40E,sBADZ,qDAGIpqE,OAAOoiB,OAAOkmH,cAAd,+BAA6D9yI,EAAQ+yI,MAArE,cAA0F,IAH9F,0MtGozqCRr1I,GAAQM,SsG3yqCJ8M,KAAMA,EACN5J,MAAOA,KtG8yqCkB3C,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,GAsB/C,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GuG1+qCX,IAAAyjB,GAAApmB,EAAA,GACA+L,GvG8+qCc7L,EAAuBkmB,GuG9+qCrCpmB,EAAA,IvGk/qCIsgC,EAAWpgC,EAAuB6L,GuGj/qCtCyiG,EAAAxuG,EAAA,IvGq/qCIyuG,EAAavuG,EAAuBsuG,GuGp/qCxC6mC,EAAAr1I,EAAA,IvGw/qCIs1I,EAAYp1I,EAAuBm1I,GuGv/qCnCv8H,EAAahW,EAASgW,WAAWtV,QACjC84G,WAAY,SAAS/5G,EAAGC,GAGpB,MAFAD,GAAIA,EAAEE,IAAI,QACVD,EAAIA,EAAEC,IAAI,QACHF,EAAIC,EAAI,EAAID,EAAIC,GAAK,EAAI,KAIpC2K,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,KACP05E,EAAaxwE,OAAOkb,kBAAoBlb,OAAOkb,iBAAiBljB,MAAMhB,EAC1EF,MAAKkB,MAAQ,GAAI/B,GAASS,MAC1BI,KAAKkB,MAAMoJ,IAASpB,OAAOC,KAA3B,iBAAgDuwE,EAAhD,0BACA15E,KAAK8gB,WAAa,GAAI3L,GACtBnV,KAAK8gB,WAAWxW,IAASpB,OAAOC,KAAhC,aAAiDD,OAAOksE,KAAKl1E,GAA7D,iBACAF,KAAKsR,QAAU,GAAIqrB,GAAAjgC,QAAGwhC,YACtBl+B,KAAK4xI,iBAAmB,GAAIj1G,GAAAjgC,QAAGm1I,OAAOroI,MAClCq3B,UAAU,EACV1M,SAAU,WACN7rB,EAAKspI,iBAAiB5yI,MAAM,OAEhC8yI,WAAY,4BACZC,WAAY,0CAEhB/xI,KAAKmqE,MAAQ,GAAIwnE,GAAAj1I,QAAM8M,MAAOs1B,IAAK,OAAQp4B,YAAY,IACvD1G,KAAKmqE,MAAM6nE,UAAU,QACrBhyI,KAAKmqE,MAAM6nE,UAAU,OACrBhyI,KAAKmqE,MAAM6nE,UAAU,4BACrBhyI,KAAKmqE,MAAM6nE,UAAU,IACrBhyI,KAAKmqE,MAAM8nE,eACXjyI,KAAK4e,WACDpZ,EAAE,UACGmE,OAAOnE,EAAE,SAASsX,KAAK,0BACvBnT,OAAO3J,KAAKmqE,MAAM5lE,KAClBoF,OACI3J,KAAKkyI,WAAa1sI,EAAE,UAChBmE,OACGnE,EAAE,SACGsX,KAAK,2BACLE,SAAS,kBAEjBrT,OAAO3J,KAAK4xI,iBAAiBrtI,MAErCoF,OACGnE,EAAE,SACGsX,KAAK,sBACLE,SAAS,kBAEjBrT,OACGnE,EAAE,WACGwX,SAAS,aACTrT,OACGnE,EAAE,UACGwX,SAAS,kBACTrT,OAAO3J,KAAKsR,QAAQ/M,KACpBoF,OAAQ3J,KAAKmyI,MAAQ3sI,EAAE,UAAUwX,SAAS,mBAElDrT,OAAQ3J,KAAKuqF,MAAQ/kF,EAAE,UAAUwX,SAAS,sBAG3Dhd,KAAK6rB,SAAS7rB,KAAK8gB,WAAY,mBAAoB,WAC/CxY,EAAKwiF,iBAET9qF,KAAK6rB,SAAS7rB,KAAKkB,MAAO,SAAU,WAChCoH,EAAK8pI,gBAETpyI,KAAK8gB,WAAWmJ,QAChBjqB,KAAKkB,MAAM+oB,SAGfjO,OAAQ,WACJhc,KAAK8qF,eACL9qF,KAAKoyI,eAGTtnD,aAAc,WACV,GAAIxiF,GAAOtI,IACXA,MAAKmqE,MAAMx1C,SACX30B,KAAK8gB,WAAWyQ,OAChBvxB,KAAK8gB,WAAWvY,KAAK,SAAArH,GACjBoH,EAAK6hE,MAAM1gE,IAAIvI,EAAMpC,IAAI,SACzBwJ,EAAK6hE,MAAM1gE,IAAIvI,EAAMhB,IACrBoI,EAAK6hE,MAAM1gE,QAA2BjI,KAAvBN,EAAMpC,IAAI,SAAyBoC,EAAMpC,IAAI,SAAW,iBACvEwJ,EAAK6hE,MAAM1gE,IACP,GAAIkzB,GAAAjgC,QAAG21I,YACHrmH,KAAM,aACN8S,IAAK,uBACLrd,QAAS,uBACTsF,QAAS,WACL7lB,EAAM4uF,aAEXvrF,KAEP+D,EAAK6hE,MAAMxgE,OAAOzI,EAAMhB,OAIhCkyI,YAAa,WACT,GAAI9pI,GAAOtI,KAEPi9B,EAAO,GAAA6tE,GAAApuG,SACPq6B,SAEQnhB,KAAM,OACNjG,KAAM,OACNgG,MAAO,OACPqM,KAAM,uCAGNpM,KAAM,OACNjG,KAAM,KACNgG,MAAO,MACPqM,KAAM,yCAGNrS,KAAM,MACNiG,KAAM,cACNs+F,YACIvkG,KAAM,OACNgG,MAAO,aACPqM,KAAM,2BACNpM,KAAM,SACN5W,MAvBG,QAwBHwL,OAEQxL,MAAO,QACP2W,MAAO,4BAGP3W,MAAO,OACP2W,MAAO,uBAGP3W,MAAO,OACP2W,MAAO,4BAInBw+F,QAEQn1G,MAAO,QACP+3B,SAEQnhB,KAAM,SACNjG,KAAM,QACNgG,MAAO,aACPnL,KAAMxK,KAAKkB,MAAMpC,IAAI,kBAK7BE,MAAO,OACP+3B,SAEQnhB,KAAM,SACNjG,KAAM,QACNgG,MAAO,WACPnL,KAAMxK,KAAKkB,MAAMpC,IAAI,gBAK7BE,MAAO,OACP+3B,SAEQnhB,KAAM,OACN08H,MAAM,EACN3iI,KAAM,QACNgG,MAAO,mBAO/B5L,SACItJ,KAAM,GAAIk8B,GAAAjgC,QAAGmiC,QACT7S,KAAM,UACNvK,QAAS,mBACT/X,MAAO,OACPo1B,IAAK,iCACL/X,QAAS,WACL,GAAIvc,GAAOyyB,EAAKzyB,KAAKooB,QAChBpoB,GAAKtK,IAAOsK,EAAKmF,KAMlBrH,EAAKwY,WAAW8R,OAAOpoB,GACnBi0B,MAAM,EACNh9B,QAAS,SAASmN,GACVA,EAAS9P,IAAI,WACbwJ,EAAKgJ,QAAQqtB,QACTrtB,QAAS1C,EAAS9P,IAAI,WACtB++B,OAAQ,YAGZv1B,EAAKgJ,QAAQqtB,QACTrtB,QAAS,yCACTusB,OAAQ,aAIpBn8B,MAAO,SAASkN,EAAU9N,GACtB,GAAIwQ,GAAUxQ,GAAOA,EAAIijF,cAAgBjjF,EAAIijF,aAAahmD,OAC1Dz1B,GAAKgJ,QAAQqtB,QACTrtB,QAASA,GAAW,iCACpBusB,OAAQ,cAxBpBv1B,EAAKgJ,QAAQqtB,QACTrtB,QAAS,2BACTusB,OAAQ,eA8B5B1J,SAAU,WACN,GAAI8L,GAAWhD,EAAKzyB,KAAK1G,MAAM,WAC/B,IAAIm8B,EAAU,CACV,GAAIQ,GAAcxD,EAAKyD,WAAWT,EAClC33B,GAAKiqI,YAAY9xG,EAAYzhC,YAIzCgB,MAAKmyI,MAAMnqH,QAAQre,OAAOszB,EAAK14B,IAC/B,IAAIqtI,GAAmB5xI,KAAKkB,MAAMpC,IAAI,mBAClC8yI,IAAoBA,EAAiB/wI,QACrCb,KAAKkyI,WAAW7qI,OAChBrH,KAAK4xI,iBAAiBjzG,OAAO3+B,KAAKkB,MAAMpC,IAAI,sBAE5CkB,KAAKkyI,WAAW5qI,OAEpBtH,KAAKuyI,YArIc,UAwIvBA,YAAa,SAASC,GAClBxyI,KAAKuqF,MACAviE,QACAhL,SAAS,oBACToC,KAAiB,SAAZozH,EAAsBxyI,KAAKyyI,iBAAmBzyI,KAAK0yI,iBAGjEA,aAAc,WACV,MACI,0lBAsBRD,eAAgB,WACZ,MACI,+UvGu7qCZr2I,GAAQM,SuGn6qCJ8M,KAAMA,KvGs6qCmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAElDd,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GwGrtrCX,IAAAgJ,GAAA3L,EAAA,IxG0trCI4L,EAEJ,SAAgCzL,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAF/CwL,GwGztrCpCwB,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXA,MAAK4e,WAAWpZ,EAAE,WAClBxF,KAAKkB,MAAQ,GAAI/B,GAASS,MAAMlB,GAChCsB,KAAKimB,KAAOjmB,KAAKkB,MAAMpC,IAAI,QAC3BkB,KAAK0J,MAAQ1J,KAAKkB,MAAMpC,IAAI,UAC5B0G,EAAE6E,MACEC,IAAQpB,OAAOC,KAAOnJ,KAAKimB,KAA3B,IAAmCjmB,KAAKkB,MAAMpC,IAAI,aAAlD,IAAkE0G,EAAEua,MAAM7W,OAAO+F,QACjFxN,QAAS,SAASmN,GACdA,EAAA,aAA0B,EAC1BtG,EAAKpH,MAAMU,IAAIgN,GACftG,EAAK0T,aAKjBA,OAAQ,WACJ,GAAImH,GAAO,GAAAlb,GAAAvL,QAAasD,KAAKkB,MAAMmE,WACnCrF,MAAKuE,IAAIyjB,QAAQre,OAAOwZ,EAAK5e,KAC7BvE,KAAKuE,IAAIoF,OAAO3J,KAAK2yI,oBAGzBA,gBAAiB,WACb,GAAIrqI,GAAOtI,KACPi1B,EAAQzvB,cAAcxF,KAAKkB,MAAMpC,IAAI,UAA7B,yCACRJ,EAAUsB,KAAKkB,MAAMmE,UACzB,IAAI3G,EAAQk0I,kBAAoBl0I,EAAQk0I,iBAAiB/xI,OAAS,EAAG,CACjE,GAAI+oF,GAASpkF,EACT,8IAOJ5H,GAAE2K,KAAK7J,EAAQk0I,iBAAkB,SAAC5jB,EAAIpiH,GAClC,GAAIimI,GAAiB3pI,OAAOC,KAAOb,EAAK2d,KAApC,0CACA+oG,EAAGz8C,SADH,SAEKy8C,EAAG8jB,IACZlpD,GAAOjgF,OAAP,oBACwBkpI,EADxB,KACwCj1I,EAAEumC,OAAO6qF,EAAGtlH,OADpD,gBAC0E9L,EAAEumC,OACpE6qF,EAAGz8C,UAFX,gBAMJt9C,EAAMtrB,OAAOigF,OAEb30D,GAAMtrB,OAAN,MAAmB3J,KAAKkB,MAAMpC,IAAI,UAAUqE,cAA5C,8BAEJ,OAAO8xB,KxGmtrCf74B,GAAQM,SwG9srCJ8M,KAAMA,KxGitrCmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUvB,EAAG4H,GAsBlD,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,GyGnxrCX,IAAA+zI,GAAA12I,EAAA,IAAY22I,EzGwyrCZ,SAAiCx2I,GAAO,GAAIA,GAAOA,EAAIC,WAAc,MAAOD,EAAc,IAAII,KAAa,IAAW,MAAPJ,EAAe,IAAK,GAAIK,KAAOL,GAAWM,OAAOC,UAAUC,eAAeC,KAAKT,EAAKK,KAAMD,EAAOC,GAAOL,EAAIK,GAAgC,OAAtBD,GAAOF,QAAUF,EAAYI,GAhBzNm2I,GyGvxrCzCnwB,EAAAvmH,EAAA,IzG2xrCIwmH,EAAQtmH,EAAuBqmH,GyG1xrCnCqwB,EAAA52I,EAAA,KzG8xrCI62I,EAAkB32I,EAAuB02I,GyG7xrC7CttG,EAAAtpC,EAAA,IzGiyrCIupC,EAAuBrpC,EAAuBopC,GyG/xrC9CwtG,EAAmBh0I,EAASqK,KAAK3J,QACjCqrB,QAAS,KACTprB,WAAY,WACRlC,EAAEw1I,QACEpzI,KACA,SACA,eACA,kBACA,mBACA,iBACA,gBAEJgzI,EAAWt0I,QAAQ20I,QAAU,MAGjCx0H,QACIy0H,4BAA6B,kBAC7BC,yBAA0B,iBAC1BC,yBAA0B,iBAC1BC,uBAAwB,gBAG5Bz3H,OAAQ,WAEJ,MADAxW,GAAExF,KAAK+d,IAAIqB,KAAKpf,KAAK0zI,gBACd1zI,MAGX2zI,gBAAiB,WACb3zI,KAAKkB,MAAMU,IAAI,sBAAuB5B,KAAKkB,MAAMpC,IAAI,uBACrDkB,KAAKkB,MAAMT,OAGXE,OAAOqoB,SAAc9f,OAAOC,KAA5B,YAGJyqI,eAAgB,WACZ,GAAIC,GAAS7zI,KAAKkB,MAAMpC,IAAI,OACxB6B,QAAOkmB,QAAP,6CAA4DgtH,EAA5D,QACA7zI,KAAKkB,MAAM4uF,SACPruF,QAAS,WACLuxI,EAAWvxI,QAAX,kCAAqDoyI,EAArD,QAGR7zI,KAAKqlB,WAIbyuH,eAAgB,WACZ,GAAIC,GAAU/zI,KAAKkB,MAAMpC,IAAI,QACzBw/H,EAAU39H,OAAOyvF,OAAP,kCAAgD2jD,EAAhD,IAA4DA,EACtEzV,KACAt+H,KAAKkB,MAAMT,MACLkP,KAAM2uH,IAEJ78H,QAAS,WACLuxI,EAAWvxI,QAAX,kCAAqDsyI,EAArD,SAAqEzV,EAArE,QAIZt+H,KAAKgc,WAIbg4H,aAAc,WACV,GAAI1rI,GAAOtI,KACP+zI,EAAU/zI,KAAKkB,MAAMpC,IAAI,OAC7B0G,GAAE0J,QAAWlP,KAAKkB,MAAM+R,QAAxB,IAAmCjT,KAAKkB,MAAMhB,GAA9C,YAA6D,SAAA+zI,GACzD,GAAI3V,cAAqByV,EACrBG,EAAe5rI,EAAKpH,MAAMpC,IAAI,QAC9Bo1I,IAAgBhrI,OAAOksE,KAAK/vE,WAAWktE,WACvC+rD,sBAA8B4V,GAElCD,EAAOtkI,KAAO2uH,EACdh2H,EAAKwY,WAAW8R,OAAOqhH,GACnBE,GAAI,EACJ11G,MAAM,EACNh9B,QAAS,WACLuxI,EAAWvxI,QAAX,iCAAoDsyI,EAApD,SAAoEzV,EAApE,MAEJ58H,MAAO,SAASR,EAAOuyE,EAAM/0E,GAGzBs0I,EAAWtxI,MAAMhD,EAAQ01I,kBAGlC1yI,MAAM,SAAC2yI,EAAOC,EAAYF,GACzBpB,EAAWtxI,MAAM2yI,EAAMtwD,aAAahmD,YAI5C21G,aAAc,WACV,GAAIrsI,GAAOrH,KAAKkB,MAAMpC,IAAI,sBACtBy1I,EAAOv0I,KAAKkB,MAAMhB,GAClBs0I,gFACAntI,cAAmBA,EAAnB,IAA6B,IAD7B,WAEOktI,EAFP,IAYJ,OATIE,6FAAsG72I,EAAEumC,OACxGnkC,KAAKkB,MAAMpC,IAAI,SADf,uCAEoCkB,KAAK00I,mBAFzC,oCAGAH,EAHA,kCAKAv0I,KAAKkB,MAAMpC,IAAI,WAAaoK,OAAOksE,KAAK/vE,WAAWktE,SAAW,MAAQvyE,KAAKkB,MAAMpC,IAAI,UALrF,mBAMekB,KAAKkB,MAAMpC,IAAI,mBAN9B,aAOAkB,KAAKkB,MAAMpC,IAAI,aAAe,MAAQ,MAPtC,YAQQ01I,EARR,SAYRG,gBAAiB,WACb,GAAIC,GAAY,GAAI/xB,GAAAnmH,QAAK4qF,YACrBpmF,MAAOlB,KAAKkB,MACZ6c,GAAIvY,EAAEsB,KAAF,IAAW9G,KAAKkB,MAAMhB,GAAtB,iBACJwnF,eAAe,GAEnBktD,GAAUnwI,QAAO,GACjBmwI,EAAU54H,UAId04H,iBAAkB,WACd,MAAI10I,MAAKkB,MAAMpC,IAAI,WAAaoK,OAAOksE,KAAK/vE,WAAWktE,SACnD,qDAA4DrpE,OAAOC,KAAnE,sBACInJ,KAAKkB,MAAMhB,GADf,+BAE+BgJ,OAAOC,KAFtC,mBAE6DnJ,KAAKkB,MAAMhB,GAFxE,8BAGIgJ,OAAOC,KAHX,uBAIuBnJ,KAAKkB,MAAMhB,GAJlC,gCAIoEgJ,OAAOC,KAJ3E,iBAKInJ,KAAKkB,MAAMhB,GALf,qMAOIgJ,OAAOC,KAPX,6BASInJ,KAAKkB,MAAMhB,GATf,2FAYA,qDACIgJ,OAAOC,KADX,kDAEkDnJ,KAAKkB,MAAMpC,IAAI,SAFjE,SAEkFkB,KAAKkB,MAAMpC,IACzF,QAHJ,+BAIgCoK,OAAOC,KAJvC,mBAKInJ,KAAKkB,MAAMhB,GALf,mHAOIF,KAAKkB,MAAMhB,GAPf,WAQWgJ,OAAOC,KARlB,uCAQ6DnJ,KAAKkB,MAAMhB,GARxE,4BAcR20I,EAAmB11I,EAASqK,KAAK3J,QACjC6J,MAAO,YACP5J,WAAY,WACRE,KAAK4e,WAAW,UAChBhhB,EAAEw1I,QAAQpzI,KAAM,wBAChBA,KAAK8gB,WAAa,GAAIoyH,GAAAx2I,QAAUo4I,mBAChC90I,KAAK8gB,WAAWmJ,QAAQ+G,KAAKhxB,KAAKgc,UAClChc,KAAK8gB,WAAWjb,KAAK,MAAO7F,KAAK+0I,YACjC/0I,KAAK8gB,WAAWpgB,GAAG,OAAQV,KAAKgc,OAAQhc,OAG5C6e,QACI2vE,UAAW,sBACXyB,KAAM,OACN1B,SAAU,SAASxpF,GACfS,EAAE,6BAA6BwX,SAAS,YACxCxX,EAAE,eAAewX,SAAS,mBAC1BjY,EAAG+hB,mBAIXkuH,oBAAqB,WACjBxvI,EAAE,6BAA6B0b,YAAY,YAC3C1b,EAAE,eAAe0b,YAAY,oBAGjC+uE,KAAM,SAASjxE,GAEXhf,KAAKg1I,sBACLh2H,EAAE8H,gBAGF,KAAK,GAAWwK,GAFZw7D,EAAQ9tE,EAAE1Y,aAAawmF,MACvBxkF,EAAOtI,KACF0P,EAAI,EAAO4hB,EAAIw7D,EAAMp9E,GAAKA,IAC/BpH,EAAK2sI,kBAAkB3jH,IAI/B2jH,kBAAmB,SAAS3jH,GACxB,GAAIhpB,GAAOtI,KACPk1I,EAAS,GAAIC,WACjBD,GAAOjpI,OAAS,SAAAmpI,GACZ,GAAIC,EACJ,KACIA,EAAUvzI,KAAKM,MAAM8yI,EAAOrlI,QAC9B,MAAOmP,GACLg0H,EAAWtxI,MAAX,wBAAyC4vB,EAAE3hB,KAA3C,2CACA0lI,EAAU,KAEVA,GACA/sI,EAAKwY,WAAW8R,OAAOyiH,GACnBlB,GAAI,EACJ11G,MAAM,EACNh9B,QAAS,WACLuxI,EAAWvxI,QAAX,mCAAsD4zI,EAAQ1lI,KAA9D,MAEJjO,MAAO,SAASR,EAAOuyE,EAAM/0E,GACzBs0I,EAAWtxI,MAAMhD,EAAQ01I,iBAKzCc,EAAOI,WAAWhkH,EAAG,UAGzBikH,eAAgB33I,EAAEi3F,KAAK,WAEnB,GAAI2gD,GAAW5vG,EAAAlpC,QAAmBoC,IAAI,UAEnB,WADF8mC,EAAAlpC,QAAmBoC,IAAI,UAEpCk0I,EAAWtxI,MAAM9D,EAAEumC,OAAOqxG,GAAY,2DAC/BA,GACPxC,EAAW7uD,KAAKvmF,EAAEumC,OAAOqxG,MAIjCx5H,OAAQ,WAEJ,GAAIwI,GAASxkB,KAAKy1I,kBAEdC,EAAkB11I,KAAK21I,yBACvBC,EAAgB51I,KAAK61I,wBACzB71I,MAAKuE,IAAI6a,KAAKoF,EAASkxH,EAAkBE,EACzC,IAAIttI,GAAOtI,IACXpC,GAAEoC,KAAK8gB,WAAWrL,QAAQlN,KAAK,SAAA0d,GAE3B3d,EAAKysI,WAAW9uH,GAChB3d,EAAKwtI,cAAc7vH,IACpBjmB,KAKH,OAHAA,MAAK+1I,eAAe/1I,KAAKwF,EAAE,cAAexF,KAAKwF,EAAE,uBAD5B,GAErBxF,KAAKg2I,uBACLh2I,KAAKu1I,iBACEv1I,MAGX+0I,WAAY,SAAS9uH,GACjB,GAAIgwH,GAAmB,GAAI9C,IACvBjyI,MAAO+kB,EACPnF,WAAY9gB,KAAK8gB,YAErBtb,GAAE,oBAAoBmE,OAAOssI,EAAiBj6H,SAAS+B,IACvDk4H,EAAiBtB,mBAIrBmB,cAAe,SAASI,GACKl2I,KAAKwF,EAAL,wBAA+B0wI,EAASh2I,IAC9C4f,MAAM,iBACrBnf,QAAOkmB,QAAP,wDAAuEqvH,EAAS7wI,WAAWsK,KAA3F,SAKRomI,eAAgB,SAASI,EAAiBC,EAAaC,GACnDF,EAAgBz1I,GAAG,QAAS,WACxB,GAAIsO,GAAQxJ,EAAExF,MAAM2I,KAGpB,IAAIqG,EAAMnO,QAAUw1I,EAAc,CAE9B,GAAIC,GAAqB,GAAIh5E,QAAOtuD,EAAO,IAC3ConI,GAAY9uI,OACZ8uI,EACK5yI,OAAO,WAGJ,MAAO8yI,GAAmB3+H,KAAKnS,EAAExF,MAAM8c,UAE1CzV,WAEL+uI,GAAY/uI,UAMxB2uI,qBAAsB,WAClBxwI,EAAExF,KAAK+d,IAAIrd,GAAG,mBAAoB,WAC9B8E,EAAExF,KAAK+d,IAAIN,IAAI,WAAY,aAE/BjY,EAAExF,KAAK+d,IAAIrd,GAAG,mBAAoB,WAC9B8E,EAAExF,KAAK+d,IAAIN,IAAI,WAAY,WAKnC84H,oBAAqB,WACjB,MAAO,yDAIXZ,uBAAwB,WACpB,mQACIzsI,OAAOC,KADX,8IAGID,OAAOC,KAHX,4CAQJ0sI,uBAAwB,WAWpB,MACIW,sTAKRf,gBAAiB,WACb,MACI,wIAURpqB,EAAqBlsH,EAASqK,KAAK3J,QACnCC,WAAY,WACRE,KAAK4e,WAAW,UAChB5e,KAAKgc,UAITA,OAAQ,WACJ,GAAI1T,GAAOtI,IACXwF,GAAE0J,QAAWhG,OAAOC,KAApB,kCAA2D,SAAAzK,GACvD4J,EAAK/D,IAAIyjB,QAAQre,OAAOrB,EAAKmuI,cAAc/3I,OAKnD+3I,cAAe,SAAS/3I,GACpB,0KACIwK,OAAOC,KADX,gMAGIzK,EAAQ4L,IAHZ,2vBAKI5L,EAAQg4I,wBALZ,sNzG4urCRt6I,GAAQM,SyGjurCJ8M,KAAMqrI,EACNxpB,mBAAoBA,KzGourCKpuH,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,GAErCrC,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G0GhmsCX,IAAAi0E,GAAA52E,EAAA,G1GqmsCI62E,EAEJ,SAAgC12E,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,IAFhDy2E,G0G3lsCnC0jE,EAAex3I,EAASS,MAAMC,OAAOqzE,EAAAx2E,QAAQ8C,eAAeK,QAC5DH,cAPe,WASfuT,QAAY/J,OAAOC,KAAnB,gBAEAxH,OAAQ,WAEJ,OAASu0I,SAAUl2I,KAAKqF,eAS5ByvI,EAAqB31I,EAASgW,WAAWtV,QACzCqB,MAAOy1I,EACPrsI,IAAQpB,OAAOC,KAAf,iB1G6msCJ/M,GAAQM,S0GvmsCJi6I,aAAcA,EACd7B,mBAAoBA,K1G0msCK73I,KAAKb,EAASC,EAAoB,KAIzD,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAsBlD,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G2GtpsCX,IAAAyjB,GAAApmB,EAAA,G3G2psCIqmB,EAAUnmB,EAAuBkmB,G2G1psCrCza,EAAA3L,EAAA,I3G8psCI4L,EAAa1L,EAAuByL,G2G7psCxC2vH,EAAAt7H,EAAA,I3GiqsCI8jI,EAAiB5jI,EAAuBo7H,G2GhqsC5CL,EAAAj7H,EAAA,K3GoqsCIk7H,EAAeh7H,EAAuB+6H,G2GnqsCtC9tH,EAAOrK,EAASqK,KAAK3J,QACrB6J,MAAO,YACP5J,WAAY,SAASpB,GACjB,GAAI4J,GAAOtI,IACXA,MAAK4e,WAAWpZ,EAAE,WAClBxF,KAAKkB,MAAQ,GAAI/B,GAASS,MAC1B8iB,EAAAhmB,QAAMoC,KACFwL,IAAQpB,OAAOC,KAAf,WAA8BzK,EAAQsrH,UAAtC,IAAmDxkH,EAAEua,MAAM7W,OAAO+F,QAClExN,QAAS,SAASmN,GACdA,EAAA,aAA0B,EAC1BhR,EAAE2K,KAAKqG,EAAA,WAAwB,SAAAwX,GACJ,QAAnBA,EAAUzQ,QACVyQ,EAAUW,QAAU,SAAA7mB,GAChBoI,EAAKsuI,gBAAgB12I,OAIjCoI,EAAKpH,MAAMU,IAAIgN,GACftG,EAAK0T,aAKjBA,OAAQ,WACJ,GAAImH,GAAO,GAAAlb,GAAAvL,QAAasD,KAAKkB,MAAMmE,WACnCrF,MAAKuE,IAAIyjB,QAAQre,OAAOwZ,EAAK5e,MAGjCqyI,gBAAiB,SAAS12I,GACtB,GAAI0mC,GAAU,GAAIu5F,GAAAzjI,QAAa6+F,SAAUr7F,GAAIA,GAC7C0mC,GACK3c,QACA45D,KAAK,WACF9iF,MAAM,mEAETiwB,KAAK,YACF,EAAAumG,EAAA76H,SAAkBkqC,MAAa5V,KAAK,WAC5BrwB,OAAO0d,QAAU1d,OAAO0d,OAAOnV,QAAUvI,OAAO0d,OAAOnV,OAAOkb,kBAC9DzjB,OAAO0d,OAAOnV,OAAOkb,iBAAiBC,qBAE1C1jB,OAAOqoB,SAAS6tH,QAAO,S3G2qsC3Cz6I,GAAQM,S2GpqsCJ8M,KAAMA,K3GuqsCmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,KAIzG,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,GAkB/C,QAASjJ,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GAhBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G4GrusCX,IAAAyjB,GAAApmB,EAAA,G5G0usCIqmB,EAAUnmB,EAAuBkmB,G4GzusCrCra,EAAA/L,EAAA,G5G6usCIsgC,EAAWpgC,EAAuB6L,G4G5usCtCyiG,EAAAxuG,EAAA,I5GgvsCIyuG,EAAavuG,EAAuBsuG,G4G9usCpCrhG,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,WACRE,KAAK4e,WAAW,UAChB5e,KAAKkB,MAAQ,GAAI/B,GAASS,OACtBse,WAAYhV,OAAO+F,OAAOiP,aAE9Ble,KAAKgc,UAITA,OAAQ,WACJ,GAAI9I,GAAchK,OAAOC,KAArB,gBAAyCnJ,KAAKkB,MAAMpC,IAAI,cAExDwJ,EAAOtI,IAEX0iB,GAAAhmB,QAAMoC,KACFwL,IAAK4I,EACLzR,QAAS,SAAS6L,GACd,GAAIwpI,GAAa5tI,OAAOC,KAApB,YAAoCmE,EAAQu2G,aAA5C,YACJnhG,GAAAhmB,QAAMoC,KACFwL,IAAKwsI,EACLr1I,QAAS,SAASs1I,GACG7tI,OAAOC,KAAgBmE,EAAQu2G,YAChDv7G,GAAK0uI,kBAAkB1uI,EAAMgF,EAASypI,IAE1Cr1I,MAAO,SAASkN,GACZ,GAAIqoI,IACAp5G,OAAQ,QACRvsB,QAAS,uCACT6sB,YAAY,EACZW,IAAK,eAETx2B,GAAK4uI,gBAAgBD,EAAgB3uI,EAAK9C,EAAE,0BAIxD9D,MAAO,SAASkN,GACZ,GAAIqoI,IACAp5G,OAAQ,QACRvsB,QAAS,2CACT6sB,YAAY,EACZW,IAAK,eAETx2B,GAAK4uI,gBAAgBD,EAAgB3uI,EAAK9C,EAAE,0BAMxDwxI,kBAAmB,SAAS1uI,EAAMgF,EAASypI,GACvCzuI,EAAK/D,IAAIyjB,QAAQre,OAAOrB,EAAKmtI,mBAC7BntI,EAAK/D,IAAIoF,OAAO,0BAChBrB,EAAK/D,IAAIoF,OAAT,iDAAiEotI,EAAIv+G,QAArE,aACAlwB,EAAK/D,IAAIoF,OAAO,2DAChBrB,EAAK/D,IAAIoF,OAAT,qBAAqCotI,EAAII,OAAzC,UACA7uI,EAAK/D,IAAIoF,OAAO,+BAChBrB,EAAK/D,IAAIoF,OACL,oUAEJrB,EAAK/D,IAAIoF,OAAOrB,EAAK8uI,oBAAoB9pI,EAASypI,KAItDG,gBAAiB,SAAStoI,EAAUrK,EAAK8yI,EAAYC,GAC5CA,EAOGD,EACA9yI,EAAIoF,OAAO,GAAIgzB,GAAAjgC,QAAG66I,iBAAiB3oI,GAAUrK,KAE7CA,EAAIyjB,QAAQ5I,KAAK,GAAIud,GAAAjgC,QAAG66I,iBAAiB3oI,GAAUrK,KATnD8yI,EACA9yI,EAAIoF,OAAO,GAAIgzB,GAAAjgC,QAAGwhC,QAAQtvB,GAAUrK,KAEpCA,EAAIyjB,QAAQ5I,KAAK,GAAIud,GAAAjgC,QAAGwhC,QAAQtvB,GAAUrK,MAYtDkxI,gBAAiB,WACb,MAAO,oFAIX2B,oBAAqB,SAAS9pI,EAASypI,GACnC,GAAIzuI,GAAOtI,KACP+2B,IAEI/U,KAAM,qBACNtjB,WACAkX,KAAM,OACNjG,KAAM,QACNgG,MAAO,aACP3W,MAAOkK,OAAOksE,KAAKt2E,IAAI,WAGvBkjB,KAAM,gGACNtjB,WACAkX,KAAM,OACN08H,MAAM,EACN3iI,KAAM,UACNgG,MAAO,YAmBXsnB,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAO,eACPqtB,OAAQA,EACRhtB,SACItJ,KAAM,GAAIk8B,GAAAjgC,QAAGmiC,QACT7S,KAAM,SACNtiB,MAAO,SACPo1B,IAAK,4BACL04G,SAAU,QACVzwH,QAAS,WACL,GAAI0wH,GAAYx6G,EAAKzyB,KAAKooB,SACtBtoB,EAASpB,OAAOC,KAAhB,YAAgC4tI,EAAI72I,GAApC,QACJu3I,GAAUv5H,WAAa5Q,EAAQpN,GAC/BoI,EAAK2c,OAAOwyH,EAAWntI,QAKvC,OAAO2yB,GAAK14B,KAIhB0gB,OAAQ,SAASwyH,EAAWntI,GACxB,GAAIhC,GAAOtI,IAEXwF,GAAE6E,MACEuL,KAAM,OACNtL,IAAKA,EACLE,KAAMitI,EACNh2I,QAAS,SAASmN,GAEdtG,EAAK/D,IAAIyjB,QAAQre,OAAOrB,EAAKmtI,mBAE7B7mI,EAAS4iG,SAASj8E,QAAQ,SAAAjkB,GACtBhJ,EAAK4uI,iBAEGr5G,OAAQvsB,EAAQ,GAChBA,QAASA,EAAQ,GACjB6sB,YAAY,GAEhB71B,EAAK9C,EAAE,sBACP,GACA,MAIZ9D,MAAO,SAASkN,GACZ,GAAIqoI,IACAp5G,OAAQ,QACRvsB,QAAS,iFACT6sB,YAAY,EACZW,IAAK,eAETx2B,GAAK4uI,gBAAgBD,EAAgB3uI,EAAK9C,EAAE,2B5G+usC5DpJ,GAAQM,S4GxusCJ8M,KAAMA,K5G2usCmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,KAIjF,SAAUF,EAAQC,EAASC,GAEjC,cAC4B,SAAS8C,EAAUqG,EAAG5H,GAsBlD,QAASrB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,QAASF,GApBvFM,OAAOiC,eAAe3C,EAAS,cAC3B4C,OAAO,G6G76sCX,IAAAyjB,GAAApmB,EAAA,GACA6L,G7Gi7sCc3L,EAAuBkmB,G6Gj7sCrCpmB,EAAA,K7Gq7sCI8L,EAAW5L,EAAuB2L,G6Gp7sCtCE,EAAA/L,EAAA,G7Gw7sCIsgC,EAAWpgC,EAAuB6L,G6Gv7sCtCyiG,EAAAxuG,EAAA,I7G27sCIyuG,EAAavuG,EAAuBsuG,G6G17sCpCrhG,EAAOrK,EAASqK,KAAK3J,QACrBC,WAAY,WACRE,KAAK4e,WAAW,UAChB5e,KAAKkB,MAAQ,GAAI/B,GAASS,OACtBse,WAAYhV,OAAO+F,OAAOiP,aAE9Ble,KAAKsR,QAAU,GAAIqrB,GAAAjgC,QAAGwhC,SAAUC,YAAY,IAC5Cn+B,KAAKuJ,KAAOvJ,KAAK03I,cACjB13I,KAAKuE,IACAoF,OAAOnE,EAAE,SAASmE,OAAO,4BACzBA,OAAO3J,KAAKsR,QAAQ/M,KACpBoF,OAAO,QACPA,OAAO3J,KAAKuJ,KAAKhF,KACjB+C,OACLtH,KAAKgc,UAITA,OAAQ,WACJ,GAAI1T,GAAOtI,IACXwF,GAAE6E,MACEC,IAAQpB,OAAOC,KAAf,+BAAkDb,EAAKpH,MAAMpC,IAAI,cACjE2C,QAAS,SAASmN,IACbtG,EAAKqvI,iBAAmBrvI,EAAKgJ,QAAQqtB,OAAO/vB,GAC7CtG,EAAKqvI,iBAAkB,EACvB/5I,EAAE2K,KAAKD,EAAK6nG,MAAO,SAAClzE,EAAMpgC,GACtBogC,EAAK/7B,MAAMU,IAAI,SAAUgN,EAAY/R,EAAZ,YACzBogC,EAAK/7B,MAAMU,IAAI,kBAAmBgN,EAAY/R,EAAZ,aAClCogC,EAAKjhB,WAET1T,EAAK/D,IAAI8C,QAEb3F,MAAO,SAASkN,GACZ,GAAImvB,GAAUnvB,EAASm1E,cAAgBn1E,EAASm1E,aAAahmD,OAC7Dz1B,GAAKgJ,QAAQqtB,QACTd,OAAQ,SACRvsB,QAASysB,GAAW,iDAOpCmtE,QAAS,SAAS9kF,EAAW6W,GACzB,GAAI30B,GAAOtI,KACPwK,EAAOyyB,EAAKzyB,KAAKooB,QACrBpoB,GAAK0T,WAAale,KAAKkB,MAAMpC,IAAI,cACjC0L,EAAK4b,UAAYA,EACjB5gB,EAAE6E,MACEuL,KAAM,MACNtL,IAAQpB,OAAOC,KAAf,mBACAqB,KAAMA,EACN/I,QAAS,SAASmN,GACdtG,EAAKgJ,QAAQqtB,OAAO/vB,GACpBtG,EAAK0T,SACL1T,EAAKsvI,kBAETl2I,MAAO,SAASkN,GACZ,GAAImvB,GAAUnvB,EAASm1E,cAAgBn1E,EAASm1E,aAAahmD,OAC7Dz1B,GAAKgJ,QAAQqtB,QACTd,OAAQ,SACRvsB,QAASysB,GAAW,4DAOpC25G,YAAa,WACT13I,KAAKmwG,OACD51F,UAAWva,KAAK63I,gBAChBC,WAAY93I,KAAK+3I,iBACjBC,SAAUh4I,KAAKi4I,eACfC,WAAYl4I,KAAKm4I,iBAErB,IAAI5uI,GAAO,GAAIpB,GAAAzL,QAAK8M,IA6BpB,OA5BAD,GAAKE,KACDvJ,GAAI,YACJwJ,MAAO,aACPsiB,KAAM,aACNvK,QAAS,0BACTld,IAAKvE,KAAKmwG,MAAM51F,UAAUhW,MAE9BgF,EAAKE,KACDvJ,GAAI,UACJwJ,MAAO,UACPsiB,KAAM,UACNvK,QAAS,wBACTld,IAAKvE,KAAKmwG,MAAM2nC,WAAWvzI,MAE/BgF,EAAKE,KACDvJ,GAAI,WACJwJ,MAAO,YACPsiB,KAAM,cACNvK,QAAS,mBACTld,IAAKvE,KAAKmwG,MAAM6nC,SAASzzI,MAE7BgF,EAAKE,KACDvJ,GAAI,cACJwJ,MAAO,cACPsiB,KAAM,UACNvK,QAAS,cACTld,IAAKvE,KAAKmwG,MAAM+nC,WAAW3zI,MAExBgF,GAIXsuI,cAAe,WACX,GAAIvvI,GAAOtI,KACPi9B,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAO,kBACP6e,YACI6vH,kBAAmB,GAAIz7G,GAAAjgC,QAAG21I,YACtB5wH,QAAS,kCACTuK,KAAM,cACNtiB,MAAO,OACPqd,QAAS,WACLze,EAAK4iG,QAAQ,aAAcjuE,MAGnCo7G,kBAAmB,GAAI17G,GAAAjgC,QAAG21I,YACtB5wH,QACI,sGACJuK,KAAM,UACNtiB,MAAO,cACPqd,QAAS,WACLze,EAAK4iG,QAAQ,aAAcjuE,QAK3C,OAAOA,IAIX86G,eAAgB,WACZ,GAAIzvI,GAAOtI,KACPi9B,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAO,wBACP6e,YACI+vH,kBAAmB,GAAI37G,GAAAjgC,QAAG21I,YACtB5wH,QAAS,wCACT/X,MAAO,mBACPsiB,KAAM,cACNjF,QAAS,WACLze,EAAK4iG,QAAQ,aAAcjuE,QAK3C,OAAOA,IAIXg7G,aAAc,WACV,GAAI3vI,GAAOtI,KACPi9B,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAO,kBACP6e,YACIgwH,gBAAiB,GAAI57G,GAAAjgC,QAAG21I,YACpB5wH,QAAS,qCACT/X,MAAO,kBACPsiB,KAAM,cACNjF,QAAS,WACLze,EAAK4iG,QAAQ,WAAYjuE,QAKzC,OAAOA,IAIXk7G,eAAgB,WACZ,GAAI7vI,GAAOtI,KACPi9B,EAAO,GAAA6tE,GAAApuG,SACPgN,MAAO,6BACP6e,YACIiwH,kBAAmB,GAAI77G,GAAAjgC,QAAG21I,YACtB5wH,QAAS,oBACT/X,MAAO,mBACPsiB,KAAM,eACNjF,QAAS,WACLze,EAAK4iG,QAAQ,aAAcjuE,QAK3C,OAAOA,IAIX26G,eAAgB,WACRj3I,OAAOuI,QACPvI,OAAOuI,OAAOkb,iBAAiBC,uB7G87sC3CjoB,GAAQM,S6Gx7sCJ8M,KAAMA,K7G27sCmBvM,KAAKb,EAASC,EAAoB,GAAIA,EAAoB,GAAIA,EAAoB,OAG5G","file":"analysis.bundled.js","sourcesContent":["webpackJsonp([0],[\n/* 0 */,\n/* 1 */,\n/* 2 */,\n/* 3 */,\n/* 4 */,\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _backbone = __webpack_require__(2);\n\nvar Backbone = _interopRequireWildcard(_backbone);\n\nvar _addLogging = __webpack_require__(21);\n\nvar _addLogging2 = _interopRequireDefault(_addLogging);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n//==============================================================================\n/** @class Mixin to add logging capabilities to an object.\n *      Designed to allow switching an objects log output off/on at one central\n *      statement. Can be used with plain browser console (or something more\n *      complex like an AJAX logger).\n *  <br />NOTE: currently only uses the console.debug log function\n *  (as opposed to debug, error, warn, etc.)\n *  @name LoggableMixin\n *\n *  @example\n *  // Add to your models/views at the definition using chaining:\n *      var MyModel = Backbone.Model.extend( LoggableMixin ).extend({ // ... });\n *\n *  // or - more explicitly AFTER the definition:\n *      var MyModel = Backbone.Model.extend({\n *          logger  : console\n *          // ...\n *          this.log( '$#%& it! - broken already...' );\n *      })\n *      _.extend( MyModel.prototype, LoggableMixin )\n *\n */\nvar LoggableMixin = /** @lends LoggableMixin# */{\n    // replace null with console (if available) to see all logs for a particular view/model\n    /** The logging object whose log function will be used to output\n     *      messages. Null will supress all logging. Commonly set to console.\n     */\n    logger: null,\n    /** @type {String} a namespace for filtering/focusing log output */\n    _logNamespace: \".\"\n};\n(0, _addLogging2.default)(LoggableMixin);\n\n//==============================================================================\n/** Backbone model that syncs to the browser's sessionStorage API.\n *      This all largely happens behind the scenes and no special calls are required.\n */\nvar SessionStorageModel = Backbone.Model.extend({\n    initialize: function initialize(initialAttrs) {\n        // check for sessionStorage and error if no id is provided\n        this._checkEnabledSessionStorage();\n        if (!initialAttrs.id) {\n            throw new Error(\"SessionStorageModel requires an id in the initial attributes\");\n        }\n        this.id = initialAttrs.id;\n\n        // load existing from storage (if any), clear any attrs set by bbone before init is called,\n        //  layer initial over existing and defaults, and save\n        var existing = !this.isNew() ? this._read(this) : {};\n        this.clear({ silent: true });\n        this.save(_.extend({}, this.defaults, existing, initialAttrs), {\n            silent: true\n        });\n\n        // save on any change to it immediately\n        this.on(\"change\", function () {\n            this.save();\n        });\n    },\n\n    _checkEnabledSessionStorage: function _checkEnabledSessionStorage() {\n        try {\n            return window.sessionStorage.length >= 0;\n        } catch (err) {\n            alert(\"Please enable cookies in your browser for this Galaxy site\");\n            return false;\n        }\n    },\n\n    /** override of bbone sync to save to sessionStorage rather than REST\n     *      bbone options (success, errror, etc.) should still apply\n     */\n    sync: function sync(method, model, options) {\n        if (!options.silent) {\n            model.trigger(\"request\", model, {}, options);\n        }\n        var returned = {};\n        switch (method) {\n            case \"create\":\n                returned = this._create(model);\n                break;\n            case \"read\":\n                returned = this._read(model);\n                break;\n            case \"update\":\n                returned = this._update(model);\n                break;\n            case \"delete\":\n                returned = this._delete(model);\n                break;\n        }\n        if (returned !== undefined || returned !== null) {\n            if (options.success) {\n                options.success();\n            }\n        } else {\n            if (options.error) {\n                options.error();\n            }\n        }\n        return returned;\n    },\n\n    /** set storage to the stringified item */\n    _create: function _create(model) {\n        try {\n            var json = model.toJSON();\n            var set = sessionStorage.setItem(model.id, JSON.stringify(json));\n            return set === null ? set : json;\n            // DOMException is thrown in Safari if in private browsing mode and sessionStorage is attempted:\n            // http://stackoverflow.com/questions/14555347\n            // TODO: this could probably use a more general soln - like detecting priv. mode + safari => non-ajaxing Model\n        } catch (err) {\n            if (!(err instanceof DOMException && navigator.userAgent.indexOf(\"Safari\") > -1)) {\n                throw err;\n            }\n        }\n        return null;\n    },\n\n    /** read and parse json from storage */\n    _read: function _read(model) {\n        return JSON.parse(sessionStorage.getItem(model.id));\n    },\n\n    /** set storage to the item (alias to create) */\n    _update: function _update(model) {\n        return model._create(model);\n    },\n\n    /** remove the item from storage */\n    _delete: function _delete(model) {\n        return sessionStorage.removeItem(model.id);\n    },\n\n    /** T/F whether sessionStorage contains the model's id (data is present) */\n    isNew: function isNew() {\n        return !sessionStorage.hasOwnProperty(this.id);\n    },\n\n    _log: function _log() {\n        return JSON.stringify(this.toJSON(), null, \"  \");\n    },\n    toString: function toString() {\n        return \"SessionStorageModel(\" + this.id + \")\";\n    }\n});\n(function () {\n    SessionStorageModel.prototype = _.omit(SessionStorageModel.prototype, \"url\", \"urlRoot\");\n})();\n\n//==============================================================================\n/** Function that allows mixing of hashs into bbone MVC while showing the mixins first\n *      (before the more local class overrides/hash).\n *      Basically, a simple reversal of param order on _.defaults() - to show mixins in top of definition.\n *  @example:\n *      var NewModel = Something.extend( mixin( MyMixinA, MyMixinB, { ... myVars : ... }) );\n *\n *  NOTE: this does not combine any hashes (like events, etc.) and you're expected to handle that\n */\nfunction mixin(mixinHash1, /* mixinHash2, etc: ... variadic */propsHash) {\n    var args = Array.prototype.slice.call(arguments, 0);\n    var lastArg = args.pop();\n    args.unshift(lastArg);\n    return _.defaults.apply(_, args);\n}\n\n//==============================================================================\n/** A mixin for models that allow T/F/Matching to their attributes - useful when\n *      searching or filtering collections of models.\n * @example:\n *      see hda-model for searchAttribute and searchAliases definition examples.\n *      see history-contents.matches for how collections are filtered\n *      and see readonly-history-view.searchHdas for how user input is connected to the filtering\n */\nvar SearchableModelMixin = {\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes: [\n        // override\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases: {\n        // override\n    },\n\n    /** search the attribute with key attrKey for the string searchFor; T/F if found */\n    searchAttribute: function searchAttribute(attrKey, searchFor) {\n        var attrVal = this.get(attrKey);\n        //this.debug( 'searchAttribute', attrKey, attrVal, searchFor );\n        // bail if empty searchFor or unsearchable values\n        if (!searchFor || attrVal === undefined || attrVal === null) {\n            return false;\n        }\n        // pass to sep. fn for deep search of array attributes\n        if (_.isArray(attrVal)) {\n            return this._searchArrayAttribute(attrVal, searchFor);\n        }\n        return attrVal.toString().toLowerCase().indexOf(searchFor.toLowerCase()) !== -1;\n    },\n\n    /** deep(er) search for array attributes; T/F if found */\n    _searchArrayAttribute: function _searchArrayAttribute(array, searchFor) {\n        //this.debug( '_searchArrayAttribute', array, searchFor );\n        searchFor = searchFor.toLowerCase();\n        //precondition: searchFor has already been validated as non-empty string\n        //precondition: assumes only 1 level array\n        //TODO: could possibly break up searchFor more (CSV...)\n        return _.any(array, function (elem) {\n            return elem.toString().toLowerCase().indexOf(searchFor.toLowerCase()) !== -1;\n        });\n    },\n\n    /** search all searchAttributes for the string searchFor,\n     *      returning a list of keys of attributes that contain searchFor\n     */\n    search: function search(searchFor) {\n        var model = this;\n        return _.filter(this.searchAttributes, function (key) {\n            return model.searchAttribute(key, searchFor);\n        });\n    },\n\n    /** alias of search, but returns a boolean; accepts attribute specifiers where\n     *      the attributes searched can be narrowed to a single attribute using\n     *      the form: matches( 'genome_build=hg19' )\n     *      (the attribute keys allowed can also be aliases to the true attribute key;\n     *          see searchAliases above)\n     *  @param {String} term   plain text or ATTR_SPECIFIER sep. key=val pair\n     *  @returns {Boolean} was term found in (any) attribute(s)\n     */\n    matches: function matches(term) {\n        var ATTR_SPECIFIER = \"=\";\n        var split = term.split(ATTR_SPECIFIER);\n        // attribute is specified - search only that\n        if (split.length >= 2) {\n            var attrKey = split[0];\n            attrKey = this.searchAliases[attrKey] || attrKey;\n            return this.searchAttribute(attrKey, split[1]);\n        }\n        // no attribute is specified - search all attributes in searchAttributes\n        return !!this.search(term).length;\n    },\n\n    /** an implicit AND search for all terms; IOW, a model must match all terms given\n     *      where terms is a whitespace separated value string.\n     *      e.g. given terms of: 'blah bler database=hg19'\n     *          an HDA would have to have attributes containing blah AND bler AND a genome_build == hg19\n     *      To include whitespace in terms: wrap the term in double quotations (name=\"blah bler\").\n     */\n    matchesAll: function matchesAll(terms) {\n        var model = this;\n        // break the terms up by whitespace and filter out the empty strings\n        terms = terms.match(/(\".*\"|\\w*=\".*\"|\\S*)/g).filter(function (s) {\n            return !!s;\n        });\n        return _.all(terms, function (term) {\n            term = term.replace(/\"/g, \"\");\n            return model.matches(term);\n        });\n    }\n};\n\n//==============================================================================\n/** A view that renders hidden and shows when some activator is clicked.\n *      options:\n *          showFn: the effect used to show/hide the View (defaults to jq.toggle)\n *          $elementShown: some jqObject (defaults to this.$el) to be shown/hidden\n *          onShowFirstTime: fn called the first time the view is shown\n *          onshow: fn called every time the view is shown\n *          onhide: fn called every time the view is hidden\n *      events:\n *          hiddenUntilActivated:shown (the view is passed as an arg)\n *          hiddenUntilActivated:hidden (the view is passed as an arg)\n *      instance vars:\n *          view.hidden {boolean} is the view in the hidden state\n */\nvar HiddenUntilActivatedViewMixin = /** @lends hiddenUntilActivatedMixin# */{\n    //TODO: since this is a mixin, consider moving toggle, hidden into HUAVOptions\n\n    /** call this in your initialize to set up the mixin\n     *  @param {jQuery} $activator the 'button' that's clicked to show/hide the view\n     *  @param {Object} hash with mixin options\n     */\n    hiddenUntilActivated: function hiddenUntilActivated($activator, options) {\n        // call this in your view's initialize fn\n        options = options || {};\n        //TODO: flesh out options - show them all here\n        this.HUAVOptions = {\n            $elementShown: this.$el,\n            showFn: jQuery.prototype.toggle,\n            showSpeed: \"fast\"\n        };\n        _.extend(this.HUAVOptions, options || {});\n        /** has this been shown already (and onshowFirstTime called)? */\n        this.HUAVOptions.hasBeenShown = this.HUAVOptions.$elementShown.is(\":visible\");\n        this.hidden = this.isHidden();\n\n        if ($activator) {\n            var mixin = this;\n            $activator.on(\"click\", function (ev) {\n                mixin.toggle(mixin.HUAVOptions.showSpeed);\n            });\n        }\n    },\n\n    //TODO:?? remove? use .hidden?\n    /** returns T/F if the view is hidden */\n    isHidden: function isHidden() {\n        return this.HUAVOptions.$elementShown.is(\":hidden\");\n    },\n\n    /** toggle the hidden state, show/hide $elementShown, call onshow/hide, trigger events */\n    toggle: function toggle() {\n        //TODO: more specific name - toggle is too general\n        // can be called manually as well with normal toggle arguments\n        //TODO: better as a callback (when the show/hide is actually done)\n        // show\n        if (this.hidden) {\n            // fire the optional fns on the first/each showing - good for render()\n            if (!this.HUAVOptions.hasBeenShown) {\n                if (_.isFunction(this.HUAVOptions.onshowFirstTime)) {\n                    this.HUAVOptions.hasBeenShown = true;\n                    this.HUAVOptions.onshowFirstTime.call(this);\n                }\n            }\n            if (_.isFunction(this.HUAVOptions.onshow)) {\n                this.HUAVOptions.onshow.call(this);\n                this.trigger(\"hiddenUntilActivated:shown\", this);\n            }\n            this.hidden = false;\n\n            // hide\n        } else {\n            if (_.isFunction(this.HUAVOptions.onhide)) {\n                this.HUAVOptions.onhide.call(this);\n                this.trigger(\"hiddenUntilActivated:hidden\", this);\n            }\n            this.hidden = true;\n        }\n        return this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown, arguments);\n    }\n};\n\n//==============================================================================\n/** Mixin for views that can be dragged and dropped\n *      Allows for the drag behavior to be turned on/off, setting/removing jQuery event\n *          handlers each time.\n *      dataTransfer data is set to the JSON string of the view's model.toJSON\n *      Override '$dragHandle' to define the draggable DOM sub-element.\n */\nvar DraggableViewMixin = {\n    /** set up instance vars to track whether this view is currently draggable */\n    initialize: function initialize(attributes) {\n        /** is the body of this hda view expanded/not? */\n        this.draggable = attributes.draggable || false;\n    },\n\n    /** what part of the view's DOM triggers the dragging */\n    $dragHandle: function $dragHandle() {\n        //TODO: make abstract/general - move this to listItem\n        // override to the element you want to be your view's handle\n        return this.$(\".title-bar\");\n    },\n\n    /** toggle whether this view is draggable */\n    toggleDraggable: function toggleDraggable() {\n        if (this.draggable) {\n            this.draggableOff();\n        } else {\n            this.draggableOn();\n        }\n    },\n\n    /** allow the view to be dragged, set up event handlers */\n    draggableOn: function draggableOn() {\n        this.draggable = true;\n        this.dragStartHandler = _.bind(this._dragStartHandler, this);\n        this.dragEndHandler = _.bind(this._dragEndHandler, this);\n\n        var handle = this.$dragHandle().attr(\"draggable\", true).get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** turn of view dragging and remove event listeners */\n    draggableOff: function draggableOff() {\n        this.draggable = false;\n        var handle = this.$dragHandle().attr(\"draggable\", false).get(0);\n        handle.removeEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.removeEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** sets the dataTransfer data to the model's toJSON\n     *  @fires draggable:dragstart (bbone event) which is passed the event and this view\n     */\n    _dragStartHandler: function _dragStartHandler(event) {\n        event.dataTransfer.effectAllowed = \"move\";\n        //ASSUMES: this.model\n        //TODO: all except IE: should be 'application/json', IE: must be 'text'\n        event.dataTransfer.setData(\"text\", JSON.stringify(this.model.toJSON()));\n        this.trigger(\"draggable:dragstart\", event, this);\n        return false;\n    },\n\n    /** handle the dragend\n     *  @fires draggable:dragend (bbone event) which is passed the event and this view\n     */\n    _dragEndHandler: function _dragEndHandler(event) {\n        this.trigger(\"draggable:dragend\", event, this);\n        return false;\n    }\n};\n\n//==============================================================================\n/** Mixin that allows a view to be selected (gen. from a list).\n *      Selection controls ($selector) may be hidden/shown/toggled.\n *          The bbone event 'selectable' is fired when the controls are shown/hidden (passed T/F).\n *      Default rendering is a font-awesome checkbox.\n *      Default selector is '.selector' within the view's $el.\n *      The bbone events 'selected' and 'de-selected' are fired when the $selector is clicked.\n *          Both events are passed the view and the (jQuery) event.\n */\nvar SelectableViewMixin = {\n    /** Set up instance state vars for whether the selector is shown and whether the view has been selected */\n    initialize: function initialize(attributes) {\n        /** is the view currently in selection mode? */\n        this.selectable = attributes.selectable || false;\n        /** is the view currently selected? */\n        this.selected = attributes.selected || false;\n    },\n\n    /** $el sub-element where the selector is rendered and what can be clicked to select. */\n    $selector: function $selector() {\n        return this.$(\".selector\");\n    },\n\n    /** How the selector is rendered - defaults to font-awesome checkbox */\n    _renderSelected: function _renderSelected() {\n        // override\n        this.$selector().find(\"span\").toggleClass(\"fa-check-square-o\", this.selected).toggleClass(\"fa-square-o\", !this.selected);\n    },\n\n    /** Toggle whether the selector is shown */\n    toggleSelector: function toggleSelector() {\n        //TODO: use this.selectable\n        if (!this.$selector().is(\":visible\")) {\n            this.showSelector();\n        } else {\n            this.hideSelector();\n        }\n    },\n\n    /** Display the selector control.\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed true (IOW, the selector is shown) and the view\n     */\n    showSelector: function showSelector(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // make sure selected state is represented properly\n        this.selectable = true;\n        this.trigger(\"selectable\", true, this);\n        this._renderSelected();\n        if (speed) {\n            this.$selector().show(speed);\n        } else {\n            this.$selector().show();\n        }\n    },\n\n    /** remove the selector control\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed false (IOW, the selector is not shown) and the view\n     */\n    hideSelector: function hideSelector(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // reverse the process from showSelect\n        this.selectable = false;\n        this.trigger(\"selectable\", false, this);\n        if (speed) {\n            this.$selector().hide(speed);\n        } else {\n            this.$selector().hide();\n        }\n    },\n\n    /** Toggle whether the view is selected */\n    toggleSelect: function toggleSelect(event) {\n        if (this.selected) {\n            this.deselect(event);\n        } else {\n            this.select(event);\n        }\n    },\n\n    /** Select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    select: function select(event) {\n        // switch icon, set selected, and trigger event\n        if (!this.selected) {\n            this.trigger(\"selected\", this, event);\n            this.selected = true;\n            this._renderSelected();\n        }\n        return false;\n    },\n\n    /** De-select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: de-selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    deselect: function deselect(event) {\n        // switch icon, set selected, and trigger event\n        if (this.selected) {\n            this.trigger(\"de-selected\", this, event);\n            this.selected = false;\n            this._renderSelected();\n        }\n        return false;\n    }\n};\n\n//==============================================================================\n/** Return an underscore template fn from an array of strings.\n *  @param {String[]} template      the template strings to compile into the underscore template fn\n *  @param {String} jsonNamespace   an optional namespace for the json data passed in (defaults to 'model')\n *  @returns {Function} the (wrapped) underscore template fn\n *      The function accepts:\n *\n *  The template strings can access:\n *      the json/model hash using model (\"<%- model.myAttr %>) using the jsonNamespace above\n *      _l: the localizer function\n *      view (if passed): ostensibly, the view using the template (handy for view instance vars)\n *      Because they're namespaced, undefined attributes will not throw an error.\n *\n *  @example:\n *      templateBler : BASE_MVC.wrapTemplate([\n *          '<div class=\"myclass <%- mynamespace.modelClass %>\">',\n *              '<span><% print( _l( mynamespace.message ) ); %>:<%= view.status %></span>'\n *          '</div>'\n *      ], 'mynamespace' )\n *\n *  Meant to be called in a View's definition in order to compile only once.\n *\n */\nfunction wrapTemplate(template, jsonNamespace) {\n    jsonNamespace = jsonNamespace || \"model\";\n    var templateFn = _.template(template.join(\"\"));\n    return function (json, view) {\n        var templateVars = { view: view || {}, _l: _localization2.default };\n        templateVars[jsonNamespace] = json || {};\n        return templateFn(templateVars);\n    };\n}\n\n//==============================================================================\n/** Return a comparator function for sorted Collections */\nfunction buildComparator(attribute_name, options) {\n    options = options || {};\n    var ascending = options.ascending ? 1 : -1;\n    return function __comparator(a, b) {\n        a = a.get(attribute_name);\n        b = b.get(attribute_name);\n        return (a < b ? -1 : a > b ? 1 : 0) * ascending;\n    };\n}\n\n//==============================================================================\nexports.default = {\n    LoggableMixin: LoggableMixin,\n    SessionStorageModel: SessionStorageModel,\n    mixin: mixin,\n    SearchableModelMixin: SearchableModelMixin,\n    HiddenUntilActivatedViewMixin: HiddenUntilActivatedViewMixin,\n    DraggableViewMixin: DraggableViewMixin,\n    SelectableViewMixin: SelectableViewMixin,\n    wrapTemplate: wrapTemplate,\n    buildComparator: buildComparator\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 6 */,\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _data = __webpack_require__(10);\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _util = __webpack_require__(8);\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _config = __webpack_require__(11);\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _gridView = __webpack_require__(12);\n\nvar _gridView2 = _interopRequireDefault(_gridView);\n\nvar _uiTabs = __webpack_require__(20);\n\nvar _uiTabs2 = _interopRequireDefault(_uiTabs);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * Mixin for returning custom JSON representation from toJSON. Class attribute to_json_keys defines a set of attributes\n * to include in the representation; to_json_mappers defines mappers for returned objects.\n */\nvar CustomToJSON = {\n    /**\n     * Returns JSON representation of object using to_json_keys and to_json_mappers.\n     */\n    toJSON: function toJSON() {\n        var self = this;\n        var json = {};\n        _.each(self.constructor.to_json_keys, function (k) {\n            var val = self.get(k);\n            if (k in self.constructor.to_json_mappers) {\n                val = self.constructor.to_json_mappers[k](val, self);\n            }\n            json[k] = val;\n        });\n        return json;\n    }\n};\n\n/**\n * Model, view, and controller objects for Galaxy visualization framework.\n *\n * Models have no references to views, instead using events to indicate state\n * changes; this is advantageous because multiple views can use the same object\n * and models can be used without views.\n */\n\n/**\n * Use a popup grid to select datasets from histories or libraries. After datasets are selected,\n * track definitions are obtained from the server and the success_fn is called with the list of\n * definitions for selected datasets.\n */\nvar select_datasets = function select_datasets(filters, success_fn) {\n    // history dataset selection tab\n    var history_grid = new _gridView2.default({\n        url_base: Galaxy.root + \"visualization/list_history_datasets\",\n        filters: filters,\n        dict_format: true,\n        embedded: true\n    });\n\n    // library dataset selection tab\n    var library_grid = new _gridView2.default({\n        url_base: Galaxy.root + \"visualization/list_library_datasets\",\n        dict_format: true,\n        embedded: true\n    });\n\n    // build tabs\n    var tabs = new _uiTabs2.default.View();\n    tabs.add({\n        id: \"histories\",\n        title: \"Histories\",\n        $el: $(\"<div/>\").append(history_grid.$el)\n    });\n    tabs.add({\n        id: \"libraries\",\n        title: \"Libraries\",\n        $el: $(\"<div/>\").append(library_grid.$el)\n    });\n\n    // modal\n    Galaxy.modal.show({\n        title: \"Select datasets for new tracks\",\n        body: tabs.$el,\n        closing_events: true,\n        buttons: {\n            Cancel: function Cancel() {\n                Galaxy.modal.hide();\n            },\n            Add: function Add() {\n                var requests = [];\n                tabs.$(\"input.grid-row-select-checkbox[name=id]:checked\").each(function () {\n                    window.console.log($(this).val());\n                    requests[requests.length] = $.ajax({\n                        url: Galaxy.root + \"api/datasets/\" + $(this).val(),\n                        dataType: \"json\",\n                        data: {\n                            data_type: \"track_config\",\n                            hda_ldda: tabs.current() == \"histories\" ? \"hda\" : \"ldda\"\n                        }\n                    });\n                });\n                // To preserve order, wait until there are definitions for all tracks and then add\n                // them sequentially.\n                $.when.apply($, requests).then(function () {\n                    // jQuery always returns an Array for arguments, so need to look at first element\n                    // to determine whether multiple requests were made and consequently how to\n                    // map arguments to track definitions.\n                    var track_defs = arguments[0] instanceof Array ? $.map(arguments, function (arg) {\n                        return arg[0];\n                    }) : [arguments[0]];\n                    success_fn(track_defs);\n                });\n                Galaxy.modal.hide();\n            }\n        }\n    });\n};\n\n// --------- Models ---------\n\n/**\n * Canvas manager is used to create canvases for browsers as well as providing a pattern cache\n */\nvar CanvasManager = function CanvasManager(default_font) {\n    this.default_font = default_font !== undefined ? default_font : \"9px Monaco, Lucida Console, monospace\";\n\n    this.dummy_canvas = this.new_canvas();\n    this.dummy_context = this.dummy_canvas.getContext(\"2d\");\n    this.dummy_context.font = this.default_font;\n\n    this.char_width_px = this.dummy_context.measureText(\"A\").width;\n\n    this.patterns = {};\n\n    // FIXME: move somewhere to make this more general\n    this.load_pattern(\"right_strand\", \"/visualization/strand_right.png\");\n    this.load_pattern(\"left_strand\", \"/visualization/strand_left.png\");\n    this.load_pattern(\"right_strand_inv\", \"/visualization/strand_right_inv.png\");\n    this.load_pattern(\"left_strand_inv\", \"/visualization/strand_left_inv.png\");\n};\n\n_.extend(CanvasManager.prototype, {\n    load_pattern: function load_pattern(key, path) {\n        var patterns = this.patterns;\n        var dummy_context = this.dummy_context;\n        var image = new Image();\n        image.src = Galaxy.root + \"static/images\" + path;\n        image.onload = function () {\n            patterns[key] = dummy_context.createPattern(image, \"repeat\");\n        };\n    },\n    get_pattern: function get_pattern(key) {\n        return this.patterns[key];\n    },\n    new_canvas: function new_canvas() {\n        var canvas = $(\"<canvas/>\")[0];\n        // Keep a reference back to the manager\n        canvas.manager = this;\n        return canvas;\n    }\n});\n\n/**\n * Generic cache that handles key/value pairs. Keys can be any object that can be\n * converted to a String and compared.\n */\nvar Cache = Backbone.Model.extend({\n    defaults: {\n        num_elements: 20,\n        // Objects in cache; indexes into cache are strings of keys.\n        obj_cache: null,\n        // key_ary contains keys for objects in cache.\n        key_ary: null\n    },\n\n    initialize: function initialize(options) {\n        this.clear();\n    },\n\n    /**\n     * Get an element from the cache using its key.\n     */\n    get_elt: function get_elt(key) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n\n        var index = _.indexOf(key_ary, function (k) {\n            return k.toString() === key_str;\n        });\n\n        // Update cache.\n        if (index !== -1) {\n            // Object is in cache, so update it.\n            if (obj_cache[key_str].stale) {\n                // Object is stale: remove key and object.\n                key_ary.splice(index, 1);\n                delete obj_cache[key_str];\n            } else {\n                // Move key to back because it is most recently used.\n                this.move_key_to_end(key, index);\n            }\n        }\n\n        return obj_cache[key_str];\n    },\n\n    /**\n     * Put an element into the cache.\n     */\n    set_elt: function set_elt(key, value) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n        var num_elements = this.attributes.num_elements;\n\n        // Update keys, objects.\n        if (!obj_cache[key_str]) {\n            // Add object to cache.\n\n            if (key_ary.length >= num_elements) {\n                // Cache full, so remove first element.\n                var deleted_key = key_ary.shift();\n                delete obj_cache[deleted_key.toString()];\n            }\n\n            // Add key.\n            key_ary.push(key);\n        }\n\n        // Add object.\n        obj_cache[key_str] = value;\n        return value;\n    },\n\n    /**\n     * Move key to end of cache. Keys are removed from the front, so moving a key to the end\n     * delays the key's removal.\n     */\n    move_key_to_end: function move_key_to_end(key, index) {\n        this.attributes.key_ary.splice(index, 1);\n        this.attributes.key_ary.push(key);\n    },\n\n    /**\n     * Clear all elements from the cache.\n     */\n    clear: function clear() {\n        this.attributes.obj_cache = {};\n        this.attributes.key_ary = [];\n    },\n\n    /** Returns the number of elements in the cache. */\n    size: function size() {\n        return this.attributes.key_ary.length;\n    },\n\n    /** Returns key most recently added to cache. */\n    most_recently_added: function most_recently_added() {\n        return this.size() === 0 ? null : // Most recent key is at the end of key array.\n        this.attributes.key_ary[this.attributes.key_ary.length - 1];\n    }\n});\n\n/**\n * Data manager for genomic data. Data is connected to and queryable by genomic regions.\n */\nvar GenomeDataManager = Cache.extend({\n    defaults: _.extend({}, Cache.prototype.defaults, {\n        dataset: null,\n        genome: null,\n        init_data: null,\n        min_region_size: 200,\n        filters_manager: null,\n        data_type: \"data\",\n        data_mode_compatible: function data_mode_compatible(entry, mode) {\n            return true;\n        },\n        can_subset: function can_subset(entry) {\n            return false;\n        }\n    }),\n\n    /**\n     * Initialization.\n     */\n    initialize: function initialize(options) {\n        Cache.prototype.initialize.call(this);\n\n        // Set initial entries in data manager.\n        var initial_entries = this.get(\"init_data\");\n        if (initial_entries) {\n            this.add_data(initial_entries);\n        }\n    },\n\n    /**\n     * Add data entries to manager; each entry should be a dict with attributes region (key), data, and data_type.\n     * If necessary, manager size is increased to hold all data.\n     */\n    add_data: function add_data(entries) {\n        // Increase size to accomodate all entries.\n        if (this.get(\"num_elements\") < entries.length) {\n            this.set(\"num_elements\", entries.length);\n        }\n\n        // Put data into manager.\n        var self = this;\n        _.each(entries, function (entry) {\n            self.set_data(entry.region, entry);\n        });\n    },\n\n    /**\n     * Returns deferred that resolves to true when dataset is ready (or false if dataset\n     * cannot be used).\n     */\n    data_is_ready: function data_is_ready() {\n        var dataset = this.get(\"dataset\");\n        var ready_deferred = $.Deferred();\n\n        var // If requesting raw data, query dataset state; if requesting (converted) data,\n        // need to query converted datasets state.\n        query_type = this.get(\"data_type\") === \"raw_data\" ? \"state\" : this.get(\"data_type\") === \"data\" ? \"converted_datasets_state\" : \"error\";\n\n        var ss_deferred = new _util2.default.ServerStateDeferred({\n            ajax_settings: {\n                url: this.get(\"dataset\").url(),\n                data: {\n                    hda_ldda: dataset.get(\"hda_ldda\"),\n                    data_type: query_type\n                },\n                dataType: \"json\"\n            },\n            interval: 5000,\n            success_fn: function success_fn(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        $.when(ss_deferred.go()).then(function (response) {\n            ready_deferred.resolve(response === \"ok\" || response === \"data\");\n        });\n        return ready_deferred;\n    },\n\n    /**\n     * Perform a feature search from server; returns Deferred object that resolves when data is available.\n     */\n    search_features: function search_features(query) {\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            query: query,\n            hda_ldda: dataset.get(\"hda_ldda\"),\n            data_type: \"features\"\n        };\n\n        return $.getJSON(dataset.url(), params);\n    },\n\n    /**\n     * Load data from server and manages data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function load_data(region, mode, resolution, extra_params) {\n        // Setup data request params.\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            data_type: this.get(\"data_type\"),\n            chrom: region.get(\"chrom\"),\n            low: region.get(\"start\"),\n            high: region.get(\"end\"),\n            mode: mode,\n            resolution: resolution,\n            hda_ldda: dataset.get(\"hda_ldda\")\n        };\n\n        $.extend(params, extra_params);\n\n        // Add track filters to params.\n        var filters_manager = this.get(\"filters_manager\");\n        if (filters_manager) {\n            var filter_names = [];\n            var filters = filters_manager.filters;\n            for (var i = 0; i < filters.length; i++) {\n                filter_names.push(filters[i].name);\n            }\n            params.filter_cols = JSON.stringify(filter_names);\n        }\n\n        // Do request.\n        var manager = this;\n\n        var entry = $.getJSON(dataset.url(), params, function (result) {\n            // Add region to the result.\n            result.region = region;\n            manager.set_data(region, result);\n        });\n\n        this.set_data(region, entry);\n        return entry;\n    },\n\n    /**\n     * Get data from dataset.\n     */\n    get_data: function get_data(region, mode, resolution, extra_params) {\n        // Look for entry and return if it's a deferred or if data available is compatible with mode.\n        var entry = this.get_elt(region);\n        if (entry && (_util2.default.is_deferred(entry) || this.get(\"data_mode_compatible\")(entry, mode))) {\n            return entry;\n        }\n\n        //\n        // Look in cache for data that can be used.\n        // TODO: this logic could be improved if the visualization knew whether\n        // the data was \"index\" or \"data.\"\n        //\n        var key_ary = this.get(\"key_ary\");\n\n        var obj_cache = this.get(\"obj_cache\");\n        var entry_region;\n        var is_subregion;\n        for (var i = 0; i < key_ary.length; i++) {\n            entry_region = key_ary[i];\n\n            if (entry_region.contains(region)) {\n                is_subregion = true;\n\n                // This entry has data in the requested range. Return if data\n                // is compatible and can be subsetted.\n                entry = obj_cache[entry_region.toString()];\n                if (_util2.default.is_deferred(entry) || this.get(\"data_mode_compatible\")(entry, mode) && this.get(\"can_subset\")(entry)) {\n                    this.move_key_to_end(entry_region, i);\n\n                    // If there's data, subset it.\n                    if (!_util2.default.is_deferred(entry)) {\n                        var subset_entry = this.subset_entry(entry, region);\n                        this.set_data(region, subset_entry);\n                        entry = subset_entry;\n                    }\n\n                    return entry;\n                }\n            }\n        }\n\n        // FIXME: There _may_ be instances where region is a subregion of another entry but cannot be\n        // subsetted. For these cases, do not increase length because region will never be found (and\n        // an infinite loop will occur.)\n        // If needed, extend region to make it minimum size.\n        if (!is_subregion && region.length() < this.attributes.min_region_size) {\n            // IDEA: alternative heuristic is to find adjacent cache entry to region and use that to extend.\n            // This would prevent bad extensions when zooming in/out while still preserving the behavior\n            // below.\n\n            // Use copy of region to avoid changing actual region.\n            region = region.copy();\n\n            // Use heuristic to extend region: extend relative to last data request.\n            var last_request = this.most_recently_added();\n            if (!last_request || region.get(\"start\") > last_request.get(\"start\")) {\n                // This request is after the last request, so extend right.\n                region.set(\"end\", region.get(\"start\") + this.attributes.min_region_size);\n            } else {\n                // This request is after the last request, so extend left.\n                region.set(\"start\", region.get(\"end\") - this.attributes.min_region_size);\n            }\n\n            // Trim region to avoid invalid coordinates.\n            region.set(\"genome\", this.attributes.genome);\n            region.trim();\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Alias for set_elt for readbility.\n     */\n    set_data: function set_data(region, entry) {\n        this.set_elt(region, entry);\n    },\n\n    /** \"Deep\" data request; used as a parameter for DataManager.get_more_data() */\n    DEEP_DATA_REQ: \"deep\",\n\n    /** \"Broad\" data request; used as a parameter for DataManager.get_more_data() */\n    BROAD_DATA_REQ: \"breadth\",\n\n    /**\n     * Gets more data for a region using either a depth-first or a breadth-first approach.\n     */\n    get_more_data: function get_more_data(region, mode, resolution, extra_params, req_type) {\n        var cur_data = this._mark_stale(region);\n        if (!(cur_data && this.get(\"data_mode_compatible\")(cur_data, mode))) {\n            console.log(\"ERROR: problem with getting more data: current data is not compatible\");\n            return;\n        }\n\n        //\n        // Set parameters based on request type.\n        //\n        var query_low = region.get(\"start\");\n        if (req_type === this.DEEP_DATA_REQ) {\n            // Use same interval but set start_val to skip data that's already in cur_data.\n            $.extend(extra_params, {\n                start_val: cur_data.data.length + 1\n            });\n        } else if (req_type === this.BROAD_DATA_REQ) {\n            // To get past an area of extreme feature depth, set query low to be after either\n            // (a) the maximum high or HACK/FIXME (b) the end of the last feature returned.\n            query_low = (cur_data.max_high ? cur_data.max_high : cur_data.data[cur_data.data.length - 1][2]) + 1;\n        }\n        var query_region = region.copy().set(\"start\", query_low);\n\n        //\n        // Get additional data, append to current data, and set new data. Use a custom deferred object\n        // to signal when new data is available.\n        //\n        var data_manager = this;\n\n        var new_data_request = this.load_data(query_region, mode, resolution, extra_params);\n\n        var new_data_available = $.Deferred();\n        // load_data sets cache to new_data_request, but use custom deferred object so that signal and data\n        // is all data, not just new data.\n        this.set_data(region, new_data_available);\n        $.when(new_data_request).then(function (result) {\n            // Update data and message.\n            if (result.data) {\n                result.data = cur_data.data.concat(result.data);\n                if (result.max_low) {\n                    result.max_low = cur_data.max_low;\n                }\n                if (result.message) {\n                    // HACK: replace number in message with current data length. Works but is ugly.\n                    result.message = result.message.replace(/[0-9]+/, result.data.length);\n                }\n            }\n            data_manager.set_data(region, result);\n            new_data_available.resolve(result);\n        });\n        return new_data_available;\n    },\n\n    /**\n     * Returns true if more detailed data can be obtained for entry.\n     */\n    can_get_more_detailed_data: function can_get_more_detailed_data(region) {\n        var cur_data = this.get_elt(region);\n\n        // Can only get more detailed data for bigwig data that has less than 8000 data points.\n        // Summary tree returns *way* too much data, and 8000 data points ~ 500KB.\n        return cur_data.dataset_type === \"bigwig\" && cur_data.data.length < 8000;\n    },\n\n    /**\n     * Returns more detailed data for an entry.\n     */\n    get_more_detailed_data: function get_more_detailed_data(region, mode, resolution, detail_multiplier, extra_params) {\n        // Mark current entry as stale.\n        var cur_data = this._mark_stale(region);\n        if (!cur_data) {\n            console.log(\"ERROR getting more detailed data: no current data\");\n            return;\n        }\n\n        if (!extra_params) {\n            extra_params = {};\n        }\n\n        // Use additional parameters to get more detailed data.\n        if (cur_data.dataset_type === \"bigwig\") {\n            // FIXME: constant should go somewhere.\n            extra_params.num_samples = 1000 * detail_multiplier;\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Marks cache data as stale.\n     */\n    _mark_stale: function _mark_stale(region) {\n        var entry = this.get_elt(region);\n        if (!entry) {\n            console.log(\"ERROR: no data to mark as stale: \", this.get(\"dataset\"), region.toString());\n        }\n        entry.stale = true;\n        return entry;\n    },\n\n    /**\n     * Returns an array of data with each entry representing one chromosome/contig\n     * of data or, if data is not available, returns a Deferred that resolves to the\n     * data when it becomes available.\n     */\n    get_genome_wide_data: function get_genome_wide_data(genome) {\n        // -- Get all data. --\n\n        var self = this;\n\n        var all_data_available = true;\n\n        var //  Map chromosome info into genome data.\n        gw_data = _.map(genome.get(\"chroms_info\").chrom_info, function (chrom_info) {\n            var chrom_data = self.get_elt(new GenomeRegion({\n                chrom: chrom_info.chrom,\n                start: 0,\n                end: chrom_info.len\n            }));\n\n            // Set flag if data is not available.\n            if (!chrom_data) {\n                all_data_available = false;\n            }\n\n            return chrom_data;\n        });\n\n        // -- If all data is available, return it. --\n        if (all_data_available) {\n            return gw_data;\n        }\n\n        // -- All data is not available, so load from server. --\n\n        var deferred = $.Deferred();\n        $.getJSON(this.get(\"dataset\").url(), { data_type: \"genome_data\" }, function (genome_wide_data) {\n            self.add_data(genome_wide_data.data);\n            deferred.resolve(genome_wide_data.data);\n        });\n\n        return deferred;\n    },\n\n    /**\n     * Returns entry with only data in the subregion.\n     */\n    subset_entry: function subset_entry(entry, subregion) {\n        // Dictionary from entry type to function for subsetting data.\n        var subset_fns = {\n            bigwig: function bigwig(data, subregion) {\n                return _.filter(data, function (data_point) {\n                    return data_point[0] >= subregion.get(\"start\") && data_point[0] <= subregion.get(\"end\");\n                });\n            },\n            refseq: function refseq(data, subregion) {\n                var seq_start = subregion.get(\"start\") - entry.region.get(\"start\");\n                return entry.data.slice(seq_start, seq_start + subregion.length());\n            }\n        };\n\n        // Subset entry if there is a function for subsetting and regions are not the same.\n        var subregion_data = entry.data;\n        if (!entry.region.same(subregion) && entry.dataset_type in subset_fns) {\n            subregion_data = subset_fns[entry.dataset_type](entry.data, subregion);\n        }\n\n        // Return entry with subregion's data.\n        return {\n            region: subregion,\n            data: subregion_data,\n            dataset_type: entry.dataset_type\n        };\n    }\n});\n\nvar GenomeReferenceDataManager = GenomeDataManager.extend({\n    initialize: function initialize(options) {\n        // Use generic object in place of dataset and set urlRoot to fetch data.\n        var dataset_placeholder = new Backbone.Model();\n        dataset_placeholder.urlRoot = options.data_url;\n        this.set(\"dataset\", dataset_placeholder);\n    },\n\n    load_data: function load_data(region, mode, resolution, extra_params) {\n        // Fetch data if region is not too large.\n        return region.length() <= 100000 ? GenomeDataManager.prototype.load_data.call(this, region, mode, resolution, extra_params) : { data: null, region: region };\n    }\n});\n\n/**\n * A genome build.\n */\nvar Genome = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        key: null,\n        chroms_info: null\n    },\n\n    initialize: function initialize(options) {\n        this.id = options.dbkey;\n    },\n\n    /**\n     * Shorthand for getting to chromosome information.\n     */\n    get_chroms_info: function get_chroms_info() {\n        return this.attributes.chroms_info.chrom_info;\n    },\n\n    /**\n     * Returns a GenomeRegion object denoting a complete chromosome.\n     */\n    get_chrom_region: function get_chrom_region(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        var chrom_info = _.find(this.get_chroms_info(), function (chrom_info) {\n            return chrom_info.chrom === chr_name;\n        });\n        return new GenomeRegion({\n            chrom: chrom_info.chrom,\n            end: chrom_info.len\n        });\n    },\n\n    /** Returns the length of a chromosome. */\n    get_chrom_len: function get_chrom_len(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        return _.find(this.get_chroms_info(), function (chrom_info) {\n            return chrom_info.chrom === chr_name;\n        }).len;\n    }\n});\n\n/**\n * A genomic region.\n */\nvar GenomeRegion = Backbone.Model.extend({\n    defaults: {\n        chrom: null,\n        start: 0,\n        end: 0,\n        str_val: null,\n        genome: null\n    },\n\n    /**\n     * Returns true if this region is the same as a given region.\n     * It does not test the genome right now.\n     */\n    same: function same(region) {\n        return this.attributes.chrom === region.get(\"chrom\") && this.attributes.start === region.get(\"start\") && this.attributes.end === region.get(\"end\");\n    },\n\n    /**\n     * If from_str specified, use it to initialize attributes.\n     */\n    initialize: function initialize(options) {\n        if (options.from_str) {\n            var pieces = options.from_str.split(\":\");\n            var chrom = pieces[0];\n            var start_end = pieces[1].split(\"-\");\n            this.set({\n                chrom: chrom,\n                start: parseInt(start_end[0], 10),\n                end: parseInt(start_end[1], 10)\n            });\n        }\n\n        // Keep a copy of region's string value for fast lookup.\n        this.attributes.str_val = this.get(\"chrom\") + \":\" + this.get(\"start\") + \"-\" + this.get(\"end\");\n\n        // Set str_val on attribute change.\n        this.on(\"change\", function () {\n            this.attributes.str_val = this.get(\"chrom\") + \":\" + this.get(\"start\") + \"-\" + this.get(\"end\");\n        }, this);\n    },\n\n    copy: function copy() {\n        return new GenomeRegion({\n            chrom: this.get(\"chrom\"),\n            start: this.get(\"start\"),\n            end: this.get(\"end\")\n        });\n    },\n\n    length: function length() {\n        return this.get(\"end\") - this.get(\"start\");\n    },\n\n    /** Returns region in canonical form chrom:start-end */\n    toString: function toString() {\n        return this.attributes.str_val;\n    },\n\n    toJSON: function toJSON() {\n        return {\n            chrom: this.get(\"chrom\"),\n            start: this.get(\"start\"),\n            end: this.get(\"end\")\n        };\n    },\n\n    /**\n     * Compute the type of overlap between this region and another region. The overlap is computed relative to the given/second region;\n     * hence, OVERLAP_START indicates that the first region overlaps the start (but not the end) of the second region.\n     */\n    compute_overlap: function compute_overlap(a_region) {\n        var first_chrom = this.get(\"chrom\");\n        var second_chrom = a_region.get(\"chrom\");\n        var first_start = this.get(\"start\");\n        var second_start = a_region.get(\"start\");\n        var first_end = this.get(\"end\");\n        var second_end = a_region.get(\"end\");\n        var overlap;\n\n        // Compare chroms.\n        if (first_chrom && second_chrom && first_chrom !== second_chrom) {\n            return GenomeRegion.overlap_results.DIF_CHROMS;\n        }\n\n        // Compare regions.\n        if (first_start < second_start) {\n            if (first_end < second_start) {\n                overlap = GenomeRegion.overlap_results.BEFORE;\n            } else if (first_end < second_end) {\n                overlap = GenomeRegion.overlap_results.OVERLAP_START;\n            } else {\n                // first_end >= second_end\n                overlap = GenomeRegion.overlap_results.CONTAINS;\n            }\n        } else if (first_start > second_start) {\n            if (first_start > second_end) {\n                overlap = GenomeRegion.overlap_results.AFTER;\n            } else if (first_end <= second_end) {\n                overlap = GenomeRegion.overlap_results.CONTAINED_BY;\n            } else {\n                overlap = GenomeRegion.overlap_results.OVERLAP_END;\n            }\n        } else {\n            // first_start === second_start\n            overlap = first_end >= second_end ? GenomeRegion.overlap_results.CONTAINS : GenomeRegion.overlap_results.CONTAINED_BY;\n        }\n\n        return overlap;\n    },\n\n    /**\n     * Trim a region to match genome's constraints.\n     */\n    trim: function trim(genome) {\n        // Assume that all chromosome/contigs start at 0.\n        if (this.attributes.start < 0) {\n            this.attributes.start = 0;\n        }\n\n        // Only try to trim the end if genome is set.\n        if (this.attributes.genome) {\n            var chrom_len = this.attributes.genome.get_chrom_len(this.attributes.chrom);\n            if (this.attributes.end > chrom_len) {\n                this.attributes.end = chrom_len - 1;\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * Returns true if this region contains a given region.\n     */\n    contains: function contains(a_region) {\n        return this.compute_overlap(a_region) === GenomeRegion.overlap_results.CONTAINS;\n    },\n\n    /**\n     * Returns true if regions overlap.\n     */\n    overlaps: function overlaps(a_region) {\n        return _.intersection([this.compute_overlap(a_region)], [GenomeRegion.overlap_results.DIF_CHROMS, GenomeRegion.overlap_results.BEFORE, GenomeRegion.overlap_results.AFTER]).length === 0;\n    }\n}, {\n    overlap_results: {\n        DIF_CHROMS: 1000,\n        BEFORE: 1001,\n        CONTAINS: 1002,\n        OVERLAP_START: 1003,\n        OVERLAP_END: 1004,\n        CONTAINED_BY: 1005,\n        AFTER: 1006\n    }\n});\n\nvar GenomeRegionCollection = Backbone.Collection.extend({\n    model: GenomeRegion\n});\n\n/**\n * A genome browser bookmark.\n */\nvar BrowserBookmark = Backbone.Model.extend({\n    defaults: {\n        region: null,\n        note: \"\"\n    },\n\n    initialize: function initialize(options) {\n        this.set(\"region\", new GenomeRegion(options.region));\n    }\n});\n\n/**\n * Bookmarks collection.\n */\nvar BrowserBookmarkCollection = Backbone.Collection.extend({\n    model: BrowserBookmark\n});\n\n/**\n * A track of data in a genome visualization.\n */\n// TODO: rename to Track and merge with Trackster's Track object.\nvar BackboneTrack = Backbone.Model.extend(CustomToJSON).extend({\n    defaults: {\n        mode: \"Auto\"\n    },\n\n    initialize: function initialize(options) {\n        this.set(\"dataset\", new _data2.default.Dataset(options.dataset));\n\n        // -- Set up config settings. --\n        var models = [{\n            key: \"name\",\n            default_value: this.get(\"dataset\").get(\"name\")\n        }, { key: \"color\" }, {\n            key: \"min_value\",\n            label: \"Min Value\",\n            type: \"float\",\n            default_value: 0\n        }, {\n            key: \"max_value\",\n            label: \"Max Value\",\n            type: \"float\",\n            default_value: 1\n        }];\n\n        this.set(\"config\", _config2.default.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n        // -- Set up data manager. --\n        var preloaded_data = this.get(\"preloaded_data\");\n        if (preloaded_data) {\n            preloaded_data = preloaded_data.data;\n        } else {\n            preloaded_data = [];\n        }\n        this.set(\"data_manager\", new GenomeDataManager({\n            dataset: this.get(\"dataset\"),\n            init_data: preloaded_data\n        }));\n    }\n}, {\n    // This definition matches that produced by to_dict() methods in tracks.js\n    to_json_keys: [\"track_type\", \"dataset\", \"prefs\", \"mode\", \"filters\", \"tool_state\"],\n    to_json_mappers: {\n        prefs: function prefs(p, self) {\n            if (_.size(p) === 0) {\n                p = {\n                    name: self.get(\"config\").get(\"name\").get(\"value\"),\n                    color: self.get(\"config\").get(\"color\").get(\"value\")\n                };\n            }\n            return p;\n        },\n        dataset: function dataset(d) {\n            return {\n                id: d.id,\n                hda_ldda: d.get(\"hda_ldda\")\n            };\n        }\n    }\n});\n\nvar BackboneTrackCollection = Backbone.Collection.extend({\n    model: BackboneTrack\n});\n\n/**\n * A visualization.\n */\nvar Visualization = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        type: \"\"\n    },\n\n    urlRoot: Galaxy.root + \"api/visualizations\",\n\n    /**\n     * POSTs visualization's JSON to its URL using the parameter 'vis_json'\n     * Note: This is necessary because (a) Galaxy requires keyword args and\n     * (b) Galaxy does not handle PUT now.\n     */\n    save: function save() {\n        return $.ajax({\n            url: this.url(),\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                vis_json: JSON.stringify(this)\n            }\n        });\n    }\n});\n\n/**\n * A visualization of genome data.\n */\nvar GenomeVisualization = Visualization.extend(CustomToJSON).extend({\n    defaults: _.extend({}, Visualization.prototype.defaults, {\n        dbkey: \"\",\n        drawables: null,\n        bookmarks: null,\n        viewport: null\n    }),\n\n    initialize: function initialize(options) {\n        // Replace drawables with tracks.\n        this.set(\"drawables\", new BackboneTrackCollection(options.tracks));\n\n        var models = [];\n        this.set(\"config\", _config2.default.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n        // Clear track and data definitions to avoid storing large objects.\n        this.unset(\"tracks\");\n        this.get(\"drawables\").each(function (d) {\n            d.unset(\"preloaded_data\");\n        });\n    },\n\n    /**\n     * Add a track or array of tracks to the visualization.\n     */\n    add_tracks: function add_tracks(tracks) {\n        this.get(\"drawables\").add(tracks);\n    }\n}, {\n    // This definition matches that produced by to_dict() methods in tracks.js\n    to_json_keys: [\"view\", \"viewport\", \"bookmarks\"],\n\n    to_json_mappers: {\n        view: function view(dummy, self) {\n            return {\n                obj_type: \"View\",\n                prefs: {\n                    name: self.get(\"title\"),\n                    content_visible: true\n                },\n                drawables: self.get(\"drawables\")\n            };\n        }\n    }\n});\n\n/**\n * -- Routers --\n */\n\n/**\n * Router for track browser.\n */\nvar TrackBrowserRouter = Backbone.Router.extend({\n    initialize: function initialize(options) {\n        this.view = options.view;\n\n        // Can't put regular expression in routes dictionary.\n        // NOTE: parentheses are used to denote parameters returned to callback.\n        this.route(/([\\w]+)$/, \"change_location\");\n        this.route(/([\\w\\+]+\\:[\\d,]+-[\\d,]+)$/, \"change_location\");\n\n        // Handle navigate events from view.\n        var self = this;\n        self.view.on(\"navigate\", function (new_loc) {\n            self.navigate(new_loc);\n        });\n    },\n\n    change_location: function change_location(new_loc) {\n        this.view.go_to(new_loc);\n    }\n});\n\nexports.default = {\n    BackboneTrack: BackboneTrack,\n    BrowserBookmark: BrowserBookmark,\n    BrowserBookmarkCollection: BrowserBookmarkCollection,\n    Cache: Cache,\n    CanvasManager: CanvasManager,\n    Genome: Genome,\n    GenomeDataManager: GenomeDataManager,\n    GenomeRegion: GenomeRegion,\n    GenomeRegionCollection: GenomeRegionCollection,\n    GenomeVisualization: GenomeVisualization,\n    GenomeReferenceDataManager: GenomeReferenceDataManager,\n    TrackBrowserRouter: TrackBrowserRouter,\n    Visualization: Visualization,\n    select_datasets: select_datasets\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(2)))\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/**\n * Stringifies a number adding commas for digit grouping as per North America.\n */\nfunction commatize(number) {\n    number += \"\"; // Convert to string\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(number)) {\n        number = number.replace(rgx, \"$1\" + \",\" + \"$2\");\n    }\n    return number;\n}\n\n/**\n * Helper to determine if object is jQuery deferred.\n */\nvar is_deferred = function is_deferred(d) {\n    return \"promise\" in d;\n};\n\n/**\n * Implementation of a server-state based deferred. Server is repeatedly polled, and when\n * condition is met, deferred is resolved.\n */\nvar ServerStateDeferred = Backbone.Model.extend({\n    defaults: {\n        ajax_settings: {},\n        interval: 1000,\n        success_fn: function success_fn(result) {\n            return true;\n        }\n    },\n\n    /**\n     * Returns a deferred that resolves when success function returns true.\n     */\n    go: function go() {\n        var deferred = $.Deferred();\n        var self = this;\n        var ajax_settings = self.get(\"ajax_settings\");\n        var success_fn = self.get(\"success_fn\");\n        var interval = self.get(\"interval\");\n\n        var _go = function _go() {\n            $.ajax(ajax_settings).success(function (result) {\n                if (success_fn(result)) {\n                    // Result is good, so resolve.\n                    deferred.resolve(result);\n                } else {\n                    // Result not good, try again.\n                    setTimeout(_go, interval);\n                }\n            });\n        };\n\n        _go();\n        return deferred;\n    }\n});\n\n/**\n * Returns a random color in hexadecimal format that is sufficiently different from a single color\n * or set of colors.\n * @param colors a color or list of colors in the format '#RRGGBB'\n */\nvar get_random_color = function get_random_color(colors) {\n    // Default for colors is white.\n    if (!colors) {\n        colors = \"#ffffff\";\n    }\n\n    // If needed, create list of colors.\n    if (typeof colors === \"string\") {\n        colors = [colors];\n    }\n\n    // Convert colors to numbers.\n    for (var i = 0; i < colors.length; i++) {\n        colors[i] = parseInt(colors[i].slice(1), 16);\n    }\n\n    // -- Perceived brightness and difference formulas are from\n    // -- http://www.w3.org/WAI/ER/WD-AERT/#color-contrast\n\n    // Compute perceived color brightness (based on RGB-YIQ transformation):\n    var brightness = function brightness(r, g, b) {\n        return (r * 299 + g * 587 + b * 114) / 1000;\n    };\n\n    // Compute color difference:\n    var difference = function difference(r1, g1, b1, r2, g2, b2) {\n        return Math.max(r1, r2) - Math.min(r1, r2) + (Math.max(g1, g2) - Math.min(g1, g2)) + (Math.max(b1, b2) - Math.min(b1, b2));\n    };\n\n    // Create new random color.\n    var new_color;\n\n    var nr;\n    var ng;\n    var nb;\n    var other_color;\n    var or;\n    var og;\n    var ob;\n    var n_brightness;\n    var o_brightness;\n    var diff;\n    var ok = false;\n    var num_tries = 0;\n    do {\n        // New color is never white b/c random in [0,1)\n        new_color = Math.round(Math.random() * 0xffffff);\n        nr = (new_color & 0xff0000) >> 16;\n        ng = (new_color & 0x00ff00) >> 8;\n        nb = new_color & 0x0000ff;\n        n_brightness = brightness(nr, ng, nb);\n        ok = true;\n        for (i = 0; i < colors.length; i++) {\n            other_color = colors[i];\n            or = (other_color & 0xff0000) >> 16;\n            og = (other_color & 0x00ff00) >> 8;\n            ob = other_color & 0x0000ff;\n            o_brightness = brightness(or, og, ob);\n            diff = difference(nr, ng, nb, or, og, ob);\n            // These thresholds may need to be adjusted. Brightness difference range is 125;\n            // color difference range is 500.\n            if (Math.abs(n_brightness - o_brightness) < 40 || diff < 200) {\n                ok = false;\n                break;\n            }\n        }\n\n        num_tries++;\n    } while (!ok && num_tries <= 10);\n\n    // Add 0x1000000 to left pad number with 0s.\n    return \"#\" + (0x1000000 + new_color).toString(16).substr(1, 6);\n};\n\nexports.default = {\n    commatize: commatize,\n    is_deferred: is_deferred,\n    ServerStateDeferred: ServerStateDeferred,\n    get_random_color: get_random_color\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 9 */,\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _uiFrames = __webpack_require__(16);\n\nvar _uiFrames2 = _interopRequireDefault(_uiFrames);\n\nvar _iconButton = __webpack_require__(14);\n\nvar _iconButton2 = _interopRequireDefault(_iconButton);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Dataset metedata.\n */\nvar DatasetMetadata = Backbone.Model.extend({});\n\n/**\n * A dataset. In Galaxy, datasets are associated with a history, so\n * this object is also known as a HistoryDatasetAssociation.\n */\n// Additional dependencies: jQuery, underscore.\nvar Dataset = Backbone.Model.extend({\n    defaults: {\n        id: \"\",\n        type: \"\",\n        name: \"\",\n        hda_ldda: \"hda\",\n        metadata: null\n    },\n\n    initialize: function initialize() {\n        // Metadata can be passed in as a model or a set of attributes; if it's\n        // already a model, there's no need to set metadata.\n        if (!this.get(\"metadata\")) {\n            this._set_metadata();\n        }\n\n        // Update metadata on change.\n        this.on(\"change\", this._set_metadata, this);\n    },\n\n    _set_metadata: function _set_metadata() {\n        var metadata = new DatasetMetadata();\n\n        // Move metadata from dataset attributes to metadata object.\n        _.each(_.keys(this.attributes), function (k) {\n            if (k.indexOf(\"metadata_\") === 0) {\n                // Found metadata.\n                var new_key = k.split(\"metadata_\")[1];\n                metadata.set(new_key, this.attributes[k]);\n                delete this.attributes[k];\n            }\n        }, this);\n\n        // Because this is an internal change, silence it.\n        this.set(\"metadata\", metadata, { silent: true });\n    },\n\n    /**\n     * Returns dataset metadata for a given attribute.\n     */\n    get_metadata: function get_metadata(attribute) {\n        return this.attributes.metadata.get(attribute);\n    },\n\n    urlRoot: Galaxy.root + \"api/datasets\"\n});\n\n/**\n * A tabular dataset. This object extends dataset to provide incremental chunked data.\n */\nvar TabularDataset = Dataset.extend({\n    defaults: _.extend({}, Dataset.prototype.defaults, {\n        chunk_url: null,\n        first_data_chunk: null,\n        offset: 0,\n        at_eof: false\n    }),\n\n    initialize: function initialize(options) {\n        Dataset.prototype.initialize.call(this);\n\n        // If first data chunk is available, next chunk is 1.\n        if (this.attributes.first_data_chunk) {\n            this.attributes.offset = this.attributes.first_data_chunk.offset;\n        }\n        this.attributes.chunk_url = Galaxy.root + \"dataset/display?dataset_id=\" + this.id;\n        this.attributes.url_viz = Galaxy.root + \"visualization\";\n    },\n\n    /**\n     * Returns a jQuery Deferred object that resolves to the next data chunk or null if at EOF.\n     */\n    get_next_chunk: function get_next_chunk() {\n        // If already at end of file, do nothing.\n        if (this.attributes.at_eof) {\n            return null;\n        }\n\n        // Get next chunk.\n        var self = this;\n\n        var next_chunk = $.Deferred();\n        $.getJSON(this.attributes.chunk_url, {\n            offset: self.attributes.offset\n        }).success(function (chunk) {\n            var rval;\n            if (chunk.ck_data !== \"\") {\n                // Found chunk.\n                rval = chunk;\n                self.attributes.offset = chunk.offset;\n            } else {\n                // At EOF.\n                self.attributes.at_eof = true;\n                rval = null;\n            }\n            next_chunk.resolve(rval);\n        });\n\n        return next_chunk;\n    }\n});\n\nvar DatasetCollection = Backbone.Collection.extend({\n    model: Dataset\n});\n\n/**\n * Provides a base for table-based, dynamic view of a tabular dataset.\n * Do not instantiate directly; use either TopLevelTabularDatasetChunkedView\n * or EmbeddedTabularDatasetChunkedView.\n */\nvar TabularDatasetChunkedView = Backbone.View.extend({\n    /**\n     * Initialize view and, importantly, set a scroll element.\n     */\n    initialize: function initialize(options) {\n        // Row count for rendering.\n        this.row_count = 0;\n        this.loading_chunk = false;\n\n        // load trackster button\n        new TabularButtonTracksterView({\n            model: options.model,\n            $el: this.$el\n        });\n    },\n\n    expand_to_container: function expand_to_container() {\n        if (this.$el.height() < this.scroll_elt.height()) {\n            this.attempt_to_fetch();\n        }\n    },\n\n    attempt_to_fetch: function attempt_to_fetch(func) {\n        var self = this;\n        if (!this.loading_chunk && this.scrolled_to_bottom()) {\n            this.loading_chunk = true;\n            this.loading_indicator.show();\n            $.when(self.model.get_next_chunk()).then(function (result) {\n                if (result) {\n                    self._renderChunk(result);\n                    self.loading_chunk = false;\n                }\n                self.loading_indicator.hide();\n                self.expand_to_container();\n            });\n        }\n    },\n\n    render: function render() {\n        // Add loading indicator.\n        this.loading_indicator = $(\"<div/>\").attr(\"id\", \"loading_indicator\");\n        this.$el.append(this.loading_indicator);\n\n        // Add data table and header.\n        var data_table = $(\"<table/>\").attr({\n            id: \"content_table\",\n            cellpadding: 0\n        });\n        this.$el.append(data_table);\n        var column_names = this.model.get_metadata(\"column_names\");\n        var header_container = $(\"<thead/>\").appendTo(data_table);\n        var header_row = $(\"<tr/>\").appendTo(header_container);\n        if (column_names) {\n            header_row.append(\"<th>\" + column_names.join(\"</th><th>\") + \"</th>\");\n        } else {\n            for (var j = 1; j <= this.model.get_metadata(\"columns\"); j++) {\n                header_row.append(\"<th>\" + j + \"</th>\");\n            }\n        }\n\n        // Render first chunk.\n        var self = this;\n\n        var first_chunk = this.model.get(\"first_data_chunk\");\n        if (first_chunk) {\n            // First chunk is bootstrapped, so render now.\n            this._renderChunk(first_chunk);\n        } else {\n            // No bootstrapping, so get first chunk and then render.\n            $.when(self.model.get_next_chunk()).then(function (result) {\n                self._renderChunk(result);\n            });\n        }\n\n        // -- Show new chunks during scrolling. --\n\n        // Set up chunk loading when scrolling using the scrolling element.\n        this.scroll_elt.scroll(function () {\n            self.attempt_to_fetch();\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function scrolled_to_bottom() {\n        return false;\n    },\n\n    // -- Helper functions. --\n\n    _renderCell: function _renderCell(cell_contents, index, colspan) {\n        var $cell = $(\"<td>\").text(cell_contents);\n        var column_types = this.model.get_metadata(\"column_types\");\n        if (colspan !== undefined) {\n            $cell.attr(\"colspan\", colspan).addClass(\"stringalign\");\n        } else if (column_types) {\n            if (index < column_types.length) {\n                if (column_types[index] === \"str\" || column_types[index] === \"list\") {\n                    /* Left align all str columns, right align the rest */\n                    $cell.addClass(\"stringalign\");\n                }\n            }\n        }\n        return $cell;\n    },\n\n    _renderRow: function _renderRow(line) {\n        // Check length of cells to ensure this is a complete row.\n        var cells = line.split(\"\\t\");\n\n        var row = $(\"<tr>\");\n        var num_columns = this.model.get_metadata(\"columns\");\n\n        if (this.row_count % 2 !== 0) {\n            row.addClass(\"dark_row\");\n        }\n\n        if (cells.length === num_columns) {\n            _.each(cells, function (cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n        } else if (cells.length > num_columns) {\n            // SAM file or like format with optional metadata included.\n            _.each(cells.slice(0, num_columns - 1), function (cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n            row.append(this._renderCell(cells.slice(num_columns - 1).join(\"\\t\"), num_columns - 1));\n        } else if (cells.length === 1) {\n            // Comment line, just return the one cell.\n            row.append(this._renderCell(line, 0, num_columns));\n        } else {\n            // cells.length is greater than one, but less than num_columns.  Render cells and pad tds.\n            // Possibly a SAM file or like format with optional metadata missing.\n            // Could also be a tabular file with a line with missing columns.\n            _.each(cells, function (cell_contents, index) {\n                row.append(this._renderCell(cell_contents, index));\n            }, this);\n            _.each(_.range(num_columns - cells.length), function () {\n                row.append($(\"<td>\"));\n            });\n        }\n\n        this.row_count++;\n        return row;\n    },\n\n    _renderChunk: function _renderChunk(chunk) {\n        var data_table = this.$el.find(\"table\");\n        _.each(chunk.ck_data.split(\"\\n\"), function (line, index) {\n            if (line !== \"\") {\n                data_table.append(this._renderRow(line));\n            }\n        }, this);\n    }\n});\n\n/**\n * Tabular view that is placed at the top level of page. Scrolling occurs\n * view top-level elements outside of view.\n */\nvar TopLevelTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function initialize(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Scrolling happens in top-level elements.\n        var scroll_elt = _.find(this.$el.parents(), function (p) {\n            return $(p).css(\"overflow\") === \"auto\";\n        });\n\n        // If no scrolling element found, use window.\n        if (!scroll_elt) {\n            scroll_elt = window;\n        }\n\n        // Wrap scrolling element for easy access.\n        this.scroll_elt = $(scroll_elt);\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function scrolled_to_bottom() {\n        return this.$el.height() - this.scroll_elt.scrollTop() - this.scroll_elt.height() <= 0;\n    }\n});\n\n/**\n * Tabular view tnat is embedded in a page. Scrolling occurs in view's el.\n */\nvar EmbeddedTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function initialize(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Because view is embedded, set up div to do scrolling.\n        this.scroll_elt = this.$el.css({\n            position: \"relative\",\n            overflow: \"scroll\",\n            height: options.height || \"500px\"\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function scrolled_to_bottom() {\n        return this.$el.scrollTop() + this.$el.innerHeight() >= this.el.scrollHeight;\n    }\n});\n\n/** Button for trackster visualization */\nvar TabularButtonTracksterView = Backbone.View.extend({\n    // gene region columns\n    col: {\n        chrom: null,\n        start: null,\n        end: null\n    },\n\n    // url for trackster\n    url_viz: null,\n\n    // dataset id\n    dataset_id: null,\n\n    // database key\n    genome_build: null,\n\n    // data type\n    file_ext: null,\n\n    // backbone initialize\n    initialize: function initialize(options) {\n        // check if environment is available\n        var Galaxy = parent.Galaxy;\n\n        // link galaxy modal or create one\n        if (Galaxy && Galaxy.modal) {\n            this.modal = Galaxy.modal;\n        }\n\n        // link galaxy frames\n        if (Galaxy && Galaxy.frame) {\n            this.frame = Galaxy.frame;\n        }\n\n        // check\n        if (!this.modal || !this.frame) {\n            return;\n        }\n\n        // model/metadata\n        var model = options.model;\n        var metadata = model.get(\"metadata\");\n\n        // check for datatype\n        if (!model.get(\"file_ext\")) {\n            return;\n        }\n\n        // get data type\n        this.file_ext = model.get(\"file_ext\");\n\n        // check for bed-file format\n        if (this.file_ext == \"bed\") {\n            // verify that metadata exists\n            if (metadata.get(\"chromCol\") && metadata.get(\"startCol\") && metadata.get(\"endCol\")) {\n                // read in columns\n                this.col.chrom = metadata.get(\"chromCol\") - 1;\n                this.col.start = metadata.get(\"startCol\") - 1;\n                this.col.end = metadata.get(\"endCol\") - 1;\n            } else {\n                console.log(\"TabularButtonTrackster : Bed-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check for vcf-file format\n        if (this.file_ext == \"vcf\") {\n            // search array\n            var search = function search(str, array) {\n                for (var j = 0; j < array.length; j++) {\n                    if (array[j].match(str)) return j;\n                }return -1;\n            };\n\n            // load\n\n\n            this.col.chrom = search(\"Chrom\", metadata.get(\"column_names\"));\n            this.col.start = search(\"Pos\", metadata.get(\"column_names\"));\n            this.col.end = null;\n\n            // verify that metadata exists\n            if (this.col.chrom == -1 || this.col.start == -1) {\n                console.log(\"TabularButtonTrackster : VCF-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check\n        if (this.col.chrom === undefined) {\n            return;\n        }\n\n        // get dataset id\n        if (model.id) {\n            this.dataset_id = model.id;\n        } else {\n            console.log(\"TabularButtonTrackster : Dataset identification is missing.\");\n            return;\n        }\n\n        // get url\n        if (model.get(\"url_viz\")) {\n            this.url_viz = model.get(\"url_viz\");\n        } else {\n            console.log(\"TabularButtonTrackster : Url for visualization controller is missing.\");\n            return;\n        }\n\n        // get genome_build / database key\n        if (model.get(\"genome_build\")) {\n            this.genome_build = model.get(\"genome_build\");\n        }\n\n        // create the icon\n        var btn_viz = new _iconButton2.default.IconButtonView({\n            model: new _iconButton2.default.IconButton({\n                title: \"Visualize\",\n                icon_class: \"chart_curve\",\n                id: \"btn_viz\"\n            })\n        });\n\n        // set element\n        this.setElement(options.$el);\n\n        // add to element\n        this.$el.append(btn_viz.render().$el);\n\n        // hide the button\n        this.hide();\n    },\n\n    /** Add event handlers */\n    events: {\n        \"mouseover tr\": \"show\",\n        mouseleave: \"hide\"\n    },\n\n    // show button\n    show: function show(e) {\n        var self = this;\n\n        // is numeric\n        function is_numeric(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        // check\n        if (this.col.chrom === null) return;\n\n        // get selected data line\n        var row = $(e.target).parent();\n\n        // verify that location has been found\n        var chrom = row.children().eq(this.col.chrom).html();\n        var start = row.children().eq(this.col.start).html();\n\n        // end is optional\n        var end = this.col.end ? row.children().eq(this.col.end).html() : start;\n\n        // double check location\n        if (!chrom.match(\"^#\") && chrom !== \"\" && is_numeric(start)) {\n            // get target gene region\n            var btn_viz_pars = {\n                dataset_id: this.dataset_id,\n                gene_region: chrom + \":\" + start + \"-\" + end\n            };\n\n            // get button position\n            var offset = row.offset();\n            var left = offset.left - 10;\n            var top = offset.top - $(window).scrollTop() + 3;\n\n            // update css\n            $(\"#btn_viz\").css({\n                position: \"fixed\",\n                top: top + \"px\",\n                left: left + \"px\"\n            });\n            $(\"#btn_viz\").off(\"click\");\n            $(\"#btn_viz\").click(function () {\n                self.frame.add({\n                    title: \"Trackster\",\n                    url: self.url_viz + \"/trackster?\" + $.param(btn_viz_pars)\n                });\n            });\n\n            // show the button\n            $(\"#btn_viz\").show();\n        } else {\n            // hide the button\n            $(\"#btn_viz\").hide();\n        }\n    },\n\n    /** hide button */\n    hide: function hide() {\n        this.$(\"#btn_viz\").hide();\n    }\n});\n\n// -- Utility functions. --\n\n/**\n * Create a model, attach it to a view, render view, and attach it to a parent element.\n */\nvar createModelAndView = function createModelAndView(model, view, model_config, parent_elt) {\n    // Create model, view.\n    var a_view = new view({\n        model: new model(model_config)\n    });\n\n    // Render view and add to parent element.\n    a_view.render();\n    if (parent_elt) {\n        parent_elt.append(a_view.$el);\n    }\n\n    return a_view;\n};\n\n/**\n * Create a tabular dataset chunked view (and requisite tabular dataset model)\n * and appends to parent_elt.\n */\nvar createTabularDatasetChunkedView = function createTabularDatasetChunkedView(options) {\n    // If no model, create and set model from dataset config.\n    if (!options.model) {\n        options.model = new TabularDataset(options.dataset_config);\n    }\n\n    var parent_elt = options.parent_elt;\n    var embedded = options.embedded;\n\n    // Clean up options so that only needed options are passed to view.\n    delete options.embedded;\n    delete options.parent_elt;\n    delete options.dataset_config;\n\n    // Create and set up view.\n    var view = embedded ? new EmbeddedTabularDatasetChunkedView(options) : new TopLevelTabularDatasetChunkedView(options);\n    view.render();\n\n    if (parent_elt) {\n        parent_elt.append(view.$el);\n        // If we're sticking this in another element, once it's appended check\n        // to make sure we've filled enough space.\n        // Without this, the scroll elements don't work.\n        view.expand_to_container();\n    }\n\n    return view;\n};\n\nexports.default = {\n    Dataset: Dataset,\n    TabularDataset: TabularDataset,\n    DatasetCollection: DatasetCollection,\n    TabularDatasetChunkedView: TabularDatasetChunkedView,\n    createTabularDatasetChunkedView: createTabularDatasetChunkedView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _util = __webpack_require__(8);\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _config = __webpack_require__(11);\n\nvar _config2 = _interopRequireDefault(_config);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * A configuration setting. Currently key is used as id.\n */\nvar ConfigSetting = Backbone.Model.extend({\n    initialize: function initialize(options) {\n        // Use key as id for now.\n        var key = this.get(\"key\");\n        this.set(\"id\", key);\n\n        // Set defaults based on key.\n        var defaults = _.find([{\n            key: \"name\",\n            label: \"Name\",\n            type: \"text\",\n            default_value: \"\"\n        }, {\n            key: \"color\",\n            label: \"Color\",\n            type: \"color\",\n            default_value: null\n        }, {\n            key: \"min_value\",\n            label: \"Min Value\",\n            type: \"float\",\n            default_value: null\n        }, {\n            key: \"max_value\",\n            label: \"Max Value\",\n            type: \"float\",\n            default_value: null\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 32,\n            hidden: true\n        }, {\n            key: \"pos_color\",\n            label: \"Positive Color\",\n            type: \"color\",\n            default_value: \"#FF8C00\"\n        }, {\n            key: \"neg_color\",\n            label: \"Negative Color\",\n            type: \"color\",\n            default_value: \"#4169E1\"\n        }, {\n            key: \"block_color\",\n            label: \"Block color\",\n            type: \"color\",\n            default_value: null\n        }, {\n            key: \"label_color\",\n            label: \"Label color\",\n            type: \"color\",\n            default_value: \"black\"\n        }, {\n            key: \"show_insertions\",\n            label: \"Show insertions\",\n            type: \"bool\",\n            default_value: false\n        }, {\n            key: \"show_counts\",\n            label: \"Show summary counts\",\n            type: \"bool\",\n            default_value: true\n        }, {\n            key: \"reverse_strand_color\",\n            label: \"Antisense strand color\",\n            type: \"color\",\n            default_value: null\n        }, {\n            key: \"show_differences\",\n            label: \"Show differences only\",\n            type: \"bool\",\n            default_value: true\n        }], function (s) {\n            return s.key === key;\n        });\n        if (defaults) {\n            this.set(_.extend({}, defaults, options));\n        }\n\n        if (this.get(\"value\") === undefined && this.get(\"default_value\") !== undefined) {\n            // Use default to set value (if present).\n            this.set_value(this.get(\"default_value\"));\n\n            // If no default value for color config, set random color.\n            if (!this.get(\"value\") && this.get(\"type\") === \"color\") {\n                // For color setting, set random color.\n                this.set(\"value\", _util2.default.get_random_color());\n            }\n        }\n    },\n\n    /**\n     * Cast and set value. This should be instead of\n     *  setting.set('value', new_value)\n     */\n    set_value: function set_value(value, options) {\n        var type = this.get(\"type\");\n\n        if (type === \"float\") {\n            value = parseFloat(value);\n        } else if (type === \"int\") {\n            value = parseInt(value, 10);\n        }\n        // TODO: handle casting from string to bool?\n\n        this.set({ value: value }, options);\n    }\n});\n\n/**\n * Collection of config settings.\n */\nvar ConfigSettingCollection = Backbone.Collection.extend({\n    model: ConfigSetting,\n\n    /**\n     * Save settings as a dictionary of key-value pairs.\n     * This function is needed for backwards compatibility.\n     */\n    to_key_value_dict: function to_key_value_dict() {\n        var rval = {};\n        this.each(function (setting) {\n            rval[setting.get(\"key\")] = setting.get(\"value\");\n        });\n\n        return rval;\n    },\n\n    /**\n     * Returns value for a given key. Returns undefined if there is no setting with the specified key.\n     */\n    get_value: function get_value(key) {\n        var s = this.get(key);\n        if (s) {\n            return s.get(\"value\");\n        }\n\n        return undefined;\n    },\n\n    /**\n     * Set value for a setting.\n     */\n    set_value: function set_value(key, value, options) {\n        var s = this.get(key);\n        if (s) {\n            return s.set_value(value, options);\n        }\n\n        return undefined;\n    },\n\n    /**\n     * Set default value for a setting.\n     */\n    set_default_value: function set_default_value(key, default_value) {\n        var s = this.get(key);\n        if (s) {\n            return s.set(\"default_value\", default_value);\n        }\n\n        return undefined;\n    }\n}, {\n    /**\n     * Utility function that creates a ConfigSettingsCollection from a set of models\n     * and a saved_values dictionary.\n     */\n    from_models_and_saved_values: function from_models_and_saved_values(models, saved_values) {\n        // If there are saved values, copy models and update with saved values.\n        if (saved_values) {\n            models = _.map(models, function (m) {\n                return _.extend({}, m, { value: saved_values[m.key] });\n            });\n        }\n\n        return new ConfigSettingCollection(models);\n    }\n});\n\n/**\n * Viewer for config settings collection.\n */\nvar ConfigSettingCollectionView = Backbone.View.extend({\n    className: \"config-settings-view\",\n\n    /**\n     * Renders form for editing configuration settings.\n     */\n    render: function render() {\n        var container = this.$el;\n\n        this.collection.each(function (param, index) {\n            // Hidden params have no representation in the form\n            if (param.get(\"hidden\")) {\n                return;\n            }\n\n            // Build row for param.\n            var id = \"param_\" + index;\n\n            var type = param.get(\"type\");\n            var value = param.get(\"value\");\n            var row = $(\"<div class='form-row' />\").appendTo(container);\n            row.append($(\"<label />\").attr(\"for\", id).text(param.get(\"label\") + \":\"));\n            // Draw parameter as checkbox\n            if (type === \"bool\") {\n                row.append($('<input type=\"checkbox\" />').attr(\"id\", id).attr(\"name\", id).attr(\"checked\", value));\n            } else if (type === \"text\") {\n                // Draw parameter as textbox\n                row.append($('<input type=\"text\"/>').attr(\"id\", id).val(value).click(function () {\n                    $(this).select();\n                }));\n            } else if (type === \"select\") {\n                // Draw parameter as select area\n                var select = $(\"<select />\").attr(\"id\", id);\n                _.each(param.get(\"options\"), function (option) {\n                    $(\"<option/>\").text(option.label).attr(\"value\", option.value).appendTo(select);\n                });\n                select.val(value);\n                row.append(select);\n            } else if (type === \"color\") {\n                // Draw parameter as color picker\n                var container_div = $(\"<div/>\").appendTo(row);\n\n                var input = $(\"<input />\").attr(\"id\", id).attr(\"name\", id).val(value).css(\"float\", \"left\").appendTo(container_div).click(function (e) {\n                    // Hide other pickers.\n                    $(\".tooltip\").removeClass(\"in\");\n\n                    // Show input's color picker.\n                    var tip = $(this).siblings(\".tooltip\").addClass(\"in\");\n                    tip.css({\n                        // left: $(this).position().left + ( $(input).width() / 2 ) - 60,\n                        // top: $(this).position().top + $(this.height)\n                        left: $(this).position().left + $(this).width() + 5,\n                        top: $(this).position().top - $(tip).height() / 2 + $(this).height() / 2\n                    }).show();\n\n                    // Click management:\n\n                    // Keep showing tip if clicking in tip.\n                    tip.click(function (e) {\n                        e.stopPropagation();\n                    });\n\n                    // Hide tip if clicking outside of tip.\n                    $(document).bind(\"click.color-picker\", function () {\n                        tip.hide();\n                        $(document).unbind(\"click.color-picker\");\n                    });\n\n                    // No propagation to avoid triggering document click (and tip hiding) above.\n                    e.stopPropagation();\n                });\n\n                var // Icon for setting a new random color; behavior set below.\n                new_color_icon = $(\"<a href='javascript:void(0)'/>\").addClass(\"icon-button arrow-circle\").appendTo(container_div).attr(\"title\", \"Set new random color\").tooltip();\n\n                var // Color picker in tool tip style.\n                tip = $(\"<div class='tooltip right' style='position: absolute;' />\").appendTo(container_div).hide();\n\n                var // Inner div for padding purposes\n                tip_inner = $(\"<div class='tooltip-inner' style='text-align: inherit'></div>\").appendTo(tip);\n\n                var tip_arrow = $(\"<div class='tooltip-arrow'></div>\").appendTo(tip);\n\n                var farb_obj = $.farbtastic(tip_inner, {\n                    width: 100,\n                    height: 100,\n                    callback: input,\n                    color: value\n                });\n\n                // Clear floating.\n                container_div.append($(\"<div/>\").css(\"clear\", \"both\"));\n\n                // Use function to fix farb_obj value.\n                (function (fixed_farb_obj) {\n                    new_color_icon.click(function () {\n                        fixed_farb_obj.setColor(_util2.default.get_random_color());\n                    });\n                })(farb_obj);\n            } else {\n                row.append($(\"<input />\").attr(\"id\", id).attr(\"name\", id).val(value));\n            }\n            // Help text\n            if (param.help) {\n                row.append($(\"<div class='help'/>\").text(param.help));\n            }\n        });\n\n        return this;\n    },\n\n    /**\n     * Render view in modal.\n     */\n    render_in_modal: function render_in_modal(title) {\n        // Set up handlers for cancel, ok button and for handling esc key.\n        var self = this;\n\n        var cancel_fn = function cancel_fn() {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n        };\n\n        var ok_fn = function ok_fn() {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n            self.update_from_form();\n        };\n\n        var check_enter_esc = function check_enter_esc(e) {\n            if ((e.keyCode || e.which) === 27) {\n                // Escape key\n                cancel_fn();\n            } else if ((e.keyCode || e.which) === 13) {\n                // Enter key\n                ok_fn();\n            }\n        };\n\n        // Set keypress handler.\n        $(window).bind(\"keypress.check_enter_esc\", check_enter_esc);\n\n        // Show modal.\n        if (this.$el.children().length === 0) {\n            this.render();\n        }\n        Galaxy.modal.show({\n            title: title || \"Configure\",\n            body: this.$el,\n            buttons: {\n                Cancel: cancel_fn,\n                OK: ok_fn\n            }\n        });\n    },\n\n    /**\n     * Update settings with new values entered via form.\n     */\n    update_from_form: function update_from_form() {\n        var self = this;\n        this.collection.each(function (setting, index) {\n            if (!setting.get(\"hidden\")) {\n                // Set value from view.\n                var id = \"param_\" + index;\n                var value = self.$el.find(\"#\" + id).val();\n                if (setting.get(\"type\") === \"bool\") {\n                    value = self.$el.find(\"#\" + id).is(\":checked\");\n                }\n                setting.set_value(value);\n            }\n        });\n    }\n});\n\nexports.default = {\n    ConfigSetting: ConfigSetting,\n    ConfigSettingCollection: ConfigSettingCollection,\n    ConfigSettingCollectionView: ConfigSettingCollectionView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _gridModel = __webpack_require__(24);\n\nvar _gridModel2 = _interopRequireDefault(_gridModel);\n\nvar _gridTemplate = __webpack_require__(25);\n\nvar _gridTemplate2 = _interopRequireDefault(_gridTemplate);\n\nvar _popupMenu = __webpack_require__(19);\n\nvar _popupMenu2 = _interopRequireDefault(_popupMenu);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\njQuery.ajaxSettings.traditional = true;\n\n// dependencies\n\n// grid view\nexports.default = Backbone.View.extend({\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function initialize(grid_config) {\n        this.grid = new _gridModel2.default();\n        this.dict_format = grid_config.dict_format;\n        this.title = grid_config.title;\n        var self = this;\n        window.add_tag_to_grid_filter = function (tag_name, tag_value) {\n            // Put tag name and value together.\n            var tag = tag_name + (tag_value !== undefined && tag_value !== \"\" ? \":\" + tag_value : \"\");\n            var advanced_search = $(\"#advanced-search\").is(\":visible\");\n            if (!advanced_search) {\n                $(\"#standard-search\").slideToggle(\"fast\");\n                $(\"#advanced-search\").slideToggle(\"fast\");\n            }\n            self.add_filter_condition(\"tags\", tag);\n        };\n\n        // set element\n        if (this.dict_format) {\n            this.setElement(\"<div/>\");\n            if (grid_config.url_base && !grid_config.items) {\n                var url_data = grid_config.url_data || {};\n                _.each(grid_config.filters, function (v, k) {\n                    url_data[\"f-\" + k] = v;\n                });\n                $.ajax({\n                    url: grid_config.url_base + \"?\" + $.param(url_data),\n                    success: function success(response) {\n                        response.embedded = grid_config.embedded;\n                        response.filters = grid_config.filters || {};\n                        self.init_grid(response);\n                    }\n                });\n            } else {\n                this.init_grid(grid_config);\n            }\n        } else {\n            this.setElement(\"#grid-container\");\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $(\"#center\").css({\n                padding: \"10px\",\n                overflow: \"auto\"\n            });\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function handle_refresh(refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray(\"history\", refresh_frames) > -1) {\n                if (window.top.Galaxy && window.top.Galaxy.currHistoryPanel) {\n                    window.top.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function init_grid(grid_config) {\n        this.grid.set(grid_config);\n\n        // get options\n        var options = this.grid.attributes;\n\n        if (this.allow_title_display && options.title) {\n            _utils2.default.setWindowTitle(options.title);\n        }\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get(\"url_base\");\n        url = url.replace(/^.*\\/\\/[^\\/]+/, \"\");\n        this.grid.set(\"url_base\", url);\n\n        // append main template\n        this.$el.html(_gridTemplate2.default.grid(options));\n\n        // update div contents\n        this.$el.find(\"#grid-table-header\").html(_gridTemplate2.default.header(options));\n        this.$el.find(\"#grid-table-body\").html(_gridTemplate2.default.body(options));\n        this.$el.find(\"#grid-table-footer\").html(_gridTemplate2.default.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find(\"#grid-message\").html(_gridTemplate2.default.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                setTimeout(function () {\n                    self.$el.find(\"#grid-message\").html(\"\");\n                }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function init_grid_controls() {\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find(\".operation-button\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find(\"input[type=text]\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                $(this).select();\n            }).keyup(function () {\n                $(this).css(\"font-style\", \"normal\");\n            });\n        });\n\n        // Initialize sort links.\n        this.$el.find(\".sort-link\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                self.set_sort_condition($(this).attr(\"sort_key\"));\n                return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find(\".text-filter-form\").each(function () {\n            $(this).off();\n            $(this).submit(function () {\n                var column_key = $(this).attr(\"column_key\");\n                var text_input_obj = $(\"#input-\" + column_key + \"-filter\");\n                var text_input = text_input_obj.val();\n                text_input_obj.val(\"\");\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".text-filter-val > a\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                // Remove visible element.\n                $(this).parent().remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".categorical-filter > a\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                self.set_categorical_filter($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find(\".advanced-search-toggle\").each(function () {\n            $(this).off();\n            $(this).click(function () {\n                self.$el.find(\"#standard-search\").slideToggle(\"fast\");\n                self.$el.find(\"#advanced-search\").slideToggle(\"fast\");\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find(\"#check_all\").off();\n        this.$el.find(\"#check_all\").on(\"click\", function () {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements: function init_grid_elements() {\n        // Initialize grid selection checkboxes.\n        this.$el.find(\".grid\").each(function () {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = function update_checked() {\n                check_count.text($(checkboxes).filter(\":checked\").length);\n            };\n\n            $(checkboxes).each(function () {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find(\".community_rating_star\").length !== 0) this.$el.find(\".community_rating_star\").rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find(\".page-link > a\").each(function () {\n            $(this).click(function () {\n                self.set_page($(this).attr(\"page_num\"));\n                return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find(\".use-target\").each(function () {\n            $(this).click(function (e) {\n                self.execute({\n                    href: $(this).attr(\"href\"),\n                    target: $(this).attr(\"target\")\n                });\n                return false;\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length == 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each(options.items, function (item, index) {\n            var button = self.$(\"#grid-\" + index + \"-popup\").off();\n            var popup = new _popupMenu2.default(button);\n            _.each(options[\"operations\"], function (operation) {\n                self._add_operation(popup, operation, item);\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    _add_operation: function _add_operation(popup, operation, item) {\n        var self = this;\n        var settings = item.operation_config[operation.label];\n        if (settings.allowed && operation.allow_popup) {\n            popup.addItem({\n                html: operation.label,\n                href: settings.url_args,\n                target: settings.target,\n                confirmation_text: operation.confirm,\n                func: function func(e) {\n                    e.preventDefault();\n                    var label = $(e.target).html();\n                    if (operation.onclick) {\n                        operation.onclick(item.encode_id);\n                    } else {\n                        self.execute(this.findItemByHtml(label));\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function add_filter_condition(name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(_gridTemplate2.default.filter_element(name, value));\n        var self = this;\n        t.click(function () {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find(\"#\" + name + \"-filtering-criteria\");\n        container.append(t);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function remove_filter_condition(name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function set_sort_condition(col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get(\"sort_key\");\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== \"-\") {\n                new_sort = \"-\" + col_key;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find(\".sort-arrow\").remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = new_sort.substring(0, 1) == \"-\" ? \"&uarr;\" : \"&darr;\";\n        var t = $(\"<span>\" + sort_arrow + \"</span>\").addClass(\"sort-arrow\");\n\n        // Add to header\n        this.$el.find(\"#\" + col_key + \"-header\").append(t);\n\n        // Update grid.\n        this.grid.set(\"sort_key\", new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function set_categorical_filter(name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get(\"categorical_filters\")[name];\n\n        var cur_value = this.grid.get(\"filters\")[name];\n        var self = this;\n        this.$el.find(\".\" + name + \"-filter\").each(function () {\n            var text = $.trim($(this).text());\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass(\"current-filter\");\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $(\"<a href=\\\"#\\\">\" + text + \"</a>\");\n                t.click(function () {\n                    self.set_categorical_filter(name, filter_value);\n                });\n                $(this).removeClass(\"current-filter\");\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function set_page(new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find(\".page-link\").each(function () {\n            var id = $(this).attr(\"id\");\n\n            var // Id has form 'page-link-<page_num>\n            page_num = parseInt(id.split(\"-\")[2], 10);\n\n            var cur_page = self.grid.get(\"cur_page\");\n            var text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this).children().text();\n                $(this).empty();\n                $(this).addClass(\"inactive-link\");\n                $(this).text(text);\n            } else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass(\"inactive-link\");\n                var t = $(\"<a href=\\\"#\\\">\" + text + \"</a>\");\n                t.click(function () {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === \"all\") {\n            this.grid.set(\"cur_page\", new_page);\n        } else {\n            this.grid.set(\"cur_page\", parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function submit_operation(operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify in any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (!number_of_checked_ids > 0) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {\n            label: operation_name\n        });\n        if (operation && !confirmation_text) {\n            confirmation_text = operation.confirm || \"\";\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find(\"input[name=id]:checked\").each(function () {\n            item_ids.push($(this).val());\n        });\n\n        // execute operation\n        var options = {\n            operation: operation_name,\n            id: item_ids,\n            confirmation_text: confirmation_text\n        };\n        if (operation.target == \"top\" || operation.target == \"center\") {\n            options = _.extend(options, {\n                href: operation.href,\n                target: operation.target\n            });\n        }\n        this.execute(options);\n        return true;\n    },\n\n    check_all_items: function check_all_items() {\n        var check = this.$(\".grid-row-select-checkbox\");\n        var state = this.$(\"#check_all\").prop(\"checked\");\n        _.each(check, function (c) {\n            $(c).prop(\"checked\", state);\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function go_page_one() {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get(\"cur_page\");\n        if (cur_page !== null && cur_page !== undefined && cur_page !== \"all\") {\n            this.grid.set(\"cur_page\", 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function execute(options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf(\"operation=\") != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf(\"operation\") != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split(\"=\")[1];\n                            operation = operation.replace(/\\+/g, \" \");\n                        } else if (href_parms[index].indexOf(\"id\") != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split(\"=\")[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (confirmation_text && confirmation_text != \"\" && confirmation_text != \"None\" && confirmation_text != \"null\") if (!confirm(confirmation_text)) return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if (target == \"top\") {\n                window.top.location = href + \"?\" + $.param(this.grid.get_url_data());\n            } else if (target == \"center\") {\n                $(\"#galaxy_main\").attr(\"src\", href + \"?\" + $.param(this.grid.get_url_data()));\n            } else if (this.grid.can_async_op(operation) || this.dict_format) {\n                this.update_grid();\n            } else {\n                this.go_to(target, href);\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        if (this.grid.get(\"async\") || this.dict_format) {\n            this.update_grid();\n        } else {\n            this.go_to(target, href);\n        }\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function go_to(target, href) {\n        // get aysnc status\n        var async = this.grid.get(\"async\");\n        this.grid.set(\"async\", false);\n\n        // get slide status\n        var advanced_search = this.$el.find(\"#advanced-search\").is(\":visible\");\n        this.grid.set(\"advanced_search\", advanced_search);\n\n        // get default url\n        if (!href) {\n            href = this.grid.get(\"url_base\") + \"?\" + $.param(this.grid.get_url_data());\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined,\n            async: async\n        });\n        switch (target) {\n            case \"center\":\n                $(\"#galaxy_main\").attr(\"src\", href);\n                break;\n            case \"top\":\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function update_grid() {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = this.grid.get(\"operation\") ? \"POST\" : \"GET\";\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find(\".loading-elt-overlay\").show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get(\"url_base\"),\n            data: self.grid.get_url_data(),\n            error: function error(response) {\n                alert(\"Grid refresh failed\");\n            },\n            success: function success(response_text) {\n                // backup\n                var embedded = self.grid.get(\"embedded\");\n                var insert = self.grid.get(\"insert\");\n                var advanced_search = self.$el.find(\"#advanced-search\").is(\":visible\");\n\n                // request new configuration\n                var json = self.dict_format ? response_text : $.parseJSON(response_text);\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n                json.advanced_search = advanced_search;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find(\".loading-elt-overlay\").hide();\n            },\n            complete: function complete() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/**\n  Webhooks\n**/\n\nvar WebhookModel = Backbone.Model.extend({\n    defaults: {\n        activate: false\n    }\n});\n\nvar Webhooks = Backbone.Collection.extend({\n    model: WebhookModel\n});\n\nvar WebhookView = Backbone.View.extend({\n    el: \"#webhook-view\",\n\n    initialize: function initialize(options) {\n        var me = this;\n        var toolId = options.toolId || \"\";\n        var toolVersion = options.toolVersion || \"\";\n\n        this.$el.attr(\"tool_id\", toolId);\n        this.$el.attr(\"tool_version\", toolVersion);\n\n        this.model = new WebhookModel();\n        this.model.urlRoot = options.urlRoot;\n        this.model.fetch({\n            success: function success() {\n                me.render();\n            }\n        });\n    },\n\n    render: function render() {\n        var webhook = this.model.toJSON();\n\n        this.$el.html(\"<div id=\\\"\" + webhook.name + \"\\\"></div>\");\n        if (webhook.styles) $(\"<style/>\", { type: \"text/css\" }).text(webhook.styles).appendTo(\"head\");\n        if (webhook.script) $(\"<script/>\", { type: \"text/javascript\" }).text(webhook.script).appendTo(\"head\");\n\n        return this;\n    }\n});\n\nvar add = function add(options) {\n    var webhooks = new Webhooks();\n\n    webhooks.url = Galaxy.root + options.url;\n    webhooks.fetch({\n        async: options.async ? options.async : true,\n        success: options.callback\n    });\n};\n\nexports.default = {\n    Webhooks: Webhooks,\n    WebhookView: WebhookView,\n    add: add\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//=============================================================================\n/**\n * backbone model for icon buttons\n */\nvar IconButton = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        icon_class: \"\",\n        on_click: null,\n        menu_options: null,\n        is_menu_button: true,\n        id: null,\n        href: null,\n        target: null,\n        enabled: true,\n        visible: true,\n        tooltip_config: {}\n    }\n});\n\n/**\n *  backbone view for icon buttons\n */\nvar IconButtonView = Backbone.View.extend({\n    initialize: function initialize() {\n        // better rendering this way\n        this.model.attributes.tooltip_config = { placement: \"bottom\" };\n        this.model.bind(\"change\", this.render, this);\n    },\n\n    render: function render() {\n        // hide tooltip\n        this.$el.tooltip(\"hide\");\n\n        var new_elem = this.template(this.model.toJSON());\n        // configure tooltip\n        new_elem.tooltip(this.model.get(\"tooltip_config\"));\n        this.$el.replaceWith(new_elem);\n        this.setElement(new_elem);\n        return this;\n    },\n\n    events: {\n        click: \"click\"\n    },\n\n    click: function click(event) {\n        // if on_click pass to that function\n        if (_.isFunction(this.model.get(\"on_click\"))) {\n            this.model.get(\"on_click\")(event);\n            return false;\n        }\n        // otherwise, bubble up ( to href or whatever )\n        return true;\n    },\n\n    // generate html element\n    template: function template(options) {\n        var buffer = \"title=\\\"\" + options.title + \"\\\" class=\\\"icon-button\";\n\n        if (options.is_menu_button) {\n            buffer += \" menu-button\";\n        }\n\n        buffer += \" \" + options.icon_class;\n\n        if (!options.enabled) {\n            buffer += \"_disabled\";\n        }\n\n        // close class tag\n        buffer += '\"';\n\n        if (options.id) {\n            buffer += \" id=\\\"\" + options.id + \"\\\"\";\n        }\n\n        buffer += \" href=\\\"\" + options.href + \"\\\"\";\n        // add target for href\n        if (options.target) {\n            buffer += \" target=\\\"\" + options.target + \"\\\"\";\n        }\n        // set visibility\n        if (!options.visible) {\n            buffer += ' style=\"display: none;\"';\n        }\n\n        // enabled/disabled\n        if (options.enabled) {\n            buffer = \"<a \" + buffer + \"/>\";\n        } else {\n            buffer = \"<span \" + buffer + \"/>\";\n        }\n\n        // return element\n        return $(buffer);\n    }\n});\n\n// define collection\nvar IconButtonCollection = Backbone.Collection.extend({\n    model: IconButton\n});\n\n/**\n * menu with multiple icon buttons\n * views are not needed nor used for individual buttons\n */\nvar IconButtonMenuView = Backbone.View.extend({\n    tagName: \"div\",\n\n    initialize: function initialize() {\n        this.render();\n    },\n\n    render: function render() {\n        // initialize icon buttons\n        var self = this;\n        this.collection.each(function (button) {\n            // create and add icon button to menu\n            var elt = $(\"<a/>\").attr(\"href\", \"javascript:void(0)\").attr(\"title\", button.attributes.title).addClass(\"icon-button menu-button\").addClass(button.attributes.icon_class).appendTo(self.$el).click(button.attributes.on_click);\n\n            // configure tooltip\n            if (button.attributes.tooltip_config) {\n                elt.tooltip(button.attributes.tooltip_config);\n            }\n\n            // add popup menu to icon\n            var menu_options = button.get(\"options\");\n            if (menu_options) {\n                make_popupmenu(elt, menu_options);\n            }\n        });\n\n        // return\n        return this;\n    }\n});\n\n/**\n * Returns an IconButtonMenuView for the provided configuration.\n * Configuration is a list of dictionaries where each dictionary\n * defines an icon button. Each dictionary must have the following\n * elements: icon_class, title, and on_click.\n */\nvar create_icon_buttons_menu = function create_icon_buttons_menu(config, global_config) {\n    // initialize global configuration\n    if (!global_config) global_config = {};\n\n    // create and initialize menu\n    var buttons = new IconButtonCollection(_.map(config, function (button_config) {\n        return new IconButton(_.extend(button_config, global_config));\n    }));\n\n    // return menu\n    return new IconButtonMenuView({ collection: buttons });\n};\n\n//=============================================================================\nexports.default = {\n    IconButton: IconButton,\n    IconButtonView: IconButtonView,\n    IconButtonCollection: IconButtonCollection,\n    IconButtonMenuView: IconButtonMenuView,\n    create_icon_buttons_menu: create_icon_buttons_menu\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 15 */,\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/** Frame view */\nvar FrameView = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model(options);\n        this.setElement($(\"<div/>\").addClass(\"corner frame\"));\n        this.$el.append($(\"<div/>\").addClass(\"f-header corner\").append($(\"<div/>\").addClass(\"f-title\")).append($(\"<div/>\").addClass(\"f-icon f-close fa fa-close\").tooltip({\n            title: \"Close\",\n            placement: \"bottom\"\n        }))).append($(\"<div/>\").addClass(\"f-content\")).append($(\"<div/>\").addClass(\"f-resize f-icon corner fa fa-expand\").tooltip({ title: \"Resize\" })).append($(\"<div/>\").addClass(\"f-cover\"));\n        this.$header = this.$(\".f-header\");\n        this.$title = this.$(\".f-title\");\n        this.$content = this.$(\".f-content\");\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    render: function render() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html(options.title || \"\");\n        this.$header.find(\".f-icon-left\").remove();\n        _.each(options.menu, function (option) {\n            var $option = $(\"<div/>\").addClass(\"f-icon-left\").addClass(option.icon);\n            if (_.isFunction(option.disabled) && option.disabled()) {\n                $option.attr(\"disabled\", true);\n            } else {\n                $option.on(\"click\", function () {\n                    option.onclick(self);\n                }).tooltip({\n                    title: option.tooltip,\n                    placement: \"bottom\"\n                });\n            }\n            self.$header.append($option);\n        });\n        if (options.url) {\n            this.$content.html($(\"<iframe/>\").addClass(\"f-iframe\").attr(\"scrolling\", \"auto\").attr(\"src\", options.url + (options.url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + \"widget=True\"));\n        } else if (options.content) {\n            _.isFunction(options.content) ? options.content(self.$content) : self.$content.html(options.content);\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {\n            // default frame size in cells\n            cols: 6,\n            rows: 3\n        },\n        rows: 1000, // maximum number of rows\n        cell: 130, // cell size in px\n        margin: 5, // margin between frames\n        scroll: 5, // scroll speed\n        top_min: 40, // top margin\n        frame_max: 9, // maximum number of frames\n        visible: true // initial visibility\n    },\n\n    cols: 0, // number of columns\n    top: 0, // scroll/element top\n    top_max: 0, // viewport scrolling state\n    frame_z: 0, // frame z-index\n    frame_counter: 0, // frame counter\n    frame_uid: 0, // unique frame id counter\n    frame_list: {}, // list of all frames\n    frame_shadow: null, // frame shown as placeholder when moving active frames\n    visible: false, // flag indicating if scratchbook viewer is visible or not\n    event: {}, // dictionary keeping track of current event\n\n    initialize: function initialize(options) {\n        var self = this;\n        this.options = _.defaults(options || {}, this.defaultOptions);\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement($(\"<div/>\").addClass(\"galaxy-frame\").append($(\"<div/>\").addClass(\"frame-background\")).append($(\"<div/>\").addClass(\"frame-menu frame-scroll-up fa fa-chevron-up fa-2x\")).append($(\"<div/>\").addClass(\"frame-menu frame-scroll-down fa fa-chevron-down fa-2x\")));\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({\n            el: $(\"<div/>\").addClass(\"corner frame-shadow\")\n        });\n        this.$el.append(this.frame_shadow.$el);\n        this._frameInit(this.frame_shadow, \"#frame-shadow\");\n        this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n        this.frame_list[\"#frame-shadow\"] = this.frame_shadow;\n\n        // initialize panel\n        this.visible ? this.show() : this.hide();\n        this._panelRefresh();\n        $(window).resize(function () {\n            self.visible && self._panelRefresh();\n        });\n    },\n\n    /** Render */\n    render: function render() {\n        this.$(\".frame-scroll-up\")[this.top != this.options.top_min && \"show\" || \"hide\"]();\n        this.$(\".frame-scroll-down\")[this.top != this.top_max && \"show\" || \"hide\"]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function add(options) {\n        if (this.frame_counter >= this.options.frame_max) {\n            Galaxy.modal.show({\n                title: \"Warning\",\n                body: \"You have reached the maximum number of allowed frames (\" + this.options.frame_max + \").\",\n                buttons: {\n                    Close: function Close() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        } else {\n            var frame_id = \"#frame-\" + this.frame_uid++;\n            if ($(frame_id).length !== 0) {\n                Galaxy.modal.show({\n                    title: \"Error\",\n                    body: \"This frame already exists. This page might contain multiple frame managers.\",\n                    buttons: {\n                        Close: function Close() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView(options);\n                this.$el.append(frame.$el);\n\n                // set dimensions\n                options.width = this._toPixelCoord(\"width\", this.options.frame.cols);\n                options.height = this._toPixelCoord(\"height\", this.options.frame.rows);\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt(frame.$el.css(\"z-index\"));\n                this.frame_list[frame_id] = frame;\n                this.frame_counter++;\n                this._frameInit(frame, frame_id);\n                this._frameResize(frame, {\n                    width: options.width,\n                    height: options.height\n                });\n                this._frameInsert(frame, { top: 0, left: 0 }, true);\n                !this.visible && this.show();\n                this.trigger(\"add\");\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function del(frame) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut(\"fast\", function () {\n            $frame.remove();\n            delete self.frame_list[frame.id];\n            self.frame_counter--;\n            self._panelRefresh(true);\n            self._panelAnimationComplete();\n            self.trigger(\"remove\");\n        });\n    },\n\n    /** Show panel */\n    show: function show() {\n        this.visible = true;\n        this.$el.fadeIn(\"fast\");\n        this.trigger(\"show\");\n    },\n\n    /** Hide panel */\n    hide: function hide() {\n        if (!this.event.type) {\n            this.visible = false;\n            this.$el.fadeOut(\"fast\", function () {\n                $(this).hide();\n            });\n            this.trigger(\"hide\");\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function length() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        mousemove: \"_eventFrameMouseMove\",\n        mouseup: \"_eventFrameMouseUp\",\n        mouseleave: \"_eventFrameMouseUp\",\n        mousewheel: \"_eventPanelScroll\",\n        DOMMouseScroll: \"_eventPanelScroll\",\n\n        // events fixed to elements\n        \"mousedown .frame\": \"_eventFrameMouseDown\",\n        \"mousedown .frame-background\": \"_eventHide\",\n        \"mousedown .frame-scroll-up\": \"_eventPanelScroll_up\",\n        \"mousedown .frame-scroll-down\": \"_eventPanelScroll_down\",\n        \"mousedown .f-close\": \"_eventFrameClose\"\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function _eventFrameMouseDown(e) {\n        $(\".tooltip\").hide();\n        if (!this.event.type) {\n            if ($(e.target).hasClass(\"f-header\") || $(e.target).hasClass(\"f-title\")) {\n                this.event.type = \"drag\";\n            }\n            if ($(e.target).hasClass(\"f-resize\")) {\n                this.event.type = \"resize\";\n            }\n            if (this.event.type) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify(e.target);\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart(this.event.target);\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function _eventFrameMouseMove(e) {\n        if (this.event.type) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x: e.originalEvent.pageX,\n                y: e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x: event_xy_new.x - this.event.xy.x,\n                y: event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen(this.event.target);\n\n            // drag/resize event\n            if (this.event.type == \"resize\") {\n                p.width += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max(p.width, min_dim);\n                p.height = Math.max(p.height, min_dim);\n                this._frameResize(this.event.target, p);\n                p.width = this._toGridCoord(\"width\", p.width) + 1;\n                p.height = this._toGridCoord(\"height\", p.height) + 1;\n                p.width = this._toPixelCoord(\"width\", p.width);\n                p.height = this._toPixelCoord(\"height\", p.height);\n                this._frameResize(this.frame_shadow, p);\n                this._frameInsert(this.frame_shadow, {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                });\n            } else if (this.event.type == \"drag\") {\n                p.left += event_xy_delta.x;\n                p.top += event_xy_delta.y;\n                this._frameOffset(this.event.target, p);\n                var l = {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                };\n                l.left !== 0 && l.left++;\n                this._frameInsert(this.frame_shadow, l);\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function _eventFrameMouseUp(e) {\n        if (this.event.type) {\n            this._frameDragStop(this.event.target);\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function _eventFrameClose(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this.del(this._frameIdentify(e.target));\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function _eventHide(e) {\n        !this.event.type && this.hide();\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function _eventPanelScroll(e) {\n        if (!this.event.type && this.visible) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $(e.srcElement).parents(\".frame\");\n            if (frames.length !== 0) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function _eventPanelScroll_up(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(-this.options.scroll);\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function _eventPanelScroll_down(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(this.options.scroll);\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function _frameIdentify(target) {\n        return this.frame_list[\"#\" + $(target).closest(\".frame\").attr(\"id\")];\n    },\n\n    /** Provides drag support */\n    _frameDragStart: function _frameDragStart(frame) {\n        this._frameFocus(frame, true);\n        var p = this._frameScreen(frame);\n        this._frameResize(this.frame_shadow, p);\n        this._frameGrid(this.frame_shadow, frame.grid_location);\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $(\".f-cover\").show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop: function _frameDragStop(frame) {\n        this._frameFocus(frame, false);\n        var p = this._frameScreen(this.frame_shadow);\n        this._frameResize(frame, p);\n        this._frameGrid(frame, this.frame_shadow.grid_location, true);\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $(\".f-cover\").hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function _toGridCoord(type, px) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        type == \"top\" && (px -= this.top);\n        return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n    },\n\n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function _toPixelCoord(type, g) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        var px = g * this.options.cell - sign * this.options.margin;\n        type == \"top\" && (px += this.top);\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function _toGrid(px) {\n        return {\n            top: this._toGridCoord(\"top\", px.top),\n            left: this._toGridCoord(\"left\", px.left),\n            width: this._toGridCoord(\"width\", px.width),\n            height: this._toGridCoord(\"height\", px.height)\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function _toPixel(g) {\n        return {\n            top: this._toPixelCoord(\"top\", g.top),\n            left: this._toPixelCoord(\"left\", g.left),\n            width: this._toPixelCoord(\"width\", g.width),\n            height: this._toPixelCoord(\"height\", g.height)\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function _isCollision(g) {\n        function is_collision_pair(a, b) {\n            return !(a.left > b.left + b.width - 1 || a.left + a.width - 1 < b.left || a.top > b.top + b.height - 1 || a.top + a.height - 1 < b.top);\n        }\n        for (var i in this.frame_list) {\n            var frame = this.frame_list[i];\n            if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function _locationRank(loc) {\n        return loc.top * this.cols + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function _panelRefresh(animate) {\n        this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n        this._frameInsert(null, null, animate);\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function _panelAnimationComplete() {\n        var self = this;\n        $(\".frame\").promise().done(function () {\n            self._panelScroll(0, true);\n        });\n    },\n\n    /** Scroll panel */\n    _panelScroll: function _panelScroll(delta, animate) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max(top_new, this.top_max);\n        top_new = Math.min(top_new, this.options.top_min);\n        if (this.top != top_new) {\n            for (var i in this.frame_list) {\n                var frame = this.frame_list[i];\n                if (frame.grid_location !== null) {\n                    var screen_location = {\n                        top: frame.screen_location.top - (this.top - top_new),\n                        left: frame.screen_location.left\n                    };\n                    this._frameOffset(frame, screen_location, animate);\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function _frameInit(frame, id) {\n        frame.id = id;\n        frame.screen_location = {};\n        frame.grid_location = {};\n        frame.grid_rank = null;\n        frame.$el.attr(\"id\", id.substring(1));\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function _frameInsert(frame, new_loc, animate) {\n        var self = this;\n        var place_list = [];\n        if (frame) {\n            frame.grid_location = null;\n            place_list.push([frame, this._locationRank(new_loc)]);\n        }\n        _.each(this.frame_list, function (f) {\n            if (f.grid_location !== null) {\n                f.grid_location = null;\n                place_list.push([f, f.grid_rank]);\n            }\n        });\n        place_list.sort(function (a, b) {\n            return a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0;\n        });\n        _.each(place_list, function (place) {\n            self._framePlace(place[0], animate);\n        });\n        this.top_max = 0;\n        _.each(this.frame_list, function (f) {\n            if (f.grid_location !== null) {\n                self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n            }\n        });\n        this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min(this.top_max, this.options.top_min);\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function _framePlace(frame, animate) {\n        frame.grid_location = null;\n        var g = this._toGrid(this._frameScreen(frame));\n        var done = false;\n        for (var i = 0; i < this.options.rows; i++) {\n            for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n                g.top = i;\n                g.left = j;\n                if (!this._isCollision(g)) {\n                    done = true;\n                    break;\n                }\n            }\n            if (done) {\n                break;\n            }\n        }\n        if (done) {\n            this._frameGrid(frame, g, animate);\n        } else {\n            console.log(\"Grid dimensions exceeded.\");\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function _frameFocus(frame, has_focus) {\n        frame.$el.css(\"z-index\", this.frame_z + (has_focus ? 1 : 0));\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function _frameOffset(frame, p, animate) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if (animate) {\n            this._frameFocus(frame, true);\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, \"fast\", function () {\n                self._frameFocus(frame, false);\n            });\n        } else {\n            frame.$el.css({ top: p.top, left: p.left });\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function _frameResize(frame, p) {\n        frame.$el.css({ width: p.width, height: p.height });\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function _frameGrid(frame, l, animate) {\n        frame.grid_location = l;\n        this._frameOffset(frame, this._toPixel(l), animate);\n        frame.grid_rank = this._locationRank(l);\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function _frameScreen(frame) {\n        var p = frame.screen_location;\n        return {\n            top: p.top,\n            left: p.left,\n            width: p.width,\n            height: p.height\n        };\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 17 */,\n/* 18 */,\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n// =============================================================================\n/**\n * view for a popup menu\n */\nvar PopupMenu = Backbone.View.extend({\n    //TODO: maybe better as singleton off the Galaxy obj\n    /** Cache the desired button element and options, set up the button click handler\n     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n     */\n    initialize: function initialize($button, options) {\n        // default settings\n        this.$button = $button;\n        if (!this.$button.length) {\n            this.$button = $(\"<div/>\");\n        }\n        this.options = options || [];\n        this.$button.data(\"popupmenu\", this);\n\n        // set up button click -> open menu behavior\n        var menu = this;\n        this.$button.click(function (event) {\n            // if there's already a menu open, remove it\n            $(\".popmenu-wrapper\").remove();\n            menu._renderAndShow(event);\n            return false;\n        });\n    },\n\n    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n    _renderAndShow: function _renderAndShow(clickEvent) {\n        this.render();\n        this.$el.appendTo(\"body\").css(this._getShownPosition(clickEvent)).show();\n        this._setUpCloseBehavior();\n    },\n\n    // render the menu\n    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n    render: function render() {\n        // render the menu body absolute and hidden, fill with template\n        this.$el.addClass(\"popmenu-wrapper\").hide().css({ position: \"absolute\" }).html(this.template(this.$button.attr(\"id\"), this.options));\n\n        // set up behavior on each link/anchor elem\n        if (this.options.length) {\n            var menu = this;\n            //precondition: there should be one option per li\n            this.$el.find(\"li\").each(function (i, li) {\n                var option = menu.options[i];\n\n                // if the option has 'func', call that function when the anchor is clicked\n                if (option.func) {\n                    $(this).children(\"a.popupmenu-option\").click(function (event) {\n                        option.func.call(menu, event, option);\n                        // We must preventDefault otherwise clicking \"cancel\"\n                        // on a purge or something still navigates and causes\n                        // the action.\n                        event.preventDefault();\n                        // bubble up so that an option click will call the close behavior\n                    });\n                }\n            });\n        }\n        return this;\n    },\n\n    template: function template(id, options) {\n        return ['<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions(options), \"</ul>\"].join(\"\");\n    },\n\n    _templateOptions: function _templateOptions(options) {\n        if (!options.length) {\n            return \"<li>(no options)</li>\";\n        }\n        return _.map(options, function (option) {\n            if (option.divider) {\n                return '<li class=\"divider\"></li>';\n            } else if (option.header) {\n                return ['<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, \"</a></li>\"].join(\"\");\n            }\n            var href = option.href || \"javascript:void(0);\";\n            var target = option.target ? \" target=\\\"\" + option.target + \"\\\"\" : \"\";\n\n            var check = option.checked ? '<span class=\"fa fa-check\"></span>' : \"\";\n\n            return ['<li><a class=\"popupmenu-option\" href=\"', href, '\"', target, \">\", check, option.html, \"</a></li>\"].join(\"\");\n        }).join(\"\");\n    },\n\n    // get the absolute position/offset for the menu\n    _getShownPosition: function _getShownPosition(clickEvent) {\n        // display menu horiz. centered on click...\n        var menuWidth = this.$el.width();\n        var x = clickEvent.pageX - menuWidth / 2;\n\n        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n        x = Math.min(x, $(document).scrollLeft() + $(window).width() - menuWidth - 5);\n        x = Math.max(x, $(document).scrollLeft() + 5);\n        return {\n            top: clickEvent.pageY,\n            left: x\n        };\n    },\n\n    // bind an event handler to all available frames so that when anything is clicked\n    // the menu is removed from the DOM and the event handler unbinds itself\n    _setUpCloseBehavior: function _setUpCloseBehavior() {\n        var menu = this;\n        //TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\n        // function to close popup and unbind itself\n        function closePopup(event) {\n            $(document).off(\"click.close_popup\");\n            if (window && window.parent !== window) {\n                try {\n                    $(window.parent.document).off(\"click.close_popup\");\n                } catch (err) {}\n            } else {\n                try {\n                    $(\"iframe#galaxy_main\").contents().off(\"click.close_popup\");\n                } catch (err) {}\n            }\n            menu.remove();\n        }\n\n        $(\"html\").one(\"click.close_popup\", closePopup);\n        if (window && window.parent !== window) {\n            try {\n                $(window.parent.document).find(\"html\").one(\"click.close_popup\", closePopup);\n            } catch (err) {}\n        } else {\n            try {\n                $(\"iframe#galaxy_main\").contents().one(\"click.close_popup\", closePopup);\n            } catch (err) {}\n        }\n    },\n\n    // add a menu option/item at the given index\n    addItem: function addItem(item, index) {\n        // append to end if no index\n        index = index >= 0 ? index : this.options.length;\n        this.options.splice(index, 0, item);\n        return this;\n    },\n\n    // remove a menu option/item at the given index\n    removeItem: function removeItem(index) {\n        if (index >= 0) {\n            this.options.splice(index, 1);\n        }\n        return this;\n    },\n\n    // search for a menu option by its html\n    findIndexByHtml: function findIndexByHtml(html) {\n        for (var i = 0; i < this.options.length; i++) {\n            if (_.has(this.options[i], \"html\") && this.options[i].html === html) {\n                return i;\n            }\n        }\n        return null;\n    },\n\n    // search for a menu option by its html\n    findItemByHtml: function findItemByHtml(html) {\n        return this.options[this.findIndexByHtml(html)];\n    },\n\n    // string representation\n    toString: function toString() {\n        return \"PopupMenu\";\n    }\n});\n/** shortcut to new for when you don't need to preserve the ref */\nPopupMenu.create = function _create($button, options) {\n    return new PopupMenu($button, options);\n};\n\n// -----------------------------------------------------------------------------\n// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n// to the newer backbone.js PopupMenu\n\n/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n *      Converts initial_options to object array used by PopupMenu.\n *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n *  @param {Object} initial_options map of key -> values, where\n *      key is option text, value is fn to call when option is clicked\n *  @returns {PopupMenu} the PopupMenu created\n */\nPopupMenu.make_popupmenu = function (button_element, initial_options) {\n    var convertedOptions = [];\n    _.each(initial_options, function (optionVal, optionKey) {\n        var newOption = { html: optionKey };\n\n        // keys with null values indicate: header\n        if (optionVal === null) {\n            // !optionVal? (null only?)\n            newOption.header = true;\n\n            // keys with function values indicate: a menu option\n        } else if (jQuery.type(optionVal) === \"function\") {\n            newOption.func = optionVal;\n        }\n        //TODO:?? any other special optionVals?\n        // there was no divider option originally\n        convertedOptions.push(newOption);\n    });\n    return new PopupMenu($(button_element), convertedOptions);\n};\n\n/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n *  @param {jQuery} $parent the element that contains the links to convert to options\n *  @param {String} selector jq selector string to find links\n *  @returns {Object[]} the options array to initialize a PopupMenu\n */\n//TODO: lose parent and selector, pass in array of links, use map to return options\nPopupMenu.convertLinksToOptions = function ($parent, selector) {\n    $parent = $($parent);\n    selector = selector || \"a\";\n    var options = [];\n    $parent.find(selector).each(function (elem, i) {\n        var option = {};\n        var $link = $(elem);\n\n        // convert link text to the option text (html) and the href into the option func\n        option.html = $link.text();\n        if ($link.attr(\"href\")) {\n            var linkHref = $link.attr(\"href\");\n            var linkTarget = $link.attr(\"target\");\n            var confirmText = $link.attr(\"confirm\");\n\n            option.func = function () {\n                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n                //  if the user cancels - do nothing\n                if (confirmText && !confirm(confirmText)) {\n                    return;\n                }\n\n                // if there's no confirm attribute, or the user accepted the confirm dialog:\n                switch (linkTarget) {\n                    // relocate the center panel\n                    case \"_parent\":\n                        window.parent.location = linkHref;\n                        break;\n\n                    // relocate the entire window\n                    case \"_top\":\n                        window.top.location = linkHref;\n                        break;\n\n                    // relocate this panel\n                    default:\n                        window.location = linkHref;\n                }\n            };\n        }\n        options.push(option);\n    });\n    return options;\n};\n\n/** Create a single popupmenu from existing DOM button and anchor elements\n *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n */\nPopupMenu.fromExistingDom = function ($buttonElement, $menuElement, menuElementLinkSelector) {\n    $buttonElement = $($buttonElement);\n    $menuElement = $($menuElement);\n    var options = PopupMenu.convertLinksToOptions($menuElement, menuElementLinkSelector);\n    // we're done with the menu (having converted it to an options map)\n    $menuElement.remove();\n    return new PopupMenu($buttonElement, options);\n};\n\n/** Create all popupmenus within a document or a more specific element\n *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n *      Will be passed $menuElement, parent.\n *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n *  @returns {PopupMenu[]} array of popupmenus created\n */\nPopupMenu.make_popup_menus = function (parent, menuSelector, buttonSelectorBuildFn) {\n    parent = parent || document;\n    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n    //  which contains the id of the button that activates the menu\n    menuSelector = menuSelector || \"div[popupmenu]\";\n    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n    buttonSelectorBuildFn = buttonSelectorBuildFn || function ($menuElement, parent) {\n        return \"#\" + $menuElement.attr(\"popupmenu\");\n    };\n\n    // aggregate and return all PopupMenus\n    var popupMenusCreated = [];\n    $(parent).find(menuSelector).each(function () {\n        var $menuElement = $(this);\n\n        var $buttonElement = $(parent).find(buttonSelectorBuildFn($menuElement, parent));\n\n        popupMenusCreated.push(PopupMenu.fromDom($buttonElement, $menuElement));\n        $buttonElement.addClass(\"popup\");\n    });\n    return popupMenusCreated;\n};\n\n// =============================================================================\nexports.default = PopupMenu;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.collection = new Backbone.Collection();\n        this.model = options && options.model || new Backbone.Model({\n            onchange: null,\n            visible: true\n        }).set(options);\n        this.setElement($(this._template()));\n        this.$nav = this.$(\".tab-navigation\");\n        this.$content = this.$(\".tab-content\");\n        this.$el.on(\"click\", function () {\n            $(\".tooltip\").hide();\n        });\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"add\", this._add, this);\n        this.listenTo(this.collection, \"remove\", this._remove, this);\n        this.listenTo(this.collection, \"change\", this._change, this);\n        this.listenTo(this.collection, \"reset\", this._reset, this);\n        this.listenTo(this.collection, \"add remove reset\", this.render, this);\n    },\n\n    render: function render() {\n        var id = this.model.get(\"current\");\n        id = this.$(\"#\" + id).length > 0 ? id : this.first();\n        if (id) {\n            this.$nav.children().removeClass(\"active\");\n            this.$content.children().removeClass(\"active\");\n            this.$(\"#tab-\" + id).addClass(\"active\");\n            this.$(\"#\" + id).addClass(\"active\");\n        }\n        this.$el[this.model.get(\"visible\") ? \"fadeIn\" : \"fadeOut\"](\"fast\");\n        this.$nav[this.size() > 1 ? \"show\" : \"hide\"]();\n    },\n\n    /** Returns tab id for currently shown tab */\n    current: function current() {\n        return this.model.get(\"current\");\n    },\n\n    /** Show tab view and highlight a tab by id */\n    show: function show(id) {\n        if (id) {\n            this.model.set({ current: id, visible: true });\n            this.model.get(\"onchange\") && this.model.get(\"onchange\")(id);\n        }\n    },\n\n    /** Hide tab view */\n    hide: function hide() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Returns first tab */\n    first: function first() {\n        var model = this.collection.first();\n        return model && model.id;\n    },\n\n    /** Returns current number of tabs */\n    size: function size() {\n        return this.collection.length;\n    },\n\n    /** Adds a new tab */\n    add: function add(options) {\n        this.collection.add(options);\n    },\n\n    /** Delete tab */\n    del: function del(id) {\n        this.collection.remove(id);\n    },\n\n    /** Delete all tabs */\n    delAll: function delAll() {\n        this.collection.reset();\n    },\n\n    /** Show tab */\n    showTab: function showTab(id) {\n        this.collection.get(id).set(\"hidden\", false);\n    },\n\n    /** Hide tab */\n    hideTab: function hideTab(id) {\n        this.collection.get(id).set(\"hidden\", true);\n    },\n\n    /** Adds a new tab */\n    _add: function _add(tab_model) {\n        var self = this;\n        var options = tab_model.attributes;\n        this.$content.append($(\"<div/>\").attr(\"id\", options.id).addClass(\"tab-pane\").append(options.$el));\n        this.$nav.append($(this._template_tab(options)).show().tooltip({\n            title: options.tooltip,\n            placement: \"bottom\",\n            container: self.$el\n        }).on(\"click\", function (e) {\n            e.preventDefault();\n            self.show(options.id);\n        }));\n        if (this.size() == 1) {\n            this.show(options.id);\n        }\n    },\n\n    /** Delete tab */\n    _remove: function _remove(tab_model) {\n        this.$(\"#tab-\" + tab_model.id).remove();\n        this.$(\"#\" + tab_model.id).remove();\n    },\n\n    /** Reset collection */\n    _reset: function _reset() {\n        this.$nav.empty();\n        this.$content.empty();\n    },\n\n    /** Change tab */\n    _change: function _change(tab_model) {\n        this.$(\"#tab-\" + tab_model.id)[tab_model.get(\"hidden\") ? \"hide\" : \"show\"]();\n    },\n\n    /** Main template */\n    _template: function _template() {\n        return $(\"<div/>\").addClass(\"ui-tabs tabbable tabs-left\").append($(\"<ul/>\").addClass(\"tab-navigation nav nav-tabs\")).append($(\"<div/>\").addClass(\"tab-content\"));\n    },\n\n    /** Tab template */\n    _template_tab: function _template_tab(options) {\n        var $tmpl = $(\"<li/>\").addClass(\"tab-element\").attr(\"id\", \"tab-\" + options.id).append($(\"<a/>\").attr(\"id\", \"tab-title-link-\" + options.id));\n        var $href = $tmpl.find(\"a\");\n        options.icon && $href.append($(\"<i/>\").addClass(\"tab-icon fa\").addClass(options.icon));\n        $href.append($(\"<span/>\").attr(\"id\", \"tab-title-text-\" + options.id).addClass(\"tab-title-text\").append(options.title));\n        return $tmpl;\n    }\n}); /**\n     *  Renders tabs e.g. used in the charts editor, behaves similar to repeat and section rendering\n     */\nexports.default = { View: View };\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//==============================================================================\nvar LOGGING_FNS = [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"];\n/** adds logging functions to an obj.prototype (or obj directly) adding a namespace for filtering\n *  @param {Object} obj\n *  @param {String} namespace\n */\nfunction addLogging(obj, namespace) {\n    var addTo = obj.prototype !== undefined ? obj.prototype : obj;\n    if (namespace !== undefined) {\n        addTo._logNamespace = namespace;\n    }\n    //yagni?: without this, may not capture Galaxy.config.debug and add Galaxy.logger properly\n    // if( window.Galaxy && window.Galaxy.config && window.Galaxy.config.debug ){\n    //     addTo.logger = window.Galaxy.logger;\n    // }\n\n    // give the object each\n    LOGGING_FNS.forEach(function (logFn) {\n        addTo[logFn] = function () {\n            if (!this.logger) {\n                return undefined;\n            }\n            if (this.logger.emit) {\n                return this.logger.emit(logFn, this._logNamespace, arguments);\n            }\n            if (this.logger[logFn]) {\n                //TODO:! there has to be a way to get the lineno/file into this\n                // http://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number\n                // http://www.paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/\n                return this.logger[logFn].apply(this.logger, arguments);\n            }\n            return undefined;\n        };\n    });\n    return obj;\n}\n\n//==============================================================================\nexports.default = addLogging;\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _util = __webpack_require__(8);\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _data = __webpack_require__(10);\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _toolForm = __webpack_require__(23);\n\nvar _toolForm2 = _interopRequireDefault(_toolForm);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * Mixin for tracking model visibility.\n */\n/**\n * Model, view, and controller objects for Galaxy tools and tool panel.\n */\n\nvar VisibilityMixin = {\n    hidden: false,\n\n    show: function show() {\n        this.set(\"hidden\", false);\n    },\n\n    hide: function hide() {\n        this.set(\"hidden\", true);\n    },\n\n    toggle: function toggle() {\n        this.set(\"hidden\", !this.get(\"hidden\"));\n    },\n\n    is_visible: function is_visible() {\n        return !this.attributes.hidden;\n    }\n};\n\n/**\n * A tool parameter.\n */\nvar ToolParameter = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        label: null,\n        type: null,\n        value: null,\n        html: null,\n        num_samples: 5\n    },\n\n    initialize: function initialize(options) {\n        this.attributes.html = unescape(this.attributes.html);\n    },\n\n    copy: function copy() {\n        return new ToolParameter(this.toJSON());\n    },\n\n    set_value: function set_value(value) {\n        this.set(\"value\", value || \"\");\n    }\n});\n\nvar ToolParameterCollection = Backbone.Collection.extend({\n    model: ToolParameter\n});\n\n/**\n * A data tool parameter.\n */\nvar DataToolParameter = ToolParameter.extend({});\n\n/**\n * An integer tool parameter.\n */\nvar IntegerToolParameter = ToolParameter.extend({\n    set_value: function set_value(value) {\n        this.set(\"value\", parseInt(value, 10));\n    },\n\n    /**\n     * Returns samples from a tool input.\n     */\n    get_samples: function get_samples() {\n        return d3.scale.linear().domain([this.get(\"min\"), this.get(\"max\")]).ticks(this.get(\"num_samples\"));\n    }\n});\n\nvar FloatToolParameter = IntegerToolParameter.extend({\n    set_value: function set_value(value) {\n        this.set(\"value\", parseFloat(value));\n    }\n});\n\n/**\n * A select tool parameter.\n */\nvar SelectToolParameter = ToolParameter.extend({\n    /**\n     * Returns tool options.\n     */\n    get_samples: function get_samples() {\n        return _.map(this.get(\"options\"), function (option) {\n            return option[0];\n        });\n    }\n});\n\n// Set up dictionary of parameter types.\nToolParameter.subModelTypes = {\n    integer: IntegerToolParameter,\n    float: FloatToolParameter,\n    data: DataToolParameter,\n    select: SelectToolParameter\n};\n\n/**\n * A Galaxy tool.\n */\nvar Tool = Backbone.Model.extend({\n    // Default attributes.\n    defaults: {\n        id: null,\n        name: null,\n        description: null,\n        target: null,\n        inputs: [],\n        outputs: []\n    },\n\n    urlRoot: Galaxy.root + \"api/tools\",\n\n    initialize: function initialize(options) {\n        // Set parameters.\n        this.set(\"inputs\", new ToolParameterCollection(_.map(options.inputs, function (p) {\n            var p_class = ToolParameter.subModelTypes[p.type] || ToolParameter;\n            return new p_class(p);\n        })));\n    },\n\n    /**\n     *\n     */\n    toJSON: function toJSON() {\n        var rval = Backbone.Model.prototype.toJSON.call(this);\n\n        // Convert inputs to JSON manually.\n        rval.inputs = this.get(\"inputs\").map(function (i) {\n            return i.toJSON();\n        });\n        return rval;\n    },\n\n    /**\n     * Removes inputs of a particular type; this is useful because not all inputs can be handled by\n     * client and server yet.\n     */\n    remove_inputs: function remove_inputs(types) {\n        var tool = this;\n\n        var incompatible_inputs = tool.get(\"inputs\").filter(function (input) {\n            return types.indexOf(input.get(\"type\")) !== -1;\n        });\n\n        tool.get(\"inputs\").remove(incompatible_inputs);\n    },\n\n    /**\n     * Returns object copy, optionally including only inputs that can be sampled.\n     */\n    copy: function copy(only_samplable_inputs) {\n        var copy = new Tool(this.toJSON());\n\n        // Return only samplable inputs if flag is set.\n        if (only_samplable_inputs) {\n            var valid_inputs = new Backbone.Collection();\n            copy.get(\"inputs\").each(function (input) {\n                if (input.get_samples()) {\n                    valid_inputs.push(input);\n                }\n            });\n            copy.set(\"inputs\", valid_inputs);\n        }\n\n        return copy;\n    },\n\n    apply_search_results: function apply_search_results(results) {\n        _.indexOf(results, this.attributes.id) !== -1 ? this.show() : this.hide();\n        return this.is_visible();\n    },\n\n    /**\n     * Set a tool input's value.\n     */\n    set_input_value: function set_input_value(name, value) {\n        this.get(\"inputs\").find(function (input) {\n            return input.get(\"name\") === name;\n        }).set(\"value\", value);\n    },\n\n    /**\n     * Set many input values at once.\n     */\n    set_input_values: function set_input_values(inputs_dict) {\n        var self = this;\n        _.each(_.keys(inputs_dict), function (input_name) {\n            self.set_input_value(input_name, inputs_dict[input_name]);\n        });\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     */\n    run: function run() {\n        return this._run();\n    },\n\n    /**\n     * Rerun tool using regions and a target dataset.\n     */\n    rerun: function rerun(target_dataset, regions) {\n        return this._run({\n            action: \"rerun\",\n            target_dataset_id: target_dataset.id,\n            regions: regions\n        });\n    },\n\n    /**\n     * Returns input dict for tool's inputs.\n     */\n    get_inputs_dict: function get_inputs_dict() {\n        var input_dict = {};\n        this.get(\"inputs\").each(function (input) {\n            input_dict[input.get(\"name\")] = input.get(\"value\");\n        });\n        return input_dict;\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     * NOTE: this method is a helper method and should not be called directly.\n     */\n    _run: function _run(additional_params) {\n        // Create payload.\n        var payload = _.extend({\n            tool_id: this.id,\n            inputs: this.get_inputs_dict()\n        }, additional_params);\n\n        // Because job may require indexing datasets, use server-side\n        // deferred to ensure that job is run. Also use deferred that\n        // resolves to outputs from tool.\n        var run_deferred = $.Deferred();\n\n        var ss_deferred = new _util2.default.ServerStateDeferred({\n            ajax_settings: {\n                url: this.urlRoot,\n                data: JSON.stringify(payload),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function success_fn(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Run job and resolve run_deferred to tool outputs.\n        $.when(ss_deferred.go()).then(function (result) {\n            run_deferred.resolve(new _data2.default.DatasetCollection(result));\n        });\n        return run_deferred;\n    }\n});\n_.extend(Tool.prototype, VisibilityMixin);\n\n/**\n * Tool view.\n */\nvar ToolView = Backbone.View.extend({});\n\n/**\n * Wrap collection of tools for fast access/manipulation.\n */\nvar ToolCollection = Backbone.Collection.extend({\n    model: Tool\n});\n\n/**\n * Label or section header in tool panel.\n */\nvar ToolSectionLabel = Backbone.Model.extend(VisibilityMixin);\n\n/**\n * Section of tool panel with elements (labels and tools).\n */\nvar ToolSection = Backbone.Model.extend({\n    defaults: {\n        elems: [],\n        open: false\n    },\n\n    clear_search_results: function clear_search_results() {\n        _.each(this.attributes.elems, function (elt) {\n            elt.show();\n        });\n\n        this.show();\n        this.set(\"open\", false);\n    },\n\n    apply_search_results: function apply_search_results(results) {\n        var all_hidden = true;\n        var cur_label;\n        _.each(this.attributes.elems, function (elt) {\n            if (elt instanceof ToolSectionLabel) {\n                cur_label = elt;\n                cur_label.hide();\n            } else if (elt instanceof Tool) {\n                if (elt.apply_search_results(results)) {\n                    all_hidden = false;\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            }\n        });\n\n        if (all_hidden) {\n            this.hide();\n        } else {\n            this.show();\n            this.set(\"open\", true);\n        }\n    }\n});\n_.extend(ToolSection.prototype, VisibilityMixin);\n\n/**\n * Tool search that updates results when query is changed. Result value of null\n * indicates that query was not run; if not null, results are from search using\n * query.\n */\nvar ToolSearch = Backbone.Model.extend({\n    defaults: {\n        search_hint_string: \"search tools\",\n        min_chars_for_search: 3,\n        clear_btn_url: \"\",\n        visible: true,\n        query: \"\",\n        results: null,\n        // ESC (27) will clear the input field and tool search filters\n        clear_key: 27\n    },\n\n    urlRoot: Galaxy.root + \"api/tools\",\n\n    initialize: function initialize() {\n        this.on(\"change:query\", this.do_search);\n    },\n\n    /**\n     * Do the search and update the results.\n     */\n    do_search: function do_search() {\n        var query = this.attributes.query;\n\n        // If query is too short, do not search.\n        if (query.length < this.attributes.min_chars_for_search) {\n            this.set(\"results\", null);\n            return;\n        }\n\n        // Do search via AJAX.\n        var q = query;\n        // Stop previous ajax-request\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n        // Start a new ajax-request in X ms\n        $(\"#search-clear-btn\").hide();\n        $(\"#search-spinner\").show();\n        var self = this;\n        this.timer = setTimeout(function () {\n            // log the search to analytics if present\n            if (typeof ga !== \"undefined\") {\n                ga(\"send\", \"pageview\", Galaxy.root + \"?q=\" + q);\n            }\n            $.get(self.urlRoot, { q: q }, function (data) {\n                self.set(\"results\", data);\n                $(\"#search-spinner\").hide();\n                $(\"#search-clear-btn\").show();\n            }, \"json\");\n        }, 400);\n    },\n\n    clear_search: function clear_search() {\n        this.set(\"query\", \"\");\n        this.set(\"results\", null);\n    }\n});\n_.extend(ToolSearch.prototype, VisibilityMixin);\n\n/**\n * Tool Panel.\n */\nvar ToolPanel = Backbone.Model.extend({\n    initialize: function initialize(options) {\n        this.attributes.tool_search = options.tool_search;\n        this.attributes.tool_search.on(\"change:results\", this.apply_search_results, this);\n        this.attributes.tools = options.tools;\n        this.attributes.layout = new Backbone.Collection(this.parse(options.layout));\n    },\n\n    /**\n     * Parse tool panel dictionary and return collection of tool panel elements.\n     */\n    parse: function parse(response) {\n        // Recursive function to parse tool panel elements.\n        var self = this;\n\n        var // Helper to recursively parse tool panel.\n        parse_elt = function parse_elt(elt_dict) {\n            var type = elt_dict.model_class;\n            // There are many types of tools; for now, anything that ends in 'Tool'\n            // is treated as a generic tool.\n            if (type.indexOf(\"Tool\") === type.length - 4) {\n                return self.attributes.tools.get(elt_dict.id);\n            } else if (type === \"ToolSection\") {\n                // Parse elements.\n                var elems = _.map(elt_dict.elems, parse_elt);\n                elt_dict.elems = elems;\n                return new ToolSection(elt_dict);\n            } else if (type === \"ToolSectionLabel\") {\n                return new ToolSectionLabel(elt_dict);\n            }\n        };\n\n        return _.map(response, parse_elt);\n    },\n\n    clear_search_results: function clear_search_results() {\n        this.get(\"layout\").each(function (panel_elt) {\n            if (panel_elt instanceof ToolSection) {\n                panel_elt.clear_search_results();\n            } else {\n                // Label or tool, so just show.\n                panel_elt.show();\n            }\n        });\n    },\n\n    apply_search_results: function apply_search_results() {\n        var results = this.get(\"tool_search\").get(\"results\");\n        if (results === null) {\n            this.clear_search_results();\n            return;\n        }\n\n        var cur_label = null;\n        this.get(\"layout\").each(function (panel_elt) {\n            if (panel_elt instanceof ToolSectionLabel) {\n                cur_label = panel_elt;\n                cur_label.hide();\n            } else if (panel_elt instanceof Tool) {\n                if (panel_elt.apply_search_results(results)) {\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            } else {\n                // Starting new section, so clear current label.\n                cur_label = null;\n                panel_elt.apply_search_results(results);\n            }\n        });\n    }\n});\n\n/**\n * View classes for Galaxy tools and tool panel.\n *\n * Views use the templates defined below for rendering. Views update as needed\n * based on (a) model/collection events and (b) user interactions; in this sense,\n * they are controllers are well and the HTML is the real view in the MVC architecture.\n */\n\n/**\n * Base view that handles visibility based on model's hidden attribute.\n */\nvar BaseView = Backbone.View.extend({\n    initialize: function initialize() {\n        this.model.on(\"change:hidden\", this.update_visible, this);\n        this.update_visible();\n    },\n    update_visible: function update_visible() {\n        this.model.attributes.hidden ? this.$el.hide() : this.$el.show();\n    }\n});\n\n/**\n * Link to a tool.\n */\nvar ToolLinkView = BaseView.extend({\n    tagName: \"div\",\n\n    render: function render() {\n        // create element\n        var $link = $(\"<div/>\");\n        $link.append(templates.tool_link(this.model.toJSON()));\n\n        var formStyle = this.model.get(\"form_style\", null);\n        // open upload dialog for upload tool\n        if (this.model.id === \"upload1\") {\n            $link.find(\"a\").on(\"click\", function (e) {\n                e.preventDefault();\n                Galaxy.upload.show();\n            });\n        } else if (formStyle === \"regular\") {\n            // regular tools\n            var self = this;\n            $link.find(\"a\").on(\"click\", function (e) {\n                e.preventDefault();\n                Galaxy.router.push(\"/\", {\n                    tool_id: self.model.id,\n                    version: self.model.get(\"version\")\n                });\n            });\n        }\n\n        // add element\n        this.$el.append($link);\n        return this;\n    }\n});\n\n/**\n * Panel label/section header.\n */\nvar ToolSectionLabelView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolPanelLabel\",\n\n    render: function render() {\n        this.$el.append($(\"<span/>\").text(this.model.attributes.text));\n        return this;\n    }\n});\n\n/**\n * Panel section.\n */\nvar ToolSectionView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolSectionWrapper\",\n\n    initialize: function initialize() {\n        BaseView.prototype.initialize.call(this);\n        this.model.on(\"change:open\", this.update_open, this);\n    },\n\n    render: function render() {\n        // Build using template.\n        this.$el.append(templates.panel_section(this.model.toJSON()));\n\n        // Add tools to section.\n        var section_body = this.$el.find(\".toolSectionBody\");\n        _.each(this.model.attributes.elems, function (elt) {\n            if (elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: elt,\n                    className: \"toolTitle\"\n                });\n                tool_view.render();\n                section_body.append(tool_view.$el);\n            } else if (elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: elt\n                });\n                label_view.render();\n                section_body.append(label_view.$el);\n            } else {\n                // TODO: handle nested section bodies?\n            }\n        });\n        return this;\n    },\n\n    events: {\n        \"click .toolSectionTitle > a\": \"toggle\"\n    },\n\n    /**\n     * Toggle visibility of tool section.\n     */\n    toggle: function toggle() {\n        this.model.set(\"open\", !this.model.attributes.open);\n    },\n\n    /**\n     * Update whether section is open or close.\n     */\n    update_open: function update_open() {\n        this.model.attributes.open ? this.$el.children(\".toolSectionBody\").slideDown(\"fast\") : this.$el.children(\".toolSectionBody\").slideUp(\"fast\");\n    }\n});\n\nvar ToolSearchView = Backbone.View.extend({\n    tagName: \"div\",\n    id: \"tool-search\",\n    className: \"bar\",\n\n    events: {\n        click: \"focus_and_select\",\n        \"keyup :input\": \"query_changed\",\n        \"change :input\": \"query_changed\",\n        \"click #search-clear-btn\": \"clear\"\n    },\n\n    render: function render() {\n        this.$el.append(templates.tool_search(this.model.toJSON()));\n        if (!this.model.is_visible()) {\n            this.$el.hide();\n        }\n\n        // Adjust top for issue 2907 depending on whether the messagebox is visible.\n        if ($(\"#messagebox\").is(\":visible\")) {\n            this.$el.css(\"top\", \"95px\");\n        }\n\n        this.$el.find(\"[title]\").tooltip();\n        return this;\n    },\n\n    focus_and_select: function focus_and_select() {\n        this.$el.find(\":input\").focus().select();\n    },\n\n    clear: function clear() {\n        this.model.clear_search();\n        this.$el.find(\":input\").val(\"\");\n        this.focus_and_select();\n        return false;\n    },\n\n    query_changed: function query_changed(evData) {\n        // check for the 'clear key' (ESC) first\n        if (this.model.attributes.clear_key && this.model.attributes.clear_key === evData.which) {\n            this.clear();\n            return false;\n        }\n        this.model.set(\"query\", this.$el.find(\":input\").val());\n    }\n});\n\n/**\n * Tool panel view. Events triggered include:\n * tool_link_click(click event, tool_model)\n */\nvar ToolPanelView = Backbone.View.extend({\n    tagName: \"div\",\n    className: \"toolMenu\",\n\n    /**\n     * Set up view.\n     */\n    initialize: function initialize() {\n        this.model.get(\"tool_search\").on(\"change:results\", this.handle_search_results, this);\n    },\n\n    render: function render() {\n        var self = this;\n\n        // Render search.\n        var search_view = new ToolSearchView({\n            model: this.model.get(\"tool_search\")\n        });\n        search_view.render();\n        self.$el.append(search_view.$el);\n\n        // Render panel.\n        this.model.get(\"layout\").each(function (panel_elt) {\n            if (panel_elt instanceof ToolSection) {\n                var section_title_view = new ToolSectionView({\n                    model: panel_elt\n                });\n                section_title_view.render();\n                self.$el.append(section_title_view.$el);\n            } else if (panel_elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: panel_elt,\n                    className: \"toolTitleNoSection\"\n                });\n                tool_view.render();\n                self.$el.append(tool_view.$el);\n            } else if (panel_elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: panel_elt\n                });\n                label_view.render();\n                self.$el.append(label_view.$el);\n            }\n        });\n\n        // Setup tool link click eventing.\n        self.$el.find(\"a.tool-link\").click(function (e) {\n            // Tool id is always the first class.\n            var tool_id = $(this).attr(\"class\").split(/\\s+/)[0];\n\n            var tool = self.model.get(\"tools\").get(tool_id);\n\n            self.trigger(\"tool_link_click\", e, tool);\n        });\n\n        return this;\n    },\n\n    handle_search_results: function handle_search_results() {\n        var results = this.model.get(\"tool_search\").get(\"results\");\n        if (results && results.length === 0) {\n            $(\"#search-no-results\").show();\n        } else {\n            $(\"#search-no-results\").hide();\n        }\n    }\n});\n\n/**\n * View for working with a tool: setting parameters and inputs and executing the tool.\n */\nvar ToolFormView = Backbone.View.extend({\n    className: \"toolForm\",\n\n    render: function render() {\n        this.$el.children().remove();\n        this.$el.append(templates.tool_form(this.model.toJSON()));\n    }\n});\n\n/**\n * Integrated tool menu + tool execution.\n */\nvar IntegratedToolMenuAndView = Backbone.View.extend({\n    className: \"toolMenuAndView\",\n\n    initialize: function initialize() {\n        this.tool_panel_view = new ToolPanelView({\n            collection: this.collection\n        });\n        this.tool_form_view = new ToolFormView();\n    },\n\n    render: function render() {\n        // Render and append tool panel.\n        this.tool_panel_view.render();\n        this.tool_panel_view.$el.css(\"float\", \"left\");\n        this.$el.append(this.tool_panel_view.$el);\n\n        // Append tool form view.\n        this.tool_form_view.$el.hide();\n        this.$el.append(this.tool_form_view.$el);\n\n        // On tool link click, show tool.\n        var self = this;\n        this.tool_panel_view.on(\"tool_link_click\", function (e, tool) {\n            // Prevents click from activating link:\n            e.preventDefault();\n            // Show tool that was clicked on:\n            self.show_tool(tool);\n        });\n    },\n\n    /**\n     * Fetch and display tool.\n     */\n    show_tool: function show_tool(tool) {\n        var self = this;\n        tool.fetch().done(function () {\n            self.tool_form_view.model = tool;\n            self.tool_form_view.render();\n            self.tool_form_view.$el.show();\n            $(\"#left\").width(\"650px\");\n        });\n    }\n});\n\n// TODO: move into relevant views\nvar templates = {\n    // the search bar at the top of the tool panel\n    tool_search: _.template(['<input id=\"tool-search-query\" class=\"search-query parent-width\" name=\"query\" ', 'placeholder=\"<%- search_hint_string %>\" autocomplete=\"off\" type=\"text\" />', '<a id=\"search-clear-btn\" title=\"clear search (esc)\"> </a>',\n    //TODO: replace with icon\n    '<span id=\"search-spinner\" class=\"search-spinner fa fa-spinner fa-spin\"></span>'].join(\"\")),\n\n    // the category level container in the tool panel (e.g. 'Get Data', 'Text Manipulation')\n    panel_section: _.template(['<div class=\"toolSectionTitle\" id=\"title_<%- id %>\">', '<a href=\"javascript:void(0)\"><span><%- name %></span></a>', \"</div>\", '<div id=\"<%- id %>\" class=\"toolSectionBody\" style=\"display: none;\">', '<div class=\"toolSectionBg\"></div>', \"<div>\"].join(\"\")),\n\n    // a single tool's link in the tool panel; will load the tool form in the center panel\n    tool_link: _.template(['<a class=\"<%- id %> tool-link\" href=\"<%= link %>\" target=\"<%- target %>\" minsizehint=\"<%- min_width %>\">', '<span class=\"labels\">', \"<% _.each( labels, function( label ){ %>\", '<span class=\"label label-default label-<%- label %>\">', \"<%- label %>\", \"</span>\", \"<% }); %>\", \"</span>\", '<span class=\"tool-old-link\">', \"<%- name %>\", \"</span>\", \" <%- description %>\", \"</a>\"].join(\"\")),\n\n    // the tool form for entering tool parameters, viewing help and executing the tool\n    // loaded when a tool link is clicked in the tool panel\n    tool_form: _.template(['<div class=\"toolFormTitle\"><%- tool.name %> (version <%- tool.version %>)</div>', '<div class=\"toolFormBody\">', \"<% _.each( tool.inputs, function( input ){ %>\", '<div class=\"form-row\">', '<label for=\"<%- input.name %>\"><%- input.label %>:</label>', '<div class=\"form-row-input\">', \"<%= input.html %>\", \"</div>\", '<div class=\"toolParamHelp\" style=\"clear: both;\">', \"<%- input.help %>\", \"</div>\", '<div style=\"clear: both;\"></div>', \"</div>\", \"<% }); %>\", \"</div>\", '<div class=\"form-row form-actions\">', '<input type=\"submit\" class=\"btn btn-primary\" name=\"runtool_btn\" value=\"Execute\" />', \"</div>\", '<div class=\"toolHelp\">', '<div class=\"toolHelpBody\"><% tool.help %></div>', \"</div>\"\n    // TODO: we need scoping here because 'help' is the dom for the help menu in the masthead\n    // which implies a leaky variable that I can't find\n    ].join(\"\"), { variable: \"tool\" })\n};\n\n// Exports\nexports.default = {\n    ToolParameter: ToolParameter,\n    IntegerToolParameter: IntegerToolParameter,\n    SelectToolParameter: SelectToolParameter,\n    Tool: Tool,\n    ToolCollection: ToolCollection,\n    ToolSearch: ToolSearch,\n    ToolPanel: ToolPanel,\n    ToolPanelView: ToolPanelView,\n    ToolFormView: ToolFormView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _toolFormBase = __webpack_require__(45);\n\nvar _toolFormBase2 = _interopRequireDefault(_toolFormBase);\n\nvar _webhooks = __webpack_require__(13);\n\nvar _webhooks2 = _interopRequireDefault(_webhooks);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.modal = parent.Galaxy.modal || new _uiModal2.default.View();\n        this.form = new _toolFormBase2.default(_utils2.default.merge({\n            listen_to_history: true,\n            always_refresh: false,\n            buildmodel: function buildmodel(process, form) {\n                var options = form.model.attributes;\n\n                // build request url\n                var build_url = \"\";\n                var build_data = {};\n                var job_id = options.job_id;\n                if (job_id) {\n                    build_url = Galaxy.root + \"api/jobs/\" + job_id + \"/build_for_rerun\";\n                } else {\n                    build_url = Galaxy.root + \"api/tools/\" + options.id + \"/build\";\n                    build_data = $.extend({}, Galaxy.params);\n                    build_data[\"tool_id\"] && delete build_data[\"tool_id\"];\n                }\n                options.version && (build_data[\"tool_version\"] = options.version);\n\n                // get initial model\n                _utils2.default.get({\n                    url: build_url,\n                    data: build_data,\n                    success: function success(data) {\n                        if (!data.display) {\n                            window.location = Galaxy.root;\n                            return;\n                        }\n                        form.model.set(data);\n                        self._customize(form);\n                        Galaxy.emit.debug(\"tool-form-base::_buildModel()\", \"Initial tool model ready.\", data);\n                        process.resolve();\n                    },\n                    error: function error(response, status) {\n                        var error_message = response && response.err_msg || \"Uncaught error.\";\n                        if (status == 401) {\n                            window.location = Galaxy.root + \"user/login?\" + $.param({\n                                redirect: Galaxy.root + \"?tool_id=\" + options.id\n                            });\n                        } else if (form.$el.is(\":empty\")) {\n                            form.$el.prepend(new _uiMisc2.default.Message({\n                                message: error_message,\n                                status: \"danger\",\n                                persistent: true,\n                                large: true\n                            }).$el);\n                        } else {\n                            Galaxy.modal && Galaxy.modal.show({\n                                title: \"Tool request failed\",\n                                body: error_message,\n                                buttons: {\n                                    Close: function Close() {\n                                        Galaxy.modal.hide();\n                                    }\n                                }\n                            });\n                        }\n                        Galaxy.emit.debug(\"tool-form-base::_buildModel()\", \"Initial tool model request failed.\", response);\n                        process.reject();\n                    }\n                });\n            },\n            postchange: function postchange(process, form) {\n                var current_state = {\n                    tool_id: form.model.get(\"id\"),\n                    tool_version: form.model.get(\"version\"),\n                    inputs: $.extend(true, {}, form.data.create())\n                };\n                form.wait(true);\n                Galaxy.emit.debug(\"tool-form::postchange()\", \"Sending current state.\", current_state);\n                _utils2.default.request({\n                    type: \"POST\",\n                    url: Galaxy.root + \"api/tools/\" + form.model.get(\"id\") + \"/build\",\n                    data: current_state,\n                    success: function success(data) {\n                        form.update(data);\n                        form.wait(false);\n                        Galaxy.emit.debug(\"tool-form::postchange()\", \"Received new model.\", data);\n                        process.resolve();\n                    },\n                    error: function error(response) {\n                        Galaxy.emit.debug(\"tool-form::postchange()\", \"Refresh request failed.\", response);\n                        process.reject();\n                    }\n                });\n            }\n        }, options));\n        this.deferred = this.form.deferred;\n        this.setElement(\"<div/>\");\n        this.$el.append(this.form.$el);\n    },\n\n    _customize: function _customize(form) {\n        var self = this;\n        var options = form.model.attributes;\n        // build execute button\n        var execute_button = new _uiMisc2.default.Button({\n            icon: \"fa-check\",\n            tooltip: \"Execute: \" + options.name + \" (\" + options.version + \")\",\n            title: \"Execute\",\n            cls: \"btn btn-primary ui-clear-float\",\n            wait_cls: \"btn btn-info ui-clear-float\",\n            onclick: function onclick() {\n                execute_button.wait();\n                form.portlet.disable();\n                self.submit(options, function () {\n                    execute_button.unwait();\n                    form.portlet.enable();\n                });\n            }\n        });\n        options.buttons = { execute: execute_button };\n\n        // remap feature\n        if (options.job_id && options.job_remap) {\n            options.inputs.push({\n                label: \"Resume dependencies from this job\",\n                name: \"rerun_remap_job_id\",\n                type: \"select\",\n                display: \"radio\",\n                ignore: \"__ignore__\",\n                value: \"__ignore__\",\n                options: [[\"Yes\", options.job_id], [\"No\", \"__ignore__\"]],\n                help: \"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.\"\n            });\n        }\n    },\n\n    /** Submit a regular job.\n     * @param{dict}     options   - Specifies tool id and version\n     * @param{function} callback  - Called when request has completed\n     */\n    submit: function submit(options, callback) {\n        var self = this;\n        var job_def = {\n            tool_id: options.id,\n            tool_version: options.version,\n            inputs: this.form.data.create()\n        };\n        this.form.trigger(\"reset\");\n        if (!self.validate(job_def)) {\n            Galaxy.emit.debug(\"tool-form::submit()\", \"Submission canceled. Validation failed.\");\n            callback && callback();\n            return;\n        }\n        if (options.action !== Galaxy.root + \"tool_runner/index\") {\n            var $f = $(\"<form/>\").attr({\n                action: options.action,\n                method: options.method,\n                enctype: options.enctype\n            });\n            _.each(job_def.inputs, function (value, key) {\n                $f.append($(\"<input/>\").attr({ name: key, value: value }));\n            });\n            $f.hide().appendTo(\"body\").submit().remove();\n            callback && callback();\n            return;\n        }\n        Galaxy.emit.debug(\"tool-form::submit()\", \"Validation complete.\", job_def);\n        _utils2.default.request({\n            type: \"POST\",\n            url: Galaxy.root + \"api/tools\",\n            data: job_def,\n            success: function success(response) {\n                callback && callback();\n                self.$el.children().hide();\n                self.$el.append(self._templateSuccess(response));\n                // Show Webhook if job is running\n                if (response.jobs && response.jobs.length > 0) {\n                    self.$el.append($(\"<div/>\", { id: \"webhook-view\" }));\n                    var WebhookApp = new _webhooks2.default.WebhookView({\n                        urlRoot: Galaxy.root + \"api/webhooks/tool\",\n                        toolId: job_def.tool_id\n                    });\n                }\n                parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.refreshContents();\n            },\n            error: function error(response) {\n                callback && callback();\n                Galaxy.emit.debug(\"tool-form::submit\", \"Submission failed.\", response);\n                var input_found = false;\n                if (response && response.err_data) {\n                    var error_messages = self.form.data.matchResponse(response.err_data);\n                    for (var input_id in error_messages) {\n                        self.form.highlight(input_id, error_messages[input_id]);\n                        input_found = true;\n                        break;\n                    }\n                }\n                if (!input_found) {\n                    self.modal.show({\n                        title: \"Job submission failed\",\n                        body: self._templateError(job_def, response && response.err_msg),\n                        buttons: {\n                            Close: function Close() {\n                                self.modal.hide();\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    /** Validate job dictionary.\n     * @param{dict}     job_def   - Job execution dictionary\n     */\n    validate: function validate(job_def) {\n        var job_inputs = job_def.inputs;\n        var batch_n = -1;\n        var batch_src = null;\n        for (var job_input_id in job_inputs) {\n            var input_value = job_inputs[job_input_id];\n            var input_id = this.form.data.match(job_input_id);\n            var input_field = this.form.field_list[input_id];\n            var input_def = this.form.input_list[input_id];\n            if (!input_id || !input_def || !input_field) {\n                Galaxy.emit.debug(\"tool-form::validate()\", \"Retrieving input objects failed.\");\n                continue;\n            }\n            if (!input_def.optional && input_value == null) {\n                this.form.highlight(input_id);\n                return false;\n            }\n            if (input_value && input_value.batch) {\n                var n = input_value.values.length;\n                var src = n > 0 && input_value.values[0] && input_value.values[0].src;\n                if (src) {\n                    if (batch_src === null) {\n                        batch_src = src;\n                    } else if (batch_src !== src) {\n                        this.form.highlight(input_id, \"Please select either dataset or dataset list fields for all batch mode fields.\");\n                        return false;\n                    }\n                }\n                if (batch_n === -1) {\n                    batch_n = n;\n                } else if (batch_n !== n) {\n                    this.form.highlight(input_id, \"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>\" + n + \"</b> selection(s) while a previous field contains <b>\" + batch_n + \"</b>.\");\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n\n    _templateSuccess: function _templateSuccess(response) {\n        if (response.jobs && response.jobs.length > 0) {\n            var njobs = response.jobs.length;\n            var njobs_text = njobs == 1 ? \"1 job has\" : njobs + \" jobs have\";\n            var $message = $(\"<div/>\").addClass(\"donemessagelarge\").append($(\"<p/>\").text(njobs_text + \" been successfully added to the queue - resulting in the following datasets:\"));\n            _.each(response.outputs, function (output) {\n                $message.append($(\"<p/>\").addClass(\"messagerow\").append($(\"<b/>\").text(output.hid + \": \" + output.name)));\n            });\n            $message.append($(\"<p/>\").append(\"<b/>\").text(\"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"));\n            return $message;\n        } else {\n            return this._templateError(response, \"Invalid success response. No jobs found.\");\n        }\n    },\n\n    _templateError: function _templateError(response, err_msg) {\n        return $(\"<div/>\").addClass(\"errormessagelarge\").append($(\"<p/>\").text(\"The server could not complete the request. Please contact the Galaxy Team if this error persists. \" + (err_msg || \"\"))).append($(\"<pre/>\").text(JSON.stringify(response, null, 4)));\n    }\n}); /* This is the regular tool form */\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n// dependencies\n\n// grid model\nexports.default = Backbone.Model.extend({\n    defaults: {\n        url_base: \"\",\n        async: false,\n        async_ops: [],\n        categorical_filters: [],\n        filters: {},\n        sort_key: null,\n        show_item_checkboxes: false,\n        advanced_search: false,\n        cur_page: 1,\n        num_pages: 1,\n        operation: undefined,\n        item_ids: undefined\n    },\n\n    /**\n     * Return true if operation can be done asynchronously.\n     */\n    can_async_op: function can_async_op(op) {\n        return _.indexOf(this.attributes.async_ops, op) !== -1;\n    },\n\n    /**\n     * Add filtering criterion.\n     */\n    add_filter: function add_filter(key, value, append) {\n        // Update URL arg with new condition.\n        if (append) {\n            // Update or append value.\n            var cur_val = this.attributes.filters[key];\n\n            var new_val;\n            if (cur_val === null || cur_val === undefined) {\n                new_val = value;\n            } else if (typeof cur_val == \"string\") {\n                if (cur_val == \"All\" || cur_val == value) {\n                    new_val = value;\n                } else {\n                    // Replace string with array.\n                    var values = [];\n                    values[0] = cur_val;\n                    values[1] = value;\n                    new_val = values;\n                }\n            } else {\n                // Current value is an array.\n                new_val = cur_val;\n                if (new_val.indexOf(value) === -1) {\n                    new_val.push(value);\n                }\n            }\n            this.attributes.filters[key] = new_val;\n        } else {\n            // Replace value.\n            this.attributes.filters[key] = value;\n        }\n    },\n\n    /**\n     * Remove filtering criterion.\n     */\n    remove_filter: function remove_filter(key, condition) {\n        var cur_val = this.attributes.filters[key];\n        if (cur_val === null || cur_val === undefined) {\n            return false;\n        }\n\n        if (typeof cur_val === \"string\") {\n            // overwrite/remove condition.\n            this.attributes.filters[key] = \"\";\n        } else {\n            // filter contains an array of conditions.\n            var condition_index = _.indexOf(cur_val, condition);\n            if (condition_index !== -1) {\n                cur_val[condition_index] = \"\";\n            }\n        }\n    },\n\n    /**\n     * Returns URL data for obtaining a new grid.\n     */\n    get_url_data: function get_url_data() {\n        var url_data = {\n            async: this.attributes.async,\n            sort: this.attributes.sort_key,\n            page: this.attributes.cur_page,\n            show_item_checkboxes: this.attributes.show_item_checkboxes,\n            advanced_search: this.attributes.advanced_search\n        };\n\n        // Add operation, item_ids only if they have values.\n        if (this.attributes.operation) {\n            url_data.operation = this.attributes.operation;\n        }\n        if (this.attributes.item_ids) {\n            url_data.id = this.attributes.item_ids;\n        }\n\n        // Add filter arguments to data, placing \"f-\" in front of all arguments.\n        var self = this;\n        _.each(_.pairs(self.attributes.filters), function (k) {\n            url_data[\"f-\" + k[0]] = k[1];\n        });\n        return url_data;\n    },\n\n    // Return URL for obtaining a new grid\n    get_url: function get_url(args) {\n        return this.get(\"url_base\") + \"?\" + $.param(this.get_url_data()) + \"&\" + $.param(args);\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// grid view templates\nexports.default = {\n    // template\n    grid: function grid(options) {\n        var tmpl = \"\";\n        if (options.embedded) {\n            tmpl = this.grid_header(options) + this.grid_table(options);\n        } else {\n            tmpl = \"<div class=\\\"loading-elt-overlay\\\"></div><table><tr><td width=\\\"75%\\\">\" + this.grid_header(options) + \"</td><td></td><td></td></tr><tr><td width=\\\"100%\\\" id=\\\"grid-message\\\" valign=\\\"top\\\"></td><td></td><td></td></tr></table>\" + this.grid_table(options);\n        }\n\n        // add info text\n        if (options.info_text) {\n            tmpl += \"<br><div class=\\\"toolParamHelp\\\" style=\\\"clear: both;\\\">\" + options.info_text + \"</div>\";\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    grid_table: function grid_table(options) {\n        return '<form method=\"post\" onsubmit=\"return false;\">' + '<table id=\"grid-table\" class=\"grid\">' + '<thead id=\"grid-table-header\"></thead>' + '<tbody id=\"grid-table-body\"></tbody>' + '<tfoot id=\"grid-table-footer\"></tfoot>' + \"</table>\" + \"</form>\";\n    },\n\n    // template\n    grid_header: function grid_header(options) {\n        var tmpl = '<div class=\"grid-header\">';\n        if (!options.embedded) {\n            tmpl += \"<h2>\" + options.title + \"</h2>\";\n        }\n        if (options.global_actions) {\n            tmpl += '<ul class=\"manage-table-actions\">';\n            var show_popup = options.global_actions.length >= 3;\n            if (show_popup) {\n                tmpl += '<li><a class=\"action-button\" id=\"popup-global-actions\" class=\"menubutton\">Actions</a></li>' + '<div popupmenu=\"popup-global-actions\">';\n            }\n            for (var i in options.global_actions) {\n                var action = options.global_actions[i];\n                tmpl += \"<li><a class=\\\"action-button use-target\\\" target=\\\"\" + action.target + \"\\\" href=\\\"\" + action.url_args + \"\\\" onclick=\\\"return false;\\\" >\" + action.label + \"</a></li>\";\n            }\n            if (show_popup) {\n                tmpl += \"</div>\";\n            }\n            tmpl += \"</ul>\";\n        }\n        if (options.insert) {\n            tmpl += options.insert;\n        }\n\n        // add grid filters\n        tmpl += this.grid_filters(options);\n        tmpl += \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    header: function header(options) {\n        // start\n        var tmpl = \"<tr>\";\n\n        // add checkbox\n        if (options.show_item_checkboxes) {\n            tmpl += \"<th>\";\n            if (options.items.length > 0) {\n                tmpl += '<input type=\"checkbox\" id=\"check_all\" name=select_all_checkbox value=\"true\">' + '<input type=\"hidden\" name=select_all_checkbox value=\"true\">';\n            }\n            tmpl += \"</th>\";\n        }\n\n        // create header elements\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.visible) {\n                tmpl += \"<th id=\\\"\" + column.key + \"-header\\\">\";\n                if (column.href) {\n                    tmpl += \"<a href=\\\"\" + column.href + \"\\\" class=\\\"sort-link\\\" sort_key=\\\"\" + column.key + \"\\\">\" + column.label + \"</a>\";\n                } else {\n                    tmpl += column.label;\n                }\n                tmpl += \"<span class=\\\"sort-arrow\\\">\" + column.extra + \"</span></th>\";\n            }\n        }\n\n        // finalize\n        tmpl += \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    body: function body(options) {\n        // initialize\n        var tmpl = \"\";\n        var num_rows_rendered = 0;\n        var items_length = options.items.length;\n\n        // empty grid?\n        if (items_length == 0) {\n            // No results.\n            tmpl += '<tr><td colspan=\"100\"><em>No Items</em></td></tr>';\n            num_rows_rendered = 1;\n        }\n\n        // create rows\n        for (var i in options.items) {\n            // encode ids\n            var item = options.items[i];\n            var encoded_id = item.encode_id;\n            var popupmenu_id = \"grid-\" + i + \"-popup\";\n\n            // Tag current\n            tmpl += \"<tr \";\n            if (options.current_item_id == item.id) {\n                tmpl += 'class=\"current\"';\n            }\n            tmpl += \">\";\n\n            // Item selection column\n            if (options.show_item_checkboxes) {\n                tmpl += \"<td style=\\\"width: 1.5em;\\\"><input type=\\\"checkbox\\\" name=\\\"id\\\" value=\\\"\" + encoded_id + \"\\\" id=\\\"\" + encoded_id + \"\\\" class=\\\"grid-row-select-checkbox\\\" /></td>\";\n            }\n\n            // Data columns\n            for (var j in options.columns) {\n                var column = options.columns[j];\n                if (column.visible) {\n                    // Nowrap\n                    var nowrap = \"\";\n                    if (column.nowrap) {\n                        nowrap = 'style=\"white-space:nowrap;\"';\n                    }\n\n                    // get column settings\n                    var column_settings = item.column_config[column.label];\n\n                    // load attributes\n                    var link = column_settings.link;\n                    var value = column_settings.value;\n                    var target = column_settings.target;\n\n                    // unescape value\n                    if (jQuery.type(value) === \"string\") {\n                        value = value.replace(/\\/\\//g, \"/\");\n                    }\n\n                    // Attach popup menu?\n                    var id = \"\";\n                    var cls = \"\";\n                    if (column.attach_popup) {\n                        id = \"grid-\" + i + \"-popup\";\n                        cls = \"menubutton\";\n                        if (link != \"\") {\n                            cls += \" split\";\n                        }\n                        cls += \" popup\";\n                    }\n\n                    // Check for row wrapping\n                    tmpl += \"<td \" + nowrap + \">\";\n\n                    // Link\n                    if (link) {\n                        if (options.operations.length != 0) {\n                            tmpl += \"<div id=\\\"\" + id + \"\\\" class=\\\"\" + cls + \"\\\" style=\\\"float: left;\\\">\";\n                        }\n                        tmpl += \"<a class=\\\"menubutton-label use-target\\\" target=\\\"\" + target + \"\\\" href=\\\"\" + link + \"\\\" onclick=\\\"return false;\\\">\" + value + \"</a>\";\n                        if (options.operations.length != 0) {\n                            tmpl += \"</div>\";\n                        }\n                    } else {\n                        tmpl += \"<div id=\\\"\" + id + \"\\\" class=\\\"\" + cls + \"\\\"><label id=\\\"\" + column.label_id_prefix + encoded_id + \"\\\" for=\\\"\" + encoded_id + \"\\\">\" + (value || \"\") + \"</label></div>\";\n                    }\n                    tmpl += \"</td>\";\n                }\n            }\n            tmpl += \"</tr>\";\n            num_rows_rendered++;\n        }\n        return tmpl;\n    },\n\n    // template\n    footer: function footer(options) {\n        // create template string\n        var tmpl = \"\";\n\n        // paging\n        if (options.use_paging && options.num_pages > 1) {\n            // get configuration\n            var num_page_links = options.num_page_links;\n            var cur_page_num = options.cur_page_num;\n            var num_pages = options.num_pages;\n\n            // First pass on min page.\n            var page_link_range = num_page_links / 2;\n            var min_page = cur_page_num - page_link_range;\n            var min_offset = 0;\n            if (min_page <= 0) {\n                // Min page is too low.\n                min_page = 1;\n                min_offset = page_link_range - (cur_page_num - min_page);\n            }\n\n            // Set max page.\n            var max_range = page_link_range + min_offset;\n            var max_page = cur_page_num + max_range;\n            var max_offset;\n            if (max_page <= num_pages) {\n                // Max page is fine.\n                max_offset = 0;\n            } else {\n                // Max page is too high.\n                max_page = num_pages;\n                // +1 to account for the +1 in the loop below.\n                max_offset = max_range - (max_page + 1 - cur_page_num);\n            }\n\n            // Second and final pass on min page to add any unused\n            // offset from max to min.\n            if (max_offset != 0) {\n                min_page -= max_offset;\n                if (min_page < 1) {\n                    min_page = 1;\n                }\n            }\n\n            // template header\n            tmpl += '<tr id=\"page-links-row\">';\n            if (options.show_item_checkboxes) {\n                tmpl += \"<td></td>\";\n            }\n            tmpl += '<td colspan=\"100\">' + '<span id=\"page-link-container\">' + \"Page:\";\n\n            if (min_page > 1) {\n                tmpl += '<span class=\"page-link\" id=\"page-link-1\"><a href=\"javascript:void(0);\" page_num=\"1\" onclick=\"return false;\">1</a></span> ...';\n            }\n\n            // create page urls\n            for (var page_index = min_page; page_index < max_page + 1; page_index++) {\n                if (page_index == options.cur_page_num) {\n                    tmpl += \"<span class=\\\"page-link inactive-link\\\" id=\\\"page-link-\" + page_index + \"\\\">\" + page_index + \"</span>\";\n                } else {\n                    tmpl += \"<span class=\\\"page-link\\\" id=\\\"page-link-\" + page_index + \"\\\"><a href=\\\"javascript:void(0);\\\" onclick=\\\"return false;\\\" page_num=\\\"\" + page_index + \"\\\">\" + page_index + \"</a></span>\";\n                }\n            }\n\n            // show last page\n            if (max_page < num_pages) {\n                tmpl += \"...<span class=\\\"page-link\\\" id=\\\"page-link-\" + num_pages + \"\\\"><a href=\\\"javascript:void(0);\\\" onclick=\\\"return false;\\\" page_num=\\\"\" + num_pages + \"\\\">\" + num_pages + \"</a></span>\";\n            }\n            tmpl += \"</span>\";\n\n            // Show all link\n            tmpl += '<span class=\"page-link\" id=\"show-all-link-span\"> | <a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"all\">Show All</a></span>' + \"</td>\" + \"</tr>\";\n        }\n\n        // Grid operations for multiple items.\n        if (options.show_item_checkboxes) {\n            // start template\n            tmpl += \"<tr>\" + '<input type=\"hidden\" id=\"operation\" name=\"operation\" value=\"\">' + \"<td></td>\" + '<td colspan=\"100\">' + 'For <span class=\"grid-selected-count\"></span> selected items: ';\n\n            // configure buttons for operations\n            for (var i in options.operations) {\n                var operation = options.operations[i];\n                if (operation.allow_multiple) {\n                    tmpl += \"<input type=\\\"button\\\" value=\\\"\" + operation.label + \"\\\" class=\\\"operation-button action-button\\\">&nbsp;\";\n                }\n            }\n\n            // finalize template\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // count global operations\n        var found_global = false;\n        for (i in options.operations) {\n            if (options.operations[i].global_operation) {\n                found_global = true;\n                break;\n            }\n        }\n\n        // add global operations\n        if (found_global) {\n            tmpl += \"<tr>\" + '<td colspan=\"100\">';\n            for (i in options.operations) {\n                var operation = options.operations[i];\n                if (operation.global_operation) {\n                    tmpl += \"<a class=\\\"action-button\\\" href=\\\"\" + operation.global_operation + \"\\\">\" + operation.label + \"</a>\";\n                }\n            }\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // add legend\n        if (options.legend) {\n            tmpl += \"<tr><td colspan=\\\"100\\\">\" + options.legend + \"</td></tr>\";\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    message: function message(options) {\n        var status = options.status;\n        if ([\"success\", \"ok\"].indexOf(status) != -1) {\n            status = \"done\";\n        }\n        return \"<p><div class=\\\"\" + status + \"message transient-message\\\">\" + _.escape(options.message) + \"</div><div style=\\\"clear: both\\\"></div></p>\";\n    },\n\n    // template\n    grid_filters: function grid_filters(options) {\n        // get filters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n\n        // show advanced search if flag set or if there are filters for advanced search fields\n        var advanced_search_display = \"none\";\n        if (options.advanced_search) {\n            advanced_search_display = \"block\";\n        }\n\n        // identify columns with advanced filtering\n        var show_advanced_search_link = false;\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"advanced\") {\n                var column_key = column.key;\n                var f_key = filters[column_key];\n                var d_key = default_filter_dict[column_key];\n                if (f_key && d_key && f_key != d_key) {\n                    advanced_search_display = \"block\";\n                }\n                show_advanced_search_link = true;\n            }\n        }\n\n        // hide standard search if advanced is shown\n        var standard_search_display = \"block\";\n        if (advanced_search_display == \"block\") {\n            standard_search_display = \"none\";\n        }\n\n        //\n        // standard search\n        //\n        var tmpl = \"<div id=\\\"standard-search\\\" style=\\\"display: \" + standard_search_display + \";\\\"><table><tr><td style=\\\"padding: 0;\\\"><table>\";\n\n        // add standard filters\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"standard\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize standard search\n        tmpl += \"</table>\" + \"</td>\" + \"</tr>\" + \"<tr>\" + \"<td>\";\n\n        // show advanced search link in standard display\n        if (show_advanced_search_link) {\n            tmpl += '<a href=\"\" class=\"advanced-search-toggle\">Advanced Search</a>';\n        }\n\n        // finalize standard search display\n        tmpl += \"</td>\" + \"</tr>\" + \"</table>\" + \"</div>\";\n\n        //\n        // advanced search\n        //\n        tmpl += \"<div id=\\\"advanced-search\\\" style=\\\"display: \" + advanced_search_display + \"; margin-top: 5px; border: 1px solid #ccc;\\\"><table><tr><td style=\\\"text-align: left\\\" colspan=\\\"100\\\"><a href=\\\"\\\" class=\\\"advanced-search-toggle\\\">Close Advanced Search</a></td></tr>\";\n\n        // add advanced filters\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"advanced\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize advanced search template\n        tmpl += \"</table>\" + \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    grid_column_filter: function grid_column_filter(options, column) {\n        // collect parameters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n        var column_label = column.label;\n        var column_key = column.key;\n        if (column.filterable == \"advanced\") {\n            column_label = column_label.toLowerCase();\n        }\n\n        // start\n        var tmpl = \"<tr>\";\n\n        if (column.filterable == \"advanced\") {\n            tmpl += \"<td align=\\\"left\\\" style=\\\"padding-left: 10px\\\">\" + column_label + \":</td>\";\n        }\n        tmpl += '<td style=\"padding-bottom: 1px;\">';\n        if (column.is_text) {\n            tmpl += \"<form class=\\\"text-filter-form\\\" column_key=\\\"\" + column_key + \"\\\" action=\\\"\" + options.url + \"\\\" method=\\\"get\\\" >\";\n            // Carry forward filtering criteria with hidden inputs.\n            for (i in options.columns) {\n                var temp_column = options.columns[i];\n                var filter_value = filters[temp_column.key];\n                if (filter_value) {\n                    if (filter_value != \"All\") {\n                        if (temp_column.is_text) {\n                            filter_value = JSON.stringify(filter_value);\n                        }\n                        tmpl += \"<input type=\\\"hidden\\\" id=\\\"\" + temp_column.key + \"\\\" name=\\\"f-\" + temp_column.key + \"\\\" value=\\\"\" + filter_value + \"\\\"/>\";\n                    }\n                }\n            }\n            // Print current filtering criteria and links to delete.\n            tmpl += \"<span id=\\\"\" + column_key + \"-filtering-criteria\\\">\";\n\n            // add filters\n            var column_filter = filters[column_key];\n            if (column_filter) {\n                // identify type\n                var type = jQuery.type(column_filter);\n\n                // single filter value\n                if (type == \"string\") {\n                    if (column_filter != \"All\") {\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter);\n                    }\n                }\n\n                // multiple filter values\n                if (type == \"array\") {\n                    for (var i in column_filter) {\n                        // get filter\n                        var filter = column_filter[i];\n\n                        // copy filters and remove entry\n                        var params = column_filter;\n                        params = params.slice(i);\n\n                        // append template\n                        tmpl += this.filter_element(column_key, filter);\n                    }\n                }\n            }\n\n            // close span\n            tmpl += \"</span>\";\n\n            // Set value, size of search input field. Minimum size is 20 characters.\n            var value = \"\";\n            if (column.filterable == \"standard\") {\n                value = column.label.toLowerCase();\n                var size = value.length;\n                if (size < 20) {\n                    size = 20;\n                }\n                // +4 to account for space after placeholder\n                size = size + 4;\n            }\n\n            // print input field for column\n            tmpl += \"<span class=\\\"search-box\\\"><input class=\\\"search-box-input\\\" id=\\\"input-\" + column_key + \"-filter\\\" name=\\\"f-\" + column_key + \"\\\" type=\\\"text\\\" placeholder=\\\"\" + value + \"\\\" size=\\\"\" + size + \"\\\"/><button type=\\\"submit\\\" style=\\\"background: transparent; border: none; padding: 4px; margin: 0px;\\\"><i class=\\\"fa fa-search\\\"></i></button></span></form>\";\n        } else {\n            // filter criteria\n            tmpl += \"<span id=\\\"\" + column_key + \"-filtering-criteria\\\">\";\n\n            // add category filters\n            var seperator = false;\n            for (var cf_label in options.categorical_filters[column_key]) {\n                // get category filter\n                var cf = options.categorical_filters[column_key][cf_label];\n\n                // each filter will have only a single argument, so get that single argument\n                var cf_key = \"\";\n                var cf_arg = \"\";\n                for (var key in cf) {\n                    cf_key = key;\n                    cf_arg = cf[key];\n                }\n\n                // add seperator\n                if (seperator) {\n                    tmpl += \" | \";\n                }\n                seperator = true;\n\n                // add category\n                var filter = filters[column_key];\n                if (filter && cf[column_key] && filter == cf_arg) {\n                    tmpl += \"<span class=\\\"categorical-filter \" + column_key + \"-filter current-filter\\\">\" + cf_label + \"</span>\";\n                } else {\n                    tmpl += \"<span class=\\\"categorical-filter \" + column_key + \"-filter\\\"><a href=\\\"javascript:void(0);\\\" filter_key=\\\"\" + cf_key + \"\\\" filter_val=\\\"\" + cf_arg + \"\\\">\" + cf_label + \"</a></span>\";\n                }\n            }\n            tmpl += \"</span>\";\n        }\n        tmpl += \"</td>\" + \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template for filter items\n    filter_element: function filter_element(filter_key, filter_value) {\n        filter_value = _utils2.default.sanitize(filter_value);\n        return \"<span class=\\\"text-filter-val\\\">\" + filter_value + \"<a href=\\\"javascript:void(0);\\\" filter_key=\\\"\" + filter_key + \"\\\" filter_val=\\\"\" + filter_value + \"\\\"><i class=\\\"fa fa-times\\\" style=\\\"padding-left: 5px; padding-bottom: 6px;\\\"/></a></span>\";\n    }\n}; // dependencies\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _tracks = __webpack_require__(27);\n\nvar _tracks2 = _interopRequireDefault(_tracks);\n\nvar _visualization = __webpack_require__(7);\n\nvar _visualization2 = _interopRequireDefault(_visualization);\n\nvar _iconButton = __webpack_require__(14);\n\nvar _iconButton2 = _interopRequireDefault(_iconButton);\n\nvar _queryStringParsing = __webpack_require__(17);\n\nvar _queryStringParsing2 = _interopRequireDefault(_queryStringParsing);\n\nvar _gridView = __webpack_require__(12);\n\nvar _gridView2 = _interopRequireDefault(_gridView);\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\n__webpack_require__(50);\n\n__webpack_require__(49);\n\n__webpack_require__(51);\n\n__webpack_require__(55);\n\n__webpack_require__(54);\n\n__webpack_require__(40);\n\n__webpack_require__(52);\n\n__webpack_require__(53);\n\n__webpack_require__(15);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * Top-level trackster code, used for creating/loading visualizations and user interface elements.\n */\n\n// global variables\nvar ui = null;\nvar view = null;\nvar browser_router = null;\n\n// trackster viewer\n\n/**\n * Base Object/Model for inhertiance.\n */\nvar Base = function Base() {\n    if (this.initialize) {\n        this.initialize.apply(this, arguments);\n    }\n};\nBase.extend = Backbone.Model.extend;\n\n/**\n * User interface controls for trackster\n */\nvar TracksterUI = Base.extend({\n    initialize: function initialize(baseURL) {\n        _utils2.default.cssLoadFile(\"static/style/jquery.rating.css\");\n        _utils2.default.cssLoadFile(\"static/style/autocomplete_tagging.css\");\n        _utils2.default.cssLoadFile(\"static/style/jquery-ui/smoothness/jquery-ui.css\");\n        _utils2.default.cssLoadFile(\"static/style/library.css\");\n        _utils2.default.cssLoadFile(\"static/style/trackster.css\");\n        this.baseURL = baseURL;\n    },\n\n    /**\n     * Save visualization, returning a Deferred object for the remote call to save.\n     */\n    save_viz: function save_viz() {\n        // show dialog\n        Galaxy.modal.show({ title: \"Saving...\", body: \"progress\" });\n\n        // Save bookmarks.\n        var bookmarks = [];\n        $(\".bookmark\").each(function () {\n            bookmarks.push({\n                position: $(this).children(\".position\").text(),\n                annotation: $(this).children(\".annotation\").text()\n            });\n        });\n\n        // FIXME: give unique IDs to Drawables and save overview as ID.\n        var overview_track_name = view.overview_drawable ? view.overview_drawable.config.get_value(\"name\") : null;\n\n        var viz_config = {\n            view: view.to_dict(),\n            viewport: {\n                chrom: view.chrom,\n                start: view.low,\n                end: view.high,\n                overview: overview_track_name\n            },\n            bookmarks: bookmarks\n        };\n\n        // Make call to save visualization.\n        return $.ajax({\n            url: Galaxy.root + \"visualization/save\",\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                id: view.vis_id,\n                title: view.config.get_value(\"name\"),\n                dbkey: view.dbkey,\n                type: \"trackster\",\n                vis_json: JSON.stringify(viz_config)\n            }\n        }).success(function (vis_info) {\n            Galaxy.modal.hide();\n            view.vis_id = vis_info.vis_id;\n            view.has_changes = false;\n\n            // Needed to set URL when first saving a visualization.\n            window.history.pushState({}, \"\", vis_info.url + window.location.hash);\n        }).error(function () {\n            // show dialog\n            Galaxy.modal.show({\n                title: \"Could Not Save\",\n                body: \"Could not save visualization. Please try again later.\",\n                buttons: {\n                    Cancel: function Cancel() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    },\n\n    /**\n     * Create button menu\n     */\n    createButtonMenu: function createButtonMenu() {\n        var self = this;\n\n        var menu = _iconButton2.default.create_icon_buttons_menu([{\n            icon_class: \"plus-button\",\n            title: \"Add tracks\",\n            on_click: function on_click() {\n                _visualization2.default.select_datasets({ dbkey: view.dbkey }, function (new_tracks) {\n                    _.each(new_tracks, function (track) {\n                        view.add_drawable(_tracks2.default.object_from_template(track, view, view));\n                    });\n                });\n            }\n        }, {\n            icon_class: \"block--plus\",\n            title: \"Add group\",\n            on_click: function on_click() {\n                view.add_drawable(new _tracks2.default.DrawableGroup(view, view, {\n                    name: \"New Group\"\n                }));\n            }\n        }, {\n            icon_class: \"bookmarks\",\n            title: \"Bookmarks\",\n            on_click: function on_click() {\n                // HACK -- use style to determine if panel is hidden and hide/show accordingly.\n                force_right_panel($(\"div#right\").css(\"right\") == \"0px\" ? \"hide\" : \"show\");\n            }\n        }, {\n            icon_class: \"globe\",\n            title: \"Circster\",\n            on_click: function on_click() {\n                window.location = self.baseURL + \"visualization/circster?id=\" + view.vis_id;\n            }\n        }, {\n            icon_class: \"disk--arrow\",\n            title: \"Save\",\n            on_click: function on_click() {\n                self.save_viz();\n            }\n        }, {\n            icon_class: \"cross-circle\",\n            title: \"Close\",\n            on_click: function on_click() {\n                self.handle_unsaved_changes(view);\n            }\n        }], {\n            tooltip_config: { placement: \"bottom\" }\n        });\n\n        this.buttonMenu = menu;\n        return menu;\n    },\n\n    /**\n     * Add bookmark.\n     */\n    add_bookmark: function add_bookmark(position, annotation, editable) {\n        // Create HTML.\n        var bookmarks_container = $(\"#right .unified-panel-body\");\n\n        var new_bookmark = $(\"<div/>\").addClass(\"bookmark\").appendTo(bookmarks_container);\n\n        var position_div = $(\"<div/>\").addClass(\"position\").appendTo(new_bookmark);\n\n        var position_link = $(\"<a href=''/>\").text(position).appendTo(position_div).click(function () {\n            view.go_to(position);\n            return false;\n        });\n\n        var annotation_div = $(\"<div/>\").text(annotation).appendTo(new_bookmark);\n\n        // If editable, enable bookmark deletion and annotation editing.\n        if (editable) {\n            var delete_icon_container = $(\"<div/>\").addClass(\"delete-icon-container\").prependTo(new_bookmark).click(function () {\n                // Remove bookmark.\n                new_bookmark.slideUp(\"fast\");\n                new_bookmark.remove();\n                view.has_changes = true;\n                return false;\n            });\n\n            var delete_icon = $(\"<a href=''/>\").addClass(\"icon-button delete\").appendTo(delete_icon_container);\n\n            annotation_div.make_text_editable({\n                num_rows: 3,\n                use_textarea: true,\n                help_text: \"Edit bookmark note\"\n            }).addClass(\"annotation\");\n        }\n\n        view.has_changes = true;\n        return new_bookmark;\n    },\n\n    /**\n     * Create a complete Trackster visualization. Returns view.\n     */\n    create_visualization: function create_visualization(view_config, viewport_config, drawables_config, bookmarks_config, editable) {\n        // Create view.\n        var self = this;\n\n        var view = new _tracks2.default.TracksterView(_.extend(view_config, { header: false }));\n\n        view.editor = true;\n        $.when(view.load_chroms_deferred).then(function (chrom_info) {\n            // Viewport config.\n            if (viewport_config) {\n                var chrom = viewport_config.chrom;\n                var start = viewport_config.start;\n                var end = viewport_config.end;\n                var overview_drawable_name = viewport_config.overview;\n\n                if (chrom && start !== undefined && end) {\n                    view.change_chrom(chrom, start, end);\n                } else {\n                    // No valid viewport, so use first chromosome.\n                    view.change_chrom(chrom_info[0].chrom);\n                }\n            } else {\n                // No viewport, so use first chromosome.\n                view.change_chrom(chrom_info[0].chrom);\n            }\n\n            // Add drawables to view.\n            if (drawables_config) {\n                // FIXME: can from_dict() be used to create view and add drawables?\n                var drawable_config;\n\n                var drawable_type;\n                var drawable;\n                for (var i = 0; i < drawables_config.length; i++) {\n                    view.add_drawable(_tracks2.default.object_from_template(drawables_config[i], view, view));\n                }\n            }\n\n            // Set overview.\n            var overview_drawable;\n            for (var i = 0; i < view.drawables.length; i++) {\n                if (view.drawables[i].config.get_value(\"name\") === overview_drawable_name) {\n                    view.set_overview(view.drawables[i]);\n                    break;\n                }\n            }\n\n            // Load bookmarks.\n            if (bookmarks_config) {\n                var bookmark;\n                for (var i = 0; i < bookmarks_config.length; i++) {\n                    bookmark = bookmarks_config[i];\n                    self.add_bookmark(bookmark[\"position\"], bookmark[\"annotation\"], editable);\n                }\n            }\n\n            // View has no changes as of yet.\n            view.has_changes = false;\n        });\n\n        // Final initialization.\n        this.set_up_router({ view: view });\n\n        return view;\n    },\n\n    /**\n     * Set up location router to use hashes as track browser locations.\n     */\n    set_up_router: function set_up_router(options) {\n        new _visualization2.default.TrackBrowserRouter(options);\n        Backbone.history.start();\n    },\n\n    /**\n     * Set up keyboard navigation for a visualization.\n     */\n    init_keyboard_nav: function init_keyboard_nav(view) {\n        // Keyboard navigation. Scroll ~7% of height when scrolling up/down.\n        $(document).keyup(function (e) {\n            // Do not navigate if arrow keys used in input element.\n            if ($(e.srcElement).is(\":input\")) {\n                return;\n            }\n\n            // Key codes: left == 37, up == 38, right == 39, down == 40\n            switch (e.which) {\n                case 37:\n                    view.move_fraction(0.25);\n                    break;\n                case 38:\n                    var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() - 20);\n                    break;\n                case 39:\n                    view.move_fraction(-0.25);\n                    break;\n                case 40:\n                    var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() + 20);\n                    break;\n            }\n        });\n    },\n\n    /**\n     * Handle unsaved changes in visualization.\n     */\n    handle_unsaved_changes: function handle_unsaved_changes(view) {\n        if (view.has_changes) {\n            var self = this;\n            Galaxy.modal.show({\n                title: \"Close visualization\",\n                body: \"There are unsaved changes to your visualization which will be lost if you do not save them.\",\n                buttons: {\n                    Cancel: function Cancel() {\n                        Galaxy.modal.hide();\n                    },\n                    \"Leave without Saving\": function LeaveWithoutSaving() {\n                        $(window).off(\"beforeunload\");\n                        window.location = Galaxy.root + \"visualization\";\n                    },\n                    Save: function Save() {\n                        $.when(self.save_viz()).then(function () {\n                            window.location = Galaxy.root + \"visualization\";\n                        });\n                    }\n                }\n            });\n        } else {\n            window.location = Galaxy.root + \"visualization\";\n        }\n    }\n});\n\nvar TracksterView = Backbone.View.extend({\n    // initalize trackster\n    initialize: function initialize() {\n        // load ui\n        ui = new TracksterUI(Galaxy.root);\n\n        // create button menu\n        ui.createButtonMenu();\n\n        // attach the button menu to the panel header and float it left\n        ui.buttonMenu.$el.attr(\"style\", \"float: right\");\n\n        // add to center panel\n        $(\"#center .unified-panel-header-inner\").append(ui.buttonMenu.$el);\n\n        // configure right panel\n        $(\"#right .unified-panel-title\").append(\"Bookmarks\");\n        $(\"#right .unified-panel-icons\").append(\"<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>\");\n\n        // resize view when showing/hiding right panel (bookmarks for now).\n        $(\"#right-border\").click(function () {\n            view.resize_window();\n        });\n\n        // hide right panel\n        force_right_panel(\"hide\");\n\n        // check if id is available\n        if (galaxy_config.app.id) {\n            this.view_existing();\n        } else if (_queryStringParsing2.default.get(\"dataset_id\")) {\n            this.choose_existing_or_new();\n        } else {\n            this.view_new();\n        }\n    },\n\n    choose_existing_or_new: function choose_existing_or_new() {\n        var self = this;\n        var dbkey = _queryStringParsing2.default.get(\"dbkey\");\n        var listTracksParams = {};\n\n        var dataset_params = {\n            dbkey: dbkey,\n            dataset_id: _queryStringParsing2.default.get(\"dataset_id\"),\n            hda_ldda: _queryStringParsing2.default.get(\"hda_ldda\"),\n            gene_region: _queryStringParsing2.default.get(\"gene_region\")\n        };\n\n        if (dbkey) {\n            listTracksParams[\"f-dbkey\"] = dbkey;\n        }\n\n        Galaxy.modal.show({\n            title: \"View Data in a New or Saved Visualization?\",\n            // either have text in here or have to remove body and the header/footer margins\n            body: \"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>\" + (dbkey || \"Not available.\") + \"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>\",\n            buttons: {\n                Cancel: function Cancel() {\n                    window.location = Galaxy.root + \"visualizations/list\";\n                },\n                \"View in saved visualization\": function ViewInSavedVisualization() {\n                    self.view_in_saved(dataset_params);\n                },\n                \"View in new visualization\": function ViewInNewVisualization() {\n                    self.view_new();\n                }\n            }\n        });\n    },\n\n    // view\n    view_in_saved: function view_in_saved(dataset_params) {\n        var tracks_grid = new _gridView2.default({\n            url_base: Galaxy.root + \"visualization/list_tracks\",\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: \"Add Data to Saved Visualization\",\n            body: tracks_grid.$el,\n            buttons: {\n                Cancel: function Cancel() {\n                    window.location = Galaxy.root + \"visualizations/list\";\n                },\n                \"Add to visualization\": function AddToVisualization() {\n                    $(parent.document).find(\"input[name=id]:checked\").each(function () {\n                        dataset_params.id = $(this).val();\n                        window.location = Galaxy.root + \"visualization/trackster?\" + $.param(dataset_params);\n                    });\n                }\n            }\n        });\n    },\n\n    // view\n    view_existing: function view_existing() {\n        // get config\n        var viz_config = galaxy_config.app.viz_config;\n\n        // view\n        view = ui.create_visualization({\n            container: $(\"#center .unified-panel-body\"),\n            name: viz_config.title,\n            vis_id: viz_config.vis_id,\n            dbkey: viz_config.dbkey\n        }, viz_config.viewport, viz_config.tracks, viz_config.bookmarks, true);\n\n        // initialize editor\n        this.init_editor();\n    },\n\n    // view\n    view_new: function view_new() {\n        // reference this\n        var self = this;\n\n        // ajax\n        $.ajax({\n            url: Galaxy.root + \"api/genomes?chrom_info=True\",\n            data: {},\n            error: function error() {\n                alert(\"Couldn't create new browser.\");\n            },\n            success: function success(response) {\n                // show dialog\n                Galaxy.modal.show({\n                    title: \"New Visualization\",\n                    body: self.template_view_new(response),\n                    buttons: {\n                        Cancel: function Cancel() {\n                            window.location = Galaxy.root + \"visualizations/list\";\n                        },\n                        Create: function Create() {\n                            self.create_browser($(\"#new-title\").val(), $(\"#new-dbkey\").val());\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n\n                // select default\n                var dbkeys_in_genomes = response.map(function (r) {\n                    return r[1];\n                });\n                if (galaxy_config.app.default_dbkey && _.contains(dbkeys_in_genomes, galaxy_config.app.default_dbkey)) {\n                    $(\"#new-dbkey\").val(galaxy_config.app.default_dbkey);\n                }\n\n                // change focus\n                $(\"#new-title\").focus();\n                $(\"select[name='dbkey']\").select2();\n\n                // to support the large number of options for dbkey, enable scrolling in overlay.\n                $(\"#overlay\").css(\"overflow\", \"auto\");\n            }\n        });\n    },\n\n    // new browser form\n    template_view_new: function template_view_new(response) {\n        // start template\n        var html = '<form id=\"new-browser-form\" action=\"javascript:void(0);\" method=\"post\" onsubmit=\"return false;\">' + '<div class=\"form-row\">' + '<label for=\"new-title\">Browser name:</label>' + '<div class=\"form-row-input\">' + '<input type=\"text\" name=\"title\" id=\"new-title\" value=\"Unnamed\"></input>' + \"</div>\" + '<div style=\"clear: both;\"></div>' + \"</div>\" + '<div class=\"form-row\">' + '<label for=\"new-dbkey\">Reference genome build (dbkey): </label>' + '<div class=\"form-row-input\">' + '<select name=\"dbkey\" id=\"new-dbkey\">';\n\n        // add dbkeys\n        for (var i = 0; i < response.length; i++) {\n            html += \"<option value=\\\"\" + response[i][1] + \"\\\">\" + response[i][0] + \"</option>\";\n        }\n\n        // close selection/finalize template\n        html += \"</select></div><div style=\\\"clear: both;\\\"></div></div><div class=\\\"form-row\\\">Is the build not listed here? <a href=\\\"\" + Galaxy.root + \"user/dbkeys?use_panels=True\\\">Add a Custom Build</a></div></form>\";\n\n        // return\n        return html;\n    },\n\n    // create\n    create_browser: function create_browser(name, dbkey) {\n        $(document).trigger(\"convert_to_values\");\n\n        view = ui.create_visualization({\n            container: $(\"#center .unified-panel-body\"),\n            name: name,\n            dbkey: dbkey\n        }, galaxy_config.app.gene_region);\n\n        // initialize editor\n        this.init_editor();\n\n        // modify view setting\n        view.editor = true;\n    },\n\n    // initialization for editor-specific functions.\n    init_editor: function init_editor() {\n        // set title\n        $(\"#center .unified-panel-title\").text(view.config.get_value(\"name\") + \" (\" + view.dbkey + \")\");\n\n        // add dataset\n        if (galaxy_config.app.add_dataset) $.ajax({\n            url: Galaxy.root + \"api/datasets/\" + galaxy_config.app.add_dataset,\n            data: { hda_ldda: \"hda\", data_type: \"track_config\" },\n            dataType: \"json\",\n            success: function success(track_data) {\n                view.add_drawable(_tracks2.default.object_from_template(track_data, view, view));\n            }\n        });\n\n        // initialize icons\n        $(\"#add-bookmark-button\").click(function () {\n            // add new bookmark.\n            var position = view.chrom + \":\" + view.low + \"-\" + view.high;\n\n            var annotation = \"Bookmark description\";\n            return ui.add_bookmark(position, annotation, true);\n        });\n\n        // initialize keyboard\n        ui.init_keyboard_nav(view);\n\n        $(window).on(\"beforeunload\", function () {\n            if (view.has_changes) {\n                return \"There are unsaved changes to your visualization that will be lost if you leave this page.\";\n            }\n        });\n    }\n});\n\nexports.default = {\n    TracksterUI: TracksterUI,\n    GalaxyApp: TracksterView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _visualization = __webpack_require__(7);\n\nvar _visualization2 = _interopRequireDefault(_visualization);\n\nvar _viz_views = __webpack_require__(28);\n\nvar _viz_views2 = _interopRequireDefault(_viz_views);\n\nvar _util = __webpack_require__(8);\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _slotting = __webpack_require__(29);\n\nvar _slotting2 = _interopRequireDefault(_slotting);\n\nvar _painters = __webpack_require__(30);\n\nvar _painters2 = _interopRequireDefault(_painters);\n\nvar _filters = __webpack_require__(31);\n\nvar _filters2 = _interopRequireDefault(_filters);\n\nvar _data = __webpack_require__(10);\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _tools = __webpack_require__(22);\n\nvar _tools2 = _interopRequireDefault(_tools);\n\nvar _config = __webpack_require__(11);\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _bbiDataManager = __webpack_require__(34);\n\nvar _bbiDataManager2 = _interopRequireDefault(_bbiDataManager);\n\n__webpack_require__(15);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar extend = _.extend;\n\n// ---- Web UI specific utilities ----\n\n/**\n * Dictionary of HTML element-JavaScript object relationships.\n */\n// TODO: probably should separate moveable objects from containers.\nvar html_elt_js_obj_dict = {};\n\n/**\n * Designates an HTML as a container.\n */\nvar is_container = function is_container(element, obj) {\n    html_elt_js_obj_dict[element.attr(\"id\")] = obj;\n};\n\n/**\n * Make `element` moveable within parent and sibling elements by dragging `handle` (a selector).\n * Function manages JS objects, containers as well.\n *\n * @param element HTML element to make moveable\n * @param handle_class classname that denotes HTML element to be used as handle\n * @param container_selector selector used to identify possible containers for this element\n * @param element_js_obj JavaScript object associated with element; used\n */\nvar moveable = function moveable(element, handle_class, container_selector, element_js_obj) {\n    // HACK: set default value for container selector.\n    container_selector = \".group\";\n\n    // Register element with its object.\n    html_elt_js_obj_dict[element.attr(\"id\")] = element_js_obj;\n\n    // Need to provide selector for handle, not class.\n    element.bind(\"drag\", { handle: \".\" + handle_class, relative: true }, function (e, d) {\n        var element = $(this);\n        var parent = $(this).parent();\n\n        var // Only sorting amongst tracks and groups.\n        children = parent.children(\".track,.group\");\n\n        var this_obj = html_elt_js_obj_dict[$(this).attr(\"id\")];\n        var child;\n        var container;\n        var top;\n        var bottom;\n        var i;\n\n        //\n        // Enable three types of dragging: (a) out of container; (b) into container;\n        // (c) sibling movement, aka sorting. Handle in this order for simplicity.\n        //\n\n        // Handle dragging out of container.\n        container = $(this).parents(container_selector);\n        if (container.length !== 0) {\n            top = container.position().top;\n            bottom = top + container.outerHeight();\n            var cur_container = html_elt_js_obj_dict[container.attr(\"id\")];\n            if (d.offsetY < top) {\n                // Moving above container.\n                $(this).insertBefore(container);\n                cur_container.remove_drawable(this_obj);\n                cur_container.container.add_drawable_before(this_obj, cur_container);\n                return;\n            } else if (d.offsetY > bottom) {\n                // Moving below container.\n                $(this).insertAfter(container);\n                cur_container.remove_drawable(this_obj);\n                cur_container.container.add_drawable(this_obj);\n                return;\n            }\n        }\n\n        // Handle dragging into container. Child is appended to container's content_div.\n        container = null;\n        for (i = 0; i < children.length; i++) {\n            child = $(children.get(i));\n            top = child.position().top;\n            bottom = top + child.outerHeight();\n            // Dragging into container if child is a container and offset is inside container.\n            if (child.is(container_selector) && this !== child.get(0) && d.offsetY >= top && d.offsetY <= bottom) {\n                // Append/prepend based on where offsetY is closest to and return.\n                if (d.offsetY - top < bottom - d.offsetY) {\n                    child.find(\".content-div\").prepend(this);\n                } else {\n                    child.find(\".content-div\").append(this);\n                }\n                // Update containers. Object may not have container if it is being moved quickly.\n                if (this_obj.container) {\n                    this_obj.container.remove_drawable(this_obj);\n                }\n                html_elt_js_obj_dict[child.attr(\"id\")].add_drawable(this_obj);\n                return;\n            }\n        }\n\n        // Handle sibling movement, aka sorting.\n\n        // Determine new position\n        for (i = 0; i < children.length; i++) {\n            child = $(children.get(i));\n            if (d.offsetY < child.position().top &&\n            // Cannot move tracks above reference track or intro div.\n            !(child.hasClass(\"reference-track\") || child.hasClass(\"intro\"))) {\n                break;\n            }\n        }\n\n        // If not already in the right place, move. Need\n        // to handle the end specially since we don't have\n        // insert at index\n        if (i === children.length) {\n            if (this !== children.get(i - 1)) {\n                parent.append(this);\n                html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, i);\n            }\n        } else if (this !== children.get(i)) {\n            $(this).insertBefore(children.get(i));\n            // Need to adjust insert position if moving down because move is changing\n            // indices of all list items.\n            html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, d.deltaY > 0 ? i - 1 : i);\n        }\n    }).bind(\"dragstart\", function () {\n        $(this).addClass(\"dragging\");\n    }).bind(\"dragend\", function () {\n        $(this).removeClass(\"dragging\");\n    });\n};\n\n/**\n * Init constants & functions used throughout trackster.\n */\nvar // Padding at the top of tracks for error messages\nERROR_PADDING = 20;\n\nvar // Maximum number of rows un a slotted track\nMAX_FEATURE_DEPTH = 100;\n\nvar // Minimum width for window for squish to be used.\nMIN_SQUISH_VIEW_WIDTH = 12000;\n\nvar // Number of pixels per tile, not including left offset.\nTILE_SIZE = 400;\n\nvar DEFAULT_DATA_QUERY_WAIT = 5000;\n\nvar // Maximum number of chromosomes that are selectable at any one time.\nMAX_CHROMS_SELECTABLE = 100;\n\nvar DATA_ERROR = \"Cannot display dataset due to an error. \";\n\nvar DATA_NOCONVERTER = \"A converter for this dataset is not installed. Please check your datatypes_conf.xml file.\";\n\nvar DATA_NONE = \"No data for this chrom/contig.\";\n\nvar DATA_PENDING = \"Preparing data. This can take a while for a large dataset. \" + \"If the visualization is saved and closed, preparation will continue in the background.\";\n\nvar DATA_CANNOT_RUN_TOOL = \"Tool cannot be rerun: \";\nvar DATA_LOADING = \"Loading data...\";\nvar DATA_OK = \"Ready for display\";\nvar TILE_CACHE_SIZE = 10;\nvar DATA_CACHE_SIZE = 20;\n\nvar // Numerical/continuous data display modes.\nCONTINUOUS_DATA_MODES = [\"Histogram\", \"Line\", \"Filled\", \"Intensity\"];\n\n/**\n * Round a number to a given number of decimal places.\n */\nfunction round(num, places) {\n    // Default rounding is to integer.\n    if (!places) {\n        places = 0;\n    }\n\n    var val = Math.pow(10, places);\n    return Math.round(num * val) / val;\n}\n\n/**\n * Check if a server can do byte range requests.\n */\nfunction supportsByteRanges(url) {\n    var promise = $.Deferred();\n    $.ajax({\n        type: \"HEAD\",\n        url: url,\n        beforeSend: function beforeSend(xhr) {\n            xhr.setRequestHeader(\"Range\", \"bytes=0-10\");\n        },\n        success: function success(result, status, xhr) {\n            promise.resolve(xhr.status === 206);\n        }\n    });\n\n    return promise;\n}\n\n/**\n * Drawables hierarchy:\n *\n * Drawable\n *    --> DrawableCollection\n *        --> DrawableGroup\n *        --> View\n *    --> Track\n */\n\n/**\n * Base class for all drawable objects. Drawable objects are associated with a view and live in a\n * container. They have the following HTML elements and structure:\n *  <container_div>\n *      <header_div>\n *      <content_div>\n *\n * They optionally have a drag handle class.\n */\nvar Drawable = function Drawable(view, container, obj_dict) {\n    if (!Drawable.id_counter) {\n        Drawable.id_counter = 0;\n    }\n    this.id = Drawable.id_counter++;\n    this.view = view;\n    this.container = container;\n    this.drag_handle_class = obj_dict.drag_handle_class;\n    this.is_overview = false;\n    this.action_icons = {};\n\n    // -- Set up drawable configuration. --\n    this.config = _config2.default.ConfigSettingCollection.from_models_and_saved_values(this.config_params, obj_dict.prefs);\n\n    // If there's no saved name, use object name.\n    if (!this.config.get_value(\"name\")) {\n        this.config.set_value(\"name\", obj_dict.name);\n    }\n    if (this.config_onchange) {\n        this.config.on(\"change\", this.config_onchange, this);\n    }\n\n    // Build Drawable HTML and behaviors.\n    this.container_div = this.build_container_div();\n    this.header_div = null;\n\n    // Use opt-out policy on header creation because this is the more frequent approach:\n    // unless flag set, create header.\n    if (obj_dict.header !== false) {\n        var header_view = new _viz_views2.default.TrackHeaderView({\n            model: this,\n            id: this.id\n        });\n\n        this.header_div = header_view.$el;\n        this.container_div.append(this.header_div);\n\n        // Show icons when users is hovering over track.\n        var icons_div = header_view.icons_div;\n        this.action_icons = header_view.action_icons;\n        this.container_div.hover(function () {\n            icons_div.show();\n        }, function () {\n            icons_div.hide();\n        });\n    }\n};\n\nDrawable.prototype.action_icons_def = [\n// Hide/show drawable content.\n// FIXME: make this an odict for easier lookup.\n{\n    name: \"toggle_icon\",\n    title: \"Hide/show content\",\n    css_class: \"toggle\",\n    on_click_fn: function on_click_fn(drawable) {\n        if (drawable.config.get_value(\"content_visible\")) {\n            drawable.action_icons.toggle_icon.addClass(\"toggle-expand\").removeClass(\"toggle\");\n            drawable.hide_contents();\n            drawable.config.set_value(\"content_visible\", false);\n        } else {\n            drawable.action_icons.toggle_icon.addClass(\"toggle\").removeClass(\"toggle-expand\");\n            drawable.config.set_value(\"content_visible\", true);\n            drawable.show_contents();\n        }\n    }\n},\n// Edit settings.\n{\n    name: \"settings_icon\",\n    title: \"Edit settings\",\n    css_class: \"gear\",\n    on_click_fn: function on_click_fn(drawable) {\n        var view = new _config2.default.ConfigSettingCollectionView({\n            collection: drawable.config\n        });\n        view.render_in_modal(\"Configure Track\");\n    }\n},\n// Remove.\n{\n    name: \"remove_icon\",\n    title: \"Remove\",\n    css_class: \"remove-icon\",\n    on_click_fn: function on_click_fn(drawable) {\n        // Tooltip for remove icon must be deleted when drawable is deleted.\n        $(\".tooltip\").remove();\n        drawable.remove();\n    }\n}];\n\nextend(Drawable.prototype, {\n    config_params: [{ key: \"name\", label: \"Name\", type: \"text\", default_value: \"\" }, {\n        key: \"content_visible\",\n        type: \"bool\",\n        default_value: true,\n        hidden: true\n    }],\n\n    config_onchange: function config_onchange() {},\n\n    init: function init() {},\n\n    changed: function changed() {\n        this.view.changed();\n    },\n\n    can_draw: function can_draw() {\n        if (this.enabled && this.config.get_value(\"content_visible\")) {\n            return true;\n        }\n\n        return false;\n    },\n\n    request_draw: function request_draw() {},\n\n    _draw: function _draw(options) {},\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function to_dict() {},\n\n    /**\n     * Set drawable name.\n     */\n    set_name: function set_name(new_name) {\n        this.old_name = this.config.get_value(\"name\");\n        this.config.set_value(\"name\", new_name);\n    },\n\n    /**\n     * Revert track name; currently name can be reverted only once.\n     */\n    revert_name: function revert_name() {\n        if (this.old_name) {\n            this.config.set_value(\"name\", this.old_name);\n        }\n    },\n\n    /**\n     * Remove drawable (a) from its container and (b) from the HTML.\n     */\n    remove: function remove() {\n        this.changed();\n\n        this.container.remove_drawable(this);\n        var view = this.view;\n        this.container_div.hide(0, function () {\n            $(this).remove();\n            // HACK: is there a better way to update the view?\n            view.update_intro_div();\n        });\n    },\n\n    /**\n     * Build drawable's container div; this is the parent div for all drawable's elements.\n     */\n    build_container_div: function build_container_div() {},\n\n    /**\n     * Update icons.\n     */\n    update_icons: function update_icons() {},\n\n    /**\n     * Hide drawable's contents.\n     */\n    hide_contents: function hide_contents() {},\n\n    /**\n     * Show drawable's contents.\n     */\n    show_contents: function show_contents() {},\n\n    /**\n     * Returns a shallow copy of all drawables in this drawable.\n     */\n    get_drawables: function get_drawables() {}\n});\n\n/**\n * A collection of drawable objects.\n */\nvar DrawableCollection = function DrawableCollection(view, container, obj_dict) {\n    Drawable.call(this, view, container, obj_dict);\n\n    // Attribute init.\n    this.obj_type = obj_dict.obj_type;\n    this.drawables = [];\n};\n\nextend(DrawableCollection.prototype, Drawable.prototype, {\n    /**\n     * Unpack and add drawables to the collection.\n     */\n    unpack_drawables: function unpack_drawables(drawables_array) {\n        // Add drawables to collection.\n        this.drawables = [];\n        var drawable;\n        for (var i = 0; i < drawables_array.length; i++) {\n            drawable = object_from_template(drawables_array[i], this.view, this);\n            this.add_drawable(drawable);\n        }\n    },\n\n    /**\n     * Init each drawable in the collection.\n     */\n    init: function init() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].init();\n        }\n    },\n\n    /**\n     * Draw each drawable in the collection.\n     */\n    _draw: function _draw(options) {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i]._draw(options);\n        }\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function to_dict() {\n        var dictified_drawables = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            dictified_drawables.push(this.drawables[i].to_dict());\n        }\n        return {\n            prefs: this.config.to_key_value_dict(),\n            obj_type: this.obj_type,\n            drawables: dictified_drawables\n        };\n    },\n\n    /**\n     * Add a drawable to the end of the collection.\n     */\n    add_drawable: function add_drawable(drawable) {\n        this.drawables.push(drawable);\n        drawable.container = this;\n        this.changed();\n    },\n\n    /**\n     * Add a drawable before another drawable.\n     */\n    add_drawable_before: function add_drawable_before(drawable, other) {\n        this.changed();\n        var index = this.drawables.indexOf(other);\n        if (index !== -1) {\n            this.drawables.splice(index, 0, drawable);\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Replace one drawable with another.\n     */\n    replace_drawable: function replace_drawable(old_drawable, new_drawable, update_html) {\n        var index = this.drawables.indexOf(old_drawable);\n        if (index !== -1) {\n            this.drawables[index] = new_drawable;\n            if (update_html) {\n                old_drawable.container_div.replaceWith(new_drawable.container_div);\n            }\n            this.changed();\n        }\n        return index;\n    },\n\n    /**\n     * Remove drawable from this collection.\n     */\n    remove_drawable: function remove_drawable(drawable) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Found drawable to remove.\n            this.drawables.splice(index, 1);\n            drawable.container = null;\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Move drawable to another location in collection.\n     */\n    move_drawable: function move_drawable(drawable, new_position) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Remove from current position:\n            this.drawables.splice(index, 1);\n            // insert into new position:\n            this.drawables.splice(new_position, 0, drawable);\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function get_drawables() {\n        return this.drawables;\n    },\n\n    /**\n     * Returns all <track_type> tracks in collection.\n     */\n    get_tracks: function get_tracks(track_type) {\n        // Initialize queue with copy of drawables array.\n        var queue = this.drawables.slice(0);\n\n        var tracks = [];\n        var drawable;\n        while (queue.length !== 0) {\n            drawable = queue.shift();\n            if (drawable instanceof track_type) {\n                tracks.push(drawable);\n            } else if (drawable.drawables) {\n                queue = queue.concat(drawable.drawables);\n            }\n        }\n        return tracks;\n    }\n});\n\n/**\n * A group of drawables that are moveable, visible.\n */\nvar DrawableGroup = function DrawableGroup(view, container, obj_dict) {\n    extend(obj_dict, {\n        obj_type: \"DrawableGroup\",\n        drag_handle_class: \"group-handle\"\n    });\n    DrawableCollection.call(this, view, container, obj_dict);\n\n    // Set up containers/moving for group: register both container_div and content div as container\n    // because both are used as containers (container div to recognize container, content_div to\n    // store elements). Group can be moved.\n    this.content_div = $(\"<div/>\").addClass(\"content-div\").attr(\"id\", \"group_\" + this.id + \"_content_div\").appendTo(this.container_div);\n    is_container(this.container_div, this);\n    is_container(this.content_div, this);\n    moveable(this.container_div, this.drag_handle_class, \".group\", this);\n\n    // Set up filters.\n    this.filters_manager = new _filters2.default.FiltersManager(this);\n    this.header_div.after(this.filters_manager.parent_div);\n\n    // HACK: add div to clear floating elements.\n    this.filters_manager.parent_div.after($(\"<div style='clear: both'/>\"));\n\n    // For saving drawables' filter managers when group-level filtering is done:\n    this.saved_filters_managers = [];\n\n    // Add drawables.\n    if (\"drawables\" in obj_dict) {\n        this.unpack_drawables(obj_dict.drawables);\n    }\n\n    // Restore filters.\n    if (\"filters\" in obj_dict) {\n        // FIXME: Pass collection_dict to DrawableCollection/Drawable will make this easier.\n        var old_manager = this.filters_manager;\n        this.filters_manager = new _filters2.default.FiltersManager(this, obj_dict.filters);\n        old_manager.parent_div.replaceWith(this.filters_manager.parent_div);\n\n        if (obj_dict.filters.visible) {\n            this.setup_multitrack_filtering();\n        }\n    }\n};\n\nextend(DrawableGroup.prototype, Drawable.prototype, DrawableCollection.prototype, {\n    action_icons_def: [Drawable.prototype.action_icons_def[0], Drawable.prototype.action_icons_def[1],\n    // Replace group with composite track.\n    {\n        name: \"composite_icon\",\n        title: \"Show composite track\",\n        css_class: \"layers-stack\",\n        on_click_fn: function on_click_fn(group) {\n            $(\".tooltip\").remove();\n            group.show_composite_track();\n        }\n    },\n    // Toggle track filters.\n    {\n        name: \"filters_icon\",\n        title: \"Filters\",\n        css_class: \"ui-slider-050\",\n        on_click_fn: function on_click_fn(group) {\n            // TODO: update Tooltip text.\n            if (group.filters_manager.visible()) {\n                // Hiding filters.\n                group.filters_manager.clear_filters();\n                group._restore_filter_managers();\n                // TODO: maintain current filter by restoring and setting saved manager's\n                // settings to current/shared manager's settings.\n                // TODO: need to restore filter managers when moving drawable outside group.\n            } else {\n                // Showing filters.\n                group.setup_multitrack_filtering();\n                group.request_draw({ clear_tile_cache: true });\n            }\n            group.filters_manager.toggle();\n        }\n    }, Drawable.prototype.action_icons_def[2]],\n\n    build_container_div: function build_container_div() {\n        var container_div = $(\"<div/>\").addClass(\"group\").attr(\"id\", \"group_\" + this.id);\n        if (this.container) {\n            this.container.content_div.append(container_div);\n        }\n        return container_div;\n    },\n\n    hide_contents: function hide_contents() {\n        this.tiles_div.hide();\n    },\n\n    show_contents: function show_contents() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    update_icons: function update_icons() {\n        //\n        // Handle update when there are no tracks.\n        //\n        var num_drawables = this.drawables.length;\n        if (num_drawables === 0) {\n            this.action_icons.composite_icon.hide();\n            this.action_icons.filters_icon.hide();\n        } else if (num_drawables === 1) {\n            this.action_icons.composite_icon.toggle(this.drawables[0] instanceof CompositeTrack);\n            this.action_icons.filters_icon.hide();\n        } else {\n            // There are 2 or more tracks.\n\n            //\n            // Determine if a composite track can be created. Current criteria:\n            // (a) all tracks are line tracks;\n            //      OR\n            // FIXME: this is not enabled right now because it has not been well tested:\n            // (b) there is a single FeatureTrack.\n            //\n\n            // All tracks the same?\n            var i;\n\n            var j;\n            var drawable;\n            var same_type = true;\n            var a_type = this.drawables[0].get_type();\n            var num_feature_tracks = 0;\n            for (i = 0; i < num_drawables; i++) {\n                drawable = this.drawables[i];\n                if (drawable.get_type() !== a_type) {\n                    can_composite = false;\n                    break;\n                }\n                if (drawable instanceof FeatureTrack) {\n                    num_feature_tracks++;\n                }\n            }\n\n            if (same_type && this.drawables[0] instanceof LineTrack) {\n                this.action_icons.composite_icon.show();\n            } else {\n                this.action_icons.composite_icon.hide();\n                $(\".tooltip\").remove();\n            }\n\n            //\n            // Set up group-level filtering and update filter icon.\n            //\n            if (num_feature_tracks > 1 && num_feature_tracks === this.drawables.length) {\n                //\n                // Find shared filters.\n                //\n                var shared_filters = {};\n\n                var filter;\n\n                // Init shared filters with filters from first drawable.\n                drawable = this.drawables[0];\n                for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                    filter = drawable.filters_manager.filters[j];\n                    shared_filters[filter.name] = [filter];\n                }\n\n                // Create lists of shared filters.\n                for (i = 1; i < this.drawables.length; i++) {\n                    drawable = this.drawables[i];\n                    for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                        filter = drawable.filters_manager.filters[j];\n                        if (filter.name in shared_filters) {\n                            shared_filters[filter.name].push(filter);\n                        }\n                    }\n                }\n\n                //\n                // Create filters for shared filters manager. Shared filters manager is group's\n                // manager.\n                //\n                this.filters_manager.remove_all();\n                var filters;\n                var new_filter;\n                var min;\n                var max;\n                for (var filter_name in shared_filters) {\n                    filters = shared_filters[filter_name];\n                    if (filters.length === num_feature_tracks) {\n                        // Add new filter.\n                        // FIXME: can filter.copy() be used?\n                        new_filter = new _filters2.default.NumberFilter({\n                            name: filters[0].name,\n                            index: filters[0].index\n                        });\n                        this.filters_manager.add_filter(new_filter);\n                    }\n                }\n\n                // Show/hide icon based on filter availability.\n                this.action_icons.filters_icon.toggle(this.filters_manager.filters.length > 0);\n            } else {\n                this.action_icons.filters_icon.hide();\n            }\n        }\n    },\n\n    /**\n     * Restore individual track filter managers.\n     */\n    _restore_filter_managers: function _restore_filter_managers() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].filters_manager = this.saved_filters_managers[i];\n        }\n        this.saved_filters_managers = [];\n    },\n\n    /**\n     *\n     */\n    setup_multitrack_filtering: function setup_multitrack_filtering() {\n        // Save tracks' managers and set up shared manager.\n        if (this.filters_manager.filters.length > 0) {\n            // For all tracks, save current filter manager and set manager to shared (this object's) manager.\n            this.saved_filters_managers = [];\n            for (var i = 0; i < this.drawables.length; i++) {\n                var drawable = this.drawables[i];\n                this.saved_filters_managers.push(drawable.filters_manager);\n                drawable.filters_manager = this.filters_manager;\n            }\n\n            //TODO: hide filters icons for each drawable?\n        }\n        this.filters_manager.init_filters();\n    },\n\n    /**\n     * Replace group with a single composite track that includes all group's tracks.\n     */\n    show_composite_track: function show_composite_track() {\n        var composite_track = new CompositeTrack(this.view, this.view, {\n            name: this.config.get_value(\"name\"),\n            drawables: this.drawables\n        });\n        var index = this.container.replace_drawable(this, composite_track, true);\n        composite_track.request_draw();\n    },\n\n    add_drawable: function add_drawable(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    remove_drawable: function remove_drawable(drawable) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    to_dict: function to_dict() {\n        // If filters are visible, need to restore original filter managers before converting to dict.\n        if (this.filters_manager.visible()) {\n            this._restore_filter_managers();\n        }\n\n        var obj_dict = extend(DrawableCollection.prototype.to_dict.call(this), {\n            filters: this.filters_manager.to_dict()\n        });\n\n        // Setup multi-track filtering again.\n        if (this.filters_manager.visible()) {\n            this.setup_multitrack_filtering();\n        }\n\n        return obj_dict;\n    },\n\n    request_draw: function request_draw(options) {\n        _.each(this.drawables, function (d) {\n            d.request_draw(options);\n        });\n    }\n});\n\n/**\n * View object manages a trackster visualization, including tracks and user interactions.\n * Events triggered:\n *      navigate: when browser view changes to a new locations\n */\nvar TracksterView = Backbone.View.extend({\n    initialize: function initialize(obj_dict) {\n        extend(obj_dict, {\n            obj_type: \"View\"\n        });\n        DrawableCollection.call(this, \"View\", obj_dict.container, obj_dict);\n        this.chrom = null;\n        this.vis_id = obj_dict.vis_id;\n        this.dbkey = obj_dict.dbkey;\n        this.stand_alone = obj_dict.stand_alone !== undefined ? obj_dict.stand_alone : true;\n        this.label_tracks = [];\n        this.tracks_to_be_redrawn = [];\n        this.max_low = 0;\n        this.max_high = 0;\n        this.zoom_factor = 3;\n        this.min_separation = 30;\n        this.has_changes = false;\n        // Deferred object that indicates when view's chrom data has been loaded.\n        this.load_chroms_deferred = null;\n        this.render();\n        this.canvas_manager = new _visualization2.default.CanvasManager(this.container.get(0).ownerDocument);\n        this.reset();\n\n        // Define track configuration\n        this.config = _config2.default.ConfigSettingCollection.from_models_and_saved_values([{\n            key: \"name\",\n            label: \"Name\",\n            type: \"text\",\n            default_value: \"\"\n        }, {\n            key: \"a_color\",\n            label: \"A Color\",\n            type: \"color\",\n            default_value: \"#FF0000\"\n        }, {\n            key: \"c_color\",\n            label: \"C Color\",\n            type: \"color\",\n            default_value: \"#00FF00\"\n        }, {\n            key: \"g_color\",\n            label: \"G Color\",\n            type: \"color\",\n            default_value: \"#0000FF\"\n        }, {\n            key: \"t_color\",\n            label: \"T Color\",\n            type: \"color\",\n            default_value: \"#FF00FF\"\n        }, {\n            key: \"n_color\",\n            label: \"N Color\",\n            type: \"color\",\n            default_value: \"#AAAAAA\"\n        }], { name: obj_dict.name });\n    },\n\n    render: function render() {\n        // Attribute init.\n        this.requested_redraw = false;\n\n        // Create DOM elements\n        var parent_element = this.container;\n\n        var view = this;\n        // Top container for things that are fixed at the top\n        this.top_container = $(\"<div/>\").addClass(\"top-container\").appendTo(parent_element);\n        // Browser content, primary tracks are contained in here\n        this.browser_content_div = $(\"<div/>\").addClass(\"content\").appendTo(parent_element);\n        // Bottom container for things that are fixed at the bottom\n        this.bottom_container = $(\"<div/>\").addClass(\"bottom-container\").appendTo(parent_element);\n        // Label track fixed at top\n        this.top_labeltrack = $(\"<div/>\").addClass(\"top-labeltrack\").appendTo(this.top_container);\n        // Viewport for dragging tracks in center\n        this.viewport_container = $(\"<div/>\").addClass(\"viewport-container\").attr(\"id\", \"viewport-container\").appendTo(this.browser_content_div);\n        // Alias viewport_container as content_div so that it matches function of DrawableCollection/Group content_div.\n        this.content_div = this.viewport_container;\n        is_container(this.viewport_container, view);\n        // Introduction div shown when there are no tracks.\n        this.intro_div = $(\"<div/>\").addClass(\"intro\").appendTo(this.viewport_container);\n        var add_tracks_button = $(\"<div/>\").text(\"Add Datasets to Visualization\").addClass(\"action-button\").appendTo(this.intro_div).click(function () {\n            _visualization2.default.select_datasets({ dbkey: view.dbkey }, function (tracks) {\n                _.each(tracks, function (track) {\n                    view.add_drawable(object_from_template(track, view, view));\n                });\n            });\n        });\n\n        // Navigation at top\n        this.nav_container = $(\"<div/>\").addClass(\"trackster-nav-container\").prependTo(this.top_container);\n        this.nav = $(\"<div/>\").addClass(\"trackster-nav\").appendTo(this.nav_container);\n\n        if (this.stand_alone) {\n            this.nav_container.addClass(\"stand-alone\");\n            this.nav.addClass(\"stand-alone\");\n        }\n\n        // Overview (scrollbar and overview plot) at bottom\n        this.overview = $(\"<div/>\").addClass(\"overview\").appendTo(this.bottom_container);\n        this.overview_viewport = $(\"<div/>\").addClass(\"overview-viewport\").appendTo(this.overview);\n        this.overview_close = $(\"<a/>\").attr(\"title\", \"Close overview\").addClass(\"icon-button overview-close tooltip\").hide().appendTo(this.overview_viewport);\n        this.overview_highlight = $(\"<div/>\").addClass(\"overview-highlight\").hide().appendTo(this.overview_viewport);\n        this.overview_box_background = $(\"<div/>\").addClass(\"overview-boxback\").appendTo(this.overview_viewport);\n        this.overview_box = $(\"<div/>\").addClass(\"overview-box\").appendTo(this.overview_viewport);\n        this.default_overview_height = this.overview_box.height();\n\n        this.nav_controls = $(\"<div/>\").addClass(\"nav-controls\").appendTo(this.nav);\n        this.chrom_select = $(\"<select/>\").attr({ name: \"chrom\" }).addClass(\"chrom-nav\").append(\"<option value=''>Loading</option>\").appendTo(this.nav_controls);\n        var submit_nav = function submit_nav(e) {\n            if (e.type === \"focusout\" || (e.keyCode || e.which) === 13 || (e.keyCode || e.which) === 27) {\n                if ((e.keyCode || e.which) !== 27) {\n                    // Not escape key\n                    view.go_to($(this).val());\n                }\n                $(this).hide();\n                $(this).val(\"\");\n                view.location_span.show();\n                view.chrom_select.show();\n            }\n\n            // Suppress key presses so that they do impact viz.\n            e.stopPropagation();\n        };\n        this.nav_input = $(\"<input/>\").addClass(\"nav-input\").hide().bind(\"keyup focusout\", submit_nav).appendTo(this.nav_controls);\n        this.location_span = $(\"<span/>\").addClass(\"location\").attr(\"title\", \"Click to change location\").tooltip({ placement: \"bottom\" }).appendTo(this.nav_controls);\n        this.location_span.click(function () {\n            view.location_span.hide();\n            view.chrom_select.hide();\n            view.nav_input.val(view.chrom + \":\" + view.low + \"-\" + view.high);\n            view.nav_input.css(\"display\", \"inline-block\");\n            view.nav_input.select();\n            view.nav_input.focus();\n            // Set up autocomplete for tracks' features.\n            view.nav_input.autocomplete({\n                source: function source(request, response) {\n                    // Using current text, query each track and create list of all matching features.\n                    var all_features = [];\n\n                    var feature_search_deferreds = $.map(view.get_tracks(FeatureTrack), function (t) {\n                        return t.data_manager.search_features(request.term).success(function (dataset_features) {\n                            all_features = all_features.concat(dataset_features);\n                        });\n                    });\n\n                    // When all searching is done, fill autocomplete.\n                    $.when.apply($, feature_search_deferreds).done(function () {\n                        response($.map(all_features, function (feature) {\n                            return {\n                                label: feature[0],\n                                value: feature[1]\n                            };\n                        }));\n                    });\n                },\n                minLength: 2\n            });\n        });\n        if (this.vis_id !== undefined) {\n            this.hidden_input = $(\"<input/>\").attr(\"type\", \"hidden\").val(this.vis_id).appendTo(this.nav_controls);\n        }\n\n        this.zo_link = $(\"<a/>\").attr(\"id\", \"zoom-out\").attr(\"title\", \"Zoom out\").tooltip({ placement: \"bottom\" }).click(function () {\n            view.zoom_out();\n        }).appendTo(this.nav_controls);\n        this.zi_link = $(\"<a/>\").attr(\"id\", \"zoom-in\").attr(\"title\", \"Zoom in\").tooltip({ placement: \"bottom\" }).click(function () {\n            view.zoom_in();\n        }).appendTo(this.nav_controls);\n\n        // Get initial set of chroms.\n        this.load_chroms_deferred = this.load_chroms({ low: 0 });\n        this.chrom_select.bind(\"change\", function () {\n            view.change_chrom(view.chrom_select.val());\n        });\n\n        /*\n        this.browser_content_div.bind(\"mousewheel\", function( e, delta ) {\n            if (Math.abs(delta) < 0.5) {\n                return;\n            }\n            if (delta > 0) {\n                view.zoom_in(e.pageX, this.viewport_container);\n            } else {\n                view.zoom_out();\n            }\n            e.preventDefault();\n        });\n        */\n\n        // Blur tool/filter inputs when user clicks on content div.\n        this.browser_content_div.click(function (e) {\n            $(this).find(\"input\").trigger(\"blur\");\n        });\n\n        // Double clicking zooms in\n        this.browser_content_div.bind(\"dblclick\", function (e) {\n            view.zoom_in(e.pageX, this.viewport_container);\n        });\n\n        // Dragging the overview box (~ horizontal scroll bar)\n        this.overview_box.bind(\"dragstart\", function (e, d) {\n            this.current_x = d.offsetX;\n        }).bind(\"drag\", function (e, d) {\n            var delta = d.offsetX - this.current_x;\n            this.current_x = d.offsetX;\n            var delta_chrom = Math.round(delta / view.viewport_container.width() * (view.max_high - view.max_low));\n            view.move_delta(-delta_chrom);\n        });\n\n        this.overview_close.click(function () {\n            view.reset_overview();\n        });\n\n        // Dragging in the viewport scrolls\n        this.viewport_container.bind(\"draginit\", function (e, d) {\n            // Disable interaction if started in scrollbar (for webkit)\n            if (e.clientX > view.viewport_container.width() - 16) {\n                return false;\n            }\n        }).bind(\"dragstart\", function (e, d) {\n            d.original_low = view.low;\n            d.current_height = e.clientY;\n            d.current_x = d.offsetX;\n        }).bind(\"drag\", function (e, d) {\n            var container = $(this);\n            var delta = d.offsetX - d.current_x;\n            var new_scroll = container.scrollTop() - (e.clientY - d.current_height);\n            container.scrollTop(new_scroll);\n            d.current_height = e.clientY;\n            d.current_x = d.offsetX;\n            var delta_chrom = Math.round(delta / view.viewport_container.width() * (view.high - view.low));\n            view.move_delta(delta_chrom);\n        });\n        /*\n        FIXME: Do not do this for now because it's too jittery. Some kind of gravity approach is\n        needed here because moving left/right should be difficult.\n         // Also capture mouse wheel for left/right scrolling\n        }).bind( 'mousewheel', function( e, d, dx, dy ) {\n            // Only handle x axis scrolling; y axis scrolling is\n            // handled by the browser when the event bubbles up.\n            if (dx) {\n                var delta_chrom = Math.round( - dx / view.viewport_container.width() * (view.high - view.low) );\n                view.move_delta( delta_chrom );\n            }\n        });\n        */\n\n        // Dragging in the top label track allows selecting a region to zoom in on selected region.\n        this.top_labeltrack.bind(\"dragstart\", function (e, d) {\n            return $(\"<div/>\").addClass(\"zoom-area\").css(\"height\", view.browser_content_div.height() + view.top_labeltrack.height() + 1).appendTo($(this));\n        }).bind(\"drag\", function (e, d) {\n            $(d.proxy).css({\n                left: Math.min(e.pageX, d.startX) - view.container.offset().left,\n                width: Math.abs(e.pageX - d.startX)\n            });\n\n            var min = Math.min(e.pageX, d.startX) - view.container.offset().left;\n\n            var max = Math.max(e.pageX, d.startX) - view.container.offset().left;\n\n            var span = view.high - view.low;\n            var width = view.viewport_container.width();\n            view.update_location(Math.round(min / width * span) + view.low, Math.round(max / width * span) + view.low);\n        }).bind(\"dragend\", function (e, d) {\n            var min = Math.min(e.pageX, d.startX);\n            var max = Math.max(e.pageX, d.startX);\n            var span = view.high - view.low;\n            var width = view.viewport_container.width();\n            var old_low = view.low;\n            view.low = Math.round(min / width * span) + old_low;\n            view.high = Math.round(max / width * span) + old_low;\n            $(d.proxy).remove();\n            view.request_redraw();\n        });\n\n        // FIXME: this is still wonky for embedded visualizations.\n        /*\n        // For vertical alignment, track mouse with simple line.\n        var mouse_tracker_div = $('<div/>').addClass('mouse-pos').appendTo(parent_element);\n         // Show tracker only when hovering over view.\n        parent_element.hover(\n            function() {\n                mouse_tracker_div.show();\n                parent_element.mousemove(function(e) {\n                    mouse_tracker_div.css({\n                        // -1 makes line appear next to the mouse w/o preventing mouse actions.\n                        left: e.pageX - parent_element.offset().left - 1\n                    });\n                });\n            },\n            function() {\n                parent_element.off('mousemove');\n                mouse_tracker_div.hide();\n            }\n        );\n        */\n\n        this.add_label_track(new LabelTrack(this, { content_div: this.top_labeltrack }));\n\n        $(window).bind(\"resize\", function () {\n            // Stop previous timer.\n            if (this.resize_timer) {\n                clearTimeout(this.resize_timer);\n            }\n\n            // When function activated, resize window and redraw.\n            this.resize_timer = setTimeout(function () {\n                view.resize_window();\n            }, 500);\n        });\n        $(document).bind(\"redraw\", function () {\n            view.redraw();\n        });\n\n        this.reset();\n        $(window).trigger(\"resize\");\n    },\n\n    get_base_color: function get_base_color(base) {\n        return this.config.get_value(base.toLowerCase() + \"_color\") || this.config.get_value(\"n_color\");\n    }\n});\n\n// FIXME: need to use this approach to enable inheritance of DrawableCollection functions.\nextend(TracksterView.prototype, DrawableCollection.prototype, {\n    changed: function changed() {\n        this.has_changes = true;\n    },\n\n    /** Add or remove intro div depending on view state. */\n    update_intro_div: function update_intro_div() {\n        this.intro_div.toggle(this.drawables.length === 0);\n    },\n\n    /**\n     * Triggers navigate events as needed. If there is a delay,\n     * then event is triggered only after navigation has stopped.\n     */\n    trigger_navigate: function trigger_navigate(new_chrom, new_low, new_high, delay) {\n        // Stop previous timer.\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n\n        if (delay) {\n            // To aggregate calls, use timer and only navigate once\n            // location has stabilized.\n            var self = this;\n            this.timer = setTimeout(function () {\n                self.trigger(\"navigate\", new_chrom + \":\" + new_low + \"-\" + new_high);\n            }, 500);\n        } else {\n            view.trigger(\"navigate\", new_chrom + \":\" + new_low + \"-\" + new_high);\n        }\n    },\n\n    update_location: function update_location(low, high) {\n        this.location_span.text(_util2.default.commatize(low) + \" - \" + _util2.default.commatize(high));\n        this.nav_input.val(this.chrom + \":\" + _util2.default.commatize(low) + \"-\" + _util2.default.commatize(high));\n\n        // Update location. Only update when there is a valid chrom; when loading vis, there may\n        // not be a valid chrom.\n        var chrom = this.chrom_select.val();\n        if (chrom !== \"\") {\n            this.trigger_navigate(chrom, this.low, this.high, true);\n        }\n    },\n\n    /**\n     * Load chrom data for the view. Returns a jQuery Deferred.\n     */\n    // FIXME: instead of loading chrom data, should load and store genome object.\n    load_chroms: function load_chroms(url_parms) {\n        url_parms.num = MAX_CHROMS_SELECTABLE;\n\n        var view = this;\n        var chrom_data = $.Deferred();\n        $.ajax({\n            url: Galaxy.root + \"api/genomes/\" + this.dbkey,\n            data: url_parms,\n            dataType: \"json\",\n            success: function success(result) {\n                // Do nothing if could not load chroms.\n                if (result.chrom_info.length === 0) {\n                    return;\n                }\n\n                // Load chroms.\n                if (result.reference) {\n                    var ref_track = new ReferenceTrack(view);\n                    view.add_label_track(ref_track);\n                    view.reference_track = ref_track;\n                }\n                view.chrom_data = result.chrom_info;\n\n                view.chrom_select.html(\"\");\n                view.chrom_select.append($('<option value=\"\">Select Chrom/Contig</option>'));\n\n                for (var i = 0, len = view.chrom_data.length; i < len; i++) {\n                    var chrom = view.chrom_data[i].chrom;\n                    var chrom_option = $(\"<option>\");\n                    chrom_option.text(chrom);\n                    chrom_option.val(chrom);\n                    view.chrom_select.append(chrom_option);\n                }\n                if (result.prev_chroms) {\n                    view.chrom_select.append($(\"<option value=\\\"previous\\\">Previous \" + MAX_CHROMS_SELECTABLE + \"</option>\"));\n                }\n                if (result.next_chroms) {\n                    view.chrom_select.append($(\"<option value=\\\"next\\\">Next \" + MAX_CHROMS_SELECTABLE + \"</option>\"));\n                }\n                view.chrom_start_index = result.start_index;\n\n                chrom_data.resolve(result.chrom_info);\n            },\n            error: function error() {\n                alert(\"Could not load chroms for this dbkey: \" + view.dbkey);\n            }\n        });\n        return chrom_data;\n    },\n\n    change_chrom: function change_chrom(chrom, low, high) {\n        var view = this;\n        // If chrom data is still loading, wait for it.\n        if (!view.chrom_data) {\n            view.load_chroms_deferred.then(function () {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        }\n\n        // Don't do anything if chrom is \"None\" (hackish but some browsers already have this set), or null/blank\n        if (!chrom || chrom === \"None\") {\n            return;\n        }\n\n        //\n        // If user is navigating to previous/next set of chroms, load new chrom set and return.\n        //\n        if (chrom === \"previous\") {\n            view.load_chroms({\n                low: this.chrom_start_index - MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n        if (chrom === \"next\") {\n            view.load_chroms({\n                low: this.chrom_start_index + MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n\n        //\n        // User is loading a particular chrom. Look first in current set; if not in current set, load new\n        // chrom set.\n        //\n        var found = $.grep(view.chrom_data, function (v, i) {\n            return v.chrom === chrom;\n        })[0];\n        if (found === undefined) {\n            // Try to load chrom and then change to chrom.\n            view.load_chroms({ chrom: chrom }, function () {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        } else {\n            // Switching to local chrom.\n            if (chrom !== view.chrom) {\n                view.chrom = chrom;\n                view.chrom_select.val(view.chrom);\n                view.max_high = found.len - 1; // -1 because we're using 0-based indexing.\n                view.reset();\n\n                for (var i = 0, len = view.drawables.length; i < len; i++) {\n                    var drawable = view.drawables[i];\n                    if (drawable.init) {\n                        drawable.init();\n                    }\n                }\n                if (view.reference_track) {\n                    view.reference_track.init();\n                }\n            }\n\n            // Resolve low, high.\n            if (low === undefined && high === undefined) {\n                // Both are undefined, so view is whole chromosome.\n                view.low = 0;\n                view.high = view.max_high;\n            } else {\n                // Low and/or high is defined.\n                view.low = low !== undefined ? Math.max(low, 0) : 0;\n                if (high === undefined) {\n                    // Center visualization around low.\n                    // HACK: max resolution is currently 30 bases.\n                    view.low = Math.max(view.low - 15, 0);\n                    view.high = view.low + 30;\n                } else {\n                    // High is defined.\n                    view.high = Math.min(high, view.max_high);\n                }\n            }\n\n            view.request_redraw();\n        }\n    },\n\n    /**\n     * Change viewing region to that denoted by string. General format of string is:\n     *\n     * <chrom>[ {separator}<start>[-<end>] ]\n     *\n     * where separator can be whitespace or a colon. Examples:\n     *\n     * chr22\n     * chr1:100-200\n     * chr7 89999\n     * chr8 90000 990000\n     */\n    go_to: function go_to(str) {\n        // Remove commas.\n        str = str.replace(/,/g, \"\");\n\n        // Replace colons and hyphens with space for easy parsing.\n        str = str.replace(/:|\\-/g, \" \");\n\n        // Parse new location.\n        var chrom_pos = str.split(/\\s+/);\n\n        var chrom = chrom_pos[0];\n        var new_low = chrom_pos[1] ? parseInt(chrom_pos[1], 10) : undefined;\n        var new_high = chrom_pos[2] ? parseInt(chrom_pos[2], 10) : undefined;\n\n        this.change_chrom(chrom, new_low, new_high);\n    },\n\n    move_fraction: function move_fraction(fraction) {\n        var view = this;\n        var span = view.high - view.low;\n        this.move_delta(fraction * span);\n    },\n\n    move_delta: function move_delta(delta_chrom) {\n        //\n        // Update low, high.\n        //\n\n        var view = this;\n        var current_chrom_span = view.high - view.low;\n        // Check for left and right boundaries\n        if (view.low - delta_chrom < view.max_low) {\n            view.low = view.max_low;\n            view.high = view.max_low + current_chrom_span;\n        } else if (view.high - delta_chrom > view.max_high) {\n            view.high = view.max_high;\n            view.low = view.max_high - current_chrom_span;\n        } else {\n            view.high -= delta_chrom;\n            view.low -= delta_chrom;\n        }\n\n        //\n        // Redraw view.\n        //\n\n        // Redraw without requesting more data immediately.\n        view.request_redraw({ data_fetch: false });\n\n        // Set up timeout to redraw with more data when moving stops.\n        if (this.redraw_on_move_fn) {\n            clearTimeout(this.redraw_on_move_fn);\n        }\n\n        this.redraw_on_move_fn = setTimeout(function () {\n            view.request_redraw();\n        }, 200);\n\n        // Navigate.\n        var chrom = view.chrom_select.val();\n        this.trigger_navigate(chrom, view.low, view.high, true);\n    },\n\n    /**\n     * Add a drawable to the view.\n     */\n    add_drawable: function add_drawable(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        drawable.init();\n        this.changed();\n        this.update_intro_div();\n\n        // When drawable config changes, mark view as changed. This\n        // captures most (all?) state change that needs to be saved.\n        var self = this;\n        drawable.config.on(\"change\", function () {\n            self.changed();\n        });\n    },\n\n    add_label_track: function add_label_track(label_track) {\n        label_track.view = this;\n        label_track.init();\n        this.label_tracks.push(label_track);\n    },\n\n    /**\n     * Remove drawable from the view.\n     */\n    remove_drawable: function remove_drawable(drawable, hide) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        if (hide) {\n            var view = this;\n            drawable.container_div.hide(0, function () {\n                $(this).remove();\n                view.update_intro_div();\n            });\n        }\n    },\n\n    reset: function reset() {\n        this.low = this.max_low;\n        this.high = this.max_high;\n        this.viewport_container.find(\".yaxislabel\").remove();\n    },\n\n    /**\n     * Request that view redraw one or more of view's drawables. If drawable is not specified,\n     * all drawables are redrawn.\n     */\n    request_redraw: function request_redraw(options, drawable) {\n        var view = this;\n\n        var // Either redrawing a single drawable or all view's drawables.\n        track_list = drawable ? [drawable] : view.drawables;\n\n        // Add/update tracks in track list to redraw list.\n        _.each(track_list, function (track) {\n            var track_options = _.find(view.tracks_to_be_redrawn, function (to) {\n                return to[0] === track;\n            });\n\n            if (track_options) {\n                // Track already in list; update options.\n                track_options[1] = options;\n            } else {\n                // Track not in list yet.\n                view.tracks_to_be_redrawn.push([track, options]);\n            }\n        });\n\n        // Set up redraw if it has not been requested since last redraw.\n        if (!this.requested_redraw) {\n            requestAnimationFrame(function () {\n                view._redraw();\n            });\n            this.requested_redraw = true;\n        }\n    },\n\n    /**\n     * Redraws view and tracks.\n     * NOTE: this method should never be called directly; request_redraw() should be used so\n     * that requestAnimationFrame can manage redrawing.\n     */\n    _redraw: function _redraw() {\n        // TODO: move this code to function that does location setting.\n\n        // Clear because requested redraw is being handled now.\n        this.requested_redraw = false;\n\n        var low = this.low;\n        var high = this.high;\n\n        if (low < this.max_low) {\n            low = this.max_low;\n        }\n        if (high > this.max_high) {\n            high = this.max_high;\n        }\n        var span = this.high - this.low;\n        if (this.high !== 0 && span < this.min_separation) {\n            high = low + this.min_separation;\n        }\n        this.low = Math.floor(low);\n        this.high = Math.ceil(high);\n\n        this.update_location(this.low, this.high);\n\n        // -- Drawing code --\n\n        // Resolution is a pixel density.\n        this.resolution_px_b = this.viewport_container.width() / (this.high - this.low);\n\n        // Overview\n        var left_px = this.low / (this.max_high - this.max_low) * this.overview_viewport.width() || 0;\n        var width_px = (this.high - this.low) / (this.max_high - this.max_low) * this.overview_viewport.width() || 0;\n        var min_width_px = 13;\n\n        this.overview_box.css({\n            left: left_px,\n            width: Math.max(min_width_px, width_px)\n        }).show();\n        if (width_px < min_width_px) {\n            this.overview_box.css(\"left\", left_px - (min_width_px - width_px) / 2);\n        }\n        if (this.overview_highlight) {\n            this.overview_highlight.css({\n                left: left_px,\n                width: width_px\n            });\n        }\n\n        // Draw data tracks.\n        _.each(this.tracks_to_be_redrawn, function (track_options) {\n            var track = track_options[0];\n            var options = track_options[1];\n            if (track) {\n                track._draw(options);\n            }\n        });\n        this.tracks_to_be_redrawn = [];\n\n        // Draw label tracks.\n        _.each(this.label_tracks, function (label_track) {\n            label_track._draw();\n        });\n    },\n\n    zoom_in: function zoom_in(point, container) {\n        if (this.max_high === 0 || this.high - this.low <= this.min_separation) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = span / this.zoom_factor / 2;\n        if (point) {\n            cur_center = point / this.viewport_container.width() * (this.high - this.low) + this.low;\n        }\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n\n        this.changed();\n        this.request_redraw();\n    },\n\n    zoom_out: function zoom_out() {\n        if (this.max_high === 0) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = span * this.zoom_factor / 2;\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n        this.changed();\n        this.request_redraw();\n    },\n\n    /** Resize viewport. Use this method if header/footer content has changed in size. */\n    resize_viewport: function resize_viewport() {\n        this.viewport_container.height(this.container.height() - this.top_container.height() - this.bottom_container.height());\n    },\n\n    /** Called when window is resized. */\n    resize_window: function resize_window() {\n        this.resize_viewport();\n        this.request_redraw();\n    },\n\n    /** Show a Drawable in the overview. */\n    set_overview: function set_overview(drawable) {\n        if (this.overview_drawable) {\n            // If drawable to be set as overview is already in overview, do nothing.\n            // Otherwise, remove overview.\n            if (this.overview_drawable.dataset.id === drawable.dataset.id) {\n                return;\n            }\n            this.overview_viewport.find(\".track\").remove();\n        }\n\n        // Set new overview.\n        var overview_drawable = drawable.copy({\n            content_div: this.overview_viewport\n        });\n\n        var view = this;\n        overview_drawable.header_div.hide();\n        overview_drawable.is_overview = true;\n        view.overview_drawable = overview_drawable;\n        this.overview_drawable.postdraw_actions = function () {\n            view.overview_highlight.show().height(view.overview_drawable.content_div.height());\n            view.overview_viewport.height(view.overview_drawable.content_div.height() + view.overview_box.outerHeight());\n            view.overview_close.show();\n            view.resize_window();\n        };\n        view.overview_drawable.request_draw();\n        this.changed();\n    },\n\n    /** Close and reset overview. */\n    reset_overview: function reset_overview() {\n        // Update UI.\n        $(\".tooltip\").remove();\n        this.overview_viewport.find(\".track-tile\").remove();\n        this.overview_viewport.height(this.default_overview_height);\n        this.overview_box.height(this.default_overview_height);\n        this.overview_close.hide();\n        this.overview_highlight.hide();\n        view.resize_window();\n        view.overview_drawable = null;\n    }\n});\n\n/**\n * Encapsulation of a tool that users can apply to tracks/datasets.\n */\nvar TracksterTool = _tools2.default.Tool.extend({\n    defaults: {\n        track: null\n    },\n\n    initialize: function initialize(options) {\n        _tools2.default.Tool.prototype.initialize.call(this, options);\n\n        // Restore tool visibility from state; default to hidden.\n        var hidden = true;\n        if (options.tool_state !== undefined && options.tool_state.hidden !== undefined) {\n            hidden = options.tool_state.hidden;\n        }\n        this.set(\"hidden\", hidden);\n\n        // FIXME: need to restore tool values from options.tool_state\n\n        // HACK: remove some inputs because Trackster does yet not work with them.\n        this.remove_inputs([\"data\", \"hidden_data\", \"conditional\"]);\n    },\n\n    state_dict: function state_dict(options) {\n        return _.extend(this.get_inputs_dict(), {\n            hidden: !this.is_visible()\n        });\n    }\n});\n\n/**\n * View renders tool parameter HTML and updates parameter value as it is changed in the HTML.\n */\nvar ToolParameterView = Backbone.View.extend({\n    events: {\n        \"change :input\": \"update_value\"\n    },\n\n    render: function render() {\n        var param_div = this.$el.addClass(\"param-row\");\n        var param = this.model;\n\n        // Param label.\n        var label_div = $(\"<div>\").addClass(\"param-label\").text(param.get(\"label\")).appendTo(param_div);\n        // Param HTML.\n        var html_div = $(\"<div/>\").addClass(\"param-input\").html(param.get(\"html\")).appendTo(param_div);\n        // Set initial value.\n        html_div.find(\":input\").val(param.get(\"value\"));\n\n        // Add to clear floating layout.\n        $(\"<div style='clear: both;'/>\").appendTo(param_div);\n    },\n\n    update_value: function update_value(update_event) {\n        this.model.set_value($(update_event.target).val());\n    }\n});\n\n/**\n * View for TracksterTool.\n */\nvar TracksterToolView = Backbone.View.extend({\n    initialize: function initialize(options) {\n        this.model.on(\"change:hidden\", this.set_visible, this);\n    },\n\n    /**\n     * Render tool UI.\n     */\n    render: function render() {\n        var self = this;\n        var tool = this.model;\n        var parent_div = this.$el.addClass(\"dynamic-tool\").hide();\n\n        // Prevent div events from propogating to other elements.\n        parent_div.bind(\"drag\", function (e) {\n            e.stopPropagation();\n        }).click(function (e) {\n            e.stopPropagation();\n        }).bind(\"dblclick\", function (e) {\n            e.stopPropagation();\n        }).keydown(function (e) {\n            e.stopPropagation();\n        });\n\n        // Add name, inputs.\n        var name_div = $(\"<div class='tool-name'>\").appendTo(parent_div).text(tool.get(\"name\"));\n        tool.get(\"inputs\").each(function (param) {\n            // Render parameter.\n            var param_view = new ToolParameterView({ model: param });\n            param_view.render();\n            parent_div.append(param_view.$el);\n        });\n\n        // Highlight value for inputs for easy replacement.\n        parent_div.find(\"input\").click(function () {\n            $(this).select();\n        });\n\n        // Add buttons for running on dataset, region.\n        var run_tool_row = $(\"<div>\").addClass(\"param-row\").appendTo(parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'>\").attr(\"value\", \"Run on complete dataset\").appendTo(run_tool_row);\n        var run_on_region_button = $(\"<input type='submit'>\").attr(\"value\", \"Run on visible region\").appendTo(run_tool_row);\n        run_on_region_button.click(function () {\n            // Run tool to create new track.\n            self.run_on_region();\n        });\n        run_on_dataset_button.click(function () {\n            self.run_on_dataset();\n        });\n\n        if (tool.is_visible()) {\n            this.$el.show();\n        }\n    },\n\n    /**\n     * Show or hide tool depending on tool visibility state.\n     */\n    set_visible: function set_visible() {\n        this.$el.toggle(this.model.is_visible());\n    },\n\n    /**\n     * Update tool parameters.\n     */\n    update_params: function update_params() {\n        for (var i = 0; i < this.params.length; i++) {\n            this.params[i].update_value();\n        }\n    },\n\n    /**\n     * Run tool on dataset. Output is placed in dataset's history and no changes to viz are made.\n     */\n    run_on_dataset: function run_on_dataset() {\n        var tool = this.model;\n        this.run(\n        // URL params.\n        {\n            target_dataset_id: this.model.get(\"track\").dataset.id,\n            action: \"rerun\",\n            tool_id: tool.id\n        }, null, function (track_data) {\n            Galaxy.modal.show({\n                title: tool.get(\"name\") + \" is Running\",\n                body: tool.get(\"name\") + \" is running on the complete dataset. Tool outputs are in dataset's history.\",\n                buttons: {\n                    Close: function Close() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        });\n    },\n\n    /**\n     * Run dataset on visible region. This creates a new track and sets the track's contents\n     * to the tool's output.\n     */\n    run_on_region: function run_on_region() {\n        //\n        // Create track for tool's output immediately to provide user feedback.\n        //\n        var track = this.model.get(\"track\");\n\n        var tool = this.model;\n\n        var region = new _visualization2.default.GenomeRegion({\n            chrom: track.view.chrom,\n            start: track.view.low,\n            end: track.view.high\n        });\n\n        var url_params = {\n            target_dataset_id: track.dataset.id,\n            action: \"rerun\",\n            tool_id: tool.id,\n            regions: [region.toJSON()]\n        };\n\n        var current_track = track;\n\n        var // Set name of track to include tool name, parameters, and region used.\n        track_name = tool.get(\"name\") + current_track.tool_region_and_parameters_str(region);\n\n        var container;\n\n        // If track not in a group, create a group for it and add new track to group. If track\n        // already in group, add track to group.\n        if (current_track.container === view) {\n            // Create new group.\n            var group = new DrawableGroup(view, view, {\n                name: track.config.get_value(\"name\")\n            });\n\n            // Replace track with group.\n            var index = current_track.container.replace_drawable(current_track, group, false);\n\n            // Update HTML.\n            // FIXME: this is ugly way to replace a track with a group -- make this easier via\n            // a Drawable or DrawableCollection function.\n            group.container_div.insertBefore(current_track.view.content_div.children()[index]);\n            group.add_drawable(current_track);\n            current_track.container_div.appendTo(group.content_div);\n            container = group;\n        } else {\n            // Use current group.\n            container = current_track.container;\n        }\n\n        // Create and init new track.\n        var new_track = new current_track.constructor(view, container, {\n            name: track_name,\n            hda_ldda: \"hda\"\n        });\n        new_track.init_for_tool_data();\n        new_track.change_mode(current_track.mode);\n        new_track.set_filters_manager(current_track.filters_manager.copy(new_track));\n        new_track.update_icons();\n        container.add_drawable(new_track);\n        new_track.tiles_div.text(\"Starting job.\");\n\n        // Run tool.\n        this.run(url_params, new_track, function (track_data) {\n            new_track.set_dataset(new _data2.default.Dataset(track_data));\n            new_track.tiles_div.text(\"Running job.\");\n            new_track.init();\n        });\n    },\n\n    /**\n     * Run tool using a set of URL params and a success callback.\n     */\n    run: function run(url_params, new_track, success_callback) {\n        // Run tool.\n        url_params.inputs = this.model.get_inputs_dict();\n        var ss_deferred = new _util2.default.ServerStateDeferred({\n            ajax_settings: {\n                url: Galaxy.root + \"api/tools\",\n                data: JSON.stringify(url_params),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function success_fn(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Start with this status message.\n        //new_track.container_div.addClass(\"pending\");\n        //new_track.content_div.html(DATA_PENDING);\n\n        $.when(ss_deferred.go()).then(function (response) {\n            if (response === \"no converter\") {\n                // No converter available for input datasets, so cannot run tool.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_NOCONVERTER);\n            } else if (response.error) {\n                // General error.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_CANNOT_RUN_TOOL + response.message);\n            } else {\n                // Job submitted and running.\n                success_callback(response);\n            }\n        });\n    }\n});\n\n/**\n * Generates scale values based on filter and feature's value for filter.\n */\nvar FilterScaler = function FilterScaler(filter, default_val) {\n    _painters2.default.Scaler.call(this, default_val);\n    this.filter = filter;\n};\n\nFilterScaler.prototype.gen_val = function (feature_data) {\n    // If filter is not initalized yet, return default val.\n    if (this.filter.high === Number.MAX_VALUE || this.filter.low === -Number.MAX_VALUE || this.filter.low === this.filter.high) {\n        return this.default_val;\n    }\n\n    // Scaling value is ratio of (filter's value compared to low) to (complete filter range).\n    return (parseFloat(feature_data[this.filter.index]) - this.filter.low) / (this.filter.high - this.filter.low);\n};\n\n/**\n * Tiles drawn by tracks.\n */\nvar Tile = function Tile(track, region, w_scale, canvas, data) {\n    this.track = track;\n    this.region = region;\n    this.low = region.get(\"start\");\n    this.high = region.get(\"end\");\n    this.w_scale = w_scale;\n    this.canvas = canvas;\n    // Wrap element in div for background and to provide container for tile-specific elements.\n    this.html_elt = $(\"<div class='track-tile'/>\").append(canvas);\n    this.data = data;\n    this.stale = false;\n};\n\n/**\n * Perform pre-display actions.\n */\nTile.prototype.predisplay_actions = function () {};\n\nvar LineTrackTile = function LineTrackTile(track, region, w_scale, canvas, data) {\n    Tile.call(this, track, region, w_scale, canvas, data);\n};\nLineTrackTile.prototype.predisplay_actions = function () {};\n\nvar FeatureTrackTile = function FeatureTrackTile(track, region, w_scale, canvas, data, mode, message, all_slotted, feature_mapper, incomplete_features, seq_data) {\n    // Attribute init.\n    Tile.call(this, track, region, w_scale, canvas, data);\n    this.mode = mode;\n    this.all_slotted = all_slotted;\n    this.feature_mapper = feature_mapper;\n    this.has_icons = false;\n    this.incomplete_features = incomplete_features;\n    // Features drawn based on data from other tiles.\n    this.other_tiles_features_drawn = {};\n    this.seq_data = seq_data;\n\n    // Add message + action icons to tile's html.\n    /*\n    This does not work right now because a random set of reads is returned by the server.\n    When the server can respond with more data systematically, renable these icons.\n    if (message) {\n        this.has_icons = true;\n         var\n            tile = this;\n            canvas = this.html_elt.children()[0],\n            message_div = $(\"<div/>\").addClass(\"tile-message\")\n                            // -1 to account for border.\n                            .css({'height': ERROR_PADDING, 'width': canvas.width}).prependTo(this.html_elt);\n         // Handle message; only message currently is that only the first N elements are displayed.\n        var tile_region = new visualization.GenomeRegion({\n                chrom: track.view.chrom,\n                start: this.low,\n                end: this.high\n            }),\n            num_features = data.length,\n            more_down_icon = $(\"<a/>\").addClass(\"icon more-down\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data including depth\")\n                                .tooltip().appendTo(message_div),\n            more_across_icon = $(\"<a/>\").addClass(\"icon more-across\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data excluding depth\")\n                                .tooltip().appendTo(message_div);\n         // Set up actions for icons.\n        more_down_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.DEEP_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n         more_across_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.BROAD_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n    }\n    */\n};\nextend(FeatureTrackTile.prototype, Tile.prototype);\n\n/**\n * Sets up support for popups.\n */\nFeatureTrackTile.prototype.predisplay_actions = function () {\n    /*\n    FIXME: use a canvas library to handle popups.\n    //\n    // Add support for popups.\n    //\n    var tile = this,\n        popups = {};\n     // Only show popups in Pack mode.\n    if (tile.mode !== \"Pack\") { return; }\n     $(this.html_elt).hover(\n    function() {\n        this.hovered = true;\n        $(this).mousemove();\n    },\n    function() {\n        this.hovered = false;\n        // Clear popup if it is still hanging around (this is probably not needed)\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    } ).mousemove(function (e) {\n        // Use the hover plugin to get a delay before showing popup\n        if ( !this.hovered ) { return; }\n        // Get feature data for position.\n        var\n            this_offset = $(this).offset(),\n            offsetX = e.pageX - this_offset.left,\n            offsetY = e.pageY - this_offset.top,\n            feature_data = tile.feature_mapper.get_feature_data(offsetX, offsetY),\n            feature_uid = (feature_data ? feature_data[0] : null);\n        // Hide visible popup if not over a feature or over a different feature.\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").each(function() {\n            if ( !feature_uid ||\n                 $(this).attr(\"id\") !== feature_uid.toString() ) {\n                $(this).remove();\n            }\n        });\n         if (feature_data) {\n            // Get or create popup.\n            var popup = popups[feature_uid];\n            if (!popup) {\n                // Create feature's popup element.\n                var feature_dict = {\n                        name: feature_data[3],\n                        start: feature_data[1],\n                        end: feature_data[2],\n                        strand: feature_data[4]\n                    },\n                    filters = tile.track.filters_manager.filters,\n                    filter;\n                 // Add filter values to feature dict.\n                for (var i = 0; i < filters.length; i++) {\n                    filter = filters[i];\n                    feature_dict[filter.name] = feature_data[filter.index];\n                }\n                 // Build popup.\n                popup = $(\"<div/>\").attr(\"id\", feature_uid).addClass(\"feature-popup\");\n                var table = $(\"<table/>\"),\n                    key, value, row;\n                for (key in feature_dict) {\n                    value = feature_dict[key];\n                    row = $(\"<tr/>\").appendTo(table);\n                    $(\"<th/>\").appendTo(row).text(key);\n                    $(\"<td/>\").attr(\"align\", \"left\").appendTo(row)\n                              .text(typeof(value) === 'number' ? round(value, 2) : value);\n                }\n                popup.append( $(\"<div class='feature-popup-inner'>\").append( table ) );\n                popups[feature_uid] = popup;\n            }\n             // Attach popup to track's overlay.\n            popup.appendTo( $(this).parents(\".track-content\").children(\".overlay\") );\n             // Offsets are within canvas, but popup must be positioned relative to parent element.\n            // parseInt strips \"px\" from left, top measurements. +7 so that mouse pointer does not\n            // overlap popup.\n            var\n                popupX = offsetX + parseInt( tile.html_elt.css(\"left\"), 10 ) - popup.width() / 2,\n                popupY = offsetY + parseInt( tile.html_elt.css(\"top\"), 10 ) + 7;\n            popup.css(\"left\", popupX + \"px\").css(\"top\", popupY + \"px\");\n        }\n        else if (!e.isPropagationStopped()) {\n            // Propogate event to other tiles because overlapping tiles prevent mousemove from being\n            // called on tiles under this tile.\n            e.stopPropagation();\n            $(this).siblings().each(function() {\n                $(this).trigger(e);\n            });\n        }\n    })\n    .mouseleave(function() {\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    });\n    */\n};\n\n/**\n * Tracks are objects can be added to the View.\n *\n * Track object hierarchy:\n * Track\n * -> LabelTrack\n * -> TiledTrack\n * ----> LineTrack\n * ----> ReferenceTrack\n * ----> FeatureTrack\n * -------> ReadTrack\n * ----> VariantTrack\n */\nvar Track = function Track(view, container, obj_dict) {\n    // For now, track's container is always view.\n    extend(obj_dict, {\n        drag_handle_class: \"draghandle\"\n    });\n    Drawable.call(this, view, container, obj_dict);\n\n    //\n    // Attribute init.\n    //\n\n    // Set or create dataset.\n    this.dataset = null;\n    if (obj_dict.dataset) {\n        // Dataset can be a Backbone model or a dict that can be used to create a model.\n        this.dataset = obj_dict.dataset instanceof Backbone.Model ? obj_dict.dataset : new _data2.default.Dataset(obj_dict.dataset);\n    }\n    this.dataset_check_type = \"converted_datasets_state\";\n    this.data_url_extra_params = {};\n    this.data_query_wait = \"data_query_wait\" in obj_dict ? obj_dict.data_query_wait : DEFAULT_DATA_QUERY_WAIT;\n    // A little ugly creating data manager right now due to transition to Backbone-based objects.\n    this.data_manager = \"data_manager\" in obj_dict ? obj_dict.data_manager : new _visualization2.default.GenomeDataManager({\n        dataset: this.dataset,\n        // HACK: simulate 'genome' attributes from view for now.\n        // View should eventually use Genome object.\n        genome: new _visualization2.default.Genome({\n            key: view.dbkey,\n            chroms_info: {\n                chrom_info: view.chrom_data\n            }\n        }),\n        data_mode_compatible: this.data_and_mode_compatible,\n        can_subset: this.can_subset\n    });\n\n    // Height attributes: min height, max height, and visible height.\n    this.min_height_px = 16;\n    this.max_height_px = 800;\n    this.visible_height_px = this.config.get_value(\"height\");\n\n    //\n    // Create content div, which is where track is displayed, and add to container if available.\n    //\n    this.content_div = $(\"<div class='track-content'>\").appendTo(this.container_div);\n    if (this.container) {\n        this.container.content_div.append(this.container_div);\n        if (!(\"resize\" in obj_dict) || obj_dict.resize) {\n            this.add_resize_handle();\n        }\n    }\n};\n\nextend(Track.prototype, Drawable.prototype, {\n    action_icons_def: [\n    // Change track mode.\n    {\n        name: \"mode_icon\",\n        title: \"Set display mode\",\n        css_class: \"chevron-expand\",\n        on_click_fn: function on_click_fn() {}\n    },\n    // Hide/show content.\n    Drawable.prototype.action_icons_def[0],\n    // Set track as overview.\n    {\n        name: \"overview_icon\",\n        title: \"Set as overview\",\n        css_class: \"application-dock-270\",\n        on_click_fn: function on_click_fn(track) {\n            track.view.set_overview(track);\n        }\n    },\n    // Edit config.\n    Drawable.prototype.action_icons_def[1],\n    // Toggle track filters.\n    {\n        name: \"filters_icon\",\n        title: \"Filters\",\n        css_class: \"ui-slider-050\",\n        on_click_fn: function on_click_fn(drawable) {\n            // TODO: update Tooltip text.\n            if (drawable.filters_manager.visible()) {\n                drawable.filters_manager.clear_filters();\n            } else {\n                drawable.filters_manager.init_filters();\n            }\n            drawable.filters_manager.toggle();\n        }\n    },\n    // Toggle track tool.\n    {\n        name: \"tools_icon\",\n        title: \"Tool\",\n        css_class: \"hammer\",\n        on_click_fn: function on_click_fn(track) {\n            // TODO: update Tooltip text.\n\n            track.tool.toggle();\n\n            // Update track name.\n            if (track.tool.is_visible()) {\n                track.set_name(track.config.get_value(\"name\") + track.tool_region_and_parameters_str());\n            } else {\n                track.revert_name();\n            }\n            // HACK: name change modifies icon placement, which leaves tooltip incorrectly placed.\n            $(\".tooltip\").remove();\n        }\n    },\n    // Go to parameter exploration visualization.\n    {\n        name: \"param_space_viz_icon\",\n        title: \"Tool parameter space visualization\",\n        css_class: \"arrow-split\",\n        on_click_fn: function on_click_fn(track) {\n            var html = \"<strong>Tool</strong>:\" + track.tool.get(\"name\") + \"<br/><strong>Dataset</strong>:\" + track.config.get_value(\"name\") + \"<br/><strong>Region(s)</strong>: <select name=\\\"regions\\\"><option value=\\\"cur\\\">current viewing area</option><option value=\\\"bookmarks\\\">bookmarks</option><option value=\\\"both\\\">current viewing area and bookmarks</option></select>\";\n\n            var cancel_fn = function cancel_fn() {\n                Galaxy.modal.hide();\n                $(window).unbind(\"keypress.check_enter_esc\");\n            };\n\n            var ok_fn = function ok_fn() {\n                var regions_to_use = $('select[name=\"regions\"] option:selected').val(),\n                    regions,\n                    view_region = new _visualization2.default.GenomeRegion({\n                    chrom: view.chrom,\n                    start: view.low,\n                    end: view.high\n                }),\n                    bookmarked_regions = _.map($(\".bookmark\"), function (elt) {\n                    return new _visualization2.default.GenomeRegion({\n                        from_str: $(elt).children(\".position\").text()\n                    });\n                });\n\n                // Get regions for visualization.\n                if (regions_to_use === \"cur\") {\n                    // Use only current region.\n                    regions = [view_region];\n                } else if (regions_to_use === \"bookmarks\") {\n                    // Use only bookmarks.\n                    regions = bookmarked_regions;\n                } else {\n                    // Use both current region and bookmarks.\n                    regions = [view_region].concat(bookmarked_regions);\n                }\n\n                Galaxy.modal.hide();\n\n                // Go to visualization.\n                window.location.href = Galaxy.root + \"visualization/sweepster?\" + $.param({\n                    dataset_id: track.dataset.id,\n                    hda_ldda: track.dataset.get(\"hda_ldda\"),\n                    regions: JSON.stringify(new Backbone.Collection(regions).toJSON())\n                });\n            };\n\n            var check_enter_esc = function check_enter_esc(e) {\n                if ((e.keyCode || e.which) === 27) {\n                    // Escape key\n                    cancel_fn();\n                } else if ((e.keyCode || e.which) === 13) {\n                    // Enter key\n                    ok_fn();\n                }\n            };\n\n            // show dialog\n            Galaxy.modal.show({\n                title: \"Visualize tool parameter space and output from different parameter settings?\",\n                body: html,\n                buttons: { No: cancel_fn, Yes: ok_fn }\n            });\n        }\n    },\n    // Remove track.\n    Drawable.prototype.action_icons_def[2]],\n\n    can_draw: function can_draw() {\n        return this.dataset && Drawable.prototype.can_draw.call(this);\n    },\n\n    build_container_div: function build_container_div() {\n        return $(\"<div/>\").addClass(\"track\").attr(\"id\", \"track_\" + this.id);\n    },\n\n    /**\n     * Set track's dataset.\n     */\n    set_dataset: function set_dataset(dataset) {\n        this.dataset = dataset;\n        this.data_manager.set(\"dataset\", dataset);\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function on_resize() {\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Add resizing handle to drawable's container_div.\n     */\n    add_resize_handle: function add_resize_handle() {\n        var track = this;\n        var in_handle = false;\n        var in_drag = false;\n        var drag_control = $(\"<div class='track-resize'>\");\n        // Control shows on hover over track, stays while dragging\n        $(track.container_div).hover(function () {\n            if (track.config.get_value(\"content_visible\")) {\n                in_handle = true;\n                drag_control.show();\n            }\n        }, function () {\n            in_handle = false;\n            if (!in_drag) {\n                drag_control.hide();\n            }\n        });\n        // Update height and force redraw of current view while dragging,\n        // clear cache to force redraw of other tiles.\n        drag_control.hide().bind(\"dragstart\", function (e, d) {\n            in_drag = true;\n            d.original_height = $(track.content_div).height();\n        }).bind(\"drag\", function (e, d) {\n            var new_height = Math.min(Math.max(d.original_height + d.deltaY, track.min_height_px), track.max_height_px);\n            $(track.tiles_div).css(\"height\", new_height);\n            track.visible_height_px = track.max_height_px === new_height ? 0 : new_height;\n            track.on_resize();\n        }).bind(\"dragend\", function (e, d) {\n            track.tile_cache.clear();\n            in_drag = false;\n            if (!in_handle) {\n                drag_control.hide();\n            }\n            track.config.set_value(\"height\", track.visible_height_px);\n            track.changed();\n        }).appendTo(track.container_div);\n    },\n\n    /**\n     * Hide any elements that are part of the tracks contents area. Should\n     * remove as approprite, the track will be redrawn by show_contents.\n     */\n    hide_contents: function hide_contents() {\n        // Hide tiles.\n        this.tiles_div.hide();\n        // Hide any y axis labels (common to several track types)\n        this.container_div.find(\".yaxislabel, .track-resize\").hide();\n    },\n\n    show_contents: function show_contents() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        this.container_div.find(\".yaxislabel, .track-resize\").show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    /**\n     * Returns track type.\n     */\n    get_type: function get_type() {\n        // Order is important: start with most-specific classes and go up the track hierarchy.\n        if (this instanceof LabelTrack) {\n            return \"LabelTrack\";\n        } else if (this instanceof ReferenceTrack) {\n            return \"ReferenceTrack\";\n        } else if (this instanceof LineTrack) {\n            return \"LineTrack\";\n        } else if (this instanceof ReadTrack) {\n            return \"ReadTrack\";\n        } else if (this instanceof VariantTrack) {\n            return \"VariantTrack\";\n        } else if (this instanceof CompositeTrack) {\n            return \"CompositeTrack\";\n        } else if (this instanceof FeatureTrack) {\n            return \"FeatureTrack\";\n        }\n        return \"\";\n    },\n\n    /**\n     * Remove visualization content and display message.\n     */\n    show_message: function show_message(msg_html) {\n        this.tiles_div.remove();\n        return $(\"<span/>\").addClass(\"message\").html(msg_html).appendTo(this.content_div);\n    },\n\n    /**\n     * Initialize and draw the track.\n     */\n    init: function init(retry) {\n        // FIXME: track should have a 'state' attribute that is checked on load; this state attribute should be\n        // used in this function to determine what action(s) to take.\n\n        var track = this;\n        track.enabled = false;\n        track.tile_cache.clear();\n        track.data_manager.clear();\n        /*\n        if (!track.content_div.text()) {\n            track.content_div.text(DATA_LOADING);\n        }\n        */\n        // Remove old track content (e.g. tiles, messages).\n        track.content_div.children().remove();\n        track.container_div.removeClass(\"nodata error pending\");\n\n        track.tiles_div = $(\"<div/>\").addClass(\"tiles\").appendTo(track.content_div);\n\n        //\n        // Tracks with no dataset id are handled differently.\n        // FIXME: is this really necessary?\n        //\n        if (!track.dataset.id) {\n            return;\n        }\n\n        // Get dataset state; if state is fine, enable and draw track. Otherwise, show message\n        // about track status.\n        var init_deferred = $.Deferred();\n\n        var params = {\n            hda_ldda: track.dataset.get(\"hda_ldda\"),\n            data_type: this.dataset_check_type,\n            chrom: track.view.chrom,\n            retry: retry\n        };\n\n        $.getJSON(this.dataset.url(), params, function (result) {\n            if (!result || result === \"error\" || result.kind === \"error\") {\n                // Dataset is in error state.\n                track.container_div.addClass(\"error\");\n                var msg_elt = track.show_message(DATA_ERROR);\n                if (result.message) {\n                    // Add links to (a) show error and (b) try again.\n                    msg_elt.append($(\"<a href='javascript:void(0);'></a>\").text(\"View error\").click(function () {\n                        Galaxy.modal.show({\n                            title: \"Trackster Error\",\n                            body: \"<pre>\" + result.message + \"</pre>\",\n                            buttons: {\n                                Close: function Close() {\n                                    Galaxy.modal.hide();\n                                }\n                            }\n                        });\n                    }));\n                    msg_elt.append($(\"<span/>\").text(\" \"));\n                    msg_elt.append($(\"<a href='javascript:void(0);'></a>\").text(\"Try again\").click(function () {\n                        track.init(true);\n                    }));\n                }\n            } else if (result === \"no converter\") {\n                track.container_div.addClass(\"error\");\n                track.show_message(DATA_NOCONVERTER);\n            } else if (result === \"no data\" || result.data !== undefined && (result.data === null || result.data.length === 0)) {\n                track.container_div.addClass(\"nodata\");\n                track.show_message(DATA_NONE);\n            } else if (result === \"pending\") {\n                track.container_div.addClass(\"pending\");\n                track.show_message(DATA_PENDING);\n                //$(\"<img/>\").attr(\"src\", image_path + \"/yui/rel_interstitial_loading.gif\").appendTo(track.tiles_div);\n                setTimeout(function () {\n                    track.init();\n                }, track.data_query_wait);\n            } else if (result === \"data\" || result.status === \"data\") {\n                if (result.valid_chroms) {\n                    track.valid_chroms = result.valid_chroms;\n                    track.update_icons();\n                }\n                track.tiles_div.text(DATA_OK);\n                if (track.view.chrom) {\n                    track.tiles_div.text(\"\");\n                    track.tiles_div.css(\"height\", track.visible_height_px + \"px\");\n                    track.enabled = true;\n                    // predraw_init may be asynchronous, wait for it and then draw\n                    $.when.apply($, track.predraw_init()).done(function () {\n                        init_deferred.resolve();\n                        track.container_div.removeClass(\"nodata error pending\");\n                        track.request_draw();\n                    });\n                } else {\n                    init_deferred.resolve();\n                }\n            }\n        });\n\n        this.update_icons();\n        return init_deferred;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function predraw_init() {\n        var track = this;\n        return $.getJSON(track.dataset.url(), {\n            data_type: \"data\",\n            stats: true,\n            chrom: track.view.chrom,\n            low: 0,\n            high: track.view.max_high,\n            hda_ldda: track.dataset.get(\"hda_ldda\")\n        }, function (result) {\n            var data = result.data;\n\n            // Tracks may not have stat data either because there is no data or data is not yet ready.\n            if (data && data.min !== undefined && data.max !== undefined) {\n                // Compute default minimum and maximum values\n                var min_value = data.min;\n\n                var max_value = data.max;\n                // If mean and sd are present, use them to compute a ~95% window\n                // but only if it would shrink the range on one side\n                min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                // Update config, prefs\n                track.config.set_default_value(\"min_value\", min_value);\n                track.config.set_default_value(\"max_value\", max_value);\n                track.config.set_value(\"min_value\", min_value);\n                track.config.set_value(\"max_value\", max_value);\n            }\n        });\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function get_drawables() {\n        return this;\n    }\n});\n\nvar TiledTrack = function TiledTrack(view, container, obj_dict) {\n    Track.call(this, view, container, obj_dict);\n\n    var track = this;\n\n    // Make track moveable.\n    moveable(track.container_div, track.drag_handle_class, \".group\", track);\n\n    // Attribute init.\n    this.filters_manager = new _filters2.default.FiltersManager(this, \"filters\" in obj_dict ? obj_dict.filters : null);\n    // HACK: set filters manager for data manager.\n    // FIXME: prolly need function to set filters and update data_manager reference.\n    this.data_manager.set(\"filters_manager\", this.filters_manager);\n    this.filters_available = false;\n    this.tool = obj_dict.tool ? new TracksterTool(_.extend(obj_dict.tool, {\n        track: this,\n        tool_state: obj_dict.tool_state\n    })) : null;\n    this.tile_cache = new _visualization2.default.Cache(TILE_CACHE_SIZE);\n    this.left_offset = 0;\n\n    if (this.header_div) {\n        //\n        // Setup filters.\n        //\n        this.set_filters_manager(this.filters_manager);\n\n        //\n        // Create dynamic tool view.\n        //\n        if (this.tool) {\n            var tool_view = new TracksterToolView({ model: this.tool });\n            tool_view.render();\n            this.dynamic_tool_div = tool_view.$el;\n            this.header_div.after(this.dynamic_tool_div);\n        }\n    }\n\n    // Add tiles_div, overlay_div to content_div.\n    this.tiles_div = $(\"<div/>\").addClass(\"tiles\").appendTo(this.content_div);\n    if (!this.config.get_value(\"content_visible\")) {\n        this.tiles_div.hide();\n    }\n    this.overlay_div = $(\"<div/>\").addClass(\"overlay\").appendTo(this.content_div);\n\n    if (obj_dict.mode) {\n        this.change_mode(obj_dict.mode);\n    }\n};\nextend(TiledTrack.prototype, Drawable.prototype, Track.prototype, {\n    action_icons_def: Track.prototype.action_icons_def.concat([\n    // Show more rows when all features are not slotted.\n    {\n        name: \"show_more_rows_icon\",\n        title: \"To minimize track height, not all feature rows are displayed. Click to display more rows.\",\n        css_class: \"exclamation\",\n        on_click_fn: function on_click_fn(track) {\n            $(\".tooltip\").remove();\n            track.slotters[track.view.resolution_px_b].max_rows *= 2;\n            track.request_draw({ clear_tile_cache: true });\n        },\n        hide: true\n    }]),\n\n    /**\n     * Returns a copy of the track. The copy uses the same data manager so that the tracks can share data.\n     */\n    copy: function copy(container) {\n        // Create copy.\n        var obj_dict = this.to_dict();\n        extend(obj_dict, {\n            data_manager: this.data_manager\n        });\n        var new_track = new this.constructor(this.view, container, obj_dict);\n        // Misc. init and return.\n        new_track.change_mode(this.mode);\n        new_track.enabled = this.enabled;\n        return new_track;\n    },\n\n    /**\n     * Set filters manager + HTML elements.\n     */\n    set_filters_manager: function set_filters_manager(filters_manager) {\n        this.filters_manager = filters_manager;\n        this.header_div.after(this.filters_manager.parent_div);\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function to_dict() {\n        return {\n            track_type: this.get_type(),\n            dataset: {\n                id: this.dataset.id,\n                hda_ldda: this.dataset.get(\"hda_ldda\")\n            },\n            prefs: this.config.to_key_value_dict(),\n            mode: this.mode,\n            filters: this.filters_manager.to_dict(),\n            tool_state: this.tool ? this.tool.state_dict() : {}\n        };\n    },\n\n    /**\n     * Set track bounds for current chromosome.\n     */\n    set_min_max: function set_min_max() {\n        var track = this;\n\n        return $.getJSON(track.dataset.url(), {\n            data_type: \"data\",\n            stats: true,\n            chrom: track.view.chrom,\n            low: 0,\n            high: track.view.max_high,\n            hda_ldda: track.dataset.get(\"hda_ldda\")\n        }, function (result) {\n            var data = result.data;\n            if (isNaN(parseFloat(track.config.get_value(\"min_value\"))) || isNaN(parseFloat(track.config.get_value(\"max_value\")))) {\n                // Compute default minimum and maximum values\n                var min_value = data.min;\n\n                var max_value = data.max;\n                // If mean and sd are present, use them to compute a ~95% window\n                // but only if it would shrink the range on one side\n                min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                // Update the prefs\n                track.config.set_value(\"min_value\", min_value);\n                track.config.set_value(\"max_value\", max_value);\n            }\n        });\n    },\n\n    /**\n     * Change track's mode.\n     */\n    change_mode: function change_mode(new_mode) {\n        var track = this;\n        // TODO: is it necessary to store the mode in two places (.mode and track_config)?\n        track.mode = new_mode;\n        track.config.set_value(\"mode\", new_mode);\n        // FIXME: find a better way to get Auto data w/o clearing cache; using mode in the\n        // data manager would work if Auto data were checked for compatibility when a specific\n        // mode is chosen.\n        if (new_mode === \"Auto\") {\n            this.data_manager.clear();\n        }\n        track.request_draw({ clear_tile_cache: true });\n        this.action_icons.mode_icon.attr(\"title\", \"Set display mode (now: \" + track.mode + \")\");\n        return track;\n    },\n\n    /**\n     * Update track's buttons.\n     */\n    update_icons: function update_icons() {\n        var track = this;\n\n        //\n        // Show/hide filter icon.\n        //\n        track.action_icons.filters_icon.toggle(track.filters_available);\n\n        //\n        // Show/hide tool icons.\n        //\n        track.action_icons.tools_icon.toggle(track.tool !== null);\n        track.action_icons.param_space_viz_icon.toggle(track.tool !== null);\n    },\n\n    /**\n     * Generate a key for the tile cache.\n     * TODO: create a TileCache object (like DataCache) and generate key internally.\n     */\n    _gen_tile_cache_key: function _gen_tile_cache_key(w_scale, tile_region) {\n        return w_scale + \"_\" + tile_region;\n    },\n\n    /**\n     * Request that track be drawn.\n     */\n    request_draw: function request_draw(options) {\n        if (options && options.clear_tile_cache) {\n            this.tile_cache.clear();\n        }\n        this.view.request_redraw(options, this);\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    before_draw: function before_draw() {\n        // Clear because this is set when drawing.\n        this.max_height_px = 0;\n    },\n\n    /**\n     * Draw track. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -clear_after: clear old tiles after drawing new tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     *\n     * NOTE: this function should never be called directly; use request_draw() so that drawing\n     * management can be used.\n     */\n    _draw: function _draw(options) {\n        if (!this.can_draw()) {\n            return;\n        }\n\n        var clear_after = options && options.clear_after;\n        var low = this.view.low;\n        var high = this.view.high;\n        var range = high - low;\n        var width = this.view.container.width();\n        var w_scale = this.view.resolution_px_b;\n        var resolution = 1 / w_scale;\n\n        // For overview, adjust high, low, resolution, and w_scale.\n        if (this.is_overview) {\n            low = this.view.max_low;\n            high = this.view.max_high;\n            w_scale = width / (view.max_high - view.max_low);\n            resolution = 1 / w_scale;\n        }\n\n        this.before_draw();\n\n        //\n        // Method for moving and/or removing tiles:\n        // (a) mark all elements for removal using class 'remove'\n        // (b) during tile drawing/placement, remove class for elements that are moved;\n        //     this occurs in show_tile()\n        // (c) after drawing tiles, remove elements still marked for removal\n        //     (i.e. that still have class 'remove').\n        //\n\n        // Step (a) for (re)moving tiles.\n        this.tiles_div.children().addClass(\"remove\");\n\n        var // Tile width in bases.\n        tile_width = Math.floor(TILE_SIZE * resolution);\n\n        var // Index of first tile that overlaps visible region.\n        tile_index = Math.floor(low / tile_width);\n\n        var tile_region;\n        var tile_promise;\n        var tile_promises = [];\n        var tiles = [];\n        // Draw tiles.\n        while (tile_index * tile_width < high) {\n            // Get tile region.\n            tile_region = new _visualization2.default.GenomeRegion({\n                chrom: this.view.chrom,\n                start: tile_index * tile_width,\n                // Tile high cannot be larger than view.max_high, which the chromosome length.\n                end: Math.min((tile_index + 1) * tile_width, this.view.max_high)\n            });\n            tile_promise = this.draw_helper(tile_region, w_scale, options);\n            tile_promises.push(tile_promise);\n            $.when(tile_promise).then(function (tile) {\n                tiles.push(tile);\n            });\n\n            // Go to next tile.\n            tile_index += 1;\n        }\n\n        // Step (c) for (re)moving tiles when clear_after is false.\n        if (!clear_after) {\n            this.tiles_div.children(\".remove\").removeClass(\"remove\").remove();\n        }\n\n        // When all tiles are drawn, call post-draw actions.\n        var track = this;\n        $.when.apply($, tile_promises).then(function () {\n            // Step (c) for (re)moving tiles when clear_after is true:\n            track.tiles_div.children(\".remove\").remove();\n\n            // Only do postdraw actions for tiles; instances where tiles may not be drawn include:\n            // (a) ReferenceTrack without sufficient resolution;\n            // (b) data_fetch = false.\n            tiles = _.filter(tiles, function (t) {\n                return t !== null;\n            });\n            if (tiles.length !== 0) {\n                track.postdraw_actions(tiles, width, w_scale, clear_after);\n            }\n        });\n    },\n\n    /**\n     * Add a maximum/minimum label to track.\n     */\n    _add_yaxis_label: function _add_yaxis_label(type, on_change) {\n        var track = this;\n        var css_class = type === \"max\" ? \"top\" : \"bottom\";\n        var text = type === \"max\" ? \"max\" : \"min\";\n        var pref_name = type === \"max\" ? \"max_value\" : \"min_value\";\n        var label = this.container_div.find(\".yaxislabel.\" + css_class);\n        var value = round(track.config.get_value(pref_name), 1);\n\n        // Default action for on_change is to redraw track.\n        on_change = on_change || function () {\n            track.request_draw({ clear_tile_cache: true });\n        };\n\n        if (label.length !== 0) {\n            // Label already exists, so update value.\n            label.text(value);\n        } else {\n            // Add label.\n            label = $(\"<div/>\").text(value).make_text_editable({\n                num_cols: 12,\n                on_finish: function on_finish(new_val) {\n                    $(\".tooltip\").remove();\n                    track.config.set_value(pref_name, round(new_val, 1));\n                    on_change();\n                },\n                help_text: \"Set \" + text + \" value\"\n            }).addClass(\"yaxislabel \" + css_class).css(\"color\", this.config.get_value(\"label_color\"));\n            this.container_div.prepend(label);\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function postdraw_actions(tiles, width, w_scale, clear_after) {\n        var line_track_tiles = _.filter(tiles, function (tile) {\n            return tile instanceof LineTrackTile;\n        });\n\n        //\n        // Take different actions depending on whether there are LineTrack/Coverage tiles.\n        //\n\n        if (line_track_tiles.length > 0) {\n            // -- Drawing in Coverage mode. --\n\n            // Clear because this is set when drawing.\n            this.max_height_px = 0;\n            var track = this;\n            _.each(tiles, function (tile) {\n                if (!(tile instanceof LineTrackTile)) {\n                    tile.html_elt.remove();\n                    track.draw_helper(tile.region, w_scale, {\n                        force: true,\n                        mode: \"Coverage\"\n                    });\n                }\n            });\n\n            track._add_yaxis_label(\"max\");\n        } else {\n            // -- Drawing in non-Coverage mode. --\n\n            // Remove Y-axis labels because there are no line track tiles.\n            this.container_div.find(\".yaxislabel\").remove();\n\n            //\n            // If some tiles have icons, set padding of tiles without icons so features and rows align.\n            //\n            var icons_present = _.find(tiles, function (tile) {\n                return tile.has_icons;\n            });\n\n            if (icons_present) {\n                _.each(tiles, function (tile) {\n                    if (!tile.has_icons) {\n                        // Need to align with other tile(s) that have icons.\n                        tile.html_elt.css(\"padding-top\", ERROR_PADDING);\n                    }\n                });\n            }\n        }\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function get_mode(data) {\n        return this.mode;\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function update_auto_mode(display_mode) {\n        // FIXME: needs to be implemented.\n    },\n\n    /**\n     * Returns a list of drawables to draw. Defaults to current track.\n     */\n    _get_drawables: function _get_drawables() {\n        return [this];\n    },\n\n    /**\n     * Retrieves from cache, draws, or sets up drawing for a single tile. Returns either a Tile object or a\n     * jQuery.Deferred object that is fulfilled when tile can be drawn again. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     */\n    draw_helper: function draw_helper(region, w_scale, options) {\n        // Init options if necessary to avoid having to check if options defined.\n        if (!options) {\n            options = {};\n        }\n\n        var force = options.force;\n        var mode = options.mode || this.mode;\n        var resolution = 1 / w_scale;\n\n        var // Useful vars.\n        track = this;\n\n        var drawables = this._get_drawables();\n        var key = this._gen_tile_cache_key(w_scale, region);\n\n        var is_tile = function is_tile(o) {\n            return o && \"track\" in o;\n        };\n\n        // Check tile cache, if found show existing tile in correct position\n        var tile = force ? undefined : track.tile_cache.get_elt(key);\n        if (tile) {\n            if (is_tile(tile)) {\n                track.show_tile(tile, w_scale);\n            }\n            return tile;\n        }\n\n        // If not fetching data, nothing more to do because data is needed to draw tile.\n        if (options.data_fetch === false) {\n            return null;\n        }\n\n        // Function that returns data/Deferreds needed to draw tile.\n        var get_tile_data = function get_tile_data() {\n            // HACK: if display mode (mode) is in continuous data modes, data mode must be coverage to get coverage data.\n            var data_mode = _.find(CONTINUOUS_DATA_MODES, function (m) {\n                return m === mode;\n            }) ? \"Coverage\" : mode;\n\n            // Map drawable object to data needed for drawing.\n            var tile_data = _.map(drawables, function (d // Get the track data/promise.\n            ) {\n                return d.data_manager.get_data(region, data_mode, resolution, track.data_url_extra_params);\n            });\n\n            // Get reference data/promise.\n            if (view.reference_track) {\n                tile_data.push(view.reference_track.data_manager.get_data(region, mode, resolution, view.reference_track.data_url_extra_params));\n            }\n\n            return tile_data;\n        };\n\n        //\n        // When data is available, draw tile.\n        //\n        var tile_drawn = $.Deferred();\n        track.tile_cache.set_elt(key, tile_drawn);\n        $.when.apply($, get_tile_data()).then(function () {\n            var tile_data = get_tile_data();\n            var tracks_data = tile_data;\n            var seq_data;\n\n            // Deferreds may show up here if trying to fetch a subset of data from a superset data chunk\n            // that cannot be subsetted. This may occur if the superset has a message. If there is a\n            // Deferred, try again from the top. NOTE: this condition could (should?) be handled by the\n            // GenomeDataManager in visualization module.\n            if (_.find(tile_data, function (d) {\n                return _util2.default.is_deferred(d);\n            })) {\n                track.tile_cache.set_elt(key, undefined);\n                $.when(track.draw_helper(region, w_scale, options)).then(function (tile) {\n                    tile_drawn.resolve(tile);\n                });\n                return;\n            }\n\n            // If sequence data is available, subset to get only data in region.\n            if (view.reference_track) {\n                seq_data = view.reference_track.data_manager.subset_entry(tile_data.pop(), region);\n            }\n\n            // Get drawing modes, heights for all tracks.\n            var drawing_modes = [];\n\n            var drawing_heights = [];\n\n            _.each(drawables, function (d, i) {\n                var mode = d.mode;\n                var data = tracks_data[i];\n                if (mode === \"Auto\") {\n                    mode = d.get_mode(data);\n                    d.update_auto_mode(mode);\n                }\n                drawing_modes.push(mode);\n                drawing_heights.push(d.get_canvas_height(data, mode, w_scale, width));\n            });\n\n            var canvas = track.view.canvas_manager.new_canvas();\n            var tile_low = region.get(\"start\");\n            var tile_high = region.get(\"end\");\n            var all_data_index = 0;\n\n            var width = Math.ceil((tile_high - tile_low) * w_scale) + track.left_offset;\n\n            var height = _.max(drawing_heights);\n            var tile;\n\n            //\n            // Draw all tracks on tile.\n            //\n            canvas.width = width;\n            // Height is specified in options or is the height found above.\n            canvas.height = options.height || height;\n            var ctx = canvas.getContext(\"2d\");\n            ctx.translate(track.left_offset, 0);\n            if (drawables.length > 1) {\n                ctx.globalAlpha = 0.5;\n                ctx.globalCompositeOperation = \"source-over\";\n            }\n            _.each(drawables, function (d, i) {\n                tile = d.draw_tile(tracks_data[i], ctx, drawing_modes[i], region, w_scale, seq_data);\n            });\n\n            // Don't cache, show if no tile.\n            if (tile !== undefined) {\n                track.tile_cache.set_elt(key, tile);\n                track.show_tile(tile, w_scale);\n            }\n\n            tile_drawn.resolve(tile);\n        });\n\n        return tile_drawn;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function get_canvas_height(result, mode, w_scale, canvas_width) {\n        return this.visible_height_px;\n    },\n\n    /**\n     * Draw line (bigwig) data onto tile.\n     */\n    _draw_line_track_tile: function _draw_line_track_tile(result, ctx, mode, region, w_scale) {\n        // Set min/max if they are not already set.\n        // FIXME: checking for different null/undefined/0 is messy; it would be nice to\n        // standardize this.\n        if ([undefined, null].indexOf(this.config.get_value(\"min_value\")) !== -1) {\n            this.config.set_value(\"min_value\", 0);\n        }\n        if ([undefined, null, 0].indexOf(this.config.get_value(\"max_value\")) !== -1) {\n            this.config.set_value(\"max_value\", _.max(_.map(result.data, function (d) {\n                return d[1];\n            })) || 0);\n        }\n\n        var canvas = ctx.canvas;\n\n        var painter = new _painters2.default.LinePainter(result.data, region.get(\"start\"), region.get(\"end\"), this.config.to_key_value_dict(), mode);\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new LineTrackTile(this, region, w_scale, canvas, result.data);\n    },\n\n    /**\n     * Draw a track tile.\n     * @param result result from server\n     * @param ctx canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     */\n    draw_tile: function draw_tile(result, ctx, mode, region, w_scale, ref_seq) {},\n\n    /**\n     * Show track tile and perform associated actions. Showing tile may actually move\n     * an existing tile rather than reshowing it.\n     */\n    show_tile: function show_tile(tile, w_scale) {\n        var track = this;\n        var tile_element = tile.html_elt;\n\n        // -- Show/move tile element. --\n\n        tile.predisplay_actions();\n\n        // Position tile element based on current viewport.\n        var left = Math.round((tile.low - (this.is_overview ? this.view.max_low : this.view.low)) * w_scale);\n        if (this.left_offset) {\n            left -= this.left_offset;\n        }\n        tile_element.css(\"left\", left);\n\n        if (tile_element.hasClass(\"remove\")) {\n            // Step (b) for (re)moving tiles. See _draw() function for description of algorithm\n            // for removing tiles.\n            tile_element.removeClass(\"remove\");\n        } else {\n            // Showing new tile.\n            this.tiles_div.append(tile_element);\n        }\n\n        // -- Update track, tile heights based on new tile. --\n\n        tile_element.css(\"height\", \"auto\");\n\n        // Update max height based on current tile's height.\n        // BUG/HACK: tile_element.height() returns a height that is always 2 pixels too big, so\n        // -2 to get the correct height.\n        this.max_height_px = Math.max(this.max_height_px, tile_element.height() - 2);\n\n        // Update height for all tiles based on max height.\n        tile_element.parent().children().css(\"height\", this.max_height_px + \"px\");\n\n        // Update track height based on max height and visible height.\n        var track_height = this.max_height_px;\n        if (this.visible_height_px !== 0) {\n            track_height = Math.min(this.max_height_px, this.visible_height_px);\n        }\n        this.tiles_div.css(\"height\", track_height + \"px\");\n    },\n\n    /**\n     * Utility function that creates a label string describing the region and parameters of a track's tool.\n     */\n    tool_region_and_parameters_str: function tool_region_and_parameters_str(region) {\n        var track = this;\n        var region_str = region !== undefined ? region.toString() : \"all\";\n        var param_str = _.values(track.tool.get_inputs_dict()).join(\", \");\n        return \" - region=[\" + region_str + \"], parameters=[\" + param_str + \"]\";\n    },\n\n    /**\n     * Returns true if data is compatible with a given mode.\n     */\n    data_and_mode_compatible: function data_and_mode_compatible(data, mode) {\n        // Only handle modes that user can set.\n        if (mode === \"Auto\") {\n            return true;\n        } else if (mode === \"Coverage\") {\n            // Histogram mode requires bigwig data.\n            return data.dataset_type === \"bigwig\";\n        } else if (data.dataset_type === \"bigwig\" || data.extra_info === \"no_detail\") {\n            // All other modes--Dense, Squish, Pack--require data + details.\n            return false;\n        } else {\n            return true;\n        }\n    },\n\n    /**\n     * Returns true if entry can be subsetted.\n     */\n    can_subset: function can_subset(entry) {\n        // Do not subset entries with a message or data with no detail.\n        if (entry.message || entry.extra_info === \"no_detail\") {\n            return false;\n        } else if (entry.dataset_type === \"bigwig\") {\n            // Subset only if data is single-bp resolution.\n            return entry.data[1][0] - entry.data[0][0] === 1;\n        }\n\n        return true;\n    },\n\n    /**\n     * Set up track to receive tool data.\n     */\n    init_for_tool_data: function init_for_tool_data() {\n        // Set up track to fetch raw data rather than converted data.\n        this.data_manager.set(\"data_type\", \"raw_data\");\n        this.data_query_wait = 1000;\n        this.dataset_check_type = \"state\";\n\n        // FIXME: this is optional and is disabled for now because it creates\n        // additional converter jobs without a clear benefit because indexing\n        // such a small dataset provides little benefit.\n        //\n        // Set up one-time, post-draw to clear tool execution settings.\n        //\n        /*\n        this.normal_postdraw_actions = this.postdraw_actions;\n        this.postdraw_actions = function(tiles, width, w_scale, clear_after) {\n            var self = this;\n             // Do normal postdraw init.\n            self.normal_postdraw_actions(tiles, width, w_scale, clear_after);\n             // Tool-execution specific post-draw init:\n             // Reset dataset check, wait time.\n            self.dataset_check_type = 'converted_datasets_state';\n            self.data_query_wait = DEFAULT_DATA_QUERY_WAIT;\n             // Reset data URL when dataset indexing has completed/when not pending.\n            var ss_deferred = new util.ServerStateDeferred({\n                url: self.dataset_state_url,\n                url_params: {dataset_id : self.dataset.id, hda_ldda: self.dataset.get('hda_ldda')},\n                interval: self.data_query_wait,\n                // Set up deferred to check dataset state until it is not pending.\n                success_fn: function(result) { return result !== \"pending\"; }\n            });\n            $.when(ss_deferred.go()).then(function() {\n                // Dataset is indexed, so use converted data.\n                self.data_manager.set('data_type', 'data');\n            });\n             // Reset post-draw actions function.\n            self.postdraw_actions = self.normal_postdraw_actions;\n        };\n        */\n    }\n});\n\nvar LabelTrack = function LabelTrack(view, container) {\n    Track.call(this, view, container, {\n        resize: false,\n        header: false\n    });\n    this.container_div.addClass(\"label-track\");\n};\nextend(LabelTrack.prototype, Track.prototype, {\n    init: function init() {\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function predraw_init() {},\n\n    _draw: function _draw(options) {\n        var view = this.view;\n        var range = view.high - view.low;\n\n        var tickDistance = Math.floor(Math.pow(10, Math.floor(Math.log(range) / Math.log(10))));\n\n        var position = Math.floor(view.low / tickDistance) * tickDistance;\n        var width = this.view.container.width();\n        var new_div = $(\"<div/>\").addClass(\"label-container\");\n        while (position < view.high) {\n            var screenPosition = Math.floor((position - view.low) / range * width);\n            new_div.append($(\"<div/>\").addClass(\"pos-label\").text(_util2.default.commatize(position)).css({\n                left: screenPosition\n            }));\n            position += tickDistance;\n        }\n        this.content_div.children(\":first\").remove();\n        this.content_div.append(new_div);\n    }\n});\n\n// FIXME: Composite tracks have code for showing composite tracks with line tracks and\n// composite tracks with line + feature tracks. It's probably best if different classes\n// are created for each type of composite track.\n\n/**\n * A tiled track composed of multiple other tracks. Composite tracks only work with\n * bigwig data for now.\n */\nvar CompositeTrack = function CompositeTrack(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n\n    // Init drawables; each drawable is a copy so that config/preferences\n    // are independent of each other. Also init left offset.\n    this.drawables = [];\n    if (\"drawables\" in obj_dict) {\n        var drawable;\n        for (var i = 0; i < obj_dict.drawables.length; i++) {\n            drawable = obj_dict.drawables[i];\n            this.drawables[i] = object_from_template(drawable, view, null);\n\n            // Track's left offset is the max of all tracks.\n            if (drawable.left_offset > this.left_offset) {\n                this.left_offset = drawable.left_offset;\n            }\n        }\n        this.enabled = true;\n    }\n\n    // Set all feature tracks to use Coverage mode.\n    _.each(this.drawables, function (d) {\n        if (d instanceof FeatureTrack || d instanceof ReadTrack) {\n            d.change_mode(\"Coverage\");\n        }\n    });\n\n    this.update_icons();\n\n    // HACK: needed for saving object for now. Need to generalize get_type() to all Drawables and use\n    // that for object type.\n    this.obj_type = \"CompositeTrack\";\n};\n\nextend(CompositeTrack.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"min_value\",\n            label: \"Min Value\",\n            type: \"float\",\n            default_value: undefined\n        }, {\n            key: \"max_value\",\n            label: \"Max Value\",\n            type: \"float\",\n            default_value: undefined\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 30,\n            hidden: true\n        }]);\n    },\n\n    action_icons_def: [\n    // Create composite track from group's tracks.\n    {\n        name: \"composite_icon\",\n        title: \"Show individual tracks\",\n        css_class: \"layers-stack\",\n        on_click_fn: function on_click_fn(track) {\n            $(\".tooltip\").remove();\n            track.show_group();\n        }\n    }].concat(TiledTrack.prototype.action_icons_def),\n\n    // HACK: CompositeTrack should inherit from DrawableCollection as well.\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: DrawableCollection.prototype.to_dict,\n\n    add_drawable: DrawableCollection.prototype.add_drawable,\n\n    unpack_drawables: DrawableCollection.prototype.unpack_drawables,\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function on_resize() {\n        // Propogate visible height to other tracks.\n        var visible_height = this.visible_height_px;\n        _.each(this.drawables, function (d) {\n            d.visible_height_px = visible_height;\n        });\n        Track.prototype.on_resize.call(this);\n    },\n\n    /**\n     * Change mode for all tracks.\n     */\n    change_mode: function change_mode(new_mode) {\n        TiledTrack.prototype.change_mode.call(this, new_mode);\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].change_mode(new_mode);\n        }\n    },\n\n    /**\n     * Initialize component tracks and draw composite track when all components are initialized.\n     */\n    init: function init() {\n        // Init components.\n        var init_deferreds = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            init_deferreds.push(this.drawables[i].init());\n        }\n\n        // Draw composite when all tracks available.\n        var track = this;\n        $.when.apply($, init_deferreds).then(function () {\n            track.enabled = true;\n            track.request_draw();\n        });\n    },\n\n    update_icons: function update_icons() {\n        // For now, hide filters and tool.\n        this.action_icons.filters_icon.hide();\n        this.action_icons.tools_icon.hide();\n        this.action_icons.param_space_viz_icon.hide();\n    },\n\n    can_draw: Drawable.prototype.can_draw,\n\n    _get_drawables: function _get_drawables() {\n        return this.drawables;\n    },\n\n    /**\n     * Replace this track with group that includes individual tracks.\n     */\n    show_group: function show_group() {\n        // Create group with individual tracks.\n        var group = new DrawableGroup(this.view, this.container, {\n            name: this.config.get_value(\"name\")\n        });\n\n        var track;\n        for (var i = 0; i < this.drawables.length; i++) {\n            track = this.drawables[i];\n            track.update_icons();\n            group.add_drawable(track);\n            track.container = group;\n            group.content_div.append(track.container_div);\n        }\n\n        // Replace track with group.\n        var index = this.container.replace_drawable(this, group, true);\n        group.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions taken before drawing.\n     */\n    before_draw: function before_draw() {\n        // FIXME: this is needed only if there are feature tracks in the composite track.\n        // TiledTrack.prototype.before_draw.call(this);\n\n        //\n        // Set min, max for tracks to be largest min, max.\n        //\n\n        // Get smallest min, biggest max.\n        var min = _.min(_.map(this.drawables, function (d) {\n            return d.config.get_value(\"min_value\");\n        }));\n\n        var max = _.max(_.map(this.drawables, function (d) {\n            return d.config.get_value(\"max_value\");\n        }));\n\n        this.config.set_value(\"min_value\", min);\n        this.config.set_value(\"max_value\", max);\n\n        // Set all tracks to smallest min, biggest max.\n        _.each(this.drawables, function (d) {\n            d.config.set_value(\"min_value\", min);\n            d.config.set_value(\"max_value\", max);\n        });\n    },\n\n    /**\n     * Update minimum, maximum for component tracks.\n     */\n    update_all_min_max: function update_all_min_max() {\n        var track = this;\n        var min_value = this.config.get_value(\"min_value\");\n        var max_value = this.config.get_value(\"max_value\");\n        _.each(this.drawables, function (d) {\n            d.config.set_value(\"min_value\", min_value);\n            d.config.set_value(\"max_value\", max_value);\n        });\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function postdraw_actions(tiles, width, w_scale, clear_after) {\n        // All tiles must be the same height in order to draw LineTracks, so redraw tiles as needed.\n        var max_height = -1;\n\n        var i;\n        for (i = 0; i < tiles.length; i++) {\n            var height = tiles[i].html_elt.find(\"canvas\").height();\n            if (height > max_height) {\n                max_height = height;\n            }\n        }\n\n        for (i = 0; i < tiles.length; i++) {\n            var tile = tiles[i];\n            if (tile.html_elt.find(\"canvas\").height() !== max_height) {\n                this.draw_helper(tile.region, w_scale, {\n                    force: true,\n                    height: max_height\n                });\n                tile.html_elt.remove();\n            }\n        }\n\n        // Wrap function so that it can be called without object reference.\n        var track = this;\n\n        var t = function t() {\n            track.update_all_min_max();\n        };\n\n        // Add min, max labels.\n        this._add_yaxis_label(\"min\", t);\n        this._add_yaxis_label(\"max\", t);\n    }\n});\n\n/**\n * Displays reference genome data.\n */\nvar ReferenceTrack = function ReferenceTrack(view) {\n    TiledTrack.call(this, view, { content_div: view.top_labeltrack }, { resize: false, header: false });\n\n    // Use offset to ensure that bases at tile edges are drawn.\n    this.left_offset = view.canvas_manager.char_width_px;\n    this.container_div.addClass(\"reference-track\");\n    this.data_url = Galaxy.root + \"api/genomes/\" + this.view.dbkey;\n    this.data_url_extra_params = { reference: true };\n    this.data_manager = new _visualization2.default.GenomeReferenceDataManager({\n        data_url: this.data_url,\n        can_subset: this.can_subset\n    });\n    this.hide_contents();\n};\nextend(ReferenceTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"height\",\n            type: \"int\",\n            default_value: 13,\n            hidden: true\n        }]);\n    },\n\n    init: function init() {\n        this.data_manager.clear();\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function predraw_init() {},\n\n    can_draw: Drawable.prototype.can_draw,\n\n    /**\n     * Draws and shows tile if reference data can be displayed; otherwise track is hidden.\n     */\n    draw_helper: function draw_helper(region, w_scale, options) {\n        var cur_visible = this.tiles_div.is(\":visible\");\n        var new_visible;\n        var tile = null;\n        if (w_scale > this.view.canvas_manager.char_width_px) {\n            this.tiles_div.show();\n            new_visible = true;\n            tile = TiledTrack.prototype.draw_helper.call(this, region, w_scale, options);\n        } else {\n            new_visible = false;\n            this.tiles_div.hide();\n        }\n\n        // NOTE: viewport resizing conceptually belongs in postdraw_actions(), but currently\n        // postdraw_actions is not called when reference track not shown due to no tiles. If\n        // it is moved to postdraw_actions, resize must be called each time because cannot\n        // easily detect showing/hiding.\n\n        // If showing or hiding reference track, resize viewport.\n        if (cur_visible !== new_visible) {\n            this.view.resize_viewport();\n        }\n\n        return tile;\n    },\n\n    can_subset: function can_subset(entry) {\n        return true;\n    },\n\n    /**\n     * Draw ReferenceTrack tile.\n     */\n    draw_tile: function draw_tile(data, ctx, mode, region, w_scale) {\n        // Try to subset data.\n        var subset = this.data_manager.subset_entry(data, region);\n\n        var seq_data = subset.data;\n\n        // Draw sequence data.\n        var canvas = ctx.canvas;\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"center\";\n        for (var c = 0, str_len = seq_data.length; c < str_len; c++) {\n            ctx.fillStyle = this.view.get_base_color(seq_data[c]);\n            ctx.fillText(seq_data[c], Math.floor(c * w_scale), 10);\n        }\n        return new Tile(this, region, w_scale, canvas, subset);\n    }\n});\n\n/**\n * Track displays continuous/numerical data. Track expects position data in 1-based format, i.e. wiggle format.\n */\nvar LineTrack = function LineTrack(view, container, obj_dict) {\n    this.mode = \"Histogram\";\n    TiledTrack.call(this, view, container, obj_dict);\n    // Need left offset for drawing overlap near tile boundaries.\n    this.left_offset = 30;\n\n    // If server has byte-range support, use BBI data manager to read directly from the BBI file.\n    // FIXME: there should be a flag to wait for this check to complete before loading the track.\n    var self = this;\n    $.when(supportsByteRanges(Galaxy.root + \"datasets/\" + this.dataset.id + \"/display\")).then(function (supportsByteRanges) {\n        if (supportsByteRanges) {\n            self.data_manager = new _bbiDataManager2.default.BBIDataManager({\n                dataset: self.dataset\n            });\n        }\n    });\n};\n\nextend(LineTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{ key: \"color\", label: \"Color\", type: \"color\" }, {\n            key: \"min_value\",\n            label: \"Min Value\",\n            type: \"float\",\n            default_value: undefined\n        }, {\n            key: \"max_value\",\n            label: \"Max Value\",\n            type: \"float\",\n            default_value: undefined\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 30,\n            hidden: true\n        }]);\n    },\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    // FIXME: can the default behavior be used; right now it breaks during resize.\n    before_draw: function before_draw() {},\n\n    /**\n     * Draw track tile.\n     */\n    draw_tile: function draw_tile(result, ctx, mode, region, w_scale) {\n        return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n    },\n\n    /**\n     * Subset data only if data is at single-base pair resolution.\n     */\n    can_subset: function can_subset(entry) {\n        return entry.data[1][0] - entry.data[0][0] === 1;\n    },\n\n    /**\n     * Add min, max labels.\n     */\n    postdraw_actions: function postdraw_actions(tiles, width, w_scale, clear_after) {\n        // Add min, max labels.\n        this._add_yaxis_label(\"max\");\n        this._add_yaxis_label(\"min\");\n    }\n});\n\n/**\n * Diagonal heatmap for showing interactions data.\n */\nvar DiagonalHeatmapTrack = function DiagonalHeatmapTrack(view, container, obj_dict) {\n    this.mode = \"Heatmap\";\n    TiledTrack.call(this, view, container, obj_dict);\n};\n\nextend(DiagonalHeatmapTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Heatmap\"],\n\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"pos_color\",\n            label: \"Positive Color\",\n            type: \"color\",\n            default_value: \"#FF8C00\"\n        }, {\n            key: \"neg_color\",\n            label: \"Negative Color\",\n            type: \"color\",\n            default_value: \"#4169E1\"\n        }, {\n            key: \"min_value\",\n            label: \"Min Value\",\n            type: \"int\",\n            default_value: undefined\n        }, {\n            key: \"max_value\",\n            label: \"Max Value\",\n            type: \"int\",\n            default_value: undefined\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 500,\n            hidden: true\n        }]);\n    },\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function predraw_init() {\n        var track = this;\n        return $.getJSON(track.dataset.url(), {\n            data_type: \"data\",\n            stats: true,\n            chrom: track.view.chrom,\n            low: 0,\n            high: track.view.max_high,\n            hda_ldda: track.dataset.get(\"hda_ldda\")\n        }, function (result) {\n            var data = result.data;\n        });\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function draw_tile(result, ctx, mode, region, w_scale) {\n        // Paint onto canvas.\n        var canvas = ctx.canvas;\n\n        var painter = new _painters2.default.DiagonalHeatmapPainter(result.data, region.get(\"start\"), region.get(\"end\"), this.config.to_key_value_dict(), mode);\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new Tile(this, region, w_scale, canvas, result.data);\n    }\n});\n\n/**\n * A track that displays features/regions. Track expects position data in BED format, i.e. 0-based, half-open.\n */\nvar FeatureTrack = function FeatureTrack(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.container_div.addClass(\"feature-track\");\n    this.summary_draw_height = 30;\n    this.slotters = {};\n    this.start_end_dct = {};\n    this.left_offset = 200;\n\n    // this.painter = painters.LinkedFeaturePainter;\n    this.set_painter_from_config();\n};\nextend(FeatureTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"block_color\",\n            label: \"Block color\",\n            type: \"color\"\n        }, {\n            key: \"reverse_strand_color\",\n            label: \"Antisense strand color\",\n            type: \"color\"\n        }, {\n            key: \"label_color\",\n            label: \"Label color\",\n            type: \"color\",\n            default_value: \"black\"\n        }, {\n            key: \"show_counts\",\n            label: \"Show summary counts\",\n            type: \"bool\",\n            default_value: true,\n            help: \"Show the number of items in each bin when drawing summary histogram\"\n        }, {\n            key: \"min_value\",\n            label: \"Histogram minimum\",\n            type: \"float\",\n            default_value: undefined,\n            help: \"clear value to set automatically\"\n        }, {\n            key: \"max_value\",\n            label: \"Histogram maximum\",\n            type: \"float\",\n            default_value: undefined,\n            help: \"clear value to set automatically\"\n        }, {\n            key: \"connector_style\",\n            label: \"Connector style\",\n            type: \"select\",\n            default_value: \"fishbones\",\n            options: [{\n                label: \"Line with arrows\",\n                value: \"fishbone\"\n            }, { label: \"Arcs\", value: \"arcs\" }]\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 0,\n            hidden: true\n        }]);\n    },\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.set_painter_from_config();\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    set_painter_from_config: function set_painter_from_config() {\n        if (this.config.get_value(\"connector_style\") === \"arcs\") {\n            this.painter = _painters2.default.ArcLinkedFeaturePainter;\n        } else {\n            this.painter = _painters2.default.LinkedFeaturePainter;\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function postdraw_actions(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var track = this;\n        var i;\n\n        var line_track_tiles = _.filter(tiles, function (t) {\n            return t instanceof LineTrackTile;\n        });\n\n        //\n        // Finish drawing of features that span multiple tiles. Features that span multiple tiles\n        // are labeled incomplete on the tile level because they cannot be completely drawn.\n        //\n        if (line_track_tiles.length === 0) {\n            // Gather incomplete features together.\n            var all_incomplete_features = {};\n            _.each(_.pluck(tiles, \"incomplete_features\"), function (inc_features) {\n                _.each(inc_features, function (feature) {\n                    all_incomplete_features[feature[0]] = feature;\n                });\n            });\n\n            // Draw incomplete features on each tile.\n            var self = this;\n            _.each(tiles, function (tile) {\n                // Remove features already drawn on tile originally.\n                var tile_incomplete_features = _.omit(all_incomplete_features, _.map(tile.incomplete_features, function (f) {\n                    return f[0];\n                }));\n\n                // Remove features already drawn on tile in past postdraw actions.\n                tile_incomplete_features = _.omit(tile_incomplete_features, _.keys(tile.other_tiles_features_drawn));\n\n                // Draw tile's incomplete features.\n                if (_.size(tile_incomplete_features) !== 0) {\n                    // To draw incomplete features, create new canvas, copy original canvas/tile onto new\n                    // canvas, and then draw incomplete features on the new canvas.\n                    var features = {\n                        data: _.values(tile_incomplete_features)\n                    };\n\n                    var new_canvas = self.view.canvas_manager.new_canvas();\n                    var new_canvas_ctx = new_canvas.getContext(\"2d\");\n                    new_canvas.height = Math.max(tile.canvas.height, self.get_canvas_height(features, tile.mode, tile.w_scale, 100));\n                    new_canvas.width = tile.canvas.width;\n                    new_canvas_ctx.drawImage(tile.canvas, 0, 0);\n                    new_canvas_ctx.translate(track.left_offset, 0);\n                    var new_tile = self.draw_tile(features, new_canvas_ctx, tile.mode, tile.region, tile.w_scale, tile.seq_data);\n                    $(tile.canvas).replaceWith($(new_tile.canvas));\n                    tile.canvas = new_canvas;\n                    _.extend(tile.other_tiles_features_drawn, all_incomplete_features);\n                }\n            });\n        }\n\n        // If mode is Coverage and tiles do not share max, redraw tiles as necessary using new max.\n        /*\n        This code isn't used right now because Coverage mode uses predefined max in preferences.\n        if (track.mode === \"Coverage\") {\n            // Get global max.\n            var global_max = -1;\n            for (i = 0; i < tiles.length; i++) {\n                var cur_max = tiles[i].max_val;\n                if (cur_max > global_max) {\n                    global_max = cur_max;\n                }\n            }\n             for (i = 0; i < tiles.length; i++) {\n                var tile = tiles[i];\n                if (tile.max_val !== global_max) {\n                    tile.html_elt.remove();\n                    track.draw_helper(tile.index, w_scale, { more_tile_data: { force: true, max: global_max } } );\n                }\n            }\n        }\n        */\n\n        //\n        // Update filter attributes, UI.\n        //\n\n        // Update filtering UI.\n        if (track.filters_manager) {\n            var filters = track.filters_manager.filters;\n            var f;\n            for (f = 0; f < filters.length; f++) {\n                filters[f].update_ui_elt();\n            }\n\n            // Determine if filters are available; this is based on the tiles' data.\n            // Criteria for filter to be available: (a) it is applicable to tile data and (b) filter min != filter max.\n            var filters_available = false;\n\n            var example_feature;\n            var filter;\n            for (i = 0; i < tiles.length; i++) {\n                if (tiles[i].data.length) {\n                    example_feature = tiles[i].data[0];\n                    for (f = 0; f < filters.length; f++) {\n                        filter = filters[f];\n                        if (filter.applies_to(example_feature) && filter.min !== filter.max) {\n                            filters_available = true;\n                            break;\n                        }\n                    }\n                }\n            }\n\n            // If filter availability changed, hide filter div if necessary and update menu.\n            if (track.filters_available !== filters_available) {\n                track.filters_available = filters_available;\n                if (!track.filters_available) {\n                    track.filters_manager.hide();\n                }\n                track.update_icons();\n            }\n        }\n\n        //\n        // If not all features slotted, show icon for showing more rows (slots).\n        //\n        if (tiles[0] instanceof FeatureTrackTile) {\n            var all_slotted = true;\n            for (i = 0; i < tiles.length; i++) {\n                if (!tiles[i].all_slotted) {\n                    all_slotted = false;\n                    break;\n                }\n            }\n            this.action_icons.show_more_rows_icon.toggle(!all_slotted);\n        } else {\n            this.action_icons.show_more_rows_icon.hide();\n        }\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function update_auto_mode(mode) {\n        if (this.mode === \"Auto\") {\n            if (mode === \"no_detail\") {\n                mode = \"feature spans\";\n            }\n            this.action_icons.mode_icon.attr(\"title\", \"Set display mode (now: Auto/\" + mode + \")\");\n        }\n    },\n\n    /**\n     * Place features in slots for drawing (i.e. pack features).\n     * this.slotters[level] is created in this method. this.slotters[level]\n     * is a Slotter object. Returns the number of slots used to pack features.\n     */\n    incremental_slots: function incremental_slots(level, features, mode) {\n        // Get/create incremental slots for level. If display mode changed,\n        // need to create new slots.\n\n        var dummy_context = this.view.canvas_manager.dummy_context;\n\n        var slotter = this.slotters[level];\n        if (!slotter || slotter.mode !== mode) {\n            slotter = new _slotting2.default.FeatureSlotter(level, mode, MAX_FEATURE_DEPTH, function (x) {\n                return dummy_context.measureText(x);\n            });\n            this.slotters[level] = slotter;\n        }\n\n        return slotter.slot_features(features);\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function get_mode(data) {\n        var mode;\n        // HACK: use no_detail mode track is in overview to prevent overview from being too large.\n        if (data.extra_info === \"no_detail\" || this.is_overview) {\n            mode = \"no_detail\";\n        } else {\n            // Choose b/t Squish and Pack.\n            // Proxy measures for using Squish:\n            // (a) error message re: limiting number of features shown;\n            // (b) X number of features shown;\n            // (c) size of view shown.\n            // TODO: cannot use (a) and (b) because it requires coordinating mode across tiles;\n            // fix this so that tiles are redrawn as necessary to use the same mode.\n            //if ( (result.message && result.message.match(/^Only the first [\\d]+/)) ||\n            //     (result.data && result.data.length > 2000) ||\n            //var data = result.data;\n            // if ( (data.length && data.length < 4) ||\n            //      (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) ) {\n            if (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) {\n                mode = \"Squish\";\n            } else {\n                mode = \"Pack\";\n            }\n        }\n        return mode;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function get_canvas_height(result, mode, w_scale, canvas_width) {\n        if (mode === \"Coverage\" || result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // All other modes require slotting.\n            var rows_required = this.incremental_slots(w_scale, result.data, mode);\n            // HACK: use dummy painter to get required height. Painter should be extended so that get_required_height\n            // works as a static function.\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return Math.max(this.min_height_px, dummy_painter.get_required_height(rows_required, canvas_width));\n        }\n    },\n\n    /**\n     * Draw FeatureTrack tile.\n     * @param result result from server\n     * @param cxt canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     * @param cur_tile true if drawing is occurring on a currently visible tile.\n     */\n    draw_tile: function draw_tile(result, ctx, mode, region, w_scale, ref_seq, cur_tile) {\n        var track = this;\n        var canvas = ctx.canvas;\n        var tile_low = region.get(\"start\");\n        var tile_high = region.get(\"end\");\n        var left_offset = this.left_offset;\n\n        // If data is line track data, draw line track tile.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n        }\n\n        // Handle row-by-row tracks\n\n        // Preprocessing: filter features and determine whether all unfiltered features have been slotted.\n        var filtered = [];\n\n        var slots = this.slotters[w_scale].slots;\n        var all_slotted = true;\n        if (result.data) {\n            var filters = this.filters_manager.filters;\n            for (var i = 0, len = result.data.length; i < len; i++) {\n                var feature = result.data[i];\n                var hide_feature = false;\n                var filter;\n                for (var f = 0, flen = filters.length; f < flen; f++) {\n                    filter = filters[f];\n                    filter.update_attrs(feature);\n                    if (!filter.keep(feature)) {\n                        hide_feature = true;\n                        break;\n                    }\n                }\n                if (!hide_feature) {\n                    // Feature visible.\n                    filtered.push(feature);\n                    // Set flag if not slotted.\n                    if (!(feature[0] in slots)) {\n                        all_slotted = false;\n                    }\n                }\n            }\n        }\n\n        // Create painter.\n        var filter_alpha_scaler = this.filters_manager.alpha_filter ? new FilterScaler(this.filters_manager.alpha_filter) : null;\n\n        var filter_height_scaler = this.filters_manager.height_filter ? new FilterScaler(this.filters_manager.height_filter) : null;\n\n        var painter = new this.painter(filtered, tile_low, tile_high, this.config.to_key_value_dict(), mode, filter_alpha_scaler, filter_height_scaler,\n        // HACK: ref_seq only be defined for ReadTracks, and only the ReadPainter accepts that argument\n        ref_seq, function (b) {\n            return track.view.get_base_color(b);\n        });\n\n        var feature_mapper = null;\n\n        ctx.fillStyle = this.config.get_value(\"block_color\");\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"right\";\n\n        if (result.data) {\n            // Draw features.\n            var draw_results = painter.draw(ctx, canvas.width, canvas.height, w_scale, slots);\n            feature_mapper = draw_results.feature_mapper;\n            incomplete_features = draw_results.incomplete_features;\n            feature_mapper.translation = -left_offset;\n        }\n\n        // If not drawing on current tile, create new tile.\n        if (!cur_tile) {\n            return new FeatureTrackTile(track, region, w_scale, canvas, result.data, mode, result.message, all_slotted, feature_mapper, incomplete_features, ref_seq);\n        }\n    }\n});\n\n/**\n * Displays variant data.\n */\nvar VariantTrack = function VariantTrack(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.painter = _painters2.default.VariantPainter;\n    this.summary_draw_height = 30;\n\n    // Maximum resolution is ~45 pixels/base, so use this size left offset to ensure that full\n    // variant is drawn when variant is at start of tile.\n    this.left_offset = 30;\n};\n\nextend(VariantTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"color\",\n            label: \"Histogram color\",\n            type: \"color\"\n        }, {\n            key: \"show_sample_data\",\n            label: \"Show sample data\",\n            type: \"bool\",\n            default_value: true\n        }, {\n            key: \"show_labels\",\n            label: \"Show summary and sample labels\",\n            type: \"bool\",\n            default_value: true\n        }, {\n            key: \"summary_height\",\n            label: \"Locus summary height\",\n            type: \"float\",\n            default_value: 20\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 0,\n            hidden: true\n        }]);\n    },\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function draw_tile(result, ctx, mode, region, w_scale) {\n        // Data could be coverage data or variant data.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, \"Histogram\", region, w_scale);\n        } else {\n            // result.dataset_type === 'variant'\n            var view = this.view;\n\n            var painter = new this.painter(result.data, region.get(\"start\"), region.get(\"end\"), this.config.to_key_value_dict(), mode, function (b) {\n                return view.get_base_color(b);\n            });\n\n            painter.draw(ctx, ctx.canvas.width, ctx.canvas.height, w_scale);\n            return new Tile(this, region, w_scale, ctx.canvas, result.data);\n        }\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function get_canvas_height(result, mode, w_scale, canvas_width) {\n        if (result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // HACK: sample_names is not be defined when dataset definition is fetched before\n            // dataset is complete (as is done when running tools). In that case, fall back on\n            // # of samples in data. This can be fixed by re-requesting dataset definition\n            // in init.\n            var num_samples = this.dataset.get_metadata(\"sample_names\") ? this.dataset.get_metadata(\"sample_names\").length : 0;\n            if (num_samples === 0 && result.data.length !== 0) {\n                // Sample data is separated by commas, so this computes # of samples:\n                num_samples = result.data[0][7].match(/,/g);\n                if (num_samples === null) {\n                    num_samples = 1;\n                } else {\n                    num_samples = num_samples.length + 1;\n                }\n            }\n\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return dummy_painter.get_required_height(num_samples);\n        }\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function predraw_init() {\n        var deferreds = [Track.prototype.predraw_init.call(this)];\n        // FIXME: updating dataset metadata is only needed for visual analysis. Can\n        // this be moved somewhere else?\n        if (!this.dataset.get_metadata(\"sample_names\")) {\n            deferreds.push(this.dataset.fetch());\n        }\n        return deferreds;\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function postdraw_actions(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var line_track_tiles = _.filter(tiles, function (t) {\n            return t instanceof LineTrackTile;\n        });\n\n        // Add summary/sample labels if needed and not already included.\n        var sample_names = this.dataset.get_metadata(\"sample_names\");\n        if (line_track_tiles.length === 0 && this.config.get_value(\"show_labels\") && sample_names && sample_names.length > 1) {\n            var font_size;\n\n            // Add and/or style labels.\n            if (this.container_div.find(\".yaxislabel.variant\").length === 0) {\n                // Add summary and sample labels.\n\n                // Add summary label to middle of summary area.\n                font_size = this.config.get_value(\"summary_height\") / 2;\n                this.tiles_div.prepend($(\"<div/>\").text(\"Summary\").addClass(\"yaxislabel variant top\").css({\n                    \"font-size\": font_size + \"px\",\n                    top: (this.config.get_value(\"summary_height\") - font_size) / 2 + \"px\"\n                }));\n\n                // Show sample labels.\n                if (this.config.get_value(\"show_sample_data\")) {\n                    var samples_div_html = sample_names.join(\"<br/>\");\n\n                    this.tiles_div.prepend($(\"<div/>\").html(samples_div_html).addClass(\"yaxislabel variant top sample\").css({\n                        top: this.config.get_value(\"summary_height\")\n                    }));\n                }\n            }\n\n            // Style labels.\n\n            // Match sample font size to mode.\n            font_size = (this.mode === \"Squish\" ? 5 : 10) + \"px\";\n            $(this.tiles_div).find(\".sample\").css({\n                \"font-size\": font_size,\n                \"line-height\": font_size\n            });\n            // Color labels to preference color.\n            $(this.tiles_div).find(\".yaxislabel\").css(\"color\", this.config.get_value(\"label_color\"));\n        } else {\n            // Remove all labels.\n            this.container_div.find(\".yaxislabel.variant\").remove();\n        }\n    }\n});\n\n/**\n * Track that displays mapped reads. Track expects position data in 1-based, closed format, i.e. SAM/BAM format.\n */\nvar ReadTrack = function ReadTrack(view, container, obj_dict) {\n    FeatureTrack.call(this, view, container, obj_dict);\n    this.painter = _painters2.default.ReadPainter;\n    this.update_icons();\n};\n\nextend(ReadTrack.prototype, Drawable.prototype, TiledTrack.prototype, FeatureTrack.prototype, {\n    build_config_params: function build_config_params() {\n        return _.union(Drawable.prototype.config_params, [{\n            key: \"block_color\",\n            label: \"Histogram color\",\n            type: \"color\"\n        }, {\n            key: \"detail_block_color\",\n            label: \"Sense strand block color\",\n            type: \"color\",\n            default_value: \"#AAAAAA\"\n        }, {\n            key: \"reverse_strand_color\",\n            label: \"Antisense strand block color\",\n            type: \"color\",\n            default_value: \"#DDDDDD\"\n        }, {\n            key: \"label_color\",\n            label: \"Label color\",\n            type: \"color\",\n            default_value: \"black\"\n        }, {\n            key: \"show_insertions\",\n            label: \"Show insertions\",\n            type: \"bool\",\n            default_value: false\n        }, {\n            key: \"show_differences\",\n            label: \"Show differences only\",\n            type: \"bool\",\n            default_value: true\n        }, {\n            key: \"show_counts\",\n            label: \"Show summary counts\",\n            type: \"bool\",\n            default_value: true\n        }, {\n            key: \"mode\",\n            type: \"string\",\n            default_value: this.mode,\n            hidden: true\n        }, {\n            key: \"min_value\",\n            label: \"Histogram minimum\",\n            type: \"float\",\n            default_value: undefined,\n            help: \"clear value to set automatically\"\n        }, {\n            key: \"max_value\",\n            label: \"Histogram maximum\",\n            type: \"float\",\n            default_value: undefined,\n            help: \"clear value to set automatically\"\n        }, {\n            key: \"height\",\n            type: \"int\",\n            default_value: 0,\n            hidden: true\n        }]);\n    },\n\n    config_onchange: function config_onchange() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    }\n});\n\n/**\n * Objects that can be added to a view.\n */\nvar addable_objects = {\n    CompositeTrack: CompositeTrack,\n    DrawableGroup: DrawableGroup,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    FeatureTrack: FeatureTrack,\n    LineTrack: LineTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    // For backward compatibility, map vcf track to variant.\n    VcfTrack: VariantTrack\n};\n\n/**\n * Create new object from a template. A template can be either an object dictionary or an\n * object itself.\n */\nvar object_from_template = function object_from_template(template, view, container) {\n    if (\"copy\" in template) {\n        // Template is an object.\n        return template.copy(container);\n    } else {\n        // Template is a dictionary.\n        var drawable_type = template.obj_type;\n        // For backward compatibility:\n        if (!drawable_type) {\n            drawable_type = template.track_type;\n        }\n        return new addable_objects[drawable_type](view, container, template);\n    }\n};\n\nexports.default = {\n    TracksterView: TracksterView,\n    DrawableGroup: DrawableGroup,\n    LineTrack: LineTrack,\n    FeatureTrack: FeatureTrack,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    CompositeTrack: CompositeTrack,\n    object_from_template: object_from_template\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(2)))\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * View for track/group header.\n */\nvar TrackHeaderView = Backbone.View.extend({\n    className: \"track-header\",\n\n    initialize: function initialize() {\n        // Watch and update name changes.\n        this.model.config.get(\"name\").on(\"change:value\", this.update_name, this);\n        this.render();\n    },\n\n    render: function render() {\n        this.$el.append($(\"<div/>\").addClass(this.model.drag_handle_class));\n        this.$el.append($(\"<div/>\").addClass(\"track-name\").text(this.model.config.get_value(\"name\")));\n\n        // Icons container.\n        this.action_icons = {};\n        this.render_action_icons();\n\n        // Suppress double clicks in header so that they do not impact viz under header.\n        this.$el.dblclick(function (e) {\n            e.stopPropagation();\n        });\n\n        // Needed for floating elts in header.\n        this.$el.append($(\"<div style='clear: both'/>\"));\n    },\n\n    update_name: function update_name() {\n        this.$el.find(\".track-name\").text(this.model.config.get_value(\"name\"));\n    },\n\n    render_action_icons: function render_action_icons() {\n        var self = this;\n        this.icons_div = $(\"<div/>\").addClass(\"track-icons\").hide().appendTo(this.$el);\n        _.each(this.model.action_icons_def, function (icon_dict) {\n            self.add_action_icon(icon_dict.name, icon_dict.title, icon_dict.css_class, icon_dict.on_click_fn, icon_dict.prepend, icon_dict.hide);\n        });\n\n        // Set up behavior for modes popup.\n        this.set_display_modes(this.model.display_modes);\n    },\n\n    /**\n     * Add an action icon to this object. Appends icon unless prepend flag is specified.\n     */\n    add_action_icon: function add_action_icon(name, title, css_class, on_click_fn, prepend, hide) {\n        var self = this;\n        this.action_icons[name] = $(\"<a/>\").attr(\"title\", title).addClass(\"icon-button\").addClass(css_class).tooltip().click(function () {\n            on_click_fn(self.model);\n        }).appendTo(this.icons_div);\n        if (hide) {\n            this.action_icons[name].hide();\n        }\n    },\n\n    /**\n     * Set track's modes and update mode icon popup.\n     */\n    set_display_modes: function set_display_modes(new_modes, init_mode) {\n        if (!new_modes) {\n            return;\n        }\n\n        // HACK: move this out of view and into track.\n\n        // Set modes, init mode.\n        this.model.display_modes = new_modes;\n        this.model.mode = init_mode || this.model.config.get_value(\"mode\") || this.model.display_modes[0];\n\n        this.action_icons.mode_icon.attr(\"title\", \"Set display mode (now: \" + this.mode + \")\");\n\n        // Setup popup menu for changing modes.\n        var self = this;\n\n        var track = this.model;\n        var mode_mapping = {};\n        for (var i = 0, len = track.display_modes.length; i < len; i++) {\n            var mode = track.display_modes[i];\n            mode_mapping[mode] = function (mode) {\n                return function () {\n                    track.change_mode(mode);\n                    // HACK: the popup menu messes with the track's hover event, so manually show/hide\n                    // icons div for now.\n                    //self.icons_div.show();\n                    //track.container_div.mouseleave(function() { track.icons_div.hide(); } );\n                };\n            }(mode);\n        }\n\n        make_popupmenu(this.action_icons.mode_icon, mode_mapping);\n    }\n});\n\nexports.default = {\n    TrackHeaderView: TrackHeaderView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar extend = _.extend;\n\n// HACK: LABEL_SPACING is currently duplicated between here and painters\nvar LABEL_SPACING = 2;\n\nvar PACK_SPACING = 5;\n\n/**\n * Hold slotting information for a feature.\n */\nvar SlottedInfo = function SlottedInfo(slot, feature) {\n    this.slot = slot;\n    this.feature = feature;\n};\n\n/**\n * FeatureSlotter determines slots in which to draw features for vertical\n * packing.\n *\n * This implementation is incremental, any feature assigned a slot will be\n * retained for slotting future features.\n */\nvar FeatureSlotter = function FeatureSlotter(w_scale, mode, max_rows, measureText) {\n    this.slots = {};\n    this.start_end_dct = {};\n    this.w_scale = w_scale;\n    this.mode = mode;\n    this.include_label = mode === \"Pack\";\n    this.max_rows = max_rows;\n    this.measureText = measureText;\n};\n\n/**\n * Slot a set of features, `this.slots` will be updated with slots by id, and\n * the largest slot required for the passed set of features is returned\n */\nextend(FeatureSlotter.prototype, {\n    /**\n     * Get drawing coordinate for a feature.\n     */\n    _get_draw_coords: function _get_draw_coords(feature) {\n        // Get initial draw coordinates using w_scale.\n        var draw_start = Math.floor(feature[1] * this.w_scale);\n\n        var draw_end = Math.ceil(feature[2] * this.w_scale);\n        var f_name = feature[3];\n        var text_align;\n\n        // Update start, end drawing locations to include feature name.\n        // Try to put the name on the left, if not, put on right.\n        if (f_name !== undefined && this.include_label) {\n            // Add gap for label spacing and extra pack space padding\n            // TODO: Fix constants\n            var text_len = this.measureText(f_name).width + (LABEL_SPACING + PACK_SPACING);\n            if (draw_start - text_len >= 0) {\n                draw_start -= text_len;\n                text_align = \"left\";\n            } else {\n                draw_end += text_len;\n                text_align = \"right\";\n            }\n        }\n\n        /*\n        if (slot_num < 0) {\n            \n            TODO: this is not yet working --\n            console.log(feature_uid, \"looking for slot with text on the right\");\n            // Slot not found. If text was on left, try on right and see\n            // if slot can be found.\n            // TODO: are there any checks we need to do to ensure that text\n            // will fit on tile?\n            if (text_align === \"left\") {\n                draw_start -= text_len;\n                draw_end -= text_len;\n                text_align = \"right\";\n                slot_num = find_slot(draw_start, draw_end);\n            }\n            if (slot_num >= 0) {\n                console.log(feature_uid, \"found slot with text on the right\");\n            }\n         }\n        */\n\n        return [draw_start, draw_end];\n    },\n\n    /**\n     * Find the first slot such that current feature doesn't overlap any other features in that slot.\n     * Returns -1 if no slot was found.\n     */\n    _find_slot: function _find_slot(draw_coords) {\n        // TODO: Use a data structure for faster searching of available slots.\n        var draw_start = draw_coords[0];\n\n        var draw_end = draw_coords[1];\n        for (var slot_num = 0; slot_num <= this.max_rows; slot_num++) {\n            var has_overlap = false;\n            var slot = this.start_end_dct[slot_num];\n            if (slot !== undefined) {\n                // Iterate through features already in slot to see if current feature will fit.\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    var s_e = slot[k];\n                    if (draw_end > s_e[0] && draw_start < s_e[1]) {\n                        // There is overlap\n                        has_overlap = true;\n                        break;\n                    }\n                }\n            }\n            if (!has_overlap) {\n                return slot_num;\n            }\n        }\n        return -1;\n    },\n\n    /**\n     * Slot features.\n     */\n    slot_features: function slot_features(features) {\n        var start_end_dct = this.start_end_dct;\n        var undone = [];\n        var highest_slot = 0;\n        var feature;\n        var feature_uid;\n\n        // Loop through features to (a) find those that are not yet slotted and (b) update\n        // those that are slotted if new information is availabe. For (a), features already\n        // slotted (based on slotting from other tiles) will retain their current slot.\n        for (var i = 0, len = features.length; i < len; i++) {\n            feature = features[i];\n            feature_uid = feature[0];\n            var slotted_info = this.slots[feature_uid];\n\n            // Separate and handle slotted vs. unslotted features.\n            if (slotted_info) {\n                // Feature is slotted; if feature now has larger start/end coordinates,\n                // update drawing coordinates.\n                if (feature[1] < slotted_info.feature[1] || slotted_info.feature[2] < feature[2]) {\n                    // Feature has changed (e.g. a single read now has its pair), so recalculate its\n                    // drawing coordinates.\n                    var old_draw_coords = this._get_draw_coords(slotted_info.feature);\n\n                    var new_draw_coords = this._get_draw_coords(feature);\n                    var slotted_coords = this.start_end_dct[slotted_info.slot];\n                    for (var k = 0; k < slotted_coords.length; k++) {\n                        var dc = slotted_coords[k];\n                        if (dc[0] === old_draw_coords[0] && dc[1] === old_draw_coords[1]) {\n                            // Replace old drawing coordinates with new ones.\n                            slotted_coords[k] = new_draw_coords;\n                        }\n                    }\n                }\n                highest_slot = Math.max(highest_slot, this.slots[feature_uid].slot);\n            } else {\n                undone.push(i);\n            }\n        }\n\n        // Slot unslotted features.\n\n        // Do slotting.\n        for (var i = 0, len = undone.length; i < len; i++) {\n            feature = features[undone[i]];\n            feature_uid = feature[0];\n            var draw_coords = this._get_draw_coords(feature);\n\n            // Find slot.\n            var slot_num = this._find_slot(draw_coords);\n\n            // Do slotting.\n            if (slot_num >= 0) {\n                // Add current feature to slot.\n                if (start_end_dct[slot_num] === undefined) {\n                    start_end_dct[slot_num] = [];\n                }\n                start_end_dct[slot_num].push(draw_coords);\n                this.slots[feature_uid] = new SlottedInfo(slot_num, feature);\n                highest_slot = Math.max(highest_slot, slot_num);\n            }\n        }\n\n        // Debugging: view slots data.\n        /*\n        for (var i = 0; i < MAX_FEATURE_DEPTH; i++) {\n            var slot = start_end_dct[i];\n            if (slot !== undefined) {\n                console.log(i, \"*************\");\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    console.log(\"\\t\", slot[k][0], slot[k][1]);\n                }\n            }\n        }\n        */\n        return highest_slot + 1;\n    }\n});\n\nexports.default = {\n    FeatureSlotter: FeatureSlotter\n};\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n * Compute the type of overlap between two regions. They are assumed to be on the same chrom/contig.\n * The overlap is computed relative to the second region; hence, OVERLAP_START indicates that the first\n * region overlaps the start (but not the end) of the second region.\n * NOTE: Coordinates are assumed to be in BED format: half open (start is closed, end is open).\n */\nvar BEFORE = 1001;\n\nvar CONTAINS = 1002;\nvar OVERLAP_START = 1003;\nvar OVERLAP_END = 1004;\nvar CONTAINED_BY = 1005;\nvar AFTER = 1006;\nvar compute_overlap = function compute_overlap(first_region, second_region) {\n    var first_start = first_region[0];\n    var first_end = first_region[1];\n    var second_start = second_region[0];\n    var second_end = second_region[1];\n    var overlap;\n    if (first_start < second_start) {\n        if (first_end <= second_start) {\n            overlap = BEFORE;\n        } else if (first_end <= second_end) {\n            overlap = OVERLAP_START;\n        } else {\n            // first_end > second_end\n            overlap = CONTAINS;\n        }\n    } else {\n        // first_start >= second_start\n        if (first_start > second_end) {\n            overlap = AFTER;\n        } else if (first_end <= second_end) {\n            overlap = CONTAINED_BY;\n        } else {\n            overlap = OVERLAP_END;\n        }\n    }\n\n    return overlap;\n};\n\n/**\n * Returns true if regions overlap.\n */\nvar is_overlap = function is_overlap(first_region, second_region) {\n    var overlap = compute_overlap(first_region, second_region);\n    return overlap !== BEFORE && overlap !== AFTER;\n};\n\n/**\n * Draw a dashed line on a canvas using filled rectangles. This function is based on:\n * http://vetruvet.blogspot.com/2010/10/drawing-dashed-lines-on-html5-canvas.html\n * However, that approach uses lines, which don't seem to render as well, so use\n * rectangles instead.\n */\nvar dashedLine = function dashedLine(ctx, x1, y1, x2, y2, dashLen) {\n    if (dashLen === undefined) {\n        dashLen = 4;\n    }\n    var dX = x2 - x1;\n    var dY = y2 - y1;\n    var dashes = Math.floor(Math.sqrt(dX * dX + dY * dY) / dashLen);\n    var dashX = dX / dashes;\n    var dashY = dY / dashes;\n    var q;\n\n    for (q = 0; q < dashes; q++, x1 += dashX, y1 += dashY) {\n        if (q % 2 !== 0) {\n            continue;\n        }\n        ctx.fillRect(x1, y1, dashLen, 1);\n    }\n};\n\n/**\n * Draw an isosceles triangle that points down.\n */\nvar drawDownwardEquilateralTriangle = function drawDownwardEquilateralTriangle(ctx, down_vertex_x, down_vertex_y, side_len) {\n    // Compute other two points of triangle.\n    var x1 = down_vertex_x - side_len / 2;\n\n    var x2 = down_vertex_x + side_len / 2;\n    var y = down_vertex_y - Math.sqrt(side_len * 3 / 2);\n\n    // Draw and fill.\n    ctx.beginPath();\n    ctx.moveTo(x1, y);\n    ctx.lineTo(x2, y);\n    ctx.lineTo(down_vertex_x, down_vertex_y);\n    ctx.lineTo(x1, y);\n\n    ctx.strokeStyle = this.fillStyle;\n    ctx.fill();\n    ctx.stroke();\n    ctx.closePath();\n};\n\n/**\n * Base class for all scalers. Scalers produce values that are used to change (scale) drawing attributes.\n */\nvar Scaler = function Scaler(default_val) {\n    this.default_val = default_val ? default_val : 1;\n};\n\n/**\n * Produce a scaling value.\n */\nScaler.prototype.gen_val = function (input) {\n    return this.default_val;\n};\n\n/**\n * Results from painter.draw()\n */\nvar DrawResults = function DrawResults(options) {\n    this.incomplete_features = options.incomplete_features;\n    this.feature_mapper = options.feature_mapper;\n};\n\n/**\n * Base class for painters\n *\n * -- Mode and prefs are both optional\n */\nvar Painter = function Painter(data, view_start, view_end, prefs, mode) {\n    // Data and data properties\n    this.data = data;\n    // View\n    this.view_start = view_start;\n    this.view_end = view_end;\n    // Drawing prefs\n    this.prefs = _.extend({}, this.default_prefs, prefs);\n    this.mode = mode;\n};\n\nPainter.prototype.default_prefs = {};\n\n/**\n * Draw on the context using a rectangle of width x height using scale w_scale.\n */\nPainter.prototype.draw = function (ctx, width, height, w_scale) {};\n\n/**\n * Get starting drawing position, which is offset a half-base left of coordinate.\n */\nPainter.prototype.get_start_draw_pos = function (chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, -0.5);\n};\n\n/**\n * Get end drawing position, which is offset a half-base right of coordinate.\n */\nPainter.prototype.get_end_draw_pos = function (chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0.5);\n};\n\n/**\n * Get drawing position.\n */\nPainter.prototype.get_draw_pos = function (chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0);\n};\n\n/**\n * Convert chromosome position to drawing position.\n */\nPainter.prototype._chrom_pos_to_draw_pos = function (chrom_pos, w_scale, offset) {\n    return Math.floor(w_scale * (Math.max(0, chrom_pos - this.view_start) + offset));\n};\n\nvar LinePainter = function LinePainter(data, view_start, view_end, prefs, mode) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n};\n\nLinePainter.prototype.default_prefs = {\n    min_value: undefined,\n    max_value: undefined,\n    mode: \"Histogram\",\n    color: \"#000\",\n    overflow_color: \"#F66\"\n};\n\nLinePainter.prototype.draw = function (ctx, width, height, w_scale) {\n    var in_path = false;\n    var min_value = this.prefs.min_value;\n    var max_value = this.prefs.max_value;\n    var vertical_range = max_value - min_value;\n    var height_px = height;\n    var view_start = this.view_start;\n    var mode = this.mode;\n    var data = this.data;\n\n    ctx.save();\n\n    // Pixel position of 0 on the y axis\n    var y_zero = Math.round(height + min_value / vertical_range * height);\n\n    // Horizontal line to denote x-axis\n    if (mode !== \"Intensity\") {\n        ctx.fillStyle = \"#aaa\";\n        ctx.fillRect(0, y_zero, width, 1);\n    }\n\n    ctx.beginPath();\n    var x_scaled;\n    var y;\n    var delta_x_pxs;\n    if (data.length > 1) {\n        delta_x_pxs = _.map(data.slice(0, -1), function (d, i) {\n            return Math.ceil((data[i + 1][0] - data[i][0]) * w_scale);\n        });\n    } else {\n        delta_x_pxs = [10];\n    }\n\n    // Painter color can be in either block_color (FeatureTrack) or color pref (LineTrack).\n    var painter_color = this.prefs.block_color || this.prefs.color;\n\n    var // Extract RGB from preference color.\n    pref_color = parseInt(painter_color.slice(1), 16);\n\n    var pref_r = (pref_color & 0xff0000) >> 16;\n    var pref_g = (pref_color & 0x00ff00) >> 8;\n    var pref_b = pref_color & 0x0000ff;\n    var top_overflow = false;\n    var bot_overflow = false;\n\n    // Paint track.\n    var delta_x_px;\n    for (var i = 0, len = data.length; i < len; i++) {\n        // Reset attributes for next point.\n        ctx.fillStyle = ctx.strokeStyle = painter_color;\n        top_overflow = bot_overflow = false;\n        delta_x_px = delta_x_pxs[i];\n\n        x_scaled = Math.floor((data[i][0] - view_start - 0.5) * w_scale);\n        y = data[i][1];\n\n        // Process Y (scaler) value.\n        if (y === null) {\n            if (in_path && mode === \"Filled\") {\n                ctx.lineTo(x_scaled, height_px);\n            }\n            in_path = false;\n            continue;\n        }\n\n        // Bound Y value by min, max.\n        if (y < min_value) {\n            bot_overflow = true;\n            y = min_value;\n        } else if (y > max_value) {\n            top_overflow = true;\n            y = max_value;\n        }\n\n        // Draw point.\n        if (mode === \"Histogram\") {\n            // y becomes the bar height in pixels, which is the negated for canvas coords\n            y = Math.round(y / vertical_range * height_px);\n            ctx.fillRect(x_scaled, y_zero, delta_x_px, -y);\n        } else if (mode === \"Intensity\") {\n            var saturation = (y - min_value) / vertical_range;\n\n            var // Range is [pref_color, 255] where saturation = 0 --> 255 and saturation = 1 --> pref color\n            new_r = Math.round(pref_r + (255 - pref_r) * (1 - saturation));\n\n            var new_g = Math.round(pref_g + (255 - pref_g) * (1 - saturation));\n            var new_b = Math.round(pref_b + (255 - pref_b) * (1 - saturation));\n            ctx.fillStyle = \"rgb(\" + new_r + \",\" + new_g + \",\" + new_b + \")\";\n            ctx.fillRect(x_scaled, 0, delta_x_px, height_px);\n        } else {\n            // mode is Coverage/Line or Filled.\n\n            // Scale Y value.\n            y = Math.round(height_px - (y - min_value) / vertical_range * height_px);\n            if (in_path) {\n                ctx.lineTo(x_scaled, y);\n            } else {\n                in_path = true;\n                if (mode === \"Filled\") {\n                    ctx.moveTo(x_scaled, height_px);\n                    ctx.lineTo(x_scaled, y);\n                } else {\n                    ctx.moveTo(x_scaled, y);\n                    // Use this approach (note: same as for filled) to draw line from 0 to\n                    // first data point.\n                    //ctx.moveTo(x_scaled, height_px);\n                    //ctx.lineTo(x_scaled, y);\n                }\n            }\n        }\n\n        // Draw lines at boundaries if overflowing min or max\n        ctx.fillStyle = this.prefs.overflow_color;\n        if (top_overflow || bot_overflow) {\n            var overflow_x;\n            if (mode === \"Histogram\" || mode === \"Intensity\") {\n                overflow_x = delta_x_px;\n            } else {\n                // Line and Filled, which are points\n                x_scaled -= 2; // Move it over to the left so it's centered on the point\n                overflow_x = 4;\n            }\n            if (top_overflow) {\n                ctx.fillRect(x_scaled, 0, overflow_x, 3);\n            }\n            if (bot_overflow) {\n                ctx.fillRect(x_scaled, height_px - 3, overflow_x, 3);\n            }\n        }\n        ctx.fillStyle = painter_color;\n    }\n    if (mode === \"Filled\") {\n        if (in_path) {\n            ctx.lineTo(x_scaled, y_zero);\n            ctx.lineTo(0, y_zero);\n        }\n        ctx.fill();\n    } else {\n        ctx.stroke();\n    }\n\n    ctx.restore();\n};\n\n/**\n * Mapper that contains information about feature locations and data.\n */\nvar FeaturePositionMapper = function FeaturePositionMapper(slot_height) {\n    this.feature_positions = {};\n    this.slot_height = slot_height;\n    this.translation = 0;\n    this.y_translation = 0;\n};\n\n/**\n * Map feature data to a position defined by <slot, x_start, x_end>.\n */\nFeaturePositionMapper.prototype.map_feature_data = function (feature_data, slot, x_start, x_end) {\n    if (!this.feature_positions[slot]) {\n        this.feature_positions[slot] = [];\n    }\n    this.feature_positions[slot].push({\n        data: feature_data,\n        x_start: x_start,\n        x_end: x_end\n    });\n};\n\n/**\n * Get feature data for position <x, y>\n */\nFeaturePositionMapper.prototype.get_feature_data = function (x, y) {\n    // Find slot using Y.\n    var slot = Math.floor((y - this.y_translation) / this.slot_height);\n\n    var feature_dict;\n\n    // May not be over a slot due to padding, margin, etc.\n    if (!this.feature_positions[slot]) {\n        return null;\n    }\n\n    // Find feature using X.\n    x += this.translation;\n    for (var i = 0; i < this.feature_positions[slot].length; i++) {\n        feature_dict = this.feature_positions[slot][i];\n        if (x >= feature_dict.x_start && x <= feature_dict.x_end) {\n            return feature_dict.data;\n        }\n    }\n};\n\n/**\n * Abstract object for painting feature tracks. Subclasses must implement draw_element() for painting to work.\n * Painter uses a 0-based, half-open coordinate system; start coordinate is closed--included--and the end is open.\n * This coordinate system matches the BED format.\n */\nvar FeaturePainter = function FeaturePainter(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    this.alpha_scaler = alpha_scaler ? alpha_scaler : new Scaler();\n    this.height_scaler = height_scaler ? height_scaler : new Scaler();\n    this.max_label_length = 200;\n};\n\nFeaturePainter.prototype.default_prefs = {\n    block_color: \"#FFF\",\n    connector_color: \"#FFF\"\n};\n\n_.extend(FeaturePainter.prototype, {\n    get_required_height: function get_required_height(rows_required, width) {\n        // y_scale is the height per row\n        var required_height = this.get_row_height();\n\n        var y_scale = required_height;\n        var mode = this.mode;\n        // If using a packing mode, need to multiply by the number of slots used\n        if (mode === \"no_detail\" || mode === \"Squish\" || mode === \"Pack\") {\n            required_height = rows_required * y_scale;\n        }\n        return required_height + this.get_top_padding(width);\n    },\n\n    /** Extra padding before first row of features */\n    get_top_padding: function get_top_padding(width) {\n        return 0;\n    },\n\n    /**\n     * Draw data on ctx using slots and within the rectangle defined by width and height. Returns\n     * a FeaturePositionMapper object with information about where features were drawn.\n     */\n    draw: function draw(ctx, width, height, w_scale, slots) {\n        var data = this.data;\n        var view_start = this.view_start;\n        var view_end = this.view_end;\n\n        ctx.save();\n\n        ctx.fillStyle = this.prefs.block_color;\n        ctx.textAlign = \"right\";\n\n        var y_scale = this.get_row_height();\n        var feature_mapper = new FeaturePositionMapper(y_scale);\n        var x_draw_coords;\n        var incomplete_features = [];\n\n        for (var i = 0, len = data.length; i < len; i++) {\n            var feature = data[i];\n            var feature_uid = feature[0];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n\n            var // Slot valid only if features are slotted and this feature is slotted;\n            // feature may not be due to lack of space.\n            slot = slots && slots[feature_uid] !== undefined ? slots[feature_uid].slot : null;\n\n            // Draw feature if (a) mode is dense or feature is slotted (as it must be for all non-dense modes) and\n            // (b) there's overlap between the feature and drawing region.\n            if ((this.mode === \"Dense\" || slot !== null) && feature_start < view_end && feature_end > view_start) {\n                x_draw_coords = this.draw_element(ctx, this.mode, feature, slot, view_start, view_end, w_scale, y_scale, width);\n                feature_mapper.map_feature_data(feature, slot, x_draw_coords[0], x_draw_coords[1]);\n\n                // Add to incomplete features if it's not drawn completely in region.\n                if (feature_start < view_start || feature_end > view_end) {\n                    incomplete_features.push(feature);\n                }\n            }\n        }\n\n        ctx.restore();\n\n        feature_mapper.y_translation = this.get_top_padding(width);\n        return new DrawResults({\n            incomplete_features: incomplete_features,\n            feature_mapper: feature_mapper\n        });\n    },\n\n    /**\n     * Abstract function for drawing an individual feature.\n     */\n    draw_element: function draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        return [0, 0];\n    }\n});\n\n// Constants specific to feature tracks moved here (HACKING, these should\n// basically all be configuration options)\nvar DENSE_TRACK_HEIGHT = 10;\n\nvar NO_DETAIL_TRACK_HEIGHT = 3;\nvar SQUISH_TRACK_HEIGHT = 5;\nvar PACK_TRACK_HEIGHT = 10;\nvar NO_DETAIL_FEATURE_HEIGHT = 1;\nvar DENSE_FEATURE_HEIGHT = 9;\nvar SQUISH_FEATURE_HEIGHT = 3;\nvar PACK_FEATURE_HEIGHT = 9;\nvar LABEL_SPACING = 2;\nvar CONNECTOR_COLOR = \"#ccc\";\n\nvar LinkedFeaturePainter = function LinkedFeaturePainter(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    FeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    // Whether to draw a single connector in the background that spans the entire feature (the intron fishbone)\n    this.draw_background_connector = true;\n    // Whether to call draw_connector for every pair of blocks\n    this.draw_individual_connectors = false;\n};\n\n_.extend(LinkedFeaturePainter.prototype, FeaturePainter.prototype, {\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height: function get_row_height() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"no_detail\") {\n            height = NO_DETAIL_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    },\n\n    /**\n     * Draw a feature. Returns an array with feature's start and end X coordinates.\n     */\n    draw_element: function draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        var feature_uid = feature[0];\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n        var feature_strand = feature[4];\n\n        var // -0.5 to offset region between bases.\n        f_start = Math.floor(Math.max(0, (feature_start - tile_low - 0.5) * w_scale));\n\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n\n        var draw_start = f_start;\n        var draw_end = f_end;\n\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale + this.get_top_padding(width);\n\n        var thickness;\n        var y_start;\n        var thick_start = null;\n        var thick_end = null;\n\n        var // TODO: is there any reason why block, label color cannot be set at the Painter level?\n        // For now, assume '.' === '+'\n        block_color = !feature_strand || feature_strand === \"+\" || feature_strand === \".\" ? this.prefs.block_color : this.prefs.reverse_strand_color;\n\n        var label_color = this.prefs.label_color;\n\n        // Set global alpha.\n        ctx.globalAlpha = this.alpha_scaler.gen_val(feature);\n\n        // In dense mode, put all data in top slot.\n        if (mode === \"Dense\") {\n            slot = 1;\n        }\n\n        if (mode === \"no_detail\") {\n            // No details for feature, so only one way to display.\n            ctx.fillStyle = block_color;\n            ctx.fillRect(f_start, y_start + 5, f_end - f_start, NO_DETAIL_FEATURE_HEIGHT);\n        } else {\n            // Mode is either Squish or Pack:\n            // Feature details.\n            var feature_ts = feature[5];\n\n            var feature_te = feature[6];\n            var feature_blocks = feature[7];\n\n            var // Whether we are drawing full height or squished features\n            full_height = true;\n\n            if (feature_ts && feature_te) {\n                thick_start = Math.floor(Math.max(0, (feature_ts - tile_low) * w_scale));\n                thick_end = Math.ceil(Math.min(width, Math.max(0, (feature_te - tile_low) * w_scale)));\n            }\n\n            // Set vars that depend on mode.\n            var thin_height;\n\n            var thick_height;\n            if (mode === \"Squish\") {\n                thin_height = 1;\n                thick_height = SQUISH_FEATURE_HEIGHT;\n                full_height = false;\n            } else if (mode === \"Dense\") {\n                thin_height = 5;\n                thick_height = DENSE_FEATURE_HEIGHT;\n            } else {\n                // mode === \"Pack\"\n                thin_height = 5;\n                thick_height = PACK_FEATURE_HEIGHT;\n            }\n\n            // Draw feature/feature blocks + connectors.\n            if (!feature_blocks) {\n                // If there are no blocks, treat the feature as one big exon.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                // If strand is specified, draw arrows over feature\n                if (feature_strand && full_height) {\n                    if (feature_strand === \"+\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                    } else if (feature_strand === \"-\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                    }\n                    ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                }\n            } else {\n                //\n                // There are feature blocks and mode is either Squish or Pack.\n                //\n                // Approach: (a) draw whole feature as connector/intron and (b) draw blocks as\n                // needed. This ensures that whole feature, regardless of whether it starts with\n                // a block, is visible.\n                //\n\n                // Compute y axis start position and height\n                var cur_y_start;\n\n                var cur_height;\n                if (mode === \"Squish\" || mode === \"Dense\") {\n                    cur_y_start = y_start + Math.floor(SQUISH_FEATURE_HEIGHT / 2) + 1;\n                    cur_height = 1;\n                } else {\n                    // mode === \"Pack\"\n                    if (feature_strand) {\n                        cur_y_start = y_start;\n                        cur_height = thick_height;\n                    } else {\n                        cur_y_start += SQUISH_FEATURE_HEIGHT / 2 + 1;\n                        cur_height = 1;\n                    }\n                }\n\n                // Draw whole feature as connector/intron.\n                if (this.draw_background_connector) {\n                    if (mode === \"Squish\" || mode === \"Dense\") {\n                        ctx.fillStyle = CONNECTOR_COLOR;\n                    } else {\n                        // mode === \"Pack\"\n                        if (feature_strand) {\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand\");\n                            }\n                        } else {\n                            ctx.fillStyle = CONNECTOR_COLOR;\n                        }\n                    }\n                    ctx.fillRect(f_start, cur_y_start, f_end - f_start, cur_height);\n                }\n\n                // Draw blocks.\n                var start_and_height;\n                for (var k = 0, k_len = feature_blocks.length; k < k_len; k++) {\n                    var block = feature_blocks[k];\n\n                    var // -0.5 to offset block between bases.\n                    block_start = Math.floor(Math.max(0, (block[0] - tile_low - 0.5) * w_scale));\n\n                    var block_end = Math.ceil(Math.min(width, Math.max((block[1] - tile_low - 0.5) * w_scale)));\n\n                    var last_block_start;\n                    var last_block_end;\n\n                    // Skip drawing if block not on tile.\n                    if (block_start > block_end) {\n                        continue;\n                    }\n\n                    // Draw thin block.\n                    ctx.fillStyle = block_color;\n                    ctx.fillRect(block_start, y_start + (thick_height - thin_height) / 2 + 1, block_end - block_start, thin_height);\n\n                    // If block intersects with thick region, draw block as thick.\n                    // - No thick is sometimes encoded as thick_start == thick_end, so don't draw in that case\n                    if (thick_start !== undefined && feature_te > feature_ts && !(block_start > thick_end || block_end < thick_start)) {\n                        var block_thick_start = Math.max(block_start, thick_start);\n\n                        var block_thick_end = Math.min(block_end, thick_end);\n                        ctx.fillRect(block_thick_start, y_start + 1, block_thick_end - block_thick_start, thick_height);\n                        if (feature_blocks.length === 1 && mode === \"Pack\") {\n                            // Exactly one block means we have no introns, but do have a distinct \"thick\" region,\n                            // draw arrows over it if in pack mode.\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                            }\n                            // If region is wide enough in pixels, pad a bit\n                            if (block_thick_start + 14 < block_thick_end) {\n                                block_thick_start += 2;\n                                block_thick_end -= 2;\n                            }\n                            ctx.fillRect(block_thick_start, y_start + 1, block_thick_end - block_thick_start, thick_height);\n                        }\n                    }\n                    // Draw individual connectors if required\n                    if (this.draw_individual_connectors && last_block_start) {\n                        this.draw_connector(ctx, last_block_start, last_block_end, block_start, block_end, y_start);\n                    }\n                    last_block_start = block_start;\n                    last_block_end = block_end;\n                }\n\n                // FIXME: Height scaling only works in Pack mode right now.\n                if (mode === \"Pack\") {\n                    // Reset alpha so height scaling is not impacted by alpha scaling.\n                    ctx.globalAlpha = 1;\n\n                    // Height scaling: draw white lines to reduce height according to height scale factor.\n                    ctx.fillStyle = \"white\"; // TODO: set this to background color.\n                    var hscale_factor = this.height_scaler.gen_val(feature);\n\n                    var // Ceil ensures that min height is >= 1.\n                    new_height = Math.ceil(thick_height * hscale_factor);\n\n                    var ws_height = Math.round((thick_height - new_height) / 2);\n                    if (hscale_factor !== 1) {\n                        ctx.fillRect(f_start, cur_y_start + 1, f_end - f_start, ws_height);\n                        ctx.fillRect(f_start, cur_y_start + thick_height - ws_height + 1, f_end - f_start, ws_height);\n                    }\n                }\n            }\n\n            // Reset alpha so that label is not transparent.\n            ctx.globalAlpha = 1;\n\n            // Draw label for Pack mode.\n            if (feature_name && mode === \"Pack\" && feature_start > tile_low) {\n                ctx.fillStyle = label_color;\n                // FIXME: assumption here that the entire view starts at 0\n                if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                    ctx.textAlign = \"left\";\n                    ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_end += ctx.measureText(feature_name).width + LABEL_SPACING;\n                } else {\n                    ctx.textAlign = \"right\";\n                    ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_start -= ctx.measureText(feature_name).width + LABEL_SPACING;\n                }\n                //ctx.fillStyle = block_color;\n            }\n        }\n\n        // Reset global alpha.\n        ctx.globalAlpha = 1;\n\n        return [draw_start, draw_end];\n    }\n});\n\nvar ReadPainter = function ReadPainter(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler, ref_seq, base_color_fn) {\n    FeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    this.ref_seq = ref_seq ? ref_seq.data : null;\n    this.base_color_fn = base_color_fn;\n};\n\n_.extend(ReadPainter.prototype, FeaturePainter.prototype, {\n    /**\n     * Returns height based on mode.\n     */\n    get_row_height: function get_row_height() {\n        var height;\n        var mode = this.mode;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n            if (this.prefs.show_insertions) {\n                height *= 2;\n            }\n        }\n        return height;\n    },\n\n    /**\n     * Parse CIGAR string to get (a) a list of contiguous drawing blocks (MD=X) and\n     * (b) an array of [ op_index, op_len ] pairs where op_index is an index into the\n     * string 'MIDNSHP=X' Return value is a dictionary with two entries, blocks and cigar\n     */\n    _parse_cigar: function _parse_cigar(cigar_str) {\n        var cigar_ops = \"MIDNSHP=X\";\n\n        // Parse cigar.\n        var blocks = [[0, 0]];\n\n        var cur_block = blocks[0];\n        var base_pos = 0;\n\n        var // Parse cigar operations out and update/create blocks as needed.\n        parsed_cigar = _.map(cigar_str.match(/[0-9]+[MIDNSHP=X]/g), function (op) {\n            // Get operation length, character.\n            var op_len = parseInt(op.slice(0, -1), 10),\n                op_char = op.slice(-1);\n\n            // Update drawing block.\n            if (op_char === \"N\") {\n                // At skip, so need to start new block if current block represents\n                // drawing area.\n                if (cur_block[1] !== 0) {\n                    cur_block = [base_pos + op_len, base_pos + op_len];\n                    blocks.push(cur_block);\n                }\n            } else if (\"ISHP\".indexOf(op_char) === -1) {\n                // Operation is M,D,=,X.\n                cur_block[1] += op_len;\n                base_pos += op_len;\n            }\n\n            // Return parsed cigar.\n            return [cigar_ops.indexOf(op_char), op_len];\n        });\n\n        return {\n            blocks: blocks,\n            cigar: parsed_cigar\n        };\n    },\n\n    /**\n     * Draw a single read from reference-based read sequence and cigar.\n     */\n    draw_read: function draw_read(ctx, mode, w_scale, y_start, tile_low, tile_high, feature_start, cigar, strand, read_seq) {\n        // Helper function to update base and sequnence offsets.\n        var update_base_offset = function update_base_offset(offset, cig_op, cig_len) {\n            if (\"M=NXD\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var update_seq_offset = function update_seq_offset(offset, cig_op, cig_len) {\n            if (\"IX\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var // Gets drawing coordinate for a sequence coordinate. Assumes closure variables w_scale and tile_low.\n        get_draw_coord = function get_draw_coord(sequence_coord // -0.5 to offset sequence between bases.\n        ) {\n            return Math.floor(Math.max(0, (sequence_coord - tile_low - 0.5) * w_scale));\n        };\n\n        ctx.textAlign = \"center\";\n        var tile_region = [tile_low, tile_high];\n        var base_offset = 0;\n        var seq_offset = 0;\n        var gap = Math.round(w_scale / 2);\n        var char_width_px = ctx.canvas.manager.char_width_px;\n\n        var block_color = strand === \"+\" ? this.prefs.detail_block_color : this.prefs.reverse_strand_color;\n\n        var pack_mode = mode === \"Pack\";\n\n        var draw_height = pack_mode ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        var rect_y = y_start + 1;\n        var paint_utils = new ReadPainterUtils(ctx, draw_height, w_scale, mode);\n        var drawing_blocks = [];\n        var s_start;\n        var s_end;\n\n        // Keep list of items that need to be drawn on top of initial drawing layer.\n        var draw_last = [];\n\n        // Parse cigar and get drawing blocks.\n        var t = this._parse_cigar(cigar);\n        cigar = t.cigar;\n        drawing_blocks = t.blocks;\n\n        // Draw blocks.\n        for (var i = 0; i < drawing_blocks.length; i++) {\n            var block = drawing_blocks[i];\n\n            if (is_overlap([feature_start + block[0], feature_start + block[1]], tile_region)) {\n                s_start = get_draw_coord(feature_start + block[0]);\n                s_end = get_draw_coord(feature_start + block[1]);\n\n                // Make sure that block is drawn even if it too small to be rendered officially; in this case,\n                // read is drawn at 1px.\n                // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n                // and drawing.\n                if (s_start === s_end) {\n                    s_end += 1;\n                }\n\n                // Draw read base as rectangle.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(s_start, rect_y, s_end - s_start, draw_height);\n            }\n        }\n\n        // Draw read features.\n        for (var cig_id = 0, len = cigar.length; cig_id < len; cig_id++) {\n            var cig = cigar[cig_id];\n            var cig_op = \"MIDNSHP=X\"[cig[0]];\n            var cig_len = cig[1];\n\n            var seq_start = feature_start + base_offset;\n            s_start = get_draw_coord(seq_start);\n            s_end = get_draw_coord(seq_start + cig_len);\n\n            // Skip feature if it's not in tile.\n            if (!is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                // Update offsets.\n                base_offset = update_base_offset(base_offset, cig_op, cig_len);\n                seq_offset = update_seq_offset(seq_offset, cig_op, cig_len);\n                continue;\n            }\n\n            // Make sure that read is drawn even if it too small to be rendered officially; in this case,\n            // read is drawn at 1px.\n            // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n            // and drawing.\n            if (s_start === s_end) {\n                s_end += 1;\n            }\n\n            // Draw read feature.\n            switch (cig_op) {\n                case \"H\": // Hard clipping.\n                case \"S\": // Soft clipping.\n                case \"P\":\n                    // Padding.\n                    // Sequence not present and not related to alignment; do nothing.\n                    break;\n                case \"M\":\n                    // \"Match\".\n                    // Because it's not known whether there is a match, ignore.\n                    base_offset += cig_len;\n                    break;\n                case \"=\": // Match with reference.\n                case \"X\":\n                    // Mismatch with reference.\n                    //\n                    // Draw sequence and/or variants.\n                    //\n\n                    // Get sequence to draw.\n                    var cur_seq = \"\";\n                    if (cig_op === \"X\") {\n                        // Get sequence from read_seq.\n                        cur_seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                    } else if (this.ref_seq) {\n                        // && cig_op === '='\n                        // Use reference sequence.\n                        cur_seq = this.ref_seq.slice(\n                        // If read starts after tile start, slice at read start.\n                        Math.max(0, seq_start - tile_low),\n                        // If read ends before tile end, slice at read end.\n                        Math.min(seq_start - tile_low + cig_len, tile_high - tile_low));\n                    }\n\n                    // Draw sequence. Because cur_seq starts and read/tile start, go to there to start writing.\n                    var start_pos = Math.max(seq_start, tile_low);\n                    for (var c = 0; c < cur_seq.length; c++) {\n                        // Draw base if showing all (i.e. not showing differences) or there is a mismatch.\n                        if (cur_seq && !this.prefs.show_differences || cig_op === \"X\") {\n                            // Draw base.\n                            var c_start = Math.floor(Math.max(0, (start_pos + c - tile_low) * w_scale));\n                            ctx.fillStyle = this.base_color_fn(cur_seq[c]);\n                            if (pack_mode && w_scale > char_width_px) {\n                                ctx.fillText(cur_seq[c], c_start, y_start + 9);\n                            } else if (w_scale > 0.05) {\n                                // Require a minimum w_scale so that variants are only drawn when somewhat zoomed in.\n                                ctx.fillRect(c_start - gap, rect_y, Math.max(1, Math.round(w_scale)), draw_height);\n                            }\n                        }\n                    }\n\n                    // Move forward in sequence only if sequence used to get mismatches.\n                    if (cig_op === \"X\") {\n                        seq_offset += cig_len;\n                    }\n                    base_offset += cig_len;\n\n                    break;\n                case \"N\":\n                    // Skipped bases.\n                    ctx.fillStyle = CONNECTOR_COLOR;\n                    ctx.fillRect(s_start, rect_y + (draw_height - 1) / 2, s_end - s_start, 1);\n                    // No change in seq_offset because sequence not used when skipping.\n                    base_offset += cig_len;\n                    break;\n                case \"D\":\n                    // Deletion.\n                    paint_utils.draw_deletion(s_start, rect_y, cig_len);\n                    base_offset += cig_len;\n                    break;\n                case \"I\":\n                    // Insertion.\n                    // Check to see if sequence should be drawn at all by looking at the overlap between\n                    // the sequence region and the tile region.\n                    var insert_x_coord = s_start - gap;\n\n                    if (is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                        var seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                        // Insertion point is between the sequence start and the previous base: (-gap) moves\n                        // back from sequence start to insertion point.\n                        if (this.prefs.show_insertions) {\n                            //\n                            // Show inserted sequence above, centered on insertion point.\n                            //\n\n                            // Draw sequence.\n                            // X center is offset + start - <half_sequence_length>\n                            var x_center = s_start - (s_end - s_start) / 2;\n                            if ((mode === \"Pack\" || this.mode === \"Auto\") && read_seq !== undefined && w_scale > char_width_px) {\n                                // Draw sequence container.\n                                ctx.fillStyle = \"yellow\";\n                                ctx.fillRect(x_center - gap, y_start - 9, s_end - s_start, 9);\n                                draw_last[draw_last.length] = {\n                                    type: \"triangle\",\n                                    data: [insert_x_coord, y_start + 4, 5]\n                                };\n                                ctx.fillStyle = CONNECTOR_COLOR;\n                                // Based on overlap b/t sequence and tile, get sequence to be drawn.\n                                switch (compute_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                                    case OVERLAP_START:\n                                        seq = seq.slice(tile_low - seq_start);\n                                        break;\n                                    case OVERLAP_END:\n                                        seq = seq.slice(0, seq_start - tile_high);\n                                        break;\n                                    case CONTAINED_BY:\n                                        // All of sequence drawn.\n                                        break;\n                                    case CONTAINS:\n                                        seq = seq.slice(tile_low - seq_start, seq_start - tile_high);\n                                        break;\n                                }\n                                // Draw sequence.\n                                for (var c = 0, str_len = seq.length; c < str_len; c++) {\n                                    var c_start = Math.floor(Math.max(0, (seq_start + c - tile_low) * w_scale));\n                                    ctx.fillText(seq[c], c_start - (s_end - s_start) / 2, y_start);\n                                }\n                            } else {\n                                // Draw block.\n                                ctx.fillStyle = \"yellow\";\n                                // TODO: This is a pretty hack-ish way to fill rectangle based on mode.\n                                ctx.fillRect(x_center, y_start + (this.mode !== \"Dense\" ? 2 : 5), s_end - s_start, mode !== \"Dense\" ? SQUISH_FEATURE_HEIGHT : DENSE_FEATURE_HEIGHT);\n                            }\n                        } else {\n                            if ((mode === \"Pack\" || this.mode === \"Auto\") && read_seq !== undefined && w_scale > char_width_px) {\n                                // Show insertions with a single number at the insertion point.\n                                draw_last.push({\n                                    type: \"text\",\n                                    data: [seq.length, insert_x_coord, y_start + 9]\n                                });\n                            } else {\n                                // TODO: probably can merge this case with code above.\n                            }\n                        }\n                    }\n                    seq_offset += cig_len;\n                    // No change to base offset because insertions are drawn above sequence/read.\n                    break;\n            }\n        }\n\n        //\n        // Draw last items.\n        //\n        ctx.fillStyle = \"yellow\";\n        var item;\n        var type;\n        var data;\n        for (var i = 0; i < draw_last.length; i++) {\n            item = draw_last[i];\n            type = item.type;\n            data = item.data;\n            if (type === \"text\") {\n                ctx.save();\n                ctx.font = \"bold \" + ctx.font;\n                ctx.fillText(data[0], data[1], data[2]);\n                ctx.restore();\n            } else if (type === \"triangle\") {\n                drawDownwardEquilateralTriangle(ctx, data[0], data[1], data[2]);\n            }\n        }\n    },\n\n    /**\n     * Draw a complete read pair\n     */\n    draw_element: function draw_element(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        // All features need a start, end, and vertical center.\n        var feature_uid = feature[0];\n\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n\n        var // -0.5 to put element between bases.\n        f_start = Math.floor(Math.max(-0.5 * w_scale, (feature_start - tile_low - 0.5) * w_scale));\n\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale;\n\n        var draw_height = mode === \"Pack\" ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        var label_color = this.prefs.label_color;\n\n        // Draw read.\n        if (feature[5] instanceof Array) {\n            // Read is paired.\n            var connector = true;\n\n            // Draw left/forward read.\n            if (feature[4][1] >= tile_low && feature[4][0] <= tile_high && feature[4][2]) {\n                this.draw_read(ctx, mode, w_scale, y_start, tile_low, tile_high, feature[4][0], feature[4][2], feature[4][3], feature[4][4]);\n            } else {\n                connector = false;\n            }\n\n            // Draw right/reverse read.\n            if (feature[5][1] >= tile_low && feature[5][0] <= tile_high && feature[5][2]) {\n                this.draw_read(ctx, mode, w_scale, y_start, tile_low, tile_high, feature[5][0], feature[5][2], feature[5][3], feature[5][4]);\n            } else {\n                connector = false;\n            }\n\n            // Draw connector if both reads were drawn.\n            // TODO: currently, there is no way to connect reads drawn on different tiles; to connect reads on different tiles, data manager\n            // code is needed to join mate pairs from different regions. Alternatively, requesting multiple regions of data at once would\n            // make it possible to put together more easily.\n            // -0.5 to position connector correctly between reads.\n            var b1_end = Math.ceil(Math.min(width, Math.max(-0.5 * w_scale, (feature[4][1] - tile_low - 0.5) * w_scale)));\n\n            var b2_start = Math.floor(Math.max(-0.5 * w_scale, (feature[5][0] - tile_low - 0.5) * w_scale));\n\n            if (connector && b2_start > b1_end) {\n                ctx.fillStyle = CONNECTOR_COLOR;\n                var line_height = y_start + 1 + (draw_height - 1) / 2;\n                dashedLine(ctx, b1_end, line_height, b2_start, line_height);\n            }\n        } else {\n            // Read is single.\n            this.draw_read(ctx, mode, w_scale, y_start, tile_low, tile_high, feature_start, feature[4], feature[5], feature[6]);\n        }\n        if (mode === \"Pack\" && feature_start >= tile_low && feature_name !== \".\") {\n            // Draw label.\n            ctx.fillStyle = this.prefs.label_color;\n            if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                ctx.textAlign = \"left\";\n                ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 9, this.max_label_length);\n            } else {\n                ctx.textAlign = \"right\";\n                ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 9, this.max_label_length);\n            }\n        }\n\n        // FIXME: provide actual coordinates for drawn read.\n        return [0, 0];\n    }\n});\n\nvar ArcLinkedFeaturePainter = function ArcLinkedFeaturePainter(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    LinkedFeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    // Need to know the longest feature length for adding spacing\n    this.longest_feature_length = this.calculate_longest_feature_length();\n    this.draw_background_connector = false;\n    this.draw_individual_connectors = true;\n};\n\n_.extend(ArcLinkedFeaturePainter.prototype, FeaturePainter.prototype, LinkedFeaturePainter.prototype, {\n    calculate_longest_feature_length: function calculate_longest_feature_length() {\n        var longest_feature_length = 0;\n        for (var i = 0, len = this.data.length; i < len; i++) {\n            var feature = this.data[i];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n            longest_feature_length = Math.max(longest_feature_length, feature_end - feature_start);\n        }\n        return longest_feature_length;\n    },\n\n    get_top_padding: function get_top_padding(width) {\n        var view_range = this.view_end - this.view_start;\n        var w_scale = width / view_range;\n        return Math.min(128, Math.ceil(this.longest_feature_length / 2 * w_scale));\n    },\n\n    draw_connector: function draw_connector(ctx, block1_start, block1_end, block2_start, block2_end, y_start) {\n        // Arc drawing -- from closest endpoints\n        var x_center = (block1_end + block2_start) / 2;\n\n        var radius = block2_start - x_center;\n\n        // For full half circles\n        var angle1 = Math.PI;\n\n        var angle2 = 0;\n        if (radius > 0) {\n            ctx.beginPath();\n            ctx.arc(x_center, y_start, block2_start - x_center, Math.PI, 0);\n            ctx.stroke();\n        }\n    }\n});\n\n// Color stuff from less.js\n\nvar Color = function Color(rgb, a) {\n    /**\n     * The end goal here, is to parse the arguments\n     * into an integer triplet, such as `128, 255, 0`\n     *\n     * This facilitates operations and conversions.\n     */\n    if (Array.isArray(rgb)) {\n        this.rgb = rgb;\n    } else if (rgb.length == 6) {\n        this.rgb = rgb.match(/.{2}/g).map(function (c) {\n            return parseInt(c, 16);\n        });\n    } else if (rgb.length == 7) {\n        this.rgb = rgb.substring(1, 7).match(/.{2}/g).map(function (c) {\n            return parseInt(c, 16);\n        });\n    } else {\n        this.rgb = rgb.split(\"\").map(function (c) {\n            return parseInt(c + c, 16);\n        });\n    }\n    this.alpha = typeof a === \"number\" ? a : 1;\n};\nColor.prototype = {\n    eval: function _eval() {\n        return this;\n    },\n\n    //\n    // If we have some transparency, the only way to represent it\n    // is via `rgba`. Otherwise, we use the hex representation,\n    // which has better compatibility with older browsers.\n    // Values are capped between `0` and `255`, rounded and zero-padded.\n    //\n    toCSS: function toCSS() {\n        if (this.alpha < 1.0) {\n            return \"rgba(\" + this.rgb.map(function (c) {\n                return Math.round(c);\n            }).concat(this.alpha).join(\", \") + \")\";\n        } else {\n            return \"#\" + this.rgb.map(function (i) {\n                i = Math.round(i);\n                i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n                return i.length === 1 ? \"0\" + i : i;\n            }).join(\"\");\n        }\n    },\n\n    toHSL: function toHSL() {\n        var r = this.rgb[0] / 255;\n        var g = this.rgb[1] / 255;\n        var b = this.rgb[2] / 255;\n        var a = this.alpha;\n        var max = Math.max(r, g, b);\n        var min = Math.min(r, g, b);\n        var h;\n        var s;\n        var l = (max + min) / 2;\n        var d = max - min;\n\n        if (max === min) {\n            h = s = 0;\n        } else {\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n            switch (max) {\n                case r:\n                    h = (g - b) / d + (g < b ? 6 : 0);\n                    break;\n                case g:\n                    h = (b - r) / d + 2;\n                    break;\n                case b:\n                    h = (r - g) / d + 4;\n                    break;\n            }\n            h /= 6;\n        }\n        return { h: h * 360, s: s, l: l, a: a };\n    },\n\n    toARGB: function toARGB() {\n        var argb = [Math.round(this.alpha * 255)].concat(this.rgb);\n        return \"#\" + argb.map(function (i) {\n            i = Math.round(i);\n            i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n            return i.length === 1 ? \"0\" + i : i;\n        }).join(\"\");\n    },\n\n    mix: function mix(color2, weight) {\n        var color1 = this;\n\n        var p = weight; // .value / 100.0;\n        var w = p * 2 - 1;\n        var a = color1.toHSL().a - color2.toHSL().a;\n\n        var w1 = ((w * a == -1 ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\n        var w2 = 1 - w1;\n\n        var rgb = [color1.rgb[0] * w1 + color2.rgb[0] * w2, color1.rgb[1] * w1 + color2.rgb[1] * w2, color1.rgb[2] * w1 + color2.rgb[2] * w2];\n\n        var alpha = color1.alpha * p + color2.alpha * (1 - p);\n\n        return new Color(rgb, alpha);\n    }\n};\n\n// End colors from less.js\n\nvar LinearRamp = function LinearRamp(start_color, end_color, start_value, end_value) {\n    /**\n     * Simple linear gradient\n     */\n    this.start_color = new Color(start_color);\n    this.end_color = new Color(end_color);\n    this.start_value = start_value;\n    this.end_value = end_value;\n    this.value_range = end_value - start_value;\n};\n\nLinearRamp.prototype.map_value = function (value) {\n    value = Math.max(value, this.start_value);\n    value = Math.min(value, this.end_value);\n    value = (value - this.start_value) / this.value_range;\n    // HACK: just red for now\n    // return \"hsl(0,100%,\" + (value * 100) + \"%)\"\n    return this.start_color.mix(this.end_color, 1 - value).toCSS();\n};\n\nvar SplitRamp = function SplitRamp(start_color, middle_color, end_color, start_value, end_value) {\n    /**\n     * Two gradients split away from 0\n     */\n    this.positive_ramp = new LinearRamp(middle_color, end_color, 0, end_value);\n    this.negative_ramp = new LinearRamp(middle_color, start_color, 0, -start_value);\n    this.start_value = start_value;\n    this.end_value = end_value;\n};\n\nSplitRamp.prototype.map_value = function (value) {\n    value = Math.max(value, this.start_value);\n    value = Math.min(value, this.end_value);\n    if (value >= 0) {\n        return this.positive_ramp.map_value(value);\n    } else {\n        return this.negative_ramp.map_value(-value);\n    }\n};\n\nvar DiagonalHeatmapPainter = function DiagonalHeatmapPainter(data, view_start, view_end, prefs, mode) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    var i;\n    var len;\n\n    if (this.prefs.min_value === undefined) {\n        var min_value = Infinity;\n        for (i = 0, len = this.data.length; i < len; i++) {\n            min_value = Math.min(min_value, this.data[i][6]);\n        }\n        this.prefs.min_value = min_value;\n    }\n    if (this.prefs.max_value === undefined) {\n        var max_value = -Infinity;\n        for (i = 0, len = this.data.length; i < len; i++) {\n            max_value = Math.max(max_value, this.data[i][6]);\n        }\n        this.prefs.max_value = max_value;\n    }\n};\n\nDiagonalHeatmapPainter.prototype.default_prefs = {\n    min_value: undefined,\n    max_value: undefined,\n    mode: \"Heatmap\",\n    pos_color: \"#FF8C00\",\n    neg_color: \"#4169E1\"\n};\n\nDiagonalHeatmapPainter.prototype.draw = function (ctx, width, height, w_scale) {\n    var min_value = this.prefs.min_value;\n    var max_value = this.prefs.max_value;\n    var value_range = max_value - min_value;\n    var height_px = height;\n    var view_start = this.view_start;\n    var mode = this.mode;\n    var data = this.data;\n    var invsqrt2 = 1 / Math.sqrt(2);\n\n    var ramp = new SplitRamp(this.prefs.neg_color, \"#FFFFFF\", this.prefs.pos_color, min_value, max_value);\n\n    var d;\n    var s1;\n    var e1;\n    var s2;\n    var e2;\n    var value;\n\n    var scale = function scale(p) {\n        return (p - view_start) * w_scale;\n    };\n\n    ctx.save();\n\n    // Draw into triangle, then rotate and scale\n    ctx.rotate(-45 * Math.PI / 180);\n    ctx.scale(invsqrt2, invsqrt2);\n\n    // Paint track.\n    for (var i = 0, len = data.length; i < len; i++) {\n        d = data[i];\n\n        s1 = scale(d[1]);\n        e1 = scale(d[2]);\n        s2 = scale(d[4]);\n        e2 = scale(d[5]);\n        value = d[6];\n\n        ctx.fillStyle = ramp.map_value(value);\n        ctx.fillRect(s1, s2, e1 - s1, e2 - s2);\n    }\n\n    ctx.restore();\n};\n\n/**\n * Utilities for painting reads.\n */\nvar ReadPainterUtils = function ReadPainterUtils(ctx, row_height, px_per_base, mode) {\n    this.ctx = ctx;\n    this.row_height = row_height;\n    this.px_per_base = px_per_base;\n    this.draw_details = (mode === \"Pack\" || mode === \"Auto\") && px_per_base >= ctx.canvas.manager.char_width_px;\n    this.delete_details_thickness = 0.2;\n};\n\n_.extend(ReadPainterUtils.prototype, {\n    /**\n     * Draw deletion of base(s).\n     * @param draw_detail if true, drawing in detail and deletion is drawn more subtly\n     */\n    draw_deletion: function draw_deletion(x, y, len) {\n        this.ctx.fillStyle = \"black\";\n        var thickness = (this.draw_details ? this.delete_details_thickness : 1) * this.row_height;\n        y += 0.5 * (this.row_height - thickness);\n        this.ctx.fillRect(x, y, len * this.px_per_base, thickness);\n    }\n});\n\n/**\n * Paints variant data onto canvas.\n */\nvar VariantPainter = function VariantPainter(data, view_start, view_end, prefs, mode, base_color_fn) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    this.base_color_fn = base_color_fn;\n    this.divider_height = 1;\n};\n\n_.extend(VariantPainter.prototype, Painter.prototype, {\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height: function get_row_height() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    },\n\n    /**\n     * Returns required height to draw a particular number of samples in a given mode.\n     */\n    get_required_height: function get_required_height(num_samples) {\n        // FIXME: for single-sample data, height should be summary_height when zoomed out and\n        // row_height when zoomed in.\n        var height = this.prefs.summary_height;\n\n        // If showing sample data, height is summary + divider + samples.\n        if (num_samples > 1 && this.prefs.show_sample_data) {\n            height += this.divider_height + num_samples * this.get_row_height();\n        }\n        return height;\n    },\n\n    /**\n     * Draw on the context using a rectangle of width x height with scale w_scale.\n     */\n    draw: function draw(ctx, width, height, w_scale) {\n        ctx.save();\n\n        var /**\n            * Returns dictionary of information about an indel; returns empty if there no indel. Assumes indel is left-aligned.\n            * Dict attributes:\n            *    -type: 'insertion' or 'deletion'\n            *    -start: where the deletion starts relative to reference start\n            *    -len: how long the deletion is\n            */\n        get_indel_info = function get_indel_info(ref, alt) {\n            var ref_len = ref.length;\n            var alt_len = alt.length;\n            var start = 0;\n            var len = 1;\n            var type = null;\n            if (alt === \"-\") {\n                type = \"deletion\";\n                len = ref.length;\n            } else if (ref.indexOf(alt) === 0 && ref_len > alt_len) {\n                type = \"deletion\";\n                len = ref_len - alt_len;\n                start = alt_len;\n            } else if (alt.indexOf(ref) === 0 && ref_len < alt_len) {\n                // Insertion.\n                type = \"insertion\";\n                len = alt_len - ref_len;\n                start = alt_len;\n            }\n\n            return type !== null ? { type: type, start: start, len: len } : {};\n        };\n\n        // Draw.\n        var locus_data;\n\n        var pos;\n        var id;\n        var ref;\n        var alt;\n        var qual;\n        var filter;\n        var sample_gts;\n        var allele_counts;\n        var variant;\n        var draw_x_start;\n        var draw_y_start;\n        var genotype;\n\n        var // Always draw variants at least 1 pixel wide.\n        base_px = Math.max(1, Math.floor(w_scale));\n\n        var // Determine number of samples.\n        num_samples = this.data.length ? this.data[0][7].split(\",\").length : 0;\n\n        var row_height = this.mode === \"Squish\" ? SQUISH_TRACK_HEIGHT : PACK_TRACK_HEIGHT;\n\n        var // If zoomed out, fill the whole row with feature to make it easier to read;\n        // when zoomed in, use feature height so that there are gaps in sample rows.\n        feature_height = w_scale < 0.1 ? row_height : this.mode === \"Squish\" ? SQUISH_FEATURE_HEIGHT : PACK_FEATURE_HEIGHT;\n\n        var draw_summary = true;\n\n        var paint_utils = new ReadPainterUtils(ctx, row_height, w_scale, this.mode);\n\n        var j;\n\n        // If there's a single sample, update drawing variables.\n        if (num_samples === 1) {\n            row_height = feature_height = w_scale < ctx.canvas.manager.char_width_px ? this.prefs.summary_height : row_height;\n            paint_utils.row_height = row_height;\n            // No summary when there's a single sample.\n            draw_summary = false;\n        }\n\n        // Draw divider between summary and samples.\n        if (this.prefs.show_sample_data && draw_summary) {\n            ctx.fillStyle = \"#F3F3F3\";\n            ctx.globalAlpha = 1;\n            ctx.fillRect(0, this.prefs.summary_height - this.divider_height, width, this.divider_height);\n        }\n\n        // Draw variants.\n        ctx.textAlign = \"center\";\n        for (var i = 0; i < this.data.length; i++) {\n            // Get locus data.\n            locus_data = this.data[i];\n            pos = locus_data[1];\n            ref = locus_data[3];\n            alt = [locus_data[4].split(\",\")];\n            sample_gts = locus_data[7].split(\",\");\n            allele_counts = locus_data.slice(8);\n\n            // Process alterate values to derive information about each alt.\n            alt = _.map(_.flatten(alt), function (a) {\n                var alt_info = {\n                    type: \"snp\",\n                    value: a,\n                    start: 0\n                };\n\n                var indel_info = get_indel_info(ref, a);\n\n                return _.extend(alt_info, indel_info);\n            });\n\n            // Only draw locus data if it's in viewing region.\n            if (pos < this.view_start || pos > this.view_end) {\n                continue;\n            }\n\n            // Draw summary for alleles.\n            if (draw_summary) {\n                ctx.fillStyle = \"#999999\";\n                ctx.globalAlpha = 1;\n                for (j = 0; j < alt.length; j++) {\n                    // Draw background for summary.\n                    draw_x_start = this.get_start_draw_pos(pos + alt[j].start, w_scale);\n                    ctx.fillRect(draw_x_start, 0, base_px, this.prefs.summary_height);\n                    draw_y_start = this.prefs.summary_height;\n                    // Draw allele fractions onto summary.\n                    for (j = 0; j < alt.length; j++) {\n                        ctx.fillStyle = alt[j].type === \"deletion\" ? \"black\" : this.base_color_fn(alt[j].value);\n                        var allele_frac = allele_counts / sample_gts.length;\n                        var draw_height = Math.ceil(this.prefs.summary_height * allele_frac);\n                        ctx.fillRect(draw_x_start, draw_y_start - draw_height, base_px, draw_height);\n                        draw_y_start -= draw_height;\n                    }\n                }\n            }\n\n            // Done drawing if not showing samples data.\n            if (!this.prefs.show_sample_data) {\n                continue;\n            }\n\n            // Draw sample genotype(s).\n            draw_y_start = draw_summary ? this.prefs.summary_height + this.divider_height : 0;\n            for (j = 0; j < sample_gts.length; j++, draw_y_start += row_height) {\n                genotype = sample_gts[j] ? sample_gts[j].split(/\\/|\\|/) : [\"0\", \"0\"];\n\n                // Get variant to draw and set drawing properties.\n                variant = null;\n                if (genotype[0] === genotype[1]) {\n                    if (genotype[0] === \".\") {\n                        // TODO: draw uncalled variant.\n                    } else if (genotype[0] !== \"0\") {\n                        // Homozygous for variant.\n                        variant = alt[parseInt(genotype[0], 10) - 1];\n                        ctx.globalAlpha = 1;\n                    }\n                    // else reference\n                } else {\n                    // Heterozygous for variant.\n                    variant = genotype[0] !== \"0\" ? genotype[0] : genotype[1];\n                    variant = alt[parseInt(variant, 10) - 1];\n                    ctx.globalAlpha = 0.5;\n                }\n\n                // If there's a variant, draw it.\n                if (variant) {\n                    draw_x_start = this.get_start_draw_pos(pos + variant.start, w_scale);\n                    if (variant.type === \"snp\") {\n                        var snp = variant.value;\n                        ctx.fillStyle = this.base_color_fn(snp);\n                        if (paint_utils.draw_details) {\n                            ctx.fillText(snp, this.get_draw_pos(pos, w_scale), draw_y_start + row_height);\n                        } else {\n                            ctx.fillRect(draw_x_start, draw_y_start + 1, base_px, feature_height);\n                        }\n                    } else if (variant.type === \"deletion\") {\n                        paint_utils.draw_deletion(draw_x_start, draw_y_start + 1, variant.len);\n                    } else {\n                        // TODO: handle insertions.\n                    }\n                }\n            }\n        }\n\n        ctx.restore();\n    }\n});\n\nexports.default = {\n    Scaler: Scaler,\n    LinePainter: LinePainter,\n    LinkedFeaturePainter: LinkedFeaturePainter,\n    ReadPainter: ReadPainter,\n    ArcLinkedFeaturePainter: ArcLinkedFeaturePainter,\n    DiagonalHeatmapPainter: DiagonalHeatmapPainter,\n    VariantPainter: VariantPainter\n};\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar extend = _.extend;\n\n/**\n * Filters that enable users to show/hide data points dynamically.\n */\nvar Filter = function Filter(obj_dict) {\n    this.manager = null;\n    this.name = obj_dict.name;\n    // Index into payload to filter.\n    this.index = obj_dict.index;\n    this.tool_id = obj_dict.tool_id;\n    // Name to use for filter when building expression for tool.\n    this.tool_exp_name = obj_dict.tool_exp_name;\n};\n\nextend(Filter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function to_dict() {\n        return {\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        };\n    }\n});\n\n/**\n * Creates an action icon.\n */\nvar create_action_icon = function create_action_icon(title, css_class, on_click_fn) {\n    return $(\"<a/>\").attr(\"href\", \"javascript:void(0);\").attr(\"title\", title).addClass(\"icon-button\").addClass(css_class).tooltip().click(on_click_fn);\n};\n\n/**\n * Number filters have a min, max as well as a low, high; low and high are used\n */\nvar NumberFilter = function NumberFilter(obj_dict) {\n    //\n    // Attribute init.\n    //\n    Filter.call(this, obj_dict);\n    // Filter low/high. These values are used to filter elements.\n    this.low = \"low\" in obj_dict ? obj_dict.low : -Number.MAX_VALUE;\n    this.high = \"high\" in obj_dict ? obj_dict.high : Number.MAX_VALUE;\n    // Slide min/max. These values are used to set/update slider.\n    this.min = \"min\" in obj_dict ? obj_dict.min : Number.MAX_VALUE;\n    this.max = \"max\" in obj_dict ? obj_dict.max : -Number.MAX_VALUE;\n    // UI elements associated with filter.\n    this.container = null;\n    this.slider = null;\n    this.slider_label = null;\n\n    //\n    // Create HTML.\n    //\n\n    // Function that supports inline text editing of slider values.\n    // Enable users to edit parameter's value via a text box.\n    var edit_slider_values = function edit_slider_values(container, span, slider) {\n        container.click(function () {\n            var cur_value = span.text();\n            var max = parseFloat(slider.slider(\"option\", \"max\"));\n\n            var input_size = max <= 1 ? 4 : max <= 1000000 ? max.toString().length : 6;\n\n            var multi_value = false;\n            var slider_row = $(this).parents(\".slider-row\");\n\n            // Row now has input.\n            slider_row.addClass(\"input\");\n\n            // Increase input size if there are two values.\n            if (slider.slider(\"option\", \"values\")) {\n                input_size = 2 * input_size + 1;\n                multi_value = true;\n            }\n            span.text(\"\");\n            // Temporary input for changing value.\n            $(\"<input type='text'/>\").attr(\"size\", input_size).attr(\"maxlength\", input_size).attr(\"value\", cur_value).appendTo(span).focus().select().click(function (e) {\n                // Don't want click to propogate up to values_span and restart everything.\n                e.stopPropagation();\n            }).blur(function () {\n                $(this).remove();\n                span.text(cur_value);\n                slider_row.removeClass(\"input\");\n            }).keyup(function (e) {\n                if (e.keyCode === 27) {\n                    // Escape key.\n                    $(this).trigger(\"blur\");\n                } else if (e.keyCode === 13) {\n                    //\n                    // Enter/return key initiates callback. If new value(s) are in slider range,\n                    // change value (which calls slider's change() function).\n                    //\n                    var slider_min = slider.slider(\"option\", \"min\");\n\n                    var slider_max = slider.slider(\"option\", \"max\");\n\n                    var invalid = function invalid(a_val) {\n                        return isNaN(a_val) || a_val > slider_max || a_val < slider_min;\n                    };\n\n                    var new_value = $(this).val();\n                    if (!multi_value) {\n                        new_value = parseFloat(new_value);\n                        if (invalid(new_value)) {\n                            alert(\"Parameter value must be in the range [\" + slider_min + \"-\" + slider_max + \"]\");\n                            return $(this);\n                        }\n                    } else {\n                        // Multi value.\n                        new_value = new_value.split(\"-\");\n                        new_value = [parseFloat(new_value[0]), parseFloat(new_value[1])];\n                        if (invalid(new_value[0]) || invalid(new_value[1])) {\n                            alert(\"Parameter value must be in the range [\" + slider_min + \"-\" + slider_max + \"]\");\n                            return $(this);\n                        }\n                    }\n\n                    // Updating the slider also updates slider values and removes input.\n                    slider.slider(multi_value ? \"values\" : \"value\", new_value);\n                    slider_row.removeClass(\"input\");\n                }\n            });\n        });\n    };\n\n    var filter = this;\n\n    filter.parent_div = $(\"<div/>\").addClass(\"filter-row slider-row\");\n\n    // Set up filter label (name, values).\n    var filter_label = $(\"<div/>\").addClass(\"elt-label\").appendTo(filter.parent_div);\n\n    var name_span = $(\"<span/>\").addClass(\"slider-name\").text(filter.name + \"  \").appendTo(filter_label);\n\n    var values_span = $(\"<span/>\").text(this.low + \"-\" + this.high);\n\n    var values_span_container = $(\"<span/>\").addClass(\"slider-value\").appendTo(filter_label).append(\"[\").append(values_span).append(\"]\");\n\n    filter.values_span = values_span;\n\n    // Set up slider for filter.\n    var slider_div = $(\"<div/>\").addClass(\"slider\").appendTo(filter.parent_div);\n    filter.control_element = $(\"<div/>\").attr(\"id\", filter.name + \"-filter-control\").appendTo(slider_div);\n    filter.control_element.slider({\n        range: true,\n        min: this.min,\n        max: this.max,\n        step: this.get_slider_step(this.min, this.max),\n        values: [this.low, this.high],\n        slide: function slide(event, ui) {\n            filter.slide(event, ui);\n        },\n        change: function change(event, ui) {\n            filter.control_element.slider(\"option\", \"slide\").call(filter.control_element, event, ui);\n        }\n    });\n    filter.slider = filter.control_element;\n    filter.slider_label = values_span;\n\n    // Enable users to edit slider values via text box.\n    edit_slider_values(values_span_container, values_span, filter.control_element);\n\n    // Set up filter display controls.\n    var display_controls_div = $(\"<div/>\").addClass(\"display-controls\").appendTo(filter.parent_div);\n    this.transparency_icon = create_action_icon(\"Use filter for data transparency\", \"layer-transparent\", function () {\n        if (filter.manager.alpha_filter !== filter) {\n            // Setting this filter as the alpha filter.\n            filter.manager.alpha_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div.find(\".layer-transparent\").removeClass(\"active\").hide();\n            filter.transparency_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.alpha_filter = null;\n            filter.transparency_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    }).appendTo(display_controls_div).hide();\n    this.height_icon = create_action_icon(\"Use filter for data height\", \"arrow-resize-090\", function () {\n        if (filter.manager.height_filter !== filter) {\n            // Setting this filter as the height filter.\n            filter.manager.height_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div.find(\".arrow-resize-090\").removeClass(\"active\").hide();\n            filter.height_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.height_filter = null;\n            filter.height_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    }).appendTo(display_controls_div).hide();\n    filter.parent_div.hover(function () {\n        filter.transparency_icon.show();\n        filter.height_icon.show();\n    }, function () {\n        if (filter.manager.alpha_filter !== filter) {\n            filter.transparency_icon.hide();\n        }\n        if (filter.manager.height_filter !== filter) {\n            filter.height_icon.hide();\n        }\n    });\n\n    // Add to clear floating layout.\n    $(\"<div style='clear: both;'/>\").appendTo(filter.parent_div);\n};\nextend(NumberFilter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function to_dict() {\n        var obj_dict = Filter.prototype.to_dict.call(this);\n        return extend(obj_dict, {\n            type: \"number\",\n            min: this.min,\n            max: this.max,\n            low: this.low,\n            high: this.high\n        });\n    },\n    /**\n     * Return a copy of filter.\n     */\n    copy: function copy() {\n        return new NumberFilter({\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        });\n    },\n    /**\n     * Get step for slider.\n     */\n    // FIXME: make this a \"static\" function.\n    get_slider_step: function get_slider_step(min, max) {\n        var range = max - min;\n        return range <= 2 ? 0.01 : 1;\n    },\n    /**\n     * Handle slide events.\n     */\n    slide: function slide(event, ui) {\n        var values = ui.values;\n\n        // Set new values in UI.\n        this.values_span.text(values[0] + \"-\" + values[1]);\n\n        // Set new values in filter.\n        this.low = values[0];\n        this.high = values[1];\n\n        // Set timeout to update if filter low, high are stable.\n        var self = this;\n        setTimeout(function () {\n            if (values[0] === self.low && values[1] === self.high) {\n                self.manager.track.request_draw({\n                    force: true,\n                    clear_after: true\n                });\n            }\n        }, 25);\n    },\n    /**\n     * Returns true if filter can be applied to element.\n     */\n    applies_to: function applies_to(element) {\n        if (element.length > this.index) {\n            return true;\n        }\n        return false;\n    },\n    /**\n     * Helper function: returns true if value in in filter's [low, high] range.\n     */\n    _keep_val: function _keep_val(val) {\n        return isNaN(val) || val >= this.low && val <= this.high;\n    },\n    /**\n     * Returns true if (a) element's value(s) is in [low, high] (range is inclusive)\n     * or (b) if value is non-numeric and hence unfilterable.\n     */\n    keep: function keep(element) {\n        if (!this.applies_to(element)) {\n            // No element to filter on.\n            return true;\n        }\n\n        // Keep value function.\n        var filter = this;\n\n        // Do filtering.\n        var to_filter = element[this.index];\n        if (to_filter instanceof Array) {\n            var returnVal = true;\n            for (var i = 0; i < to_filter.length; i++) {\n                if (!this._keep_val(to_filter[i])) {\n                    // Exclude element.\n                    returnVal = false;\n                    break;\n                }\n            }\n            return returnVal;\n        } else {\n            return this._keep_val(element[this.index]);\n        }\n    },\n    /**\n     * Update filter's min and max values based on element's values.\n     */\n    update_attrs: function update_attrs(element) {\n        var updated = false;\n        if (!this.applies_to(element)) {\n            return updated;\n        }\n\n        //\n        // Update filter's min, max based on element values.\n        //\n\n        // Make value(s) into an Array.\n        var values = element[this.index];\n        if (!(values instanceof Array)) {\n            values = [values];\n        }\n\n        // Loop through values and update min, max.\n        for (var i = 0; i < values.length; i++) {\n            var value = values[i];\n            if (value < this.min) {\n                this.min = Math.floor(value);\n                updated = true;\n            }\n            if (value > this.max) {\n                this.max = Math.ceil(value);\n                updated = true;\n            }\n        }\n        return updated;\n    },\n    /**\n     * Update filter's slider.\n     */\n    update_ui_elt: function update_ui_elt() {\n        // Only show filter if min < max because filter is not useful otherwise. This\n        // covers all corner cases, such as when min, max have not been defined and\n        // when min == max.\n        if (this.min < this.max) {\n            this.parent_div.show();\n        } else {\n            this.parent_div.hide();\n        }\n\n        var slider_min = this.slider.slider(\"option\", \"min\");\n        var slider_max = this.slider.slider(\"option\", \"max\");\n        if (this.min < slider_min || this.max > slider_max) {\n            // Update slider min, max, step.\n            this.slider.slider(\"option\", \"min\", this.min);\n            this.slider.slider(\"option\", \"max\", this.max);\n            this.slider.slider(\"option\", \"step\", this.get_slider_step(this.min, this.max));\n            // Refresh slider:\n            // TODO: do we want to keep current values or reset to min/max?\n            // Currently we reset values:\n            this.slider.slider(\"option\", \"values\", [this.min, this.max]);\n            // To use the current values.\n            //var values = this.slider.slider( \"option\", \"values\" );\n            //this.slider.slider( \"option\", \"values\", values );\n        }\n    }\n});\n\n/**\n * Manages a set of filters.\n */\nvar FiltersManager = function FiltersManager(track, obj_dict) {\n    this.track = track;\n    this.alpha_filter = null;\n    this.height_filter = null;\n    this.filters = [];\n\n    //\n    // Create HTML.\n    //\n\n    //\n    // Create parent div.\n    //\n    this.parent_div = $(\"<div/>\").addClass(\"filters\").hide();\n    // Disable dragging, double clicking, keys on div so that actions on slider do not impact viz.\n    this.parent_div.bind(\"drag\", function (e) {\n        e.stopPropagation();\n    }).click(function (e) {\n        e.stopPropagation();\n    }).bind(\"dblclick\", function (e) {\n        e.stopPropagation();\n    }).bind(\"keydown\", function (e) {\n        e.stopPropagation();\n    });\n\n    //\n    // Restore state from dict.\n    //\n    if (obj_dict && \"filters\" in obj_dict) {\n        // Second condition needed for backward compatibility.\n        var alpha_filter_name = \"alpha_filter\" in obj_dict ? obj_dict.alpha_filter : null;\n\n        var height_filter_name = \"height_filter\" in obj_dict ? obj_dict.height_filter : null;\n\n        var filters_dict = obj_dict.filters;\n        var filter;\n        for (var i = 0; i < filters_dict.length; i++) {\n            if (filters_dict[i].type === \"number\") {\n                filter = new NumberFilter(filters_dict[i]);\n                this.add_filter(filter);\n                if (filter.name === alpha_filter_name) {\n                    this.alpha_filter = filter;\n                    filter.transparency_icon.addClass(\"active\").show();\n                }\n                if (filter.name === height_filter_name) {\n                    this.height_filter = filter;\n                    filter.height_icon.addClass(\"active\").show();\n                }\n            } else {\n                console.log(\"ERROR: unsupported filter: \", name, type);\n            }\n        }\n\n        if (\"visible\" in obj_dict && obj_dict.visible) {\n            this.parent_div.show();\n        }\n    }\n\n    // Add button to filter complete dataset.\n    if (this.filters.length !== 0) {\n        var run_buttons_row = $(\"<div/>\").addClass(\"param-row\").appendTo(this.parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'/>\").attr(\"value\", \"Run on complete dataset\").appendTo(run_buttons_row);\n        var filter_manager = this;\n        run_on_dataset_button.click(function () {\n            filter_manager.run_on_dataset();\n        });\n    }\n};\n\nextend(FiltersManager.prototype, {\n    // HTML manipulation and inspection.\n    show: function show() {\n        this.parent_div.show();\n    },\n    hide: function hide() {\n        this.parent_div.hide();\n    },\n    toggle: function toggle() {\n        this.parent_div.toggle();\n    },\n    visible: function visible() {\n        return this.parent_div.is(\":visible\");\n    },\n    /**\n     * Returns dictionary for manager.\n     */\n    to_dict: function to_dict() {\n        var obj_dict = {};\n        var filter_dicts = [];\n        var filter;\n\n        // Include individual filter states.\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            filter_dicts.push(filter.to_dict());\n        }\n        obj_dict.filters = filter_dicts;\n\n        // Include transparency, height filters.\n        obj_dict.alpha_filter = this.alpha_filter ? this.alpha_filter.name : null;\n        obj_dict.height_filter = this.height_filter ? this.height_filter.name : null;\n\n        // Include visibility.\n        obj_dict.visible = this.parent_div.is(\":visible\");\n\n        return obj_dict;\n    },\n    /**\n     * Return a copy of the manager.\n     */\n    copy: function copy(new_track) {\n        var copy = new FiltersManager(new_track);\n        for (var i = 0; i < this.filters.length; i++) {\n            copy.add_filter(this.filters[i].copy());\n        }\n        return copy;\n    },\n    /**\n     * Add a filter to the manager.\n     */\n    add_filter: function add_filter(filter) {\n        filter.manager = this;\n        this.parent_div.append(filter.parent_div);\n        this.filters.push(filter);\n    },\n    /**\n     * Remove all filters from manager.\n     */\n    remove_all: function remove_all() {\n        this.filters = [];\n        this.parent_div.children().remove();\n    },\n    /**\n     * Initialize filters.\n     */\n\n    init_filters: function init_filters() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.update_ui_elt();\n        }\n    },\n    /**\n     * Clear filters so that they do not impact track display.\n     */\n    clear_filters: function clear_filters() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.slider.slider(\"option\", \"values\", [filter.min, filter.max]);\n        }\n        this.alpha_filter = null;\n        this.height_filter = null;\n\n        // Hide icons for setting filters.\n        this.parent_div.find(\".icon-button\").hide();\n    },\n    run_on_dataset: function run_on_dataset() {\n        // Get or create dictionary item.\n        var get_or_create_dict_item = function get_or_create_dict_item(dict, key, new_item) {\n            // Add new item to dict if\n            if (!(key in dict)) {\n                dict[key] = new_item;\n            }\n            return dict[key];\n        };\n\n        //\n        // Find and group active filters. Active filters are those being used to hide data.\n        // Filters with the same tool id are grouped.\n        //\n        var active_filters = {};\n\n        var filter;\n        var tool_filter_conditions;\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            if (filter.tool_id) {\n                // Add filtering conditions if filter low/high are set.\n                if (filter.min !== filter.low) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = filter.tool_exp_name + \" >= \" + filter.low;\n                }\n                if (filter.max !== filter.high) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = filter.tool_exp_name + \" <= \" + filter.high;\n                }\n            }\n        }\n\n        //\n        // Use tools to run filters.\n        //\n\n        // Create list of (tool_id, tool_filters) tuples.\n        var active_filters_list = [];\n        for (var tool_id in active_filters) {\n            active_filters_list[active_filters_list.length] = [tool_id, active_filters[tool_id]];\n        }\n\n        // Invoke recursive function to run filters; this enables chaining of filters via\n        // iteratively application.\n        (function run_filter(input_dataset_id, filters) {\n            var // Set up filtering info and params.\n            filter_tuple = filters[0];\n\n            var tool_id = filter_tuple[0];\n            var tool_filters = filter_tuple[1];\n            var tool_filter_str = \"(\" + tool_filters.join(\") and (\") + \")\";\n\n            var url_params = {\n                cond: tool_filter_str,\n                input: input_dataset_id,\n                target_dataset_id: input_dataset_id,\n                tool_id: tool_id\n            };\n\n            // Remove current filter.\n            filters = filters.slice(1);\n\n            $.getJSON(run_tool_url, url_params, function (response) {\n                if (response.error) {\n                    // General error.\n                    Galaxy.modal.show({\n                        title: \"Filter Dataset\",\n                        body: \"Error running tool \" + tool_id,\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else if (filters.length === 0) {\n                    // No more filters to run.\n                    Galaxy.modal.show({\n                        title: \"Filtering Dataset\",\n                        body: \"Filter(s) are running on the complete dataset. Outputs are in dataset's history.\",\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else {\n                    // More filters to run.\n                    run_filter(response.dataset_id, filters);\n                }\n            });\n        })(this.track.dataset_id, active_filters_list);\n    }\n});\n\nexports.default = {\n    FiltersManager: FiltersManager,\n    NumberFilter: NumberFilter\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 32 */,\n/* 33 */,\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _visualization = __webpack_require__(7);\n\nvar _visualization2 = _interopRequireDefault(_visualization);\n\nvar _bigwig = __webpack_require__(35);\n\nvar bigwig = _interopRequireWildcard(_bigwig);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Data manager for BBI datasets/files, including BigWig and BigBed.\n */\nvar BBIDataManager = _visualization2.default.GenomeDataManager.extend({\n    /**\n     * Load data from server and manage data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function load_data(region, mode, resolution, extra_params) {\n        var deferred = $.Deferred();\n        this.set_data(region, deferred);\n\n        var url = Galaxy.root + \"datasets/\" + this.get(\"dataset\").id + \"/display\";\n\n        var self = this;\n        var promise = new $.Deferred();\n        $.when(bigwig.makeBwg(url)).then(function (bb, err) {\n            $.when(bb.readWigData(region.get(\"chrom\"), region.get(\"start\"), region.get(\"end\"))).then(function (data) {\n                // Transform data into \"bigwig\" format for LinePainter. \"bigwig\" format is an array of 2-element arrays\n                // where each element is [position, score]; unlike real bigwig format, no gaps are allowed.\n                var result = [];\n\n                var prev = { max: Number.MIN_VALUE };\n                data.forEach(function (d) {\n                    // If there is a gap between prev and d, fill it with an interval with score 0.\n                    // This is necessary for LinePainter to draw correctly.\n                    if (prev.max !== d.min - 1) {\n                        // +1 to start after previous region.\n                        result.push([prev.max + 1, 0]);\n                        // -2 = -1 for converting from 1-based to 0-based coordinates,\n                        //      -1 for ending before current region.\n                        result.push([d.min - 2, 0]);\n                    }\n\n                    // Add data point for entry start. -1 to convert from wiggle\n                    // 1-based coordinates to 0-based browser coordinates.\n                    result.push([d.min - 1, d.score]);\n\n                    // Add data point for entry end:\n                    result.push([d.max, d.score]);\n\n                    prev = d;\n                });\n\n                var entry = {\n                    data: result,\n                    region: region,\n                    dataset_type: \"bigwig\"\n                };\n\n                self.set_data(region, entry);\n                deferred.resolve(entry);\n            });\n        });\n\n        return deferred;\n    }\n});\n\nexports.default = {\n    BBIDataManager: BBIDataManager\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function($) {var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;//\n// Author: Jeremy Goecks\n//\n// Modified from:\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// bigwig.js: indexed binary WIG (and BED) files\n//\n\n// Requirements:\n//  * jquery and ajax-native plugin for reading binary data, jquery for promises\n//  * spans for working working with genomic intervals\n//  * jszlib for decompression.\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(36), __webpack_require__(37), __webpack_require__(38)], __WEBPACK_AMD_DEFINE_RESULT__ = function(spans, jszlib) {\n    \"use strict\";\n\n    // -- Copied from das.js --\n\n    function DASFeature() {\n    }\n\n    function DASGroup(id) {\n        if (id)\n        this.id = id;\n    }\n\n    // -- End copy --\n\n    // -- Copied from bin.js --\n\n    function readInt(ba, offset) {\n        return (ba[offset + 3] << 24) | (ba[offset + 2] << 16) | (ba[offset + 1] << 8) | (ba[offset]);\n    }\n\n    // -- End copy --\n\n    // Some globals.\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n\n    var BIG_WIG_MAGIC = 0x888FFC26;\n    var BIG_WIG_MAGIC_BE = 0x26FC8F88;\n    var BIG_BED_MAGIC = 0x8789F2EB;\n    var BIG_BED_MAGIC_BE = 0xEBF28987;\n\n\n    var BIG_WIG_TYPE_GRAPH = 1;\n    var BIG_WIG_TYPE_VSTEP = 2;\n    var BIG_WIG_TYPE_FSTEP = 3;\n\n    var M1 = 256;\n    var M2 = 256*256;\n    var M3 = 256*256*256;\n    var M4 = 256*256*256*256;\n\n    var BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\n    /**\n     * Read binary data from a URL using HTTP Range header. Requires jQuery and ajax-native plugin.\n     */\n    function read(url, start, size) {\n        // Taken from bin.js:\n        // This may be necessary for Safari:\n        //   if ((isSafari || this.opts.salt) && url.indexOf('?') < 0) {\n        //       url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + (++seed));\n        //   }\n\n        var chunkSizeLimit = Math.pow(10, 6); // 1 MB\n        if(size > chunkSizeLimit) {\n            // TODO: raise error.\n        }\n\n        // Read data from remote file.\n        return $.ajax({\n            type: 'GET',\n            dataType: 'native',\n            url: url,\n            // Potential timeout on first request to catch mixed-content errors on Chromium.\n            timeout: 5000,\n            beforeSend: function(xhrObj) {\n                // (size - 1) because range is inclusive.\n                xhrObj.setRequestHeader(\"Range\", \"bytes=\" + start + \"-\" + (start + (size - 1)));\n            },\n            xhrFields: {\n                responseType: 'arraybuffer'\n            }\n        });\n    }\n\n    function bwg_readOffset(ba, o) {\n        var offset = ba[o] + ba[o+1]*M1 + ba[o+2]*M2 + ba[o+3]*M3 + ba[o+4]*M4;\n        return offset;\n    }\n\n    function BigWig() {\n    }\n\n    /**\n     * Read the chromosome B+ tree header.\n     */\n    BigWig.prototype.readChromTree = function() {\n        var thisB = this;\n        this.chromsToIDs = {};\n        this.idsToChroms = {};\n        this.maxID = 0;\n\n        var udo = this.unzoomedDataOffset;\n        var eb = (udo - this.chromTreeOffset) & 3;\n        udo = udo + 4 - eb;\n\n        // Read and parse the chrom tree, return the promise so that subsequent actions can be taken.\n        return $.when(read(this.url, this.chromTreeOffset, udo - this.chromTreeOffset)).then(function(bpt) {\n            var ba = new Uint8Array(bpt);\n            var sa = new Int16Array(bpt);\n            var la = new Int32Array(bpt);\n            var bptMagic = la[0];\n            var blockSize = la[1];\n            var keySize = la[2];\n            var valSize = la[3];\n            var itemCount = bwg_readOffset(ba, 16);\n            var rootNodeOffset = 32;\n\n            var bptReadNode = function(offset) {\n                var nodeType = ba[offset];\n                var cnt = sa[(offset/2) + 1];\n                offset += 4;\n                for (var n = 0; n < cnt; ++n) {\n                    if (nodeType === 0) {\n                        offset += keySize;\n                        var childOffset = bwg_readOffset(ba, offset);\n                        offset += 8;\n                        childOffset -= thisB.chromTreeOffset;\n                        bptReadNode(childOffset);\n                    } else {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode !== 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n                        var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n                        var chromSize = (ba[offset + 7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n                        offset += 8;\n\n                        thisB.chromsToIDs[key] = chromId;\n                        if (key.indexOf('chr') === 0) {\n                            thisB.chromsToIDs[key.substr(3)] = chromId;\n                        }\n                        thisB.idsToChroms[chromId] = key;\n                        thisB.maxID = Math.max(thisB.maxID, chromId);\n                    }\n                }\n            };\n            bptReadNode(rootNodeOffset);\n        });\n    }\n\n    function BigWigView(bwg, cirTreeOffset, cirTreeLength, isSummary) {\n        this.bwg = bwg;\n        this.cirTreeOffset = cirTreeOffset;\n        this.cirTreeLength = cirTreeLength;\n        this.isSummary = isSummary;\n    }\n\n\n\n    BigWigView.prototype.readWigData = function(chrName, min, max) {\n        var chr = this.bwg.chromsToIDs[chrName],\n            rval;\n        if (chr === undefined) {\n            // Not an error because some .bwgs won't have data for all chromosomes.\n            rval = [];\n        } else {\n            rval = this.readWigDataById(chr, min, max);\n        }\n\n        return rval;\n    };\n\n    BigWigView.prototype.readWigDataById = function(chr, min, max) {\n        var thisB = this,\n            promise = $.Deferred();\n\n        // Read the R-tree index header and then read data again.\n        if (!this.cirHeader) {\n            $.when(read(thisB.bwg.url, this.cirTreeOffset, 48)).then(function(result) {\n                thisB.cirHeader = result;\n                var la = new Int32Array(thisB.cirHeader);\n                thisB.cirBlockSize = la[1];\n                $.when(thisB.readWigDataById(chr, min, max)).then(function(result) {\n                    promise.resolve(result);\n                });\n            });\n            return promise;\n        }\n\n        var blocksToFetch = [];\n        var outstanding = 0;\n\n        var beforeBWG = Date.now();\n\n        var filter = function(chromId, fmin, fmax, toks) {\n            return ((chr < 0 || chromId == chr) && fmin <= max && fmax >= min);\n        };\n\n        var cirFobRecur = function(offset, level) {\n            if (thisB.bwg.instrument)\n            console.log('level=' + level + '; offset=' + offset + '; time=' + (Date.now()|0));\n\n            outstanding += offset.length;\n\n            if (offset.length == 1 && offset[0] - thisB.cirTreeOffset == 48 && thisB.cachedCirRoot) {\n                cirFobRecur2(thisB.cachedCirRoot, 0, level);\n                --outstanding;\n                if (outstanding === 0) {\n                    $.when(thisB.fetchFeatures(filter, blocksToFetch)).then(function(result) {\n                        promise.resolve(result);\n                    });\n                }\n                return;\n            }\n\n            var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n            var spans;\n            for (var i = 0; i < offset.length; ++i) {\n                var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n                spans = spans ? union(spans, blockSpan) : blockSpan;\n            }\n\n            var fetchRanges = spans.ranges();\n            for (var r = 0; r < fetchRanges.length; ++r) {\n                var fr = fetchRanges[r];\n                cirFobStartFetch(offset, fr, level);\n            }\n        };\n\n        var cirFobStartFetch = function(offset, fr, level, attempts) {\n            var length = fr.max() - fr.min();\n            $.when(read(thisB.bwg.url, fr.min(), fr.max() - fr.min())).then(function(resultBuffer) {\n                for (var i = 0; i < offset.length; ++i) {\n                    if (fr.contains(offset[i])) {\n                        cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n\n                        if (offset[i] - thisB.cirTreeOffset == 48 && offset[i] - fr.min() === 0)\n                            thisB.cachedCirRoot = resultBuffer;\n\n                        --outstanding;\n                        if (outstanding === 0) {\n                            $.when(thisB.fetchFeatures(filter, blocksToFetch)).then(function(result) {\n                                promise.resolve(result);\n                            });\n                        }\n                    }\n                }\n            });\n        };\n\n        var cirFobRecur2 = function(cirBlockData, offset, level) {\n            var ba = new Uint8Array(cirBlockData);\n            var sa = new Int16Array(cirBlockData);\n            var la = new Int32Array(cirBlockData);\n\n            var isLeaf = ba[offset];\n            var cnt = sa[offset/2 + 1];\n            offset += 4;\n\n            if (isLeaf !== 0) {\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    var blockSize = bwg_readOffset(ba, offset+24);\n                    if (((chr < 0 || startChrom < chr) || (startChrom == chr && startBase <= max)) &&\n                    ((chr < 0 || endChrom   > chr) || (endChrom == chr && endBase >= min)))\n                    {\n                        blocksToFetch.push({offset: blockOffset, size: blockSize});\n                    }\n                    offset += 32;\n                }\n            } else {\n                var recurOffsets = [];\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    if ((chr < 0 || startChrom < chr || (startChrom == chr && startBase <= max)) &&\n                    (chr < 0 || endChrom   > chr || (endChrom == chr && endBase >= min)))\n                    {\n                        recurOffsets.push(blockOffset);\n                    }\n                    offset += 24;\n                }\n                if (recurOffsets.length > 0) {\n                    cirFobRecur(recurOffsets, level + 1);\n                }\n            }\n        };\n\n        cirFobRecur([thisB.cirTreeOffset + 48], 1);\n        return promise;\n    };\n\n    /**\n     * Fetch data for a set of blocks. Returns a promise that resolves to fetched data.\n     */\n    BigWigView.prototype.fetchFeatures = function(filter, blocksToFetch) {\n        var thisB = this,\n            promise = $.Deferred();\n\n        blocksToFetch.sort(function(b0, b1) {\n            return (b0.offset|0) - (b1.offset|0);\n        });\n\n        if (blocksToFetch.length === 0) {\n            return [];\n        } else {\n            var features = [];\n            var createFeature = function(chr, fmin, fmax, opts) {\n                if (!opts) {\n                    opts = {};\n                }\n\n                var f = new DASFeature();\n                f._chromId = chr;\n                f.segment = thisB.bwg.idsToChroms[chr];\n                f.min = fmin;\n                f.max = fmax;\n                f.type = thisB.bwg.type;\n\n                for (var k in opts) {\n                    f[k] = opts[k];\n                }\n\n                features.push(f);\n            };\n\n            // Recursive function to read blocks of data.\n            var tramp = function() {\n                if (blocksToFetch.length === 0) {\n                    var afterBWG = Date.now();\n                    // dlog('BWG fetch took ' + (afterBWG - beforeBWG) + 'ms');\n                    return promise.resolve(features);\n                }\n                else {\n                    var block = blocksToFetch[0];\n                    if (block.data) {\n                        thisB.parseFeatures(block.data, createFeature, filter);\n                        blocksToFetch.splice(0, 1);\n                        tramp();\n                    }\n                    else {\n                        var fetchStart = block.offset;\n                        var fetchSize = block.size;\n                        var bi = 1;\n                        while (bi < blocksToFetch.length && blocksToFetch[bi].offset == (fetchStart + fetchSize)) {\n                            fetchSize += blocksToFetch[bi].size;\n                            ++bi;\n                        }\n\n                        $.when(read(thisB.bwg.url, fetchStart, fetchSize)).then(function(result) {\n                            var offset = 0;\n                            var bi = 0;\n                            while (offset < fetchSize) {\n                                var fb = blocksToFetch[bi];\n\n                                var data;\n                                if (thisB.bwg.uncompressBufSize > 0) {\n                                    data = jszlib_inflate_buffer(result, offset + 2, fb.size - 2);\n                                } else {\n                                    var tmp = new Uint8Array(fb.size);    // FIXME is this really the best we can do?\n                                    arrayCopy(new Uint8Array(result, offset, fb.size), 0, tmp, 0, fb.size);\n                                    data = tmp.buffer;\n                                }\n                                fb.data = data;\n\n                                offset += fb.size;\n                                ++bi;\n                            }\n                            tramp();\n                        });\n                    }\n                }\n            };\n            tramp();\n        }\n\n        return promise;\n    };\n\n    BigWigView.prototype.parseFeatures = function(data, createFeature, filter) {\n        var ba = new Uint8Array(data);\n\n        if (this.isSummary) {\n            var sa = new Int16Array(data);\n            var la = new Int32Array(data);\n            var fa = new Float32Array(data);\n\n            var itemCount = data.byteLength/32;\n            for (var i = 0; i < itemCount; ++i) {\n                var chromId =   la[(i*8)];\n                var start =     la[(i*8)+1];\n                var end =       la[(i*8)+2];\n                var validCnt =  la[(i*8)+3];\n                var minVal    = fa[(i*8)+4];\n                var maxVal    = fa[(i*8)+5];\n                var sumData   = fa[(i*8)+6];\n                var sumSqData = fa[(i*8)+7];\n\n                if (filter(chromId, start + 1, end)) {\n                    var summaryOpts = {type: 'bigwig', score: sumData/validCnt, maxScore: maxVal};\n                    if (this.bwg.type == 'bigbed') {\n                        summaryOpts.type = 'density';\n                    }\n                    createFeature(chromId, start + 1, end, summaryOpts);\n                }\n            }\n        }\n        else if (this.bwg.type == 'bigwig') {\n            var sa = new Int16Array(data);\n            var la = new Int32Array(data);\n            var fa = new Float32Array(data);\n\n            var chromId = la[0];\n            var blockStart = la[1];\n            var blockEnd = la[2];\n            var itemStep = la[3];\n            var itemSpan = la[4];\n            var blockType = ba[20];\n            var itemCount = sa[11];\n\n            if (blockType == BIG_WIG_TYPE_FSTEP) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var score = fa[i + 6];\n                    var fmin = blockStart + (i*itemStep) + 1, fmax = blockStart + (i*itemStep) + itemSpan;\n                    if (filter(chromId, fmin, fmax))\n                    createFeature(chromId, fmin, fmax, {score: score});\n                }\n            } else if (blockType == BIG_WIG_TYPE_VSTEP) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var start = la[(i*2) + 6] + 1;\n                    var end = start + itemSpan - 1;\n                    var score = fa[(i*2) + 7];\n                    if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n                }\n            } else if (blockType == BIG_WIG_TYPE_GRAPH) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var start = la[(i*3) + 6] + 1;\n                    var end   = la[(i*3) + 7];\n                    var score = fa[(i*3) + 8];\n                    if (start > end) {\n                        start = end;\n                    }\n                    if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n                }\n            } else {\n                console.log('Currently not handling bwgType=' + blockType);\n            }\n        } else if (this.bwg.type == 'bigbed') {\n            var offset = 0;\n            var dfc = this.bwg.definedFieldCount;\n            var schema = this.bwg.schema;\n\n            while (offset < ba.length) {\n                var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n                var start = (ba[offset+7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n                var end = (ba[offset+11]<<24) | (ba[offset+10]<<16) | (ba[offset+9]<<8) | (ba[offset+8]);\n                offset += 12;\n                var rest = '';\n                while (true) {\n                    var ch = ba[offset++];\n                    if (ch != 0) {\n                        rest += String.fromCharCode(ch);\n                    } else {\n                        break;\n                    }\n                }\n\n                var featureOpts = {};\n\n                var bedColumns;\n                if (rest.length > 0) {\n                    bedColumns = rest.split('\\t');\n                } else {\n                    bedColumns = [];\n                }\n                if (bedColumns.length > 0 && dfc > 3) {\n                    featureOpts.label = bedColumns[0];\n                }\n                if (bedColumns.length > 1 && dfc > 4) {\n                    var score = parseInt(bedColumns[1]);\n                    if (!isNaN(score))\n                    featureOpts.score = score;\n                }\n                if (bedColumns.length > 2 && dfc > 5) {\n                    featureOpts.orientation = bedColumns[2];\n                }\n                if (bedColumns.length > 5 && dfc > 8) {\n                    var color = bedColumns[5];\n                    if (BED_COLOR_REGEXP.test(color)) {\n                        featureOpts.itemRgb = 'rgb(' + color + ')';\n                    }\n                }\n\n                if (bedColumns.length > dfc-3 && schema) {\n                    for (var col = dfc - 3; col < bedColumns.length; ++col) {\n                        featureOpts[schema.fields[col+3].name] = bedColumns[col];\n                    }\n                }\n\n                if (filter(chromId, start + 1, end, bedColumns)) {\n                    if (dfc < 12) {\n                        createFeature(chromId, start + 1, end, featureOpts);\n                    } else {\n                        // TODO: add block starts, sizes, thick start, thick end to feature.\n                        var thickStart = bedColumns[3]|0;\n                        var thickEnd   = bedColumns[4]|0;\n                        var blockCount = bedColumns[6]|0;\n                        var blockSizes = bedColumns[7].split(',');\n                        var blockStarts = bedColumns[8].split(',');\n\n                        if (featureOpts.exonFrames) {\n                            var exonFrames = featureOpts.exonFrames.split(',');\n                            featureOpts.exonFrames = undefined;\n                        }\n\n                        featureOpts.type = 'transcript'\n                        var grp = new DASGroup();\n                        for (var k in featureOpts) {\n                            grp[k] = featureOpts[k];\n                        }\n                        grp.id = bedColumns[0];\n                        grp.segment = this.bwg.idsToChroms[chromId];\n                        grp.min = start + 1;\n                        grp.max = end;\n                        grp.notes = [];\n                        featureOpts.groups = [grp];\n\n                        // Moving towards using bigGenePred model, but will\n                        // still support old Dalliance-style BED12+gene-name for the\n                        // foreseeable future.\n                        if (bedColumns.length > 9) {\n                            var geneId = featureOpts.geneName || bedColumns[9];\n                            var geneName = geneId;\n                            if (bedColumns.length > 10) {\n                                geneName = bedColumns[10];\n                            }\n                            if (featureOpts.geneName2)\n                            geneName = featureOpts.geneName2;\n\n                            var gg = $.extend({}, grp);\n                            gg.id = geneId;\n                            gg.label = geneName;\n                            gg.type = 'gene';\n                            featureOpts.groups.push(gg);\n                        }\n\n                        var spanList = [];\n                        for (var b = 0; b < blockCount; ++b) {\n                            var bmin = (blockStarts[b]|0) + start;\n                            var bmax = bmin + (blockSizes[b]|0);\n                            var span = new Range(bmin, bmax);\n                            spanList.push(span);\n                        }\n                        var spans = union(spanList);\n\n                        var tsList = spans.ranges();\n                        for (var s = 0; s < tsList.length; ++s) {\n                            var ts = tsList[s];\n                            createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                        }\n\n                        if (thickEnd > thickStart) {\n                            var codingRegion = (featureOpts.orientation == '+') ?\n                            new Range(thickStart, thickEnd + 3) :\n                            new Range(thickStart - 3, thickEnd);\n                            // +/- 3 to account for stop codon\n\n                            var tl = intersection(spans, codingRegion);\n                            if (tl) {\n                                featureOpts.type = 'translation';\n                                var tlList = tl.ranges();\n                                var readingFrame = 0;\n\n                                var tlOffset = 0;\n                                while (tlList[0].min() > tsList[tlOffset].max())\n                                tlOffset++;\n\n                                for (var s = 0; s < tlList.length; ++s) {\n                                    // Record reading frame for every exon\n                                    var index = s;\n                                    if (featureOpts.orientation == '-')\n                                    index = tlList.length - s - 1;\n                                    var ts = tlList[index];\n                                    featureOpts.readframe = readingFrame;\n                                    if (exonFrames) {\n                                        var brf = parseInt(exonFrames[index + tlOffset]);\n                                        if (typeof(brf) === 'number' && brf >= 0 && brf <= 2) {\n                                            featureOpts.readframe = brf;\n                                            featureOpts.readframeExplicit = true;\n                                        }\n                                    }\n                                    var length = ts.max() - ts.min();\n                                    readingFrame = (readingFrame + length) % 3;\n                                    createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        } else {\n            throw Error(\"Don't know what to do with \" + this.bwg.type);\n        }\n    }\n\n    //\n    // nasty cut/paste, should roll back in!\n    //\n\n    BigWigView.prototype.getFirstAdjacent = function(chrName, pos, dir, callback) {\n        var chr = this.bwg.chromsToIDs[chrName];\n        if (chr === undefined) {\n            // Not an error because some .bwgs won't have data for all chromosomes.\n            return callback([]);\n        } else {\n            this.getFirstAdjacentById(chr, pos, dir, callback);\n        }\n    }\n\n    BigWigView.prototype.getFirstAdjacentById = function(chr, pos, dir, callback) {\n        var thisB = this;\n        if (!this.cirHeader) {\n            this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function(result) {\n                thisB.cirHeader = result;\n                var la = new Int32Array(thisB.cirHeader);\n                thisB.cirBlockSize = la[1];\n                thisB.getFirstAdjacentById(chr, pos, dir, callback);\n            });\n            return;\n        }\n\n        var blockToFetch = null;\n        var bestBlockChr = -1;\n        var bestBlockOffset = -1;\n\n        var outstanding = 0;\n\n        var beforeBWG = Date.now();\n\n        var cirFobRecur = function(offset, level) {\n            outstanding += offset.length;\n\n            var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n            var spans;\n            for (var i = 0; i < offset.length; ++i) {\n                var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n                spans = spans ? union(spans, blockSpan) : blockSpan;\n            }\n\n            var fetchRanges = spans.ranges();\n            for (var r = 0; r < fetchRanges.length; ++r) {\n                var fr = fetchRanges[r];\n                cirFobStartFetch(offset, fr, level);\n            }\n        }\n\n        var cirFobStartFetch = function(offset, fr, level, attempts) {\n            var length = fr.max() - fr.min();\n            thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function(resultBuffer) {\n                for (var i = 0; i < offset.length; ++i) {\n                    if (fr.contains(offset[i])) {\n                        cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n                        --outstanding;\n                        if (outstanding == 0) {\n                            if (!blockToFetch) {\n                                if (dir > 0 && (chr != 0 || pos > 0)) {\n                                    return thisB.getFirstAdjacentById(0, 0, dir, callback);\n                                } else if (dir < 0 && (chr != thisB.bwg.maxID || pos < 1000000000)) {\n                                    return thisB.getFirstAdjacentById(thisB.bwg.maxID, 1000000000, dir, callback);\n                                }\n                                return callback([]);\n                            }\n\n                            thisB.fetchFeatures(function(chrx, fmin, fmax, toks) {\n                                return (dir < 0 && (chrx < chr || fmax < pos)) || (dir > 0 && (chrx > chr || fmin > pos));\n                            }, [blockToFetch], function(features) {\n                                var bestFeature = null;\n                                var bestChr = -1;\n                                var bestPos = -1;\n                                for (var fi = 0; fi < features.length; ++fi) {\n                                    var f = features[fi];\n                                    var chrx = f._chromId, fmin = f.min, fmax = f.max;\n                                    if (bestFeature == null || ((dir < 0) && (chrx > bestChr || fmax > bestPos)) || ((dir > 0) && (chrx < bestChr || fmin < bestPos))) {\n                                        bestFeature = f;\n                                        bestPos = (dir < 0) ? fmax : fmin;\n                                        bestChr = chrx;\n                                    }\n                                }\n\n                                if (bestFeature != null)\n                                return callback([bestFeature]);\n                                else\n                                return callback([]);\n                            });\n                        }\n                    }\n                }\n            });\n        }\n\n        var cirFobRecur2 = function(cirBlockData, offset, level) {\n            var ba = new Uint8Array(cirBlockData);\n            var sa = new Int16Array(cirBlockData);\n            var la = new Int32Array(cirBlockData);\n\n            var isLeaf = ba[offset];\n            var cnt = sa[offset/2 + 1];\n            offset += 4;\n\n            if (isLeaf != 0) {\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    var blockSize = bwg_readOffset(ba, offset+24);\n                    if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)))) ||\n                    (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)))))\n                    {\n                        // console.log('Got an interesting block: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                        if (/_random/.exec(thisB.bwg.idsToChroms[startChrom])) {\n                            // dlog('skipping random: ' + thisB.bwg.idsToChroms[startChrom]);\n                        } else if (blockToFetch == null || ((dir < 0) && (endChrom > bestBlockChr || (endChrom == bestBlockChr && endBase > bestBlockOffset)) ||\n                        (dir > 0) && (startChrom < bestBlockChr || (startChrom == bestBlockChr && startBase < bestBlockOffset))))\n                        {\n                            //                        dlog('best is: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                            blockToFetch = {offset: blockOffset, size: blockSize};\n                            bestBlockOffset = (dir < 0) ? endBase : startBase;\n                            bestBlockChr = (dir < 0) ? endChrom : startChrom;\n                        }\n                    }\n                    offset += 32;\n                }\n            } else {\n                var bestRecur = -1;\n                var bestPos = -1;\n                var bestChr = -1;\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = (la[lo + 4]<<32) | (la[lo + 5]);\n                    if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)) &&\n                    (endChrom   >= chr))) ||\n                    (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)) &&\n                    (startChrom <= chr))))\n                    {\n                        if (bestRecur < 0 || endBase > bestPos) {\n                            bestRecur = blockOffset;\n                            bestPos = (dir < 0) ? endBase : startBase;\n                            bestChr = (dir < 0) ? endChrom : startChrom;\n                        }\n                    }\n                    offset += 24;\n                }\n                if (bestRecur >= 0) {\n                    cirFobRecur([bestRecur], level + 1);\n                }\n            }\n        };\n\n\n        cirFobRecur([thisB.cirTreeOffset + 48], 1);\n    }\n\n    /**\n    * Automatically choose a zoom level and return data from that level.\n    */\n    BigWig.prototype.readWigData = function(chrName, min, max) {\n        // Maximum number of data points to return when reading a bigwig. This is used\n        // to choose the appropriate level. One data point ~= 25-65 bytes.\n        // FIXME: For targeted sequencing, data points returned is going to be much lower,\n        // so this will need to be tuned appropriately.\n        var MAX_DATA_POINTS = 25000;\n\n        var range = max - min,\n        view;\n        // If no zooming needed or available (common in bigbed), use unzoomed view.\n        if (range <= MAX_DATA_POINTS || this.zoomLevels.length === 0) {\n            view = this.getUnzoomedView();\n        }\n        else {\n            // Find reasonable zoom level. Reduction is the # of bases represented\n            // by each data point at that level.\n            for (var i = 0; i < this.zoomLevels.length; i++) {\n                if (range/this.zoomLevels[i].reduction < MAX_DATA_POINTS) {\n                    view = this.getZoomedView(i);\n                    break;\n                }\n            }\n        }\n\n        return view.readWigData(chrName, min, max);\n    }\n\n    BigWig.prototype.getUnzoomedView = function() {\n        if (!this.unzoomedView) {\n            var cirLen = 4000;\n            var nzl = this.zoomLevels[0];\n            if (nzl) {\n                cirLen = this.zoomLevels[0].dataOffset - this.unzoomedIndexOffset;\n            }\n            this.unzoomedView = new BigWigView(this, this.unzoomedIndexOffset, cirLen, false);\n        }\n        return this.unzoomedView;\n    }\n\n    BigWig.prototype.getZoomedView = function(z) {\n        var zh = this.zoomLevels[z];\n        if (!zh.view) {\n            zh.view = new BigWigView(this, zh.indexOffset, /* this.zoomLevels[z + 1].dataOffset - zh.indexOffset */ 4000, true);\n        }\n        return zh.view;\n    }\n\n    /**\n     * Create a BigWig object using a URL to a bigwig/bigbed file. Returns a promise\n     * that resolves to the object when it's available.\n     */\n    function makeBwg(url) {\n        var promise = $.Deferred(),\n        bwg = new BigWig();\n        bwg.url = url;\n\n        // Read and parse bigwig header, including chrom tree.\n        $.when(read(bwg.url, 0, 512)).then(function(result) {\n            if (!result) {\n                return promise.resolve(null, \"Couldn't fetch file\");\n            }\n\n            var header = result;\n            var ba = new Uint8Array(header);\n            var sa = new Int16Array(header);\n            var la = new Int32Array(header);\n            var magic = ba[0] + (M1 * ba[1]) + (M2 * ba[2]) + (M3 * ba[3]);\n            if (magic == BIG_WIG_MAGIC) {\n                bwg.type = 'bigwig';\n            } else if (magic == BIG_BED_MAGIC) {\n                bwg.type = 'bigbed';\n            } else if (magic == BIG_WIG_MAGIC_BE || magic == BIG_BED_MAGIC_BE) {\n                return promise.resolve(null, \"Currently don't support big-endian BBI files\");\n\n            } else {\n                return promise.resolve(null, \"Not a supported format, magic=0x\" + magic.toString(16));\n\n            }\n\n            bwg.version = sa[2];             // 4\n            bwg.numZoomLevels = sa[3];       // 6\n            bwg.chromTreeOffset = bwg_readOffset(ba, 8);\n            bwg.unzoomedDataOffset = bwg_readOffset(ba, 16);\n            bwg.unzoomedIndexOffset = bwg_readOffset(ba, 24);\n            bwg.fieldCount = sa[16];         // 32\n            bwg.definedFieldCount = sa[17];  // 34\n            bwg.asOffset = bwg_readOffset(ba, 36);\n            bwg.totalSummaryOffset = bwg_readOffset(ba, 44);\n            bwg.uncompressBufSize = la[13];  // 52\n            bwg.extHeaderOffset = bwg_readOffset(ba, 56);\n\n            bwg.zoomLevels = [];\n            for (var zl = 0; zl < bwg.numZoomLevels; ++zl) {\n                var zlReduction = la[zl*6 + 16]\n                var zlData = bwg_readOffset(ba, zl*24 + 72);\n                var zlIndex = bwg_readOffset(ba, zl*24 + 80);\n                bwg.zoomLevels.push({reduction: zlReduction, dataOffset: zlData, indexOffset: zlIndex});\n            }\n\n            $.when(bwg.readChromTree()).then(function() {\n                bwg.getAutoSQL(function(as) {\n                    bwg.schema = as;\n                    return promise.resolve(bwg);\n                });\n            });\n        });\n\n        return promise;\n    }\n\n\n    BigWig.prototype._tsFetch = function(zoom, chr, min, max, callback) {\n        var bwg = this;\n        if (zoom >= this.zoomLevels.length - 1) {\n            if (!this.topLevelReductionCache) {\n                this.getZoomedView(this.zoomLevels.length - 1).readWigDataById(-1, 0, 300000000, function(feats) {\n                    bwg.topLevelReductionCache = feats;\n                    return bwg._tsFetch(zoom, chr, min, max, callback);\n                });\n            } else {\n                var f = [];\n                var c = this.topLevelReductionCache;\n                for (var fi = 0; fi < c.length; ++fi) {\n                    if (c[fi]._chromId == chr) {\n                        f.push(c[fi]);\n                    }\n                }\n                return callback(f);\n            }\n        } else {\n            var view;\n            if (zoom < 0) {\n                view = this.getUnzoomedView();\n            } else {\n                view = this.getZoomedView(zoom);\n            }\n            return view.readWigDataById(chr, min, max, callback);\n        }\n    }\n\n    BigWig.prototype.thresholdSearch = function(chrName, referencePoint, dir, threshold, callback) {\n        dir = (dir<0) ? -1 : 1;\n        var bwg = this;\n        var initialChr = this.chromsToIDs[chrName];\n        var candidates = [{chrOrd: 0, chr: initialChr, zoom: bwg.zoomLevels.length - 4, min: 0, max: 300000000, fromRef: true}]\n        for (var i = 1; i <= this.maxID + 1; ++i) {\n            var chrId = (initialChr + (dir*i)) % (this.maxID + 1);\n            if (chrId < 0)\n            chrId += (this.maxID + 1);\n            candidates.push({chrOrd: i, chr: chrId, zoom: bwg.zoomLevels.length - 1, min: 0, max: 300000000})\n        }\n\n        function fbThresholdSearchRecur() {\n            if (candidates.length == 0) {\n                return callback(null);\n            }\n            candidates.sort(function(c1, c2) {\n                var d = c1.zoom - c2.zoom;\n                if (d != 0)\n                return d;\n\n                d = c1.chrOrd - c2.chrOrd;\n                if (d != 0)\n                return d;\n                else\n                return c1.min - c2.min * dir;\n            });\n\n            var candidate = candidates.splice(0, 1)[0];\n            bwg._tsFetch(candidate.zoom, candidate.chr, candidate.min, candidate.max, function(feats) {\n                var rp = dir > 0 ? 0 : 300000000;\n                if (candidate.fromRef)\n                rp = referencePoint;\n\n                for (var fi = 0; fi < feats.length; ++fi) {\n                    var f = feats[fi];\n                    var score;\n                    if (f.maxScore != undefined)\n                    score = f.maxScore;\n                    else\n                    score = f.score;\n\n                    if (dir > 0) {\n                        if (score > threshold) {\n                            if (candidate.zoom < 0) {\n                                if (f.min > rp)\n                                return callback(f);\n                            } else if (f.max > rp) {\n                                candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n                            }\n                        }\n                    } else {\n                        if (score > threshold) {\n                            if (candidate.zoom < 0) {\n                                if (f.max < rp)\n                                return callback(f);\n                            } else if (f.min < rp) {\n                                candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n                            }\n                        }\n                    }\n                }\n                fbThresholdSearchRecur();\n            });\n        }\n\n        fbThresholdSearchRecur();\n    }\n\n    BigWig.prototype.getAutoSQL = function(callback) {\n        var thisB = this;\n        if (!this.asOffset)\n        return callback(null);\n\n        $.when(read(this.url, this.asOffset, 2048)).then(function(result) {\n            var ba = new Uint8Array(result);\n            var s = '';\n            for (var i = 0; i < ba.length; ++i) {\n                if (ba[i] == 0)\n                break;\n                s += String.fromCharCode(ba[i]);\n            }\n\n            /*\n            * Quick'n'dirty attempt to parse autoSql format.\n            * See: http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/059/5949/5949l2.html\n            */\n\n            var header_re = /(\\w+)\\s+(\\w+)\\s+(\"([^\"]+)\")?\\s+\\(\\s*/;\n                var field_re = /([\\w\\[\\]]+)\\s+(\\w+)\\s*;\\s*(\"([^\"]+)\")?\\s*/g;\n\n            var headerMatch = header_re.exec(s);\n            if (headerMatch) {\n                var as = {\n                    declType: headerMatch[1],\n                    name: headerMatch[2],\n                    comment: headerMatch[4],\n\n                    fields: []\n                };\n\n                s = s.substring(headerMatch[0]);\n                for (var m = field_re.exec(s); m != null; m = field_re.exec(s)) {\n                    as.fields.push({type: m[1],\n                        name: m[2],\n                        comment: m[4]});\n                    }\n\n                    return callback(as);\n                }\n        });\n    };\n\n    BigWig.prototype.getExtraIndices = function(callback) {\n        var thisB = this;\n        if (this.version < 4 || this.extHeaderOffset == 0 || this.type != 'bigbed') {\n            return callback(null);\n        } else {\n            this.data.slice(this.extHeaderOffset, 64).fetch(function(result) {\n                if (!result) {\n                    return callback(null, \"Couldn't fetch extension header\");\n                }\n\n                var ba = new Uint8Array(result);\n                var sa = new Int16Array(result);\n                var la = new Int32Array(result);\n\n                var extHeaderSize = sa[0];\n                var extraIndexCount = sa[1];\n                var extraIndexListOffset = bwg_readOffset(ba, 4);\n\n                if (extraIndexCount == 0) {\n                    return callback(null);\n                }\n\n                // FIXME 20byte records only make sense for single-field indices.\n                // Right now, these seem to be the only things around, but the format\n                // is actually more general.\n                thisB.data.slice(extraIndexListOffset, extraIndexCount * 20).fetch(function(eil) {\n                    if (!eil) {\n                        return callback(null, \"Couldn't fetch index info\");\n                    }\n\n                    var ba = new Uint8Array(eil);\n                    var sa = new Int16Array(eil);\n                    var la = new Int32Array(eil);\n\n                    var indices = [];\n                    for (var ii = 0; ii < extraIndexCount; ++ii) {\n                        var eiType = sa[ii*10];\n                        var eiFieldCount = sa[ii*10 + 1];\n                        var eiOffset = bwg_readOffset(ba, ii*20 + 4);\n                        var eiField = sa[ii*10 + 8]\n                        var index = new BBIExtraIndex(thisB, eiType, eiFieldCount, eiOffset, eiField);\n                        indices.push(index);\n                    }\n                    callback(indices);\n                });\n            });\n        }\n    }\n\n    function BBIExtraIndex(bbi, type, fieldCount, offset, field) {\n        this.bbi = bbi;\n        this.type = type;\n        this.fieldCount = fieldCount;\n        this.offset = offset;\n        this.field = field;\n    }\n\n    BBIExtraIndex.prototype.lookup = function(name, callback) {\n        var thisB = this;\n\n        this.bbi.data.slice(this.offset, 32).fetch(function(bpt) {\n            var ba = new Uint8Array(bpt);\n            var sa = new Int16Array(bpt);\n            var la = new Int32Array(bpt);\n            var bptMagic = la[0];\n            var blockSize = la[1];\n            var keySize = la[2];\n            var valSize = la[3];\n            var itemCount = bwg_readOffset(ba, 16);\n            var rootNodeOffset = 32;\n\n            function bptReadNode(nodeOffset) {\n                thisB.bbi.data.slice(nodeOffset, 4 + (blockSize * (keySize + valSize))).fetch(function(node) {\n                    var ba = new Uint8Array(node);\n                    var sa = new Uint16Array(node);\n                    var la = new Uint32Array(node);\n\n                    var nodeType = ba[0];\n                    var cnt = sa[1];\n\n                    var offset = 4;\n                    if (nodeType == 0) {\n                        var lastChildOffset = null;\n                        for (var n = 0; n < cnt; ++n) {\n                            var key = '';\n                            for (var ki = 0; ki < keySize; ++ki) {\n                                var charCode = ba[offset++];\n                                if (charCode != 0) {\n                                    key += String.fromCharCode(charCode);\n                                }\n                            }\n\n                            var childOffset = bwg_readOffset(ba, offset);\n                            offset += 8;\n\n                            if (name.localeCompare(key) < 0 && lastChildOffset) {\n                                bptReadNode(lastChildOffset);\n                                return;\n                            }\n                            lastChildOffset = childOffset;\n                        }\n                        bptReadNode(lastChildOffset);\n                    } else {\n                        for (var n = 0; n < cnt; ++n) {\n                            var key = '';\n                            for (var ki = 0; ki < keySize; ++ki) {\n                                var charCode = ba[offset++];\n                                if (charCode != 0) {\n                                    key += String.fromCharCode(charCode);\n                                }\n                            }\n\n                            // Specific for EI case.\n                            if (key == name) {\n                                var start = bwg_readOffset(ba, offset);\n                                var length = readInt(ba, offset + 8);\n\n                                return thisB.bbi.getUnzoomedView().fetchFeatures(\n                                    function(chr, min, max, toks) {\n                                        if (toks && toks.length > thisB.field - 3)\n                                        return toks[thisB.field - 3] == name;\n                                    },\n                                    [{offset: start, size: length}],\n                                    callback);\n                                }\n                                offset += valSize;\n                            }\n                            return callback([]);\n                        }\n                    });\n                }\n\n                bptReadNode(thisB.offset + rootNodeOffset);\n        });\n    }\n\n    return {\n        makeBwg: makeBwg\n    };\n}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// spans.js: JavaScript Intset/Location port.\n//\n\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\n\"use strict\";\n\n\nfunction Range(min, max)\n{\n    if (typeof(min) != 'number' || typeof(max) != 'number')\n        throw 'Bad range ' + min + ',' + max;\n    this._min = min;\n    this._max = max;\n}\n\nRange.prototype.min = function() {\n    return this._min;\n}\n\nRange.prototype.max = function() {\n    return this._max;\n}\n\nRange.prototype.contains = function(pos) {\n    return pos >= this._min && pos <= this._max;\n}\n\nRange.prototype.isContiguous = function() {\n    return true;\n}\n\nRange.prototype.ranges = function() {\n    return [this];\n}\n\nRange.prototype._pushRanges = function(ranges) {\n    ranges.push(this);\n}\n\nRange.prototype.toString = function() {\n    return '[' + this._min + '-' + this._max + ']';\n}\n\nfunction _Compound(ranges) {\n    // given: a set of unsorted possibly overlapping ranges\n    // sort the input ranges\n    var sorted = ranges.sort(_rangeOrder);\n    // merge overlaps between adjacent ranges\n    var merged = [];\n    var current = sorted.shift();\n    sorted.forEach(function(range) {\n        if (range._min <= current._max) {\n            if (range._max > current._max) {\n                current._max = range._max;\n            }\n        }\n        else {\n            merged.push(current);\n            current = range;\n        }\n    });\n    merged.push(current);\n    this._ranges = merged;\n}\n\n_Compound.prototype.min = function() {\n    return this._ranges[0].min();\n}\n\n_Compound.prototype.max = function() {\n    return this._ranges[this._ranges.length - 1].max();\n}\n\n// returns the index of the first range that is not less than pos\n_Compound.prototype.lower_bound = function(pos) {\n    // first check if pos is out of range\n    var r = this.ranges();\n    if (pos > this.max()) return r.length;\n    if (pos < this.min()) return 0;\n    // do a binary search\n    var a=0, b=r.length - 1;\n    while (a <= b) {\n        var m = Math.floor((a+b)/2);\n        if (pos > r[m]._max) {\n            a = m+1;\n        }\n        else if (pos < r[m]._min) {\n            b = m-1;\n        }\n        else {\n            return m;\n        }\n    }\n    return a;\n}\n\n_Compound.prototype.contains = function(pos) {\n    var lb = this.lower_bound(pos);\n    if (lb < this._ranges.length && this._ranges[lb].contains(pos)) {\n        return true;\n    }\n    return false;\n}\n\n_Compound.prototype.insertRange = function(range) {\n    var lb = this.lower_bound(range._min);\n    if (lb === this._ranges.length) { // range follows this\n        this._ranges.push(range);\n        return;\n    }\n\n    var r = this.ranges();\n    if (range._max < r[lb]._min) { // range preceeds lb\n        this._ranges.splice(lb,0,range);\n        return;\n    }\n\n    // range overlaps lb (at least)\n    if (r[lb]._min < range._min) range._min = r[lb]._min;\n    var ub = lb+1;\n    while (ub < r.length && r[ub]._min <= range._max) {\n        ub++;\n    }\n    ub--;\n    // ub is the upper bound of the new range\n    if (r[ub]._max > range._max) range._max = r[ub]._max;\n\n    // splice range into this._ranges\n    this._ranges.splice(lb,ub-lb+1,range);\n    return;\n}\n\n_Compound.prototype.isContiguous = function() {\n    return this._ranges.length > 1;\n}\n\n_Compound.prototype.ranges = function() {\n    return this._ranges;\n}\n\n_Compound.prototype._pushRanges = function(ranges) {\n    for (var ri = 0; ri < this._ranges.length; ++ri)\n        ranges.push(this._ranges[ri]);\n}\n\n_Compound.prototype.toString = function() {\n    var s = '';\n    for (var r = 0; r < this._ranges.length; ++r) {\n        if (r>0) {\n            s = s + ',';\n        }\n        s = s + this._ranges[r].toString();\n    }\n    return s;\n}\n\nfunction union(s0, s1) {\n    if (! (s0 instanceof _Compound)) {\n        if (! (s0 instanceof Array))\n            s0 = [s0];\n        s0 = new _Compound(s0);\n    }\n\n    if (s1)\n        s0.insertRange(s1);\n\n    return s0;\n}\n\nfunction intersection(s0, s1) {\n    var r0 = s0.ranges();\n    var r1 = s1.ranges();\n    var l0 = r0.length, l1 = r1.length;\n    var i0 = 0, i1 = 0;\n    var or = [];\n\n    while (i0 < l0 && i1 < l1) {\n        var s0 = r0[i0], s1 = r1[i1];\n        var lapMin = Math.max(s0.min(), s1.min());\n        var lapMax = Math.min(s0.max(), s1.max());\n        if (lapMax >= lapMin) {\n            or.push(new Range(lapMin, lapMax));\n        }\n        if (s0.max() > s1.max()) {\n            ++i1;\n        } else {\n            ++i0;\n        }\n    }\n\n    if (or.length == 0) {\n        return null; // FIXME\n    } else if (or.length == 1) {\n        return or[0];\n    } else {\n        return new _Compound(or);\n    }\n}\n\nfunction coverage(s) {\n    var tot = 0;\n    var rl = s.ranges();\n    for (var ri = 0; ri < rl.length; ++ri) {\n        var r = rl[ri];\n        tot += (r.max() - r.min() + 1);\n    }\n    return tot;\n}\n\n\n\nfunction rangeOrder(a, b)\n{\n    if (a.min() < b.min()) {\n        return -1;\n    } else if (a.min() > b.min()) {\n        return 1;\n    } else if (a.max() < b.max()) {\n        return -1;\n    } else if (b.max() > a.max()) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction _rangeOrder(a, b)\n{\n    if (a._min < b._min) {\n        return -1;\n    } else if (a._min > b._min) {\n        return 1;\n    } else if (a._max < b._max) {\n        return -1;\n    } else if (b._max > a._max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nreturn {\n        Range: Range,\n        union: union,\n        intersection: intersection,\n        coverage: coverage,\n        rangeOver: rangeOrder,\n        _rangeOrder: _rangeOrder\n};\n}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Javascript ZLib\n// By Thomas Down 2010-2011\n//\n// Based very heavily on portions of jzlib (by ymnk@jcraft.com), who in\n// turn credits Jean-loup Gailly and Mark Adler for the original zlib code.\n//\n// inflate.js: ZLib inflate code\n//\n\n//\n// Shared constants\n//\n\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\nvar MAX_WBITS=15; // 32K LZ77 window\nvar DEF_WBITS=MAX_WBITS;\nvar MAX_MEM_LEVEL=9;\nvar MANY=1440;\nvar BMAX = 15;\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT=0x20;\n\nvar Z_NO_FLUSH=0;\nvar Z_PARTIAL_FLUSH=1;\nvar Z_SYNC_FLUSH=2;\nvar Z_FULL_FLUSH=3;\nvar Z_FINISH=4;\n\nvar Z_DEFLATED=8;\n\nvar Z_OK=0;\nvar Z_STREAM_END=1;\nvar Z_NEED_DICT=2;\nvar Z_ERRNO=-1;\nvar Z_STREAM_ERROR=-2;\nvar Z_DATA_ERROR=-3;\nvar Z_MEM_ERROR=-4;\nvar Z_BUF_ERROR=-5;\nvar Z_VERSION_ERROR=-6;\n\nvar METHOD=0;   // waiting for method byte\nvar FLAG=1;     // waiting for flag byte\nvar DICT4=2;    // four dictionary check bytes to go\nvar DICT3=3;    // three dictionary check bytes to go\nvar DICT2=4;    // two dictionary check bytes to go\nvar DICT1=5;    // one dictionary check byte to go\nvar DICT0=6;    // waiting for inflateSetDictionary\nvar BLOCKS=7;   // decompressing blocks\nvar CHECK4=8;   // four check bytes to go\nvar CHECK3=9;   // three check bytes to go\nvar CHECK2=10;  // two check bytes to go\nvar CHECK1=11;  // one check byte to go\nvar DONE=12;    // finished check, done\nvar BAD=13;     // got an error--stay here\n\nvar inflate_mask = [0x00000000, 0x00000001, 0x00000003, 0x00000007, 0x0000000f, 0x0000001f, 0x0000003f, 0x0000007f, 0x000000ff, 0x000001ff, 0x000003ff, 0x000007ff, 0x00000fff, 0x00001fff, 0x00003fff, 0x00007fff, 0x0000ffff];\n\nvar IB_TYPE=0;  // get type bits (3, including end bit)\nvar IB_LENS=1;  // get lengths for stored\nvar IB_STORED=2;// processing stored block\nvar IB_TABLE=3; // get table lengths\nvar IB_BTREE=4; // get bit lengths tree for a dynamic block\nvar IB_DTREE=5; // get length, distance trees for a dynamic block\nvar IB_CODES=6; // processing fixed or dynamic block\nvar IB_DRY=7;   // output remaining window bytes\nvar IB_DONE=8;  // finished last block, done\nvar IB_BAD=9;   // ot a data error--stuck here\n\nvar fixed_bl = 9;\nvar fixed_bd = 5;\n\nvar fixed_tl = [\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,192,\n    80,7,10, 0,8,96, 0,8,32, 0,9,160,\n    0,8,0, 0,8,128, 0,8,64, 0,9,224,\n    80,7,6, 0,8,88, 0,8,24, 0,9,144,\n    83,7,59, 0,8,120, 0,8,56, 0,9,208,\n    81,7,17, 0,8,104, 0,8,40, 0,9,176,\n    0,8,8, 0,8,136, 0,8,72, 0,9,240,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,200,\n    81,7,13, 0,8,100, 0,8,36, 0,9,168,\n    0,8,4, 0,8,132, 0,8,68, 0,9,232,\n    80,7,8, 0,8,92, 0,8,28, 0,9,152,\n    84,7,83, 0,8,124, 0,8,60, 0,9,216,\n    82,7,23, 0,8,108, 0,8,44, 0,9,184,\n    0,8,12, 0,8,140, 0,8,76, 0,9,248,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,196,\n    81,7,11, 0,8,98, 0,8,34, 0,9,164,\n    0,8,2, 0,8,130, 0,8,66, 0,9,228,\n    80,7,7, 0,8,90, 0,8,26, 0,9,148,\n    84,7,67, 0,8,122, 0,8,58, 0,9,212,\n    82,7,19, 0,8,106, 0,8,42, 0,9,180,\n    0,8,10, 0,8,138, 0,8,74, 0,9,244,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,204,\n    81,7,15, 0,8,102, 0,8,38, 0,9,172,\n    0,8,6, 0,8,134, 0,8,70, 0,9,236,\n    80,7,9, 0,8,94, 0,8,30, 0,9,156,\n    84,7,99, 0,8,126, 0,8,62, 0,9,220,\n    82,7,27, 0,8,110, 0,8,46, 0,9,188,\n    0,8,14, 0,8,142, 0,8,78, 0,9,252,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,194,\n    80,7,10, 0,8,97, 0,8,33, 0,9,162,\n    0,8,1, 0,8,129, 0,8,65, 0,9,226,\n    80,7,6, 0,8,89, 0,8,25, 0,9,146,\n    83,7,59, 0,8,121, 0,8,57, 0,9,210,\n    81,7,17, 0,8,105, 0,8,41, 0,9,178,\n    0,8,9, 0,8,137, 0,8,73, 0,9,242,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,202,\n    81,7,13, 0,8,101, 0,8,37, 0,9,170,\n    0,8,5, 0,8,133, 0,8,69, 0,9,234,\n    80,7,8, 0,8,93, 0,8,29, 0,9,154,\n    84,7,83, 0,8,125, 0,8,61, 0,9,218,\n    82,7,23, 0,8,109, 0,8,45, 0,9,186,\n    0,8,13, 0,8,141, 0,8,77, 0,9,250,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,198,\n    81,7,11, 0,8,99, 0,8,35, 0,9,166,\n    0,8,3, 0,8,131, 0,8,67, 0,9,230,\n    80,7,7, 0,8,91, 0,8,27, 0,9,150,\n    84,7,67, 0,8,123, 0,8,59, 0,9,214,\n    82,7,19, 0,8,107, 0,8,43, 0,9,182,\n    0,8,11, 0,8,139, 0,8,75, 0,9,246,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,206,\n    81,7,15, 0,8,103, 0,8,39, 0,9,174,\n    0,8,7, 0,8,135, 0,8,71, 0,9,238,\n    80,7,9, 0,8,95, 0,8,31, 0,9,158,\n    84,7,99, 0,8,127, 0,8,63, 0,9,222,\n    82,7,27, 0,8,111, 0,8,47, 0,9,190,\n    0,8,15, 0,8,143, 0,8,79, 0,9,254,\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,193,\n\n    80,7,10, 0,8,96, 0,8,32, 0,9,161,\n    0,8,0, 0,8,128, 0,8,64, 0,9,225,\n    80,7,6, 0,8,88, 0,8,24, 0,9,145,\n    83,7,59, 0,8,120, 0,8,56, 0,9,209,\n    81,7,17, 0,8,104, 0,8,40, 0,9,177,\n    0,8,8, 0,8,136, 0,8,72, 0,9,241,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,201,\n    81,7,13, 0,8,100, 0,8,36, 0,9,169,\n    0,8,4, 0,8,132, 0,8,68, 0,9,233,\n    80,7,8, 0,8,92, 0,8,28, 0,9,153,\n    84,7,83, 0,8,124, 0,8,60, 0,9,217,\n    82,7,23, 0,8,108, 0,8,44, 0,9,185,\n    0,8,12, 0,8,140, 0,8,76, 0,9,249,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,197,\n    81,7,11, 0,8,98, 0,8,34, 0,9,165,\n    0,8,2, 0,8,130, 0,8,66, 0,9,229,\n    80,7,7, 0,8,90, 0,8,26, 0,9,149,\n    84,7,67, 0,8,122, 0,8,58, 0,9,213,\n    82,7,19, 0,8,106, 0,8,42, 0,9,181,\n    0,8,10, 0,8,138, 0,8,74, 0,9,245,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,205,\n    81,7,15, 0,8,102, 0,8,38, 0,9,173,\n    0,8,6, 0,8,134, 0,8,70, 0,9,237,\n    80,7,9, 0,8,94, 0,8,30, 0,9,157,\n    84,7,99, 0,8,126, 0,8,62, 0,9,221,\n    82,7,27, 0,8,110, 0,8,46, 0,9,189,\n    0,8,14, 0,8,142, 0,8,78, 0,9,253,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,195,\n    80,7,10, 0,8,97, 0,8,33, 0,9,163,\n    0,8,1, 0,8,129, 0,8,65, 0,9,227,\n    80,7,6, 0,8,89, 0,8,25, 0,9,147,\n    83,7,59, 0,8,121, 0,8,57, 0,9,211,\n    81,7,17, 0,8,105, 0,8,41, 0,9,179,\n    0,8,9, 0,8,137, 0,8,73, 0,9,243,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,203,\n    81,7,13, 0,8,101, 0,8,37, 0,9,171,\n    0,8,5, 0,8,133, 0,8,69, 0,9,235,\n    80,7,8, 0,8,93, 0,8,29, 0,9,155,\n    84,7,83, 0,8,125, 0,8,61, 0,9,219,\n    82,7,23, 0,8,109, 0,8,45, 0,9,187,\n    0,8,13, 0,8,141, 0,8,77, 0,9,251,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,199,\n    81,7,11, 0,8,99, 0,8,35, 0,9,167,\n    0,8,3, 0,8,131, 0,8,67, 0,9,231,\n    80,7,7, 0,8,91, 0,8,27, 0,9,151,\n    84,7,67, 0,8,123, 0,8,59, 0,9,215,\n    82,7,19, 0,8,107, 0,8,43, 0,9,183,\n    0,8,11, 0,8,139, 0,8,75, 0,9,247,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,207,\n    81,7,15, 0,8,103, 0,8,39, 0,9,175,\n    0,8,7, 0,8,135, 0,8,71, 0,9,239,\n    80,7,9, 0,8,95, 0,8,31, 0,9,159,\n    84,7,99, 0,8,127, 0,8,63, 0,9,223,\n    82,7,27, 0,8,111, 0,8,47, 0,9,191,\n    0,8,15, 0,8,143, 0,8,79, 0,9,255\n];\nvar fixed_td = [\n    80,5,1, 87,5,257, 83,5,17, 91,5,4097,\n    81,5,5, 89,5,1025, 85,5,65, 93,5,16385,\n    80,5,3, 88,5,513, 84,5,33, 92,5,8193,\n    82,5,9, 90,5,2049, 86,5,129, 192,5,24577,\n    80,5,2, 87,5,385, 83,5,25, 91,5,6145,\n    81,5,7, 89,5,1537, 85,5,97, 93,5,24577,\n    80,5,4, 88,5,769, 84,5,49, 92,5,12289,\n    82,5,13, 90,5,3073, 86,5,193, 192,5,24577\n];\n\n  // Tables for deflate from PKZIP's appnote.txt.\n  var cplens = [ // Copy lengths for literal codes 257..285\n        3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n        35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n  ];\n\n  // see note #13 above about 258\n  var cplext = [ // Extra bits for literal codes 257..285\n        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,\n        3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 112, 112  // 112==invalid\n  ];\n\n var cpdist = [ // Copy offsets for distance codes 0..29\n        1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n        257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n        8193, 12289, 16385, 24577\n  ];\n\n  var cpdext = [ // Extra bits for distance codes\n        0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,\n        7, 7, 8, 8, 9, 9, 10, 10, 11, 11,\n        12, 12, 13, 13];\n\n//\n// ZStream.java\n//\n\nfunction ZStream() {\n}\n\n\nZStream.prototype.inflateInit = function(w, nowrap) {\n    if (!w) {\n\tw = DEF_WBITS;\n    }\n    if (nowrap) {\n\tnowrap = false;\n    }\n    this.istate = new Inflate();\n    return this.istate.inflateInit(this, nowrap?-w:w);\n}\n\nZStream.prototype.inflate = function(f) {\n    if(this.istate==null) return Z_STREAM_ERROR;\n    return this.istate.inflate(this, f);\n}\n\nZStream.prototype.inflateEnd = function(){\n    if(this.istate==null) return Z_STREAM_ERROR;\n    var ret=istate.inflateEnd(this);\n    this.istate = null;\n    return ret;\n}\nZStream.prototype.inflateSync = function(){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSync(this);\n}\nZStream.prototype.inflateSetDictionary = function(dictionary, dictLength){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSetDictionary(this, dictionary, dictLength);\n}\n\n/*\n\n  public int deflateInit(int level){\n    return deflateInit(level, MAX_WBITS);\n  }\n  public int deflateInit(int level, boolean nowrap){\n    return deflateInit(level, MAX_WBITS, nowrap);\n  }\n  public int deflateInit(int level, int bits){\n    return deflateInit(level, bits, false);\n  }\n  public int deflateInit(int level, int bits, boolean nowrap){\n    dstate=new Deflate();\n    return dstate.deflateInit(this, level, nowrap?-bits:bits);\n  }\n  public int deflate(int flush){\n    if(dstate==null){\n      return Z_STREAM_ERROR;\n    }\n    return dstate.deflate(this, flush);\n  }\n  public int deflateEnd(){\n    if(dstate==null) return Z_STREAM_ERROR;\n    int ret=dstate.deflateEnd();\n    dstate=null;\n    return ret;\n  }\n  public int deflateParams(int level, int strategy){\n    if(dstate==null) return Z_STREAM_ERROR;\n    return dstate.deflateParams(this, level, strategy);\n  }\n  public int deflateSetDictionary (byte[] dictionary, int dictLength){\n    if(dstate == null)\n      return Z_STREAM_ERROR;\n    return dstate.deflateSetDictionary(this, dictionary, dictLength);\n  }\n\n*/\n\n/*\n  // Flush as much pending output as possible. All deflate() output goes\n  // through this function so some applications may wish to modify it\n  // to avoid allocating a large strm->next_out buffer and copying into it.\n  // (See also read_buf()).\n  void flush_pending(){\n    int len=dstate.pending;\n\n    if(len>avail_out) len=avail_out;\n    if(len==0) return;\n\n    if(dstate.pending_buf.length<=dstate.pending_out ||\n       next_out.length<=next_out_index ||\n       dstate.pending_buf.length<(dstate.pending_out+len) ||\n       next_out.length<(next_out_index+len)){\n      System.out.println(dstate.pending_buf.length+\", \"+dstate.pending_out+\n\t\t\t \", \"+next_out.length+\", \"+next_out_index+\", \"+len);\n      System.out.println(\"avail_out=\"+avail_out);\n    }\n\n    System.arraycopy(dstate.pending_buf, dstate.pending_out,\n\t\t     next_out, next_out_index, len);\n\n    next_out_index+=len;\n    dstate.pending_out+=len;\n    total_out+=len;\n    avail_out-=len;\n    dstate.pending-=len;\n    if(dstate.pending==0){\n      dstate.pending_out=0;\n    }\n  }\n\n  // Read a new buffer from the current input stream, update the adler32\n  // and total number of bytes read.  All deflate() input goes through\n  // this function so some applications may wish to modify it to avoid\n  // allocating a large strm->next_in buffer and copying from it.\n  // (See also flush_pending()).\n  int read_buf(byte[] buf, int start, int size) {\n    int len=avail_in;\n\n    if(len>size) len=size;\n    if(len==0) return 0;\n\n    avail_in-=len;\n\n    if(dstate.noheader==0) {\n      adler=_adler.adler32(adler, next_in, next_in_index, len);\n    }\n    System.arraycopy(next_in, next_in_index, buf, start, len);\n    next_in_index  += len;\n    total_in += len;\n    return len;\n  }\n\n  public void free(){\n    next_in=null;\n    next_out=null;\n    msg=null;\n    _adler=null;\n  }\n}\n*/\n\n\n//\n// Inflate.java\n//\n\nfunction Inflate() {\n    this.was = [0];\n}\n\nInflate.prototype.inflateReset = function(z) {\n    if(z == null || z.istate == null) return Z_STREAM_ERROR;\n\n    z.total_in = z.total_out = 0;\n    z.msg = null;\n    z.istate.mode = z.istate.nowrap!=0 ? BLOCKS : METHOD;\n    z.istate.blocks.reset(z, null);\n    return Z_OK;\n}\n\nInflate.prototype.inflateEnd = function(z){\n    if(this.blocks != null)\n      this.blocks.free(z);\n    this.blocks=null;\n    return Z_OK;\n}\n\nInflate.prototype.inflateInit = function(z, w){\n    z.msg = null;\n    this.blocks = null;\n\n    // handle undocumented nowrap option (no zlib header or check)\n    nowrap = 0;\n    if(w < 0){\n      w = - w;\n      nowrap = 1;\n    }\n\n    // set window size\n    if(w<8 ||w>15){\n      this.inflateEnd(z);\n      return Z_STREAM_ERROR;\n    }\n    this.wbits=w;\n\n    z.istate.blocks=new InfBlocks(z,\n\t\t\t\t  z.istate.nowrap!=0 ? null : this,\n\t\t\t\t  1<<w);\n\n    // reset state\n    this.inflateReset(z);\n    return Z_OK;\n  }\n\nInflate.prototype.inflate = function(z, f){\n    var r, b;\n\n    if(z == null || z.istate == null || z.next_in == null)\n      return Z_STREAM_ERROR;\n    f = f == Z_FINISH ? Z_BUF_ERROR : Z_OK;\n    r = Z_BUF_ERROR;\n    while (true){\n      switch (z.istate.mode){\n      case METHOD:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        if(((z.istate.method = z.next_in[z.next_in_index++])&0xf)!=Z_DEFLATED){\n          z.istate.mode = BAD;\n          z.msg=\"unknown compression method\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        if((z.istate.method>>4)+8>z.istate.wbits){\n          z.istate.mode = BAD;\n          z.msg=\"invalid window size\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        z.istate.mode=FLAG;\n      case FLAG:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        b = (z.next_in[z.next_in_index++])&0xff;\n\n        if((((z.istate.method << 8)+b) % 31)!=0){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect header check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        if((b&PRESET_DICT)==0){\n          z.istate.mode = BLOCKS;\n          break;\n        }\n        z.istate.mode = DICT4;\n      case DICT4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=DICT3;\n      case DICT3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode=DICT2;\n      case DICT2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode=DICT1;\n      case DICT1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need += (z.next_in[z.next_in_index++]&0xff);\n        z.adler = z.istate.need;\n        z.istate.mode = DICT0;\n        return Z_NEED_DICT;\n      case DICT0:\n        z.istate.mode = BAD;\n        z.msg = \"need dictionary\";\n        z.istate.marker = 0;       // can try inflateSync\n        return Z_STREAM_ERROR;\n      case BLOCKS:\n\n        r = z.istate.blocks.proc(z, r);\n        if(r == Z_DATA_ERROR){\n          z.istate.mode = BAD;\n          z.istate.marker = 0;     // can try inflateSync\n          break;\n        }\n        if(r == Z_OK){\n          r = f;\n        }\n        if(r != Z_STREAM_END){\n          return r;\n        }\n        r = f;\n        z.istate.blocks.reset(z, z.istate.was);\n        if(z.istate.nowrap!=0){\n          z.istate.mode=DONE;\n          break;\n        }\n        z.istate.mode=CHECK4;\n      case CHECK4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=CHECK3;\n      case CHECK3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode = CHECK2;\n      case CHECK2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode = CHECK1;\n      case CHECK1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=(z.next_in[z.next_in_index++]&0xff);\n\n        if(((z.istate.was[0])) != ((z.istate.need))){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect data check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        z.istate.mode = DONE;\n      case DONE:\n        return Z_STREAM_END;\n      case BAD:\n        return Z_DATA_ERROR;\n      default:\n        return Z_STREAM_ERROR;\n      }\n    }\n  }\n\n\nInflate.prototype.inflateSetDictionary = function(z,  dictionary, dictLength) {\n    var index=0;\n    var length = dictLength;\n    if(z==null || z.istate == null|| z.istate.mode != DICT0)\n      return Z_STREAM_ERROR;\n\n    if(z._adler.adler32(1, dictionary, 0, dictLength)!=z.adler){\n      return Z_DATA_ERROR;\n    }\n\n    z.adler = z._adler.adler32(0, null, 0, 0);\n\n    if(length >= (1<<z.istate.wbits)){\n      length = (1<<z.istate.wbits)-1;\n      index=dictLength - length;\n    }\n    z.istate.blocks.set_dictionary(dictionary, index, length);\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n  }\n\n//  static private byte[] mark = {(byte)0, (byte)0, (byte)0xff, (byte)0xff};\nvar mark = [0, 0, 255, 255]\n\nInflate.prototype.inflateSync = function(z){\n    var n;       // number of bytes to look at\n    var p;       // pointer to bytes\n    var m;       // number of marker bytes found in a row\n    var r, w;   // temporaries to save total_in and total_out\n\n    // set up\n    if(z == null || z.istate == null)\n      return Z_STREAM_ERROR;\n    if(z.istate.mode != BAD){\n      z.istate.mode = BAD;\n      z.istate.marker = 0;\n    }\n    if((n=z.avail_in)==0)\n      return Z_BUF_ERROR;\n    p=z.next_in_index;\n    m=z.istate.marker;\n\n    // search\n    while (n!=0 && m < 4){\n      if(z.next_in[p] == mark[m]){\n        m++;\n      }\n      else if(z.next_in[p]!=0){\n        m = 0;\n      }\n      else{\n        m = 4 - m;\n      }\n      p++; n--;\n    }\n\n    // restore\n    z.total_in += p-z.next_in_index;\n    z.next_in_index = p;\n    z.avail_in = n;\n    z.istate.marker = m;\n\n    // return no joy or set up to restart on a new block\n    if(m != 4){\n      return Z_DATA_ERROR;\n    }\n    r=z.total_in;  w=z.total_out;\n    this.inflateReset(z);\n    z.total_in=r;  z.total_out = w;\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP\n  // implementation to provide an additional safety check. PPP uses Z_SYNC_FLUSH\n  // but removes the length bytes of the resulting empty stored block. When\n  // decompressing, PPP checks that at the end of input packet, inflate is\n  // waiting for these length bytes.\nInflate.prototype.inflateSyncPoint = function(z){\n    if(z == null || z.istate == null || z.istate.blocks == null)\n      return Z_STREAM_ERROR;\n    return z.istate.blocks.sync_point();\n}\n\n\n//\n// InfBlocks.java\n//\n\nvar INFBLOCKS_BORDER = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\nfunction InfBlocks(z, checkfn, w) {\n    this.hufts=new Int32Array(MANY*3);\n    this.window=new Uint8Array(w);\n    this.end=w;\n    this.checkfn = checkfn;\n    this.mode = IB_TYPE;\n    this.reset(z, null);\n\n    this.left = 0;            // if STORED, bytes left to copy\n\n    this.table = 0;           // table lengths (14 bits)\n    this.index = 0;           // index into blens (or border)\n    this.blens = null;         // bit lengths of codes\n    this.bb=new Int32Array(1); // bit length tree depth\n    this.tb=new Int32Array(1); // bit length decoding tree\n\n    this.codes = new InfCodes();\n\n    this.last = 0;            // true if this block is the last block\n\n  // mode independent information\n    this.bitk = 0;            // bits in bit buffer\n    this.bitb = 0;            // bit buffer\n    this.read = 0;            // window read pointer\n    this.write = 0;           // window write pointer\n    this.check = 0;          // check on output\n\n    this.inftree=new InfTree();\n}\n\n\n\n\nInfBlocks.prototype.reset = function(z, c){\n    if(c) c[0]=this.check;\n    if(this.mode==IB_CODES){\n      this.codes.free(z);\n    }\n    this.mode=IB_TYPE;\n    this.bitk=0;\n    this.bitb=0;\n    this.read=this.write=0;\n\n    if(this.checkfn)\n      z.adler=this.check=z._adler.adler32(0, null, 0, 0);\n  }\n\n InfBlocks.prototype.proc = function(z, r){\n    var t;              // temporary storage\n    var b;              // bit buffer\n    var k;              // bits in bit buffer\n    var p;              // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n\n    // copy input/output information to locals (UPDATE macro restores)\n    {p=z.next_in_index;n=z.avail_in;b=this.bitb;k=this.bitk;}\n    {q=this.write;m=(q<this.read ? this.read-q-1 : this.end-q);}\n\n    // process input based on current state\n    while(true){\n      switch (this.mode){\n      case IB_TYPE:\n\n\twhile(k<(3)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\tt = (b & 7);\n\tthis.last = t & 1;\n\n\tswitch (t >>> 1){\n        case 0:                         // stored\n          {b>>>=(3);k-=(3);}\n          t = k & 7;                    // go to byte boundary\n\n          {b>>>=(t);k-=(t);}\n          this.mode = IB_LENS;                  // get length of stored block\n          break;\n        case 1:                         // fixed\n          {\n              var bl=new Int32Array(1);\n\t      var bd=new Int32Array(1);\n              var tl=[];\n\t      var td=[];\n\n\t      inflate_trees_fixed(bl, bd, tl, td, z);\n              this.codes.init(bl[0], bd[0], tl[0], 0, td[0], 0, z);\n          }\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_CODES;\n          break;\n        case 2:                         // dynamic\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_TABLE;\n          break;\n        case 3:                         // illegal\n\n          {b>>>=(3);k-=(3);}\n          this.mode = BAD;\n          z.msg = \"invalid block type\";\n          r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tbreak;\n      case IB_LENS:\n\twhile(k<(32)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tif ((((~b) >>> 16) & 0xffff) != (b & 0xffff)){\n\t  this.mode = BAD;\n\t  z.msg = \"invalid stored block lengths\";\n\t  r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tthis.left = (b & 0xffff);\n\tb = k = 0;                       // dump bits\n\tthis.mode = this.left!=0 ? IB_STORED : (this.last!=0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_STORED:\n\tif (n == 0){\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tif(m==0){\n\t  if(q==end&&read!=0){\n\t    q=0; m=(q<this.read ? this.read-q-1 : this.end-q);\n\t  }\n\t  if(m==0){\n\t    this.write=q;\n\t    r=this.inflate_flush(z,r);\n\t    q=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    if(q==this.end && this.read != 0){\n\t      q=0; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    }\n\t    if(m==0){\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\tt = this.left;\n\tif(t>n) t = n;\n\tif(t>m) t = m;\n\tarrayCopy(z.next_in, p, this.window, q, t);\n\tp += t;  n -= t;\n\tq += t;  m -= t;\n\tif ((this.left -= t) != 0)\n\t  break;\n\tthis.mode = (this.last != 0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_TABLE:\n\n\twhile(k<(14)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.table = t = (b & 0x3fff);\n\tif ((t & 0x1f) > 29 || ((t >> 5) & 0x1f) > 29)\n\t  {\n\t    this.mode = IB_BAD;\n\t    z.msg = \"too many length or distance symbols\";\n\t    r = Z_DATA_ERROR;\n\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  }\n\tt = 258 + (t & 0x1f) + ((t >> 5) & 0x1f);\n\tif(this.blens==null || this.blens.length<t){\n\t    this.blens=new Int32Array(t);\n\t}\n\telse{\n\t  for(var i=0; i<t; i++){\n              this.blens[i]=0;\n          }\n\t}\n\n\t{b>>>=(14);k-=(14);}\n\n\tthis.index = 0;\n\tmode = IB_BTREE;\n      case IB_BTREE:\n\twhile (this.index < 4 + (this.table >>> 10)){\n\t  while(k<(3)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = b&7;\n\n\t  {b>>>=(3);k-=(3);}\n\t}\n\n\twhile(this.index < 19){\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = 0;\n\t}\n\n\tthis.bb[0] = 7;\n\tt = this.inftree.inflate_trees_bits(this.blens, this.bb, this.tb, this.hufts, z);\n\tif (t != Z_OK){\n\t  r = t;\n\t  if (r == Z_DATA_ERROR){\n\t    this.blens=null;\n\t    this.mode = IB_BAD;\n\t  }\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tthis.index = 0;\n\tthis.mode = IB_DTREE;\n      case IB_DTREE:\n\twhile (true){\n\t  t = this.table;\n\t  if(!(this.index < 258 + (t & 0x1f) + ((t >> 5) & 0x1f))){\n\t    break;\n\t  }\n\n\t  var h; //int[]\n\t  var i, j, c;\n\n\t  t = this.bb[0];\n\n\t  while(k<(t)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n//\t  if (this.tb[0]==-1){\n//            dlog(\"null...\");\n//\t  }\n\n\t  t=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+1];\n\t  c=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+2];\n\n\t  if (c < 16){\n\t    b>>>=(t);k-=(t);\n\t    this.blens[this.index++] = c;\n\t  }\n\t  else { // c == 16..18\n\t    i = c == 18 ? 7 : c - 14;\n\t    j = c == 18 ? 11 : 3;\n\n\t    while(k<(t+i)){\n\t      if(n!=0){\n\t\tr=Z_OK;\n\t      }\n\t      else{\n\t\tthis.bitb=b; this.bitk=k;\n\t\tz.avail_in=n;\n\t\tz.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\tthis.write=q;\n\t\treturn this.inflate_flush(z,r);\n\t      };\n\t      n--;\n\t      b|=(z.next_in[p++]&0xff)<<k;\n\t      k+=8;\n\t    }\n\n\t    b>>>=(t);k-=(t);\n\n\t    j += (b & inflate_mask[i]);\n\n\t    b>>>=(i);k-=(i);\n\n\t    i = this.index;\n\t    t = this.table;\n\t    if (i + j > 258 + (t & 0x1f) + ((t >> 5) & 0x1f) ||\n\t\t(c == 16 && i < 1)){\n\t      this.blens=null;\n\t      this.mode = IB_BAD;\n\t      z.msg = \"invalid bit length repeat\";\n\t      r = Z_DATA_ERROR;\n\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\n\t    c = c == 16 ? this.blens[i-1] : 0;\n\t    do{\n\t      this.blens[i++] = c;\n\t    }\n\t    while (--j!=0);\n\t    this.index = i;\n\t  }\n\t}\n\n\tthis.tb[0]=-1;\n\t{\n\t    var bl=new Int32Array(1);\n\t    var bd=new Int32Array(1);\n\t    var tl=new Int32Array(1);\n\t    var td=new Int32Array(1);\n\t    bl[0] = 9;         // must be <= 9 for lookahead assumptions\n\t    bd[0] = 6;         // must be <= 9 for lookahead assumptions\n\n\t    t = this.table;\n\t    t = this.inftree.inflate_trees_dynamic(257 + (t & 0x1f),\n\t\t\t\t\t      1 + ((t >> 5) & 0x1f),\n\t\t\t\t\t      this.blens, bl, bd, tl, td, this.hufts, z);\n\n\t    if (t != Z_OK){\n\t        if (t == Z_DATA_ERROR){\n\t            this.blens=null;\n\t            this.mode = BAD;\n\t        }\n\t        r = t;\n\n\t        this.bitb=b; this.bitk=k;\n\t        z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t        this.write=q;\n\t        return this.inflate_flush(z,r);\n\t    }\n\t    this.codes.init(bl[0], bd[0], this.hufts, tl[0], this.hufts, td[0], z);\n\t}\n\tthis.mode = IB_CODES;\n      case IB_CODES:\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n; z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\n\tif ((r = this.codes.proc(this, z, r)) != Z_STREAM_END){\n\t  return this.inflate_flush(z, r);\n\t}\n\tr = Z_OK;\n\tthis.codes.free(z);\n\n\tp=z.next_in_index; n=z.avail_in;b=this.bitb;k=this.bitk;\n\tq=this.write;m = (q < this.read ? this.read-q-1 : this.end-q);\n\n\tif (this.last==0){\n\t  this.mode = IB_TYPE;\n\t  break;\n\t}\n\tthis.mode = IB_DRY;\n      case IB_DRY:\n\tthis.write=q;\n\tr = this.inflate_flush(z, r);\n\tq=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\tif (this.read != this.write){\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z, r);\n\t}\n\tmode = DONE;\n      case IB_DONE:\n\tr = Z_STREAM_END;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      case IB_BAD:\n\tr = Z_DATA_ERROR;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      }\n    }\n  }\n\nInfBlocks.prototype.free = function(z){\n    this.reset(z, null);\n    this.window=null;\n    this.hufts=null;\n}\n\nInfBlocks.prototype.set_dictionary = function(d, start, n){\n    arrayCopy(d, start, window, 0, n);\n    this.read = this.write = n;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH.\nInfBlocks.prototype.sync_point = function(){\n    return this.mode == IB_LENS;\n}\n\n  // copy as much as possible from the sliding window to the output area\nInfBlocks.prototype.inflate_flush = function(z, r){\n    var n;\n    var p;\n    var q;\n\n    // local copies of source and destination pointers\n    p = z.next_out_index;\n    q = this.read;\n\n    // compute number of bytes to copy as far as end of window\n    n = ((q <= this.write ? this.write : this.end) - q);\n    if (n > z.avail_out) n = z.avail_out;\n    if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n    // update counters\n    z.avail_out -= n;\n    z.total_out += n;\n\n    // update check information\n    if(this.checkfn != null)\n      z.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n    // copy as far as end of window\n    arrayCopy(this.window, q, z.next_out, p, n);\n    p += n;\n    q += n;\n\n    // see if more to copy at beginning of window\n    if (q == this.end){\n      // wrap pointers\n      q = 0;\n      if (this.write == this.end)\n        this.write = 0;\n\n      // compute bytes to copy\n      n = this.write - q;\n      if (n > z.avail_out) n = z.avail_out;\n      if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n      // update counters\n      z.avail_out -= n;\n      z.total_out += n;\n\n      // update check information\n      if(this.checkfn != null)\n\tz.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n      // copy\n      arrayCopy(this.window, q, z.next_out, p, n);\n      p += n;\n      q += n;\n    }\n\n    // update pointers\n    z.next_out_index = p;\n    this.read = q;\n\n    // done\n    return r;\n  }\n\n//\n// InfCodes.java\n//\n\nvar IC_START=0;  // x: set up for LEN\nvar IC_LEN=1;    // i: get length/literal/eob next\nvar IC_LENEXT=2; // i: getting length extra (have base)\nvar IC_DIST=3;   // i: get distance next\nvar IC_DISTEXT=4;// i: getting distance extra\nvar IC_COPY=5;   // o: copying bytes in window, waiting for space\nvar IC_LIT=6;    // o: got literal, waiting for output space\nvar IC_WASH=7;   // o: got eob, possibly still output waiting\nvar IC_END=8;    // x: got eob and all data flushed\nvar IC_BADCODE=9;// x: got error\n\nfunction InfCodes() {\n}\n\nInfCodes.prototype.init = function(bl, bd, tl, tl_index, td, td_index, z) {\n    this.mode=IC_START;\n    this.lbits=bl;\n    this.dbits=bd;\n    this.ltree=tl;\n    this.ltree_index=tl_index;\n    this.dtree = td;\n    this.dtree_index=td_index;\n    this.tree=null;\n}\n\nInfCodes.prototype.proc = function(s, z, r){\n    var j;              // temporary storage\n    var t;              // temporary pointer (int[])\n    var tindex;         // temporary pointer\n    var e;              // extra bits or operation\n    var b=0;            // bit buffer\n    var k=0;            // bits in bit buffer\n    var p=0;            // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n    var f;              // pointer to copy strings from\n\n    // copy input/output information to locals (UPDATE macro restores)\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // process input and output based on current state\n    while (true){\n      switch (this.mode){\n\t// waiting for \"i:\"=input, \"o:\"=output, \"x:\"=nothing\n      case IC_START:         // x: set up for LEN\n\tif (m >= 258 && n >= 10){\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  r = this.inflate_fast(this.lbits, this.dbits,\n\t\t\t   this.ltree, this.ltree_index,\n\t\t\t   this.dtree, this.dtree_index,\n\t\t\t   s, z);\n\n\t  p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n\t  q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t  if (r != Z_OK){\n\t    this.mode = r == Z_STREAM_END ? IC_WASH : IC_BADCODE;\n\t    break;\n\t  }\n\t}\n\tthis.need = this.lbits;\n\tthis.tree = this.ltree;\n\tthis.tree_index=this.ltree_index;\n\n\tthis.mode = IC_LEN;\n      case IC_LEN:           // i: get length/literal/eob next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b&inflate_mask[j]))*3;\n\n\tb>>>=(this.tree[tindex+1]);\n\tk-=(this.tree[tindex+1]);\n\n\te=this.tree[tindex];\n\n\tif(e == 0){               // literal\n\t  this.lit = this.tree[tindex+2];\n\t  this.mode = IC_LIT;\n\t  break;\n\t}\n\tif((e & 16)!=0 ){          // length\n\t  this.get = e & 15;\n\t  this.len = this.tree[tindex+2];\n\t  this.mode = IC_LENEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tif ((e & 32)!=0){               // end of block\n\t  this.mode = IC_WASH;\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid literal/length code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_LENEXT:        // i: getting length extra (have base)\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.len += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.need = this.dbits;\n\tthis.tree = this.dtree;\n\tthis.tree_index = this.dtree_index;\n\tthis.mode = IC_DIST;\n      case IC_DIST:          // i: get distance next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b & inflate_mask[j]))*3;\n\n\tb>>=this.tree[tindex+1];\n\tk-=this.tree[tindex+1];\n\n\te = (this.tree[tindex]);\n\tif((e & 16)!=0){               // distance\n\t  this.get = e & 15;\n\t  this.dist = this.tree[tindex+2];\n\t  this.mode = IC_DISTEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid distance code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_DISTEXT:       // i: getting distance extra\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.dist += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.mode = IC_COPY;\n      case IC_COPY:          // o: copying bytes in window, waiting for space\n        f = q - this.dist;\n        while(f < 0){     // modulo window size-\"while\" instead\n          f += s.end;     // of \"if\" handles invalid distances\n\t}\n\twhile (this.len!=0){\n\n\t  if(m==0){\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.write=q; r=s.inflate_flush(z,r);\n\t      q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t      if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\n\t      if(m==0){\n\t\ts.bitb=b;s.bitk=k;\n\t\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\ts.write=q;\n\t\treturn s.inflate_flush(z,r);\n\t      }\n\t    }\n\t  }\n\n\t  s.window[q++]=s.window[f++]; m--;\n\n\t  if (f == s.end)\n            f = 0;\n\t  this.len--;\n\t}\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_LIT:           // o: got literal, waiting for output space\n\tif(m==0){\n\t  if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t  if(m==0){\n\t    s.write=q; r=s.inflate_flush(z,r);\n\t    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\t      return s.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\ts.window[q++]=this.lit; m--;\n\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_WASH:           // o: got eob, possibly more output\n\tif (k > 7){        // return unused byte, if any\n\t  k -= 8;\n\t  n++;\n\t  p--;             // can always return one\n\t}\n\n\ts.write=q; r=s.inflate_flush(z,r);\n\tq=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\tif (s.read != s.write){\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  return s.inflate_flush(z,r);\n\t}\n\tthis.mode = IC_END;\n      case IC_END:\n\tr = Z_STREAM_END;\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_BADCODE:       // x: got error\n\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n      }\n    }\n  }\n\nInfCodes.prototype.free = function(z){\n    //  ZFREE(z, c);\n}\n\n  // Called with number of bytes left to write in window at least 258\n  // (the maximum string length) and number of input bytes available\n  // at least ten.  The ten bytes are six bytes for the longest length/\n  // distance pair plus four bytes for overloading the bit buffer.\n\nInfCodes.prototype.inflate_fast = function(bl, bd, tl, tl_index, td, td_index, s, z) {\n    var t;                // temporary pointer\n    var   tp;             // temporary pointer (int[])\n    var tp_index;         // temporary pointer\n    var e;                // extra bits or operation\n    var b;                // bit buffer\n    var k;                // bits in bit buffer\n    var p;                // input data pointer\n    var n;                // bytes available there\n    var q;                // output window write pointer\n    var m;                // bytes to end of window or read pointer\n    var ml;               // mask for literal/length tree\n    var md;               // mask for distance tree\n    var c;                // bytes to copy\n    var d;                // distance back to copy from\n    var r;                // copy source pointer\n\n    var tp_index_t_3;     // (tp_index+t)*3\n\n    // load input, output, bit values\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // initialize masks\n    ml = inflate_mask[bl];\n    md = inflate_mask[bd];\n\n    // do until not enough input or output space for fast loop\n    do {                          // assume called with m >= 258 && n >= 10\n      // get literal/length code\n      while(k<(20)){              // max bits for literal/length code\n\tn--;\n\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n      }\n\n      t= b&ml;\n      tp=tl;\n      tp_index=tl_index;\n      tp_index_t_3=(tp_index+t)*3;\n      if ((e = tp[tp_index_t_3]) == 0){\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\ts.window[q++] = tp[tp_index_t_3+2];\n\tm--;\n\tcontinue;\n      }\n      do {\n\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\tif((e&16)!=0){\n\t  e &= 15;\n\t  c = tp[tp_index_t_3+2] + (b & inflate_mask[e]);\n\n\t  b>>=e; k-=e;\n\n\t  // decode distance base of block to copy\n\t  while(k<(15)){           // max bits for distance code\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t  }\n\n\t  t= b&md;\n\t  tp=td;\n\t  tp_index=td_index;\n          tp_index_t_3=(tp_index+t)*3;\n\t  e = tp[tp_index_t_3];\n\n\t  do {\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    if((e&16)!=0){\n\t      // get extra bits to add to distance base\n\t      e &= 15;\n\t      while(k<(e)){         // get extra bits (up to 13)\n\t\tn--;\n\t\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t      }\n\n\t      d = tp[tp_index_t_3+2] + (b&inflate_mask[e]);\n\n\t      b>>=(e); k-=(e);\n\n\t      // do the copy\n\t      m -= c;\n\t      if (q >= d){                // offset before dest\n\t\t//  just copy\n\t\tr=q-d;\n\t\tif(q-r>0 && 2>(q-r)){\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t\telse{\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t      }\n\t      else{                  // else offset after destination\n                r=q-d;\n                do{\n                  r+=s.end;          // force pointer in window\n                }while(r<0);         // covers invalid distances\n\t\te=s.end-r;\n\t\tif(c>e){             // if source crosses,\n\t\t  c-=e;              // wrapped copy\n\t\t  if(q-r>0 && e>(q-r)){\n\t\t    do{s.window[q++] = s.window[r++];}\n\t\t    while(--e!=0);\n\t\t  }\n\t\t  else{\n\t\t    arrayCopy(s.window, r, s.window, q, e);\n\t\t    q+=e; r+=e; e=0;\n\t\t  }\n\t\t  r = 0;                  // copy rest from start of window\n\t\t}\n\n\t      }\n\n\t      // copy all or what's left\n              do{s.window[q++] = s.window[r++];}\n\t\twhile(--c!=0);\n\t      break;\n\t    }\n\t    else if((e&64)==0){\n\t      t+=tp[tp_index_t_3+2];\n\t      t+=(b&inflate_mask[e]);\n\t      tp_index_t_3=(tp_index+t)*3;\n\t      e=tp[tp_index_t_3];\n\t    }\n\t    else{\n\t      z.msg = \"invalid distance code\";\n\n\t      c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\n\t      return Z_DATA_ERROR;\n\t    }\n\t  }\n\t  while(true);\n\t  break;\n\t}\n\n\tif((e&64)==0){\n\t  t+=tp[tp_index_t_3+2];\n\t  t+=(b&inflate_mask[e]);\n\t  tp_index_t_3=(tp_index+t)*3;\n\t  if((e=tp[tp_index_t_3])==0){\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    s.window[q++]=tp[tp_index_t_3+2];\n\t    m--;\n\t    break;\n\t  }\n\t}\n\telse if((e&32)!=0){\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_STREAM_END;\n\t}\n\telse{\n\t  z.msg=\"invalid literal/length code\";\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_DATA_ERROR;\n\t}\n      }\n      while(true);\n    }\n    while(m>=258 && n>= 10);\n\n    // not enough input or output--restore pointers and return\n    c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n    s.bitb=b;s.bitk=k;\n    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n    s.write=q;\n\n    return Z_OK;\n}\n\n//\n// InfTree.java\n//\n\nfunction InfTree() {\n}\n\nInfTree.prototype.huft_build = function(b, bindex, n, s, d, e, t, m, hp, hn, v) {\n\n    // Given a list of code lengths and a maximum table size, make a set of\n    // tables to decode that set of codes.  Return Z_OK on success, Z_BUF_ERROR\n    // if the given code set is incomplete (the tables are still built in this\n    // case), Z_DATA_ERROR if the input is invalid (an over-subscribed set of\n    // lengths), or Z_MEM_ERROR if not enough memory.\n\n    var a;                       // counter for codes of length k\n    var f;                       // i repeats in table every f entries\n    var g;                       // maximum code length\n    var h;                       // table level\n    var i;                       // counter, current code\n    var j;                       // counter\n    var k;                       // number of bits in current code\n    var l;                       // bits per table (returned in m)\n    var mask;                    // (1 << w) - 1, to avoid cc -O bug on HP\n    var p;                       // pointer into c[], b[], or v[]\n    var q;                       // points to current table\n    var w;                       // bits before this table == (l * h)\n    var xp;                      // pointer into x\n    var y;                       // number of dummy codes added\n    var z;                       // number of entries in current table\n\n    // Generate counts for each bit length\n\n    p = 0; i = n;\n    do {\n      this.c[b[bindex+p]]++; p++; i--;   // assume all entries <= BMAX\n    }while(i!=0);\n\n    if(this.c[0] == n){                // null input--all zero length codes\n      t[0] = -1;\n      m[0] = 0;\n      return Z_OK;\n    }\n\n    // Find minimum and maximum length, bound *m by those\n    l = m[0];\n    for (j = 1; j <= BMAX; j++)\n      if(this.c[j]!=0) break;\n    k = j;                        // minimum code length\n    if(l < j){\n      l = j;\n    }\n    for (i = BMAX; i!=0; i--){\n      if(this.c[i]!=0) break;\n    }\n    g = i;                        // maximum code length\n    if(l > i){\n      l = i;\n    }\n    m[0] = l;\n\n    // Adjust last length count to fill out codes, if needed\n    for (y = 1 << j; j < i; j++, y <<= 1){\n      if ((y -= this.c[j]) < 0){\n        return Z_DATA_ERROR;\n      }\n    }\n    if ((y -= this.c[i]) < 0){\n      return Z_DATA_ERROR;\n    }\n    this.c[i] += y;\n\n    // Generate starting offsets into the value table for each length\n    this.x[1] = j = 0;\n    p = 1;  xp = 2;\n    while (--i!=0) {                 // note that i == g from above\n      this.x[xp] = (j += this.c[p]);\n      xp++;\n      p++;\n    }\n\n    // Make a table of values in order of bit lengths\n    i = 0; p = 0;\n    do {\n      if ((j = b[bindex+p]) != 0){\n        this.v[this.x[j]++] = i;\n      }\n      p++;\n    }\n    while (++i < n);\n    n = this.x[g];                     // set n to length of v\n\n    // Generate the Huffman codes and for each, make the table entries\n    this.x[0] = i = 0;                 // first Huffman code is zero\n    p = 0;                        // grab values in bit order\n    h = -1;                       // no tables yet--level -1\n    w = -l;                       // bits decoded == (l * h)\n    this.u[0] = 0;                     // just to keep compilers happy\n    q = 0;                        // ditto\n    z = 0;                        // ditto\n\n    // go through the bit lengths (k already is bits in shortest code)\n    for (; k <= g; k++){\n      a = this.c[k];\n      while (a--!=0){\n\t// here i is the Huffman code of length k bits for value *p\n\t// make tables up to required level\n        while (k > w + l){\n          h++;\n          w += l;                 // previous table always l bits\n\t  // compute minimum size table less than or equal to l bits\n          z = g - w;\n          z = (z > l) ? l : z;        // table size upper limit\n          if((f=1<<(j=k-w))>a+1){     // try a k-w bit table\n                                      // too few codes for k-w bit table\n            f -= a + 1;               // deduct codes from patterns left\n            xp = k;\n            if(j < z){\n              while (++j < z){        // try smaller tables up to z bits\n                if((f <<= 1) <= this.c[++xp])\n                  break;              // enough codes to use up j bits\n                f -= this.c[xp];           // else deduct codes from patterns\n              }\n\t    }\n          }\n          z = 1 << j;                 // table entries for j-bit table\n\n\t  // allocate new table\n          if (this.hn[0] + z > MANY){       // (note: doesn't matter for fixed)\n            return Z_DATA_ERROR;       // overflow of MANY\n          }\n          this.u[h] = q = /*hp+*/ this.hn[0];   // DEBUG\n          this.hn[0] += z;\n\n\t  // connect to last table, if there is one\n\t  if(h!=0){\n            this.x[h]=i;           // save pattern for backing up\n            this.r[0]=j;     // bits in this table\n            this.r[1]=l;     // bits to dump before this table\n            j=i>>>(w - l);\n            this.r[2] = (q - this.u[h-1] - j);               // offset to this table\n            arrayCopy(this.r, 0, hp, (this.u[h-1]+j)*3, 3); // connect to last table\n          }\n          else{\n            t[0] = q;               // first table is returned result\n\t  }\n        }\n\n\t// set up table entry in r\n        this.r[1] = (k - w);\n        if (p >= n){\n          this.r[0] = 128 + 64;      // out of values--invalid code\n\t}\n        else if (v[p] < s){\n          this.r[0] = (this.v[p] < 256 ? 0 : 32 + 64);  // 256 is end-of-block\n          this.r[2] = this.v[p++];          // simple code is just the value\n        }\n        else{\n          this.r[0]=(e[this.v[p]-s]+16+64); // non-simple--look up in lists\n          this.r[2]=d[this.v[p++] - s];\n        }\n\n        // fill code-like entries with r\n        f=1<<(k-w);\n        for (j=i>>>w;j<z;j+=f){\n          arrayCopy(this.r, 0, hp, (q+j)*3, 3);\n\t}\n\n\t// backwards increment the k-bit code i\n        for (j = 1 << (k - 1); (i & j)!=0; j >>>= 1){\n          i ^= j;\n\t}\n        i ^= j;\n\n\t// backup over finished tables\n        mask = (1 << w) - 1;      // needed on HP, cc -O bug\n        while ((i & mask) != this.x[h]){\n          h--;                    // don't need to update q\n          w -= l;\n          mask = (1 << w) - 1;\n        }\n      }\n    }\n    // Return Z_BUF_ERROR if we were given an incomplete table\n    return y != 0 && g != 1 ? Z_BUF_ERROR : Z_OK;\n}\n\nInfTree.prototype.inflate_trees_bits = function(c, bb, tb, hp, z) {\n    var result;\n    this.initWorkArea(19);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, 19, 19, null, null, tb, bb, hp, this.hn, this.v);\n\n    if(result == Z_DATA_ERROR){\n      z.msg = \"oversubscribed dynamic bit lengths tree\";\n    }\n    else if(result == Z_BUF_ERROR || bb[0] == 0){\n      z.msg = \"incomplete dynamic bit lengths tree\";\n      result = Z_DATA_ERROR;\n    }\n    return result;\n}\n\nInfTree.prototype.inflate_trees_dynamic = function(nl, nd, c, bl, bd, tl, td, hp, z) {\n    var result;\n\n    // build literal/length tree\n    this.initWorkArea(288);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, nl, 257, cplens, cplext, tl, bl, hp, this.hn, this.v);\n    if (result != Z_OK || bl[0] == 0){\n      if(result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed literal/length tree\";\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"incomplete literal/length tree\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    // build distance tree\n    this.initWorkArea(288);\n    result = this.huft_build(c, nl, nd, 0, cpdist, cpdext, td, bd, hp, this.hn, this.v);\n\n    if (result != Z_OK || (bd[0] == 0 && nl > 257)){\n      if (result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed distance tree\";\n      }\n      else if (result == Z_BUF_ERROR) {\n        z.msg = \"incomplete distance tree\";\n        result = Z_DATA_ERROR;\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"empty distance tree with lengths\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    return Z_OK;\n}\n/*\n  static int inflate_trees_fixed(int[] bl,  //literal desired/actual bit depth\n                                 int[] bd,  //distance desired/actual bit depth\n                                 int[][] tl,//literal/length tree result\n                                 int[][] td,//distance tree result\n                                 ZStream z  //for memory allocation\n\t\t\t\t ){\n\n*/\n\nfunction inflate_trees_fixed(bl, bd, tl, td, z) {\n    bl[0]=fixed_bl;\n    bd[0]=fixed_bd;\n    tl[0]=fixed_tl;\n    td[0]=fixed_td;\n    return Z_OK;\n}\n\nInfTree.prototype.initWorkArea = function(vsize){\n    if(this.hn==null){\n        this.hn=new Int32Array(1);\n        this.v=new Int32Array(vsize);\n        this.c=new Int32Array(BMAX+1);\n        this.r=new Int32Array(3);\n        this.u=new Int32Array(BMAX);\n        this.x=new Int32Array(BMAX+1);\n    }\n    if(this.v.length<vsize){\n        this.v=new Int32Array(vsize);\n    }\n    for(var i=0; i<vsize; i++){this.v[i]=0;}\n    for(var i=0; i<BMAX+1; i++){this.c[i]=0;}\n    for(var i=0; i<3; i++){this.r[i]=0;}\n//  for(int i=0; i<BMAX; i++){u[i]=0;}\n    arrayCopy(this.c, 0, this.u, 0, BMAX);\n//  for(int i=0; i<BMAX+1; i++){x[i]=0;}\n    arrayCopy(this.c, 0, this.x, 0, BMAX+1);\n}\n\nvar testArray = new Uint8Array(1);\nvar hasSubarray = (typeof testArray.subarray === 'function');\nvar hasSlice = false; /* (typeof testArray.slice === 'function'); */ // Chrome slice performance is so dire that we're currently not using it...\n\nfunction arrayCopy(src, srcOffset, dest, destOffset, count) {\n    if (count == 0) {\n        return;\n    }\n    if (!src) {\n        throw \"Undef src\";\n    } else if (!dest) {\n        throw \"Undef dest\";\n    }\n\n    if (srcOffset == 0 && count == src.length) {\n        arrayCopy_fast(src, dest, destOffset);\n    } else if (hasSubarray) {\n        arrayCopy_fast(src.subarray(srcOffset, srcOffset + count), dest, destOffset);\n    } else if (src.BYTES_PER_ELEMENT == 1 && count > 100) {\n        arrayCopy_fast(new Uint8Array(src.buffer, src.byteOffset + srcOffset, count), dest, destOffset);\n    } else {\n        arrayCopy_slow(src, srcOffset, dest, destOffset, count);\n    }\n\n}\n\nfunction arrayCopy_slow(src, srcOffset, dest, destOffset, count) {\n\n    // dlog('_slow call: srcOffset=' + srcOffset + '; destOffset=' + destOffset + '; count=' + count);\n\n     for (var i = 0; i < count; ++i) {\n        dest[destOffset + i] = src[srcOffset + i];\n    }\n}\n\nfunction arrayCopy_fast(src, dest, destOffset) {\n    dest.set(src, destOffset);\n}\n\n\n  // largest prime smaller than 65536\nvar ADLER_BASE=65521;\n  // NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) <= 2^32-1\nvar ADLER_NMAX=5552;\n\nfunction adler32(adler, /* byte[] */ buf,  index, len){\n    if(buf == null){ return 1; }\n\n    var s1=adler&0xffff;\n    var s2=(adler>>16)&0xffff;\n    var k;\n\n    while(len > 0) {\n      k=len<ADLER_NMAX?len:ADLER_NMAX;\n      len-=k;\n      while(k>=16){\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        k-=16;\n      }\n      if(k!=0){\n        do{\n          s1+=buf[index++]&0xff; s2+=s1;\n        }\n        while(--k!=0);\n      }\n      s1%=ADLER_BASE;\n      s2%=ADLER_BASE;\n    }\n    return (s2<<16)|s1;\n}\n\n\n\nfunction jszlib_inflate_buffer(buffer, start, length, afterUncOffset) {\n    if (!start) {\n        buffer = new Uint8Array(buffer);\n    } else if (!length) {\n        buffer = new Uint8Array(buffer, start, buffer.byteLength - start);\n    } else {\n        buffer = new Uint8Array(buffer, start, length);\n    }\n\n    var z = new ZStream();\n    z.inflateInit(DEF_WBITS, true);\n    z.next_in = buffer;\n    z.next_in_index = 0;\n    z.avail_in = buffer.length;\n\n    var oBlockList = [];\n    var totalSize = 0;\n    while (true) {\n        var obuf = new Uint8Array(32000);\n        z.next_out = obuf;\n        z.next_out_index = 0;\n        z.avail_out = obuf.length;\n        var status = z.inflate(Z_NO_FLUSH);\n        if (status != Z_OK && status != Z_STREAM_END && status != Z_BUF_ERROR) {\n            throw z.msg;\n        }\n        if (z.avail_out != 0) {\n            var newob = new Uint8Array(obuf.length - z.avail_out);\n            arrayCopy(obuf, 0, newob, 0, (obuf.length - z.avail_out));\n            obuf = newob;\n        }\n        oBlockList.push(obuf);\n        totalSize += obuf.length;\n        if (status == Z_STREAM_END || status == Z_BUF_ERROR) {\n            break;\n        }\n    }\n\n    if (afterUncOffset) {\n        afterUncOffset[0] = (start || 0) + z.next_in_index;\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0].buffer;\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = oBlockList[i];\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nreturn {\n    inflateBuffer: jszlib_inflate_buffer,\n    arrayCopy: arrayCopy\n  };\n}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(jQuery) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;//     jQuery Ajax Native Plugin\n\n//     (c) 2015 Tarik Zakaria Benmerar, Acigna Inc.\n//      jQuery Ajax Native Plugin may be freely distributed under the MIT license.\n(function (root, factory) {\n    if (true) {\n        // AMD. Register as an anonymous module.\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(0)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('jquery'));\n    } else {\n        // Browser globals (root is window)\n        factory(root.jQuery);\n    }\n}(this, function ( $ ) {\n    var ajaxSettings = $.ajaxSettings;\n    ajaxSettings.responseFields.native = 'responseNative';\n    ajaxSettings.converters[ '* native' ] = true;\n    var support = {},\n        xhrId = 0,\n        xhrSuccessStatus = {\n            // file protocol always yields status code 0, assume 200\n            0: 200,\n            // Support: IE9\n            // #1450: sometimes IE returns 1223 when it should be 204\n            1223: 204\n        },\n        xhrCallbacks = {},\n        xhrSupported = jQuery.ajaxSettings.xhr();\n    // Support: IE9\n    // Open requests must be manually aborted on unload (#5280)\n    if ( window.ActiveXObject ) {\n        $( window ).on( \"unload\", function() {\n            for ( var key in xhrCallbacks ) {\n                xhrCallbacks[ key ]();\n            }\n        });\n    }\n    support.cors = !!xhrSupported && ( \"withCredentials\" in xhrSupported );\n    support.ajax = xhrSupported = !!xhrSupported;\n\n    //Native Data Type Ajax Transport\n    $.ajaxTransport('native', function ( options ) {\n        var callback;\n        // Cross domain only allowed if supported through XMLHttpRequest\n        if ( support.cors || xhrSupported && !options.crossDomain ) {\n            return {\n                send: function( headers, complete ) {\n                    var i,\n                        xhr = options.xhr(),\n                        id = ++xhrId,\n                        responses = {};\n\n                    xhr.open( options.type, options.url, options.async, options.username, options.password );\n\n                    // Apply custom fields if provided\n                    if ( options.xhrFields ) {\n                        for ( i in options.xhrFields ) {\n                            xhr[ i ] = options.xhrFields[ i ];\n                        }\n                    }\n\n                    // Override mime type if needed\n                    if ( options.mimeType && xhr.overrideMimeType ) {\n                        xhr.overrideMimeType( options.mimeType );\n                    }\n\n                    // X-Requested-With header\n                    // For cross-domain requests, seeing as conditions for a preflight are\n                    // akin to a jigsaw puzzle, we simply never set it to be sure.\n                    // (it can always be set on a per-request basis or even using ajaxSetup)\n                    // For same-domain requests, won't change header if already provided.\n                    if ( !options.crossDomain && !headers[\"X-Requested-With\"] ) {\n                        headers[\"X-Requested-With\"] = \"XMLHttpRequest\";\n                    }\n\n                    // Set headers\n                    for ( i in headers ) {\n                        xhr.setRequestHeader( i, headers[ i ] );\n                    }\n\n                    // Callback\n                    callback = function( type ) {\n                        return function() {\n                            if ( callback ) {\n                                delete xhrCallbacks[ id ];\n                                callback = xhr.onload = xhr.onerror = null;\n\n                                if ( type === \"abort\" ) {\n                                    xhr.abort();\n                                } else if ( type === \"error\" ) {\n                                    complete(\n                                        // file: protocol always yields status 0; see #8605, #14207\n                                        xhr.status,\n                                        xhr.statusText\n                                    );\n                                } else {\n                                    // The native response associated with the responseType\n                                    // Stored in the xhr.response attribute (XHR2 Spec)\n                                    if ( xhr.response ) {\n                                        responses.native = xhr.response;\n                                    }\n\n                                    complete(\n                                        xhrSuccessStatus[ xhr.status ] || xhr.status,\n                                        xhr.statusText,\n                                        responses,\n                                        xhr.getAllResponseHeaders()\n                                    );\n                                }\n                            }\n                        };\n                    };\n\n                    // Listen to events\n                    xhr.onload = callback();\n                    xhr.onerror = callback(\"error\");\n\n                    // Create the abort callback\n                    callback = xhrCallbacks[ id ] = callback(\"abort\");\n\n                    try {\n                        // Do send the request (this may raise an exception)\n                        xhr.send( options.hasContent && options.data || null );\n                    } catch ( e ) {\n                        // #14683: Only rethrow if this hasn't been notified as an error yet\n                        if ( callback ) {\n                            throw e;\n                        }\n                    }\n                },\n\n                abort: function() {\n                    if ( callback ) {\n                        callback();\n                    }\n                }\n            };\n        }\n    });\n\n\n    //$.getNative wrapper\n    $.getNative = function ( url, callback ) {\n        return $.ajax({\n            dataType: 'native',\n            url: url,\n            xhrFields: {\n                responseType: 'arraybuffer'\n            },\n            success: callback\n        });\n    }\n}));\n\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _backbone = __webpack_require__(2);\n\nvar Backbone = _interopRequireWildcard(_backbone);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n */\nvar User = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(\n/** @lends User.prototype */{\n    _logNamespace: logNamespace,\n\n    /** API location for this resource */\n    urlRoot: function urlRoot() {\n        return Galaxy.root + \"api/users\";\n    },\n\n    /** Model defaults\n     *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n     *      a safer method is if( !user.get( 'email' ) ) -> anon user\n     */\n    defaults: /** @lends User.prototype */{\n        id: null,\n        username: \"(\" + (0, _localization2.default)(\"anonymous user\") + \")\",\n        email: \"\",\n        total_disk_usage: 0,\n        nice_total_disk_usage: \"\",\n        quota_percent: null,\n        is_admin: false\n    },\n\n    /** Set up and bind events\n     *  @param {Object} data Initial model data.\n     */\n    initialize: function initialize(data) {\n        this.log(\"User.initialize:\", data);\n\n        this.on(\"loaded\", function (model, resp) {\n            this.log(this + \" has loaded:\", model, resp);\n        });\n        this.on(\"change\", function (model, data) {\n            this.log(this + \" has changed:\", model, data.changes);\n        });\n    },\n\n    isAnonymous: function isAnonymous() {\n        return !this.get(\"email\");\n    },\n\n    isAdmin: function isAdmin() {\n        return this.get(\"is_admin\");\n    },\n\n    /** Load a user with the API using an id.\n     *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n     *      (e.g. 'current') and the API will return the current transaction's user data.\n     *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n     *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n     *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n     */\n    loadFromApi: function loadFromApi(idOrCurrent, options) {\n        idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n        options = options || {};\n        var model = this;\n        var userFn = options.success;\n\n        /** @ignore */\n        options.success = function (newModel, response) {\n            model.trigger(\"loaded\", newModel, response);\n            if (userFn) {\n                userFn(newModel, response);\n            }\n        };\n\n        // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n        if (idOrCurrent === User.CURRENT_ID_STR) {\n            options.url = this.urlRoot + \"/\" + User.CURRENT_ID_STR;\n        }\n        return Backbone.Model.prototype.fetch.call(this, options);\n    },\n\n    /** Clears all data from the sessionStorage.\n     */\n    clearSessionStorage: function clearSessionStorage() {\n        for (var key in sessionStorage) {\n            //TODO: store these under the user key so we don't have to do this\n            // currently only history\n            if (key.indexOf(\"history:\") === 0) {\n                sessionStorage.removeItem(key);\n            } else if (key === \"history-panel\") {\n                sessionStorage.removeItem(key);\n            }\n        }\n    },\n\n    /** string representation */\n    toString: function toString() {\n        var userInfo = [this.get(\"username\")];\n        if (this.get(\"id\")) {\n            userInfo.unshift(this.get(\"id\"));\n            userInfo.push(this.get(\"email\"));\n        }\n        return \"User(\" + userInfo.join(\":\") + \")\";\n    }\n});\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = \"current\";\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = function (options) {\n    var currentUser = new User();\n    currentUser.loadFromApi(User.CURRENT_ID_STR, options);\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\nvar UserCollection = Backbone.Collection.extend(_baseMvc2.default.LoggableMixin).extend({\n    model: User,\n    urlRoot: function urlRoot() {\n        return Galaxy.root + \"api/users\";\n    }\n    //logger  : console,\n});\n\n//==============================================================================\nexports.default = {\n    User: User\n};\n\n/***/ }),\n/* 40 */,\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _menu = __webpack_require__(42);\n\nvar _menu2 = _interopRequireDefault(_menu);\n\nvar _scratchbook = __webpack_require__(44);\n\nvar _scratchbook2 = _interopRequireDefault(_scratchbook);\n\nvar _userQuotameter = __webpack_require__(46);\n\nvar _userQuotameter2 = _interopRequireDefault(_userQuotameter);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.options = options;\n        this.setElement(this._template());\n        this.$navbarBrandLink = this.$(\".navbar-brand-link\");\n        this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n        this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n        this.$navbarTabs = this.$(\".navbar-tabs\");\n        this.$quoteMeter = this.$(\".quota-meter-container\");\n\n        // build tabs\n        this.collection = new _menu2.default.Collection();\n        this.collection.on(\"add\", function (model) {\n            self.$navbarTabs.append(new _menu2.default.Tab({ model: model }).render().$el);\n        }).on(\"reset\", function () {\n            self.$navbarTabs.empty();\n        }).on(\"dispatch\", function (callback) {\n            self.collection.each(function (m) {\n                callback(m);\n            });\n        }).fetch(this.options);\n\n        // scratchbook\n        Galaxy.frame = this.frame = new _scratchbook2.default({\n            collection: this.collection\n        });\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new _userQuotameter2.default.UserQuotaMeter({\n            model: Galaxy.user,\n            el: this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $(window).on(\"click\", function (e) {\n            var $download_link = $(e.target).closest(\"a[download]\");\n            if ($download_link.length == 1) {\n                if ($(\"iframe[id=download]\").length === 0) {\n                    $(\"body\").append($(\"<iframe/>\").attr(\"id\", \"download\").hide());\n                }\n                $(\"iframe[id=download]\").attr(\"src\", $download_link.attr(\"href\"));\n                e.preventDefault();\n            }\n        }).on(\"beforeunload\", function () {\n            var text = \"\";\n            self.collection.each(function (model) {\n                var q = model.get(\"onbeforeunload\") && model.get(\"onbeforeunload\")();\n                q && (text += q + \" \");\n            });\n            if (text !== \"\") {\n                return text;\n            }\n        });\n    },\n\n    render: function render() {\n        this.$navbarBrandTitle.html(\"Galaxy \" + (this.options.brand && \"/ \" + this.options.brand || \"\"));\n        this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n        this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n        this.quotaMeter.render();\n        return this;\n    },\n\n    /** body template */\n    _template: function _template() {\n        return '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' + '<div class=\"navbar-header\">' + '<div class=\"navbar-tabs\"/>' + \"</div>\" + '<div class=\"navbar-brand\">' + '<a class=\"navbar-brand-link\">' + '<img class=\"navbar-brand-image\"/>' + '<span class=\"navbar-brand-title\"/>' + \"</a>\" + \"</div>\" + '<div class=\"quota-meter-container\"/>' + '<div class=\"navbar-icons\"/>' + \"</div>\";\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, jQuery, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _genericNavView = __webpack_require__(43);\n\nvar _genericNavView2 = _interopRequireDefault(_genericNavView);\n\nvar _webhooks = __webpack_require__(13);\n\nvar _webhooks2 = _interopRequireDefault(_webhooks);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Masthead Collection **/\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function fetch(options) {\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new _genericNavView2.default.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: (0, _localization2.default)(\"Analyze Data\"),\n            url: \"\",\n            tooltip: (0, _localization2.default)(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: (0, _localization2.default)(\"Workflow\"),\n            tooltip: (0, _localization2.default)(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflow\"\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: (0, _localization2.default)(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: (0, _localization2.default)(\"Access published resources\"),\n            menu: [{\n                title: (0, _localization2.default)(\"Data Libraries\"),\n                url: \"library/list\"\n            }, {\n                title: (0, _localization2.default)(\"Histories\"),\n                url: \"histories/list_published\"\n            }, {\n                title: (0, _localization2.default)(\"Workflows\"),\n                url: \"workflows/list_published\"\n            }, {\n                title: (0, _localization2.default)(\"Visualizations\"),\n                url: \"visualizations/list_published\"\n            }, {\n                title: (0, _localization2.default)(\"Pages\"),\n                url: \"pages/list_published\"\n            }]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: (0, _localization2.default)(\"Visualization\"),\n            url: \"visualizations/list\",\n            tooltip: (0, _localization2.default)(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [{\n                title: (0, _localization2.default)(\"New Track Browser\"),\n                url: \"visualization/trackster\",\n                target: \"_frame\"\n            }, {\n                title: (0, _localization2.default)(\"Saved Visualizations\"),\n                url: \"visualizations/list\",\n                target: \"_frame\"\n            }, {\n                title: (0, _localization2.default)(\"Interactive Environments\"),\n                url: \"visualization/gie_list\",\n                target: \"galaxy_main\"\n            }]\n        });\n\n        //\n        // Webhooks\n        //\n        _webhooks2.default.add({\n            url: \"api/webhooks/masthead/all\",\n            callback: function callback(webhooks) {\n                $(document).ready(function () {\n                    $.each(webhooks.models, function (index, model) {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.name,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                onclick: webhook.config.function && new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            _utils2.default.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get(\"is_admin\") && this.add({\n            id: \"admin\",\n            title: (0, _localization2.default)(\"Admin\"),\n            url: \"admin\",\n            tooltip: (0, _localization2.default)(\"Administer this Galaxy\"),\n            cls: \"admin-only\"\n        });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: (0, _localization2.default)(\"Help\"),\n            tooltip: (0, _localization2.default)(\"Support, contact, and community\"),\n            menu: [{\n                title: (0, _localization2.default)(\"Support\"),\n                url: options.support_url,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"Search\"),\n                url: options.search_url,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"Mailing Lists\"),\n                url: options.mailing_lists,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"Videos\"),\n                url: options.screencasts_url,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"Wiki\"),\n                url: options.wiki_url,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"How to Cite Galaxy\"),\n                url: options.citation_url,\n                target: \"_blank\"\n            }, {\n                title: (0, _localization2.default)(\"Interactive Tours\"),\n                url: \"tours\"\n            }]\n        };\n        options.terms_url && helpTab.menu.push({\n            title: (0, _localization2.default)(\"Terms and Conditions\"),\n            url: options.terms_url,\n            target: \"_blank\"\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title: (0, _localization2.default)(\"Ask a question\"),\n            url: \"biostar/biostar_question_redirect\",\n            target: \"_blank\"\n        });\n        options.biostar_url && helpTab.menu.unshift({\n            title: (0, _localization2.default)(\"Galaxy Biostar\"),\n            url: options.biostar_url_redirect,\n            target: \"_blank\"\n        });\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: (0, _localization2.default)(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    tooltip: (0, _localization2.default)(\"Account registration or login\"),\n                    menu: [{\n                        title: (0, _localization2.default)(\"Login\"),\n                        url: \"user/login\",\n                        target: \"galaxy_main\",\n                        noscratchbook: true\n                    }, {\n                        title: (0, _localization2.default)(\"Register\"),\n                        url: \"user/create\",\n                        target: \"galaxy_main\",\n                        noscratchbook: true\n                    }]\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: (0, _localization2.default)(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: (0, _localization2.default)(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: (0, _localization2.default)(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: (0, _localization2.default)(\"Account and saved data\"),\n                menu: [{\n                    title: (0, _localization2.default)(\"Logged in as\") + \" \" + Galaxy.user.get(\"email\")\n                }, {\n                    title: (0, _localization2.default)(\"Preferences\"),\n                    url: \"user\"\n                }, {\n                    title: (0, _localization2.default)(\"Custom Builds\"),\n                    url: \"custom_builds\"\n                }, {\n                    title: (0, _localization2.default)(\"Logout\"),\n                    url: \"user/logout?session_csrf_token=\" + Galaxy.session_csrf_token,\n                    target: \"_top\",\n                    divider: true\n                }, {\n                    title: (0, _localization2.default)(\"Saved Histories\"),\n                    url: \"histories/list\",\n                    target: \"_top\"\n                }, {\n                    title: (0, _localization2.default)(\"Saved Datasets\"),\n                    url: \"datasets/list\",\n                    target: \"_top\"\n                }, {\n                    title: (0, _localization2.default)(\"Saved Pages\"),\n                    url: \"pages/list\",\n                    target: \"_top\"\n                }]\n            };\n        }\n        this.add(userTab);\n        var activeView = this.get(options.active_view);\n        activeView && activeView.set(\"active\", true);\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function initialize(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$dropdown = this.$(\".dropdown\");\n        this.$toggle = this.$(\".dropdown-toggle\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.$note = this.$(\".dropdown-note\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .dropdown-toggle\": \"_toggleClick\"\n    },\n\n    render: function render() {\n        var self = this;\n        $(\".tooltip\").remove();\n        this.$el.attr(\"id\", this.model.id).css({\n            visibility: this.model.get(\"visible\") && \"visible\" || \"hidden\"\n        });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note.html(this.model.get(\"note\") || \"\").removeClass().addClass(\"dropdown-note\").addClass(this.model.get(\"note_cls\")).css({\n            display: this.model.get(\"show_note\") && \"block\" || \"none\"\n        });\n        this.$toggle.html(this.model.get(\"title\") || \"\").removeClass().addClass(\"dropdown-toggle\").addClass(this.model.get(\"cls\")).addClass(this.model.get(\"icon\") && \"dropdown-icon fa \" + this.model.get(\"icon\")).addClass(this.model.get(\"toggle\") && \"toggle\").attr(\"target\", this.model.get(\"target\")).attr(\"href\", this.model.get(\"url\")).attr(\"title\", this.model.get(\"tooltip\")).tooltip(\"destroy\");\n        this.model.get(\"tooltip\") && this.$toggle.tooltip({ placement: \"bottom\" });\n        this.$dropdown.removeClass().addClass(\"dropdown\").addClass(this.model.get(\"disabled\") && \"disabled\").addClass(this.model.get(\"active\") && \"active\");\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\").show().off().on(\"click\", function () {\n                $(\"#dd-helper\").hide();\n                self.model.set(\"show_menu\", false);\n            });\n        } else {\n            self.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass(\"dropdown-menu\");\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), function (menuItem) {\n                self.$menu.append(self._buildMenuItem(menuItem));\n                menuItem.divider && self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n            });\n            self.$menu.addClass(\"dropdown-menu\");\n            self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function _buildMenuItem(options) {\n        var self = this;\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = self._formatUrl(options.url);\n        return $(\"<li/>\").append($(\"<a/>\").attr(\"href\", options.url).attr(\"target\", options.target).html(options.title).on(\"click\", function (e) {\n            e.preventDefault();\n            self.model.set(\"show_menu\", false);\n            if (options.onclick) {\n                options.onclick();\n            } else {\n                Galaxy.frame.add(options);\n            }\n        }));\n    },\n\n    /** Handle click event */\n    _toggleClick: function _toggleClick(e) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", function (m) {\n            model.id !== m.id && m.get(\"menu\") && m.set(\"show_menu\", false);\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                model.get(\"onclick\") ? model.get(\"onclick\")() : Galaxy.frame.add(model.attributes);\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            var buildLink = function buildLink(label, url) {\n                return $(\"<div/>\").append($(\"<a/>\").attr(\"href\", Galaxy.root + url).html(label)).html();\n            };\n\n            this.$toggle.popover && this.$toggle.popover(\"destroy\");\n            this.$toggle.popover({\n                html: true,\n                placement: \"bottom\",\n                content: \"Please \" + buildLink(\"login\", \"user/login?use_panels=True\") + \" or \" + buildLink(\"register\", \"user/create?use_panels=True\") + \" to use this feature.\"\n            }).popover(\"show\");\n            setTimeout(function () {\n                self.$toggle.popover(\"destroy\");\n            }, 5000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function _formatUrl(url) {\n        return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function _template() {\n        return '<ul class=\"nav navbar-nav\">' + '<li class=\"dropdown\">' + '<a class=\"dropdown-toggle\"/>' + '<ul class=\"dropdown-menu\"/>' + '<div class=\"dropdown-note\"/>' + \"</li>\" + \"</ul>\";\n    }\n});\n\nexports.default = {\n    Collection: Collection,\n    Tab: Tab\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar GenericNavView = Backbone.View.extend({\n    initialize: function initialize() {\n        this.modal = null;\n    },\n\n    /** makes bootstrap modal and iframe inside it */\n    makeModalIframe: function makeModalIframe(e) {\n        // make modal\n        var host = window.Galaxy.config.communication_server_host;\n\n        var port = window.Galaxy.config.communication_server_port;\n        var username = escape(window.Galaxy.user.attributes.username);\n\n        var persistent_communication_rooms = escape(window.Galaxy.config.persistent_communication_rooms);\n\n        var query_string = '?username=' + username + '&persistent_communication_rooms=' + persistent_communication_rooms;\n\n        var src = host + ':' + port + query_string;\n        var $el_chat_modal_header = null;\n        var $el_chat_modal_body = null;\n\n        var iframe_template = '<iframe class=\"f-iframe fade in communication-iframe\" src=\"' + src + '\"> </iframe>';\n\n        var header_template = '<i class=\"fa fa-comment\" aria-hidden=\"true\" title=\"Communicate with other users\"></i>' + '<i class=\"fa fa-expand expand-compress-modal\" aria-hidden=\"true\" title=\"Maximize\"></i>' + '<i class=\"fa fa-times close-modal\" aria-hidden=\"true\" title=\"Close\"></i>';\n\n        var frame_height = 350;\n        var frame_width = 600;\n        var class_names = \"ui-modal chat-modal\";\n\n        // deletes the chat modal if already present and create one\n        if ($(\".chat-modal\").length > 0) {\n            $(\".chat-modal\").remove();\n        }\n        // creates a modal\n        GenericNavView.modal = new _uiModal2.default.View({\n            body: iframe_template,\n            height: frame_height,\n            width: frame_width,\n            closing_events: true,\n            title_separator: false,\n            cls: class_names\n        });\n\n        // shows modal\n        GenericNavView.modal.show();\n        $el_chat_modal_header = $(\".chat-modal .modal-header\");\n        $el_chat_modal_body = $(\".chat-modal .modal-body\");\n        // adjusts the css of bootstrap modal for chat\n        $el_chat_modal_header.addClass(\"modal-header-body\");\n        $el_chat_modal_body.addClass(\"modal-header-body\");\n        $el_chat_modal_header.find(\"h4\").remove();\n        $el_chat_modal_header.removeAttr(\"min-height padding border\");\n        $el_chat_modal_header.append(header_template);\n        // click event of the close button for chat\n        $(\".close-modal\").click(function (e) {\n            $(\".chat-modal\").css(\"display\", \"none\");\n        });\n        // click event of expand and compress icon\n        $(\".expand-compress-modal\").click(function (e) {\n            if ($(\".expand-compress-modal\").hasClass(\"fa-expand\")) {\n                $(\".chat-modal .modal-dialog\").width(\"1000px\");\n                $(\".chat-modal .modal-body\").height(\"575px\");\n                $(\".expand-compress-modal\").removeClass(\"fa-expand\").addClass(\"fa-compress\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Minimize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"96.2%\");\n            } else {\n                $(\".chat-modal .modal-dialog\").width(frame_width + 'px');\n                $(\".chat-modal .modal-body\").height(frame_height + 'px');\n                $(\".expand-compress-modal\").removeClass(\"fa-compress\").addClass(\"fa-expand\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Maximize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"93.2%\");\n            }\n        });\n        return this;\n    },\n\n    /**renders the chat icon as a nav item*/\n    render: function render() {\n        var self = this;\n        var navItem = {};\n        navItem = {\n            id: \"show-chat-online\",\n            icon: \"fa-comment-o\",\n            tooltip: \"Chat online\",\n            visible: false,\n            onclick: self.makeModalIframe\n        };\n        return navItem;\n    }\n}); /** Real-time Communication feature **/\nexports.default = {\n    GenericNavView: GenericNavView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _uiFrames = __webpack_require__(16);\n\nvar _uiFrames2 = _interopRequireDefault(_uiFrames);\n\nvar _data = __webpack_require__(10);\n\nvar _data2 = _interopRequireDefault(_data);\n\nvar _visualization = __webpack_require__(7);\n\nvar _visualization2 = _interopRequireDefault(_visualization);\n\nvar _trackster = __webpack_require__(26);\n\nvar _trackster2 = _interopRequireDefault(_trackster);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        options = options || {};\n        this.frames = new _uiFrames2.default.View({ visible: false });\n        this.setElement(this.frames.$el);\n        this.buttonActive = options.collection.add({\n            id: \"enable-scratchbook\",\n            icon: \"fa-th\",\n            tooltip: (0, _localization2.default)(\"Enable/Disable Scratchbook\"),\n            onclick: function onclick() {\n                self.active = !self.active;\n                self.buttonActive.set({\n                    toggle: self.active,\n                    show_note: self.active,\n                    note_cls: self.active && \"fa fa-check\"\n                });\n                !self.active && self.frames.hide();\n            },\n            onbeforeunload: function onbeforeunload() {\n                if (self.frames.length() > 0) {\n                    return \"You opened \" + self.frames.length() + \" frame(s) which will be lost.\";\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id: \"show-scratchbook\",\n            icon: \"fa-eye\",\n            tooltip: (0, _localization2.default)(\"Show/Hide Scratchbook\"),\n            show_note: true,\n            visible: false,\n            onclick: function onclick(e) {\n                self.frames.visible ? self.frames.hide() : self.frames.show();\n            }\n        });\n        this.frames.on(\"add remove\", function () {\n            this.visible && this.length() == 0 && this.hide();\n            self.buttonLoad.set({\n                note: this.length(),\n                visible: this.length() > 0\n            });\n        }).on(\"show hide \", function () {\n            self.buttonLoad.set({\n                toggle: this.visible,\n                icon: this.visible && \"fa-eye\" || \"fa-eye-slash\"\n            });\n        });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function addDataset(dataset_id) {\n        var self = this;\n        var current_dataset = null;\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[history_id] = {\n                name: Galaxy.currHistoryPanel.model.get(\"name\"),\n                dataset_ids: []\n            };\n            Galaxy.currHistoryPanel.collection.each(function (model) {\n                !model.get(\"deleted\") && model.get(\"visible\") && self.history_cache[history_id].dataset_ids.push(model.get(\"id\"));\n            });\n        }\n        var _findDataset = function _findDataset(dataset, offset) {\n            if (dataset) {\n                var history_details = self.history_cache[dataset.get(\"history_id\")];\n                if (history_details && history_details.dataset_ids) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf(dataset.get(\"id\"));\n                    if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n                        return dataset_list[pos + offset];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = function _loadDatasetOffset(dataset, offset, frame) {\n            var new_dataset_id = _findDataset(dataset, offset);\n            if (new_dataset_id) {\n                self._loadDataset(new_dataset_id, function (new_dataset, config) {\n                    current_dataset = new_dataset;\n                    frame.model.set(config);\n                });\n            } else {\n                frame.model.trigger(\"change\");\n            }\n        };\n        this._loadDataset(dataset_id, function (dataset, config) {\n            current_dataset = dataset;\n            self.add(_.extend({\n                menu: [{\n                    icon: \"fa fa-chevron-circle-left\",\n                    tooltip: \"Previous in History\",\n                    onclick: function onclick(frame) {\n                        _loadDatasetOffset(current_dataset, -1, frame);\n                    },\n                    disabled: function disabled() {\n                        return !_findDataset(current_dataset, -1);\n                    }\n                }, {\n                    icon: \"fa fa-chevron-circle-right\",\n                    tooltip: \"Next in History\",\n                    onclick: function onclick(frame) {\n                        _loadDatasetOffset(current_dataset, 1, frame);\n                    },\n                    disabled: function disabled() {\n                        return !_findDataset(current_dataset, 1);\n                    }\n                }]\n            }, config));\n        });\n    },\n\n    _loadDataset: function _loadDataset(dataset_id, callback) {\n        var self = this;\n        var dataset = new _data2.default.Dataset({ id: dataset_id });\n        $.when(dataset.fetch()).then(function () {\n            var is_tabular = _.find([\"tabular\", \"interval\"], function (data_type) {\n                return dataset.get(\"data_type\").indexOf(data_type) !== -1;\n            });\n            var title = dataset.get(\"name\");\n            var history_details = self.history_cache[dataset.get(\"history_id\")];\n            if (history_details) {\n                title = history_details.name + \": \" + title;\n            }\n            callback(dataset, is_tabular ? {\n                title: title,\n                url: null,\n                content: _data2.default.createTabularDatasetChunkedView({\n                    model: new _data2.default.TabularDataset(dataset.toJSON()),\n                    embedded: true,\n                    height: \"100%\"\n                }).$el\n            } : {\n                title: title,\n                url: Galaxy.root + \"datasets/\" + dataset_id + \"/display/?preview=True\",\n                content: null\n            });\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function addTrackster(viz_id) {\n        var self = this;\n        var viz = new _visualization2.default.Visualization({ id: viz_id });\n        $.when(viz.fetch()).then(function () {\n            var ui = new _trackster2.default.TracksterUI(Galaxy.root);\n\n            // Construct frame config based on dataset's type.\n            var frame_config = {\n                title: viz.get(\"name\"),\n                type: \"other\",\n                content: function content(parent_elt) {\n                    // Create view config.\n                    var view_config = {\n                        container: parent_elt,\n                        name: viz.get(\"title\"),\n                        id: viz.id,\n                        // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                        dbkey: viz.get(\"dbkey\"),\n                        stand_alone: false\n                    };\n\n                    var latest_revision = viz.get(\"latest_revision\");\n                    var drawables = latest_revision.config.view.drawables;\n\n                    // Set up datasets in drawables.\n                    _.each(drawables, function (d) {\n                        d.dataset = {\n                            hda_ldda: d.hda_ldda,\n                            id: d.dataset_id\n                        };\n                    });\n                    view = ui.create_visualization(view_config, latest_revision.config.viewport, latest_revision.config.view.drawables, latest_revision.config.bookmarks, false);\n                }\n            };\n            self.add(frame_config);\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function add(options) {\n        if (options.target == \"_blank\") {\n            window.open(options.url);\n        } else if (options.target == \"_top\" || options.target == \"_parent\" || options.target == \"_self\") {\n            window.location = options.url;\n        } else if (!this.active || options.noscratchbook) {\n            var $galaxy_main = $(window.parent.document).find(\"#galaxy_main\");\n            if (options.target == \"galaxy_main\" || options.target == \"center\") {\n                if ($galaxy_main.length === 0) {\n                    window.location = options.url + (options.url.indexOf(\"?\") == -1 ? \"?\" : \"&\") + \"use_panels=True\";\n                } else {\n                    $galaxy_main.attr(\"src\", options.url);\n                }\n            } else window.location = options.url;\n        } else {\n            this.frames.add(options);\n        }\n    }\n}); /** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 45 */,\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class View to display a user's disk/storage usage\n *      either as a progress bar representing the percentage of a quota used\n *      or a simple text element displaying the human readable size used.\n *  @name UserQuotaMeter\n *  @augments Backbone.View\n */\nvar UserQuotaMeter = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(\n/** @lends UserQuotaMeter.prototype */{\n    _logNamespace: logNamespace,\n\n    /** Defaults for optional settings passed to initialize */\n    options: {\n        warnAtPercent: 85,\n        errorAtPercent: 100\n    },\n\n    /** Set up, accept options, and bind events */\n    initialize: function initialize(options) {\n        this.log(this + \".initialize:\", options);\n        _.extend(this.options, options);\n\n        //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n        this.listenTo(this.model, \"change:quota_percent change:total_disk_usage\", this.render);\n    },\n\n    /** Re-load user model data from the api */\n    update: function update(options) {\n        this.log(this + \" updating user data...\", options);\n        this.model.loadFromApi(this.model.get(\"id\"), options);\n        return this;\n    },\n\n    /** Is the user over their quota (if there is one)?\n     * @returns {Boolean} true if over quota, false if no quota or under quota\n     */\n    isOverQuota: function isOverQuota() {\n        return this.model.get(\"quota_percent\") !== null && this.model.get(\"quota_percent\") >= this.options.errorAtPercent;\n    },\n\n    /** Render the meter when they have an applicable quota. Will render as a progress bar\n     *      with their percentage of that quota in text over the bar.\n     *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n     *  @fires quota:under when user is under quota\n     *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n     *  @fires quota:under:ok when user is below this.warnAtPercent\n     *  @returns {jQuery} the rendered meter\n     */\n    _render_quota: function _render_quota() {\n        var modelJson = this.model.toJSON();\n\n        var //prevPercent = this.model.previous( 'quota_percent' ),\n        percent = modelJson.quota_percent;\n\n        var //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n        $meter = $(this._templateQuotaMeter(modelJson));\n\n        var $bar = $meter.find(\".progress-bar\");\n        //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\n        // OVER QUOTA: color the quota bar and show the quota error message\n        if (this.isOverQuota()) {\n            //this.log( '\\t over quota' );\n            $bar.attr(\"class\", \"progress-bar progress-bar-danger\");\n            $meter.find(\".quota-meter-text\").css(\"color\", \"white\");\n            //TODO: only trigger event if state has changed\n            this.trigger(\"quota:over\", modelJson);\n\n            // APPROACHING QUOTA: color the quota bar\n        } else if (percent >= this.options.warnAtPercent) {\n            //this.log( '\\t approaching quota' );\n            $bar.attr(\"class\", \"progress-bar progress-bar-warning\");\n            //TODO: only trigger event if state has changed\n            this.trigger(\"quota:under quota:under:approaching\", modelJson);\n\n            // otherwise, hide/don't use the msg box\n        } else {\n            $bar.attr(\"class\", \"progress-bar progress-bar-success\");\n            //TODO: only trigger event if state has changed\n            this.trigger(\"quota:under quota:under:ok\", modelJson);\n        }\n        return $meter;\n    },\n\n    /** Render the meter when the user has NO applicable quota. Will render as text\n     *      showing the human readable sum storage their data is using.\n     *  @returns {jQuery} the rendered text\n     */\n    _render_usage: function _render_usage() {\n        //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n        var usage = $(this._templateUsage(this.model.toJSON()));\n        this.log(this + \".rendering usage:\", usage);\n        return usage;\n    },\n\n    /** Render either the quota percentage meter or the human readable disk usage\n     *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n     *  @returns {Object} this UserQuotaMeter\n     */\n    render: function render() {\n        //this.log( this + '.rendering' );\n        var meterHtml = null;\n\n        // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n        this.log(this + \".model.quota_percent:\", this.model.get(\"quota_percent\"));\n        if (this.model.get(\"quota_percent\") === null || this.model.get(\"quota_percent\") === undefined) {\n            meterHtml = this._render_usage();\n\n            // otherwise, render percent of quota (and warning, error)\n        } else {\n            meterHtml = this._render_quota();\n            //TODO: add the original text for unregistered quotas\n            //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n        }\n\n        this.$el.html(meterHtml);\n        this.$el.find(\".quota-meter-text\").tooltip();\n        return this;\n    },\n\n    _templateQuotaMeter: function _templateQuotaMeter(data) {\n        return ['<div id=\"quota-meter\" class=\"quota-meter progress\">', '<div class=\"progress-bar\" style=\"width: ', data.quota_percent, '%\"></div>', '<div class=\"quota-meter-text\" data-placement=\"left\" style=\"top: 6px\"', data.nice_total_disk_usage ? \" title=\\\"Using \" + data.nice_total_disk_usage + \".  This value is recalculated when you log out.\\\">\" : \">\", (0, _localization2.default)(\"Using\"), \" \", data.quota_percent, \"%\", \"</div>\", \"</div>\"].join(\"\");\n    },\n\n    _templateUsage: function _templateUsage(data) {\n        return ['<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">', '<div class=\"quota-meter-text\" data-placement=\"left\" data-original-title=\"This value is recalculated when you log out.\" style=\"top: 6px; color: white\">', data.nice_total_disk_usage ? (0, _localization2.default)(\"Using \") + data.nice_total_disk_usage : \"\", \"</div>\", \"</div>\"].join(\"\");\n    },\n\n    toString: function toString() {\n        return \"UserQuotaMeter(\" + this.model + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    UserQuotaMeter: UserQuotaMeter\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    optionsDefault: {\n        with_close: true,\n        title: null,\n        placement: \"top\",\n        container: \"body\",\n        body: null\n    },\n\n    initialize: function initialize(options) {\n        this.setElement(this._template());\n        this.uid = _utils2.default.uid();\n        this.options = _.defaults(options || {}, this.optionsDefault);\n        this.options.container.parent().append(this.el);\n        this.$title = this.$(\".popover-title-label\");\n        this.$close = this.$(\".popover-close\");\n        this.$body = this.$(\".popover-content\");\n\n        // add initial content\n        this.options.body && this.append(this.options.body);\n\n        // add event to hide if click is outside of popup and not on container\n        var self = this;\n        $(\"body\").on(\"mousedown.\" + this.uid, function (e) {\n            // the 'is' for buttons that trigger popups\n            // the 'has' for icons within a button that triggers a popup\n            self.visible && !$(self.options.container).is(e.target) && !$(self.el).is(e.target) && $(self.el).has(e.target).length === 0 && self.hide();\n        });\n    },\n\n    /**\n     * Render popover\n     */\n    render: function render() {\n        this.$title.html(this.options.title);\n        this.$el.removeClass().addClass(\"ui-popover popover fade in\").addClass(this.options.placement);\n        this.$el.css(this._get_placement(this.options.placement));\n\n        // configure close option\n        var self = this;\n        if (this.options.with_close) {\n            this.$close.on(\"click\", function () {\n                self.hide();\n            }).show();\n        } else {\n            this.$close.off().hide();\n        }\n    },\n\n    /**\n     * Set the popover title\n     * @params{ String }    newTitle    - New popover title\n     */\n    title: function title(newTitle) {\n        if (newTitle !== undefined) {\n            this.options.title = newTitle;\n            this.$title.html(newTitle);\n        }\n    },\n\n    /**\n     * Show popover\n     */\n    show: function show() {\n        this.render();\n        this.$el.show();\n        this.visible = true;\n    },\n\n    /**\n     * Hide popover\n     */\n    hide: function hide() {\n        this.$el.hide();\n        this.visible = false;\n    },\n\n    /**\n     * Append new content to the popover\n     * @params{ Object }  $el - Dom element\n     */\n    append: function append($el) {\n        this.$body.append($el);\n    },\n\n    /**\n     * Remove all content\n     */\n    empty: function empty() {\n        this.$body.empty();\n    },\n\n    /**\n     * Remove popover\n     */\n    remove: function remove() {\n        $(\"body\").off(\"mousedown.\" + this.uid);\n        this.$el.remove();\n    },\n\n    /**\n     * Improve popover location/placement\n     */\n    _get_placement: function _get_placement(placement) {\n        // get popover dimensions\n        var width = this._get_width(this.$el);\n        var height = this.$el.height();\n\n        // get container details\n        var $container = this.options.container;\n        var container_width = this._get_width($container);\n        var container_height = this._get_height($container);\n        var container_position = $container.position();\n\n        // get position\n        var top;\n\n        var left;\n        top = left = 0;\n        if ([\"top\", \"bottom\"].indexOf(placement) != -1) {\n            left = container_position.left - width + (container_width + width) / 2;\n            switch (placement) {\n                case \"top\":\n                    top = container_position.top - height - 5;\n                    break;\n                case \"bottom\":\n                    top = container_position.top + container_height + 5;\n                    break;\n            }\n        } else {\n            top = container_position.top - height + (container_height + height) / 2;\n            switch (placement) {\n                case \"right\":\n                    left = container_position.left + container_width;\n                    break;\n            }\n        }\n        return { top: top, left: left };\n    },\n\n    /**\n     * Returns padding/margin corrected width\n     */\n    _get_width: function _get_width($el) {\n        return $el.width() + parseInt($el.css(\"padding-left\")) + parseInt($el.css(\"margin-left\")) + parseInt($el.css(\"padding-right\")) + parseInt($el.css(\"margin-right\"));\n    },\n\n    /**\n     * Returns padding corrected height\n     */\n    _get_height: function _get_height($el) {\n        return $el.height() + parseInt($el.css(\"padding-top\")) + parseInt($el.css(\"padding-bottom\"));\n    },\n\n    /**\n     * Return the popover template\n     */\n    _template: function _template(options) {\n        return '<div class=\"ui-popover popover fade in\">' + '<div class=\"arrow\"/>' + '<div class=\"popover-title\">' + '<div class=\"popover-title-label\"/>' + '<div class=\"popover-close fa fa-times-circle\"/>' + \"</div>\" + '<div class=\"popover-content\"/>' + \"</div>\";\n    }\n}); /**\n     * Popover wrapper\n     */\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//==============================================================================\n/** Map of possible HDA/collection/job states to their string equivalents.\n *      A port of galaxy.model.Dataset.states.\n */\nvar STATES = {\n    // NOT ready states\n    /** is uploading and not ready */\n    UPLOAD: \"upload\",\n    /** the job that will produce the dataset queued in the runner */\n    QUEUED: \"queued\",\n    /** the job that will produce the dataset is running */\n    RUNNING: \"running\",\n    /** metadata for the dataset is being discovered/set */\n    SETTING_METADATA: \"setting_metadata\",\n\n    // ready states\n    /** was created without a tool */\n    NEW: \"new\",\n    /** has no data */\n    EMPTY: \"empty\",\n    /** has successfully completed running */\n    OK: \"ok\",\n\n    /** the job that will produce the dataset paused */\n    PAUSED: \"paused\",\n    /** metadata discovery/setting failed or errored (but otherwise ok) */\n    FAILED_METADATA: \"failed_metadata\",\n    //TODO: not in trans.app.model.Dataset.states - is in database\n    /** not accessible to the current user (i.e. due to permissions) */\n    NOT_VIEWABLE: \"noPermission\",\n    /** deleted while uploading */\n    DISCARDED: \"discarded\",\n    /** the tool producing this dataset failed */\n    ERROR: \"error\"\n};\n\nSTATES.READY_STATES = [STATES.OK, STATES.EMPTY, STATES.PAUSED, STATES.FAILED_METADATA, STATES.NOT_VIEWABLE, STATES.DISCARDED, STATES.ERROR];\n\nSTATES.NOT_READY_STATES = [STATES.UPLOAD, STATES.QUEUED, STATES.RUNNING, STATES.SETTING_METADATA, STATES.NEW];\n\n//==============================================================================\nexports.default = STATES;\n\n/***/ }),\n/* 49 */,\n/* 50 */,\n/* 51 */,\n/* 52 */,\n/* 53 */,\n/* 54 */,\n/* 55 */,\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * A plugin for initializing select2 input items.\n * Make sure the select2 library itself is loaded beforehand.\n * Also the element to which select2 will be appended has to\n * be created before select2 initialization (and passed as option).\n */\nvar View = Backbone.View.extend({\n    // options\n    optionsDefault: {\n        css: \"\",\n        placeholder: \"No data available\",\n        data: [],\n        value: null,\n        multiple: false,\n        minimumInputLength: 0,\n        // example format of initial data: \"id:name,55:anotherrole@role.com,27:role@role.com\"\n        initialData: \"\"\n    },\n\n    // initialize\n    initialize: function initialize(options) {\n        // configure options\n        this.options = _utils2.default.merge(options, this.optionsDefault);\n\n        // create new element\n        this.setElement(this._template(this.options));\n\n        // check if container exists\n        if (!this.options.container) {\n            console.log(\"ui-select::initialize() : container not specified.\");\n            return;\n        }\n\n        // add to dom\n        this.options.container.append(this.$el);\n\n        // link selection dictionary\n        this.select_data = this.options.data;\n\n        // refresh\n        this._refresh();\n\n        if (!this.options.multiple) {\n            // initial value\n            if (this.options.value) {\n                this._setValue(this.options.value);\n            }\n\n            // add change event\n            var self = this;\n            if (this.options.onchange) {\n                this.$el.on(\"change\", function () {\n                    self.options.onchange(self.value());\n                });\n            }\n        }\n    },\n\n    // value\n    value: function value(new_value) {\n        // get current id/value\n        var before = this._getValue();\n\n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        }\n\n        // get current id/value\n        var after = this._getValue();\n\n        // fire onchange\n        if (after != before && this.options.onchange) {\n            this.options.onchange(after);\n        }\n\n        // return current value\n        return after;\n    },\n\n    // label\n    text: function text() {\n        return this.$el.select2(\"data\").text;\n    },\n\n    // disabled\n    disabled: function disabled() {\n        return !this.$el.select2(\"enable\");\n    },\n\n    // enable\n    enable: function enable() {\n        this.$el.select2(\"enable\", true);\n    },\n\n    // disable\n    disable: function disable() {\n        this.$el.select2(\"enable\", false);\n    },\n\n    // add\n    add: function add(options) {\n        // add options\n        this.select_data.push({\n            id: options.id,\n            text: options.text\n        });\n\n        // refresh\n        this._refresh();\n    },\n\n    // remove\n    del: function del(id) {\n        // search option\n        var index = this._getIndex(id);\n\n        // check if found\n        if (index != -1) {\n            // remove options\n            this.select_data.splice(index, 1);\n\n            // refresh\n            this._refresh();\n        }\n    },\n\n    // remove\n    remove: function remove() {\n        this.$el.select2(\"destroy\");\n    },\n\n    // update\n    update: function update(options) {\n        // copy options\n        this.select_data = [];\n        for (var key in options.data) {\n            this.select_data.push(options.data[key]);\n        }\n\n        // refresh\n        this._refresh();\n    },\n\n    // refresh\n    _refresh: function _refresh() {\n        // add select2 data based on type of input\n        if (!this.options.multiple) {\n            var selected = this._getValue();\n            var select_opt = {\n                data: this.select_data,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                dropdownAutoWidth: true\n            };\n            this.$el.select2(select_opt);\n            // select previous value (if exists)\n            this._setValue(selected);\n        } else {\n            var select_opt = {\n                multiple: this.options.multiple,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                minimumInputLength: this.options.minimumInputLength,\n                ajax: this.options.ajax,\n                dropdownCssClass: this.options.dropdownCssClass,\n                escapeMarkup: this.options.escapeMarkup,\n                formatResult: this.options.formatResult,\n                formatSelection: this.options.formatSelection,\n                initSelection: this.options.initSelection,\n                initialData: this.options.initialData\n            };\n            this.$el.select2(select_opt);\n        }\n    },\n\n    // get index\n    _getIndex: function _getIndex(value) {\n        // returns the index of the searched value\n        _.findIndex(this.select_data, { id: value });\n    },\n\n    // get value\n    _getValue: function _getValue() {\n        return this.$el.select2(\"val\");\n    },\n\n    // set value\n    _setValue: function _setValue(new_value) {\n        var index = this._getIndex(new_value);\n        if (index == -1) {\n            if (this.select_data.length > 0) {\n                new_value = this.select_data[0].id;\n            }\n        }\n        this.$el.select2(\"val\", new_value);\n    },\n\n    // element\n    _template: function _template(options) {\n        return \"<input type=\\\"hidden\\\" value=\\\"\" + this.options.initialData + \"\\\"/>\";\n    }\n}); // dependencies\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\"use_strict\";\n\nvar $ = _jquery2.default;\n//============================================================================\n/** Returns a jQuery object containing a clickable font-awesome button.\n *      options:\n *          tooltipConfig   : option map for bootstrap tool tip\n *          classes         : array of class names (will always be classed as icon-btn)\n *          disabled        : T/F - add the 'disabled' class?\n *          title           : tooltip/title string\n *          target          : optional href target\n *          href            : optional href\n *          faIcon          : which font awesome icon to use\n *          onclick         : function to call when the button is clicked\n */\nvar faIconButton = function faIconButton(options) {\n    options = options || {};\n    options.tooltipConfig = options.tooltipConfig || {\n        placement: \"bottom\"\n    };\n\n    options.classes = [\"icon-btn\"].concat(options.classes || []);\n    if (options.disabled) {\n        options.classes.push(\"disabled\");\n    }\n\n    var html = ['<a class=\"', options.classes.join(\" \"), '\"', options.title ? \" title=\\\"\" + options.title + \"\\\"\" : \"\", !options.disabled && options.target ? \" target=\\\"\" + options.target + \"\\\"\" : \"\", ' href=\"', !options.disabled && options.href ? options.href : \"javascript:void(0);\", '\">',\n    // could go with something less specific here - like 'html'\n    '<span class=\"fa ', options.faIcon, '\"></span>', \"</a>\"].join(\"\");\n    var $button = $(html).tooltip(options.tooltipConfig);\n    if (_.isFunction(options.onclick)) {\n        $button.click(options.onclick);\n    }\n    return $button;\n};\n\n//============================================================================\nexports.default = faIconButton;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 58 */,\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _backbone = __webpack_require__(2);\n\nvar Backbone = _interopRequireWildcard(_backbone);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _userModel = __webpack_require__(39);\n\nvar _userModel2 = _interopRequireDefault(_userModel);\n\nvar _metricsLogger = __webpack_require__(60);\n\nvar _metricsLogger2 = _interopRequireDefault(_metricsLogger);\n\nvar _addLogging = __webpack_require__(21);\n\nvar _addLogging2 = _interopRequireDefault(_addLogging);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n// TODO: move into a singleton pattern and have dependents import Galaxy\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nfunction GalaxyApp(options, bootstrapped) {\n    var self = this;\n    return self._init(options || {}, bootstrapped || {});\n}\n\n// add logging shortcuts for this object\n(0, _addLogging2.default)(GalaxyApp, \"GalaxyApp\");\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = \"galaxy:debug\";\n\nvar NAMESPACE_KEY = DEBUGGING_KEY + \":namespaces\";\nvar FLATTEN_LOG_MESSAGES_KEY = DEBUGGING_KEY + \":flatten\";\n\nvar localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem(DEBUGGING_KEY) == \"true\";\n} catch (storageErr) {\n    console.log((0, _localization2.default)(\"localStorage not available for debug flag retrieval\"));\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function __init(options, bootstrapped) {\n    var self = this;\n    _.extend(self, Backbone.Events);\n    if (localDebugging) {\n        self.logger = console;\n        console.debug(\"debugging galaxy:\", \"options:\", options, \"bootstrapped:\", bootstrapped);\n    }\n\n    self._processOptions(options);\n\n    // add root and url parameters\n    self.root = options.root || \"/\";\n    self.params = options.params || {};\n    self.session_csrf_token = options.session_csrf_token || null;\n\n    self._initConfig(options.config || {});\n    self._patchGalaxy(window.Galaxy);\n\n    self._initLogger(self.options.loggerOptions || {});\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug(\"GalaxyApp.options: \", self.options);\n    self.debug(\"GalaxyApp.config: \", self.config);\n    self.debug(\"GalaxyApp.logger: \", self.logger);\n\n    self._initLocale();\n    self.debug(\"GalaxyApp.localize: \", self.localize);\n\n    self.config = options.config || {};\n    self.debug(\"GalaxyApp.config: \", self.config);\n\n    self._initUser(options.user || {});\n    self.debug(\"GalaxyApp.user: \", self.user);\n\n    self._setUpListeners();\n    self.trigger(\"ready\", self);\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing window.Galaxy object? */\n    patchExisting: true,\n    /** root url of this app */\n    root: \"/\",\n    session_csrf_token: null\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions(options) {\n    var self = this;\n    var defaults = self.defaultOptions;\n\n    self.options = {};\n    for (var k in defaults) {\n        if (defaults.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig(config) {\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n/** add an option from options if the key matches an option in defaultOptions */\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if (self.options.patchExisting && patchWith) {\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for (var k in patchWith) {\n            if (patchWith.hasOwnProperty(k)) {\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[k] = patchWith[k];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if (self.config.debug) {\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || _metricsLogger2.default.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(\",\");\n        } catch (storageErr) {}\n        try {\n            loggerOptions.consoleFlattenMessages = localStorage.getItem(FLATTEN_LOG_MESSAGES_KEY) == \"true\";\n        } catch (storageErr) {}\n        console.log(loggerOptions.consoleFlattenMessages);\n    }\n\n    self.logger = new _metricsLogger2.default.MetricsLogger(loggerOptions);\n    self.emit = {};\n    [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"].map(function (i) {\n        self.emit[i] = function (data) {\n            self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n        };\n    });\n\n    if (self.config.debug) {\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        _baseMvc2.default.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale(options) {\n    var self = this;\n    self.debug(\"_initLocale:\", options);\n    self.localize = _localization2.default;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser(userJSON) {\n    var self = this;\n    self.debug(\"_initUser:\", userJSON);\n    self.user = new _userModel2.default.User(userJSON);\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $(document).bind(\"ajaxSend\", function (ev, xhr, options) {\n        var data = options.data;\n        try {\n            data = JSON.parse(data);\n        } catch (err) {}\n\n        self.lastAjax = {\n            url: location.href.slice(0, -1) + options.url,\n            data: data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging(setting) {\n    var self = this;\n    try {\n        if (setting === undefined) {\n            return localStorage.getItem(DEBUGGING_KEY) === \"true\";\n        }\n        if (setting) {\n            localStorage.setItem(DEBUGGING_KEY, true);\n            return true;\n        }\n\n        localStorage.removeItem(DEBUGGING_KEY);\n        // also remove all namespaces\n        self.debuggingNamespaces(null);\n    } catch (storageErr) {\n        console.log((0, _localization2.default)(\"localStorage not available for debug flag retrieval\"));\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n    var self = this;\n    try {\n        if (namespaces === undefined) {\n            var csv = localStorage.getItem(NAMESPACE_KEY);\n            return typeof csv === \"string\" ? csv.split(\",\") : [];\n        } else if (namespaces === null) {\n            localStorage.removeItem(NAMESPACE_KEY);\n        } else {\n            localStorage.setItem(NAMESPACE_KEY, namespaces);\n        }\n        var newSettings = self.debuggingNamespaces();\n        if (self.logger) {\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch (storageErr) {\n        console.log((0, _localization2.default)(\"localStorage not available for debug namespace retrieval\"));\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString() {\n    var userEmail = this.user ? this.user.get(\"email\") || \"(anonymous)\" : \"uninitialized\";\n    return \"GalaxyApp(\" + userEmail + \")\";\n};\n\n// ============================================================================\nexports.default = {\n    GalaxyApp: GalaxyApp\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/*global window, jQuery, console */\n/*=============================================================================\nTODO:\n    while anon: logs saved to 'logs-null' - this will never post\n        unless we manually do so at/after login\n        OR prepend when userId and localStorage has 'logs-null'\n    wire up _delayPost and test\n\n=============================================================================*/\n/** @class MetricsLogger\n *\n *  Object to cache, output, and post log/metric messages to the server.\n *  Meant to be attached to the Galaxy object.\n *\n *  Log from objects by either attaching logger directly:\n *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n *  or using the LoggableMixin or addLogging function:\n *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n *      addLogging( MyBackboneModel, 'my-backbone-model' )\n *\n *  Log from templates by calling directly from Galaxy object:\n *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n *\n *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n *  appropriately, a warning will be shown when this happens:\n *      > panel.metric( 'something weird with window', { window : window })\n *      !'Metrics logger could not stringify logArguments: ...'\n */\nfunction MetricsLogger(options) {\n    options = options || {};\n    var self = this;\n\n    ///** get the current user's id from bootstrapped data or options */\n    self.userId = window.bootstrapped && window.bootstrapped.user ? window.bootstrapped.user.id : null;\n    self.userId = self.userId || options.userId || null;\n\n    /** the (optional) console to emit logs to */\n    self.consoleLogger = options.consoleLogger || null;\n\n    self._init(options);\n    return self;\n}\n\n//----------------------------------------------------------------------------- defaults and constants\n// see: python std lib, logging\nMetricsLogger.ALL = 0;\nMetricsLogger.LOG = 0;\nMetricsLogger.DEBUG = 10;\nMetricsLogger.INFO = 20;\nMetricsLogger.WARN = 30;\nMetricsLogger.ERROR = 40;\n// metrics levels here?\n//MetricsLogger.MinorEvent  = 45;\n//MetricsLogger.MajorEvent  = 50;\nMetricsLogger.METRIC = 50;\nMetricsLogger.NONE = 100;\n\n/** default options - override these through the constructor */\nMetricsLogger.defaultOptions = {\n    /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n    logLevel: MetricsLogger.NONE,\n    /** if an incoming message has a level >= this, it will be output to the console */\n    consoleLevel: MetricsLogger.NONE,\n    /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n    defaultNamespace: \"Galaxy\",\n    /** the namespaces output to the console (all namespaces will be output if this is falsy)\n     *  note: applies only to the console (not the event/metrics log/cache)\n     */\n    consoleNamespaceWhitelist: null,\n    /** Force all messages into simple strings. */\n    consoleFlattenMessages: false,\n    /** the prefix attached to client-side logs to distinguish them in the metrics db */\n    clientPrefix: \"client.\",\n\n    /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n    maxCacheSize: 3000,\n    /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n    postSize: 1000,\n    /** T/F whether to add a timestamp to incoming cached messages */\n    addTime: true,\n    /** string to prefix to userid for cache web storage */\n    cacheKeyPrefix: \"logs-\",\n\n    /** the relative url to post messages to */\n    postUrl: \"/api/metrics\",\n    /** delay before trying post again after two failures */\n    delayPostInMs: 1000 * 60 * 10,\n\n    /** an (optional) function that should return an object; used to send additional data with the metrics */\n    getPingData: undefined,\n    /** an (optional) function that will handle the servers response after successfully posting messages */\n    onServerResponse: undefined\n};\n\n//----------------------------------------------------------------------------- set up\n/** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\nMetricsLogger.prototype._init = function _init(options) {\n    var self = this;\n    self.options = {};\n    for (var k in MetricsLogger.defaultOptions) {\n        if (MetricsLogger.defaultOptions.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : MetricsLogger.defaultOptions[k];\n        }\n    }\n    self.options.logLevel = self._parseLevel(self.options.logLevel);\n    self.options.consoleLevel = self._parseLevel(self.options.consoleLevel);\n    //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\n    /** is the logger currently sending? */\n    self._sending = false;\n    /** the setTimeout id if the logger POST has failed more than once */\n    self._waiting = null;\n    /** the current number of entries to send in a POST */\n    self._postSize = self.options.postSize;\n\n    self._initCache();\n\n    return self;\n};\n\n/** initialize the cache */\nMetricsLogger.prototype._initCache = function _initCache() {\n    try {\n        this.cache = new LoggingCache({\n            maxSize: this.options.maxCacheSize,\n            key: this.options.cacheKeyPrefix + this.userId\n        });\n    } catch (err) {\n        this._emitToConsole(\"warn\", \"MetricsLogger\", [\"Could not intitialize logging cache:\", err]);\n        this.options.logLevel = MetricsLogger.NONE;\n    }\n};\n\n/** return the numeric log level if level in 'none, debug, log, info, warn, error' */\nMetricsLogger.prototype._parseLevel = function _parseLevel(level) {\n    var type = typeof level === \"undefined\" ? \"undefined\" : _typeof(level);\n    if (type === \"number\") {\n        return level;\n    }\n    if (type === \"string\") {\n        var upper = level.toUpperCase();\n        if (MetricsLogger.hasOwnProperty(upper)) {\n            return MetricsLogger[upper];\n        }\n    }\n    throw new Error(\"Unknown log level: \" + level);\n};\n\n//----------------------------------------------------------------------------- main entry point\n/** record a log/message's arguments to the cache and/or the console based on level and namespace */\nMetricsLogger.prototype.emit = function emit(level, namespace, logArguments) {\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n    var self = this;\n    namespace = namespace || self.options.defaultNamespace;\n    if (!level || !logArguments) {\n        return self;\n    }\n    // add to cache if proper level\n    //TODO: respect do not track?\n    //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n    level = self._parseLevel(level);\n    if (level >= self.options.logLevel) {\n        self._addToCache(level, namespace, logArguments);\n    }\n    // also emit to consoleLogger if proper level for that\n    if (self.consoleLogger && level >= self.options.consoleLevel) {\n        self._emitToConsole(level, namespace, logArguments);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- cache\n/** add a message to the cache and if messages.length is high enough post them to the server */\nMetricsLogger.prototype._addToCache = function _addToCache(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\"_addToCache:\", arguments, this.options.addTime, this.cache.length()]);\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n    var self = this;\n    // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n    try {\n        var newLength = self.cache.add(self._buildEntry(level, namespace, logArguments));\n        if (newLength >= self._postSize) {\n            self._postCache();\n        }\n        // discard entry if an error occurs, but warn if level set to do so\n    } catch (err) {\n        self._emitToConsole(\"warn\", \"MetricsLogger\", [\"Metrics logger could not stringify logArguments:\", namespace, logArguments]);\n        self._emitToConsole(\"error\", \"MetricsLogger\", [err]);\n    }\n    return self;\n};\n\n/** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\nMetricsLogger.prototype._buildEntry = function _buildEntry(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\"_buildEntry:\", arguments]);\n    var entry = {\n        level: level,\n        namespace: this.options.clientPrefix + namespace,\n        args: logArguments\n    };\n    if (this.options.addTime) {\n        entry.time = new Date().toISOString();\n    }\n    return entry;\n};\n\n/** post _postSize messages from the cache to the server, removing them if successful\n *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n *      onServerResponse will be called (if set) with any response from the server\n */\nMetricsLogger.prototype._postCache = function _postCache(options) {\n    options = options || {};\n    this._emitToConsole(\"info\", \"MetricsLogger\", [\"_postCache\", options, this._postSize]);\n\n    // short circuit if we're already sending\n    if (!this.options.postUrl || this._sending) {\n        return jQuery.when({});\n    }\n\n    var self = this;\n    var postSize = options.count || self._postSize;\n\n    var // do not splice - remove after *successful* post\n    entries = self.cache.get(postSize);\n\n    var entriesLength = entries.length;\n\n    var // use the optional getPingData to add any extra info we may want to send\n    postData = typeof self.options.getPingData === \"function\" ? self.options.getPingData() : {};\n\n    //console.debug( postSize, entriesLength );\n\n    // add the metrics and send\n    postData.metrics = JSON.stringify(entries);\n    //console.debug( postData.metrics );\n    self._sending = true;\n    return jQuery.post(self.options.postUrl, postData).always(function () {\n        self._sending = false;\n    }).fail(function (xhr, status, message) {\n        // if we failed the previous time, set the next post target to the max num of entries\n        self._postSize = self.options.maxCacheSize;\n        //TODO:??\n        // log this failure to explain any gap in metrics\n        self.emit(\"error\", \"MetricsLogger\", [\"_postCache error:\", xhr.readyState, xhr.status, xhr.responseJSON || xhr.responseText]);\n        //TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n        //TODO: see _delayPost\n    }).done(function (response) {\n        if (typeof self.options.onServerResponse === \"function\") {\n            self.options.onServerResponse(response);\n        }\n        // only remove if post successful\n        self.cache.remove(entriesLength);\n        //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n        // if we succeeded, reset the post target to the normal num of entries\n        self._postSize = self.options.postSize;\n    });\n    // return the xhr promise\n};\n\n/** set _waiting to true and, after delayPostInMs, set it back to false */\nMetricsLogger.prototype._delayPost = function _delayPost() {\n    //TODO: this won't work between pages\n    var self = this;\n    self._waiting = setTimeout(function () {\n        self._waiting = null;\n    }, self.options.delayPostInMs);\n};\n\nfunction usefulToString(arg) {\n    var asStr = String(arg);\n    if (asStr == \"[object Object]\") {\n        asStr = JSON.stringify(arg);\n    }\n    return asStr;\n}\n\n//----------------------------------------------------------------------------- console\n/** output message to console based on level and consoleLogger type */\nMetricsLogger.prototype._emitToConsole = function _emitToConsole(level, namespace, logArguments) {\n    //console.debug( '_emitToConsole:', level, namespace, logArguments );\n    var self = this;\n\n    var whitelist = self.options.consoleNamespaceWhitelist;\n    if (!self.consoleLogger) {\n        return self;\n    }\n    // if a whitelist for namespaces is set, bail if this namespace is not in the list\n    if (whitelist && whitelist.indexOf(namespace) === -1) {\n        return self;\n    }\n\n    var args = Array.prototype.slice.call(logArguments, 0);\n    args.unshift(namespace);\n    if (self.options.consoleFlattenMessages) {\n        args = [args.map(usefulToString).join(\" \")];\n    }\n    //TODO: script location and/or source maps?\n    //TODO: branch on navigator.userAgent == AIIEEE - it only has log\n    if (level >= MetricsLogger.METRIC && typeof self.consoleLogger.info === \"function\") {\n        return self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.ERROR && typeof self.consoleLogger.error === \"function\") {\n        return self.consoleLogger.error.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.WARN && typeof self.consoleLogger.warn === \"function\") {\n        self.consoleLogger.warn.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.INFO && typeof self.consoleLogger.info === \"function\") {\n        self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.DEBUG && typeof self.consoleLogger.debug === \"function\") {\n        self.consoleLogger.debug.apply(self.consoleLogger, args);\n    } else if (typeof self.consoleLogger.log === \"function\") {\n        self.consoleLogger.log.apply(self.consoleLogger, args);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- shortcuts\n// generic functions when logging from non-namespaced object (e.g. templates)\n/** log to default namespace */\nMetricsLogger.prototype.log = function log() {\n    this.emit(1, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** debug to default namespace */\nMetricsLogger.prototype.debug = function debug() {\n    this.emit(MetricsLogger.DEBUG, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** info to default namespace */\nMetricsLogger.prototype.info = function info() {\n    this.emit(MetricsLogger.INFO, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** warn to default namespace */\nMetricsLogger.prototype.warn = function warn() {\n    this.emit(MetricsLogger.WARN, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** error to default namespace */\nMetricsLogger.prototype.error = function error() {\n    this.emit(MetricsLogger.ERROR, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** metric to default namespace */\nMetricsLogger.prototype.metric = function metric() {\n    this.emit(MetricsLogger.METRIC, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/* ============================================================================\nTODO:\n    need a performance pass - the JSON un/parsing is a bit much\n\n============================================================================ */\n/** @class LoggingCache\n *  Simple implementation of cache wrapping an array.\n *\n *  Formats an entry before it's cached and only keeps options.maxSize number\n *  of entries. Older entries are deleted first.\n */\nfunction LoggingCache(options) {\n    var self = this;\n    return self._init(options || {});\n}\n\n/** default options */\nLoggingCache.defaultOptions = {\n    /** maximum number of entries to keep before discarding oldest */\n    maxSize: 5000\n};\n\n/** initialize with options */\nLoggingCache.prototype._init = function _init(options) {\n    if (!this._hasStorage()) {\n        //TODO: fall back to jstorage\n        throw new Error(\"LoggingCache needs localStorage\");\n    }\n    if (!options.key) {\n        throw new Error(\"LoggingCache needs key for localStorage\");\n    }\n    this.key = options.key;\n    this._initStorage();\n\n    this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n    return this;\n};\n\n/** tests for localStorage fns */\nLoggingCache.prototype._hasStorage = function _hasStorage() {\n    //TODO: modernizr\n    var test = \"test\";\n    try {\n        localStorage.setItem(test, test);\n        localStorage.removeItem(test);\n        return true;\n    } catch (e) {\n        return false;\n    }\n};\n\n/** if no localStorage set for key, initialize to empty array */\nLoggingCache.prototype._initStorage = function _initStorage() {\n    if (localStorage.getItem(this.key) === null) {\n        return this.empty();\n    }\n    return this;\n};\n\n/** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\nLoggingCache.prototype.add = function add(entry) {\n    var self = this;\n    var _cache = self._fetchAndParse();\n    var overage = _cache.length + 1 - self.maxSize;\n    if (overage > 0) {\n        _cache.splice(0, overage);\n    }\n    _cache.push(entry);\n    self._unparseAndStore(_cache);\n    return _cache.length;\n};\n\n/** get the entries from localStorage and parse them */\nLoggingCache.prototype._fetchAndParse = function _fetchAndParse() {\n    var self = this;\n    return JSON.parse(localStorage.getItem(self.key));\n};\n\n/** stringify the entries and put them in localStorage */\nLoggingCache.prototype._unparseAndStore = function _unparseAndStore(entries) {\n    var self = this;\n    return localStorage.setItem(self.key, JSON.stringify(entries));\n};\n\n///** process the entry before caching */\n//LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n//    return JSON.stringify( entry );\n//};\n\n/** return the length --- oh, getters where are you? */\nLoggingCache.prototype.length = function length() {\n    return this._fetchAndParse().length;\n};\n\n/** get count number of entries starting with the oldest */\nLoggingCache.prototype.get = function get(count) {\n    return this._fetchAndParse().slice(0, count);\n};\n\n/** remove count number of entries starting with the oldest */\nLoggingCache.prototype.remove = function remove(count) {\n    var _cache = this._fetchAndParse();\n    var removed = _cache.splice(0, count);\n    this._unparseAndStore(_cache);\n    return removed;\n};\n\n/** empty/clear the entire cache */\nLoggingCache.prototype.empty = function empty() {\n    localStorage.setItem(this.key, \"[]\");\n    return this;\n};\n\n/** stringify count number of entries (but do not remove) */\nLoggingCache.prototype.stringify = function stringify(count) {\n    return JSON.stringify(this.get(count));\n};\n\n/** outputs entire cache to console */\nLoggingCache.prototype.print = function print() {\n    // popup? (really, carl? a popup?) - easier to copy/paste\n    console.log(JSON.stringify(this._fetchAndParse(), null, \"  \"));\n};\n\n//=============================================================================\nexports.default = {\n    MetricsLogger: MetricsLogger,\n    LoggingCache: LoggingCache\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _masthead = __webpack_require__(41);\n\nvar _masthead2 = _interopRequireDefault(_masthead);\n\nvar _panel = __webpack_require__(58);\n\nvar _panel2 = _interopRequireDefault(_panel);\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    el: \"body\",\n    className: \"full-content\",\n    _panelids: [\"left\", \"right\"],\n\n    initialize: function initialize(options) {\n        var self = this;\n        this.config = _.defaults(options.config || {}, {\n            message_box_visible: false,\n            message_box_content: \"\",\n            message_box_class: \"info\",\n            show_inactivity_warning: false,\n            inactivity_box_content: \"\"\n        });\n\n        // attach global objects, build mastheads\n        Galaxy.modal = this.modal = new _uiModal2.default.View();\n        Galaxy.display = this.display = function (view) {\n            if (view.title) {\n                _utils2.default.setWindowTitle(view.title);\n                view.allow_title_display = false;\n            } else {\n                _utils2.default.setWindowTitle();\n                view.allow_title_display = true;\n            }\n            self.center.display(view);\n        };\n        Galaxy.router = this.router = options.Router && new options.Router(self, options);\n        this.masthead = new _masthead2.default.View(this.config);\n        this.center = new _panel2.default.CenterPanel();\n\n        // build page template\n        this.$el.attr(\"scroll\", \"no\");\n        this.$el.html(this._template());\n        this.$(\"#masthead\").replaceWith(this.masthead.$el);\n        this.$(\"#center\").append(this.center.$el);\n        this.$el.append(this.masthead.frame.$el);\n        this.$el.append(this.modal.$el);\n        this.$messagebox = this.$(\"#messagebox\");\n        this.$inactivebox = this.$(\"#inactivebox\");\n\n        // build panels\n        this.panels = {};\n        _.each(this._panelids, function (panel_id) {\n            var panel_class_name = panel_id.charAt(0).toUpperCase() + panel_id.slice(1);\n            var panel_class = options[panel_class_name];\n            if (panel_class) {\n                var panel_instance = new panel_class(self, options);\n                self[panel_instance.toString()] = panel_instance;\n                self.panels[panel_id] = new _panel2.default.SidePanel({\n                    id: panel_id,\n                    el: self.$(\"#\" + panel_id),\n                    view: panel_instance\n                });\n            }\n        });\n        this.render();\n\n        // start the router\n        this.router && Backbone.history.start({\n            root: Galaxy.root,\n            pushState: true\n        });\n    },\n\n    render: function render() {\n        // TODO: Remove this line after select2 update\n        $(\".select2-hidden-accessible\").remove();\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox: function renderMessageBox() {\n        if (this.config.message_box_visible) {\n            var content = this.config.message_box_content || \"\";\n            var level = this.config.message_box_class || \"info\";\n            this.$el.addClass(\"has-message-box\");\n            this.$messagebox.attr(\"class\", \"panel-\" + level + \"-message\").html(content).toggle(!!content).show();\n        } else {\n            this.$el.removeClass(\"has-message-box\");\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox: function renderInactivityBox() {\n        if (this.config.show_inactivity_warning) {\n            var content = this.config.inactivity_box_content || \"\";\n            var verificationLink = $(\"<a/>\").attr(\"href\", Galaxy.root + \"user/resend_verification\").text(\"Resend verification\");\n            this.$el.addClass(\"has-inactivity-box\");\n            this.$inactivebox.html(content + \" \").append(verificationLink).toggle(!!content).show();\n        } else {\n            this.$el.removeClass(\"has-inactivity-box\");\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels: function renderPanels() {\n        var self = this;\n        _.each(this._panelids, function (panel_id) {\n            var panel = self.panels[panel_id];\n            if (panel) {\n                panel.render();\n            } else {\n                self.$(\"#center\").css(panel_id, 0);\n                self.$(\"#\" + panel_id).hide();\n            }\n        });\n        return this;\n    },\n\n    /** body template */\n    _template: function _template() {\n        return ['<div id=\"everything\">', '<div id=\"background\"/>', '<div id=\"masthead\"/>', '<div id=\"messagebox\"/>', '<div id=\"inactivebox\" class=\"panel-warning-message\" />', '<div id=\"left\" />', '<div id=\"center\" />', '<div id=\"right\" />', \"</div>\", '<div id=\"dd-helper\" />'].join(\"\");\n    },\n\n    toString: function toString() {\n        return \"PageLayoutView\";\n    },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function _checkCommunicationServerOnline() {\n        var host = window.Galaxy.config.communication_server_host;\n        var port = window.Galaxy.config.communication_server_port;\n        var preferences = window.Galaxy.user.attributes.preferences;\n        var $chat_icon_element = $(\"#show-chat-online\");\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if (preferences && [\"1\", \"true\"].indexOf(preferences.communication_server) != -1) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: host + \":\" + port\n            }).success(function (data) {\n                // enable communication only when a user is logged in\n                if (window.Galaxy.user.id !== null) {\n                    if ($chat_icon_element.css(\"visibility\") === \"hidden\") {\n                        $chat_icon_element.css(\"visibility\", \"visible\");\n                    }\n                }\n            }).error(function (data) {\n                // hide the communication icon if the communication server is not available\n                $chat_icon_element.css(\"visibility\", \"hidden\");\n            });\n        } else {\n            $chat_icon_element.css(\"visibility\", \"hidden\");\n        }\n    }\n});\n\nexports.default = { View: View };\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 62 */,\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar Model = Backbone.Model.extend({\n    defaults: {\n        extension: \"auto\",\n        genome: \"?\",\n        url_paste: \"\",\n        status: \"init\",\n        info: null,\n        file_name: \"\",\n        file_mode: \"\",\n        file_size: 0,\n        file_type: null,\n        file_path: \"\",\n        file_data: null,\n        percentage: 0,\n        space_to_tab: false,\n        to_posix_lines: true,\n        enabled: true\n    },\n    reset: function reset(attr) {\n        this.clear().set(this.defaults).set(attr);\n    }\n});\nvar Collection = Backbone.Collection.extend({ model: Model });\nexports.default = { Model: Model, Collection: Collection };\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ }),\n/* 64 */,\n/* 65 */,\n/* 66 */,\n/* 67 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// =============================================================================\n/** A view on any model that has a 'tags' attribute (a list of tag strings)\n *      Incorporates the select2 jQuery plugin for tags display/editing:\n *      http://ivaynberg.github.io/select2/\n */\nvar TagsEditor = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.HiddenUntilActivatedViewMixin).extend({\n    tagName: \"div\",\n    className: \"tags-display\",\n    select_width: \"100%\",\n    events: {},\n\n    /** Set up listeners, parse options */\n    initialize: function initialize(options) {\n        //console.debug( this, options );\n        // only listen to the model only for changes to tags - re-render\n        this.show_editor = false;\n        if (options.usePrompt === false) {\n            this.label = \"\";\n        } else {\n            this.label = \"<label class=\\\"prompt\\\">\" + (0, _localization2.default)(\"Tags\") + \"</label>\";\n        }\n        this.workflow_mode = options.workflow_mode || false;\n        if (this.workflow_mode) {\n            this.events.click = \"showEditor\";\n            this.events.keydown = \"keydownHandler\";\n        }\n        this.hiddenUntilActivated(options.$activator, options);\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render: function render() {\n        var self = this;\n        if (this.workflow_mode) {\n            this.$el.html(this._workflowTemplate());\n        } else {\n            this.$el.html(this._defaultTemplate());\n        }\n        this.$input().select2({\n            placeholder: \"Add tags\",\n            width: this.workflow_mode ? this.width : this.select_width,\n            tags: function tags() {\n                // initialize possible tags in the dropdown based on all the tags the user has used so far\n                return self._getTagsUsed();\n            }\n        });\n\n        this._setUpBehaviors();\n        return this;\n    },\n\n    _hashToName: function _hashToName(tag) {\n        if (tag.startsWith(\"#\")) {\n            return \"name:\" + tag.slice(1);\n        }\n        return tag;\n    },\n\n    _nameToHash: function _nameToHash(tag) {\n        if (tag.startsWith(\"name:\")) {\n            tag = \"#\" + tag.slice(5);\n        }\n        return tag;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _defaultTemplate: function _defaultTemplate() {\n        return [this.label, this._renderEditor()].join(\"\");\n    },\n\n    _workflowTemplate: function _workflowTemplate() {\n        // Shows labels by default, event handler controls whether we show tags or editor\n        return [this.show_editor ? this._renderEditor() : this._renderTags()].join(\" \");\n    },\n\n    keydownHandler: function keydownHandler(e) {\n        switch (e.which) {\n            // esc\n            case 27:\n                // hide the tag editor when pressing escape\n                this.hideEditor();\n                break;\n        }\n    },\n\n    showEditor: function showEditor() {\n        this.show_editor = true;\n        this.render();\n    },\n\n    hideEditor: function hideEditor() {\n        this.show_editor = false;\n        this.render();\n    },\n\n    _renderEditor: function _renderEditor() {\n        // set up initial tags by adding as CSV to input vals (necc. to init select2)\n        return \"<input class=\\\"tags-input\\\" value=\\\"\" + this.tagsToCSV() + \"\\\"/>\";\n    },\n\n    _renderTags: function _renderTags() {\n        var tags = this.model.get(\"tags\");\n        var addButton = \"static/images/fugue/tag--plus.png\";\n        var renderedArray = [];\n        _.each(tags, function (tag) {\n            tag = tag.indexOf(\"name:\") == 0 ? tag.slice(5) : tag;\n            var renderString = \"<span class=\\\"label label-info\\\">\" + tag + \"</span>\";\n            renderedArray.push(renderString);\n        });\n        if (renderedArray.length === 0) {\n            // If there are no tags to render we just show the add-tag-button\n            renderedArray.push(\"<img src=\" + addButton + \" class=\\\"add-tag-button\\\" title=\\\"Add tags\\\"/>\");\n        }\n        return renderedArray.join(\" \");\n    },\n\n    /** @returns {String} the sorted, comma-separated tags from the model */\n    tagsToCSV: function tagsToCSV() {\n        var self = this;\n        var tagsArray = this.model.get(\"tags\");\n        if (!_.isArray(tagsArray) || _.isEmpty(tagsArray)) {\n            return \"\";\n        }\n        return tagsArray.map(function (tag) {\n            return _.escape(self._nameToHash(tag));\n        }).sort().join(\",\");\n    },\n\n    /** @returns {jQuery} the input for this view */\n    $input: function $input() {\n        return this.$el.find(\"input.tags-input\");\n    },\n\n    /** @returns {String[]} all tags used by the current user */\n    _getTagsUsed: function _getTagsUsed() {\n        //TODO: global\n        var self = this;\n        return _.map(Galaxy.user.get(\"tags_used\"), self._nameToHash);\n    },\n\n    /** set up any event listeners on the view's DOM (mostly handled by select2) */\n    _setUpBehaviors: function _setUpBehaviors() {\n        var self = this;\n        this.$input().on(\"change\", function (event) {\n            // Modify any 'hashtag' 'nametags'\n            event.val = _.map(event.val, self._hashToName);\n            // save the model's tags in either remove or added event\n            self.model.save({ tags: event.val });\n            // if it's new, add the tag to the users tags\n            if (event.added) {\n                //??: solve weird behavior in FF on test.galaxyproject.org where\n                //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n                self._addNewTagToTagsUsed(\"\" + event.added.text);\n            }\n        });\n    },\n\n    /** add a new tag (if not already there) to the list of all tags used by the user\n     *  @param {String} newTag  the tag to add to the list of used\n     */\n    _addNewTagToTagsUsed: function _addNewTagToTagsUsed(newTag) {\n        //TODO: global\n        var tagsUsed = Galaxy.user.get(\"tags_used\");\n        if (!_.contains(tagsUsed, newTag)) {\n            tagsUsed.push(newTag);\n            tagsUsed.sort();\n            Galaxy.user.set(\"tags_used\", tagsUsed);\n        }\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove: function remove() {\n        this.$input.off();\n        this.stopListening(this.model);\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return [\"TagsEditor(\", \"\" + this.model, \")\"].join(\"\");\n    }\n});\n\nexports.default = {\n    TagsEditor: TagsEditor\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ }),\n/* 68 */,\n/* 69 */,\n/* 70 */,\n/* 71 */,\n/* 72 */,\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _queryStringParsing = __webpack_require__(17);\n\nvar _queryStringParsing2 = _interopRequireDefault(_queryStringParsing);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar $ = _jquery2.default;\n\n\nvar Router = Backbone.Router.extend({\n    // TODO: not many client routes at this point - fill and remove from server.\n    // since we're at root here, this may be the last to be routed entirely on the client.\n    initialize: function initialize(page, options) {\n        this.page = page;\n        this.options = options;\n    },\n\n    /** helper to push a new navigation state */\n    push: function push(url, data) {\n        data = data || {};\n        data.__identifer = Math.random().toString(36).substr(2);\n        if (!$.isEmptyObject(data)) {\n            url += url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            url += $.param(data, true);\n        }\n        Galaxy.params = data;\n        this.navigate(url, { trigger: true });\n    },\n\n    /** override to parse query string into obj and send to each route */\n    execute: function execute(callback, args, name) {\n        Galaxy.debug(\"router execute:\", callback, args, name);\n        var queryObj = _queryStringParsing2.default.parse(args.pop());\n        args.push(queryObj);\n        if (callback) {\n            if (this.authenticate(args, name)) {\n                callback.apply(this, args);\n            } else {\n                this.access_denied();\n            }\n        }\n    },\n\n    authenticate: function authenticate(args, name) {\n        return true;\n    },\n\n    access_denied: function access_denied() {\n        this.page.display(new _uiMisc2.default.Message({\n            status: \"danger\",\n            message: \"You must be logged in with proper credentials to make this request.\",\n            persistent: true\n        }));\n    }\n});\n\nexports.default = Router;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    options: {\n        class_check: \"fa-check-square-o\",\n        class_uncheck: \"fa-square-o\",\n        parameters: [{\n            id: \"space_to_tab\",\n            title: \"Convert spaces to tabs\"\n        }, {\n            id: \"to_posix_lines\",\n            title: \"Use POSIX standard\"\n        }]\n    },\n\n    initialize: function initialize(options) {\n        var self = this;\n        this.model = options.model;\n        this.setElement($(\"<div/>\").addClass(\"upload-settings\"));\n        this.$el.append($(\"<div/>\").addClass(\"upload-settings-cover\"));\n        this.$el.append($(\"<table/>\").addClass(\"upload-settings-table ui-table-striped\").append(\"<tbody/>\"));\n        this.$cover = this.$(\".upload-settings-cover\");\n        this.$table = this.$(\".upload-settings-table > tbody\");\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.model.trigger(\"change\");\n    },\n\n    render: function render() {\n        var self = this;\n        this.$table.empty();\n        _.each(this.options.parameters, function (parameter) {\n            var $checkbox = $(\"<div/>\").addClass(\"upload-\" + parameter.id + \" upload-icon-button fa\").addClass(self.model.get(parameter.id) && self.options.class_check || self.options.class_uncheck).on(\"click\", function () {\n                self.model.get(\"enabled\") && self.model.set(parameter.id, !self.model.get(parameter.id));\n            });\n            self.$table.append($(\"<tr/>\").append($(\"<td/>\").append($checkbox)).append($(\"<td/>\").append(parameter.title)));\n        });\n        this.$cover[this.model.get(\"enabled\") && \"hide\" || \"show\"]();\n    }\n}); /** This renders the content of the settings popup, allowing users to specify flags i.e. for space-to-tab conversion **/\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.model = new Backbone.Model({\n            cls: \"upload-ftp\",\n            class_add: \"upload-icon-button fa fa-square-o\",\n            class_remove: \"upload-icon-button fa fa-check-square-o\",\n            class_partial: \"upload-icon-button fa fa-minus-square-o\",\n            help_enabled: true,\n            help_text: \"This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>\" + options.ftp_upload_site + \"</strong> using your Galaxy credentials.\",\n            collection: null,\n            onchange: function onchange() {},\n            onadd: function onadd() {},\n            onremove: function onremove() {}\n        }).set(options);\n        this.collection = this.model.get(\"collection\");\n        this.setElement(this._template());\n        this.$content = this.$(\".upload-ftp-content\");\n        this.$wait = this.$(\".upload-ftp-wait\");\n        this.$help = this.$(\".upload-ftp-help\");\n        this.$number = this.$(\".upload-ftp-number\");\n        this.$disk = this.$(\".upload-ftp-disk\");\n        this.$body = this.$(\".upload-ftp-body\");\n        this.$warning = this.$(\".upload-ftp-warning\");\n        this.$select = this.$(\".upload-ftp-select-all\");\n        this.render();\n    },\n\n    render: function render() {\n        var self = this;\n        this.$wait.show();\n        this.$content.hide();\n        this.$warning.hide();\n        this.$help.hide();\n        $.ajax({\n            url: Galaxy.root + \"api/remote_files\",\n            method: \"GET\",\n            success: function success(ftp_files) {\n                self.model.set(\"ftp_files\", ftp_files);\n                self._index();\n                self._renderTable();\n            },\n            error: function error() {\n                self._renderTable();\n            }\n        });\n    },\n\n    /** Fill table with ftp entries */\n    _renderTable: function _renderTable() {\n        var self = this;\n        var ftp_files = this.model.get(\"ftp_files\");\n        this.rows = [];\n        if (ftp_files && ftp_files.length > 0) {\n            this.$body.empty();\n            var size = 0;\n            _.each(ftp_files, function (ftp_file) {\n                self.rows.push(self._renderRow(ftp_file));\n                size += ftp_file.size;\n            });\n            this.$number.html(ftp_files.length + \" files\");\n            this.$disk.html(_utils2.default.bytesToString(size, true));\n            if (this.collection) {\n                this.$(\"._has_collection\").show();\n                this.$select.addClass(this.model.get(\"class_add\")).off().on(\"click\", function () {\n                    self._all();\n                });\n                this._refresh();\n            }\n            this.$content.show();\n        } else {\n            this.$warning.show();\n        }\n        this.model.get(\"help_enabled\") && this.$help.show();\n        this.$wait.hide();\n    },\n\n    /** Add row */\n    _renderRow: function _renderRow(ftp_file) {\n        var self = this;\n        var options = this.model.attributes;\n        var $it = $(this._templateRow(ftp_file));\n        var $icon = $it.find(\".icon\");\n        this.$body.append($it);\n        if (this.collection) {\n            var model_index = this.ftp_index[ftp_file.path];\n            $icon.addClass(model_index === undefined ? options.class_add : options.class_remove);\n            $it.on(\"click\", function () {\n                self._switch($icon, ftp_file);\n                self._refresh();\n            });\n        } else {\n            $it.on(\"click\", function () {\n                options.onchange(ftp_file);\n            });\n        }\n        return $icon;\n    },\n\n    /** Create ftp index */\n    _index: function _index() {\n        var self = this;\n        this.ftp_index = {};\n        this.collection && this.collection.each(function (model) {\n            if (model.get(\"file_mode\") == \"ftp\") {\n                self.ftp_index[model.get(\"file_path\")] = model.id;\n            }\n        });\n    },\n\n    /** Select all event handler */\n    _all: function _all() {\n        var options = this.model.attributes;\n        var ftp_files = this.model.get(\"ftp_files\");\n        var add = this.$select.hasClass(options.class_add);\n        for (var index in ftp_files) {\n            var ftp_file = ftp_files[index];\n            var model_index = this.ftp_index[ftp_file.path];\n            if (model_index === undefined && add || model_index !== undefined && !add) {\n                this._switch(this.rows[index], ftp_file);\n            }\n        }\n        this._refresh();\n    },\n\n    /** Handle collection changes */\n    _switch: function _switch($icon, ftp_file) {\n        $icon.removeClass();\n        var options = this.model.attributes;\n        var model_index = this.ftp_index[ftp_file.path];\n        if (model_index === undefined) {\n            var new_index = options.onadd(ftp_file);\n            $icon.addClass(options.class_remove);\n            this.ftp_index[ftp_file.path] = new_index;\n        } else {\n            options.onremove(model_index);\n            $icon.addClass(options.class_add);\n            this.ftp_index[ftp_file.path] = undefined;\n        }\n    },\n\n    /** Refresh select all button state */\n    _refresh: function _refresh() {\n        var counts = _.reduce(this.ftp_index, function (memo, element) {\n            element !== undefined && memo++;\n            return memo;\n        }, 0);\n        this.$select.removeClass();\n        if (counts == 0) {\n            this.$select.addClass(this.model.get(\"class_add\"));\n        } else {\n            this.$select.addClass(counts == this.rows.length ? this.model.get(\"class_remove\") : this.model.get(\"class_partial\"));\n        }\n    },\n\n    /** Template of row */\n    _templateRow: function _templateRow(options) {\n        return \"<tr class=\\\"upload-ftp-row\\\"><td class=\\\"_has_collection\\\" style=\\\"display: none;\\\"><div class=\\\"icon\\\"/></td><td class=\\\"ftp-name\\\">\" + _.escape(options.path) + \"</td><td class=\\\"ftp-size\\\">\" + _utils2.default.bytesToString(options.size) + \"</td><td class=\\\"ftp-time\\\">\" + options.ctime + \"</td></tr>\";\n    },\n\n    /** Template of main view */\n    _template: function _template() {\n        return \"<div class=\\\"\" + this.model.get(\"cls\") + \"\\\"><div class=\\\"upload-ftp-wait fa fa-spinner fa-spin\\\"/><div class=\\\"upload-ftp-help\\\">\" + this.model.get(\"help_text\") + \"</div><div class=\\\"upload-ftp-content\\\"><span style=\\\"whitespace: nowrap; float: left;\\\">Available files: </span><span style=\\\"whitespace: nowrap; float: right;\\\"><span class=\\\"upload-icon fa fa-file-text-o\\\"/><span class=\\\"upload-ftp-number\\\"/>&nbsp;&nbsp;<span class=\\\"upload-icon fa fa-hdd-o\\\"/><span class=\\\"upload-ftp-disk\\\"/></span><table class=\\\"grid\\\" style=\\\"float: left;\\\"><thead><tr><th class=\\\"_has_collection\\\" style=\\\"display: none;\\\"><div class=\\\"upload-ftp-select-all\\\"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody class=\\\"upload-ftp-body\\\"/></table></div><div class=\\\"upload-ftp-warning warningmessage\\\">Your FTP directory does not contain any files.</div>\";\n        \"<div>\";\n    }\n}); /** This renders the content of the ftp popup **/\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** This renders a popover with extension details **/\nexports.default = Backbone.View.extend({\n    initialize: function initialize(options) {\n        this.model = new Backbone.Model(options);\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function render() {\n        var self = this;\n        var options = this.model.attributes;\n        var description = _.findWhere(options.list, {\n            id: options.extension\n        });\n        this.extension_popup && this.extension_popup.remove();\n        this.extension_popup = new _uiPopover2.default.View({\n            placement: options.placement || \"bottom\",\n            container: options.$el\n        });\n        this.extension_popup.title(options.title);\n        this.extension_popup.empty();\n        this.extension_popup.append(this._templateDescription(description));\n        this.extension_popup.show();\n    },\n\n    /** Template for extensions description */\n    _templateDescription: function _templateDescription(options) {\n        if (options.description) {\n            var tmpl = options.description;\n            if (options.description_url) {\n                tmpl += \"&nbsp;(<a href=\\\"\" + options.description_url + \"\\\" target=\\\"_blank\\\">read more</a>)\";\n            }\n            return tmpl;\n        } else {\n            return \"There is no description available for this file extension.\";\n        }\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, _) {\n\n/*\n    galaxy upload plugins - requires FormData and XMLHttpRequest\n*/\n(function ($) {\n    // add event properties\n    jQuery.event.props.push(\"dataTransfer\");\n\n    /**\n        Posts file data to the API\n    */\n    $.uploadpost = function (config) {\n        // parse options\n        var cnf = $.extend({}, {\n            data: {},\n            success: function success() {},\n            error: function error() {},\n            progress: function progress() {},\n            url: null,\n            maxfilesize: 2048,\n            error_filesize: \"File exceeds 2GB. Please use a FTP client.\",\n            error_default: \"Please make sure the file is available.\",\n            error_server: \"Upload request failed.\",\n            error_login: \"Uploads require you to log in.\"\n        }, config);\n\n        // link data\n        var data = cnf.data;\n\n        // check errors\n        if (data.error_message) {\n            cnf.error(data.error_message);\n            return;\n        }\n\n        // construct form data\n        var form = new FormData();\n        for (var key in data.payload) {\n            form.append(key, data.payload[key]);\n        }\n\n        // add files to submission\n        var sizes = 0;\n        for (var key in data.files) {\n            var d = data.files[key];\n            form.append(d.name, d.file, d.file.name);\n            sizes += d.file.size;\n        }\n\n        // check file size, unless it's an ftp file\n        if (sizes > 1048576 * cnf.maxfilesize) {\n            cnf.error(cnf.error_filesize);\n            return;\n        }\n\n        // prepare request\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", cnf.url, true);\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n        xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n        // captures state changes\n        xhr.onreadystatechange = function () {\n            // check for request completed, server connection closed\n            if (xhr.readyState == xhr.DONE) {\n                // parse response\n                var response = null;\n                var extra_info = \"\";\n                if (xhr.responseText) {\n                    try {\n                        response = jQuery.parseJSON(xhr.responseText);\n                        extra_info = response.err_msg;\n                    } catch (e) {\n                        response = xhr.responseText;\n                        extra_info = response;\n                    }\n                }\n                // pass any error to the error option\n                if (xhr.status < 200 || xhr.status > 299) {\n                    var text = xhr.statusText;\n                    if (xhr.status == 403) {\n                        text = cnf.error_login;\n                    } else if (xhr.status == 0) {\n                        text = cnf.error_server;\n                    } else if (!text) {\n                        text = cnf.error_default;\n                    }\n                    cnf.error(text + \" (\" + xhr.status + \"). \" + extra_info);\n                } else {\n                    cnf.success(response);\n                }\n            }\n        };\n\n        // prepare upload progress\n        xhr.upload.addEventListener(\"progress\", function (e) {\n            if (e.lengthComputable) {\n                cnf.progress(Math.round(e.loaded * 100 / e.total));\n            }\n        }, false);\n\n        // send request\n        Galaxy.emit.debug(\"uploadbox::uploadpost()\", \"Posting following data.\", cnf);\n        xhr.send(form);\n    };\n\n    /**\n        Handles the upload events drag/drop etc.\n    */\n    $.fn.uploadinput = function (options) {\n        // initialize\n        var el = this;\n        var opts = $.extend({}, {\n            ondragover: function ondragover() {},\n            ondragleave: function ondragleave() {},\n            onchange: function onchange() {},\n            multiple: false\n        }, options);\n\n        // append hidden upload field\n        var $input = $(\"<input type=\\\"file\\\" style=\\\"display: none\\\" \" + (opts.multiple && \"multiple\" || \"\") + \"/>\");\n        el.append($input.change(function (e) {\n            opts.onchange(e.target.files);\n            $(this).val(\"\");\n        }));\n\n        // drag/drop events\n        el.on(\"drop\", function (e) {\n            opts.ondragleave(e);\n            if (e.dataTransfer) {\n                opts.onchange(e.dataTransfer.files);\n                e.preventDefault();\n            }\n        });\n        el.on(\"dragover\", function (e) {\n            e.preventDefault();\n            opts.ondragover(e);\n        });\n        el.on(\"dragleave\", function (e) {\n            e.stopPropagation();\n            opts.ondragleave(e);\n        });\n\n        // exports\n        return {\n            dialog: function dialog() {\n                $input.trigger(\"click\");\n            }\n        };\n    };\n\n    /**\n        Handles the upload queue and events such as drag/drop etc.\n    */\n    $.fn.uploadbox = function (options) {\n        // parse options\n        var opts = $.extend({}, {\n            dragover: function dragover() {},\n            dragleave: function dragleave() {},\n            announce: function announce(d) {},\n            initialize: function initialize(d) {},\n            progress: function progress(d, m) {},\n            success: function success(d, m) {},\n            error: function error(d, m) {\n                alert(m);\n            },\n            complete: function complete() {}\n        }, options);\n\n        // file queue\n        var queue = {};\n\n        // queue index/length counter\n        var queue_index = 0;\n        var queue_length = 0;\n\n        // indicates if queue is currently running\n        var queue_running = false;\n        var queue_stop = false;\n\n        // element\n        var uploadinput = $(this).uploadinput({\n            multiple: true,\n            onchange: function onchange(files) {\n                add(files);\n            },\n            ondragover: options.ondragover,\n            ondragleave: options.ondragleave\n        });\n\n        // add new files to upload queue\n        function add(files) {\n            if (files && files.length && !queue_running) {\n                var index = undefined;\n                _.each(files, function (file, key) {\n                    if (file.mode !== \"new\" && _.filter(queue, function (f) {\n                        return f.name === file.name && f.size === file.size;\n                    }).length) {\n                        file.duplicate = true;\n                    }\n                });\n                _.each(files, function (file) {\n                    if (!file.duplicate) {\n                        index = String(queue_index++);\n                        queue[index] = file;\n                        opts.announce(index, queue[index]);\n                        queue_length++;\n                    }\n                });\n                return index;\n            }\n        }\n\n        // remove file from queue\n        function remove(index) {\n            if (queue[index]) {\n                delete queue[index];\n                queue_length--;\n            }\n        }\n\n        // process an upload, recursive\n        function process() {\n            // validate\n            if (queue_length == 0 || queue_stop) {\n                queue_stop = false;\n                queue_running = false;\n                opts.complete();\n                return;\n            } else {\n                queue_running = true;\n            }\n\n            // get an identifier from the queue\n            var index = -1;\n            for (var key in queue) {\n                index = key;\n                break;\n            }\n\n            // get current file from queue\n            var file = queue[index];\n\n            // remove from queue\n            remove(index);\n\n            // create and submit data\n            $.uploadpost({\n                url: opts.url,\n                data: opts.initialize(index),\n                success: function success(message) {\n                    opts.success(index, message);\n                    process();\n                },\n                error: function error(message) {\n                    opts.error(index, message);\n                    process();\n                },\n                progress: function progress(percentage) {\n                    opts.progress(index, percentage);\n                }\n            });\n        }\n\n        /*\n            public interface\n        */\n\n        // open file browser for selection\n        function select() {\n            uploadinput.dialog();\n        }\n\n        // remove all entries from queue\n        function reset(index) {\n            for (index in queue) {\n                remove(index);\n            }\n        }\n\n        // initiate upload process\n        function start() {\n            if (!queue_running) {\n                queue_running = true;\n                process();\n            }\n        }\n\n        // stop upload process\n        function stop() {\n            queue_stop = true;\n        }\n\n        // set options\n        function configure(options) {\n            opts = $.extend({}, opts, options);\n            return opts;\n        }\n\n        // verify browser compatibility\n        function compatible() {\n            return window.File && window.FormData && window.XMLHttpRequest && window.FileList;\n        }\n\n        // export functions\n        return {\n            select: select,\n            add: add,\n            remove: remove,\n            start: start,\n            stop: stop,\n            reset: reset,\n            configure: configure,\n            compatible: compatible\n        };\n    };\n})(jQuery);\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _hdcaModel = __webpack_require__(79);\n\nvar _hdcaModel2 = _interopRequireDefault(_hdcaModel);\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _baseCreator = __webpack_require__(121);\n\nvar _baseCreator2 = _interopRequireDefault(_baseCreator);\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _naturalSort = __webpack_require__(122);\n\nvar _naturalSort2 = _interopRequireDefault(_naturalSort);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(123);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"collections\";\n\n/*==============================================================================\nTODO:\n    use proper Element model and not just json\n    straighten out createFn, collection.createHDCA\n    possibly stop using modals for this\n    It would be neat to do a drag and drop\n\n==============================================================================*/\n/** A view for both DatasetDCEs and NestedDCDCEs\n *  (things that implement collection-model:DatasetCollectionElementMixin)\n */\nvar DatasetCollectionElementView = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function initialize(attributes) {\n        this.element = attributes.element || {};\n        this.selected = attributes.selected || false;\n    },\n\n    render: function render() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el.attr(\"data-element-id\", this.element.id).attr(\"draggable\", true).html(this.template({ element: this.element })).get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        if (this.selected) {\n            this.$el.addClass(\"selected\");\n        }\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(['<a class=\"name\" title=\"', (0, _localization2.default)(\"Click to rename\"), '\" href=\"javascript:void(0)\">', \"<%- element.name %>\", \"</a>\", '<button class=\"discard btn btn-sm\" title=\"', (0, _localization2.default)(\"Remove this dataset from the list\"), '\">', (0, _localization2.default)(\"Discard\"), \"</button>\"].join(\"\")),\n\n    /** select this element and pub */\n    select: function select(toggle) {\n        this.$el.toggleClass(\"selected\", toggle);\n        this.trigger(\"select\", {\n            source: this,\n            selected: this.$el.hasClass(\"selected\")\n        });\n    },\n\n    /** animate the removal of this element and pub */\n    discard: function discard() {\n        var view = this;\n        var parentWidth = this.$el.parent().width();\n        this.$el.animate({ \"margin-right\": parentWidth }, \"fast\", function () {\n            view.trigger(\"discard\", {\n                source: view\n            });\n            view.destroy();\n        });\n    },\n\n    /** remove the DOM and any listeners */\n    destroy: function destroy() {\n        this.off();\n        this.$el.remove();\n    },\n\n    events: {\n        click: \"_click\",\n        \"click .name\": \"_clickName\",\n        \"click .discard\": \"_clickDiscard\",\n\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** select when the li is clicked */\n    _click: function _click(ev) {\n        ev.stopPropagation();\n        this.select(ev);\n    },\n\n    /** rename a pair when the name is clicked */\n    _clickName: function _clickName(ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n\n        var promptString = [(0, _localization2.default)(\"Enter a new name for the element\"), \":\\n(\", (0, _localization2.default)(\"Note that changing the name here will not rename the dataset\"), \")\"].join(\"\");\n\n        var response = prompt((0, _localization2.default)(\"Enter a new name for the element\") + \":\", this.element.name);\n\n        if (response) {\n            this.element.name = response;\n            this.render();\n        }\n        //TODO: cancelling with ESC leads to closure of the creator...\n    },\n\n    /** discard when the discard button is clicked */\n    _clickDiscard: function _clickDiscard(ev) {\n        ev.stopPropagation();\n        this.discard();\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function _dragstart(ev) {\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.element));\n\n        this.$el.addClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragstart\", [this]);\n    },\n\n    /** dragging for re-ordering */\n    _dragend: function _dragend(ev) {\n        this.$el.removeClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function _sendToParent(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\n/** An interface for building collections.\n */\nvar ListCollectionCreator = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(_baseCreator2.default.CollectionCreatorMixin).extend({\n    _logNamespace: logNamespace,\n\n    /** the class used to display individual elements */\n    elementViewClass: DatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass: _hdcaModel2.default.HistoryListDatasetCollection,\n    className: \"list-collection-creator collection-creator flex-row-container\",\n\n    /** minimum number of valid elements to start with in order to build a collection of this type */\n    minElements: 1,\n\n    defaultAttributes: {\n        //TODO: remove - use new collectionClass().save()\n        /** takes elements and creates the proper collection - returns a promise */\n        creationFn: function creationFn() {\n            throw new TypeError(\"no creation fn for creator\");\n        },\n        /** fn to call when the collection is created (scoped to this) */\n        oncreate: function oncreate() {},\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        oncancel: function oncancel() {},\n        /** distance from list edge to begin autoscrolling list */\n        autoscrollDist: 24,\n        /** Color passed to hoverhighlight */\n        highlightClr: \"rgba( 64, 255, 255, 1.0 )\"\n    },\n\n    footerSettings: {\n        \".hide-originals\": \"hideOriginals\"\n    },\n\n    /** set up initial options, instance vars, behaviors */\n    initialize: function initialize(attributes) {\n        this.metric(\"ListCollectionCreator.initialize\", attributes);\n        var creator = this;\n        _.each(this.defaultAttributes, function (value, key) {\n            value = attributes[key] || value;\n            creator[key] = value;\n        });\n\n        /** unordered, original list - cache to allow reversal */\n        creator.initialElements = attributes.elements || [];\n\n        this._setUpCommonSettings(attributes);\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this._setUpBehaviors();\n    },\n\n    /** set up instance vars */\n    _instanceSetUp: function _instanceSetUp() {\n        /** Ids of elements that have been selected by the user - to preserve over renders */\n        this.selectedIds = {};\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n    },\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data */\n    _elementsSetUp: function _elementsSetUp() {\n        //this.debug( '-- _dataSetUp' );\n        /** a list of invalid elements and the reasons they aren't valid */\n        this.invalidElements = [];\n        //TODO: handle fundamental problem of syncing DOM, views, and list here\n        /** data for list in progress */\n        this.workingElements = [];\n        /** views for workingElements */\n        this.elementViews = [];\n\n        // copy initial list, sort, add ids if needed\n        this.workingElements = this.initialElements.slice(0);\n        this._ensureElementIds();\n        this._validateElements();\n        this._mangleDuplicateNames();\n        this._sortElements();\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureElementIds: function _ensureElementIds() {\n        this.workingElements.forEach(function (element) {\n            if (!element.hasOwnProperty(\"id\")) {\n                element.id = _.uniqueId();\n            }\n        });\n        return this.workingElements;\n    },\n\n    /** separate working list into valid and invalid elements for this collection */\n    _validateElements: function _validateElements() {\n        var creator = this;\n        var existingNames = {};\n        creator.invalidElements = [];\n\n        this.workingElements = this.workingElements.filter(function (element) {\n            var problem = creator._isElementInvalid(element);\n            if (problem) {\n                creator.invalidElements.push({\n                    element: element,\n                    text: problem\n                });\n            }\n            return !problem;\n        });\n        return this.workingElements;\n    },\n\n    /** describe what is wrong with a particular element if anything */\n    _isElementInvalid: function _isElementInvalid(element) {\n        if (element.history_content_type !== \"dataset\") {\n            return (0, _localization2.default)(\"is not a dataset\");\n        }\n        var validState = element.state === _states2.default.OK || _.contains(_states2.default.NOT_READY_STATES, element.state);\n        if (!validState) {\n            return (0, _localization2.default)(\"has errored, is paused, or is not accessible\");\n        }\n        if (element.deleted || element.purged) {\n            return (0, _localization2.default)(\"has been deleted or purged\");\n        }\n        return null;\n    },\n\n    /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n    _mangleDuplicateNames: function _mangleDuplicateNames() {\n        var SAFETY = 900;\n        var counter = 1;\n        var existingNames = {};\n        this.workingElements.forEach(function (element) {\n            var currName = element.name;\n            while (existingNames.hasOwnProperty(currName)) {\n                currName = element.name + \" (\" + counter + \")\";\n                counter += 1;\n                if (counter >= SAFETY) {\n                    throw new Error(\"Safety hit in while loop - thats impressive\");\n                }\n            }\n            element.name = currName;\n            existingNames[element.name] = true;\n        });\n    },\n\n    /** sort a list of elements */\n    _sortElements: function _sortElements(list) {\n        // // currently only natural sort by name\n        // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n        // return this.workingElements;\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    // templates : ListCollectionCreator.templates,\n    /** render the entire interface */\n    render: function render(speed, callback) {\n        //this.debug( '-- _render' );\n        if (this.workingElements.length < this.minElements) {\n            return this._renderInvalid(speed, callback);\n        }\n\n        this.$el.empty().html(this.templates.main());\n        this._renderHeader(speed);\n        this._renderMiddle(speed);\n        this._renderFooter(speed);\n        this._addPluginComponents();\n        this.$(\".collection-name\").focus();\n        this.trigger(\"rendered\", this);\n        return this;\n    },\n\n    /** render a simplified interface aimed at telling the user why they can't move forward */\n    _renderInvalid: function _renderInvalid(speed, callback) {\n        //this.debug( '-- _render' );\n        this.$el.empty().html(this.templates.invalidInitial({\n            problems: this.invalidElements,\n            elements: this.workingElements\n        }));\n        if (typeof this.oncancel === \"function\") {\n            this.$(\".cancel-create.btn\").show();\n        }\n        this.trigger(\"rendered\", this);\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader: function _renderHeader(speed, callback) {\n        var $header = this.$(\".header\").empty().html(this.templates.header()).find(\".help-content\").prepend($(this.templates.helpContent()));\n        //TODO: should only show once despite calling _renderHeader again\n        if (this.invalidElements.length) {\n            this._invalidElementsAlert();\n        }\n        return $header;\n    },\n\n    /** render the middle including the elements */\n    _renderMiddle: function _renderMiddle(speed, callback) {\n        var $middle = this.$(\".middle\").empty().html(this.templates.middle());\n        this._renderList(speed);\n        return $middle;\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents: function _addPluginComponents() {\n        this.$(\".help-content i\").hoverhighlight(\".collection-creator\", this.highlightClr);\n    },\n\n    /** build and show an alert describing any elements that could not be included due to problems */\n    _invalidElementsAlert: function _invalidElementsAlert() {\n        this._showAlert(this.templates.invalidElements({\n            problems: this.invalidElements\n        }), \"alert-warning\");\n    },\n\n    _disableNameAndCreate: function _disableNameAndCreate(disable) {\n        disable = !_.isUndefined(disable) ? disable : true;\n        if (disable) {\n            this.$(\".collection-name\").prop(\"disabled\", true);\n            this.$(\".create-collection\").toggleClass(\"disabled\", true);\n            // } else {\n            //     this.$( '.collection-name' ).prop( 'disabled', false );\n            //     this.$( '.create-collection' ).removeClass( 'disable' );\n        }\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** conv. to the main list display DOM */\n    $list: function $list() {\n        return this.$(\".collection-elements\");\n    },\n\n    /** show or hide the clear selected control based on the num of selected elements */\n    _renderClearSelected: function _renderClearSelected() {\n        if (_.size(this.selectedIds)) {\n            this.$(\".collection-elements-controls > .clear-selected\").show();\n        } else {\n            this.$(\".collection-elements-controls > .clear-selected\").hide();\n        }\n    },\n\n    /** render the elements in order (or a warning if no elements found) */\n    _renderList: function _renderList(speed, callback) {\n        //this.debug( '-- _renderList' );\n        var creator = this;\n\n        var $tmp = jQuery(\"<div/>\");\n        var $list = creator.$list();\n\n        _.each(this.elementViews, function (view) {\n            view.destroy();\n            creator.removeElementView(view);\n        });\n\n        // if( !this.workingElements.length ){\n        //     this._renderNoValidElements();\n        //     return;\n        // }\n\n        creator.workingElements.forEach(function (element) {\n            var elementView = creator._createElementView(element);\n            $tmp.append(elementView.$el);\n        });\n\n        creator._renderClearSelected();\n        $list.empty().append($tmp.children());\n        _.invoke(creator.elementViews, \"render\");\n\n        if ($list.height() > $list.css(\"max-height\")) {\n            $list.css(\"border-width\", \"1px 0px 1px 0px\");\n        } else {\n            $list.css(\"border-width\", \"0px\");\n        }\n    },\n\n    /** create an element view, cache in elementViews, set up listeners, and return */\n    _createElementView: function _createElementView(element) {\n        var elementView = new this.elementViewClass({\n            //TODO: use non-generic class or not all\n            // model : COLLECTION.DatasetDCE( element )\n            element: element,\n            selected: _.has(this.selectedIds, element.id)\n        });\n        this.elementViews.push(elementView);\n        this._listenToElementView(elementView);\n        return elementView;\n    },\n\n    /** listen to any element events */\n    _listenToElementView: function _listenToElementView(view) {\n        var creator = this;\n        creator.listenTo(view, {\n            select: function select(data) {\n                var element = data.source.element;\n                if (data.selected) {\n                    creator.selectedIds[element.id] = true;\n                } else {\n                    delete creator.selectedIds[element.id];\n                }\n                creator.trigger(\"elements:select\", data);\n            },\n            discard: function discard(data) {\n                creator.trigger(\"elements:discard\", data);\n            }\n        });\n    },\n\n    /** add a new element view based on the json in element */\n    addElementView: function addElementView(element) {\n        //TODO: workingElements is sorted, add element in appropo index\n        // add element, sort elements, find element index\n        // var view = this._createElementView( element );\n        // return view;\n    },\n\n    /** stop listening to view and remove from caches */\n    removeElementView: function removeElementView(view) {\n        delete this.selectedIds[view.element.id];\n        this._renderClearSelected();\n\n        this.elementViews = _.without(this.elementViews, view);\n        this.stopListening(view);\n    },\n\n    /** render a message in the list that no elements remain to create a collection */\n    _renderNoElementsLeft: function _renderNoElementsLeft() {\n        this._disableNameAndCreate(true);\n        this.$(\".collection-elements\").append(this.templates.noElementsLeft());\n    },\n\n    // /** render a message in the list that no valid elements were found to create a collection */\n    // _renderNoValidElements : function(){\n    //     this._disableNameAndCreate( true );\n    //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n    // },\n\n    // ------------------------------------------------------------------------ API\n    /** convert element into JSON compatible with the collections API */\n    _elementToJSON: function _elementToJSON(element) {\n        // return element.toJSON();\n        return element;\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object} the jquery ajax request\n     */\n    createList: function createList(name) {\n        if (!this.workingElements.length) {\n            var message = (0, _localization2.default)(\"No valid elements for final list\") + \". \";\n            message += \"<a class=\\\"cancel-create\\\" href=\\\"javascript:void(0);\\\">\" + (0, _localization2.default)(\"Cancel\") + \"</a> \";\n            message += (0, _localization2.default)(\"or\");\n            message += \" <a class=\\\"reset\\\" href=\\\"javascript:void(0);\\\">\" + (0, _localization2.default)(\"start over\") + \"</a>.\";\n            this._showAlert(message);\n            return;\n        }\n\n        var creator = this;\n\n        var elements = this.workingElements.map(function (element) {\n            return creator._elementToJSON(element);\n        });\n\n        creator.blocking = true;\n        return creator.creationFn(elements, name, creator.hideOriginals).always(function () {\n            creator.blocking = false;\n        }).fail(function (xhr, status, message) {\n            creator.trigger(\"error\", {\n                xhr: xhr,\n                status: status,\n                message: (0, _localization2.default)(\"An error occurred while creating this collection\")\n            });\n        }).done(function (response, message, xhr) {\n            creator.trigger(\"collection:created\", response, message, xhr);\n            creator.metric(\"collection:created\", response);\n            if (typeof creator.oncreate === \"function\") {\n                creator.oncreate.call(this, response, message, xhr);\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors: function _setUpBehaviors() {\n        this.on(\"error\", this._errorHandler);\n\n        this.once(\"rendered\", function () {\n            this.trigger(\"rendered:initial\", this);\n        });\n\n        this.on(\"elements:select\", function (data) {\n            this._renderClearSelected();\n        });\n\n        this.on(\"elements:discard\", function (data) {\n            var element = data.source.element;\n            this.removeElementView(data.source);\n\n            this.workingElements = _.without(this.workingElements, element);\n            if (!this.workingElements.length) {\n                this._renderNoElementsLeft();\n            }\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    /** handle errors with feedback and details to the user (if available) */\n    _errorHandler: function _errorHandler(data) {\n        this.error(data);\n\n        var creator = this;\n        var content = data.message || (0, _localization2.default)(\"An error occurred\");\n        if (data.xhr) {\n            var xhr = data.xhr;\n            var message = data.message;\n            if (xhr.readyState === 0 && xhr.status === 0) {\n                content += \": \" + (0, _localization2.default)(\"Galaxy could not be reached and may be updating.\") + (0, _localization2.default)(\" Try again in a few minutes.\");\n            } else if (xhr.responseJSON) {\n                content += \":<br /><pre>\" + JSON.stringify(xhr.responseJSON) + \"</pre>\";\n            } else {\n                content += \": \" + message;\n            }\n        }\n        creator._showAlert(content, \"alert-danger\");\n    },\n\n    events: {\n        // header\n        \"click .more-help\": \"_clickMoreHelp\",\n        \"click .less-help\": \"_clickLessHelp\",\n        \"click .main-help\": \"_toggleHelp\",\n        \"click .header .alert button\": \"_hideAlert\",\n\n        \"click .reset\": \"reset\",\n        \"click .clear-selected\": \"clearSelectedElements\",\n\n        // elements - selection\n        \"click .collection-elements\": \"clearSelectedElements\",\n\n        // elements - drop target\n        // 'dragenter .collection-elements': '_dragenterElements',\n        // 'dragleave .collection-elements': '_dragleaveElements',\n        \"dragover .collection-elements\": \"_dragoverElements\",\n        \"drop .collection-elements\": \"_dropElements\",\n\n        // these bubble up from the elements as custom events\n        \"collection-element.dragstart .collection-elements\": \"_elementDragstart\",\n        \"collection-element.dragend   .collection-elements\": \"_elementDragend\",\n\n        // footer\n        \"change .collection-name\": \"_changeName\",\n        \"keydown .collection-name\": \"_nameCheckForEnter\",\n        \"change .hide-originals\": \"_changeHideOriginals\",\n        \"click .cancel-create\": \"_cancelCreate\",\n        \"click .create-collection\": \"_clickCreate\" //,\n    },\n\n    // ........................................................................ elements\n    /** reset all data to the initial state */\n    reset: function reset() {\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this.render();\n    },\n\n    /** deselect all elements */\n    clearSelectedElements: function clearSelectedElements(ev) {\n        this.$(\".collection-elements .collection-element\").removeClass(\"selected\");\n        this.$(\".collection-elements-controls > .clear-selected\").hide();\n    },\n\n    //_dragenterElements : function( ev ){\n    //    //this.debug( '_dragenterElements:', ev );\n    //},\n    //TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n    // _dragleaveElements : function( ev ){\n    //    //this.debug( '_dragleaveElements:', ev );\n    // },\n\n    /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n    _dragoverElements: function _dragoverElements(ev) {\n        //this.debug( '_dragoverElements:', ev );\n        ev.preventDefault();\n\n        var $list = this.$list();\n        this._checkForAutoscroll($list, ev.originalEvent.clientY);\n        var $nearest = this._getNearestElement(ev.originalEvent.clientY);\n\n        //TODO: no need to re-create - move instead\n        this.$(\".element-drop-placeholder\").remove();\n        var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n        if (!$nearest.length) {\n            $list.append($placeholder);\n        } else {\n            $nearest.before($placeholder);\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll: function _checkForAutoscroll($element, y) {\n        var AUTOSCROLL_SPEED = 2;\n        var offset = $element.offset();\n        var scrollTop = $element.scrollTop();\n        var upperDist = y - offset.top;\n        var lowerDist = offset.top + $element.outerHeight() - y;\n        if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n            $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n        } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n            $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n        }\n    },\n\n    /** get the nearest element based on the mouse's Y coordinate.\n     *  If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestElement: function _getNearestElement(y) {\n        var WIGGLE = 4;\n\n        var lis = this.$(\".collection-elements li.collection-element\").toArray();\n\n        for (var i = 0; i < lis.length; i++) {\n            var $li = $(lis[i]);\n            var top = $li.offset().top;\n            var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n            if (top + halfHeight > y && top - halfHeight < y) {\n                return $li;\n            }\n        }\n        return $();\n    },\n\n    /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n    _dropElements: function _dropElements(ev) {\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = \"move\";\n\n        // insert before the nearest element or after the last.\n        var $nearest = this._getNearestElement(ev.clientY);\n        if ($nearest.length) {\n            this.$dragging.insertBefore($nearest);\n        } else {\n            // no nearest before - insert after last element\n            this.$dragging.insertAfter(this.$(\".collection-elements .collection-element\").last());\n        }\n        // resync the creator's list based on the new DOM order\n        this._syncOrderToDom();\n        return false;\n    },\n\n    /** resync the creator's list of elements based on the DOM order */\n    _syncOrderToDom: function _syncOrderToDom() {\n        var creator = this;\n        var newElements = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$(\".collection-elements .collection-element\").each(function () {\n            var id = $(this).attr(\"data-element-id\");\n\n            var element = _.findWhere(creator.workingElements, {\n                id: id\n            });\n\n            if (element) {\n                newElements.push(element);\n            } else {\n                console.error(\"missing element: \", id);\n            }\n        });\n        this.workingElements = newElements;\n        this._renderList();\n    },\n\n    /** drag communication with element sub-views: dragstart */\n    _elementDragstart: function _elementDragstart(ev, element) {\n        // auto select the element causing the event and move all selected\n        element.select(true);\n        this.$dragging = this.$(\".collection-elements .collection-element.selected\");\n    },\n\n    /** drag communication with element sub-views: dragend - remove the placeholder */\n    _elementDragend: function _elementDragend(ev, element) {\n        $(\".element-drop-placeholder\").remove();\n        this.$dragging = null;\n    },\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates: _.extend({}, _baseCreator2.default.CollectionCreatorMixin._creatorTemplates, {\n        /** the header (not including help text) */\n        header: _.template(['<div class=\"main-help well clear\">', '<a class=\"more-help\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"More help\"), \"</a>\", '<div class=\"help-content\">', '<a class=\"less-help\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Less\"), \"</a>\", \"</div>\", \"</div>\", '<div class=\"alert alert-dismissable\">', '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ', 'title=\"', (0, _localization2.default)(\"Close and show more help\"), '\" aria-hidden=\"true\">&times;</button>', '<span class=\"alert-message\"></span>', \"</div>\"].join(\"\")),\n\n        /** the middle: element list */\n        middle: _.template(['<div class=\"collection-elements-controls\">', '<a class=\"reset\" href=\"javascript:void(0);\" ', 'title=\"', (0, _localization2.default)(\"Undo all reordering and discards\"), '\">', (0, _localization2.default)(\"Start over\"), \"</a>\", '<a class=\"clear-selected\" href=\"javascript:void(0);\" ', 'title=\"', (0, _localization2.default)(\"De-select all selected datasets\"), '\">', (0, _localization2.default)(\"Clear selected\"), \"</a>\", \"</div>\", '<div class=\"collection-elements scroll-container flex-row\">', \"</div>\"].join(\"\")),\n\n        /** creation and cancel controls */\n        footer: _.template(['<div class=\"attributes clear\">', '<div class=\"clear\">', '<label class=\"setting-prompt pull-right\">', (0, _localization2.default)(\"Hide original elements\"), \"?\", '<input class=\"hide-originals pull-right\" type=\"checkbox\" />', \"</label>\", \"</div>\", '<div class=\"clear\">', '<input class=\"collection-name form-control pull-right\" ', 'placeholder=\"', (0, _localization2.default)(\"Enter a name for your new collection\"), '\" />', '<div class=\"collection-name-prompt pull-right\">', (0, _localization2.default)(\"Name\"), \":</div>\", \"</div>\", \"</div>\", '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', (0, _localization2.default)(\"Cancel\"), \"</button>\", '<div class=\"create-other btn-group dropup\">', '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', (0, _localization2.default)(\"Create a different kind of collection\"), ' <span class=\"caret\"></span>', \"</button>\", '<ul class=\"dropdown-menu\" role=\"menu\">', '<li><a href=\"#\">', (0, _localization2.default)(\"Create a <i>single</i> pair\"), \"</a></li>\", '<li><a href=\"#\">', (0, _localization2.default)(\"Create a list of <i>unpaired</i> datasets\"), \"</a></li>\", \"</ul>\", \"</div>\", \"</div>\", '<div class=\"main-options pull-right\">', '<button class=\"create-collection btn btn-primary\">', (0, _localization2.default)(\"Create list\"), \"</button>\", \"</div>\", \"</div>\"].join(\"\")),\n\n        /** help content */\n        helpContent: _.template([\"<p>\", (0, _localization2.default)([\"Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and \", \"workflows in order to have analyses done on each member of the entire group. This interface allows \", \"you to create a collection and re-order the final collection.\"].join(\"\")), \"</p>\", \"<ul>\", \"<li>\", (0, _localization2.default)([\"Rename elements in the list by clicking on \", '<i data-target=\".collection-element .name\">the existing name</i>.'].join(\"\")), \"</li>\", \"<li>\", (0, _localization2.default)([\"Discard elements from the final created list by clicking on the \", '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'].join(\"\")), \"</li>\", \"<li>\", (0, _localization2.default)([\"Reorder the list by clicking and dragging elements. Select multiple elements by clicking on \", '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ', \"entire group. Deselect them by clicking them again or by clicking the \", 'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'].join(\"\")), \"</li>\", \"<li>\", (0, _localization2.default)(['Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ', \"the interface.\"].join(\"\")), \"</li>\", \"<li>\", (0, _localization2.default)(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\"\")), \"</li>\", \"</ul><br />\", \"<p>\", (0, _localization2.default)(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>.'].join(\"\")), \"</p>\"].join(\"\")),\n\n        /** shown in list when all elements are discarded */\n        invalidElements: _.template([(0, _localization2.default)(\"The following selections could not be included due to problems:\"), \"<ul><% _.each( problems, function( problem ){ %>\", \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\", \"<% }); %></ul>\"].join(\"\")),\n\n        /** shown in list when all elements are discarded */\n        noElementsLeft: _.template(['<li class=\"no-elements-left-message\">', (0, _localization2.default)(\"No elements left! \"), (0, _localization2.default)(\"Would you like to \"), '<a class=\"reset\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"start over\"), \"</a>?\", \"</li>\"].join(\"\")),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial: _.template(['<div class=\"header flex-row no-flex\">', '<div class=\"alert alert-warning\" style=\"display: block\">', '<span class=\"alert-message\">', \"<% if( _.size( problems ) ){ %>\", (0, _localization2.default)(\"The following selections could not be included due to problems\"), \":\", \"<ul><% _.each( problems, function( problem ){ %>\", \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\", \"<% }); %></ul>\", \"<% } else if( _.size( elements ) < 1 ){ %>\", (0, _localization2.default)(\"No datasets were selected\"), \".\", \"<% } %>\", \"<br />\", (0, _localization2.default)(\"At least one element is needed for the collection\"), \". \", (0, _localization2.default)(\"You may need to \"), '<a class=\"cancel-create\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"cancel\"), \"</a> \", (0, _localization2.default)(\"and reselect new elements\"), \".\", \"</span>\", \"</div>\", \"</div>\", '<div class=\"footer flex-row no-flex\">', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', (0, _localization2.default)(\"Cancel\"), \"</button>\",\n        // _l( 'Create a different kind of collection' ),\n        \"</div>\", \"</div>\", \"</div>\"].join(\"\"))\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListCollectionCreator\";\n    }\n});\n\n//=============================================================================\n/** Create a modal and load its body with the given CreatorClass creator type\n *  @returns {Deferred} resolved when creator has built a collection.\n */\nvar collectionCreatorModal = function _collectionCreatorModal(elements, options, CreatorClass) {\n    var deferred = jQuery.Deferred();\n    var modal = Galaxy.modal || new _uiModal2.default.View();\n    var creator;\n\n    options = _.defaults(options || {}, {\n        elements: elements,\n        oncancel: function oncancel() {\n            modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function oncreate(creator, response) {\n            modal.hide();\n            deferred.resolve(response);\n        }\n    });\n\n    creator = new CreatorClass(options);\n    modal.show({\n        title: options.title || (0, _localization2.default)(\"Create a collection\"),\n        body: creator.$el,\n        width: \"80%\",\n        height: \"100%\",\n        closing_events: true\n    });\n    creator.render();\n    window._collectionCreator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n/** List collection flavor of collectionCreatorModal. */\nvar listCollectionCreatorModal = function _listCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = (0, _localization2.default)(\"Create a collection from a list of datasets\");\n    return collectionCreatorModal(elements, options, ListCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a list collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createListCollection(contents, defaultHideSourceItems) {\n    var elements = contents.toJSON();\n\n    var promise = listCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function creationFn(elements, name, hideSourceItems) {\n            elements = elements.map(function (element) {\n                return {\n                    id: element.id,\n                    name: element.name,\n\n                    //TODO: this allows for list:list even if the filter above does not - reconcile\n                    src: element.history_content_type === \"dataset\" ? \"hda\" : \"hdca\"\n                };\n            });\n            return contents.createHDCA(elements, \"list\", name, hideSourceItems);\n        }\n    });\n\n    return promise;\n}\n\n//==============================================================================\nexports.default = {\n    DatasetCollectionElementView: DatasetCollectionElementView,\n    ListCollectionCreator: ListCollectionCreator,\n\n    collectionCreatorModal: collectionCreatorModal,\n    listCollectionCreatorModal: listCollectionCreatorModal,\n    createListCollection: createListCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0), __webpack_require__(0)))\n\n/***/ }),\n/* 79 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _collectionModel = __webpack_require__(80);\n\nvar _collectionModel2 = _interopRequireDefault(_collectionModel);\n\nvar _historyContentModel = __webpack_require__(120);\n\nvar _historyContentModel2 = _interopRequireDefault(_historyContentModel);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*==============================================================================\n\nModels for DatasetCollections contained within a history.\n\nTODO:\n    these might be compactable to one class if some duplication with\n    collection-model is used.\n\n==============================================================================*/\nvar hcontentMixin = _historyContentModel2.default.HistoryContentMixin;\n\nvar ListDC = _collectionModel2.default.ListDatasetCollection;\nvar PairDC = _collectionModel2.default.PairDatasetCollection;\nvar ListPairedDC = _collectionModel2.default.ListPairedDatasetCollection;\nvar ListOfListsDC = _collectionModel2.default.ListOfListsDatasetCollection;\n\n//==============================================================================\n/** Override to post to contents route w/o id. */\nfunction buildHDCASave(_super) {\n    return function _save(attributes, options) {\n        if (this.isNew()) {\n            options = options || {};\n            options.url = this.urlRoot + this.get(\"history_id\") + \"/contents\";\n            attributes = attributes || {};\n            attributes.type = \"dataset_collection\";\n        }\n        return _super.call(this, attributes, options);\n    };\n}\n\n//==============================================================================\n/** @class Backbone model for List Dataset Collection within a History.\n */\nvar HistoryListDatasetCollection = ListDC.extend(hcontentMixin).extend(\n/** @lends HistoryListDatasetCollection.prototype */{\n    defaults: _.extend(_.clone(ListDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"list\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(ListDC.prototype.save),\n\n    /** String representation. */\n    toString: function toString() {\n        return \"History\" + ListDC.prototype.toString.call(this);\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for Pair Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryPairDatasetCollection = PairDC.extend(hcontentMixin).extend(\n/** @lends HistoryPairDatasetCollection.prototype */{\n    defaults: _.extend(_.clone(PairDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"paired\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(PairDC.prototype.save),\n\n    /** String representation. */\n    toString: function toString() {\n        return \"History\" + PairDC.prototype.toString.call(this);\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for List of Pairs Dataset Collection within a History. */\nvar HistoryListPairedDatasetCollection = ListPairedDC.extend(hcontentMixin).extend({\n    defaults: _.extend(_.clone(ListPairedDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"list:paired\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(ListPairedDC.prototype.save),\n\n    /** String representation. */\n    toString: function toString() {\n        return \"History\" + ListPairedDC.prototype.toString.call(this);\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for List of Lists Dataset Collection within a History. */\nvar HistoryListOfListsDatasetCollection = ListOfListsDC.extend(hcontentMixin).extend({\n    defaults: _.extend(_.clone(ListOfListsDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"list:list\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(ListOfListsDC.prototype.save),\n\n    /** String representation. */\n    toString: function toString() {\n        return \"HistoryListOfListsDatasetCollection(\" + this.get(\"name\") + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    HistoryListDatasetCollection: HistoryListDatasetCollection,\n    HistoryPairDatasetCollection: HistoryPairDatasetCollection,\n    HistoryListPairedDatasetCollection: HistoryListPairedDatasetCollection,\n    HistoryListOfListsDatasetCollection: HistoryListOfListsDatasetCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 80 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, Backbone, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _datasetModel = __webpack_require__(119);\n\nvar _datasetModel2 = _interopRequireDefault(_datasetModel);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\n/*\nNotes:\n\nTerminology:\n    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\n\nThis all seems too complex unfortunately:\n\n- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n    decided to merge the contained JSON with the DC element json - making the 'has a'\n    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n    DRY in both models and views, but may make tracking or tracing within these models\n    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n    or DatasetCollections (nested)). This also violates the rule of thumb about\n    favoring aggregation over inheritance.\n- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n    These each should a) be usable on their own, b) be usable in the context of\n    nesting within a collection model (at least in the case of ListPaired), and\n    c) be usable within the context of other container models (like History or\n    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n    handle those three situations, but it's proven difficult to do in a simple,\n    readable manner.\n- Ideally, histories and libraries would inherit from the same server models as\n    dataset collections do since they are (in essence) dataset collections themselves -\n    making the whole nested structure simpler. This would be a large, error-prone\n    refactoring and migration.\n\nMany of the classes and heirarchy are meant as extension points so, while the\nrelations and flow may be difficult to understand initially, they'll allow us to\nhandle the growth or flux dataset collection in the future (w/o actually implementing\nany YAGNI).\n\n*/\n//_________________________________________________________________________________________________ ELEMENTS\n/** @class mixin for Dataset collection elements.\n *      When collection elements are passed from the API, the underlying element is\n *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n *          effectively changing a DCE from a container to a subclass (has a --> is a).\n */\nvar DatasetCollectionElementMixin = {\n    /** default attributes used by elements in a dataset collection */\n    defaults: {\n        model_class: \"DatasetCollectionElement\",\n        element_identifier: null,\n        element_index: null,\n        element_type: null\n    },\n\n    /** merge the attributes of the sub-object 'object' into this model */\n    _mergeObject: function _mergeObject(attributes) {\n        // if we don't preserve and correct ids here, the element id becomes the object id\n        // and collision in backbone's _byId will occur and only\n        _.extend(attributes, attributes.object, {\n            element_id: attributes.id\n        });\n        delete attributes.object;\n        return attributes;\n    },\n\n    /** override to merge this.object into this */\n    constructor: function constructor(attributes, options) {\n        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n        attributes = this._mergeObject(attributes);\n        this.idAttribute = \"element_id\";\n        Backbone.Model.apply(this, arguments);\n    },\n\n    /** when the model is fetched, merge this.object into this */\n    parse: function parse(response, options) {\n        var attributes = response;\n        attributes = this._mergeObject(attributes);\n        return attributes;\n    }\n};\n\n/** @class Concrete class of Generic DatasetCollectionElement */\nvar DatasetCollectionElement = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(DatasetCollectionElementMixin).extend({ _logNamespace: \"collections\" });\n\n//==============================================================================\n/** @class Base/Abstract Backbone collection for Generic DCEs. */\nvar DCECollection = Backbone.Collection.extend(_baseMvc2.default.LoggableMixin).extend(\n/** @lends DCECollection.prototype */{\n    _logNamespace: \"collections\",\n\n    model: DatasetCollectionElement,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"DatasetCollectionElementCollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n */\nvar DatasetDCE = _datasetModel2.default.DatasetAssociation.extend(_baseMvc2.default.mixin(DatasetCollectionElementMixin,\n/** @lends DatasetDCE.prototype */{\n    /** url fn */\n    url: function url() {\n        // won't always be an hda\n        if (!this.has(\"history_id\")) {\n            console.warn(\"no endpoint for non-hdas within a collection yet\");\n            // (a little silly since this api endpoint *also* points at hdas)\n            return Galaxy.root + \"api/datasets\";\n        }\n        return Galaxy.root + \"api/histories/\" + this.get(\"history_id\") + \"/contents/\" + this.get(\"id\");\n    },\n\n    defaults: _.extend({}, _datasetModel2.default.DatasetAssociation.prototype.defaults, DatasetCollectionElementMixin.defaults),\n\n    _downloadQueryParameters: function _downloadQueryParameters() {\n        var fileExt = this.get(\"file_ext\");\n        var elementIdentifier = this.get(\"element_identifier\");\n        var parentHdcaId = this.get(\"parent_hdca_id\");\n        return \"?to_ext=\" + fileExt + \"&hdca_id=\" + parentHdcaId + \"&element_identifier=\" + elementIdentifier;\n    },\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually for now\n    /** call the mixin constructor */\n    constructor: function constructor(attributes, options) {\n        this.debug(\"\\t DatasetDCE.constructor:\", attributes, options);\n        //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails: function hasDetails() {\n        return this.elements && this.elements.length;\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        var objStr = this.get(\"element_identifier\");\n        return \"DatasetDCE({objStr})\";\n    }\n}));\n\n//==============================================================================\n/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n */\nvar DatasetDCECollection = DCECollection.extend(\n/** @lends DatasetDCECollection.prototype */{\n    model: DatasetDCE,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"DatasetDCECollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//_________________________________________________________________________________________________ COLLECTIONS\n/** @class Backbone model for Dataset Collections.\n *      The DC API returns an array of JSON objects under the attribute elements.\n *      This model:\n *          - removes that array/attribute ('elements') from the model,\n *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n *          - passes that json onto the bbone collection\n *          - caches the bbone collection in this.elements\n */\nvar DatasetCollection = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.SearchableModelMixin).extend(\n/** @lends DatasetCollection.prototype */{\n    _logNamespace: \"collections\",\n\n    /** default attributes for a model */\n    defaults: {\n        /* 'list', 'paired', or 'list:paired' */\n        collection_type: null,\n        //??\n        deleted: false\n    },\n\n    /** Which class to use for elements */\n    collectionClass: DCECollection,\n\n    /** set up: create elements instance var and (on changes to elements) update them  */\n    initialize: function initialize(model, options) {\n        this.debug(this + \"(DatasetCollection).initialize:\", model, options, this);\n        this.elements = this._createElementsModel();\n        this.on(\"change:elements\", function () {\n            this.log(\"change:elements\");\n            //TODO: prob. better to update the collection instead of re-creating it\n            this.elements = this._createElementsModel();\n        });\n    },\n\n    /** move elements model attribute to full collection */\n    _createElementsModel: function _createElementsModel() {\n        this.debug(this + \"._createElementsModel\", this.collectionClass, this.get(\"elements\"), this.elements);\n        //TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n        var elements = this.get(\"elements\") || [];\n        this.unset(\"elements\", { silent: true });\n        var self = this;\n        _.each(elements, function (element, index) {\n            _.extend(element, {\n                parent_hdca_id: self.get(\"id\")\n            });\n        });\n        this.elements = new this.collectionClass(elements);\n        //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n        return this.elements;\n    },\n\n    // ........................................................................ common queries\n    /** pass the elements back within the model json when this is serialized */\n    toJSON: function toJSON() {\n        var json = Backbone.Model.prototype.toJSON.call(this);\n        if (this.elements) {\n            json.elements = this.elements.toJSON();\n        }\n        return json;\n    },\n\n    /** Is this collection in a 'ready' state no processing (for the collection) is left\n     *  to do on the server.\n     */\n    inReadyState: function inReadyState() {\n        var populated = this.get(\"populated\");\n        return this.isDeletedOrPurged() || populated;\n    },\n\n    //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n    /** Does the DC contain any elements yet? Is a fetch() required? */\n    hasDetails: function hasDetails() {\n        return this.elements.length !== 0;\n    },\n\n    /** Given the filters, what models in this.elements would be returned? */\n    getVisibleContents: function getVisibleContents(filters) {\n        // filters unused for now\n        return this.elements;\n    },\n\n    // ........................................................................ ajax\n    /** override to use actual Dates objects for create/update times */\n    parse: function parse(response, options) {\n        var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n        if (parsed.create_time) {\n            parsed.create_time = new Date(parsed.create_time);\n        }\n        if (parsed.update_time) {\n            parsed.update_time = new Date(parsed.update_time);\n        }\n        return parsed;\n    },\n\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    delete: function _delete(options) {\n        if (this.get(\"deleted\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: true }, options);\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete: function undelete(options) {\n        if (!this.get(\"deleted\") || this.get(\"purged\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: false }, options);\n    },\n\n    /** Is this collection deleted or purged? */\n    isDeletedOrPurged: function isDeletedOrPurged() {\n        return this.get(\"deleted\") || this.get(\"purged\");\n    },\n\n    // ........................................................................ searchable\n    /** searchable attributes for collections */\n    searchAttributes: [\"name\", \"tags\"],\n\n    // ........................................................................ misc\n    /** String representation */\n    toString: function toString() {\n        var idAndName = [this.get(\"id\"), this.get(\"name\") || this.get(\"element_identifier\")];\n        return \"DatasetCollection(\" + idAndName.join(\",\") + \")\";\n    }\n});\n\n//==============================================================================\n/** Model for a DatasetCollection containing datasets (non-nested).\n */\nvar ListDatasetCollection = DatasetCollection.extend(\n/** @lends ListDatasetCollection.prototype */{\n    /** override since we know the collection will only contain datasets */\n    collectionClass: DatasetDCECollection,\n\n    /** String representation. */\n    toString: function toString() {\n        return \"List\" + DatasetCollection.prototype.toString.call(this);\n    }\n});\n\n//==============================================================================\n/** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n */\nvar PairDatasetCollection = ListDatasetCollection.extend(\n/** @lends PairDatasetCollection.prototype */{\n    /** String representation. */\n    toString: function toString() {\n        return \"Pair\" + DatasetCollection.prototype.toString.call(this);\n    }\n});\n\n//_________________________________________________________________________________________________ NESTED COLLECTIONS\n// this is where things get weird, man. Weird.\n//TODO: it might be possible to compact all the following...I think.\n//==============================================================================\n/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n *      (a nested collection). Currently only list:paired.\n */\nvar NestedDCDCE = DatasetCollection.extend(_baseMvc2.default.mixin(DatasetCollectionElementMixin,\n/** @lends NestedDCDCE.prototype */{\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** call the mixin constructor */\n    constructor: function constructor(attributes, options) {\n        this.debug(\"\\t NestedDCDCE.constructor:\", attributes, options);\n        DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        var objStr = this.object ? \"\" + this.object : this.get(\"element_identifier\");\n        return [\"NestedDCDCE(\", objStr, \")\"].join(\"\");\n    }\n}));\n\n//==============================================================================\n/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n */\nvar NestedDCDCECollection = DCECollection.extend(\n/** @lends NestedDCDCECollection.prototype */{\n    /** This is a collection of nested collections */\n    model: NestedDCDCE,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"NestedDCDCECollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n */\nvar NestedPairDCDCE = PairDatasetCollection.extend(_baseMvc2.default.mixin(DatasetCollectionElementMixin,\n/** @lends NestedPairDCDCE.prototype */{\n    //TODO:?? possibly rename to NestedDatasetCollection?\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** This is both a collection and a collection element - call the constructor */\n    constructor: function constructor(attributes, options) {\n        this.debug(\"\\t NestedPairDCDCE.constructor:\", attributes, options);\n        //DatasetCollection.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        var objStr = this.object ? \"\" + this.object : this.get(\"element_identifier\");\n        return [\"NestedPairDCDCE(\", objStr, \")\"].join(\"\");\n    }\n}));\n\n//==============================================================================\n/** @class Backbone collection for a backbone collection containing paired dataset collections.\n */\nvar NestedPairDCDCECollection = NestedDCDCECollection.extend(\n/** @lends PairDCDCECollection.prototype */{\n    /** We know this collection is composed of only nested pair collections */\n    model: NestedPairDCDCE,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"NestedPairDCDCECollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n */\nvar ListPairedDatasetCollection = DatasetCollection.extend(\n/** @lends ListPairedDatasetCollection.prototype */{\n    /** list:paired is the only collection that itself contains collections */\n    collectionClass: NestedPairDCDCECollection,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"ListPairedDatasetCollection(\", this.get(\"name\"), \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for a list dataset collection within a list:list dataset collection. */\nvar NestedListDCDCE = ListDatasetCollection.extend(_baseMvc2.default.mixin(DatasetCollectionElementMixin,\n/** @lends NestedListDCDCE.prototype */{\n    /** This is both a collection and a collection element - call the constructor */\n    constructor: function constructor(attributes, options) {\n        this.debug(\"\\t NestedListDCDCE.constructor:\", attributes, options);\n        DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        var objStr = this.object ? \"\" + this.object : this.get(\"element_identifier\");\n        return [\"NestedListDCDCE(\", objStr, \")\"].join(\"\");\n    }\n}));\n\n//==============================================================================\n/** @class Backbone collection containing list dataset collections. */\nvar NestedListDCDCECollection = NestedDCDCECollection.extend({\n    /** We know this collection is composed of only nested pair collections */\n    model: NestedListDCDCE,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"NestedListDCDCECollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains other lists. */\nvar ListOfListsDatasetCollection = DatasetCollection.extend({\n    /** list:paired is the only collection that itself contains collections */\n    collectionClass: NestedListDCDCECollection,\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"ListOfListsDatasetCollection(\", this.get(\"name\"), \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\nexports.default = {\n    ListDatasetCollection: ListDatasetCollection,\n    PairDatasetCollection: PairDatasetCollection,\n    ListPairedDatasetCollection: ListPairedDatasetCollection,\n    ListOfListsDatasetCollection: ListOfListsDatasetCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 81 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = {\n    tool: \"fa-wrench\",\n    data_input: \"fa-file-o\",\n    data_collection_input: \"fa-folder-o\",\n    subworkflow: \"fa-sitemap fa-rotate-270\",\n    pause: \"fa-pause\"\n};\n\n/***/ }),\n/* 82 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, jQuery, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _historyContents = __webpack_require__(83);\n\nvar _historyContents2 = _interopRequireDefault(_historyContents);\n\nvar _historyPreferences = __webpack_require__(84);\n\nvar _historyPreferences2 = _interopRequireDefault(_historyPreferences);\n\nvar _controlledFetchCollection = __webpack_require__(127);\n\nvar _controlledFetchCollection2 = _interopRequireDefault(_controlledFetchCollection);\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\n/** @class Model for a Galaxy history resource - both a record of user\n *      tool use and a collection of the datasets those tools produced.\n *  @name History\n *  @augments Backbone.Model\n */\nvar History = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.mixin(_baseMvc2.default.SearchableModelMixin,\n/** @lends History.prototype */{\n    _logNamespace: \"history\",\n\n    /** ms between fetches when checking running jobs/datasets for updates */\n    UPDATE_DELAY: 4000,\n\n    // values from api (may need more)\n    defaults: {\n        model_class: \"History\",\n        id: null,\n        name: \"Unnamed History\",\n        state: \"new\",\n\n        deleted: false,\n        contents_active: {},\n        contents_states: {}\n    },\n\n    urlRoot: Galaxy.root + \"api/histories\",\n\n    contentsClass: _historyContents2.default.HistoryContents,\n\n    /** What model fields to search with */\n    searchAttributes: [\"name\", \"annotation\", \"tags\"],\n\n    /** Adding title and singular tag */\n    searchAliases: {\n        title: \"name\",\n        tag: \"tags\"\n    },\n\n    // ........................................................................ set up/tear down\n    /** Set up the model\n     *  @param {Object} historyJSON model data for this History\n     *  @param {Object} options     any extra settings including logger\n     */\n    initialize: function initialize(historyJSON, options) {\n        options = options || {};\n        this.logger = options.logger || null;\n        this.log(this + \".initialize:\", historyJSON, options);\n\n        /** HistoryContents collection of the HDAs contained in this history. */\n        this.contents = new this.contentsClass([], {\n            history: this,\n            historyId: this.get(\"id\"),\n            order: options.order\n        });\n\n        this._setUpListeners();\n        this._setUpCollectionListeners();\n\n        /** cached timeout id for the dataset updater */\n        this.updateTimeoutId = null;\n    },\n\n    /** set up any event listeners for this history including those to the contained HDAs\n     *  events: error:contents  if an error occurred with the contents collection\n     */\n    _setUpListeners: function _setUpListeners() {\n        // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n        return this.on({\n            error: function error(model, xhr, options, msg, details) {\n                this.clearUpdateTimeout();\n            },\n            \"change:id\": function changeId(model, newId) {\n                if (this.contents) {\n                    this.contents.historyId = newId;\n                }\n            }\n        });\n    },\n\n    /** event handlers for the contents submodels */\n    _setUpCollectionListeners: function _setUpCollectionListeners() {\n        if (!this.contents) {\n            return this;\n        }\n        // bubble up errors\n        return this.listenTo(this.contents, {\n            error: function error() {\n                this.trigger.apply(this, jQuery.makeArray(arguments));\n            }\n        });\n    },\n\n    // ........................................................................ derived attributes\n    /**  */\n    contentsShown: function contentsShown() {\n        var contentsActive = this.get(\"contents_active\");\n        var shown = contentsActive.active || 0;\n        shown += this.contents.includeDeleted ? contentsActive.deleted : 0;\n        shown += this.contents.includeHidden ? contentsActive.hidden : 0;\n        return shown;\n    },\n\n    /** convert size in bytes to a more human readable version */\n    nice_size: function nice_size() {\n        var size = this.get(\"size\");\n        return size ? _utils2.default.bytesToString(size, true, 2) : (0, _localization2.default)(\"(empty)\");\n    },\n\n    /** override to add nice_size */\n    toJSON: function toJSON() {\n        return _.extend(Backbone.Model.prototype.toJSON.call(this), {\n            nice_size: this.nice_size()\n        });\n    },\n\n    /** override to allow getting nice_size */\n    get: function get(key) {\n        if (key === \"nice_size\") {\n            return this.nice_size();\n        }\n        return Backbone.Model.prototype.get.apply(this, arguments);\n    },\n\n    // ........................................................................ common queries\n    /** T/F is this history owned by the current user (Galaxy.user)\n     *      Note: that this will return false for an anon user even if the history is theirs.\n     */\n    ownedByCurrUser: function ownedByCurrUser() {\n        // no currUser\n        if (!Galaxy || !Galaxy.user) {\n            return false;\n        }\n        // user is anon or history isn't owned\n        if (Galaxy.user.isAnonymous() || Galaxy.user.id !== this.get(\"user_id\")) {\n            return false;\n        }\n        return true;\n    },\n\n    /** Return the number of running jobs assoc with this history (note: unknown === 0) */\n    numOfUnfinishedJobs: function numOfUnfinishedJobs() {\n        var unfinishedJobIds = this.get(\"non_ready_jobs\");\n        return unfinishedJobIds ? unfinishedJobIds.length : 0;\n    },\n\n    /** Return the number of running hda/hdcas in this history (note: unknown === 0) */\n    numOfUnfinishedShownContents: function numOfUnfinishedShownContents() {\n        return this.contents.runningAndActive().length || 0;\n    },\n\n    // ........................................................................ updates\n    _fetchContentRelatedAttributes: function _fetchContentRelatedAttributes() {\n        var contentRelatedAttrs = [\"size\", \"non_ready_jobs\", \"contents_active\", \"hid_counter\"];\n        return this.fetch({\n            data: $.param({\n                keys: contentRelatedAttrs.join(\",\")\n            })\n        });\n    },\n\n    /** check for any changes since the last time we updated (or fetch all if ) */\n    refresh: function refresh(options) {\n        var _this = this;\n\n        // console.log( this + '.refresh' );\n        options = options || {};\n\n        // note if there was no previous update time, all summary contents will be fetched\n        var lastUpdateTime = this.lastUpdateTime;\n        // if we don't flip this, then a fully-fetched list will not be re-checked via fetch\n        this.contents.allFetched = false;\n        var fetchFn = this.contents.currentPage !== 0 ? function () {\n            return _this.contents.fetchPage(_this.contents.currentPage);\n        } : function () {\n            return _this.contents.fetchUpdated(lastUpdateTime);\n        };\n        // note: if there was no previous update time, all summary contents will be fetched\n        return fetchFn().done(function (response, status, xhr) {\n            var serverResponseDatetime;\n            try {\n                serverResponseDatetime = new Date(xhr.getResponseHeader(\"Date\"));\n            } catch (err) {}\n            _this.lastUpdateTime = serverResponseDatetime || new Date();\n            _this.checkForUpdates(options);\n        });\n    },\n\n    /** continuously fetch updated contents every UPDATE_DELAY ms if this history's datasets or jobs are unfinished */\n    checkForUpdates: function checkForUpdates(options) {\n        var _this2 = this;\n\n        // console.log( this + '.checkForUpdates' );\n        options = options || {};\n        var delay = this.UPDATE_DELAY;\n        if (!this.id) {\n            return;\n        }\n\n        var _delayThenUpdate = function _delayThenUpdate() {\n            // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n            _this2.clearUpdateTimeout();\n            _this2.updateTimeoutId = setTimeout(function () {\n                _this2.refresh(options);\n            }, delay);\n        };\n\n        // if there are still datasets in the non-ready state, recurse into this function with the new time\n        var nonReadyContentCount = this.numOfUnfinishedShownContents();\n        // console.log( 'nonReadyContentCount:', nonReadyContentCount );\n        if (nonReadyContentCount > 0) {\n            _delayThenUpdate();\n        } else {\n            // no datasets are running, but currently runnning jobs may still produce new datasets\n            // see if the history has any running jobs and continue to update if so\n            // (also update the size for the user in either case)\n            this._fetchContentRelatedAttributes().done(function (historyData) {\n                // console.log( 'non_ready_jobs:', historyData.non_ready_jobs );\n                if (_this2.numOfUnfinishedJobs() > 0) {\n                    _delayThenUpdate();\n                } else {\n                    // otherwise, let listeners know that all updates have stopped\n                    _this2.trigger(\"ready\");\n                }\n            });\n        }\n    },\n\n    /** clear the timeout and the cached timeout id */\n    clearUpdateTimeout: function clearUpdateTimeout() {\n        if (this.updateTimeoutId) {\n            clearTimeout(this.updateTimeoutId);\n            this.updateTimeoutId = null;\n        }\n    },\n\n    // ........................................................................ ajax\n    /** override to use actual Dates objects for create/update times */\n    parse: function parse(response, options) {\n        var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n        if (parsed.create_time) {\n            parsed.create_time = new Date(parsed.create_time);\n        }\n        if (parsed.update_time) {\n            parsed.update_time = new Date(parsed.update_time);\n        }\n        return parsed;\n    },\n\n    /** fetch this histories data (using options) then it's contents (using contentsOptions) */\n    fetchWithContents: function fetchWithContents(options, contentsOptions) {\n        options = options || {};\n        var self = this;\n\n        // console.log( this + '.fetchWithContents' );\n        // TODO: push down to a base class\n        options.view = \"dev-detailed\";\n\n        // fetch history then use history data to fetch (paginated) contents\n        return this.fetch(options).then(function getContents(history) {\n            self.contents.history = self;\n            self.contents.setHistoryId(history.id);\n            return self.fetchContents(contentsOptions);\n        });\n    },\n\n    /** fetch this histories contents, adjusting options based on the stored history preferences */\n    fetchContents: function fetchContents(options) {\n        options = options || {};\n        var self = this;\n\n        // we're updating, reset the update time\n        self.lastUpdateTime = new Date();\n        return self.contents.fetchCurrentPage(options);\n    },\n\n    /** save this history, _Mark_ing it as deleted (just a flag) */\n    _delete: function _delete(options) {\n        if (this.get(\"deleted\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: true }, options);\n    },\n    /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n    purge: function purge(options) {\n        if (this.get(\"purged\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: true, purged: true }, options);\n    },\n    /** save this history, _Mark_ing it as undeleted */\n    undelete: function undelete(options) {\n        if (!this.get(\"deleted\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: false }, options);\n    },\n\n    /** Make a copy of this history on the server\n     *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n     *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n     *  @fires copied               passed this history and the response JSON from the copy\n     *  @returns {xhr}\n     */\n    copy: function copy(current, name, allDatasets) {\n        current = current !== undefined ? current : true;\n        if (!this.id) {\n            throw new Error(\"You must set the history ID before copying it.\");\n        }\n\n        var postData = { history_id: this.id };\n        if (current) {\n            postData.current = true;\n        }\n        if (name) {\n            postData.name = name;\n        }\n        if (!allDatasets) {\n            postData.all_datasets = false;\n        }\n        postData.view = \"dev-detailed\";\n\n        var history = this;\n        var copy = jQuery.post(this.urlRoot, postData);\n        // if current - queue to setAsCurrent before firing 'copied'\n        if (current) {\n            return copy.then(function (response) {\n                var newHistory = new History(response);\n                return newHistory.setAsCurrent().done(function () {\n                    history.trigger(\"copied\", history, response);\n                });\n            });\n        }\n        return copy.done(function (response) {\n            history.trigger(\"copied\", history, response);\n        });\n    },\n\n    setAsCurrent: function setAsCurrent() {\n        var history = this;\n\n        var xhr = jQuery.getJSON(Galaxy.root + \"history/set_as_current?id=\" + this.id);\n\n        xhr.done(function () {\n            history.trigger(\"set-as-current\", history);\n        });\n        return xhr;\n    },\n\n    // ........................................................................ misc\n    toString: function toString() {\n        return \"History(\" + this.get(\"id\") + \",\" + this.get(\"name\") + \")\";\n    }\n}));\n\n//==============================================================================\nvar _collectionSuper = _controlledFetchCollection2.default.InfinitelyScrollingCollection;\n/** @class A collection of histories (per user)\n *      that maintains the current history as the first in the collection.\n *  New or copied histories become the current history.\n */\nvar HistoryCollection = _collectionSuper.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    model: History,\n    /** @type {String} initial order used by collection */\n    order: \"update_time\",\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: 10,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 10,\n\n    initialize: function initialize(models, options) {\n        options = options || {};\n        this.log(\"HistoryCollection.initialize\", models, options);\n        _collectionSuper.prototype.initialize.call(this, models, options);\n\n        /** @type {boolean} should deleted histories be included */\n        this.includeDeleted = options.includeDeleted || false;\n\n        /** @type {String} encoded id of the history that's current */\n        this.currentHistoryId = options.currentHistoryId;\n\n        this.setUpListeners();\n        // note: models are sent to reset *after* this fn ends; up to this point\n        // the collection *is empty*\n    },\n\n    urlRoot: Galaxy.root + \"api/histories\",\n    url: function url() {\n        return this.urlRoot;\n    },\n\n    /** set up reflexive event handlers */\n    setUpListeners: function setUpListeners() {\n        return this.on({\n            // when a history is deleted, remove it from the collection (if optionally set to do so)\n            \"change:deleted\": function changeDeleted(history) {\n                // TODO: this becomes complicated when more filters are used\n                this.debug(\"change:deleted\", this.includeDeleted, history.get(\"deleted\"));\n                if (!this.includeDeleted && history.get(\"deleted\")) {\n                    this.remove(history);\n                }\n            },\n            // listen for a history copy, setting it to current\n            copied: function copied(original, newData) {\n                this.setCurrent(new History(newData, []));\n            },\n            // when a history is made current, track the id in the collection\n            \"set-as-current\": function setAsCurrent(history) {\n                var oldCurrentId = this.currentHistoryId;\n                this.trigger(\"no-longer-current\", oldCurrentId);\n                this.currentHistoryId = history.id;\n            }\n        });\n    },\n\n    /** override to change view */\n    _buildFetchData: function _buildFetchData(options) {\n        return _.extend(_collectionSuper.prototype._buildFetchData.call(this, options), {\n            view: \"dev-detailed\"\n        });\n    },\n\n    /** override to filter out deleted and purged */\n    _buildFetchFilters: function _buildFetchFilters(options) {\n        var superFilters = _collectionSuper.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (!this.includeDeleted) {\n            filters.deleted = false;\n            filters.purged = false;\n        } else {\n            // force API to return both deleted and non\n            //TODO: when the API is updated, remove this\n            filters.deleted = null;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    /** override to fetch current as well (as it may be outside the first 10, etc.) */\n    fetchFirst: function fetchFirst(options) {\n        var self = this;\n        // TODO: batch?\n        var xhr = $.when();\n        if (this.currentHistoryId) {\n            xhr = _collectionSuper.prototype.fetchFirst.call(self, {\n                silent: true,\n                limit: 1,\n                filters: {\n                    // without these a deleted current history will return [] here and block the other xhr\n                    purged: \"\",\n                    deleted: \"\",\n                    \"encoded_id-in\": this.currentHistoryId\n                }\n            });\n        }\n        return xhr.then(function () {\n            options = options || {};\n            options.offset = 0;\n            return self.fetchMore(options);\n        });\n    },\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_collectionSuper.prototype.comparators), {\n        name: _baseMvc2.default.buildComparator(\"name\", {\n            ascending: true\n        }),\n        \"name-dsc\": _baseMvc2.default.buildComparator(\"name\", {\n            ascending: false\n        }),\n        size: _baseMvc2.default.buildComparator(\"size\", {\n            ascending: false\n        }),\n        \"size-asc\": _baseMvc2.default.buildComparator(\"size\", {\n            ascending: true\n        })\n    }),\n\n    /** override to always have the current history first */\n    sort: function sort(options) {\n        options = options || {};\n        var silent = options.silent;\n        var currentHistory = this.remove(this.get(this.currentHistoryId));\n        _collectionSuper.prototype.sort.call(this, _.defaults({ silent: true }, options));\n        this.unshift(currentHistory, { silent: true });\n        if (!silent) {\n            this.trigger(\"sort\", this, options);\n        }\n        return this;\n    },\n\n    /** create a new history and by default set it to be the current history */\n    create: function create(data, hdas, historyOptions, xhrOptions) {\n        //TODO: .create is actually a collection function that's overridden here\n        var collection = this;\n\n        var xhr = jQuery.getJSON(Galaxy.root + \"history/create_new_current\");\n        return xhr.done(function (newData) {\n            collection.setCurrent(new History(newData, [], historyOptions || {}));\n        });\n    },\n\n    /** set the current history to the given history, placing it first in the collection.\n     *  Pass standard bbone options for use in unshift.\n     *  @triggers new-current passed history and this collection\n     */\n    setCurrent: function setCurrent(history, options) {\n        options = options || {};\n        // new histories go in the front\n        this.unshift(history, options);\n        this.currentHistoryId = history.get(\"id\");\n        if (!options.silent) {\n            this.trigger(\"new-current\", history, this);\n        }\n        return this;\n    },\n\n    toString: function toString() {\n        return \"HistoryCollection(\" + this.length + \",current:\" + this.currentHistoryId + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    History: History,\n    HistoryCollection: HistoryCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 83 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, jQuery, Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _controlledFetchCollection = __webpack_require__(127);\n\nvar _controlledFetchCollection2 = _interopRequireDefault(_controlledFetchCollection);\n\nvar _hdaModel = __webpack_require__(128);\n\nvar _hdaModel2 = _interopRequireDefault(_hdaModel);\n\nvar _hdcaModel = __webpack_require__(79);\n\nvar _hdcaModel2 = _interopRequireDefault(_hdcaModel);\n\nvar _historyPreferences = __webpack_require__(84);\n\nvar _historyPreferences2 = _interopRequireDefault(_historyPreferences);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _ajaxQueue = __webpack_require__(247);\n\nvar _ajaxQueue2 = _interopRequireDefault(_ajaxQueue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _controlledFetchCollection2.default.PaginatedCollection;\n/** @class Backbone collection for history content.\n *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n *          the same level.\n *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n *          HDAs or child dataset collections on one level.\n *      This is why this does not inherit from any of the DatasetCollections (currently).\n */\nvar HistoryContents = _super.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    // ........................................................................ set up\n    limitPerPage: 500,\n\n    /** @type {Integer} how many contents per call to fetch when using progressivelyFetchDetails */\n    limitPerProgressiveFetch: 500,\n\n    /** @type {String} order used here and when fetching from server */\n    order: \"hid\",\n\n    /** root api url */\n    urlRoot: Galaxy.root + \"api/histories\",\n\n    /** complete api url */\n    url: function url() {\n        return this.urlRoot + \"/\" + this.historyId + \"/contents\";\n    },\n\n    /** Set up */\n    initialize: function initialize(models, options) {\n        options = options || {};\n        _super.prototype.initialize.call(this, models, options);\n\n        this.history = options.history || null;\n        this.setHistoryId(options.historyId || null);\n        /** @type {Boolean} does this collection contain and fetch deleted elements */\n        this.includeDeleted = options.includeDeleted || this.includeDeleted;\n        /** @type {Boolean} does this collection contain and fetch non-visible elements */\n        this.includeHidden = options.includeHidden || this.includeHidden;\n\n        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n        this.model.prototype.idAttribute = \"type_id\";\n    },\n\n    // ........................................................................ composite collection\n    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n    model: function model(attrs, options) {\n        if (attrs.history_content_type === \"dataset\") {\n            return new _hdaModel2.default.HistoryDatasetAssociation(attrs, options);\n        } else if (attrs.history_content_type === \"dataset_collection\") {\n            switch (attrs.collection_type) {\n                case \"list\":\n                    return new _hdcaModel2.default.HistoryListDatasetCollection(attrs, options);\n                case \"paired\":\n                    return new _hdcaModel2.default.HistoryPairDatasetCollection(attrs, options);\n                case \"list:paired\":\n                    return new _hdcaModel2.default.HistoryListPairedDatasetCollection(attrs, options);\n                case \"list:list\":\n                    return new _hdcaModel2.default.HistoryListOfListsDatasetCollection(attrs, options);\n            }\n            // This is a hack inside a hack:\n            // Raise a plain object with validationError to fake a model.validationError\n            // (since we don't have a model to use validate with)\n            // (the outer hack being the mixed content/model function in this collection)\n            var msg = \"Unknown collection_type: \" + attrs.collection_type;\n            console.warn(msg, attrs);\n            return { validationError: msg };\n        }\n        return {\n            validationError: \"Unknown history_content_type: \" + attrs.history_content_type\n        };\n    },\n\n    setHistoryId: function setHistoryId(newId) {\n        this.historyId = newId;\n        this._setUpWebStorage();\n    },\n\n    /** Set up client side storage. Currently PersistanStorage keyed under 'history:<id>' */\n    _setUpWebStorage: function _setUpWebStorage(initialSettings) {\n        // TODO: use initialSettings\n        if (!this.historyId) {\n            return;\n        }\n        this.storage = new _historyPreferences2.default.HistoryPrefs({\n            id: _historyPreferences2.default.HistoryPrefs.historyStorageKey(this.historyId)\n        });\n        this.trigger(\"new-storage\", this.storage, this);\n\n        this.on({\n            \"include-deleted\": function includeDeleted(newVal) {\n                this.storage.includeDeleted(newVal);\n            },\n            \"include-hidden\": function includeHidden(newVal) {\n                this.storage.includeHidden(newVal);\n            }\n        });\n\n        this.includeDeleted = this.storage.includeDeleted() || false;\n        this.includeHidden = this.storage.includeHidden() || false;\n        return this;\n    },\n\n    // ........................................................................ common queries\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_super.prototype.comparators), {\n        name: _baseMvc2.default.buildComparator(\"name\", { ascending: true }),\n        \"name-dsc\": _baseMvc2.default.buildComparator(\"name\", {\n            ascending: false\n        }),\n        hid: _baseMvc2.default.buildComparator(\"hid\", { ascending: false }),\n        \"hid-asc\": _baseMvc2.default.buildComparator(\"hid\", { ascending: true })\n    }),\n\n    /** Get every model in this collection not in a 'ready' state (running). */\n    running: function running() {\n        return this.filter(function (c) {\n            return !c.inReadyState();\n        });\n    },\n\n    /** return contents that are not ready and not deleted/hidden */\n    runningAndActive: function runningAndActive() {\n        return this.filter(function (c) {\n            return !c.inReadyState() && c.get(\"visible\") &&\n            // TODO: deletedOrPurged?\n            !c.get(\"deleted\");\n        });\n    },\n\n    /** Get the model with the given hid\n     *  @param {Int} hid the hid to search for\n     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n     */\n    getByHid: function getByHid(hid) {\n        // note: there *can* be more than one content with a given hid, this finds the first based on order\n        return this.findWhere({ hid: hid });\n    },\n\n    /** return true if all contents have details */\n    haveDetails: function haveDetails() {\n        return this.all(function (c) {\n            return c.hasDetails();\n        });\n    },\n\n    // ........................................................................ hidden / deleted\n    /** return a new contents collection of only hidden items */\n    hidden: function hidden() {\n        return this.filter(function (c) {\n            return c.hidden();\n        });\n    },\n\n    /** return a new contents collection of only hidden items */\n    deleted: function deleted() {\n        return this.filter(function (c) {\n            return c.get(\"deleted\");\n        });\n    },\n\n    /** return a new contents collection of only hidden items */\n    visibleAndUndeleted: function visibleAndUndeleted() {\n        return this.filter(function (c) {\n            return c.get(\"visible\") &&\n            // TODO: deletedOrPurged?\n            !c.get(\"deleted\");\n        });\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeDeleted: function setIncludeDeleted(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeDeleted) {\n            this.includeDeleted = setting;\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-deleted\", setting, this);\n        }\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeHidden: function setIncludeHidden(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeHidden) {\n            this.includeHidden = setting;\n            options = options || {};\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-hidden\", setting, this);\n        }\n    },\n\n    // ........................................................................ ajax\n    // ............ controlled fetch collection\n    /** override to get expanded ids from sessionStorage and pass to API as details */\n    fetch: function fetch(options) {\n        options = options || {};\n        if (this.historyId && !options.details) {\n            var prefs = _historyPreferences2.default.HistoryPrefs.get(this.historyId).toJSON();\n            if (!_.isEmpty(prefs.expandedIds)) {\n                options.details = _.values(prefs.expandedIds).join(\",\");\n            }\n        }\n        return _super.prototype.fetch.call(this, options);\n    },\n\n    // ............. ControlledFetch stuff\n    /** override to include the API versioning flag */\n    _buildFetchData: function _buildFetchData(options) {\n        return _.extend(_super.prototype._buildFetchData.call(this, options), {\n            v: \"dev\"\n        });\n    },\n\n    /** Extend to include details and version */\n    _fetchParams: _super.prototype._fetchParams.concat([\n    // TODO: remove (the need for) both\n    /** version */\n    \"v\",\n    /** dataset ids to get full details of */\n    \"details\"]),\n\n    /** override to add deleted/hidden filters */\n    _buildFetchFilters: function _buildFetchFilters(options) {\n        var superFilters = _super.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (!this.includeDeleted) {\n            filters.deleted = false;\n            filters.purged = false;\n        }\n        if (!this.includeHidden) {\n            filters.visible = true;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    // ............ paginated collection\n    getTotalItemCount: function getTotalItemCount() {\n        return this.history.contentsShown();\n    },\n\n    // ............ history contents specific ajax\n    /** override to filter requested contents to those updated after the Date 'since' */\n    fetchUpdated: function fetchUpdated(since, options) {\n        if (since) {\n            options = options || { filters: {} };\n            options.remove = false;\n            options.filters = {\n                \"update_time-ge\": since.toISOString(),\n                // workflows will produce hidden datasets (non-output datasets) that still\n                // need to be updated in the collection or they'll update forever\n                // we can remove the default visible filter by using an 'empty' value\n                visible: \"\"\n            };\n        }\n        return this.fetch(options);\n    },\n\n    /** fetch all the deleted==true contents of this collection */\n    fetchDeleted: function fetchDeleted(options) {\n        var _this = this;\n\n        options = options || {};\n        options.filters = _.extend(options.filters, {\n            // all deleted, purged or not\n            deleted: true,\n            purged: undefined\n        });\n        options.remove = false;\n\n        this.trigger(\"fetching-deleted\", this);\n        return this.fetch(options).always(function () {\n            _this.trigger(\"fetching-deleted-done\", _this);\n        });\n    },\n\n    /** fetch all the visible==false contents of this collection */\n    fetchHidden: function fetchHidden(options) {\n        options = options || {};\n        var self = this;\n        options.filters = _.extend(options.filters, {\n            visible: false\n        });\n        options.remove = false;\n\n        self.trigger(\"fetching-hidden\", self);\n        return self.fetch(options).always(function () {\n            self.trigger(\"fetching-hidden-done\", self);\n        });\n    },\n\n    /** fetch detailed model data for all contents in this collection */\n    fetchAllDetails: function fetchAllDetails(options) {\n        options = options || {};\n        var detailsFlag = { details: \"all\" };\n        options.data = _.extend(options.data || {}, detailsFlag);\n        return this.fetch(options);\n    },\n\n    /** specialty fetch method for retrieving the element_counts of all hdcas in the history */\n    fetchCollectionCounts: function fetchCollectionCounts(options) {\n        options = options || {};\n        options.keys = [\"type_id\", \"element_count\"].join(\",\");\n        options.filters = _.extend(options.filters || {}, {\n            history_content_type: \"dataset_collection\"\n        });\n        options.remove = false;\n        return this.fetch(options);\n    },\n\n    // ............. quasi-batch ops\n    // TODO: to batch\n    /** helper that fetches using filterParams then calls save on each fetched using updateWhat as the save params */\n    _filterAndUpdate: function _filterAndUpdate(filterParams, updateWhat) {\n        var self = this;\n        var idAttribute = self.model.prototype.idAttribute;\n        var updateArgs = [updateWhat];\n\n        return self.fetch({ filters: filterParams, remove: false }).then(function (fetched) {\n            // convert filtered json array to model array\n            fetched = fetched.reduce(function (modelArray, currJson, i) {\n                var model = self.get(currJson[idAttribute]);\n                return model ? modelArray.concat(model) : modelArray;\n            }, []);\n            return self.ajaxQueue(\"save\", updateArgs, fetched);\n        });\n    },\n\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue: function ajaxQueue(ajaxFn, args, collection) {\n        collection = collection || this.models;\n        return new _ajaxQueue2.default.AjaxQueue(collection.slice().reverse().map(function (content, i) {\n            var fn = _.isString(ajaxFn) ? content[ajaxFn] : ajaxFn;\n            return function () {\n                return fn.apply(content, args);\n            };\n        })).deferred;\n    },\n\n    /** fetch contents' details in batches of limitPerCall - note: only get searchable details here */\n    progressivelyFetchDetails: function progressivelyFetchDetails(options) {\n        options = options || {};\n        var deferred = jQuery.Deferred();\n        var self = this;\n        var limit = options.limitPerCall || self.limitPerProgressiveFetch;\n        // TODO: only fetch tags and annotations if specifically requested\n        var searchAttributes = _hdaModel2.default.HistoryDatasetAssociation.prototype.searchAttributes;\n        var detailKeys = searchAttributes.join(\",\");\n\n        function _recursivelyFetch(offset) {\n            offset = offset || 0;\n            var _options = _.extend(_.clone(options), {\n                view: \"summary\",\n                keys: detailKeys,\n                limit: limit,\n                offset: offset,\n                reset: offset === 0,\n                remove: false\n            });\n\n            _.defer(function () {\n                self.fetch.call(self, _options).fail(deferred.reject).done(function (response) {\n                    deferred.notify(response, limit, offset);\n                    if (response.length !== limit) {\n                        self.allFetched = true;\n                        deferred.resolve(response, limit, offset);\n                    } else {\n                        _recursivelyFetch(offset + limit);\n                    }\n                });\n            });\n        }\n        _recursivelyFetch();\n        return deferred;\n    },\n\n    /** does some bit of JSON represent something that can be copied into this contents collection */\n    isCopyable: function isCopyable(contentsJSON) {\n        var copyableModelClasses = [\"HistoryDatasetAssociation\", \"HistoryDatasetCollectionAssociation\"];\n        return _.isObject(contentsJSON) && contentsJSON.id && _.contains(copyableModelClasses, contentsJSON.model_class);\n    },\n\n    /** copy an existing, accessible hda into this collection */\n    copy: function copy(json) {\n        // TODO: somehow showhorn all this into 'save'\n        var id;\n\n        var type;\n        var contentType;\n        if (_.isString(json)) {\n            id = json;\n            contentType = \"hda\";\n            type = \"dataset\";\n        } else {\n            id = json.id;\n            contentType = {\n                HistoryDatasetAssociation: \"hda\",\n                LibraryDatasetDatasetAssociation: \"ldda\",\n                HistoryDatasetCollectionAssociation: \"hdca\"\n            }[json.model_class] || \"hda\";\n            type = contentType === \"hdca\" ? \"dataset_collection\" : \"dataset\";\n        }\n        var collection = this;\n\n        var xhr = jQuery.ajax(this.url(), {\n            method: \"POST\",\n            contentType: \"application/json\",\n            data: JSON.stringify({\n                content: id,\n                source: contentType,\n                type: type\n            })\n        }).done(function (response) {\n            collection.add([response], { parse: true });\n        }).fail(function (error, status, message) {\n            collection.trigger(\"error\", collection, xhr, {}, \"Error copying contents\", {\n                type: type,\n                id: id,\n                source: contentType\n            });\n        });\n\n        return xhr;\n    },\n\n    /** create a new HDCA in this collection */\n    createHDCA: function createHDCA(elementIdentifiers, collectionType, name, hideSourceItems, options) {\n        // normally collection.create returns the new model, but we need the promise from the ajax, so we fake create\n        //precondition: elementIdentifiers is an array of plain js objects\n        //  in the proper form to create the collectionType\n        var hdca = this.model({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: this.historyId,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            // should probably be able to just send in a bunch of json here and restruct per class\n            // note: element_identifiers is now (incorrectly) an attribute\n            element_identifiers: elementIdentifiers\n            // do not create the model on the client until the ajax returns\n        });\n        return hdca.save(options);\n    },\n\n    // ........................................................................ searching\n    /** return true if all contents have the searchable attributes */\n    haveSearchDetails: function haveSearchDetails() {\n        return this.allFetched && this.all(function (content // null (which is a valid returned annotation value)\n        ) {\n            return (\n                // will return false when using content.has( 'annotation' )\n                //TODO: a bit hacky - formalize\n                _.has(content.attributes, \"annotation\")\n            );\n        });\n    },\n\n    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n    matches: function matches(matchesWhat) {\n        return this.filter(function (content) {\n            return content.matches(matchesWhat);\n        });\n    },\n\n    // ........................................................................ misc\n    /** In this override, copy the historyId to the clone */\n    clone: function clone() {\n        var clone = Backbone.Collection.prototype.clone.call(this);\n        clone.historyId = this.historyId;\n        return clone;\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"HistoryContents(\", [this.historyId, this.length].join(), \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\nexports.default = {\n    HistoryContents: HistoryContents\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0), __webpack_require__(2)))\n\n/***/ }),\n/* 84 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"history\";\n\n// ============================================================================\n/** session storage for individual history preferences */\nvar HistoryPrefs = _baseMvc2.default.SessionStorageModel.extend(\n/** @lends HistoryPrefs.prototype */{\n    //TODO:?? move to user prefs?\n    defaults: {\n        //TODO:?? expandedIds to array?\n        expandedIds: {},\n        show_deleted: false,\n        show_hidden: false\n    },\n\n    /** add an hda id to the hash of expanded hdas */\n    addExpanded: function addExpanded(model) {\n        //TODO: use type_id and not model\n        var current = this.get(\"expandedIds\");\n        current[model.id] = model.get(\"id\");\n        this.save(\"expandedIds\", current);\n    },\n\n    /** remove an hda id from the hash of expanded hdas */\n    removeExpanded: function removeExpanded(model) {\n        var current = this.get(\"expandedIds\");\n        delete current[model.id];\n        this.save(\"expandedIds\", current);\n    },\n\n    isExpanded: function isExpanded(contentId) {\n        return _.result(this.get(\"expandedIds\"), contentId, false);\n    },\n\n    allExpanded: function allExpanded() {\n        return _.values(this.get(\"expandedIds\"));\n    },\n\n    clearExpanded: function clearExpanded() {\n        this.set(\"expandedIds\", {});\n    },\n\n    includeDeleted: function includeDeleted(val) {\n        // moving the invocation here so other components don't need to know the key\n        // TODO: change this key later\n        if (!_.isUndefined(val)) {\n            this.set(\"show_deleted\", val);\n        }\n        return this.get(\"show_deleted\");\n    },\n\n    includeHidden: function includeHidden(val) {\n        // TODO: change this key later\n        if (!_.isUndefined(val)) {\n            this.set(\"show_hidden\", val);\n        }\n        return this.get(\"show_hidden\");\n    },\n\n    toString: function toString() {\n        return \"HistoryPrefs(\" + this.id + \")\";\n    }\n}, {\n    // ........................................................................ class vars\n    // class lvl for access w/o instantiation\n    storageKeyPrefix: \"history:\",\n\n    /** key string to store each histories settings under */\n    historyStorageKey: function historyStorageKey(historyId) {\n        if (!historyId) {\n            throw new Error(\"HistoryPrefs.historyStorageKey needs valid id: \" + historyId);\n        }\n        // single point of change\n        return HistoryPrefs.storageKeyPrefix + historyId;\n    },\n\n    /** return the existing storage for the history with the given id (or create one if it doesn't exist) */\n    get: function get(historyId) {\n        return new HistoryPrefs({\n            id: HistoryPrefs.historyStorageKey(historyId)\n        });\n    },\n\n    /** clear all history related items in sessionStorage */\n    clearAll: function clearAll(historyId) {\n        for (var key in sessionStorage) {\n            if (key.indexOf(HistoryPrefs.storageKeyPrefix) === 0) {\n                sessionStorage.removeItem(key);\n            }\n        }\n    }\n});\n\n//==============================================================================\nexports.default = {\n    HistoryPrefs: HistoryPrefs\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 85 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"list\";\n//==============================================================================\n/** A view which, when first rendered, shows only summary data/attributes, but\n *      can be expanded to show further details (and optionally fetch those\n *      details from the server).\n */\nvar ExpandableView = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n    //PRECONDITION: model must have method hasDetails\n    //PRECONDITION: subclasses must have templates.el and templates.details\n\n    initialize: function initialize(attributes) {\n        /** are the details of this view expanded/shown or not? */\n        this.expanded = attributes.expanded || false;\n        this.log(\"\\t expanded:\", this.expanded);\n        this.fxSpeed = attributes.fxSpeed !== undefined ? attributes.fxSpeed : this.fxSpeed;\n    },\n\n    // ........................................................................ render main\n    /** jq fx speed */\n    fxSpeed: \"fast\",\n\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render: function render(speed) {\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors($newRender);\n        this._queueNewRender($newRender, speed);\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     *      If the view is already expanded, build the details as well.\n     */\n    _buildNewRender: function _buildNewRender() {\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = $(this.templates.el(this.model.toJSON(), this));\n        if (this.expanded) {\n            this.$details($newRender).replaceWith(this._renderDetails().show());\n        }\n        return $newRender;\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender: function _queueNewRender($newRender, speed) {\n        speed = speed === undefined ? this.fxSpeed : speed;\n        var view = this;\n\n        if (speed === 0) {\n            view._swapNewRender($newRender);\n            view.trigger(\"rendered\", view);\n        } else {\n            $(view).queue(\"fx\", [function (next) {\n                view.$el.fadeOut(speed, next);\n            }, function (next) {\n                view._swapNewRender($newRender);\n                next();\n            }, function (next) {\n                view.$el.fadeIn(speed, next);\n            }, function (next) {\n                view.trigger(\"rendered\", view);\n                next();\n            }]);\n        }\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender: function _swapNewRender($newRender) {\n        return this.$el.empty().attr(\"class\", _.isFunction(this.className) ? this.className() : this.className).append($newRender.children());\n    },\n\n    /** set up js behaviors, event handlers for elements within the given container\n     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n     */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        $where = $where || this.$el;\n        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n        //make_popup_menus( $where );\n        $where.find(\"[title]\").tooltip({ placement: \"bottom\" });\n    },\n\n    // ......................................................................... details\n    /** shortcut to details DOM (as jQ) */\n    $details: function $details($where) {\n        $where = $where || this.$el;\n        return $where.find(\"> .details\");\n    },\n\n    /** build the DOM for the details and set up behaviors on it */\n    _renderDetails: function _renderDetails() {\n        var $newDetails = $(this.templates.details(this.model.toJSON(), this));\n        this._setUpBehaviors($newDetails);\n        return $newDetails;\n    },\n\n    // ......................................................................... expansion/details\n    /** Show or hide the details\n     *  @param {Boolean} expand if true, expand; if false, collapse\n     */\n    toggleExpanded: function toggleExpanded(expand) {\n        expand = expand === undefined ? !this.expanded : expand;\n        if (expand) {\n            this.expand();\n        } else {\n            this.collapse();\n        }\n        return this;\n    },\n\n    /** Render and show the full, detailed body of this view including extra data and controls.\n     *      note: if the model does not have detailed data, fetch that data before showing the body\n     *  @fires expanded when a body has been expanded\n     */\n    expand: function expand() {\n        var view = this;\n        return view._fetchModelDetails().always(function () {\n            view._expand();\n        });\n    },\n\n    /** Check for model details and, if none, fetch them.\n     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n     */\n    _fetchModelDetails: function _fetchModelDetails() {\n        if (!this.model.hasDetails()) {\n            return this.model.fetch();\n        }\n        return jQuery.when();\n    },\n\n    /** Inner fn called when expand (public) has fetched the details */\n    _expand: function _expand() {\n        var view = this;\n        var $newDetails = view._renderDetails();\n        view.$details().replaceWith($newDetails);\n        // needs to be set after the above or the slide will not show\n        view.expanded = true;\n        view.$details().slideDown(view.fxSpeed, function () {\n            view.trigger(\"expanded\", view);\n        });\n    },\n\n    /** Hide the body/details of an HDA.\n     *  @fires collapsed when a body has been collapsed\n     */\n    collapse: function collapse() {\n        this.debug(this + \"(ExpandableView).collapse\");\n        var view = this;\n        view.expanded = false;\n        this.$details().slideUp(view.fxSpeed, function () {\n            view.trigger(\"collapsed\", view);\n        });\n    }\n});\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *      Inherits from Expandable, Selectable, Draggable.\n *  The DOM contains warnings, a title bar, and a series of primary action controls.\n *      Primary actions are meant to be easily accessible item functions (such as delete)\n *      that are rendered in the title bar.\n *\n *  Details are rendered when the user clicks the title bar or presses enter/space when\n *      the title bar is in focus.\n *\n *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n */\nvar ListItemView = ExpandableView.extend(_baseMvc2.default.mixin(_baseMvc2.default.SelectableViewMixin, _baseMvc2.default.DraggableViewMixin, {\n    tagName: \"div\",\n    className: \"list-item\",\n\n    /** Set up the base class and all mixins */\n    initialize: function initialize(attributes) {\n        ExpandableView.prototype.initialize.call(this, attributes);\n        _baseMvc2.default.SelectableViewMixin.initialize.call(this, attributes);\n        _baseMvc2.default.DraggableViewMixin.initialize.call(this, attributes);\n        this._setUpListeners();\n    },\n\n    /** event listeners */\n    _setUpListeners: function _setUpListeners() {\n        // hide the primary actions in the title bar when selectable and narrow\n        this.on(\"selectable\", function (isSelectable) {\n            if (isSelectable) {\n                this.$(\".primary-actions\").hide();\n            } else {\n                this.$(\".primary-actions\").show();\n            }\n        }, this);\n        return this;\n    },\n\n    // ........................................................................ rendering\n    /** In this override, call methods to build warnings, titlebar and primary actions */\n    _buildNewRender: function _buildNewRender() {\n        var $newRender = ExpandableView.prototype._buildNewRender.call(this);\n        $newRender.children(\".warnings\").replaceWith(this._renderWarnings());\n        $newRender.children(\".title-bar\").replaceWith(this._renderTitleBar());\n        $newRender.children(\".primary-actions\").append(this._renderPrimaryActions());\n        $newRender.find(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n        return $newRender;\n    },\n\n    /** In this override, render the selector controls and set up dragging before the swap */\n    _swapNewRender: function _swapNewRender($newRender) {\n        ExpandableView.prototype._swapNewRender.call(this, $newRender);\n        if (this.selectable) {\n            this.showSelector(0);\n        }\n        if (this.draggable) {\n            this.draggableOn();\n        }\n        return this.$el;\n    },\n\n    /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n    _renderWarnings: function _renderWarnings() {\n        var view = this;\n        var $warnings = $('<div class=\"warnings\"></div>');\n        var json = view.model.toJSON();\n        //TODO:! unordered (map)\n        _.each(view.templates.warnings, function (templateFn) {\n            $warnings.append($(templateFn(json, view)));\n        });\n        return $warnings;\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderTitleBar: function _renderTitleBar() {\n        return $(this.templates.titleBar(this.model.toJSON(), this));\n    },\n\n    /** Return an array of jQ objects containing common/easily-accessible item controls */\n    _renderPrimaryActions: function _renderPrimaryActions() {\n        // override this\n        return [];\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderSubtitle: function _renderSubtitle() {\n        return $(this.templates.subtitle(this.model.toJSON(), this));\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events: {\n        // expand the body when the title is clicked or when in focus and space or enter is pressed\n        \"click .title-bar\": \"_clickTitleBar\",\n        \"keydown .title-bar\": \"_keyDownTitleBar\",\n        \"click .selector\": \"toggleSelect\"\n    },\n\n    /** expand when the title bar is clicked */\n    _clickTitleBar: function _clickTitleBar(event) {\n        event.stopPropagation();\n        if (event.altKey) {\n            this.toggleSelect(event);\n            if (!this.selectable) {\n                this.showSelector();\n            }\n        } else {\n            this.toggleExpanded();\n        }\n    },\n\n    /** expand when the title bar is in focus and enter or space is pressed */\n    _keyDownTitleBar: function _keyDownTitleBar(event) {\n        // bail (with propagation) if keydown and not space or enter\n        var KEYCODE_SPACE = 32;\n\n        var KEYCODE_RETURN = 13;\n        if (event && event.type === \"keydown\" && (event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN)) {\n            this.toggleExpanded();\n            event.stopPropagation();\n            return false;\n        }\n        return true;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"ListItemView(\" + modelString + \")\";\n    }\n}));\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListItemView.prototype.templates = function () {\n    var elTemplato = _baseMvc2.default.wrapTemplate(['<div class=\"list-element\">',\n    // errors, messages, etc.\n    '<div class=\"warnings\"></div>',\n\n    // multi-select checkbox\n    '<div class=\"selector\">', '<span class=\"fa fa-2x fa-square-o\"></span>', \"</div>\",\n    // space for title bar buttons - gen. floated to the right\n    '<div class=\"primary-actions\"></div>', '<div class=\"title-bar\"></div>',\n\n    // expandable area for more details\n    '<div class=\"details\"></div>', \"</div>\"]);\n\n    var warnings = {};\n\n    var titleBarTemplate = _baseMvc2.default.wrapTemplate([\n    // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n    '<div class=\"title-bar clear\" tabindex=\"0\">',\n    //TODO: prob. belongs in dataset-list-item\n    '<span class=\"state-icon\"></span>', '<div class=\"title\">', '<span class=\"name\"><%- element.name %></span>', \"</div>\", '<div class=\"subtitle\"></div>', \"</div>\"], \"element\");\n\n    var subtitleTemplate = _baseMvc2.default.wrapTemplate([\n    // override this\n    '<div class=\"subtitle\"></div>']);\n\n    var detailsTemplate = _baseMvc2.default.wrapTemplate([\n    // override this\n    '<div class=\"details\"></div>']);\n\n    return {\n        el: elTemplato,\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate,\n        details: detailsTemplate\n    };\n}();\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n *      If 'foldout': will expand vertically to show the nested list\n *      If 'drilldown': will overlay the parent list\n *\n *  Inherits from ListItemView.\n *\n *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n */\nvar FoldoutListItemView = ListItemView.extend({\n    /** If 'foldout': show the sub-panel inside the expanded item\n     *  If 'drilldown': only fire events and handle by pub-sub\n     *      (allow the panel containing this item to attach it, hide itself, etc.)\n     */\n    foldoutStyle: \"foldout\",\n    /** Panel view class to instantiate for the sub-panel */\n    foldoutPanelClass: null,\n\n    /** override to:\n     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n     *      disrespect attributes.expanded if drilldown\n     */\n    initialize: function initialize(attributes) {\n        if (this.foldoutStyle === \"drilldown\") {\n            this.expanded = false;\n        }\n        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\n        ListItemView.prototype.initialize.call(this, attributes);\n        this.foldout = this._createFoldoutPanel();\n    },\n\n    /** in this override, attach the foldout panel when rendering details */\n    _renderDetails: function _renderDetails() {\n        if (this.foldoutStyle === \"drilldown\") {\n            return $();\n        }\n        var $newDetails = ListItemView.prototype._renderDetails.call(this);\n        return this._attachFoldout(this.foldout, $newDetails);\n    },\n\n    /** In this override, handle collection expansion. */\n    _createFoldoutPanel: function _createFoldoutPanel() {\n        var model = this.model;\n        var FoldoutClass = this._getFoldoutPanelClass(model);\n        var options = this._getFoldoutPanelOptions(model);\n\n        var foldout = new FoldoutClass(_.extend(options, {\n            model: model\n        }));\n\n        return foldout;\n    },\n\n    /** Stub to return proper foldout panel class */\n    _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n        // override\n        return this.foldoutPanelClass;\n    },\n\n    /** Stub to return proper foldout panel options */\n    _getFoldoutPanelOptions: function _getFoldoutPanelOptions() {\n        return {\n            // propagate foldout style down\n            foldoutStyle: this.foldoutStyle,\n            fxSpeed: this.fxSpeed\n        };\n    },\n\n    /** Render the foldout panel inside the view, hiding controls */\n    _attachFoldout: function _attachFoldout(foldout, $whereTo) {\n        $whereTo = $whereTo || this.$(\"> .details\");\n        this.foldout = foldout.render(0);\n        foldout.$(\"> .controls\").hide();\n        return $whereTo.append(foldout.$el);\n    },\n\n    /** In this override, branch on foldoutStyle to show expanded */\n    expand: function expand() {\n        var view = this;\n        return view._fetchModelDetails().always(function () {\n            if (view.foldoutStyle === \"foldout\") {\n                view._expand();\n            } else if (view.foldoutStyle === \"drilldown\") {\n                view._expandByDrilldown();\n            }\n        });\n    },\n\n    /** For drilldown, set up close handler and fire expanded:drilldown\n     *      containing views can listen to this and handle other things\n     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n     */\n    _expandByDrilldown: function _expandByDrilldown() {\n        var view = this;\n        // attachment and rendering done by listener\n        view.listenTo(view.foldout, \"close\", function () {\n            view.trigger(\"collapsed:drilldown\", view, view.foldout);\n        });\n        view.trigger(\"expanded:drilldown\", view, view.foldout);\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nFoldoutListItemView.prototype.templates = function () {\n    var detailsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"details\">',\n    // override with more info (that goes above the panel)\n    \"</div>\"], \"collection\");\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        details: detailsTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    ExpandableView: ExpandableView,\n    ListItemView: ListItemView,\n    FoldoutListItemView: FoldoutListItemView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 86 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, jQuery, Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listItem = __webpack_require__(85);\n\nvar _listItem2 = _interopRequireDefault(_listItem);\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"dataset\";\n/*==============================================================================\nTODO:\n    straighten out state rendering and templates used\n    inaccessible/STATES.NOT_VIEWABLE is a special case\n    simplify button rendering\n\n==============================================================================*/\nvar _super = _listItem2.default.ListItemView;\n/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n *      Roughly, any DatasetInstance (and not a raw Dataset).\n */\nvar DatasetListItemView = _super.extend(\n/** @lends DatasetListItemView.prototype */{\n    _logNamespace: logNamespace,\n\n    className: _super.prototype.className + \" dataset\",\n    //TODO:?? doesn't exactly match an hda's type_id\n    id: function id() {\n        return [\"dataset\", this.model.get(\"id\")].join(\"-\");\n    },\n\n    /** Set up: instance vars, options, and event handlers */\n    initialize: function initialize(attributes) {\n        if (attributes.logger) {\n            this.logger = this.model.logger = attributes.logger;\n        }\n        this.log(this + \".initialize:\", attributes);\n        _super.prototype.initialize.call(this, attributes);\n\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || \"_blank\";\n    },\n\n    /** event listeners */\n    _setUpListeners: function _setUpListeners() {\n        _super.prototype._setUpListeners.call(this);\n        var self = this;\n\n        // re-rendering on any model changes\n        return self.listenTo(self.model, {\n            change: function change(model) {\n                // if the model moved into the ready state and is expanded without details, fetch those details now\n                if (self.model.changedAttributes().state && self.model.inReadyState() && self.expanded && !self.model.hasDetails()) {\n                    // normally, will render automatically (due to fetch -> change),\n                    // but! setting_metadata sometimes doesn't cause any other changes besides state\n                    // so, not rendering causes it to seem frozen in setting_metadata state\n                    self.model.fetch({ silent: true }).done(function () {\n                        self.render();\n                    });\n                } else {\n                    if (_.has(model.changed, \"tags\") && _.keys(model.changed).length === 1) {\n                        // If only the tags have changed, rerender specifically\n                        // the titlebar region.  Otherwise default to the full\n                        // render.\n                        self.$(\".nametags\").html(self._renderNametags());\n                    } else {\n                        self.render();\n                    }\n                }\n            }\n        });\n    },\n\n    // ......................................................................... expandable\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails: function _fetchModelDetails() {\n        var view = this;\n        if (view.model.inReadyState() && !view.model.hasDetails()) {\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... removal\n    /** Remove this view's html from the DOM and remove all event listeners.\n     *  @param {Number or String} speed jq effect speed\n     *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n     */\n    remove: function remove(speed, callback) {\n        var view = this;\n        speed = speed || this.fxSpeed;\n        this.$el.fadeOut(speed, function () {\n            Backbone.View.prototype.remove.call(view);\n            if (callback) {\n                callback.call(view);\n            }\n        });\n    },\n\n    // ......................................................................... rendering\n    /* TODO:\n    dataset states are the issue primarily making dataset rendering complex\n        each state should have it's own way of displaying/set of details\n        often with different actions that can be applied\n    throw in deleted/purged/visible and things get complicated easily\n    I've considered (a couple of times) - creating a view for each state\n        - but recreating the view during an update...seems wrong\n    */\n    /** In this override, add the dataset state as a class for use with state-based CSS */\n    _swapNewRender: function _swapNewRender($newRender) {\n        _super.prototype._swapNewRender.call(this, $newRender);\n        if (this.model.has(\"state\")) {\n            this.$el.addClass(\"state-\" + this.model.get(\"state\"));\n        }\n        return this.$el;\n    },\n\n    // ................................................................................ titlebar\n    /** In this override, add the dataset display button. */\n    _renderPrimaryActions: function _renderPrimaryActions() {\n        // render just the display for read-only\n        return [this._renderDisplayButton()];\n    },\n\n    /** Render icon-button to display dataset data */\n    _renderDisplayButton: function _renderDisplayButton() {\n        // don't show display if not viewable or not accessible\n        var state = this.model.get(\"state\");\n        if (state === _states2.default.NOT_VIEWABLE || state === _states2.default.DISCARDED || !this.model.get(\"accessible\")) {\n            return null;\n        }\n\n        var displayBtnData = {\n            target: this.linkTarget,\n            classes: \"display-btn\"\n        };\n\n        // show a disabled display if the data's been purged\n        if (this.model.get(\"purged\")) {\n            displayBtnData.disabled = true;\n            displayBtnData.title = (0, _localization2.default)(\"Cannot display datasets removed from disk\");\n\n            // disable if still uploading\n        } else if (state === _states2.default.UPLOAD) {\n            displayBtnData.disabled = true;\n            displayBtnData.title = (0, _localization2.default)(\"This dataset must finish uploading before it can be viewed\");\n\n            // disable if still new\n        } else if (state === _states2.default.NEW) {\n            displayBtnData.disabled = true;\n            displayBtnData.title = (0, _localization2.default)(\"This dataset is not yet viewable\");\n        } else {\n            displayBtnData.title = (0, _localization2.default)(\"View data\");\n\n            // default link for dataset\n            displayBtnData.href = this.model.urls.display;\n\n            // add frame manager option onclick event\n            var self = this;\n            displayBtnData.onclick = function (ev) {\n                if (Galaxy.frame && Galaxy.frame.active) {\n                    // Add dataset to frames.\n                    Galaxy.frame.addDataset(self.model.get(\"id\"));\n                    ev.preventDefault();\n                }\n            };\n        }\n        displayBtnData.faIcon = \"fa-eye\";\n        return (0, _faIconButton2.default)(displayBtnData);\n    },\n\n    // ......................................................................... rendering details\n    /** Render the enclosing div of the hda body and, if expanded, the html in the body\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDetails: function _renderDetails() {\n        //TODO: generalize to be allow different details for each state\n\n        // no access - render nothing but a message\n        if (this.model.get(\"state\") === _states2.default.NOT_VIEWABLE) {\n            return $(this.templates.noAccess(this.model.toJSON(), this));\n        }\n\n        var $details = _super.prototype._renderDetails.call(this);\n        $details.find(\".actions .left\").empty().append(this._renderSecondaryActions());\n        $details.find(\".summary\").html(this._renderSummary()).prepend(this._renderDetailMessages());\n        $details.find(\".display-applications\").html(this._renderDisplayApplications());\n\n        this._setUpBehaviors($details);\n        return $details;\n    },\n\n    /** Defer to the appropo summary rendering fn based on state */\n    _renderSummary: function _renderSummary() {\n        var json = this.model.toJSON();\n        var summaryRenderFn = this.templates.summaries[json.state];\n        summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n        return summaryRenderFn(json, this);\n    },\n\n    /** Render messages to be displayed only when the details are shown */\n    _renderDetailMessages: function _renderDetailMessages() {\n        var view = this;\n        var $warnings = $('<div class=\"detail-messages\"></div>');\n        var json = view.model.toJSON();\n        //TODO:! unordered (map)\n        _.each(view.templates.detailMessages, function (templateFn) {\n            $warnings.append($(templateFn(json, view)));\n        });\n        return $warnings;\n    },\n\n    /** Render the external display application links */\n    _renderDisplayApplications: function _renderDisplayApplications() {\n        if (this.model.isDeletedOrPurged()) {\n            return \"\";\n        }\n        // render both old and new display apps using the same template\n        return [this.templates.displayApplications(this.model.get(\"display_apps\"), this), this.templates.displayApplications(this.model.get(\"display_types\"), this)].join(\"\");\n    },\n\n    // ......................................................................... secondary/details actions\n    /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n    _renderSecondaryActions: function _renderSecondaryActions() {\n        this.debug(\"_renderSecondaryActions\");\n        switch (this.model.get(\"state\")) {\n            case _states2.default.NOT_VIEWABLE:\n                return [];\n            case _states2.default.OK:\n            case _states2.default.FAILED_METADATA:\n            case _states2.default.ERROR:\n                return [this._renderDownloadButton(), this._renderShowParamsButton()];\n        }\n        return [this._renderShowParamsButton()];\n    },\n\n    /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderShowParamsButton: function _renderShowParamsButton() {\n        // gen. safe to show in all cases\n        return (0, _faIconButton2.default)({\n            title: (0, _localization2.default)(\"View details\"),\n            classes: \"params-btn\",\n            href: this.model.urls.show_params,\n            target: this.linkTarget,\n            faIcon: \"fa-info-circle\",\n            onclick: function onclick(ev) {\n                if (Galaxy.frame && Galaxy.frame.active) {\n                    Galaxy.frame.add({\n                        title: \"Dataset details\",\n                        url: this.href\n                    });\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                }\n            }\n        });\n    },\n\n    /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDownloadButton: function _renderDownloadButton() {\n        // don't show anything if the data's been purged\n        if (this.model.get(\"purged\") || !this.model.hasData()) {\n            return null;\n        }\n\n        // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n        //  or a single download icon-button (if there are no meta files)\n        if (!_.isEmpty(this.model.get(\"meta_files\"))) {\n            return this._renderMetaFileDownloadButton();\n        }\n\n        return $(['<a class=\"download-btn icon-btn\" ', 'href=\"', this.model.urls.download, \"\\\" title=\\\"\" + (0, _localization2.default)(\"Download\") + \"\\\" download>\", '<span class=\"fa fa-floppy-o\"></span>', \"</a>\"].join(\"\"));\n    },\n\n    /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n    _renderMetaFileDownloadButton: function _renderMetaFileDownloadButton() {\n        var urls = this.model.urls;\n        return $(['<div class=\"metafile-dropdown dropdown\">', '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"', \" title=\\\"\" + (0, _localization2.default)(\"Download\") + \"\\\">\", '<span class=\"fa fa-floppy-o\"></span>', \"</a>\", '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">', \"<li><a href=\\\"\" + urls.download + \"\\\" download>\", (0, _localization2.default)(\"Download dataset\"), \"</a></li>\", _.map(this.model.get(\"meta_files\"), function (meta_file) {\n            return ['<li><a href=\"', urls.meta_download + meta_file.file_type, '\">', (0, _localization2.default)(\"Download\"), \" \", meta_file.file_type, \"</a></li>\"].join(\"\");\n        }).join(\"\\n\"), \"</ul>\", \"</div>\"].join(\"\\n\"));\n    },\n\n    _renderNametags: function _renderNametags() {\n        var tpl = _.template([\"<% _.each(_.sortBy(_.uniq(tags), function(x) { return x }), function(tag){ %>\", '<% if (tag.indexOf(\"name:\") == 0){ %>', '<span class=\"label label-info\"><%- tag.slice(5) %></span>', \"<% } %>\", \"<% }); %>\"].join(\"\"));\n        return tpl({ tags: this.model.get(\"tags\") });\n    },\n\n    // ......................................................................... misc\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .display-btn\": function clickDisplayBtn(ev) {\n            this.trigger(\"display\", this, ev);\n        },\n        \"click .params-btn\": function clickParamsBtn(ev) {\n            this.trigger(\"params\", this, ev);\n        },\n        \"click .download-btn\": function clickDownloadBtn(ev) {\n            this.trigger(\"download\", this, ev);\n        }\n    }),\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DatasetListItemView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemView.prototype.templates = function () {\n    //TODO: move to require text! plugin\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: _baseMvc2.default.wrapTemplate([\n        // failed metadata is rendered as a warning on an otherwise ok dataset view\n        '<% if( model.state === \"failed_metadata\" ){ %>', '<div class=\"warningmessagesmall\">', (0, _localization2.default)(\"An error occurred setting the metadata for this dataset\"), \"</div>\", \"<% } %>\"]),\n        error: _baseMvc2.default.wrapTemplate([\n        // error during index fetch - show error on dataset\n        \"<% if( model.error ){ %>\", '<div class=\"errormessagesmall\">', (0, _localization2.default)(\"There was an error getting the data for this dataset\"), \": <%- model.error %>\", \"</div>\", \"<% } %>\"]),\n        purged: _baseMvc2.default.wrapTemplate([\"<% if( model.purged ){ %>\", '<div class=\"purged-msg warningmessagesmall\">', (0, _localization2.default)(\"This dataset has been deleted and removed from disk\"), \"</div>\", \"<% } %>\"]),\n        deleted: _baseMvc2.default.wrapTemplate([\n        // deleted not purged\n        \"<% if( model.deleted && !model.purged ){ %>\", '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This dataset has been deleted\"), \"</div>\", \"<% } %>\"])\n\n        //NOTE: hidden warning is only needed for HDAs\n    });\n\n    var detailsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"details\">', '<div class=\"summary\"></div>', '<div class=\"actions clear\">', '<div class=\"left\"></div>', '<div class=\"right\"></div>', \"</div>\",\n\n    // do not display tags, annotation, display apps, or peek when deleted\n    \"<% if( !dataset.deleted && !dataset.purged ){ %>\", '<div class=\"tags-display\"></div>', '<div class=\"annotation-display\"></div>', '<div class=\"display-applications\"></div>', \"<% if( dataset.peek ){ %>\", '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>', \"<% } %>\", \"<% } %>\", \"</div>\"], \"dataset\");\n\n    var noAccessTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"details\">', '<div class=\"summary\">', (0, _localization2.default)(\"You do not have permission to view this dataset\"), \"</div>\", \"</div>\"], \"dataset\");\n\n    //TODO: still toooooooooooooo complex - rework\n    var summaryTemplates = {};\n    summaryTemplates[_states2.default.OK] = summaryTemplates[_states2.default.FAILED_METADATA] = _baseMvc2.default.wrapTemplate([\"<% if( dataset.misc_blurb ){ %>\", '<div class=\"blurb\">', '<span class=\"value\"><%- dataset.misc_blurb %></span>', \"</div>\", \"<% } %>\", \"<% if( dataset.file_ext ){ %>\", '<div class=\"datatype\">', '<label class=\"prompt\">', (0, _localization2.default)(\"format\"), \"</label>\", '<span class=\"value\"><%- dataset.file_ext %></span>', \"</div>\", \"<% } %>\", \"<% if( dataset.metadata_dbkey ){ %>\", '<div class=\"dbkey\">', '<label class=\"prompt\">', (0, _localization2.default)(\"database\"), \"</label>\", '<span class=\"value\">', \"<%- dataset.metadata_dbkey %>\", \"</span>\", \"</div>\", \"<% } %>\", \"<% if( dataset.misc_info ){ %>\", '<div class=\"info\">', '<span class=\"value\"><%- dataset.misc_info %></span>', \"</div>\", \"<% } %>\"], \"dataset\");\n    summaryTemplates[_states2.default.NEW] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"This is a new dataset and not all of its data are available yet\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.NOT_VIEWABLE] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"You do not have permission to view this dataset\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.DISCARDED] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"The job creating this dataset was cancelled before completion\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.QUEUED] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"This job is waiting to run\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.RUNNING] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"This job is currently running\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.UPLOAD] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"This dataset is currently uploading\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.SETTING_METADATA] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"Metadata is being auto-detected\"), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.PAUSED] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)('This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume'), \"</div>\"], \"dataset\");\n    summaryTemplates[_states2.default.ERROR] = _baseMvc2.default.wrapTemplate([\"<% if( !dataset.purged ){ %>\", \"<div><%- dataset.misc_blurb %></div>\", \"<% } %>\", '<span class=\"help-text\">', (0, _localization2.default)(\"An error occurred with this dataset\"), \":</span>\", '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'], \"dataset\");\n    summaryTemplates[_states2.default.EMPTY] = _baseMvc2.default.wrapTemplate([\"<div>\", (0, _localization2.default)(\"No data\"), \": <i><%- dataset.misc_blurb %></i></div>\"], \"dataset\");\n    summaryTemplates.unknown = _baseMvc2.default.wrapTemplate(['<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'], \"dataset\");\n\n    // messages to be displayed only within the details section ('below the fold')\n    var detailMessageTemplates = {\n        resubmitted: _baseMvc2.default.wrapTemplate([\n        // deleted not purged\n        \"<% if( model.resubmitted ){ %>\", '<div class=\"resubmitted-msg infomessagesmall\">', (0, _localization2.default)(\"The job creating this dataset has been resubmitted\"), \"</div>\", \"<% } %>\"])\n    };\n\n    // this is applied to both old and new style display apps\n    var displayApplicationsTemplate = _baseMvc2.default.wrapTemplate([\"<% _.each( apps, function( app ){ %>\", '<div class=\"display-application\">', '<span class=\"display-application-location\"><%- app.label %></span> ', '<span class=\"display-application-links\">', \"<% _.each( app.links, function( link ){ %>\", '<a target=\"<%- link.target %>\" href=\"<%- link.href %>\">', \"<% print( _l( link.text ) ); %>\", \"</a> \", \"<% }); %>\", \"</span>\", \"</div>\", \"<% }); %>\"], \"apps\");\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        details: detailsTemplate,\n        noAccess: noAccessTemplate,\n        summaries: summaryTemplates,\n        detailMessages: detailMessageTemplates,\n        displayApplications: displayApplicationsTemplate\n    });\n}();\n\n// ============================================================================\nexports.default = {\n    DatasetListItemView: DatasetListItemView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0), __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 87 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listItem = __webpack_require__(85);\n\nvar _listItem2 = _interopRequireDefault(_listItem);\n\nvar _datasetLi = __webpack_require__(86);\n\nvar _datasetLi2 = _interopRequireDefault(_datasetLi);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar FoldoutListItemView = _listItem2.default.FoldoutListItemView;\n\nvar ListItemView = _listItem2.default.ListItemView;\n/** @class Read only view for DatasetCollection.\n */\nvar DCListItemView = FoldoutListItemView.extend(\n/** @lends DCListItemView.prototype */{\n    className: FoldoutListItemView.prototype.className + \" dataset-collection\",\n    id: function id() {\n        return [\"dataset_collection\", this.model.get(\"id\")].join(\"-\");\n    },\n\n    /** override to add linkTarget */\n    initialize: function initialize(attributes) {\n        this.linkTarget = attributes.linkTarget || \"_blank\";\n        this.hasUser = attributes.hasUser;\n        FoldoutListItemView.prototype.initialize.call(this, attributes);\n    },\n\n    /** event listeners */\n    _setUpListeners: function _setUpListeners() {\n        FoldoutListItemView.prototype._setUpListeners.call(this);\n        this.listenTo(this.model, \"change\", function (model, options) {\n            // if the model has changed deletion status render it entirely\n            if (_.has(model.changed, \"deleted\")) {\n                this.render();\n\n                // if the model has been decorated after the fact with the element count,\n                // render the subtitle where the count is displayed\n            } else if (_.has(model.changed, \"element_count\")) {\n                this.$(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n            }\n        });\n    },\n\n    // ......................................................................... rendering\n    /** render a subtitle to show the user what sort of collection this is */\n    _renderSubtitle: function _renderSubtitle() {\n        return $(this.templates.subtitle(this.model.toJSON(), this));\n    },\n\n    // ......................................................................... foldout\n    /** override to add linktarget to sub-panel */\n    _getFoldoutPanelOptions: function _getFoldoutPanelOptions() {\n        var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call(this);\n        return _.extend(options, {\n            linkTarget: this.linkTarget,\n            hasUser: this.hasUser\n        });\n    },\n\n    /** override to not catch sub-panel selectors */\n    $selector: function $selector() {\n        return this.$(\"> .selector\");\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DCListItemView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCListItemView.prototype.templates = function () {\n    var warnings = _.extend({}, FoldoutListItemView.prototype.templates.warnings, {\n        error: _baseMvc2.default.wrapTemplate([\n        // error during index fetch - show error on dataset\n        \"<% if( model.error ){ %>\", '<div class=\"errormessagesmall\">', (0, _localization2.default)(\"There was an error getting the data for this collection\"), \": <%- model.error %>\", \"</div>\", \"<% } %>\"]),\n        purged: _baseMvc2.default.wrapTemplate([\"<% if( model.purged ){ %>\", '<div class=\"purged-msg warningmessagesmall\">', (0, _localization2.default)(\"This collection has been deleted and removed from disk\"), \"</div>\", \"<% } %>\"]),\n        deleted: _baseMvc2.default.wrapTemplate([\n        // deleted not purged\n        \"<% if( model.deleted && !model.purged ){ %>\", '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This collection has been deleted\"), \"</div>\", \"<% } %>\"])\n    });\n\n    // use element identifier\n    var titleBarTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<div class=\"title\">', '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>', \"</div>\", '<div class=\"subtitle\"></div>', \"</div>\"], \"collection\");\n\n    // use element identifier\n    var subtitleTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"subtitle\">', '<% var countText = collection.element_count? ( collection.element_count + \" \" ) : \"\"; %>', '<%        if( collection.collection_type === \"list\" ){ %>', (0, _localization2.default)(\"a list of <%- countText %>datasets\"), '<% } else if( collection.collection_type === \"paired\" ){ %>', (0, _localization2.default)(\"a pair of datasets\"), '<% } else if( collection.collection_type === \"list:paired\" ){ %>', (0, _localization2.default)(\"a list of <%- countText %>dataset pairs\"), '<% } else if( collection.collection_type === \"list:list\" ){ %>', (0, _localization2.default)(\"a list of <%- countText %>dataset lists\"), \"<% } %>\", \"</div>\"], \"collection\");\n\n    return _.extend({}, FoldoutListItemView.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate\n    });\n}();\n\n//==============================================================================\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemView = ListItemView.extend(\n/** @lends DCEListItemView.prototype */{\n    /** add the DCE class to the list item */\n    className: ListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** set up */\n    initialize: function initialize(attributes) {\n        if (attributes.logger) {\n            this.logger = this.model.logger = attributes.logger;\n        }\n        this.log(\"DCEListItemView.initialize:\", attributes);\n        ListItemView.prototype.initialize.call(this, attributes);\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DCEListItemView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCEListItemView.prototype.templates = function () {\n    // use the element identifier here - since that will persist and the user will need it\n    var titleBarTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<div class=\"title\">', '<span class=\"name\"><%- element.element_identifier %></span>', \"</div>\", '<div class=\"subtitle\"></div>', \"</div>\"], \"element\");\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n}();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemView = _datasetLi2.default.DatasetListItemView.extend(\n/** @lends DatasetDCEListItemView.prototype */{\n    className: _datasetLi2.default.DatasetListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** set up */\n    initialize: function initialize(attributes) {\n        if (attributes.logger) {\n            this.logger = this.model.logger = attributes.logger;\n        }\n        this.log(\"DatasetDCEListItemView.initialize:\", attributes);\n        _datasetLi2.default.DatasetListItemView.prototype.initialize.call(this, attributes);\n    },\n\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails: function _fetchModelDetails() {\n        var view = this;\n        if (view.model.inReadyState() && !view.model.hasDetails()) {\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DatasetDCEListItemView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemView.prototype.templates = function () {\n    // use the element identifier here and not the dataset name\n    //TODO:?? can we steal the DCE titlebar?\n    var titleBarTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"title-bar clear\" tabindex=\"0\">', '<span class=\"state-icon\"></span>', '<div class=\"title\">', '<span class=\"name\"><%- element.element_identifier %></span>', \"</div>\", \"</div>\"], \"element\");\n\n    return _.extend({}, _datasetLi2.default.DatasetListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n}();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemView = DCListItemView.extend(\n/** @lends NestedDCDCEListItemView.prototype */{\n    className: DCListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender: function _swapNewRender($newRender) {\n        DCListItemView.prototype._swapNewRender.call(this, $newRender);\n        var state = this.model.get(\"state\") || \"ok\";\n        this.$el.addClass(\"state-\" + state);\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"NestedDCDCEListItemView(\" + modelString + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    DCListItemView: DCListItemView,\n    DCEListItemView: DCEListItemView,\n    DatasetDCEListItemView: DatasetDCEListItemView,\n    NestedDCDCEListItemView: NestedDCDCEListItemView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0), __webpack_require__(0)))\n\n/***/ }),\n/* 88 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Generic form view */\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function render() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        }).done(function (response) {\n            var options = $.extend({}, self.model.attributes, response);\n            var form = new _formView2.default({\n                title: options.title,\n                message: options.message,\n                status: options.status || \"warning\",\n                icon: options.icon,\n                inputs: options.inputs,\n                buttons: {\n                    submit: new _uiMisc2.default.Button({\n                        tooltip: options.submit_tooltip,\n                        title: options.submit_title || \"Save\",\n                        icon: options.submit_icon || \"fa-save\",\n                        cls: \"btn btn-primary ui-clear-float\",\n                        onclick: function onclick() {\n                            self._submit(form);\n                        }\n                    })\n                }\n            });\n            self.$el.empty().append(form.$el);\n        }).fail(function (response) {\n            self.$el.empty().append(new _uiMisc2.default.Message({\n                message: \"Failed to load resource \" + self.url + \".\",\n                status: \"danger\",\n                persistent: true\n            }).$el);\n        });\n    },\n\n    _submit: function _submit(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        }).done(function (response) {\n            var success_message = {\n                message: response.message,\n                status: \"success\",\n                persistent: false\n            };\n            if (self.redirect) {\n                window.location = Galaxy.root + self.redirect + \"?\" + $.param(success_message);\n            } else {\n                form.data.matchModel(response, function (input, input_id) {\n                    form.field_list[input_id].value(input.value);\n                });\n                self._showMessage(form, success_message);\n            }\n        }).fail(function (response) {\n            self._showMessage(form, {\n                message: response.responseJSON.err_msg,\n                status: \"danger\",\n                persistent: false\n            });\n        });\n    },\n\n    _showMessage: function _showMessage(form, options) {\n        var $panel = form.$el.parents().filter(function () {\n            return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n        }).first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 89 */,\n/* 90 */,\n/* 91 */,\n/* 92 */,\n/* 93 */,\n/* 94 */,\n/* 95 */,\n/* 96 */,\n/* 97 */,\n/* 98 */,\n/* 99 */,\n/* 100 */,\n/* 101 */,\n/* 102 */,\n/* 103 */,\n/* 104 */,\n/* 105 */,\n/* 106 */,\n/* 107 */,\n/* 108 */,\n/* 109 */,\n/* 110 */,\n/* 111 */,\n/* 112 */,\n/* 113 */,\n/* 114 */,\n/* 115 */,\n/* 116 */,\n/* 117 */,\n/* 118 */,\n/* 119 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"dataset\";\n//==============================================================================\nvar searchableMixin = _baseMvc2.default.SearchableModelMixin;\n/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n */\nvar DatasetAssociation = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.mixin(searchableMixin,\n/** @lends DatasetAssociation.prototype */{\n    _logNamespace: logNamespace,\n\n    /** default attributes for a model */\n    defaults: {\n        state: _states2.default.NEW,\n        deleted: false,\n        purged: false,\n        name: \"(unnamed dataset)\",\n        accessible: true,\n        // sniffed datatype (sam, tabular, bed, etc.)\n        data_type: \"\",\n        file_ext: \"\",\n        file_size: 0,\n\n        // array of associated file types (eg. [ 'bam_index', ... ])\n        meta_files: [],\n\n        misc_blurb: \"\",\n        misc_info: \"\",\n\n        tags: []\n        // do NOT default on annotation, as this default is valid and will be passed on 'save'\n        //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n        //annotation          : ''\n    },\n\n    /** instance vars and listeners */\n    initialize: function initialize(attributes, options) {\n        this.debug(this + \"(Dataset).initialize\", attributes, options);\n\n        //!! this state is not in trans.app.model.Dataset.states - set it here -\n        if (!this.get(\"accessible\")) {\n            this.set(\"state\", _states2.default.NOT_VIEWABLE);\n        }\n\n        /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n        this.urls = this._generateUrls();\n\n        this._setUpListeners();\n    },\n\n    /** returns misc. web urls for rendering things like re-run, display, etc. */\n    _generateUrls: function _generateUrls() {\n        var id = this.get(\"id\");\n        if (!id) {\n            return {};\n        }\n        var urls = {\n            purge: \"datasets/\" + id + \"/purge_async\",\n            display: \"datasets/\" + id + \"/display/?preview=True\",\n            edit: \"datasets/edit?dataset_id=\" + id,\n            download: \"datasets/\" + id + \"/display\" + this._downloadQueryParameters(),\n            report_error: \"dataset/errors?id=\" + id,\n            rerun: \"tool_runner/rerun?id=\" + id,\n            show_params: \"datasets/\" + id + \"/show_params\",\n            visualization: \"visualization\",\n            meta_download: \"dataset/get_metadata_file?hda_id=\" + id + \"&metadata_name=\"\n        };\n        _.each(urls, function (value, key) {\n            urls[key] = Galaxy.root + value;\n        });\n        this.urls = urls;\n        return urls;\n    },\n\n    _downloadQueryParameters: function _downloadQueryParameters() {\n        return \"?to_ext=\" + this.get(\"file_ext\");\n    },\n\n    /** set up any event listeners\n     *  event: state:ready  fired when this DA moves into/is already in a ready state\n     */\n    _setUpListeners: function _setUpListeners() {\n        // if the state has changed and the new state is a ready state, fire an event\n        this.on(\"change:state\", function (currModel, newState) {\n            this.log(this + \" has changed state:\", currModel, newState);\n            if (this.inReadyState()) {\n                this.trigger(\"state:ready\", currModel, newState, this.previous(\"state\"));\n            }\n        });\n        // the download url (currently) relies on having a correct file extension\n        this.on(\"change:id change:file_ext\", function (currModel) {\n            this._generateUrls();\n        });\n    },\n\n    // ........................................................................ common queries\n    /** override to add urls */\n    toJSON: function toJSON() {\n        var json = Backbone.Model.prototype.toJSON.call(this);\n        //console.warn( 'returning json?' );\n        //return json;\n        return _.extend(json, {\n            urls: this.urls\n        });\n    },\n\n    /** Is this dataset deleted or purged? */\n    isDeletedOrPurged: function isDeletedOrPurged() {\n        return this.get(\"deleted\") || this.get(\"purged\");\n    },\n\n    /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n     *      processing (for the ds) is left to do on the server.\n     */\n    inReadyState: function inReadyState() {\n        var ready = _.contains(_states2.default.READY_STATES, this.get(\"state\"));\n        return this.isDeletedOrPurged() || ready;\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails: function hasDetails() {\n        // if it's inaccessible assume it has everything it needs\n        if (!this.get(\"accessible\")) {\n            return true;\n        }\n        return this.has(\"annotation\");\n    },\n\n    /** Convenience function to match dataset.has_data. */\n    hasData: function hasData() {\n        return this.get(\"file_size\") > 0;\n    },\n\n    // ........................................................................ ajax\n    fetch: function fetch(options) {\n        var dataset = this;\n        return Backbone.Model.prototype.fetch.call(this, options).always(function () {\n            dataset._generateUrls();\n        });\n    },\n\n    /** override to use actual Dates objects for create/update times */\n    parse: function parse(response, options) {\n        var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n        if (parsed.create_time) {\n            parsed.create_time = new Date(parsed.create_time);\n        }\n        if (parsed.update_time) {\n            parsed.update_time = new Date(parsed.update_time);\n        }\n        return parsed;\n    },\n\n    /** override to wait by default */\n    save: function save(attrs, options) {\n        options = options || {};\n        options.wait = _.isUndefined(options.wait) ? true : options.wait;\n        return Backbone.Model.prototype.save.call(this, attrs, options);\n    },\n\n    //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    delete: function _delete(options) {\n        if (this.get(\"deleted\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: true }, options);\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete: function undelete(options) {\n        if (!this.get(\"deleted\") || this.get(\"purged\")) {\n            return jQuery.when();\n        }\n        return this.save({ deleted: false }, options);\n    },\n\n    /** remove the file behind this dataset from the filesystem (if permitted) */\n    purge: function _purge(options) {\n        //TODO: use, override model.destroy, HDA.delete({ purge: true })\n        if (this.get(\"purged\")) {\n            return jQuery.when();\n        }\n        options = options || {};\n        options.url = this.urls.purge;\n\n        //TODO: ideally this would be a DELETE call to the api\n        //  using purge async for now\n        var hda = this;\n\n        var xhr = jQuery.ajax(options);\n        xhr.done(function (message, status, responseObj) {\n            hda.set({ deleted: true, purged: true });\n        });\n        xhr.fail(function (xhr, status, message) {\n            // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n            // unbury and re-add to xhr\n            var error = (0, _localization2.default)(\"Unable to purge dataset\");\n            var messageBuriedInUnfortunatelyFormattedError = \"Removal of datasets by users \" + \"is not allowed in this Galaxy instance\";\n            if (xhr.responseJSON && xhr.responseJSON.error) {\n                error = xhr.responseJSON.error;\n            } else if (xhr.responseText.indexOf(messageBuriedInUnfortunatelyFormattedError) !== -1) {\n                error = messageBuriedInUnfortunatelyFormattedError;\n            }\n            xhr.responseText = error;\n            hda.trigger(\"error\", hda, xhr, options, (0, _localization2.default)(error), {\n                error: error\n            });\n        });\n        return xhr;\n    },\n\n    // ........................................................................ searching\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes: [\"name\", \"file_ext\", \"genome_build\", \"misc_blurb\", \"misc_info\", \"annotation\", \"tags\"],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases: {\n        title: \"name\",\n        format: \"file_ext\",\n        database: \"genome_build\",\n        blurb: \"misc_blurb\",\n        description: \"misc_blurb\",\n        info: \"misc_info\",\n        tag: \"tags\"\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString: function toString() {\n        var nameAndId = this.get(\"id\") || \"\";\n        if (this.get(\"name\")) {\n            nameAndId = \"\\\"\" + this.get(\"name\") + \"\\\",\" + nameAndId;\n        }\n        return \"Dataset(\" + nameAndId + \")\";\n    }\n}));\n\n//==============================================================================\n/** @class Backbone collection for dataset associations.\n */\nvar DatasetAssociationCollection = Backbone.Collection.extend(_baseMvc2.default.LoggableMixin).extend(\n/** @lends HistoryContents.prototype */{\n    _logNamespace: logNamespace,\n\n    model: DatasetAssociation,\n\n    /** root api url */\n    urlRoot: Galaxy.root + \"api/datasets\",\n\n    /** url fn */\n    url: function url() {\n        return this.urlRoot;\n    },\n\n    // ........................................................................ common queries\n    /** Get the ids of every item in this collection\n     *  @returns array of encoded ids\n     */\n    ids: function ids() {\n        return this.map(function (item) {\n            return item.get(\"id\");\n        });\n    },\n\n    /** Get contents that are not ready\n     *  @returns array of content models\n     */\n    notReady: function notReady() {\n        return this.filter(function (content) {\n            return !content.inReadyState();\n        });\n    },\n\n    /** return true if any datasets don't have details */\n    haveDetails: function haveDetails() {\n        return this.all(function (dataset) {\n            return dataset.hasDetails();\n        });\n    },\n\n    // ........................................................................ ajax\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue: function ajaxQueue(ajaxFn, options) {\n        var deferred = jQuery.Deferred();\n        var startingLength = this.length;\n        var responses = [];\n\n        if (!startingLength) {\n            deferred.resolve([]);\n            return deferred;\n        }\n\n        // use reverse order (stylistic choice)\n        var ajaxFns = this.chain().reverse().map(function (dataset, i) {\n            return function () {\n                var xhr = ajaxFn.call(dataset, options);\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done(function (response) {\n                    deferred.notify({\n                        curr: i,\n                        total: startingLength,\n                        response: response,\n                        model: dataset\n                    });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always(function (response) {\n                    responses.push(response);\n                    if (ajaxFns.length) {\n                        ajaxFns.shift()();\n                    } else {\n                        deferred.resolve(responses);\n                    }\n                });\n            };\n        }).value();\n        // start the queue\n        ajaxFns.shift()();\n\n        return deferred;\n    },\n\n    // ........................................................................ sorting/filtering\n    /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n    matches: function matches(matchesWhat) {\n        return this.filter(function (dataset) {\n            return dataset.matches(matchesWhat);\n        });\n    },\n\n    /** String representation. */\n    toString: function toString() {\n        return [\"DatasetAssociationCollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\nexports.default = {\n    DatasetAssociation: DatasetAssociation,\n    DatasetAssociationCollection: DatasetAssociationCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 120 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n    /** default attributes for a model */\n    defaults: {\n        /** parent (containing) history */\n        history_id: null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid: null,\n        /** whether the user wants the content shown (visible) */\n        visible: true\n    },\n\n    // ........................................................................ mixed content element\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Instead, use type_id which prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute: \"type_id\",\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden: function hidden() {\n        return !this.get(\"visible\");\n    },\n\n    //TODO: remove\n    /** based on includeDeleted, includeHidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} includeDeleted are we showing deleted hdas?\n     *  @param {Boolean} includeHidden are we showing hidden hdas?\n     */\n    isVisible: function isVisible(includeDeleted, includeHidden) {\n        var isVisible = true;\n        if (!includeDeleted && (this.get(\"deleted\") || this.get(\"purged\"))) {\n            isVisible = false;\n        }\n        if (!includeHidden && !this.get(\"visible\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n    //TODO?: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: Galaxy.root + \"api/histories/\",\n\n    /** full url spec. for this content */\n    url: function url() {\n        var historyContentType = this.get(\"history_content_type\");\n        var historyId = this.get(\"history_id\");\n        var historyContentId = this.get(\"id\");\n        var url = \"\" + this.urlRoot + historyId + \"/contents/\" + historyContentType + \"s/\" + historyContentId;\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide: function hide(options) {\n        if (!this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: false }, options);\n    },\n    /** save this content as visible */\n    unhide: function unhide(options) {\n        if (this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: true }, options);\n    },\n\n    // ........................................................................ misc\n    toString: function toString() {\n        return [this.get(\"type_id\"), this.get(\"hid\"), this.get(\"name\")].join(\":\");\n    }\n};\n\n//==============================================================================\nexports.default = {\n    HistoryContentMixin: HistoryContentMixin\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 121 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/* For presentation-related functionality shared across collection creators.\n   Particularily overlapping functionality related to name processing and help.\n*/\nvar CollectionCreatorMixin = {\n    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n    _validationWarning: function _validationWarning(what, clear) {\n        var VALIDATION_CLASS = \"validation-warning\";\n        if (what === \"name\") {\n            what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n            this.$(\".collection-name\").focus().select();\n        }\n        if (clear) {\n            what = what || this.$(\".\" + VALIDATION_CLASS);\n            what.removeClass(VALIDATION_CLASS);\n        } else {\n            what.addClass(VALIDATION_CLASS);\n        }\n    },\n\n    _changeHideOriginals: function _changeHideOriginals(ev) {\n        this.hideOriginals = this.$(\".hide-originals\").prop(\"checked\");\n    },\n\n    // ........................................................................ footer\n    /** handle a collection name change */\n    _changeName: function _changeName(ev) {\n        this._validationWarning(\"name\", !!this._getName());\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter: function _nameCheckForEnter(ev) {\n        if (ev.keyCode === 13 && !this.blocking) {\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName: function _getName() {\n        return _.escape(this.$(\".collection-name\").val());\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp: function _clickMoreHelp(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").addClass(\"expanded\");\n        this.$(\".more-help\").hide();\n    },\n    /** collapse help */\n    _clickLessHelp: function _clickLessHelp(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").removeClass(\"expanded\");\n        this.$(\".more-help\").show();\n    },\n    /** toggle help */\n    _toggleHelp: function _toggleHelp(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").toggleClass(\"expanded\");\n        this.$(\".more-help\").toggle();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n    _showAlert: function _showAlert(message, alertClass) {\n        alertClass = alertClass || \"alert-danger\";\n        this.$(\".main-help\").hide();\n        this.$(\".header .alert\").attr(\"class\", \"alert alert-dismissable\").addClass(alertClass).show().find(\".alert-message\").html(message);\n    },\n    /** hide the alerts at the top */\n    _hideAlert: function _hideAlert(message) {\n        this.$(\".main-help\").show();\n        this.$(\".header .alert\").hide();\n    },\n\n    _cancelCreate: function _cancelCreate(ev) {\n        if (typeof this.oncancel === \"function\") {\n            this.oncancel.call(this);\n        }\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate: function _clickCreate(ev) {\n        var name = this._getName();\n        if (!name) {\n            this._validationWarning(\"name\");\n        } else if (!this.blocking) {\n            this.createList(name);\n        }\n    },\n\n    _setUpCommonSettings: function _setUpCommonSettings(attributes) {\n        this.hideOriginals = attributes.defaultHideSourceItems || false;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter: function _renderFooter(speed, callback) {\n        var self = this;\n        var $footer = this.$(\".footer\").empty().html(this.templates.footer());\n        _.each(this.footerSettings, function (property, selector) {\n            self.$(selector).prop(\"checked\", self[property]);\n        });\n        if (typeof this.oncancel === \"function\") {\n            this.$(\".cancel-create.btn\").show();\n        }\n        return $footer;\n    },\n\n    _creatorTemplates: {\n        main: _.template(['<div class=\"header flex-row no-flex\"></div>', '<div class=\"middle flex-row flex-row-container\"></div>', '<div class=\"footer flex-row no-flex\"></div>'].join(\"\"))\n    }\n};\n\n//==============================================================================\nexports.default = {\n    CollectionCreatorMixin: CollectionCreatorMixin\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 122 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n// Alphanumeric/natural sort fn\nfunction naturalSort(a, b) {\n    // setup temp-scope variables for comparison evauluation\n    var re = /(-?[0-9\\.]+)/g;\n\n    var x = a.toString().toLowerCase() || \"\";\n    var y = b.toString().toLowerCase() || \"\";\n    var nC = String.fromCharCode(0);\n    var xN = x.replace(re, nC + \"$1\" + nC).split(nC);\n    var yN = y.replace(re, nC + \"$1\" + nC).split(nC);\n    var xD = new Date(x).getTime();\n    var yD = xD ? new Date(y).getTime() : null;\n    // natural sorting of dates\n    if (yD) {\n        if (xD < yD) {\n            return -1;\n        } else if (xD > yD) {\n            return 1;\n        }\n    }\n\n    // natural sorting through split numeric strings and default strings\n    var oFxNcL;\n\n    var oFyNcL;\n    for (var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {\n        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n        if (oFxNcL < oFyNcL) {\n            return -1;\n        } else if (oFxNcL > oFyNcL) {\n            return 1;\n        }\n    }\n    return 0;\n}\n\nexports.default = naturalSort;\n\n/***/ }),\n/* 123 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\"use_strict\";\n\nvar $ = _jquery2.default;\n//=============================================================================\n\n_jquery2.default.fn.extend({\n    hoverhighlight: function $hoverhighlight(scope, color) {\n        scope = scope || \"body\";\n        if (!this.length) {\n            return this;\n        }\n\n        $(this).each(function () {\n            var $this = $(this);\n            var targetSelector = $this.data(\"target\");\n\n            if (targetSelector) {\n                $this.mouseover(function (ev) {\n                    $(targetSelector, scope).css({\n                        background: color\n                    });\n                }).mouseout(function (ev) {\n                    $(targetSelector).css({\n                        background: \"\"\n                    });\n                });\n            }\n        });\n        return this;\n    }\n});\n\n/***/ }),\n/* 124 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _deferred = __webpack_require__(97);\n\nvar _deferred2 = _interopRequireDefault(_deferred);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nvar _formData = __webpack_require__(100);\n\nvar _formData2 = _interopRequireDefault(_formData);\n\nvar _toolFormBase = __webpack_require__(45);\n\nvar _toolFormBase2 = _interopRequireDefault(_toolFormBase);\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _webhooks = __webpack_require__(13);\n\nvar _webhooks2 = _interopRequireDefault(_webhooks);\n\nvar _workflowIcons = __webpack_require__(81);\n\nvar _workflowIcons2 = _interopRequireDefault(_workflowIcons);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.modal = parent.Galaxy.modal || new _uiModal2.default.View();\n        this.model = options && options.model || new Backbone.Model(options);\n        this.deferred = new _deferred2.default();\n        this.setElement($(\"<div/>\").addClass(\"ui-form-composite\").append(this.$message = $(\"<div/>\")).append(this.$header = $(\"<div/>\")).append(this.$steps = $(\"<div/>\")));\n        $(\"body\").append(this.$el);\n        this._configure();\n        this.render();\n        $(window).resize(function () {\n            self._refresh();\n        });\n    },\n\n    /** Refresh height of scrollable div below header, handle scrolling by lazy loading steps */\n    _refresh: function _refresh(step_index) {\n        var margin = _.reduce(this.$el.children(), function (memo, child) {\n            return memo + $(child).outerHeight();\n        }, 0) - this.$steps.height() + 90;\n        this.$steps.css(\"height\", $(window).height() - margin);\n    },\n\n    /** Configures form/step options for each workflow step */\n    _configure: function _configure() {\n        var self = this;\n        this.forms = [];\n        this.steps = [];\n        this.links = [];\n        this.parms = [];\n        _.each(this.model.get(\"steps\"), function (step, i) {\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", i + \" : Preparing workflow step.\");\n            var icon = _workflowIcons2.default[step.step_type];\n            var title = parseInt(i + 1) + \": \" + (step.step_label || step.step_name);\n            if (step.annotation) {\n                title += \" - \" + step.annotation;\n            }\n            if (step.step_version) {\n                title += \" (Galaxy Version \" + step.step_version + \")\";\n            }\n            step = _utils2.default.merge({\n                index: i,\n                fixed_title: _.escape(title),\n                icon: icon || \"\",\n                help: null,\n                citations: null,\n                collapsible: true,\n                collapsed: i > 0 && !self._isDataStep(step),\n                sustain_version: true,\n                sustain_repeats: true,\n                sustain_conditionals: true,\n                narrow: true,\n                text_enable: \"Edit\",\n                text_disable: \"Undo\",\n                cls_enable: \"fa fa-edit\",\n                cls_disable: \"fa fa-undo\",\n                errors: step.messages,\n                initial_errors: true,\n                cls: \"ui-portlet-narrow\",\n                hide_operations: true,\n                needs_refresh: false,\n                always_refresh: step.step_type != \"tool\"\n            }, step);\n            self.steps[i] = step;\n            self.links[i] = [];\n            self.parms[i] = {};\n        });\n\n        // build linear index of step input pairs\n        _.each(this.steps, function (step, i) {\n            _formData2.default.visitInputs(step.inputs, function (input, name) {\n                self.parms[i][name] = input;\n            });\n        });\n\n        // iterate through data input modules and collect linked sub steps\n        _.each(this.steps, function (step, i) {\n            _.each(step.output_connections, function (output_connection) {\n                _.each(self.steps, function (sub_step, j) {\n                    sub_step.step_index === output_connection.input_step_index && self.links[i].push(sub_step);\n                });\n            });\n        });\n\n        // convert all connected data inputs to hidden fields with proper labels,\n        // and track the linked source step\n        _.each(this.steps, function (step, i) {\n            _.each(self.steps, function (sub_step, j) {\n                var connections_by_name = {};\n                _.each(step.output_connections, function (connection) {\n                    sub_step.step_index === connection.input_step_index && (connections_by_name[connection.input_name] = connection);\n                });\n                _.each(self.parms[j], function (input, name) {\n                    var connection = connections_by_name[name];\n                    if (connection) {\n                        input.type = \"hidden\";\n                        input.help = input.step_linked ? input.help + \", \" : \"\";\n                        input.help += \"Output dataset '\" + connection.output_name + \"' from step \" + (parseInt(i) + 1);\n                        input.step_linked = input.step_linked || [];\n                        input.step_linked.push(step);\n                    }\n                });\n            });\n        });\n\n        // identify and configure workflow parameters\n        var wp_count = 0;\n        this.wp_inputs = {};\n        function _handleWorkflowParameter(value, callback) {\n            var re = /\\$\\{(.+?)\\}/g;\n            var match;\n            while (match = re.exec(String(value))) {\n                var wp_name = match[1];\n                callback(self.wp_inputs[wp_name] = self.wp_inputs[wp_name] || {\n                    label: wp_name,\n                    name: wp_name,\n                    type: \"text\",\n                    color: \"hsl( \" + ++wp_count * 100 + \", 70%, 30% )\",\n                    style: \"ui-form-wp-source\",\n                    links: []\n                });\n            }\n        }\n        _.each(this.steps, function (step, i) {\n            _.each(self.parms[i], function (input, name) {\n                _handleWorkflowParameter(input.value, function (wp_input) {\n                    wp_input.links.push(step);\n                    input.wp_linked = true;\n                    input.type = \"text\";\n                    input.backdrop = true;\n                    input.style = \"ui-form-wp-target\";\n                });\n            });\n            _.each(step.post_job_actions, function (pja) {\n                _.each(pja.action_arguments, function (arg) {\n                    _handleWorkflowParameter(arg, function () {});\n                });\n            });\n        });\n\n        // select fields are shown for dynamic fields if all putative data inputs are available,\n        // or if an explicit reference is specified as data_ref and available\n        _.each(this.steps, function (step, i) {\n            if (step.step_type == \"tool\") {\n                var data_resolved = true;\n                _formData2.default.visitInputs(step.inputs, function (input, name, context) {\n                    var is_runtime_value = input.value && input.value.__class__ == \"RuntimeValue\";\n                    var is_data_input = [\"data\", \"data_collection\"].indexOf(input.type) != -1;\n                    var data_ref = context[input.data_ref];\n                    input.step_linked && !self._isDataStep(input.step_linked) && (data_resolved = false);\n                    input.options && (input.options.length == 0 && !data_resolved || input.wp_linked) && (input.is_workflow = true);\n                    data_ref && (input.is_workflow = data_ref.step_linked && !self._isDataStep(data_ref.step_linked) || input.wp_linked);\n                    (is_data_input || input.value && input.value.__class__ == \"RuntimeValue\" && !input.step_linked) && (step.collapsed = false);\n                    is_runtime_value && (input.value = input.default_value);\n                    input.flavor = \"workflow\";\n                    if (!is_runtime_value && !is_data_input && input.type !== \"hidden\" && !input.wp_linked) {\n                        if (input.optional || !_utils2.default.isEmpty(input.value) && input.value !== \"\") {\n                            input.collapsible_value = input.value;\n                            input.collapsible_preview = true;\n                        }\n                    }\n                });\n            }\n        });\n    },\n\n    render: function render() {\n        var self = this;\n        this.deferred.reset();\n        this._renderHeader();\n        this._renderMessage();\n        this._renderParameters();\n        this._renderHistory();\n        _.each(this.steps, function (step) {\n            self._renderStep(step);\n        });\n    },\n\n    /** Render header */\n    _renderHeader: function _renderHeader() {\n        var self = this;\n        this.execute_btn = new _uiMisc2.default.Button({\n            icon: \"fa-check\",\n            title: \"Run workflow\",\n            cls: \"btn btn-primary\",\n            onclick: function onclick() {\n                self._execute();\n            }\n        });\n        this.$header.addClass(\"ui-form-header\").empty().append(new _uiMisc2.default.Label({\n            title: \"Workflow: \" + this.model.get(\"name\")\n        }).$el).append(this.execute_btn.$el);\n    },\n\n    /** Render message */\n    _renderMessage: function _renderMessage() {\n        this.$message.empty();\n        if (this.model.get(\"has_upgrade_messages\")) {\n            this.$message.append(new _uiMisc2.default.Message({\n                message: \"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.\",\n                status: \"warning\",\n                persistent: true,\n                fade: false\n            }).$el);\n        }\n        var step_version_changes = this.model.get(\"step_version_changes\");\n        if (step_version_changes && step_version_changes.length > 0) {\n            this.$message.append(new _uiMisc2.default.Message({\n                message: \"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.\",\n                status: \"warning\",\n                persistent: true,\n                fade: false\n            }).$el);\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderParameters: function _renderParameters() {\n        var self = this;\n        this.wp_form = null;\n        if (!_.isEmpty(this.wp_inputs)) {\n            this.wp_form = new _formView2.default({\n                title: \"<b>Workflow Parameters</b>\",\n                inputs: this.wp_inputs,\n                cls: \"ui-portlet-narrow\",\n                onchange: function onchange() {\n                    _.each(self.wp_form.input_list, function (input_def, i) {\n                        _.each(input_def.links, function (step) {\n                            self._refreshStep(step);\n                        });\n                    });\n                }\n            });\n            this._append(this.$steps.empty(), this.wp_form.$el);\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderHistory: function _renderHistory() {\n        this.history_form = new _formView2.default({\n            cls: \"ui-portlet-narrow\",\n            title: \"<b>History Options</b>\",\n            inputs: [{\n                type: \"conditional\",\n                name: \"new_history\",\n                test_param: {\n                    name: \"check\",\n                    label: \"Send results to a new history\",\n                    type: \"boolean\",\n                    value: \"false\",\n                    help: \"\"\n                },\n                cases: [{\n                    value: \"true\",\n                    inputs: [{\n                        name: \"name\",\n                        label: \"History name\",\n                        type: \"text\",\n                        value: this.model.get(\"name\")\n                    }]\n                }]\n            }]\n        });\n        this._append(this.$steps, this.history_form.$el);\n    },\n\n    /** Render step */\n    _renderStep: function _renderStep(step) {\n        var self = this;\n        var form = null;\n        this.deferred.execute(function (promise) {\n            self.$steps.addClass(\"ui-steps\");\n            if (step.step_type == \"tool\") {\n                step.postchange = function (process, form) {\n                    var self = this;\n                    var current_state = {\n                        tool_id: step.id,\n                        tool_version: step.version,\n                        inputs: $.extend(true, {}, form.data.create())\n                    };\n                    form.wait(true);\n                    Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Sending current state.\", current_state);\n                    _utils2.default.request({\n                        type: \"POST\",\n                        url: Galaxy.root + \"api/tools/\" + step.id + \"/build\",\n                        data: current_state,\n                        success: function success(data) {\n                            form.update(data);\n                            form.wait(false);\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Received new model.\", data);\n                            process.resolve();\n                        },\n                        error: function error(response) {\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Refresh request failed.\", response);\n                            process.reject();\n                        }\n                    });\n                };\n                form = new _toolFormBase2.default(step);\n                if (step.post_job_actions && step.post_job_actions.length) {\n                    form.portlet.append($(\"<div/>\").addClass(\"ui-form-element-disabled\").append($(\"<div/>\").addClass(\"ui-form-title\").html(\"<b>Job Post Actions</b>\")).append($(\"<div/>\").addClass(\"ui-form-preview\").html(_.reduce(step.post_job_actions, function (memo, value) {\n                        return memo + \" \" + value.short_str;\n                    }, \"\"))));\n                }\n            } else {\n                var is_simple_input = [\"data_input\", \"data_collection_input\"].indexOf(step.step_type) != -1;\n                _.each(step.inputs, function (input) {\n                    input.flavor = \"module\";\n                    input.hide_label = is_simple_input;\n                });\n                form = new _formView2.default(_utils2.default.merge({\n                    title: step.fixed_title,\n                    onchange: function onchange() {\n                        _.each(self.links[step.index], function (link) {\n                            self._refreshStep(link);\n                        });\n                    },\n                    inputs: step.inputs && step.inputs.length > 0 ? step.inputs : [{\n                        type: \"hidden\",\n                        name: \"No options available.\",\n                        ignore: null\n                    }]\n                }, step));\n            }\n            self.forms[step.index] = form;\n            self._append(self.$steps, form.$el);\n            self._refresh();\n            step.needs_refresh && self._refreshStep(step);\n            form.portlet[!self.show_progress ? \"enable\" : \"disable\"]();\n            self.show_progress && self.execute_btn.model.set({\n                wait: true,\n                wait_text: \"Preparing...\",\n                percentage: (step.index + 1) * 100.0 / self.steps.length\n            });\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", step.index + \" : Workflow step state ready.\", step);\n            setTimeout(function () {\n                promise.resolve();\n            }, 0);\n        });\n    },\n\n    /** Refreshes step values from source step values */\n    _refreshStep: function _refreshStep(step) {\n        var self = this;\n        var form = this.forms[step.index];\n        if (form) {\n            _.each(self.parms[step.index], function (input, name) {\n                if (input.step_linked || input.wp_linked) {\n                    var field = form.field_list[form.data.match(name)];\n                    if (field) {\n                        var new_value = undefined;\n                        if (input.step_linked) {\n                            new_value = { values: [] };\n                            _.each(input.step_linked, function (source_step) {\n                                if (self._isDataStep(source_step)) {\n                                    var value = self.forms[source_step.index].data.create().input;\n                                    value && _.each(value.values, function (v) {\n                                        new_value.values.push(v);\n                                    });\n                                }\n                            });\n                            if (!input.multiple && new_value.values.length > 0) {\n                                new_value = {\n                                    values: [new_value.values[0]]\n                                };\n                            }\n                        } else if (input.wp_linked) {\n                            new_value = input.value;\n                            var re = /\\$\\{(.+?)\\}/g;\n                            var match;\n                            while (match = re.exec(input.value)) {\n                                var wp_field = self.wp_form.field_list[self.wp_form.data.match(match[1])];\n                                var wp_value = wp_field && wp_field.value();\n                                if (wp_value) {\n                                    new_value = new_value.split(match[0]).join(wp_value);\n                                }\n                            }\n                        }\n                        if (new_value !== undefined) {\n                            field.value(new_value);\n                        }\n                    }\n                }\n            });\n            form.trigger(\"change\");\n        } else {\n            step.needs_refresh = true;\n        }\n    },\n\n    /** Refresh the history after job submission while form is shown */\n    _refreshHistory: function _refreshHistory() {\n        var self = this;\n        var history = parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.model;\n        this._refresh_history && clearTimeout(this._refresh_history);\n        if (history) {\n            history.refresh().success(function () {\n                if (history.numOfUnfinishedShownContents() === 0) {\n                    self._refresh_history = setTimeout(function () {\n                        self._refreshHistory();\n                    }, history.UPDATE_DELAY);\n                }\n            });\n        }\n    },\n\n    /** Build remaining steps */\n    _execute: function _execute() {\n        var self = this;\n        this.show_progress = true;\n        this._enabled(false);\n        this.deferred.execute(function (promise) {\n            setTimeout(function () {\n                promise.resolve();\n                self._submit();\n            }, 0);\n        });\n    },\n\n    /** Validate and submit workflow */\n    _submit: function _submit() {\n        var self = this;\n        var history_form_data = this.history_form.data.create();\n        var job_def = {\n            new_history_name: history_form_data[\"new_history|name\"] ? history_form_data[\"new_history|name\"] : null,\n            history_id: !history_form_data[\"new_history|name\"] ? this.model.get(\"history_id\") : null,\n            replacement_params: this.wp_form ? this.wp_form.data.create() : {},\n            parameters: {},\n            // Tool form will submit flat maps for each parameter\n            // (e.g. \"repeat_0|cond|param\": \"foo\" instead of nested\n            // data structures).\n            parameters_normalized: true,\n            // Tool form always wants a list of invocations back\n            // so that inputs can be batched.\n            batch: true\n        };\n        var validated = true;\n        for (var i in this.forms) {\n            var form = this.forms[i];\n            var job_inputs = form.data.create();\n            var step = self.steps[i];\n            var step_index = step.step_index;\n            form.trigger(\"reset\");\n            for (var job_input_id in job_inputs) {\n                var input_value = job_inputs[job_input_id];\n                var input_id = form.data.match(job_input_id);\n                var input_field = form.field_list[input_id];\n                var input_def = form.input_list[input_id];\n                if (!input_def.step_linked) {\n                    if (this._isDataStep(step)) {\n                        validated = input_value && input_value.values && input_value.values.length > 0;\n                    } else {\n                        validated = input_def.optional || input_def.is_workflow && input_value !== \"\" || !input_def.is_workflow && input_value !== null;\n                    }\n                    if (!validated) {\n                        form.highlight(input_id);\n                        break;\n                    }\n                    job_def.parameters[step_index] = job_def.parameters[step_index] || {};\n                    job_def.parameters[step_index][job_input_id] = job_inputs[job_input_id];\n                }\n            }\n            if (!validated) {\n                break;\n            }\n        }\n        if (!validated) {\n            self._enabled(true);\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation failed.\", job_def);\n        } else {\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation complete.\", job_def);\n            _utils2.default.request({\n                type: \"POST\",\n                url: Galaxy.root + \"api/workflows/\" + this.model.id + \"/invocations\",\n                data: job_def,\n                success: function success(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission successful.\", response);\n                    self.$el.children().hide();\n                    self.$el.append(self._templateSuccess(response));\n\n                    // Show Webhook if job is running\n                    if ($.isArray(response) && response.length > 0) {\n                        self.$el.append($(\"<div/>\", { id: \"webhook-view\" }));\n                        var WebhookApp = new _webhooks2.default.WebhookView({\n                            urlRoot: Galaxy.root + \"api/webhooks/workflow\",\n                            toolId: job_def.tool_id,\n                            toolVersion: job_def.tool_version\n                        });\n                    }\n\n                    self._refreshHistory();\n                },\n                error: function error(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission failed.\", response);\n                    var input_found = false;\n                    if (response && response.err_data) {\n                        for (var i in self.forms) {\n                            var form = self.forms[i];\n                            var step_related_errors = response.err_data[form.model.get(\"step_index\")];\n                            if (step_related_errors) {\n                                var error_messages = form.data.matchResponse(step_related_errors);\n                                for (var input_id in error_messages) {\n                                    form.highlight(input_id, error_messages[input_id]);\n                                    input_found = true;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                    if (!input_found) {\n                        self.modal.show({\n                            title: \"Workflow submission failed\",\n                            body: self._templateError(job_def, response && response.err_msg),\n                            buttons: {\n                                Close: function Close() {\n                                    self.modal.hide();\n                                }\n                            }\n                        });\n                    }\n                },\n                complete: function complete() {\n                    self._enabled(true);\n                }\n            });\n        }\n    },\n\n    /** Append new dom to body */\n    _append: function _append($container, $el) {\n        $container.append(\"<p/>\").append($el);\n    },\n\n    /** Set enabled/disabled state */\n    _enabled: function _enabled(enabled) {\n        this.execute_btn.model.set({\n            wait: !enabled,\n            wait_text: \"Sending...\",\n            percentage: -1\n        });\n        this.wp_form && this.wp_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        this.history_form && this.history_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        _.each(this.forms, function (form) {\n            form && form.portlet[enabled ? \"enable\" : \"disable\"]();\n        });\n    },\n\n    /** Is data input module/step */\n    _isDataStep: function _isDataStep(steps) {\n        var lst = $.isArray(steps) ? steps : [steps];\n        for (var i = 0; i < lst.length; i++) {\n            var step = lst[i];\n            if (!step || !step.step_type || !step.step_type.startsWith(\"data\")) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    /** Templates */\n    _templateSuccess: function _templateSuccess(response) {\n        if ($.isArray(response) && response.length > 0) {\n            return $(\"<div/>\").addClass(\"donemessagelarge\").append($(\"<p/>\").html(\"Successfully invoked workflow <b>\" + _utils2.default.sanitize(this.model.get(\"name\")) + \"</b>\" + (response.length > 1 ? \" <b>\" + response.length + \" times</b>\" : \"\") + \".\")).append($(\"<p/>\").append(\"<b/>\").text(\"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"));\n        } else {\n            return this._templateError(response, \"Invalid success response. No invocations found.\");\n        }\n    },\n\n    _templateError: function _templateError(response, err_msg) {\n        return $(\"<div/>\").addClass(\"errormessagelarge\").append($(\"<p/>\").text(\"The server could not complete the request. Please contact the Galaxy Team if this error persists. \" + (JSON.stringify(err_msg) || \"\"))).append($(\"<pre/>\").text(JSON.stringify(response, null, 4)));\n    }\n}); /** This is the run workflow tool form view. */\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 125 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, jQuery, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _errorModal = __webpack_require__(126);\n\nvar _errorModal2 = _interopRequireDefault(_errorModal);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\n/**\n * A dialog/modal that allows copying a user history or 'importing' from user\n * another. Generally called via historyCopyDialog below.\n * @type {Object}\n */\nvar CopyDialog = {\n    // language related strings/fns\n    defaultName: _.template(\"Copy of '<%- name %>'\"),\n    title: _.template((0, _localization2.default)(\"Copying history\") + \" \\\"<%- name %>\\\"\"),\n    submitLabel: (0, _localization2.default)(\"Copy\"),\n    errorMessage: (0, _localization2.default)(\"History could not be copied.\"),\n    progressive: (0, _localization2.default)(\"Copying history\"),\n    activeLabel: (0, _localization2.default)(\"Copy only the active, non-deleted datasets\"),\n    allLabel: (0, _localization2.default)(\"Copy all datasets including deleted ones\"),\n    anonWarning: (0, _localization2.default)(\"As an anonymous user, unless you login or register, you will lose your current history \") + (0, _localization2.default)(\"after copying this history. \"),\n\n    // template for modal body\n    _template: _.template([\n    //TODO: remove inline styles\n    // show a warning message for losing current to anon users\n    \"<% if( isAnon ){ %>\", '<div class=\"warningmessage\">', \"<%- anonWarning %>\", (0, _localization2.default)(\"You can\"), ' <a href=\"/user/login\">', (0, _localization2.default)(\"login here\"), \"</a> \", (0, _localization2.default)(\"or\"), \" \", ' <a href=\"/user/create\">', (0, _localization2.default)(\"register here\"), \"</a>.\", \"</div>\", \"<% } %>\", \"<form>\", '<label for=\"copy-modal-title\">', (0, _localization2.default)(\"Enter a title for the new history\"), \":\", \"</label><br />\",\n    // TODO: could use required here and the form validators\n    // NOTE: use unescaped here if escaped in the modal function below\n    '<input id=\"copy-modal-title\" class=\"form-control\" style=\"width: 100%\" value=\"<%= name %>\" />', '<p class=\"invalid-title bg-danger\" style=\"color: red; margin: 8px 0px 8px 0px; display: none\">', (0, _localization2.default)(\"Please enter a valid history title\"), \"</p>\",\n    // if allowAll, add the option to copy deleted datasets, too\n    \"<% if( allowAll ){ %>\", \"<br />\", \"<p>\", (0, _localization2.default)(\"Choose which datasets from the original history to include:\"), \"</p>\",\n    // copy non-deleted is the default\n    '<input name=\"copy-what\" type=\"radio\" id=\"copy-non-deleted\" value=\"copy-non-deleted\" ', '<% if( copyWhat === \"copy-non-deleted\" ){ print( \"checked\" ); } %>/>', '<label for=\"copy-non-deleted\"> <%- activeLabel %></label>', \"<br />\", '<input name=\"copy-what\" type=\"radio\" id=\"copy-all\" value=\"copy-all\" ', '<% if( copyWhat === \"copy-all\" ){ print( \"checked\" ); } %>/>', '<label for=\"copy-all\"> <%- allLabel %></label>', \"<% } %>\", \"</form>\"].join(\"\")),\n\n    // empty modal body and let the user know the copy is happening\n    _showAjaxIndicator: function _showAjaxIndicator() {\n        var indicator = \"<p><span class=\\\"fa fa-spinner fa-spin\\\"></span> \" + this.progressive + \"...</p>\";\n        this.modal.$(\".modal-body\").empty().append(indicator).css({ \"margin-top\": \"8px\" });\n    },\n\n    // (sorta) public interface - display the modal, render the form, and potentially copy the history\n    // returns a jQuery.Deferred done->history copied, fail->user cancelled\n    dialog: function _dialog(modal, history, options) {\n        options = options || {};\n\n        var dialog = this;\n        var deferred = jQuery.Deferred();\n\n        var // TODO: getting a little byzantine here\n        defaultCopyNameFn = options.nameFn || this.defaultName;\n\n        var defaultCopyName = defaultCopyNameFn({\n            name: history.get(\"name\")\n        });\n\n        var // TODO: these two might be simpler as one 3 state option (all,active,no-choice)\n        defaultCopyWhat = options.allDatasets ? \"copy-all\" : \"copy-non-deleted\";\n\n        var allowAll = !_.isUndefined(options.allowAll) ? options.allowAll : true;\n\n        var autoClose = !_.isUndefined(options.autoClose) ? options.autoClose : true;\n\n        this.modal = modal;\n\n        // validate the name and copy if good\n        function checkNameAndCopy() {\n            var name = modal.$(\"#copy-modal-title\").val();\n            if (!name) {\n                modal.$(\".invalid-title\").show();\n                return;\n            }\n            // get further settings, shut down and indicate the ajax call, then hide and resolve/reject\n            var copyAllDatasets = modal.$('input[name=\"copy-what\"]:checked').val() === \"copy-all\";\n            modal.$(\"button\").prop(\"disabled\", true);\n            dialog._showAjaxIndicator();\n            history.copy(true, name, copyAllDatasets).done(function (response) {\n                deferred.resolve(response);\n            }).fail(function (xhr, status, message) {\n                var options = {\n                    name: name,\n                    copyAllDatasets: copyAllDatasets\n                };\n                _errorModal2.default.ajaxErrorModal(history, xhr, options, dialog.errorMessage);\n                deferred.rejectWith(deferred, arguments);\n            }).done(function () {\n                if (autoClose) {\n                    modal.hide();\n                }\n            });\n        }\n\n        var originalClosingCallback = options.closing_callback;\n        modal.show(_.extend(options, {\n            title: this.title({ name: history.get(\"name\") }),\n            body: $(dialog._template({\n                name: defaultCopyName,\n                isAnon: Galaxy.user.isAnonymous(),\n                allowAll: allowAll,\n                copyWhat: defaultCopyWhat,\n                activeLabel: this.activeLabel,\n                allLabel: this.allLabel,\n                anonWarning: this.anonWarning\n            })),\n            buttons: _.object([[(0, _localization2.default)(\"Cancel\"), function () {\n                modal.hide();\n            }], [this.submitLabel, checkNameAndCopy]]),\n            height: \"auto\",\n            closing_events: true,\n            closing_callback: function _historyCopyClose(cancelled) {\n                if (cancelled) {\n                    deferred.reject({ cancelled: true });\n                }\n                if (originalClosingCallback) {\n                    originalClosingCallback(cancelled);\n                }\n            }\n        }));\n\n        // set the default dataset copy, autofocus the title, and set up for a simple return\n        modal.$(\"#copy-modal-title\").focus().select();\n        modal.$(\"#copy-modal-title\").on(\"keydown\", function (ev) {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                checkNameAndCopy();\n            }\n        });\n\n        return deferred;\n    }\n};\n\n//==============================================================================\n// maintain the (slight) distinction between copy and import\n/**\n * Subclass CopyDialog to use the import language.\n */\nvar ImportDialog = _.extend({}, CopyDialog, {\n    defaultName: _.template(\"imported: <%- name %>\"),\n    title: _.template((0, _localization2.default)(\"Importing history\") + \" \\\"<%- name %>\\\"\"),\n    submitLabel: (0, _localization2.default)(\"Import\"),\n    errorMessage: (0, _localization2.default)(\"History could not be imported.\"),\n    progressive: (0, _localization2.default)(\"Importing history\"),\n    activeLabel: (0, _localization2.default)(\"Import only the active, non-deleted datasets\"),\n    allLabel: (0, _localization2.default)(\"Import all datasets including deleted ones\"),\n    anonWarning: (0, _localization2.default)(\"As an anonymous user, unless you login or register, you will lose your current history \") + (0, _localization2.default)(\"after importing this history. \")\n});\n\n//==============================================================================\n/**\n * Main interface for both history import and history copy dialogs.\n * @param  {Backbone.Model} history     the history to copy\n * @param  {Object}         options     a hash\n * @return {jQuery.Deferred}            promise that fails on close and succeeds on copy\n *\n * options:\n *     (this object is also passed to the modal used to display the dialog and accepts modal options)\n *     {Function} nameFn    if defined, use this to build the default name shown to the user\n *                          (the fn is passed: {name: <original history's name>})\n *     {bool} useImport     if true, use the 'import' language (instead of Copy)\n *     {bool} allowAll      if true, allow the user to choose between copying all datasets and\n *                          only non-deleted datasets\n *     {String} allDatasets default initial checked radio button: 'copy-all' or 'copy-non-deleted',\n */\nvar historyCopyDialog = function historyCopyDialog(history, options) {\n    options = options || {};\n    // create our own modal if Galaxy doesn't have one (mako tab without use_panels)\n    var modal = window.parent.Galaxy.modal || new _uiModal2.default.View({});\n    return options.useImport ? ImportDialog.dialog(modal, history, options) : CopyDialog.dialog(modal, history, options);\n};\n\n//==============================================================================\nexports.default = historyCopyDialog;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0), __webpack_require__(0)))\n\n/***/ }),\n/* 126 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//TODO: toastr is another possibility - I didn't see where I might add details, tho\n\n/* ============================================================================\nError modals meant to replace the o-so-easy alerts.\n\nThese are currently styled as errormessages but use the Galaxy.modal\ninfrastructure to be shown/closed. They're capable of showing details in a\ntogglable dropdown and the details are formatted in a pre.\n\nExample:\n    errorModal( 'Heres a message', 'A Title', { some_details: 'here' });\n    errorModal( 'Heres a message' ); // no details, title is 'Error'\n\nThere are three specialized forms:\n    offlineErrorModal       a canned response for when there's no connection\n    badGatewayErrorModal    canned response for when Galaxy is restarting\n    ajaxErrorModal          plugable into any Backbone class as an\n        error event handler by accepting the error args: model, xhr, options\n\nExamples:\n    if( navigator.offLine ){ offlineErrorModal(); }\n    if( xhr.status === 502 ){ badGatewayErrorModal(); }\n    this.listenTo( this.model, 'error', ajaxErrorModal );\n\n============================================================================ */\n\nvar CONTACT_MSG = (0, _localization2.default)(\"Please contact a Galaxy administrator if the problem persists.\");\nvar DEFAULT_AJAX_ERR_MSG = (0, _localization2.default)(\"An error occurred while updating information with the server.\");\nvar DETAILS_MSG = (0, _localization2.default)(\"The following information can assist the developers in finding the source of the error:\");\n\n/** private helper that builds the modal and handles adding details */\nfunction _errorModal(message, title, details) {\n    // create and return the modal, adding details button only if needed\n    Galaxy.modal.show({\n        title: title,\n        body: message,\n        closing_events: true,\n        buttons: {\n            Ok: function Ok() {\n                Galaxy.modal.hide();\n            }\n        }\n    });\n    Galaxy.modal.$el.addClass(\"error-modal\");\n\n    if (details) {\n        Galaxy.modal.$(\".error-details\").add(Galaxy.modal.$('button:contains(\"Details\")')).remove();\n        $(\"<div/>\").addClass(\"error-details\").hide().appendTo(Galaxy.modal.$(\".modal-content\")).append([$(\"<p/>\").text(DETAILS_MSG), $(\"<pre/>\").text(JSON.stringify(details, null, \"  \"))]);\n\n        $(\"<button id=\\\"button-1\\\" class=\\\"pull-left\\\">\" + (0, _localization2.default)(\"Details\") + \"</button>\").appendTo(Galaxy.modal.$(\".buttons\")).click(function () {\n            Galaxy.modal.$(\".error-details\").toggle();\n        });\n    }\n    return Galaxy.modal;\n}\n\n/** Display a modal showing an error message but fallback to alert if there's no modal */\nfunction errorModal(message, title, details) {\n    if (!message) {\n        return;\n    }\n\n    message = (0, _localization2.default)(message);\n    title = (0, _localization2.default)(title) || (0, _localization2.default)(\"Error:\");\n    if (window.Galaxy && Galaxy.modal) {\n        return _errorModal(message, title, details);\n    }\n\n    alert(title + \"\\n\\n\" + message);\n    console.log(\"error details:\", JSON.stringify(details));\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal when the user may be offline */\nfunction offlineErrorModal() {\n    return errorModal((0, _localization2.default)(\"You appear to be offline. Please check your connection and try again.\"), (0, _localization2.default)(\"Offline?\"));\n}\n\n// ----------------------------------------------------------------------------\n/** 502 messages that should be displayed when galaxy is restarting */\nfunction badGatewayErrorModal() {\n    return errorModal((0, _localization2.default)(\"Galaxy is currently unreachable. Please try again in a few minutes.\") + \" \" + CONTACT_MSG, (0, _localization2.default)(\"Cannot connect to Galaxy\"));\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal (with details) about a failed Backbone ajax operation */\nfunction ajaxErrorModal(model, xhr, options, message, title) {\n    message = message || DEFAULT_AJAX_ERR_MSG;\n    message += \" \" + CONTACT_MSG;\n    title = title || (0, _localization2.default)(\"An error occurred\");\n    var details = _ajaxDetails(model, xhr, options);\n    return errorModal(message, title, details);\n}\n\n/** build details which may help debugging the ajax call */\nfunction _ajaxDetails(model, xhr, options) {\n    return {\n        //TODO: still can't manage Raven id\n        raven: _.result(window.Raven, \"lastEventId\"),\n        userAgent: navigator.userAgent,\n        onLine: navigator.onLine,\n        version: _.result(Galaxy.config, \"version_major\"),\n        xhr: _.omit(xhr, _.functions(xhr)),\n        options: _.omit(options, \"xhr\"),\n        // add ajax data from Galaxy object cache\n        url: _.result(Galaxy.lastAjax, \"url\"),\n        data: _.result(Galaxy.lastAjax, \"data\"),\n        // backbone stuff (auto-redacting email for user)\n        model: _.result(model, \"toJSON\", \"\" + model),\n        user: _.omit(_.result(Galaxy.user, \"toJSON\"), \"email\")\n    };\n}\n\n//=============================================================================\nexports.default = {\n    errorModal: errorModal,\n    offlineErrorModal: offlineErrorModal,\n    badGatewayErrorModal: badGatewayErrorModal,\n    ajaxErrorModal: ajaxErrorModal\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 127 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _underscore = __webpack_require__(1);\n\nvar _ = _interopRequireWildcard(_underscore);\n\nvar _backbone = __webpack_require__(2);\n\nvar Backbone = _interopRequireWildcard(_backbone);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n//=============================================================================\n/**\n * A Collection that can be limited/offset/re-ordered/filtered.\n * @type {Backbone.Collection}\n */\nvar ControlledFetchCollection = Backbone.Collection.extend({\n    /** call setOrder on initialization to build the comparator based on options */\n    initialize: function initialize(models, options) {\n        Backbone.Collection.prototype.initialize.call(this, models, options);\n        this.setOrder(options.order || this.order, { silent: true });\n    },\n\n    /** set up to track order changes and re-sort when changed */\n    _setUpListeners: function _setUpListeners() {\n        return this.on({\n            \"changed-order\": this.sort\n        });\n    },\n\n    /** override to provide order and offsets based on instance vars, set limit if passed,\n     *  and set allFetched/fire 'all-fetched' when xhr returns\n     */\n    fetch: function fetch(options) {\n        options = this._buildFetchOptions(options);\n        Galaxy.debug(\"fetch options:\", options);\n        return Backbone.Collection.prototype.fetch.call(this, options);\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function _buildFetchOptions(options) {\n        // note: we normally want options passed in to override the defaults built here\n        // so most of these fns will generate defaults\n        options = _.clone(options) || {};\n        var self = this;\n\n        // jquery ajax option; allows multiple q/qv for filters (instead of 'q[]')\n        options.traditional = true;\n\n        // options.data\n        // we keep limit, offset, etc. in options *as well as move it into data* because:\n        // - it makes fetch calling convenient to add it to a single options map (instead of as mult. args)\n        // - it allows the std. event handlers (for fetch, etc.) to have access\n        //   to the pagination options too\n        //      (i.e. this.on( 'sync', function( options ){ if( options.limit ){ ... } }))\n        // however, when we send to xhr/jquery we copy them to data also so that they become API query params\n        options.data = options.data || self._buildFetchData(options);\n        Galaxy.debug(\"data:\", options.data);\n\n        // options.data.filters --> options.data.q, options.data.qv\n        var filters = this._buildFetchFilters(options);\n        Galaxy.debug(\"filters:\", filters);\n        if (!_.isEmpty(filters)) {\n            _.extend(options.data, this._fetchFiltersToAjaxData(filters));\n        }\n        Galaxy.debug(\"data:\", options.data);\n        return options;\n    },\n\n    /** Build the dictionary to send to fetch's XHR as data */\n    _buildFetchData: function _buildFetchData(options) {\n        var defaults = {};\n        if (this.order) {\n            defaults.order = this.order;\n        }\n        return _.defaults(_.pick(options, this._fetchParams), defaults);\n    },\n\n    /** These attribute keys are valid params to fetch/API-index */\n    _fetchParams: [\n    /** model dependent string to control the order of models returned */\n    \"order\",\n    /** limit the number of models returned from a fetch */\n    \"limit\",\n    /** skip this number of models when fetching */\n    \"offset\",\n    /** what series of attributes to return (model dependent) */\n    \"view\",\n    /** individual keys to return for the models (see api/histories.index) */\n    \"keys\"],\n\n    /** add any needed filters here based on collection state */\n    _buildFetchFilters: function _buildFetchFilters(options) {\n        // override\n        return _.clone(options.filters || {});\n    },\n\n    /** Convert dictionary filters to qqv style arrays */\n    _fetchFiltersToAjaxData: function _fetchFiltersToAjaxData(filters) {\n        // return as a map so ajax.data can extend from it\n        var filterMap = {\n            q: [],\n            qv: []\n        };\n        _.each(filters, function (v, k) {\n            // don't send if filter value is empty\n            if (v === undefined || v === \"\") {\n                return;\n            }\n            // json to python\n            if (v === true) {\n                v = \"True\";\n            }\n            if (v === false) {\n                v = \"False\";\n            }\n            if (v === null) {\n                v = \"None\";\n            }\n            // map to k/v arrays (q/qv)\n            filterMap.q.push(k);\n            filterMap.qv.push(v);\n        });\n        return filterMap;\n    },\n\n    /** override to reset allFetched flag to false */\n    reset: function reset(models, options) {\n        this.allFetched = false;\n        return Backbone.Collection.prototype.reset.call(this, models, options);\n    },\n\n    // ........................................................................ order\n    order: null,\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: {\n        update_time: _baseMvc2.default.buildComparator(\"update_time\", {\n            ascending: false\n        }),\n        \"update_time-asc\": _baseMvc2.default.buildComparator(\"update_time\", {\n            ascending: true\n        }),\n        create_time: _baseMvc2.default.buildComparator(\"create_time\", {\n            ascending: false\n        }),\n        \"create_time-asc\": _baseMvc2.default.buildComparator(\"create_time\", {\n            ascending: true\n        })\n    },\n\n    /** set the order and comparator for this collection then sort with the new order\n     *  @event 'changed-order' passed the new order and the collection\n     */\n    setOrder: function setOrder(order, options) {\n        options = options || {};\n        var collection = this;\n        var comparator = collection.comparators[order];\n        if (_.isUndefined(comparator)) {\n            throw new Error(\"unknown order: \" + order);\n        }\n        // if( _.isUndefined( comparator ) ){ return; }\n        if (comparator === collection.comparator) {\n            return;\n        }\n\n        collection.order = order;\n        collection.comparator = comparator;\n\n        if (!options.silent) {\n            collection.trigger(\"changed-order\", options);\n        }\n        return collection;\n    }\n});\n\n//=============================================================================\n/**\n *\n */\nvar PaginatedCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for each page's fetch */\n    limitPerPage: 500,\n\n    initialize: function initialize(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        this.currentPage = options.currentPage || 0;\n    },\n\n    getTotalItemCount: function getTotalItemCount() {\n        return this.length;\n    },\n\n    shouldPaginate: function shouldPaginate() {\n        return this.getTotalItemCount() >= this.limitPerPage;\n    },\n\n    getLastPage: function getLastPage() {\n        return Math.floor(this.getTotalItemCount() / this.limitPerPage);\n    },\n\n    getPageCount: function getPageCount() {\n        return this.getLastPage() + 1;\n    },\n\n    getPageLimitOffset: function getPageLimitOffset(pageNum) {\n        pageNum = this.constrainPageNum(pageNum);\n        return {\n            limit: this.limitPerPage,\n            offset: pageNum * this.limitPerPage\n        };\n    },\n\n    constrainPageNum: function constrainPageNum(pageNum) {\n        return Math.max(0, Math.min(pageNum, this.getLastPage()));\n    },\n\n    /** fetch the next page of data */\n    fetchPage: function fetchPage(pageNum, options) {\n        var self = this;\n        pageNum = self.constrainPageNum(pageNum);\n        self.currentPage = pageNum;\n        options = _.defaults(options || {}, self.getPageLimitOffset(pageNum));\n\n        self.trigger(\"fetching-more\");\n        return self.fetch(options).always(function () {\n            self.trigger(\"fetching-more-done\");\n        });\n    },\n\n    fetchCurrentPage: function fetchCurrentPage(options) {\n        return this.fetchPage(this.currentPage, options);\n    },\n\n    fetchPrevPage: function fetchPrevPage(options) {\n        return this.fetchPage(this.currentPage - 1, options);\n    },\n\n    fetchNextPage: function fetchNextPage(options) {\n        return this.fetchPage(this.currentPage + 1, options);\n    }\n});\n\n//=============================================================================\n/**\n * A Collection that will load more elements without reseting.\n */\nvar InfinitelyScrollingCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: null,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 100,\n\n    initialize: function initialize(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        /** @type {Integer} number of contents to return from the first fetch */\n        this.limitOnFirstFetch = options.limitOnFirstFetch || this.limitOnFirstFetch;\n        /** @type {Integer} limit for every fetch after the first */\n        this.limitPerFetch = options.limitPerFetch || this.limitPerFetch;\n        /** @type {Boolean} are all contents fetched? */\n        this.allFetched = false;\n        /** @type {Integer} what was the offset of the last content returned */\n        this.lastFetched = options.lastFetched || 0;\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function _buildFetchOptions(options) {\n        // options (options for backbone.fetch and jquery.ajax generally)\n        // backbone option; false here to make fetching an addititive process\n        options.remove = options.remove || false;\n        return ControlledFetchCollection.prototype._buildFetchOptions.call(this, options);\n    },\n\n    /** fetch the first 'page' of data */\n    fetchFirst: function fetchFirst(options) {\n        Galaxy.debug(\"ControlledFetchCollection.fetchFirst:\", options);\n        options = options ? _.clone(options) : {};\n        this.allFetched = false;\n        this.lastFetched = 0;\n        return this.fetchMore(_.defaults(options, {\n            reset: true,\n            limit: this.limitOnFirstFetch\n        }));\n    },\n\n    /** fetch the next page of data */\n    fetchMore: function fetchMore(options) {\n        Galaxy.debug(\"ControlledFetchCollection.fetchMore:\", options);\n        options = _.clone(options || {});\n        var collection = this;\n\n        Galaxy.debug(\"fetchMore, options.reset:\", options.reset);\n        if (!options.reset && collection.allFetched) {\n            return jQuery.when();\n        }\n\n        // TODO: this fails in the edge case where\n        //  the first fetch offset === limit (limit 4, offset 4, collection.length 4)\n        if (options.reset) {\n            options.offset = 0;\n        } else if (options.offset === undefined) {\n            options.offset = collection.lastFetched;\n        }\n        var limit = options.limit = options.limit || collection.limitPerFetch || null;\n        Galaxy.debug(\"fetchMore, limit:\", limit, \"offset:\", options.offset);\n\n        collection.trigger(\"fetching-more\");\n        return collection.fetch(options).always(function () {\n            collection.trigger(\"fetching-more-done\");\n        })\n        // maintain allFetched flag and trigger if all were fetched this time\n        .done(function _postFetchMore(fetchedData) {\n            var numFetched = _.isArray(fetchedData) ? fetchedData.length : 0;\n            collection.lastFetched += numFetched;\n            Galaxy.debug(\"fetchMore, lastFetched:\", collection.lastFetched);\n            // anything less than a full page means we got all there is to get\n            if (!limit || numFetched < limit) {\n                collection.allFetched = true;\n                collection.trigger(\"all-fetched\", this);\n            }\n        });\n    },\n\n    /** fetch all the collection */\n    fetchAll: function fetchAll(options) {\n        // whitelist options to prevent allowing limit/offset/filters\n        // (use vanilla fetch instead)\n        options = options || {};\n        var self = this;\n        options = _.pick(options, \"silent\");\n        options.filters = {};\n        return self.fetch(options).done(function () {\n            self.allFetched = true;\n            self.trigger(\"all-fetched\", self);\n        });\n    }\n});\n\n//==============================================================================\nexports.default = {\n    ControlledFetchCollection: ControlledFetchCollection,\n    PaginatedCollection: PaginatedCollection,\n    InfinitelyScrollingCollection: InfinitelyScrollingCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 128 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _datasetModel = __webpack_require__(119);\n\nvar _datasetModel2 = _interopRequireDefault(_datasetModel);\n\nvar _historyContentModel = __webpack_require__(120);\n\nvar _historyContentModel2 = _interopRequireDefault(_historyContentModel);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _datasetModel2.default.DatasetAssociation;\n\nvar hcontentMixin = _historyContentModel2.default.HistoryContentMixin;\n/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n */\nvar HistoryDatasetAssociation = _super.extend(_baseMvc2.default.mixin(hcontentMixin,\n/** @lends HistoryDatasetAssociation.prototype */{\n    /** default attributes for a model */\n    defaults: _.extend({}, _super.prototype.defaults, hcontentMixin.defaults, {\n        history_content_type: \"dataset\",\n        model_class: \"HistoryDatasetAssociation\"\n    })\n}));\n\n//==============================================================================\nexports.default = {\n    HistoryDatasetAssociation: HistoryDatasetAssociation\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 129 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listItem = __webpack_require__(85);\n\nvar _listItem2 = _interopRequireDefault(_listItem);\n\nvar _loadingIndicator = __webpack_require__(250);\n\nvar _loadingIndicator2 = _interopRequireDefault(_loadingIndicator);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(130);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"list\";\n/* ============================================================================\nTODO:\n\n============================================================================ */\n/** @class View for a list/collection of models and the sub-views of those models.\n *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n *      use ModelWithListPanel)\n *\n *  Allows for:\n *      searching collection/sub-views\n *      selecting/multi-selecting sub-views\n *\n *  Currently used:\n *      for dataset/dataset-choice\n *      as superclass of ModelListPanel\n */\nvar ListPanel = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(\n/** @lends ListPanel.prototype */{\n    _logNamespace: logNamespace,\n\n    /** class to use for constructing the sub-views */\n    viewClass: _listItem2.default.ListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass: Backbone.Collection,\n\n    tagName: \"div\",\n    className: \"list-panel\",\n\n    /** (in ms) that jquery effects will use */\n    fxSpeed: \"fast\",\n\n    /** string to display when the collection has no contents */\n    emptyMsg: (0, _localization2.default)(\"This list is empty\"),\n    /** displayed when no items match the search terms */\n    noneFoundMsg: (0, _localization2.default)(\"No matching items found\"),\n    /** string used for search placeholder */\n    searchPlaceholder: (0, _localization2.default)(\"search\"),\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the list\n     */\n    initialize: function initialize(attributes, options) {\n        attributes = attributes || {};\n        // set the logger if requested\n        if (attributes.logger) {\n            this.logger = attributes.logger;\n        }\n        this.log(this + \".initialize:\", attributes);\n\n        // ---- instance vars\n        /** how quickly should jquery fx run? */\n        this.fxSpeed = _.has(attributes, \"fxSpeed\") ? attributes.fxSpeed : this.fxSpeed;\n\n        /** filters for displaying subviews */\n        this.filters = [];\n        /** current search terms */\n        this.searchFor = attributes.searchFor || \"\";\n\n        /** loading indicator */\n        // this.indicator = new LoadingIndicator( this.$el );\n\n        /** currently showing selectors on items? */\n        this.selecting = attributes.selecting !== undefined ? attributes.selecting : true;\n        //this.selecting = false;\n\n        /** cached selected item.model.ids to persist btwn renders */\n        this.selected = attributes.selected || [];\n        /** the last selected item.model.id */\n        this.lastSelected = null;\n\n        /** are sub-views draggable */\n        this.dragItems = attributes.dragItems || false;\n\n        /** list item view class (when passed models) */\n        this.viewClass = attributes.viewClass || this.viewClass;\n\n        /** list item views */\n        this.views = [];\n        /** list item models */\n        this.collection = attributes.collection || this._createDefaultCollection();\n\n        /** filter fns run over collection items to see if they should show in the list */\n        this.filters = attributes.filters || [];\n\n        /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n        this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\n        /** @type {String} generic title */\n        this.title = attributes.title || \"\";\n        /** @type {String} generic subtitle */\n        this.subtitle = attributes.subtitle || \"\";\n\n        this._setUpListeners();\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** create any event listeners for the list */\n    _setUpListeners: function _setUpListeners() {\n        this.off();\n\n        //TODO: move errorHandler down into list-view from history-view or\n        //  pass to global error handler (Galaxy)\n        this.on({\n            error: function error(model, xhr, options, msg, details) {\n                //this.errorHandler( model, xhr, options, msg, details );\n                console.error(model, xhr, options, msg, details);\n            },\n            // show hide the loading indicator\n            loading: function loading() {\n                this._showLoadingIndicator(\"loading...\", 40);\n            },\n            \"loading-done\": function loadingDone() {\n                this._hideLoadingIndicator(40);\n            }\n        });\n\n        // throw the first render up as a diff namespace using once (for outside consumption)\n        this.once(\"rendered\", function () {\n            this.trigger(\"rendered:initial\", this);\n        });\n\n        this._setUpCollectionListeners();\n        this._setUpViewListeners();\n        return this;\n    },\n\n    /** create and return a collection for when none is initially passed */\n    _createDefaultCollection: function _createDefaultCollection() {\n        // override\n        return new this.collectionClass([]);\n    },\n\n    /** listening for collection events */\n    _setUpCollectionListeners: function _setUpCollectionListeners() {\n        this.log(this + \"._setUpCollectionListeners\", this.collection);\n        this.stopListening(this.collection);\n\n        // bubble up error events\n        this.listenTo(this.collection, {\n            error: function error(model, xhr, options, msg, details) {\n                this.trigger(\"error\", model, xhr, options, msg, details);\n            },\n            update: function update(collection, options) {\n                var changes = options.changes;\n                // console.info( collection + ', update:', changes, '\\noptions:', options );\n                // more than one: render everything\n                if (options.renderAll || changes.added.length + changes.removed.length > 1) {\n                    return this.renderItems();\n                }\n                // otherwise, let the single add/remove handlers do it\n                if (changes.added.length === 1) {\n                    return this.addItemView(_.first(changes.added), collection, options);\n                }\n                if (changes.removed.length === 1) {\n                    return this.removeItemView(_.first(changes.removed), collection, options);\n                }\n            }\n        });\n        return this;\n    },\n\n    /** listening for sub-view events that bubble up with the 'view:' prefix */\n    _setUpViewListeners: function _setUpViewListeners() {\n        this.log(this + \"._setUpViewListeners\");\n\n        // shift to select a range\n        this.on({\n            \"view:selected\": function viewSelected(view, ev) {\n                if (ev && ev.shiftKey && this.lastSelected) {\n                    var lastSelectedView = this.viewFromModelId(this.lastSelected);\n                    if (lastSelectedView) {\n                        this.selectRange(view, lastSelectedView);\n                    }\n                } else if (ev && ev.altKey && !this.selecting) {\n                    this.showSelectors();\n                }\n                this.selected.push(view.model.id);\n                this.lastSelected = view.model.id;\n            },\n\n            \"view:de-selected\": function viewDeSelected(view, ev) {\n                this.selected = _.without(this.selected, view.model.id);\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render: function render(speed) {\n        this.log(this + \".render\", speed);\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors($newRender);\n        this._queueNewRender($newRender, speed);\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el. */\n    _buildNewRender: function _buildNewRender() {\n        this.debug(this + \"(ListPanel)._buildNewRender\");\n        var $newRender = $(this.templates.el({}, this));\n        this._renderControls($newRender);\n        this._renderTitle($newRender);\n        this._renderSubtitle($newRender);\n        this._renderSearch($newRender);\n        this.renderItems($newRender);\n        return $newRender;\n    },\n\n    /** Build a temp div containing the new children for the view's $el. */\n    _renderControls: function _renderControls($newRender) {\n        this.debug(this + \"(ListPanel)._renderControls\");\n        var $controls = $(this.templates.controls({}, this));\n        $newRender.find(\".controls\").replaceWith($controls);\n        return $controls;\n    },\n\n    /** return a jQuery object containing the title DOM */\n    _renderTitle: function _renderTitle($where) {\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /** return a jQuery object containing the subtitle DOM (if any) */\n    _renderSubtitle: function _renderSubtitle($where) {\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender: function _queueNewRender($newRender, speed) {\n        speed = speed === undefined ? this.fxSpeed : speed;\n        var panel = this;\n        panel.log(\"_queueNewRender:\", $newRender, speed);\n\n        $(panel).queue(\"fx\", [function (next) {\n            panel.$el.fadeOut(speed, next);\n        }, function (next) {\n            panel._swapNewRender($newRender);\n            next();\n        }, function (next) {\n            panel.$el.fadeIn(speed, next);\n        }, function (next) {\n            panel.trigger(\"rendered\", panel);\n            next();\n        }]);\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender: function _swapNewRender($newRender) {\n        this.$el.empty().attr(\"class\", this.className).append($newRender.children());\n        if (this.selecting) {\n            this.showSelectors(0);\n        }\n        return this;\n    },\n\n    /** Set up any behaviors, handlers (ep. plugins) that need to be called when the entire view has been built but\n     *  not attached to the page yet.\n     */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        $where = $where || this.$el;\n        this.$controls($where).find(\"[title]\").tooltip();\n        // set up the pupup for actions available when multi selecting\n        this._renderMultiselectActionMenu($where);\n        return this;\n    },\n\n    /** render a menu containing the actions available to sets of selected items */\n    _renderMultiselectActionMenu: function _renderMultiselectActionMenu($where) {\n        $where = $where || this.$el;\n        var $menu = $where.find(\".list-action-menu\");\n        var actions = this.multiselectActions();\n        if (!actions.length) {\n            return $menu.empty();\n        }\n\n        var $newMenu = $(['<div class=\"list-action-menu btn-group\">', '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', (0, _localization2.default)(\"For all selected\"), \"...\", \"</button>\", '<ul class=\"dropdown-menu pull-right\" role=\"menu\">', \"</ul>\", \"</div>\"].join(\"\"));\n        var $actions = actions.map(function (action) {\n            var html = ['<li><a href=\"javascript:void(0);\">', action.html, \"</a></li>\"].join(\"\");\n            return $(html).click(function (ev) {\n                ev.preventDefault();\n                return action.func(ev);\n            });\n        });\n        $newMenu.find(\"ul\").append($actions);\n        $menu.replaceWith($newMenu);\n        return $newMenu;\n    },\n\n    /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n     *      html: an html string used as the anchor contents\n     *      func: a function called when the anchor is clicked (passed the click event)\n     */\n    multiselectActions: function multiselectActions() {\n        return [];\n    },\n\n    // ------------------------------------------------------------------------ sub-$element shortcuts\n    /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n    $scrollContainer: function $scrollContainer($where) {\n        // override or set via attributes.$scrollContainer\n        return ($where || this.$el).parent().parent();\n    },\n    /** convenience selector for the section that displays the list controls */\n    $controls: function $controls($where) {\n        return ($where || this.$el).find(\"> .controls\");\n    },\n    /** list-items: where the subviews are contained in the view's dom */\n    $list: function $list($where) {\n        return ($where || this.$el).find(\"> .list-items\");\n    },\n    /** container where list messages are attached */\n    $messages: function $messages($where) {\n        //TODO: controls isn't really correct here (only for ModelListPanel)\n        return ($where || this.$el).find(\"> .controls .messages\");\n    },\n    /** the message displayed when no views can be shown (no views, none matching search) */\n    $emptyMessage: function $emptyMessage($where) {\n        return ($where || this.$el).find(\"> .empty-message\");\n    },\n\n    // ------------------------------------------------------------------------ hda sub-views\n    /** render the subviews for the list's collection */\n    renderItems: function renderItems($whereTo) {\n        $whereTo = $whereTo || this.$el;\n        var panel = this;\n        panel.log(this + \".renderItems\", $whereTo);\n\n        var $list = panel.$list($whereTo);\n        panel.freeViews();\n        // console.log( 'views freed' );\n        //TODO:? cache and re-use views?\n        var shownModels = panel._filterCollection();\n        // console.log( 'models filtered:', shownModels );\n\n        panel.views = shownModels.map(function (itemModel) {\n            var view = panel._createItemView(itemModel);\n            return view;\n        });\n\n        $list.empty();\n        // console.log( 'list emptied' );\n        if (panel.views.length) {\n            panel._attachItems($whereTo);\n            // console.log( 'items attached' );\n        }\n        panel._renderEmptyMessage($whereTo).toggle(!panel.views.length);\n        panel.trigger(\"views:ready\", panel.views);\n\n        // console.log( '------------------------------------------- rendering items' );\n        return panel.views;\n    },\n\n    /** Filter the collection to only those models that should be currently viewed */\n    _filterCollection: function _filterCollection() {\n        // override this\n        var panel = this;\n        return panel.collection.filter(_.bind(panel._filterItem, panel));\n    },\n\n    /** Should the model be viewable in the current state?\n     *     Checks against this.filters and this.searchFor\n     */\n    _filterItem: function _filterItem(model) {\n        // override this\n        var panel = this;\n        return _.every(panel.filters.map(function (fn) {\n            return fn.call(model);\n        })) && (!panel.searchFor || model.matchesAll(panel.searchFor));\n    },\n\n    /** Create a view for a model and set up it's listeners */\n    _createItemView: function _createItemView(model) {\n        var ViewClass = this._getItemViewClass(model);\n        var options = _.extend(this._getItemViewOptions(model), {\n            model: model\n        });\n        var view = new ViewClass(options);\n        this._setUpItemViewListeners(view);\n        return view;\n    },\n\n    /** Free a view for a model. Note: does not remove it from the DOM */\n    _destroyItemView: function _destroyItemView(view) {\n        this.stopListening(view);\n        this.views = _.without(this.views, view);\n    },\n\n    _destroyItemViews: function _destroyItemViews(view) {\n        var self = this;\n        self.views.forEach(function (v) {\n            self.stopListening(v);\n        });\n        self.views = [];\n        return self;\n    },\n\n    /** free any sub-views the list has */\n    freeViews: function freeViews() {\n        return this._destroyItemViews();\n    },\n\n    /** Get the bbone view class based on the model */\n    _getItemViewClass: function _getItemViewClass(model) {\n        // override this\n        return this.viewClass;\n    },\n\n    /** Get the options passed to the new view based on the model */\n    _getItemViewOptions: function _getItemViewOptions(model) {\n        // override this\n        return {\n            //logger      : this.logger,\n            fxSpeed: this.fxSpeed,\n            expanded: false,\n            selectable: this.selecting,\n            selected: _.contains(this.selected, model.id),\n            draggable: this.dragItems\n        };\n    },\n\n    /** Set up listeners for new models */\n    _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n        var panel = this;\n        // send all events to the panel, re-namspaceing them with the view prefix\n        this.listenTo(view, \"all\", function () {\n            var args = Array.prototype.slice.call(arguments, 0);\n            args[0] = \"view:\" + args[0];\n            panel.trigger.apply(panel, args);\n        });\n\n        // drag multiple - hijack ev.setData to add all selected items\n        this.listenTo(view, \"draggable:dragstart\", function (ev, v) {\n            //TODO: set multiple drag data here\n            var json = {};\n\n            var selected = this.getSelectedModels();\n            if (selected.length) {\n                json = selected.toJSON();\n            } else {\n                json = [v.model.toJSON()];\n            }\n            ev.dataTransfer.setData(\"text\", JSON.stringify(json));\n            //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n        }, this);\n\n        return panel;\n    },\n\n    /** Attach views in this.views to the model based on $whereTo */\n    _attachItems: function _attachItems($whereTo) {\n        var self = this;\n        // console.log( '_attachItems:', $whereTo, this.$list( $whereTo ) );\n        //ASSUMES: $list has been emptied\n        this.$list($whereTo).append(this.views.map(function (view) {\n            return self._renderItemView$el(view);\n        }));\n        return this;\n    },\n\n    /** get a given subview's $el (or whatever may wrap it) and return it */\n    _renderItemView$el: function _renderItemView$el(view) {\n        // useful to wrap and override\n        return view.render(0).$el;\n    },\n\n    /** render the empty/none-found message */\n    _renderEmptyMessage: function _renderEmptyMessage($whereTo) {\n        this.debug(\"_renderEmptyMessage\", $whereTo, this.searchFor);\n        var text = this.searchFor ? this.noneFoundMsg : this.emptyMsg;\n        return this.$emptyMessage($whereTo).text(text);\n    },\n\n    /** expand all item views */\n    expandAll: function expandAll() {\n        _.each(this.views, function (view) {\n            view.expand();\n        });\n    },\n\n    /** collapse all item views */\n    collapseAll: function collapseAll() {\n        _.each(this.views, function (view) {\n            view.collapse();\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection/views syncing\n    /** Add a view (if the model should be viewable) to the panel */\n    addItemView: function addItemView(model, collection, options) {\n        // console.log( this + '.addItemView:', model );\n        var panel = this;\n        // get the index of the model in the list of filtered models shown by this list\n        // in order to insert the view in the proper place\n        //TODO:? potentially expensive\n        var modelIndex = panel._filterCollection().indexOf(model);\n        if (modelIndex === -1) {\n            return undefined;\n        }\n        var view = panel._createItemView(model);\n        // console.log( 'adding and rendering:', modelIndex, view.toString() );\n\n        $(view).queue(\"fx\", [function (next) {\n            // hide the empty message first if only view\n            if (panel.$emptyMessage().is(\":visible\")) {\n                panel.$emptyMessage().fadeOut(panel.fxSpeed, next);\n            } else {\n                next();\n            }\n        }, function (next) {\n            panel._attachView(view, modelIndex);\n            next();\n        }]);\n        return view;\n    },\n\n    /** internal fn to add view (to both panel.views and panel.$list) */\n    _attachView: function _attachView(view, modelIndex, useFx) {\n        // console.log( this + '._attachView:', view, modelIndex, useFx );\n        useFx = _.isUndefined(useFx) ? true : useFx;\n        modelIndex = modelIndex || 0;\n        var panel = this;\n\n        // use the modelIndex to splice into views and insert at the proper index in the DOM\n        panel.views.splice(modelIndex, 0, view);\n        panel._insertIntoListAt(modelIndex, panel._renderItemView$el(view).hide());\n\n        panel.trigger(\"view:attached\", view);\n        if (useFx) {\n            view.$el.slideDown(panel.fxSpeed, function () {\n                panel.trigger(\"view:attached:rendered\");\n            });\n        } else {\n            view.$el.show();\n            panel.trigger(\"view:attached:rendered\");\n        }\n        return view;\n    },\n\n    /** insert a jq object as a child of list-items at the specified *DOM index* */\n    _insertIntoListAt: function _insertIntoListAt(index, $what) {\n        // console.log( this + '._insertIntoListAt:', index, $what );\n        var $list = this.$list();\n        if (index === 0) {\n            $list.prepend($what);\n        } else {\n            $list.children().eq(index - 1).after($what);\n        }\n        return $what;\n    },\n\n    /** Remove a view from the panel (if found) */\n    removeItemView: function removeItemView(model, collection, options) {\n        var panel = this;\n        var view = _.find(panel.views, function (v) {\n            return v.model === model;\n        });\n        if (!view) {\n            return undefined;\n        }\n        panel.views = _.without(panel.views, view);\n        panel.trigger(\"view:removed\", view);\n\n        // potentially show the empty message if no views left\n        // use anonymous queue here - since remove can happen multiple times\n        $({}).queue(\"fx\", [function (next) {\n            view.$el.fadeOut(panel.fxSpeed, next);\n        }, function (next) {\n            view.remove();\n            panel.trigger(\"view:removed:rendered\");\n            if (!panel.views.length) {\n                panel._renderEmptyMessage().fadeIn(panel.fxSpeed, next);\n            } else {\n                next();\n            }\n        }]);\n        return view;\n    },\n\n    /** get views based on model.id */\n    viewFromModelId: function viewFromModelId(id) {\n        return _.find(this.views, function (v) {\n            return v.model.id === id;\n        });\n    },\n\n    /** get views based on model */\n    viewFromModel: function viewFromModel(model) {\n        return model ? this.viewFromModelId(model.id) : undefined;\n    },\n\n    /** get views based on model properties */\n    viewsWhereModel: function viewsWhereModel(properties) {\n        return this.views.filter(function (view) {\n            return _.isMatch(view.model.attributes, properties);\n        });\n    },\n\n    /** A range of views between (and including) viewA and viewB */\n    viewRange: function viewRange(viewA, viewB) {\n        if (viewA === viewB) {\n            return viewA ? [viewA] : [];\n        }\n\n        var indexA = this.views.indexOf(viewA);\n        var indexB = this.views.indexOf(viewB);\n\n        // handle not found\n        if (indexA === -1 || indexB === -1) {\n            if (indexA === indexB) {\n                return [];\n            }\n            return indexA === -1 ? [viewB] : [viewA];\n        }\n        // reverse if indeces are\n        //note: end inclusive\n        return indexA < indexB ? this.views.slice(indexA, indexB + 1) : this.views.slice(indexB, indexA + 1);\n    },\n\n    // ------------------------------------------------------------------------ searching\n    /** render a search input for filtering datasets shown\n     *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n     *      return will start the search\n     *      esc will clear the search\n     *      clicking the clear button will clear the search\n     *      uses searchInput in ui.js\n     */\n    _renderSearch: function _renderSearch($where) {\n        $where.find(\".controls .search-input\").searchInput({\n            placeholder: this.searchPlaceholder,\n            initialVal: this.searchFor,\n            onfirstsearch: _.bind(this._firstSearch, this),\n            onsearch: _.bind(this.searchItems, this),\n            onclear: _.bind(this.clearSearch, this)\n        });\n        return $where;\n    },\n\n    /** What to do on the first search entered */\n    _firstSearch: function _firstSearch(searchFor) {\n        // override to load model details if necc.\n        this.log(\"onFirstSearch\", searchFor);\n        return this.searchItems(searchFor);\n    },\n\n    /** filter view list to those that contain the searchFor terms */\n    searchItems: function searchItems(searchFor, force) {\n        this.log(\"searchItems\", searchFor, this.searchFor, force);\n        if (!force && this.searchFor === searchFor) {\n            return this;\n        }\n        this.searchFor = searchFor;\n        this.renderItems();\n        this.trigger(\"search:searching\", searchFor, this);\n        var $search = this.$(\"> .controls .search-query\");\n        if ($search.val() !== searchFor) {\n            $search.val(searchFor);\n        }\n        return this;\n    },\n\n    /** clear the search filters and show all views that are normally shown */\n    clearSearch: function clearSearch(searchFor) {\n        //this.log( 'onSearchClear', this );\n        this.searchFor = \"\";\n        this.trigger(\"search:clear\", this);\n        this.$(\"> .controls .search-query\").val(\"\");\n        this.renderItems();\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** @type Integer when the number of list item views is >= to this, don't animate selectors */\n    THROTTLE_SELECTOR_FX_AT: 20,\n\n    /** show selectors on all visible itemViews and associated controls */\n    showSelectors: function showSelectors(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        this.selecting = true;\n        this.$(\".list-actions\").slideDown(speed);\n        speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n        _.each(this.views, function (view) {\n            view.showSelector(speed);\n        });\n        //this.selected = [];\n        //this.lastSelected = null;\n    },\n\n    /** hide selectors on all visible itemViews and associated controls */\n    hideSelectors: function hideSelectors(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        this.selecting = false;\n        this.$(\".list-actions\").slideUp(speed);\n        speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n        _.each(this.views, function (view) {\n            view.hideSelector(speed);\n        });\n        this.selected = [];\n        this.lastSelected = null;\n    },\n\n    /** show or hide selectors on all visible itemViews and associated controls */\n    toggleSelectors: function toggleSelectors() {\n        if (!this.selecting) {\n            this.showSelectors();\n        } else {\n            this.hideSelectors();\n        }\n    },\n\n    /** select all visible items */\n    selectAll: function selectAll(event) {\n        _.each(this.views, function (view) {\n            view.select(event);\n        });\n    },\n\n    /** deselect all visible items */\n    deselectAll: function deselectAll(event) {\n        this.lastSelected = null;\n        _.each(this.views, function (view) {\n            view.deselect(event);\n        });\n    },\n\n    /** select a range of datasets between A and B */\n    selectRange: function selectRange(viewA, viewB) {\n        var range = this.viewRange(viewA, viewB);\n        _.each(range, function (view) {\n            view.select();\n        });\n        return range;\n    },\n\n    /** return an array of all currently selected itemViews */\n    getSelectedViews: function getSelectedViews() {\n        return _.filter(this.views, function (v) {\n            return v.selected;\n        });\n    },\n\n    /** return a collection of the models of all currenly selected items */\n    getSelectedModels: function getSelectedModels() {\n        // console.log( '(getSelectedModels)' );\n        return new this.collection.constructor(_.map(this.getSelectedViews(), function (view) {\n            return view.model;\n        }));\n    },\n\n    // ------------------------------------------------------------------------ loading indicator\n    /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n    _showLoadingIndicator: function _showLoadingIndicator(msg, speed, callback) {\n        this.debug(\"_showLoadingIndicator\", this.indicator, msg, speed, callback);\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        if (!this.indicator) {\n            this.indicator = new _loadingIndicator2.default(this.$el);\n            this.debug(\"\\t created\", this.indicator);\n        }\n        if (!this.$el.is(\":visible\")) {\n            this.indicator.show(0, callback);\n        } else {\n            this.$el.fadeOut(speed);\n            this.indicator.show(msg, speed, callback);\n        }\n    },\n\n    /** hide the loading indicator */\n    _hideLoadingIndicator: function _hideLoadingIndicator(speed, callback) {\n        this.debug(\"_hideLoadingIndicator\", this.indicator, speed, callback);\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        if (this.indicator) {\n            this.indicator.hide(speed, callback);\n        }\n    },\n\n    // ------------------------------------------------------------------------ scrolling\n    /** get the current scroll position of the panel in its parent */\n    scrollPosition: function scrollPosition() {\n        return this.$scrollContainer().scrollTop();\n    },\n\n    /** set the current scroll position of the panel in its parent */\n    scrollTo: function scrollTo(pos, speed) {\n        speed = speed || 0;\n        this.$scrollContainer().animate({ scrollTop: pos }, speed);\n        return this;\n    },\n\n    /** Scrolls the panel to the top. */\n    scrollToTop: function scrollToTop(speed) {\n        return this.scrollTo(0, speed);\n    },\n\n    /** scroll to the given view in list-items */\n    scrollToItem: function scrollToItem(view, speed) {\n        if (!view) {\n            return this;\n        }\n        return this;\n    },\n\n    /** Scrolls the panel to show the content with the given id. */\n    scrollToId: function scrollToId(id, speed) {\n        return this.scrollToItem(this.viewFromModelId(id), speed);\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events: {\n        \"click .select-all\": \"selectAll\",\n        \"click .deselect-all\": \"deselectAll\"\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString: function toString() {\n        return \"ListPanel(\" + this.collection + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListPanel.prototype.templates = function () {\n    var elTemplate = _baseMvc2.default.wrapTemplate([\n    // temp container\n    \"<div>\", '<div class=\"controls\"></div>', '<div class=\"list-items\"></div>', '<div class=\"empty-message infomessagesmall\"></div>', \"</div>\"]);\n\n    var controlsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">', '<div class=\"name\"><%- view.title %></div>', \"</div>\", '<div class=\"subtitle\"><%- view.subtitle %></div>',\n    // buttons, controls go here\n    '<div class=\"actions\"></div>',\n    // deleted msg, etc.\n    '<div class=\"messages\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', \"</div>\",\n\n    // show when selectors are shown\n    '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"All\"), \"</button>\", '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"None\"), \"</button>\", \"</div>\", '<div class=\"list-action-menu btn-group\">', \"</div>\", \"</div>\", \"</div>\"]);\n\n    return {\n        el: elTemplate,\n        controls: controlsTemplate\n    };\n}();\n\n//=============================================================================\n/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n *  Allows:\n *      the model to be reset\n *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n *\n */\nvar ModelListPanel = ListPanel.extend({\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey: \"contents\",\n\n    initialize: function initialize(attributes) {\n        ListPanel.prototype.initialize.call(this, attributes);\n        this.selecting = attributes.selecting !== undefined ? attributes.selecting : false;\n\n        this.setModel(this.model, attributes);\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel: function setModel(model, attributes) {\n        attributes = attributes || {};\n        this.debug(this + \".setModel:\", model, attributes);\n\n        this.freeModel();\n        this.freeViews();\n\n        if (model) {\n            var oldModelId = this.model ? this.model.get(\"id\") : null;\n\n            // set up the new model with user, logger, storage, events\n            this.model = model;\n            if (this.logger) {\n                this.model.logger = this.logger;\n            }\n            this._setUpModelListeners();\n\n            //TODO: relation btwn model, collection becoming tangled here\n            // free the collection, and assign the new collection to either\n            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n            this.stopListening(this.collection);\n            this.collection = this.model[this.modelCollectionKey] || attributes.collection || this._createDefaultCollection();\n            this._setUpCollectionListeners();\n\n            if (oldModelId && model.get(\"id\") !== oldModelId) {\n                this.trigger(\"new-model\", this);\n            }\n        }\n        return this;\n    },\n\n    /** free the current model and all listeners for it, free any views for the model */\n    freeModel: function freeModel() {\n        // stop/release the previous model, and clear cache to sub-views\n        if (this.model) {\n            this.stopListening(this.model);\n            //TODO: see base-mvc\n            //this.model.free();\n            //this.model = null;\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listening\n    /** listening for model events */\n    _setUpModelListeners: function _setUpModelListeners() {\n        // override\n        this.log(this + \"._setUpModelListeners\", this.model);\n        // bounce model errors up to the panel\n        this.listenTo(this.model, \"error\", function () {\n            var args = Array.prototype.slice.call(arguments, 0);\n            //args.unshift( 'model:error' );\n            args.unshift(\"error\");\n            this.trigger.apply(this, args);\n        }, this);\n\n        // debugging\n        if (this.logger) {\n            this.listenTo(this.model, \"all\", function (event) {\n                this.info(this + \"(model)\", event, arguments);\n            });\n        }\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls: function _renderControls($newRender) {\n        this.debug(this + \"(ModelListPanel)._renderControls\");\n        var json = this.model ? this.model.toJSON() : {};\n        var $controls = $(this.templates.controls(json, this));\n        $newRender.find(\".controls\").replaceWith($controls);\n        return $controls;\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString: function toString() {\n        return \"ModelListPanel(\" + this.model + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nModelListPanel.prototype.templates = function () {\n    var controlsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">',\n    //TODO: this is really the only difference - consider factoring titlebar out\n    '<div class=\"name\"><%- model.name %></div>', \"</div>\", '<div class=\"subtitle\"><%- view.subtitle %></div>', '<div class=\"actions\"></div>', '<div class=\"messages\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', \"</div>\", '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"All\"), \"</button>\", '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"None\"), \"</button>\", \"</div>\", '<div class=\"list-action-menu btn-group\">', \"</div>\", \"</div>\", \"</div>\"]);\n\n    return _.extend(_.clone(ListPanel.prototype.templates), {\n        controls: controlsTemplate\n    });\n}();\n\n//=============================================================================\nexports.default = {\n    ListPanel: ListPanel,\n    ModelListPanel: ModelListPanel\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 130 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\"use_strict\";\n\nvar $ = _jquery2.default;\nvar _l = window._l || function (s) {\n    return s;\n};\n\n//TODO: consolidate with tool menu functionality, use there\n\n/** searchInput: (jQuery plugin)\n *      Creates a search input, a clear button, and loading indicator\n *      within the selected node.\n *\n *      When the user either presses return or enters some minimal number\n *      of characters, a callback is called. Pressing ESC when the input\n *      is focused will clear the input and call a separate callback.\n */\nfunction searchInput(parentNode, options) {\n    var KEYCODE_ESC = 27;\n    var KEYCODE_RETURN = 13;\n    var $parentNode = $(parentNode);\n    var firstSearch = true;\n\n    var defaults = {\n        initialVal: \"\",\n        name: \"search\",\n        placeholder: \"search\",\n        classes: \"\",\n        onclear: function onclear() {},\n        onfirstsearch: null,\n        onsearch: function onsearch(inputVal) {},\n        minSearchLen: 0,\n        escWillClear: true,\n        oninit: function oninit() {}\n    };\n\n    // .................................................................... input rendering and events\n    // visually clear the search, trigger an event, and call the callback\n    function clearSearchInput(event) {\n        var $input = $(this).parent().children(\"input\");\n        $input.val(\"\").trigger(\"searchInput.clear\").blur();\n        options.onclear();\n    }\n\n    // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n    function search(event, searchTerms) {\n        if (!searchTerms) {\n            return clearSearchInput();\n        }\n        $(this).trigger(\"search.search\", searchTerms);\n        if (typeof options.onfirstsearch === \"function\" && firstSearch) {\n            firstSearch = false;\n            options.onfirstsearch(searchTerms);\n        } else {\n            options.onsearch(searchTerms);\n        }\n    }\n\n    // .................................................................... input rendering and events\n    function inputTemplate() {\n        // class search-query is bootstrap 2.3 style that now lives in base.less\n        return ['<input type=\"text\" name=\"', options.name, '\" placeholder=\"', options.placeholder, '\" ', 'class=\"search-query ', options.classes, '\" ', \"/>\"].join(\"\");\n    }\n\n    // the search input that responds to keyboard events and displays the search value\n    function $input() {\n        return $(inputTemplate())\n        // select all text on a focus\n        .focus(function (event) {\n            $(this).select();\n        })\n        // attach behaviors to esc, return if desired, search on some min len string\n        .keyup(function (event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            // esc key will clear if desired\n            if (event.which === KEYCODE_ESC && options.escWillClear) {\n                clearSearchInput.call(this, event);\n            } else {\n                var searchTerms = $(this).val();\n                // return key or the search string len > minSearchLen (if not 0) triggers search\n                if (event.which === KEYCODE_RETURN || options.minSearchLen && searchTerms.length >= options.minSearchLen) {\n                    search.call(this, event, searchTerms);\n                }\n            }\n        }).val(options.initialVal);\n    }\n\n    // .................................................................... clear button rendering and events\n    // a button for clearing the search bar, placed on the right hand side\n    function $clearBtn() {\n        return $(['<span class=\"search-clear fa fa-times-circle\" ', 'title=\"', _l(\"clear search (esc)\"), '\"></span>'].join(\"\")).tooltip({ placement: \"bottom\" }).click(function (event) {\n            clearSearchInput.call(this, event);\n        });\n    }\n\n    // .................................................................... loadingIndicator rendering\n    // a button for clearing the search bar, placed on the right hand side\n    function $loadingIndicator() {\n        return $(['<span class=\"search-loading fa fa-spinner fa-spin\" ', 'title=\"', _l(\"loading...\"), '\"></span>'].join(\"\")).hide().tooltip({ placement: \"bottom\" });\n    }\n\n    // .................................................................... commands\n    // visually swap the load, clear buttons\n    function toggleLoadingIndicator() {\n        $parentNode.find(\".search-loading\").toggle();\n        $parentNode.find(\".search-clear\").toggle();\n    }\n\n    // .................................................................... init\n    // string command (not constructor)\n    if (_jquery2.default.type(options) === \"string\") {\n        if (options === \"toggle-loading\") {\n            toggleLoadingIndicator();\n        }\n        return $parentNode;\n    }\n\n    // initial render\n    if (_jquery2.default.type(options) === \"object\") {\n        options = _jquery2.default.extend(true, {}, defaults, options);\n    }\n    //NOTE: prepended\n    return $parentNode.addClass(\"search-input\").prepend([$input(), $clearBtn(), $loadingIndicator()]);\n}\n\n// as jq plugin\n_jquery2.default.fn.extend({\n    searchInput: function $searchInput(options) {\n        return this.each(function () {\n            return searchInput(this, options);\n        });\n    }\n});\n\n/***/ }),\n/* 131 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _datasetLi = __webpack_require__(86);\n\nvar _datasetLi2 = _interopRequireDefault(_datasetLi);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _historyItemLi = __webpack_require__(132);\n\nvar _historyItemLi2 = _interopRequireDefault(_historyItemLi);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _datasetLi2.default.DatasetListItemView;\n/** @class Read only view for HistoryDatasetAssociation.\n *      Since there are no controls on the HDAView to hide the dataset,\n *      the primary thing this class does (currently) is override templates\n *      to render the HID.\n */\nvar HDAListItemView = _super.extend(\n/** @lends HDAListItemView.prototype */{\n    className: _super.prototype.className + \" history-content\",\n\n    initialize: function initialize(attributes, options) {\n        _super.prototype.initialize.call(this, attributes, options);\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"HDAListItemView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemView.prototype.templates = function () {\n    var titleBarTemplate = function titleBarTemplate(dataset) {\n        return \"\\n        <div class=\\\"title-bar clear\\\" tabindex=\\\"0\\\">\\n            <span class=\\\"state-icon\\\"></span>\\n            <div class=\\\"title\\\">\\n                <span class=\\\"hid\\\">\" + dataset.hid + \"</span>\\n                <span class=\\\"name\\\">\" + _.escape(dataset.name) + \"</span>\\n            </div>\\n            </br>\\n            \" + _historyItemLi2.default.nametagTemplate(dataset) + \"\\n        </div>\\n    \";\n    };\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: _baseMvc2.default.wrapTemplate([\n        // add a warning when hidden\n        \"<% if( !dataset.visible ){ %>\", '<div class=\"hidden-msg warningmessagesmall\">', (0, _localization2.default)(\"This dataset has been hidden\"), \"</div>\", \"<% } %>\"], \"dataset\")\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        titleBar: titleBarTemplate,\n        warnings: warnings\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    HDAListItemView: HDAListItemView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 132 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nfunction _labelIfName(tag) {\n    if (tag.indexOf(\"name:\") == 0) {\n        return \"<span class=\\\"label label-info\\\">\" + _.escape(tag.slice(5)) + \"</span>\";\n    } else {\n        return \"\";\n    }\n}\n\nfunction nametagTemplate(historyItem) {\n    return \"<span class=\\\"nametags\\\">\" + _.sortBy(_.uniq(historyItem.tags)).map(_labelIfName).join(\"\") + \"</span>\";\n}\n\nexports.default = {\n    nametagTemplate: nametagTemplate\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 133 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _collectionLi = __webpack_require__(87);\n\nvar _collectionLi2 = _interopRequireDefault(_collectionLi);\n\nvar _collectionView = __webpack_require__(134);\n\nvar _collectionView2 = _interopRequireDefault(_collectionView);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _historyItemLi = __webpack_require__(132);\n\nvar _historyItemLi2 = _interopRequireDefault(_historyItemLi);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _collectionLi2.default.DCListItemView;\n/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n */\nvar HDCAListItemView = _super.extend(\n/** @lends HDCAListItemView.prototype */{\n    className: _super.prototype.className + \" history-content\",\n\n    /** event listeners */\n    _setUpListeners: function _setUpListeners() {\n        _super.prototype._setUpListeners.call(this);\n        this.listenTo(this.model, {\n            \"change:tags change:populated change:visible\": function changeTagsChangePopulatedChangeVisible(model, options) {\n                this.render();\n            }\n        });\n    },\n\n    /** Override to provide the proper collections panels as the foldout */\n    _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n        var collectionType = this.model.get(\"collection_type\");\n        switch (collectionType) {\n            case \"list\":\n                return _collectionView2.default.ListCollectionView;\n            case \"paired\":\n                return _collectionView2.default.PairCollectionView;\n            case \"list:paired\":\n                return _collectionView2.default.ListOfPairsCollectionView;\n            case \"list:list\":\n                return _collectionView2.default.ListOfListsCollectionView;\n        }\n        throw new TypeError(\"Unknown collection_type: \" + collectionType);\n    },\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender: function _swapNewRender($newRender) {\n        _super.prototype._swapNewRender.call(this, $newRender);\n        //TODO: model currently has no state\n        var state = !this.model.get(\"populated\") ? _states2.default.RUNNING : _states2.default.OK;\n        //if( this.model.has( 'state' ) ){\n        this.$el.addClass(\"state-\" + state);\n        //}\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"HDCAListItemView(\" + modelString + \")\";\n    }\n});\n\n/** underscore templates */\nHDCAListItemView.prototype.templates = function () {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: function hidden(collection) {\n            collection.visible ? \"\" : \"<div class=\\\"hidden-msg warningmessagesmall\\\">\" + (0, _localization2.default)(\"This collection has been hidden\") + \"</div>\";\n        }\n    });\n\n    // could steal this from hda-base (or use mixed content)\n    var titleBarTemplate = function titleBarTemplate(collection) {\n        return \"\\n        <div class=\\\"title-bar clear\\\" tabindex=\\\"0\\\">\\n            <span class=\\\"state-icon\\\"></span>\\n            <div class=\\\"title\\\">\\n                <span class=\\\"hid\\\">\" + collection.hid + \"</span>\\n                <span class=\\\"name\\\">\" + _.escape(collection.name) + \"</span>\\n            </div>\\n            <div class=\\\"subtitle\\\"></div>\\n            \" + _historyItemLi2.default.nametagTemplate(collection) + \"\\n        </div>\\n    \";\n    };\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    HDCAListItemView: HDCAListItemView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 134 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listView = __webpack_require__(129);\n\nvar _listView2 = _interopRequireDefault(_listView);\n\nvar _collectionModel = __webpack_require__(80);\n\nvar _collectionModel2 = _interopRequireDefault(_collectionModel);\n\nvar _collectionLi = __webpack_require__(87);\n\nvar _collectionLi2 = _interopRequireDefault(_collectionLi);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"collections\";\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class non-editable, read-only View/Controller for a dataset collection.\n */\nvar _super = _listView2.default.ModelListPanel;\nvar CollectionView = _super.extend(\n/** @lends CollectionView.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n    _logNamespace: logNamespace,\n\n    className: _super.prototype.className + \" dataset-collection-panel\",\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass: _collectionLi2.default.DatasetDCEListItemView,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLi2.default.NestedDCDCEListItemView,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey: \"elements\",\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize: function initialize(attributes) {\n        _super.prototype.initialize.call(this, attributes);\n        this.linkTarget = attributes.linkTarget || \"_blank\";\n\n        this.hasUser = attributes.hasUser;\n        /** A stack of panels that currently cover or hide this panel */\n        this.panelStack = [];\n        /** The text of the link to go back to the panel containing this one */\n        this.parentName = attributes.parentName;\n        /** foldout or drilldown */\n        this.foldoutStyle = attributes.foldoutStyle || \"foldout\";\n        this.downloadUrl = Galaxy.root + \"api/dataset_collections/\" + this.model.attributes.id + \"/download\";\n    },\n\n    _queueNewRender: function _queueNewRender($newRender, speed) {\n        speed = speed === undefined ? this.fxSpeed : speed;\n        var panel = this;\n        panel.log(\"_queueNewRender:\", $newRender, speed);\n\n        // TODO: jquery@1.12 doesn't change display when the elem has display: flex\n        // this causes display: block for those elems after the use of show/hide animations\n        // animations are removed from this view for now until fixed\n        panel._swapNewRender($newRender);\n        panel.trigger(\"rendered\", panel);\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, use model.getVisibleContents */\n    _filterCollection: function _filterCollection() {\n        //TODO: should *not* be model.getVisibleContents - visibility is not model related\n        return this.model.getVisibleContents();\n    },\n\n    /** override to return proper view class based on element_type */\n    _getItemViewClass: function _getItemViewClass(model) {\n        //this.debug( this + '._getItemViewClass:', model );\n        //TODO: subclasses use DCEViewClass - but are currently unused - decide\n        switch (model.get(\"element_type\")) {\n            case \"hda\":\n                return this.DatasetDCEViewClass;\n            case \"dataset_collection\":\n                return this.NestedDCDCEViewClass;\n        }\n        throw new TypeError(\"Unknown element type:\", model.get(\"element_type\"));\n    },\n\n    /** override to add link target and anon */\n    _getItemViewOptions: function _getItemViewOptions(model) {\n        var options = _super.prototype._getItemViewOptions.call(this, model);\n        return _.extend(options, {\n            linkTarget: this.linkTarget,\n            hasUser: this.hasUser,\n            //TODO: could move to only nested: list:paired\n            foldoutStyle: this.foldoutStyle\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection sub-views\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call(panel, view);\n\n        // use pub-sub to: handle drilldown expansion and collapse\n        panel.listenTo(view, {\n            \"expanded:drilldown\": function expandedDrilldown(v, drilldown) {\n                this._expandDrilldownPanel(drilldown);\n            },\n            \"collapsed:drilldown\": function collapsedDrilldown(v, drilldown) {\n                this._collapseDrilldownPanel(drilldown);\n            }\n        });\n        return this;\n    },\n\n    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n    _expandDrilldownPanel: function _expandDrilldownPanel(drilldown) {\n        this.panelStack.push(drilldown);\n        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n        this.$(\"> .controls\").add(this.$list()).hide();\n        drilldown.parentName = this.model.get(\"name\");\n        this.$el.append(drilldown.render().$el);\n    },\n\n    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n    _collapseDrilldownPanel: function _collapseDrilldownPanel(drilldown) {\n        this.panelStack.pop();\n        this.render();\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events: {\n        \"click .navigation .back\": \"close\"\n    },\n\n    /** close/remove this collection panel */\n    close: function close(event) {\n        this.remove();\n        this.trigger(\"close\");\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"CollectionView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//------------------------------------------------------------------------------ TEMPLATES\nCollectionView.prototype.templates = function () {\n    var controlsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"controls\">', '<div class=\"navigation\">', '<a class=\"back\" href=\"javascript:void(0)\">', '<span class=\"fa fa-icon fa-angle-left\"></span>', (0, _localization2.default)(\"Back to \"), \"<%- view.parentName %>\", \"</a>\", \"</div>\", '<div class=\"title\">', '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>', '<div class=\"subtitle\">', '<% if( collection.collection_type === \"list\" ){ %>', (0, _localization2.default)(\"a list of datasets\"), '<% } else if( collection.collection_type === \"paired\" ){ %>', (0, _localization2.default)(\"a pair of datasets\"), '<% } else if( collection.collection_type === \"list:paired\" ){ %>', (0, _localization2.default)(\"a list of paired datasets\"), '<% } else if( collection.collection_type === \"list:list\" ){ %>', (0, _localization2.default)(\"a list of dataset lists\"), \"<% } %>\", \"</div>\", \"</div>\", '<div class=\"tags-display\"></div>', '<div class=\"actions\">', '<a class=\"download-btn icon-btn\" ', 'href=\"<%- view.downloadUrl %>', '\" title=\"\" download=\"\" data-original-title=\"Download Collection\">', '<span class=\"fa fa-floppy-o\"></span>', \"</a>\", \"</div>\", \"</div>\"], \"collection\");\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        controls: controlsTemplate\n    });\n}();\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionView = CollectionView.extend(\n/** @lends ListCollectionView.prototype */{\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass: _collectionLi2.default.DatasetDCEListItemView,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListCollectionView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionView = ListCollectionView.extend(\n/** @lends PairCollectionView.prototype */{\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"PairCollectionView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionView = CollectionView.extend(\n/** @lends ListOfPairsCollectionView.prototype */{\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLi2.default.NestedDCDCEListItemView.extend({\n        foldoutPanelClass: PairCollectionView\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListOfPairsCollectionView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a list of lists dataset collection. */\nvar ListOfListsCollectionView = CollectionView.extend({\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLi2.default.NestedDCDCEListItemView.extend({\n        foldoutPanelClass: PairCollectionView\n    }),\n\n    /** string rep */\n    toString: function toString() {\n        return \"ListOfListsCollectionView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    CollectionView: CollectionView,\n    ListCollectionView: ListCollectionView,\n    PairCollectionView: PairCollectionView,\n    ListOfPairsCollectionView: ListOfPairsCollectionView,\n    ListOfListsCollectionView: ListOfListsCollectionView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 135 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _datasetLi = __webpack_require__(86);\n\nvar _datasetLi2 = _interopRequireDefault(_datasetLi);\n\nvar _tag = __webpack_require__(67);\n\nvar _tag2 = _interopRequireDefault(_tag);\n\nvar _annotation = __webpack_require__(136);\n\nvar _annotation2 = _interopRequireDefault(_annotation);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _datasetLi2.default.DatasetListItemView;\n/** @class Editing view for DatasetAssociation.\n */\nvar DatasetListItemEdit = _super.extend(\n/** @lends DatasetListItemEdit.prototype */{\n    /** set up: options */\n    initialize: function initialize(attributes) {\n        _super.prototype.initialize.call(this, attributes);\n        this.hasUser = attributes.hasUser;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        //TODO: move to HiddenUntilActivatedViewMixin\n        /** should the tags editor be shown or hidden initially? */\n        this.tagsEditorShown = attributes.tagsEditorShown || false;\n        /** should the tags editor be shown or hidden initially? */\n        this.annotationEditorShown = attributes.annotationEditorShown || false;\n    },\n\n    // ......................................................................... titlebar actions\n    /** In this override, add the other two primary actions: edit and delete */\n    _renderPrimaryActions: function _renderPrimaryActions() {\n        var actions = _super.prototype._renderPrimaryActions.call(this);\n        if (this.model.get(\"state\") === _states2.default.NOT_VIEWABLE) {\n            return actions;\n        }\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(), this._renderDeleteButton()]);\n    },\n\n    //TODO: move titleButtons into state renderers, remove state checks in the buttons\n\n    /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n    _renderEditButton: function _renderEditButton() {\n        var self = this;\n        // don't show edit while uploading, in-accessible\n        // DO show if in error (ala previous history panel)\n        if (this.model.get(\"state\") === _states2.default.DISCARDED || !this.model.get(\"accessible\")) {\n            return null;\n        }\n        var purged = this.model.get(\"purged\");\n        var deleted = this.model.get(\"deleted\");\n\n        var editBtnData = {\n            title: (0, _localization2.default)(\"Edit attributes\"),\n            href: Galaxy.root + \"datasets/edit?dataset_id=\" + this.model.attributes.id,\n            faIcon: \"fa-pencil\",\n            classes: \"edit-btn\",\n            onclick: function onclick(ev) {\n                if (Galaxy.router) {\n                    ev.preventDefault();\n                    Galaxy.router.push(\"datasets/edit\", {\n                        dataset_id: self.model.attributes.id\n                    });\n                }\n            }\n        };\n\n        // disable if purged or deleted and explain why in the tooltip\n        if (deleted || purged) {\n            editBtnData.disabled = true;\n            if (purged) {\n                editBtnData.title = (0, _localization2.default)(\"Cannot edit attributes of datasets removed from disk\");\n            } else if (deleted) {\n                editBtnData.title = (0, _localization2.default)(\"Undelete dataset to edit attributes\");\n            }\n\n            // disable if still uploading or new\n        } else if (_.contains([_states2.default.UPLOAD, _states2.default.NEW], this.model.get(\"state\"))) {\n            editBtnData.disabled = true;\n            editBtnData.title = (0, _localization2.default)(\"This dataset is not yet editable\");\n        }\n        return (0, _faIconButton2.default)(editBtnData);\n    },\n\n    /** Render icon-button to delete this hda. */\n    _renderDeleteButton: function _renderDeleteButton() {\n        // don't show delete if...\n        if (!this.model.get(\"accessible\")) {\n            return null;\n        }\n\n        var self = this;\n        var deletedAlready = this.model.isDeletedOrPurged();\n        return (0, _faIconButton2.default)({\n            title: !deletedAlready ? (0, _localization2.default)(\"Delete\") : (0, _localization2.default)(\"Dataset is already deleted\"),\n            disabled: deletedAlready,\n            faIcon: \"fa-times\",\n            classes: \"delete-btn\",\n            onclick: function onclick() {\n                // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                self.$el.find(\".icon-btn.delete-btn\").trigger(\"mouseout\");\n                self.model[\"delete\"]();\n            }\n        });\n    },\n\n    // ......................................................................... details\n    /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n    _renderDetails: function _renderDetails() {\n        //TODO: generalize to be allow different details for each state\n        var $details = _super.prototype._renderDetails.call(this);\n\n        var state = this.model.get(\"state\");\n\n        if (!this.model.isDeletedOrPurged() && _.contains([_states2.default.OK, _states2.default.FAILED_METADATA], state)) {\n            this._renderTags($details);\n            this._renderAnnotation($details);\n            this._makeDbkeyEditLink($details);\n        }\n\n        this._setUpBehaviors($details);\n        return $details;\n    },\n\n    /**************************************************************************\n     * Render help button to show tool help text without rerunning the tool.\n     * Issue #2100\n     */\n    _renderToolHelpButton: function _renderToolHelpButton() {\n        var datasetID = this.model.attributes.dataset_id;\n        var jobID = this.model.attributes.creating_job;\n        var self = this;\n\n        var parseToolBuild = function parseToolBuild(data) {\n            var helpString = \"<div id=\\\"thdiv-\" + datasetID + \"\\\" class=\\\"toolhelp\\\">\";\n            if (data.name && data.help) {\n                helpString += \"<strong>Tool help for \" + data.name + \"</strong><hr/>\";\n                helpString += data.help;\n            } else {\n                helpString += \"<strong>Tool help is unavailable for this dataset.</strong><hr/>\";\n            }\n            helpString += \"</div>\";\n            self.$el.find(\".details\").append($.parseHTML(helpString));\n        };\n        var parseToolID = function parseToolID(data) {\n            $.ajax({\n                url: Galaxy.root + \"api/tools/\" + data.tool_id + \"/build\"\n            }).done(function (data) {\n                parseToolBuild(data);\n            }).fail(function () {\n                parseToolBuild({});\n            });\n        };\n        if (Galaxy.user.id === null) {\n            return null;\n        }\n        return (0, _faIconButton2.default)({\n            title: (0, _localization2.default)(\"Tool Help\"),\n            classes: \"icon-btn\",\n            href: \"#\",\n            faIcon: \"fa-question\",\n            onclick: function onclick() {\n                var divString = \"thdiv-\" + datasetID;\n                if (self.$el.find(\".toolhelp\").length > 0) {\n                    self.$el.find(\".toolhelp\").toggle();\n                } else {\n                    $.ajax({\n                        url: Galaxy.root + \"api/jobs/\" + jobID\n                    }).done(function (data) {\n                        parseToolID(data);\n                    }).fail(function () {\n                        console.log(\"Failed at recovering job information from the  Galaxy API for job id \\\"\" + jobID + \"\\\".\");\n                    });\n                }\n            }\n        });\n    },\n    //*************************************************************************\n\n    /** Add less commonly used actions in the details section based on state */\n    _renderSecondaryActions: function _renderSecondaryActions() {\n        var actions = _super.prototype._renderSecondaryActions.call(this);\n        switch (this.model.get(\"state\")) {\n            case _states2.default.UPLOAD:\n            case _states2.default.NOT_VIEWABLE:\n                return actions;\n            case _states2.default.ERROR:\n                // error button comes first\n                actions.unshift(this._renderErrButton());\n                return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n            case _states2.default.OK:\n            case _states2.default.FAILED_METADATA:\n                return actions.concat([this._renderRerunButton(), this._renderVisualizationsButton(), this._renderToolHelpButton()]);\n        }\n        return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n    },\n\n    /** Render icon-button to report an error on this dataset to the galaxy admin. */\n    _renderErrButton: function _renderErrButton() {\n        var self = this;\n        return (0, _faIconButton2.default)({\n            title: (0, _localization2.default)(\"View or report this error\"),\n            href: Galaxy.root + \"datasets/error?dataset_id=\" + this.model.attributes.id,\n            classes: \"report-error-btn\",\n            faIcon: \"fa-bug\",\n            onclick: function onclick(ev) {\n                if (Galaxy.router) {\n                    ev.preventDefault();\n                    Galaxy.router.push(\"datasets/error\", {\n                        dataset_id: self.model.attributes.id\n                    });\n                }\n            }\n        });\n    },\n\n    /** Render icon-button to re-run the job that created this dataset. */\n    _renderRerunButton: function _renderRerunButton() {\n        var creating_job = this.model.get(\"creating_job\");\n        if (this.model.get(\"rerunnable\")) {\n            return (0, _faIconButton2.default)({\n                title: (0, _localization2.default)(\"Run this job again\"),\n                href: this.model.urls.rerun,\n                classes: \"rerun-btn\",\n                target: this.linkTarget,\n                faIcon: \"fa-refresh\",\n                onclick: function onclick(ev) {\n                    if (Galaxy.router) {\n                        ev.preventDefault();\n                        Galaxy.router.push(\"/\", {\n                            job_id: creating_job\n                        });\n                    }\n                }\n            });\n        }\n    },\n\n    /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n    _renderVisualizationsButton: function _renderVisualizationsButton() {\n        //TODO: someday - lazyload visualizations\n        var visualizations = this.model.get(\"visualizations\");\n        if (this.model.isDeletedOrPurged() || !this.hasUser || !this.model.hasData() || _.isEmpty(visualizations)) {\n            return null;\n        }\n        if (!_.isObject(visualizations[0])) {\n            this.warn(\"Visualizations have been switched off\");\n            return null;\n        }\n\n        var $visualizations = $(this.templates.visualizations(visualizations, this));\n        //HACK: need to re-write those directed at galaxy_main with linkTarget\n        $visualizations.find('[target=\"galaxy_main\"]').attr(\"target\", this.linkTarget);\n        // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n        this._addScratchBookFn($visualizations.find(\".visualization-link\").addBack(\".visualization-link\"));\n        return $visualizations;\n    },\n\n    /** add scratchbook functionality to visualization links */\n    _addScratchBookFn: function _addScratchBookFn($links) {\n        var li = this;\n        $links.click(function (ev) {\n            if (Galaxy.frame && Galaxy.frame.active) {\n                Galaxy.frame.add({\n                    title: \"Visualization\",\n                    url: $(this).attr(\"href\")\n                });\n                ev.preventDefault();\n                ev.stopPropagation();\n            }\n        });\n    },\n\n    //TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n    /** Render the tags list/control */\n    _renderTags: function _renderTags($where) {\n        if (!this.hasUser) {\n            return;\n        }\n        var view = this;\n        this.tagsEditor = new _tag2.default.TagsEditor({\n            model: this.model,\n            el: $where.find(\".tags-display\"),\n            onshowFirstTime: function onshowFirstTime() {\n                this.render();\n            },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow: function onshow() {\n                view.tagsEditorShown = true;\n            },\n            onhide: function onhide() {\n                view.tagsEditorShown = false;\n            },\n            $activator: (0, _faIconButton2.default)({\n                title: (0, _localization2.default)(\"Edit dataset tags\"),\n                classes: \"tag-btn\",\n                faIcon: \"fa-tags\"\n            }).appendTo($where.find(\".actions .right\"))\n        });\n        if (this.tagsEditorShown) {\n            this.tagsEditor.toggle(true);\n        }\n    },\n\n    /** Render the annotation display/control */\n    _renderAnnotation: function _renderAnnotation($where) {\n        if (!this.hasUser) {\n            return;\n        }\n        var view = this;\n        this.annotationEditor = new _annotation2.default.AnnotationEditor({\n            model: this.model,\n            el: $where.find(\".annotation-display\"),\n            onshowFirstTime: function onshowFirstTime() {\n                this.render();\n            },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow: function onshow() {\n                view.annotationEditorShown = true;\n            },\n            onhide: function onhide() {\n                view.annotationEditorShown = false;\n            },\n            $activator: (0, _faIconButton2.default)({\n                title: (0, _localization2.default)(\"Edit dataset annotation\"),\n                classes: \"annotate-btn\",\n                faIcon: \"fa-comment\"\n            }).appendTo($where.find(\".actions .right\"))\n        });\n        if (this.annotationEditorShown) {\n            this.annotationEditor.toggle(true);\n        }\n    },\n\n    /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n    _makeDbkeyEditLink: function _makeDbkeyEditLink($details) {\n        // make the dbkey a link to editing\n        if (this.model.get(\"metadata_dbkey\") === \"?\" && !this.model.isDeletedOrPurged()) {\n            var editableDbkey = $('<a class=\"value\">?</a>').attr(\"href\", this.model.urls.edit).attr(\"target\", \"_top\");\n            $details.find(\".dbkey .value\").replaceWith(editableDbkey);\n        }\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .undelete-link\": \"_clickUndeleteLink\",\n        \"click .purge-link\": \"_clickPurgeLink\",\n\n        \"click .edit-btn\": function clickEditBtn(ev) {\n            this.trigger(\"edit\", this, ev);\n        },\n        \"click .delete-btn\": function clickDeleteBtn(ev) {\n            this.trigger(\"delete\", this, ev);\n        },\n        \"click .rerun-btn\": function clickRerunBtn(ev) {\n            this.trigger(\"rerun\", this, ev);\n        },\n        \"click .report-err-btn\": function clickReportErrBtn(ev) {\n            this.trigger(\"report-err\", this, ev);\n        },\n        \"click .visualization-btn\": function clickVisualizationBtn(ev) {\n            this.trigger(\"visualize\", this, ev);\n        },\n        \"click .dbkey a\": function clickDbkeyA(ev) {\n            this.trigger(\"edit\", this, ev);\n        }\n    }),\n\n    /** listener for item undelete (in the messages section) */\n    _clickUndeleteLink: function _clickUndeleteLink(ev) {\n        this.model.undelete();\n        return false;\n    },\n\n    /** listener for item purge (in the messages section) */\n    _clickPurgeLink: function _clickPurgeLink(ev) {\n        if (confirm((0, _localization2.default)(\"This will permanently remove the data in your dataset. Are you sure?\"))) {\n            this.model.purge();\n        }\n        return false;\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"HDAEditView(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemEdit.prototype.templates = function () {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: _baseMvc2.default.wrapTemplate([\n        // in this override, provide a link to the edit page\n        '<% if( dataset.state === \"failed_metadata\" ){ %>', '<div class=\"failed_metadata-warning warningmessagesmall\">', (0, _localization2.default)(\"An error occurred setting the metadata for this dataset\"), '<br /><a href=\"<%- dataset.urls.edit %>\" target=\"_top\">', (0, _localization2.default)(\"Set it manually or retry auto-detection\"), \"</a>\", \"</div>\", \"<% } %>\"], \"dataset\"),\n\n        deleted: _baseMvc2.default.wrapTemplate([\n        // in this override, provide links to undelete or purge the dataset\n        \"<% if( dataset.deleted && !dataset.purged ){ %>\",\n        // deleted not purged\n        '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This dataset has been deleted\"), '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Undelete it\"), \"</a>\", \"<% if( view.purgeAllowed ){ %>\", '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Permanently remove it from disk\"), \"</a>\", \"<% } %>\", \"</div>\", \"<% } %>\"], \"dataset\")\n    });\n\n    var visualizationsTemplate = _baseMvc2.default.wrapTemplate([\"<% if( visualizations.length === 1 ){ %>\", '<a class=\"visualization-link icon-btn\" href=\"<%- visualizations[0].href %>\"', ' target=\"<%- visualizations[0].target %>\" title=\"', (0, _localization2.default)(\"Visualize in\"), ' <%- visualizations[0].html %>\">', '<span class=\"fa fa-bar-chart-o\"></span>', \"</a>\", \"<% } else { %>\", '<div class=\"visualizations-dropdown dropdown icon-btn\">', '<a data-toggle=\"dropdown\" title=\"', (0, _localization2.default)(\"Visualize\"), '\">', '<span class=\"fa fa-bar-chart-o\"></span>', \"</a>\", '<ul class=\"dropdown-menu\" role=\"menu\">', \"<% _.each( visualizations, function( visualization ){ %>\", '<li><a class=\"visualization-link\" href=\"<%- visualization.href %>\"', ' target=\"<%- visualization.target %>\">', \"<%- visualization.html %>\", \"</a></li>\", \"<% }); %>\", \"</ul>\", \"</div>\", \"<% } %>\"], \"visualizations\");\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        visualizations: visualizationsTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    DatasetListItemEdit: DatasetListItemEdit\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 136 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(15);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// =============================================================================\n/** A view on any model that has a 'annotation' attribute\n */\nvar AnnotationEditor = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.HiddenUntilActivatedViewMixin).extend({\n    tagName: \"div\",\n    className: \"annotation-display\",\n\n    /** Set up listeners, parse options */\n    initialize: function initialize(options) {\n        options = options || {};\n        this.tooltipConfig = options.tooltipConfig || {\n            placement: \"bottom\"\n        };\n        //console.debug( this, options );\n        // only listen to the model only for changes to annotations\n        this.listenTo(this.model, \"change:annotation\", function () {\n            this.render();\n        });\n        this.hiddenUntilActivated(options.$activator, options);\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render: function render() {\n        var view = this;\n        this.$el.html(this._template());\n\n        //TODO: handle empties better\n        this.$annotation().make_text_editable({\n            use_textarea: true,\n            on_finish: function on_finish(newAnnotation) {\n                view.$annotation().text(newAnnotation);\n                view.model.save({ annotation: newAnnotation }, { silent: true }).fail(function () {\n                    view.$annotation().text(view.model.previous(\"annotation\"));\n                });\n            }\n        });\n        return this;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _template: function _template() {\n        var annotation = this.model.get(\"annotation\");\n        return [\n        //TODO: make prompt optional\n        '<label class=\"prompt\">', (0, _localization2.default)(\"Annotation\"), \"</label>\",\n        // set up initial tags by adding as CSV to input vals (necc. to init select2)\n        '<div class=\"annotation\">', _.escape(annotation), \"</div>\"].join(\"\");\n    },\n\n    /** @returns {jQuery} the main element for this view */\n    $annotation: function $annotation() {\n        return this.$el.find(\".annotation\");\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove: function remove() {\n        this.$annotation.off();\n        this.stopListening(this.model);\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return [\"AnnotationEditor(\", \"\" + this.model, \")\"].join(\"\");\n    }\n});\n// =============================================================================\nexports.default = {\n    AnnotationEditor: AnnotationEditor\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ }),\n/* 137 */,\n/* 138 */,\n/* 139 */,\n/* 140 */,\n/* 141 */,\n/* 142 */,\n/* 143 */,\n/* 144 */,\n/* 145 */,\n/* 146 */,\n/* 147 */,\n/* 148 */,\n/* 149 */,\n/* 150 */,\n/* 151 */,\n/* 152 */,\n/* 153 */,\n/* 154 */,\n/* 155 */,\n/* 156 */,\n/* 157 */,\n/* 158 */,\n/* 159 */,\n/* 160 */,\n/* 161 */,\n/* 162 */,\n/* 163 */,\n/* 164 */,\n/* 165 */,\n/* 166 */,\n/* 167 */,\n/* 168 */,\n/* 169 */,\n/* 170 */,\n/* 171 */,\n/* 172 */,\n/* 173 */,\n/* 174 */,\n/* 175 */,\n/* 176 */,\n/* 177 */,\n/* 178 */,\n/* 179 */,\n/* 180 */,\n/* 181 */,\n/* 182 */,\n/* 183 */,\n/* 184 */,\n/* 185 */,\n/* 186 */,\n/* 187 */,\n/* 188 */,\n/* 189 */,\n/* 190 */,\n/* 191 */,\n/* 192 */,\n/* 193 */,\n/* 194 */,\n/* 195 */,\n/* 196 */,\n/* 197 */,\n/* 198 */,\n/* 199 */,\n/* 200 */,\n/* 201 */,\n/* 202 */,\n/* 203 */,\n/* 204 */,\n/* 205 */,\n/* 206 */,\n/* 207 */,\n/* 208 */,\n/* 209 */,\n/* 210 */,\n/* 211 */,\n/* 212 */,\n/* 213 */,\n/* 214 */,\n/* 215 */,\n/* 216 */,\n/* 217 */,\n/* 218 */,\n/* 219 */,\n/* 220 */,\n/* 221 */,\n/* 222 */,\n/* 223 */,\n/* 224 */,\n/* 225 */,\n/* 226 */,\n/* 227 */,\n/* 228 */,\n/* 229 */,\n/* 230 */,\n/* 231 */,\n/* 232 */,\n/* 233 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_) {\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _galaxy = __webpack_require__(59);\n\nvar _galaxy2 = _interopRequireDefault(_galaxy);\n\nvar _router = __webpack_require__(73);\n\nvar _router2 = _interopRequireDefault(_router);\n\nvar _toolPanel = __webpack_require__(234);\n\nvar _toolPanel2 = _interopRequireDefault(_toolPanel);\n\nvar _historyPanel = __webpack_require__(244);\n\nvar _historyPanel2 = _interopRequireDefault(_historyPanel);\n\nvar _page = __webpack_require__(61);\n\nvar _page2 = _interopRequireDefault(_page);\n\nvar _toolForm = __webpack_require__(23);\n\nvar _toolForm2 = _interopRequireDefault(_toolForm);\n\nvar _formWrapper = __webpack_require__(88);\n\nvar _formWrapper2 = _interopRequireDefault(_formWrapper);\n\nvar _userPreferences = __webpack_require__(258);\n\nvar _userPreferences2 = _interopRequireDefault(_userPreferences);\n\nvar _userCustomBuilds = __webpack_require__(259);\n\nvar _userCustomBuilds2 = _interopRequireDefault(_userCustomBuilds);\n\nvar _tours = __webpack_require__(94);\n\nvar _tours2 = _interopRequireDefault(_tours);\n\nvar _gridView = __webpack_require__(12);\n\nvar _gridView2 = _interopRequireDefault(_gridView);\n\nvar _gridShared = __webpack_require__(260);\n\nvar _gridShared2 = _interopRequireDefault(_gridShared);\n\nvar _workflow = __webpack_require__(261);\n\nvar _workflow2 = _interopRequireDefault(_workflow);\n\nvar _historyList = __webpack_require__(263);\n\nvar _historyList2 = _interopRequireDefault(_historyList);\n\nvar _toolFormComposite = __webpack_require__(124);\n\nvar _toolFormComposite2 = _interopRequireDefault(_toolFormComposite);\n\nvar _queryStringParsing = __webpack_require__(17);\n\nvar _queryStringParsing2 = _interopRequireDefault(_queryStringParsing);\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _datasetError = __webpack_require__(264);\n\nvar _datasetError2 = _interopRequireDefault(_datasetError);\n\nvar _datasetEditAttributes = __webpack_require__(265);\n\nvar _datasetEditAttributes2 = _interopRequireDefault(_datasetEditAttributes);\n\nvar _citations = __webpack_require__(101);\n\nvar _citations2 = _interopRequireDefault(_citations);\n\nvar _vue = __webpack_require__(64);\n\nvar _vue2 = _interopRequireDefault(_vue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar $ = _jquery2.default;\n\n\n/** define the 'Analyze Data'/analysis/main/home page for Galaxy\n *  * has a masthead\n *  * a left tool menu to allow the user to load tools in the center panel\n *  * a right history menu that shows the user's current data\n *  * a center panel\n *  Both panels (generally) persist while the center panel shows any\n *  UI needed for the current step of an analysis, like:\n *      * tool forms to set tool parameters,\n *      * tables showing the contents of datasets\n *      * etc.\n */\nwindow.app = function app(options, bootstrapped) {\n    window.Galaxy = new _galaxy2.default.GalaxyApp(options, bootstrapped);\n    Galaxy.debug(\"analysis app\");\n\n    /** Routes */\n    var AnalysisRouter = _router2.default.extend({\n        routes: {\n            \"(/)\": \"home\",\n            \"(/)root*\": \"home\",\n            \"(/)tours(/)(:tour_id)\": \"show_tours\",\n            \"(/)user(/)\": \"show_user\",\n            \"(/)user(/)(:form_id)\": \"show_user_form\",\n            \"(/)workflow(/)\": \"show_workflows\",\n            \"(/)workflow/run(/)\": \"show_run\",\n            \"(/)pages(/)create(/)\": \"show_pages_create\",\n            \"(/)pages(/)edit(/)\": \"show_pages_edit\",\n            \"(/)pages(/)(:action_id)\": \"show_pages\",\n            \"(/)visualizations(/)edit(/)\": \"show_visualizations_edit\",\n            \"(/)visualizations/(:action_id)\": \"show_visualizations\",\n            \"(/)workflows/list_published(/)\": \"show_workflows_published\",\n            \"(/)histories(/)citations(/)\": \"show_history_citations\",\n            \"(/)histories(/)rename(/)\": \"show_histories_rename\",\n            \"(/)histories(/)permissions(/)\": \"show_histories_permissions\",\n            \"(/)histories(/)(:action_id)\": \"show_histories\",\n            \"(/)datasets(/)list(/)\": \"show_datasets\",\n            \"(/)workflow/import_workflow\": \"show_import_workflow\",\n            \"(/)custom_builds\": \"show_custom_builds\",\n            \"(/)datasets/edit\": \"show_dataset_edit_attributes\",\n            \"(/)datasets/error\": \"show_dataset_error\"\n        },\n\n        require_login: [\"show_user\", \"show_user_form\", \"show_workflows\"],\n\n        authenticate: function authenticate(args, name) {\n            return Galaxy.user && Galaxy.user.id || this.require_login.indexOf(name) == -1;\n        },\n\n        show_tours: function show_tours(tour_id) {\n            if (tour_id) {\n                _tours2.default.giveTour(tour_id);\n            } else {\n                this.page.display(new _tours2.default.ToursView());\n            }\n        },\n\n        show_user: function show_user() {\n            this.page.display(new _userPreferences2.default.View());\n        },\n\n        show_user_form: function show_user_form(form_id) {\n            var model = new _userPreferences2.default.Model({\n                user_id: Galaxy.params.id\n            });\n            this.page.display(new _formWrapper2.default.View(model.get(form_id)));\n        },\n\n        show_visualizations: function show_visualizations(action_id) {\n            this.page.display(new _gridShared2.default.View({\n                action_id: action_id,\n                plural: \"Visualizations\",\n                item: \"visualization\"\n            }));\n        },\n\n        show_visualizations_edit: function show_visualizations_edit() {\n            this.page.display(new _formWrapper2.default.View({\n                url: \"visualization/edit?id=\" + _queryStringParsing2.default.get(\"id\"),\n                redirect: \"visualizations/list\"\n            }));\n        },\n\n        show_workflows_published: function show_workflows_published() {\n            this.page.display(new _gridView2.default({\n                url_base: Galaxy.root + \"workflow/list_published\",\n                dict_format: true\n            }));\n        },\n\n        show_histories: function show_histories(action_id) {\n            this.page.display(new _historyList2.default.View({ action_id: action_id }));\n        },\n\n        show_history_citations: function show_history_citations() {\n            var citationInstance = _vue2.default.extend(_citations2.default);\n            var vm = document.createElement(\"div\");\n            this.page.display(vm);\n            new citationInstance({ propsData: { id: _queryStringParsing2.default.get(\"id\"), source: \"histories\" } }).$mount(vm);\n        },\n\n        show_histories_rename: function show_histories_rename() {\n            this.page.display(new _formWrapper2.default.View({\n                url: \"history/rename?id=\" + _queryStringParsing2.default.get(\"id\"),\n                redirect: \"histories/list\"\n            }));\n        },\n\n        show_histories_permissions: function show_histories_permissions() {\n            this.page.display(new _formWrapper2.default.View({\n                url: \"history/permissions?id=\" + _queryStringParsing2.default.get(\"id\"),\n                redirect: \"histories/list\"\n            }));\n        },\n\n        show_datasets: function show_datasets() {\n            this.page.display(new _gridView2.default({\n                url_base: Galaxy.root + \"dataset/list\",\n                dict_format: true\n            }));\n        },\n\n        show_pages: function show_pages(action_id) {\n            this.page.display(new _gridShared2.default.View({\n                action_id: action_id,\n                plural: \"Pages\",\n                item: \"page\"\n            }));\n        },\n\n        show_pages_create: function show_pages_create() {\n            this.page.display(new _formWrapper2.default.View({\n                url: \"page/create\",\n                redirect: \"pages/list\"\n            }));\n        },\n\n        show_pages_edit: function show_pages_edit() {\n            this.page.display(new _formWrapper2.default.View({\n                url: \"page/edit?id=\" + _queryStringParsing2.default.get(\"id\"),\n                redirect: \"pages/list\"\n            }));\n        },\n\n        show_workflows: function show_workflows() {\n            this.page.display(new _workflow2.default.View());\n        },\n\n        show_run: function show_run() {\n            this._loadWorkflow();\n        },\n\n        show_import_workflow: function show_import_workflow() {\n            this.page.display(new _workflow2.default.ImportWorkflowView());\n        },\n\n        show_custom_builds: function show_custom_builds() {\n            var _this = this;\n\n            var historyPanel = this.page.historyPanel.historyView;\n            if (!historyPanel || !historyPanel.model || !historyPanel.model.id) {\n                window.setTimeout(function () {\n                    _this.show_custom_builds();\n                }, 500);\n                return;\n            }\n            this.page.display(new _userCustomBuilds2.default.View());\n        },\n\n        show_dataset_edit_attributes: function show_dataset_edit_attributes() {\n            this.page.display(new _datasetEditAttributes2.default.View());\n        },\n\n        show_dataset_error: function show_dataset_error() {\n            this.page.display(new _datasetError2.default.View());\n        },\n\n        /**  */\n        home: function home(params) {\n            // TODO: to router, remove Globals\n            // load a tool by id (tool_id) or rerun a previous tool execution (job_id)\n            if (params.tool_id || params.job_id) {\n                if (params.tool_id === \"upload1\") {\n                    this.page.toolPanel.upload.show();\n                    this._loadCenterIframe(\"welcome\");\n                } else {\n                    this._loadToolForm(params);\n                }\n            } else {\n                // show the workflow run form\n                if (params.workflow_id) {\n                    this._loadWorkflow();\n                    // load the center iframe with controller.action: galaxy.org/?m_c=history&m_a=list -> history/list\n                } else if (params.m_c) {\n                    this._loadCenterIframe(params.m_c + \"/\" + params.m_a);\n                    // show the workflow run form\n                } else {\n                    this._loadCenterIframe(\"welcome\");\n                }\n            }\n        },\n\n        /** load the center panel with a tool form described by the given params obj */\n        _loadToolForm: function _loadToolForm(params) {\n            //TODO: load tool form code async\n            params.id = decodeURIComponent(params.tool_id);\n            this.page.display(new _toolForm2.default.View(params));\n        },\n\n        /** load the center panel iframe using the given url */\n        _loadCenterIframe: function _loadCenterIframe(url, root) {\n            root = root || Galaxy.root;\n            url = root + url;\n            this.page.$(\"#galaxy_main\").prop(\"src\", url);\n        },\n\n        /** load workflow by its url in run mode */\n        _loadWorkflow: function _loadWorkflow() {\n            var _this2 = this;\n\n            _utils2.default.get({\n                url: Galaxy.root + \"api/workflows/\" + _utils2.default.getQueryString(\"id\") + \"/download?style=run\",\n                success: function success(response) {\n                    _this2.page.display(new _toolFormComposite2.default.View(response));\n                },\n                error: function error(response) {\n                    var error_msg = response.err_msg || \"Error occurred while loading the resource.\";\n                    var options = {\n                        message: error_msg,\n                        status: \"danger\",\n                        persistent: true\n                    };\n                    _this2.page.display(new _uiMisc2.default.Message(options));\n                }\n            });\n        }\n    });\n\n    // render and start the router\n    $(function () {\n        Galaxy.page = new _page2.default.View(_.extend(options, {\n            Left: _toolPanel2.default,\n            Right: _historyPanel2.default,\n            Router: AnalysisRouter\n        }));\n    });\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1)))\n\n/***/ }),\n/* 234 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _tools = __webpack_require__(22);\n\nvar _tools2 = _interopRequireDefault(_tools);\n\nvar _uploadView = __webpack_require__(235);\n\nvar _uploadView2 = _interopRequireDefault(_uploadView);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nvar _toolFormComposite = __webpack_require__(124);\n\nvar _toolFormComposite2 = _interopRequireDefault(_toolFormComposite);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar ToolPanel = Backbone.View.extend({\n    initialize: function initialize(page, options) {\n        // access configuration options\n        var config = options.config;\n        this.root = options.root;\n\n        /** @type {Object[]} descriptions of user's workflows to be shown in the tool menu */\n        this.stored_workflow_menu_entries = config.stored_workflow_menu_entries || [];\n\n        // create tool search, tool panel, and tool panel view.\n        var tool_search = new _tools2.default.ToolSearch({\n            hidden: false\n        });\n        var tools = new _tools2.default.ToolCollection(config.toolbox);\n        this.tool_panel = new _tools2.default.ToolPanel({\n            tool_search: tool_search,\n            tools: tools,\n            layout: config.toolbox_in_panel\n        });\n        this.tool_panel_view = new _tools2.default.ToolPanelView({\n            model: this.tool_panel\n        });\n\n        // add upload modal\n        this.upload_button = new _uploadView2.default({\n            nginx_upload_path: config.nginx_upload_path,\n            ftp_upload_site: config.ftp_upload_site,\n            default_genome: config.default_genome,\n            default_extension: config.default_extension\n        });\n\n        // add uploader button to Galaxy object\n        Galaxy.upload = this.upload_button;\n\n        // components for panel definition\n        this.model = new Backbone.Model({\n            title: (0, _localization2.default)(\"Tools\"),\n            buttons: [this.upload_button]\n        });\n\n        // build body template\n        this.setElement(this._template());\n    },\n\n    render: function render() {\n        // if there are tools, render panel and display everything\n        var self = this;\n        if (this.tool_panel.get(\"layout\").size() > 0) {\n            this.$el.prepend(this.tool_panel_view.$el);\n            this.tool_panel_view.render();\n        }\n        // build the dom for the workflow portion of the tool menu\n        // add internal workflow list\n        self.$(\"#internal-workflows\").append(self._templateAllWorkflow({\n            title: (0, _localization2.default)(\"All workflows\"),\n            href: \"workflow\"\n        }));\n        _.each(this.stored_workflow_menu_entries, function (menu_entry) {\n            self.$(\"#internal-workflows\").append(self._templateWorkflowLink({\n                title: menu_entry.stored_workflow.name,\n                href: \"workflow/run?id=\" + menu_entry.encoded_stored_workflow_id\n            }));\n        });\n    },\n\n    /** build a link to one tool */\n    _templateTool: function _templateTool(tool) {\n        return ['<div class=\"toolTitle\">', '<a href=\"', this.root, tool.href, '\" target=\"galaxy_main\">', tool.title, \"</a>\", \"</div>\"].join(\"\");\n    },\n\n    /** build a link to 'All Workflows' */\n    _templateAllWorkflow: function _templateAllWorkflow(tool) {\n        return ['<div class=\"toolTitle\">',\n        // global\n        '<a href=\"', Galaxy.root, tool.href, '\">', tool.title, \"</a>\", \"</div>\"].join(\"\");\n    },\n\n    /** build links to workflows in toolpanel */\n    _templateWorkflowLink: function _templateWorkflowLink(wf) {\n        return ['<div class=\"toolTitle\">', \"<a class=\\\"\" + wf.cls + \" \\\" href=\\\"\", Galaxy.root, wf.href, '\">', wf.title, \"</a>\", \"</div>\"].join(\"\");\n    },\n\n    /** override to include inital menu dom and workflow section */\n    _template: function _template() {\n        return ['<div class=\"toolMenuContainer\">', '<div class=\"toolMenu\" style=\"display: none\">', '<div id=\"search-no-results\" style=\"display: none; padding-top: 5px\">', \"<em><strong>\", (0, _localization2.default)(\"Search did not match any tools.\"), \"</strong></em>\", \"</div>\", \"</div>\", '<div class=\"toolSectionPad\"/>', '<div class=\"toolSectionPad\"/>', '<div class=\"toolSectionTitle\" id=\"title_XXinternalXXworkflow\">', \"<span>\", (0, _localization2.default)(\"Workflows\"), \"</span>\", \"</div>\", '<div id=\"internal-workflows\" class=\"toolSectionBody\">', '<div class=\"toolSectionBg\"/>', \"</div>\", \"</div>\"].join(\"\");\n    },\n\n    toString: function toString() {\n        return \"toolPanel\";\n    }\n});\n\nexports.default = ToolPanel;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1)))\n\n/***/ }),\n/* 235 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiModal = __webpack_require__(9);\n\nvar _uiModal2 = _interopRequireDefault(_uiModal);\n\nvar _uiTabs = __webpack_require__(20);\n\nvar _uiTabs2 = _interopRequireDefault(_uiTabs);\n\nvar _uploadButton = __webpack_require__(236);\n\nvar _uploadButton2 = _interopRequireDefault(_uploadButton);\n\nvar _defaultView = __webpack_require__(237);\n\nvar _defaultView2 = _interopRequireDefault(_defaultView);\n\nvar _compositeView = __webpack_require__(240);\n\nvar _compositeView2 = _interopRequireDefault(_compositeView);\n\nvar _collectionView = __webpack_require__(242);\n\nvar _collectionView2 = _interopRequireDefault(_collectionView);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    options: {\n        nginx_upload_path: \"\",\n        ftp_upload_site: \"n/a\",\n        default_genome: \"?\",\n        default_extension: \"auto\",\n        height: 500,\n        width: 900,\n        auto: {\n            id: \"auto\",\n            text: \"Auto-detect\",\n            description: \"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed.\"\n        }\n    },\n\n    // contains all available dataset extensions/types\n    list_extensions: [],\n\n    // contains all available genomes\n    list_genomes: [],\n\n    initialize: function initialize(options) {\n        var self = this;\n        this.options = _utils2.default.merge(options, this.options);\n\n        // create view for upload/progress button\n        this.ui_button = new _uploadButton2.default.View({\n            onclick: function onclick(e) {\n                e.preventDefault();\n                self.show();\n            },\n            onunload: function onunload() {\n                var percentage = self.ui_button.model.get(\"percentage\", 0);\n                if (percentage > 0 && percentage < 100) {\n                    return \"Several uploads are queued.\";\n                }\n            }\n        });\n\n        // set element to button view\n        this.setElement(this.ui_button.$el);\n\n        // load extensions\n        var self = this;\n        _utils2.default.get({\n            url: Galaxy.root + \"api/datatypes?extension_only=False\",\n            success: function success(datatypes) {\n                for (var key in datatypes) {\n                    self.list_extensions.push({\n                        id: datatypes[key].extension,\n                        text: datatypes[key].extension,\n                        description: datatypes[key].description,\n                        description_url: datatypes[key].description_url,\n                        composite_files: datatypes[key].composite_files\n                    });\n                }\n                self.list_extensions.sort(function (a, b) {\n                    var a_text = a.text && a.text.toLowerCase();\n                    var b_text = b.text && b.text.toLowerCase();\n                    return a_text > b_text ? 1 : a_text < b_text ? -1 : 0;\n                });\n                if (!self.options.datatypes_disable_auto) {\n                    self.list_extensions.unshift(self.options.auto);\n                }\n            }\n        });\n\n        // load genomes\n        _utils2.default.get({\n            url: Galaxy.root + \"api/genomes\",\n            success: function success(genomes) {\n                for (var key in genomes) {\n                    self.list_genomes.push({\n                        id: genomes[key][1],\n                        text: genomes[key][0]\n                    });\n                }\n                self.list_genomes.sort(function (a, b) {\n                    if (a.id == self.options.default_genome) {\n                        return -1;\n                    }\n                    if (b.id == self.options.default_genome) {\n                        return 1;\n                    }\n                    return a.text > b.text ? 1 : a.text < b.text ? -1 : 0;\n                });\n            }\n        });\n    },\n\n    /** Show/hide upload dialog */\n    show: function show() {\n        var self = this;\n        if (!Galaxy.currHistoryPanel || !Galaxy.currHistoryPanel.model) {\n            window.setTimeout(function () {\n                self.show();\n            }, 500);\n            return;\n        }\n        this.current_user = Galaxy.user.id;\n        if (!this.modal) {\n            this.tabs = new _uiTabs2.default.View();\n            this.default_view = new _defaultView2.default(this);\n            this.tabs.add({\n                id: \"regular\",\n                title: \"Regular\",\n                $el: this.default_view.$el\n            });\n            this.composite_view = new _compositeView2.default(this);\n            this.tabs.add({\n                id: \"composite\",\n                title: \"Composite\",\n                $el: this.composite_view.$el\n            });\n            this.collection_view = new _collectionView2.default(this);\n            this.tabs.add({\n                id: \"collection\",\n                title: \"Collection\",\n                $el: this.collection_view.$el\n            });\n            this.modal = new _uiModal2.default.View({\n                title: \"Download from web or upload from disk\",\n                body: this.tabs.$el,\n                height: this.options.height,\n                width: this.options.width,\n                closing_events: true,\n                title_separator: false\n            });\n        }\n        this.modal.show();\n    },\n\n    /** Refresh user and current history */\n    currentHistory: function currentHistory() {\n        return this.current_user && Galaxy.currHistoryPanel.model.get(\"id\");\n    },\n\n    /** Get ftp configuration */\n    currentFtp: function currentFtp() {\n        return this.current_user && this.options.ftp_upload_site;\n    },\n\n    /**\n     * Package API data from array of models\n     * @param{Array} items - Upload items/rows filtered from a collection\n     */\n    toData: function toData(items, history_id) {\n        // create dictionary for data submission\n        var data = {\n            payload: {\n                tool_id: \"upload1\",\n                history_id: history_id || this.currentHistory(),\n                inputs: {}\n            },\n            files: [],\n            error_message: null\n        };\n        // add upload tools input data\n        if (items && items.length > 0) {\n            var inputs = {\n                file_count: items.length,\n                dbkey: items[0].get(\"genome\", \"?\"),\n                file_type: items[0].get(\"extension\", \"auto\")\n            };\n            for (var index in items) {\n                var it = items[index];\n                it.set(\"status\", \"running\");\n                if (it.get(\"file_size\") > 0) {\n                    var prefix = \"files_\" + index + \"|\";\n                    inputs[prefix + \"type\"] = \"upload_dataset\";\n                    inputs[prefix + \"space_to_tab\"] = it.get(\"space_to_tab\") && \"Yes\" || null;\n                    inputs[prefix + \"to_posix_lines\"] = it.get(\"to_posix_lines\") && \"Yes\" || null;\n                    inputs[prefix + \"dbkey\"] = it.get(\"genome\", null);\n                    inputs[prefix + \"file_type\"] = it.get(\"extension\", null);\n                    switch (it.get(\"file_mode\")) {\n                        case \"new\":\n                            inputs[prefix + \"url_paste\"] = it.get(\"url_paste\");\n                            break;\n                        case \"ftp\":\n                            inputs[prefix + \"ftp_files\"] = it.get(\"file_path\");\n                            break;\n                        case \"local\":\n                            data.files.push({\n                                name: prefix + \"file_data\",\n                                file: it.get(\"file_data\")\n                            });\n                    }\n                } else {\n                    data.error_message = \"Upload content incomplete.\";\n                    it.set(\"status\", \"error\");\n                    it.set(\"info\", data.error_message);\n                    break;\n                }\n            }\n            data.payload.inputs = JSON.stringify(inputs);\n        }\n        return data;\n    }\n}); /** Upload app contains the upload progress button and upload modal, compiles model data for API request **/\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ }),\n/* 236 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/** View for upload/progress bar button */\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.model = options && options.model || new Backbone.Model({\n            icon: \"fa-upload\",\n            tooltip: \"Download from URL or upload files from disk\",\n            label: \"Load Data\",\n            percentage: 0,\n            status: \"\",\n            onunload: function onunload() {},\n            onclick: function onclick() {}\n        }).set(options);\n        this.setElement(this._template());\n        this.$progress = this.$(\".progress-bar\");\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n        $(window).on(\"beforeunload\", function () {\n            return self.model.get(\"onunload\")();\n        });\n    },\n\n    render: function render() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$el.off(\"click\").on(\"click\", function (e) {\n            options.onclick(e);\n        }).tooltip({\n            title: this.model.get(\"tooltip\"),\n            placement: \"bottom\"\n        });\n        this.$progress.removeClass().addClass(\"progress-bar\").addClass(\"progress-bar-notransition\").addClass(options.status != \"\" && \"progress-bar-\" + options.status).css({ width: options.percentage + \"%\" });\n    },\n\n    /** Template */\n    _template: function _template() {\n        return '<div class=\"upload-button\">' + '<div class=\"progress\">' + '<div class=\"progress-bar\"/>' + '<a class=\"panel-header-button\" href=\"javascript:void(0)\" id=\"tool-panel-upload-button\">' + '<span class=\"fa fa-upload\"/>' + \"</a>\" + \"</div>\" + \"</div>\";\n    }\n});\nexports.default = { View: View };\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 237 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadModel = __webpack_require__(63);\n\nvar _uploadModel2 = _interopRequireDefault(_uploadModel);\n\nvar _defaultRow = __webpack_require__(238);\n\nvar _defaultRow2 = _interopRequireDefault(_defaultRow);\n\nvar _uploadFtp2 = __webpack_require__(75);\n\nvar _uploadFtp3 = _interopRequireDefault(_uploadFtp2);\n\nvar _uploadExtension = __webpack_require__(76);\n\nvar _uploadExtension2 = _interopRequireDefault(_uploadExtension);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _lazyLimited = __webpack_require__(239);\n\nvar _lazyLimited2 = _interopRequireDefault(_lazyLimited);\n\n__webpack_require__(77);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Renders contents of the default uploader */\nexports.default = Backbone.View.extend({\n    // current upload size in bytes\n    upload_size: 0,\n\n    // contains upload row models\n    collection: new _uploadModel2.default.Collection(),\n\n    // keeps track of the current uploader state\n    counter: {\n        announce: 0,\n        success: 0,\n        error: 0,\n        running: 0,\n        reset: function reset() {\n            this.announce = this.success = this.error = this.running = 0;\n        }\n    },\n\n    initialize: function initialize(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ui_button = app.ui_button;\n        this.ftp_upload_site = app.currentFtp();\n\n        // build template\n        this.setElement(this._template());\n        this.$uploadbox = this.$(\".upload-box\");\n        this.$uploadtable = this.$(\".upload-table\");\n\n        // append buttons to dom\n        this.btnLocal = new _uiMisc2.default.Button({\n            id: \"btn-local\",\n            title: \"Choose local file\",\n            onclick: function onclick() {\n                self.uploadbox.select();\n            },\n            icon: \"fa fa-laptop\"\n        });\n        this.btnFtp = new _uiMisc2.default.Button({\n            id: \"btn-ftp\",\n            title: \"Choose FTP file\",\n            onclick: function onclick() {\n                self._eventFtp();\n            },\n            icon: \"fa fa-folder-open-o\"\n        });\n        this.btnCreate = new _uiMisc2.default.Button({\n            id: \"btn-new\",\n            title: \"Paste/Fetch data\",\n            onclick: function onclick() {\n                self._eventCreate();\n            },\n            icon: \"fa fa-edit\"\n        });\n        this.btnStart = new _uiMisc2.default.Button({\n            id: \"btn-start\",\n            title: \"Start\",\n            onclick: function onclick() {\n                self._eventStart();\n            }\n        });\n        this.btnStop = new _uiMisc2.default.Button({\n            id: \"btn-stop\",\n            title: \"Pause\",\n            onclick: function onclick() {\n                self._eventStop();\n            }\n        });\n        this.btnReset = new _uiMisc2.default.Button({\n            id: \"btn-reset\",\n            title: \"Reset\",\n            onclick: function onclick() {\n                self._eventReset();\n            }\n        });\n        this.btnClose = new _uiMisc2.default.Button({\n            id: \"btn-close\",\n            title: \"Close\",\n            onclick: function onclick() {\n                self.app.modal.hide();\n            }\n        });\n        _.each([this.btnLocal, this.btnFtp, this.btnCreate, this.btnStop, this.btnReset, this.btnStart, this.btnClose], function (button) {\n            self.$(\".upload-buttons\").prepend(button.$el);\n        });\n\n        // file upload\n        this.uploadbox = this.$uploadbox.uploadbox({\n            url: this.app.options.nginx_upload_path,\n            announce: function announce(index, file) {\n                self._eventAnnounce(index, file);\n            },\n            initialize: function initialize(index) {\n                return self.app.toData([self.collection.get(index)], self.history_id);\n            },\n            progress: function progress(index, percentage) {\n                self._eventProgress(index, percentage);\n            },\n            success: function success(index, message) {\n                self._eventSuccess(index, message);\n            },\n            error: function error(index, message) {\n                self._eventError(index, message);\n            },\n            complete: function complete() {\n                self._eventComplete();\n            },\n            ondragover: function ondragover() {\n                self.$uploadbox.addClass(\"highlight\");\n            },\n            ondragleave: function ondragleave() {\n                self.$uploadbox.removeClass(\"highlight\");\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new _uiPopover2.default.View({\n            title: \"FTP files\",\n            container: this.btnFtp.$el\n        });\n\n        // select extension\n        this.select_extension = new _uiSelect2.default.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, function (ext) {\n                return !ext.composite_files;\n            }),\n            value: this.options.default_extension,\n            onchange: function onchange(extension) {\n                self._changeExtension(extension);\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\").on(\"click\", function (e) {\n            new _uploadExtension2.default({\n                $el: $(e.target),\n                title: self.select_extension.text(),\n                extension: self.select_extension.value(),\n                list: self.list_extensions,\n                placement: \"top\"\n            });\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // genome extension\n        this.select_genome = new _uiSelect2.default.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome,\n            onchange: function onchange(genome) {\n                self._changeGenome(genome);\n            }\n        });\n\n        // Lazy load helper\n        this.loader = new _lazyLimited2.default({\n            $container: this.$uploadbox,\n            collection: this.collection,\n            new_content: function new_content(model) {\n                var upload_row = new _defaultRow2.default(self, { model: model });\n                self.$uploadtable.find(\"> tbody:first\").append(upload_row.$el);\n                upload_row.render();\n                return upload_row;\n            }\n        });\n\n        // events\n        this.collection.on(\"remove\", function (model) {\n            self._eventRemove(model);\n        });\n        this.render();\n    },\n\n    render: function render() {\n        var message = \"\";\n        if (this.counter.announce == 0) {\n            if (this.uploadbox.compatible()) {\n                message = \"&nbsp;\";\n            } else {\n                message = \"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.\";\n            }\n        } else {\n            if (this.counter.running == 0) {\n                message = \"You added \" + this.counter.announce + \" file(s) to the queue. Add more files or click 'Start' to proceed.\";\n            } else {\n                message = \"Please wait...\" + this.counter.announce + \" out of \" + this.counter.running + \" remaining.\";\n            }\n        }\n        this.$(\".upload-top-info\").html(message);\n        var enable_reset = this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0;\n        var enable_start = this.counter.running == 0 && this.counter.announce > 0;\n        var enable_sources = this.counter.running == 0;\n        var show_table = this.counter.announce + this.counter.success + this.counter.error > 0;\n        this.btnReset[enable_reset ? \"enable\" : \"disable\"]();\n        this.btnStart[enable_start ? \"enable\" : \"disable\"]();\n        this.btnStart.$el[enable_start ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnStop[this.counter.running > 0 ? \"enable\" : \"disable\"]();\n        this.btnLocal[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnCreate[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp.$el[this.ftp_upload_site ? \"show\" : \"hide\"]();\n        this.$(\".upload-table\")[show_table ? \"show\" : \"hide\"]();\n        this.$(\".upload-helper\")[show_table ? \"hide\" : \"show\"]();\n    },\n\n    /** A new file has been dropped/selected through the uploadbox plugin */\n    _eventAnnounce: function _eventAnnounce(index, file) {\n        this.counter.announce++;\n        var new_model = new _uploadModel2.default.Model({\n            id: index,\n            file_name: file.name,\n            file_size: file.size,\n            file_mode: file.mode || \"local\",\n            file_path: file.path,\n            file_data: file\n        });\n        this.render();\n        this.collection.add(new_model);\n    },\n\n    /** Progress */\n    _eventProgress: function _eventProgress(index, percentage) {\n        var it = this.collection.get(index);\n        it.set(\"percentage\", percentage);\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(percentage, it.get(\"file_size\")));\n    },\n\n    /** Success */\n    _eventSuccess: function _eventSuccess(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"success\" });\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(100, it.get(\"file_size\")));\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.success++;\n        this.render();\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Error */\n    _eventError: function _eventError(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"error\", info: message });\n        this.ui_button.model.set({\n            percentage: this._uploadPercentage(100, it.get(\"file_size\")),\n            status: \"danger\"\n        });\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.error++;\n        this.render();\n    },\n\n    /** Queue is done */\n    _eventComplete: function _eventComplete() {\n        this.collection.each(function (model) {\n            model.get(\"status\") == \"queued\" && model.set(\"status\", \"init\");\n        });\n        this.counter.running = 0;\n        this.render();\n    },\n\n    /** Remove model from upload list */\n    _eventRemove: function _eventRemove(model) {\n        var status = model.get(\"status\");\n        if (status == \"success\") {\n            this.counter.success--;\n        } else if (status == \"error\") {\n            this.counter.error--;\n        } else {\n            this.counter.announce--;\n        }\n        this.uploadbox.remove(model.id);\n        this.render();\n    },\n\n    //\n    // events triggered by this view\n    //\n\n    /** Show/hide ftp popup */\n    _eventFtp: function _eventFtp() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append(new _uploadFtp3.default({\n                collection: this.collection,\n                ftp_upload_site: this.ftp_upload_site,\n                onadd: function onadd(ftp_file) {\n                    return self.uploadbox.add([{\n                        mode: \"ftp\",\n                        name: ftp_file.path,\n                        size: ftp_file.size,\n                        path: ftp_file.path\n                    }]);\n                },\n                onremove: function onremove(model_index) {\n                    self.collection.remove(model_index);\n                }\n            }).$el);\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Create a new file */\n    _eventCreate: function _eventCreate() {\n        this.uploadbox.add([{ name: \"New File\", size: 0, mode: \"new\" }]);\n    },\n\n    /** Start upload process */\n    _eventStart: function _eventStart() {\n        if (this.counter.announce != 0 && this.counter.running == 0) {\n            // prepare upload process\n            var self = this;\n            this.upload_size = 0;\n            this.upload_completed = 0;\n            this.collection.each(function (model) {\n                if (model.get(\"status\") == \"init\") {\n                    model.set(\"status\", \"queued\");\n                    self.upload_size += model.get(\"file_size\");\n                }\n            });\n            this.ui_button.model.set({\n                percentage: 0,\n                status: \"success\"\n            });\n            this.counter.running = this.counter.announce;\n            this.history_id = this.app.currentHistory();\n\n            // package ftp files separately, and remove them from queue\n            this._uploadFtp();\n\n            // queue remaining files\n            this.uploadbox.start();\n            this.render();\n        }\n    },\n\n    /** Pause upload process */\n    _eventStop: function _eventStop() {\n        if (this.counter.running > 0) {\n            this.ui_button.model.set(\"status\", \"info\");\n            $(\".upload-top-info\").html(\"Queue will pause after completing the current file...\");\n            this.uploadbox.stop();\n        }\n    },\n\n    /** Remove all */\n    _eventReset: function _eventReset() {\n        if (this.counter.running == 0) {\n            var self = this;\n            this.collection.reset();\n            this.counter.reset();\n            this.uploadbox.reset();\n            this.select_extension.value(this.options.default_extension);\n            this.select_genome.value(this.options.default_genome);\n            this.ui_button.model.set(\"percentage\", 0);\n            this.render();\n        }\n    },\n\n    /** Update extension for all models */\n    _changeExtension: function _changeExtension(extension, defaults_only) {\n        var self = this;\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"init\" && (model.get(\"extension\") == self.options.default_extension || !defaults_only)) {\n                model.set(\"extension\", extension);\n            }\n        });\n    },\n\n    /** Update genome for all models */\n    _changeGenome: function _changeGenome(genome, defaults_only) {\n        var self = this;\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"init\" && (model.get(\"genome\") == self.options.default_genome || !defaults_only)) {\n                model.set(\"genome\", genome);\n            }\n        });\n    },\n\n    /** Package and upload ftp files in a single request */\n    _uploadFtp: function _uploadFtp() {\n        var self = this;\n        var list = [];\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"queued\" && model.get(\"file_mode\") == \"ftp\") {\n                self.uploadbox.remove(model.id);\n                list.push(model);\n            }\n        });\n        if (list.length > 0) {\n            $.uploadpost({\n                data: this.app.toData(list),\n                url: this.app.options.nginx_upload_path,\n                success: function success(message) {\n                    _.each(list, function (model) {\n                        self._eventSuccess(model.id);\n                    });\n                },\n                error: function error(message) {\n                    _.each(list, function (model) {\n                        self._eventError(model.id, message);\n                    });\n                }\n            });\n        }\n    },\n\n    /** Calculate percentage of all queued uploads */\n    _uploadPercentage: function _uploadPercentage(percentage, size) {\n        return (this.upload_completed + percentage * size) / this.upload_size;\n    },\n\n    /** Template */\n    _template: function _template() {\n        return '<div class=\"upload-view-default\">' + '<div class=\"upload-top\">' + '<h6 class=\"upload-top-info\"/>' + \"</div>\" + '<div class=\"upload-box\">' + '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' + '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' + \"<thead>\" + \"<tr>\" + \"<th>Name</th>\" + \"<th>Size</th>\" + \"<th>Type</th>\" + \"<th>Genome</th>\" + \"<th>Settings</th>\" + \"<th>Status</th>\" + \"<th/>\" + \"</tr>\" + \"</thead>\" + \"<tbody/>\" + \"</table>\" + \"</div>\" + '<div class=\"upload-footer\">' + '<span class=\"upload-footer-title\">Type (set all):</span>' + '<span class=\"upload-footer-extension\"/>' + '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' + '<span class=\"upload-footer-title\">Genome (set all):</span>' + '<span class=\"upload-footer-genome\"/>' + \"</div>\" + '<div class=\"upload-buttons\"/>' + \"</div>\";\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 238 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadModel = __webpack_require__(63);\n\nvar _uploadModel2 = _interopRequireDefault(_uploadModel);\n\nvar _uploadSettings = __webpack_require__(74);\n\nvar _uploadSettings2 = _interopRequireDefault(_uploadSettings);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function initialize(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new _uiPopover2.default.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new _uiSelect2.default.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function onchange(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new _uiSelect2.default.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function onchange(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", function () {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\").on(\"click\", function (e) {\n            self.app.showExtensionInfo({\n                $el: $(e.target),\n                title: self.select_extension.text(),\n                extension: self.select_extension.value()\n            });\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // handle settings popover\n        this.$settings.on(\"click\", function (e) {\n            self._showSettings();\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function (e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function () {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function () {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function () {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", function () {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", function () {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", function () {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function render() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function remove() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function _refreshType() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(_utils2.default.bytesToString(options.file_size));\n        this.$mode.removeClass().addClass(\"upload-mode\").addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text.css({\n                width: this.$el.width() - 16 + \"px\",\n                top: this.$el.height() - 8 + \"px\"\n            }).show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function _refreshExtension() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function _refreshGenome() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function _refreshInfo() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function _refreshPercentage() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: percentage + \"%\" });\n        this.$percentage.html(percentage != 100 ? percentage + \"%\" : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function _refreshStatus() {\n        var status = this.model.get(\"status\");\n        this.$symbol.removeClass().addClass(\"upload-symbol\").addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function _refreshFileSize() {\n        this.$size.html(_utils2.default.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function _removeRow() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function _showSettings() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new _uploadSettings2.default(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function _template(options) {\n        return \"<tr id=\\\"upload-row-\" + options.id + \"\\\" class=\\\"upload-row\\\"><td><div class=\\\"upload-text-column\\\"><div class=\\\"upload-mode\\\"/><div class=\\\"upload-title\\\"/><div class=\\\"upload-text\\\"><div class=\\\"upload-text-info\\\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\\\"upload-text-content form-control\\\"/></div></div></td><td><div class=\\\"upload-size\\\"/></td><td><div class=\\\"upload-extension\\\" style=\\\"float: left;\\\"/>&nbsp;&nbsp<div class=\\\"upload-extension-info upload-icon-button fa fa-search\\\"/></td><td><div class=\\\"upload-genome\\\"/></td><td><div class=\\\"upload-settings upload-icon-button fa fa-gear\\\"/></td><td><div class=\\\"upload-info\\\"><div class=\\\"upload-info-text\\\"/><div class=\\\"upload-info-progress progress\\\"><div class=\\\"upload-progress-bar progress-bar progress-bar-success\\\"/><div class=\\\"upload-percentage\\\">0%</div></div></div></td><td><div class=\\\"upload-symbol \" + this.status_classes.init + \"\\\"/></td></tr>\";\n    }\n}); /** Renders the default uploader rows */\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 239 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n/** Contains helpers to limit/lazy load views for backbone views */\n\nexports.default = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.$container = options.$container;\n        this.collection = options.collection;\n        this.new_content = options.new_content;\n        this.max = options.max || 50;\n        this.content_list = {};\n        this.$message = $(\"<div/>\").addClass(\"ui-limitloader\").append(\"...only the first \" + this.max + \" entries are visible.\");\n        this.$container.append(this.$message);\n        this.listenTo(this.collection, \"reset\", this._reset, this);\n        this.listenTo(this.collection, \"add\", this._refresh, this);\n        this.listenTo(this.collection, \"remove\", this._remove, this);\n    },\n\n    /** Checks if the limit has been reached */\n    _done: function _done() {\n        var done = _.size(this.content_list) > this.max;\n        this.$message[done ? \"show\" : \"hide\"]();\n        return done;\n    },\n\n    /** Remove all content */\n    _reset: function _reset() {\n        _.each(this.content_list, function (content) {\n            content.remove();\n        });\n        this.content_list = {};\n        this.$message.hide();\n    },\n\n    /** Remove content */\n    _remove: function _remove(model) {\n        var model_id = model.id;\n        var content = this.content_list[model_id];\n        if (content) {\n            content.remove();\n            delete this.content_list[model_id];\n        }\n        this._refresh();\n    },\n\n    /** Refreshes container content by adding new views if visible */\n    _refresh: function _refresh() {\n        if (!this._done()) {\n            for (var i in this.collection.models) {\n                var model = this.collection.models[i];\n                var view = this.content_list[model.id];\n                if (!this.content_list[model.id]) {\n                    var content = this.new_content(model);\n                    this.content_list[model.id] = content;\n                    if (this._done()) {\n                        break;\n                    }\n                }\n            }\n        }\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 240 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadModel = __webpack_require__(63);\n\nvar _uploadModel2 = _interopRequireDefault(_uploadModel);\n\nvar _compositeRow = __webpack_require__(241);\n\nvar _compositeRow2 = _interopRequireDefault(_compositeRow);\n\nvar _uploadExtension = __webpack_require__(76);\n\nvar _uploadExtension2 = _interopRequireDefault(_uploadExtension);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    collection: new _uploadModel2.default.Collection(),\n    initialize: function initialize(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ftp_upload_site = app.currentFtp();\n        this.setElement(this._template());\n\n        // create button section\n        this.btnStart = new _uiMisc2.default.Button({\n            title: \"Start\",\n            onclick: function onclick() {\n                self._eventStart();\n            }\n        });\n        this.btnClose = new _uiMisc2.default.Button({\n            title: \"Close\",\n            onclick: function onclick() {\n                self.app.modal.hide();\n            }\n        });\n\n        // append buttons to dom\n        _.each([this.btnStart, this.btnClose], function (button) {\n            self.$(\".upload-buttons\").prepend(button.$el);\n        });\n\n        // select extension\n        this.select_extension = new _uiSelect2.default.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, function (ext) {\n                return ext.composite_files;\n            }),\n            onchange: function onchange(extension) {\n                self.collection.reset();\n                var details = _.findWhere(self.list_extensions, {\n                    id: extension\n                });\n                if (details && details.composite_files) {\n                    _.each(details.composite_files, function (item) {\n                        self.collection.add({\n                            id: self.collection.size(),\n                            file_desc: item.description || item.name\n                        });\n                    });\n                }\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\").on(\"click\", function (e) {\n            new _uploadExtension2.default({\n                $el: $(e.target),\n                title: self.select_extension.text(),\n                extension: self.select_extension.value(),\n                list: self.list_extensions,\n                placement: \"top\"\n            });\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // genome extension\n        this.select_genome = new _uiSelect2.default.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome\n        });\n\n        // listener for collection triggers on change in composite datatype and extension selection\n        this.listenTo(this.collection, \"add\", function (model) {\n            self._eventAnnounce(model);\n        });\n        this.listenTo(this.collection, \"change add\", function () {\n            self.render();\n        });\n        this.select_extension.options.onchange(this.select_extension.value());\n        this.render();\n    },\n\n    render: function render() {\n        var model = this.collection.first();\n        if (model && model.get(\"status\") == \"running\") {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        } else {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        }\n        if (this.collection.where({ status: \"ready\" }).length == this.collection.length && this.collection.length > 0) {\n            this.btnStart.enable();\n            this.btnStart.$el.addClass(\"btn-primary\");\n        } else {\n            this.btnStart.disable();\n            this.btnStart.$el.removeClass(\"btn-primary\");\n        }\n        this.$(\".upload-table\")[this.collection.length > 0 ? \"show\" : \"hide\"]();\n    },\n\n    //\n    // upload events / process pipeline\n    //\n\n    /** Builds the basic ui with placeholder rows for each composite data type file */\n    _eventAnnounce: function _eventAnnounce(model) {\n        var upload_row = new _compositeRow2.default(this, { model: model });\n        this.$(\".upload-table > tbody:first\").append(upload_row.$el);\n        this.$(\".upload-table\")[this.collection.length > 0 ? \"show\" : \"hide\"]();\n        upload_row.render();\n    },\n\n    /** Start upload process */\n    _eventStart: function _eventStart() {\n        var self = this;\n        this.collection.each(function (model) {\n            model.set({\n                genome: self.select_genome.value(),\n                extension: self.select_extension.value()\n            });\n        });\n        $.uploadpost({\n            url: this.app.options.nginx_upload_path,\n            data: this.app.toData(this.collection.filter()),\n            success: function success(message) {\n                self._eventSuccess(message);\n            },\n            error: function error(message) {\n                self._eventError(message);\n            },\n            progress: function progress(percentage) {\n                self._eventProgress(percentage);\n            }\n        });\n    },\n\n    /** Refresh progress state */\n    _eventProgress: function _eventProgress(percentage) {\n        this.collection.each(function (it) {\n            it.set(\"percentage\", percentage);\n        });\n    },\n\n    /** Refresh success state */\n    _eventSuccess: function _eventSuccess(message) {\n        this.collection.each(function (it) {\n            it.set(\"status\", \"success\");\n        });\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Refresh error state */\n    _eventError: function _eventError(message) {\n        this.collection.each(function (it) {\n            it.set({ status: \"error\", info: message });\n        });\n    },\n\n    /** Load html template */\n    _template: function _template() {\n        return '<div class=\"upload-view-composite\">' + '<div class=\"upload-top\">' + '<h6 class=\"upload-top-info\"/>' + \"</div>\" + '<div class=\"upload-box\">' + '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' + \"<thead>\" + \"<tr>\" + \"<th/>\" + \"<th/>\" + \"<th>Description</th>\" + \"<th>Name</th>\" + \"<th>Size</th>\" + \"<th>Settings</th>\" + \"<th>Status</th>\" + \"</tr>\" + \"</thead>\" + \"<tbody/>\" + \"</table>\" + \"</div>\" + '<div class=\"upload-footer\">' + '<span class=\"upload-footer-title\">Composite Type:</span>' + '<span class=\"upload-footer-extension\"/>' + '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' + '<span class=\"upload-footer-title\">Genome/Build:</span>' + '<span class=\"upload-footer-genome\"/>' + \"</div>\" + '<div class=\"upload-buttons\"/>' + \"</div>\";\n    }\n}); /** Renders contents of the composite uploader */\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 241 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadSettings = __webpack_require__(74);\n\nvar _uploadSettings2 = _interopRequireDefault(_uploadSettings);\n\nvar _uploadFtp = __webpack_require__(75);\n\nvar _uploadFtp2 = _interopRequireDefault(_uploadFtp);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\n__webpack_require__(77);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-mode fa fa-exclamation text-primary\",\n        ready: \"upload-mode fa fa-check text-success\",\n        running: \"upload-mode fa fa-spinner fa-spin\",\n        success: \"upload-mode fa fa-check\",\n        error: \"upload-mode fa fa-exclamation-triangle\"\n    },\n\n    initialize: function initialize(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$source = this.$(\".upload-source\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$status = this.$(\".upload-status\");\n        this.$text = this.$(\".upload-text\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$file_name = this.$(\".upload-file-name\");\n        this.$file_desc = this.$(\".upload-file-desc\");\n        this.$file_size = this.$(\".upload-file-size\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // build upload functions\n        this.uploadinput = this.$el.uploadinput({\n            ondragover: function ondragover() {\n                self.model.get(\"enabled\") && self.$el.addClass(\"warning\");\n            },\n            ondragleave: function ondragleave() {\n                self.$el.removeClass(\"warning\");\n            },\n            onchange: function onchange(files) {\n                if (self.model.get(\"status\") != \"running\" && files && files.length > 0) {\n                    self.model.reset({\n                        file_data: files[0],\n                        file_name: files[0].name,\n                        file_size: files[0].size,\n                        file_mode: files[0].mode || \"local\"\n                    });\n                    self._refreshReady();\n                }\n            }\n        });\n\n        // source selection popup\n        this.button_menu = new _uiMisc2.default.ButtonMenu({\n            icon: \"fa-caret-down\",\n            title: \"Select\",\n            pull: \"left\"\n        });\n        this.$source.append(this.button_menu.$el);\n        this.button_menu.addMenu({\n            icon: \"fa-laptop\",\n            title: \"Choose local file\",\n            onclick: function onclick() {\n                self.uploadinput.dialog();\n            }\n        });\n        if (this.app.ftp_upload_site) {\n            this.button_menu.addMenu({\n                icon: \"fa-folder-open-o\",\n                title: \"Choose FTP file\",\n                onclick: function onclick() {\n                    self._showFtp();\n                }\n            });\n        }\n        this.button_menu.addMenu({\n            icon: \"fa-edit\",\n            title: \"Paste/Fetch data\",\n            onclick: function onclick() {\n                self.model.reset({\n                    file_mode: \"new\",\n                    file_name: \"New File\"\n                });\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new _uiPopover2.default.View({\n            title: \"Choose FTP file:\",\n            container: this.$source.find(\".ui-button-menu\"),\n            placement: \"right\"\n        });\n\n        // append popup to settings icon\n        this.settings = new _uiPopover2.default.View({\n            title: \"Upload configuration\",\n            container: this.$settings,\n            placement: \"bottom\"\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function (e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n            self._refreshReady();\n        });\n\n        // handle settings popover\n        this.$settings.on(\"click\", function (e) {\n            self._showSettings();\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function () {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function () {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function () {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_name\", function () {\n            self._refreshFileName();\n        });\n        this.listenTo(this.model, \"change:file_mode\", function () {\n            self._refreshMode();\n        });\n        this.listenTo(this.model, \"change:file_size\", function () {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", function () {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", function () {\n            self.remove();\n        });\n    },\n\n    render: function render() {\n        this.$el.attr(\"id\", \"upload-row-\" + this.model.id);\n        this.$file_name.html(_.escape(this.model.get(\"file_name\") || \"-\"));\n        this.$file_desc.html(this.model.get(\"file_desc\") || \"Unavailable\");\n        this.$file_size.html(_utils2.default.bytesToString(this.model.get(\"file_size\")));\n        this.$status.removeClass().addClass(this.status_classes.init);\n    },\n\n    /** Remove view */\n    remove: function remove() {\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    /** Refresh ready or not states */\n    _refreshReady: function _refreshReady() {\n        this.app.collection.each(function (model) {\n            model.set(\"status\", model.get(\"file_size\") > 0 && \"ready\" || \"init\");\n        });\n    },\n\n    /** Refresh mode and e.g. show/hide textarea field */\n    _refreshMode: function _refreshMode() {\n        var file_mode = this.model.get(\"file_mode\");\n        if (file_mode == \"new\") {\n            this.height = this.$el.height();\n            this.$text.css({\n                width: this.$el.width() - 16 + \"px\",\n                top: this.$el.height() - 8 + \"px\"\n            }).show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$text_content.val(\"\").trigger(\"keyup\");\n        } else {\n            this.$el.height(this.height);\n            this.$text.hide();\n        }\n    },\n\n    /** Refresh information */\n    _refreshInfo: function _refreshInfo() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage */\n    _refreshPercentage: function _refreshPercentage() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        if (percentage != 0) {\n            this.$progress_bar.css({ width: percentage + \"%\" });\n        } else {\n            this.$progress_bar.addClass(\"no-transition\");\n            this.$progress_bar.css({ width: \"0%\" });\n            this.$progress_bar[0].offsetHeight;\n            this.$progress_bar.removeClass(\"no-transition\");\n        }\n        this.$percentage.html(percentage != 100 ? percentage + \"%\" : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function _refreshStatus() {\n        var status = this.model.get(\"status\");\n        this.$status.removeClass().addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status != \"running\");\n        this.$text_content.attr(\"disabled\", !this.model.get(\"enabled\"));\n        this.$el.removeClass(\"success danger warning\");\n        if (status == \"running\" || status == \"ready\") {\n            this.model.set(\"percentage\", 0);\n        }\n        this.$source.find(\".button\")[status == \"running\" ? \"addClass\" : \"removeClass\"](\"disabled\");\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.model.set(\"percentage\", 100);\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.model.set(\"percentage\", 0);\n            this.$info_progress.hide();\n            this.$info_text.show();\n        } else {\n            this.$info_progress.show();\n            this.$info_text.hide();\n        }\n    },\n\n    /** File name */\n    _refreshFileName: function _refreshFileName() {\n        this.$file_name.html(this.model.get(\"file_name\") || \"-\");\n    },\n\n    /** File size */\n    _refreshFileSize: function _refreshFileSize() {\n        this.$file_size.html(_utils2.default.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Show/hide ftp popup */\n    _showFtp: function _showFtp() {\n        if (!this.ftp.visible) {\n            var self = this;\n            this.ftp.empty();\n            this.ftp.append(new _uploadFtp2.default({\n                ftp_upload_site: this.app.ftp_upload_site,\n                onchange: function onchange(ftp_file) {\n                    self.ftp.hide();\n                    if (self.model.get(\"status\") != \"running\" && ftp_file) {\n                        self.model.reset({\n                            file_mode: \"ftp\",\n                            file_name: ftp_file.path,\n                            file_size: ftp_file.size,\n                            file_path: ftp_file.path\n                        });\n                        self._refreshReady();\n                    }\n                }\n            }).$el);\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Show/hide settings popup */\n    _showSettings: function _showSettings() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new _uploadSettings2.default(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** Template */\n    _template: function _template() {\n        return '<tr class=\"upload-row\">' + \"<td>\" + '<div class=\"upload-source\"/>' + '<div class=\"upload-text-column\">' + '<div class=\"upload-text\">' + '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' + '<textarea class=\"upload-text-content form-control\"/>' + \"</div>\" + \"</div>\" + \"</td>\" + \"<td>\" + '<div class=\"upload-status\"/>' + \"</td>\" + \"<td>\" + '<div class=\"upload-file-desc upload-title\"/>' + \"</td>\" + \"<td>\" + '<div class=\"upload-file-name upload-title\"/>' + \"</td>\" + \"<td>\" + '<div class=\"upload-file-size upload-size\"/>' + \"</td>\" + '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' + \"<td>\" + '<div class=\"upload-info\">' + '<div class=\"upload-info-text\"/>' + '<div class=\"upload-info-progress progress\">' + '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' + '<div class=\"upload-percentage\">0%</div>' + \"</div>\" + \"</div>\" + \"</td>\" + \"</tr>\";\n    }\n}); /** Renders the composite upload row view */\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 242 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadModel = __webpack_require__(63);\n\nvar _uploadModel2 = _interopRequireDefault(_uploadModel);\n\nvar _collectionRow = __webpack_require__(243);\n\nvar _collectionRow2 = _interopRequireDefault(_collectionRow);\n\nvar _uploadFtp = __webpack_require__(75);\n\nvar _uploadFtp2 = _interopRequireDefault(_uploadFtp);\n\nvar _uploadExtension = __webpack_require__(76);\n\nvar _uploadExtension2 = _interopRequireDefault(_uploadExtension);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _listCollectionCreator = __webpack_require__(78);\n\nvar _listCollectionCreator2 = _interopRequireDefault(_listCollectionCreator);\n\n__webpack_require__(77);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Renders contents of the collection uploader */\nexports.default = Backbone.View.extend({\n    // current upload size in bytes\n    upload_size: 0,\n\n    // contains upload row models\n    collection: new _uploadModel2.default.Collection(),\n\n    // keeps track of the current uploader state\n    counter: {\n        announce: 0,\n        success: 0,\n        error: 0,\n        running: 0,\n        reset: function reset() {\n            this.announce = this.success = this.error = this.running = 0;\n        }\n    },\n\n    initialize: function initialize(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ui_button = app.ui_button;\n        this.ftp_upload_site = app.currentFtp();\n        this.setElement(this._template());\n\n        // append buttons to dom\n        this.btnLocal = new _uiMisc2.default.Button({\n            id: \"btn-local\",\n            title: \"Choose local files\",\n            onclick: function onclick() {\n                self.uploadbox.select();\n            },\n            icon: \"fa fa-laptop\"\n        });\n        this.btnFtp = new _uiMisc2.default.Button({\n            id: \"btn-ftp\",\n            title: \"Choose FTP files\",\n            onclick: function onclick() {\n                self._eventFtp();\n            },\n            icon: \"fa fa-folder-open-o\"\n        });\n        this.btnCreate = new _uiMisc2.default.Button({\n            id: \"btn-new\",\n            title: \"Paste/Fetch data\",\n            onclick: function onclick() {\n                self._eventCreate();\n            },\n            icon: \"fa fa-edit\"\n        });\n        this.btnStart = new _uiMisc2.default.Button({\n            id: \"btn-start\",\n            title: \"Start\",\n            onclick: function onclick() {\n                self._eventStart();\n            }\n        });\n        this.btnBuild = new _uiMisc2.default.Button({\n            id: \"btn-build\",\n            title: \"Build\",\n            onclick: function onclick() {\n                self._eventBuild();\n            }\n        });\n        this.btnStop = new _uiMisc2.default.Button({\n            id: \"btn-stop\",\n            title: \"Pause\",\n            onclick: function onclick() {\n                self._eventStop();\n            }\n        });\n        this.btnReset = new _uiMisc2.default.Button({\n            id: \"btn-reset\",\n            title: \"Reset\",\n            onclick: function onclick() {\n                self._eventReset();\n            }\n        });\n        this.btnClose = new _uiMisc2.default.Button({\n            id: \"btn-close\",\n            title: \"Close\",\n            onclick: function onclick() {\n                self.app.modal.hide();\n            }\n        });\n        _.each([this.btnLocal, this.btnFtp, this.btnCreate, this.btnStop, this.btnReset, this.btnStart, this.btnBuild, this.btnClose], function (button) {\n            self.$(\".upload-buttons\").prepend(button.$el);\n        });\n\n        // file upload\n        this.uploadbox = this.$(\".upload-box\").uploadbox({\n            url: this.app.options.nginx_upload_path,\n            announce: function announce(index, file) {\n                self._eventAnnounce(index, file);\n            },\n            initialize: function initialize(index) {\n                return self.app.toData([self.collection.get(index)], self.history_id);\n            },\n            progress: function progress(index, percentage) {\n                self._eventProgress(index, percentage);\n            },\n            success: function success(index, message) {\n                self._eventSuccess(index, message);\n            },\n            error: function error(index, message) {\n                self._eventError(index, message);\n            },\n            complete: function complete() {\n                self._eventComplete();\n            },\n            ondragover: function ondragover() {\n                self.$(\".upload-box\").addClass(\"highlight\");\n            },\n            ondragleave: function ondragleave() {\n                self.$(\".upload-box\").removeClass(\"highlight\");\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new _uiPopover2.default.View({\n            title: \"FTP files\",\n            container: this.btnFtp.$el\n        });\n\n        // select extension\n        this.select_extension = new _uiSelect2.default.View({\n            css: \"upload-footer-selection-compressed\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, function (ext) {\n                return !ext.composite_files;\n            }),\n            value: this.options.default_extension,\n            onchange: function onchange(extension) {\n                self.updateExtension(extension);\n            }\n        });\n\n        this.collectionType = \"list\";\n        this.select_collection = new _uiSelect2.default.View({\n            css: \"upload-footer-selection-compressed\",\n            container: this.$(\".upload-footer-collection-type\"),\n            data: [{ id: \"list\", text: \"List\" }, { id: \"paired\", text: \"Paired\" }, { id: \"list:paired\", text: \"List of Pairs\" }],\n            value: \"list\",\n            onchange: function onchange(collectionType) {\n                self.updateCollectionType(collectionType);\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\").on(\"click\", function (e) {\n            new _uploadExtension2.default({\n                $el: $(e.target),\n                title: self.select_extension.text(),\n                extension: self.select_extension.value(),\n                list: self.list_extensions,\n                placement: \"top\"\n            });\n        }).on(\"mousedown\", function (e) {\n            e.preventDefault();\n        });\n\n        // genome extension\n        this.select_genome = new _uiSelect2.default.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome,\n            onchange: function onchange(genome) {\n                self.updateGenome(genome);\n            }\n        });\n\n        // events\n        this.collection.on(\"remove\", function (model) {\n            self._eventRemove(model);\n        });\n        this._updateScreen();\n    },\n\n    /** A new file has been dropped/selected through the uploadbox plugin */\n    _eventAnnounce: function _eventAnnounce(index, file) {\n        this.counter.announce++;\n        var new_model = new _uploadModel2.default.Model({\n            id: index,\n            file_name: file.name,\n            file_size: file.size,\n            file_mode: file.mode || \"local\",\n            file_path: file.path,\n            file_data: file,\n            extension: this.select_extension.value(),\n            genome: this.select_genome.value()\n        });\n        this.collection.add(new_model);\n        var upload_row = new _collectionRow2.default(this, { model: new_model });\n        this.$(\".upload-table > tbody:first\").append(upload_row.$el);\n        this._updateScreen();\n        upload_row.render();\n    },\n\n    /** Progress */\n    _eventProgress: function _eventProgress(index, percentage) {\n        var it = this.collection.get(index);\n        it.set(\"percentage\", percentage);\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(percentage, it.get(\"file_size\")));\n    },\n\n    /** Success */\n    _eventSuccess: function _eventSuccess(index, message) {\n        // var hdaId = message[\"outputs\"][0][\"id\"];\n        var hids = _.pluck(message[\"outputs\"], \"hid\");\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"success\", hids: hids });\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(100, it.get(\"file_size\")));\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.success++;\n        this._updateScreen();\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Error */\n    _eventError: function _eventError(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"error\", info: message });\n        this.ui_button.model.set({\n            percentage: this._uploadPercentage(100, it.get(\"file_size\")),\n            status: \"danger\"\n        });\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.error++;\n        this._updateScreen();\n    },\n\n    /** Queue is done */\n    _eventComplete: function _eventComplete() {\n        this.collection.each(function (model) {\n            model.get(\"status\") == \"queued\" && model.set(\"status\", \"init\");\n        });\n        this.counter.running = 0;\n        this._updateScreen();\n    },\n\n    _eventBuild: function _eventBuild() {\n        var allHids = [];\n        _.forEach(this.collection.models, function (upload) {\n            allHids.push.apply(allHids, upload.get(\"hids\"));\n        });\n        var models = _.map(allHids, function (hid) {\n            return Galaxy.currHistoryPanel.collection.getByHid(hid);\n        });\n        var selection = new Galaxy.currHistoryPanel.collection.constructor(models);\n        // I'm building the selection wrong because I need to set this historyId directly.\n        selection.historyId = Galaxy.currHistoryPanel.collection.historyId;\n        Galaxy.currHistoryPanel.buildCollection(this.collectionType, selection, true);\n        this.counter.running = 0;\n        this._updateScreen();\n        this._eventReset();\n        this.app.modal.hide();\n    },\n\n    /** Remove model from upload list */\n    _eventRemove: function _eventRemove(model) {\n        var status = model.get(\"status\");\n        if (status == \"success\") {\n            this.counter.success--;\n        } else if (status == \"error\") {\n            this.counter.error--;\n        } else {\n            this.counter.announce--;\n        }\n        this.uploadbox.remove(model.id);\n        this._updateScreen();\n    },\n\n    //\n    // events triggered by this view\n    //\n\n    /** Show/hide ftp popup */\n    _eventFtp: function _eventFtp() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append(new _uploadFtp2.default({\n                collection: this.collection,\n                ftp_upload_site: this.ftp_upload_site,\n                onadd: function onadd(ftp_file) {\n                    return self.uploadbox.add([{\n                        mode: \"ftp\",\n                        name: ftp_file.path,\n                        size: ftp_file.size,\n                        path: ftp_file.path\n                    }]);\n                },\n                onremove: function onremove(model_index) {\n                    self.collection.remove(model_index);\n                }\n            }).$el);\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Create a new file */\n    _eventCreate: function _eventCreate() {\n        this.uploadbox.add([{ name: \"New File\", size: 0, mode: \"new\" }]);\n    },\n\n    /** Start upload process */\n    _eventStart: function _eventStart() {\n        if (this.counter.announce == 0 || this.counter.running > 0) {\n            return;\n        }\n        var self = this;\n        this.upload_size = 0;\n        this.upload_completed = 0;\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"init\") {\n                model.set(\"status\", \"queued\");\n                self.upload_size += model.get(\"file_size\");\n            }\n        });\n        this.ui_button.model.set({ percentage: 0, status: \"success\" });\n        this.counter.running = this.counter.announce;\n        this.history_id = this.app.currentHistory();\n        this.uploadbox.start();\n        this._updateScreen();\n    },\n\n    /** Pause upload process */\n    _eventStop: function _eventStop() {\n        if (this.counter.running > 0) {\n            this.ui_button.model.set(\"status\", \"info\");\n            $(\".upload-top-info\").html(\"Queue will pause after completing the current file...\");\n            this.uploadbox.stop();\n        }\n    },\n\n    /** Remove all */\n    _eventReset: function _eventReset() {\n        if (this.counter.running == 0) {\n            this.collection.reset();\n            this.counter.reset();\n            this.uploadbox.reset();\n            this.select_extension.value(this.options.default_extension);\n            this.select_genome.value(this.options.default_genome);\n            this.ui_button.model.set(\"percentage\", 0);\n            this._updateScreen();\n        }\n    },\n\n    /** Update extension for all models */\n    updateExtension: function updateExtension(extension, defaults_only) {\n        var self = this;\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"init\" && (model.get(\"extension\") == self.options.default_extension || !defaults_only)) {\n                model.set(\"extension\", extension);\n            }\n        });\n    },\n\n    /** Update collection type */\n    updateCollectionType: function updateCollectionType(collectionType) {\n        var self = this;\n        this.collectionType = collectionType;\n    },\n\n    /** Update genome for all models */\n    updateGenome: function updateGenome(genome, defaults_only) {\n        var self = this;\n        this.collection.each(function (model) {\n            if (model.get(\"status\") == \"init\" && (model.get(\"genome\") == self.options.default_genome || !defaults_only)) {\n                model.set(\"genome\", genome);\n            }\n        });\n    },\n\n    /** Set screen */\n    _updateScreen: function _updateScreen() {\n        var message = \"\";\n        if (this.counter.announce == 0) {\n            if (this.uploadbox.compatible()) {\n                message = \"&nbsp;\";\n            } else {\n                message = \"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.\";\n            }\n        } else {\n            if (this.counter.running == 0) {\n                message = \"You added \" + this.counter.announce + \" file(s) to the queue. Add more files or click 'Start' to proceed.\";\n            } else {\n                message = \"Please wait...\" + this.counter.announce + \" out of \" + this.counter.running + \" remaining.\";\n            }\n        }\n        this.$(\".upload-top-info\").html(message);\n        var enable_reset = this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0;\n        var enable_start = this.counter.running == 0 && this.counter.announce > 0;\n        var enable_build = this.counter.running == 0 && this.counter.announce == 0 && this.counter.success > 0 && this.counter.error == 0;\n        var enable_sources = this.counter.running == 0;\n        var show_table = this.counter.announce + this.counter.success + this.counter.error > 0;\n        this.btnReset[enable_reset ? \"enable\" : \"disable\"]();\n        this.btnStart[enable_start ? \"enable\" : \"disable\"]();\n        this.btnStart.$el[enable_start ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnBuild[enable_build ? \"enable\" : \"disable\"]();\n        this.btnBuild.$el[enable_build ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnStop[this.counter.running > 0 ? \"enable\" : \"disable\"]();\n        this.btnLocal[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnCreate[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp.$el[this.ftp_upload_site ? \"show\" : \"hide\"]();\n        this.$(\".upload-table\")[show_table ? \"show\" : \"hide\"]();\n        this.$(\".upload-helper\")[show_table ? \"hide\" : \"show\"]();\n    },\n\n    /** Calculate percentage of all queued uploads */\n    _uploadPercentage: function _uploadPercentage(percentage, size) {\n        return (this.upload_completed + percentage * size) / this.upload_size;\n    },\n\n    /** Template */\n    _template: function _template() {\n        return '<div class=\"upload-view-default\">' + '<div class=\"upload-top\">' + '<h6 class=\"upload-top-info\"/>' + \"</div>\" + '<div class=\"upload-box\">' + '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' + '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' + \"<thead>\" + \"<tr>\" + \"<th>Name</th>\" + \"<th>Size</th>\" + \"<th>Status</th>\" + \"<th/>\" + \"</tr>\" + \"</thead>\" + \"<tbody/>\" + \"</table>\" + \"</div>\" + '<div class=\"upload-footer\">' + '<span class=\"upload-footer-title-compressed\">Collection Type:</span>' + '<span class=\"upload-footer-collection-type\"/>' + '<span class=\"upload-footer-title-compressed\">File Type:</span>' + '<span class=\"upload-footer-extension\"/>' + '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' + '<span class=\"upload-footer-title-compressed\">Genome (set all):</span>' + '<span class=\"upload-footer-genome\"/>' + \"</div>\" + '<div class=\"upload-buttons\"/>' + \"</div>\";\n    }\n});\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 243 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uploadModel = __webpack_require__(63);\n\nvar _uploadModel2 = _interopRequireDefault(_uploadModel);\n\nvar _uploadSettings = __webpack_require__(74);\n\nvar _uploadSettings2 = _interopRequireDefault(_uploadSettings);\n\nvar _uiPopover = __webpack_require__(47);\n\nvar _uiPopover2 = _interopRequireDefault(_uiPopover);\n\nvar _uiSelect = __webpack_require__(56);\n\nvar _uiSelect2 = _interopRequireDefault(_uiSelect);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.default = Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function initialize(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title-extended\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new _uiPopover2.default.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // handle click event\n        this.$symbol.on(\"click\", function () {\n            self._removeRow();\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", function (e) {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", function () {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", function () {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", function () {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_size\", function () {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", function () {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", function () {\n            self.remove();\n        });\n    },\n\n    render: function render() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(_utils2.default.bytesToString(options.file_size));\n        this.$mode.removeClass().addClass(\"upload-mode\").addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text.css({\n                width: this.$el.width() - 16 + \"px\",\n                top: this.$el.height() - 8 + \"px\"\n            }).show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function _refreshInfo() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(\"<strong>Failed: </strong>\" + info).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function _refreshPercentage() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: percentage + \"%\" });\n        this.$percentage.html(percentage != 100 ? percentage + \"%\" : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function _refreshStatus() {\n        var status = this.model.get(\"status\");\n        this.$symbol.removeClass().addClass(\"upload-symbol\").addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function _refreshFileSize() {\n        this.$size.html(_utils2.default.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function _removeRow() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function _showSettings() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new _uploadSettings2.default(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function _template(options) {\n        return \"<tr id=\\\"upload-row-\" + options.id + \"\\\" class=\\\"upload-row\\\"><td><div class=\\\"upload-text-column\\\"><div class=\\\"upload-mode\\\"/><div class=\\\"upload-title-extended\\\"/><div class=\\\"upload-text\\\"><div class=\\\"upload-text-info\\\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\\\"upload-text-content form-control\\\"/></div></div></td><td><div class=\\\"upload-size\\\"/></td><td><div class=\\\"upload-info\\\"><div class=\\\"upload-info-text\\\"/><div class=\\\"upload-info-progress progress\\\"><div class=\\\"upload-progress-bar progress-bar progress-bar-success\\\"/><div class=\\\"upload-percentage\\\">0%</div></div></div></td><td><div class=\\\"upload-symbol \" + this.status_classes.init + \"\\\"/></td></tr>\";\n    }\n}); /** Renders the collection uploader rows */\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 244 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _optionsMenu = __webpack_require__(245);\n\nvar _optionsMenu2 = _interopRequireDefault(_optionsMenu);\n\nvar _historyViewEditCurrent = __webpack_require__(246);\n\nvar _historyViewEditCurrent2 = _interopRequireDefault(_historyViewEditCurrent);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** the right hand panel in the analysis page that shows the current history */\nvar HistoryPanel = Backbone.View.extend({\n    initialize: function initialize(page, options) {\n        var self = this;\n        this.userIsAnonymous = Galaxy.user.isAnonymous();\n        this.allow_user_dataset_purge = options.config.allow_user_dataset_purge;\n        this.root = options.root;\n\n        // view of the current history\n        this.historyView = new _historyViewEditCurrent2.default.CurrentHistoryView({\n            className: _historyViewEditCurrent2.default.CurrentHistoryView.prototype.className + \" middle\",\n            purgeAllowed: this.allow_user_dataset_purge,\n            linkTarget: \"galaxy_main\"\n        });\n\n        // add history panel to Galaxy object\n        Galaxy.currHistoryPanel = this.historyView;\n        Galaxy.currHistoryPanel.listenToGalaxy(Galaxy);\n\n        // build buttons\n        this.buttonRefresh = new _uiMisc2.default.ButtonLink({\n            id: \"history-refresh-button\",\n            title: \"Refresh history\",\n            cls: \"panel-header-button\",\n            icon: \"fa fa-refresh\",\n            onclick: function onclick() {\n                self.historyView.loadCurrentHistory();\n            }\n        });\n        this.buttonOptions = new _uiMisc2.default.ButtonLink({\n            id: \"history-options-button\",\n            title: \"History options\",\n            cls: \"panel-header-button\",\n            target: \"galaxy_main\",\n            icon: \"fa fa-cog\",\n            href: this.root + \"root/history_options\"\n        });\n        this.buttonViewMulti = new _uiMisc2.default.ButtonLink({\n            id: \"history-view-multi-button\",\n            title: \"View all histories\",\n            cls: \"panel-header-button\",\n            icon: \"fa fa-columns\",\n            href: this.root + \"history/view_multiple\"\n        });\n\n        // define components\n        this.model = new Backbone.Model({\n            cls: \"history-right-panel\",\n            title: (0, _localization2.default)(\"History\"),\n            buttons: [this.buttonRefresh, this.buttonOptions, this.buttonViewMulti]\n        });\n\n        // build body template and connect history view\n        this.setElement(this._template());\n        this.historyView.setElement(this.$el);\n        this.historyView.connectToQuotaMeter(Galaxy.quotaMeter);\n        this.historyView.loadCurrentHistory();\n\n        // fetch to update the quota meter adding 'current' for any anon-user's id\n        Galaxy.listenTo(this.historyView, \"history-size-change\", function () {\n            Galaxy.user.fetch({\n                url: Galaxy.user.urlRoot() + \"/\" + (Galaxy.user.id || \"current\")\n            });\n        });\n    },\n\n    render: function render() {\n        this.optionsMenu = (0, _optionsMenu2.default)(this.buttonOptions.$el, {\n            anonymous: this.userIsAnonymous,\n            purgeAllowed: this.allow_user_dataset_purge,\n            root: this.root\n        });\n        this.buttonViewMulti.$el[!this.userIsAnonymous ? \"show\" : \"hide\"]();\n    },\n\n    /** add history view div */\n    _template: function _template(data) {\n        return ['<div id=\"current-history-panel\" class=\"history-panel middle\"/>'].join(\"\");\n    },\n\n    toString: function toString() {\n        return \"historyPanel\";\n    }\n});\n\nexports.default = HistoryPanel;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ }),\n/* 245 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function($, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _popupMenu = __webpack_require__(19);\n\nvar _popupMenu2 = _interopRequireDefault(_popupMenu);\n\nvar _copyDialog = __webpack_require__(125);\n\nvar _copyDialog2 = _interopRequireDefault(_copyDialog);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nvar _webhooks = __webpack_require__(13);\n\nvar _webhooks2 = _interopRequireDefault(_webhooks);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// ============================================================================\nvar menu = [{\n    html: (0, _localization2.default)(\"History Lists\"),\n    header: true\n}, {\n    html: (0, _localization2.default)(\"Saved Histories\"),\n    href: \"histories/list\",\n    target: \"_top\"\n}, {\n    html: (0, _localization2.default)(\"Histories Shared with Me\"),\n    href: \"histories/list_shared\",\n    target: \"_top\"\n}, {\n    html: (0, _localization2.default)(\"Current History\"),\n    header: true,\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Create New\"),\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            Galaxy.currHistoryPanel.createNewHistory();\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Copy History\"),\n    func: function func() {\n        (0, _copyDialog2.default)(Galaxy.currHistoryPanel.model).done(function () {\n            Galaxy.currHistoryPanel.loadCurrentHistory();\n        });\n    }\n}, {\n    html: (0, _localization2.default)(\"Share or Publish\"),\n    href: \"history/sharing\"\n}, {\n    html: (0, _localization2.default)(\"Show Structure\"),\n    href: \"history/display_structured\",\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Extract Workflow\"),\n    href: \"workflow/build_from_current_history\"\n}, {\n    html: (0, _localization2.default)(\"Delete\"),\n    anon: true,\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel && confirm((0, _localization2.default)(\"Really delete the current history?\"))) {\n            Galaxy.currHistoryPanel.model._delete().done(function () {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            });\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Delete Permanently\"),\n    purge: true,\n    anon: true,\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel && confirm((0, _localization2.default)(\"Really delete the current history permanently? This cannot be undone.\"))) {\n            Galaxy.currHistoryPanel.model.purge().done(function () {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            });\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Dataset Actions\"),\n    header: true,\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Copy Datasets\"),\n    href: \"dataset/copy_datasets\"\n}, {\n    html: (0, _localization2.default)(\"Dataset Security\"),\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel && Galaxy.router) {\n            Galaxy.router.push(\"/histories/permissions?id=\" + Galaxy.currHistoryPanel.model.id);\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Resume Paused Jobs\"),\n    href: \"history/resume_paused_jobs?current=True\",\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Collapse Expanded Datasets\"),\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            Galaxy.currHistoryPanel.collapseAll();\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Unhide Hidden Datasets\"),\n    anon: true,\n    func: function func() {\n        // TODO: Deprecate this functionality and replace with group dataset selector and action combination\n        if (Galaxy && Galaxy.currHistoryPanel && confirm((0, _localization2.default)(\"Really unhide all hidden datasets?\"))) {\n            $.post(Galaxy.root + \"history/adjust_hidden\", { user_action: \"unhide\" }, function () {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            });\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Delete Hidden Datasets\"),\n    anon: true,\n    func: function func() {\n        // TODO: Deprecate this functionality and replace with group dataset selector and action combination\n        if (Galaxy && Galaxy.currHistoryPanel && confirm((0, _localization2.default)(\"Really delete all hidden datasets?\"))) {\n            $.post(Galaxy.root + \"history/adjust_hidden\", { user_action: \"delete\" }, function () {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            });\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Purge Deleted Datasets\"),\n    confirm: (0, _localization2.default)(\"Really delete all deleted datasets permanently? This cannot be undone.\"),\n    href: \"history/purge_deleted_datasets\",\n    purge: true,\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Downloads\"),\n    header: true\n}, {\n    html: (0, _localization2.default)(\"Export Tool Citations\"),\n    anon: true,\n    func: function func() {\n        if (Galaxy && Galaxy.currHistoryPanel && Galaxy.router) {\n            Galaxy.router.push(\"/histories/citations?id=\" + Galaxy.currHistoryPanel.model.id);\n        }\n    }\n}, {\n    html: (0, _localization2.default)(\"Export History to File\"),\n    href: \"history/export_archive?preview=True\",\n    anon: true\n}, {\n    html: (0, _localization2.default)(\"Other Actions\"),\n    header: true\n}, {\n    html: (0, _localization2.default)(\"Import from File\"),\n    href: \"history/import_archive\"\n}];\n\n// Webhooks\n_webhooks2.default.add({\n    url: \"api/webhooks/history-menu/all\",\n    async: false, // (hypothetically) slows down the performance\n    callback: function callback(webhooks) {\n        var webhooks_menu = [];\n\n        $.each(webhooks.models, function (index, model) {\n            var webhook = model.toJSON();\n            if (webhook.activate) {\n                webhooks_menu.push({\n                    html: (0, _localization2.default)(webhook.config.title),\n                    // func: function() {},\n                    anon: true\n                });\n            }\n        });\n\n        if (webhooks_menu.length > 0) {\n            webhooks_menu.unshift({\n                html: (0, _localization2.default)(\"Webhooks\"),\n                header: true\n            });\n            $.merge(menu, webhooks_menu);\n        }\n    }\n});\n\nfunction buildMenu(isAnon, purgeAllowed, urlRoot) {\n    return _.clone(menu).filter(function (menuOption) {\n        if (isAnon && !menuOption.anon) {\n            return false;\n        }\n        if (!purgeAllowed && menuOption.purge) {\n            return false;\n        }\n\n        //TODO:?? hard-coded galaxy_main\n        if (menuOption.href) {\n            menuOption.href = urlRoot + menuOption.href;\n            menuOption.target = menuOption.target || \"galaxy_main\";\n        }\n\n        if (menuOption.confirm) {\n            menuOption.func = function () {\n                if (confirm(menuOption.confirm)) {\n                    galaxy_main.location = menuOption.href;\n                }\n            };\n        }\n        return true;\n    });\n}\n\nvar create = function create($button, options) {\n    options = options || {};\n    var isAnon = options.anonymous === undefined ? true : options.anonymous;\n    var purgeAllowed = options.purgeAllowed || false;\n    var menu = buildMenu(isAnon, purgeAllowed, Galaxy.root);\n    //console.debug( 'menu:', menu );\n    return new _popupMenu2.default($button, menu);\n};\n\n// ============================================================================\nexports.default = create;\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 246 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, $, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _historyModel = __webpack_require__(82);\n\nvar _historyModel2 = _interopRequireDefault(_historyModel);\n\nvar _historyViewEdit = __webpack_require__(248);\n\nvar _historyViewEdit2 = _interopRequireDefault(_historyViewEdit);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// ============================================================================\n/** session storage for history panel preferences (and to maintain state)\n */\nvar HistoryViewPrefs = _baseMvc2.default.SessionStorageModel.extend(\n/** @lends HistoryViewPrefs.prototype */{\n    defaults: {\n        /** should the tags editor be shown or hidden initially? */\n        tagsEditorShown: false,\n        /** should the annotation editor be shown or hidden initially? */\n        annotationEditorShown: false,\n        ///** what is the currently focused content (dataset or collection) in the current history?\n        // *      (the history panel will highlight and scroll to the focused content view)\n        // */\n        //focusedContentId : null\n        /** Current scroll position */\n        scrollPosition: 0\n    },\n    toString: function toString() {\n        return \"HistoryViewPrefs(\" + JSON.stringify(this.toJSON()) + \")\";\n    }\n});\n\n/** key string to store panel prefs (made accessible on class so you can access sessionStorage directly) */\nHistoryViewPrefs.storageKey = function storageKey() {\n    return \"history-panel\";\n};\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = _historyViewEdit2.default.HistoryViewEdit;\n// used in root/index.mako\n/** @class View/Controller for the user's current history model as used in the history\n *      panel (current right hand panel) of the analysis page.\n *\n *  The only history panel that:\n *      will poll for updates.\n *      displays datasets in reverse hid order.\n */\nvar CurrentHistoryView = _super.extend(\n/** @lends CurrentHistoryView.prototype */{\n    className: _super.prototype.className + \" current-history-panel\",\n\n    /** override to use drilldown (and not foldout) for how collections are displayed */\n    HDCAViewClass: _super.prototype.HDCAViewClass.extend({\n        foldoutStyle: \"drilldown\"\n    }),\n\n    emptyMsg: [(0, _localization2.default)(\"This history is empty\"), \". \", (0, _localization2.default)(\"You can \"), '<a class=\"uploader-link\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"load your own data\"), \"</a>\", (0, _localization2.default)(\" or \"), '<a class=\"get-data-link\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"get data from an external source\"), \"</a>\"].join(\"\"),\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events */\n    initialize: function initialize(attributes) {\n        attributes = attributes || {};\n\n        // ---- persistent preferences\n        /** maintain state / preferences over page loads */\n        this.preferences = new HistoryViewPrefs(_.extend({\n            id: HistoryViewPrefs.storageKey()\n        }, _.pick(attributes, _.keys(HistoryViewPrefs.prototype.defaults))));\n\n        _super.prototype.initialize.call(this, attributes);\n\n        /** sub-views that will overlay this panel (collections) */\n        this.panelStack = [];\n\n        /** id of currently focused content */\n        this.currentContentId = attributes.currentContentId || null;\n        //NOTE: purposely not sent to localstorage since panel recreation roughly lines up with a reset of this value\n    },\n\n    /** Override to cache the current scroll position with a listener */\n    _setUpListeners: function _setUpListeners() {\n        _super.prototype._setUpListeners.call(this);\n\n        var panel = this;\n        // reset scroll position when there's a new history\n        this.on(\"new-model\", function () {\n            panel.preferences.set(\"scrollPosition\", 0);\n        });\n    },\n\n    // ------------------------------------------------------------------------ loading history/item models\n    // TODO: next three more appropriate moved to the app level\n    /** (re-)loads the user's current history & contents w/ details */\n    loadCurrentHistory: function loadCurrentHistory() {\n        return this.loadHistory(null, {\n            url: Galaxy.root + \"history/current_history_json\"\n        });\n    },\n\n    /** loads a history & contents w/ details and makes them the current history */\n    switchToHistory: function switchToHistory(historyId, attributes) {\n        if (Galaxy.user.isAnonymous()) {\n            this.trigger(\"error\", (0, _localization2.default)(\"You must be logged in to switch histories\"), (0, _localization2.default)(\"Anonymous user\"));\n            return $.when();\n        }\n        return this.loadHistory(historyId, {\n            url: Galaxy.root + \"history/set_as_current?id=\" + historyId\n        });\n    },\n\n    /** creates a new history on the server and sets it as the user's current history */\n    createNewHistory: function createNewHistory(attributes) {\n        if (Galaxy.user.isAnonymous()) {\n            this.trigger(\"error\", (0, _localization2.default)(\"You must be logged in to create histories\"), (0, _localization2.default)(\"Anonymous user\"));\n            return $.when();\n        }\n        return this.loadHistory(null, {\n            url: Galaxy.root + \"history/create_new_current\"\n        });\n    },\n\n    /** release/free/shutdown old models and set up panel for new models */\n    setModel: function setModel(model, attributes, render) {\n        _super.prototype.setModel.call(this, model, attributes, render);\n        if (this.model && this.model.id) {\n            this.log(\"checking for updates\");\n            this.model.checkForUpdates();\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ history/content event listening\n    /** listening for history events */\n    _setUpModelListeners: function _setUpModelListeners() {\n        _super.prototype._setUpModelListeners.call(this);\n        // re-broadcast any model change events so that listeners don't have to re-bind to each history\n        return this.listenTo(this.model, {\n            \"change:nice_size change:size\": function changeNice_sizeChangeSize() {\n                this.trigger(\"history-size-change\", this, this.model, arguments);\n            },\n            \"change:id\": function changeId() {\n                this.once(\"loading-done\", function () {\n                    this.model.checkForUpdates();\n                });\n            }\n        });\n    },\n\n    /** listening for collection events */\n    _setUpCollectionListeners: function _setUpCollectionListeners() {\n        _super.prototype._setUpCollectionListeners.call(this);\n        // if a hidden item is created (gen. by a workflow), moves thru the updater to the ready state,\n        //  then: remove it from the collection if the panel is set to NOT show hidden datasets\n        this.listenTo(this.collection, \"state:ready\", function (model, newState, oldState) {\n            if (!model.get(\"visible\") && !this.collection.storage.includeHidden()) {\n                this.removeItemView(model);\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** override to add a handler to capture the scroll position when the parent scrolls */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        $where = $where || this.$el;\n        // console.log( '_setUpBehaviors', this.$scrollContainer( $where ).get(0), this.$list( $where ) );\n        // we need to call this in _setUpBehaviors which is called after render since the $el\n        // may not be attached to $el.parent and $scrollContainer() may not work\n        var panel = this;\n        _super.prototype._setUpBehaviors.call(panel, $where);\n\n        // cache the handler to remove and re-add so we don't pile up the handlers\n        if (!this._debouncedScrollCaptureHandler) {\n            this._debouncedScrollCaptureHandler = _.debounce(function scrollCapture() {\n                // cache the scroll position (only if visible)\n                if (panel.$el.is(\":visible\")) {\n                    panel.preferences.set(\"scrollPosition\", $(this).scrollTop());\n                }\n            }, 40);\n        }\n\n        panel.$scrollContainer($where).off(\"scroll\", this._debouncedScrollCaptureHandler).on(\"scroll\", this._debouncedScrollCaptureHandler);\n        return panel;\n    },\n\n    /** In this override, handle null models and move the search input to the top */\n    _buildNewRender: function _buildNewRender() {\n        if (!this.model) {\n            return $();\n        }\n        var $newRender = _super.prototype._buildNewRender.call(this);\n        $newRender.find(\".search\").prependTo($newRender.find(\"> .controls\"));\n        this._renderQuotaMessage($newRender);\n        return $newRender;\n    },\n\n    /** render the message displayed when a user is over quota and can't run jobs */\n    _renderQuotaMessage: function _renderQuotaMessage($whereTo) {\n        $whereTo = $whereTo || this.$el;\n        return $(this.templates.quotaMsg({}, this)).prependTo($whereTo.find(\".messages\"));\n    },\n\n    /** In this override, get and set current panel preferences when editor is used */\n    _renderTags: function _renderTags($where) {\n        var panel = this;\n        // render tags and show/hide based on preferences\n        _super.prototype._renderTags.call(panel, $where);\n        if (panel.preferences.get(\"tagsEditorShown\")) {\n            panel.tagsEditor.toggle(true);\n        }\n        // store preference when shown or hidden\n        panel.listenTo(panel.tagsEditor, \"hiddenUntilActivated:shown hiddenUntilActivated:hidden\", function (tagsEditor) {\n            panel.preferences.set(\"tagsEditorShown\", tagsEditor.hidden);\n        });\n    },\n\n    /** In this override, get and set current panel preferences when editor is used */\n    _renderAnnotation: function _renderAnnotation($where) {\n        var panel = this;\n        // render annotation and show/hide based on preferences\n        _super.prototype._renderAnnotation.call(panel, $where);\n        if (panel.preferences.get(\"annotationEditorShown\")) {\n            panel.annotationEditor.toggle(true);\n        }\n        // store preference when shown or hidden\n        panel.listenTo(panel.annotationEditor, \"hiddenUntilActivated:shown hiddenUntilActivated:hidden\", function (annotationEditor) {\n            panel.preferences.set(\"annotationEditorShown\", annotationEditor.hidden);\n        });\n    },\n\n    /** Override to scroll to cached position (in prefs) after swapping */\n    _swapNewRender: function _swapNewRender($newRender) {\n        _super.prototype._swapNewRender.call(this, $newRender);\n        var panel = this;\n        _.delay(function () {\n            var pos = panel.preferences.get(\"scrollPosition\");\n            if (pos) {\n                panel.scrollTo(pos, 0);\n            }\n        }, 10);\n        //TODO: is this enough of a delay on larger histories?\n\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** Override to add the current-content highlight class to currentContentId's view */\n    _attachItems: function _attachItems($whereTo) {\n        _super.prototype._attachItems.call(this, $whereTo);\n        var panel = this;\n        if (panel.currentContentId) {\n            panel._setCurrentContentById(panel.currentContentId);\n        }\n        return this;\n    },\n\n    /** Override to remove any drill down panels */\n    addItemView: function addItemView(model, collection, options) {\n        var view = _super.prototype.addItemView.call(this, model, collection, options);\n        if (!view) {\n            return view;\n        }\n        if (this.panelStack.length) {\n            return this._collapseDrilldownPanel();\n        }\n        return view;\n    },\n\n    // ------------------------------------------------------------------------ collection sub-views\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call(panel, view);\n        // use pub-sub to: handle drilldown expansion and collapse\n        return panel.listenTo(view, {\n            \"expanded:drilldown\": function expandedDrilldown(v, drilldown) {\n                this._expandDrilldownPanel(drilldown);\n            },\n            \"collapsed:drilldown\": function collapsedDrilldown(v, drilldown) {\n                this._collapseDrilldownPanel(drilldown);\n            }\n        });\n    },\n\n    /** display 'current content': add a visible highlight and store the id of a content item */\n    setCurrentContent: function setCurrentContent(view) {\n        this.$(\".history-content.current-content\").removeClass(\"current-content\");\n        if (view) {\n            view.$el.addClass(\"current-content\");\n            this.currentContentId = view.model.id;\n        } else {\n            this.currentContentId = null;\n        }\n    },\n\n    /** find the view with the id and then call setCurrentContent on it */\n    _setCurrentContentById: function _setCurrentContentById(id) {\n        var view = this.viewFromModelId(id) || null;\n        this.setCurrentContent(view);\n    },\n\n    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n    _expandDrilldownPanel: function _expandDrilldownPanel(drilldown) {\n        this.panelStack.push(drilldown);\n        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n        this.$controls().add(this.$list()).hide();\n        drilldown.parentName = this.model.get(\"name\");\n        drilldown.delegateEvents().render().$el.appendTo(this.$el);\n    },\n\n    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n    _collapseDrilldownPanel: function _collapseDrilldownPanel(drilldown) {\n        this.panelStack.pop();\n        //TODO: MEM: free the panel\n        this.$controls().add(this.$list()).show();\n    },\n\n    // ........................................................................ panel events\n    /** event map */\n    events: _.extend(_.clone(_super.prototype.events), {\n        // the two links in the empty message\n        \"click .uploader-link\": function clickUploaderLink(ev) {\n            Galaxy.upload.show(ev);\n        },\n        \"click .get-data-link\": function clickGetDataLink(ev) {\n            var $toolMenu = $(\".toolMenuContainer\");\n            $toolMenu.parent().scrollTop(0);\n            $toolMenu.find('span:contains(\"Get Data\")').click();\n        }\n    }),\n\n    // ........................................................................ external objects/MVC\n    listenToGalaxy: function listenToGalaxy(galaxy) {\n        this.listenTo(galaxy, {\n            // when the galaxy_main iframe is loaded with a new page,\n            // compare the url to the following list and if there's a match\n            // pull the id from url and indicate in the history view that\n            // the dataset with that id is the 'current'ly active dataset\n            \"center-frame:load\": function centerFrameLoad(data) {\n                var pathToMatch = data.fullpath;\n                var hdaId = null;\n                var useToURLRegexMap = {\n                    display: /datasets\\/([a-f0-9]+)\\/display/,\n                    edit: /datasets\\/([a-f0-9]+)\\/edit/,\n                    report_error: /dataset\\/errors\\?id=([a-f0-9]+)/,\n                    rerun: /tool_runner\\/rerun\\?id=([a-f0-9]+)/,\n                    show_params: /datasets\\/([a-f0-9]+)\\/show_params/\n                    // no great way to do this here? (leave it in the dataset event handlers above?)\n                    // 'visualization' : 'visualization',\n                };\n                _.find(useToURLRegexMap, function (regex, use) {\n                    // grab the more specific match result (1), save, and use it as the find flag\n                    hdaId = _.result(pathToMatch.match(regex), 1);\n                    return hdaId;\n                });\n                // need to type mangle to go from web route to history contents\n                this._setCurrentContentById(hdaId ? \"dataset-\" + hdaId : null);\n            },\n            // when the center panel is given a new view, clear the current indicator\n            \"center-panel:load\": function centerPanelLoad(view) {\n                this._setCurrentContentById();\n            }\n        });\n    },\n\n    //TODO: remove quota meter from panel and remove this\n    /** add listeners to an external quota meter (mvc/user/user-quotameter.js) */\n    connectToQuotaMeter: function connectToQuotaMeter(quotaMeter) {\n        if (!quotaMeter) {\n            return this;\n        }\n        // show/hide the 'over quota message' in the history when the meter tells it to\n        this.listenTo(quotaMeter, \"quota:over\", this.showQuotaMessage);\n        this.listenTo(quotaMeter, \"quota:under\", this.hideQuotaMessage);\n\n        // having to add this to handle re-render of hview while overquota (the above do not fire)\n        this.on(\"rendered rendered:initial\", function () {\n            if (quotaMeter && quotaMeter.isOverQuota()) {\n                this.showQuotaMessage();\n            }\n        });\n        return this;\n    },\n\n    /** Override to preserve the quota message */\n    clearMessages: function clearMessages(ev) {\n        var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n        $target = $target.not(\".quota-message\");\n        $target.fadeOut(this.fxSpeed, function () {\n            $(this).remove();\n        });\n        return this;\n    },\n\n    /** Show the over quota message (which happens to be in the history panel).\n     */\n    showQuotaMessage: function showQuotaMessage() {\n        var $msg = this.$(\".quota-message\");\n        if ($msg.is(\":hidden\")) {\n            $msg.slideDown(this.fxSpeed);\n        }\n    },\n\n    /** Hide the over quota message (which happens to be in the history panel).\n     */\n    hideQuotaMessage: function hideQuotaMessage() {\n        var $msg = this.$(\".quota-message\");\n        if (!$msg.is(\":hidden\")) {\n            $msg.slideUp(this.fxSpeed);\n        }\n    },\n\n    // ........................................................................ options menu\n    //TODO: remove to batch\n    /** unhide any hidden datasets */\n    unhideHidden: function unhideHidden() {\n        var self = this;\n        if (confirm((0, _localization2.default)(\"Really unhide all hidden datasets?\"))) {\n            // get all hidden, regardless of deleted/purged\n            return self.model.contents._filterAndUpdate({ visible: false, deleted: \"\", purged: \"\" }, { visible: true }).done(function () {\n                // TODO: would be better to render these as they're unhidden instead of all at once\n                if (!self.model.contents.includeHidden) {\n                    self.renderItems();\n                }\n            });\n        }\n        return jQuery.when();\n    },\n\n    /** delete any hidden datasets */\n    deleteHidden: function deleteHidden() {\n        var self = this;\n        if (confirm((0, _localization2.default)(\"Really delete all hidden datasets?\"))) {\n            return self.model.contents._filterAndUpdate(\n            // get all hidden, regardless of deleted/purged\n            { visible: false, deleted: \"\", purged: \"\" },\n            // both delete *and* unhide them\n            { deleted: true, visible: true });\n        }\n        return jQuery.when();\n    },\n\n    /** Return a string rep of the history */\n    toString: function toString() {\n        return \"CurrentHistoryView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//------------------------------------------------------------------------------ TEMPLATES\nCurrentHistoryView.prototype.templates = function () {\n    var quotaMsgTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"quota-message errormessage\">', (0, _localization2.default)(\"You are over your disk quota\"), \". \", (0, _localization2.default)(\"Tool execution is on hold until your disk usage drops below your allocated quota\"), \".\", \"</div>\"], \"history\");\n    return _.extend(_.clone(_super.prototype.templates), {\n        quotaMsg: quotaMsgTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    CurrentHistoryView: CurrentHistoryView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0), __webpack_require__(0)))\n\n/***/ }),\n/* 247 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n//ASSUMES: jquery\n//=============================================================================\n/** @class AjaxQueue\n *  Class that allows queueing functions that return jQuery promises (such\n *  as ajax calls). Each function waits for the previous to complete before\n *  being called\n *\n *  @constructor accepts a list of functions and automatically begins\n *      processing them\n */\nvar AjaxQueue = function () {\n    function AjaxQueue(initialFunctions) {\n        _classCallCheck(this, AjaxQueue);\n\n        /** the main deferred for the entire queue - note: also sends notifications of progress */\n        this.deferred = jQuery.Deferred();\n        /** the queue array of functions */\n        this.queue = [];\n        /** cache the response from each deferred call - error or success */\n        this.responses = [];\n        /** total number of fn's to process */\n        this.numToProcess = 0;\n        /** is the queue processing/waiting for any calls to return? */\n        this.running = false;\n\n        this.init(initialFunctions || []);\n        this.start();\n    }\n\n    /** add all fns in initialFunctions (if any) to the queue */\n\n\n    _createClass(AjaxQueue, [{\n        key: \"init\",\n        value: function init(initialFunctions) {\n            var _this = this;\n\n            initialFunctions.forEach(function (fn) {\n                _this.add(fn);\n            });\n        }\n    }, {\n        key: \"add\",\n        value: function add(fn) {\n            var _this2 = this;\n\n            var index = this.queue.length;\n            this.numToProcess += 1;\n\n            this.queue.push(function () {\n                var fnIndex = index;\n                var xhr = fn();\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done(function (response) {\n                    _this2.deferred.notify({\n                        curr: fnIndex,\n                        total: _this2.numToProcess,\n                        response: response\n                    });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always(function (response) {\n                    _this2.responses.push(response);\n                    if (_this2.queue.length) {\n                        _this2.queue.shift()();\n                    } else {\n                        _this2.stop();\n                    }\n                });\n            });\n            return this;\n        }\n    }, {\n        key: \"start\",\n        value: function start() {\n            if (this.queue.length) {\n                this.running = true;\n                this.queue.shift()();\n            }\n            return this;\n        }\n\n        /** stop the queue\n         *  @param {boolean} causeFail  cause an error/fail on the main deferred\n         *  @param {String} msg         message to send when rejecting the main deferred\n         */\n\n    }, {\n        key: \"stop\",\n        value: function stop(causeFail, msg) {\n            //TODO: doesn't abort current call\n            this.running = false;\n            this.queue = [];\n            if (causeFail) {\n                //TODO: spliced args instead\n                this.deferred.reject(msg);\n            } else {\n                this.deferred.resolve(this.responses);\n            }\n            this.numToProcess = 0;\n            this.deferred = jQuery.Deferred();\n            return this;\n        }\n\n        // only a handful of the deferred interface for now - possible YAGNI\n        /** implement done from the jq deferred interface */\n\n    }, {\n        key: \"done\",\n        value: function done(fn) {\n            return this.deferred.done(fn);\n        }\n\n        /** implement fail from the jq deferred interface */\n\n    }, {\n        key: \"fail\",\n        value: function fail(fn) {\n            return this.deferred.fail(fn);\n        }\n\n        /** implement always from the jq deferred interface */\n\n    }, {\n        key: \"always\",\n        value: function always(fn) {\n            return this.deferred.always(fn);\n        }\n\n        /** implement progress from the jq deferred interface */\n\n    }, {\n        key: \"progress\",\n        value: function progress(fn) {\n            return this.deferred.progress(fn);\n        }\n\n        /** shortcut constructor / fire and forget\n         *  @returns {Deferred} the queue's main deferred\n         */\n\n    }], [{\n        key: \"create\",\n        value: function create(initialFunctions) {\n            return new AjaxQueue(initialFunctions).deferred;\n        }\n    }]);\n\n    return AjaxQueue;\n}();\n\n//=============================================================================\n/** @class NamedAjaxQueue\n *  @augments AjaxQueue\n *  Allows associating a name with a deferring fn and prevents adding deferring\n *  fns if the name has already been used. Useful to prevent build up of duplicate\n *  async calls.\n *  Both the array initialFunctions sent to constructor and any added later with\n *  add() should be objects (NOT functions) of the form:\n *  { name: some unique id,\n *    fn:   the deferring fn or ajax call }\n */\n\n\nvar NamedAjaxQueue = function (_AjaxQueue) {\n    _inherits(NamedAjaxQueue, _AjaxQueue);\n\n    function NamedAjaxQueue(initialFunctions) {\n        _classCallCheck(this, NamedAjaxQueue);\n\n        var _this3 = _possibleConstructorReturn(this, (NamedAjaxQueue.__proto__ || Object.getPrototypeOf(NamedAjaxQueue)).call(this, initialFunctions));\n\n        _this3.names = {};\n        return _this3;\n    }\n\n    /** add the obj.fn to the queue if obj.name hasn't been used before */\n\n\n    _createClass(NamedAjaxQueue, [{\n        key: \"add\",\n        value: function add(obj) {\n            if (!(obj.hasOwnProperty(\"name\") && obj.hasOwnProperty(\"fn\"))) {\n                throw new Error(\"NamedAjaxQueue.add requires an object with both \\\"name\\\" and \\\"fn\\\": \" + JSON.stringify(obj));\n            }\n            if (this.names.hasOwnProperty(obj.name)) {\n                //console.warn( 'name has been used:', obj.name );\n                return;\n            }\n            this.names[obj.name] = true;\n            return _get(NamedAjaxQueue.prototype.__proto__ || Object.getPrototypeOf(NamedAjaxQueue.prototype), \"add\", this).call(this, obj.fn);\n        }\n    }, {\n        key: \"clear\",\n        value: function clear() {\n            this.names = {};\n            return this;\n        }\n\n        /** shortcut constructor / fire and forget\n         *  @returns {Deferred} the queue's main deferred\n         */\n\n    }], [{\n        key: \"create\",\n        value: function create(initialFunctions) {\n            return new NamedAjaxQueue(initialFunctions).deferred;\n        }\n    }]);\n\n    return NamedAjaxQueue;\n}(AjaxQueue);\n\n//=============================================================================\n\n\nexports.default = {\n    AjaxQueue: AjaxQueue,\n    NamedAjaxQueue: NamedAjaxQueue\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))\n\n/***/ }),\n/* 248 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _historyView = __webpack_require__(249);\n\nvar _historyView2 = _interopRequireDefault(_historyView);\n\nvar _historyContents = __webpack_require__(83);\n\nvar _historyContents2 = _interopRequireDefault(_historyContents);\n\nvar _states = __webpack_require__(48);\n\nvar _states2 = _interopRequireDefault(_states);\n\nvar _hdaModel = __webpack_require__(128);\n\nvar _hdaModel2 = _interopRequireDefault(_hdaModel);\n\nvar _hdaLiEdit = __webpack_require__(251);\n\nvar _hdaLiEdit2 = _interopRequireDefault(_hdaLiEdit);\n\nvar _hdcaLiEdit = __webpack_require__(252);\n\nvar _hdcaLiEdit2 = _interopRequireDefault(_hdcaLiEdit);\n\nvar _tag = __webpack_require__(67);\n\nvar _tag2 = _interopRequireDefault(_tag);\n\nvar _annotation = __webpack_require__(136);\n\nvar _annotation2 = _interopRequireDefault(_annotation);\n\nvar _listCollectionCreator = __webpack_require__(78);\n\nvar _listCollectionCreator2 = _interopRequireDefault(_listCollectionCreator);\n\nvar _pairCollectionCreator = __webpack_require__(255);\n\nvar _pairCollectionCreator2 = _interopRequireDefault(_pairCollectionCreator);\n\nvar _listOfPairsCollectionCreator = __webpack_require__(256);\n\nvar _listOfPairsCollectionCreator2 = _interopRequireDefault(_listOfPairsCollectionCreator);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _popupMenu = __webpack_require__(19);\n\nvar _popupMenu2 = _interopRequireDefault(_popupMenu);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(15);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = _historyView2.default.HistoryView;\n// base class for history-view-edit-current and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryView allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryViewEdit = _super.extend(\n/** @lends HistoryViewEdit.prototype */{\n    /** class to use for constructing the HistoryDatasetAssociation views */\n    HDAViewClass: _hdaLiEdit2.default.HDAListItemEdit,\n    /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n    HDCAViewClass: _hdcaLiEdit2.default.HDCAListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes\n     */\n    initialize: function initialize(attributes) {\n        attributes = attributes || {};\n        _super.prototype.initialize.call(this, attributes);\n\n        // ---- set up instance vars\n        /** editor for tags - sub-view */\n        this.tagsEditor = null;\n\n        /** enable drag and drop - sub-view */\n        this.dragItems = true;\n\n        /** editor for annotations - sub-view */\n        this.annotationEditor = null;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        // states/modes the panel can be in\n        /** is the panel currently showing the dataset selection controls? */\n        this.annotationEditorShown = attributes.annotationEditorShown || false;\n        this.tagsEditorShown = attributes.tagsEditorShown || false;\n    },\n\n    /** Override to handle history as drag-drop target */\n    _setUpListeners: function _setUpListeners() {\n        _super.prototype._setUpListeners.call(this);\n        return this.on({\n            \"droptarget:drop\": function droptargetDrop(ev, data) {\n                // process whatever was dropped and re-hide the drop target\n                this.dataDropped(data);\n                this.dropTargetOff();\n            },\n            \"view:attached view:removed\": function viewAttachedViewRemoved() {\n                this._renderCounts();\n            },\n            \"search:loading-progress\": this._renderSearchProgress,\n            \"search:searching\": this._renderSearchFindings\n        });\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** listening for history and HDA events */\n    _setUpModelListeners: function _setUpModelListeners() {\n        _super.prototype._setUpModelListeners.call(this);\n        this.listenTo(this.model, \"change:size\", this.updateHistoryDiskSize);\n        return this;\n    },\n\n    /** listening for collection events */\n    _setUpCollectionListeners: function _setUpCollectionListeners() {\n        _super.prototype._setUpCollectionListeners.call(this);\n        this.listenTo(this.collection, {\n            \"change:deleted\": this._handleItemDeletedChange,\n            \"change:visible\": this._handleItemVisibleChange,\n            \"change:purged\": function changePurged(model) {\n                // hafta get the new nice-size w/o the purged model\n                this.model.fetch();\n            },\n            // loading indicators for deleted/hidden\n            \"fetching-deleted\": function fetchingDeleted(collection) {\n                this.$(\"> .controls .deleted-count\").html(\"<i>\" + (0, _localization2.default)(\"loading...\") + \"</i>\");\n            },\n            \"fetching-hidden\": function fetchingHidden(collection) {\n                this.$(\"> .controls .hidden-count\").html(\"<i>\" + (0, _localization2.default)(\"loading...\") + \"</i>\");\n            },\n            \"fetching-deleted-done fetching-hidden-done\": this._renderCounts\n        });\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n    _buildNewRender: function _buildNewRender() {\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = _super.prototype._buildNewRender.call(this);\n        if (!this.model) {\n            return $newRender;\n        }\n\n        if (Galaxy && Galaxy.user && Galaxy.user.id && Galaxy.user.id === this.model.get(\"user_id\")) {\n            this._renderTags($newRender);\n            this._renderAnnotation($newRender);\n        }\n        return $newRender;\n    },\n\n    /** Update the history size display (curr. upper right of panel). */\n    updateHistoryDiskSize: function updateHistoryDiskSize() {\n        this.$(\".history-size\").text(this.model.get(\"nice_size\"));\n    },\n\n    /** override to render counts when the items are rendered */\n    renderItems: function renderItems($whereTo) {\n        var views = _super.prototype.renderItems.call(this, $whereTo);\n        if (!this.searchFor) {\n            this._renderCounts($whereTo);\n        } else {\n            this._renderSearchFindings($whereTo);\n        }\n        return views;\n    },\n\n    /** override to show counts, what's deleted/hidden, and links to toggle those */\n    _renderCounts: function _renderCounts($whereTo) {\n        $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n        var html = this.templates.counts(this.model.toJSON(), this);\n        return $whereTo.find(\"> .controls .subtitle\").html(html);\n    },\n\n    /** render the tags sub-view controller */\n    _renderTags: function _renderTags($where) {\n        var panel = this;\n        this.tagsEditor = new _tag2.default.TagsEditor({\n            model: this.model,\n            el: $where.find(\".controls .tags-display\"),\n            onshowFirstTime: function onshowFirstTime() {\n                this.render();\n            },\n            // show hide sub-view tag editors when this is shown/hidden\n            onshow: function onshow() {\n                panel.toggleHDATagEditors(true, panel.fxSpeed);\n            },\n            onhide: function onhide() {\n                panel.toggleHDATagEditors(false, panel.fxSpeed);\n            },\n            $activator: (0, _faIconButton2.default)({\n                title: (0, _localization2.default)(\"Edit history tags\"),\n                classes: \"history-tag-btn\",\n                faIcon: \"fa-tags\"\n            }).appendTo($where.find(\".controls .actions\"))\n        });\n    },\n    /** render the annotation sub-view controller */\n    _renderAnnotation: function _renderAnnotation($where) {\n        var panel = this;\n        this.annotationEditor = new _annotation2.default.AnnotationEditor({\n            model: this.model,\n            el: $where.find(\".controls .annotation-display\"),\n            onshowFirstTime: function onshowFirstTime() {\n                this.render();\n            },\n            // show hide sub-view view annotation editors when this is shown/hidden\n            onshow: function onshow() {\n                panel.toggleHDAAnnotationEditors(true, panel.fxSpeed);\n            },\n            onhide: function onhide() {\n                panel.toggleHDAAnnotationEditors(false, panel.fxSpeed);\n            },\n            $activator: (0, _faIconButton2.default)({\n                title: (0, _localization2.default)(\"Edit history annotation\"),\n                classes: \"history-annotate-btn\",\n                faIcon: \"fa-comment\"\n            }).appendTo($where.find(\".controls .actions\"))\n        });\n    },\n\n    /** Set up HistoryViewEdit js/widget behaviours\n     *  In this override, make the name editable\n     */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call(this, $where);\n        if (!this.model) {\n            return;\n        }\n\n        // anon users shouldn't have access to any of the following\n        if (!Galaxy.user || Galaxy.user.isAnonymous() || Galaxy.user.id !== this.model.get(\"user_id\")) {\n            return;\n        }\n\n        var panel = this;\n        var nameSelector = \"> .controls .name\";\n        $where.find(nameSelector).attr(\"title\", (0, _localization2.default)(\"Click to rename history\")).tooltip({ placement: \"bottom\" }).make_text_editable({\n            on_finish: function on_finish(newName) {\n                var previousName = panel.model.get(\"name\");\n                if (newName && newName !== previousName) {\n                    panel.$el.find(nameSelector).text(newName);\n                    panel.model.save({ name: newName }).fail(function () {\n                        panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                    });\n                } else {\n                    panel.$el.find(nameSelector).text(previousName);\n                }\n            }\n        });\n    },\n\n    /** return a new popup menu for choosing a multi selection action\n     *  ajax calls made for multiple datasets are queued\n     */\n    multiselectActions: function multiselectActions() {\n        var panel = this;\n\n        var actions = [{\n            html: (0, _localization2.default)(\"Hide datasets\"),\n            func: function func() {\n                var action = _hdaModel2.default.HistoryDatasetAssociation.prototype.hide;\n                panel.getSelectedModels().ajaxQueue(action);\n            }\n        }, {\n            html: (0, _localization2.default)(\"Unhide datasets\"),\n            func: function func() {\n                var action = _hdaModel2.default.HistoryDatasetAssociation.prototype.unhide;\n                panel.getSelectedModels().ajaxQueue(action);\n            }\n        }, {\n            html: (0, _localization2.default)(\"Delete datasets\"),\n            func: function func() {\n                var action = _hdaModel2.default.HistoryDatasetAssociation.prototype[\"delete\"];\n                panel.getSelectedModels().ajaxQueue(action);\n            }\n        }, {\n            html: (0, _localization2.default)(\"Undelete datasets\"),\n            func: function func() {\n                var action = _hdaModel2.default.HistoryDatasetAssociation.prototype.undelete;\n                panel.getSelectedModels().ajaxQueue(action);\n            }\n        }];\n\n        if (panel.purgeAllowed) {\n            actions.push({\n                html: (0, _localization2.default)(\"Permanently delete datasets\"),\n                func: function func() {\n                    if (confirm((0, _localization2.default)(\"This will permanently remove the data in your datasets. Are you sure?\"))) {\n                        var action = _hdaModel2.default.HistoryDatasetAssociation.prototype.purge;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                }\n            });\n        }\n        actions = actions.concat(panel._collectionActions());\n        return actions;\n    },\n\n    /**   */\n    _collectionActions: function _collectionActions() {\n        var panel = this;\n        return [{\n            html: (0, _localization2.default)(\"Build Dataset List\"),\n            func: function func() {\n                panel.buildCollection(\"list\");\n            }\n        },\n        // TODO: Only show quick pair if two things selected.\n        {\n            html: (0, _localization2.default)(\"Build Dataset Pair\"),\n            func: function func() {\n                panel.buildCollection(\"paired\");\n            }\n        }, {\n            html: (0, _localization2.default)(\"Build List of Dataset Pairs\"),\n            func: function func() {\n                panel.buildCollection(\"list:paired\");\n            }\n        }];\n    },\n\n    buildCollection: function buildCollection(collectionType, selection, hideSourceItems) {\n        var panel = this;\n        var selection = selection || panel.getSelectedModels();\n        var hideSourceItems = hideSourceItems || false;\n        var createFunc;\n        if (collectionType == \"list\") {\n            createFunc = _listCollectionCreator2.default.createListCollection;\n        } else if (collectionType == \"paired\") {\n            createFunc = _pairCollectionCreator2.default.createPairCollection;\n        } else if (collectionType == \"list:paired\") {\n            createFunc = _listOfPairsCollectionCreator2.default.createListOfPairsCollection;\n        } else {\n            console.warn(\"Unknown collectionType encountered \" + collectionType);\n        }\n        createFunc(selection, hideSourceItems).done(function () {\n            panel.model.refresh();\n        });\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n    _getItemViewOptions: function _getItemViewOptions(model) {\n        var options = _super.prototype._getItemViewOptions.call(this, model);\n        _.extend(options, {\n            purgeAllowed: this.purgeAllowed,\n            tagsEditorShown: this.tagsEditor && !this.tagsEditor.hidden,\n            annotationEditorShown: this.annotationEditor && !this.annotationEditor.hidden\n        });\n        return options;\n    },\n\n    /** If this item is deleted and we're not showing deleted items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleItemDeletedChange: function _handleItemDeletedChange(itemModel) {\n        if (itemModel.get(\"deleted\")) {\n            this._handleItemDeletion(itemModel);\n        } else {\n            this._handleItemUndeletion(itemModel);\n        }\n        this._renderCounts();\n    },\n\n    _handleItemDeletion: function _handleItemDeletion(itemModel) {\n        var contentsShown = this.model.get(\"contents_active\");\n        contentsShown.deleted += 1;\n        contentsShown.active -= 1;\n        if (!this.model.contents.includeDeleted) {\n            this.removeItemView(itemModel);\n        }\n        this.model.set(\"contents_active\", contentsShown);\n    },\n\n    _handleItemUndeletion: function _handleItemUndeletion(itemModel) {\n        var contentsShown = this.model.get(\"contents_active\");\n        contentsShown.deleted -= 1;\n        if (!this.model.contents.includeDeleted) {\n            contentsShown.active -= 1;\n        }\n        this.model.set(\"contents_active\", contentsShown);\n    },\n\n    /** If this item is hidden and we're not showing hidden items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleItemVisibleChange: function _handleItemVisibleChange(itemModel) {\n        if (itemModel.hidden()) {\n            this._handleItemHidden(itemModel);\n        } else {\n            this._handleItemUnhidden(itemModel);\n        }\n        this._renderCounts();\n    },\n\n    _handleItemHidden: function _handleItemHidden(itemModel) {\n        var contentsShown = this.model.get(\"contents_active\");\n        contentsShown.hidden += 1;\n        contentsShown.active -= 1;\n        if (!this.model.contents.includeHidden) {\n            this.removeItemView(itemModel);\n        }\n        this.model.set(\"contents_active\", contentsShown);\n    },\n\n    _handleItemUnhidden: function _handleItemUnhidden(itemModel) {\n        var contentsShown = this.model.get(\"contents_active\");\n        contentsShown.hidden -= 1;\n        if (!this.model.contents.includeHidden) {\n            contentsShown.active -= 1;\n        }\n        this.model.set(\"contents_active\", contentsShown);\n    },\n\n    /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n    toggleHDATagEditors: function toggleHDATagEditors(showOrHide, speed) {\n        _.each(this.views, function (view) {\n            if (view.tagsEditor) {\n                view.tagsEditor.toggle(showOrHide, speed);\n            }\n        });\n    },\n\n    /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n    toggleHDAAnnotationEditors: function toggleHDAAnnotationEditors(showOrHide, speed) {\n        _.each(this.views, function (view) {\n            if (view.annotationEditor) {\n                view.annotationEditor.toggle(showOrHide, speed);\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .show-selectors-btn\": \"toggleSelectors\",\n        \"click .toggle-deleted-link\": function clickToggleDeletedLink(ev) {\n            this.toggleShowDeleted();\n        },\n        \"click .toggle-hidden-link\": function clickToggleHiddenLink(ev) {\n            this.toggleShowHidden();\n        }\n    }),\n\n    // ------------------------------------------------------------------------ search\n    _renderSearchProgress: function _renderSearchProgress(limit, offset) {\n        var stop = limit + offset;\n        return this.$(\"> .controls .subtitle\").html([\"<i>\", (0, _localization2.default)(\"Searching \"), stop, \"/\", this.model.contentsShown(), \"</i>\"].join(\"\"));\n    },\n\n    /** override to display number found in subtitle */\n    _renderSearchFindings: function _renderSearchFindings($whereTo) {\n        $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n        var html = this.templates.found(this.model.toJSON(), this);\n        $whereTo.find(\"> .controls .subtitle\").html(html);\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ as drop target\n    /** turn all the drag and drop handlers on and add some help text above the drop area */\n    dropTargetOn: function dropTargetOn() {\n        if (this.dropTarget) {\n            return this;\n        }\n        this.dropTarget = true;\n\n        //TODO: to init\n        var dropHandlers = {\n            dragenter: _.bind(this.dragenter, this),\n            dragover: _.bind(this.dragover, this),\n            dragleave: _.bind(this.dragleave, this),\n            drop: _.bind(this.drop, this)\n        };\n\n        var $dropTarget = this._renderDropTarget();\n        this.$list().before([this._renderDropTargetHelp(), $dropTarget]);\n        for (var evName in dropHandlers) {\n            if (dropHandlers.hasOwnProperty(evName)) {\n                //console.debug( evName, dropHandlers[ evName ] );\n                $dropTarget.on(evName, dropHandlers[evName]);\n            }\n        }\n        return this;\n    },\n\n    /** render a box to serve as a 'drop here' area on the history */\n    _renderDropTarget: function _renderDropTarget() {\n        this.$(\".history-drop-target\").remove();\n        return $(\"<div/>\").addClass(\"history-drop-target\");\n    },\n\n    /** tell the user how it works  */\n    _renderDropTargetHelp: function _renderDropTargetHelp() {\n        this.$(\".history-drop-target-help\").remove();\n        return $(\"<div/>\").addClass(\"history-drop-target-help\").text((0, _localization2.default)(\"Drag datasets here to copy them to the current history\"));\n    },\n\n    /** shut down drag and drop event handlers and remove drop target */\n    dropTargetOff: function dropTargetOff() {\n        if (!this.dropTarget) {\n            return this;\n        }\n        //this.log( 'dropTargetOff' );\n        this.dropTarget = false;\n        var dropTarget = this.$(\".history-drop-target\").get(0);\n        for (var evName in this._dropHandlers) {\n            if (this._dropHandlers.hasOwnProperty(evName)) {\n                dropTarget.off(evName, this._dropHandlers[evName]);\n            }\n        }\n        this.$(\".history-drop-target\").remove();\n        this.$(\".history-drop-target-help\").remove();\n        return this;\n    },\n    /** toggle the target on/off */\n    dropTargetToggle: function dropTargetToggle() {\n        if (this.dropTarget) {\n            this.dropTargetOff();\n        } else {\n            this.dropTargetOn();\n        }\n        return this;\n    },\n\n    dragenter: function dragenter(ev) {\n        //console.debug( 'dragenter:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$(\".history-drop-target\").css(\"border\", \"2px solid black\");\n    },\n    dragover: function dragover(ev) {\n        ev.preventDefault();\n        ev.stopPropagation();\n    },\n    dragleave: function dragleave(ev) {\n        //console.debug( 'dragleave:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$(\".history-drop-target\").css(\"border\", \"1px dashed black\");\n    },\n    /** when (text) is dropped try to parse as json and trigger an event */\n    drop: function drop(ev) {\n        ev.preventDefault();\n        //ev.stopPropagation();\n\n        var self = this;\n        var dataTransfer = ev.originalEvent.dataTransfer;\n        var data = dataTransfer.getData(\"text\");\n\n        dataTransfer.dropEffect = \"move\";\n        try {\n            data = JSON.parse(data);\n        } catch (err) {\n            self.warn(\"error parsing JSON from drop:\", data);\n        }\n\n        self.trigger(\"droptarget:drop\", ev, data, self);\n        return false;\n    },\n\n    /** handler that copies data into the contents */\n    dataDropped: function dataDropped(data) {\n        var self = this;\n        // HDA: dropping will copy it to the history\n        if (_.isObject(data) && data.model_class === \"HistoryDatasetAssociation\" && data.id) {\n            if (self.contents.currentPage !== 0) {\n                return self.contents.fetchPage(0).then(function () {\n                    return self.model.contents.copy(data.id);\n                });\n            }\n            return self.model.contents.copy(data.id);\n        }\n        return jQuery.when();\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString: function toString() {\n        return \"HistoryViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryViewEdit.prototype.templates = function () {\n    var countsTemplate = _baseMvc2.default.wrapTemplate([\"<% var shown = Math.max( view.views.length, history.contents_active.active ) %>\", \"<% if( shown ){ %>\", '<span class=\"shown-count\">', \"<%- shown %> \", (0, _localization2.default)(\"shown\"), \"</span>\", \"<% } %>\", \"<% if( history.contents_active.deleted ){ %>\", '<span class=\"deleted-count\">', \"<% if( view.model.contents.includeDeleted ){ %>\", '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"hide deleted\"), \"</a>\", \"<% } else { %>\", \"<%- history.contents_active.deleted %> \", '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"deleted\"), \"</a>\", \"<% } %>\", \"</span>\", \"<% } %>\", \"<% if( history.contents_active.hidden ){ %>\", '<span class=\"hidden-count\">', \"<% if( view.model.contents.includeHidden ){ %>\", '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"hide hidden\"), \"</a>\", \"<% } else { %>\", \"<%- history.contents_active.hidden %> \", '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"hidden\"), \"</a>\", \"<% } %>\", \"</span>\", \"<% } %>\"], \"history\");\n\n    var foundTemplate = _baseMvc2.default.wrapTemplate([(0, _localization2.default)(\"Found\"), \" <%- view.views.length %>, \", \"<% if( history.contents_active.deleted ){ %>\", \"<% if( view.model.contents.includeDeleted ){ %>\", '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"hide deleted\"), \"</a>, \", \"<% } else { %>\", '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"show deleted\"), \"</a>, \", \"<% } %>\", \"<% } %>\", \"<% if( history.contents_active.hidden ){ %>\", \"<% if( view.model.contents.includeHidden ){ %>\", '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"hide hidden\"), \"</a>\", \"<% } else { %>\", '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"show hidden\"), \"</a>\", \"<% } %>\", \"<% } %>\"], \"history\");\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        counts: countsTemplate,\n        found: foundTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    HistoryViewEdit: HistoryViewEdit\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 249 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(_, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listView = __webpack_require__(129);\n\nvar _listView2 = _interopRequireDefault(_listView);\n\nvar _historyModel = __webpack_require__(82);\n\nvar _historyModel2 = _interopRequireDefault(_historyModel);\n\nvar _historyContents = __webpack_require__(83);\n\nvar _historyContents2 = _interopRequireDefault(_historyContents);\n\nvar _historyPreferences = __webpack_require__(84);\n\nvar _historyPreferences2 = _interopRequireDefault(_historyPreferences);\n\nvar _hdaLi = __webpack_require__(131);\n\nvar _hdaLi2 = _interopRequireDefault(_hdaLi);\n\nvar _hdcaLi = __webpack_require__(133);\n\nvar _hdcaLi2 = _interopRequireDefault(_hdcaLi);\n\nvar _userModel = __webpack_require__(39);\n\nvar _userModel2 = _interopRequireDefault(_userModel);\n\nvar _errorModal = __webpack_require__(126);\n\nvar _errorModal2 = _interopRequireDefault(_errorModal);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(130);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = _listView2.default.ModelListPanel;\nvar HistoryView = _super.extend(\n/** @lends HistoryView.prototype */{\n    _logNamespace: \"history\",\n\n    /** class to use for constructing the HDA views */\n    HDAViewClass: _hdaLi2.default.HDAListItemView,\n    /** class to use for constructing the HDCA views */\n    HDCAViewClass: _hdcaLi2.default.HDCAListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass: _historyContents2.default.HistoryContents,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey: \"contents\",\n\n    tagName: \"div\",\n    className: _super.prototype.className + \" history-panel\",\n\n    /** string to display when the collection is empty */\n    emptyMsg: (0, _localization2.default)(\"This history is empty\"),\n    /** displayed when no items match the search terms */\n    noneFoundMsg: (0, _localization2.default)(\"No matching datasets found\"),\n    /** string used for search placeholder */\n    searchPlaceholder: (0, _localization2.default)(\"search datasets\"),\n\n    /** @type {Number} ms to wait after history load to fetch/decorate hdcas with element_count */\n    FETCH_COLLECTION_COUNTS_DELAY: 2000,\n\n    // ......................................................................... SET UP\n    /** Set up the view, bind listeners.\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize: function initialize(attributes) {\n        _super.prototype.initialize.call(this, attributes);\n        // ---- instance vars\n        // control contents/behavior based on where (and in what context) the panel is being used\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || \"_blank\";\n\n        /** timeout id for detailed fetch of collection counts, etc... */\n        this.detailedFetchTimeoutId = null;\n    },\n\n    /** create and return a collection for when none is initially passed */\n    _createDefaultCollection: function _createDefaultCollection() {\n        // override\n        return new this.collectionClass([], {\n            history: this.model\n        });\n    },\n\n    /** In this override, clear the update timer on the model */\n    freeModel: function freeModel() {\n        _super.prototype.freeModel.call(this);\n        if (this.model) {\n            this.model.clearUpdateTimeout();\n        }\n        this._clearDetailedFetchTimeout();\n        return this;\n    },\n\n    /** clear the timeout and the cached timeout id */\n    _clearDetailedFetchTimeout: function _clearDetailedFetchTimeout() {\n        if (this.detailedFetchTimeoutId) {\n            clearTimeout(this.detailedFetchTimeoutId);\n            this.detailedFetchTimeoutId = null;\n        }\n    },\n\n    /** create any event listeners for the panel\n     *  @fires: rendered:initial    on the first render\n     *  @fires: empty-history       when switching to a history with no contents or creating a new history\n     */\n    _setUpListeners: function _setUpListeners() {\n        var _this = this;\n\n        _super.prototype._setUpListeners.call(this);\n        this.on({\n            error: function error(model, xhr, options, msg, details) {\n                this.errorHandler(model, xhr, options, msg, details);\n            },\n            \"loading-done\": function loadingDone() {\n                // after the initial load, decorate with more time consuming fields (like HDCA element_counts)\n                _this.detailedFetchTimeoutId = _.delay(function () {\n                    _this.detailedFetchTimeoutId = null;\n                    _this.model.contents.fetchCollectionCounts();\n                }, _this.FETCH_COLLECTION_COUNTS_DELAY);\n            },\n            \"views:ready view:attached view:removed\": function viewsReadyViewAttachedViewRemoved(view) {\n                this._renderSelectButton();\n            },\n            \"view:attached\": function viewAttached(view) {\n                this.scrollTo(0);\n            }\n        });\n        // this.on( 'all', function(){ console.debug( arguments ); });\n    },\n\n    // ------------------------------------------------------------------------ loading history/hda models\n    /** load the history with the given id then it's contents, sending ajax options to both */\n    loadHistory: function loadHistory(historyId, options, contentsOptions) {\n        var _this2 = this;\n\n        contentsOptions = _.extend(contentsOptions || { silent: true });\n        this.info(\"loadHistory:\", historyId, options, contentsOptions);\n        this.setModel(new _historyModel2.default.History({ id: historyId }));\n\n        contentsOptions.silent = true;\n        this.trigger(\"loading\");\n        return this.model.fetchWithContents(options, contentsOptions).always(function () {\n            _this2.render();\n            _this2.trigger(\"loading-done\");\n        });\n    },\n\n    /** convenience alias to the model. Updates the item list only (not the history) */\n    refreshContents: function refreshContents(options) {\n        if (this.model) {\n            return this.model.refresh(options);\n        }\n        // may have callbacks - so return an empty promise\n        return $.when();\n    },\n\n    /** Override to reset web storage when the id changes (since it needs the id) */\n    _setUpCollectionListeners: function _setUpCollectionListeners() {\n        _super.prototype._setUpCollectionListeners.call(this);\n        return this.listenTo(this.collection, {\n            // 'all' : function(){ console.log( this.collection + ':', arguments ); },\n            \"fetching-more\": function fetchingMore() {\n                this._toggleContentsLoadingIndicator(true);\n                this.$emptyMessage().hide();\n            },\n            \"fetching-more-done\": function fetchingMoreDone() {\n                this._toggleContentsLoadingIndicator(false);\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n    _showLoadingIndicator: function _showLoadingIndicator(msg, speed, callback) {\n        var $indicator = $('<div class=\"loading-indicator\"/>');\n        this.$el.html($indicator.text(msg).slideDown(!_.isUndefined(speed) ? speed : this.fxSpeed));\n    },\n\n    /** hide the loading indicator */\n    _hideLoadingIndicator: function _hideLoadingIndicator(speed) {\n        // make speed a bit slower to compensate for slow rendering of up to 500 contents\n        this.$(\".loading-indicator\").slideUp(!_.isUndefined(speed) ? speed : this.fxSpeed + 200, function () {\n            $(this).remove();\n        });\n    },\n\n    /** In this override, add a btn to toggle the selectors */\n    _buildNewRender: function _buildNewRender() {\n        var $newRender = _super.prototype._buildNewRender.call(this);\n        this._renderSelectButton($newRender);\n        return $newRender;\n    },\n\n    /** button for starting select mode */\n    _renderSelectButton: function _renderSelectButton($where) {\n        $where = $where || this.$el;\n        // do not render selector option if no actions\n        if (!this.multiselectActions().length) {\n            return null;\n        }\n        // do not render (and remove even) if nothing to select\n        if (!this.views.length) {\n            this.hideSelectors();\n            $where.find(\".controls .actions .show-selectors-btn\").remove();\n            return null;\n        }\n        // don't bother rendering if there's one already\n        var $existing = $where.find(\".controls .actions .show-selectors-btn\");\n        if ($existing.length) {\n            return $existing;\n        }\n\n        return (0, _faIconButton2.default)({\n            title: (0, _localization2.default)(\"Operations on multiple datasets\"),\n            classes: \"show-selectors-btn\",\n            faIcon: \"fa-check-square-o\"\n        }).prependTo($where.find(\".controls .actions\"));\n    },\n\n    /** override to avoid showing intial empty message using contents_active */\n    _renderEmptyMessage: function _renderEmptyMessage($whereTo) {\n        var $emptyMsg = this.$emptyMessage($whereTo);\n        var empty = this.model.get(\"contents_active\").active <= 0;\n        if (empty) {\n            return $emptyMsg.empty().append(this.emptyMsg).show();\n        } else if (this.searchFor && this.model.contents.haveSearchDetails() && !this.views.length) {\n            return $emptyMsg.empty().append(this.noneFoundMsg).show();\n        }\n        $emptyMsg.hide();\n        return $();\n    },\n\n    /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n    $scrollContainer: function $scrollContainer($where) {\n        // override or set via attributes.$scrollContainer\n        return this.$list($where);\n    },\n\n    // ------------------------------------------------------------------------ subviews\n    _toggleContentsLoadingIndicator: function _toggleContentsLoadingIndicator(show) {\n        if (!show) {\n            this.$list().find(\".contents-loading-indicator\").remove();\n        } else {\n            this.$list().html('<div class=\"contents-loading-indicator\">' + '<span class=\"fa fa-2x fa-spinner fa-spin\"/></div>');\n        }\n    },\n\n    /** override to render pagination also */\n    renderItems: function renderItems($whereTo) {\n        // console.log( this + '.renderItems-----------------', new Date() );\n        $whereTo = $whereTo || this.$el;\n        var $list = this.$list($whereTo);\n\n        // TODO: bootstrap hack to remove orphaned tooltips\n        $(\".tooltip\").remove();\n\n        $list.empty();\n        this.views = [];\n\n        var models = this._filterCollection();\n        if (models.length) {\n            this._renderPagination($whereTo);\n            this.views = this._renderSomeItems(models, $list);\n        } else {\n            // TODO: consolidate with _renderPagination above by (???) passing in models/length?\n            $whereTo.find(\"> .controls .list-pagination\").empty();\n        }\n        this._renderEmptyMessage($whereTo).toggle(!models.length);\n\n        this.trigger(\"views:ready\", this.views);\n        return this.views;\n    },\n\n    /** render pagination controls if not searching and contents says we're paginating */\n    _renderPagination: function _renderPagination($whereTo) {\n        var $paginationControls = $whereTo.find(\"> .controls .list-pagination\");\n        if (this.searchFor || !this.model.contents.shouldPaginate()) return $paginationControls.empty();\n\n        $paginationControls.html(this.templates.pagination({\n            // pagination is 1-based for the user\n            current: this.model.contents.currentPage + 1,\n            last: this.model.contents.getLastPage() + 1\n        }, this));\n        $paginationControls.find(\"select.pages\").tooltip();\n        return $paginationControls;\n    },\n\n    /** render a subset of the entire collection (client-side pagination) */\n    _renderSomeItems: function _renderSomeItems(models, $list) {\n        var _this3 = this;\n\n        var views = [];\n        $list.append(models.map(function (m) {\n            var view = _this3._createItemView(m);\n            views.push(view);\n            return _this3._renderItemView$el(view);\n        }));\n        return views;\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** in this override, check if the contents would also display based on includeDeleted/hidden */\n    _filterItem: function _filterItem(model) {\n        var contents = this.model.contents;\n        return (contents.includeHidden || !model.hidden()) && (contents.includeDeleted || !model.isDeletedOrPurged()) && _super.prototype._filterItem.call(this, model);\n    },\n\n    /** In this override, since history contents are mixed,\n     *      get the appropo view class based on history_content_type\n     */\n    _getItemViewClass: function _getItemViewClass(model) {\n        var contentType = model.get(\"history_content_type\");\n        switch (contentType) {\n            case \"dataset\":\n                return this.HDAViewClass;\n            case \"dataset_collection\":\n                return this.HDCAViewClass;\n        }\n        throw new TypeError(\"Unknown history_content_type: \" + contentType);\n    },\n\n    /** in this override, add a linktarget, and expand if id is in web storage */\n    _getItemViewOptions: function _getItemViewOptions(model) {\n        var options = _super.prototype._getItemViewOptions.call(this, model);\n        return _.extend(options, {\n            linkTarget: this.linkTarget,\n            expanded: this.model.contents.storage.isExpanded(model.id),\n            hasUser: this.model.ownedByCurrUser()\n        });\n    },\n\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners: function _setUpItemViewListeners(view) {\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call(panel, view);\n        //TODO: send from content view: this.model.collection.storage.addExpanded\n        // maintain a list of items whose bodies are expanded\n        return panel.listenTo(view, {\n            expanded: function expanded(v) {\n                panel.model.contents.storage.addExpanded(v.model);\n            },\n            collapsed: function collapsed(v) {\n                panel.model.contents.storage.removeExpanded(v.model);\n            }\n        });\n    },\n\n    /** override to remove expandedIds from webstorage */\n    collapseAll: function collapseAll() {\n        this.model.contents.storage.clearExpanded();\n        _super.prototype.collapseAll.call(this);\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** Override to correctly set the historyId of the new collection */\n    getSelectedModels: function getSelectedModels() {\n        var collection = _super.prototype.getSelectedModels.call(this);\n        collection.historyId = this.collection.historyId;\n        return collection;\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .show-selectors-btn\": \"toggleSelectors\",\n        \"click > .controls .prev\": \"_clickPrevPage\",\n        \"click > .controls .next\": \"_clickNextPage\",\n        \"change > .controls .pages\": \"_changePageSelect\",\n        // allow (error) messages to be clicked away\n        \"click .messages [class$=message]\": \"clearMessages\"\n    }),\n\n    _clickPrevPage: function _clickPrevPage(ev) {\n        this.model.clearUpdateTimeout();\n        this.model.contents.fetchPrevPage();\n    },\n\n    _clickNextPage: function _clickNextPage(ev) {\n        this.model.clearUpdateTimeout();\n        this.model.contents.fetchNextPage();\n    },\n\n    _changePageSelect: function _changePageSelect(ev) {\n        this.model.clearUpdateTimeout();\n        var page = $(ev.currentTarget).val();\n        this.model.contents.fetchPage(page);\n    },\n\n    /** Toggle and store the deleted visibility and re-render items\n     * @returns {Boolean} new setting\n     */\n    toggleShowDeleted: function toggleShowDeleted(show, options) {\n        show = show !== undefined ? show : !this.model.contents.includeDeleted;\n        var contents = this.model.contents;\n        contents.setIncludeDeleted(show, options);\n        this.trigger(\"show-deleted\", show);\n\n        contents.fetchCurrentPage({ renderAll: true });\n        return show;\n    },\n\n    /** Toggle and store whether to render explicity hidden contents\n     * @returns {Boolean} new setting\n     */\n    toggleShowHidden: function toggleShowHidden(show, store, options) {\n        // console.log( 'toggleShowHidden', show, store );\n        show = show !== undefined ? show : !this.model.contents.includeHidden;\n        var contents = this.model.contents;\n        contents.setIncludeHidden(show, options);\n        this.trigger(\"show-hidden\", show);\n\n        contents.fetchCurrentPage({ renderAll: true });\n        return show;\n    },\n\n    /** On the first search, if there are no details - load them, then search */\n    _firstSearch: function _firstSearch(searchFor) {\n        var _this4 = this;\n\n        var inputSelector = \"> .controls .search-input\";\n        this.log(\"onFirstSearch\", searchFor);\n\n        // if the contents already have enough details to search, search and return now\n        if (this.model.contents.haveSearchDetails()) {\n            this.searchItems(searchFor);\n            return;\n        }\n\n        // otherwise, load the details progressively here\n        this.$(inputSelector).searchInput(\"toggle-loading\");\n        // set this now so that only results will show during progress\n        this.searchFor = searchFor;\n        var xhr = this.model.contents.progressivelyFetchDetails({ silent: true }).progress(function (response, limit, offset) {\n            _this4.renderItems();\n            _this4.trigger(\"search:loading-progress\", limit, offset);\n        }).always(function () {\n            _this4.$el.find(inputSelector).searchInput(\"toggle-loading\");\n        }).done(function () {\n            _this4.searchItems(searchFor, \"force\");\n        });\n    },\n\n    /** clear the search filters and show all views that are normally shown */\n    clearSearch: function clearSearch(searchFor) {\n        var _this5 = this;\n\n        if (!this.searchFor) return this;\n        //this.log( 'onSearchClear', this );\n        this.searchFor = \"\";\n        this.trigger(\"search:clear\", this);\n        this.$(\"> .controls .search-query\").val(\"\");\n        // NOTE: silent + render prevents collection update event with merge only\n        // - which causes an empty page due to event handler above\n        this.model.contents.fetchCurrentPage({ silent: true }).done(function () {\n            _this5.renderItems();\n        });\n        return this;\n    },\n\n    // ........................................................................ error handling\n    /** Event handler for errors (from the panel, the history, or the history's contents)\n     *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n     *  @param {Model or View} model    the (Backbone) source of the error\n     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n     *  @param {Object} options         the options map commonly used with bbone ajax\n     */\n    errorHandler: function errorHandler(model, xhr, options) {\n        //TODO: to mixin or base model\n        // interrupted ajax or no connection\n        if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n            // return ERROR_MODAL.offlineErrorModal();\n            // fail silently\n            return;\n        }\n        // otherwise, leave something to report in the console\n        this.error(model, xhr, options);\n        // and feedback to a modal\n        // if sent two strings (and possibly details as 'options'), use those as message and title\n        if (_.isString(model) && _.isString(xhr)) {\n            var message = model;\n            var title = xhr;\n            return _errorModal2.default.errorModal(message, title, options);\n        }\n        // bad gateway\n        // TODO: possibly to global handler\n        if (xhr && xhr.status === 502) {\n            return _errorModal2.default.badGatewayErrorModal();\n        }\n        return _errorModal2.default.ajaxErrorModal(model, xhr, options);\n    },\n\n    /** Remove all messages from the panel. */\n    clearMessages: function clearMessages(ev) {\n        var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n        $target.fadeOut(this.fxSpeed, function () {\n            $(this).remove();\n        });\n        return this;\n    },\n\n    // ........................................................................ scrolling\n    /** Scrolls the panel to show the content sub-view with the given hid.\n     *  @param {Integer} hid    the hid of item to scroll into view\n     *  @returns {HistoryView} the panel\n     */\n    scrollToHid: function scrollToHid(hid) {\n        return this.scrollToItem(_.first(this.viewsWhereModel({ hid: hid })));\n    },\n\n    // ........................................................................ misc\n    /** utility for adding -st, -nd, -rd, -th to numbers */\n    ordinalIndicator: function ordinalIndicator(number) {\n        var numStr = \"\" + number;\n        switch (numStr.charAt(numStr.length - 1)) {\n            case \"1\":\n                return numStr + \"st\";\n            case \"2\":\n                return numStr + \"nd\";\n            case \"3\":\n                return numStr + \"rd\";\n            default:\n                return numStr + \"th\";\n        }\n    },\n\n    /** Return a string rep of the history */\n    toString: function toString() {\n        return \"HistoryView(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryView.prototype.templates = function () {\n    var mainTemplate = function mainTemplate() {\n        return \"<div>\\n            <div class=\\\"controls\\\"></div>\\n            <ul class=\\\"list-items\\\"></ul>\\n            <div class=\\\"empty-message infomessagesmall\\\"></div>',\\n        </div>\";\n    };\n\n    var controlsTemplate = _baseMvc2.default.wrapTemplate(['<div class=\"controls\">', '<div class=\"title\">', '<div class=\"name\"><%- history.name %></div>', \"</div>\", '<div class=\"subtitle\"></div>', '<div class=\"history-size\"><%- history.nice_size %></div>', '<div class=\"actions\"></div>', '<div class=\"messages\">', \"<% if( history.deleted && history.purged ){ %>\", '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This history has been purged and deleted\"), \"</div>\", \"<% } else if( history.deleted ){ %>\", '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This history has been deleted\"), \"</div>\", \"<% } else if( history.purged ){ %>\", '<div class=\"deleted-msg warningmessagesmall\">', (0, _localization2.default)(\"This history has been purged\"), \"</div>\", \"<% } %>\", \"<% if( history.message ){ %>\",\n    // should already be localized\n    '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">', \"<%= history.message.text %>\", \"</div>\", \"<% } %>\", \"</div>\",\n\n    // add tags and annotations\n    '<div class=\"tags-display\"></div>', '<div class=\"annotation-display\"></div>', '<div class=\"search\">', '<div class=\"search-input\"></div>', \"</div>\", '<div class=\"list-actions\">', '<div class=\"btn-group\">', '<button class=\"select-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"All\"), \"</button>\", '<button class=\"deselect-all btn btn-default\"', 'data-mode=\"select\">', (0, _localization2.default)(\"None\"), \"</button>\", \"</div>\", '<div class=\"list-action-menu btn-group\">', \"</div>\", \"</div>\", '<div class=\"list-pagination form-inline\"></div>', \"</div>\"], \"history\");\n\n    var paginationTemplate = _baseMvc2.default.wrapTemplate(['<button class=\"prev\" <%- pages.current === 1 ? \"disabled\" : \"\" %>>previous</button>', '<select class=\"pages form-control\" ', 'title=\"', (0, _localization2.default)(\"Click to open and select a page. Begin typing a page number to select it\"), '\">', \"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>\", '<option value=\"<%- i - 1 %>\" <%- i === pages.current ? \"selected\" : \"\" %>>', \"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages\", \"</option>\", \"<% }); %>\", \"</select>\", '<button class=\"next\" <%- pages.current === pages.last ? \"disabled\" : \"\" %>>next</button>'], \"pages\");\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        el: mainTemplate,\n        controls: controlsTemplate,\n        pagination: paginationTemplate\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    HistoryView: HistoryView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 250 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\"use_strict\";\n\nvar $ = _jquery2.default;\n//TODO: too specific to history panel\nfunction LoadingIndicator($where, options) {\n    var self = this;\n    // defaults\n    options = _jquery2.default.extend({\n        cover: false\n    }, options || {});\n\n    function render() {\n        var html = ['<div class=\"loading-indicator\">', '<div class=\"loading-indicator-text\">', '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>', '<span class=\"loading-indicator-message\">loading...</span>', \"</div>\", \"</div>\"].join(\"\\n\");\n\n        var $indicator = $(html).hide().css(options.css || {\n            position: \"fixed\"\n        });\n\n        var $text = $indicator.children(\".loading-indicator-text\");\n\n        if (options.cover) {\n            $indicator.css({\n                \"z-index\": 2,\n                top: $where.css(\"top\"),\n                bottom: $where.css(\"bottom\"),\n                left: $where.css(\"left\"),\n                right: $where.css(\"right\"),\n                opacity: 0.5,\n                \"background-color\": \"white\",\n                \"text-align\": \"center\"\n            });\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                \"margin-top\": \"20px\"\n            });\n        } else {\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                margin: \"12px 0px 0px 10px\",\n                opacity: \"0.85\",\n                color: \"grey\"\n            });\n            $text.children(\".loading-indicator-message\").css({\n                margin: \"0px 8px 0px 0px\",\n                \"font-style\": \"italic\"\n            });\n        }\n        return $indicator;\n    }\n\n    self.show = function (msg, speed, callback) {\n        msg = msg || \"loading...\";\n        speed = speed || \"fast\";\n        // remove previous\n        $where.parent().find(\".loading-indicator\").remove();\n        // since position is fixed - we insert as sibling\n        self.$indicator = render().insertBefore($where);\n        self.message(msg);\n        self.$indicator.fadeIn(speed, callback);\n        return self;\n    };\n\n    self.message = function (msg) {\n        self.$indicator.find(\"i\").text(msg);\n    };\n\n    self.hide = function (speed, callback) {\n        speed = speed || \"fast\";\n        if (self.$indicator && self.$indicator.length) {\n            self.$indicator.fadeOut(speed, function () {\n                self.$indicator.remove();\n                if (callback) {\n                    callback();\n                }\n            });\n        } else {\n            if (callback) {\n                callback();\n            }\n        }\n        return self;\n    };\n    return self;\n}\n\n//============================================================================\nexports.default = LoadingIndicator;\n\n/***/ }),\n/* 251 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _datasetLiEdit = __webpack_require__(135);\n\nvar _datasetLiEdit2 = _interopRequireDefault(_datasetLiEdit);\n\nvar _hdaLi = __webpack_require__(131);\n\nvar _hdaLi2 = _interopRequireDefault(_hdaLi);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _datasetLiEdit2.default.DatasetListItemEdit;\n/** @class Editing view for HistoryDatasetAssociation.\n */\nvar HDAListItemEdit = _super.extend(\n/** @lends HDAListItemEdit.prototype */{\n    className: _super.prototype.className + \" history-content\",\n\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails: function _fetchModelDetails() {\n        var view = this;\n        if (view.model.inReadyState() && !view.model.hasDetails()) {\n            return view.model.fetch({ silent: true });\n\n            // special case the need for the rerunnable and creating_job attributes\n            // needed for rendering re-run button on queued, running datasets\n        } else if (!view.model.has(\"rerunnable\")) {\n            return view.model.fetch({\n                silent: true,\n                data: {\n                    // only fetch rerunnable and creating_job to keep overhead down\n                    keys: [\"rerunnable\", \"creating_job\"].join(\",\")\n                }\n            });\n        }\n        return jQuery.when();\n    },\n\n    /** event map */\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .unhide-link\": function clickUnhideLink(ev) {\n            this.model.unhide();\n            return false;\n        }\n    }),\n\n    /** string rep */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"HDAListItemEdit(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemEdit.prototype.templates = function () {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: _baseMvc2.default.wrapTemplate([\"<% if( !dataset.visible ){ %>\",\n        // add a link to unhide a dataset\n        '<div class=\"hidden-msg warningmessagesmall\">', (0, _localization2.default)(\"This dataset has been hidden\"), '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">', (0, _localization2.default)(\"Unhide it\"), \"</a>\", \"</div>\", \"<% } %>\"], \"dataset\")\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        //NOTE: *steal* the HDAListItemView titleBar\n        titleBar: _hdaLi2.default.HDAListItemView.prototype.templates.titleBar,\n        warnings: warnings\n    });\n}();\n\n//==============================================================================\nexports.default = {\n    HDAListItemEdit: HDAListItemEdit\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 252 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _hdcaLi = __webpack_require__(133);\n\nvar _hdcaLi2 = _interopRequireDefault(_hdcaLi);\n\nvar _collectionViewEdit = __webpack_require__(253);\n\nvar _collectionViewEdit2 = _interopRequireDefault(_collectionViewEdit);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar _super = _hdcaLi2.default.HDCAListItemView;\n/** @class Editing view for HistoryDatasetCollectionAssociation.\n */\nvar HDCAListItemEdit = _super.extend(\n/** @lends HDCAListItemEdit.prototype */{\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** Override to return editable versions of the collection panels */\n    _getFoldoutPanelClass: function _getFoldoutPanelClass() {\n        var collectionType = this.model.get(\"collection_type\");\n        switch (collectionType) {\n            case \"list\":\n                return _collectionViewEdit2.default.ListCollectionViewEdit;\n            case \"paired\":\n                return _collectionViewEdit2.default.PairCollectionViewEdit;\n            case \"list:paired\":\n                return _collectionViewEdit2.default.ListOfPairsCollectionViewEdit;\n            case \"list:list\":\n                return _collectionViewEdit2.default.ListOfListsCollectionViewEdit;\n        }\n        throw new TypeError(\"Unknown collection_type: \" + collectionType);\n    },\n\n    // ......................................................................... delete\n    /** In this override, add the delete button. */\n    _renderPrimaryActions: function _renderPrimaryActions() {\n        this.log(this + \"._renderPrimaryActions\");\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()]);\n    },\n\n    /** Render icon-button to delete this collection. */\n    _renderDeleteButton: function _renderDeleteButton() {\n        var _this = this;\n\n        var deleted = this.model.get(\"deleted\");\n        return (0, _faIconButton2.default)({\n            title: deleted ? (0, _localization2.default)(\"Dataset collection is already deleted\") : (0, _localization2.default)(\"Delete\"),\n            classes: \"delete-btn\",\n            faIcon: \"fa-times\",\n            disabled: deleted,\n            onclick: function onclick() {\n                // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                _this.$el.find(\".icon-btn.delete-btn\").trigger(\"mouseout\");\n                _this.model[\"delete\"]();\n            }\n        });\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"HDCAListItemEdit(\" + modelString + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    HDCAListItemEdit: HDCAListItemEdit\n};\n\n/***/ }),\n/* 253 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _collectionView = __webpack_require__(134);\n\nvar _collectionView2 = _interopRequireDefault(_collectionView);\n\nvar _collectionModel = __webpack_require__(80);\n\nvar _collectionModel2 = _interopRequireDefault(_collectionModel);\n\nvar _collectionLiEdit = __webpack_require__(254);\n\nvar _collectionLiEdit2 = _interopRequireDefault(_collectionLiEdit);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _tag = __webpack_require__(67);\n\nvar _tag2 = _interopRequireDefault(_tag);\n\nvar _faIconButton = __webpack_require__(57);\n\nvar _faIconButton2 = _interopRequireDefault(_faIconButton);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(15);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class editable View/Controller for a dataset collection.\n */\nvar _super = _collectionView2.default.CollectionView;\nvar CollectionViewEdit = _super.extend(\n/** @lends CollectionView.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass: _collectionLiEdit2.default.DatasetDCEListItemEdit,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLiEdit2.default.NestedDCDCEListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize: function initialize(attributes) {\n        _super.prototype.initialize.call(this, attributes);\n    },\n\n    /** In this override, make the collection name editable\n     */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call(this, $where);\n        if (!this.model) {\n            return;\n        }\n\n        // anon users shouldn't have access to any of the following\n        if (!Galaxy.user || Galaxy.user.isAnonymous()) {\n            return;\n        }\n\n        this.tagsEditorShown = true;\n\n        //TODO: extract\n        var panel = this;\n\n        var nameSelector = \"> .controls .name\";\n        $where.find(nameSelector).attr(\"title\", (0, _localization2.default)(\"Click to rename collection\")).tooltip({ placement: \"bottom\" }).make_text_editable({\n            on_finish: function on_finish(newName) {\n                var previousName = panel.model.get(\"name\");\n                if (newName && newName !== previousName) {\n                    panel.$el.find(nameSelector).text(newName);\n                    panel.model.save({ name: newName }).fail(function () {\n                        panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                    });\n                } else {\n                    panel.$el.find(nameSelector).text(previousName);\n                }\n            }\n        });\n        this.tagsEditor = new _tag2.default.TagsEditor({\n            model: this.model,\n            el: $where.find(\".tags-display\"),\n            onshowFirstTime: function onshowFirstTime() {\n                this.render();\n            },\n            usePrompt: false\n        });\n        this.tagsEditor.toggle(true);\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"CollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionViewEdit = CollectionViewEdit.extend(\n/** @lends ListCollectionView.prototype */{\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass: _collectionLiEdit2.default.DatasetDCEListItemEdit,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListCollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class Editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionViewEdit = ListCollectionViewEdit.extend(\n/** @lends PairCollectionViewEdit.prototype */{\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"PairCollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class Editable (roughly since these collections are immutable),\n *  View/Controller for a dataset collection.\n */\nvar NestedPairCollectionViewEdit = PairCollectionViewEdit.extend(\n/** @lends NestedPairCollectionViewEdit.prototype */{\n    /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n    _setUpBehaviors: function _setUpBehaviors($where) {\n        _super.prototype._setUpBehaviors.call(this, $where);\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"NestedPairCollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class editable, View/Controller for a list of pairs dataset collection. */\nvar ListOfPairsCollectionViewEdit = CollectionViewEdit.extend(\n/** @lends ListOfPairsCollectionView.prototype */{\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLiEdit2.default.NestedDCDCEListItemEdit.extend({\n        foldoutPanelClass: NestedPairCollectionViewEdit\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListOfPairsCollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n// =============================================================================\n/** @class View/Controller for a list of lists dataset collection. */\nvar ListOfListsCollectionViewEdit = CollectionViewEdit.extend(\n/** @lends ListOfListsCollectionView.prototype */{\n    //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: _collectionLiEdit2.default.NestedDCDCEListItemEdit.extend({\n        foldoutPanelClass: NestedPairCollectionViewEdit\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString: function toString() {\n        return \"ListOfListsCollectionViewEdit(\" + (this.model ? this.model.get(\"name\") : \"\") + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    CollectionViewEdit: CollectionViewEdit,\n    ListCollectionViewEdit: ListCollectionViewEdit,\n    PairCollectionViewEdit: PairCollectionViewEdit,\n    ListOfPairsCollectionViewEdit: ListOfPairsCollectionViewEdit,\n    ListOfListsCollectionViewEdit: ListOfListsCollectionViewEdit\n};\n\n/***/ }),\n/* 254 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(jQuery, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _collectionLi = __webpack_require__(87);\n\nvar _collectionLi2 = _interopRequireDefault(_collectionLi);\n\nvar _datasetLiEdit = __webpack_require__(135);\n\nvar _datasetLiEdit2 = _interopRequireDefault(_datasetLiEdit);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//==============================================================================\nvar DCListItemView = _collectionLi2.default.DCListItemView;\n/** @class Edit view for DatasetCollection.\n */\nvar DCListItemEdit = DCListItemView.extend(\n/** @lends DCListItemEdit.prototype */{\n    /** override to add linkTarget */\n    initialize: function initialize(attributes) {\n        DCListItemView.prototype.initialize.call(this, attributes);\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DCListItemEdit(\" + modelString + \")\";\n    }\n});\n\n//==============================================================================\nvar DCEListItemView = _collectionLi2.default.DCEListItemView;\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemEdit = DCEListItemView.extend(\n/** @lends DCEListItemEdit.prototype */{\n    //TODO: this might be expendable - compacted with HDAListItemView\n\n    /** set up */\n    initialize: function initialize(attributes) {\n        DCEListItemView.prototype.initialize.call(this, attributes);\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DCEListItemEdit(\" + modelString + \")\";\n    }\n});\n\n//==============================================================================\n// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n//TODO: but should - if we can find something simpler than using diamond\n/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemEdit = _datasetLiEdit2.default.DatasetListItemEdit.extend(\n/** @lends DatasetDCEListItemEdit.prototype */{\n    /** set up */\n    initialize: function initialize(attributes) {\n        _datasetLiEdit2.default.DatasetListItemEdit.prototype.initialize.call(this, attributes);\n    },\n\n    // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n    //TODO: fix\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails: function _fetchModelDetails() {\n        var view = this;\n        if (view.model.inReadyState() && !view.model.hasDetails()) {\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    /** Override to remove delete button */\n    _renderDeleteButton: function _renderDeleteButton() {\n        return null;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"DatasetDCEListItemEdit(\" + modelString + \")\";\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemEdit.prototype.templates = function () {\n    return _.extend({}, _datasetLiEdit2.default.DatasetListItemEdit.prototype.templates, {\n        titleBar: _collectionLi2.default.DatasetDCEListItemView.prototype.templates.titleBar\n    });\n}();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemEdit = _collectionLi2.default.NestedDCDCEListItemView.extend(\n/** @lends NestedDCDCEListItemEdit.prototype */{\n    /** String representation */\n    toString: function toString() {\n        var modelString = this.model ? \"\" + this.model : \"(no model)\";\n        return \"NestedDCDCEListItemEdit(\" + modelString + \")\";\n    }\n});\n\n//==============================================================================\nexports.default = {\n    DCListItemEdit: DCListItemEdit,\n    DCEListItemEdit: DCEListItemEdit,\n    DatasetDCEListItemEdit: DatasetDCEListItemEdit,\n    NestedDCDCEListItemEdit: NestedDCDCEListItemEdit\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 255 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _listCollectionCreator = __webpack_require__(78);\n\nvar _listCollectionCreator2 = _interopRequireDefault(_listCollectionCreator);\n\nvar _hdcaModel = __webpack_require__(79);\n\nvar _hdcaModel2 = _interopRequireDefault(_hdcaModel);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"collections\";\n/*==============================================================================\nTODO:\n    the paired creator doesn't really mesh with the list creator as parent\n        it may be better to make an abstract super class for both\n    composites may inherit from this (or vis-versa)\n    PairedDatasetCollectionElementView doesn't make a lot of sense\n\n==============================================================================*/\n/**  */\nvar PairedDatasetCollectionElementView = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function initialize(attributes) {\n        this.element = attributes.element || {};\n        this.identifier = attributes.identifier;\n    },\n\n    render: function render() {\n        this.$el.attr(\"data-element-id\", this.element.id).html(this.template({\n            identifier: this.identifier,\n            element: this.element\n        }));\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(['<span class=\"identifier\"><%- identifier %></span>', '<span class=\"name\"><%- element.name %></span>'].join(\"\")),\n\n    /** remove the DOM and any listeners */\n    destroy: function destroy() {\n        this.off();\n        this.$el.remove();\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\nvar _super = _listCollectionCreator2.default.ListCollectionCreator;\n\n/** An interface for building collections.\n */\nvar PairCollectionCreator = _super.extend({\n    /** the class used to display individual elements */\n    elementViewClass: PairedDatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass: _hdcaModel2.default.HistoryPairDatasetCollection,\n    className: \"pair-collection-creator collection-creator flex-row-container\",\n\n    /** override to no-op */\n    _mangleDuplicateNames: function _mangleDuplicateNames() {},\n\n    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n    //      bad inital choices and\n    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n    /** render the entire interface */\n    render: function render(speed, callback) {\n        if (this.workingElements.length === 2) {\n            return _super.prototype.render.call(this, speed, callback);\n        }\n        return this._renderInvalid(speed, callback);\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** render forward/reverse */\n    _renderList: function _renderList(speed, callback) {\n        //this.debug( '-- _renderList' );\n        //precondition: there are two valid elements in workingElements\n        var creator = this;\n\n        var $tmp = jQuery(\"<div/>\");\n        var $list = creator.$list();\n\n        // lose the original views, create the new, append all at once, then call their renders\n        _.each(this.elementViews, function (view) {\n            view.destroy();\n            creator.removeElementView(view);\n        });\n        $tmp.append(creator._createForwardElementView().$el);\n        $tmp.append(creator._createReverseElementView().$el);\n        $list.empty().append($tmp.children());\n        _.invoke(creator.elementViews, \"render\");\n    },\n\n    /** create the forward element view */\n    _createForwardElementView: function _createForwardElementView() {\n        return this._createElementView(this.workingElements[0], {\n            identifier: \"forward\"\n        });\n    },\n\n    /** create the forward element view */\n    _createReverseElementView: function _createReverseElementView() {\n        return this._createElementView(this.workingElements[1], {\n            identifier: \"reverse\"\n        });\n    },\n\n    /** create an element view, cache in elementViews, and return */\n    _createElementView: function _createElementView(element, options) {\n        var elementView = new this.elementViewClass(_.extend(options, {\n            element: element\n        }));\n        this.elementViews.push(elementView);\n        return elementView;\n    },\n\n    /** swap the forward, reverse elements and re-render */\n    swap: function swap() {\n        this.workingElements = [this.workingElements[1], this.workingElements[0]];\n        this._renderList();\n    },\n\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .swap\": \"swap\"\n    }),\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates: _.extend(_.clone(_super.prototype.templates), {\n        /** the middle: element list */\n        middle: _.template(['<div class=\"collection-elements-controls\">', '<a class=\"swap\" href=\"javascript:void(0);\" title=\"', (0, _localization2.default)(\"Swap forward and reverse datasets\"), '\">', (0, _localization2.default)(\"Swap\"), \"</a>\", \"</div>\", '<div class=\"collection-elements scroll-container flex-row\">', \"</div>\"].join(\"\")),\n\n        /** help content */\n        helpContent: _.template([\"<p>\", (0, _localization2.default)([\"Pair collections are permanent collections containing two datasets: one forward and one reverse. \", \"Often these are forward and reverse reads. The pair collections can be passed to tools and \", \"workflows in order to have analyses done on both datasets. This interface allows \", \"you to create a pair, name it, and swap which is forward and which reverse.\"].join(\"\")), \"</p>\", \"<ul>\", \"<li>\", (0, _localization2.default)(['Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ', \"and the reverse dataset forward.\"].join(\"\")), \"</li>\", \"<li>\", (0, _localization2.default)(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\"\")), \"</li>\", \"</ul><br />\", \"<p>\", (0, _localization2.default)(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>.'].join(\"\")), \"</p>\"].join(\"\")),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial: _.template(['<div class=\"header flex-row no-flex\">', '<div class=\"alert alert-warning\" style=\"display: block\">', '<span class=\"alert-message\">', \"<% if( _.size( problems ) ){ %>\", (0, _localization2.default)(\"The following selections could not be included due to problems\"), \"<ul><% _.each( problems, function( problem ){ %>\", \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\", \"<% }); %></ul>\", \"<% } else if( _.size( elements ) === 0 ){ %>\", (0, _localization2.default)(\"No datasets were selected\"), \".\", \"<% } else if( _.size( elements ) === 1 ){ %>\", (0, _localization2.default)(\"Only one dataset was selected\"), \": <%- elements[0].name %>\", \"<% } else if( _.size( elements ) > 2 ){ %>\", (0, _localization2.default)(\"Too many datasets were selected\"), ': <%- _.pluck( elements, \"name\" ).join( \", \") %>', \"<% } %>\", \"<br />\", (0, _localization2.default)(\"Two (and only two) elements are needed for the pair\"), \". \", (0, _localization2.default)(\"You may need to \"), '<a class=\"cancel-create\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"cancel\"), \"</a> \", (0, _localization2.default)(\"and reselect new elements\"), \".\", \"</span>\", \"</div>\", \"</div>\", '<div class=\"footer flex-row no-flex\">', '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', (0, _localization2.default)(\"Cancel\"), \"</button>\",\n        // _l( 'Create a different kind of collection' ),\n        \"</div>\", \"</div>\", \"</div>\"].join(\"\"))\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString: function toString() {\n        return \"PairCollectionCreator\";\n    }\n});\n\n//==============================================================================\n/** List collection flavor of collectionCreatorModal. */\nvar pairCollectionCreatorModal = function _pairCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = (0, _localization2.default)(\"Create a collection from a pair of datasets\");\n    return _listCollectionCreator2.default.collectionCreatorModal(elements, options, PairCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a pair collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createPairCollection(contents, defaultHideSourceItems) {\n    var elements = contents.toJSON();\n\n    var promise = pairCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function creationFn(elements, name, hideSourceItems) {\n            elements = [{ name: \"forward\", src: \"hda\", id: elements[0].id }, { name: \"reverse\", src: \"hda\", id: elements[1].id }];\n            return contents.createHDCA(elements, \"paired\", name, hideSourceItems);\n        }\n    });\n\n    return promise;\n}\n\n//==============================================================================\nexports.default = {\n    PairCollectionCreator: PairCollectionCreator,\n    pairCollectionCreatorModal: pairCollectionCreatorModal,\n    createPairCollection: createPairCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 256 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, jQuery, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _levenshtein = __webpack_require__(257);\n\nvar _levenshtein2 = _interopRequireDefault(_levenshtein);\n\nvar _naturalSort = __webpack_require__(122);\n\nvar _naturalSort2 = _interopRequireDefault(_naturalSort);\n\nvar _baseCreator = __webpack_require__(121);\n\nvar _baseCreator2 = _interopRequireDefault(_baseCreator);\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nvar _localization = __webpack_require__(4);\n\nvar _localization2 = _interopRequireDefault(_localization);\n\n__webpack_require__(123);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar logNamespace = \"collections\";\n/* ============================================================================\nTODO:\n\n\nPROGRAMMATICALLY:\ncurrPanel.once( 'rendered', function(){\n    currPanel.showSelectors();\n    currPanel.selectAll();\n    _.last( currPanel.actionsPopup.options ).func();\n});\n\n============================================================================ */\n/** A view for paired datasets in the collections creator.\n */\nvar PairView = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    tagName: \"li\",\n    className: \"dataset paired\",\n\n    initialize: function initialize(attributes) {\n        this.pair = attributes.pair || {};\n    },\n\n    template: _.template(['<span class=\"forward-dataset-name flex-column\"><%- pair.forward.name %></span>', '<span class=\"pair-name-column flex-column\">', '<span class=\"pair-name\"><%- pair.name %></span>', \"</span>\", '<span class=\"reverse-dataset-name flex-column\"><%- pair.reverse.name %></span>'].join(\"\")),\n\n    render: function render() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el.attr(\"draggable\", true).data(\"pair\", this.pair).html(this.template({ pair: this.pair })).addClass(\"flex-column-container\").get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        return this;\n    },\n\n    events: {\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function _dragstart(ev) {\n        ev.currentTarget.style.opacity = \"0.4\";\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.pair));\n\n        this.$el.parent().trigger(\"pair.dragstart\", [this]);\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragend: function _dragend(ev) {\n        ev.currentTarget.style.opacity = \"1.0\";\n        this.$el.parent().trigger(\"pair.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function _sendToParent(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return \"PairView(\" + this.pair.name + \")\";\n    }\n});\n\n// ============================================================================\n/** returns an autopair function that uses the provided options.match function */\nfunction autoPairFnBuilder(options) {\n    options = options || {};\n    options.createPair = options.createPair || function _defaultCreatePair(params) {\n        params = params || {};\n        var a = params.listA.splice(params.indexA, 1)[0];\n        var b = params.listB.splice(params.indexB, 1)[0];\n        var aInBIndex = params.listB.indexOf(a);\n        var bInAIndex = params.listA.indexOf(b);\n        if (aInBIndex !== -1) {\n            params.listB.splice(aInBIndex, 1);\n        }\n        if (bInAIndex !== -1) {\n            params.listA.splice(bInAIndex, 1);\n        }\n        return this._pair(a, b, { silent: true });\n    };\n    // compile these here outside of the loop\n    var _regexps = [];\n    function getRegExps() {\n        if (!_regexps.length) {\n            _regexps = [new RegExp(this.filters[0]), new RegExp(this.filters[1])];\n        }\n        return _regexps;\n    }\n    // mangle params as needed\n    options.preprocessMatch = options.preprocessMatch || function _defaultPreprocessMatch(params) {\n        var regexps = getRegExps.call(this);\n        return _.extend(params, {\n            matchTo: params.matchTo.name.replace(regexps[0], \"\"),\n            possible: params.possible.name.replace(regexps[1], \"\")\n        });\n    };\n\n    return function _strategy(params) {\n        this.debug(\"autopair _strategy ---------------------------\");\n        params = params || {};\n        var listA = params.listA;\n        var listB = params.listB;\n        var indexA = 0;\n        var indexB;\n\n        var bestMatch = {\n            score: 0.0,\n            index: null\n        };\n\n        var paired = [];\n        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n        this.debug(\"starting list lens:\", listA.length, listB.length);\n        this.debug(\"bestMatch (starting):\", JSON.stringify(bestMatch, null, \"  \"));\n\n        while (indexA < listA.length) {\n            var matchTo = listA[indexA];\n            bestMatch.score = 0.0;\n\n            for (indexB = 0; indexB < listB.length; indexB++) {\n                var possible = listB[indexB];\n                this.debug(indexA + \":\" + matchTo.name);\n                this.debug(indexB + \":\" + possible.name);\n\n                // no matching with self\n                if (listA[indexA] !== listB[indexB]) {\n                    bestMatch = options.match.call(this, options.preprocessMatch.call(this, {\n                        matchTo: matchTo,\n                        possible: possible,\n                        index: indexB,\n                        bestMatch: bestMatch\n                    }));\n                    this.debug(\"bestMatch:\", JSON.stringify(bestMatch, null, \"  \"));\n                    if (bestMatch.score === 1.0) {\n                        this.debug(\"breaking early due to perfect match\");\n                        break;\n                    }\n                }\n            }\n            var scoreThreshold = options.scoreThreshold.call(this);\n            this.debug(\"scoreThreshold:\", scoreThreshold);\n            this.debug(\"bestMatch.score:\", bestMatch.score);\n\n            if (bestMatch.score >= scoreThreshold) {\n                //console.debug( 'autoPairFnBuilder.strategy', listA[ indexA ].name, listB[ bestMatch.index ].name );\n                paired.push(options.createPair.call(this, {\n                    listA: listA,\n                    indexA: indexA,\n                    listB: listB,\n                    indexB: bestMatch.index\n                }));\n                //console.debug( 'list lens now:', listA.length, listB.length );\n            } else {\n                indexA += 1;\n            }\n            if (!listA.length || !listB.length) {\n                return paired;\n            }\n        }\n        this.debug(\"paired:\", JSON.stringify(paired, null, \"  \"));\n        this.debug(\"autopair _strategy ---------------------------\");\n        return paired;\n    };\n}\n\n// ============================================================================\n/** An interface for building collections of paired datasets.\n */\nvar PairedCollectionCreator = Backbone.View.extend(_baseMvc2.default.LoggableMixin).extend(_baseCreator2.default.CollectionCreatorMixin).extend({\n    _logNamespace: logNamespace,\n\n    className: \"list-of-pairs-collection-creator collection-creator flex-row-container\",\n\n    /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n    initialize: function initialize(attributes) {\n        this.metric(\"PairedCollectionCreator.initialize\", attributes);\n        //this.debug( '-- PairedCollectionCreator:', attributes );\n\n        attributes = _.defaults(attributes, {\n            datasets: [],\n            filters: this.DEFAULT_FILTERS,\n            automaticallyPair: true,\n            strategy: \"lcs\",\n            matchPercentage: 0.9,\n            twoPassAutopairing: true\n        });\n\n        /** unordered, original list */\n        this.initialList = attributes.datasets;\n\n        /** is this from a history? if so, what's its id? */\n        this.historyId = attributes.historyId;\n\n        /** which filters should be used initially? (String[2] or name in commonFilters) */\n        this.filters = this.commonFilters[attributes.filters] || this.commonFilters[this.DEFAULT_FILTERS];\n        if (_.isArray(attributes.filters)) {\n            this.filters = attributes.filters;\n        }\n\n        /** try to auto pair the unpaired datasets on load? */\n        this.automaticallyPair = attributes.automaticallyPair;\n\n        /** what method to use for auto pairing (will be passed aggression level) */\n        this.strategy = this.strategies[attributes.strategy] || this.strategies[this.DEFAULT_STRATEGY];\n        if (_.isFunction(attributes.strategy)) {\n            this.strategy = attributes.strategy;\n        }\n\n        /** distance/mismatch level allowed for autopairing */\n        this.matchPercentage = attributes.matchPercentage;\n\n        /** try to autopair using simple first, then this.strategy on the remainder */\n        this.twoPassAutopairing = attributes.twoPassAutopairing;\n\n        /** remove file extensions (\\.*) from created pair names? */\n        this.removeExtensions = true;\n        //this.removeExtensions = false;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.oncancel = attributes.oncancel;\n        /** fn to call when the collection is created (scoped to this) */\n        this.oncreate = attributes.oncreate;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.autoscrollDist = attributes.autoscrollDist || 24;\n\n        /** is the unpaired panel shown? */\n        this.unpairedPanelHidden = false;\n        /** is the paired panel shown? */\n        this.pairedPanelHidden = false;\n\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n\n        this._setUpCommonSettings(attributes);\n        this._setUpBehaviors();\n        this._dataSetUp();\n    },\n\n    /** map of common filter pairs by name */\n    commonFilters: {\n        illumina: [\"_1\", \"_2\"],\n        Rs: [\"_R1\", \"_R2\"]\n    },\n    /** which commonFilter to use by default */\n    DEFAULT_FILTERS: \"illumina\",\n\n    /** map of name->fn for autopairing */\n    strategies: {\n        simple: \"autopairSimple\",\n        lcs: \"autopairLCS\",\n        levenshtein: \"autopairLevenshtein\"\n    },\n    /** default autopair strategy name */\n    DEFAULT_STRATEGY: \"lcs\",\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data: cache initialList, sort, and autopair */\n    _dataSetUp: function _dataSetUp() {\n        //this.debug( '-- _dataSetUp' );\n\n        this.paired = [];\n        this.unpaired = [];\n\n        this.selectedIds = [];\n\n        // sort initial list, add ids if needed, and save new working copy to unpaired\n        this._sortInitialList();\n        this._ensureIds();\n        this.unpaired = this.initialList.slice(0);\n\n        if (this.automaticallyPair) {\n            this.autoPair();\n            this.once(\"rendered:initial\", function () {\n                this.trigger(\"autopair\");\n            });\n        }\n    },\n\n    /** sort initial list */\n    _sortInitialList: function _sortInitialList() {\n        //this.debug( '-- _sortInitialList' );\n        this._sortDatasetList(this.initialList);\n    },\n\n    /** sort a list of datasets */\n    _sortDatasetList: function _sortDatasetList(list) {\n        // currently only natural sort by name\n        list.sort(function (a, b) {\n            return (0, _naturalSort2.default)(a.name, b.name);\n        });\n        return list;\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureIds: function _ensureIds() {\n        this.initialList.forEach(function (dataset) {\n            if (!dataset.hasOwnProperty(\"id\")) {\n                dataset.id = _.uniqueId();\n            }\n        });\n        return this.initialList;\n    },\n\n    /** split initial list into two lists, those that pass forward filters & those passing reverse */\n    _splitByFilters: function _splitByFilters() {\n        var regexFilters = this.filters.map(function (stringFilter) {\n            return new RegExp(stringFilter);\n        });\n\n        var split = [[], []];\n\n        function _filter(unpaired, filter) {\n            return filter.test(unpaired.name);\n            //return dataset.name.indexOf( filter ) >= 0;\n        }\n        this.unpaired.forEach(function _filterEach(unpaired) {\n            // 90% of the time this seems to work, but:\n            //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n            //  would need explanation in help as well\n            regexFilters.forEach(function (filter, i) {\n                if (_filter(unpaired, filter)) {\n                    split[i].push(unpaired);\n                }\n            });\n        });\n        return split;\n    },\n\n    /** add a dataset to the unpaired list in it's proper order */\n    _addToUnpaired: function _addToUnpaired(dataset) {\n        var _this = this;\n\n        // currently, unpaired is natural sorted by name, use binary search to find insertion point\n        var binSearchSortedIndex = function binSearchSortedIndex(low, hi) {\n            if (low === hi) {\n                return low;\n            }\n\n            var mid = Math.floor((hi - low) / 2) + low;\n\n            var compared = (0, _naturalSort2.default)(dataset.name, _this.unpaired[mid].name);\n\n            if (compared < 0) {\n                return binSearchSortedIndex(low, mid);\n            } else if (compared > 0) {\n                return binSearchSortedIndex(mid + 1, hi);\n            }\n            // walk the equal to find the last\n            while (_this.unpaired[mid] && _this.unpaired[mid].name === dataset.name) {\n                mid++;\n            }\n            return mid;\n        };\n\n        this.unpaired.splice(binSearchSortedIndex(0, this.unpaired.length), 0, dataset);\n    },\n\n    // ------------------------------------------------------------------------ auto pairing\n    /** two passes to automatically create pairs:\n     *  use both simpleAutoPair, then the fn mentioned in strategy\n     */\n    autoPair: function autoPair(strategy) {\n        // split first using exact matching\n        var split = this._splitByFilters();\n\n        var paired = [];\n        if (this.twoPassAutopairing) {\n            paired = this.autopairSimple({\n                listA: split[0],\n                listB: split[1]\n            });\n            split = this._splitByFilters();\n        }\n\n        // uncomment to see printlns while running tests\n        //this.debug = function(){ console.log.apply( console, arguments ); };\n\n        // then try the remainder with something less strict\n        strategy = strategy || this.strategy;\n        split = this._splitByFilters();\n        paired = paired.concat(this[strategy].call(this, {\n            listA: split[0],\n            listB: split[1]\n        }));\n        return paired;\n    },\n\n    /** autopair by exact match */\n    autopairSimple: autoPairFnBuilder({\n        scoreThreshold: function scoreThreshold() {\n            return 0.6;\n        },\n        match: function _match(params) {\n            params = params || {};\n            if (params.matchTo === params.possible) {\n                return {\n                    index: params.index,\n                    score: 1.0\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by levenshtein edit distance scoring */\n    autopairLevenshtein: autoPairFnBuilder({\n        scoreThreshold: function scoreThreshold() {\n            return this.matchPercentage;\n        },\n        match: function _matches(params) {\n            params = params || {};\n\n            var distance = (0, _levenshtein2.default)(params.matchTo, params.possible);\n\n            var score = 1.0 - distance / Math.max(params.matchTo.length, params.possible.length);\n\n            if (score > params.bestMatch.score) {\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by longest common substrings scoring */\n    autopairLCS: autoPairFnBuilder({\n        scoreThreshold: function scoreThreshold() {\n            return this.matchPercentage;\n        },\n        match: function _matches(params) {\n            params = params || {};\n\n            var match = this._naiveStartingAndEndingLCS(params.matchTo, params.possible).length;\n\n            var score = match / Math.max(params.matchTo.length, params.possible.length);\n\n            if (score > params.bestMatch.score) {\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** return the concat'd longest common prefix and suffix from two strings */\n    _naiveStartingAndEndingLCS: function _naiveStartingAndEndingLCS(s1, s2) {\n        var fwdLCS = \"\";\n        var revLCS = \"\";\n        var i = 0;\n        var j = 0;\n        while (i < s1.length && i < s2.length) {\n            if (s1[i] !== s2[i]) {\n                break;\n            }\n            fwdLCS += s1[i];\n            i += 1;\n        }\n        if (i === s1.length) {\n            return s1;\n        }\n        if (i === s2.length) {\n            return s2;\n        }\n\n        i = s1.length - 1;\n        j = s2.length - 1;\n        while (i >= 0 && j >= 0) {\n            if (s1[i] !== s2[j]) {\n                break;\n            }\n            revLCS = [s1[i], revLCS].join(\"\");\n            i -= 1;\n            j -= 1;\n        }\n        return fwdLCS + revLCS;\n    },\n\n    // ------------------------------------------------------------------------ pairing / unpairing\n    /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n    _pair: function _pair(fwd, rev, options) {\n        options = options || {};\n        this.debug(\"_pair:\", fwd, rev);\n        var pair = this._createPair(fwd, rev, options.name);\n        this.paired.push(pair);\n        this.unpaired = _.without(this.unpaired, fwd, rev);\n        if (!options.silent) {\n            this.trigger(\"pair:new\", pair);\n        }\n        return pair;\n    },\n\n    /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n    _createPair: function _createPair(fwd, rev, name) {\n        // ensure existance and don't pair something with itself\n        if (!(fwd && rev) || fwd === rev) {\n            throw new Error(\"Bad pairing: \" + [JSON.stringify(fwd), JSON.stringify(rev)]);\n        }\n        name = name || this._guessNameForPair(fwd, rev);\n        return { forward: fwd, name: name, reverse: rev };\n    },\n\n    /** try to find a good pair name for the given fwd and rev datasets */\n    _guessNameForPair: function _guessNameForPair(fwd, rev, removeExtensions) {\n        removeExtensions = removeExtensions !== undefined ? removeExtensions : this.removeExtensions;\n        var fwdName = fwd.name;\n        var revName = rev.name;\n\n        var lcs = this._naiveStartingAndEndingLCS(fwdName.replace(new RegExp(this.filters[0]), \"\"), revName.replace(new RegExp(this.filters[1]), \"\"));\n\n        if (removeExtensions) {\n            var lastDotIndex = lcs.lastIndexOf(\".\");\n            if (lastDotIndex > 0) {\n                var extension = lcs.slice(lastDotIndex, lcs.length);\n                lcs = lcs.replace(extension, \"\");\n                fwdName = fwdName.replace(extension, \"\");\n                revName = revName.replace(extension, \"\");\n            }\n        }\n        return lcs || fwdName + \" & \" + revName;\n    },\n\n    /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n    _unpair: function _unpair(pair, options) {\n        options = options || {};\n        if (!pair) {\n            throw new Error(\"Bad pair: \" + JSON.stringify(pair));\n        }\n        this.paired = _.without(this.paired, pair);\n        this._addToUnpaired(pair.forward);\n        this._addToUnpaired(pair.reverse);\n\n        if (!options.silent) {\n            this.trigger(\"pair:unpair\", [pair]);\n        }\n        return pair;\n    },\n\n    /** unpair all paired datasets */\n    unpairAll: function unpairAll() {\n        var pairs = [];\n        while (this.paired.length) {\n            pairs.push(this._unpair(this.paired[0], { silent: true }));\n        }\n        this.trigger(\"pair:unpair\", pairs);\n    },\n\n    // ------------------------------------------------------------------------ API\n    /** convert a pair into JSON compatible with the collections API */\n    _pairToJSON: function _pairToJSON(pair, src) {\n        src = src || \"hda\";\n        //TODO: consider making this the pair structure when created instead\n        return {\n            collection_type: \"paired\",\n            src: \"new_collection\",\n            name: pair.name,\n            element_identifiers: [{\n                name: \"forward\",\n                id: pair.forward.id,\n                src: src\n            }, {\n                name: \"reverse\",\n                id: pair.reverse.id,\n                src: src\n            }]\n        };\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object}    the jquery ajax request\n     */\n    createList: function createList(name) {\n        var self = this;\n\n        var url = Galaxy.root + \"api/histories/\" + this.historyId + \"/contents/dataset_collections\";\n\n        //TODO: use ListPairedCollection.create()\n        var ajaxData = {\n            type: \"dataset_collection\",\n            collection_type: \"list:paired\",\n            hide_source_items: self.hideOriginals || false,\n            name: _.escape(name || self.$(\".collection-name\").val()),\n            element_identifiers: self.paired.map(function (pair) {\n                return self._pairToJSON(pair);\n            })\n        };\n        //this.debug( JSON.stringify( ajaxData ) );\n        self.blocking = true;\n        return jQuery.ajax(url, {\n            type: \"POST\",\n            contentType: \"application/json\",\n            dataType: \"json\",\n            data: JSON.stringify(ajaxData)\n        }).always(function () {\n            self.blocking = false;\n        }).fail(function (xhr, status, message) {\n            self._ajaxErrHandler(xhr, status, message);\n        }).done(function (response, message, xhr) {\n            //this.info( 'ok', response, message, xhr );\n            self.trigger(\"collection:created\", response, message, xhr);\n            self.metric(\"collection:created\", response);\n            if (typeof self.oncreate === \"function\") {\n                self.oncreate.call(this, response, message, xhr);\n            }\n        });\n    },\n\n    /** handle ajax errors with feedback and details to the user (if available) */\n    _ajaxErrHandler: function _ajaxErrHandler(xhr, status, message) {\n        this.error(xhr, status, message);\n        var self = this;\n        var content = (0, _localization2.default)(\"An error occurred while creating this collection\");\n        if (xhr) {\n            if (xhr.readyState === 0 && xhr.status === 0) {\n                content += \": \" + (0, _localization2.default)(\"Galaxy could not be reached and may be updating.\") + (0, _localization2.default)(\" Try again in a few minutes.\");\n            } else if (xhr.responseJSON) {\n                content += \"<br /><pre>\" + JSON.stringify(xhr.responseJSON) + \"</pre>\";\n            } else {\n                content += \": \" + message;\n            }\n        }\n        self._showAlert(content, \"alert-danger\");\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** render the entire interface */\n    render: function render(speed, callback) {\n        //this.debug( '-- _render' );\n        //this.$el.empty().html( this.templates.main() );\n        this.$el.empty().html(this.templates.main());\n        this._renderHeader(speed);\n        this._renderMiddle(speed);\n        this._renderFooter(speed);\n        this._addPluginComponents();\n        this.trigger(\"rendered\", this);\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader: function _renderHeader(speed, callback) {\n        //this.debug( '-- _renderHeader' );\n        var $header = this.$(\".header\").empty().html(this.templates.header()).find(\".help-content\").prepend($(this.templates.helpContent()));\n\n        this._renderFilters();\n        return $header;\n    },\n    /** fill the filter inputs with the filter values */\n    _renderFilters: function _renderFilters() {\n        return this.$(\".forward-column .column-header input\").val(this.filters[0]).add(this.$(\".reverse-column .column-header input\").val(this.filters[1]));\n    },\n\n    /** render the middle including unpaired and paired sections (which may be hidden) */\n    _renderMiddle: function _renderMiddle(speed, callback) {\n        var $middle = this.$(\".middle\").empty().html(this.templates.middle());\n\n        // (re-) hide the un/paired panels based on instance vars\n        if (this.unpairedPanelHidden) {\n            this.$(\".unpaired-columns\").hide();\n        } else if (this.pairedPanelHidden) {\n            this.$(\".paired-columns\").hide();\n        }\n\n        this._renderUnpaired();\n        this._renderPaired();\n        return $middle;\n    },\n    /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n    _renderUnpaired: function _renderUnpaired(speed, callback) {\n        //this.debug( '-- _renderUnpaired' );\n        var self = this;\n\n        var $fwd;\n        var $rev;\n        var $prd = [];\n        var split = this._splitByFilters();\n        // update unpaired counts\n        this.$(\".forward-column .title\").text([split[0].length, (0, _localization2.default)(\"unpaired forward\")].join(\" \"));\n        this.$(\".forward-column .unpaired-info\").text(this._renderUnpairedDisplayStr(this.unpaired.length - split[0].length));\n        this.$(\".reverse-column .title\").text([split[1].length, (0, _localization2.default)(\"unpaired reverse\")].join(\" \"));\n        this.$(\".reverse-column .unpaired-info\").text(this._renderUnpairedDisplayStr(this.unpaired.length - split[1].length));\n\n        this.$(\".unpaired-columns .column-datasets\").empty();\n\n        // show/hide the auto pair button if any unpaired are left\n        this.$(\".autopair-link\").toggle(this.unpaired.length !== 0);\n        if (this.unpaired.length === 0) {\n            this._renderUnpairedEmpty();\n            return;\n        }\n\n        // create the dataset dom arrays\n        $rev = split[1].map(function (dataset, i) {\n            // if there'll be a fwd dataset across the way, add a button to pair the row\n            if (split[0][i] !== undefined && split[0][i] !== dataset) {\n                $prd.push(self._renderPairButton());\n            }\n            return self._renderUnpairedDataset(dataset);\n        });\n        $fwd = split[0].map(function (dataset) {\n            return self._renderUnpairedDataset(dataset);\n        });\n\n        if (!$fwd.length && !$rev.length) {\n            this._renderUnpairedNotShown();\n            return;\n        }\n        // add to appropo cols\n        //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n        //  and swapping out that\n        this.$(\".unpaired-columns .forward-column .column-datasets\").append($fwd).add(this.$(\".unpaired-columns .paired-column .column-datasets\").append($prd)).add(this.$(\".unpaired-columns .reverse-column .column-datasets\").append($rev));\n        this._adjUnpairedOnScrollbar();\n    },\n    /** return a string to display the count of filtered out datasets */\n    _renderUnpairedDisplayStr: function _renderUnpairedDisplayStr(numFiltered) {\n        return [\"(\", numFiltered, \" \", (0, _localization2.default)(\"filtered out\"), \")\"].join(\"\");\n    },\n    /** return an unattached jQuery DOM element to represent an unpaired dataset */\n    _renderUnpairedDataset: function _renderUnpairedDataset(dataset) {\n        //TODO: to underscore template\n        return $(\"<li/>\").attr(\"id\", \"dataset-\" + dataset.id).addClass(\"dataset unpaired\").attr(\"draggable\", true).addClass(dataset.selected ? \"selected\" : \"\").append($(\"<span/>\").addClass(\"dataset-name\").text(dataset.name))\n        //??\n        .data(\"dataset\", dataset);\n    },\n    /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n    _renderPairButton: function _renderPairButton() {\n        //TODO: *not* a dataset - don't pretend like it is\n        return $(\"<li/>\").addClass(\"dataset unpaired\").append($(\"<span/>\").addClass(\"dataset-name\").text((0, _localization2.default)(\"Pair these datasets\")));\n    },\n    /** a message to display when no unpaired left */\n    _renderUnpairedEmpty: function _renderUnpairedEmpty() {\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $('<div class=\"empty-message\"></div>').text(\"(\" + (0, _localization2.default)(\"no remaining unpaired datasets\") + \")\");\n        this.$(\".unpaired-columns .paired-column .column-datasets\").empty().prepend($msg);\n        return $msg;\n    },\n    /** a message to display when no unpaired can be shown with the current filters */\n    _renderUnpairedNotShown: function _renderUnpairedNotShown() {\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $('<div class=\"empty-message\"></div>').text(\"(\" + (0, _localization2.default)(\"no datasets were found matching the current filters\") + \")\");\n        this.$(\".unpaired-columns .paired-column .column-datasets\").empty().prepend($msg);\n        return $msg;\n    },\n    /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n    _adjUnpairedOnScrollbar: function _adjUnpairedOnScrollbar() {\n        var $unpairedColumns = this.$(\".unpaired-columns\").last();\n\n        var $firstDataset = this.$(\".unpaired-columns .reverse-column .dataset\").first();\n\n        if (!$firstDataset.length) {\n            return;\n        }\n\n        var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth();\n\n        var dsRight = $firstDataset.offset().left + $firstDataset.outerWidth();\n\n        var rightDiff = Math.floor(ucRight) - Math.floor(dsRight);\n        //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n        this.$(\".unpaired-columns .forward-column\").css(\"margin-left\", rightDiff > 0 ? rightDiff : 0);\n    },\n\n    /** render the paired section and update counts of paired datasets */\n    _renderPaired: function _renderPaired(speed, callback) {\n        //this.debug( '-- _renderPaired' );\n        this.$(\".paired-column-title .title\").text([this.paired.length, (0, _localization2.default)(\"paired\")].join(\" \"));\n        // show/hide the unpair all link\n        this.$(\".unpair-all-link\").toggle(this.paired.length !== 0);\n        if (this.paired.length === 0) {\n            this._renderPairedEmpty();\n            return;\n            //TODO: would be best to return here (the $columns)\n        } else {\n            // show/hide 'remove extensions link' when any paired and they seem to have extensions\n            this.$(\".remove-extensions-link\").show();\n        }\n\n        this.$(\".paired-columns .column-datasets\").empty();\n        var self = this;\n        this.paired.forEach(function (pair, i) {\n            //TODO: cache these?\n            var pairView = new PairView({ pair: pair });\n            self.$(\".paired-columns .column-datasets\").append(pairView.render().$el).append(['<button class=\"unpair-btn\">', '<span class=\"fa fa-unlink\" title=\"', (0, _localization2.default)(\"Unpair\"), '\"></span>', \"</button>\"].join(\"\"));\n        });\n    },\n    /** a message to display when none paired */\n    _renderPairedEmpty: function _renderPairedEmpty() {\n        var $msg = $('<div class=\"empty-message\"></div>').text(\"(\" + (0, _localization2.default)(\"no paired datasets yet\") + \")\");\n        this.$(\".paired-columns .column-datasets\").empty().prepend($msg);\n        return $msg;\n    },\n\n    footerSettings: {\n        \".hide-originals\": \"hideOriginals\",\n        \".remove-extensions\": \"removeExtensions\"\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents: function _addPluginComponents() {\n        this._chooseFiltersPopover(\".choose-filters-link\");\n        this.$(\".help-content i\").hoverhighlight(\".collection-creator\", \"rgba( 64, 255, 255, 1.0 )\");\n    },\n\n    /** build a filter selection popover allowing selection of common filter pairs */\n    _chooseFiltersPopover: function _chooseFiltersPopover(selector) {\n        function filterChoice(val1, val2) {\n            return ['<button class=\"filter-choice btn\" ', 'data-forward=\"', val1, '\" data-reverse=\"', val2, '\">', (0, _localization2.default)(\"Forward\"), \": \", val1, \", \", (0, _localization2.default)(\"Reverse\"), \": \", val2, \"</button>\"].join(\"\");\n        }\n        var $popoverContent = $(_.template(['<div class=\"choose-filters\">', '<div class=\"help\">', (0, _localization2.default)(\"Choose from the following filters to change which unpaired reads are shown in the display\"), \":</div>\", _.values(this.commonFilters).map(function (filterSet) {\n            return filterChoice(filterSet[0], filterSet[1]);\n        }).join(\"\"), \"</div>\"].join(\"\"))({}));\n\n        return this.$(selector).popover({\n            container: \".collection-creator\",\n            placement: \"bottom\",\n            html: true,\n            //animation   : false,\n            content: $popoverContent\n        });\n    },\n\n    /** add (or clear if clear is truthy) a validation warning to what */\n    _validationWarning: function _validationWarning(what, clear) {\n        var VALIDATION_CLASS = \"validation-warning\";\n        if (what === \"name\") {\n            what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n            this.$(\".collection-name\").focus().select();\n        }\n        if (clear) {\n            what = what || this.$(\".\" + VALIDATION_CLASS);\n            what.removeClass(VALIDATION_CLASS);\n        } else {\n            what.addClass(VALIDATION_CLASS);\n        }\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors: function _setUpBehaviors() {\n        this.once(\"rendered\", function () {\n            this.trigger(\"rendered:initial\", this);\n        });\n\n        this.on(\"pair:new\", function () {\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n\n            // scroll to bottom where new pairs are added\n            //TODO: this doesn't seem to work - innerHeight sticks at 133...\n            //  may have to do with improper flex columns\n            //var $pairedView = this.$( '.paired-columns' );\n            //$pairedView.scrollTop( $pairedView.innerHeight() );\n            //this.debug( $pairedView.height() )\n            this.$(\".paired-columns\").scrollTop(8000000);\n        });\n        this.on(\"pair:unpair\", function (pairs) {\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n            this.splitView();\n        });\n\n        this.on(\"filter-change\", function () {\n            this.filters = [this.$(\".forward-unpaired-filter input\").val(), this.$(\".reverse-unpaired-filter input\").val()];\n            this.metric(\"filter-change\", this.filters);\n            this._renderFilters();\n            this._renderUnpaired();\n        });\n\n        this.on(\"autopair\", function () {\n            this._renderUnpaired();\n            this._renderPaired();\n\n            var message;\n            var msgClass = null;\n            if (this.paired.length) {\n                msgClass = \"alert-success\";\n                message = this.paired.length + \" \" + (0, _localization2.default)(\"pairs created\");\n                if (!this.unpaired.length) {\n                    message += \": \" + (0, _localization2.default)(\"all datasets have been successfully paired\");\n                    this.hideUnpaired();\n                    this.$(\".collection-name\").focus();\n                }\n            } else {\n                message = (0, _localization2.default)([\"Could not automatically create any pairs from the given dataset names.\", \"You may want to choose or enter different filters and try auto-pairing again.\", \"Close this message using the X on the right to view more help.\"].join(\" \"));\n            }\n            this._showAlert(message, msgClass);\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    events: {\n        // header\n        \"click .more-help\": \"_clickMoreHelp\",\n        \"click .less-help\": \"_clickLessHelp\",\n        \"click .main-help\": \"_toggleHelp\",\n        \"click .header .alert button\": \"_hideAlert\",\n        \"click .forward-column .column-title\": \"_clickShowOnlyUnpaired\",\n        \"click .reverse-column .column-title\": \"_clickShowOnlyUnpaired\",\n        \"click .unpair-all-link\": \"_clickUnpairAll\",\n        //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n        \"change .forward-unpaired-filter input\": function changeForwardUnpairedFilterInput(ev) {\n            this.trigger(\"filter-change\");\n        },\n        \"focus .forward-unpaired-filter input\": function focusForwardUnpairedFilterInput(ev) {\n            $(ev.currentTarget).select();\n        },\n        \"click .autopair-link\": \"_clickAutopair\",\n        \"click .choose-filters .filter-choice\": \"_clickFilterChoice\",\n        \"click .clear-filters-link\": \"_clearFilters\",\n        \"change .reverse-unpaired-filter input\": function changeReverseUnpairedFilterInput(ev) {\n            this.trigger(\"filter-change\");\n        },\n        \"focus .reverse-unpaired-filter input\": function focusReverseUnpairedFilterInput(ev) {\n            $(ev.currentTarget).select();\n        },\n        // unpaired\n        \"click .forward-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n        \"click .reverse-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n        \"click .paired-column .dataset.unpaired\": \"_clickPairRow\",\n        \"click .unpaired-columns\": \"clearSelectedUnpaired\",\n        \"mousedown .unpaired-columns .dataset\": \"_mousedownUnpaired\",\n        // divider\n        \"click .paired-column-title\": \"_clickShowOnlyPaired\",\n        \"mousedown .flexible-partition-drag\": \"_startPartitionDrag\",\n        // paired\n        \"click .paired-columns .dataset.paired\": \"selectPair\",\n        \"click .paired-columns\": \"clearSelectedPaired\",\n        \"click .paired-columns .pair-name\": \"_clickPairName\",\n        \"click .unpair-btn\": \"_clickUnpair\",\n        // paired - drop target\n        //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n        //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n        \"dragover .paired-columns .column-datasets\": \"_dragoverPairedColumns\",\n        \"drop .paired-columns .column-datasets\": \"_dropPairedColumns\",\n\n        \"pair.dragstart .paired-columns .column-datasets\": \"_pairDragstart\",\n        \"pair.dragend   .paired-columns .column-datasets\": \"_pairDragend\",\n\n        // footer\n        \"change .remove-extensions\": function changeRemoveExtensions(ev) {\n            this.toggleExtensions();\n        },\n        \"change .collection-name\": \"_changeName\",\n        \"keydown .collection-name\": \"_nameCheckForEnter\",\n        \"change .hide-originals\": \"_changeHideOriginals\",\n        \"click .cancel-create\": \"_cancelCreate\",\n        \"click .create-collection\": \"_clickCreate\" //,\n    },\n\n    /** toggle between showing only unpaired and split view */\n    _clickShowOnlyUnpaired: function _clickShowOnlyUnpaired(ev) {\n        //this.debug( 'click unpaired', ev.currentTarget );\n        if (this.$(\".paired-columns\").is(\":visible\")) {\n            this.hidePaired();\n        } else {\n            this.splitView();\n        }\n    },\n    /** toggle between showing only paired and split view */\n    _clickShowOnlyPaired: function _clickShowOnlyPaired(ev) {\n        //this.debug( 'click paired' );\n        if (this.$(\".unpaired-columns\").is(\":visible\")) {\n            this.hideUnpaired();\n        } else {\n            this.splitView();\n        }\n    },\n\n    /** hide unpaired, show paired */\n    hideUnpaired: function hideUnpaired(speed, callback) {\n        this.unpairedPanelHidden = true;\n        this.pairedPanelHidden = false;\n        this._renderMiddle(speed, callback);\n    },\n    /** hide paired, show unpaired */\n    hidePaired: function hidePaired(speed, callback) {\n        this.unpairedPanelHidden = false;\n        this.pairedPanelHidden = true;\n        this._renderMiddle(speed, callback);\n    },\n    /** show both paired and unpaired (splitting evenly) */\n    splitView: function splitView(speed, callback) {\n        this.unpairedPanelHidden = this.pairedPanelHidden = false;\n        this._renderMiddle(speed, callback);\n        return this;\n    },\n\n    /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n    _clickUnpairAll: function _clickUnpairAll(ev) {\n        this.metric(\"unpairAll\");\n        this.unpairAll();\n    },\n\n    /** attempt to autopair */\n    _clickAutopair: function _clickAutopair(ev) {\n        var paired = this.autoPair();\n        this.metric(\"autopair\", paired.length, this.unpaired.length);\n        this.trigger(\"autopair\");\n    },\n\n    /** set the filters based on the data attributes of the button click target */\n    _clickFilterChoice: function _clickFilterChoice(ev) {\n        var $selected = $(ev.currentTarget);\n        this.$(\".forward-unpaired-filter input\").val($selected.data(\"forward\"));\n        this.$(\".reverse-unpaired-filter input\").val($selected.data(\"reverse\"));\n        this._hideChooseFilters();\n        this.trigger(\"filter-change\");\n    },\n\n    /** hide the choose filters popover */\n    _hideChooseFilters: function _hideChooseFilters() {\n        //TODO: update bootstrap and remove the following hack\n        //  see also: https://github.com/twbs/bootstrap/issues/10260\n        this.$(\".choose-filters-link\").popover(\"hide\");\n        this.$(\".popover\").css(\"display\", \"none\");\n    },\n\n    /** clear both filters */\n    _clearFilters: function _clearFilters(ev) {\n        this.$(\".forward-unpaired-filter input\").val(\"\");\n        this.$(\".reverse-unpaired-filter input\").val(\"\");\n        this.trigger(\"filter-change\");\n    },\n\n    // ........................................................................ unpaired\n    /** select an unpaired dataset */\n    _clickUnpairedDataset: function _clickUnpairedDataset(ev) {\n        ev.stopPropagation();\n        return this.toggleSelectUnpaired($(ev.currentTarget));\n    },\n\n    /** Toggle the selection of an unpaired dataset representation.\n     *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n     *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n     */\n    toggleSelectUnpaired: function toggleSelectUnpaired($dataset, options) {\n        options = options || {};\n        var dataset = $dataset.data(\"dataset\");\n\n        var select = options.force !== undefined ? options.force : !$dataset.hasClass(\"selected\");\n\n        //this.debug( id, options.force, $dataset, dataset );\n        if (!$dataset.length || dataset === undefined) {\n            return $dataset;\n        }\n\n        if (select) {\n            $dataset.addClass(\"selected\");\n            if (!options.waitToPair) {\n                this.pairAllSelected();\n            }\n        } else {\n            $dataset.removeClass(\"selected\");\n            //delete dataset.selected;\n        }\n        return $dataset;\n    },\n\n    /** pair all the currently selected unpaired datasets */\n    pairAllSelected: function pairAllSelected(options) {\n        options = options || {};\n        var self = this;\n        var fwds = [];\n        var revs = [];\n        var pairs = [];\n        self.$(\".unpaired-columns .forward-column .dataset.selected\").each(function () {\n            fwds.push($(this).data(\"dataset\"));\n        });\n        self.$(\".unpaired-columns .reverse-column .dataset.selected\").each(function () {\n            revs.push($(this).data(\"dataset\"));\n        });\n        fwds.length = revs.length = Math.min(fwds.length, revs.length);\n        //this.debug( fwds );\n        //this.debug( revs );\n        fwds.forEach(function (fwd, i) {\n            try {\n                pairs.push(self._pair(fwd, revs[i], { silent: true }));\n            } catch (err) {\n                //TODO: preserve selected state of those that couldn't be paired\n                //TODO: warn that some could not be paired\n                self.error(err);\n            }\n        });\n        if (pairs.length && !options.silent) {\n            this.trigger(\"pair:new\", pairs);\n        }\n        return pairs;\n    },\n\n    /** clear the selection on all unpaired datasets */\n    clearSelectedUnpaired: function clearSelectedUnpaired() {\n        this.$(\".unpaired-columns .dataset.selected\").removeClass(\"selected\");\n    },\n\n    /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n    _mousedownUnpaired: function _mousedownUnpaired(ev) {\n        if (ev.shiftKey) {\n            var self = this;\n            var $startTarget = $(ev.target).addClass(\"selected\");\n\n            var moveListener = function moveListener(ev) {\n                self.$(ev.target).filter(\".dataset\").addClass(\"selected\");\n            };\n\n            $startTarget.parent().on(\"mousemove\", moveListener);\n\n            // on any mouseup, stop listening to the move and try to pair any selected\n            $(document).one(\"mouseup\", function (ev) {\n                $startTarget.parent().off(\"mousemove\", moveListener);\n                self.pairAllSelected();\n            });\n        }\n    },\n\n    /** attempt to pair two datasets directly across from one another */\n    _clickPairRow: function _clickPairRow(ev) {\n        //if( !ev.currentTarget ){ return true; }\n        var rowIndex = $(ev.currentTarget).index();\n\n        var fwd = $(\".unpaired-columns .forward-column .dataset\").eq(rowIndex).data(\"dataset\");\n\n        var rev = $(\".unpaired-columns .reverse-column .dataset\").eq(rowIndex).data(\"dataset\");\n\n        //this.debug( 'row:', rowIndex, fwd, rev );\n        this._pair(fwd, rev);\n    },\n\n    // ........................................................................ divider/partition\n    /** start dragging the visible divider/partition between unpaired and paired panes */\n    _startPartitionDrag: function _startPartitionDrag(ev) {\n        var self = this;\n        var startingY = ev.pageY;\n        //this.debug( 'partition drag START:', ev );\n        $(\"body\").css(\"cursor\", \"ns-resize\");\n        self.$(\".flexible-partition-drag\").css(\"color\", \"black\");\n\n        function endDrag(ev) {\n            self.$(\".flexible-partition-drag\").css(\"color\", \"\");\n            $(\"body\").css(\"cursor\", \"\").unbind(\"mousemove\", trackMouse);\n        }\n        function trackMouse(ev) {\n            var offset = ev.pageY - startingY;\n            if (!self.adjPartition(offset)) {\n                $(\"body\").trigger(\"mouseup\");\n            }\n            self._adjUnpairedOnScrollbar();\n            startingY += offset;\n        }\n        $(\"body\").mousemove(trackMouse);\n        $(\"body\").one(\"mouseup\", endDrag);\n    },\n\n    /** adjust the parition up/down +/-adj pixels */\n    adjPartition: function adjPartition(adj) {\n        var $unpaired = this.$(\".unpaired-columns\");\n        var $paired = this.$(\".paired-columns\");\n        var unpairedHi = parseInt($unpaired.css(\"height\"), 10);\n        var pairedHi = parseInt($paired.css(\"height\"), 10);\n        //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\n        unpairedHi = Math.max(10, unpairedHi + adj);\n        pairedHi = pairedHi - adj;\n\n        var movingUpwards = adj < 0;\n        // when the divider gets close to the top - lock into hiding the unpaired section\n        if (movingUpwards) {\n            if (this.unpairedPanelHidden) {\n                return false;\n            } else if (unpairedHi <= 10) {\n                this.hideUnpaired();\n                return false;\n            }\n        } else {\n            if (this.unpairedPanelHidden) {\n                $unpaired.show();\n                this.unpairedPanelHidden = false;\n            }\n        }\n\n        // when the divider gets close to the bottom - lock into hiding the paired section\n        if (!movingUpwards) {\n            if (this.pairedPanelHidden) {\n                return false;\n            } else if (pairedHi <= 15) {\n                this.hidePaired();\n                return false;\n            }\n        } else {\n            if (this.pairedPanelHidden) {\n                $paired.show();\n                this.pairedPanelHidden = false;\n            }\n        }\n\n        $unpaired.css({\n            height: unpairedHi + \"px\",\n            flex: \"0 0 auto\"\n        });\n        return true;\n    },\n\n    // ........................................................................ paired\n    /** select a pair when clicked */\n    selectPair: function selectPair(ev) {\n        ev.stopPropagation();\n        $(ev.currentTarget).toggleClass(\"selected\");\n    },\n\n    /** deselect all pairs */\n    clearSelectedPaired: function clearSelectedPaired(ev) {\n        this.$(\".paired-columns .dataset.selected\").removeClass(\"selected\");\n    },\n\n    /** rename a pair when the pair name is clicked */\n    _clickPairName: function _clickPairName(ev) {\n        ev.stopPropagation();\n        var $name = $(ev.currentTarget);\n        var $pair = $name.parent().parent();\n        var index = $pair.index(\".dataset.paired\");\n        var pair = this.paired[index];\n        var response = prompt(\"Enter a new name for the pair:\", pair.name);\n        if (response) {\n            pair.name = response;\n            // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n            //  when adding/removing extensions\n            //hackish\n            pair.customizedName = true;\n            $name.text(pair.name);\n        }\n    },\n\n    /** unpair this pair */\n    _clickUnpair: function _clickUnpair(ev) {\n        //if( !ev.currentTarget ){ return true; }\n        var pairIndex = Math.floor($(ev.currentTarget).index(\".unpair-btn\"));\n        //this.debug( 'pair:', pairIndex );\n        this._unpair(this.paired[pairIndex]);\n    },\n\n    // ........................................................................ paired - drag and drop re-ordering\n    //_dragenterPairedColumns : function( ev ){\n    //    this.debug( '_dragenterPairedColumns:', ev );\n    //},\n    //_dragleavePairedColumns : function( ev ){\n    //    //this.debug( '_dragleavePairedColumns:', ev );\n    //},\n    /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n    _dragoverPairedColumns: function _dragoverPairedColumns(ev) {\n        //this.debug( '_dragoverPairedColumns:', ev );\n        ev.preventDefault();\n\n        var $list = this.$(\".paired-columns .column-datasets\");\n        this._checkForAutoscroll($list, ev.originalEvent.clientY);\n        //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n        var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n\n        $(\".element-drop-placeholder\").remove();\n        var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n        if (!$nearest.length) {\n            $list.append($placeholder);\n        } else {\n            $nearest.before($placeholder);\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll: function _checkForAutoscroll($element, y) {\n        var AUTOSCROLL_SPEED = 2;\n        var offset = $element.offset();\n        var scrollTop = $element.scrollTop();\n        var upperDist = y - offset.top;\n        var lowerDist = offset.top + $element.outerHeight() - y;\n        //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n        if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n            $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n        } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n            $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n        }\n    },\n\n    /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n     *      If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestPairedDatasetLi: function _getNearestPairedDatasetLi(y) {\n        var WIGGLE = 4;\n        var lis = this.$(\".paired-columns .column-datasets li\").toArray();\n        for (var i = 0; i < lis.length; i++) {\n            var $li = $(lis[i]);\n            var top = $li.offset().top;\n            var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n            if (top + halfHeight > y && top - halfHeight < y) {\n                //this.debug( y, top + halfHeight, top - halfHeight )\n                return $li;\n            }\n        }\n        return $();\n    },\n    /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n    _dropPairedColumns: function _dropPairedColumns(ev) {\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = \"move\";\n\n        var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n        if ($nearest.length) {\n            this.$dragging.insertBefore($nearest);\n        } else {\n            // no nearest before - insert after last element (unpair button)\n            this.$dragging.insertAfter(this.$(\".paired-columns .unpair-btn\").last());\n        }\n        // resync the creator's list of paired based on the new DOM order\n        this._syncPairsToDom();\n        return false;\n    },\n    /** resync the creator's list of paired based on the DOM order of pairs */\n    _syncPairsToDom: function _syncPairsToDom() {\n        var newPaired = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$(\".paired-columns .dataset.paired\").each(function () {\n            newPaired.push($(this).data(\"pair\"));\n        });\n        //this.debug( newPaired );\n        this.paired = newPaired;\n        this._renderPaired();\n    },\n    /** drag communication with pair sub-views: dragstart */\n    _pairDragstart: function _pairDragstart(ev, pair) {\n        //this.debug( '_pairDragstart', ev, pair )\n        // auto select the pair causing the event and move all selected\n        pair.$el.addClass(\"selected\");\n        var $selected = this.$(\".paired-columns .dataset.selected\");\n        this.$dragging = $selected;\n    },\n    /** drag communication with pair sub-views: dragend - remove the placeholder */\n    _pairDragend: function _pairDragend(ev, pair) {\n        //this.debug( '_pairDragend', ev, pair )\n        $(\".element-drop-placeholder\").remove();\n        this.$dragging = null;\n    },\n\n    // ........................................................................ footer\n    toggleExtensions: function toggleExtensions(force) {\n        var self = this;\n        self.removeExtensions = force !== undefined ? force : !self.removeExtensions;\n\n        _.each(self.paired, function (pair) {\n            // don't overwrite custom names\n            if (pair.customizedName) {\n                return;\n            }\n            pair.name = self._guessNameForPair(pair.forward, pair.reverse);\n        });\n\n        self._renderPaired();\n        self._renderFooter();\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** debug a dataset list */\n    _printList: function _printList(list) {\n        var self = this;\n        _.each(list, function (e) {\n            if (list === self.paired) {\n                self._printPair(e);\n            } else {\n                self.debug(e);\n            }\n        });\n    },\n\n    /** print a pair Object */\n    _printPair: function _printPair(pair) {\n        this.debug(pair.forward.name, pair.reverse.name, \": ->\", pair.name);\n    },\n\n    /** string rep */\n    toString: function toString() {\n        return \"PairedCollectionCreator\";\n    },\n\n    templates: _.extend({}, _baseCreator2.default.CollectionCreatorMixin._creatorTemplates, {\n        /** the header (not including help text) */\n        header: _.template(['<div class=\"main-help well clear\">', '<a class=\"more-help\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"More help\"), \"</a>\", '<div class=\"help-content\">', '<a class=\"less-help\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Less\"), \"</a>\", \"</div>\", \"</div>\", '<div class=\"alert alert-dismissable\">', '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>', '<span class=\"alert-message\"></span>', \"</div>\", '<div class=\"column-headers vertically-spaced flex-column-container\">', '<div class=\"forward-column flex-column column\">', '<div class=\"column-header\">', '<div class=\"column-title\">', '<span class=\"title\">', (0, _localization2.default)(\"Unpaired forward\"), \"</span>\", '<span class=\"title-info unpaired-info\"></span>', \"</div>\", '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">', '<input class=\"search-query\" placeholder=\"', (0, _localization2.default)(\"Filter this list\"), '\" />', \"</div>\", \"</div>\", \"</div>\", '<div class=\"paired-column flex-column no-flex column\">', '<div class=\"column-header\">', '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">', (0, _localization2.default)(\"Choose filters\"), \"</a>\", '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Clear filters\"), \"</a><br />\", '<a class=\"autopair-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Auto-pair\"), \"</a>\", \"</div>\", \"</div>\", '<div class=\"reverse-column flex-column column\">', '<div class=\"column-header\">', '<div class=\"column-title\">', '<span class=\"title\">', (0, _localization2.default)(\"Unpaired reverse\"), \"</span>\", '<span class=\"title-info unpaired-info\"></span>', \"</div>\", '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">', '<input class=\"search-query\" placeholder=\"', (0, _localization2.default)(\"Filter this list\"), '\" />', \"</div>\", \"</div>\", \"</div>\", \"</div>\"].join(\"\")),\n\n        /** the middle: unpaired, divider, and paired */\n        middle: _.template([\n        // contains two flex rows (rows that fill available space) and a divider btwn\n        '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">', '<div class=\"forward-column flex-column column\">', '<ol class=\"column-datasets\"></ol>', \"</div>\", '<div class=\"paired-column flex-column no-flex column\">', '<ol class=\"column-datasets\"></ol>', \"</div>\", '<div class=\"reverse-column flex-column column\">', '<ol class=\"column-datasets\"></ol>', \"</div>\", \"</div>\", '<div class=\"flexible-partition\">', '<div class=\"flexible-partition-drag\" title=\"', (0, _localization2.default)(\"Drag to change\"), '\"></div>', '<div class=\"column-header\">', '<div class=\"column-title paired-column-title\">', '<span class=\"title\"></span>', \"</div>\", '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">', (0, _localization2.default)(\"Unpair all\"), \"</a>\", \"</div>\", \"</div>\", '<div class=\"paired-columns flex-column-container scroll-container flex-row\">', '<ol class=\"column-datasets\"></ol>', \"</div>\"].join(\"\")),\n\n        /** creation and cancel controls */\n        footer: _.template(['<div class=\"attributes clear\">', '<div class=\"clear\">', '<label class=\"setting-prompt pull-right\">', (0, _localization2.default)(\"Hide original elements\"), \"?\", '<input class=\"hide-originals pull-right\" type=\"checkbox\" />', \"</label>\", '<label class=\"setting-prompt pull-right\">', (0, _localization2.default)(\"Remove file extensions from pair names\"), \"?\", '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />', \"</label>\", \"</div>\", '<div class=\"clear\">', '<input class=\"collection-name form-control pull-right\" ', 'placeholder=\"', (0, _localization2.default)(\"Enter a name for your new list\"), '\" />', '<div class=\"collection-name-prompt pull-right\">', (0, _localization2.default)(\"Name\"), \":</div>\", \"</div>\", \"</div>\", '<div class=\"actions clear vertically-spaced\">', '<div class=\"other-options pull-left\">', '<button class=\"cancel-create btn\" tabindex=\"-1\">', (0, _localization2.default)(\"Cancel\"), \"</button>\", '<div class=\"create-other btn-group dropup\">', '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">', (0, _localization2.default)(\"Create a different kind of collection\"), ' <span class=\"caret\"></span>', \"</button>\", '<ul class=\"dropdown-menu\" role=\"menu\">', '<li><a href=\"#\">', (0, _localization2.default)(\"Create a <i>single</i> pair\"), \"</a></li>\", '<li><a href=\"#\">', (0, _localization2.default)(\"Create a list of <i>unpaired</i> datasets\"), \"</a></li>\", \"</ul>\", \"</div>\", \"</div>\", '<div class=\"main-options pull-right\">', '<button class=\"create-collection btn btn-primary\">', (0, _localization2.default)(\"Create list\"), \"</button>\", \"</div>\", \"</div>\"].join(\"\")),\n\n        /** help content */\n        helpContent: _.template([\"<p>\", (0, _localization2.default)([\"Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). \", \"These collections can be passed to tools and workflows in order to have analyses done on each member of \", \"the entire group. This interface allows you to create a collection, choose which datasets are paired, \", \"and re-order the final collection.\"].join(\"\")), \"</p>\", \"<p>\", (0, _localization2.default)(['Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ', \"(hover over the underlined words to highlight below). \", 'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.', \"<ul>To pair datasets, you can:\", \"<li>Click a dataset in the \", '<i data-target=\".unpaired-columns .forward-column .column-datasets,', '.unpaired-columns .forward-column\">forward column</i> ', \"to select it then click a dataset in the \", '<i data-target=\".unpaired-columns .reverse-column .column-datasets,', '.unpaired-columns .reverse-column\">reverse column</i>.', \"</li>\", '<li>Click one of the \"Pair these datasets\" buttons in the ', '<i data-target=\".unpaired-columns .paired-column .column-datasets,', '.unpaired-columns .paired-column\">middle column</i> ', \"to pair the datasets in a particular row.\", \"</li>\", '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ', \"to have your datasets automatically paired based on name.\", \"</li>\", \"</ul>\"].join(\"\")), \"</p>\", \"<p>\", (0, _localization2.default)([\"<ul>You can filter what is shown in the unpaired sections by:\", \"<li>Entering partial dataset names in either the \", '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ', '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.', \"</li>\", \"<li>Choosing from a list of preset filters by clicking the \", '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.', \"</li>\", \"<li>Entering regular expressions to match dataset names. See: \", '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"', ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ', \"Note: forward slashes (\\\\) are not needed.\", \"</li>\", \"<li>Clearing the filters by clicking the \", '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.', \"</li>\", \"</ul>\"].join(\"\")), \"</p>\", \"<p>\", (0, _localization2.default)([\"To unpair individual dataset pairs, click the \", '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ', 'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'].join(\"\")), \"</p>\", \"<p>\", (0, _localization2.default)(['You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ', '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'].join(\"\")), \"</p>\", \"<p>\", (0, _localization2.default)(['Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ', 'click <i data-target=\".create-collection\">\"Create list\"</i>. ', \"(Note: you do not have to pair all unpaired datasets to finish.)\"].join(\"\")), \"</p>\"].join(\"\"))\n    })\n});\n\n//=============================================================================\n/** a modal version of the paired collection creator */\nvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal(datasets, options) {\n    var deferred = jQuery.Deferred();\n    var creator;\n\n    options = _.defaults(options || {}, {\n        datasets: datasets,\n        oncancel: function oncancel() {\n            Galaxy.modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function oncreate(creator, response) {\n            Galaxy.modal.hide();\n            deferred.resolve(response);\n        }\n    });\n\n    if (!window.Galaxy || !Galaxy.modal) {\n        throw new Error(\"Galaxy or Galaxy.modal not found\");\n    }\n\n    creator = new PairedCollectionCreator(options);\n    Galaxy.modal.show({\n        title: \"Create a collection of paired datasets\",\n        body: creator.$el,\n        width: \"80%\",\n        height: \"800px\",\n        closing_events: true\n    });\n    creator.render();\n    window.creator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n//=============================================================================\nfunction createListOfPairsCollection(collection, defaultHideSourceItems) {\n    var elements = collection.toJSON();\n    //TODO: validate elements\n    return pairedCollectionCreatorModal(elements, {\n        historyId: collection.historyId,\n        defaultHideSourceItems: defaultHideSourceItems\n    });\n}\n\n//=============================================================================\nexports.default = {\n    PairedCollectionCreator: PairedCollectionCreator,\n    pairedCollectionCreatorModal: pairedCollectionCreatorModal,\n    createListOfPairsCollection: createListOfPairsCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0), __webpack_require__(0)))\n\n/***/ }),\n/* 257 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//=============================================================================\n/**\n(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\nCopyright (c) 2011 Andrei Mackenzie\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\nSoftware.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// Compute the edit distance between the two given strings\n//exports.getEditDistance = function(a, b){\nfunction levenshteinDistance(a, b) {\n    if (a.length === 0) {\n        return b.length;\n    }\n    if (b.length === 0) {\n        return a.length;\n    }\n\n    var matrix = [];\n\n    // increment along the first column of each row\n    var i;\n    for (i = 0; i <= b.length; i++) {\n        matrix[i] = [i];\n    }\n\n    // increment each column in the first row\n    var j;\n    for (j = 0; j <= a.length; j++) {\n        matrix[0][j] = j;\n    }\n\n    // Fill in the rest of the matrix\n    for (i = 1; i <= b.length; i++) {\n        for (j = 1; j <= a.length; j++) {\n            if (b.charAt(i - 1) === a.charAt(j - 1)) {\n                matrix[i][j] = matrix[i - 1][j - 1];\n            } else {\n                matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, // substitution\n                Math.min(matrix[i][j - 1] + 1, // insertion\n                matrix[i - 1][j] + 1)); // deletion\n            }\n        }\n    }\n\n    //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n    return matrix[b.length][a.length];\n}\n\n//=============================================================================\nexports.default = levenshteinDistance;\n\n/***/ }),\n/* 258 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _queryStringParsing = __webpack_require__(17);\n\nvar _queryStringParsing2 = _interopRequireDefault(_queryStringParsing);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Contains descriptive dictionaries describing user forms */\nvar Model = Backbone.Model.extend({\n    initialize: function initialize(options) {\n        options = options || {};\n        options.user_id = options.user_id || Galaxy.user.id;\n        this.set({\n            user_id: options.user_id,\n            information: {\n                title: \"Manage information\",\n                description: \"Edit your email, addresses and custom parameters or change your username.\",\n                url: \"api/users/\" + options.user_id + \"/information/inputs\",\n                icon: \"fa-user\",\n                redirect: \"user\"\n            },\n            password: {\n                title: \"Change password\",\n                description: \"Allows you to change your login credentials.\",\n                icon: \"fa-unlock-alt\",\n                url: \"api/users/\" + options.user_id + \"/password/inputs\",\n                submit_title: \"Save password\",\n                redirect: \"user\"\n            },\n            communication: {\n                title: \"Change communication settings\",\n                description: \"Enable or disable the communication feature to chat with other users.\",\n                url: \"api/users/\" + options.user_id + \"/communication/inputs\",\n                icon: \"fa-comments-o\",\n                redirect: \"user\"\n            },\n            permissions: {\n                title: \"Set dataset permissions for new histories\",\n                description: \"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.\",\n                url: \"api/users/\" + options.user_id + \"/permissions/inputs\",\n                icon: \"fa-users\",\n                submit_title: \"Save permissions\",\n                redirect: \"user\"\n            },\n            api_key: {\n                title: \"Manage API key\",\n                description: \"Access your current API key or create a new one.\",\n                url: \"api/users/\" + options.user_id + \"/api_key/inputs\",\n                icon: \"fa-key\",\n                submit_title: \"Create a new key\",\n                submit_icon: \"fa-check\"\n            },\n            toolbox_filters: {\n                title: \"Manage Toolbox filters\",\n                description: \"Customize your Toolbox by displaying or omitting sets of Tools.\",\n                url: \"api/users/\" + options.user_id + \"/toolbox_filters/inputs\",\n                icon: \"fa-filter\",\n                submit_title: \"Save filters\",\n                redirect: \"user\"\n            },\n            openids: {\n                title: \"Manage OpenIDs\",\n                description: \"Associate OpenIDs with your account.\",\n                icon: \"fa-openid\",\n                onclick: function onclick() {\n                    window.location.href = Galaxy.root + \"user/openid_manage?cntrller=user&use_panels=True\";\n                }\n            },\n            custom_builds: {\n                title: \"Manage custom builds\",\n                description: \"Add or remove custom builds using history datasets.\",\n                icon: \"fa-cubes\",\n                onclick: function onclick() {\n                    window.location.href = Galaxy.root + \"custom_builds\";\n                }\n            },\n            logout: {\n                title: \"Sign out\",\n                description: \"Click here to sign out of all sessions.\",\n                icon: \"fa-sign-out\",\n                onclick: function onclick() {\n                    Galaxy.modal.show({\n                        title: \"Sign out\",\n                        body: \"Do you want to continue and sign out of all active sessions?\",\n                        buttons: {\n                            Cancel: function Cancel() {\n                                Galaxy.modal.hide();\n                            },\n                            \"Sign out\": function SignOut() {\n                                window.location.href = Galaxy.root + \"user/logout?session_csrf_token=\" + Galaxy.session_csrf_token;\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    }\n});\n\n/** View of the main user preference panel with links to individual user forms */\n/** User Preferences view */\nvar View = Backbone.View.extend({\n    title: \"User Preferences\",\n    initialize: function initialize() {\n        this.model = new Model();\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function render() {\n        var self = this;\n        var config = Galaxy.config;\n        $.getJSON(Galaxy.root + \"api/users/\" + Galaxy.user.id, function (data) {\n            self.$preferences = $(\"<div/>\").addClass(\"ui-panel\").append($(\"<h2/>\").append(\"User preferences\")).append($(\"<p/>\").append(\"You are logged in as <strong>\" + _.escape(data.email) + \"</strong>.\")).append(self.$table = $(\"<table/>\").addClass(\"ui-panel-table\"));\n            var message = _queryStringParsing2.default.get(\"message\");\n            var status = _queryStringParsing2.default.get(\"status\");\n            if (message && status) {\n                self.$preferences.prepend(new _uiMisc2.default.Message({ message: message, status: status }).$el);\n            }\n            if (!config.use_remote_user) {\n                self._addLink(\"information\");\n                self._addLink(\"password\");\n            }\n            if (config.enable_communication_server) {\n                self._addLink(\"communication\");\n            }\n            self._addLink(\"custom_builds\");\n            self._addLink(\"permissions\");\n            self._addLink(\"api_key\");\n            if (config.has_user_tool_filters) {\n                self._addLink(\"toolbox_filters\");\n            }\n            if (config.enable_openid && !config.use_remote_user) {\n                self._addLink(\"openids\");\n            }\n            if (Galaxy.session_csrf_token) {\n                self._addLink(\"logout\");\n            }\n            self.$preferences.append(self._templateFooter(data));\n            self.$el.empty().append(self.$preferences);\n        });\n    },\n\n    _addLink: function _addLink(action) {\n        var options = this.model.get(action);\n        var $row = $(this._templateLink(options));\n        var $a = $row.find(\"a\");\n        if (options.onclick) {\n            $a.on(\"click\", function () {\n                options.onclick();\n            });\n        } else {\n            $a.attr(\"href\", Galaxy.root + \"user/\" + action);\n        }\n        this.$table.append($row);\n    },\n\n    _templateLink: function _templateLink(options) {\n        return \"<tr><td><div class=\\\"ui-panel-icon fa \" + options.icon + \"\\\"></td><td><a class=\\\"ui-panel-anchor\\\" href=\\\"javascript:void(0)\\\">\" + options.title + \"</a><div class=\\\"ui-form-info\\\">\" + options.description + \"</div></td></tr>\";\n    },\n\n    _templateFooter: function _templateFooter(options) {\n        return \"<p class=\\\"ui-panel-footer\\\">You are using <strong>\" + options.nice_total_disk_usage + \"</strong> of disk space in this Galaxy instance. \" + (Galaxy.config.enable_quotas ? \"Your disk quota is: <strong>\" + options.quota + \"</strong>. \" : \"\") + \"Is your usage more than expected? See the <a href=\\\"https://galaxyproject.org/learn/managing-datasets/\\\" target=\\\"_blank\\\">documentation</a> for tips on how to find all of the data in your account.</p>\";\n    }\n});\n\nexports.default = {\n    View: View,\n    Model: Model\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 259 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nvar _uiTable = __webpack_require__(98);\n\nvar _uiTable2 = _interopRequireDefault(_uiTable);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** This class renders the chart configuration form. */\nvar Collection = Backbone.Collection.extend({\n    comparator: function comparator(a, b) {\n        a = a.get(\"name\");\n        b = b.get(\"name\");\n        return a > b ? 1 : a < b ? -1 : 0;\n    }\n});\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        var history_id = Galaxy.currHistoryPanel && Galaxy.currHistoryPanel.model.id;\n        this.model = new Backbone.Model();\n        this.model.url = Galaxy.root + \"api/histories/\" + history_id + \"/custom_builds_metadata\";\n        this.collection = new Collection();\n        this.collection.url = Galaxy.root + \"api/users/\" + Galaxy.user.id + \"/custom_builds\";\n        this.message = new _uiMisc2.default.Message({});\n        this.installed_builds = new _uiMisc2.default.Select.View({\n            optional: true,\n            onchange: function onchange() {\n                self.installed_builds.value(null);\n            },\n            empty_text: \"List of available builds:\",\n            error_text: \"No system installed builds available.\"\n        });\n        this.table = new _uiTable2.default.View({ cls: \"grid\", selectable: false });\n        this.table.addHeader(\"Name\");\n        this.table.addHeader(\"Key\");\n        this.table.addHeader(\"Number of chroms/contigs\");\n        this.table.addHeader(\"\");\n        this.table.appendHeader();\n        this.setElement($(\"<div/>\").append($(\"<h4/>\").text(\"Current Custom Builds\")).append(this.table.$el).append(this.$installed = $(\"<div/>\").append($(\"<h4/>\").text(\"System Installed Builds\").addClass(\"ui-margin-top\")).append(this.installed_builds.$el)).append($(\"<h4/>\").text(\"Add a Custom Build\").addClass(\"ui-margin-top\")).append($(\"<span/>\").addClass(\"ui-column\").append($(\"<div/>\").addClass(\"ui-column-left\").append(this.message.$el).append(this.$form = $(\"<div/>\").addClass(\"ui-margin-top\"))).append(this.$help = $(\"<div/>\").addClass(\"ui-column-right\"))));\n        this.listenTo(this.collection, \"add remove reset\", function () {\n            self._renderTable();\n        });\n        this.listenTo(this.model, \"change\", function () {\n            self._renderForm();\n        });\n        this.collection.fetch();\n        this.model.fetch();\n    },\n\n    render: function render() {\n        this._renderTable();\n        this._renderForm();\n    },\n\n    _renderTable: function _renderTable() {\n        var self = this;\n        this.table.delAll();\n        this.collection.sort();\n        this.collection.each(function (model) {\n            self.table.add(model.get(\"name\"));\n            self.table.add(model.id);\n            self.table.add(model.get(\"count\") !== undefined ? model.get(\"count\") : \"Processing...\");\n            self.table.add(new _uiMisc2.default.ButtonIcon({\n                icon: \"fa-trash-o\",\n                cls: \"ui-button-icon-plain\",\n                tooltip: \"Delete custom build.\",\n                onclick: function onclick() {\n                    model.destroy();\n                }\n            }).$el);\n            self.table.append(model.id);\n        });\n    },\n\n    _renderForm: function _renderForm() {\n        var self = this;\n        var initial_type = \"fasta\";\n        var form = new _formView2.default({\n            inputs: [{\n                type: \"text\",\n                name: \"name\",\n                label: \"Name\",\n                help: \"Specify a build name e.g. Hamster.\"\n            }, {\n                type: \"text\",\n                name: \"id\",\n                label: \"Key\",\n                help: \"Specify a build key e.g. hamster_v1.\"\n            }, {\n                name: \"len\",\n                type: \"conditional\",\n                test_param: {\n                    name: \"type\",\n                    label: \"Definition\",\n                    help: \"Provide the data source.\",\n                    type: \"select\",\n                    value: initial_type,\n                    data: [{\n                        value: \"fasta\",\n                        label: \"FASTA-file from history\"\n                    }, {\n                        value: \"file\",\n                        label: \"Len-file from disk\"\n                    }, {\n                        value: \"text\",\n                        label: \"Len-file by copy/paste\"\n                    }]\n                },\n                cases: [{\n                    value: \"fasta\",\n                    inputs: [{\n                        type: \"select\",\n                        name: \"value\",\n                        label: \"FASTA-file\",\n                        data: this.model.get(\"fasta_hdas\")\n                    }]\n                }, {\n                    value: \"file\",\n                    inputs: [{\n                        type: \"upload\",\n                        name: \"value\",\n                        label: \"Len-file\",\n                        data: this.model.get(\"len_hdas\")\n                    }]\n                }, {\n                    value: \"text\",\n                    inputs: [{\n                        type: \"text\",\n                        area: true,\n                        name: \"value\",\n                        label: \"Edit/Paste\"\n                    }]\n                }]\n            }],\n            buttons: {\n                save: new _uiMisc2.default.Button({\n                    icon: \"fa-save\",\n                    tooltip: \"Create new Build\",\n                    title: \"Save\",\n                    cls: \"btn btn-primary ui-clear-float\",\n                    onclick: function onclick() {\n                        var data = form.data.create();\n                        if (!data.id || !data.name) {\n                            self.message.update({\n                                message: \"All inputs are required.\",\n                                status: \"danger\"\n                            });\n                        } else {\n                            self.collection.create(data, {\n                                wait: true,\n                                success: function success(response) {\n                                    if (response.get(\"message\")) {\n                                        self.message.update({\n                                            message: response.get(\"message\"),\n                                            status: \"warning\"\n                                        });\n                                    } else {\n                                        self.message.update({\n                                            message: \"Successfully added a new custom build.\",\n                                            status: \"success\"\n                                        });\n                                    }\n                                },\n                                error: function error(response, err) {\n                                    var message = err && err.responseJSON && err.responseJSON.err_msg;\n                                    self.message.update({\n                                        message: message || \"Failed to create custom build.\",\n                                        status: \"danger\"\n                                    });\n                                }\n                            });\n                        }\n                    }\n                })\n            },\n            onchange: function onchange() {\n                var input_id = form.data.match(\"len|type\");\n                if (input_id) {\n                    var input_field = form.field_list[input_id];\n                    self._renderHelp(input_field.value());\n                }\n            }\n        });\n        this.$form.empty().append(form.$el);\n        var installed_builds = this.model.get(\"installed_builds\");\n        if (installed_builds && installed_builds.length) {\n            this.$installed.show();\n            this.installed_builds.update(this.model.get(\"installed_builds\"));\n        } else {\n            this.$installed.hide();\n        }\n        this._renderHelp(initial_type);\n    },\n\n    _renderHelp: function _renderHelp(len_type) {\n        this.$help.empty().addClass(\"alert alert-info\").html(len_type == \"fasta\" ? this._templateFasta() : this._templateLen());\n    },\n\n    _templateLen: function _templateLen() {\n        return \"<h4>Length Format</h4>\" + \"<p>\" + \"The length format is two-column, separated by whitespace, of the form:\" + \"<pre>chrom/contig   length of chrom/contig</pre>\" + \"</p>\" + \"<p>\" + \"For example, the first few entries of <em>mm9.len</em> are as follows:\" + \"<pre>\" + \"chr1    197195432\\n\" + \"chr2    181748087\\n\" + \"chr3    159599783\\n\" + \"chr4    155630120\\n\" + \"chr5    152537259\" + \"</pre>\" + \"</p>\" + \"<p>Trackster uses this information to populate the select box for chrom/contig, and\" + \"to set the maximum basepair of the track browser. You may either upload a .len file\" + \"of this format (Len File option), or directly enter the information into the box \" + \"(Len Entry option).</p>\";\n    },\n\n    _templateFasta: function _templateFasta() {\n        return \"<h4>FASTA format</h4>\" + \"<p>\" + \"This is a multi-fasta file from your current history that provides the genome\" + \"sequences for each chromosome/contig in your build.\" + \"</p>\" + \"<p>\" + \"Here is a snippet from an example multi-fasta file:\" + \"<pre>\" + \">chr1\\n\" + \"ATTATATATAAGACCACAGAGAGAATATTTTGCCCGG...\\n\\n\" + \">chr2\\n\" + \"GGCGGCCGCGGCGATATAGAACTACTCATTATATATA...\\n\\n\" + \"...\" + \"</pre>\" + \"</p>\";\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 260 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _gridView = __webpack_require__(12);\n\nvar _gridView2 = _interopRequireDefault(_gridView);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar View = Backbone.View.extend({\n    initialize: function initialize(options) {\n        var self = this;\n        this.setElement($(\"<div/>\"));\n        this.model = new Backbone.Model(options);\n        this.item = this.model.get(\"item\");\n        this.title = this.model.get(\"plural\");\n        $.ajax({\n            url: Galaxy.root + this.item + \"/\" + this.model.get(\"action_id\") + \"?\" + $.param(Galaxy.params),\n            success: function success(response) {\n                response[\"dict_format\"] = true;\n                self.model.set(response);\n                self.render();\n            }\n        });\n    },\n\n    render: function render() {\n        var grid = new _gridView2.default(this.model.attributes);\n        this.$el.empty().append(grid.$el);\n        this.$el.append(this._templateShared());\n    },\n\n    _templateShared: function _templateShared() {\n        var self = this;\n        var $tmpl = $(\"<div><h2>\" + this.model.get(\"plural\") + \" shared with you by others</h2></div>\");\n        var options = this.model.attributes;\n        if (options.shared_by_others && options.shared_by_others.length > 0) {\n            var $table = $('<table class=\"colored\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">' + '<tr class=\"header\">' + \"<th>Title</th>\" + \"<th>Owner</th>\" + \"</tr>\" + \"</table>\");\n            _.each(options.shared_by_others, function (it, index) {\n                var display_url = Galaxy.root + self.item + \"/display_by_username_and_slug?username=\" + it.username + \"&slug=\" + it.slug;\n                $table.append(\"<tr><td><a href=\\\"\" + display_url + \"\\\">\" + _.escape(it.title) + \"</a></td><td>\" + _.escape(it.username) + \"</td></tr>\");\n            });\n            $tmpl.append($table);\n        } else {\n            $tmpl.append(\"No \" + this.model.get(\"plural\").toLowerCase() + \" have been shared with you.\");\n        }\n        return $tmpl;\n    }\n}); /** This class renders the grid list with shared section. */\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 261 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, _, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _toastr = __webpack_require__(65);\n\nvar mod_toastr = _interopRequireWildcard(_toastr);\n\nvar _tag = __webpack_require__(67);\n\nvar _tag2 = _interopRequireDefault(_tag);\n\nvar _workflowModel = __webpack_require__(262);\n\nvar _workflowModel2 = _interopRequireDefault(_workflowModel);\n\nvar _queryStringParsing = __webpack_require__(17);\n\nvar _queryStringParsing2 = _interopRequireDefault(_queryStringParsing);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/** View of the individual workflows */\n/** Workflow view */\nvar WorkflowItemView = Backbone.View.extend({\n    tagName: \"tr\", // name of (orphan) root tag in this.el\n    initialize: function initialize() {\n        _.bindAll(this, \"render\", \"_rowTemplate\", \"renderTagEditor\", \"_templateActions\", \"removeWorkflow\", \"copyWorkflow\"); // every function that uses 'this' as the current object should be in here\n        mod_toastr.options.timeOut = 1500;\n    },\n\n    events: {\n        \"click #show-in-tool-panel\": \"showInToolPanel\",\n        \"click #delete-workflow\": \"removeWorkflow\",\n        \"click #rename-workflow\": \"renameWorkflow\",\n        \"click #copy-workflow\": \"copyWorkflow\"\n    },\n\n    render: function render() {\n        $(this.el).html(this._rowTemplate());\n        return this;\n    },\n\n    showInToolPanel: function showInToolPanel() {\n        this.model.set(\"show_in_tool_panel\", !this.model.get(\"show_in_tool_panel\"));\n        this.model.save();\n        // This reloads the whole page, so that the workflow appears in the tool panel.\n        // Ideally we would notify only the tool panel of a change\n        window.location = Galaxy.root + \"workflow\";\n    },\n\n    removeWorkflow: function removeWorkflow() {\n        var wfName = this.model.get(\"name\");\n        if (window.confirm(\"Are you sure you want to delete workflow '\" + wfName + \"'?\")) {\n            this.model.destroy({\n                success: function success() {\n                    mod_toastr.success(\"Successfully deleted workflow '\" + wfName + \"'\");\n                }\n            });\n            this.remove();\n        }\n    },\n\n    renameWorkflow: function renameWorkflow() {\n        var oldName = this.model.get(\"name\");\n        var newName = window.prompt(\"Enter a new Name for workflow '\" + oldName + \"'\", oldName);\n        if (newName) {\n            this.model.save({ name: newName }, {\n                success: function success() {\n                    mod_toastr.success(\"Successfully renamed workflow '\" + oldName + \"' to '\" + newName + \"'\");\n                }\n            });\n            this.render();\n        }\n    },\n\n    copyWorkflow: function copyWorkflow() {\n        var self = this;\n        var oldName = this.model.get(\"name\");\n        $.getJSON(this.model.urlRoot + \"/\" + this.model.id + \"/download\", function (wfJson) {\n            var newName = \"Copy of \" + oldName;\n            var currentOwner = self.model.get(\"owner\");\n            if (currentOwner != Galaxy.user.attributes.username) {\n                newName += \" shared by user \" + currentOwner;\n            }\n            wfJson.name = newName;\n            self.collection.create(wfJson, {\n                at: 0,\n                wait: true,\n                success: function success() {\n                    mod_toastr.success(\"Successfully copied workflow '\" + oldName + \"' to '\" + newName + \"'\");\n                },\n                error: function error(model, resp, options) {\n                    // signature seems to have changed over the course of backbone dev\n                    // see https://github.com/jashkenas/backbone/issues/2606#issuecomment-19289483\n                    mod_toastr.error(options.errorThrown);\n                }\n            });\n        }).error(function (jqXHR, textStatus, errorThrown) {\n            mod_toastr.error(jqXHR.responseJSON.err_msg);\n        });\n    },\n\n    _rowTemplate: function _rowTemplate() {\n        var show = this.model.get(\"show_in_tool_panel\");\n        var wfId = this.model.id;\n        var checkboxHtml = \"<input id=\\\"show-in-tool-panel\\\" type=\\\"checkbox\\\" class=\\\"show-in-tool-panel\\\" \" + (show ? \"checked=\\\"\" + show + \"\\\"\" : \"\") + \" value=\\\"\" + wfId + \"\\\">\";\n        var trHtml = \"<td><div class=\\\"dropdown\\\"><button class=\\\"menubutton\\\" type=\\\"button\\\" data-toggle=\\\"dropdown\\\">\" + _.escape(this.model.get(\"name\")) + \"<span class=\\\"caret\\\"></span></button>\" + this._templateActions() + \"</div></td><td><span><div class=\\\"\" + wfId + \" tags-display\\\"></div></td><td>\" + (this.model.get(\"owner\") === Galaxy.user.attributes.username ? \"You\" : this.model.get(\"owner\")) + \"</span></td><td>\" + this.model.get(\"number_of_steps\") + \"</td><td>\" + (this.model.get(\"published\") ? \"Yes\" : \"No\") + \"</td><td>\" + checkboxHtml + \"</td>\";\n        return trHtml;\n    },\n\n    renderTagEditor: function renderTagEditor() {\n        var TagEditor = new _tag2.default.TagsEditor({\n            model: this.model,\n            el: $.find(\".\" + this.model.id + \".tags-display\"),\n            workflow_mode: true\n        });\n        TagEditor.toggle(true);\n        TagEditor.render();\n    },\n\n    /** Template for user actions for workflows */\n    _templateActions: function _templateActions() {\n        if (this.model.get(\"owner\") === Galaxy.user.attributes.username) {\n            return \"<ul class=\\\"dropdown-menu action-dpd\\\"><li><a href=\\\"\" + Galaxy.root + \"workflow/editor?id=\" + this.model.id + \"\\\">Edit</a></li><li><a href=\\\"\" + Galaxy.root + \"workflow/run?id=\" + this.model.id + \"\\\">Run</a></li><li><a href=\\\"\" + Galaxy.root + \"workflow/sharing?id=\" + this.model.id + \"\\\">Share</a></li><li><a href=\\\"\" + Galaxy.root + \"api/workflows/\" + this.model.id + \"/download?format=json-download\\\">Download</a></li><li><a id=\\\"copy-workflow\\\" style=\\\"cursor: pointer;\\\">Copy</a></li><li><a id=\\\"rename-workflow\\\" style=\\\"cursor: pointer;\\\">Rename</a></li><li><a href=\\\"\" + Galaxy.root + \"workflow/display_by_id?id=\" + this.model.id + \"\\\">View</a></li><li><a id=\\\"delete-workflow\\\" style=\\\"cursor: pointer;\\\">Delete</a></li></ul>\";\n        } else {\n            return \"<ul class=\\\"dropdown-menu action-dpd\\\"><li><a href=\\\"\" + Galaxy.root + \"workflow/display_by_username_and_slug?username=\" + this.model.get(\"owner\") + \"&slug=\" + this.model.get(\"slug\") + \"\\\">View</a></li><li><a href=\\\"\" + Galaxy.root + \"workflow/run?id=\" + this.model.id + \"\\\">Run</a></li><li><a id=\\\"copy-workflow\\\" style=\\\"cursor: pointer;\\\">Copy</a></li><li><a class=\\\"link-confirm-shared-\" + this.model.id + \"\\\" href=\\\"\" + Galaxy.root + \"workflow/sharing?unshare_me=True&id=\" + this.model.id + \"\\\">Remove</a></li></ul>\";\n        }\n    }\n});\n\n/** View of the main workflow list page */\nvar WorkflowListView = Backbone.View.extend({\n    title: \"Workflows\",\n    initialize: function initialize() {\n        this.setElement(\"<div/>\");\n        _.bindAll(this, \"adjustActiondropdown\");\n        this.collection = new _workflowModel2.default.WorkflowCollection();\n        this.collection.fetch().done(this.render());\n        this.collection.bind(\"add\", this.appendItem);\n        this.collection.on(\"sync\", this.render, this);\n    },\n\n    events: {\n        dragleave: \"unhighlightDropZone\",\n        drop: \"drop\",\n        dragover: function dragover(ev) {\n            $(\".hidden_description_layer\").addClass(\"dragover\");\n            $(\".menubutton\").addClass(\"background-none\");\n            ev.preventDefault();\n        }\n    },\n\n    unhighlightDropZone: function unhighlightDropZone() {\n        $(\".hidden_description_layer\").removeClass(\"dragover\");\n        $(\".menubutton\").removeClass(\"background-none\");\n    },\n\n    drop: function drop(e) {\n        // TODO: check that file is valid galaxy workflow\n        this.unhighlightDropZone();\n        e.preventDefault();\n        var files = e.dataTransfer.files;\n        var self = this;\n        for (var i = 0, f; f = files[i]; i++) {\n            self.readWorkflowFiles(f);\n        }\n    },\n\n    readWorkflowFiles: function readWorkflowFiles(f) {\n        var self = this;\n        var reader = new FileReader();\n        reader.onload = function (theFile) {\n            var wf_json;\n            try {\n                wf_json = JSON.parse(reader.result);\n            } catch (e) {\n                mod_toastr.error(\"Could not read file '\" + f.name + \"'. Verify it is a valid Galaxy workflow\");\n                wf_json = null;\n            }\n            if (wf_json) {\n                self.collection.create(wf_json, {\n                    at: 0,\n                    wait: true,\n                    success: function success() {\n                        mod_toastr.success(\"Successfully imported workflow '\" + wf_json.name + \"'\");\n                    },\n                    error: function error(model, resp, options) {\n                        mod_toastr.error(options.errorThrown);\n                    }\n                });\n            }\n        };\n        reader.readAsText(f, \"utf-8\");\n    },\n\n    _showArgErrors: _.once(function () {\n        // Parse args out of params, display if there's a message.\n        var msg_text = _queryStringParsing2.default.get(\"message\");\n        var msg_status = _queryStringParsing2.default.get(\"status\");\n        if (msg_status === \"error\") {\n            mod_toastr.error(_.escape(msg_text || \"Unknown Error, please report this to an administrator.\"));\n        } else if (msg_text) {\n            mod_toastr.info(_.escape(msg_text));\n        }\n    }),\n\n    render: function render() {\n        // Add workflow header\n        var header = this._templateHeader();\n        // Add the actions buttons\n        var templateActions = this._templateActionButtons();\n        var tableTemplate = this._templateWorkflowTable();\n        this.$el.html(header + templateActions + tableTemplate);\n        var self = this;\n        _(this.collection.models).each(function (item) {\n            // in case collection is not empty\n            self.appendItem(item);\n            self.confirmDelete(item);\n        }, this);\n        var minQueryLength = 3;\n        this.searchWorkflow(this.$(\".search-wf\"), this.$(\".workflow-search tr\"), minQueryLength);\n        this.adjustActiondropdown();\n        this._showArgErrors();\n        return this;\n    },\n\n    appendItem: function appendItem(item) {\n        var workflowItemView = new WorkflowItemView({\n            model: item,\n            collection: this.collection\n        });\n        $(\".workflow-search\").append(workflowItemView.render().el);\n        workflowItemView.renderTagEditor();\n    },\n\n    /** Add confirm box before removing/unsharing workflow */\n    confirmDelete: function confirmDelete(workflow) {\n        var $el_shared_wf_link = this.$(\".link-confirm-shared-\" + workflow.id);\n        $el_shared_wf_link.click(function () {\n            return window.confirm(\"Are you sure you want to remove the shared workflow '\" + workflow.attributes.name + \"'?\");\n        });\n    },\n\n    /** Implement client side workflow search/filtering */\n    searchWorkflow: function searchWorkflow($el_searchinput, $el_tabletr, min_querylen) {\n        $el_searchinput.on(\"keyup\", function () {\n            var query = $(this).val();\n            // Filter when query is at least 3 characters\n            // otherwise show all rows\n            if (query.length >= min_querylen) {\n                // Ignore the query's case using 'i'\n                var regular_expression = new RegExp(query, \"i\");\n                $el_tabletr.hide();\n                $el_tabletr.filter(function () {\n                    // Apply regular expression on each row's text\n                    // and show when there is a match\n                    return regular_expression.test($(this).text());\n                }).show();\n            } else {\n                $el_tabletr.show();\n            }\n        });\n    },\n\n    /** Ajust the position of dropdown with respect to table */\n    adjustActiondropdown: function adjustActiondropdown() {\n        $(this.el).on(\"show.bs.dropdown\", function () {\n            $(this.el).css(\"overflow\", \"inherit\");\n        });\n        $(this.el).on(\"hide.bs.dropdown\", function () {\n            $(this.el).css(\"overflow\", \"auto\");\n        });\n    },\n\n    /** Template for no workflow */\n    _templateNoWorkflow: function _templateNoWorkflow() {\n        return '<div class=\"wf-nodata\"> You have no workflows. </div>';\n    },\n\n    /** Template for actions buttons */\n    _templateActionButtons: function _templateActionButtons() {\n        return \"<ul class=\\\"manage-table-actions\\\"><li><input class=\\\"search-wf form-control\\\" type=\\\"text\\\" autocomplete=\\\"off\\\" placeholder=\\\"search for workflow...\\\"></li><li><a class=\\\"action-button fa fa-plus wf-action\\\" id=\\\"new-workflow\\\" title=\\\"Create new workflow\\\" href=\\\"\" + Galaxy.root + \"workflow/create\\\"></a></li><li><a class=\\\"action-button fa fa-upload wf-action\\\" id=\\\"import-workflow\\\" title=\\\"Upload or import workflow\\\" href=\\\"\" + Galaxy.root + \"workflow/import_workflow\\\"></a></li></ul>\";\n    },\n\n    /** Template for workflow table */\n    _templateWorkflowTable: function _templateWorkflowTable() {\n        var tableHtml = '<table class=\"table colored\"><thead>' + '<tr class=\"header\">' + \"<th>Name</th>\" + \"<th>Tags</th>\" + \"<th>Owner</th>\" + \"<th># of Steps</th>\" + \"<th>Published</th>\" + \"<th>Show in tools panel</th>\" + \"</tr></thead>\";\n        return tableHtml + \"<tbody class=\\\"workflow-search \\\"><div class=\\\"hidden_description_layer\\\"><p>Drop workflow files here to import</p></tbody></table></div>\";\n    },\n\n    /** Main template */\n    _templateHeader: function _templateHeader() {\n        return '<div class=\"page-container\">' + '<div class=\"user-workflows wf\">' + '<div class=\"response-message\"></div>' + \"<h2>Your workflows</h2>\" + \"</div>\" + \"</div>\";\n    }\n});\n\nvar ImportWorkflowView = Backbone.View.extend({\n    initialize: function initialize() {\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    /** Open page to import workflow */\n    render: function render() {\n        var self = this;\n        $.getJSON(Galaxy.root + \"workflow/upload_import_workflow\", function (options) {\n            self.$el.empty().append(self._mainTemplate(options));\n        });\n    },\n\n    /** Template for the import workflow page */\n    _mainTemplate: function _mainTemplate(options) {\n        return \"<div class='toolForm'><div class='toolFormTitle'>Import Galaxy workflow</div><div class='toolFormBody'><form name='import_workflow' id='import_workflow' action='\" + Galaxy.root + \"workflow/upload_import_workflow' enctype='multipart/form-data' method='POST'><div class='form-row'><label>Galaxy workflow URL:</label><input type='text' name='url' class='input-url' value='\" + options.url + \"' size='40'><div class='toolParamHelp' style='clear: both;'>If the workflow is accessible via a URL, enter the URL above and click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><label>Galaxy workflow file:</label><div class='form-row-input'><input type='file' name='file_data' class='input-file'/></div><div class='toolParamHelp' style='clear: both;'>If the workflow is in a file on your computer, choose it and then click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><input type='submit' class='primary-button wf-import' name='import_button' value='Import'></div></form><hr/><div class='form-row'><label>Import a Galaxy workflow from myExperiment:</label><div class='form-row-input'><a href='\" + options.myexperiment_target_url + \"'> Visit myExperiment</a></div><div class='toolParamHelp' style='clear: both;'>Click the link above to visit myExperiment and browse for Galaxy workflows.</div><div style='clear: both'></div></div></div></div>\";\n    }\n});\n\nexports.default = {\n    View: WorkflowListView,\n    ImportWorkflowView: ImportWorkflowView\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(1), __webpack_require__(0)))\n\n/***/ }),\n/* 262 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _baseMvc = __webpack_require__(5);\n\nvar _baseMvc2 = _interopRequireDefault(_baseMvc);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* global Backbone */\n// workflow model\n\nvar logNamespace = \"workflow\";\n//==============================================================================\n/** @class model for a single workflow.\n *  @name WorkflowItem\n *  @augments Backbone.Model\n */\nvar WorkflowItem = Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    urlRoot: Galaxy.root + \"api/workflows\",\n\n    toJSON: function toJSON() {\n        // need to overwrite this as endpoint expects the 'workflow' key in payload\n        return { workflow: this.attributes };\n    }\n});\n\n//==============================================================================\n/** @class collection for workflows.\n *  @name WorkflowCollection\n *  @augments Backbone.Collection\n */\nvar WorkflowCollection = Backbone.Collection.extend({\n    model: WorkflowItem,\n    url: Galaxy.root + \"api/workflows\"\n});\n\n//==============================================================================\n\nexports.default = {\n    WorkflowItem: WorkflowItem,\n    WorkflowCollection: WorkflowCollection\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2)))\n\n/***/ }),\n/* 263 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _gridView = __webpack_require__(12);\n\nvar _gridView2 = _interopRequireDefault(_gridView);\n\nvar _historyModel = __webpack_require__(82);\n\nvar _historyModel2 = _interopRequireDefault(_historyModel);\n\nvar _copyDialog = __webpack_require__(125);\n\nvar _copyDialog2 = _interopRequireDefault(_copyDialog);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** This class renders the grid list. */\nvar View = Backbone.View.extend({\n    title: \"Histories\",\n    initialize: function initialize(options) {\n        var self = this;\n        this.setElement($(\"<div/>\"));\n        this.model = new Backbone.Model();\n        _utils2.default.get({\n            url: Galaxy.root + \"history/\" + options.action_id + \"?\" + $.param(Galaxy.params),\n            success: function success(response) {\n                response[\"dict_format\"] = true;\n                _.each(response[\"operations\"], function (operation) {\n                    if (operation.label == \"Copy\") {\n                        operation.onclick = function (id) {\n                            self._showCopyDialog(id);\n                        };\n                    }\n                });\n                self.model.set(response);\n                self.render();\n            }\n        });\n    },\n\n    render: function render() {\n        var grid = new _gridView2.default(this.model.attributes);\n        this.$el.empty().append(grid.$el);\n    },\n\n    _showCopyDialog: function _showCopyDialog(id) {\n        var history = new _historyModel2.default.History({ id: id });\n        history.fetch().fail(function () {\n            alert(\"History could not be fetched. Please contact an administrator\");\n        }).done(function () {\n            (0, _copyDialog2.default)(history, {}).done(function () {\n                if (window.parent && window.parent.Galaxy && window.parent.Galaxy.currHistoryPanel) {\n                    window.parent.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n                window.location.reload(true);\n            });\n        });\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ }),\n/* 264 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Dataset edit attributes view */\nvar View = Backbone.View.extend({\n    initialize: function initialize() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.render();\n    },\n\n    // Fetch data for the selected dataset and\n    render: function render() {\n        var data_url = Galaxy.root + \"api/datasets/\" + this.model.get(\"dataset_id\");\n\n        var self = this;\n\n        _utils2.default.get({\n            url: data_url,\n            success: function success(dataset) {\n                var job_url = Galaxy.root + \"api/jobs/\" + dataset.creating_job + \"?full=True\";\n                _utils2.default.get({\n                    url: job_url,\n                    success: function success(job) {\n                        var job_url = Galaxy.root + \"api/jobs/\" + dataset.creating_job + \"?full=True\";\n                        self.render_error_page(self, dataset, job);\n                    },\n                    error: function error(response) {\n                        var error_response = {\n                            status: \"error\",\n                            message: \"Error occured while loading the job.\",\n                            persistent: true,\n                            cls: \"errormessage\"\n                        };\n                        self.display_message(error_response, self.$(\".response-message\"));\n                    }\n                });\n            },\n            error: function error(response) {\n                var error_response = {\n                    status: \"error\",\n                    message: \"Error occured while loading the dataset.\",\n                    persistent: true,\n                    cls: \"errormessage\"\n                };\n                self.display_message(error_response, self.$(\".response-message\"));\n            }\n        });\n    },\n\n    /** Render the view */\n    render_error_page: function render_error_page(self, dataset, job) {\n        self.$el.empty().append(self._templateHeader());\n        self.$el.append(\"<h2>Dataset Error</h2>\");\n        self.$el.append(\"<p>An error occured while running the tool <b>\" + job.tool_id + \"</b>.</p>\");\n        self.$el.append(\"<p>Tool execution generated the following messages:</p>\");\n        self.$el.append(\"<pre class=\\\"code\\\">\" + job.stderr + \"</pre>\");\n        self.$el.append(\"<h2>Report This Error</pre>\");\n        self.$el.append(\"<p>Usually the local Galaxy administrators regularly review errors that occur on the server. However, if you would like to provide additional information (such as what you were trying to do when the error occurred) and a contact e-mail address, we will be better able to investigate your problem and get back to you.</p>\");\n        self.$el.append(self._getBugFormTemplate(dataset, job));\n    },\n\n    /** Display actions messages */\n    display_message: function display_message(response, $el, doNotClear, safe) {\n        if (!safe) {\n            if (doNotClear) {\n                $el.append(new _uiMisc2.default.Message(response).$el);\n            } else {\n                $el.empty().html(new _uiMisc2.default.Message(response).$el);\n            }\n        } else {\n            if (doNotClear) {\n                $el.append(new _uiMisc2.default.UnescapedMessage(response).$el);\n            } else {\n                $el.empty().html(new _uiMisc2.default.UnescapedMessage(response).$el);\n            }\n        }\n    },\n\n    /** Main template */\n    _templateHeader: function _templateHeader() {\n        return '<div class=\"page-container edit-attr\">' + '<div class=\"response-message\"></div>' + \"</div>\";\n    },\n\n    /** Convert tab template */\n    _getBugFormTemplate: function _getBugFormTemplate(dataset, job) {\n        var self = this;\n        var inputs = [{\n            help: \"Your email address\",\n            options: [],\n            type: \"text\",\n            name: \"email\",\n            label: \"Your email\",\n            value: Galaxy.user.get(\"email\")\n        }, {\n            help: \"Any additional comments you can provide regarding what you were doing at the time of the bug.\",\n            options: [],\n            type: \"text\",\n            area: true,\n            name: \"message\",\n            label: \"Message\"\n        }];\n\n        // TODO\n        /*\n        if (false && response.any_public) {\n            inputs.push({\n                name: \"public_consent\",\n                label: \"Public Disclosure Consent\",\n                help:\n                    \"This Galaxy is configured to report to one or more error reporting backends that public to the world. By selecting 'yes', you acknowledge that this bug report will be made public.\",\n                value: String(Boolean(false)),\n                options: [],\n                type: \"boolean\"\n            });\n        }\n        */\n\n        var form = new _formView2.default({\n            title: \"Error Report\",\n            inputs: inputs,\n            buttons: {\n                save: new _uiMisc2.default.Button({\n                    icon: \"fa-bug\",\n                    title: \"Report\",\n                    cls: \"ui-button btn btn-primary\",\n                    floating: \"clear\",\n                    onclick: function onclick() {\n                        var form_data = form.data.create();\n                        var url = Galaxy.root + \"api/jobs/\" + job.id + \"/error\";\n                        form_data.dataset_id = dataset.id;\n                        self.submit(form_data, url);\n                    }\n                })\n            }\n        });\n        return form.$el;\n    },\n\n    /** Make ajax request */\n    submit: function submit(form_data, url) {\n        var self = this;\n        // Some required metadata\n        $.ajax({\n            type: \"POST\",\n            url: url,\n            data: form_data,\n            success: function success(response) {\n                // Clear out the div\n                self.$el.empty().append(self._templateHeader());\n                // And display the messages.\n                response.messages.forEach(function (message) {\n                    self.display_message({\n                        status: message[1],\n                        message: message[0],\n                        persistent: true\n                    }, self.$(\".response-message\"), true, true);\n                });\n            },\n            error: function error(response) {\n                var error_response = {\n                    status: \"error\",\n                    message: \"Error occured while saving. Please fill all the required fields and try again.\",\n                    persistent: true,\n                    cls: \"errormessage\"\n                };\n                self.display_message(error_response, self.$(\".response-message\"));\n            }\n        });\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0)))\n\n/***/ }),\n/* 265 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(Backbone, $, _) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _utils = __webpack_require__(3);\n\nvar _utils2 = _interopRequireDefault(_utils);\n\nvar _uiTabs = __webpack_require__(20);\n\nvar _uiTabs2 = _interopRequireDefault(_uiTabs);\n\nvar _uiMisc = __webpack_require__(6);\n\nvar _uiMisc2 = _interopRequireDefault(_uiMisc);\n\nvar _formView = __webpack_require__(32);\n\nvar _formView2 = _interopRequireDefault(_formView);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/** Dataset edit attributes view */\nvar View = Backbone.View.extend({\n    initialize: function initialize() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new _uiMisc2.default.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el.append($(\"<h4/>\").append(\"Edit dataset attributes\")).append(this.message.$el).append(\"<p/>\").append(this.tabs.$el).hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function render() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + \"dataset/get_edit?dataset_id=\" + self.model.get(\"dataset_id\"),\n            success: function success(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, function (form, key) {\n                    form.model.set(\"inputs\", response[key + \"_inputs\"]);\n                    form.model.set(\"hide_operations\", response[key + \"_disable\"]);\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function error(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function _submit(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: Galaxy.root + \"dataset/set_edit\",\n            data: data,\n            success: function success(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function error(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function _createTabs() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new _uiTabs2.default.View();\n        tabs.add({\n            id: \"attribute\",\n            title: \"Attributes\",\n            icon: \"fa fa-bars\",\n            tooltip: \"Edit dataset attributes\",\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: \"Convert\",\n            icon: \"fa-gear\",\n            tooltip: \"Convert to new format\",\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: \"Datatypes\",\n            icon: \"fa-database\",\n            tooltip: \"Change data type\",\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: \"Permissions\",\n            icon: \"fa-user\",\n            tooltip: \"Permissions\",\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function _getAttribute() {\n        var self = this;\n        var form = new _formView2.default({\n            title: \"Edit attributes\",\n            operations: {\n                submit_attributes: new _uiMisc2.default.ButtonIcon({\n                    tooltip: \"Save attributes of the dataset.\",\n                    icon: \"fa-floppy-o\",\n                    title: \"Save\",\n                    onclick: function onclick() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new _uiMisc2.default.ButtonIcon({\n                    tooltip: \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function onclick() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function _getConversion() {\n        var self = this;\n        var form = new _formView2.default({\n            title: \"Convert to new format\",\n            operations: {\n                submit_conversion: new _uiMisc2.default.ButtonIcon({\n                    tooltip: \"Convert the datatype to a new format.\",\n                    title: \"Convert datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function onclick() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function _getDatatype() {\n        var self = this;\n        var form = new _formView2.default({\n            title: \"Change datatype\",\n            operations: {\n                submit_datatype: new _uiMisc2.default.ButtonIcon({\n                    tooltip: \"Change the datatype to a new type.\",\n                    title: \"Change datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function onclick() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function _getPermission() {\n        var self = this;\n        var form = new _formView2.default({\n            title: \"Manage dataset permissions\",\n            operations: {\n                submit_permission: new _uiMisc2.default.ButtonIcon({\n                    tooltip: \"Save permissions.\",\n                    title: \"Save permissions\",\n                    icon: \"fa-floppy-o \",\n                    onclick: function onclick() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function _reloadHistory() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexports.default = {\n    View: View\n};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(2), __webpack_require__(0), __webpack_require__(1)))\n\n/***/ })\n],[233]);\n\n\n// WEBPACK FOOTER //\n// analysis.bundled.js","import * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport addLogging from \"utils/add-logging\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/** @class Mixin to add logging capabilities to an object.\n *      Designed to allow switching an objects log output off/on at one central\n *      statement. Can be used with plain browser console (or something more\n *      complex like an AJAX logger).\n *  <br />NOTE: currently only uses the console.debug log function\n *  (as opposed to debug, error, warn, etc.)\n *  @name LoggableMixin\n *\n *  @example\n *  // Add to your models/views at the definition using chaining:\n *      var MyModel = Backbone.Model.extend( LoggableMixin ).extend({ // ... });\n *\n *  // or - more explicitly AFTER the definition:\n *      var MyModel = Backbone.Model.extend({\n *          logger  : console\n *          // ...\n *          this.log( '$#%& it! - broken already...' );\n *      })\n *      _.extend( MyModel.prototype, LoggableMixin )\n *\n */\nvar LoggableMixin = /** @lends LoggableMixin# */ {\n    // replace null with console (if available) to see all logs for a particular view/model\n    /** The logging object whose log function will be used to output\n     *      messages. Null will supress all logging. Commonly set to console.\n     */\n    logger: null,\n    /** @type {String} a namespace for filtering/focusing log output */\n    _logNamespace: \".\"\n};\naddLogging(LoggableMixin);\n\n//==============================================================================\n/** Backbone model that syncs to the browser's sessionStorage API.\n *      This all largely happens behind the scenes and no special calls are required.\n */\nvar SessionStorageModel = Backbone.Model.extend({\n    initialize: function(initialAttrs) {\n        // check for sessionStorage and error if no id is provided\n        this._checkEnabledSessionStorage();\n        if (!initialAttrs.id) {\n            throw new Error(\"SessionStorageModel requires an id in the initial attributes\");\n        }\n        this.id = initialAttrs.id;\n\n        // load existing from storage (if any), clear any attrs set by bbone before init is called,\n        //  layer initial over existing and defaults, and save\n        var existing = !this.isNew() ? this._read(this) : {};\n        this.clear({ silent: true });\n        this.save(_.extend({}, this.defaults, existing, initialAttrs), {\n            silent: true\n        });\n\n        // save on any change to it immediately\n        this.on(\"change\", function() {\n            this.save();\n        });\n    },\n\n    _checkEnabledSessionStorage: function() {\n        try {\n            return window.sessionStorage.length >= 0;\n        } catch (err) {\n            alert(\"Please enable cookies in your browser for this Galaxy site\");\n            return false;\n        }\n    },\n\n    /** override of bbone sync to save to sessionStorage rather than REST\n     *      bbone options (success, errror, etc.) should still apply\n     */\n    sync: function(method, model, options) {\n        if (!options.silent) {\n            model.trigger(\"request\", model, {}, options);\n        }\n        var returned = {};\n        switch (method) {\n            case \"create\":\n                returned = this._create(model);\n                break;\n            case \"read\":\n                returned = this._read(model);\n                break;\n            case \"update\":\n                returned = this._update(model);\n                break;\n            case \"delete\":\n                returned = this._delete(model);\n                break;\n        }\n        if (returned !== undefined || returned !== null) {\n            if (options.success) {\n                options.success();\n            }\n        } else {\n            if (options.error) {\n                options.error();\n            }\n        }\n        return returned;\n    },\n\n    /** set storage to the stringified item */\n    _create: function(model) {\n        try {\n            var json = model.toJSON();\n            var set = sessionStorage.setItem(model.id, JSON.stringify(json));\n            return set === null ? set : json;\n            // DOMException is thrown in Safari if in private browsing mode and sessionStorage is attempted:\n            // http://stackoverflow.com/questions/14555347\n            // TODO: this could probably use a more general soln - like detecting priv. mode + safari => non-ajaxing Model\n        } catch (err) {\n            if (!(err instanceof DOMException && navigator.userAgent.indexOf(\"Safari\") > -1)) {\n                throw err;\n            }\n        }\n        return null;\n    },\n\n    /** read and parse json from storage */\n    _read: function(model) {\n        return JSON.parse(sessionStorage.getItem(model.id));\n    },\n\n    /** set storage to the item (alias to create) */\n    _update: function(model) {\n        return model._create(model);\n    },\n\n    /** remove the item from storage */\n    _delete: function(model) {\n        return sessionStorage.removeItem(model.id);\n    },\n\n    /** T/F whether sessionStorage contains the model's id (data is present) */\n    isNew: function() {\n        return !sessionStorage.hasOwnProperty(this.id);\n    },\n\n    _log: function() {\n        return JSON.stringify(this.toJSON(), null, \"  \");\n    },\n    toString: function() {\n        return `SessionStorageModel(${this.id})`;\n    }\n});\n(() => {\n    SessionStorageModel.prototype = _.omit(SessionStorageModel.prototype, \"url\", \"urlRoot\");\n})();\n\n//==============================================================================\n/** Function that allows mixing of hashs into bbone MVC while showing the mixins first\n *      (before the more local class overrides/hash).\n *      Basically, a simple reversal of param order on _.defaults() - to show mixins in top of definition.\n *  @example:\n *      var NewModel = Something.extend( mixin( MyMixinA, MyMixinB, { ... myVars : ... }) );\n *\n *  NOTE: this does not combine any hashes (like events, etc.) and you're expected to handle that\n */\nfunction mixin(mixinHash1, /* mixinHash2, etc: ... variadic */ propsHash) {\n    var args = Array.prototype.slice.call(arguments, 0);\n    var lastArg = args.pop();\n    args.unshift(lastArg);\n    return _.defaults.apply(_, args);\n}\n\n//==============================================================================\n/** A mixin for models that allow T/F/Matching to their attributes - useful when\n *      searching or filtering collections of models.\n * @example:\n *      see hda-model for searchAttribute and searchAliases definition examples.\n *      see history-contents.matches for how collections are filtered\n *      and see readonly-history-view.searchHdas for how user input is connected to the filtering\n */\nvar SearchableModelMixin = {\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes: [\n        // override\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases: {\n        // override\n    },\n\n    /** search the attribute with key attrKey for the string searchFor; T/F if found */\n    searchAttribute: function(attrKey, searchFor) {\n        var attrVal = this.get(attrKey);\n        //this.debug( 'searchAttribute', attrKey, attrVal, searchFor );\n        // bail if empty searchFor or unsearchable values\n        if (!searchFor || (attrVal === undefined || attrVal === null)) {\n            return false;\n        }\n        // pass to sep. fn for deep search of array attributes\n        if (_.isArray(attrVal)) {\n            return this._searchArrayAttribute(attrVal, searchFor);\n        }\n        return (\n            attrVal\n                .toString()\n                .toLowerCase()\n                .indexOf(searchFor.toLowerCase()) !== -1\n        );\n    },\n\n    /** deep(er) search for array attributes; T/F if found */\n    _searchArrayAttribute: function(array, searchFor) {\n        //this.debug( '_searchArrayAttribute', array, searchFor );\n        searchFor = searchFor.toLowerCase();\n        //precondition: searchFor has already been validated as non-empty string\n        //precondition: assumes only 1 level array\n        //TODO: could possibly break up searchFor more (CSV...)\n        return _.any(\n            array,\n            elem =>\n                elem\n                    .toString()\n                    .toLowerCase()\n                    .indexOf(searchFor.toLowerCase()) !== -1\n        );\n    },\n\n    /** search all searchAttributes for the string searchFor,\n     *      returning a list of keys of attributes that contain searchFor\n     */\n    search: function(searchFor) {\n        var model = this;\n        return _.filter(this.searchAttributes, key => model.searchAttribute(key, searchFor));\n    },\n\n    /** alias of search, but returns a boolean; accepts attribute specifiers where\n     *      the attributes searched can be narrowed to a single attribute using\n     *      the form: matches( 'genome_build=hg19' )\n     *      (the attribute keys allowed can also be aliases to the true attribute key;\n     *          see searchAliases above)\n     *  @param {String} term   plain text or ATTR_SPECIFIER sep. key=val pair\n     *  @returns {Boolean} was term found in (any) attribute(s)\n     */\n    matches: function(term) {\n        var ATTR_SPECIFIER = \"=\";\n        var split = term.split(ATTR_SPECIFIER);\n        // attribute is specified - search only that\n        if (split.length >= 2) {\n            var attrKey = split[0];\n            attrKey = this.searchAliases[attrKey] || attrKey;\n            return this.searchAttribute(attrKey, split[1]);\n        }\n        // no attribute is specified - search all attributes in searchAttributes\n        return !!this.search(term).length;\n    },\n\n    /** an implicit AND search for all terms; IOW, a model must match all terms given\n     *      where terms is a whitespace separated value string.\n     *      e.g. given terms of: 'blah bler database=hg19'\n     *          an HDA would have to have attributes containing blah AND bler AND a genome_build == hg19\n     *      To include whitespace in terms: wrap the term in double quotations (name=\"blah bler\").\n     */\n    matchesAll: function(terms) {\n        var model = this;\n        // break the terms up by whitespace and filter out the empty strings\n        terms = terms.match(/(\".*\"|\\w*=\".*\"|\\S*)/g).filter(s => !!s);\n        return _.all(terms, term => {\n            term = term.replace(/\"/g, \"\");\n            return model.matches(term);\n        });\n    }\n};\n\n//==============================================================================\n/** A view that renders hidden and shows when some activator is clicked.\n *      options:\n *          showFn: the effect used to show/hide the View (defaults to jq.toggle)\n *          $elementShown: some jqObject (defaults to this.$el) to be shown/hidden\n *          onShowFirstTime: fn called the first time the view is shown\n *          onshow: fn called every time the view is shown\n *          onhide: fn called every time the view is hidden\n *      events:\n *          hiddenUntilActivated:shown (the view is passed as an arg)\n *          hiddenUntilActivated:hidden (the view is passed as an arg)\n *      instance vars:\n *          view.hidden {boolean} is the view in the hidden state\n */\nvar HiddenUntilActivatedViewMixin = /** @lends hiddenUntilActivatedMixin# */ {\n    //TODO: since this is a mixin, consider moving toggle, hidden into HUAVOptions\n\n    /** call this in your initialize to set up the mixin\n     *  @param {jQuery} $activator the 'button' that's clicked to show/hide the view\n     *  @param {Object} hash with mixin options\n     */\n    hiddenUntilActivated: function($activator, options) {\n        // call this in your view's initialize fn\n        options = options || {};\n        //TODO: flesh out options - show them all here\n        this.HUAVOptions = {\n            $elementShown: this.$el,\n            showFn: jQuery.prototype.toggle,\n            showSpeed: \"fast\"\n        };\n        _.extend(this.HUAVOptions, options || {});\n        /** has this been shown already (and onshowFirstTime called)? */\n        this.HUAVOptions.hasBeenShown = this.HUAVOptions.$elementShown.is(\":visible\");\n        this.hidden = this.isHidden();\n\n        if ($activator) {\n            var mixin = this;\n            $activator.on(\"click\", ev => {\n                mixin.toggle(mixin.HUAVOptions.showSpeed);\n            });\n        }\n    },\n\n    //TODO:?? remove? use .hidden?\n    /** returns T/F if the view is hidden */\n    isHidden: function() {\n        return this.HUAVOptions.$elementShown.is(\":hidden\");\n    },\n\n    /** toggle the hidden state, show/hide $elementShown, call onshow/hide, trigger events */\n    toggle: function() {\n        //TODO: more specific name - toggle is too general\n        // can be called manually as well with normal toggle arguments\n        //TODO: better as a callback (when the show/hide is actually done)\n        // show\n        if (this.hidden) {\n            // fire the optional fns on the first/each showing - good for render()\n            if (!this.HUAVOptions.hasBeenShown) {\n                if (_.isFunction(this.HUAVOptions.onshowFirstTime)) {\n                    this.HUAVOptions.hasBeenShown = true;\n                    this.HUAVOptions.onshowFirstTime.call(this);\n                }\n            }\n            if (_.isFunction(this.HUAVOptions.onshow)) {\n                this.HUAVOptions.onshow.call(this);\n                this.trigger(\"hiddenUntilActivated:shown\", this);\n            }\n            this.hidden = false;\n\n            // hide\n        } else {\n            if (_.isFunction(this.HUAVOptions.onhide)) {\n                this.HUAVOptions.onhide.call(this);\n                this.trigger(\"hiddenUntilActivated:hidden\", this);\n            }\n            this.hidden = true;\n        }\n        return this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown, arguments);\n    }\n};\n\n//==============================================================================\n/** Mixin for views that can be dragged and dropped\n *      Allows for the drag behavior to be turned on/off, setting/removing jQuery event\n *          handlers each time.\n *      dataTransfer data is set to the JSON string of the view's model.toJSON\n *      Override '$dragHandle' to define the draggable DOM sub-element.\n */\nvar DraggableViewMixin = {\n    /** set up instance vars to track whether this view is currently draggable */\n    initialize: function(attributes) {\n        /** is the body of this hda view expanded/not? */\n        this.draggable = attributes.draggable || false;\n    },\n\n    /** what part of the view's DOM triggers the dragging */\n    $dragHandle: function() {\n        //TODO: make abstract/general - move this to listItem\n        // override to the element you want to be your view's handle\n        return this.$(\".title-bar\");\n    },\n\n    /** toggle whether this view is draggable */\n    toggleDraggable: function() {\n        if (this.draggable) {\n            this.draggableOff();\n        } else {\n            this.draggableOn();\n        }\n    },\n\n    /** allow the view to be dragged, set up event handlers */\n    draggableOn: function() {\n        this.draggable = true;\n        this.dragStartHandler = _.bind(this._dragStartHandler, this);\n        this.dragEndHandler = _.bind(this._dragEndHandler, this);\n\n        var handle = this.$dragHandle()\n            .attr(\"draggable\", true)\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** turn of view dragging and remove event listeners */\n    draggableOff: function() {\n        this.draggable = false;\n        var handle = this.$dragHandle()\n            .attr(\"draggable\", false)\n            .get(0);\n        handle.removeEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.removeEventListener(\"dragend\", this.dragEndHandler, false);\n    },\n\n    /** sets the dataTransfer data to the model's toJSON\n     *  @fires draggable:dragstart (bbone event) which is passed the event and this view\n     */\n    _dragStartHandler: function(event) {\n        event.dataTransfer.effectAllowed = \"move\";\n        //ASSUMES: this.model\n        //TODO: all except IE: should be 'application/json', IE: must be 'text'\n        event.dataTransfer.setData(\"text\", JSON.stringify(this.model.toJSON()));\n        this.trigger(\"draggable:dragstart\", event, this);\n        return false;\n    },\n\n    /** handle the dragend\n     *  @fires draggable:dragend (bbone event) which is passed the event and this view\n     */\n    _dragEndHandler: function(event) {\n        this.trigger(\"draggable:dragend\", event, this);\n        return false;\n    }\n};\n\n//==============================================================================\n/** Mixin that allows a view to be selected (gen. from a list).\n *      Selection controls ($selector) may be hidden/shown/toggled.\n *          The bbone event 'selectable' is fired when the controls are shown/hidden (passed T/F).\n *      Default rendering is a font-awesome checkbox.\n *      Default selector is '.selector' within the view's $el.\n *      The bbone events 'selected' and 'de-selected' are fired when the $selector is clicked.\n *          Both events are passed the view and the (jQuery) event.\n */\nvar SelectableViewMixin = {\n    /** Set up instance state vars for whether the selector is shown and whether the view has been selected */\n    initialize: function(attributes) {\n        /** is the view currently in selection mode? */\n        this.selectable = attributes.selectable || false;\n        /** is the view currently selected? */\n        this.selected = attributes.selected || false;\n    },\n\n    /** $el sub-element where the selector is rendered and what can be clicked to select. */\n    $selector: function() {\n        return this.$(\".selector\");\n    },\n\n    /** How the selector is rendered - defaults to font-awesome checkbox */\n    _renderSelected: function() {\n        // override\n        this.$selector()\n            .find(\"span\")\n            .toggleClass(\"fa-check-square-o\", this.selected)\n            .toggleClass(\"fa-square-o\", !this.selected);\n    },\n\n    /** Toggle whether the selector is shown */\n    toggleSelector: function() {\n        //TODO: use this.selectable\n        if (!this.$selector().is(\":visible\")) {\n            this.showSelector();\n        } else {\n            this.hideSelector();\n        }\n    },\n\n    /** Display the selector control.\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed true (IOW, the selector is shown) and the view\n     */\n    showSelector: function(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // make sure selected state is represented properly\n        this.selectable = true;\n        this.trigger(\"selectable\", true, this);\n        this._renderSelected();\n        if (speed) {\n            this.$selector().show(speed);\n        } else {\n            this.$selector().show();\n        }\n    },\n\n    /** remove the selector control\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed false (IOW, the selector is not shown) and the view\n     */\n    hideSelector: function(speed) {\n        speed = speed !== undefined ? speed : this.fxSpeed;\n        // reverse the process from showSelect\n        this.selectable = false;\n        this.trigger(\"selectable\", false, this);\n        if (speed) {\n            this.$selector().hide(speed);\n        } else {\n            this.$selector().hide();\n        }\n    },\n\n    /** Toggle whether the view is selected */\n    toggleSelect: function(event) {\n        if (this.selected) {\n            this.deselect(event);\n        } else {\n            this.select(event);\n        }\n    },\n\n    /** Select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    select: function(event) {\n        // switch icon, set selected, and trigger event\n        if (!this.selected) {\n            this.trigger(\"selected\", this, event);\n            this.selected = true;\n            this._renderSelected();\n        }\n        return false;\n    },\n\n    /** De-select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: de-selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    deselect: function(event) {\n        // switch icon, set selected, and trigger event\n        if (this.selected) {\n            this.trigger(\"de-selected\", this, event);\n            this.selected = false;\n            this._renderSelected();\n        }\n        return false;\n    }\n};\n\n//==============================================================================\n/** Return an underscore template fn from an array of strings.\n *  @param {String[]} template      the template strings to compile into the underscore template fn\n *  @param {String} jsonNamespace   an optional namespace for the json data passed in (defaults to 'model')\n *  @returns {Function} the (wrapped) underscore template fn\n *      The function accepts:\n *\n *  The template strings can access:\n *      the json/model hash using model (\"<%- model.myAttr %>) using the jsonNamespace above\n *      _l: the localizer function\n *      view (if passed): ostensibly, the view using the template (handy for view instance vars)\n *      Because they're namespaced, undefined attributes will not throw an error.\n *\n *  @example:\n *      templateBler : BASE_MVC.wrapTemplate([\n *          '<div class=\"myclass <%- mynamespace.modelClass %>\">',\n *              '<span><% print( _l( mynamespace.message ) ); %>:<%= view.status %></span>'\n *          '</div>'\n *      ], 'mynamespace' )\n *\n *  Meant to be called in a View's definition in order to compile only once.\n *\n */\nfunction wrapTemplate(template, jsonNamespace) {\n    jsonNamespace = jsonNamespace || \"model\";\n    var templateFn = _.template(template.join(\"\"));\n    return (json, view) => {\n        var templateVars = { view: view || {}, _l: _l };\n        templateVars[jsonNamespace] = json || {};\n        return templateFn(templateVars);\n    };\n}\n\n//==============================================================================\n/** Return a comparator function for sorted Collections */\nfunction buildComparator(attribute_name, options) {\n    options = options || {};\n    var ascending = options.ascending ? 1 : -1;\n    return function __comparator(a, b) {\n        a = a.get(attribute_name);\n        b = b.get(attribute_name);\n        return (a < b ? -1 : a > b ? 1 : 0) * ascending;\n    };\n}\n\n//==============================================================================\nexport default {\n    LoggableMixin: LoggableMixin,\n    SessionStorageModel: SessionStorageModel,\n    mixin: mixin,\n    SearchableModelMixin: SearchableModelMixin,\n    HiddenUntilActivatedViewMixin: HiddenUntilActivatedViewMixin,\n    DraggableViewMixin: DraggableViewMixin,\n    SelectableViewMixin: SelectableViewMixin,\n    wrapTemplate: wrapTemplate,\n    buildComparator: buildComparator\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/base-mvc.js","import * as _ from \"libs/underscore\";\nimport data_mod from \"mvc/dataset/data\";\nimport util_mod from \"viz/trackster/util\";\nimport config_mod from \"utils/config\";\nimport GridView from \"mvc/grid/grid-view\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\n/**\n * Mixin for returning custom JSON representation from toJSON. Class attribute to_json_keys defines a set of attributes\n * to include in the representation; to_json_mappers defines mappers for returned objects.\n */\nvar CustomToJSON = {\n    /**\n     * Returns JSON representation of object using to_json_keys and to_json_mappers.\n     */\n    toJSON: function() {\n        var self = this;\n        var json = {};\n        _.each(self.constructor.to_json_keys, k => {\n            var val = self.get(k);\n            if (k in self.constructor.to_json_mappers) {\n                val = self.constructor.to_json_mappers[k](val, self);\n            }\n            json[k] = val;\n        });\n        return json;\n    }\n};\n\n/**\n * Model, view, and controller objects for Galaxy visualization framework.\n *\n * Models have no references to views, instead using events to indicate state\n * changes; this is advantageous because multiple views can use the same object\n * and models can be used without views.\n */\n\n/**\n * Use a popup grid to select datasets from histories or libraries. After datasets are selected,\n * track definitions are obtained from the server and the success_fn is called with the list of\n * definitions for selected datasets.\n */\nvar select_datasets = (filters, success_fn) => {\n    // history dataset selection tab\n    var history_grid = new GridView({\n        url_base: `${Galaxy.root}visualization/list_history_datasets`,\n        filters: filters,\n        dict_format: true,\n        embedded: true\n    });\n\n    // library dataset selection tab\n    var library_grid = new GridView({\n        url_base: `${Galaxy.root}visualization/list_library_datasets`,\n        dict_format: true,\n        embedded: true\n    });\n\n    // build tabs\n    var tabs = new Tabs.View();\n    tabs.add({\n        id: \"histories\",\n        title: \"Histories\",\n        $el: $(\"<div/>\").append(history_grid.$el)\n    });\n    tabs.add({\n        id: \"libraries\",\n        title: \"Libraries\",\n        $el: $(\"<div/>\").append(library_grid.$el)\n    });\n\n    // modal\n    Galaxy.modal.show({\n        title: \"Select datasets for new tracks\",\n        body: tabs.$el,\n        closing_events: true,\n        buttons: {\n            Cancel: function() {\n                Galaxy.modal.hide();\n            },\n            Add: function() {\n                var requests = [];\n                tabs.$(\"input.grid-row-select-checkbox[name=id]:checked\").each(function() {\n                    window.console.log($(this).val());\n                    requests[requests.length] = $.ajax({\n                        url: `${Galaxy.root}api/datasets/${$(this).val()}`,\n                        dataType: \"json\",\n                        data: {\n                            data_type: \"track_config\",\n                            hda_ldda: tabs.current() == \"histories\" ? \"hda\" : \"ldda\"\n                        }\n                    });\n                });\n                // To preserve order, wait until there are definitions for all tracks and then add\n                // them sequentially.\n                $.when.apply($, requests).then(function() {\n                    // jQuery always returns an Array for arguments, so need to look at first element\n                    // to determine whether multiple requests were made and consequently how to\n                    // map arguments to track definitions.\n                    var track_defs = arguments[0] instanceof Array ? $.map(arguments, arg => arg[0]) : [arguments[0]];\n                    success_fn(track_defs);\n                });\n                Galaxy.modal.hide();\n            }\n        }\n    });\n};\n\n// --------- Models ---------\n\n/**\n * Canvas manager is used to create canvases for browsers as well as providing a pattern cache\n */\nvar CanvasManager = function(default_font) {\n    this.default_font = default_font !== undefined ? default_font : \"9px Monaco, Lucida Console, monospace\";\n\n    this.dummy_canvas = this.new_canvas();\n    this.dummy_context = this.dummy_canvas.getContext(\"2d\");\n    this.dummy_context.font = this.default_font;\n\n    this.char_width_px = this.dummy_context.measureText(\"A\").width;\n\n    this.patterns = {};\n\n    // FIXME: move somewhere to make this more general\n    this.load_pattern(\"right_strand\", \"/visualization/strand_right.png\");\n    this.load_pattern(\"left_strand\", \"/visualization/strand_left.png\");\n    this.load_pattern(\"right_strand_inv\", \"/visualization/strand_right_inv.png\");\n    this.load_pattern(\"left_strand_inv\", \"/visualization/strand_left_inv.png\");\n};\n\n_.extend(CanvasManager.prototype, {\n    load_pattern: function(key, path) {\n        var patterns = this.patterns;\n        var dummy_context = this.dummy_context;\n        var image = new Image();\n        image.src = `${Galaxy.root}static/images${path}`;\n        image.onload = () => {\n            patterns[key] = dummy_context.createPattern(image, \"repeat\");\n        };\n    },\n    get_pattern: function(key) {\n        return this.patterns[key];\n    },\n    new_canvas: function() {\n        var canvas = $(\"<canvas/>\")[0];\n        // Keep a reference back to the manager\n        canvas.manager = this;\n        return canvas;\n    }\n});\n\n/**\n * Generic cache that handles key/value pairs. Keys can be any object that can be\n * converted to a String and compared.\n */\nvar Cache = Backbone.Model.extend({\n    defaults: {\n        num_elements: 20,\n        // Objects in cache; indexes into cache are strings of keys.\n        obj_cache: null,\n        // key_ary contains keys for objects in cache.\n        key_ary: null\n    },\n\n    initialize: function(options) {\n        this.clear();\n    },\n\n    /**\n     * Get an element from the cache using its key.\n     */\n    get_elt: function(key) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n\n        var index = _.indexOf(key_ary, k => k.toString() === key_str);\n\n        // Update cache.\n        if (index !== -1) {\n            // Object is in cache, so update it.\n            if (obj_cache[key_str].stale) {\n                // Object is stale: remove key and object.\n                key_ary.splice(index, 1);\n                delete obj_cache[key_str];\n            } else {\n                // Move key to back because it is most recently used.\n                this.move_key_to_end(key, index);\n            }\n        }\n\n        return obj_cache[key_str];\n    },\n\n    /**\n     * Put an element into the cache.\n     */\n    set_elt: function(key, value) {\n        var obj_cache = this.attributes.obj_cache;\n        var key_ary = this.attributes.key_ary;\n        var key_str = key.toString();\n        var num_elements = this.attributes.num_elements;\n\n        // Update keys, objects.\n        if (!obj_cache[key_str]) {\n            // Add object to cache.\n\n            if (key_ary.length >= num_elements) {\n                // Cache full, so remove first element.\n                var deleted_key = key_ary.shift();\n                delete obj_cache[deleted_key.toString()];\n            }\n\n            // Add key.\n            key_ary.push(key);\n        }\n\n        // Add object.\n        obj_cache[key_str] = value;\n        return value;\n    },\n\n    /**\n     * Move key to end of cache. Keys are removed from the front, so moving a key to the end\n     * delays the key's removal.\n     */\n    move_key_to_end: function(key, index) {\n        this.attributes.key_ary.splice(index, 1);\n        this.attributes.key_ary.push(key);\n    },\n\n    /**\n     * Clear all elements from the cache.\n     */\n    clear: function() {\n        this.attributes.obj_cache = {};\n        this.attributes.key_ary = [];\n    },\n\n    /** Returns the number of elements in the cache. */\n    size: function() {\n        return this.attributes.key_ary.length;\n    },\n\n    /** Returns key most recently added to cache. */\n    most_recently_added: function() {\n        return this.size() === 0\n            ? null\n            : // Most recent key is at the end of key array.\n              this.attributes.key_ary[this.attributes.key_ary.length - 1];\n    }\n});\n\n/**\n * Data manager for genomic data. Data is connected to and queryable by genomic regions.\n */\nvar GenomeDataManager = Cache.extend({\n    defaults: _.extend({}, Cache.prototype.defaults, {\n        dataset: null,\n        genome: null,\n        init_data: null,\n        min_region_size: 200,\n        filters_manager: null,\n        data_type: \"data\",\n        data_mode_compatible: function(entry, mode) {\n            return true;\n        },\n        can_subset: function(entry) {\n            return false;\n        }\n    }),\n\n    /**\n     * Initialization.\n     */\n    initialize: function(options) {\n        Cache.prototype.initialize.call(this);\n\n        // Set initial entries in data manager.\n        var initial_entries = this.get(\"init_data\");\n        if (initial_entries) {\n            this.add_data(initial_entries);\n        }\n    },\n\n    /**\n     * Add data entries to manager; each entry should be a dict with attributes region (key), data, and data_type.\n     * If necessary, manager size is increased to hold all data.\n     */\n    add_data: function(entries) {\n        // Increase size to accomodate all entries.\n        if (this.get(\"num_elements\") < entries.length) {\n            this.set(\"num_elements\", entries.length);\n        }\n\n        // Put data into manager.\n        var self = this;\n        _.each(entries, entry => {\n            self.set_data(entry.region, entry);\n        });\n    },\n\n    /**\n     * Returns deferred that resolves to true when dataset is ready (or false if dataset\n     * cannot be used).\n     */\n    data_is_ready: function() {\n        var dataset = this.get(\"dataset\");\n        var ready_deferred = $.Deferred();\n\n        var // If requesting raw data, query dataset state; if requesting (converted) data,\n        // need to query converted datasets state.\n        query_type =\n            this.get(\"data_type\") === \"raw_data\"\n                ? \"state\"\n                : this.get(\"data_type\") === \"data\" ? \"converted_datasets_state\" : \"error\";\n\n        var ss_deferred = new util_mod.ServerStateDeferred({\n            ajax_settings: {\n                url: this.get(\"dataset\").url(),\n                data: {\n                    hda_ldda: dataset.get(\"hda_ldda\"),\n                    data_type: query_type\n                },\n                dataType: \"json\"\n            },\n            interval: 5000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        $.when(ss_deferred.go()).then(response => {\n            ready_deferred.resolve(response === \"ok\" || response === \"data\");\n        });\n        return ready_deferred;\n    },\n\n    /**\n     * Perform a feature search from server; returns Deferred object that resolves when data is available.\n     */\n    search_features: function(query) {\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            query: query,\n            hda_ldda: dataset.get(\"hda_ldda\"),\n            data_type: \"features\"\n        };\n\n        return $.getJSON(dataset.url(), params);\n    },\n\n    /**\n     * Load data from server and manages data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function(region, mode, resolution, extra_params) {\n        // Setup data request params.\n        var dataset = this.get(\"dataset\");\n\n        var params = {\n            data_type: this.get(\"data_type\"),\n            chrom: region.get(\"chrom\"),\n            low: region.get(\"start\"),\n            high: region.get(\"end\"),\n            mode: mode,\n            resolution: resolution,\n            hda_ldda: dataset.get(\"hda_ldda\")\n        };\n\n        $.extend(params, extra_params);\n\n        // Add track filters to params.\n        var filters_manager = this.get(\"filters_manager\");\n        if (filters_manager) {\n            var filter_names = [];\n            var filters = filters_manager.filters;\n            for (var i = 0; i < filters.length; i++) {\n                filter_names.push(filters[i].name);\n            }\n            params.filter_cols = JSON.stringify(filter_names);\n        }\n\n        // Do request.\n        var manager = this;\n\n        var entry = $.getJSON(dataset.url(), params, result => {\n            // Add region to the result.\n            result.region = region;\n            manager.set_data(region, result);\n        });\n\n        this.set_data(region, entry);\n        return entry;\n    },\n\n    /**\n     * Get data from dataset.\n     */\n    get_data: function(region, mode, resolution, extra_params) {\n        // Look for entry and return if it's a deferred or if data available is compatible with mode.\n        var entry = this.get_elt(region);\n        if (entry && (util_mod.is_deferred(entry) || this.get(\"data_mode_compatible\")(entry, mode))) {\n            return entry;\n        }\n\n        //\n        // Look in cache for data that can be used.\n        // TODO: this logic could be improved if the visualization knew whether\n        // the data was \"index\" or \"data.\"\n        //\n        var key_ary = this.get(\"key_ary\");\n\n        var obj_cache = this.get(\"obj_cache\");\n        var entry_region;\n        var is_subregion;\n        for (var i = 0; i < key_ary.length; i++) {\n            entry_region = key_ary[i];\n\n            if (entry_region.contains(region)) {\n                is_subregion = true;\n\n                // This entry has data in the requested range. Return if data\n                // is compatible and can be subsetted.\n                entry = obj_cache[entry_region.toString()];\n                if (\n                    util_mod.is_deferred(entry) ||\n                    (this.get(\"data_mode_compatible\")(entry, mode) && this.get(\"can_subset\")(entry))\n                ) {\n                    this.move_key_to_end(entry_region, i);\n\n                    // If there's data, subset it.\n                    if (!util_mod.is_deferred(entry)) {\n                        var subset_entry = this.subset_entry(entry, region);\n                        this.set_data(region, subset_entry);\n                        entry = subset_entry;\n                    }\n\n                    return entry;\n                }\n            }\n        }\n\n        // FIXME: There _may_ be instances where region is a subregion of another entry but cannot be\n        // subsetted. For these cases, do not increase length because region will never be found (and\n        // an infinite loop will occur.)\n        // If needed, extend region to make it minimum size.\n        if (!is_subregion && region.length() < this.attributes.min_region_size) {\n            // IDEA: alternative heuristic is to find adjacent cache entry to region and use that to extend.\n            // This would prevent bad extensions when zooming in/out while still preserving the behavior\n            // below.\n\n            // Use copy of region to avoid changing actual region.\n            region = region.copy();\n\n            // Use heuristic to extend region: extend relative to last data request.\n            var last_request = this.most_recently_added();\n            if (!last_request || region.get(\"start\") > last_request.get(\"start\")) {\n                // This request is after the last request, so extend right.\n                region.set(\"end\", region.get(\"start\") + this.attributes.min_region_size);\n            } else {\n                // This request is after the last request, so extend left.\n                region.set(\"start\", region.get(\"end\") - this.attributes.min_region_size);\n            }\n\n            // Trim region to avoid invalid coordinates.\n            region.set(\"genome\", this.attributes.genome);\n            region.trim();\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Alias for set_elt for readbility.\n     */\n    set_data: function(region, entry) {\n        this.set_elt(region, entry);\n    },\n\n    /** \"Deep\" data request; used as a parameter for DataManager.get_more_data() */\n    DEEP_DATA_REQ: \"deep\",\n\n    /** \"Broad\" data request; used as a parameter for DataManager.get_more_data() */\n    BROAD_DATA_REQ: \"breadth\",\n\n    /**\n     * Gets more data for a region using either a depth-first or a breadth-first approach.\n     */\n    get_more_data: function(region, mode, resolution, extra_params, req_type) {\n        var cur_data = this._mark_stale(region);\n        if (!(cur_data && this.get(\"data_mode_compatible\")(cur_data, mode))) {\n            console.log(\"ERROR: problem with getting more data: current data is not compatible\");\n            return;\n        }\n\n        //\n        // Set parameters based on request type.\n        //\n        var query_low = region.get(\"start\");\n        if (req_type === this.DEEP_DATA_REQ) {\n            // Use same interval but set start_val to skip data that's already in cur_data.\n            $.extend(extra_params, {\n                start_val: cur_data.data.length + 1\n            });\n        } else if (req_type === this.BROAD_DATA_REQ) {\n            // To get past an area of extreme feature depth, set query low to be after either\n            // (a) the maximum high or HACK/FIXME (b) the end of the last feature returned.\n            query_low = (cur_data.max_high ? cur_data.max_high : cur_data.data[cur_data.data.length - 1][2]) + 1;\n        }\n        var query_region = region.copy().set(\"start\", query_low);\n\n        //\n        // Get additional data, append to current data, and set new data. Use a custom deferred object\n        // to signal when new data is available.\n        //\n        var data_manager = this;\n\n        var new_data_request = this.load_data(query_region, mode, resolution, extra_params);\n\n        var new_data_available = $.Deferred();\n        // load_data sets cache to new_data_request, but use custom deferred object so that signal and data\n        // is all data, not just new data.\n        this.set_data(region, new_data_available);\n        $.when(new_data_request).then(result => {\n            // Update data and message.\n            if (result.data) {\n                result.data = cur_data.data.concat(result.data);\n                if (result.max_low) {\n                    result.max_low = cur_data.max_low;\n                }\n                if (result.message) {\n                    // HACK: replace number in message with current data length. Works but is ugly.\n                    result.message = result.message.replace(/[0-9]+/, result.data.length);\n                }\n            }\n            data_manager.set_data(region, result);\n            new_data_available.resolve(result);\n        });\n        return new_data_available;\n    },\n\n    /**\n     * Returns true if more detailed data can be obtained for entry.\n     */\n    can_get_more_detailed_data: function(region) {\n        var cur_data = this.get_elt(region);\n\n        // Can only get more detailed data for bigwig data that has less than 8000 data points.\n        // Summary tree returns *way* too much data, and 8000 data points ~ 500KB.\n        return cur_data.dataset_type === \"bigwig\" && cur_data.data.length < 8000;\n    },\n\n    /**\n     * Returns more detailed data for an entry.\n     */\n    get_more_detailed_data: function(region, mode, resolution, detail_multiplier, extra_params) {\n        // Mark current entry as stale.\n        var cur_data = this._mark_stale(region);\n        if (!cur_data) {\n            console.log(\"ERROR getting more detailed data: no current data\");\n            return;\n        }\n\n        if (!extra_params) {\n            extra_params = {};\n        }\n\n        // Use additional parameters to get more detailed data.\n        if (cur_data.dataset_type === \"bigwig\") {\n            // FIXME: constant should go somewhere.\n            extra_params.num_samples = 1000 * detail_multiplier;\n        }\n\n        return this.load_data(region, mode, resolution, extra_params);\n    },\n\n    /**\n     * Marks cache data as stale.\n     */\n    _mark_stale: function(region) {\n        var entry = this.get_elt(region);\n        if (!entry) {\n            console.log(\"ERROR: no data to mark as stale: \", this.get(\"dataset\"), region.toString());\n        }\n        entry.stale = true;\n        return entry;\n    },\n\n    /**\n     * Returns an array of data with each entry representing one chromosome/contig\n     * of data or, if data is not available, returns a Deferred that resolves to the\n     * data when it becomes available.\n     */\n    get_genome_wide_data: function(genome) {\n        // -- Get all data. --\n\n        var self = this;\n\n        var all_data_available = true;\n\n        var //  Map chromosome info into genome data.\n        gw_data = _.map(genome.get(\"chroms_info\").chrom_info, chrom_info => {\n            var chrom_data = self.get_elt(\n                new GenomeRegion({\n                    chrom: chrom_info.chrom,\n                    start: 0,\n                    end: chrom_info.len\n                })\n            );\n\n            // Set flag if data is not available.\n            if (!chrom_data) {\n                all_data_available = false;\n            }\n\n            return chrom_data;\n        });\n\n        // -- If all data is available, return it. --\n        if (all_data_available) {\n            return gw_data;\n        }\n\n        // -- All data is not available, so load from server. --\n\n        var deferred = $.Deferred();\n        $.getJSON(this.get(\"dataset\").url(), { data_type: \"genome_data\" }, genome_wide_data => {\n            self.add_data(genome_wide_data.data);\n            deferred.resolve(genome_wide_data.data);\n        });\n\n        return deferred;\n    },\n\n    /**\n     * Returns entry with only data in the subregion.\n     */\n    subset_entry: function(entry, subregion) {\n        // Dictionary from entry type to function for subsetting data.\n        var subset_fns = {\n            bigwig: function(data, subregion) {\n                return _.filter(\n                    data,\n                    data_point => data_point[0] >= subregion.get(\"start\") && data_point[0] <= subregion.get(\"end\")\n                );\n            },\n            refseq: function(data, subregion) {\n                var seq_start = subregion.get(\"start\") - entry.region.get(\"start\");\n                return entry.data.slice(seq_start, seq_start + subregion.length());\n            }\n        };\n\n        // Subset entry if there is a function for subsetting and regions are not the same.\n        var subregion_data = entry.data;\n        if (!entry.region.same(subregion) && entry.dataset_type in subset_fns) {\n            subregion_data = subset_fns[entry.dataset_type](entry.data, subregion);\n        }\n\n        // Return entry with subregion's data.\n        return {\n            region: subregion,\n            data: subregion_data,\n            dataset_type: entry.dataset_type\n        };\n    }\n});\n\nvar GenomeReferenceDataManager = GenomeDataManager.extend({\n    initialize: function(options) {\n        // Use generic object in place of dataset and set urlRoot to fetch data.\n        var dataset_placeholder = new Backbone.Model();\n        dataset_placeholder.urlRoot = options.data_url;\n        this.set(\"dataset\", dataset_placeholder);\n    },\n\n    load_data: function(region, mode, resolution, extra_params) {\n        // Fetch data if region is not too large.\n        return region.length() <= 100000\n            ? GenomeDataManager.prototype.load_data.call(this, region, mode, resolution, extra_params)\n            : { data: null, region: region };\n    }\n});\n\n/**\n * A genome build.\n */\nvar Genome = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        key: null,\n        chroms_info: null\n    },\n\n    initialize: function(options) {\n        this.id = options.dbkey;\n    },\n\n    /**\n     * Shorthand for getting to chromosome information.\n     */\n    get_chroms_info: function() {\n        return this.attributes.chroms_info.chrom_info;\n    },\n\n    /**\n     * Returns a GenomeRegion object denoting a complete chromosome.\n     */\n    get_chrom_region: function(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        var chrom_info = _.find(this.get_chroms_info(), chrom_info => chrom_info.chrom === chr_name);\n        return new GenomeRegion({\n            chrom: chrom_info.chrom,\n            end: chrom_info.len\n        });\n    },\n\n    /** Returns the length of a chromosome. */\n    get_chrom_len: function(chr_name) {\n        // FIXME: use findWhere in underscore 1.4\n        return _.find(this.get_chroms_info(), chrom_info => chrom_info.chrom === chr_name).len;\n    }\n});\n\n/**\n * A genomic region.\n */\nvar GenomeRegion = Backbone.Model.extend(\n    {\n        defaults: {\n            chrom: null,\n            start: 0,\n            end: 0,\n            str_val: null,\n            genome: null\n        },\n\n        /**\n         * Returns true if this region is the same as a given region.\n         * It does not test the genome right now.\n         */\n        same: function(region) {\n            return (\n                this.attributes.chrom === region.get(\"chrom\") &&\n                this.attributes.start === region.get(\"start\") &&\n                this.attributes.end === region.get(\"end\")\n            );\n        },\n\n        /**\n         * If from_str specified, use it to initialize attributes.\n         */\n        initialize: function(options) {\n            if (options.from_str) {\n                var pieces = options.from_str.split(\":\");\n                var chrom = pieces[0];\n                var start_end = pieces[1].split(\"-\");\n                this.set({\n                    chrom: chrom,\n                    start: parseInt(start_end[0], 10),\n                    end: parseInt(start_end[1], 10)\n                });\n            }\n\n            // Keep a copy of region's string value for fast lookup.\n            this.attributes.str_val = `${this.get(\"chrom\")}:${this.get(\"start\")}-${this.get(\"end\")}`;\n\n            // Set str_val on attribute change.\n            this.on(\n                \"change\",\n                function() {\n                    this.attributes.str_val = `${this.get(\"chrom\")}:${this.get(\"start\")}-${this.get(\"end\")}`;\n                },\n                this\n            );\n        },\n\n        copy: function() {\n            return new GenomeRegion({\n                chrom: this.get(\"chrom\"),\n                start: this.get(\"start\"),\n                end: this.get(\"end\")\n            });\n        },\n\n        length: function() {\n            return this.get(\"end\") - this.get(\"start\");\n        },\n\n        /** Returns region in canonical form chrom:start-end */\n        toString: function() {\n            return this.attributes.str_val;\n        },\n\n        toJSON: function() {\n            return {\n                chrom: this.get(\"chrom\"),\n                start: this.get(\"start\"),\n                end: this.get(\"end\")\n            };\n        },\n\n        /**\n         * Compute the type of overlap between this region and another region. The overlap is computed relative to the given/second region;\n         * hence, OVERLAP_START indicates that the first region overlaps the start (but not the end) of the second region.\n         */\n        compute_overlap: function(a_region) {\n            var first_chrom = this.get(\"chrom\");\n            var second_chrom = a_region.get(\"chrom\");\n            var first_start = this.get(\"start\");\n            var second_start = a_region.get(\"start\");\n            var first_end = this.get(\"end\");\n            var second_end = a_region.get(\"end\");\n            var overlap;\n\n            // Compare chroms.\n            if (first_chrom && second_chrom && first_chrom !== second_chrom) {\n                return GenomeRegion.overlap_results.DIF_CHROMS;\n            }\n\n            // Compare regions.\n            if (first_start < second_start) {\n                if (first_end < second_start) {\n                    overlap = GenomeRegion.overlap_results.BEFORE;\n                } else if (first_end < second_end) {\n                    overlap = GenomeRegion.overlap_results.OVERLAP_START;\n                } else {\n                    // first_end >= second_end\n                    overlap = GenomeRegion.overlap_results.CONTAINS;\n                }\n            } else if (first_start > second_start) {\n                if (first_start > second_end) {\n                    overlap = GenomeRegion.overlap_results.AFTER;\n                } else if (first_end <= second_end) {\n                    overlap = GenomeRegion.overlap_results.CONTAINED_BY;\n                } else {\n                    overlap = GenomeRegion.overlap_results.OVERLAP_END;\n                }\n            } else {\n                // first_start === second_start\n                overlap =\n                    first_end >= second_end\n                        ? GenomeRegion.overlap_results.CONTAINS\n                        : GenomeRegion.overlap_results.CONTAINED_BY;\n            }\n\n            return overlap;\n        },\n\n        /**\n         * Trim a region to match genome's constraints.\n         */\n        trim: function(genome) {\n            // Assume that all chromosome/contigs start at 0.\n            if (this.attributes.start < 0) {\n                this.attributes.start = 0;\n            }\n\n            // Only try to trim the end if genome is set.\n            if (this.attributes.genome) {\n                var chrom_len = this.attributes.genome.get_chrom_len(this.attributes.chrom);\n                if (this.attributes.end > chrom_len) {\n                    this.attributes.end = chrom_len - 1;\n                }\n            }\n\n            return this;\n        },\n\n        /**\n         * Returns true if this region contains a given region.\n         */\n        contains: function(a_region) {\n            return this.compute_overlap(a_region) === GenomeRegion.overlap_results.CONTAINS;\n        },\n\n        /**\n         * Returns true if regions overlap.\n         */\n        overlaps: function(a_region) {\n            return (\n                _.intersection(\n                    [this.compute_overlap(a_region)],\n                    [\n                        GenomeRegion.overlap_results.DIF_CHROMS,\n                        GenomeRegion.overlap_results.BEFORE,\n                        GenomeRegion.overlap_results.AFTER\n                    ]\n                ).length === 0\n            );\n        }\n    },\n    {\n        overlap_results: {\n            DIF_CHROMS: 1000,\n            BEFORE: 1001,\n            CONTAINS: 1002,\n            OVERLAP_START: 1003,\n            OVERLAP_END: 1004,\n            CONTAINED_BY: 1005,\n            AFTER: 1006\n        }\n    }\n);\n\nvar GenomeRegionCollection = Backbone.Collection.extend({\n    model: GenomeRegion\n});\n\n/**\n * A genome browser bookmark.\n */\nvar BrowserBookmark = Backbone.Model.extend({\n    defaults: {\n        region: null,\n        note: \"\"\n    },\n\n    initialize: function(options) {\n        this.set(\"region\", new GenomeRegion(options.region));\n    }\n});\n\n/**\n * Bookmarks collection.\n */\nvar BrowserBookmarkCollection = Backbone.Collection.extend({\n    model: BrowserBookmark\n});\n\n/**\n * A track of data in a genome visualization.\n */\n// TODO: rename to Track and merge with Trackster's Track object.\nvar BackboneTrack = Backbone.Model.extend(CustomToJSON).extend(\n    {\n        defaults: {\n            mode: \"Auto\"\n        },\n\n        initialize: function(options) {\n            this.set(\"dataset\", new data_mod.Dataset(options.dataset));\n\n            // -- Set up config settings. --\n            var models = [\n                {\n                    key: \"name\",\n                    default_value: this.get(\"dataset\").get(\"name\")\n                },\n                { key: \"color\" },\n                {\n                    key: \"min_value\",\n                    label: \"Min Value\",\n                    type: \"float\",\n                    default_value: 0\n                },\n                {\n                    key: \"max_value\",\n                    label: \"Max Value\",\n                    type: \"float\",\n                    default_value: 1\n                }\n            ];\n\n            this.set(\"config\", config_mod.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n            // -- Set up data manager. --\n            var preloaded_data = this.get(\"preloaded_data\");\n            if (preloaded_data) {\n                preloaded_data = preloaded_data.data;\n            } else {\n                preloaded_data = [];\n            }\n            this.set(\n                \"data_manager\",\n                new GenomeDataManager({\n                    dataset: this.get(\"dataset\"),\n                    init_data: preloaded_data\n                })\n            );\n        }\n    },\n    {\n        // This definition matches that produced by to_dict() methods in tracks.js\n        to_json_keys: [\"track_type\", \"dataset\", \"prefs\", \"mode\", \"filters\", \"tool_state\"],\n        to_json_mappers: {\n            prefs: function(p, self) {\n                if (_.size(p) === 0) {\n                    p = {\n                        name: self\n                            .get(\"config\")\n                            .get(\"name\")\n                            .get(\"value\"),\n                        color: self\n                            .get(\"config\")\n                            .get(\"color\")\n                            .get(\"value\")\n                    };\n                }\n                return p;\n            },\n            dataset: function(d) {\n                return {\n                    id: d.id,\n                    hda_ldda: d.get(\"hda_ldda\")\n                };\n            }\n        }\n    }\n);\n\nvar BackboneTrackCollection = Backbone.Collection.extend({\n    model: BackboneTrack\n});\n\n/**\n * A visualization.\n */\nvar Visualization = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        type: \"\"\n    },\n\n    urlRoot: `${Galaxy.root}api/visualizations`,\n\n    /**\n     * POSTs visualization's JSON to its URL using the parameter 'vis_json'\n     * Note: This is necessary because (a) Galaxy requires keyword args and\n     * (b) Galaxy does not handle PUT now.\n     */\n    save: function() {\n        return $.ajax({\n            url: this.url(),\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                vis_json: JSON.stringify(this)\n            }\n        });\n    }\n});\n\n/**\n * A visualization of genome data.\n */\nvar GenomeVisualization = Visualization.extend(CustomToJSON).extend(\n    {\n        defaults: _.extend({}, Visualization.prototype.defaults, {\n            dbkey: \"\",\n            drawables: null,\n            bookmarks: null,\n            viewport: null\n        }),\n\n        initialize: function(options) {\n            // Replace drawables with tracks.\n            this.set(\"drawables\", new BackboneTrackCollection(options.tracks));\n\n            var models = [];\n            this.set(\"config\", config_mod.ConfigSettingCollection.from_models_and_saved_values(models, options.prefs));\n\n            // Clear track and data definitions to avoid storing large objects.\n            this.unset(\"tracks\");\n            this.get(\"drawables\").each(d => {\n                d.unset(\"preloaded_data\");\n            });\n        },\n\n        /**\n         * Add a track or array of tracks to the visualization.\n         */\n        add_tracks: function(tracks) {\n            this.get(\"drawables\").add(tracks);\n        }\n    },\n    {\n        // This definition matches that produced by to_dict() methods in tracks.js\n        to_json_keys: [\"view\", \"viewport\", \"bookmarks\"],\n\n        to_json_mappers: {\n            view: function(dummy, self) {\n                return {\n                    obj_type: \"View\",\n                    prefs: {\n                        name: self.get(\"title\"),\n                        content_visible: true\n                    },\n                    drawables: self.get(\"drawables\")\n                };\n            }\n        }\n    }\n);\n\n/**\n * -- Routers --\n */\n\n/**\n * Router for track browser.\n */\nvar TrackBrowserRouter = Backbone.Router.extend({\n    initialize: function(options) {\n        this.view = options.view;\n\n        // Can't put regular expression in routes dictionary.\n        // NOTE: parentheses are used to denote parameters returned to callback.\n        this.route(/([\\w]+)$/, \"change_location\");\n        this.route(/([\\w\\+]+\\:[\\d,]+-[\\d,]+)$/, \"change_location\");\n\n        // Handle navigate events from view.\n        var self = this;\n        self.view.on(\"navigate\", new_loc => {\n            self.navigate(new_loc);\n        });\n    },\n\n    change_location: function(new_loc) {\n        this.view.go_to(new_loc);\n    }\n});\n\nexport default {\n    BackboneTrack: BackboneTrack,\n    BrowserBookmark: BrowserBookmark,\n    BrowserBookmarkCollection: BrowserBookmarkCollection,\n    Cache: Cache,\n    CanvasManager: CanvasManager,\n    Genome: Genome,\n    GenomeDataManager: GenomeDataManager,\n    GenomeRegion: GenomeRegion,\n    GenomeRegionCollection: GenomeRegionCollection,\n    GenomeVisualization: GenomeVisualization,\n    GenomeReferenceDataManager: GenomeReferenceDataManager,\n    TrackBrowserRouter: TrackBrowserRouter,\n    Visualization: Visualization,\n    select_datasets: select_datasets\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/visualization.js","/**\n * Stringifies a number adding commas for digit grouping as per North America.\n */\nfunction commatize(number) {\n    number += \"\"; // Convert to string\n    var rgx = /(\\d+)(\\d{3})/;\n    while (rgx.test(number)) {\n        number = number.replace(rgx, \"$1\" + \",\" + \"$2\");\n    }\n    return number;\n}\n\n/**\n * Helper to determine if object is jQuery deferred.\n */\nvar is_deferred = d => \"promise\" in d;\n\n/**\n * Implementation of a server-state based deferred. Server is repeatedly polled, and when\n * condition is met, deferred is resolved.\n */\nvar ServerStateDeferred = Backbone.Model.extend({\n    defaults: {\n        ajax_settings: {},\n        interval: 1000,\n        success_fn: function(result) {\n            return true;\n        }\n    },\n\n    /**\n     * Returns a deferred that resolves when success function returns true.\n     */\n    go: function() {\n        var deferred = $.Deferred();\n        var self = this;\n        var ajax_settings = self.get(\"ajax_settings\");\n        var success_fn = self.get(\"success_fn\");\n        var interval = self.get(\"interval\");\n\n        var _go = () => {\n            $.ajax(ajax_settings).success(result => {\n                if (success_fn(result)) {\n                    // Result is good, so resolve.\n                    deferred.resolve(result);\n                } else {\n                    // Result not good, try again.\n                    setTimeout(_go, interval);\n                }\n            });\n        };\n\n        _go();\n        return deferred;\n    }\n});\n\n/**\n * Returns a random color in hexadecimal format that is sufficiently different from a single color\n * or set of colors.\n * @param colors a color or list of colors in the format '#RRGGBB'\n */\nvar get_random_color = colors => {\n    // Default for colors is white.\n    if (!colors) {\n        colors = \"#ffffff\";\n    }\n\n    // If needed, create list of colors.\n    if (typeof colors === \"string\") {\n        colors = [colors];\n    }\n\n    // Convert colors to numbers.\n    for (var i = 0; i < colors.length; i++) {\n        colors[i] = parseInt(colors[i].slice(1), 16);\n    }\n\n    // -- Perceived brightness and difference formulas are from\n    // -- http://www.w3.org/WAI/ER/WD-AERT/#color-contrast\n\n    // Compute perceived color brightness (based on RGB-YIQ transformation):\n    var brightness = (r, g, b) => (r * 299 + g * 587 + b * 114) / 1000;\n\n    // Compute color difference:\n    var difference = (r1, g1, b1, r2, g2, b2) =>\n        Math.max(r1, r2) -\n        Math.min(r1, r2) +\n        (Math.max(g1, g2) - Math.min(g1, g2)) +\n        (Math.max(b1, b2) - Math.min(b1, b2));\n\n    // Create new random color.\n    var new_color;\n\n    var nr;\n    var ng;\n    var nb;\n    var other_color;\n    var or;\n    var og;\n    var ob;\n    var n_brightness;\n    var o_brightness;\n    var diff;\n    var ok = false;\n    var num_tries = 0;\n    do {\n        // New color is never white b/c random in [0,1)\n        new_color = Math.round(Math.random() * 0xffffff);\n        nr = (new_color & 0xff0000) >> 16;\n        ng = (new_color & 0x00ff00) >> 8;\n        nb = new_color & 0x0000ff;\n        n_brightness = brightness(nr, ng, nb);\n        ok = true;\n        for (i = 0; i < colors.length; i++) {\n            other_color = colors[i];\n            or = (other_color & 0xff0000) >> 16;\n            og = (other_color & 0x00ff00) >> 8;\n            ob = other_color & 0x0000ff;\n            o_brightness = brightness(or, og, ob);\n            diff = difference(nr, ng, nb, or, og, ob);\n            // These thresholds may need to be adjusted. Brightness difference range is 125;\n            // color difference range is 500.\n            if (Math.abs(n_brightness - o_brightness) < 40 || diff < 200) {\n                ok = false;\n                break;\n            }\n        }\n\n        num_tries++;\n    } while (!ok && num_tries <= 10);\n\n    // Add 0x1000000 to left pad number with 0s.\n    return `#${(0x1000000 + new_color).toString(16).substr(1, 6)}`;\n};\n\nexport default {\n    commatize: commatize,\n    is_deferred: is_deferred,\n    ServerStateDeferred: ServerStateDeferred,\n    get_random_color: get_random_color\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster/util.js","// Additional dependencies: jQuery, underscore.\nimport Modal from \"mvc/ui/ui-modal\";\nimport Frames from \"mvc/ui/ui-frames\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\n/**\n * Dataset metedata.\n */\nvar DatasetMetadata = Backbone.Model.extend({});\n\n/**\n * A dataset. In Galaxy, datasets are associated with a history, so\n * this object is also known as a HistoryDatasetAssociation.\n */\nvar Dataset = Backbone.Model.extend({\n    defaults: {\n        id: \"\",\n        type: \"\",\n        name: \"\",\n        hda_ldda: \"hda\",\n        metadata: null\n    },\n\n    initialize: function() {\n        // Metadata can be passed in as a model or a set of attributes; if it's\n        // already a model, there's no need to set metadata.\n        if (!this.get(\"metadata\")) {\n            this._set_metadata();\n        }\n\n        // Update metadata on change.\n        this.on(\"change\", this._set_metadata, this);\n    },\n\n    _set_metadata: function() {\n        var metadata = new DatasetMetadata();\n\n        // Move metadata from dataset attributes to metadata object.\n        _.each(\n            _.keys(this.attributes),\n            function(k) {\n                if (k.indexOf(\"metadata_\") === 0) {\n                    // Found metadata.\n                    var new_key = k.split(\"metadata_\")[1];\n                    metadata.set(new_key, this.attributes[k]);\n                    delete this.attributes[k];\n                }\n            },\n            this\n        );\n\n        // Because this is an internal change, silence it.\n        this.set(\"metadata\", metadata, { silent: true });\n    },\n\n    /**\n     * Returns dataset metadata for a given attribute.\n     */\n    get_metadata: function(attribute) {\n        return this.attributes.metadata.get(attribute);\n    },\n\n    urlRoot: `${Galaxy.root}api/datasets`\n});\n\n/**\n * A tabular dataset. This object extends dataset to provide incremental chunked data.\n */\nvar TabularDataset = Dataset.extend({\n    defaults: _.extend({}, Dataset.prototype.defaults, {\n        chunk_url: null,\n        first_data_chunk: null,\n        offset: 0,\n        at_eof: false\n    }),\n\n    initialize: function(options) {\n        Dataset.prototype.initialize.call(this);\n\n        // If first data chunk is available, next chunk is 1.\n        if (this.attributes.first_data_chunk) {\n            this.attributes.offset = this.attributes.first_data_chunk.offset;\n        }\n        this.attributes.chunk_url = `${Galaxy.root}dataset/display?dataset_id=${this.id}`;\n        this.attributes.url_viz = `${Galaxy.root}visualization`;\n    },\n\n    /**\n     * Returns a jQuery Deferred object that resolves to the next data chunk or null if at EOF.\n     */\n    get_next_chunk: function() {\n        // If already at end of file, do nothing.\n        if (this.attributes.at_eof) {\n            return null;\n        }\n\n        // Get next chunk.\n        var self = this;\n\n        var next_chunk = $.Deferred();\n        $.getJSON(this.attributes.chunk_url, {\n            offset: self.attributes.offset\n        }).success(chunk => {\n            var rval;\n            if (chunk.ck_data !== \"\") {\n                // Found chunk.\n                rval = chunk;\n                self.attributes.offset = chunk.offset;\n            } else {\n                // At EOF.\n                self.attributes.at_eof = true;\n                rval = null;\n            }\n            next_chunk.resolve(rval);\n        });\n\n        return next_chunk;\n    }\n});\n\nvar DatasetCollection = Backbone.Collection.extend({\n    model: Dataset\n});\n\n/**\n * Provides a base for table-based, dynamic view of a tabular dataset.\n * Do not instantiate directly; use either TopLevelTabularDatasetChunkedView\n * or EmbeddedTabularDatasetChunkedView.\n */\nvar TabularDatasetChunkedView = Backbone.View.extend({\n    /**\n     * Initialize view and, importantly, set a scroll element.\n     */\n    initialize: function(options) {\n        // Row count for rendering.\n        this.row_count = 0;\n        this.loading_chunk = false;\n\n        // load trackster button\n        new TabularButtonTracksterView({\n            model: options.model,\n            $el: this.$el\n        });\n    },\n\n    expand_to_container: function() {\n        if (this.$el.height() < this.scroll_elt.height()) {\n            this.attempt_to_fetch();\n        }\n    },\n\n    attempt_to_fetch: function(func) {\n        var self = this;\n        if (!this.loading_chunk && this.scrolled_to_bottom()) {\n            this.loading_chunk = true;\n            this.loading_indicator.show();\n            $.when(self.model.get_next_chunk()).then(result => {\n                if (result) {\n                    self._renderChunk(result);\n                    self.loading_chunk = false;\n                }\n                self.loading_indicator.hide();\n                self.expand_to_container();\n            });\n        }\n    },\n\n    render: function() {\n        // Add loading indicator.\n        this.loading_indicator = $(\"<div/>\").attr(\"id\", \"loading_indicator\");\n        this.$el.append(this.loading_indicator);\n\n        // Add data table and header.\n        var data_table = $(\"<table/>\").attr({\n            id: \"content_table\",\n            cellpadding: 0\n        });\n        this.$el.append(data_table);\n        var column_names = this.model.get_metadata(\"column_names\");\n        var header_container = $(\"<thead/>\").appendTo(data_table);\n        var header_row = $(\"<tr/>\").appendTo(header_container);\n        if (column_names) {\n            header_row.append(`<th>${column_names.join(\"</th><th>\")}</th>`);\n        } else {\n            for (var j = 1; j <= this.model.get_metadata(\"columns\"); j++) {\n                header_row.append(`<th>${j}</th>`);\n            }\n        }\n\n        // Render first chunk.\n        var self = this;\n\n        var first_chunk = this.model.get(\"first_data_chunk\");\n        if (first_chunk) {\n            // First chunk is bootstrapped, so render now.\n            this._renderChunk(first_chunk);\n        } else {\n            // No bootstrapping, so get first chunk and then render.\n            $.when(self.model.get_next_chunk()).then(result => {\n                self._renderChunk(result);\n            });\n        }\n\n        // -- Show new chunks during scrolling. --\n\n        // Set up chunk loading when scrolling using the scrolling element.\n        this.scroll_elt.scroll(() => {\n            self.attempt_to_fetch();\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return false;\n    },\n\n    // -- Helper functions. --\n\n    _renderCell: function(cell_contents, index, colspan) {\n        var $cell = $(\"<td>\").text(cell_contents);\n        var column_types = this.model.get_metadata(\"column_types\");\n        if (colspan !== undefined) {\n            $cell.attr(\"colspan\", colspan).addClass(\"stringalign\");\n        } else if (column_types) {\n            if (index < column_types.length) {\n                if (column_types[index] === \"str\" || column_types[index] === \"list\") {\n                    /* Left align all str columns, right align the rest */\n                    $cell.addClass(\"stringalign\");\n                }\n            }\n        }\n        return $cell;\n    },\n\n    _renderRow: function(line) {\n        // Check length of cells to ensure this is a complete row.\n        var cells = line.split(\"\\t\");\n\n        var row = $(\"<tr>\");\n        var num_columns = this.model.get_metadata(\"columns\");\n\n        if (this.row_count % 2 !== 0) {\n            row.addClass(\"dark_row\");\n        }\n\n        if (cells.length === num_columns) {\n            _.each(\n                cells,\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n        } else if (cells.length > num_columns) {\n            // SAM file or like format with optional metadata included.\n            _.each(\n                cells.slice(0, num_columns - 1),\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n            row.append(this._renderCell(cells.slice(num_columns - 1).join(\"\\t\"), num_columns - 1));\n        } else if (cells.length === 1) {\n            // Comment line, just return the one cell.\n            row.append(this._renderCell(line, 0, num_columns));\n        } else {\n            // cells.length is greater than one, but less than num_columns.  Render cells and pad tds.\n            // Possibly a SAM file or like format with optional metadata missing.\n            // Could also be a tabular file with a line with missing columns.\n            _.each(\n                cells,\n                function(cell_contents, index) {\n                    row.append(this._renderCell(cell_contents, index));\n                },\n                this\n            );\n            _.each(_.range(num_columns - cells.length), () => {\n                row.append($(\"<td>\"));\n            });\n        }\n\n        this.row_count++;\n        return row;\n    },\n\n    _renderChunk: function(chunk) {\n        var data_table = this.$el.find(\"table\");\n        _.each(\n            chunk.ck_data.split(\"\\n\"),\n            function(line, index) {\n                if (line !== \"\") {\n                    data_table.append(this._renderRow(line));\n                }\n            },\n            this\n        );\n    }\n});\n\n/**\n * Tabular view that is placed at the top level of page. Scrolling occurs\n * view top-level elements outside of view.\n */\nvar TopLevelTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Scrolling happens in top-level elements.\n        var scroll_elt = _.find(this.$el.parents(), p => $(p).css(\"overflow\") === \"auto\");\n\n        // If no scrolling element found, use window.\n        if (!scroll_elt) {\n            scroll_elt = window;\n        }\n\n        // Wrap scrolling element for easy access.\n        this.scroll_elt = $(scroll_elt);\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return this.$el.height() - this.scroll_elt.scrollTop() - this.scroll_elt.height() <= 0;\n    }\n});\n\n/**\n * Tabular view tnat is embedded in a page. Scrolling occurs in view's el.\n */\nvar EmbeddedTabularDatasetChunkedView = TabularDatasetChunkedView.extend({\n    initialize: function(options) {\n        TabularDatasetChunkedView.prototype.initialize.call(this, options);\n\n        // Because view is embedded, set up div to do scrolling.\n        this.scroll_elt = this.$el.css({\n            position: \"relative\",\n            overflow: \"scroll\",\n            height: options.height || \"500px\"\n        });\n    },\n\n    /**\n     * Returns true if user has scrolled to the bottom of the view.\n     */\n    scrolled_to_bottom: function() {\n        return this.$el.scrollTop() + this.$el.innerHeight() >= this.el.scrollHeight;\n    }\n});\n\n/** Button for trackster visualization */\nvar TabularButtonTracksterView = Backbone.View.extend({\n    // gene region columns\n    col: {\n        chrom: null,\n        start: null,\n        end: null\n    },\n\n    // url for trackster\n    url_viz: null,\n\n    // dataset id\n    dataset_id: null,\n\n    // database key\n    genome_build: null,\n\n    // data type\n    file_ext: null,\n\n    // backbone initialize\n    initialize: function(options) {\n        // check if environment is available\n        var Galaxy = parent.Galaxy;\n\n        // link galaxy modal or create one\n        if (Galaxy && Galaxy.modal) {\n            this.modal = Galaxy.modal;\n        }\n\n        // link galaxy frames\n        if (Galaxy && Galaxy.frame) {\n            this.frame = Galaxy.frame;\n        }\n\n        // check\n        if (!this.modal || !this.frame) {\n            return;\n        }\n\n        // model/metadata\n        var model = options.model;\n        var metadata = model.get(\"metadata\");\n\n        // check for datatype\n        if (!model.get(\"file_ext\")) {\n            return;\n        }\n\n        // get data type\n        this.file_ext = model.get(\"file_ext\");\n\n        // check for bed-file format\n        if (this.file_ext == \"bed\") {\n            // verify that metadata exists\n            if (metadata.get(\"chromCol\") && metadata.get(\"startCol\") && metadata.get(\"endCol\")) {\n                // read in columns\n                this.col.chrom = metadata.get(\"chromCol\") - 1;\n                this.col.start = metadata.get(\"startCol\") - 1;\n                this.col.end = metadata.get(\"endCol\") - 1;\n            } else {\n                console.log(\"TabularButtonTrackster : Bed-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check for vcf-file format\n        if (this.file_ext == \"vcf\") {\n            // search array\n            function search(str, array) {\n                for (var j = 0; j < array.length; j++) if (array[j].match(str)) return j;\n                return -1;\n            }\n\n            // load\n            this.col.chrom = search(\"Chrom\", metadata.get(\"column_names\"));\n            this.col.start = search(\"Pos\", metadata.get(\"column_names\"));\n            this.col.end = null;\n\n            // verify that metadata exists\n            if (this.col.chrom == -1 || this.col.start == -1) {\n                console.log(\"TabularButtonTrackster : VCF-file metadata incomplete.\");\n                return;\n            }\n        }\n\n        // check\n        if (this.col.chrom === undefined) {\n            return;\n        }\n\n        // get dataset id\n        if (model.id) {\n            this.dataset_id = model.id;\n        } else {\n            console.log(\"TabularButtonTrackster : Dataset identification is missing.\");\n            return;\n        }\n\n        // get url\n        if (model.get(\"url_viz\")) {\n            this.url_viz = model.get(\"url_viz\");\n        } else {\n            console.log(\"TabularButtonTrackster : Url for visualization controller is missing.\");\n            return;\n        }\n\n        // get genome_build / database key\n        if (model.get(\"genome_build\")) {\n            this.genome_build = model.get(\"genome_build\");\n        }\n\n        // create the icon\n        var btn_viz = new mod_icon_btn.IconButtonView({\n            model: new mod_icon_btn.IconButton({\n                title: \"Visualize\",\n                icon_class: \"chart_curve\",\n                id: \"btn_viz\"\n            })\n        });\n\n        // set element\n        this.setElement(options.$el);\n\n        // add to element\n        this.$el.append(btn_viz.render().$el);\n\n        // hide the button\n        this.hide();\n    },\n\n    /** Add event handlers */\n    events: {\n        \"mouseover tr\": \"show\",\n        mouseleave: \"hide\"\n    },\n\n    // show button\n    show: function(e) {\n        var self = this;\n\n        // is numeric\n        function is_numeric(n) {\n            return !isNaN(parseFloat(n)) && isFinite(n);\n        }\n\n        // check\n        if (this.col.chrom === null) return;\n\n        // get selected data line\n        var row = $(e.target).parent();\n\n        // verify that location has been found\n        var chrom = row\n            .children()\n            .eq(this.col.chrom)\n            .html();\n        var start = row\n            .children()\n            .eq(this.col.start)\n            .html();\n\n        // end is optional\n        var end = this.col.end\n            ? row\n                  .children()\n                  .eq(this.col.end)\n                  .html()\n            : start;\n\n        // double check location\n        if (!chrom.match(\"^#\") && chrom !== \"\" && is_numeric(start)) {\n            // get target gene region\n            var btn_viz_pars = {\n                dataset_id: this.dataset_id,\n                gene_region: `${chrom}:${start}-${end}`\n            };\n\n            // get button position\n            var offset = row.offset();\n            var left = offset.left - 10;\n            var top = offset.top - $(window).scrollTop() + 3;\n\n            // update css\n            $(\"#btn_viz\").css({\n                position: \"fixed\",\n                top: `${top}px`,\n                left: `${left}px`\n            });\n            $(\"#btn_viz\").off(\"click\");\n            $(\"#btn_viz\").click(() => {\n                self.frame.add({\n                    title: \"Trackster\",\n                    url: `${self.url_viz}/trackster?${$.param(btn_viz_pars)}`\n                });\n            });\n\n            // show the button\n            $(\"#btn_viz\").show();\n        } else {\n            // hide the button\n            $(\"#btn_viz\").hide();\n        }\n    },\n\n    /** hide button */\n    hide: function() {\n        this.$(\"#btn_viz\").hide();\n    }\n});\n\n// -- Utility functions. --\n\n/**\n * Create a model, attach it to a view, render view, and attach it to a parent element.\n */\nvar createModelAndView = (model, view, model_config, parent_elt) => {\n    // Create model, view.\n    var a_view = new view({\n        model: new model(model_config)\n    });\n\n    // Render view and add to parent element.\n    a_view.render();\n    if (parent_elt) {\n        parent_elt.append(a_view.$el);\n    }\n\n    return a_view;\n};\n\n/**\n * Create a tabular dataset chunked view (and requisite tabular dataset model)\n * and appends to parent_elt.\n */\nvar createTabularDatasetChunkedView = options => {\n    // If no model, create and set model from dataset config.\n    if (!options.model) {\n        options.model = new TabularDataset(options.dataset_config);\n    }\n\n    var parent_elt = options.parent_elt;\n    var embedded = options.embedded;\n\n    // Clean up options so that only needed options are passed to view.\n    delete options.embedded;\n    delete options.parent_elt;\n    delete options.dataset_config;\n\n    // Create and set up view.\n    var view = embedded\n        ? new EmbeddedTabularDatasetChunkedView(options)\n        : new TopLevelTabularDatasetChunkedView(options);\n    view.render();\n\n    if (parent_elt) {\n        parent_elt.append(view.$el);\n        // If we're sticking this in another element, once it's appended check\n        // to make sure we've filled enough space.\n        // Without this, the scroll elements don't work.\n        view.expand_to_container();\n    }\n\n    return view;\n};\n\nexport default {\n    Dataset: Dataset,\n    TabularDataset: TabularDataset,\n    DatasetCollection: DatasetCollection,\n    TabularDatasetChunkedView: TabularDatasetChunkedView,\n    createTabularDatasetChunkedView: createTabularDatasetChunkedView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/data.js","import * as _ from \"libs/underscore\";\nimport util_mod from \"viz/trackster/util\";\nimport config_mod from \"utils/config\";\n/**\n * A configuration setting. Currently key is used as id.\n */\nvar ConfigSetting = Backbone.Model.extend({\n    initialize: function(options) {\n        // Use key as id for now.\n        var key = this.get(\"key\");\n        this.set(\"id\", key);\n\n        // Set defaults based on key.\n        var defaults = _.find(\n            [\n                {\n                    key: \"name\",\n                    label: \"Name\",\n                    type: \"text\",\n                    default_value: \"\"\n                },\n                {\n                    key: \"color\",\n                    label: \"Color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"min_value\",\n                    label: \"Min Value\",\n                    type: \"float\",\n                    default_value: null\n                },\n                {\n                    key: \"max_value\",\n                    label: \"Max Value\",\n                    type: \"float\",\n                    default_value: null\n                },\n                {\n                    key: \"mode\",\n                    type: \"string\",\n                    default_value: this.mode,\n                    hidden: true\n                },\n                {\n                    key: \"height\",\n                    type: \"int\",\n                    default_value: 32,\n                    hidden: true\n                },\n                {\n                    key: \"pos_color\",\n                    label: \"Positive Color\",\n                    type: \"color\",\n                    default_value: \"#FF8C00\"\n                },\n                {\n                    key: \"neg_color\",\n                    label: \"Negative Color\",\n                    type: \"color\",\n                    default_value: \"#4169E1\"\n                },\n                {\n                    key: \"block_color\",\n                    label: \"Block color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"label_color\",\n                    label: \"Label color\",\n                    type: \"color\",\n                    default_value: \"black\"\n                },\n                {\n                    key: \"show_insertions\",\n                    label: \"Show insertions\",\n                    type: \"bool\",\n                    default_value: false\n                },\n                {\n                    key: \"show_counts\",\n                    label: \"Show summary counts\",\n                    type: \"bool\",\n                    default_value: true\n                },\n                {\n                    key: \"reverse_strand_color\",\n                    label: \"Antisense strand color\",\n                    type: \"color\",\n                    default_value: null\n                },\n                {\n                    key: \"show_differences\",\n                    label: \"Show differences only\",\n                    type: \"bool\",\n                    default_value: true\n                }\n            ],\n            s => s.key === key\n        );\n        if (defaults) {\n            this.set(_.extend({}, defaults, options));\n        }\n\n        if (this.get(\"value\") === undefined && this.get(\"default_value\") !== undefined) {\n            // Use default to set value (if present).\n            this.set_value(this.get(\"default_value\"));\n\n            // If no default value for color config, set random color.\n            if (!this.get(\"value\") && this.get(\"type\") === \"color\") {\n                // For color setting, set random color.\n                this.set(\"value\", util_mod.get_random_color());\n            }\n        }\n    },\n\n    /**\n     * Cast and set value. This should be instead of\n     *  setting.set('value', new_value)\n     */\n    set_value: function(value, options) {\n        var type = this.get(\"type\");\n\n        if (type === \"float\") {\n            value = parseFloat(value);\n        } else if (type === \"int\") {\n            value = parseInt(value, 10);\n        }\n        // TODO: handle casting from string to bool?\n\n        this.set({ value: value }, options);\n    }\n});\n\n/**\n * Collection of config settings.\n */\nvar ConfigSettingCollection = Backbone.Collection.extend(\n    {\n        model: ConfigSetting,\n\n        /**\n         * Save settings as a dictionary of key-value pairs.\n         * This function is needed for backwards compatibility.\n         */\n        to_key_value_dict: function() {\n            var rval = {};\n            this.each(setting => {\n                rval[setting.get(\"key\")] = setting.get(\"value\");\n            });\n\n            return rval;\n        },\n\n        /**\n         * Returns value for a given key. Returns undefined if there is no setting with the specified key.\n         */\n        get_value: function(key) {\n            var s = this.get(key);\n            if (s) {\n                return s.get(\"value\");\n            }\n\n            return undefined;\n        },\n\n        /**\n         * Set value for a setting.\n         */\n        set_value: function(key, value, options) {\n            var s = this.get(key);\n            if (s) {\n                return s.set_value(value, options);\n            }\n\n            return undefined;\n        },\n\n        /**\n         * Set default value for a setting.\n         */\n        set_default_value: function(key, default_value) {\n            var s = this.get(key);\n            if (s) {\n                return s.set(\"default_value\", default_value);\n            }\n\n            return undefined;\n        }\n    },\n    {\n        /**\n         * Utility function that creates a ConfigSettingsCollection from a set of models\n         * and a saved_values dictionary.\n         */\n        from_models_and_saved_values: function(models, saved_values) {\n            // If there are saved values, copy models and update with saved values.\n            if (saved_values) {\n                models = _.map(models, m => _.extend({}, m, { value: saved_values[m.key] }));\n            }\n\n            return new ConfigSettingCollection(models);\n        }\n    }\n);\n\n/**\n * Viewer for config settings collection.\n */\nvar ConfigSettingCollectionView = Backbone.View.extend({\n    className: \"config-settings-view\",\n\n    /**\n     * Renders form for editing configuration settings.\n     */\n    render: function() {\n        var container = this.$el;\n\n        this.collection.each((param, index) => {\n            // Hidden params have no representation in the form\n            if (param.get(\"hidden\")) {\n                return;\n            }\n\n            // Build row for param.\n            var id = `param_${index}`;\n\n            var type = param.get(\"type\");\n            var value = param.get(\"value\");\n            var row = $(\"<div class='form-row' />\").appendTo(container);\n            row.append(\n                $(\"<label />\")\n                    .attr(\"for\", id)\n                    .text(`${param.get(\"label\")}:`)\n            );\n            // Draw parameter as checkbox\n            if (type === \"bool\") {\n                row.append(\n                    $('<input type=\"checkbox\" />')\n                        .attr(\"id\", id)\n                        .attr(\"name\", id)\n                        .attr(\"checked\", value)\n                );\n            } else if (type === \"text\") {\n                // Draw parameter as textbox\n                row.append(\n                    $('<input type=\"text\"/>')\n                        .attr(\"id\", id)\n                        .val(value)\n                        .click(function() {\n                            $(this).select();\n                        })\n                );\n            } else if (type === \"select\") {\n                // Draw parameter as select area\n                var select = $(\"<select />\").attr(\"id\", id);\n                _.each(param.get(\"options\"), option => {\n                    $(\"<option/>\")\n                        .text(option.label)\n                        .attr(\"value\", option.value)\n                        .appendTo(select);\n                });\n                select.val(value);\n                row.append(select);\n            } else if (type === \"color\") {\n                // Draw parameter as color picker\n                var container_div = $(\"<div/>\").appendTo(row);\n\n                var input = $(\"<input />\")\n                    .attr(\"id\", id)\n                    .attr(\"name\", id)\n                    .val(value)\n                    .css(\"float\", \"left\")\n                    .appendTo(container_div)\n                    .click(function(e) {\n                        // Hide other pickers.\n                        $(\".tooltip\").removeClass(\"in\");\n\n                        // Show input's color picker.\n                        var tip = $(this)\n                            .siblings(\".tooltip\")\n                            .addClass(\"in\");\n                        tip\n                            .css({\n                                // left: $(this).position().left + ( $(input).width() / 2 ) - 60,\n                                // top: $(this).position().top + $(this.height)\n                                left: $(this).position().left + $(this).width() + 5,\n                                top: $(this).position().top - $(tip).height() / 2 + $(this).height() / 2\n                            })\n                            .show();\n\n                        // Click management:\n\n                        // Keep showing tip if clicking in tip.\n                        tip.click(e => {\n                            e.stopPropagation();\n                        });\n\n                        // Hide tip if clicking outside of tip.\n                        $(document).bind(\"click.color-picker\", () => {\n                            tip.hide();\n                            $(document).unbind(\"click.color-picker\");\n                        });\n\n                        // No propagation to avoid triggering document click (and tip hiding) above.\n                        e.stopPropagation();\n                    });\n\n                var // Icon for setting a new random color; behavior set below.\n                new_color_icon = $(\"<a href='javascript:void(0)'/>\")\n                    .addClass(\"icon-button arrow-circle\")\n                    .appendTo(container_div)\n                    .attr(\"title\", \"Set new random color\")\n                    .tooltip();\n\n                var // Color picker in tool tip style.\n                tip = $(\"<div class='tooltip right' style='position: absolute;' />\")\n                    .appendTo(container_div)\n                    .hide();\n\n                var // Inner div for padding purposes\n                tip_inner = $(\"<div class='tooltip-inner' style='text-align: inherit'></div>\").appendTo(tip);\n\n                var tip_arrow = $(\"<div class='tooltip-arrow'></div>\").appendTo(tip);\n\n                var farb_obj = $.farbtastic(tip_inner, {\n                    width: 100,\n                    height: 100,\n                    callback: input,\n                    color: value\n                });\n\n                // Clear floating.\n                container_div.append($(\"<div/>\").css(\"clear\", \"both\"));\n\n                // Use function to fix farb_obj value.\n                (fixed_farb_obj => {\n                    new_color_icon.click(() => {\n                        fixed_farb_obj.setColor(util_mod.get_random_color());\n                    });\n                })(farb_obj);\n            } else {\n                row.append(\n                    $(\"<input />\")\n                        .attr(\"id\", id)\n                        .attr(\"name\", id)\n                        .val(value)\n                );\n            }\n            // Help text\n            if (param.help) {\n                row.append($(\"<div class='help'/>\").text(param.help));\n            }\n        });\n\n        return this;\n    },\n\n    /**\n     * Render view in modal.\n     */\n    render_in_modal: function(title) {\n        // Set up handlers for cancel, ok button and for handling esc key.\n        var self = this;\n\n        var cancel_fn = () => {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n        };\n\n        var ok_fn = () => {\n            Galaxy.modal.hide();\n            $(window).unbind(\"keypress.check_enter_esc\");\n            self.update_from_form();\n        };\n\n        var check_enter_esc = e => {\n            if ((e.keyCode || e.which) === 27) {\n                // Escape key\n                cancel_fn();\n            } else if ((e.keyCode || e.which) === 13) {\n                // Enter key\n                ok_fn();\n            }\n        };\n\n        // Set keypress handler.\n        $(window).bind(\"keypress.check_enter_esc\", check_enter_esc);\n\n        // Show modal.\n        if (this.$el.children().length === 0) {\n            this.render();\n        }\n        Galaxy.modal.show({\n            title: title || \"Configure\",\n            body: this.$el,\n            buttons: {\n                Cancel: cancel_fn,\n                OK: ok_fn\n            }\n        });\n    },\n\n    /**\n     * Update settings with new values entered via form.\n     */\n    update_from_form: function() {\n        var self = this;\n        this.collection.each((setting, index) => {\n            if (!setting.get(\"hidden\")) {\n                // Set value from view.\n                var id = `param_${index}`;\n                var value = self.$el.find(`#${id}`).val();\n                if (setting.get(\"type\") === \"bool\") {\n                    value = self.$el.find(`#${id}`).is(\":checked\");\n                }\n                setting.set_value(value);\n            }\n        });\n    }\n});\n\nexport default {\n    ConfigSetting: ConfigSetting,\n    ConfigSettingCollection: ConfigSettingCollection,\n    ConfigSettingCollectionView: ConfigSettingCollectionView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/config.js","// This is necessary so that, when nested arrays are used in ajax/post/get methods, square brackets ('[]') are\n// not appended to the identifier of a nested array.\njQuery.ajaxSettings.traditional = true;\n\n// dependencies\nimport Utils from \"utils/utils\";\nimport GridModel from \"mvc/grid/grid-model\";\nimport Templates from \"mvc/grid/grid-template\";\nimport PopupMenu from \"mvc/ui/popup-menu\";\n// grid view\nexport default Backbone.View.extend({\n    // model\n    grid: null,\n\n    // Initialize\n    initialize: function(grid_config) {\n        this.grid = new GridModel();\n        this.dict_format = grid_config.dict_format;\n        this.title = grid_config.title;\n        var self = this;\n        window.add_tag_to_grid_filter = (tag_name, tag_value) => {\n            // Put tag name and value together.\n            var tag = tag_name + (tag_value !== undefined && tag_value !== \"\" ? `:${tag_value}` : \"\");\n            var advanced_search = $(\"#advanced-search\").is(\":visible\");\n            if (!advanced_search) {\n                $(\"#standard-search\").slideToggle(\"fast\");\n                $(\"#advanced-search\").slideToggle(\"fast\");\n            }\n            self.add_filter_condition(\"tags\", tag);\n        };\n\n        // set element\n        if (this.dict_format) {\n            this.setElement(\"<div/>\");\n            if (grid_config.url_base && !grid_config.items) {\n                var url_data = grid_config.url_data || {};\n                _.each(grid_config.filters, (v, k) => {\n                    url_data[`f-${k}`] = v;\n                });\n                $.ajax({\n                    url: `${grid_config.url_base}?${$.param(url_data)}`,\n                    success: function(response) {\n                        response.embedded = grid_config.embedded;\n                        response.filters = grid_config.filters || {};\n                        self.init_grid(response);\n                    }\n                });\n            } else {\n                this.init_grid(grid_config);\n            }\n        } else {\n            this.setElement(\"#grid-container\");\n            this.init_grid(grid_config);\n        }\n\n        // fix padding\n        if (grid_config.use_panels) {\n            $(\"#center\").css({\n                padding: \"10px\",\n                overflow: \"auto\"\n            });\n        }\n    },\n\n    // refresh frames\n    handle_refresh: function(refresh_frames) {\n        if (refresh_frames) {\n            if ($.inArray(\"history\", refresh_frames) > -1) {\n                if (window.top.Galaxy && window.top.Galaxy.currHistoryPanel) {\n                    window.top.Galaxy.currHistoryPanel.loadCurrentHistory();\n                }\n            }\n        }\n    },\n\n    // Initialize\n    init_grid: function(grid_config) {\n        this.grid.set(grid_config);\n\n        // get options\n        var options = this.grid.attributes;\n\n        if (this.allow_title_display && options.title) {\n            Utils.setWindowTitle(options.title);\n        }\n        // handle refresh requests\n        this.handle_refresh(options.refresh_frames);\n\n        // strip protocol and domain\n        var url = this.grid.get(\"url_base\");\n        url = url.replace(/^.*\\/\\/[^\\/]+/, \"\");\n        this.grid.set(\"url_base\", url);\n\n        // append main template\n        this.$el.html(Templates.grid(options));\n\n        // update div contents\n        this.$el.find(\"#grid-table-header\").html(Templates.header(options));\n        this.$el.find(\"#grid-table-body\").html(Templates.body(options));\n        this.$el.find(\"#grid-table-footer\").html(Templates.footer(options));\n\n        // update message\n        if (options.message) {\n            this.$el.find(\"#grid-message\").html(Templates.message(options));\n            var self = this;\n            if (options.use_hide_message) {\n                setTimeout(() => {\n                    self.$el.find(\"#grid-message\").html(\"\");\n                }, 5000);\n            }\n        }\n\n        // configure elements\n        this.init_grid_elements();\n        this.init_grid_controls();\n\n        // attach global event handler\n        // TODO: redundant (the onload/standard page handlers do this) - but needed because these are constructed after page ready\n        init_refresh_on_change();\n    },\n\n    // Initialize grid controls\n    init_grid_controls: function() {\n        // link\n        var self = this;\n\n        // Initialize grid operation button.\n        this.$el.find(\".operation-button\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.submit_operation(this);\n                return false;\n            });\n        });\n\n        // Initialize text filters to select text on click and use normal font when user is typing.\n        this.$el.find(\"input[type=text]\").each(function() {\n            $(this).off();\n            $(this)\n                .click(function() {\n                    $(this).select();\n                })\n                .keyup(function() {\n                    $(this).css(\"font-style\", \"normal\");\n                });\n        });\n\n        // Initialize sort links.\n        this.$el.find(\".sort-link\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_sort_condition($(this).attr(\"sort_key\"));\n                return false;\n            });\n        });\n\n        // Initialize text filters.\n        this.$el.find(\".text-filter-form\").each(function() {\n            $(this).off();\n            $(this).submit(function() {\n                var column_key = $(this).attr(\"column_key\");\n                var text_input_obj = $(`#input-${column_key}-filter`);\n                var text_input = text_input_obj.val();\n                text_input_obj.val(\"\");\n                self.add_filter_condition(column_key, text_input);\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".text-filter-val > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                // Remove visible element.\n                $(this)\n                    .parent()\n                    .remove();\n\n                // Remove filter condition.\n                self.remove_filter_condition($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n\n                // Return\n                return false;\n            });\n        });\n\n        // Initialize categorical filters.\n        this.$el.find(\".categorical-filter > a\").each(function() {\n            $(this).off();\n            $(this).click(function() {\n                self.set_categorical_filter($(this).attr(\"filter_key\"), $(this).attr(\"filter_val\"));\n                return false;\n            });\n        });\n\n        // Initialize standard, advanced search toggles.\n        this.$el.find(\".advanced-search-toggle\").each(function() {\n            $(this).off();\n            $(this).click(() => {\n                self.$el.find(\"#standard-search\").slideToggle(\"fast\");\n                self.$el.find(\"#advanced-search\").slideToggle(\"fast\");\n                return false;\n            });\n        });\n\n        // Add event to check all box\n        this.$el.find(\"#check_all\").off();\n        this.$el.find(\"#check_all\").on(\"click\", () => {\n            self.check_all_items();\n        });\n    },\n\n    // Initialize grid elements.\n    init_grid_elements: function() {\n        // Initialize grid selection checkboxes.\n        this.$el.find(\".grid\").each(function() {\n            var checkboxes = $(this).find(\"input.grid-row-select-checkbox\");\n            var check_count = $(this).find(\"span.grid-selected-count\");\n            var update_checked = () => {\n                check_count.text($(checkboxes).filter(\":checked\").length);\n            };\n\n            $(checkboxes).each(function() {\n                $(this).change(update_checked);\n            });\n            update_checked();\n        });\n\n        // Initialize ratings.\n        if (this.$el.find(\".community_rating_star\").length !== 0) this.$el.find(\".community_rating_star\").rating({});\n\n        // get options\n        var options = this.grid.attributes;\n        var self = this;\n\n        //\n        // add page click events\n        //\n        this.$el.find(\".page-link > a\").each(function() {\n            $(this).click(function() {\n                self.set_page($(this).attr(\"page_num\"));\n                return false;\n            });\n        });\n\n        //\n        // add inbound/outbound events\n        //\n        this.$el.find(\".use-target\").each(function() {\n            $(this).click(function(e) {\n                self.execute({\n                    href: $(this).attr(\"href\"),\n                    target: $(this).attr(\"target\")\n                });\n                return false;\n            });\n        });\n\n        // empty grid?\n        var items_length = options.items.length;\n        if (items_length == 0) {\n            return;\n        }\n\n        // add operation popup menus\n        _.each(options.items, (item, index) => {\n            var button = self.$(`#grid-${index}-popup`).off();\n            var popup = new PopupMenu(button);\n            _.each(options[\"operations\"], operation => {\n                self._add_operation(popup, operation, item);\n            });\n        });\n    },\n\n    /** Add an operation to the items menu */\n    _add_operation: function(popup, operation, item) {\n        var self = this;\n        var settings = item.operation_config[operation.label];\n        if (settings.allowed && operation.allow_popup) {\n            popup.addItem({\n                html: operation.label,\n                href: settings.url_args,\n                target: settings.target,\n                confirmation_text: operation.confirm,\n                func: function(e) {\n                    e.preventDefault();\n                    var label = $(e.target).html();\n                    if (operation.onclick) {\n                        operation.onclick(item.encode_id);\n                    } else {\n                        self.execute(this.findItemByHtml(label));\n                    }\n                }\n            });\n        }\n    },\n\n    // Add a condition to the grid filter; this adds the condition and refreshes the grid.\n    add_filter_condition: function(name, value) {\n        // Do nothing is value is empty.\n        if (value === \"\") {\n            return false;\n        }\n\n        // Add condition to grid.\n        this.grid.add_filter(name, value, true);\n\n        // Add button that displays filter and provides a button to delete it.\n        var t = $(Templates.filter_element(name, value));\n        var self = this;\n        t.click(function() {\n            // Remove visible element.\n            $(this).remove();\n\n            // Remove filter condition.\n            self.remove_filter_condition(name, value);\n        });\n\n        // append to container\n        var container = this.$el.find(`#${name}-filtering-criteria`);\n        container.append(t);\n\n        // execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Remove a condition to the grid filter; this adds the condition and refreshes the grid.\n    remove_filter_condition: function(name, value) {\n        // Remove filter condition.\n        this.grid.remove_filter(name, value);\n\n        // Execute\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set sort condition for grid.\n    set_sort_condition: function(col_key) {\n        // Set new sort condition. New sort is col_key if sorting new column; if reversing sort on\n        // currently sorted column, sort is reversed.\n        var cur_sort = this.grid.get(\"sort_key\");\n        var new_sort = col_key;\n        if (cur_sort.indexOf(col_key) !== -1) {\n            // Reverse sort.\n            if (cur_sort.substring(0, 1) !== \"-\") {\n                new_sort = `-${col_key}`;\n            }\n        }\n\n        // Remove sort arrows elements.\n        this.$el.find(\".sort-arrow\").remove();\n\n        // Add sort arrow element to new sort column.\n        var sort_arrow = new_sort.substring(0, 1) == \"-\" ? \"&uarr;\" : \"&darr;\";\n        var t = $(`<span>${sort_arrow}</span>`).addClass(\"sort-arrow\");\n\n        // Add to header\n        this.$el.find(`#${col_key}-header`).append(t);\n\n        // Update grid.\n        this.grid.set(\"sort_key\", new_sort);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set new value for categorical filter.\n    set_categorical_filter: function(name, new_value) {\n        // Update filter hyperlinks to reflect new filter value.\n        var category_filter = this.grid.get(\"categorical_filters\")[name];\n\n        var cur_value = this.grid.get(\"filters\")[name];\n        var self = this;\n        this.$el.find(`.${name}-filter`).each(function() {\n            var text = $.trim($(this).text());\n            var filter = category_filter[text];\n            var filter_value = filter[name];\n            if (filter_value == new_value) {\n                // Remove filter link since grid will be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                $(this).empty();\n                $(this).addClass(\"current-filter\");\n                $(this).append(text);\n            } else if (filter_value == cur_value) {\n                // Add hyperlink for this filter since grid will no longer be using this filter. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                $(this).empty();\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_categorical_filter(name, filter_value);\n                });\n                $(this).removeClass(\"current-filter\");\n                $(this).append(t);\n            }\n        });\n\n        // Update grid.\n        this.grid.add_filter(name, new_value);\n        this.go_page_one();\n        this.execute();\n    },\n\n    // Set page to view.\n    set_page: function(new_page) {\n        // Update page hyperlink to reflect new page.\n        var self = this;\n        this.$el.find(\".page-link\").each(function() {\n            var id = $(this).attr(\"id\");\n\n            var // Id has form 'page-link-<page_num>\n            page_num = parseInt(id.split(\"-\")[2], 10);\n\n            var cur_page = self.grid.get(\"cur_page\");\n            var text;\n            if (page_num === new_page) {\n                // Remove link to page since grid will be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor with text.\n                text = $(this)\n                    .children()\n                    .text();\n                $(this).empty();\n                $(this).addClass(\"inactive-link\");\n                $(this).text(text);\n            } else if (page_num === cur_page) {\n                // Add hyperlink to this page since grid will no longer be on this page. It is assumed that\n                // this element has a single child, a hyperlink/anchor.\n                text = $(this).text();\n                $(this).empty();\n                $(this).removeClass(\"inactive-link\");\n                var t = $(`<a href=\"#\">${text}</a>`);\n                t.click(() => {\n                    self.set_page(page_num);\n                });\n                $(this).append(t);\n            }\n        });\n\n        if (new_page === \"all\") {\n            this.grid.set(\"cur_page\", new_page);\n        } else {\n            this.grid.set(\"cur_page\", parseInt(new_page, 10));\n        }\n        this.execute();\n    },\n\n    // confirmation/submission of operation request\n    submit_operation: function(operation_button, confirmation_text) {\n        // identify operation\n        var operation_name = $(operation_button).val();\n\n        // verify in any item is selected\n        var number_of_checked_ids = this.$el.find('input[name=\"id\"]:checked').length;\n        if (!number_of_checked_ids > 0) {\n            return false;\n        }\n\n        // Check to see if there's grid confirmation text for this operation\n        var operation = _.findWhere(this.grid.attributes.operations, {\n            label: operation_name\n        });\n        if (operation && !confirmation_text) {\n            confirmation_text = operation.confirm || \"\";\n        }\n\n        // collect ids\n        var item_ids = [];\n        this.$el.find(\"input[name=id]:checked\").each(function() {\n            item_ids.push($(this).val());\n        });\n\n        // execute operation\n        var options = {\n            operation: operation_name,\n            id: item_ids,\n            confirmation_text: confirmation_text\n        };\n        if (operation.target == \"top\" || operation.target == \"center\") {\n            options = _.extend(options, {\n                href: operation.href,\n                target: operation.target\n            });\n        }\n        this.execute(options);\n        return true;\n    },\n\n    check_all_items: function() {\n        var check = this.$(\".grid-row-select-checkbox\");\n        var state = this.$(\"#check_all\").prop(\"checked\");\n        _.each(check, c => {\n            $(c).prop(\"checked\", state);\n        });\n        this.init_grid_elements();\n    },\n\n    // Go back to page one; this is useful when a filter is applied.\n    go_page_one: function() {\n        // Need to go back to page 1 if not showing all.\n        var cur_page = this.grid.get(\"cur_page\");\n        if (cur_page !== null && cur_page !== undefined && cur_page !== \"all\") {\n            this.grid.set(\"cur_page\", 1);\n        }\n    },\n\n    //\n    // execute operations and hyperlink requests\n    //\n    execute: function(options) {\n        // get url\n        var id = null;\n        var href = null;\n        var operation = null;\n        var confirmation_text = null;\n        var target = null;\n\n        // check for options\n        if (options) {\n            // get options\n            href = options.href;\n            operation = options.operation;\n            id = options.id;\n            confirmation_text = options.confirmation_text;\n            target = options.target;\n\n            // check if input contains the operation tag\n            if (href !== undefined && href.indexOf(\"operation=\") != -1) {\n                // Get operation, id in hyperlink's href.\n                var href_parts = href.split(\"?\");\n                if (href_parts.length > 1) {\n                    var href_parms_str = href_parts[1];\n                    var href_parms = href_parms_str.split(\"&\");\n                    for (var index = 0; index < href_parms.length; index++) {\n                        if (href_parms[index].indexOf(\"operation\") != -1) {\n                            // Found operation parm; get operation value.\n                            operation = href_parms[index].split(\"=\")[1];\n                            operation = operation.replace(/\\+/g, \" \");\n                        } else if (href_parms[index].indexOf(\"id\") != -1) {\n                            // Found id parm; get id value.\n                            id = href_parms[index].split(\"=\")[1];\n                        }\n                    }\n                }\n            }\n        }\n\n        // check for operation details\n        if (operation && id) {\n            // show confirmation box\n            if (\n                confirmation_text &&\n                confirmation_text != \"\" &&\n                confirmation_text != \"None\" &&\n                confirmation_text != \"null\"\n            )\n                if (!confirm(confirmation_text)) return false;\n\n            // use small characters for operation?!\n            operation = operation.toLowerCase();\n\n            // Update grid.\n            this.grid.set({\n                operation: operation,\n                item_ids: id\n            });\n\n            // Do operation. If operation cannot be performed asynchronously, redirect to location.\n            if (target == \"top\") {\n                window.top.location = `${href}?${$.param(this.grid.get_url_data())}`;\n            } else if (target == \"center\") {\n                $(\"#galaxy_main\").attr(\"src\", `${href}?${$.param(this.grid.get_url_data())}`);\n            } else if (this.grid.can_async_op(operation) || this.dict_format) {\n                this.update_grid();\n            } else {\n                this.go_to(target, href);\n            }\n\n            // done\n            return false;\n        }\n\n        // refresh grid\n        if (href) {\n            this.go_to(target, href);\n            return false;\n        }\n\n        // refresh grid\n        if (this.grid.get(\"async\") || this.dict_format) {\n            this.update_grid();\n        } else {\n            this.go_to(target, href);\n        }\n\n        // done\n        return false;\n    },\n\n    // go to url\n    go_to: function(target, href) {\n        // get aysnc status\n        var async = this.grid.get(\"async\");\n        this.grid.set(\"async\", false);\n\n        // get slide status\n        var advanced_search = this.$el.find(\"#advanced-search\").is(\":visible\");\n        this.grid.set(\"advanced_search\", advanced_search);\n\n        // get default url\n        if (!href) {\n            href = `${this.grid.get(\"url_base\")}?${$.param(this.grid.get_url_data())}`;\n        }\n\n        // clear grid of transient request attributes.\n        this.grid.set({\n            operation: undefined,\n            item_ids: undefined,\n            async: async\n        });\n        switch (target) {\n            case \"center\":\n                $(\"#galaxy_main\").attr(\"src\", href);\n                break;\n            case \"top\":\n                window.top.location = href;\n                break;\n            default:\n                window.location = href;\n        }\n    },\n\n    // Update grid.\n    update_grid: function() {\n        // If there's an operation, do POST; otherwise, do GET.\n        var method = this.grid.get(\"operation\") ? \"POST\" : \"GET\";\n\n        // Show overlay to indicate loading and prevent user actions.\n        this.$el.find(\".loading-elt-overlay\").show();\n        var self = this;\n        $.ajax({\n            type: method,\n            url: self.grid.get(\"url_base\"),\n            data: self.grid.get_url_data(),\n            error: function(response) {\n                alert(\"Grid refresh failed\");\n            },\n            success: function(response_text) {\n                // backup\n                var embedded = self.grid.get(\"embedded\");\n                var insert = self.grid.get(\"insert\");\n                var advanced_search = self.$el.find(\"#advanced-search\").is(\":visible\");\n\n                // request new configuration\n                var json = self.dict_format ? response_text : $.parseJSON(response_text);\n\n                // update\n                json.embedded = embedded;\n                json.insert = insert;\n                json.advanced_search = advanced_search;\n\n                // Initialize new grid config\n                self.init_grid(json);\n\n                // Hide loading overlay.\n                self.$el.find(\".loading-elt-overlay\").hide();\n            },\n            complete: function() {\n                // Clear grid of transient request attributes.\n                self.grid.set({\n                    operation: undefined,\n                    item_ids: undefined\n                });\n            }\n        });\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/grid/grid-view.js","/**\n  Webhooks\n**/\n\nvar WebhookModel = Backbone.Model.extend({\n    defaults: {\n        activate: false\n    }\n});\n\nvar Webhooks = Backbone.Collection.extend({\n    model: WebhookModel\n});\n\nvar WebhookView = Backbone.View.extend({\n    el: \"#webhook-view\",\n\n    initialize: function(options) {\n        var me = this;\n        var toolId = options.toolId || \"\";\n        var toolVersion = options.toolVersion || \"\";\n\n        this.$el.attr(\"tool_id\", toolId);\n        this.$el.attr(\"tool_version\", toolVersion);\n\n        this.model = new WebhookModel();\n        this.model.urlRoot = options.urlRoot;\n        this.model.fetch({\n            success: function() {\n                me.render();\n            }\n        });\n    },\n\n    render: function() {\n        var webhook = this.model.toJSON();\n\n        this.$el.html(`<div id=\"${webhook.name}\"></div>`);\n        if (webhook.styles)\n            $(\"<style/>\", { type: \"text/css\" })\n                .text(webhook.styles)\n                .appendTo(\"head\");\n        if (webhook.script)\n            $(\"<script/>\", { type: \"text/javascript\" })\n                .text(webhook.script)\n                .appendTo(\"head\");\n\n        return this;\n    }\n});\n\nvar add = options => {\n    var webhooks = new Webhooks();\n\n    webhooks.url = Galaxy.root + options.url;\n    webhooks.fetch({\n        async: options.async ? options.async : true,\n        success: options.callback\n    });\n};\n\nexport default {\n    Webhooks: Webhooks,\n    WebhookView: WebhookView,\n    add: add\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/webhooks.js","//=============================================================================\n/**\n * backbone model for icon buttons\n */\nvar IconButton = Backbone.Model.extend({\n    defaults: {\n        title: \"\",\n        icon_class: \"\",\n        on_click: null,\n        menu_options: null,\n        is_menu_button: true,\n        id: null,\n        href: null,\n        target: null,\n        enabled: true,\n        visible: true,\n        tooltip_config: {}\n    }\n});\n\n/**\n *  backbone view for icon buttons\n */\nvar IconButtonView = Backbone.View.extend({\n    initialize: function() {\n        // better rendering this way\n        this.model.attributes.tooltip_config = { placement: \"bottom\" };\n        this.model.bind(\"change\", this.render, this);\n    },\n\n    render: function() {\n        // hide tooltip\n        this.$el.tooltip(\"hide\");\n\n        var new_elem = this.template(this.model.toJSON());\n        // configure tooltip\n        new_elem.tooltip(this.model.get(\"tooltip_config\"));\n        this.$el.replaceWith(new_elem);\n        this.setElement(new_elem);\n        return this;\n    },\n\n    events: {\n        click: \"click\"\n    },\n\n    click: function(event) {\n        // if on_click pass to that function\n        if (_.isFunction(this.model.get(\"on_click\"))) {\n            this.model.get(\"on_click\")(event);\n            return false;\n        }\n        // otherwise, bubble up ( to href or whatever )\n        return true;\n    },\n\n    // generate html element\n    template: function(options) {\n        var buffer = `title=\"${options.title}\" class=\"icon-button`;\n\n        if (options.is_menu_button) {\n            buffer += \" menu-button\";\n        }\n\n        buffer += ` ${options.icon_class}`;\n\n        if (!options.enabled) {\n            buffer += \"_disabled\";\n        }\n\n        // close class tag\n        buffer += '\"';\n\n        if (options.id) {\n            buffer += ` id=\"${options.id}\"`;\n        }\n\n        buffer += ` href=\"${options.href}\"`;\n        // add target for href\n        if (options.target) {\n            buffer += ` target=\"${options.target}\"`;\n        }\n        // set visibility\n        if (!options.visible) {\n            buffer += ' style=\"display: none;\"';\n        }\n\n        // enabled/disabled\n        if (options.enabled) {\n            buffer = `<a ${buffer}/>`;\n        } else {\n            buffer = `<span ${buffer}/>`;\n        }\n\n        // return element\n        return $(buffer);\n    }\n});\n\n// define collection\nvar IconButtonCollection = Backbone.Collection.extend({\n    model: IconButton\n});\n\n/**\n * menu with multiple icon buttons\n * views are not needed nor used for individual buttons\n */\nvar IconButtonMenuView = Backbone.View.extend({\n    tagName: \"div\",\n\n    initialize: function() {\n        this.render();\n    },\n\n    render: function() {\n        // initialize icon buttons\n        var self = this;\n        this.collection.each(button => {\n            // create and add icon button to menu\n            var elt = $(\"<a/>\")\n                .attr(\"href\", \"javascript:void(0)\")\n                .attr(\"title\", button.attributes.title)\n                .addClass(\"icon-button menu-button\")\n                .addClass(button.attributes.icon_class)\n                .appendTo(self.$el)\n                .click(button.attributes.on_click);\n\n            // configure tooltip\n            if (button.attributes.tooltip_config) {\n                elt.tooltip(button.attributes.tooltip_config);\n            }\n\n            // add popup menu to icon\n            var menu_options = button.get(\"options\");\n            if (menu_options) {\n                make_popupmenu(elt, menu_options);\n            }\n        });\n\n        // return\n        return this;\n    }\n});\n\n/**\n * Returns an IconButtonMenuView for the provided configuration.\n * Configuration is a list of dictionaries where each dictionary\n * defines an icon button. Each dictionary must have the following\n * elements: icon_class, title, and on_click.\n */\nvar create_icon_buttons_menu = (config, global_config) => {\n    // initialize global configuration\n    if (!global_config) global_config = {};\n\n    // create and initialize menu\n    var buttons = new IconButtonCollection(\n        _.map(config, button_config => new IconButton(_.extend(button_config, global_config)))\n    );\n\n    // return menu\n    return new IconButtonMenuView({ collection: buttons });\n};\n\n//=============================================================================\nexport default {\n    IconButton: IconButton,\n    IconButtonView: IconButtonView,\n    IconButtonCollection: IconButtonCollection,\n    IconButtonMenuView: IconButtonMenuView,\n    create_icon_buttons_menu: create_icon_buttons_menu\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/icon-button.js","/** Frame view */\nvar FrameView = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.setElement($(\"<div/>\").addClass(\"corner frame\"));\n        this.$el\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-header corner\")\n                    .append($(\"<div/>\").addClass(\"f-title\"))\n                    .append(\n                        $(\"<div/>\")\n                            .addClass(\"f-icon f-close fa fa-close\")\n                            .tooltip({\n                                title: \"Close\",\n                                placement: \"bottom\"\n                            })\n                    )\n            )\n            .append($(\"<div/>\").addClass(\"f-content\"))\n            .append(\n                $(\"<div/>\")\n                    .addClass(\"f-resize f-icon corner fa fa-expand\")\n                    .tooltip({ title: \"Resize\" })\n            )\n            .append($(\"<div/>\").addClass(\"f-cover\"));\n        this.$header = this.$(\".f-header\");\n        this.$title = this.$(\".f-title\");\n        this.$content = this.$(\".f-content\");\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$title.html(options.title || \"\");\n        this.$header.find(\".f-icon-left\").remove();\n        _.each(options.menu, option => {\n            var $option = $(\"<div/>\")\n                .addClass(\"f-icon-left\")\n                .addClass(option.icon);\n            if (_.isFunction(option.disabled) && option.disabled()) {\n                $option.attr(\"disabled\", true);\n            } else {\n                $option\n                    .on(\"click\", () => {\n                        option.onclick(self);\n                    })\n                    .tooltip({\n                        title: option.tooltip,\n                        placement: \"bottom\"\n                    });\n            }\n            self.$header.append($option);\n        });\n        if (options.url) {\n            this.$content.html(\n                $(\"<iframe/>\")\n                    .addClass(\"f-iframe\")\n                    .attr(\"scrolling\", \"auto\")\n                    .attr(\"src\", `${options.url + (options.url.indexOf(\"?\") === -1 ? \"?\" : \"&\")}widget=True`)\n            );\n        } else if (options.content) {\n            _.isFunction(options.content) ? options.content(self.$content) : self.$content.html(options.content);\n        }\n    }\n});\n\n/** Scratchbook viewer */\nvar View = Backbone.View.extend({\n    defaultOptions: {\n        frame: {\n            // default frame size in cells\n            cols: 6,\n            rows: 3\n        },\n        rows: 1000, // maximum number of rows\n        cell: 130, // cell size in px\n        margin: 5, // margin between frames\n        scroll: 5, // scroll speed\n        top_min: 40, // top margin\n        frame_max: 9, // maximum number of frames\n        visible: true // initial visibility\n    },\n\n    cols: 0, // number of columns\n    top: 0, // scroll/element top\n    top_max: 0, // viewport scrolling state\n    frame_z: 0, // frame z-index\n    frame_counter: 0, // frame counter\n    frame_uid: 0, // unique frame id counter\n    frame_list: {}, // list of all frames\n    frame_shadow: null, // frame shown as placeholder when moving active frames\n    visible: false, // flag indicating if scratchbook viewer is visible or not\n    event: {}, // dictionary keeping track of current event\n\n    initialize: function(options) {\n        var self = this;\n        this.options = _.defaults(options || {}, this.defaultOptions);\n        this.visible = this.options.visible;\n        this.top = this.top_max = this.options.top_min;\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"galaxy-frame\")\n                .append($(\"<div/>\").addClass(\"frame-background\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-up fa fa-chevron-up fa-2x\"))\n                .append($(\"<div/>\").addClass(\"frame-menu frame-scroll-down fa fa-chevron-down fa-2x\"))\n        );\n\n        // initialize shadow to guiding drag/resize events\n        this.frame_shadow = new Backbone.View({\n            el: $(\"<div/>\").addClass(\"corner frame-shadow\")\n        });\n        this.$el.append(this.frame_shadow.$el);\n        this._frameInit(this.frame_shadow, \"#frame-shadow\");\n        this._frameResize(this.frame_shadow, { width: 0, height: 0 });\n        this.frame_list[\"#frame-shadow\"] = this.frame_shadow;\n\n        // initialize panel\n        this.visible ? this.show() : this.hide();\n        this._panelRefresh();\n        $(window).resize(() => {\n            self.visible && self._panelRefresh();\n        });\n    },\n\n    /** Render */\n    render: function() {\n        this.$(\".frame-scroll-up\")[(this.top != this.options.top_min && \"show\") || \"hide\"]();\n        this.$(\".frame-scroll-down\")[(this.top != this.top_max && \"show\") || \"hide\"]();\n    },\n\n    /**\n     * Adds and displays a new frame.\n     *\n     * options:\n     *  url     : loaded into an iframe\n     *  content : content is treated as a function or raw HTML, function is passed a single\n     *              argument that is the frame's content DOM element\n     */\n    add: function(options) {\n        if (this.frame_counter >= this.options.frame_max) {\n            Galaxy.modal.show({\n                title: \"Warning\",\n                body: `You have reached the maximum number of allowed frames (${this.options.frame_max}).`,\n                buttons: {\n                    Close: function() {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n        } else {\n            var frame_id = `#frame-${this.frame_uid++}`;\n            if ($(frame_id).length !== 0) {\n                Galaxy.modal.show({\n                    title: \"Error\",\n                    body: \"This frame already exists. This page might contain multiple frame managers.\",\n                    buttons: {\n                        Close: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            } else {\n                // initialize new frame elements\n                this.top = this.options.top_min;\n                var frame = new FrameView(options);\n                this.$el.append(frame.$el);\n\n                // set dimensions\n                options.width = this._toPixelCoord(\"width\", this.options.frame.cols);\n                options.height = this._toPixelCoord(\"height\", this.options.frame.rows);\n\n                // set default z-index and add to ui and frame list\n                this.frame_z = parseInt(frame.$el.css(\"z-index\"));\n                this.frame_list[frame_id] = frame;\n                this.frame_counter++;\n                this._frameInit(frame, frame_id);\n                this._frameResize(frame, {\n                    width: options.width,\n                    height: options.height\n                });\n                this._frameInsert(frame, { top: 0, left: 0 }, true);\n                !this.visible && this.show();\n                this.trigger(\"add\");\n            }\n        }\n    },\n\n    /** Remove a frame */\n    del: function(frame) {\n        var self = this;\n        var $frame = frame.$el;\n        $frame.fadeOut(\"fast\", () => {\n            $frame.remove();\n            delete self.frame_list[frame.id];\n            self.frame_counter--;\n            self._panelRefresh(true);\n            self._panelAnimationComplete();\n            self.trigger(\"remove\");\n        });\n    },\n\n    /** Show panel */\n    show: function() {\n        this.visible = true;\n        this.$el.fadeIn(\"fast\");\n        this.trigger(\"show\");\n    },\n\n    /** Hide panel */\n    hide: function() {\n        if (!this.event.type) {\n            this.visible = false;\n            this.$el.fadeOut(\"fast\", function() {\n                $(this).hide();\n            });\n            this.trigger(\"hide\");\n        }\n    },\n\n    /** Returns the number of frames */\n    length: function() {\n        return this.frame_counter;\n    },\n\n    /*\n        EVENT HANDLING\n    */\n    events: {\n        // global frame events\n        mousemove: \"_eventFrameMouseMove\",\n        mouseup: \"_eventFrameMouseUp\",\n        mouseleave: \"_eventFrameMouseUp\",\n        mousewheel: \"_eventPanelScroll\",\n        DOMMouseScroll: \"_eventPanelScroll\",\n\n        // events fixed to elements\n        \"mousedown .frame\": \"_eventFrameMouseDown\",\n        \"mousedown .frame-background\": \"_eventHide\",\n        \"mousedown .frame-scroll-up\": \"_eventPanelScroll_up\",\n        \"mousedown .frame-scroll-down\": \"_eventPanelScroll_down\",\n        \"mousedown .f-close\": \"_eventFrameClose\"\n    },\n\n    /** Start drag/resize event */\n    _eventFrameMouseDown: function(e) {\n        $(\".tooltip\").hide();\n        if (!this.event.type) {\n            if ($(e.target).hasClass(\"f-header\") || $(e.target).hasClass(\"f-title\")) {\n                this.event.type = \"drag\";\n            }\n            if ($(e.target).hasClass(\"f-resize\")) {\n                this.event.type = \"resize\";\n            }\n            if (this.event.type) {\n                e.preventDefault();\n                this.event.target = this._frameIdentify(e.target);\n                this.event.xy = {\n                    x: e.originalEvent.pageX,\n                    y: e.originalEvent.pageY\n                };\n                this._frameDragStart(this.event.target);\n            }\n        }\n    },\n\n    /** Processes drag/resize events */\n    _eventFrameMouseMove: function(e) {\n        if (this.event.type) {\n            // get mouse motion and delta\n            var event_xy_new = {\n                x: e.originalEvent.pageX,\n                y: e.originalEvent.pageY\n            };\n            var event_xy_delta = {\n                x: event_xy_new.x - this.event.xy.x,\n                y: event_xy_new.y - this.event.xy.y\n            };\n            this.event.xy = event_xy_new;\n\n            // get current screen position and size of frame\n            var p = this._frameScreen(this.event.target);\n\n            // drag/resize event\n            if (this.event.type == \"resize\") {\n                p.width += event_xy_delta.x;\n                p.height += event_xy_delta.y;\n                var min_dim = this.options.cell - this.options.margin - 1;\n                p.width = Math.max(p.width, min_dim);\n                p.height = Math.max(p.height, min_dim);\n                this._frameResize(this.event.target, p);\n                p.width = this._toGridCoord(\"width\", p.width) + 1;\n                p.height = this._toGridCoord(\"height\", p.height) + 1;\n                p.width = this._toPixelCoord(\"width\", p.width);\n                p.height = this._toPixelCoord(\"height\", p.height);\n                this._frameResize(this.frame_shadow, p);\n                this._frameInsert(this.frame_shadow, {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                });\n            } else if (this.event.type == \"drag\") {\n                p.left += event_xy_delta.x;\n                p.top += event_xy_delta.y;\n                this._frameOffset(this.event.target, p);\n                var l = {\n                    top: this._toGridCoord(\"top\", p.top),\n                    left: this._toGridCoord(\"left\", p.left)\n                };\n                l.left !== 0 && l.left++;\n                this._frameInsert(this.frame_shadow, l);\n            }\n        }\n    },\n\n    /** Stop drag/resize events */\n    _eventFrameMouseUp: function(e) {\n        if (this.event.type) {\n            this._frameDragStop(this.event.target);\n            this.event.type = null;\n        }\n    },\n\n    /** Destroy a frame */\n    _eventFrameClose: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this.del(this._frameIdentify(e.target));\n        }\n    },\n\n    /** Hide all frames */\n    _eventHide: function(e) {\n        !this.event.type && this.hide();\n    },\n\n    /** Fired when scrolling occurs on panel */\n    _eventPanelScroll: function(e) {\n        if (!this.event.type && this.visible) {\n            // Stop propagation if scrolling is happening inside a frame.\n            // TODO: could propagate scrolling if at top/bottom of frame.\n            var frames = $(e.srcElement).parents(\".frame\");\n            if (frames.length !== 0) {\n                e.stopPropagation();\n            } else {\n                e.preventDefault();\n                this._panelScroll(e.originalEvent.detail ? e.originalEvent.detail : e.originalEvent.wheelDelta / -3);\n            }\n        }\n    },\n\n    /** Handle scroll up event */\n    _eventPanelScroll_up: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(-this.options.scroll);\n        }\n    },\n\n    /** Handle scroll down */\n    _eventPanelScroll_down: function(e) {\n        if (!this.event.type) {\n            e.preventDefault();\n            this._panelScroll(this.options.scroll);\n        }\n    },\n\n    /*\n        FRAME EVENTS SUPPORT\n    */\n\n    /** Identify the target frame */\n    _frameIdentify: function(target) {\n        return this.frame_list[\n            `#${$(target)\n                .closest(\".frame\")\n                .attr(\"id\")}`\n        ];\n    },\n\n    /** Provides drag support */\n    _frameDragStart: function(frame) {\n        this._frameFocus(frame, true);\n        var p = this._frameScreen(frame);\n        this._frameResize(this.frame_shadow, p);\n        this._frameGrid(this.frame_shadow, frame.grid_location);\n        frame.grid_location = null;\n        this.frame_shadow.$el.show();\n        $(\".f-cover\").show();\n    },\n\n    /** Removes drag support */\n    _frameDragStop: function(frame) {\n        this._frameFocus(frame, false);\n        var p = this._frameScreen(this.frame_shadow);\n        this._frameResize(frame, p);\n        this._frameGrid(frame, this.frame_shadow.grid_location, true);\n        this.frame_shadow.grid_location = null;\n        this.frame_shadow.$el.hide();\n        $(\".f-cover\").hide();\n        this._panelAnimationComplete();\n    },\n\n    /*\n        GRID/PIXEL CONVERTER\n    */\n\n    /** Converts a pixel to a grid dimension */\n    _toGridCoord: function(type, px) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        type == \"top\" && (px -= this.top);\n        return parseInt((px + sign * this.options.margin) / this.options.cell, 10);\n    },\n\n    /** Converts a grid to a pixels dimension */\n    _toPixelCoord: function(type, g) {\n        var sign = type == \"width\" || type == \"height\" ? 1 : -1;\n        var px = g * this.options.cell - sign * this.options.margin;\n        type == \"top\" && (px += this.top);\n        return px;\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toGrid: function(px) {\n        return {\n            top: this._toGridCoord(\"top\", px.top),\n            left: this._toGridCoord(\"left\", px.left),\n            width: this._toGridCoord(\"width\", px.width),\n            height: this._toGridCoord(\"height\", px.height)\n        };\n    },\n\n    /** Converts a pixel to a grid coordinate set */\n    _toPixel: function(g) {\n        return {\n            top: this._toPixelCoord(\"top\", g.top),\n            left: this._toPixelCoord(\"left\", g.left),\n            width: this._toPixelCoord(\"width\", g.width),\n            height: this._toPixelCoord(\"height\", g.height)\n        };\n    },\n\n    /* \n        COLLISION DETECTION\n    */\n\n    /** Check collisions for a grid coordinate set */\n    _isCollision: function(g) {\n        function is_collision_pair(a, b) {\n            return !(\n                a.left > b.left + b.width - 1 ||\n                a.left + a.width - 1 < b.left ||\n                a.top > b.top + b.height - 1 ||\n                a.top + a.height - 1 < b.top\n            );\n        }\n        for (var i in this.frame_list) {\n            var frame = this.frame_list[i];\n            if (frame.grid_location !== null && is_collision_pair(g, frame.grid_location)) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    /** Return location/grid rank */\n    _locationRank: function(loc) {\n        return loc.top * this.cols + loc.left;\n    },\n\n    /*\n        PANEL/WINDOW FUNCTIONS\n    */\n\n    /** Refresh panel */\n    _panelRefresh: function(animate) {\n        this.cols = parseInt($(window).width() / this.options.cell, 10) + 1;\n        this._frameInsert(null, null, animate);\n    },\n\n    /** Complete panel animation / frames not moving */\n    _panelAnimationComplete: function() {\n        var self = this;\n        $(\".frame\")\n            .promise()\n            .done(() => {\n                self._panelScroll(0, true);\n            });\n    },\n\n    /** Scroll panel */\n    _panelScroll: function(delta, animate) {\n        var top_new = this.top - this.options.scroll * delta;\n        top_new = Math.max(top_new, this.top_max);\n        top_new = Math.min(top_new, this.options.top_min);\n        if (this.top != top_new) {\n            for (var i in this.frame_list) {\n                var frame = this.frame_list[i];\n                if (frame.grid_location !== null) {\n                    var screen_location = {\n                        top: frame.screen_location.top - (this.top - top_new),\n                        left: frame.screen_location.left\n                    };\n                    this._frameOffset(frame, screen_location, animate);\n                }\n            }\n            this.top = top_new;\n        }\n        this.render();\n    },\n\n    /*\n        FRAME FUNCTIONS\n    */\n\n    /** Initialize a new frame */\n    _frameInit: function(frame, id) {\n        frame.id = id;\n        frame.screen_location = {};\n        frame.grid_location = {};\n        frame.grid_rank = null;\n        frame.$el.attr(\"id\", id.substring(1));\n    },\n\n    /** Insert frame at given location */\n    _frameInsert: function(frame, new_loc, animate) {\n        var self = this;\n        var place_list = [];\n        if (frame) {\n            frame.grid_location = null;\n            place_list.push([frame, this._locationRank(new_loc)]);\n        }\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                f.grid_location = null;\n                place_list.push([f, f.grid_rank]);\n            }\n        });\n        place_list.sort((a, b) => (a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0));\n        _.each(place_list, place => {\n            self._framePlace(place[0], animate);\n        });\n        this.top_max = 0;\n        _.each(this.frame_list, f => {\n            if (f.grid_location !== null) {\n                self.top_max = Math.max(self.top_max, f.grid_location.top + f.grid_location.height);\n            }\n        });\n        this.top_max = $(window).height() - this.top_max * this.options.cell - 2 * this.options.margin;\n        this.top_max = Math.min(this.top_max, this.options.top_min);\n        this.render();\n    },\n\n    /** Naive frame placement */\n    _framePlace: function(frame, animate) {\n        frame.grid_location = null;\n        var g = this._toGrid(this._frameScreen(frame));\n        var done = false;\n        for (var i = 0; i < this.options.rows; i++) {\n            for (var j = 0; j < Math.max(1, this.cols - g.width); j++) {\n                g.top = i;\n                g.left = j;\n                if (!this._isCollision(g)) {\n                    done = true;\n                    break;\n                }\n            }\n            if (done) {\n                break;\n            }\n        }\n        if (done) {\n            this._frameGrid(frame, g, animate);\n        } else {\n            console.log(\"Grid dimensions exceeded.\");\n        }\n    },\n\n    /** Handle frame focussing */\n    _frameFocus: function(frame, has_focus) {\n        frame.$el.css(\"z-index\", this.frame_z + (has_focus ? 1 : 0));\n    },\n\n    /** New left/top position frame */\n    _frameOffset: function(frame, p, animate) {\n        frame.screen_location.left = p.left;\n        frame.screen_location.top = p.top;\n        if (animate) {\n            this._frameFocus(frame, true);\n            var self = this;\n            frame.$el.animate({ top: p.top, left: p.left }, \"fast\", () => {\n                self._frameFocus(frame, false);\n            });\n        } else {\n            frame.$el.css({ top: p.top, left: p.left });\n        }\n    },\n\n    /** Resize frame */\n    _frameResize: function(frame, p) {\n        frame.$el.css({ width: p.width, height: p.height });\n        frame.screen_location.width = p.width;\n        frame.screen_location.height = p.height;\n    },\n\n    /** Push frame to new grid location */\n    _frameGrid: function(frame, l, animate) {\n        frame.grid_location = l;\n        this._frameOffset(frame, this._toPixel(l), animate);\n        frame.grid_rank = this._locationRank(l);\n    },\n\n    /** Get frame dimensions */\n    _frameScreen: function(frame) {\n        var p = frame.screen_location;\n        return {\n            top: p.top,\n            left: p.left,\n            width: p.width,\n            height: p.height\n        };\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/ui-frames.js","// =============================================================================\n/**\n * view for a popup menu\n */\nvar PopupMenu = Backbone.View.extend({\n    //TODO: maybe better as singleton off the Galaxy obj\n    /** Cache the desired button element and options, set up the button click handler\n     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n     */\n    initialize: function($button, options) {\n        // default settings\n        this.$button = $button;\n        if (!this.$button.length) {\n            this.$button = $(\"<div/>\");\n        }\n        this.options = options || [];\n        this.$button.data(\"popupmenu\", this);\n\n        // set up button click -> open menu behavior\n        var menu = this;\n        this.$button.click(event => {\n            // if there's already a menu open, remove it\n            $(\".popmenu-wrapper\").remove();\n            menu._renderAndShow(event);\n            return false;\n        });\n    },\n\n    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n    _renderAndShow: function(clickEvent) {\n        this.render();\n        this.$el\n            .appendTo(\"body\")\n            .css(this._getShownPosition(clickEvent))\n            .show();\n        this._setUpCloseBehavior();\n    },\n\n    // render the menu\n    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n    render: function() {\n        // render the menu body absolute and hidden, fill with template\n        this.$el\n            .addClass(\"popmenu-wrapper\")\n            .hide()\n            .css({ position: \"absolute\" })\n            .html(this.template(this.$button.attr(\"id\"), this.options));\n\n        // set up behavior on each link/anchor elem\n        if (this.options.length) {\n            var menu = this;\n            //precondition: there should be one option per li\n            this.$el.find(\"li\").each(function(i, li) {\n                var option = menu.options[i];\n\n                // if the option has 'func', call that function when the anchor is clicked\n                if (option.func) {\n                    $(this)\n                        .children(\"a.popupmenu-option\")\n                        .click(event => {\n                            option.func.call(menu, event, option);\n                            // We must preventDefault otherwise clicking \"cancel\"\n                            // on a purge or something still navigates and causes\n                            // the action.\n                            event.preventDefault();\n                            // bubble up so that an option click will call the close behavior\n                        });\n                }\n            });\n        }\n        return this;\n    },\n\n    template: function(id, options) {\n        return ['<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions(options), \"</ul>\"].join(\"\");\n    },\n\n    _templateOptions: function(options) {\n        if (!options.length) {\n            return \"<li>(no options)</li>\";\n        }\n        return _.map(options, option => {\n            if (option.divider) {\n                return '<li class=\"divider\"></li>';\n            } else if (option.header) {\n                return ['<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, \"</a></li>\"].join(\"\");\n            }\n            var href = option.href || \"javascript:void(0);\";\n            var target = option.target ? ` target=\"${option.target}\"` : \"\";\n\n            var check = option.checked ? '<span class=\"fa fa-check\"></span>' : \"\";\n\n            return [\n                '<li><a class=\"popupmenu-option\" href=\"',\n                href,\n                '\"',\n                target,\n                \">\",\n                check,\n                option.html,\n                \"</a></li>\"\n            ].join(\"\");\n        }).join(\"\");\n    },\n\n    // get the absolute position/offset for the menu\n    _getShownPosition: function(clickEvent) {\n        // display menu horiz. centered on click...\n        var menuWidth = this.$el.width();\n        var x = clickEvent.pageX - menuWidth / 2;\n\n        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n        x = Math.min(x, $(document).scrollLeft() + $(window).width() - menuWidth - 5);\n        x = Math.max(x, $(document).scrollLeft() + 5);\n        return {\n            top: clickEvent.pageY,\n            left: x\n        };\n    },\n\n    // bind an event handler to all available frames so that when anything is clicked\n    // the menu is removed from the DOM and the event handler unbinds itself\n    _setUpCloseBehavior: function() {\n        var menu = this;\n        //TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\n        // function to close popup and unbind itself\n        function closePopup(event) {\n            $(document).off(\"click.close_popup\");\n            if (window && window.parent !== window) {\n                try {\n                    $(window.parent.document).off(\"click.close_popup\");\n                } catch (err) {}\n            } else {\n                try {\n                    $(\"iframe#galaxy_main\")\n                        .contents()\n                        .off(\"click.close_popup\");\n                } catch (err) {}\n            }\n            menu.remove();\n        }\n\n        $(\"html\").one(\"click.close_popup\", closePopup);\n        if (window && window.parent !== window) {\n            try {\n                $(window.parent.document)\n                    .find(\"html\")\n                    .one(\"click.close_popup\", closePopup);\n            } catch (err) {}\n        } else {\n            try {\n                $(\"iframe#galaxy_main\")\n                    .contents()\n                    .one(\"click.close_popup\", closePopup);\n            } catch (err) {}\n        }\n    },\n\n    // add a menu option/item at the given index\n    addItem: function(item, index) {\n        // append to end if no index\n        index = index >= 0 ? index : this.options.length;\n        this.options.splice(index, 0, item);\n        return this;\n    },\n\n    // remove a menu option/item at the given index\n    removeItem: function(index) {\n        if (index >= 0) {\n            this.options.splice(index, 1);\n        }\n        return this;\n    },\n\n    // search for a menu option by its html\n    findIndexByHtml: function(html) {\n        for (var i = 0; i < this.options.length; i++) {\n            if (_.has(this.options[i], \"html\") && this.options[i].html === html) {\n                return i;\n            }\n        }\n        return null;\n    },\n\n    // search for a menu option by its html\n    findItemByHtml: function(html) {\n        return this.options[this.findIndexByHtml(html)];\n    },\n\n    // string representation\n    toString: function() {\n        return \"PopupMenu\";\n    }\n});\n/** shortcut to new for when you don't need to preserve the ref */\nPopupMenu.create = function _create($button, options) {\n    return new PopupMenu($button, options);\n};\n\n// -----------------------------------------------------------------------------\n// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n// to the newer backbone.js PopupMenu\n\n/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n *      Converts initial_options to object array used by PopupMenu.\n *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n *  @param {Object} initial_options map of key -> values, where\n *      key is option text, value is fn to call when option is clicked\n *  @returns {PopupMenu} the PopupMenu created\n */\nPopupMenu.make_popupmenu = (button_element, initial_options) => {\n    var convertedOptions = [];\n    _.each(initial_options, (optionVal, optionKey) => {\n        var newOption = { html: optionKey };\n\n        // keys with null values indicate: header\n        if (optionVal === null) {\n            // !optionVal? (null only?)\n            newOption.header = true;\n\n            // keys with function values indicate: a menu option\n        } else if (jQuery.type(optionVal) === \"function\") {\n            newOption.func = optionVal;\n        }\n        //TODO:?? any other special optionVals?\n        // there was no divider option originally\n        convertedOptions.push(newOption);\n    });\n    return new PopupMenu($(button_element), convertedOptions);\n};\n\n/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n *  @param {jQuery} $parent the element that contains the links to convert to options\n *  @param {String} selector jq selector string to find links\n *  @returns {Object[]} the options array to initialize a PopupMenu\n */\n//TODO: lose parent and selector, pass in array of links, use map to return options\nPopupMenu.convertLinksToOptions = ($parent, selector) => {\n    $parent = $($parent);\n    selector = selector || \"a\";\n    var options = [];\n    $parent.find(selector).each((elem, i) => {\n        var option = {};\n        var $link = $(elem);\n\n        // convert link text to the option text (html) and the href into the option func\n        option.html = $link.text();\n        if ($link.attr(\"href\")) {\n            var linkHref = $link.attr(\"href\");\n            var linkTarget = $link.attr(\"target\");\n            var confirmText = $link.attr(\"confirm\");\n\n            option.func = () => {\n                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n                //  if the user cancels - do nothing\n                if (confirmText && !confirm(confirmText)) {\n                    return;\n                }\n\n                // if there's no confirm attribute, or the user accepted the confirm dialog:\n                switch (linkTarget) {\n                    // relocate the center panel\n                    case \"_parent\":\n                        window.parent.location = linkHref;\n                        break;\n\n                    // relocate the entire window\n                    case \"_top\":\n                        window.top.location = linkHref;\n                        break;\n\n                    // relocate this panel\n                    default:\n                        window.location = linkHref;\n                }\n            };\n        }\n        options.push(option);\n    });\n    return options;\n};\n\n/** Create a single popupmenu from existing DOM button and anchor elements\n *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n */\nPopupMenu.fromExistingDom = ($buttonElement, $menuElement, menuElementLinkSelector) => {\n    $buttonElement = $($buttonElement);\n    $menuElement = $($menuElement);\n    var options = PopupMenu.convertLinksToOptions($menuElement, menuElementLinkSelector);\n    // we're done with the menu (having converted it to an options map)\n    $menuElement.remove();\n    return new PopupMenu($buttonElement, options);\n};\n\n/** Create all popupmenus within a document or a more specific element\n *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n *      Will be passed $menuElement, parent.\n *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n *  @returns {PopupMenu[]} array of popupmenus created\n */\nPopupMenu.make_popup_menus = (parent, menuSelector, buttonSelectorBuildFn) => {\n    parent = parent || document;\n    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n    //  which contains the id of the button that activates the menu\n    menuSelector = menuSelector || \"div[popupmenu]\";\n    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n    buttonSelectorBuildFn = buttonSelectorBuildFn || (($menuElement, parent) => `#${$menuElement.attr(\"popupmenu\")}`);\n\n    // aggregate and return all PopupMenus\n    var popupMenusCreated = [];\n    $(parent)\n        .find(menuSelector)\n        .each(function() {\n            var $menuElement = $(this);\n\n            var $buttonElement = $(parent).find(buttonSelectorBuildFn($menuElement, parent));\n\n            popupMenusCreated.push(PopupMenu.fromDom($buttonElement, $menuElement));\n            $buttonElement.addClass(\"popup\");\n        });\n    return popupMenusCreated;\n};\n\n// =============================================================================\nexport default PopupMenu;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/popup-menu.js","/**\n *  Renders tabs e.g. used in the charts editor, behaves similar to repeat and section rendering\n */\nimport Utils from \"utils/utils\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.collection = new Backbone.Collection();\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                onchange: null,\n                visible: true\n            }).set(options);\n        this.setElement($(this._template()));\n        this.$nav = this.$(\".tab-navigation\");\n        this.$content = this.$(\".tab-content\");\n        this.$el.on(\"click\", () => {\n            $(\".tooltip\").hide();\n        });\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"add\", this._add, this);\n        this.listenTo(this.collection, \"remove\", this._remove, this);\n        this.listenTo(this.collection, \"change\", this._change, this);\n        this.listenTo(this.collection, \"reset\", this._reset, this);\n        this.listenTo(this.collection, \"add remove reset\", this.render, this);\n    },\n\n    render: function() {\n        var id = this.model.get(\"current\");\n        id = this.$(`#${id}`).length > 0 ? id : this.first();\n        if (id) {\n            this.$nav.children().removeClass(\"active\");\n            this.$content.children().removeClass(\"active\");\n            this.$(`#tab-${id}`).addClass(\"active\");\n            this.$(`#${id}`).addClass(\"active\");\n        }\n        this.$el[this.model.get(\"visible\") ? \"fadeIn\" : \"fadeOut\"](\"fast\");\n        this.$nav[this.size() > 1 ? \"show\" : \"hide\"]();\n    },\n\n    /** Returns tab id for currently shown tab */\n    current: function() {\n        return this.model.get(\"current\");\n    },\n\n    /** Show tab view and highlight a tab by id */\n    show: function(id) {\n        if (id) {\n            this.model.set({ current: id, visible: true });\n            this.model.get(\"onchange\") && this.model.get(\"onchange\")(id);\n        }\n    },\n\n    /** Hide tab view */\n    hide: function() {\n        this.model.set(\"visible\", false);\n    },\n\n    /** Returns first tab */\n    first: function() {\n        var model = this.collection.first();\n        return model && model.id;\n    },\n\n    /** Returns current number of tabs */\n    size: function() {\n        return this.collection.length;\n    },\n\n    /** Adds a new tab */\n    add: function(options) {\n        this.collection.add(options);\n    },\n\n    /** Delete tab */\n    del: function(id) {\n        this.collection.remove(id);\n    },\n\n    /** Delete all tabs */\n    delAll: function() {\n        this.collection.reset();\n    },\n\n    /** Show tab */\n    showTab: function(id) {\n        this.collection.get(id).set(\"hidden\", false);\n    },\n\n    /** Hide tab */\n    hideTab: function(id) {\n        this.collection.get(id).set(\"hidden\", true);\n    },\n\n    /** Adds a new tab */\n    _add: function(tab_model) {\n        var self = this;\n        var options = tab_model.attributes;\n        this.$content.append(\n            $(\"<div/>\")\n                .attr(\"id\", options.id)\n                .addClass(\"tab-pane\")\n                .append(options.$el)\n        );\n        this.$nav.append(\n            $(this._template_tab(options))\n                .show()\n                .tooltip({\n                    title: options.tooltip,\n                    placement: \"bottom\",\n                    container: self.$el\n                })\n                .on(\"click\", e => {\n                    e.preventDefault();\n                    self.show(options.id);\n                })\n        );\n        if (this.size() == 1) {\n            this.show(options.id);\n        }\n    },\n\n    /** Delete tab */\n    _remove: function(tab_model) {\n        this.$(`#tab-${tab_model.id}`).remove();\n        this.$(`#${tab_model.id}`).remove();\n    },\n\n    /** Reset collection */\n    _reset: function() {\n        this.$nav.empty();\n        this.$content.empty();\n    },\n\n    /** Change tab */\n    _change: function(tab_model) {\n        this.$(`#tab-${tab_model.id}`)[tab_model.get(\"hidden\") ? \"hide\" : \"show\"]();\n    },\n\n    /** Main template */\n    _template: function() {\n        return $(\"<div/>\")\n            .addClass(\"ui-tabs tabbable tabs-left\")\n            .append($(\"<ul/>\").addClass(\"tab-navigation nav nav-tabs\"))\n            .append($(\"<div/>\").addClass(\"tab-content\"));\n    },\n\n    /** Tab template */\n    _template_tab: function(options) {\n        var $tmpl = $(\"<li/>\")\n            .addClass(\"tab-element\")\n            .attr(\"id\", `tab-${options.id}`)\n            .append($(\"<a/>\").attr(\"id\", `tab-title-link-${options.id}`));\n        var $href = $tmpl.find(\"a\");\n        options.icon &&\n            $href.append(\n                $(\"<i/>\")\n                    .addClass(\"tab-icon fa\")\n                    .addClass(options.icon)\n            );\n        $href.append(\n            $(\"<span/>\")\n                .attr(\"id\", `tab-title-text-${options.id}`)\n                .addClass(\"tab-title-text\")\n                .append(options.title)\n        );\n        return $tmpl;\n    }\n});\n\nexport default { View: View };\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/ui-tabs.js","//==============================================================================\nvar LOGGING_FNS = [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"];\n/** adds logging functions to an obj.prototype (or obj directly) adding a namespace for filtering\n *  @param {Object} obj\n *  @param {String} namespace\n */\nfunction addLogging(obj, namespace) {\n    var addTo = obj.prototype !== undefined ? obj.prototype : obj;\n    if (namespace !== undefined) {\n        addTo._logNamespace = namespace;\n    }\n    //yagni?: without this, may not capture Galaxy.config.debug and add Galaxy.logger properly\n    // if( window.Galaxy && window.Galaxy.config && window.Galaxy.config.debug ){\n    //     addTo.logger = window.Galaxy.logger;\n    // }\n\n    // give the object each\n    LOGGING_FNS.forEach(logFn => {\n        addTo[logFn] = function() {\n            if (!this.logger) {\n                return undefined;\n            }\n            if (this.logger.emit) {\n                return this.logger.emit(logFn, this._logNamespace, arguments);\n            }\n            if (this.logger[logFn]) {\n                //TODO:! there has to be a way to get the lineno/file into this\n                // http://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number\n                // http://www.paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/\n                return this.logger[logFn].apply(this.logger, arguments);\n            }\n            return undefined;\n        };\n    });\n    return obj;\n}\n\n//==============================================================================\nexport default addLogging;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/add-logging.js","/**\n * Model, view, and controller objects for Galaxy tools and tool panel.\n */\n\nimport * as _ from \"libs/underscore\";\nimport util from \"viz/trackster/util\";\nimport data from \"mvc/dataset/data\";\nimport ToolForm from \"mvc/tool/tool-form\";\n\n/**\n * Mixin for tracking model visibility.\n */\nvar VisibilityMixin = {\n    hidden: false,\n\n    show: function() {\n        this.set(\"hidden\", false);\n    },\n\n    hide: function() {\n        this.set(\"hidden\", true);\n    },\n\n    toggle: function() {\n        this.set(\"hidden\", !this.get(\"hidden\"));\n    },\n\n    is_visible: function() {\n        return !this.attributes.hidden;\n    }\n};\n\n/**\n * A tool parameter.\n */\nvar ToolParameter = Backbone.Model.extend({\n    defaults: {\n        name: null,\n        label: null,\n        type: null,\n        value: null,\n        html: null,\n        num_samples: 5\n    },\n\n    initialize: function(options) {\n        this.attributes.html = unescape(this.attributes.html);\n    },\n\n    copy: function() {\n        return new ToolParameter(this.toJSON());\n    },\n\n    set_value: function(value) {\n        this.set(\"value\", value || \"\");\n    }\n});\n\nvar ToolParameterCollection = Backbone.Collection.extend({\n    model: ToolParameter\n});\n\n/**\n * A data tool parameter.\n */\nvar DataToolParameter = ToolParameter.extend({});\n\n/**\n * An integer tool parameter.\n */\nvar IntegerToolParameter = ToolParameter.extend({\n    set_value: function(value) {\n        this.set(\"value\", parseInt(value, 10));\n    },\n\n    /**\n     * Returns samples from a tool input.\n     */\n    get_samples: function() {\n        return d3.scale\n            .linear()\n            .domain([this.get(\"min\"), this.get(\"max\")])\n            .ticks(this.get(\"num_samples\"));\n    }\n});\n\nvar FloatToolParameter = IntegerToolParameter.extend({\n    set_value: function(value) {\n        this.set(\"value\", parseFloat(value));\n    }\n});\n\n/**\n * A select tool parameter.\n */\nvar SelectToolParameter = ToolParameter.extend({\n    /**\n     * Returns tool options.\n     */\n    get_samples: function() {\n        return _.map(this.get(\"options\"), option => option[0]);\n    }\n});\n\n// Set up dictionary of parameter types.\nToolParameter.subModelTypes = {\n    integer: IntegerToolParameter,\n    float: FloatToolParameter,\n    data: DataToolParameter,\n    select: SelectToolParameter\n};\n\n/**\n * A Galaxy tool.\n */\nvar Tool = Backbone.Model.extend({\n    // Default attributes.\n    defaults: {\n        id: null,\n        name: null,\n        description: null,\n        target: null,\n        inputs: [],\n        outputs: []\n    },\n\n    urlRoot: `${Galaxy.root}api/tools`,\n\n    initialize: function(options) {\n        // Set parameters.\n        this.set(\n            \"inputs\",\n            new ToolParameterCollection(\n                _.map(options.inputs, p => {\n                    var p_class = ToolParameter.subModelTypes[p.type] || ToolParameter;\n                    return new p_class(p);\n                })\n            )\n        );\n    },\n\n    /**\n     *\n     */\n    toJSON: function() {\n        var rval = Backbone.Model.prototype.toJSON.call(this);\n\n        // Convert inputs to JSON manually.\n        rval.inputs = this.get(\"inputs\").map(i => i.toJSON());\n        return rval;\n    },\n\n    /**\n     * Removes inputs of a particular type; this is useful because not all inputs can be handled by\n     * client and server yet.\n     */\n    remove_inputs: function(types) {\n        var tool = this;\n\n        var incompatible_inputs = tool.get(\"inputs\").filter(input => types.indexOf(input.get(\"type\")) !== -1);\n\n        tool.get(\"inputs\").remove(incompatible_inputs);\n    },\n\n    /**\n     * Returns object copy, optionally including only inputs that can be sampled.\n     */\n    copy: function(only_samplable_inputs) {\n        var copy = new Tool(this.toJSON());\n\n        // Return only samplable inputs if flag is set.\n        if (only_samplable_inputs) {\n            var valid_inputs = new Backbone.Collection();\n            copy.get(\"inputs\").each(input => {\n                if (input.get_samples()) {\n                    valid_inputs.push(input);\n                }\n            });\n            copy.set(\"inputs\", valid_inputs);\n        }\n\n        return copy;\n    },\n\n    apply_search_results: function(results) {\n        _.indexOf(results, this.attributes.id) !== -1 ? this.show() : this.hide();\n        return this.is_visible();\n    },\n\n    /**\n     * Set a tool input's value.\n     */\n    set_input_value: function(name, value) {\n        this.get(\"inputs\")\n            .find(input => input.get(\"name\") === name)\n            .set(\"value\", value);\n    },\n\n    /**\n     * Set many input values at once.\n     */\n    set_input_values: function(inputs_dict) {\n        var self = this;\n        _.each(_.keys(inputs_dict), input_name => {\n            self.set_input_value(input_name, inputs_dict[input_name]);\n        });\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     */\n    run: function() {\n        return this._run();\n    },\n\n    /**\n     * Rerun tool using regions and a target dataset.\n     */\n    rerun: function(target_dataset, regions) {\n        return this._run({\n            action: \"rerun\",\n            target_dataset_id: target_dataset.id,\n            regions: regions\n        });\n    },\n\n    /**\n     * Returns input dict for tool's inputs.\n     */\n    get_inputs_dict: function() {\n        var input_dict = {};\n        this.get(\"inputs\").each(input => {\n            input_dict[input.get(\"name\")] = input.get(\"value\");\n        });\n        return input_dict;\n    },\n\n    /**\n     * Run tool; returns a Deferred that resolves to the tool's output(s).\n     * NOTE: this method is a helper method and should not be called directly.\n     */\n    _run: function(additional_params) {\n        // Create payload.\n        var payload = _.extend(\n            {\n                tool_id: this.id,\n                inputs: this.get_inputs_dict()\n            },\n            additional_params\n        );\n\n        // Because job may require indexing datasets, use server-side\n        // deferred to ensure that job is run. Also use deferred that\n        // resolves to outputs from tool.\n        var run_deferred = $.Deferred();\n\n        var ss_deferred = new util.ServerStateDeferred({\n            ajax_settings: {\n                url: this.urlRoot,\n                data: JSON.stringify(payload),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Run job and resolve run_deferred to tool outputs.\n        $.when(ss_deferred.go()).then(result => {\n            run_deferred.resolve(new data.DatasetCollection(result));\n        });\n        return run_deferred;\n    }\n});\n_.extend(Tool.prototype, VisibilityMixin);\n\n/**\n * Tool view.\n */\nvar ToolView = Backbone.View.extend({});\n\n/**\n * Wrap collection of tools for fast access/manipulation.\n */\nvar ToolCollection = Backbone.Collection.extend({\n    model: Tool\n});\n\n/**\n * Label or section header in tool panel.\n */\nvar ToolSectionLabel = Backbone.Model.extend(VisibilityMixin);\n\n/**\n * Section of tool panel with elements (labels and tools).\n */\nvar ToolSection = Backbone.Model.extend({\n    defaults: {\n        elems: [],\n        open: false\n    },\n\n    clear_search_results: function() {\n        _.each(this.attributes.elems, elt => {\n            elt.show();\n        });\n\n        this.show();\n        this.set(\"open\", false);\n    },\n\n    apply_search_results: function(results) {\n        var all_hidden = true;\n        var cur_label;\n        _.each(this.attributes.elems, elt => {\n            if (elt instanceof ToolSectionLabel) {\n                cur_label = elt;\n                cur_label.hide();\n            } else if (elt instanceof Tool) {\n                if (elt.apply_search_results(results)) {\n                    all_hidden = false;\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            }\n        });\n\n        if (all_hidden) {\n            this.hide();\n        } else {\n            this.show();\n            this.set(\"open\", true);\n        }\n    }\n});\n_.extend(ToolSection.prototype, VisibilityMixin);\n\n/**\n * Tool search that updates results when query is changed. Result value of null\n * indicates that query was not run; if not null, results are from search using\n * query.\n */\nvar ToolSearch = Backbone.Model.extend({\n    defaults: {\n        search_hint_string: \"search tools\",\n        min_chars_for_search: 3,\n        clear_btn_url: \"\",\n        visible: true,\n        query: \"\",\n        results: null,\n        // ESC (27) will clear the input field and tool search filters\n        clear_key: 27\n    },\n\n    urlRoot: `${Galaxy.root}api/tools`,\n\n    initialize: function() {\n        this.on(\"change:query\", this.do_search);\n    },\n\n    /**\n     * Do the search and update the results.\n     */\n    do_search: function() {\n        var query = this.attributes.query;\n\n        // If query is too short, do not search.\n        if (query.length < this.attributes.min_chars_for_search) {\n            this.set(\"results\", null);\n            return;\n        }\n\n        // Do search via AJAX.\n        var q = query;\n        // Stop previous ajax-request\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n        // Start a new ajax-request in X ms\n        $(\"#search-clear-btn\").hide();\n        $(\"#search-spinner\").show();\n        var self = this;\n        this.timer = setTimeout(() => {\n            // log the search to analytics if present\n            if (typeof ga !== \"undefined\") {\n                ga(\"send\", \"pageview\", `${Galaxy.root}?q=${q}`);\n            }\n            $.get(\n                self.urlRoot,\n                { q: q },\n                data => {\n                    self.set(\"results\", data);\n                    $(\"#search-spinner\").hide();\n                    $(\"#search-clear-btn\").show();\n                },\n                \"json\"\n            );\n        }, 400);\n    },\n\n    clear_search: function() {\n        this.set(\"query\", \"\");\n        this.set(\"results\", null);\n    }\n});\n_.extend(ToolSearch.prototype, VisibilityMixin);\n\n/**\n * Tool Panel.\n */\nvar ToolPanel = Backbone.Model.extend({\n    initialize: function(options) {\n        this.attributes.tool_search = options.tool_search;\n        this.attributes.tool_search.on(\"change:results\", this.apply_search_results, this);\n        this.attributes.tools = options.tools;\n        this.attributes.layout = new Backbone.Collection(this.parse(options.layout));\n    },\n\n    /**\n     * Parse tool panel dictionary and return collection of tool panel elements.\n     */\n    parse: function(response) {\n        // Recursive function to parse tool panel elements.\n        var self = this;\n\n        var // Helper to recursively parse tool panel.\n        parse_elt = elt_dict => {\n            var type = elt_dict.model_class;\n            // There are many types of tools; for now, anything that ends in 'Tool'\n            // is treated as a generic tool.\n            if (type.indexOf(\"Tool\") === type.length - 4) {\n                return self.attributes.tools.get(elt_dict.id);\n            } else if (type === \"ToolSection\") {\n                // Parse elements.\n                var elems = _.map(elt_dict.elems, parse_elt);\n                elt_dict.elems = elems;\n                return new ToolSection(elt_dict);\n            } else if (type === \"ToolSectionLabel\") {\n                return new ToolSectionLabel(elt_dict);\n            }\n        };\n\n        return _.map(response, parse_elt);\n    },\n\n    clear_search_results: function() {\n        this.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSection) {\n                panel_elt.clear_search_results();\n            } else {\n                // Label or tool, so just show.\n                panel_elt.show();\n            }\n        });\n    },\n\n    apply_search_results: function() {\n        var results = this.get(\"tool_search\").get(\"results\");\n        if (results === null) {\n            this.clear_search_results();\n            return;\n        }\n\n        var cur_label = null;\n        this.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSectionLabel) {\n                cur_label = panel_elt;\n                cur_label.hide();\n            } else if (panel_elt instanceof Tool) {\n                if (panel_elt.apply_search_results(results)) {\n                    if (cur_label) {\n                        cur_label.show();\n                    }\n                }\n            } else {\n                // Starting new section, so clear current label.\n                cur_label = null;\n                panel_elt.apply_search_results(results);\n            }\n        });\n    }\n});\n\n/**\n * View classes for Galaxy tools and tool panel.\n *\n * Views use the templates defined below for rendering. Views update as needed\n * based on (a) model/collection events and (b) user interactions; in this sense,\n * they are controllers are well and the HTML is the real view in the MVC architecture.\n */\n\n/**\n * Base view that handles visibility based on model's hidden attribute.\n */\nvar BaseView = Backbone.View.extend({\n    initialize: function() {\n        this.model.on(\"change:hidden\", this.update_visible, this);\n        this.update_visible();\n    },\n    update_visible: function() {\n        this.model.attributes.hidden ? this.$el.hide() : this.$el.show();\n    }\n});\n\n/**\n * Link to a tool.\n */\nvar ToolLinkView = BaseView.extend({\n    tagName: \"div\",\n\n    render: function() {\n        // create element\n        var $link = $(\"<div/>\");\n        $link.append(templates.tool_link(this.model.toJSON()));\n\n        var formStyle = this.model.get(\"form_style\", null);\n        // open upload dialog for upload tool\n        if (this.model.id === \"upload1\") {\n            $link.find(\"a\").on(\"click\", e => {\n                e.preventDefault();\n                Galaxy.upload.show();\n            });\n        } else if (formStyle === \"regular\") {\n            // regular tools\n            var self = this;\n            $link.find(\"a\").on(\"click\", e => {\n                e.preventDefault();\n                Galaxy.router.push(\"/\", {\n                    tool_id: self.model.id,\n                    version: self.model.get(\"version\")\n                });\n            });\n        }\n\n        // add element\n        this.$el.append($link);\n        return this;\n    }\n});\n\n/**\n * Panel label/section header.\n */\nvar ToolSectionLabelView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolPanelLabel\",\n\n    render: function() {\n        this.$el.append($(\"<span/>\").text(this.model.attributes.text));\n        return this;\n    }\n});\n\n/**\n * Panel section.\n */\nvar ToolSectionView = BaseView.extend({\n    tagName: \"div\",\n    className: \"toolSectionWrapper\",\n\n    initialize: function() {\n        BaseView.prototype.initialize.call(this);\n        this.model.on(\"change:open\", this.update_open, this);\n    },\n\n    render: function() {\n        // Build using template.\n        this.$el.append(templates.panel_section(this.model.toJSON()));\n\n        // Add tools to section.\n        var section_body = this.$el.find(\".toolSectionBody\");\n        _.each(this.model.attributes.elems, elt => {\n            if (elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: elt,\n                    className: \"toolTitle\"\n                });\n                tool_view.render();\n                section_body.append(tool_view.$el);\n            } else if (elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: elt\n                });\n                label_view.render();\n                section_body.append(label_view.$el);\n            } else {\n                // TODO: handle nested section bodies?\n            }\n        });\n        return this;\n    },\n\n    events: {\n        \"click .toolSectionTitle > a\": \"toggle\"\n    },\n\n    /**\n     * Toggle visibility of tool section.\n     */\n    toggle: function() {\n        this.model.set(\"open\", !this.model.attributes.open);\n    },\n\n    /**\n     * Update whether section is open or close.\n     */\n    update_open: function() {\n        this.model.attributes.open\n            ? this.$el.children(\".toolSectionBody\").slideDown(\"fast\")\n            : this.$el.children(\".toolSectionBody\").slideUp(\"fast\");\n    }\n});\n\nvar ToolSearchView = Backbone.View.extend({\n    tagName: \"div\",\n    id: \"tool-search\",\n    className: \"bar\",\n\n    events: {\n        click: \"focus_and_select\",\n        \"keyup :input\": \"query_changed\",\n        \"change :input\": \"query_changed\",\n        \"click #search-clear-btn\": \"clear\"\n    },\n\n    render: function() {\n        this.$el.append(templates.tool_search(this.model.toJSON()));\n        if (!this.model.is_visible()) {\n            this.$el.hide();\n        }\n\n        // Adjust top for issue 2907 depending on whether the messagebox is visible.\n        if ($(\"#messagebox\").is(\":visible\")) {\n            this.$el.css(\"top\", \"95px\");\n        }\n\n        this.$el.find(\"[title]\").tooltip();\n        return this;\n    },\n\n    focus_and_select: function() {\n        this.$el\n            .find(\":input\")\n            .focus()\n            .select();\n    },\n\n    clear: function() {\n        this.model.clear_search();\n        this.$el.find(\":input\").val(\"\");\n        this.focus_and_select();\n        return false;\n    },\n\n    query_changed: function(evData) {\n        // check for the 'clear key' (ESC) first\n        if (this.model.attributes.clear_key && this.model.attributes.clear_key === evData.which) {\n            this.clear();\n            return false;\n        }\n        this.model.set(\"query\", this.$el.find(\":input\").val());\n    }\n});\n\n/**\n * Tool panel view. Events triggered include:\n * tool_link_click(click event, tool_model)\n */\nvar ToolPanelView = Backbone.View.extend({\n    tagName: \"div\",\n    className: \"toolMenu\",\n\n    /**\n     * Set up view.\n     */\n    initialize: function() {\n        this.model.get(\"tool_search\").on(\"change:results\", this.handle_search_results, this);\n    },\n\n    render: function() {\n        var self = this;\n\n        // Render search.\n        var search_view = new ToolSearchView({\n            model: this.model.get(\"tool_search\")\n        });\n        search_view.render();\n        self.$el.append(search_view.$el);\n\n        // Render panel.\n        this.model.get(\"layout\").each(panel_elt => {\n            if (panel_elt instanceof ToolSection) {\n                var section_title_view = new ToolSectionView({\n                    model: panel_elt\n                });\n                section_title_view.render();\n                self.$el.append(section_title_view.$el);\n            } else if (panel_elt instanceof Tool) {\n                var tool_view = new ToolLinkView({\n                    model: panel_elt,\n                    className: \"toolTitleNoSection\"\n                });\n                tool_view.render();\n                self.$el.append(tool_view.$el);\n            } else if (panel_elt instanceof ToolSectionLabel) {\n                var label_view = new ToolSectionLabelView({\n                    model: panel_elt\n                });\n                label_view.render();\n                self.$el.append(label_view.$el);\n            }\n        });\n\n        // Setup tool link click eventing.\n        self.$el.find(\"a.tool-link\").click(function(e) {\n            // Tool id is always the first class.\n            var tool_id = $(this)\n                .attr(\"class\")\n                .split(/\\s+/)[0];\n\n            var tool = self.model.get(\"tools\").get(tool_id);\n\n            self.trigger(\"tool_link_click\", e, tool);\n        });\n\n        return this;\n    },\n\n    handle_search_results: function() {\n        var results = this.model.get(\"tool_search\").get(\"results\");\n        if (results && results.length === 0) {\n            $(\"#search-no-results\").show();\n        } else {\n            $(\"#search-no-results\").hide();\n        }\n    }\n});\n\n/**\n * View for working with a tool: setting parameters and inputs and executing the tool.\n */\nvar ToolFormView = Backbone.View.extend({\n    className: \"toolForm\",\n\n    render: function() {\n        this.$el.children().remove();\n        this.$el.append(templates.tool_form(this.model.toJSON()));\n    }\n});\n\n/**\n * Integrated tool menu + tool execution.\n */\nvar IntegratedToolMenuAndView = Backbone.View.extend({\n    className: \"toolMenuAndView\",\n\n    initialize: function() {\n        this.tool_panel_view = new ToolPanelView({\n            collection: this.collection\n        });\n        this.tool_form_view = new ToolFormView();\n    },\n\n    render: function() {\n        // Render and append tool panel.\n        this.tool_panel_view.render();\n        this.tool_panel_view.$el.css(\"float\", \"left\");\n        this.$el.append(this.tool_panel_view.$el);\n\n        // Append tool form view.\n        this.tool_form_view.$el.hide();\n        this.$el.append(this.tool_form_view.$el);\n\n        // On tool link click, show tool.\n        var self = this;\n        this.tool_panel_view.on(\"tool_link_click\", (e, tool) => {\n            // Prevents click from activating link:\n            e.preventDefault();\n            // Show tool that was clicked on:\n            self.show_tool(tool);\n        });\n    },\n\n    /**\n     * Fetch and display tool.\n     */\n    show_tool: function(tool) {\n        var self = this;\n        tool.fetch().done(() => {\n            self.tool_form_view.model = tool;\n            self.tool_form_view.render();\n            self.tool_form_view.$el.show();\n            $(\"#left\").width(\"650px\");\n        });\n    }\n});\n\n// TODO: move into relevant views\nvar templates = {\n    // the search bar at the top of the tool panel\n    tool_search: _.template(\n        [\n            '<input id=\"tool-search-query\" class=\"search-query parent-width\" name=\"query\" ',\n            'placeholder=\"<%- search_hint_string %>\" autocomplete=\"off\" type=\"text\" />',\n            '<a id=\"search-clear-btn\" title=\"clear search (esc)\"> </a>',\n            //TODO: replace with icon\n            '<span id=\"search-spinner\" class=\"search-spinner fa fa-spinner fa-spin\"></span>'\n        ].join(\"\")\n    ),\n\n    // the category level container in the tool panel (e.g. 'Get Data', 'Text Manipulation')\n    panel_section: _.template(\n        [\n            '<div class=\"toolSectionTitle\" id=\"title_<%- id %>\">',\n            '<a href=\"javascript:void(0)\"><span><%- name %></span></a>',\n            \"</div>\",\n            '<div id=\"<%- id %>\" class=\"toolSectionBody\" style=\"display: none;\">',\n            '<div class=\"toolSectionBg\"></div>',\n            \"<div>\"\n        ].join(\"\")\n    ),\n\n    // a single tool's link in the tool panel; will load the tool form in the center panel\n    tool_link: _.template(\n        [\n            '<a class=\"<%- id %> tool-link\" href=\"<%= link %>\" target=\"<%- target %>\" minsizehint=\"<%- min_width %>\">',\n            '<span class=\"labels\">',\n            \"<% _.each( labels, function( label ){ %>\",\n            '<span class=\"label label-default label-<%- label %>\">',\n            \"<%- label %>\",\n            \"</span>\",\n            \"<% }); %>\",\n            \"</span>\",\n            '<span class=\"tool-old-link\">',\n            \"<%- name %>\",\n            \"</span>\",\n            \" <%- description %>\",\n            \"</a>\"\n        ].join(\"\")\n    ),\n\n    // the tool form for entering tool parameters, viewing help and executing the tool\n    // loaded when a tool link is clicked in the tool panel\n    tool_form: _.template(\n        [\n            '<div class=\"toolFormTitle\"><%- tool.name %> (version <%- tool.version %>)</div>',\n            '<div class=\"toolFormBody\">',\n            \"<% _.each( tool.inputs, function( input ){ %>\",\n            '<div class=\"form-row\">',\n            '<label for=\"<%- input.name %>\"><%- input.label %>:</label>',\n            '<div class=\"form-row-input\">',\n            \"<%= input.html %>\",\n            \"</div>\",\n            '<div class=\"toolParamHelp\" style=\"clear: both;\">',\n            \"<%- input.help %>\",\n            \"</div>\",\n            '<div style=\"clear: both;\"></div>',\n            \"</div>\",\n            \"<% }); %>\",\n            \"</div>\",\n            '<div class=\"form-row form-actions\">',\n            '<input type=\"submit\" class=\"btn btn-primary\" name=\"runtool_btn\" value=\"Execute\" />',\n            \"</div>\",\n            '<div class=\"toolHelp\">',\n            '<div class=\"toolHelpBody\"><% tool.help %></div>',\n            \"</div>\"\n            // TODO: we need scoping here because 'help' is the dom for the help menu in the masthead\n            // which implies a leaky variable that I can't find\n        ].join(\"\"),\n        { variable: \"tool\" }\n    )\n};\n\n// Exports\nexport default {\n    ToolParameter: ToolParameter,\n    IntegerToolParameter: IntegerToolParameter,\n    SelectToolParameter: SelectToolParameter,\n    Tool: Tool,\n    ToolCollection: ToolCollection,\n    ToolSearch: ToolSearch,\n    ToolPanel: ToolPanel,\n    ToolPanelView: ToolPanelView,\n    ToolFormView: ToolFormView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/tool/tools.js","/* This is the regular tool form */\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport ToolFormBase from \"mvc/tool/tool-form-base\";\nimport Webhooks from \"mvc/webhooks\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.modal = parent.Galaxy.modal || new Modal.View();\n        this.form = new ToolFormBase(\n            Utils.merge(\n                {\n                    listen_to_history: true,\n                    always_refresh: false,\n                    buildmodel: function(process, form) {\n                        var options = form.model.attributes;\n\n                        // build request url\n                        var build_url = \"\";\n                        var build_data = {};\n                        var job_id = options.job_id;\n                        if (job_id) {\n                            build_url = `${Galaxy.root}api/jobs/${job_id}/build_for_rerun`;\n                        } else {\n                            build_url = `${Galaxy.root}api/tools/${options.id}/build`;\n                            build_data = $.extend({}, Galaxy.params);\n                            build_data[\"tool_id\"] && delete build_data[\"tool_id\"];\n                        }\n                        options.version && (build_data[\"tool_version\"] = options.version);\n\n                        // get initial model\n                        Utils.get({\n                            url: build_url,\n                            data: build_data,\n                            success: function(data) {\n                                if (!data.display) {\n                                    window.location = Galaxy.root;\n                                    return;\n                                }\n                                form.model.set(data);\n                                self._customize(form);\n                                Galaxy.emit.debug(\"tool-form-base::_buildModel()\", \"Initial tool model ready.\", data);\n                                process.resolve();\n                            },\n                            error: function(response, status) {\n                                var error_message = (response && response.err_msg) || \"Uncaught error.\";\n                                if (status == 401) {\n                                    window.location = `${Galaxy.root}user/login?${$.param({\n                                        redirect: `${Galaxy.root}?tool_id=${options.id}`\n                                    })}`;\n                                } else if (form.$el.is(\":empty\")) {\n                                    form.$el.prepend(\n                                        new Ui.Message({\n                                            message: error_message,\n                                            status: \"danger\",\n                                            persistent: true,\n                                            large: true\n                                        }).$el\n                                    );\n                                } else {\n                                    Galaxy.modal &&\n                                        Galaxy.modal.show({\n                                            title: \"Tool request failed\",\n                                            body: error_message,\n                                            buttons: {\n                                                Close: function() {\n                                                    Galaxy.modal.hide();\n                                                }\n                                            }\n                                        });\n                                }\n                                Galaxy.emit.debug(\n                                    \"tool-form-base::_buildModel()\",\n                                    \"Initial tool model request failed.\",\n                                    response\n                                );\n                                process.reject();\n                            }\n                        });\n                    },\n                    postchange: function(process, form) {\n                        var current_state = {\n                            tool_id: form.model.get(\"id\"),\n                            tool_version: form.model.get(\"version\"),\n                            inputs: $.extend(true, {}, form.data.create())\n                        };\n                        form.wait(true);\n                        Galaxy.emit.debug(\"tool-form::postchange()\", \"Sending current state.\", current_state);\n                        Utils.request({\n                            type: \"POST\",\n                            url: `${Galaxy.root}api/tools/${form.model.get(\"id\")}/build`,\n                            data: current_state,\n                            success: function(data) {\n                                form.update(data);\n                                form.wait(false);\n                                Galaxy.emit.debug(\"tool-form::postchange()\", \"Received new model.\", data);\n                                process.resolve();\n                            },\n                            error: function(response) {\n                                Galaxy.emit.debug(\"tool-form::postchange()\", \"Refresh request failed.\", response);\n                                process.reject();\n                            }\n                        });\n                    }\n                },\n                options\n            )\n        );\n        this.deferred = this.form.deferred;\n        this.setElement(\"<div/>\");\n        this.$el.append(this.form.$el);\n    },\n\n    _customize: function(form) {\n        var self = this;\n        var options = form.model.attributes;\n        // build execute button\n        var execute_button = new Ui.Button({\n            icon: \"fa-check\",\n            tooltip: `Execute: ${options.name} (${options.version})`,\n            title: \"Execute\",\n            cls: \"btn btn-primary ui-clear-float\",\n            wait_cls: \"btn btn-info ui-clear-float\",\n            onclick: function() {\n                execute_button.wait();\n                form.portlet.disable();\n                self.submit(options, () => {\n                    execute_button.unwait();\n                    form.portlet.enable();\n                });\n            }\n        });\n        options.buttons = { execute: execute_button };\n\n        // remap feature\n        if (options.job_id && options.job_remap) {\n            options.inputs.push({\n                label: \"Resume dependencies from this job\",\n                name: \"rerun_remap_job_id\",\n                type: \"select\",\n                display: \"radio\",\n                ignore: \"__ignore__\",\n                value: \"__ignore__\",\n                options: [[\"Yes\", options.job_id], [\"No\", \"__ignore__\"]],\n                help:\n                    \"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.\"\n            });\n        }\n    },\n\n    /** Submit a regular job.\n     * @param{dict}     options   - Specifies tool id and version\n     * @param{function} callback  - Called when request has completed\n     */\n    submit: function(options, callback) {\n        var self = this;\n        var job_def = {\n            tool_id: options.id,\n            tool_version: options.version,\n            inputs: this.form.data.create()\n        };\n        this.form.trigger(\"reset\");\n        if (!self.validate(job_def)) {\n            Galaxy.emit.debug(\"tool-form::submit()\", \"Submission canceled. Validation failed.\");\n            callback && callback();\n            return;\n        }\n        if (options.action !== `${Galaxy.root}tool_runner/index`) {\n            var $f = $(\"<form/>\").attr({\n                action: options.action,\n                method: options.method,\n                enctype: options.enctype\n            });\n            _.each(job_def.inputs, (value, key) => {\n                $f.append($(\"<input/>\").attr({ name: key, value: value }));\n            });\n            $f\n                .hide()\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n            callback && callback();\n            return;\n        }\n        Galaxy.emit.debug(\"tool-form::submit()\", \"Validation complete.\", job_def);\n        Utils.request({\n            type: \"POST\",\n            url: `${Galaxy.root}api/tools`,\n            data: job_def,\n            success: function(response) {\n                callback && callback();\n                self.$el.children().hide();\n                self.$el.append(self._templateSuccess(response));\n                // Show Webhook if job is running\n                if (response.jobs && response.jobs.length > 0) {\n                    self.$el.append($(\"<div/>\", { id: \"webhook-view\" }));\n                    var WebhookApp = new Webhooks.WebhookView({\n                        urlRoot: `${Galaxy.root}api/webhooks/tool`,\n                        toolId: job_def.tool_id\n                    });\n                }\n                parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.refreshContents();\n            },\n            error: function(response) {\n                callback && callback();\n                Galaxy.emit.debug(\"tool-form::submit\", \"Submission failed.\", response);\n                var input_found = false;\n                if (response && response.err_data) {\n                    var error_messages = self.form.data.matchResponse(response.err_data);\n                    for (var input_id in error_messages) {\n                        self.form.highlight(input_id, error_messages[input_id]);\n                        input_found = true;\n                        break;\n                    }\n                }\n                if (!input_found) {\n                    self.modal.show({\n                        title: \"Job submission failed\",\n                        body: self._templateError(job_def, response && response.err_msg),\n                        buttons: {\n                            Close: function() {\n                                self.modal.hide();\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    },\n\n    /** Validate job dictionary.\n     * @param{dict}     job_def   - Job execution dictionary\n     */\n    validate: function(job_def) {\n        var job_inputs = job_def.inputs;\n        var batch_n = -1;\n        var batch_src = null;\n        for (var job_input_id in job_inputs) {\n            var input_value = job_inputs[job_input_id];\n            var input_id = this.form.data.match(job_input_id);\n            var input_field = this.form.field_list[input_id];\n            var input_def = this.form.input_list[input_id];\n            if (!input_id || !input_def || !input_field) {\n                Galaxy.emit.debug(\"tool-form::validate()\", \"Retrieving input objects failed.\");\n                continue;\n            }\n            if (!input_def.optional && input_value == null) {\n                this.form.highlight(input_id);\n                return false;\n            }\n            if (input_value && input_value.batch) {\n                var n = input_value.values.length;\n                var src = n > 0 && input_value.values[0] && input_value.values[0].src;\n                if (src) {\n                    if (batch_src === null) {\n                        batch_src = src;\n                    } else if (batch_src !== src) {\n                        this.form.highlight(\n                            input_id,\n                            \"Please select either dataset or dataset list fields for all batch mode fields.\"\n                        );\n                        return false;\n                    }\n                }\n                if (batch_n === -1) {\n                    batch_n = n;\n                } else if (batch_n !== n) {\n                    this.form.highlight(\n                        input_id,\n                        `Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>${\n                            n\n                        }</b> selection(s) while a previous field contains <b>${batch_n}</b>.`\n                    );\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n\n    _templateSuccess: function(response) {\n        if (response.jobs && response.jobs.length > 0) {\n            var njobs = response.jobs.length;\n            var njobs_text = njobs == 1 ? \"1 job has\" : `${njobs} jobs have`;\n            var $message = $(\"<div/>\")\n                .addClass(\"donemessagelarge\")\n                .append(\n                    $(\"<p/>\").text(\n                        `${njobs_text} been successfully added to the queue - resulting in the following datasets:`\n                    )\n                );\n            _.each(response.outputs, output => {\n                $message.append(\n                    $(\"<p/>\")\n                        .addClass(\"messagerow\")\n                        .append($(\"<b/>\").text(`${output.hid}: ${output.name}`))\n                );\n            });\n            $message.append(\n                $(\"<p/>\")\n                    .append(\"<b/>\")\n                    .text(\n                        \"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"\n                    )\n            );\n            return $message;\n        } else {\n            return this._templateError(response, \"Invalid success response. No jobs found.\");\n        }\n    },\n\n    _templateError: function(response, err_msg) {\n        return $(\"<div/>\")\n            .addClass(\"errormessagelarge\")\n            .append(\n                $(\"<p/>\").text(\n                    `The server could not complete the request. Please contact the Galaxy Team if this error persists. ${err_msg ||\n                        \"\"}`\n                )\n            )\n            .append($(\"<pre/>\").text(JSON.stringify(response, null, 4)));\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/tool/tool-form.js","// dependencies\n\n// grid model\nexport default Backbone.Model.extend({\n    defaults: {\n        url_base: \"\",\n        async: false,\n        async_ops: [],\n        categorical_filters: [],\n        filters: {},\n        sort_key: null,\n        show_item_checkboxes: false,\n        advanced_search: false,\n        cur_page: 1,\n        num_pages: 1,\n        operation: undefined,\n        item_ids: undefined\n    },\n\n    /**\n     * Return true if operation can be done asynchronously.\n     */\n    can_async_op: function(op) {\n        return _.indexOf(this.attributes.async_ops, op) !== -1;\n    },\n\n    /**\n     * Add filtering criterion.\n     */\n    add_filter: function(key, value, append) {\n        // Update URL arg with new condition.\n        if (append) {\n            // Update or append value.\n            var cur_val = this.attributes.filters[key];\n\n            var new_val;\n            if (cur_val === null || cur_val === undefined) {\n                new_val = value;\n            } else if (typeof cur_val == \"string\") {\n                if (cur_val == \"All\" || cur_val == value) {\n                    new_val = value;\n                } else {\n                    // Replace string with array.\n                    var values = [];\n                    values[0] = cur_val;\n                    values[1] = value;\n                    new_val = values;\n                }\n            } else {\n                // Current value is an array.\n                new_val = cur_val;\n                if (new_val.indexOf(value) === -1) {\n                    new_val.push(value);\n                }\n            }\n            this.attributes.filters[key] = new_val;\n        } else {\n            // Replace value.\n            this.attributes.filters[key] = value;\n        }\n    },\n\n    /**\n     * Remove filtering criterion.\n     */\n    remove_filter: function(key, condition) {\n        var cur_val = this.attributes.filters[key];\n        if (cur_val === null || cur_val === undefined) {\n            return false;\n        }\n\n        if (typeof cur_val === \"string\") {\n            // overwrite/remove condition.\n            this.attributes.filters[key] = \"\";\n        } else {\n            // filter contains an array of conditions.\n            var condition_index = _.indexOf(cur_val, condition);\n            if (condition_index !== -1) {\n                cur_val[condition_index] = \"\";\n            }\n        }\n    },\n\n    /**\n     * Returns URL data for obtaining a new grid.\n     */\n    get_url_data: function() {\n        var url_data = {\n            async: this.attributes.async,\n            sort: this.attributes.sort_key,\n            page: this.attributes.cur_page,\n            show_item_checkboxes: this.attributes.show_item_checkboxes,\n            advanced_search: this.attributes.advanced_search\n        };\n\n        // Add operation, item_ids only if they have values.\n        if (this.attributes.operation) {\n            url_data.operation = this.attributes.operation;\n        }\n        if (this.attributes.item_ids) {\n            url_data.id = this.attributes.item_ids;\n        }\n\n        // Add filter arguments to data, placing \"f-\" in front of all arguments.\n        var self = this;\n        _.each(_.pairs(self.attributes.filters), k => {\n            url_data[`f-${k[0]}`] = k[1];\n        });\n        return url_data;\n    },\n\n    // Return URL for obtaining a new grid\n    get_url: function(args) {\n        return `${this.get(\"url_base\")}?${$.param(this.get_url_data())}&${$.param(args)}`;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/grid/grid-model.js","// dependencies\nimport Utils from \"utils/utils\";\n// grid view templates\nexport default {\n    // template\n    grid: function(options) {\n        var tmpl = \"\";\n        if (options.embedded) {\n            tmpl = this.grid_header(options) + this.grid_table(options);\n        } else {\n            tmpl = `<div class=\"loading-elt-overlay\"></div><table><tr><td width=\"75%\">${this.grid_header(\n                options\n            )}</td><td></td><td></td></tr><tr><td width=\"100%\" id=\"grid-message\" valign=\"top\"></td><td></td><td></td></tr></table>${this.grid_table(\n                options\n            )}`;\n        }\n\n        // add info text\n        if (options.info_text) {\n            tmpl += `<br><div class=\"toolParamHelp\" style=\"clear: both;\">${options.info_text}</div>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    grid_table: function(options) {\n        return (\n            '<form method=\"post\" onsubmit=\"return false;\">' +\n            '<table id=\"grid-table\" class=\"grid\">' +\n            '<thead id=\"grid-table-header\"></thead>' +\n            '<tbody id=\"grid-table-body\"></tbody>' +\n            '<tfoot id=\"grid-table-footer\"></tfoot>' +\n            \"</table>\" +\n            \"</form>\"\n        );\n    },\n\n    // template\n    grid_header: function(options) {\n        var tmpl = '<div class=\"grid-header\">';\n        if (!options.embedded) {\n            tmpl += `<h2>${options.title}</h2>`;\n        }\n        if (options.global_actions) {\n            tmpl += '<ul class=\"manage-table-actions\">';\n            var show_popup = options.global_actions.length >= 3;\n            if (show_popup) {\n                tmpl +=\n                    '<li><a class=\"action-button\" id=\"popup-global-actions\" class=\"menubutton\">Actions</a></li>' +\n                    '<div popupmenu=\"popup-global-actions\">';\n            }\n            for (var i in options.global_actions) {\n                var action = options.global_actions[i];\n                tmpl += `<li><a class=\"action-button use-target\" target=\"${action.target}\" href=\"${\n                    action.url_args\n                }\" onclick=\"return false;\" >${action.label}</a></li>`;\n            }\n            if (show_popup) {\n                tmpl += \"</div>\";\n            }\n            tmpl += \"</ul>\";\n        }\n        if (options.insert) {\n            tmpl += options.insert;\n        }\n\n        // add grid filters\n        tmpl += this.grid_filters(options);\n        tmpl += \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    header: function(options) {\n        // start\n        var tmpl = \"<tr>\";\n\n        // add checkbox\n        if (options.show_item_checkboxes) {\n            tmpl += \"<th>\";\n            if (options.items.length > 0) {\n                tmpl +=\n                    '<input type=\"checkbox\" id=\"check_all\" name=select_all_checkbox value=\"true\">' +\n                    '<input type=\"hidden\" name=select_all_checkbox value=\"true\">';\n            }\n            tmpl += \"</th>\";\n        }\n\n        // create header elements\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.visible) {\n                tmpl += `<th id=\"${column.key}-header\">`;\n                if (column.href) {\n                    tmpl += `<a href=\"${column.href}\" class=\"sort-link\" sort_key=\"${column.key}\">${column.label}</a>`;\n                } else {\n                    tmpl += column.label;\n                }\n                tmpl += `<span class=\"sort-arrow\">${column.extra}</span></th>`;\n            }\n        }\n\n        // finalize\n        tmpl += \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    body: function(options) {\n        // initialize\n        var tmpl = \"\";\n        var num_rows_rendered = 0;\n        var items_length = options.items.length;\n\n        // empty grid?\n        if (items_length == 0) {\n            // No results.\n            tmpl += '<tr><td colspan=\"100\"><em>No Items</em></td></tr>';\n            num_rows_rendered = 1;\n        }\n\n        // create rows\n        for (var i in options.items) {\n            // encode ids\n            var item = options.items[i];\n            var encoded_id = item.encode_id;\n            var popupmenu_id = `grid-${i}-popup`;\n\n            // Tag current\n            tmpl += \"<tr \";\n            if (options.current_item_id == item.id) {\n                tmpl += 'class=\"current\"';\n            }\n            tmpl += \">\";\n\n            // Item selection column\n            if (options.show_item_checkboxes) {\n                tmpl += `<td style=\"width: 1.5em;\"><input type=\"checkbox\" name=\"id\" value=\"${encoded_id}\" id=\"${\n                    encoded_id\n                }\" class=\"grid-row-select-checkbox\" /></td>`;\n            }\n\n            // Data columns\n            for (var j in options.columns) {\n                var column = options.columns[j];\n                if (column.visible) {\n                    // Nowrap\n                    var nowrap = \"\";\n                    if (column.nowrap) {\n                        nowrap = 'style=\"white-space:nowrap;\"';\n                    }\n\n                    // get column settings\n                    var column_settings = item.column_config[column.label];\n\n                    // load attributes\n                    var link = column_settings.link;\n                    var value = column_settings.value;\n                    var target = column_settings.target;\n\n                    // unescape value\n                    if (jQuery.type(value) === \"string\") {\n                        value = value.replace(/\\/\\//g, \"/\");\n                    }\n\n                    // Attach popup menu?\n                    var id = \"\";\n                    var cls = \"\";\n                    if (column.attach_popup) {\n                        id = `grid-${i}-popup`;\n                        cls = \"menubutton\";\n                        if (link != \"\") {\n                            cls += \" split\";\n                        }\n                        cls += \" popup\";\n                    }\n\n                    // Check for row wrapping\n                    tmpl += `<td ${nowrap}>`;\n\n                    // Link\n                    if (link) {\n                        if (options.operations.length != 0) {\n                            tmpl += `<div id=\"${id}\" class=\"${cls}\" style=\"float: left;\">`;\n                        }\n                        tmpl += `<a class=\"menubutton-label use-target\" target=\"${target}\" href=\"${\n                            link\n                        }\" onclick=\"return false;\">${value}</a>`;\n                        if (options.operations.length != 0) {\n                            tmpl += \"</div>\";\n                        }\n                    } else {\n                        tmpl += `<div id=\"${id}\" class=\"${cls}\"><label id=\"${column.label_id_prefix}${\n                            encoded_id\n                        }\" for=\"${encoded_id}\">${value || \"\"}</label></div>`;\n                    }\n                    tmpl += \"</td>\";\n                }\n            }\n            tmpl += \"</tr>\";\n            num_rows_rendered++;\n        }\n        return tmpl;\n    },\n\n    // template\n    footer: function(options) {\n        // create template string\n        var tmpl = \"\";\n\n        // paging\n        if (options.use_paging && options.num_pages > 1) {\n            // get configuration\n            var num_page_links = options.num_page_links;\n            var cur_page_num = options.cur_page_num;\n            var num_pages = options.num_pages;\n\n            // First pass on min page.\n            var page_link_range = num_page_links / 2;\n            var min_page = cur_page_num - page_link_range;\n            var min_offset = 0;\n            if (min_page <= 0) {\n                // Min page is too low.\n                min_page = 1;\n                min_offset = page_link_range - (cur_page_num - min_page);\n            }\n\n            // Set max page.\n            var max_range = page_link_range + min_offset;\n            var max_page = cur_page_num + max_range;\n            var max_offset;\n            if (max_page <= num_pages) {\n                // Max page is fine.\n                max_offset = 0;\n            } else {\n                // Max page is too high.\n                max_page = num_pages;\n                // +1 to account for the +1 in the loop below.\n                max_offset = max_range - (max_page + 1 - cur_page_num);\n            }\n\n            // Second and final pass on min page to add any unused\n            // offset from max to min.\n            if (max_offset != 0) {\n                min_page -= max_offset;\n                if (min_page < 1) {\n                    min_page = 1;\n                }\n            }\n\n            // template header\n            tmpl += '<tr id=\"page-links-row\">';\n            if (options.show_item_checkboxes) {\n                tmpl += \"<td></td>\";\n            }\n            tmpl += '<td colspan=\"100\">' + '<span id=\"page-link-container\">' + \"Page:\";\n\n            if (min_page > 1) {\n                tmpl +=\n                    '<span class=\"page-link\" id=\"page-link-1\"><a href=\"javascript:void(0);\" page_num=\"1\" onclick=\"return false;\">1</a></span> ...';\n            }\n\n            // create page urls\n            for (var page_index = min_page; page_index < max_page + 1; page_index++) {\n                if (page_index == options.cur_page_num) {\n                    tmpl += `<span class=\"page-link inactive-link\" id=\"page-link-${page_index}\">${page_index}</span>`;\n                } else {\n                    tmpl += `<span class=\"page-link\" id=\"page-link-${\n                        page_index\n                    }\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${page_index}\">${\n                        page_index\n                    }</a></span>`;\n                }\n            }\n\n            // show last page\n            if (max_page < num_pages) {\n                tmpl += `...<span class=\"page-link\" id=\"page-link-${\n                    num_pages\n                }\"><a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"${num_pages}\">${\n                    num_pages\n                }</a></span>`;\n            }\n            tmpl += \"</span>\";\n\n            // Show all link\n            tmpl +=\n                '<span class=\"page-link\" id=\"show-all-link-span\"> | <a href=\"javascript:void(0);\" onclick=\"return false;\" page_num=\"all\">Show All</a></span>' +\n                \"</td>\" +\n                \"</tr>\";\n        }\n\n        // Grid operations for multiple items.\n        if (options.show_item_checkboxes) {\n            // start template\n            tmpl +=\n                \"<tr>\" +\n                '<input type=\"hidden\" id=\"operation\" name=\"operation\" value=\"\">' +\n                \"<td></td>\" +\n                '<td colspan=\"100\">' +\n                'For <span class=\"grid-selected-count\"></span> selected items: ';\n\n            // configure buttons for operations\n            for (var i in options.operations) {\n                var operation = options.operations[i];\n                if (operation.allow_multiple) {\n                    tmpl += `<input type=\"button\" value=\"${\n                        operation.label\n                    }\" class=\"operation-button action-button\">&nbsp;`;\n                }\n            }\n\n            // finalize template\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // count global operations\n        var found_global = false;\n        for (i in options.operations) {\n            if (options.operations[i].global_operation) {\n                found_global = true;\n                break;\n            }\n        }\n\n        // add global operations\n        if (found_global) {\n            tmpl += \"<tr>\" + '<td colspan=\"100\">';\n            for (i in options.operations) {\n                var operation = options.operations[i];\n                if (operation.global_operation) {\n                    tmpl += `<a class=\"action-button\" href=\"${operation.global_operation}\">${operation.label}</a>`;\n                }\n            }\n            tmpl += \"</td>\" + \"</tr>\";\n        }\n\n        // add legend\n        if (options.legend) {\n            tmpl += `<tr><td colspan=\"100\">${options.legend}</td></tr>`;\n        }\n\n        // return\n        return tmpl;\n    },\n\n    // template\n    message: function(options) {\n        var status = options.status;\n        if ([\"success\", \"ok\"].indexOf(status) != -1) {\n            status = \"done\";\n        }\n        return `<p><div class=\"${status}message transient-message\">${_.escape(\n            options.message\n        )}</div><div style=\"clear: both\"></div></p>`;\n    },\n\n    // template\n    grid_filters: function(options) {\n        // get filters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n\n        // show advanced search if flag set or if there are filters for advanced search fields\n        var advanced_search_display = \"none\";\n        if (options.advanced_search) {\n            advanced_search_display = \"block\";\n        }\n\n        // identify columns with advanced filtering\n        var show_advanced_search_link = false;\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"advanced\") {\n                var column_key = column.key;\n                var f_key = filters[column_key];\n                var d_key = default_filter_dict[column_key];\n                if (f_key && d_key && f_key != d_key) {\n                    advanced_search_display = \"block\";\n                }\n                show_advanced_search_link = true;\n            }\n        }\n\n        // hide standard search if advanced is shown\n        var standard_search_display = \"block\";\n        if (advanced_search_display == \"block\") {\n            standard_search_display = \"none\";\n        }\n\n        //\n        // standard search\n        //\n        var tmpl = `<div id=\"standard-search\" style=\"display: ${\n            standard_search_display\n        };\"><table><tr><td style=\"padding: 0;\"><table>`;\n\n        // add standard filters\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"standard\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize standard search\n        tmpl += \"</table>\" + \"</td>\" + \"</tr>\" + \"<tr>\" + \"<td>\";\n\n        // show advanced search link in standard display\n        if (show_advanced_search_link) {\n            tmpl += '<a href=\"\" class=\"advanced-search-toggle\">Advanced Search</a>';\n        }\n\n        // finalize standard search display\n        tmpl += \"</td>\" + \"</tr>\" + \"</table>\" + \"</div>\";\n\n        //\n        // advanced search\n        //\n        tmpl += `<div id=\"advanced-search\" style=\"display: ${\n            advanced_search_display\n        }; margin-top: 5px; border: 1px solid #ccc;\"><table><tr><td style=\"text-align: left\" colspan=\"100\"><a href=\"\" class=\"advanced-search-toggle\">Close Advanced Search</a></td></tr>`;\n\n        // add advanced filters\n        for (var i in options.columns) {\n            var column = options.columns[i];\n            if (column.filterable == \"advanced\") {\n                tmpl += this.grid_column_filter(options, column);\n            }\n        }\n\n        // finalize advanced search template\n        tmpl += \"</table>\" + \"</div>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template\n    grid_column_filter: function(options, column) {\n        // collect parameters\n        var default_filter_dict = options.default_filter_dict;\n        var filters = options.filters;\n        var column_label = column.label;\n        var column_key = column.key;\n        if (column.filterable == \"advanced\") {\n            column_label = column_label.toLowerCase();\n        }\n\n        // start\n        var tmpl = \"<tr>\";\n\n        if (column.filterable == \"advanced\") {\n            tmpl += `<td align=\"left\" style=\"padding-left: 10px\">${column_label}:</td>`;\n        }\n        tmpl += '<td style=\"padding-bottom: 1px;\">';\n        if (column.is_text) {\n            tmpl += `<form class=\"text-filter-form\" column_key=\"${column_key}\" action=\"${options.url}\" method=\"get\" >`;\n            // Carry forward filtering criteria with hidden inputs.\n            for (i in options.columns) {\n                var temp_column = options.columns[i];\n                var filter_value = filters[temp_column.key];\n                if (filter_value) {\n                    if (filter_value != \"All\") {\n                        if (temp_column.is_text) {\n                            filter_value = JSON.stringify(filter_value);\n                        }\n                        tmpl += `<input type=\"hidden\" id=\"${temp_column.key}\" name=\"f-${temp_column.key}\" value=\"${\n                            filter_value\n                        }\"/>`;\n                    }\n                }\n            }\n            // Print current filtering criteria and links to delete.\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add filters\n            var column_filter = filters[column_key];\n            if (column_filter) {\n                // identify type\n                var type = jQuery.type(column_filter);\n\n                // single filter value\n                if (type == \"string\") {\n                    if (column_filter != \"All\") {\n                        // append template\n                        tmpl += this.filter_element(column_key, column_filter);\n                    }\n                }\n\n                // multiple filter values\n                if (type == \"array\") {\n                    for (var i in column_filter) {\n                        // get filter\n                        var filter = column_filter[i];\n\n                        // copy filters and remove entry\n                        var params = column_filter;\n                        params = params.slice(i);\n\n                        // append template\n                        tmpl += this.filter_element(column_key, filter);\n                    }\n                }\n            }\n\n            // close span\n            tmpl += \"</span>\";\n\n            // Set value, size of search input field. Minimum size is 20 characters.\n            var value = \"\";\n            if (column.filterable == \"standard\") {\n                value = column.label.toLowerCase();\n                var size = value.length;\n                if (size < 20) {\n                    size = 20;\n                }\n                // +4 to account for space after placeholder\n                size = size + 4;\n            }\n\n            // print input field for column\n            tmpl += `<span class=\"search-box\"><input class=\"search-box-input\" id=\"input-${column_key}-filter\" name=\"f-${\n                column_key\n            }\" type=\"text\" placeholder=\"${value}\" size=\"${\n                size\n            }\"/><button type=\"submit\" style=\"background: transparent; border: none; padding: 4px; margin: 0px;\"><i class=\"fa fa-search\"></i></button></span></form>`;\n        } else {\n            // filter criteria\n            tmpl += `<span id=\"${column_key}-filtering-criteria\">`;\n\n            // add category filters\n            var seperator = false;\n            for (var cf_label in options.categorical_filters[column_key]) {\n                // get category filter\n                var cf = options.categorical_filters[column_key][cf_label];\n\n                // each filter will have only a single argument, so get that single argument\n                var cf_key = \"\";\n                var cf_arg = \"\";\n                for (var key in cf) {\n                    cf_key = key;\n                    cf_arg = cf[key];\n                }\n\n                // add seperator\n                if (seperator) {\n                    tmpl += \" | \";\n                }\n                seperator = true;\n\n                // add category\n                var filter = filters[column_key];\n                if (filter && cf[column_key] && filter == cf_arg) {\n                    tmpl += `<span class=\"categorical-filter ${column_key}-filter current-filter\">${cf_label}</span>`;\n                } else {\n                    tmpl += `<span class=\"categorical-filter ${\n                        column_key\n                    }-filter\"><a href=\"javascript:void(0);\" filter_key=\"${cf_key}\" filter_val=\"${cf_arg}\">${\n                        cf_label\n                    }</a></span>`;\n                }\n            }\n            tmpl += \"</span>\";\n        }\n        tmpl += \"</td>\" + \"</tr>\";\n\n        // return template\n        return tmpl;\n    },\n\n    // template for filter items\n    filter_element: function(filter_key, filter_value) {\n        filter_value = Utils.sanitize(filter_value);\n        return `<span class=\"text-filter-val\">${filter_value}<a href=\"javascript:void(0);\" filter_key=\"${\n            filter_key\n        }\" filter_val=\"${\n            filter_value\n        }\"><i class=\"fa fa-times\" style=\"padding-left: 5px; padding-bottom: 6px;\"/></a></span>`;\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/grid/grid-template.js","/**\n * Top-level trackster code, used for creating/loading visualizations and user interface elements.\n */\n\n// global variables\nvar ui = null;\nvar view = null;\nvar browser_router = null;\n\n// trackster viewer\nimport * as _ from \"libs/underscore\";\nimport tracks from \"viz/trackster/tracks\";\nimport visualization from \"viz/visualization\";\nimport mod_icon_btn from \"mvc/ui/icon-button\";\nimport query_string from \"utils/query-string-parsing\";\nimport GridView from \"mvc/grid/grid-view\";\nimport mod_utils from \"utils/utils\";\nimport \"libs/jquery/jquery.event.drag\";\nimport \"libs/jquery/jquery.event.hover\";\nimport \"libs/jquery/jquery.mousewheel\";\nimport \"libs/jquery/jquery-ui\";\nimport \"libs/jquery/select2\";\nimport \"libs/farbtastic\";\nimport \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jquery.rating\";\nimport \"ui/editable-text\";\n/**\n * Base Object/Model for inhertiance.\n */\nvar Base = function() {\n    if (this.initialize) {\n        this.initialize.apply(this, arguments);\n    }\n};\nBase.extend = Backbone.Model.extend;\n\n/**\n * User interface controls for trackster\n */\nvar TracksterUI = Base.extend({\n    initialize: function(baseURL) {\n        mod_utils.cssLoadFile(\"static/style/jquery.rating.css\");\n        mod_utils.cssLoadFile(\"static/style/autocomplete_tagging.css\");\n        mod_utils.cssLoadFile(\"static/style/jquery-ui/smoothness/jquery-ui.css\");\n        mod_utils.cssLoadFile(\"static/style/library.css\");\n        mod_utils.cssLoadFile(\"static/style/trackster.css\");\n        this.baseURL = baseURL;\n    },\n\n    /**\n     * Save visualization, returning a Deferred object for the remote call to save.\n     */\n    save_viz: function() {\n        // show dialog\n        Galaxy.modal.show({ title: \"Saving...\", body: \"progress\" });\n\n        // Save bookmarks.\n        var bookmarks = [];\n        $(\".bookmark\").each(function() {\n            bookmarks.push({\n                position: $(this)\n                    .children(\".position\")\n                    .text(),\n                annotation: $(this)\n                    .children(\".annotation\")\n                    .text()\n            });\n        });\n\n        // FIXME: give unique IDs to Drawables and save overview as ID.\n        var overview_track_name = view.overview_drawable ? view.overview_drawable.config.get_value(\"name\") : null;\n\n        var viz_config = {\n            view: view.to_dict(),\n            viewport: {\n                chrom: view.chrom,\n                start: view.low,\n                end: view.high,\n                overview: overview_track_name\n            },\n            bookmarks: bookmarks\n        };\n\n        // Make call to save visualization.\n        return $.ajax({\n            url: `${Galaxy.root}visualization/save`,\n            type: \"POST\",\n            dataType: \"json\",\n            data: {\n                id: view.vis_id,\n                title: view.config.get_value(\"name\"),\n                dbkey: view.dbkey,\n                type: \"trackster\",\n                vis_json: JSON.stringify(viz_config)\n            }\n        })\n            .success(vis_info => {\n                Galaxy.modal.hide();\n                view.vis_id = vis_info.vis_id;\n                view.has_changes = false;\n\n                // Needed to set URL when first saving a visualization.\n                window.history.pushState({}, \"\", vis_info.url + window.location.hash);\n            })\n            .error(() => {\n                // show dialog\n                Galaxy.modal.show({\n                    title: \"Could Not Save\",\n                    body: \"Could not save visualization. Please try again later.\",\n                    buttons: {\n                        Cancel: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            });\n    },\n\n    /**\n     * Create button menu\n     */\n    createButtonMenu: function() {\n        var self = this;\n\n        var menu = mod_icon_btn.create_icon_buttons_menu(\n            [\n                {\n                    icon_class: \"plus-button\",\n                    title: \"Add tracks\",\n                    on_click: function() {\n                        visualization.select_datasets({ dbkey: view.dbkey }, new_tracks => {\n                            _.each(new_tracks, track => {\n                                view.add_drawable(tracks.object_from_template(track, view, view));\n                            });\n                        });\n                    }\n                },\n                {\n                    icon_class: \"block--plus\",\n                    title: \"Add group\",\n                    on_click: function() {\n                        view.add_drawable(\n                            new tracks.DrawableGroup(view, view, {\n                                name: \"New Group\"\n                            })\n                        );\n                    }\n                },\n                {\n                    icon_class: \"bookmarks\",\n                    title: \"Bookmarks\",\n                    on_click: function() {\n                        // HACK -- use style to determine if panel is hidden and hide/show accordingly.\n                        force_right_panel($(\"div#right\").css(\"right\") == \"0px\" ? \"hide\" : \"show\");\n                    }\n                },\n                {\n                    icon_class: \"globe\",\n                    title: \"Circster\",\n                    on_click: function() {\n                        window.location = `${self.baseURL}visualization/circster?id=${view.vis_id}`;\n                    }\n                },\n                {\n                    icon_class: \"disk--arrow\",\n                    title: \"Save\",\n                    on_click: function() {\n                        self.save_viz();\n                    }\n                },\n                {\n                    icon_class: \"cross-circle\",\n                    title: \"Close\",\n                    on_click: function() {\n                        self.handle_unsaved_changes(view);\n                    }\n                }\n            ],\n            {\n                tooltip_config: { placement: \"bottom\" }\n            }\n        );\n\n        this.buttonMenu = menu;\n        return menu;\n    },\n\n    /**\n     * Add bookmark.\n     */\n    add_bookmark: function(position, annotation, editable) {\n        // Create HTML.\n        var bookmarks_container = $(\"#right .unified-panel-body\");\n\n        var new_bookmark = $(\"<div/>\")\n            .addClass(\"bookmark\")\n            .appendTo(bookmarks_container);\n\n        var position_div = $(\"<div/>\")\n            .addClass(\"position\")\n            .appendTo(new_bookmark);\n\n        var position_link = $(\"<a href=''/>\")\n            .text(position)\n            .appendTo(position_div)\n            .click(() => {\n                view.go_to(position);\n                return false;\n            });\n\n        var annotation_div = $(\"<div/>\")\n            .text(annotation)\n            .appendTo(new_bookmark);\n\n        // If editable, enable bookmark deletion and annotation editing.\n        if (editable) {\n            var delete_icon_container = $(\"<div/>\")\n                .addClass(\"delete-icon-container\")\n                .prependTo(new_bookmark)\n                .click(() => {\n                    // Remove bookmark.\n                    new_bookmark.slideUp(\"fast\");\n                    new_bookmark.remove();\n                    view.has_changes = true;\n                    return false;\n                });\n\n            var delete_icon = $(\"<a href=''/>\")\n                .addClass(\"icon-button delete\")\n                .appendTo(delete_icon_container);\n\n            annotation_div\n                .make_text_editable({\n                    num_rows: 3,\n                    use_textarea: true,\n                    help_text: \"Edit bookmark note\"\n                })\n                .addClass(\"annotation\");\n        }\n\n        view.has_changes = true;\n        return new_bookmark;\n    },\n\n    /**\n     * Create a complete Trackster visualization. Returns view.\n     */\n    create_visualization: function(view_config, viewport_config, drawables_config, bookmarks_config, editable) {\n        // Create view.\n        var self = this;\n\n        var view = new tracks.TracksterView(_.extend(view_config, { header: false }));\n\n        view.editor = true;\n        $.when(view.load_chroms_deferred).then(chrom_info => {\n            // Viewport config.\n            if (viewport_config) {\n                var chrom = viewport_config.chrom;\n                var start = viewport_config.start;\n                var end = viewport_config.end;\n                var overview_drawable_name = viewport_config.overview;\n\n                if (chrom && start !== undefined && end) {\n                    view.change_chrom(chrom, start, end);\n                } else {\n                    // No valid viewport, so use first chromosome.\n                    view.change_chrom(chrom_info[0].chrom);\n                }\n            } else {\n                // No viewport, so use first chromosome.\n                view.change_chrom(chrom_info[0].chrom);\n            }\n\n            // Add drawables to view.\n            if (drawables_config) {\n                // FIXME: can from_dict() be used to create view and add drawables?\n                var drawable_config;\n\n                var drawable_type;\n                var drawable;\n                for (var i = 0; i < drawables_config.length; i++) {\n                    view.add_drawable(tracks.object_from_template(drawables_config[i], view, view));\n                }\n            }\n\n            // Set overview.\n            var overview_drawable;\n            for (var i = 0; i < view.drawables.length; i++) {\n                if (view.drawables[i].config.get_value(\"name\") === overview_drawable_name) {\n                    view.set_overview(view.drawables[i]);\n                    break;\n                }\n            }\n\n            // Load bookmarks.\n            if (bookmarks_config) {\n                var bookmark;\n                for (var i = 0; i < bookmarks_config.length; i++) {\n                    bookmark = bookmarks_config[i];\n                    self.add_bookmark(bookmark[\"position\"], bookmark[\"annotation\"], editable);\n                }\n            }\n\n            // View has no changes as of yet.\n            view.has_changes = false;\n        });\n\n        // Final initialization.\n        this.set_up_router({ view: view });\n\n        return view;\n    },\n\n    /**\n     * Set up location router to use hashes as track browser locations.\n     */\n    set_up_router: function(options) {\n        new visualization.TrackBrowserRouter(options);\n        Backbone.history.start();\n    },\n\n    /**\n     * Set up keyboard navigation for a visualization.\n     */\n    init_keyboard_nav: function(view) {\n        // Keyboard navigation. Scroll ~7% of height when scrolling up/down.\n        $(document).keyup(e => {\n            // Do not navigate if arrow keys used in input element.\n            if ($(e.srcElement).is(\":input\")) {\n                return;\n            }\n\n            // Key codes: left == 37, up == 38, right == 39, down == 40\n            switch (e.which) {\n                case 37:\n                    view.move_fraction(0.25);\n                    break;\n                case 38:\n                    var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() - 20);\n                    break;\n                case 39:\n                    view.move_fraction(-0.25);\n                    break;\n                case 40:\n                    var change = Math.round(view.viewport_container.height() / 15.0);\n                    view.viewport_container.scrollTop(view.viewport_container.scrollTop() + 20);\n                    break;\n            }\n        });\n    },\n\n    /**\n     * Handle unsaved changes in visualization.\n     */\n    handle_unsaved_changes: function(view) {\n        if (view.has_changes) {\n            var self = this;\n            Galaxy.modal.show({\n                title: \"Close visualization\",\n                body: \"There are unsaved changes to your visualization which will be lost if you do not save them.\",\n                buttons: {\n                    Cancel: function() {\n                        Galaxy.modal.hide();\n                    },\n                    \"Leave without Saving\": function() {\n                        $(window).off(\"beforeunload\");\n                        window.location = `${Galaxy.root}visualization`;\n                    },\n                    Save: function() {\n                        $.when(self.save_viz()).then(() => {\n                            window.location = `${Galaxy.root}visualization`;\n                        });\n                    }\n                }\n            });\n        } else {\n            window.location = `${Galaxy.root}visualization`;\n        }\n    }\n});\n\nvar TracksterView = Backbone.View.extend({\n    // initalize trackster\n    initialize: function() {\n        // load ui\n        ui = new TracksterUI(Galaxy.root);\n\n        // create button menu\n        ui.createButtonMenu();\n\n        // attach the button menu to the panel header and float it left\n        ui.buttonMenu.$el.attr(\"style\", \"float: right\");\n\n        // add to center panel\n        $(\"#center .unified-panel-header-inner\").append(ui.buttonMenu.$el);\n\n        // configure right panel\n        $(\"#right .unified-panel-title\").append(\"Bookmarks\");\n        $(\"#right .unified-panel-icons\").append(\n            \"<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>\"\n        );\n\n        // resize view when showing/hiding right panel (bookmarks for now).\n        $(\"#right-border\").click(() => {\n            view.resize_window();\n        });\n\n        // hide right panel\n        force_right_panel(\"hide\");\n\n        // check if id is available\n        if (galaxy_config.app.id) {\n            this.view_existing();\n        } else if (query_string.get(\"dataset_id\")) {\n            this.choose_existing_or_new();\n        } else {\n            this.view_new();\n        }\n    },\n\n    choose_existing_or_new: function() {\n        var self = this;\n        var dbkey = query_string.get(\"dbkey\");\n        var listTracksParams = {};\n\n        var dataset_params = {\n            dbkey: dbkey,\n            dataset_id: query_string.get(\"dataset_id\"),\n            hda_ldda: query_string.get(\"hda_ldda\"),\n            gene_region: query_string.get(\"gene_region\")\n        };\n\n        if (dbkey) {\n            listTracksParams[\"f-dbkey\"] = dbkey;\n        }\n\n        Galaxy.modal.show({\n            title: \"View Data in a New or Saved Visualization?\",\n            // either have text in here or have to remove body and the header/footer margins\n            body: `<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>${dbkey ||\n                \"Not available.\"}</b></li><li>or create a new session with this dataset as the only track</li></ul></p>`,\n            buttons: {\n                Cancel: function() {\n                    window.location = `${Galaxy.root}visualizations/list`;\n                },\n                \"View in saved visualization\": function() {\n                    self.view_in_saved(dataset_params);\n                },\n                \"View in new visualization\": function() {\n                    self.view_new();\n                }\n            }\n        });\n    },\n\n    // view\n    view_in_saved: function(dataset_params) {\n        var tracks_grid = new GridView({\n            url_base: `${Galaxy.root}visualization/list_tracks`,\n            dict_format: true,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: \"Add Data to Saved Visualization\",\n            body: tracks_grid.$el,\n            buttons: {\n                Cancel: function() {\n                    window.location = `${Galaxy.root}visualizations/list`;\n                },\n                \"Add to visualization\": function() {\n                    $(parent.document)\n                        .find(\"input[name=id]:checked\")\n                        .each(function() {\n                            dataset_params.id = $(this).val();\n                            window.location = `${Galaxy.root}visualization/trackster?${$.param(dataset_params)}`;\n                        });\n                }\n            }\n        });\n    },\n\n    // view\n    view_existing: function() {\n        // get config\n        var viz_config = galaxy_config.app.viz_config;\n\n        // view\n        view = ui.create_visualization(\n            {\n                container: $(\"#center .unified-panel-body\"),\n                name: viz_config.title,\n                vis_id: viz_config.vis_id,\n                dbkey: viz_config.dbkey\n            },\n            viz_config.viewport,\n            viz_config.tracks,\n            viz_config.bookmarks,\n            true\n        );\n\n        // initialize editor\n        this.init_editor();\n    },\n\n    // view\n    view_new: function() {\n        // reference this\n        var self = this;\n\n        // ajax\n        $.ajax({\n            url: `${Galaxy.root}api/genomes?chrom_info=True`,\n            data: {},\n            error: function() {\n                alert(\"Couldn't create new browser.\");\n            },\n            success: function(response) {\n                // show dialog\n                Galaxy.modal.show({\n                    title: \"New Visualization\",\n                    body: self.template_view_new(response),\n                    buttons: {\n                        Cancel: function() {\n                            window.location = `${Galaxy.root}visualizations/list`;\n                        },\n                        Create: function() {\n                            self.create_browser($(\"#new-title\").val(), $(\"#new-dbkey\").val());\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n\n                // select default\n                var dbkeys_in_genomes = response.map(r => r[1]);\n                if (galaxy_config.app.default_dbkey && _.contains(dbkeys_in_genomes, galaxy_config.app.default_dbkey)) {\n                    $(\"#new-dbkey\").val(galaxy_config.app.default_dbkey);\n                }\n\n                // change focus\n                $(\"#new-title\").focus();\n                $(\"select[name='dbkey']\").select2();\n\n                // to support the large number of options for dbkey, enable scrolling in overlay.\n                $(\"#overlay\").css(\"overflow\", \"auto\");\n            }\n        });\n    },\n\n    // new browser form\n    template_view_new: function(response) {\n        // start template\n        var html =\n            '<form id=\"new-browser-form\" action=\"javascript:void(0);\" method=\"post\" onsubmit=\"return false;\">' +\n            '<div class=\"form-row\">' +\n            '<label for=\"new-title\">Browser name:</label>' +\n            '<div class=\"form-row-input\">' +\n            '<input type=\"text\" name=\"title\" id=\"new-title\" value=\"Unnamed\"></input>' +\n            \"</div>\" +\n            '<div style=\"clear: both;\"></div>' +\n            \"</div>\" +\n            '<div class=\"form-row\">' +\n            '<label for=\"new-dbkey\">Reference genome build (dbkey): </label>' +\n            '<div class=\"form-row-input\">' +\n            '<select name=\"dbkey\" id=\"new-dbkey\">';\n\n        // add dbkeys\n        for (var i = 0; i < response.length; i++) {\n            html += `<option value=\"${response[i][1]}\">${response[i][0]}</option>`;\n        }\n\n        // close selection/finalize template\n        html += `</select></div><div style=\"clear: both;\"></div></div><div class=\"form-row\">Is the build not listed here? <a href=\"${\n            Galaxy.root\n        }user/dbkeys?use_panels=True\">Add a Custom Build</a></div></form>`;\n\n        // return\n        return html;\n    },\n\n    // create\n    create_browser: function(name, dbkey) {\n        $(document).trigger(\"convert_to_values\");\n\n        view = ui.create_visualization(\n            {\n                container: $(\"#center .unified-panel-body\"),\n                name: name,\n                dbkey: dbkey\n            },\n            galaxy_config.app.gene_region\n        );\n\n        // initialize editor\n        this.init_editor();\n\n        // modify view setting\n        view.editor = true;\n    },\n\n    // initialization for editor-specific functions.\n    init_editor: function() {\n        // set title\n        $(\"#center .unified-panel-title\").text(`${view.config.get_value(\"name\")} (${view.dbkey})`);\n\n        // add dataset\n        if (galaxy_config.app.add_dataset)\n            $.ajax({\n                url: `${Galaxy.root}api/datasets/${galaxy_config.app.add_dataset}`,\n                data: { hda_ldda: \"hda\", data_type: \"track_config\" },\n                dataType: \"json\",\n                success: function(track_data) {\n                    view.add_drawable(tracks.object_from_template(track_data, view, view));\n                }\n            });\n\n        // initialize icons\n        $(\"#add-bookmark-button\").click(() => {\n            // add new bookmark.\n            var position = `${view.chrom}:${view.low}-${view.high}`;\n\n            var annotation = \"Bookmark description\";\n            return ui.add_bookmark(position, annotation, true);\n        });\n\n        // initialize keyboard\n        ui.init_keyboard_nav(view);\n\n        $(window).on(\"beforeunload\", () => {\n            if (view.has_changes) {\n                return \"There are unsaved changes to your visualization that will be lost if you leave this page.\";\n            }\n        });\n    }\n});\n\nexport default {\n    TracksterUI: TracksterUI,\n    GalaxyApp: TracksterView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster.js","import * as _ from \"libs/underscore\";\nimport visualization from \"viz/visualization\";\nimport viz_views from \"viz/viz_views\";\nimport util from \"viz/trackster/util\";\nimport slotting from \"viz/trackster/slotting\";\nimport painters from \"viz/trackster/painters\";\nimport filters_mod from \"viz/trackster/filters\";\nimport data from \"mvc/dataset/data\";\nimport tools_mod from \"mvc/tool/tools\";\nimport config_mod from \"utils/config\";\nimport bbi from \"viz/bbi-data-manager\";\nimport \"ui/editable-text\";\nvar extend = _.extend;\n\n// ---- Web UI specific utilities ----\n\n/**\n * Dictionary of HTML element-JavaScript object relationships.\n */\n// TODO: probably should separate moveable objects from containers.\nvar html_elt_js_obj_dict = {};\n\n/**\n * Designates an HTML as a container.\n */\nvar is_container = (element, obj) => {\n    html_elt_js_obj_dict[element.attr(\"id\")] = obj;\n};\n\n/**\n * Make `element` moveable within parent and sibling elements by dragging `handle` (a selector).\n * Function manages JS objects, containers as well.\n *\n * @param element HTML element to make moveable\n * @param handle_class classname that denotes HTML element to be used as handle\n * @param container_selector selector used to identify possible containers for this element\n * @param element_js_obj JavaScript object associated with element; used\n */\nvar moveable = (element, handle_class, container_selector, element_js_obj) => {\n    // HACK: set default value for container selector.\n    container_selector = \".group\";\n\n    // Register element with its object.\n    html_elt_js_obj_dict[element.attr(\"id\")] = element_js_obj;\n\n    // Need to provide selector for handle, not class.\n    element\n        .bind(\"drag\", { handle: `.${handle_class}`, relative: true }, function(e, d) {\n            var element = $(this);\n            var parent = $(this).parent();\n\n            var // Only sorting amongst tracks and groups.\n            children = parent.children(\".track,.group\");\n\n            var this_obj = html_elt_js_obj_dict[$(this).attr(\"id\")];\n            var child;\n            var container;\n            var top;\n            var bottom;\n            var i;\n\n            //\n            // Enable three types of dragging: (a) out of container; (b) into container;\n            // (c) sibling movement, aka sorting. Handle in this order for simplicity.\n            //\n\n            // Handle dragging out of container.\n            container = $(this).parents(container_selector);\n            if (container.length !== 0) {\n                top = container.position().top;\n                bottom = top + container.outerHeight();\n                var cur_container = html_elt_js_obj_dict[container.attr(\"id\")];\n                if (d.offsetY < top) {\n                    // Moving above container.\n                    $(this).insertBefore(container);\n                    cur_container.remove_drawable(this_obj);\n                    cur_container.container.add_drawable_before(this_obj, cur_container);\n                    return;\n                } else if (d.offsetY > bottom) {\n                    // Moving below container.\n                    $(this).insertAfter(container);\n                    cur_container.remove_drawable(this_obj);\n                    cur_container.container.add_drawable(this_obj);\n                    return;\n                }\n            }\n\n            // Handle dragging into container. Child is appended to container's content_div.\n            container = null;\n            for (i = 0; i < children.length; i++) {\n                child = $(children.get(i));\n                top = child.position().top;\n                bottom = top + child.outerHeight();\n                // Dragging into container if child is a container and offset is inside container.\n                if (child.is(container_selector) && this !== child.get(0) && d.offsetY >= top && d.offsetY <= bottom) {\n                    // Append/prepend based on where offsetY is closest to and return.\n                    if (d.offsetY - top < bottom - d.offsetY) {\n                        child.find(\".content-div\").prepend(this);\n                    } else {\n                        child.find(\".content-div\").append(this);\n                    }\n                    // Update containers. Object may not have container if it is being moved quickly.\n                    if (this_obj.container) {\n                        this_obj.container.remove_drawable(this_obj);\n                    }\n                    html_elt_js_obj_dict[child.attr(\"id\")].add_drawable(this_obj);\n                    return;\n                }\n            }\n\n            // Handle sibling movement, aka sorting.\n\n            // Determine new position\n            for (i = 0; i < children.length; i++) {\n                child = $(children.get(i));\n                if (\n                    d.offsetY < child.position().top &&\n                    // Cannot move tracks above reference track or intro div.\n                    !(child.hasClass(\"reference-track\") || child.hasClass(\"intro\"))\n                ) {\n                    break;\n                }\n            }\n\n            // If not already in the right place, move. Need\n            // to handle the end specially since we don't have\n            // insert at index\n            if (i === children.length) {\n                if (this !== children.get(i - 1)) {\n                    parent.append(this);\n                    html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, i);\n                }\n            } else if (this !== children.get(i)) {\n                $(this).insertBefore(children.get(i));\n                // Need to adjust insert position if moving down because move is changing\n                // indices of all list items.\n                html_elt_js_obj_dict[parent.attr(\"id\")].move_drawable(this_obj, d.deltaY > 0 ? i - 1 : i);\n            }\n        })\n        .bind(\"dragstart\", function() {\n            $(this).addClass(\"dragging\");\n        })\n        .bind(\"dragend\", function() {\n            $(this).removeClass(\"dragging\");\n        });\n};\n\n/**\n * Init constants & functions used throughout trackster.\n */\nvar // Padding at the top of tracks for error messages\nERROR_PADDING = 20;\n\nvar // Maximum number of rows un a slotted track\nMAX_FEATURE_DEPTH = 100;\n\nvar // Minimum width for window for squish to be used.\nMIN_SQUISH_VIEW_WIDTH = 12000;\n\nvar // Number of pixels per tile, not including left offset.\nTILE_SIZE = 400;\n\nvar DEFAULT_DATA_QUERY_WAIT = 5000;\n\nvar // Maximum number of chromosomes that are selectable at any one time.\nMAX_CHROMS_SELECTABLE = 100;\n\nvar DATA_ERROR = \"Cannot display dataset due to an error. \";\n\nvar DATA_NOCONVERTER = \"A converter for this dataset is not installed. Please check your datatypes_conf.xml file.\";\n\nvar DATA_NONE = \"No data for this chrom/contig.\";\n\nvar DATA_PENDING =\n    \"Preparing data. This can take a while for a large dataset. \" +\n    \"If the visualization is saved and closed, preparation will continue in the background.\";\n\nvar DATA_CANNOT_RUN_TOOL = \"Tool cannot be rerun: \";\nvar DATA_LOADING = \"Loading data...\";\nvar DATA_OK = \"Ready for display\";\nvar TILE_CACHE_SIZE = 10;\nvar DATA_CACHE_SIZE = 20;\n\nvar // Numerical/continuous data display modes.\nCONTINUOUS_DATA_MODES = [\"Histogram\", \"Line\", \"Filled\", \"Intensity\"];\n\n/**\n * Round a number to a given number of decimal places.\n */\nfunction round(num, places) {\n    // Default rounding is to integer.\n    if (!places) {\n        places = 0;\n    }\n\n    var val = Math.pow(10, places);\n    return Math.round(num * val) / val;\n}\n\n/**\n * Check if a server can do byte range requests.\n */\nfunction supportsByteRanges(url) {\n    var promise = $.Deferred();\n    $.ajax({\n        type: \"HEAD\",\n        url: url,\n        beforeSend: function(xhr) {\n            xhr.setRequestHeader(\"Range\", \"bytes=0-10\");\n        },\n        success: function(result, status, xhr) {\n            promise.resolve(xhr.status === 206);\n        }\n    });\n\n    return promise;\n}\n\n/**\n * Drawables hierarchy:\n *\n * Drawable\n *    --> DrawableCollection\n *        --> DrawableGroup\n *        --> View\n *    --> Track\n */\n\n/**\n * Base class for all drawable objects. Drawable objects are associated with a view and live in a\n * container. They have the following HTML elements and structure:\n *  <container_div>\n *      <header_div>\n *      <content_div>\n *\n * They optionally have a drag handle class.\n */\nvar Drawable = function(view, container, obj_dict) {\n    if (!Drawable.id_counter) {\n        Drawable.id_counter = 0;\n    }\n    this.id = Drawable.id_counter++;\n    this.view = view;\n    this.container = container;\n    this.drag_handle_class = obj_dict.drag_handle_class;\n    this.is_overview = false;\n    this.action_icons = {};\n\n    // -- Set up drawable configuration. --\n    this.config = config_mod.ConfigSettingCollection.from_models_and_saved_values(this.config_params, obj_dict.prefs);\n\n    // If there's no saved name, use object name.\n    if (!this.config.get_value(\"name\")) {\n        this.config.set_value(\"name\", obj_dict.name);\n    }\n    if (this.config_onchange) {\n        this.config.on(\"change\", this.config_onchange, this);\n    }\n\n    // Build Drawable HTML and behaviors.\n    this.container_div = this.build_container_div();\n    this.header_div = null;\n\n    // Use opt-out policy on header creation because this is the more frequent approach:\n    // unless flag set, create header.\n    if (obj_dict.header !== false) {\n        var header_view = new viz_views.TrackHeaderView({\n            model: this,\n            id: this.id\n        });\n\n        this.header_div = header_view.$el;\n        this.container_div.append(this.header_div);\n\n        // Show icons when users is hovering over track.\n        var icons_div = header_view.icons_div;\n        this.action_icons = header_view.action_icons;\n        this.container_div.hover(\n            () => {\n                icons_div.show();\n            },\n            () => {\n                icons_div.hide();\n            }\n        );\n    }\n};\n\nDrawable.prototype.action_icons_def = [\n    // Hide/show drawable content.\n    // FIXME: make this an odict for easier lookup.\n    {\n        name: \"toggle_icon\",\n        title: \"Hide/show content\",\n        css_class: \"toggle\",\n        on_click_fn: function(drawable) {\n            if (drawable.config.get_value(\"content_visible\")) {\n                drawable.action_icons.toggle_icon.addClass(\"toggle-expand\").removeClass(\"toggle\");\n                drawable.hide_contents();\n                drawable.config.set_value(\"content_visible\", false);\n            } else {\n                drawable.action_icons.toggle_icon.addClass(\"toggle\").removeClass(\"toggle-expand\");\n                drawable.config.set_value(\"content_visible\", true);\n                drawable.show_contents();\n            }\n        }\n    },\n    // Edit settings.\n    {\n        name: \"settings_icon\",\n        title: \"Edit settings\",\n        css_class: \"gear\",\n        on_click_fn: function(drawable) {\n            var view = new config_mod.ConfigSettingCollectionView({\n                collection: drawable.config\n            });\n            view.render_in_modal(\"Configure Track\");\n        }\n    },\n    // Remove.\n    {\n        name: \"remove_icon\",\n        title: \"Remove\",\n        css_class: \"remove-icon\",\n        on_click_fn: function(drawable) {\n            // Tooltip for remove icon must be deleted when drawable is deleted.\n            $(\".tooltip\").remove();\n            drawable.remove();\n        }\n    }\n];\n\nextend(Drawable.prototype, {\n    config_params: [\n        { key: \"name\", label: \"Name\", type: \"text\", default_value: \"\" },\n        {\n            key: \"content_visible\",\n            type: \"bool\",\n            default_value: true,\n            hidden: true\n        }\n    ],\n\n    config_onchange: function() {},\n\n    init: function() {},\n\n    changed: function() {\n        this.view.changed();\n    },\n\n    can_draw: function() {\n        if (this.enabled && this.config.get_value(\"content_visible\")) {\n            return true;\n        }\n\n        return false;\n    },\n\n    request_draw: function() {},\n\n    _draw: function(options) {},\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {},\n\n    /**\n     * Set drawable name.\n     */\n    set_name: function(new_name) {\n        this.old_name = this.config.get_value(\"name\");\n        this.config.set_value(\"name\", new_name);\n    },\n\n    /**\n     * Revert track name; currently name can be reverted only once.\n     */\n    revert_name: function() {\n        if (this.old_name) {\n            this.config.set_value(\"name\", this.old_name);\n        }\n    },\n\n    /**\n     * Remove drawable (a) from its container and (b) from the HTML.\n     */\n    remove: function() {\n        this.changed();\n\n        this.container.remove_drawable(this);\n        var view = this.view;\n        this.container_div.hide(0, function() {\n            $(this).remove();\n            // HACK: is there a better way to update the view?\n            view.update_intro_div();\n        });\n    },\n\n    /**\n     * Build drawable's container div; this is the parent div for all drawable's elements.\n     */\n    build_container_div: function() {},\n\n    /**\n     * Update icons.\n     */\n    update_icons: function() {},\n\n    /**\n     * Hide drawable's contents.\n     */\n    hide_contents: function() {},\n\n    /**\n     * Show drawable's contents.\n     */\n    show_contents: function() {},\n\n    /**\n     * Returns a shallow copy of all drawables in this drawable.\n     */\n    get_drawables: function() {}\n});\n\n/**\n * A collection of drawable objects.\n */\nvar DrawableCollection = function(view, container, obj_dict) {\n    Drawable.call(this, view, container, obj_dict);\n\n    // Attribute init.\n    this.obj_type = obj_dict.obj_type;\n    this.drawables = [];\n};\n\nextend(DrawableCollection.prototype, Drawable.prototype, {\n    /**\n     * Unpack and add drawables to the collection.\n     */\n    unpack_drawables: function(drawables_array) {\n        // Add drawables to collection.\n        this.drawables = [];\n        var drawable;\n        for (var i = 0; i < drawables_array.length; i++) {\n            drawable = object_from_template(drawables_array[i], this.view, this);\n            this.add_drawable(drawable);\n        }\n    },\n\n    /**\n     * Init each drawable in the collection.\n     */\n    init: function() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].init();\n        }\n    },\n\n    /**\n     * Draw each drawable in the collection.\n     */\n    _draw: function(options) {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i]._draw(options);\n        }\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {\n        var dictified_drawables = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            dictified_drawables.push(this.drawables[i].to_dict());\n        }\n        return {\n            prefs: this.config.to_key_value_dict(),\n            obj_type: this.obj_type,\n            drawables: dictified_drawables\n        };\n    },\n\n    /**\n     * Add a drawable to the end of the collection.\n     */\n    add_drawable: function(drawable) {\n        this.drawables.push(drawable);\n        drawable.container = this;\n        this.changed();\n    },\n\n    /**\n     * Add a drawable before another drawable.\n     */\n    add_drawable_before: function(drawable, other) {\n        this.changed();\n        var index = this.drawables.indexOf(other);\n        if (index !== -1) {\n            this.drawables.splice(index, 0, drawable);\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Replace one drawable with another.\n     */\n    replace_drawable: function(old_drawable, new_drawable, update_html) {\n        var index = this.drawables.indexOf(old_drawable);\n        if (index !== -1) {\n            this.drawables[index] = new_drawable;\n            if (update_html) {\n                old_drawable.container_div.replaceWith(new_drawable.container_div);\n            }\n            this.changed();\n        }\n        return index;\n    },\n\n    /**\n     * Remove drawable from this collection.\n     */\n    remove_drawable: function(drawable) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Found drawable to remove.\n            this.drawables.splice(index, 1);\n            drawable.container = null;\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Move drawable to another location in collection.\n     */\n    move_drawable: function(drawable, new_position) {\n        var index = this.drawables.indexOf(drawable);\n        if (index !== -1) {\n            // Remove from current position:\n            this.drawables.splice(index, 1);\n            // insert into new position:\n            this.drawables.splice(new_position, 0, drawable);\n            this.changed();\n            return true;\n        }\n        return false;\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function() {\n        return this.drawables;\n    },\n\n    /**\n     * Returns all <track_type> tracks in collection.\n     */\n    get_tracks: function(track_type) {\n        // Initialize queue with copy of drawables array.\n        var queue = this.drawables.slice(0);\n\n        var tracks = [];\n        var drawable;\n        while (queue.length !== 0) {\n            drawable = queue.shift();\n            if (drawable instanceof track_type) {\n                tracks.push(drawable);\n            } else if (drawable.drawables) {\n                queue = queue.concat(drawable.drawables);\n            }\n        }\n        return tracks;\n    }\n});\n\n/**\n * A group of drawables that are moveable, visible.\n */\nvar DrawableGroup = function(view, container, obj_dict) {\n    extend(obj_dict, {\n        obj_type: \"DrawableGroup\",\n        drag_handle_class: \"group-handle\"\n    });\n    DrawableCollection.call(this, view, container, obj_dict);\n\n    // Set up containers/moving for group: register both container_div and content div as container\n    // because both are used as containers (container div to recognize container, content_div to\n    // store elements). Group can be moved.\n    this.content_div = $(\"<div/>\")\n        .addClass(\"content-div\")\n        .attr(\"id\", `group_${this.id}_content_div`)\n        .appendTo(this.container_div);\n    is_container(this.container_div, this);\n    is_container(this.content_div, this);\n    moveable(this.container_div, this.drag_handle_class, \".group\", this);\n\n    // Set up filters.\n    this.filters_manager = new filters_mod.FiltersManager(this);\n    this.header_div.after(this.filters_manager.parent_div);\n\n    // HACK: add div to clear floating elements.\n    this.filters_manager.parent_div.after($(\"<div style='clear: both'/>\"));\n\n    // For saving drawables' filter managers when group-level filtering is done:\n    this.saved_filters_managers = [];\n\n    // Add drawables.\n    if (\"drawables\" in obj_dict) {\n        this.unpack_drawables(obj_dict.drawables);\n    }\n\n    // Restore filters.\n    if (\"filters\" in obj_dict) {\n        // FIXME: Pass collection_dict to DrawableCollection/Drawable will make this easier.\n        var old_manager = this.filters_manager;\n        this.filters_manager = new filters_mod.FiltersManager(this, obj_dict.filters);\n        old_manager.parent_div.replaceWith(this.filters_manager.parent_div);\n\n        if (obj_dict.filters.visible) {\n            this.setup_multitrack_filtering();\n        }\n    }\n};\n\nextend(DrawableGroup.prototype, Drawable.prototype, DrawableCollection.prototype, {\n    action_icons_def: [\n        Drawable.prototype.action_icons_def[0],\n        Drawable.prototype.action_icons_def[1],\n        // Replace group with composite track.\n        {\n            name: \"composite_icon\",\n            title: \"Show composite track\",\n            css_class: \"layers-stack\",\n            on_click_fn: function(group) {\n                $(\".tooltip\").remove();\n                group.show_composite_track();\n            }\n        },\n        // Toggle track filters.\n        {\n            name: \"filters_icon\",\n            title: \"Filters\",\n            css_class: \"ui-slider-050\",\n            on_click_fn: function(group) {\n                // TODO: update Tooltip text.\n                if (group.filters_manager.visible()) {\n                    // Hiding filters.\n                    group.filters_manager.clear_filters();\n                    group._restore_filter_managers();\n                    // TODO: maintain current filter by restoring and setting saved manager's\n                    // settings to current/shared manager's settings.\n                    // TODO: need to restore filter managers when moving drawable outside group.\n                } else {\n                    // Showing filters.\n                    group.setup_multitrack_filtering();\n                    group.request_draw({ clear_tile_cache: true });\n                }\n                group.filters_manager.toggle();\n            }\n        },\n        Drawable.prototype.action_icons_def[2]\n    ],\n\n    build_container_div: function() {\n        var container_div = $(\"<div/>\")\n            .addClass(\"group\")\n            .attr(\"id\", `group_${this.id}`);\n        if (this.container) {\n            this.container.content_div.append(container_div);\n        }\n        return container_div;\n    },\n\n    hide_contents: function() {\n        this.tiles_div.hide();\n    },\n\n    show_contents: function() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    update_icons: function() {\n        //\n        // Handle update when there are no tracks.\n        //\n        var num_drawables = this.drawables.length;\n        if (num_drawables === 0) {\n            this.action_icons.composite_icon.hide();\n            this.action_icons.filters_icon.hide();\n        } else if (num_drawables === 1) {\n            this.action_icons.composite_icon.toggle(this.drawables[0] instanceof CompositeTrack);\n            this.action_icons.filters_icon.hide();\n        } else {\n            // There are 2 or more tracks.\n\n            //\n            // Determine if a composite track can be created. Current criteria:\n            // (a) all tracks are line tracks;\n            //      OR\n            // FIXME: this is not enabled right now because it has not been well tested:\n            // (b) there is a single FeatureTrack.\n            //\n\n            // All tracks the same?\n            var i;\n\n            var j;\n            var drawable;\n            var same_type = true;\n            var a_type = this.drawables[0].get_type();\n            var num_feature_tracks = 0;\n            for (i = 0; i < num_drawables; i++) {\n                drawable = this.drawables[i];\n                if (drawable.get_type() !== a_type) {\n                    can_composite = false;\n                    break;\n                }\n                if (drawable instanceof FeatureTrack) {\n                    num_feature_tracks++;\n                }\n            }\n\n            if (same_type && this.drawables[0] instanceof LineTrack) {\n                this.action_icons.composite_icon.show();\n            } else {\n                this.action_icons.composite_icon.hide();\n                $(\".tooltip\").remove();\n            }\n\n            //\n            // Set up group-level filtering and update filter icon.\n            //\n            if (num_feature_tracks > 1 && num_feature_tracks === this.drawables.length) {\n                //\n                // Find shared filters.\n                //\n                var shared_filters = {};\n\n                var filter;\n\n                // Init shared filters with filters from first drawable.\n                drawable = this.drawables[0];\n                for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                    filter = drawable.filters_manager.filters[j];\n                    shared_filters[filter.name] = [filter];\n                }\n\n                // Create lists of shared filters.\n                for (i = 1; i < this.drawables.length; i++) {\n                    drawable = this.drawables[i];\n                    for (j = 0; j < drawable.filters_manager.filters.length; j++) {\n                        filter = drawable.filters_manager.filters[j];\n                        if (filter.name in shared_filters) {\n                            shared_filters[filter.name].push(filter);\n                        }\n                    }\n                }\n\n                //\n                // Create filters for shared filters manager. Shared filters manager is group's\n                // manager.\n                //\n                this.filters_manager.remove_all();\n                var filters;\n                var new_filter;\n                var min;\n                var max;\n                for (var filter_name in shared_filters) {\n                    filters = shared_filters[filter_name];\n                    if (filters.length === num_feature_tracks) {\n                        // Add new filter.\n                        // FIXME: can filter.copy() be used?\n                        new_filter = new filters_mod.NumberFilter({\n                            name: filters[0].name,\n                            index: filters[0].index\n                        });\n                        this.filters_manager.add_filter(new_filter);\n                    }\n                }\n\n                // Show/hide icon based on filter availability.\n                this.action_icons.filters_icon.toggle(this.filters_manager.filters.length > 0);\n            } else {\n                this.action_icons.filters_icon.hide();\n            }\n        }\n    },\n\n    /**\n     * Restore individual track filter managers.\n     */\n    _restore_filter_managers: function() {\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].filters_manager = this.saved_filters_managers[i];\n        }\n        this.saved_filters_managers = [];\n    },\n\n    /**\n     *\n     */\n    setup_multitrack_filtering: function() {\n        // Save tracks' managers and set up shared manager.\n        if (this.filters_manager.filters.length > 0) {\n            // For all tracks, save current filter manager and set manager to shared (this object's) manager.\n            this.saved_filters_managers = [];\n            for (var i = 0; i < this.drawables.length; i++) {\n                var drawable = this.drawables[i];\n                this.saved_filters_managers.push(drawable.filters_manager);\n                drawable.filters_manager = this.filters_manager;\n            }\n\n            //TODO: hide filters icons for each drawable?\n        }\n        this.filters_manager.init_filters();\n    },\n\n    /**\n     * Replace group with a single composite track that includes all group's tracks.\n     */\n    show_composite_track: function() {\n        var composite_track = new CompositeTrack(this.view, this.view, {\n            name: this.config.get_value(\"name\"),\n            drawables: this.drawables\n        });\n        var index = this.container.replace_drawable(this, composite_track, true);\n        composite_track.request_draw();\n    },\n\n    add_drawable: function(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    remove_drawable: function(drawable) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        this.update_icons();\n    },\n\n    to_dict: function() {\n        // If filters are visible, need to restore original filter managers before converting to dict.\n        if (this.filters_manager.visible()) {\n            this._restore_filter_managers();\n        }\n\n        var obj_dict = extend(DrawableCollection.prototype.to_dict.call(this), {\n            filters: this.filters_manager.to_dict()\n        });\n\n        // Setup multi-track filtering again.\n        if (this.filters_manager.visible()) {\n            this.setup_multitrack_filtering();\n        }\n\n        return obj_dict;\n    },\n\n    request_draw: function(options) {\n        _.each(this.drawables, d => {\n            d.request_draw(options);\n        });\n    }\n});\n\n/**\n * View object manages a trackster visualization, including tracks and user interactions.\n * Events triggered:\n *      navigate: when browser view changes to a new locations\n */\nvar TracksterView = Backbone.View.extend({\n    initialize: function(obj_dict) {\n        extend(obj_dict, {\n            obj_type: \"View\"\n        });\n        DrawableCollection.call(this, \"View\", obj_dict.container, obj_dict);\n        this.chrom = null;\n        this.vis_id = obj_dict.vis_id;\n        this.dbkey = obj_dict.dbkey;\n        this.stand_alone = obj_dict.stand_alone !== undefined ? obj_dict.stand_alone : true;\n        this.label_tracks = [];\n        this.tracks_to_be_redrawn = [];\n        this.max_low = 0;\n        this.max_high = 0;\n        this.zoom_factor = 3;\n        this.min_separation = 30;\n        this.has_changes = false;\n        // Deferred object that indicates when view's chrom data has been loaded.\n        this.load_chroms_deferred = null;\n        this.render();\n        this.canvas_manager = new visualization.CanvasManager(this.container.get(0).ownerDocument);\n        this.reset();\n\n        // Define track configuration\n        this.config = config_mod.ConfigSettingCollection.from_models_and_saved_values(\n            [\n                {\n                    key: \"name\",\n                    label: \"Name\",\n                    type: \"text\",\n                    default_value: \"\"\n                },\n                {\n                    key: \"a_color\",\n                    label: \"A Color\",\n                    type: \"color\",\n                    default_value: \"#FF0000\"\n                },\n                {\n                    key: \"c_color\",\n                    label: \"C Color\",\n                    type: \"color\",\n                    default_value: \"#00FF00\"\n                },\n                {\n                    key: \"g_color\",\n                    label: \"G Color\",\n                    type: \"color\",\n                    default_value: \"#0000FF\"\n                },\n                {\n                    key: \"t_color\",\n                    label: \"T Color\",\n                    type: \"color\",\n                    default_value: \"#FF00FF\"\n                },\n                {\n                    key: \"n_color\",\n                    label: \"N Color\",\n                    type: \"color\",\n                    default_value: \"#AAAAAA\"\n                }\n            ],\n            { name: obj_dict.name }\n        );\n    },\n\n    render: function() {\n        // Attribute init.\n        this.requested_redraw = false;\n\n        // Create DOM elements\n        var parent_element = this.container;\n\n        var view = this;\n        // Top container for things that are fixed at the top\n        this.top_container = $(\"<div/>\")\n            .addClass(\"top-container\")\n            .appendTo(parent_element);\n        // Browser content, primary tracks are contained in here\n        this.browser_content_div = $(\"<div/>\")\n            .addClass(\"content\")\n            .appendTo(parent_element);\n        // Bottom container for things that are fixed at the bottom\n        this.bottom_container = $(\"<div/>\")\n            .addClass(\"bottom-container\")\n            .appendTo(parent_element);\n        // Label track fixed at top\n        this.top_labeltrack = $(\"<div/>\")\n            .addClass(\"top-labeltrack\")\n            .appendTo(this.top_container);\n        // Viewport for dragging tracks in center\n        this.viewport_container = $(\"<div/>\")\n            .addClass(\"viewport-container\")\n            .attr(\"id\", \"viewport-container\")\n            .appendTo(this.browser_content_div);\n        // Alias viewport_container as content_div so that it matches function of DrawableCollection/Group content_div.\n        this.content_div = this.viewport_container;\n        is_container(this.viewport_container, view);\n        // Introduction div shown when there are no tracks.\n        this.intro_div = $(\"<div/>\")\n            .addClass(\"intro\")\n            .appendTo(this.viewport_container);\n        var add_tracks_button = $(\"<div/>\")\n            .text(\"Add Datasets to Visualization\")\n            .addClass(\"action-button\")\n            .appendTo(this.intro_div)\n            .click(() => {\n                visualization.select_datasets({ dbkey: view.dbkey }, tracks => {\n                    _.each(tracks, track => {\n                        view.add_drawable(object_from_template(track, view, view));\n                    });\n                });\n            });\n\n        // Navigation at top\n        this.nav_container = $(\"<div/>\")\n            .addClass(\"trackster-nav-container\")\n            .prependTo(this.top_container);\n        this.nav = $(\"<div/>\")\n            .addClass(\"trackster-nav\")\n            .appendTo(this.nav_container);\n\n        if (this.stand_alone) {\n            this.nav_container.addClass(\"stand-alone\");\n            this.nav.addClass(\"stand-alone\");\n        }\n\n        // Overview (scrollbar and overview plot) at bottom\n        this.overview = $(\"<div/>\")\n            .addClass(\"overview\")\n            .appendTo(this.bottom_container);\n        this.overview_viewport = $(\"<div/>\")\n            .addClass(\"overview-viewport\")\n            .appendTo(this.overview);\n        this.overview_close = $(\"<a/>\")\n            .attr(\"title\", \"Close overview\")\n            .addClass(\"icon-button overview-close tooltip\")\n            .hide()\n            .appendTo(this.overview_viewport);\n        this.overview_highlight = $(\"<div/>\")\n            .addClass(\"overview-highlight\")\n            .hide()\n            .appendTo(this.overview_viewport);\n        this.overview_box_background = $(\"<div/>\")\n            .addClass(\"overview-boxback\")\n            .appendTo(this.overview_viewport);\n        this.overview_box = $(\"<div/>\")\n            .addClass(\"overview-box\")\n            .appendTo(this.overview_viewport);\n        this.default_overview_height = this.overview_box.height();\n\n        this.nav_controls = $(\"<div/>\")\n            .addClass(\"nav-controls\")\n            .appendTo(this.nav);\n        this.chrom_select = $(\"<select/>\")\n            .attr({ name: \"chrom\" })\n            .addClass(\"chrom-nav\")\n            .append(\"<option value=''>Loading</option>\")\n            .appendTo(this.nav_controls);\n        var submit_nav = function(e) {\n            if (e.type === \"focusout\" || (e.keyCode || e.which) === 13 || (e.keyCode || e.which) === 27) {\n                if ((e.keyCode || e.which) !== 27) {\n                    // Not escape key\n                    view.go_to($(this).val());\n                }\n                $(this).hide();\n                $(this).val(\"\");\n                view.location_span.show();\n                view.chrom_select.show();\n            }\n\n            // Suppress key presses so that they do impact viz.\n            e.stopPropagation();\n        };\n        this.nav_input = $(\"<input/>\")\n            .addClass(\"nav-input\")\n            .hide()\n            .bind(\"keyup focusout\", submit_nav)\n            .appendTo(this.nav_controls);\n        this.location_span = $(\"<span/>\")\n            .addClass(\"location\")\n            .attr(\"title\", \"Click to change location\")\n            .tooltip({ placement: \"bottom\" })\n            .appendTo(this.nav_controls);\n        this.location_span.click(() => {\n            view.location_span.hide();\n            view.chrom_select.hide();\n            view.nav_input.val(`${view.chrom}:${view.low}-${view.high}`);\n            view.nav_input.css(\"display\", \"inline-block\");\n            view.nav_input.select();\n            view.nav_input.focus();\n            // Set up autocomplete for tracks' features.\n            view.nav_input.autocomplete({\n                source: function(request, response) {\n                    // Using current text, query each track and create list of all matching features.\n                    var all_features = [];\n\n                    var feature_search_deferreds = $.map(view.get_tracks(FeatureTrack), t =>\n                        t.data_manager.search_features(request.term).success(dataset_features => {\n                            all_features = all_features.concat(dataset_features);\n                        })\n                    );\n\n                    // When all searching is done, fill autocomplete.\n                    $.when.apply($, feature_search_deferreds).done(() => {\n                        response(\n                            $.map(all_features, feature => ({\n                                label: feature[0],\n                                value: feature[1]\n                            }))\n                        );\n                    });\n                },\n                minLength: 2\n            });\n        });\n        if (this.vis_id !== undefined) {\n            this.hidden_input = $(\"<input/>\")\n                .attr(\"type\", \"hidden\")\n                .val(this.vis_id)\n                .appendTo(this.nav_controls);\n        }\n\n        this.zo_link = $(\"<a/>\")\n            .attr(\"id\", \"zoom-out\")\n            .attr(\"title\", \"Zoom out\")\n            .tooltip({ placement: \"bottom\" })\n            .click(() => {\n                view.zoom_out();\n            })\n            .appendTo(this.nav_controls);\n        this.zi_link = $(\"<a/>\")\n            .attr(\"id\", \"zoom-in\")\n            .attr(\"title\", \"Zoom in\")\n            .tooltip({ placement: \"bottom\" })\n            .click(() => {\n                view.zoom_in();\n            })\n            .appendTo(this.nav_controls);\n\n        // Get initial set of chroms.\n        this.load_chroms_deferred = this.load_chroms({ low: 0 });\n        this.chrom_select.bind(\"change\", () => {\n            view.change_chrom(view.chrom_select.val());\n        });\n\n        /*\n        this.browser_content_div.bind(\"mousewheel\", function( e, delta ) {\n            if (Math.abs(delta) < 0.5) {\n                return;\n            }\n            if (delta > 0) {\n                view.zoom_in(e.pageX, this.viewport_container);\n            } else {\n                view.zoom_out();\n            }\n            e.preventDefault();\n        });\n        */\n\n        // Blur tool/filter inputs when user clicks on content div.\n        this.browser_content_div.click(function(e) {\n            $(this)\n                .find(\"input\")\n                .trigger(\"blur\");\n        });\n\n        // Double clicking zooms in\n        this.browser_content_div.bind(\"dblclick\", function(e) {\n            view.zoom_in(e.pageX, this.viewport_container);\n        });\n\n        // Dragging the overview box (~ horizontal scroll bar)\n        this.overview_box\n            .bind(\"dragstart\", function(e, d) {\n                this.current_x = d.offsetX;\n            })\n            .bind(\"drag\", function(e, d) {\n                var delta = d.offsetX - this.current_x;\n                this.current_x = d.offsetX;\n                var delta_chrom = Math.round(delta / view.viewport_container.width() * (view.max_high - view.max_low));\n                view.move_delta(-delta_chrom);\n            });\n\n        this.overview_close.click(() => {\n            view.reset_overview();\n        });\n\n        // Dragging in the viewport scrolls\n        this.viewport_container\n            .bind(\"draginit\", (e, d) => {\n                // Disable interaction if started in scrollbar (for webkit)\n                if (e.clientX > view.viewport_container.width() - 16) {\n                    return false;\n                }\n            })\n            .bind(\"dragstart\", (e, d) => {\n                d.original_low = view.low;\n                d.current_height = e.clientY;\n                d.current_x = d.offsetX;\n            })\n            .bind(\"drag\", function(e, d) {\n                var container = $(this);\n                var delta = d.offsetX - d.current_x;\n                var new_scroll = container.scrollTop() - (e.clientY - d.current_height);\n                container.scrollTop(new_scroll);\n                d.current_height = e.clientY;\n                d.current_x = d.offsetX;\n                var delta_chrom = Math.round(delta / view.viewport_container.width() * (view.high - view.low));\n                view.move_delta(delta_chrom);\n            });\n        /*\n        FIXME: Do not do this for now because it's too jittery. Some kind of gravity approach is\n        needed here because moving left/right should be difficult.\n\n        // Also capture mouse wheel for left/right scrolling\n        }).bind( 'mousewheel', function( e, d, dx, dy ) {\n            // Only handle x axis scrolling; y axis scrolling is\n            // handled by the browser when the event bubbles up.\n            if (dx) {\n                var delta_chrom = Math.round( - dx / view.viewport_container.width() * (view.high - view.low) );\n                view.move_delta( delta_chrom );\n            }\n        });\n        */\n\n        // Dragging in the top label track allows selecting a region to zoom in on selected region.\n        this.top_labeltrack\n            .bind(\"dragstart\", function(e, d) {\n                return $(\"<div/>\")\n                    .addClass(\"zoom-area\")\n                    .css(\"height\", view.browser_content_div.height() + view.top_labeltrack.height() + 1)\n                    .appendTo($(this));\n            })\n            .bind(\"drag\", (e, d) => {\n                $(d.proxy).css({\n                    left: Math.min(e.pageX, d.startX) - view.container.offset().left,\n                    width: Math.abs(e.pageX - d.startX)\n                });\n\n                var min = Math.min(e.pageX, d.startX) - view.container.offset().left;\n\n                var max = Math.max(e.pageX, d.startX) - view.container.offset().left;\n\n                var span = view.high - view.low;\n                var width = view.viewport_container.width();\n                view.update_location(\n                    Math.round(min / width * span) + view.low,\n                    Math.round(max / width * span) + view.low\n                );\n            })\n            .bind(\"dragend\", (e, d) => {\n                var min = Math.min(e.pageX, d.startX);\n                var max = Math.max(e.pageX, d.startX);\n                var span = view.high - view.low;\n                var width = view.viewport_container.width();\n                var old_low = view.low;\n                view.low = Math.round(min / width * span) + old_low;\n                view.high = Math.round(max / width * span) + old_low;\n                $(d.proxy).remove();\n                view.request_redraw();\n            });\n\n        // FIXME: this is still wonky for embedded visualizations.\n        /*\n        // For vertical alignment, track mouse with simple line.\n        var mouse_tracker_div = $('<div/>').addClass('mouse-pos').appendTo(parent_element);\n\n        // Show tracker only when hovering over view.\n        parent_element.hover(\n            function() {\n                mouse_tracker_div.show();\n                parent_element.mousemove(function(e) {\n                    mouse_tracker_div.css({\n                        // -1 makes line appear next to the mouse w/o preventing mouse actions.\n                        left: e.pageX - parent_element.offset().left - 1\n                    });\n                });\n            },\n            function() {\n                parent_element.off('mousemove');\n                mouse_tracker_div.hide();\n            }\n        );\n        */\n\n        this.add_label_track(new LabelTrack(this, { content_div: this.top_labeltrack }));\n\n        $(window).bind(\"resize\", function() {\n            // Stop previous timer.\n            if (this.resize_timer) {\n                clearTimeout(this.resize_timer);\n            }\n\n            // When function activated, resize window and redraw.\n            this.resize_timer = setTimeout(() => {\n                view.resize_window();\n            }, 500);\n        });\n        $(document).bind(\"redraw\", () => {\n            view.redraw();\n        });\n\n        this.reset();\n        $(window).trigger(\"resize\");\n    },\n\n    get_base_color: function(base) {\n        return this.config.get_value(`${base.toLowerCase()}_color`) || this.config.get_value(\"n_color\");\n    }\n});\n\n// FIXME: need to use this approach to enable inheritance of DrawableCollection functions.\nextend(TracksterView.prototype, DrawableCollection.prototype, {\n    changed: function() {\n        this.has_changes = true;\n    },\n\n    /** Add or remove intro div depending on view state. */\n    update_intro_div: function() {\n        this.intro_div.toggle(this.drawables.length === 0);\n    },\n\n    /**\n     * Triggers navigate events as needed. If there is a delay,\n     * then event is triggered only after navigation has stopped.\n     */\n    trigger_navigate: function(new_chrom, new_low, new_high, delay) {\n        // Stop previous timer.\n        if (this.timer) {\n            clearTimeout(this.timer);\n        }\n\n        if (delay) {\n            // To aggregate calls, use timer and only navigate once\n            // location has stabilized.\n            var self = this;\n            this.timer = setTimeout(() => {\n                self.trigger(\"navigate\", `${new_chrom}:${new_low}-${new_high}`);\n            }, 500);\n        } else {\n            view.trigger(\"navigate\", `${new_chrom}:${new_low}-${new_high}`);\n        }\n    },\n\n    update_location: function(low, high) {\n        this.location_span.text(`${util.commatize(low)} - ${util.commatize(high)}`);\n        this.nav_input.val(`${this.chrom}:${util.commatize(low)}-${util.commatize(high)}`);\n\n        // Update location. Only update when there is a valid chrom; when loading vis, there may\n        // not be a valid chrom.\n        var chrom = this.chrom_select.val();\n        if (chrom !== \"\") {\n            this.trigger_navigate(chrom, this.low, this.high, true);\n        }\n    },\n\n    /**\n     * Load chrom data for the view. Returns a jQuery Deferred.\n     */\n    // FIXME: instead of loading chrom data, should load and store genome object.\n    load_chroms: function(url_parms) {\n        url_parms.num = MAX_CHROMS_SELECTABLE;\n\n        var view = this;\n        var chrom_data = $.Deferred();\n        $.ajax({\n            url: `${Galaxy.root}api/genomes/${this.dbkey}`,\n            data: url_parms,\n            dataType: \"json\",\n            success: function(result) {\n                // Do nothing if could not load chroms.\n                if (result.chrom_info.length === 0) {\n                    return;\n                }\n\n                // Load chroms.\n                if (result.reference) {\n                    var ref_track = new ReferenceTrack(view);\n                    view.add_label_track(ref_track);\n                    view.reference_track = ref_track;\n                }\n                view.chrom_data = result.chrom_info;\n\n                view.chrom_select.html(\"\");\n                view.chrom_select.append($('<option value=\"\">Select Chrom/Contig</option>'));\n\n                for (var i = 0, len = view.chrom_data.length; i < len; i++) {\n                    var chrom = view.chrom_data[i].chrom;\n                    var chrom_option = $(\"<option>\");\n                    chrom_option.text(chrom);\n                    chrom_option.val(chrom);\n                    view.chrom_select.append(chrom_option);\n                }\n                if (result.prev_chroms) {\n                    view.chrom_select.append($(`<option value=\"previous\">Previous ${MAX_CHROMS_SELECTABLE}</option>`));\n                }\n                if (result.next_chroms) {\n                    view.chrom_select.append($(`<option value=\"next\">Next ${MAX_CHROMS_SELECTABLE}</option>`));\n                }\n                view.chrom_start_index = result.start_index;\n\n                chrom_data.resolve(result.chrom_info);\n            },\n            error: function() {\n                alert(`Could not load chroms for this dbkey: ${view.dbkey}`);\n            }\n        });\n        return chrom_data;\n    },\n\n    change_chrom: function(chrom, low, high) {\n        var view = this;\n        // If chrom data is still loading, wait for it.\n        if (!view.chrom_data) {\n            view.load_chroms_deferred.then(() => {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        }\n\n        // Don't do anything if chrom is \"None\" (hackish but some browsers already have this set), or null/blank\n        if (!chrom || chrom === \"None\") {\n            return;\n        }\n\n        //\n        // If user is navigating to previous/next set of chroms, load new chrom set and return.\n        //\n        if (chrom === \"previous\") {\n            view.load_chroms({\n                low: this.chrom_start_index - MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n        if (chrom === \"next\") {\n            view.load_chroms({\n                low: this.chrom_start_index + MAX_CHROMS_SELECTABLE\n            });\n            return;\n        }\n\n        //\n        // User is loading a particular chrom. Look first in current set; if not in current set, load new\n        // chrom set.\n        //\n        var found = $.grep(view.chrom_data, (v, i) => v.chrom === chrom)[0];\n        if (found === undefined) {\n            // Try to load chrom and then change to chrom.\n            view.load_chroms({ chrom: chrom }, () => {\n                view.change_chrom(chrom, low, high);\n            });\n            return;\n        } else {\n            // Switching to local chrom.\n            if (chrom !== view.chrom) {\n                view.chrom = chrom;\n                view.chrom_select.val(view.chrom);\n                view.max_high = found.len - 1; // -1 because we're using 0-based indexing.\n                view.reset();\n\n                for (var i = 0, len = view.drawables.length; i < len; i++) {\n                    var drawable = view.drawables[i];\n                    if (drawable.init) {\n                        drawable.init();\n                    }\n                }\n                if (view.reference_track) {\n                    view.reference_track.init();\n                }\n            }\n\n            // Resolve low, high.\n            if (low === undefined && high === undefined) {\n                // Both are undefined, so view is whole chromosome.\n                view.low = 0;\n                view.high = view.max_high;\n            } else {\n                // Low and/or high is defined.\n                view.low = low !== undefined ? Math.max(low, 0) : 0;\n                if (high === undefined) {\n                    // Center visualization around low.\n                    // HACK: max resolution is currently 30 bases.\n                    view.low = Math.max(view.low - 15, 0);\n                    view.high = view.low + 30;\n                } else {\n                    // High is defined.\n                    view.high = Math.min(high, view.max_high);\n                }\n            }\n\n            view.request_redraw();\n        }\n    },\n\n    /**\n     * Change viewing region to that denoted by string. General format of string is:\n     *\n     * <chrom>[ {separator}<start>[-<end>] ]\n     *\n     * where separator can be whitespace or a colon. Examples:\n     *\n     * chr22\n     * chr1:100-200\n     * chr7 89999\n     * chr8 90000 990000\n     */\n    go_to: function(str) {\n        // Remove commas.\n        str = str.replace(/,/g, \"\");\n\n        // Replace colons and hyphens with space for easy parsing.\n        str = str.replace(/:|\\-/g, \" \");\n\n        // Parse new location.\n        var chrom_pos = str.split(/\\s+/);\n\n        var chrom = chrom_pos[0];\n        var new_low = chrom_pos[1] ? parseInt(chrom_pos[1], 10) : undefined;\n        var new_high = chrom_pos[2] ? parseInt(chrom_pos[2], 10) : undefined;\n\n        this.change_chrom(chrom, new_low, new_high);\n    },\n\n    move_fraction: function(fraction) {\n        var view = this;\n        var span = view.high - view.low;\n        this.move_delta(fraction * span);\n    },\n\n    move_delta: function(delta_chrom) {\n        //\n        // Update low, high.\n        //\n\n        var view = this;\n        var current_chrom_span = view.high - view.low;\n        // Check for left and right boundaries\n        if (view.low - delta_chrom < view.max_low) {\n            view.low = view.max_low;\n            view.high = view.max_low + current_chrom_span;\n        } else if (view.high - delta_chrom > view.max_high) {\n            view.high = view.max_high;\n            view.low = view.max_high - current_chrom_span;\n        } else {\n            view.high -= delta_chrom;\n            view.low -= delta_chrom;\n        }\n\n        //\n        // Redraw view.\n        //\n\n        // Redraw without requesting more data immediately.\n        view.request_redraw({ data_fetch: false });\n\n        // Set up timeout to redraw with more data when moving stops.\n        if (this.redraw_on_move_fn) {\n            clearTimeout(this.redraw_on_move_fn);\n        }\n\n        this.redraw_on_move_fn = setTimeout(() => {\n            view.request_redraw();\n        }, 200);\n\n        // Navigate.\n        var chrom = view.chrom_select.val();\n        this.trigger_navigate(chrom, view.low, view.high, true);\n    },\n\n    /**\n     * Add a drawable to the view.\n     */\n    add_drawable: function(drawable) {\n        DrawableCollection.prototype.add_drawable.call(this, drawable);\n        drawable.init();\n        this.changed();\n        this.update_intro_div();\n\n        // When drawable config changes, mark view as changed. This\n        // captures most (all?) state change that needs to be saved.\n        var self = this;\n        drawable.config.on(\"change\", () => {\n            self.changed();\n        });\n    },\n\n    add_label_track: function(label_track) {\n        label_track.view = this;\n        label_track.init();\n        this.label_tracks.push(label_track);\n    },\n\n    /**\n     * Remove drawable from the view.\n     */\n    remove_drawable: function(drawable, hide) {\n        DrawableCollection.prototype.remove_drawable.call(this, drawable);\n        if (hide) {\n            var view = this;\n            drawable.container_div.hide(0, function() {\n                $(this).remove();\n                view.update_intro_div();\n            });\n        }\n    },\n\n    reset: function() {\n        this.low = this.max_low;\n        this.high = this.max_high;\n        this.viewport_container.find(\".yaxislabel\").remove();\n    },\n\n    /**\n     * Request that view redraw one or more of view's drawables. If drawable is not specified,\n     * all drawables are redrawn.\n     */\n    request_redraw: function(options, drawable) {\n        var view = this;\n\n        var // Either redrawing a single drawable or all view's drawables.\n        track_list = drawable ? [drawable] : view.drawables;\n\n        // Add/update tracks in track list to redraw list.\n        _.each(track_list, track => {\n            var track_options = _.find(view.tracks_to_be_redrawn, to => to[0] === track);\n\n            if (track_options) {\n                // Track already in list; update options.\n                track_options[1] = options;\n            } else {\n                // Track not in list yet.\n                view.tracks_to_be_redrawn.push([track, options]);\n            }\n        });\n\n        // Set up redraw if it has not been requested since last redraw.\n        if (!this.requested_redraw) {\n            requestAnimationFrame(() => {\n                view._redraw();\n            });\n            this.requested_redraw = true;\n        }\n    },\n\n    /**\n     * Redraws view and tracks.\n     * NOTE: this method should never be called directly; request_redraw() should be used so\n     * that requestAnimationFrame can manage redrawing.\n     */\n    _redraw: function() {\n        // TODO: move this code to function that does location setting.\n\n        // Clear because requested redraw is being handled now.\n        this.requested_redraw = false;\n\n        var low = this.low;\n        var high = this.high;\n\n        if (low < this.max_low) {\n            low = this.max_low;\n        }\n        if (high > this.max_high) {\n            high = this.max_high;\n        }\n        var span = this.high - this.low;\n        if (this.high !== 0 && span < this.min_separation) {\n            high = low + this.min_separation;\n        }\n        this.low = Math.floor(low);\n        this.high = Math.ceil(high);\n\n        this.update_location(this.low, this.high);\n\n        // -- Drawing code --\n\n        // Resolution is a pixel density.\n        this.resolution_px_b = this.viewport_container.width() / (this.high - this.low);\n\n        // Overview\n        var left_px = this.low / (this.max_high - this.max_low) * this.overview_viewport.width() || 0;\n        var width_px = (this.high - this.low) / (this.max_high - this.max_low) * this.overview_viewport.width() || 0;\n        var min_width_px = 13;\n\n        this.overview_box\n            .css({\n                left: left_px,\n                width: Math.max(min_width_px, width_px)\n            })\n            .show();\n        if (width_px < min_width_px) {\n            this.overview_box.css(\"left\", left_px - (min_width_px - width_px) / 2);\n        }\n        if (this.overview_highlight) {\n            this.overview_highlight.css({\n                left: left_px,\n                width: width_px\n            });\n        }\n\n        // Draw data tracks.\n        _.each(this.tracks_to_be_redrawn, track_options => {\n            var track = track_options[0];\n            var options = track_options[1];\n            if (track) {\n                track._draw(options);\n            }\n        });\n        this.tracks_to_be_redrawn = [];\n\n        // Draw label tracks.\n        _.each(this.label_tracks, label_track => {\n            label_track._draw();\n        });\n    },\n\n    zoom_in: function(point, container) {\n        if (this.max_high === 0 || this.high - this.low <= this.min_separation) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = span / this.zoom_factor / 2;\n        if (point) {\n            cur_center = point / this.viewport_container.width() * (this.high - this.low) + this.low;\n        }\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n\n        this.changed();\n        this.request_redraw();\n    },\n\n    zoom_out: function() {\n        if (this.max_high === 0) {\n            return;\n        }\n        var span = this.high - this.low;\n        var cur_center = span / 2 + this.low;\n        var new_half = span * this.zoom_factor / 2;\n        this.low = Math.round(cur_center - new_half);\n        this.high = Math.round(cur_center + new_half);\n        this.changed();\n        this.request_redraw();\n    },\n\n    /** Resize viewport. Use this method if header/footer content has changed in size. */\n    resize_viewport: function() {\n        this.viewport_container.height(\n            this.container.height() - this.top_container.height() - this.bottom_container.height()\n        );\n    },\n\n    /** Called when window is resized. */\n    resize_window: function() {\n        this.resize_viewport();\n        this.request_redraw();\n    },\n\n    /** Show a Drawable in the overview. */\n    set_overview: function(drawable) {\n        if (this.overview_drawable) {\n            // If drawable to be set as overview is already in overview, do nothing.\n            // Otherwise, remove overview.\n            if (this.overview_drawable.dataset.id === drawable.dataset.id) {\n                return;\n            }\n            this.overview_viewport.find(\".track\").remove();\n        }\n\n        // Set new overview.\n        var overview_drawable = drawable.copy({\n            content_div: this.overview_viewport\n        });\n\n        var view = this;\n        overview_drawable.header_div.hide();\n        overview_drawable.is_overview = true;\n        view.overview_drawable = overview_drawable;\n        this.overview_drawable.postdraw_actions = () => {\n            view.overview_highlight.show().height(view.overview_drawable.content_div.height());\n            view.overview_viewport.height(\n                view.overview_drawable.content_div.height() + view.overview_box.outerHeight()\n            );\n            view.overview_close.show();\n            view.resize_window();\n        };\n        view.overview_drawable.request_draw();\n        this.changed();\n    },\n\n    /** Close and reset overview. */\n    reset_overview: function() {\n        // Update UI.\n        $(\".tooltip\").remove();\n        this.overview_viewport.find(\".track-tile\").remove();\n        this.overview_viewport.height(this.default_overview_height);\n        this.overview_box.height(this.default_overview_height);\n        this.overview_close.hide();\n        this.overview_highlight.hide();\n        view.resize_window();\n        view.overview_drawable = null;\n    }\n});\n\n/**\n * Encapsulation of a tool that users can apply to tracks/datasets.\n */\nvar TracksterTool = tools_mod.Tool.extend({\n    defaults: {\n        track: null\n    },\n\n    initialize: function(options) {\n        tools_mod.Tool.prototype.initialize.call(this, options);\n\n        // Restore tool visibility from state; default to hidden.\n        var hidden = true;\n        if (options.tool_state !== undefined && options.tool_state.hidden !== undefined) {\n            hidden = options.tool_state.hidden;\n        }\n        this.set(\"hidden\", hidden);\n\n        // FIXME: need to restore tool values from options.tool_state\n\n        // HACK: remove some inputs because Trackster does yet not work with them.\n        this.remove_inputs([\"data\", \"hidden_data\", \"conditional\"]);\n    },\n\n    state_dict: function(options) {\n        return _.extend(this.get_inputs_dict(), {\n            hidden: !this.is_visible()\n        });\n    }\n});\n\n/**\n * View renders tool parameter HTML and updates parameter value as it is changed in the HTML.\n */\nvar ToolParameterView = Backbone.View.extend({\n    events: {\n        \"change :input\": \"update_value\"\n    },\n\n    render: function() {\n        var param_div = this.$el.addClass(\"param-row\");\n        var param = this.model;\n\n        // Param label.\n        var label_div = $(\"<div>\")\n            .addClass(\"param-label\")\n            .text(param.get(\"label\"))\n            .appendTo(param_div);\n        // Param HTML.\n        var html_div = $(\"<div/>\")\n            .addClass(\"param-input\")\n            .html(param.get(\"html\"))\n            .appendTo(param_div);\n        // Set initial value.\n        html_div.find(\":input\").val(param.get(\"value\"));\n\n        // Add to clear floating layout.\n        $(\"<div style='clear: both;'/>\").appendTo(param_div);\n    },\n\n    update_value: function(update_event) {\n        this.model.set_value($(update_event.target).val());\n    }\n});\n\n/**\n * View for TracksterTool.\n */\nvar TracksterToolView = Backbone.View.extend({\n    initialize: function(options) {\n        this.model.on(\"change:hidden\", this.set_visible, this);\n    },\n\n    /**\n     * Render tool UI.\n     */\n    render: function() {\n        var self = this;\n        var tool = this.model;\n        var parent_div = this.$el.addClass(\"dynamic-tool\").hide();\n\n        // Prevent div events from propogating to other elements.\n        parent_div\n            .bind(\"drag\", e => {\n                e.stopPropagation();\n            })\n            .click(e => {\n                e.stopPropagation();\n            })\n            .bind(\"dblclick\", e => {\n                e.stopPropagation();\n            })\n            .keydown(e => {\n                e.stopPropagation();\n            });\n\n        // Add name, inputs.\n        var name_div = $(\"<div class='tool-name'>\")\n            .appendTo(parent_div)\n            .text(tool.get(\"name\"));\n        tool.get(\"inputs\").each(param => {\n            // Render parameter.\n            var param_view = new ToolParameterView({ model: param });\n            param_view.render();\n            parent_div.append(param_view.$el);\n        });\n\n        // Highlight value for inputs for easy replacement.\n        parent_div.find(\"input\").click(function() {\n            $(this).select();\n        });\n\n        // Add buttons for running on dataset, region.\n        var run_tool_row = $(\"<div>\")\n            .addClass(\"param-row\")\n            .appendTo(parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'>\")\n            .attr(\"value\", \"Run on complete dataset\")\n            .appendTo(run_tool_row);\n        var run_on_region_button = $(\"<input type='submit'>\")\n            .attr(\"value\", \"Run on visible region\")\n            .appendTo(run_tool_row);\n        run_on_region_button.click(() => {\n            // Run tool to create new track.\n            self.run_on_region();\n        });\n        run_on_dataset_button.click(() => {\n            self.run_on_dataset();\n        });\n\n        if (tool.is_visible()) {\n            this.$el.show();\n        }\n    },\n\n    /**\n     * Show or hide tool depending on tool visibility state.\n     */\n    set_visible: function() {\n        this.$el.toggle(this.model.is_visible());\n    },\n\n    /**\n     * Update tool parameters.\n     */\n    update_params: function() {\n        for (var i = 0; i < this.params.length; i++) {\n            this.params[i].update_value();\n        }\n    },\n\n    /**\n     * Run tool on dataset. Output is placed in dataset's history and no changes to viz are made.\n     */\n    run_on_dataset: function() {\n        var tool = this.model;\n        this.run(\n            // URL params.\n            {\n                target_dataset_id: this.model.get(\"track\").dataset.id,\n                action: \"rerun\",\n                tool_id: tool.id\n            },\n            null,\n            track_data => {\n                Galaxy.modal.show({\n                    title: `${tool.get(\"name\")} is Running`,\n                    body: `${tool.get(\n                        \"name\"\n                    )} is running on the complete dataset. Tool outputs are in dataset's history.`,\n                    buttons: {\n                        Close: function() {\n                            Galaxy.modal.hide();\n                        }\n                    }\n                });\n            }\n        );\n    },\n\n    /**\n     * Run dataset on visible region. This creates a new track and sets the track's contents\n     * to the tool's output.\n     */\n    run_on_region: function() {\n        //\n        // Create track for tool's output immediately to provide user feedback.\n        //\n        var track = this.model.get(\"track\");\n\n        var tool = this.model;\n\n        var region = new visualization.GenomeRegion({\n            chrom: track.view.chrom,\n            start: track.view.low,\n            end: track.view.high\n        });\n\n        var url_params = {\n            target_dataset_id: track.dataset.id,\n            action: \"rerun\",\n            tool_id: tool.id,\n            regions: [region.toJSON()]\n        };\n\n        var current_track = track;\n\n        var // Set name of track to include tool name, parameters, and region used.\n        track_name = tool.get(\"name\") + current_track.tool_region_and_parameters_str(region);\n\n        var container;\n\n        // If track not in a group, create a group for it and add new track to group. If track\n        // already in group, add track to group.\n        if (current_track.container === view) {\n            // Create new group.\n            var group = new DrawableGroup(view, view, {\n                name: track.config.get_value(\"name\")\n            });\n\n            // Replace track with group.\n            var index = current_track.container.replace_drawable(current_track, group, false);\n\n            // Update HTML.\n            // FIXME: this is ugly way to replace a track with a group -- make this easier via\n            // a Drawable or DrawableCollection function.\n            group.container_div.insertBefore(current_track.view.content_div.children()[index]);\n            group.add_drawable(current_track);\n            current_track.container_div.appendTo(group.content_div);\n            container = group;\n        } else {\n            // Use current group.\n            container = current_track.container;\n        }\n\n        // Create and init new track.\n        var new_track = new current_track.constructor(view, container, {\n            name: track_name,\n            hda_ldda: \"hda\"\n        });\n        new_track.init_for_tool_data();\n        new_track.change_mode(current_track.mode);\n        new_track.set_filters_manager(current_track.filters_manager.copy(new_track));\n        new_track.update_icons();\n        container.add_drawable(new_track);\n        new_track.tiles_div.text(\"Starting job.\");\n\n        // Run tool.\n        this.run(url_params, new_track, track_data => {\n            new_track.set_dataset(new data.Dataset(track_data));\n            new_track.tiles_div.text(\"Running job.\");\n            new_track.init();\n        });\n    },\n\n    /**\n     * Run tool using a set of URL params and a success callback.\n     */\n    run: function(url_params, new_track, success_callback) {\n        // Run tool.\n        url_params.inputs = this.model.get_inputs_dict();\n        var ss_deferred = new util.ServerStateDeferred({\n            ajax_settings: {\n                url: `${Galaxy.root}api/tools`,\n                data: JSON.stringify(url_params),\n                dataType: \"json\",\n                contentType: \"application/json\",\n                type: \"POST\"\n            },\n            interval: 2000,\n            success_fn: function(response) {\n                return response !== \"pending\";\n            }\n        });\n\n        // Start with this status message.\n        //new_track.container_div.addClass(\"pending\");\n        //new_track.content_div.html(DATA_PENDING);\n\n        $.when(ss_deferred.go()).then(response => {\n            if (response === \"no converter\") {\n                // No converter available for input datasets, so cannot run tool.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_NOCONVERTER);\n            } else if (response.error) {\n                // General error.\n                new_track.container_div.addClass(\"error\");\n                new_track.content_div.text(DATA_CANNOT_RUN_TOOL + response.message);\n            } else {\n                // Job submitted and running.\n                success_callback(response);\n            }\n        });\n    }\n});\n\n/**\n * Generates scale values based on filter and feature's value for filter.\n */\nvar FilterScaler = function(filter, default_val) {\n    painters.Scaler.call(this, default_val);\n    this.filter = filter;\n};\n\nFilterScaler.prototype.gen_val = function(feature_data) {\n    // If filter is not initalized yet, return default val.\n    if (\n        this.filter.high === Number.MAX_VALUE ||\n        this.filter.low === -Number.MAX_VALUE ||\n        this.filter.low === this.filter.high\n    ) {\n        return this.default_val;\n    }\n\n    // Scaling value is ratio of (filter's value compared to low) to (complete filter range).\n    return (parseFloat(feature_data[this.filter.index]) - this.filter.low) / (this.filter.high - this.filter.low);\n};\n\n/**\n * Tiles drawn by tracks.\n */\nvar Tile = function(track, region, w_scale, canvas, data) {\n    this.track = track;\n    this.region = region;\n    this.low = region.get(\"start\");\n    this.high = region.get(\"end\");\n    this.w_scale = w_scale;\n    this.canvas = canvas;\n    // Wrap element in div for background and to provide container for tile-specific elements.\n    this.html_elt = $(\"<div class='track-tile'/>\").append(canvas);\n    this.data = data;\n    this.stale = false;\n};\n\n/**\n * Perform pre-display actions.\n */\nTile.prototype.predisplay_actions = () => {};\n\nvar LineTrackTile = function(track, region, w_scale, canvas, data) {\n    Tile.call(this, track, region, w_scale, canvas, data);\n};\nLineTrackTile.prototype.predisplay_actions = () => {};\n\nvar FeatureTrackTile = function(\n    track,\n    region,\n    w_scale,\n    canvas,\n    data,\n    mode,\n    message,\n    all_slotted,\n    feature_mapper,\n    incomplete_features,\n    seq_data\n) {\n    // Attribute init.\n    Tile.call(this, track, region, w_scale, canvas, data);\n    this.mode = mode;\n    this.all_slotted = all_slotted;\n    this.feature_mapper = feature_mapper;\n    this.has_icons = false;\n    this.incomplete_features = incomplete_features;\n    // Features drawn based on data from other tiles.\n    this.other_tiles_features_drawn = {};\n    this.seq_data = seq_data;\n\n    // Add message + action icons to tile's html.\n    /*\n    This does not work right now because a random set of reads is returned by the server.\n    When the server can respond with more data systematically, renable these icons.\n    if (message) {\n        this.has_icons = true;\n\n        var\n            tile = this;\n            canvas = this.html_elt.children()[0],\n            message_div = $(\"<div/>\").addClass(\"tile-message\")\n                            // -1 to account for border.\n                            .css({'height': ERROR_PADDING, 'width': canvas.width}).prependTo(this.html_elt);\n\n        // Handle message; only message currently is that only the first N elements are displayed.\n        var tile_region = new visualization.GenomeRegion({\n                chrom: track.view.chrom,\n                start: this.low,\n                end: this.high\n            }),\n            num_features = data.length,\n            more_down_icon = $(\"<a/>\").addClass(\"icon more-down\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data including depth\")\n                                .tooltip().appendTo(message_div),\n            more_across_icon = $(\"<a/>\").addClass(\"icon more-across\")\n                                .attr(\"title\", \"For speed, only the first \" + num_features + \" features in this region were obtained from server. Click to get more data excluding depth\")\n                                .tooltip().appendTo(message_div);\n\n        // Set up actions for icons.\n        more_down_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.DEEP_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n\n        more_across_icon.click(function() {\n            // Mark tile as stale, request more data, and redraw track.\n            tile.stale = true;\n            track.data_manager.get_more_data(tile_region, track.mode, 1 / tile.w_scale, {}, track.data_manager.BROAD_DATA_REQ);\n            $(\".tooltip\").hide();\n            track.request_draw();\n        }).dblclick(function(e) {\n            // Do not propogate as this would normally zoom in.\n            e.stopPropagation();\n        });\n    }\n    */\n};\nextend(FeatureTrackTile.prototype, Tile.prototype);\n\n/**\n * Sets up support for popups.\n */\nFeatureTrackTile.prototype.predisplay_actions = () => {\n    /*\n    FIXME: use a canvas library to handle popups.\n    //\n    // Add support for popups.\n    //\n    var tile = this,\n        popups = {};\n\n    // Only show popups in Pack mode.\n    if (tile.mode !== \"Pack\") { return; }\n\n    $(this.html_elt).hover(\n    function() {\n        this.hovered = true;\n        $(this).mousemove();\n    },\n    function() {\n        this.hovered = false;\n        // Clear popup if it is still hanging around (this is probably not needed)\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    } ).mousemove(function (e) {\n        // Use the hover plugin to get a delay before showing popup\n        if ( !this.hovered ) { return; }\n        // Get feature data for position.\n        var\n            this_offset = $(this).offset(),\n            offsetX = e.pageX - this_offset.left,\n            offsetY = e.pageY - this_offset.top,\n            feature_data = tile.feature_mapper.get_feature_data(offsetX, offsetY),\n            feature_uid = (feature_data ? feature_data[0] : null);\n        // Hide visible popup if not over a feature or over a different feature.\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").each(function() {\n            if ( !feature_uid ||\n                 $(this).attr(\"id\") !== feature_uid.toString() ) {\n                $(this).remove();\n            }\n        });\n\n        if (feature_data) {\n            // Get or create popup.\n            var popup = popups[feature_uid];\n            if (!popup) {\n                // Create feature's popup element.\n                var feature_dict = {\n                        name: feature_data[3],\n                        start: feature_data[1],\n                        end: feature_data[2],\n                        strand: feature_data[4]\n                    },\n                    filters = tile.track.filters_manager.filters,\n                    filter;\n\n                // Add filter values to feature dict.\n                for (var i = 0; i < filters.length; i++) {\n                    filter = filters[i];\n                    feature_dict[filter.name] = feature_data[filter.index];\n                }\n\n                // Build popup.\n                popup = $(\"<div/>\").attr(\"id\", feature_uid).addClass(\"feature-popup\");\n                var table = $(\"<table/>\"),\n                    key, value, row;\n                for (key in feature_dict) {\n                    value = feature_dict[key];\n                    row = $(\"<tr/>\").appendTo(table);\n                    $(\"<th/>\").appendTo(row).text(key);\n                    $(\"<td/>\").attr(\"align\", \"left\").appendTo(row)\n                              .text(typeof(value) === 'number' ? round(value, 2) : value);\n                }\n                popup.append( $(\"<div class='feature-popup-inner'>\").append( table ) );\n                popups[feature_uid] = popup;\n            }\n\n            // Attach popup to track's overlay.\n            popup.appendTo( $(this).parents(\".track-content\").children(\".overlay\") );\n\n            // Offsets are within canvas, but popup must be positioned relative to parent element.\n            // parseInt strips \"px\" from left, top measurements. +7 so that mouse pointer does not\n            // overlap popup.\n            var\n                popupX = offsetX + parseInt( tile.html_elt.css(\"left\"), 10 ) - popup.width() / 2,\n                popupY = offsetY + parseInt( tile.html_elt.css(\"top\"), 10 ) + 7;\n            popup.css(\"left\", popupX + \"px\").css(\"top\", popupY + \"px\");\n        }\n        else if (!e.isPropagationStopped()) {\n            // Propogate event to other tiles because overlapping tiles prevent mousemove from being\n            // called on tiles under this tile.\n            e.stopPropagation();\n            $(this).siblings().each(function() {\n                $(this).trigger(e);\n            });\n        }\n    })\n    .mouseleave(function() {\n        $(this).parents(\".track-content\").children(\".overlay\").children(\".feature-popup\").remove();\n    });\n    */\n};\n\n/**\n * Tracks are objects can be added to the View.\n *\n * Track object hierarchy:\n * Track\n * -> LabelTrack\n * -> TiledTrack\n * ----> LineTrack\n * ----> ReferenceTrack\n * ----> FeatureTrack\n * -------> ReadTrack\n * ----> VariantTrack\n */\nvar Track = function(view, container, obj_dict) {\n    // For now, track's container is always view.\n    extend(obj_dict, {\n        drag_handle_class: \"draghandle\"\n    });\n    Drawable.call(this, view, container, obj_dict);\n\n    //\n    // Attribute init.\n    //\n\n    // Set or create dataset.\n    this.dataset = null;\n    if (obj_dict.dataset) {\n        // Dataset can be a Backbone model or a dict that can be used to create a model.\n        this.dataset =\n            obj_dict.dataset instanceof Backbone.Model ? obj_dict.dataset : new data.Dataset(obj_dict.dataset);\n    }\n    this.dataset_check_type = \"converted_datasets_state\";\n    this.data_url_extra_params = {};\n    this.data_query_wait = \"data_query_wait\" in obj_dict ? obj_dict.data_query_wait : DEFAULT_DATA_QUERY_WAIT;\n    // A little ugly creating data manager right now due to transition to Backbone-based objects.\n    this.data_manager =\n        \"data_manager\" in obj_dict\n            ? obj_dict.data_manager\n            : new visualization.GenomeDataManager({\n                  dataset: this.dataset,\n                  // HACK: simulate 'genome' attributes from view for now.\n                  // View should eventually use Genome object.\n                  genome: new visualization.Genome({\n                      key: view.dbkey,\n                      chroms_info: {\n                          chrom_info: view.chrom_data\n                      }\n                  }),\n                  data_mode_compatible: this.data_and_mode_compatible,\n                  can_subset: this.can_subset\n              });\n\n    // Height attributes: min height, max height, and visible height.\n    this.min_height_px = 16;\n    this.max_height_px = 800;\n    this.visible_height_px = this.config.get_value(\"height\");\n\n    //\n    // Create content div, which is where track is displayed, and add to container if available.\n    //\n    this.content_div = $(\"<div class='track-content'>\").appendTo(this.container_div);\n    if (this.container) {\n        this.container.content_div.append(this.container_div);\n        if (!(\"resize\" in obj_dict) || obj_dict.resize) {\n            this.add_resize_handle();\n        }\n    }\n};\n\nextend(Track.prototype, Drawable.prototype, {\n    action_icons_def: [\n        // Change track mode.\n        {\n            name: \"mode_icon\",\n            title: \"Set display mode\",\n            css_class: \"chevron-expand\",\n            on_click_fn: function() {}\n        },\n        // Hide/show content.\n        Drawable.prototype.action_icons_def[0],\n        // Set track as overview.\n        {\n            name: \"overview_icon\",\n            title: \"Set as overview\",\n            css_class: \"application-dock-270\",\n            on_click_fn: function(track) {\n                track.view.set_overview(track);\n            }\n        },\n        // Edit config.\n        Drawable.prototype.action_icons_def[1],\n        // Toggle track filters.\n        {\n            name: \"filters_icon\",\n            title: \"Filters\",\n            css_class: \"ui-slider-050\",\n            on_click_fn: function(drawable) {\n                // TODO: update Tooltip text.\n                if (drawable.filters_manager.visible()) {\n                    drawable.filters_manager.clear_filters();\n                } else {\n                    drawable.filters_manager.init_filters();\n                }\n                drawable.filters_manager.toggle();\n            }\n        },\n        // Toggle track tool.\n        {\n            name: \"tools_icon\",\n            title: \"Tool\",\n            css_class: \"hammer\",\n            on_click_fn: function(track) {\n                // TODO: update Tooltip text.\n\n                track.tool.toggle();\n\n                // Update track name.\n                if (track.tool.is_visible()) {\n                    track.set_name(track.config.get_value(\"name\") + track.tool_region_and_parameters_str());\n                } else {\n                    track.revert_name();\n                }\n                // HACK: name change modifies icon placement, which leaves tooltip incorrectly placed.\n                $(\".tooltip\").remove();\n            }\n        },\n        // Go to parameter exploration visualization.\n        {\n            name: \"param_space_viz_icon\",\n            title: \"Tool parameter space visualization\",\n            css_class: \"arrow-split\",\n            on_click_fn: function(track) {\n                var html = `<strong>Tool</strong>:${track.tool.get(\n                    \"name\"\n                )}<br/><strong>Dataset</strong>:${track.config.get_value(\n                    \"name\"\n                )}<br/><strong>Region(s)</strong>: <select name=\"regions\"><option value=\"cur\">current viewing area</option><option value=\"bookmarks\">bookmarks</option><option value=\"both\">current viewing area and bookmarks</option></select>`;\n\n                var cancel_fn = () => {\n                    Galaxy.modal.hide();\n                    $(window).unbind(\"keypress.check_enter_esc\");\n                };\n\n                var ok_fn = () => {\n                    var regions_to_use = $('select[name=\"regions\"] option:selected').val(),\n                        regions,\n                        view_region = new visualization.GenomeRegion({\n                            chrom: view.chrom,\n                            start: view.low,\n                            end: view.high\n                        }),\n                        bookmarked_regions = _.map(\n                            $(\".bookmark\"),\n                            elt =>\n                                new visualization.GenomeRegion({\n                                    from_str: $(elt)\n                                        .children(\".position\")\n                                        .text()\n                                })\n                        );\n\n                    // Get regions for visualization.\n                    if (regions_to_use === \"cur\") {\n                        // Use only current region.\n                        regions = [view_region];\n                    } else if (regions_to_use === \"bookmarks\") {\n                        // Use only bookmarks.\n                        regions = bookmarked_regions;\n                    } else {\n                        // Use both current region and bookmarks.\n                        regions = [view_region].concat(bookmarked_regions);\n                    }\n\n                    Galaxy.modal.hide();\n\n                    // Go to visualization.\n                    window.location.href = `${Galaxy.root}visualization/sweepster?${$.param({\n                        dataset_id: track.dataset.id,\n                        hda_ldda: track.dataset.get(\"hda_ldda\"),\n                        regions: JSON.stringify(new Backbone.Collection(regions).toJSON())\n                    })}`;\n                };\n\n                var check_enter_esc = e => {\n                    if ((e.keyCode || e.which) === 27) {\n                        // Escape key\n                        cancel_fn();\n                    } else if ((e.keyCode || e.which) === 13) {\n                        // Enter key\n                        ok_fn();\n                    }\n                };\n\n                // show dialog\n                Galaxy.modal.show({\n                    title: \"Visualize tool parameter space and output from different parameter settings?\",\n                    body: html,\n                    buttons: { No: cancel_fn, Yes: ok_fn }\n                });\n            }\n        },\n        // Remove track.\n        Drawable.prototype.action_icons_def[2]\n    ],\n\n    can_draw: function() {\n        return this.dataset && Drawable.prototype.can_draw.call(this);\n    },\n\n    build_container_div: function() {\n        return $(\"<div/>\")\n            .addClass(\"track\")\n            .attr(\"id\", `track_${this.id}`);\n    },\n\n    /**\n     * Set track's dataset.\n     */\n    set_dataset: function(dataset) {\n        this.dataset = dataset;\n        this.data_manager.set(\"dataset\", dataset);\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function() {\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Add resizing handle to drawable's container_div.\n     */\n    add_resize_handle: function() {\n        var track = this;\n        var in_handle = false;\n        var in_drag = false;\n        var drag_control = $(\"<div class='track-resize'>\");\n        // Control shows on hover over track, stays while dragging\n        $(track.container_div).hover(\n            () => {\n                if (track.config.get_value(\"content_visible\")) {\n                    in_handle = true;\n                    drag_control.show();\n                }\n            },\n            () => {\n                in_handle = false;\n                if (!in_drag) {\n                    drag_control.hide();\n                }\n            }\n        );\n        // Update height and force redraw of current view while dragging,\n        // clear cache to force redraw of other tiles.\n        drag_control\n            .hide()\n            .bind(\"dragstart\", (e, d) => {\n                in_drag = true;\n                d.original_height = $(track.content_div).height();\n            })\n            .bind(\"drag\", (e, d) => {\n                var new_height = Math.min(\n                    Math.max(d.original_height + d.deltaY, track.min_height_px),\n                    track.max_height_px\n                );\n                $(track.tiles_div).css(\"height\", new_height);\n                track.visible_height_px = track.max_height_px === new_height ? 0 : new_height;\n                track.on_resize();\n            })\n            .bind(\"dragend\", (e, d) => {\n                track.tile_cache.clear();\n                in_drag = false;\n                if (!in_handle) {\n                    drag_control.hide();\n                }\n                track.config.set_value(\"height\", track.visible_height_px);\n                track.changed();\n            })\n            .appendTo(track.container_div);\n    },\n\n    /**\n     * Hide any elements that are part of the tracks contents area. Should\n     * remove as approprite, the track will be redrawn by show_contents.\n     */\n    hide_contents: function() {\n        // Hide tiles.\n        this.tiles_div.hide();\n        // Hide any y axis labels (common to several track types)\n        this.container_div.find(\".yaxislabel, .track-resize\").hide();\n    },\n\n    show_contents: function() {\n        // Show the contents div and labels (if present)\n        this.tiles_div.show();\n        this.container_div.find(\".yaxislabel, .track-resize\").show();\n        // Request a redraw of the content\n        this.request_draw();\n    },\n\n    /**\n     * Returns track type.\n     */\n    get_type: function() {\n        // Order is important: start with most-specific classes and go up the track hierarchy.\n        if (this instanceof LabelTrack) {\n            return \"LabelTrack\";\n        } else if (this instanceof ReferenceTrack) {\n            return \"ReferenceTrack\";\n        } else if (this instanceof LineTrack) {\n            return \"LineTrack\";\n        } else if (this instanceof ReadTrack) {\n            return \"ReadTrack\";\n        } else if (this instanceof VariantTrack) {\n            return \"VariantTrack\";\n        } else if (this instanceof CompositeTrack) {\n            return \"CompositeTrack\";\n        } else if (this instanceof FeatureTrack) {\n            return \"FeatureTrack\";\n        }\n        return \"\";\n    },\n\n    /**\n     * Remove visualization content and display message.\n     */\n    show_message: function(msg_html) {\n        this.tiles_div.remove();\n        return $(\"<span/>\")\n            .addClass(\"message\")\n            .html(msg_html)\n            .appendTo(this.content_div);\n    },\n\n    /**\n     * Initialize and draw the track.\n     */\n    init: function(retry) {\n        // FIXME: track should have a 'state' attribute that is checked on load; this state attribute should be\n        // used in this function to determine what action(s) to take.\n\n        var track = this;\n        track.enabled = false;\n        track.tile_cache.clear();\n        track.data_manager.clear();\n        /*\n        if (!track.content_div.text()) {\n            track.content_div.text(DATA_LOADING);\n        }\n        */\n        // Remove old track content (e.g. tiles, messages).\n        track.content_div.children().remove();\n        track.container_div.removeClass(\"nodata error pending\");\n\n        track.tiles_div = $(\"<div/>\")\n            .addClass(\"tiles\")\n            .appendTo(track.content_div);\n\n        //\n        // Tracks with no dataset id are handled differently.\n        // FIXME: is this really necessary?\n        //\n        if (!track.dataset.id) {\n            return;\n        }\n\n        // Get dataset state; if state is fine, enable and draw track. Otherwise, show message\n        // about track status.\n        var init_deferred = $.Deferred();\n\n        var params = {\n            hda_ldda: track.dataset.get(\"hda_ldda\"),\n            data_type: this.dataset_check_type,\n            chrom: track.view.chrom,\n            retry: retry\n        };\n\n        $.getJSON(this.dataset.url(), params, result => {\n            if (!result || result === \"error\" || result.kind === \"error\") {\n                // Dataset is in error state.\n                track.container_div.addClass(\"error\");\n                var msg_elt = track.show_message(DATA_ERROR);\n                if (result.message) {\n                    // Add links to (a) show error and (b) try again.\n                    msg_elt.append(\n                        $(\"<a href='javascript:void(0);'></a>\")\n                            .text(\"View error\")\n                            .click(() => {\n                                Galaxy.modal.show({\n                                    title: \"Trackster Error\",\n                                    body: `<pre>${result.message}</pre>`,\n                                    buttons: {\n                                        Close: function() {\n                                            Galaxy.modal.hide();\n                                        }\n                                    }\n                                });\n                            })\n                    );\n                    msg_elt.append($(\"<span/>\").text(\" \"));\n                    msg_elt.append(\n                        $(\"<a href='javascript:void(0);'></a>\")\n                            .text(\"Try again\")\n                            .click(() => {\n                                track.init(true);\n                            })\n                    );\n                }\n            } else if (result === \"no converter\") {\n                track.container_div.addClass(\"error\");\n                track.show_message(DATA_NOCONVERTER);\n            } else if (\n                result === \"no data\" ||\n                (result.data !== undefined && (result.data === null || result.data.length === 0))\n            ) {\n                track.container_div.addClass(\"nodata\");\n                track.show_message(DATA_NONE);\n            } else if (result === \"pending\") {\n                track.container_div.addClass(\"pending\");\n                track.show_message(DATA_PENDING);\n                //$(\"<img/>\").attr(\"src\", image_path + \"/yui/rel_interstitial_loading.gif\").appendTo(track.tiles_div);\n                setTimeout(() => {\n                    track.init();\n                }, track.data_query_wait);\n            } else if (result === \"data\" || result.status === \"data\") {\n                if (result.valid_chroms) {\n                    track.valid_chroms = result.valid_chroms;\n                    track.update_icons();\n                }\n                track.tiles_div.text(DATA_OK);\n                if (track.view.chrom) {\n                    track.tiles_div.text(\"\");\n                    track.tiles_div.css(\"height\", `${track.visible_height_px}px`);\n                    track.enabled = true;\n                    // predraw_init may be asynchronous, wait for it and then draw\n                    $.when.apply($, track.predraw_init()).done(() => {\n                        init_deferred.resolve();\n                        track.container_div.removeClass(\"nodata error pending\");\n                        track.request_draw();\n                    });\n                } else {\n                    init_deferred.resolve();\n                }\n            }\n        });\n\n        this.update_icons();\n        return init_deferred;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var track = this;\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                var data = result.data;\n\n                // Tracks may not have stat data either because there is no data or data is not yet ready.\n                if (data && data.min !== undefined && data.max !== undefined) {\n                    // Compute default minimum and maximum values\n                    var min_value = data.min;\n\n                    var max_value = data.max;\n                    // If mean and sd are present, use them to compute a ~95% window\n                    // but only if it would shrink the range on one side\n                    min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                    max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                    // Update config, prefs\n                    track.config.set_default_value(\"min_value\", min_value);\n                    track.config.set_default_value(\"max_value\", max_value);\n                    track.config.set_value(\"min_value\", min_value);\n                    track.config.set_value(\"max_value\", max_value);\n                }\n            }\n        );\n    },\n\n    /**\n     * Returns all drawables in this drawable.\n     */\n    get_drawables: function() {\n        return this;\n    }\n});\n\nvar TiledTrack = function(view, container, obj_dict) {\n    Track.call(this, view, container, obj_dict);\n\n    var track = this;\n\n    // Make track moveable.\n    moveable(track.container_div, track.drag_handle_class, \".group\", track);\n\n    // Attribute init.\n    this.filters_manager = new filters_mod.FiltersManager(this, \"filters\" in obj_dict ? obj_dict.filters : null);\n    // HACK: set filters manager for data manager.\n    // FIXME: prolly need function to set filters and update data_manager reference.\n    this.data_manager.set(\"filters_manager\", this.filters_manager);\n    this.filters_available = false;\n    this.tool = obj_dict.tool\n        ? new TracksterTool(\n              _.extend(obj_dict.tool, {\n                  track: this,\n                  tool_state: obj_dict.tool_state\n              })\n          )\n        : null;\n    this.tile_cache = new visualization.Cache(TILE_CACHE_SIZE);\n    this.left_offset = 0;\n\n    if (this.header_div) {\n        //\n        // Setup filters.\n        //\n        this.set_filters_manager(this.filters_manager);\n\n        //\n        // Create dynamic tool view.\n        //\n        if (this.tool) {\n            var tool_view = new TracksterToolView({ model: this.tool });\n            tool_view.render();\n            this.dynamic_tool_div = tool_view.$el;\n            this.header_div.after(this.dynamic_tool_div);\n        }\n    }\n\n    // Add tiles_div, overlay_div to content_div.\n    this.tiles_div = $(\"<div/>\")\n        .addClass(\"tiles\")\n        .appendTo(this.content_div);\n    if (!this.config.get_value(\"content_visible\")) {\n        this.tiles_div.hide();\n    }\n    this.overlay_div = $(\"<div/>\")\n        .addClass(\"overlay\")\n        .appendTo(this.content_div);\n\n    if (obj_dict.mode) {\n        this.change_mode(obj_dict.mode);\n    }\n};\nextend(TiledTrack.prototype, Drawable.prototype, Track.prototype, {\n    action_icons_def: Track.prototype.action_icons_def.concat([\n        // Show more rows when all features are not slotted.\n        {\n            name: \"show_more_rows_icon\",\n            title: \"To minimize track height, not all feature rows are displayed. Click to display more rows.\",\n            css_class: \"exclamation\",\n            on_click_fn: function(track) {\n                $(\".tooltip\").remove();\n                track.slotters[track.view.resolution_px_b].max_rows *= 2;\n                track.request_draw({ clear_tile_cache: true });\n            },\n            hide: true\n        }\n    ]),\n\n    /**\n     * Returns a copy of the track. The copy uses the same data manager so that the tracks can share data.\n     */\n    copy: function(container) {\n        // Create copy.\n        var obj_dict = this.to_dict();\n        extend(obj_dict, {\n            data_manager: this.data_manager\n        });\n        var new_track = new this.constructor(this.view, container, obj_dict);\n        // Misc. init and return.\n        new_track.change_mode(this.mode);\n        new_track.enabled = this.enabled;\n        return new_track;\n    },\n\n    /**\n     * Set filters manager + HTML elements.\n     */\n    set_filters_manager: function(filters_manager) {\n        this.filters_manager = filters_manager;\n        this.header_div.after(this.filters_manager.parent_div);\n    },\n\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: function() {\n        return {\n            track_type: this.get_type(),\n            dataset: {\n                id: this.dataset.id,\n                hda_ldda: this.dataset.get(\"hda_ldda\")\n            },\n            prefs: this.config.to_key_value_dict(),\n            mode: this.mode,\n            filters: this.filters_manager.to_dict(),\n            tool_state: this.tool ? this.tool.state_dict() : {}\n        };\n    },\n\n    /**\n     * Set track bounds for current chromosome.\n     */\n    set_min_max: function() {\n        var track = this;\n\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                var data = result.data;\n                if (\n                    isNaN(parseFloat(track.config.get_value(\"min_value\"))) ||\n                    isNaN(parseFloat(track.config.get_value(\"max_value\")))\n                ) {\n                    // Compute default minimum and maximum values\n                    var min_value = data.min;\n\n                    var max_value = data.max;\n                    // If mean and sd are present, use them to compute a ~95% window\n                    // but only if it would shrink the range on one side\n                    min_value = Math.floor(Math.min(0, Math.max(min_value, data.mean - 2 * data.sd)));\n                    max_value = Math.ceil(Math.max(0, Math.min(max_value, data.mean + 2 * data.sd)));\n                    // Update the prefs\n                    track.config.set_value(\"min_value\", min_value);\n                    track.config.set_value(\"max_value\", max_value);\n                }\n            }\n        );\n    },\n\n    /**\n     * Change track's mode.\n     */\n    change_mode: function(new_mode) {\n        var track = this;\n        // TODO: is it necessary to store the mode in two places (.mode and track_config)?\n        track.mode = new_mode;\n        track.config.set_value(\"mode\", new_mode);\n        // FIXME: find a better way to get Auto data w/o clearing cache; using mode in the\n        // data manager would work if Auto data were checked for compatibility when a specific\n        // mode is chosen.\n        if (new_mode === \"Auto\") {\n            this.data_manager.clear();\n        }\n        track.request_draw({ clear_tile_cache: true });\n        this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: ${track.mode})`);\n        return track;\n    },\n\n    /**\n     * Update track's buttons.\n     */\n    update_icons: function() {\n        var track = this;\n\n        //\n        // Show/hide filter icon.\n        //\n        track.action_icons.filters_icon.toggle(track.filters_available);\n\n        //\n        // Show/hide tool icons.\n        //\n        track.action_icons.tools_icon.toggle(track.tool !== null);\n        track.action_icons.param_space_viz_icon.toggle(track.tool !== null);\n    },\n\n    /**\n     * Generate a key for the tile cache.\n     * TODO: create a TileCache object (like DataCache) and generate key internally.\n     */\n    _gen_tile_cache_key: function(w_scale, tile_region) {\n        return `${w_scale}_${tile_region}`;\n    },\n\n    /**\n     * Request that track be drawn.\n     */\n    request_draw: function(options) {\n        if (options && options.clear_tile_cache) {\n            this.tile_cache.clear();\n        }\n        this.view.request_redraw(options, this);\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    before_draw: function() {\n        // Clear because this is set when drawing.\n        this.max_height_px = 0;\n    },\n\n    /**\n     * Draw track. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -clear_after: clear old tiles after drawing new tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     *\n     * NOTE: this function should never be called directly; use request_draw() so that drawing\n     * management can be used.\n     */\n    _draw: function(options) {\n        if (!this.can_draw()) {\n            return;\n        }\n\n        var clear_after = options && options.clear_after;\n        var low = this.view.low;\n        var high = this.view.high;\n        var range = high - low;\n        var width = this.view.container.width();\n        var w_scale = this.view.resolution_px_b;\n        var resolution = 1 / w_scale;\n\n        // For overview, adjust high, low, resolution, and w_scale.\n        if (this.is_overview) {\n            low = this.view.max_low;\n            high = this.view.max_high;\n            w_scale = width / (view.max_high - view.max_low);\n            resolution = 1 / w_scale;\n        }\n\n        this.before_draw();\n\n        //\n        // Method for moving and/or removing tiles:\n        // (a) mark all elements for removal using class 'remove'\n        // (b) during tile drawing/placement, remove class for elements that are moved;\n        //     this occurs in show_tile()\n        // (c) after drawing tiles, remove elements still marked for removal\n        //     (i.e. that still have class 'remove').\n        //\n\n        // Step (a) for (re)moving tiles.\n        this.tiles_div.children().addClass(\"remove\");\n\n        var // Tile width in bases.\n        tile_width = Math.floor(TILE_SIZE * resolution);\n\n        var // Index of first tile that overlaps visible region.\n        tile_index = Math.floor(low / tile_width);\n\n        var tile_region;\n        var tile_promise;\n        var tile_promises = [];\n        var tiles = [];\n        // Draw tiles.\n        while (tile_index * tile_width < high) {\n            // Get tile region.\n            tile_region = new visualization.GenomeRegion({\n                chrom: this.view.chrom,\n                start: tile_index * tile_width,\n                // Tile high cannot be larger than view.max_high, which the chromosome length.\n                end: Math.min((tile_index + 1) * tile_width, this.view.max_high)\n            });\n            tile_promise = this.draw_helper(tile_region, w_scale, options);\n            tile_promises.push(tile_promise);\n            $.when(tile_promise).then(tile => {\n                tiles.push(tile);\n            });\n\n            // Go to next tile.\n            tile_index += 1;\n        }\n\n        // Step (c) for (re)moving tiles when clear_after is false.\n        if (!clear_after) {\n            this.tiles_div\n                .children(\".remove\")\n                .removeClass(\"remove\")\n                .remove();\n        }\n\n        // When all tiles are drawn, call post-draw actions.\n        var track = this;\n        $.when.apply($, tile_promises).then(() => {\n            // Step (c) for (re)moving tiles when clear_after is true:\n            track.tiles_div.children(\".remove\").remove();\n\n            // Only do postdraw actions for tiles; instances where tiles may not be drawn include:\n            // (a) ReferenceTrack without sufficient resolution;\n            // (b) data_fetch = false.\n            tiles = _.filter(tiles, t => t !== null);\n            if (tiles.length !== 0) {\n                track.postdraw_actions(tiles, width, w_scale, clear_after);\n            }\n        });\n    },\n\n    /**\n     * Add a maximum/minimum label to track.\n     */\n    _add_yaxis_label: function(type, on_change) {\n        var track = this;\n        var css_class = type === \"max\" ? \"top\" : \"bottom\";\n        var text = type === \"max\" ? \"max\" : \"min\";\n        var pref_name = type === \"max\" ? \"max_value\" : \"min_value\";\n        var label = this.container_div.find(`.yaxislabel.${css_class}`);\n        var value = round(track.config.get_value(pref_name), 1);\n\n        // Default action for on_change is to redraw track.\n        on_change =\n            on_change ||\n            (() => {\n                track.request_draw({ clear_tile_cache: true });\n            });\n\n        if (label.length !== 0) {\n            // Label already exists, so update value.\n            label.text(value);\n        } else {\n            // Add label.\n            label = $(\"<div/>\")\n                .text(value)\n                .make_text_editable({\n                    num_cols: 12,\n                    on_finish: function(new_val) {\n                        $(\".tooltip\").remove();\n                        track.config.set_value(pref_name, round(new_val, 1));\n                        on_change();\n                    },\n                    help_text: `Set ${text} value`\n                })\n                .addClass(`yaxislabel ${css_class}`)\n                .css(\"color\", this.config.get_value(\"label_color\"));\n            this.container_div.prepend(label);\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        var line_track_tiles = _.filter(tiles, tile => tile instanceof LineTrackTile);\n\n        //\n        // Take different actions depending on whether there are LineTrack/Coverage tiles.\n        //\n\n        if (line_track_tiles.length > 0) {\n            // -- Drawing in Coverage mode. --\n\n            // Clear because this is set when drawing.\n            this.max_height_px = 0;\n            var track = this;\n            _.each(tiles, tile => {\n                if (!(tile instanceof LineTrackTile)) {\n                    tile.html_elt.remove();\n                    track.draw_helper(tile.region, w_scale, {\n                        force: true,\n                        mode: \"Coverage\"\n                    });\n                }\n            });\n\n            track._add_yaxis_label(\"max\");\n        } else {\n            // -- Drawing in non-Coverage mode. --\n\n            // Remove Y-axis labels because there are no line track tiles.\n            this.container_div.find(\".yaxislabel\").remove();\n\n            //\n            // If some tiles have icons, set padding of tiles without icons so features and rows align.\n            //\n            var icons_present = _.find(tiles, tile => tile.has_icons);\n\n            if (icons_present) {\n                _.each(tiles, tile => {\n                    if (!tile.has_icons) {\n                        // Need to align with other tile(s) that have icons.\n                        tile.html_elt.css(\"padding-top\", ERROR_PADDING);\n                    }\n                });\n            }\n        }\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function(data) {\n        return this.mode;\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function(display_mode) {\n        // FIXME: needs to be implemented.\n    },\n\n    /**\n     * Returns a list of drawables to draw. Defaults to current track.\n     */\n    _get_drawables: function() {\n        return [this];\n    },\n\n    /**\n     * Retrieves from cache, draws, or sets up drawing for a single tile. Returns either a Tile object or a\n     * jQuery.Deferred object that is fulfilled when tile can be drawn again. Options include:\n     * -force: force a redraw rather than use cached tiles (default: false)\n     * -data_fetch: fetch data if necessary (default: true)\n     */\n    draw_helper: function(region, w_scale, options) {\n        // Init options if necessary to avoid having to check if options defined.\n        if (!options) {\n            options = {};\n        }\n\n        var force = options.force;\n        var mode = options.mode || this.mode;\n        var resolution = 1 / w_scale;\n\n        var // Useful vars.\n        track = this;\n\n        var drawables = this._get_drawables();\n        var key = this._gen_tile_cache_key(w_scale, region);\n\n        var is_tile = o => o && \"track\" in o;\n\n        // Check tile cache, if found show existing tile in correct position\n        var tile = force ? undefined : track.tile_cache.get_elt(key);\n        if (tile) {\n            if (is_tile(tile)) {\n                track.show_tile(tile, w_scale);\n            }\n            return tile;\n        }\n\n        // If not fetching data, nothing more to do because data is needed to draw tile.\n        if (options.data_fetch === false) {\n            return null;\n        }\n\n        // Function that returns data/Deferreds needed to draw tile.\n        var get_tile_data = () => {\n            // HACK: if display mode (mode) is in continuous data modes, data mode must be coverage to get coverage data.\n            var data_mode = _.find(CONTINUOUS_DATA_MODES, m => m === mode) ? \"Coverage\" : mode;\n\n            // Map drawable object to data needed for drawing.\n            var tile_data = _.map(drawables, (\n                d // Get the track data/promise.\n            ) => d.data_manager.get_data(region, data_mode, resolution, track.data_url_extra_params));\n\n            // Get reference data/promise.\n            if (view.reference_track) {\n                tile_data.push(\n                    view.reference_track.data_manager.get_data(\n                        region,\n                        mode,\n                        resolution,\n                        view.reference_track.data_url_extra_params\n                    )\n                );\n            }\n\n            return tile_data;\n        };\n\n        //\n        // When data is available, draw tile.\n        //\n        var tile_drawn = $.Deferred();\n        track.tile_cache.set_elt(key, tile_drawn);\n        $.when.apply($, get_tile_data()).then(() => {\n            var tile_data = get_tile_data();\n            var tracks_data = tile_data;\n            var seq_data;\n\n            // Deferreds may show up here if trying to fetch a subset of data from a superset data chunk\n            // that cannot be subsetted. This may occur if the superset has a message. If there is a\n            // Deferred, try again from the top. NOTE: this condition could (should?) be handled by the\n            // GenomeDataManager in visualization module.\n            if (_.find(tile_data, d => util.is_deferred(d))) {\n                track.tile_cache.set_elt(key, undefined);\n                $.when(track.draw_helper(region, w_scale, options)).then(tile => {\n                    tile_drawn.resolve(tile);\n                });\n                return;\n            }\n\n            // If sequence data is available, subset to get only data in region.\n            if (view.reference_track) {\n                seq_data = view.reference_track.data_manager.subset_entry(tile_data.pop(), region);\n            }\n\n            // Get drawing modes, heights for all tracks.\n            var drawing_modes = [];\n\n            var drawing_heights = [];\n\n            _.each(drawables, (d, i) => {\n                var mode = d.mode;\n                var data = tracks_data[i];\n                if (mode === \"Auto\") {\n                    mode = d.get_mode(data);\n                    d.update_auto_mode(mode);\n                }\n                drawing_modes.push(mode);\n                drawing_heights.push(d.get_canvas_height(data, mode, w_scale, width));\n            });\n\n            var canvas = track.view.canvas_manager.new_canvas();\n            var tile_low = region.get(\"start\");\n            var tile_high = region.get(\"end\");\n            var all_data_index = 0;\n\n            var width = Math.ceil((tile_high - tile_low) * w_scale) + track.left_offset;\n\n            var height = _.max(drawing_heights);\n            var tile;\n\n            //\n            // Draw all tracks on tile.\n            //\n            canvas.width = width;\n            // Height is specified in options or is the height found above.\n            canvas.height = options.height || height;\n            var ctx = canvas.getContext(\"2d\");\n            ctx.translate(track.left_offset, 0);\n            if (drawables.length > 1) {\n                ctx.globalAlpha = 0.5;\n                ctx.globalCompositeOperation = \"source-over\";\n            }\n            _.each(drawables, (d, i) => {\n                tile = d.draw_tile(tracks_data[i], ctx, drawing_modes[i], region, w_scale, seq_data);\n            });\n\n            // Don't cache, show if no tile.\n            if (tile !== undefined) {\n                track.tile_cache.set_elt(key, tile);\n                track.show_tile(tile, w_scale);\n            }\n\n            tile_drawn.resolve(tile);\n        });\n\n        return tile_drawn;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        return this.visible_height_px;\n    },\n\n    /**\n     * Draw line (bigwig) data onto tile.\n     */\n    _draw_line_track_tile: function(result, ctx, mode, region, w_scale) {\n        // Set min/max if they are not already set.\n        // FIXME: checking for different null/undefined/0 is messy; it would be nice to\n        // standardize this.\n        if ([undefined, null].indexOf(this.config.get_value(\"min_value\")) !== -1) {\n            this.config.set_value(\"min_value\", 0);\n        }\n        if ([undefined, null, 0].indexOf(this.config.get_value(\"max_value\")) !== -1) {\n            this.config.set_value(\"max_value\", _.max(_.map(result.data, d => d[1])) || 0);\n        }\n\n        var canvas = ctx.canvas;\n\n        var painter = new painters.LinePainter(\n            result.data,\n            region.get(\"start\"),\n            region.get(\"end\"),\n            this.config.to_key_value_dict(),\n            mode\n        );\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new LineTrackTile(this, region, w_scale, canvas, result.data);\n    },\n\n    /**\n     * Draw a track tile.\n     * @param result result from server\n     * @param ctx canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale, ref_seq) {},\n\n    /**\n     * Show track tile and perform associated actions. Showing tile may actually move\n     * an existing tile rather than reshowing it.\n     */\n    show_tile: function(tile, w_scale) {\n        var track = this;\n        var tile_element = tile.html_elt;\n\n        // -- Show/move tile element. --\n\n        tile.predisplay_actions();\n\n        // Position tile element based on current viewport.\n        var left = Math.round((tile.low - (this.is_overview ? this.view.max_low : this.view.low)) * w_scale);\n        if (this.left_offset) {\n            left -= this.left_offset;\n        }\n        tile_element.css(\"left\", left);\n\n        if (tile_element.hasClass(\"remove\")) {\n            // Step (b) for (re)moving tiles. See _draw() function for description of algorithm\n            // for removing tiles.\n            tile_element.removeClass(\"remove\");\n        } else {\n            // Showing new tile.\n            this.tiles_div.append(tile_element);\n        }\n\n        // -- Update track, tile heights based on new tile. --\n\n        tile_element.css(\"height\", \"auto\");\n\n        // Update max height based on current tile's height.\n        // BUG/HACK: tile_element.height() returns a height that is always 2 pixels too big, so\n        // -2 to get the correct height.\n        this.max_height_px = Math.max(this.max_height_px, tile_element.height() - 2);\n\n        // Update height for all tiles based on max height.\n        tile_element\n            .parent()\n            .children()\n            .css(\"height\", `${this.max_height_px}px`);\n\n        // Update track height based on max height and visible height.\n        var track_height = this.max_height_px;\n        if (this.visible_height_px !== 0) {\n            track_height = Math.min(this.max_height_px, this.visible_height_px);\n        }\n        this.tiles_div.css(\"height\", `${track_height}px`);\n    },\n\n    /**\n     * Utility function that creates a label string describing the region and parameters of a track's tool.\n     */\n    tool_region_and_parameters_str: function(region) {\n        var track = this;\n        var region_str = region !== undefined ? region.toString() : \"all\";\n        var param_str = _.values(track.tool.get_inputs_dict()).join(\", \");\n        return ` - region=[${region_str}], parameters=[${param_str}]`;\n    },\n\n    /**\n     * Returns true if data is compatible with a given mode.\n     */\n    data_and_mode_compatible: function(data, mode) {\n        // Only handle modes that user can set.\n        if (mode === \"Auto\") {\n            return true;\n        } else if (mode === \"Coverage\") {\n            // Histogram mode requires bigwig data.\n            return data.dataset_type === \"bigwig\";\n        } else if (data.dataset_type === \"bigwig\" || data.extra_info === \"no_detail\") {\n            // All other modes--Dense, Squish, Pack--require data + details.\n            return false;\n        } else {\n            return true;\n        }\n    },\n\n    /**\n     * Returns true if entry can be subsetted.\n     */\n    can_subset: function(entry) {\n        // Do not subset entries with a message or data with no detail.\n        if (entry.message || entry.extra_info === \"no_detail\") {\n            return false;\n        } else if (entry.dataset_type === \"bigwig\") {\n            // Subset only if data is single-bp resolution.\n            return entry.data[1][0] - entry.data[0][0] === 1;\n        }\n\n        return true;\n    },\n\n    /**\n     * Set up track to receive tool data.\n     */\n    init_for_tool_data: function() {\n        // Set up track to fetch raw data rather than converted data.\n        this.data_manager.set(\"data_type\", \"raw_data\");\n        this.data_query_wait = 1000;\n        this.dataset_check_type = \"state\";\n\n        // FIXME: this is optional and is disabled for now because it creates\n        // additional converter jobs without a clear benefit because indexing\n        // such a small dataset provides little benefit.\n        //\n        // Set up one-time, post-draw to clear tool execution settings.\n        //\n        /*\n        this.normal_postdraw_actions = this.postdraw_actions;\n        this.postdraw_actions = function(tiles, width, w_scale, clear_after) {\n            var self = this;\n\n            // Do normal postdraw init.\n            self.normal_postdraw_actions(tiles, width, w_scale, clear_after);\n\n            // Tool-execution specific post-draw init:\n\n            // Reset dataset check, wait time.\n            self.dataset_check_type = 'converted_datasets_state';\n            self.data_query_wait = DEFAULT_DATA_QUERY_WAIT;\n\n            // Reset data URL when dataset indexing has completed/when not pending.\n            var ss_deferred = new util.ServerStateDeferred({\n                url: self.dataset_state_url,\n                url_params: {dataset_id : self.dataset.id, hda_ldda: self.dataset.get('hda_ldda')},\n                interval: self.data_query_wait,\n                // Set up deferred to check dataset state until it is not pending.\n                success_fn: function(result) { return result !== \"pending\"; }\n            });\n            $.when(ss_deferred.go()).then(function() {\n                // Dataset is indexed, so use converted data.\n                self.data_manager.set('data_type', 'data');\n            });\n\n            // Reset post-draw actions function.\n            self.postdraw_actions = self.normal_postdraw_actions;\n        };\n        */\n    }\n});\n\nvar LabelTrack = function(view, container) {\n    Track.call(this, view, container, {\n        resize: false,\n        header: false\n    });\n    this.container_div.addClass(\"label-track\");\n};\nextend(LabelTrack.prototype, Track.prototype, {\n    init: function() {\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {},\n\n    _draw: function(options) {\n        var view = this.view;\n        var range = view.high - view.low;\n\n        var tickDistance = Math.floor(Math.pow(10, Math.floor(Math.log(range) / Math.log(10))));\n\n        var position = Math.floor(view.low / tickDistance) * tickDistance;\n        var width = this.view.container.width();\n        var new_div = $(\"<div/>\").addClass(\"label-container\");\n        while (position < view.high) {\n            var screenPosition = Math.floor((position - view.low) / range * width);\n            new_div.append(\n                $(\"<div/>\")\n                    .addClass(\"pos-label\")\n                    .text(util.commatize(position))\n                    .css({\n                        left: screenPosition\n                    })\n            );\n            position += tickDistance;\n        }\n        this.content_div.children(\":first\").remove();\n        this.content_div.append(new_div);\n    }\n});\n\n// FIXME: Composite tracks have code for showing composite tracks with line tracks and\n// composite tracks with line + feature tracks. It's probably best if different classes\n// are created for each type of composite track.\n\n/**\n * A tiled track composed of multiple other tracks. Composite tracks only work with\n * bigwig data for now.\n */\nvar CompositeTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n\n    // Init drawables; each drawable is a copy so that config/preferences\n    // are independent of each other. Also init left offset.\n    this.drawables = [];\n    if (\"drawables\" in obj_dict) {\n        var drawable;\n        for (var i = 0; i < obj_dict.drawables.length; i++) {\n            drawable = obj_dict.drawables[i];\n            this.drawables[i] = object_from_template(drawable, view, null);\n\n            // Track's left offset is the max of all tracks.\n            if (drawable.left_offset > this.left_offset) {\n                this.left_offset = drawable.left_offset;\n            }\n        }\n        this.enabled = true;\n    }\n\n    // Set all feature tracks to use Coverage mode.\n    _.each(this.drawables, d => {\n        if (d instanceof FeatureTrack || d instanceof ReadTrack) {\n            d.change_mode(\"Coverage\");\n        }\n    });\n\n    this.update_icons();\n\n    // HACK: needed for saving object for now. Need to generalize get_type() to all Drawables and use\n    // that for object type.\n    this.obj_type = \"CompositeTrack\";\n};\n\nextend(CompositeTrack.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 30,\n                hidden: true\n            }\n        ]);\n    },\n\n    action_icons_def: [\n        // Create composite track from group's tracks.\n        {\n            name: \"composite_icon\",\n            title: \"Show individual tracks\",\n            css_class: \"layers-stack\",\n            on_click_fn: function(track) {\n                $(\".tooltip\").remove();\n                track.show_group();\n            }\n        }\n    ].concat(TiledTrack.prototype.action_icons_def),\n\n    // HACK: CompositeTrack should inherit from DrawableCollection as well.\n    /**\n     * Returns representation of object in a dictionary for easy saving.\n     * Use from_dict to recreate object.\n     */\n    to_dict: DrawableCollection.prototype.to_dict,\n\n    add_drawable: DrawableCollection.prototype.add_drawable,\n\n    unpack_drawables: DrawableCollection.prototype.unpack_drawables,\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Action to take during resize.\n     */\n    on_resize: function() {\n        // Propogate visible height to other tracks.\n        var visible_height = this.visible_height_px;\n        _.each(this.drawables, d => {\n            d.visible_height_px = visible_height;\n        });\n        Track.prototype.on_resize.call(this);\n    },\n\n    /**\n     * Change mode for all tracks.\n     */\n    change_mode: function(new_mode) {\n        TiledTrack.prototype.change_mode.call(this, new_mode);\n        for (var i = 0; i < this.drawables.length; i++) {\n            this.drawables[i].change_mode(new_mode);\n        }\n    },\n\n    /**\n     * Initialize component tracks and draw composite track when all components are initialized.\n     */\n    init: function() {\n        // Init components.\n        var init_deferreds = [];\n        for (var i = 0; i < this.drawables.length; i++) {\n            init_deferreds.push(this.drawables[i].init());\n        }\n\n        // Draw composite when all tracks available.\n        var track = this;\n        $.when.apply($, init_deferreds).then(() => {\n            track.enabled = true;\n            track.request_draw();\n        });\n    },\n\n    update_icons: function() {\n        // For now, hide filters and tool.\n        this.action_icons.filters_icon.hide();\n        this.action_icons.tools_icon.hide();\n        this.action_icons.param_space_viz_icon.hide();\n    },\n\n    can_draw: Drawable.prototype.can_draw,\n\n    _get_drawables: function() {\n        return this.drawables;\n    },\n\n    /**\n     * Replace this track with group that includes individual tracks.\n     */\n    show_group: function() {\n        // Create group with individual tracks.\n        var group = new DrawableGroup(this.view, this.container, {\n            name: this.config.get_value(\"name\")\n        });\n\n        var track;\n        for (var i = 0; i < this.drawables.length; i++) {\n            track = this.drawables[i];\n            track.update_icons();\n            group.add_drawable(track);\n            track.container = group;\n            group.content_div.append(track.container_div);\n        }\n\n        // Replace track with group.\n        var index = this.container.replace_drawable(this, group, true);\n        group.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions taken before drawing.\n     */\n    before_draw: function() {\n        // FIXME: this is needed only if there are feature tracks in the composite track.\n        // TiledTrack.prototype.before_draw.call(this);\n\n        //\n        // Set min, max for tracks to be largest min, max.\n        //\n\n        // Get smallest min, biggest max.\n        var min = _.min(_.map(this.drawables, d => d.config.get_value(\"min_value\")));\n\n        var max = _.max(_.map(this.drawables, d => d.config.get_value(\"max_value\")));\n\n        this.config.set_value(\"min_value\", min);\n        this.config.set_value(\"max_value\", max);\n\n        // Set all tracks to smallest min, biggest max.\n        _.each(this.drawables, d => {\n            d.config.set_value(\"min_value\", min);\n            d.config.set_value(\"max_value\", max);\n        });\n    },\n\n    /**\n     * Update minimum, maximum for component tracks.\n     */\n    update_all_min_max: function() {\n        var track = this;\n        var min_value = this.config.get_value(\"min_value\");\n        var max_value = this.config.get_value(\"max_value\");\n        _.each(this.drawables, d => {\n            d.config.set_value(\"min_value\", min_value);\n            d.config.set_value(\"max_value\", max_value);\n        });\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        // All tiles must be the same height in order to draw LineTracks, so redraw tiles as needed.\n        var max_height = -1;\n\n        var i;\n        for (i = 0; i < tiles.length; i++) {\n            var height = tiles[i].html_elt.find(\"canvas\").height();\n            if (height > max_height) {\n                max_height = height;\n            }\n        }\n\n        for (i = 0; i < tiles.length; i++) {\n            var tile = tiles[i];\n            if (tile.html_elt.find(\"canvas\").height() !== max_height) {\n                this.draw_helper(tile.region, w_scale, {\n                    force: true,\n                    height: max_height\n                });\n                tile.html_elt.remove();\n            }\n        }\n\n        // Wrap function so that it can be called without object reference.\n        var track = this;\n\n        var t = () => {\n            track.update_all_min_max();\n        };\n\n        // Add min, max labels.\n        this._add_yaxis_label(\"min\", t);\n        this._add_yaxis_label(\"max\", t);\n    }\n});\n\n/**\n * Displays reference genome data.\n */\nvar ReferenceTrack = function(view) {\n    TiledTrack.call(this, view, { content_div: view.top_labeltrack }, { resize: false, header: false });\n\n    // Use offset to ensure that bases at tile edges are drawn.\n    this.left_offset = view.canvas_manager.char_width_px;\n    this.container_div.addClass(\"reference-track\");\n    this.data_url = `${Galaxy.root}api/genomes/${this.view.dbkey}`;\n    this.data_url_extra_params = { reference: true };\n    this.data_manager = new visualization.GenomeReferenceDataManager({\n        data_url: this.data_url,\n        can_subset: this.can_subset\n    });\n    this.hide_contents();\n};\nextend(ReferenceTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 13,\n                hidden: true\n            }\n        ]);\n    },\n\n    init: function() {\n        this.data_manager.clear();\n        // Enable by default because there should always be data when drawing track.\n        this.enabled = true;\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {},\n\n    can_draw: Drawable.prototype.can_draw,\n\n    /**\n     * Draws and shows tile if reference data can be displayed; otherwise track is hidden.\n     */\n    draw_helper: function(region, w_scale, options) {\n        var cur_visible = this.tiles_div.is(\":visible\");\n        var new_visible;\n        var tile = null;\n        if (w_scale > this.view.canvas_manager.char_width_px) {\n            this.tiles_div.show();\n            new_visible = true;\n            tile = TiledTrack.prototype.draw_helper.call(this, region, w_scale, options);\n        } else {\n            new_visible = false;\n            this.tiles_div.hide();\n        }\n\n        // NOTE: viewport resizing conceptually belongs in postdraw_actions(), but currently\n        // postdraw_actions is not called when reference track not shown due to no tiles. If\n        // it is moved to postdraw_actions, resize must be called each time because cannot\n        // easily detect showing/hiding.\n\n        // If showing or hiding reference track, resize viewport.\n        if (cur_visible !== new_visible) {\n            this.view.resize_viewport();\n        }\n\n        return tile;\n    },\n\n    can_subset: function(entry) {\n        return true;\n    },\n\n    /**\n     * Draw ReferenceTrack tile.\n     */\n    draw_tile: function(data, ctx, mode, region, w_scale) {\n        // Try to subset data.\n        var subset = this.data_manager.subset_entry(data, region);\n\n        var seq_data = subset.data;\n\n        // Draw sequence data.\n        var canvas = ctx.canvas;\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"center\";\n        for (var c = 0, str_len = seq_data.length; c < str_len; c++) {\n            ctx.fillStyle = this.view.get_base_color(seq_data[c]);\n            ctx.fillText(seq_data[c], Math.floor(c * w_scale), 10);\n        }\n        return new Tile(this, region, w_scale, canvas, subset);\n    }\n});\n\n/**\n * Track displays continuous/numerical data. Track expects position data in 1-based format, i.e. wiggle format.\n */\nvar LineTrack = function(view, container, obj_dict) {\n    this.mode = \"Histogram\";\n    TiledTrack.call(this, view, container, obj_dict);\n    // Need left offset for drawing overlap near tile boundaries.\n    this.left_offset = 30;\n\n    // If server has byte-range support, use BBI data manager to read directly from the BBI file.\n    // FIXME: there should be a flag to wait for this check to complete before loading the track.\n    var self = this;\n    $.when(supportsByteRanges(`${Galaxy.root}datasets/${this.dataset.id}/display`)).then(supportsByteRanges => {\n        if (supportsByteRanges) {\n            self.data_manager = new bbi.BBIDataManager({\n                dataset: self.dataset\n            });\n        }\n    });\n};\n\nextend(LineTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: CONTINUOUS_DATA_MODES,\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            { key: \"color\", label: \"Color\", type: \"color\" },\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"float\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 30,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Actions to be taken before drawing.\n     */\n    // FIXME: can the default behavior be used; right now it breaks during resize.\n    before_draw: function() {},\n\n    /**\n     * Draw track tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n    },\n\n    /**\n     * Subset data only if data is at single-base pair resolution.\n     */\n    can_subset: function(entry) {\n        return entry.data[1][0] - entry.data[0][0] === 1;\n    },\n\n    /**\n     * Add min, max labels.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        // Add min, max labels.\n        this._add_yaxis_label(\"max\");\n        this._add_yaxis_label(\"min\");\n    }\n});\n\n/**\n * Diagonal heatmap for showing interactions data.\n */\nvar DiagonalHeatmapTrack = function(view, container, obj_dict) {\n    this.mode = \"Heatmap\";\n    TiledTrack.call(this, view, container, obj_dict);\n};\n\nextend(DiagonalHeatmapTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Heatmap\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"pos_color\",\n                label: \"Positive Color\",\n                type: \"color\",\n                default_value: \"#FF8C00\"\n            },\n            {\n                key: \"neg_color\",\n                label: \"Negative Color\",\n                type: \"color\",\n                default_value: \"#4169E1\"\n            },\n            {\n                key: \"min_value\",\n                label: \"Min Value\",\n                type: \"int\",\n                default_value: undefined\n            },\n            {\n                key: \"max_value\",\n                label: \"Max Value\",\n                type: \"int\",\n                default_value: undefined\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 500,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var track = this;\n        return $.getJSON(\n            track.dataset.url(),\n            {\n                data_type: \"data\",\n                stats: true,\n                chrom: track.view.chrom,\n                low: 0,\n                high: track.view.max_high,\n                hda_ldda: track.dataset.get(\"hda_ldda\")\n            },\n            result => {\n                var data = result.data;\n            }\n        );\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        // Paint onto canvas.\n        var canvas = ctx.canvas;\n\n        var painter = new painters.DiagonalHeatmapPainter(\n            result.data,\n            region.get(\"start\"),\n            region.get(\"end\"),\n            this.config.to_key_value_dict(),\n            mode\n        );\n\n        painter.draw(ctx, canvas.width, canvas.height, w_scale);\n\n        return new Tile(this, region, w_scale, canvas, result.data);\n    }\n});\n\n/**\n * A track that displays features/regions. Track expects position data in BED format, i.e. 0-based, half-open.\n */\nvar FeatureTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.container_div.addClass(\"feature-track\");\n    this.summary_draw_height = 30;\n    this.slotters = {};\n    this.start_end_dct = {};\n    this.left_offset = 200;\n\n    // this.painter = painters.LinkedFeaturePainter;\n    this.set_painter_from_config();\n};\nextend(FeatureTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"block_color\",\n                label: \"Block color\",\n                type: \"color\"\n            },\n            {\n                key: \"reverse_strand_color\",\n                label: \"Antisense strand color\",\n                type: \"color\"\n            },\n            {\n                key: \"label_color\",\n                label: \"Label color\",\n                type: \"color\",\n                default_value: \"black\"\n            },\n            {\n                key: \"show_counts\",\n                label: \"Show summary counts\",\n                type: \"bool\",\n                default_value: true,\n                help: \"Show the number of items in each bin when drawing summary histogram\"\n            },\n            {\n                key: \"min_value\",\n                label: \"Histogram minimum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"max_value\",\n                label: \"Histogram maximum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"connector_style\",\n                label: \"Connector style\",\n                type: \"select\",\n                default_value: \"fishbones\",\n                options: [\n                    {\n                        label: \"Line with arrows\",\n                        value: \"fishbone\"\n                    },\n                    { label: \"Arcs\", value: \"arcs\" }\n                ]\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.set_painter_from_config();\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    set_painter_from_config: function() {\n        if (this.config.get_value(\"connector_style\") === \"arcs\") {\n            this.painter = painters.ArcLinkedFeaturePainter;\n        } else {\n            this.painter = painters.LinkedFeaturePainter;\n        }\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var track = this;\n        var i;\n\n        var line_track_tiles = _.filter(tiles, t => t instanceof LineTrackTile);\n\n        //\n        // Finish drawing of features that span multiple tiles. Features that span multiple tiles\n        // are labeled incomplete on the tile level because they cannot be completely drawn.\n        //\n        if (line_track_tiles.length === 0) {\n            // Gather incomplete features together.\n            var all_incomplete_features = {};\n            _.each(_.pluck(tiles, \"incomplete_features\"), inc_features => {\n                _.each(inc_features, feature => {\n                    all_incomplete_features[feature[0]] = feature;\n                });\n            });\n\n            // Draw incomplete features on each tile.\n            var self = this;\n            _.each(tiles, tile => {\n                // Remove features already drawn on tile originally.\n                var tile_incomplete_features = _.omit(\n                    all_incomplete_features,\n                    _.map(tile.incomplete_features, f => f[0])\n                );\n\n                // Remove features already drawn on tile in past postdraw actions.\n                tile_incomplete_features = _.omit(tile_incomplete_features, _.keys(tile.other_tiles_features_drawn));\n\n                // Draw tile's incomplete features.\n                if (_.size(tile_incomplete_features) !== 0) {\n                    // To draw incomplete features, create new canvas, copy original canvas/tile onto new\n                    // canvas, and then draw incomplete features on the new canvas.\n                    var features = {\n                        data: _.values(tile_incomplete_features)\n                    };\n\n                    var new_canvas = self.view.canvas_manager.new_canvas();\n                    var new_canvas_ctx = new_canvas.getContext(\"2d\");\n                    new_canvas.height = Math.max(\n                        tile.canvas.height,\n                        self.get_canvas_height(features, tile.mode, tile.w_scale, 100)\n                    );\n                    new_canvas.width = tile.canvas.width;\n                    new_canvas_ctx.drawImage(tile.canvas, 0, 0);\n                    new_canvas_ctx.translate(track.left_offset, 0);\n                    var new_tile = self.draw_tile(\n                        features,\n                        new_canvas_ctx,\n                        tile.mode,\n                        tile.region,\n                        tile.w_scale,\n                        tile.seq_data\n                    );\n                    $(tile.canvas).replaceWith($(new_tile.canvas));\n                    tile.canvas = new_canvas;\n                    _.extend(tile.other_tiles_features_drawn, all_incomplete_features);\n                }\n            });\n        }\n\n        // If mode is Coverage and tiles do not share max, redraw tiles as necessary using new max.\n        /*\n        This code isn't used right now because Coverage mode uses predefined max in preferences.\n        if (track.mode === \"Coverage\") {\n            // Get global max.\n            var global_max = -1;\n            for (i = 0; i < tiles.length; i++) {\n                var cur_max = tiles[i].max_val;\n                if (cur_max > global_max) {\n                    global_max = cur_max;\n                }\n            }\n\n            for (i = 0; i < tiles.length; i++) {\n                var tile = tiles[i];\n                if (tile.max_val !== global_max) {\n                    tile.html_elt.remove();\n                    track.draw_helper(tile.index, w_scale, { more_tile_data: { force: true, max: global_max } } );\n                }\n            }\n        }\n        */\n\n        //\n        // Update filter attributes, UI.\n        //\n\n        // Update filtering UI.\n        if (track.filters_manager) {\n            var filters = track.filters_manager.filters;\n            var f;\n            for (f = 0; f < filters.length; f++) {\n                filters[f].update_ui_elt();\n            }\n\n            // Determine if filters are available; this is based on the tiles' data.\n            // Criteria for filter to be available: (a) it is applicable to tile data and (b) filter min != filter max.\n            var filters_available = false;\n\n            var example_feature;\n            var filter;\n            for (i = 0; i < tiles.length; i++) {\n                if (tiles[i].data.length) {\n                    example_feature = tiles[i].data[0];\n                    for (f = 0; f < filters.length; f++) {\n                        filter = filters[f];\n                        if (filter.applies_to(example_feature) && filter.min !== filter.max) {\n                            filters_available = true;\n                            break;\n                        }\n                    }\n                }\n            }\n\n            // If filter availability changed, hide filter div if necessary and update menu.\n            if (track.filters_available !== filters_available) {\n                track.filters_available = filters_available;\n                if (!track.filters_available) {\n                    track.filters_manager.hide();\n                }\n                track.update_icons();\n            }\n        }\n\n        //\n        // If not all features slotted, show icon for showing more rows (slots).\n        //\n        if (tiles[0] instanceof FeatureTrackTile) {\n            var all_slotted = true;\n            for (i = 0; i < tiles.length; i++) {\n                if (!tiles[i].all_slotted) {\n                    all_slotted = false;\n                    break;\n                }\n            }\n            this.action_icons.show_more_rows_icon.toggle(!all_slotted);\n        } else {\n            this.action_icons.show_more_rows_icon.hide();\n        }\n    },\n\n    /**\n     * Update track interface to show display mode being used.\n     */\n    update_auto_mode: function(mode) {\n        if (this.mode === \"Auto\") {\n            if (mode === \"no_detail\") {\n                mode = \"feature spans\";\n            }\n            this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: Auto/${mode})`);\n        }\n    },\n\n    /**\n     * Place features in slots for drawing (i.e. pack features).\n     * this.slotters[level] is created in this method. this.slotters[level]\n     * is a Slotter object. Returns the number of slots used to pack features.\n     */\n    incremental_slots: function(level, features, mode) {\n        // Get/create incremental slots for level. If display mode changed,\n        // need to create new slots.\n\n        var dummy_context = this.view.canvas_manager.dummy_context;\n\n        var slotter = this.slotters[level];\n        if (!slotter || slotter.mode !== mode) {\n            slotter = new slotting.FeatureSlotter(level, mode, MAX_FEATURE_DEPTH, x => dummy_context.measureText(x));\n            this.slotters[level] = slotter;\n        }\n\n        return slotter.slot_features(features);\n    },\n\n    /**\n     * Returns appropriate display mode based on data.\n     */\n    get_mode: function(data) {\n        var mode;\n        // HACK: use no_detail mode track is in overview to prevent overview from being too large.\n        if (data.extra_info === \"no_detail\" || this.is_overview) {\n            mode = \"no_detail\";\n        } else {\n            // Choose b/t Squish and Pack.\n            // Proxy measures for using Squish:\n            // (a) error message re: limiting number of features shown;\n            // (b) X number of features shown;\n            // (c) size of view shown.\n            // TODO: cannot use (a) and (b) because it requires coordinating mode across tiles;\n            // fix this so that tiles are redrawn as necessary to use the same mode.\n            //if ( (result.message && result.message.match(/^Only the first [\\d]+/)) ||\n            //     (result.data && result.data.length > 2000) ||\n            //var data = result.data;\n            // if ( (data.length && data.length < 4) ||\n            //      (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) ) {\n            if (this.view.high - this.view.low > MIN_SQUISH_VIEW_WIDTH) {\n                mode = \"Squish\";\n            } else {\n                mode = \"Pack\";\n            }\n        }\n        return mode;\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        if (mode === \"Coverage\" || result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // All other modes require slotting.\n            var rows_required = this.incremental_slots(w_scale, result.data, mode);\n            // HACK: use dummy painter to get required height. Painter should be extended so that get_required_height\n            // works as a static function.\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return Math.max(this.min_height_px, dummy_painter.get_required_height(rows_required, canvas_width));\n        }\n    },\n\n    /**\n     * Draw FeatureTrack tile.\n     * @param result result from server\n     * @param cxt canvas context to draw on\n     * @param mode mode to draw in\n     * @param region region to draw on tile\n     * @param w_scale pixels per base\n     * @param ref_seq reference sequence data\n     * @param cur_tile true if drawing is occurring on a currently visible tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale, ref_seq, cur_tile) {\n        var track = this;\n        var canvas = ctx.canvas;\n        var tile_low = region.get(\"start\");\n        var tile_high = region.get(\"end\");\n        var left_offset = this.left_offset;\n\n        // If data is line track data, draw line track tile.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, mode, region, w_scale);\n        }\n\n        // Handle row-by-row tracks\n\n        // Preprocessing: filter features and determine whether all unfiltered features have been slotted.\n        var filtered = [];\n\n        var slots = this.slotters[w_scale].slots;\n        var all_slotted = true;\n        if (result.data) {\n            var filters = this.filters_manager.filters;\n            for (var i = 0, len = result.data.length; i < len; i++) {\n                var feature = result.data[i];\n                var hide_feature = false;\n                var filter;\n                for (var f = 0, flen = filters.length; f < flen; f++) {\n                    filter = filters[f];\n                    filter.update_attrs(feature);\n                    if (!filter.keep(feature)) {\n                        hide_feature = true;\n                        break;\n                    }\n                }\n                if (!hide_feature) {\n                    // Feature visible.\n                    filtered.push(feature);\n                    // Set flag if not slotted.\n                    if (!(feature[0] in slots)) {\n                        all_slotted = false;\n                    }\n                }\n            }\n        }\n\n        // Create painter.\n        var filter_alpha_scaler = this.filters_manager.alpha_filter\n            ? new FilterScaler(this.filters_manager.alpha_filter)\n            : null;\n\n        var filter_height_scaler = this.filters_manager.height_filter\n            ? new FilterScaler(this.filters_manager.height_filter)\n            : null;\n\n        var painter = new this.painter(\n            filtered,\n            tile_low,\n            tile_high,\n            this.config.to_key_value_dict(),\n            mode,\n            filter_alpha_scaler,\n            filter_height_scaler,\n            // HACK: ref_seq only be defined for ReadTracks, and only the ReadPainter accepts that argument\n            ref_seq,\n            b => track.view.get_base_color(b)\n        );\n\n        var feature_mapper = null;\n\n        ctx.fillStyle = this.config.get_value(\"block_color\");\n        ctx.font = ctx.canvas.manager.default_font;\n        ctx.textAlign = \"right\";\n\n        if (result.data) {\n            // Draw features.\n            var draw_results = painter.draw(ctx, canvas.width, canvas.height, w_scale, slots);\n            feature_mapper = draw_results.feature_mapper;\n            incomplete_features = draw_results.incomplete_features;\n            feature_mapper.translation = -left_offset;\n        }\n\n        // If not drawing on current tile, create new tile.\n        if (!cur_tile) {\n            return new FeatureTrackTile(\n                track,\n                region,\n                w_scale,\n                canvas,\n                result.data,\n                mode,\n                result.message,\n                all_slotted,\n                feature_mapper,\n                incomplete_features,\n                ref_seq\n            );\n        }\n    }\n});\n\n/**\n * Displays variant data.\n */\nvar VariantTrack = function(view, container, obj_dict) {\n    TiledTrack.call(this, view, container, obj_dict);\n    this.painter = painters.VariantPainter;\n    this.summary_draw_height = 30;\n\n    // Maximum resolution is ~45 pixels/base, so use this size left offset to ensure that full\n    // variant is drawn when variant is at start of tile.\n    this.left_offset = 30;\n};\n\nextend(VariantTrack.prototype, Drawable.prototype, TiledTrack.prototype, {\n    display_modes: [\"Auto\", \"Coverage\", \"Dense\", \"Squish\", \"Pack\"],\n\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"color\",\n                label: \"Histogram color\",\n                type: \"color\"\n            },\n            {\n                key: \"show_sample_data\",\n                label: \"Show sample data\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"show_labels\",\n                label: \"Show summary and sample labels\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"summary_height\",\n                label: \"Locus summary height\",\n                type: \"float\",\n                default_value: 20\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    },\n\n    /**\n     * Draw tile.\n     */\n    draw_tile: function(result, ctx, mode, region, w_scale) {\n        // Data could be coverage data or variant data.\n        if (result.dataset_type === \"bigwig\") {\n            return this._draw_line_track_tile(result, ctx, \"Histogram\", region, w_scale);\n        } else {\n            // result.dataset_type === 'variant'\n            var view = this.view;\n\n            var painter = new this.painter(\n                result.data,\n                region.get(\"start\"),\n                region.get(\"end\"),\n                this.config.to_key_value_dict(),\n                mode,\n                b => view.get_base_color(b)\n            );\n\n            painter.draw(ctx, ctx.canvas.width, ctx.canvas.height, w_scale);\n            return new Tile(this, region, w_scale, ctx.canvas, result.data);\n        }\n    },\n\n    /**\n     * Returns canvas height needed to display data; return value is an integer that denotes the\n     * number of pixels required.\n     */\n    get_canvas_height: function(result, mode, w_scale, canvas_width) {\n        if (result.dataset_type === \"bigwig\") {\n            return this.summary_draw_height;\n        } else {\n            // HACK: sample_names is not be defined when dataset definition is fetched before\n            // dataset is complete (as is done when running tools). In that case, fall back on\n            // # of samples in data. This can be fixed by re-requesting dataset definition\n            // in init.\n            var num_samples = this.dataset.get_metadata(\"sample_names\")\n                ? this.dataset.get_metadata(\"sample_names\").length\n                : 0;\n            if (num_samples === 0 && result.data.length !== 0) {\n                // Sample data is separated by commas, so this computes # of samples:\n                num_samples = result.data[0][7].match(/,/g);\n                if (num_samples === null) {\n                    num_samples = 1;\n                } else {\n                    num_samples = num_samples.length + 1;\n                }\n            }\n\n            var dummy_painter = new this.painter(null, null, null, this.config.to_key_value_dict(), mode);\n            return dummy_painter.get_required_height(num_samples);\n        }\n    },\n\n    /**\n     * Additional initialization required before drawing track for the first time.\n     */\n    predraw_init: function() {\n        var deferreds = [Track.prototype.predraw_init.call(this)];\n        // FIXME: updating dataset metadata is only needed for visual analysis. Can\n        // this be moved somewhere else?\n        if (!this.dataset.get_metadata(\"sample_names\")) {\n            deferreds.push(this.dataset.fetch());\n        }\n        return deferreds;\n    },\n\n    /**\n     * Actions to be taken after draw has been completed. Draw is completed when all tiles have been\n     * drawn/fetched and shown.\n     */\n    postdraw_actions: function(tiles, width, w_scale, clear_after) {\n        TiledTrack.prototype.postdraw_actions.call(this, tiles, width, w_scale, clear_after);\n\n        var line_track_tiles = _.filter(tiles, t => t instanceof LineTrackTile);\n\n        // Add summary/sample labels if needed and not already included.\n        var sample_names = this.dataset.get_metadata(\"sample_names\");\n        if (\n            line_track_tiles.length === 0 &&\n            this.config.get_value(\"show_labels\") &&\n            sample_names &&\n            sample_names.length > 1\n        ) {\n            var font_size;\n\n            // Add and/or style labels.\n            if (this.container_div.find(\".yaxislabel.variant\").length === 0) {\n                // Add summary and sample labels.\n\n                // Add summary label to middle of summary area.\n                font_size = this.config.get_value(\"summary_height\") / 2;\n                this.tiles_div.prepend(\n                    $(\"<div/>\")\n                        .text(\"Summary\")\n                        .addClass(\"yaxislabel variant top\")\n                        .css({\n                            \"font-size\": `${font_size}px`,\n                            top: `${(this.config.get_value(\"summary_height\") - font_size) / 2}px`\n                        })\n                );\n\n                // Show sample labels.\n                if (this.config.get_value(\"show_sample_data\")) {\n                    var samples_div_html = sample_names.join(\"<br/>\");\n\n                    this.tiles_div.prepend(\n                        $(\"<div/>\")\n                            .html(samples_div_html)\n                            .addClass(\"yaxislabel variant top sample\")\n                            .css({\n                                top: this.config.get_value(\"summary_height\")\n                            })\n                    );\n                }\n            }\n\n            // Style labels.\n\n            // Match sample font size to mode.\n            font_size = `${this.mode === \"Squish\" ? 5 : 10}px`;\n            $(this.tiles_div)\n                .find(\".sample\")\n                .css({\n                    \"font-size\": font_size,\n                    \"line-height\": font_size\n                });\n            // Color labels to preference color.\n            $(this.tiles_div)\n                .find(\".yaxislabel\")\n                .css(\"color\", this.config.get_value(\"label_color\"));\n        } else {\n            // Remove all labels.\n            this.container_div.find(\".yaxislabel.variant\").remove();\n        }\n    }\n});\n\n/**\n * Track that displays mapped reads. Track expects position data in 1-based, closed format, i.e. SAM/BAM format.\n */\nvar ReadTrack = function(view, container, obj_dict) {\n    FeatureTrack.call(this, view, container, obj_dict);\n    this.painter = painters.ReadPainter;\n    this.update_icons();\n};\n\nextend(ReadTrack.prototype, Drawable.prototype, TiledTrack.prototype, FeatureTrack.prototype, {\n    build_config_params: function() {\n        return _.union(Drawable.prototype.config_params, [\n            {\n                key: \"block_color\",\n                label: \"Histogram color\",\n                type: \"color\"\n            },\n            {\n                key: \"detail_block_color\",\n                label: \"Sense strand block color\",\n                type: \"color\",\n                default_value: \"#AAAAAA\"\n            },\n            {\n                key: \"reverse_strand_color\",\n                label: \"Antisense strand block color\",\n                type: \"color\",\n                default_value: \"#DDDDDD\"\n            },\n            {\n                key: \"label_color\",\n                label: \"Label color\",\n                type: \"color\",\n                default_value: \"black\"\n            },\n            {\n                key: \"show_insertions\",\n                label: \"Show insertions\",\n                type: \"bool\",\n                default_value: false\n            },\n            {\n                key: \"show_differences\",\n                label: \"Show differences only\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"show_counts\",\n                label: \"Show summary counts\",\n                type: \"bool\",\n                default_value: true\n            },\n            {\n                key: \"mode\",\n                type: \"string\",\n                default_value: this.mode,\n                hidden: true\n            },\n            {\n                key: \"min_value\",\n                label: \"Histogram minimum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"max_value\",\n                label: \"Histogram maximum\",\n                type: \"float\",\n                default_value: undefined,\n                help: \"clear value to set automatically\"\n            },\n            {\n                key: \"height\",\n                type: \"int\",\n                default_value: 0,\n                hidden: true\n            }\n        ]);\n    },\n\n    config_onchange: function() {\n        this.set_name(this.config.get_value(\"name\"));\n        this.request_draw({ clear_tile_cache: true });\n    }\n});\n\n/**\n * Objects that can be added to a view.\n */\nvar addable_objects = {\n    CompositeTrack: CompositeTrack,\n    DrawableGroup: DrawableGroup,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    FeatureTrack: FeatureTrack,\n    LineTrack: LineTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    // For backward compatibility, map vcf track to variant.\n    VcfTrack: VariantTrack\n};\n\n/**\n * Create new object from a template. A template can be either an object dictionary or an\n * object itself.\n */\nvar object_from_template = (template, view, container) => {\n    if (\"copy\" in template) {\n        // Template is an object.\n        return template.copy(container);\n    } else {\n        // Template is a dictionary.\n        var drawable_type = template.obj_type;\n        // For backward compatibility:\n        if (!drawable_type) {\n            drawable_type = template.track_type;\n        }\n        return new addable_objects[drawable_type](view, container, template);\n    }\n};\n\nexport default {\n    TracksterView: TracksterView,\n    DrawableGroup: DrawableGroup,\n    LineTrack: LineTrack,\n    FeatureTrack: FeatureTrack,\n    DiagonalHeatmapTrack: DiagonalHeatmapTrack,\n    ReadTrack: ReadTrack,\n    VariantTrack: VariantTrack,\n    CompositeTrack: CompositeTrack,\n    object_from_template: object_from_template\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster/tracks.js","import * as _ from \"libs/underscore\";\n/**\n * View for track/group header.\n */\nvar TrackHeaderView = Backbone.View.extend({\n    className: \"track-header\",\n\n    initialize: function() {\n        // Watch and update name changes.\n        this.model.config.get(\"name\").on(\"change:value\", this.update_name, this);\n        this.render();\n    },\n\n    render: function() {\n        this.$el.append($(\"<div/>\").addClass(this.model.drag_handle_class));\n        this.$el.append(\n            $(\"<div/>\")\n                .addClass(\"track-name\")\n                .text(this.model.config.get_value(\"name\"))\n        );\n\n        // Icons container.\n        this.action_icons = {};\n        this.render_action_icons();\n\n        // Suppress double clicks in header so that they do not impact viz under header.\n        this.$el.dblclick(e => {\n            e.stopPropagation();\n        });\n\n        // Needed for floating elts in header.\n        this.$el.append($(\"<div style='clear: both'/>\"));\n    },\n\n    update_name: function() {\n        this.$el.find(\".track-name\").text(this.model.config.get_value(\"name\"));\n    },\n\n    render_action_icons: function() {\n        var self = this;\n        this.icons_div = $(\"<div/>\")\n            .addClass(\"track-icons\")\n            .hide()\n            .appendTo(this.$el);\n        _.each(this.model.action_icons_def, icon_dict => {\n            self.add_action_icon(\n                icon_dict.name,\n                icon_dict.title,\n                icon_dict.css_class,\n                icon_dict.on_click_fn,\n                icon_dict.prepend,\n                icon_dict.hide\n            );\n        });\n\n        // Set up behavior for modes popup.\n        this.set_display_modes(this.model.display_modes);\n    },\n\n    /**\n     * Add an action icon to this object. Appends icon unless prepend flag is specified.\n     */\n    add_action_icon: function(name, title, css_class, on_click_fn, prepend, hide) {\n        var self = this;\n        this.action_icons[name] = $(\"<a/>\")\n            .attr(\"title\", title)\n            .addClass(\"icon-button\")\n            .addClass(css_class)\n            .tooltip()\n            .click(() => {\n                on_click_fn(self.model);\n            })\n            .appendTo(this.icons_div);\n        if (hide) {\n            this.action_icons[name].hide();\n        }\n    },\n\n    /**\n     * Set track's modes and update mode icon popup.\n     */\n    set_display_modes: function(new_modes, init_mode) {\n        if (!new_modes) {\n            return;\n        }\n\n        // HACK: move this out of view and into track.\n\n        // Set modes, init mode.\n        this.model.display_modes = new_modes;\n        this.model.mode = init_mode || this.model.config.get_value(\"mode\") || this.model.display_modes[0];\n\n        this.action_icons.mode_icon.attr(\"title\", `Set display mode (now: ${this.mode})`);\n\n        // Setup popup menu for changing modes.\n        var self = this;\n\n        var track = this.model;\n        var mode_mapping = {};\n        for (var i = 0, len = track.display_modes.length; i < len; i++) {\n            var mode = track.display_modes[i];\n            mode_mapping[mode] = (mode => () => {\n                track.change_mode(mode);\n                // HACK: the popup menu messes with the track's hover event, so manually show/hide\n                // icons div for now.\n                //self.icons_div.show();\n                //track.container_div.mouseleave(function() { track.icons_div.hide(); } );\n            })(mode);\n        }\n\n        make_popupmenu(this.action_icons.mode_icon, mode_mapping);\n    }\n});\n\nexport default {\n    TrackHeaderView: TrackHeaderView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/viz_views.js","import * as _ from \"libs/underscore\";\nvar extend = _.extend;\n\n// HACK: LABEL_SPACING is currently duplicated between here and painters\nvar LABEL_SPACING = 2;\n\nvar PACK_SPACING = 5;\n\n/**\n * Hold slotting information for a feature.\n */\nvar SlottedInfo = function(slot, feature) {\n    this.slot = slot;\n    this.feature = feature;\n};\n\n/**\n * FeatureSlotter determines slots in which to draw features for vertical\n * packing.\n *\n * This implementation is incremental, any feature assigned a slot will be\n * retained for slotting future features.\n */\nvar FeatureSlotter = function(w_scale, mode, max_rows, measureText) {\n    this.slots = {};\n    this.start_end_dct = {};\n    this.w_scale = w_scale;\n    this.mode = mode;\n    this.include_label = mode === \"Pack\";\n    this.max_rows = max_rows;\n    this.measureText = measureText;\n};\n\n/**\n * Slot a set of features, `this.slots` will be updated with slots by id, and\n * the largest slot required for the passed set of features is returned\n */\nextend(FeatureSlotter.prototype, {\n    /**\n     * Get drawing coordinate for a feature.\n     */\n    _get_draw_coords: function(feature) {\n        // Get initial draw coordinates using w_scale.\n        var draw_start = Math.floor(feature[1] * this.w_scale);\n\n        var draw_end = Math.ceil(feature[2] * this.w_scale);\n        var f_name = feature[3];\n        var text_align;\n\n        // Update start, end drawing locations to include feature name.\n        // Try to put the name on the left, if not, put on right.\n        if (f_name !== undefined && this.include_label) {\n            // Add gap for label spacing and extra pack space padding\n            // TODO: Fix constants\n            var text_len = this.measureText(f_name).width + (LABEL_SPACING + PACK_SPACING);\n            if (draw_start - text_len >= 0) {\n                draw_start -= text_len;\n                text_align = \"left\";\n            } else {\n                draw_end += text_len;\n                text_align = \"right\";\n            }\n        }\n\n        /*\n        if (slot_num < 0) {\n            \n            TODO: this is not yet working --\n            console.log(feature_uid, \"looking for slot with text on the right\");\n            // Slot not found. If text was on left, try on right and see\n            // if slot can be found.\n            // TODO: are there any checks we need to do to ensure that text\n            // will fit on tile?\n            if (text_align === \"left\") {\n                draw_start -= text_len;\n                draw_end -= text_len;\n                text_align = \"right\";\n                slot_num = find_slot(draw_start, draw_end);\n            }\n            if (slot_num >= 0) {\n                console.log(feature_uid, \"found slot with text on the right\");\n            }\n\n        }\n        */\n\n        return [draw_start, draw_end];\n    },\n\n    /**\n     * Find the first slot such that current feature doesn't overlap any other features in that slot.\n     * Returns -1 if no slot was found.\n     */\n    _find_slot: function(draw_coords) {\n        // TODO: Use a data structure for faster searching of available slots.\n        var draw_start = draw_coords[0];\n\n        var draw_end = draw_coords[1];\n        for (var slot_num = 0; slot_num <= this.max_rows; slot_num++) {\n            var has_overlap = false;\n            var slot = this.start_end_dct[slot_num];\n            if (slot !== undefined) {\n                // Iterate through features already in slot to see if current feature will fit.\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    var s_e = slot[k];\n                    if (draw_end > s_e[0] && draw_start < s_e[1]) {\n                        // There is overlap\n                        has_overlap = true;\n                        break;\n                    }\n                }\n            }\n            if (!has_overlap) {\n                return slot_num;\n            }\n        }\n        return -1;\n    },\n\n    /**\n     * Slot features.\n     */\n    slot_features: function(features) {\n        var start_end_dct = this.start_end_dct;\n        var undone = [];\n        var highest_slot = 0;\n        var feature;\n        var feature_uid;\n\n        // Loop through features to (a) find those that are not yet slotted and (b) update\n        // those that are slotted if new information is availabe. For (a), features already\n        // slotted (based on slotting from other tiles) will retain their current slot.\n        for (var i = 0, len = features.length; i < len; i++) {\n            feature = features[i];\n            feature_uid = feature[0];\n            var slotted_info = this.slots[feature_uid];\n\n            // Separate and handle slotted vs. unslotted features.\n            if (slotted_info) {\n                // Feature is slotted; if feature now has larger start/end coordinates,\n                // update drawing coordinates.\n                if (feature[1] < slotted_info.feature[1] || slotted_info.feature[2] < feature[2]) {\n                    // Feature has changed (e.g. a single read now has its pair), so recalculate its\n                    // drawing coordinates.\n                    var old_draw_coords = this._get_draw_coords(slotted_info.feature);\n\n                    var new_draw_coords = this._get_draw_coords(feature);\n                    var slotted_coords = this.start_end_dct[slotted_info.slot];\n                    for (var k = 0; k < slotted_coords.length; k++) {\n                        var dc = slotted_coords[k];\n                        if (dc[0] === old_draw_coords[0] && dc[1] === old_draw_coords[1]) {\n                            // Replace old drawing coordinates with new ones.\n                            slotted_coords[k] = new_draw_coords;\n                        }\n                    }\n                }\n                highest_slot = Math.max(highest_slot, this.slots[feature_uid].slot);\n            } else {\n                undone.push(i);\n            }\n        }\n\n        // Slot unslotted features.\n\n        // Do slotting.\n        for (var i = 0, len = undone.length; i < len; i++) {\n            feature = features[undone[i]];\n            feature_uid = feature[0];\n            var draw_coords = this._get_draw_coords(feature);\n\n            // Find slot.\n            var slot_num = this._find_slot(draw_coords);\n\n            // Do slotting.\n            if (slot_num >= 0) {\n                // Add current feature to slot.\n                if (start_end_dct[slot_num] === undefined) {\n                    start_end_dct[slot_num] = [];\n                }\n                start_end_dct[slot_num].push(draw_coords);\n                this.slots[feature_uid] = new SlottedInfo(slot_num, feature);\n                highest_slot = Math.max(highest_slot, slot_num);\n            }\n        }\n\n        // Debugging: view slots data.\n        /*\n        for (var i = 0; i < MAX_FEATURE_DEPTH; i++) {\n            var slot = start_end_dct[i];\n            if (slot !== undefined) {\n                console.log(i, \"*************\");\n                for (var k = 0, k_len = slot.length; k < k_len; k++) {\n                    console.log(\"\\t\", slot[k][0], slot[k][1]);\n                }\n            }\n        }\n        */\n        return highest_slot + 1;\n    }\n});\n\nexport default {\n    FeatureSlotter: FeatureSlotter\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster/slotting.js","import * as _ from \"libs/underscore\";\n\n/**\n * Compute the type of overlap between two regions. They are assumed to be on the same chrom/contig.\n * The overlap is computed relative to the second region; hence, OVERLAP_START indicates that the first\n * region overlaps the start (but not the end) of the second region.\n * NOTE: Coordinates are assumed to be in BED format: half open (start is closed, end is open).\n */\nvar BEFORE = 1001;\n\nvar CONTAINS = 1002;\nvar OVERLAP_START = 1003;\nvar OVERLAP_END = 1004;\nvar CONTAINED_BY = 1005;\nvar AFTER = 1006;\nvar compute_overlap = (first_region, second_region) => {\n    var first_start = first_region[0];\n    var first_end = first_region[1];\n    var second_start = second_region[0];\n    var second_end = second_region[1];\n    var overlap;\n    if (first_start < second_start) {\n        if (first_end <= second_start) {\n            overlap = BEFORE;\n        } else if (first_end <= second_end) {\n            overlap = OVERLAP_START;\n        } else {\n            // first_end > second_end\n            overlap = CONTAINS;\n        }\n    } else {\n        // first_start >= second_start\n        if (first_start > second_end) {\n            overlap = AFTER;\n        } else if (first_end <= second_end) {\n            overlap = CONTAINED_BY;\n        } else {\n            overlap = OVERLAP_END;\n        }\n    }\n\n    return overlap;\n};\n\n/**\n * Returns true if regions overlap.\n */\nvar is_overlap = (first_region, second_region) => {\n    var overlap = compute_overlap(first_region, second_region);\n    return overlap !== BEFORE && overlap !== AFTER;\n};\n\n/**\n * Draw a dashed line on a canvas using filled rectangles. This function is based on:\n * http://vetruvet.blogspot.com/2010/10/drawing-dashed-lines-on-html5-canvas.html\n * However, that approach uses lines, which don't seem to render as well, so use\n * rectangles instead.\n */\nvar dashedLine = (ctx, x1, y1, x2, y2, dashLen) => {\n    if (dashLen === undefined) {\n        dashLen = 4;\n    }\n    var dX = x2 - x1;\n    var dY = y2 - y1;\n    var dashes = Math.floor(Math.sqrt(dX * dX + dY * dY) / dashLen);\n    var dashX = dX / dashes;\n    var dashY = dY / dashes;\n    var q;\n\n    for (q = 0; q < dashes; q++, x1 += dashX, y1 += dashY) {\n        if (q % 2 !== 0) {\n            continue;\n        }\n        ctx.fillRect(x1, y1, dashLen, 1);\n    }\n};\n\n/**\n * Draw an isosceles triangle that points down.\n */\nvar drawDownwardEquilateralTriangle = function(ctx, down_vertex_x, down_vertex_y, side_len) {\n    // Compute other two points of triangle.\n    var x1 = down_vertex_x - side_len / 2;\n\n    var x2 = down_vertex_x + side_len / 2;\n    var y = down_vertex_y - Math.sqrt(side_len * 3 / 2);\n\n    // Draw and fill.\n    ctx.beginPath();\n    ctx.moveTo(x1, y);\n    ctx.lineTo(x2, y);\n    ctx.lineTo(down_vertex_x, down_vertex_y);\n    ctx.lineTo(x1, y);\n\n    ctx.strokeStyle = this.fillStyle;\n    ctx.fill();\n    ctx.stroke();\n    ctx.closePath();\n};\n\n/**\n * Base class for all scalers. Scalers produce values that are used to change (scale) drawing attributes.\n */\nvar Scaler = function(default_val) {\n    this.default_val = default_val ? default_val : 1;\n};\n\n/**\n * Produce a scaling value.\n */\nScaler.prototype.gen_val = function(input) {\n    return this.default_val;\n};\n\n/**\n * Results from painter.draw()\n */\nvar DrawResults = function(options) {\n    this.incomplete_features = options.incomplete_features;\n    this.feature_mapper = options.feature_mapper;\n};\n\n/**\n * Base class for painters\n *\n * -- Mode and prefs are both optional\n */\nvar Painter = function(data, view_start, view_end, prefs, mode) {\n    // Data and data properties\n    this.data = data;\n    // View\n    this.view_start = view_start;\n    this.view_end = view_end;\n    // Drawing prefs\n    this.prefs = _.extend({}, this.default_prefs, prefs);\n    this.mode = mode;\n};\n\nPainter.prototype.default_prefs = {};\n\n/**\n * Draw on the context using a rectangle of width x height using scale w_scale.\n */\nPainter.prototype.draw = (ctx, width, height, w_scale) => {};\n\n/**\n * Get starting drawing position, which is offset a half-base left of coordinate.\n */\nPainter.prototype.get_start_draw_pos = function(chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, -0.5);\n};\n\n/**\n * Get end drawing position, which is offset a half-base right of coordinate.\n */\nPainter.prototype.get_end_draw_pos = function(chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0.5);\n};\n\n/**\n * Get drawing position.\n */\nPainter.prototype.get_draw_pos = function(chrom_pos, w_scale) {\n    return this._chrom_pos_to_draw_pos(chrom_pos, w_scale, 0);\n};\n\n/**\n * Convert chromosome position to drawing position.\n */\nPainter.prototype._chrom_pos_to_draw_pos = function(chrom_pos, w_scale, offset) {\n    return Math.floor(w_scale * (Math.max(0, chrom_pos - this.view_start) + offset));\n};\n\nvar LinePainter = function(data, view_start, view_end, prefs, mode) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n};\n\nLinePainter.prototype.default_prefs = {\n    min_value: undefined,\n    max_value: undefined,\n    mode: \"Histogram\",\n    color: \"#000\",\n    overflow_color: \"#F66\"\n};\n\nLinePainter.prototype.draw = function(ctx, width, height, w_scale) {\n    var in_path = false;\n    var min_value = this.prefs.min_value;\n    var max_value = this.prefs.max_value;\n    var vertical_range = max_value - min_value;\n    var height_px = height;\n    var view_start = this.view_start;\n    var mode = this.mode;\n    var data = this.data;\n\n    ctx.save();\n\n    // Pixel position of 0 on the y axis\n    var y_zero = Math.round(height + min_value / vertical_range * height);\n\n    // Horizontal line to denote x-axis\n    if (mode !== \"Intensity\") {\n        ctx.fillStyle = \"#aaa\";\n        ctx.fillRect(0, y_zero, width, 1);\n    }\n\n    ctx.beginPath();\n    var x_scaled;\n    var y;\n    var delta_x_pxs;\n    if (data.length > 1) {\n        delta_x_pxs = _.map(data.slice(0, -1), (d, i) => Math.ceil((data[i + 1][0] - data[i][0]) * w_scale));\n    } else {\n        delta_x_pxs = [10];\n    }\n\n    // Painter color can be in either block_color (FeatureTrack) or color pref (LineTrack).\n    var painter_color = this.prefs.block_color || this.prefs.color;\n\n    var // Extract RGB from preference color.\n    pref_color = parseInt(painter_color.slice(1), 16);\n\n    var pref_r = (pref_color & 0xff0000) >> 16;\n    var pref_g = (pref_color & 0x00ff00) >> 8;\n    var pref_b = pref_color & 0x0000ff;\n    var top_overflow = false;\n    var bot_overflow = false;\n\n    // Paint track.\n    var delta_x_px;\n    for (var i = 0, len = data.length; i < len; i++) {\n        // Reset attributes for next point.\n        ctx.fillStyle = ctx.strokeStyle = painter_color;\n        top_overflow = bot_overflow = false;\n        delta_x_px = delta_x_pxs[i];\n\n        x_scaled = Math.floor((data[i][0] - view_start - 0.5) * w_scale);\n        y = data[i][1];\n\n        // Process Y (scaler) value.\n        if (y === null) {\n            if (in_path && mode === \"Filled\") {\n                ctx.lineTo(x_scaled, height_px);\n            }\n            in_path = false;\n            continue;\n        }\n\n        // Bound Y value by min, max.\n        if (y < min_value) {\n            bot_overflow = true;\n            y = min_value;\n        } else if (y > max_value) {\n            top_overflow = true;\n            y = max_value;\n        }\n\n        // Draw point.\n        if (mode === \"Histogram\") {\n            // y becomes the bar height in pixels, which is the negated for canvas coords\n            y = Math.round(y / vertical_range * height_px);\n            ctx.fillRect(x_scaled, y_zero, delta_x_px, -y);\n        } else if (mode === \"Intensity\") {\n            var saturation = (y - min_value) / vertical_range;\n\n            var // Range is [pref_color, 255] where saturation = 0 --> 255 and saturation = 1 --> pref color\n            new_r = Math.round(pref_r + (255 - pref_r) * (1 - saturation));\n\n            var new_g = Math.round(pref_g + (255 - pref_g) * (1 - saturation));\n            var new_b = Math.round(pref_b + (255 - pref_b) * (1 - saturation));\n            ctx.fillStyle = `rgb(${new_r},${new_g},${new_b})`;\n            ctx.fillRect(x_scaled, 0, delta_x_px, height_px);\n        } else {\n            // mode is Coverage/Line or Filled.\n\n            // Scale Y value.\n            y = Math.round(height_px - (y - min_value) / vertical_range * height_px);\n            if (in_path) {\n                ctx.lineTo(x_scaled, y);\n            } else {\n                in_path = true;\n                if (mode === \"Filled\") {\n                    ctx.moveTo(x_scaled, height_px);\n                    ctx.lineTo(x_scaled, y);\n                } else {\n                    ctx.moveTo(x_scaled, y);\n                    // Use this approach (note: same as for filled) to draw line from 0 to\n                    // first data point.\n                    //ctx.moveTo(x_scaled, height_px);\n                    //ctx.lineTo(x_scaled, y);\n                }\n            }\n        }\n\n        // Draw lines at boundaries if overflowing min or max\n        ctx.fillStyle = this.prefs.overflow_color;\n        if (top_overflow || bot_overflow) {\n            var overflow_x;\n            if (mode === \"Histogram\" || mode === \"Intensity\") {\n                overflow_x = delta_x_px;\n            } else {\n                // Line and Filled, which are points\n                x_scaled -= 2; // Move it over to the left so it's centered on the point\n                overflow_x = 4;\n            }\n            if (top_overflow) {\n                ctx.fillRect(x_scaled, 0, overflow_x, 3);\n            }\n            if (bot_overflow) {\n                ctx.fillRect(x_scaled, height_px - 3, overflow_x, 3);\n            }\n        }\n        ctx.fillStyle = painter_color;\n    }\n    if (mode === \"Filled\") {\n        if (in_path) {\n            ctx.lineTo(x_scaled, y_zero);\n            ctx.lineTo(0, y_zero);\n        }\n        ctx.fill();\n    } else {\n        ctx.stroke();\n    }\n\n    ctx.restore();\n};\n\n/**\n * Mapper that contains information about feature locations and data.\n */\nvar FeaturePositionMapper = function(slot_height) {\n    this.feature_positions = {};\n    this.slot_height = slot_height;\n    this.translation = 0;\n    this.y_translation = 0;\n};\n\n/**\n * Map feature data to a position defined by <slot, x_start, x_end>.\n */\nFeaturePositionMapper.prototype.map_feature_data = function(feature_data, slot, x_start, x_end) {\n    if (!this.feature_positions[slot]) {\n        this.feature_positions[slot] = [];\n    }\n    this.feature_positions[slot].push({\n        data: feature_data,\n        x_start: x_start,\n        x_end: x_end\n    });\n};\n\n/**\n * Get feature data for position <x, y>\n */\nFeaturePositionMapper.prototype.get_feature_data = function(x, y) {\n    // Find slot using Y.\n    var slot = Math.floor((y - this.y_translation) / this.slot_height);\n\n    var feature_dict;\n\n    // May not be over a slot due to padding, margin, etc.\n    if (!this.feature_positions[slot]) {\n        return null;\n    }\n\n    // Find feature using X.\n    x += this.translation;\n    for (var i = 0; i < this.feature_positions[slot].length; i++) {\n        feature_dict = this.feature_positions[slot][i];\n        if (x >= feature_dict.x_start && x <= feature_dict.x_end) {\n            return feature_dict.data;\n        }\n    }\n};\n\n/**\n * Abstract object for painting feature tracks. Subclasses must implement draw_element() for painting to work.\n * Painter uses a 0-based, half-open coordinate system; start coordinate is closed--included--and the end is open.\n * This coordinate system matches the BED format.\n */\nvar FeaturePainter = function(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    this.alpha_scaler = alpha_scaler ? alpha_scaler : new Scaler();\n    this.height_scaler = height_scaler ? height_scaler : new Scaler();\n    this.max_label_length = 200;\n};\n\nFeaturePainter.prototype.default_prefs = {\n    block_color: \"#FFF\",\n    connector_color: \"#FFF\"\n};\n\n_.extend(FeaturePainter.prototype, {\n    get_required_height: function(rows_required, width) {\n        // y_scale is the height per row\n        var required_height = this.get_row_height();\n\n        var y_scale = required_height;\n        var mode = this.mode;\n        // If using a packing mode, need to multiply by the number of slots used\n        if (mode === \"no_detail\" || mode === \"Squish\" || mode === \"Pack\") {\n            required_height = rows_required * y_scale;\n        }\n        return required_height + this.get_top_padding(width);\n    },\n\n    /** Extra padding before first row of features */\n    get_top_padding: function(width) {\n        return 0;\n    },\n\n    /**\n     * Draw data on ctx using slots and within the rectangle defined by width and height. Returns\n     * a FeaturePositionMapper object with information about where features were drawn.\n     */\n    draw: function(ctx, width, height, w_scale, slots) {\n        var data = this.data;\n        var view_start = this.view_start;\n        var view_end = this.view_end;\n\n        ctx.save();\n\n        ctx.fillStyle = this.prefs.block_color;\n        ctx.textAlign = \"right\";\n\n        var y_scale = this.get_row_height();\n        var feature_mapper = new FeaturePositionMapper(y_scale);\n        var x_draw_coords;\n        var incomplete_features = [];\n\n        for (var i = 0, len = data.length; i < len; i++) {\n            var feature = data[i];\n            var feature_uid = feature[0];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n\n            var // Slot valid only if features are slotted and this feature is slotted;\n            // feature may not be due to lack of space.\n            slot = slots && slots[feature_uid] !== undefined ? slots[feature_uid].slot : null;\n\n            // Draw feature if (a) mode is dense or feature is slotted (as it must be for all non-dense modes) and\n            // (b) there's overlap between the feature and drawing region.\n            if ((this.mode === \"Dense\" || slot !== null) && (feature_start < view_end && feature_end > view_start)) {\n                x_draw_coords = this.draw_element(\n                    ctx,\n                    this.mode,\n                    feature,\n                    slot,\n                    view_start,\n                    view_end,\n                    w_scale,\n                    y_scale,\n                    width\n                );\n                feature_mapper.map_feature_data(feature, slot, x_draw_coords[0], x_draw_coords[1]);\n\n                // Add to incomplete features if it's not drawn completely in region.\n                if (feature_start < view_start || feature_end > view_end) {\n                    incomplete_features.push(feature);\n                }\n            }\n        }\n\n        ctx.restore();\n\n        feature_mapper.y_translation = this.get_top_padding(width);\n        return new DrawResults({\n            incomplete_features: incomplete_features,\n            feature_mapper: feature_mapper\n        });\n    },\n\n    /**\n     * Abstract function for drawing an individual feature.\n     */\n    draw_element: function(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        return [0, 0];\n    }\n});\n\n// Constants specific to feature tracks moved here (HACKING, these should\n// basically all be configuration options)\nvar DENSE_TRACK_HEIGHT = 10;\n\nvar NO_DETAIL_TRACK_HEIGHT = 3;\nvar SQUISH_TRACK_HEIGHT = 5;\nvar PACK_TRACK_HEIGHT = 10;\nvar NO_DETAIL_FEATURE_HEIGHT = 1;\nvar DENSE_FEATURE_HEIGHT = 9;\nvar SQUISH_FEATURE_HEIGHT = 3;\nvar PACK_FEATURE_HEIGHT = 9;\nvar LABEL_SPACING = 2;\nvar CONNECTOR_COLOR = \"#ccc\";\n\nvar LinkedFeaturePainter = function(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    FeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    // Whether to draw a single connector in the background that spans the entire feature (the intron fishbone)\n    this.draw_background_connector = true;\n    // Whether to call draw_connector for every pair of blocks\n    this.draw_individual_connectors = false;\n};\n\n_.extend(LinkedFeaturePainter.prototype, FeaturePainter.prototype, {\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height: function() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"no_detail\") {\n            height = NO_DETAIL_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    },\n\n    /**\n     * Draw a feature. Returns an array with feature's start and end X coordinates.\n     */\n    draw_element: function(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        var feature_uid = feature[0];\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n        var feature_strand = feature[4];\n\n        var // -0.5 to offset region between bases.\n        f_start = Math.floor(Math.max(0, (feature_start - tile_low - 0.5) * w_scale));\n\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n\n        var draw_start = f_start;\n        var draw_end = f_end;\n\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale + this.get_top_padding(width);\n\n        var thickness;\n        var y_start;\n        var thick_start = null;\n        var thick_end = null;\n\n        var // TODO: is there any reason why block, label color cannot be set at the Painter level?\n        // For now, assume '.' === '+'\n        block_color =\n            !feature_strand || feature_strand === \"+\" || feature_strand === \".\"\n                ? this.prefs.block_color\n                : this.prefs.reverse_strand_color;\n\n        var label_color = this.prefs.label_color;\n\n        // Set global alpha.\n        ctx.globalAlpha = this.alpha_scaler.gen_val(feature);\n\n        // In dense mode, put all data in top slot.\n        if (mode === \"Dense\") {\n            slot = 1;\n        }\n\n        if (mode === \"no_detail\") {\n            // No details for feature, so only one way to display.\n            ctx.fillStyle = block_color;\n            ctx.fillRect(f_start, y_start + 5, f_end - f_start, NO_DETAIL_FEATURE_HEIGHT);\n        } else {\n            // Mode is either Squish or Pack:\n            // Feature details.\n            var feature_ts = feature[5];\n\n            var feature_te = feature[6];\n            var feature_blocks = feature[7];\n\n            var // Whether we are drawing full height or squished features\n            full_height = true;\n\n            if (feature_ts && feature_te) {\n                thick_start = Math.floor(Math.max(0, (feature_ts - tile_low) * w_scale));\n                thick_end = Math.ceil(Math.min(width, Math.max(0, (feature_te - tile_low) * w_scale)));\n            }\n\n            // Set vars that depend on mode.\n            var thin_height;\n\n            var thick_height;\n            if (mode === \"Squish\") {\n                thin_height = 1;\n                thick_height = SQUISH_FEATURE_HEIGHT;\n                full_height = false;\n            } else if (mode === \"Dense\") {\n                thin_height = 5;\n                thick_height = DENSE_FEATURE_HEIGHT;\n            } else {\n                // mode === \"Pack\"\n                thin_height = 5;\n                thick_height = PACK_FEATURE_HEIGHT;\n            }\n\n            // Draw feature/feature blocks + connectors.\n            if (!feature_blocks) {\n                // If there are no blocks, treat the feature as one big exon.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                // If strand is specified, draw arrows over feature\n                if (feature_strand && full_height) {\n                    if (feature_strand === \"+\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                    } else if (feature_strand === \"-\") {\n                        ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                    }\n                    ctx.fillRect(f_start, y_start + 1, f_end - f_start, thick_height);\n                }\n            } else {\n                //\n                // There are feature blocks and mode is either Squish or Pack.\n                //\n                // Approach: (a) draw whole feature as connector/intron and (b) draw blocks as\n                // needed. This ensures that whole feature, regardless of whether it starts with\n                // a block, is visible.\n                //\n\n                // Compute y axis start position and height\n                var cur_y_start;\n\n                var cur_height;\n                if (mode === \"Squish\" || mode === \"Dense\") {\n                    cur_y_start = y_start + Math.floor(SQUISH_FEATURE_HEIGHT / 2) + 1;\n                    cur_height = 1;\n                } else {\n                    // mode === \"Pack\"\n                    if (feature_strand) {\n                        cur_y_start = y_start;\n                        cur_height = thick_height;\n                    } else {\n                        cur_y_start += SQUISH_FEATURE_HEIGHT / 2 + 1;\n                        cur_height = 1;\n                    }\n                }\n\n                // Draw whole feature as connector/intron.\n                if (this.draw_background_connector) {\n                    if (mode === \"Squish\" || mode === \"Dense\") {\n                        ctx.fillStyle = CONNECTOR_COLOR;\n                    } else {\n                        // mode === \"Pack\"\n                        if (feature_strand) {\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand\");\n                            }\n                        } else {\n                            ctx.fillStyle = CONNECTOR_COLOR;\n                        }\n                    }\n                    ctx.fillRect(f_start, cur_y_start, f_end - f_start, cur_height);\n                }\n\n                // Draw blocks.\n                var start_and_height;\n                for (var k = 0, k_len = feature_blocks.length; k < k_len; k++) {\n                    var block = feature_blocks[k];\n\n                    var // -0.5 to offset block between bases.\n                    block_start = Math.floor(Math.max(0, (block[0] - tile_low - 0.5) * w_scale));\n\n                    var block_end = Math.ceil(Math.min(width, Math.max((block[1] - tile_low - 0.5) * w_scale)));\n\n                    var last_block_start;\n                    var last_block_end;\n\n                    // Skip drawing if block not on tile.\n                    if (block_start > block_end) {\n                        continue;\n                    }\n\n                    // Draw thin block.\n                    ctx.fillStyle = block_color;\n                    ctx.fillRect(\n                        block_start,\n                        y_start + (thick_height - thin_height) / 2 + 1,\n                        block_end - block_start,\n                        thin_height\n                    );\n\n                    // If block intersects with thick region, draw block as thick.\n                    // - No thick is sometimes encoded as thick_start == thick_end, so don't draw in that case\n                    if (\n                        thick_start !== undefined &&\n                        feature_te > feature_ts &&\n                        !(block_start > thick_end || block_end < thick_start)\n                    ) {\n                        var block_thick_start = Math.max(block_start, thick_start);\n\n                        var block_thick_end = Math.min(block_end, thick_end);\n                        ctx.fillRect(block_thick_start, y_start + 1, block_thick_end - block_thick_start, thick_height);\n                        if (feature_blocks.length === 1 && mode === \"Pack\") {\n                            // Exactly one block means we have no introns, but do have a distinct \"thick\" region,\n                            // draw arrows over it if in pack mode.\n                            if (feature_strand === \"+\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"right_strand_inv\");\n                            } else if (feature_strand === \"-\") {\n                                ctx.fillStyle = ctx.canvas.manager.get_pattern(\"left_strand_inv\");\n                            }\n                            // If region is wide enough in pixels, pad a bit\n                            if (block_thick_start + 14 < block_thick_end) {\n                                block_thick_start += 2;\n                                block_thick_end -= 2;\n                            }\n                            ctx.fillRect(\n                                block_thick_start,\n                                y_start + 1,\n                                block_thick_end - block_thick_start,\n                                thick_height\n                            );\n                        }\n                    }\n                    // Draw individual connectors if required\n                    if (this.draw_individual_connectors && last_block_start) {\n                        this.draw_connector(ctx, last_block_start, last_block_end, block_start, block_end, y_start);\n                    }\n                    last_block_start = block_start;\n                    last_block_end = block_end;\n                }\n\n                // FIXME: Height scaling only works in Pack mode right now.\n                if (mode === \"Pack\") {\n                    // Reset alpha so height scaling is not impacted by alpha scaling.\n                    ctx.globalAlpha = 1;\n\n                    // Height scaling: draw white lines to reduce height according to height scale factor.\n                    ctx.fillStyle = \"white\"; // TODO: set this to background color.\n                    var hscale_factor = this.height_scaler.gen_val(feature);\n\n                    var // Ceil ensures that min height is >= 1.\n                    new_height = Math.ceil(thick_height * hscale_factor);\n\n                    var ws_height = Math.round((thick_height - new_height) / 2);\n                    if (hscale_factor !== 1) {\n                        ctx.fillRect(f_start, cur_y_start + 1, f_end - f_start, ws_height);\n                        ctx.fillRect(f_start, cur_y_start + thick_height - ws_height + 1, f_end - f_start, ws_height);\n                    }\n                }\n            }\n\n            // Reset alpha so that label is not transparent.\n            ctx.globalAlpha = 1;\n\n            // Draw label for Pack mode.\n            if (feature_name && mode === \"Pack\" && feature_start > tile_low) {\n                ctx.fillStyle = label_color;\n                // FIXME: assumption here that the entire view starts at 0\n                if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                    ctx.textAlign = \"left\";\n                    ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_end += ctx.measureText(feature_name).width + LABEL_SPACING;\n                } else {\n                    ctx.textAlign = \"right\";\n                    ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 8, this.max_label_length);\n                    draw_start -= ctx.measureText(feature_name).width + LABEL_SPACING;\n                }\n                //ctx.fillStyle = block_color;\n            }\n        }\n\n        // Reset global alpha.\n        ctx.globalAlpha = 1;\n\n        return [draw_start, draw_end];\n    }\n});\n\nvar ReadPainter = function(\n    data,\n    view_start,\n    view_end,\n    prefs,\n    mode,\n    alpha_scaler,\n    height_scaler,\n    ref_seq,\n    base_color_fn\n) {\n    FeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    this.ref_seq = ref_seq ? ref_seq.data : null;\n    this.base_color_fn = base_color_fn;\n};\n\n_.extend(ReadPainter.prototype, FeaturePainter.prototype, {\n    /**\n     * Returns height based on mode.\n     */\n    get_row_height: function() {\n        var height;\n        var mode = this.mode;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n            if (this.prefs.show_insertions) {\n                height *= 2;\n            }\n        }\n        return height;\n    },\n\n    /**\n     * Parse CIGAR string to get (a) a list of contiguous drawing blocks (MD=X) and\n     * (b) an array of [ op_index, op_len ] pairs where op_index is an index into the\n     * string 'MIDNSHP=X' Return value is a dictionary with two entries, blocks and cigar\n     */\n    _parse_cigar: function(cigar_str) {\n        var cigar_ops = \"MIDNSHP=X\";\n\n        // Parse cigar.\n        var blocks = [[0, 0]];\n\n        var cur_block = blocks[0];\n        var base_pos = 0;\n\n        var // Parse cigar operations out and update/create blocks as needed.\n        parsed_cigar = _.map(cigar_str.match(/[0-9]+[MIDNSHP=X]/g), op => {\n            // Get operation length, character.\n            var op_len = parseInt(op.slice(0, -1), 10),\n                op_char = op.slice(-1);\n\n            // Update drawing block.\n            if (op_char === \"N\") {\n                // At skip, so need to start new block if current block represents\n                // drawing area.\n                if (cur_block[1] !== 0) {\n                    cur_block = [base_pos + op_len, base_pos + op_len];\n                    blocks.push(cur_block);\n                }\n            } else if (\"ISHP\".indexOf(op_char) === -1) {\n                // Operation is M,D,=,X.\n                cur_block[1] += op_len;\n                base_pos += op_len;\n            }\n\n            // Return parsed cigar.\n            return [cigar_ops.indexOf(op_char), op_len];\n        });\n\n        return {\n            blocks: blocks,\n            cigar: parsed_cigar\n        };\n    },\n\n    /**\n     * Draw a single read from reference-based read sequence and cigar.\n     */\n    draw_read: function(ctx, mode, w_scale, y_start, tile_low, tile_high, feature_start, cigar, strand, read_seq) {\n        // Helper function to update base and sequnence offsets.\n        var update_base_offset = (offset, cig_op, cig_len) => {\n            if (\"M=NXD\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var update_seq_offset = (offset, cig_op, cig_len) => {\n            if (\"IX\".indexOf(cig_op) !== -1) {\n                offset += cig_len;\n            }\n            return offset;\n        };\n\n        var // Gets drawing coordinate for a sequence coordinate. Assumes closure variables w_scale and tile_low.\n        get_draw_coord = (\n            sequence_coord // -0.5 to offset sequence between bases.\n        ) => Math.floor(Math.max(0, (sequence_coord - tile_low - 0.5) * w_scale));\n\n        ctx.textAlign = \"center\";\n        var tile_region = [tile_low, tile_high];\n        var base_offset = 0;\n        var seq_offset = 0;\n        var gap = Math.round(w_scale / 2);\n        var char_width_px = ctx.canvas.manager.char_width_px;\n\n        var block_color = strand === \"+\" ? this.prefs.detail_block_color : this.prefs.reverse_strand_color;\n\n        var pack_mode = mode === \"Pack\";\n\n        var draw_height = pack_mode ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        var rect_y = y_start + 1;\n        var paint_utils = new ReadPainterUtils(ctx, draw_height, w_scale, mode);\n        var drawing_blocks = [];\n        var s_start;\n        var s_end;\n\n        // Keep list of items that need to be drawn on top of initial drawing layer.\n        var draw_last = [];\n\n        // Parse cigar and get drawing blocks.\n        var t = this._parse_cigar(cigar);\n        cigar = t.cigar;\n        drawing_blocks = t.blocks;\n\n        // Draw blocks.\n        for (var i = 0; i < drawing_blocks.length; i++) {\n            var block = drawing_blocks[i];\n\n            if (is_overlap([feature_start + block[0], feature_start + block[1]], tile_region)) {\n                s_start = get_draw_coord(feature_start + block[0]);\n                s_end = get_draw_coord(feature_start + block[1]);\n\n                // Make sure that block is drawn even if it too small to be rendered officially; in this case,\n                // read is drawn at 1px.\n                // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n                // and drawing.\n                if (s_start === s_end) {\n                    s_end += 1;\n                }\n\n                // Draw read base as rectangle.\n                ctx.fillStyle = block_color;\n                ctx.fillRect(s_start, rect_y, s_end - s_start, draw_height);\n            }\n        }\n\n        // Draw read features.\n        for (var cig_id = 0, len = cigar.length; cig_id < len; cig_id++) {\n            var cig = cigar[cig_id];\n            var cig_op = \"MIDNSHP=X\"[cig[0]];\n            var cig_len = cig[1];\n\n            var seq_start = feature_start + base_offset;\n            s_start = get_draw_coord(seq_start);\n            s_end = get_draw_coord(seq_start + cig_len);\n\n            // Skip feature if it's not in tile.\n            if (!is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                // Update offsets.\n                base_offset = update_base_offset(base_offset, cig_op, cig_len);\n                seq_offset = update_seq_offset(seq_offset, cig_op, cig_len);\n                continue;\n            }\n\n            // Make sure that read is drawn even if it too small to be rendered officially; in this case,\n            // read is drawn at 1px.\n            // TODO: need to ensure that s_start, s_end are calculated the same for both slotting\n            // and drawing.\n            if (s_start === s_end) {\n                s_end += 1;\n            }\n\n            // Draw read feature.\n            switch (cig_op) {\n                case \"H\": // Hard clipping.\n                case \"S\": // Soft clipping.\n                case \"P\": // Padding.\n                    // Sequence not present and not related to alignment; do nothing.\n                    break;\n                case \"M\": // \"Match\".\n                    // Because it's not known whether there is a match, ignore.\n                    base_offset += cig_len;\n                    break;\n                case \"=\": // Match with reference.\n                case \"X\": // Mismatch with reference.\n                    //\n                    // Draw sequence and/or variants.\n                    //\n\n                    // Get sequence to draw.\n                    var cur_seq = \"\";\n                    if (cig_op === \"X\") {\n                        // Get sequence from read_seq.\n                        cur_seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                    } else if (this.ref_seq) {\n                        // && cig_op === '='\n                        // Use reference sequence.\n                        cur_seq = this.ref_seq.slice(\n                            // If read starts after tile start, slice at read start.\n                            Math.max(0, seq_start - tile_low),\n                            // If read ends before tile end, slice at read end.\n                            Math.min(seq_start - tile_low + cig_len, tile_high - tile_low)\n                        );\n                    }\n\n                    // Draw sequence. Because cur_seq starts and read/tile start, go to there to start writing.\n                    var start_pos = Math.max(seq_start, tile_low);\n                    for (var c = 0; c < cur_seq.length; c++) {\n                        // Draw base if showing all (i.e. not showing differences) or there is a mismatch.\n                        if ((cur_seq && !this.prefs.show_differences) || cig_op === \"X\") {\n                            // Draw base.\n                            var c_start = Math.floor(Math.max(0, (start_pos + c - tile_low) * w_scale));\n                            ctx.fillStyle = this.base_color_fn(cur_seq[c]);\n                            if (pack_mode && w_scale > char_width_px) {\n                                ctx.fillText(cur_seq[c], c_start, y_start + 9);\n                            } else if (w_scale > 0.05) {\n                                // Require a minimum w_scale so that variants are only drawn when somewhat zoomed in.\n                                ctx.fillRect(c_start - gap, rect_y, Math.max(1, Math.round(w_scale)), draw_height);\n                            }\n                        }\n                    }\n\n                    // Move forward in sequence only if sequence used to get mismatches.\n                    if (cig_op === \"X\") {\n                        seq_offset += cig_len;\n                    }\n                    base_offset += cig_len;\n\n                    break;\n                case \"N\": // Skipped bases.\n                    ctx.fillStyle = CONNECTOR_COLOR;\n                    ctx.fillRect(s_start, rect_y + (draw_height - 1) / 2, s_end - s_start, 1);\n                    // No change in seq_offset because sequence not used when skipping.\n                    base_offset += cig_len;\n                    break;\n                case \"D\": // Deletion.\n                    paint_utils.draw_deletion(s_start, rect_y, cig_len);\n                    base_offset += cig_len;\n                    break;\n                case \"I\": // Insertion.\n                    // Check to see if sequence should be drawn at all by looking at the overlap between\n                    // the sequence region and the tile region.\n                    var insert_x_coord = s_start - gap;\n\n                    if (is_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                        var seq = read_seq.slice(seq_offset, seq_offset + cig_len);\n                        // Insertion point is between the sequence start and the previous base: (-gap) moves\n                        // back from sequence start to insertion point.\n                        if (this.prefs.show_insertions) {\n                            //\n                            // Show inserted sequence above, centered on insertion point.\n                            //\n\n                            // Draw sequence.\n                            // X center is offset + start - <half_sequence_length>\n                            var x_center = s_start - (s_end - s_start) / 2;\n                            if (\n                                (mode === \"Pack\" || this.mode === \"Auto\") &&\n                                read_seq !== undefined &&\n                                w_scale > char_width_px\n                            ) {\n                                // Draw sequence container.\n                                ctx.fillStyle = \"yellow\";\n                                ctx.fillRect(x_center - gap, y_start - 9, s_end - s_start, 9);\n                                draw_last[draw_last.length] = {\n                                    type: \"triangle\",\n                                    data: [insert_x_coord, y_start + 4, 5]\n                                };\n                                ctx.fillStyle = CONNECTOR_COLOR;\n                                // Based on overlap b/t sequence and tile, get sequence to be drawn.\n                                switch (compute_overlap([seq_start, seq_start + cig_len], tile_region)) {\n                                    case OVERLAP_START:\n                                        seq = seq.slice(tile_low - seq_start);\n                                        break;\n                                    case OVERLAP_END:\n                                        seq = seq.slice(0, seq_start - tile_high);\n                                        break;\n                                    case CONTAINED_BY:\n                                        // All of sequence drawn.\n                                        break;\n                                    case CONTAINS:\n                                        seq = seq.slice(tile_low - seq_start, seq_start - tile_high);\n                                        break;\n                                }\n                                // Draw sequence.\n                                for (var c = 0, str_len = seq.length; c < str_len; c++) {\n                                    var c_start = Math.floor(Math.max(0, (seq_start + c - tile_low) * w_scale));\n                                    ctx.fillText(seq[c], c_start - (s_end - s_start) / 2, y_start);\n                                }\n                            } else {\n                                // Draw block.\n                                ctx.fillStyle = \"yellow\";\n                                // TODO: This is a pretty hack-ish way to fill rectangle based on mode.\n                                ctx.fillRect(\n                                    x_center,\n                                    y_start + (this.mode !== \"Dense\" ? 2 : 5),\n                                    s_end - s_start,\n                                    mode !== \"Dense\" ? SQUISH_FEATURE_HEIGHT : DENSE_FEATURE_HEIGHT\n                                );\n                            }\n                        } else {\n                            if (\n                                (mode === \"Pack\" || this.mode === \"Auto\") &&\n                                read_seq !== undefined &&\n                                w_scale > char_width_px\n                            ) {\n                                // Show insertions with a single number at the insertion point.\n                                draw_last.push({\n                                    type: \"text\",\n                                    data: [seq.length, insert_x_coord, y_start + 9]\n                                });\n                            } else {\n                                // TODO: probably can merge this case with code above.\n                            }\n                        }\n                    }\n                    seq_offset += cig_len;\n                    // No change to base offset because insertions are drawn above sequence/read.\n                    break;\n            }\n        }\n\n        //\n        // Draw last items.\n        //\n        ctx.fillStyle = \"yellow\";\n        var item;\n        var type;\n        var data;\n        for (var i = 0; i < draw_last.length; i++) {\n            item = draw_last[i];\n            type = item.type;\n            data = item.data;\n            if (type === \"text\") {\n                ctx.save();\n                ctx.font = `bold ${ctx.font}`;\n                ctx.fillText(data[0], data[1], data[2]);\n                ctx.restore();\n            } else if (type === \"triangle\") {\n                drawDownwardEquilateralTriangle(ctx, data[0], data[1], data[2]);\n            }\n        }\n    },\n\n    /**\n     * Draw a complete read pair\n     */\n    draw_element: function(ctx, mode, feature, slot, tile_low, tile_high, w_scale, y_scale, width) {\n        // All features need a start, end, and vertical center.\n        var feature_uid = feature[0];\n\n        var feature_start = feature[1];\n        var feature_end = feature[2];\n        var feature_name = feature[3];\n\n        var // -0.5 to put element between bases.\n        f_start = Math.floor(Math.max(-0.5 * w_scale, (feature_start - tile_low - 0.5) * w_scale));\n\n        var f_end = Math.ceil(Math.min(width, Math.max(0, (feature_end - tile_low - 0.5) * w_scale)));\n\n        var y_start = (mode === \"Dense\" ? 0 : 0 + slot) * y_scale;\n\n        var draw_height = mode === \"Pack\" ? PACK_FEATURE_HEIGHT : SQUISH_FEATURE_HEIGHT;\n\n        var label_color = this.prefs.label_color;\n\n        // Draw read.\n        if (feature[5] instanceof Array) {\n            // Read is paired.\n            var connector = true;\n\n            // Draw left/forward read.\n            if (feature[4][1] >= tile_low && feature[4][0] <= tile_high && feature[4][2]) {\n                this.draw_read(\n                    ctx,\n                    mode,\n                    w_scale,\n                    y_start,\n                    tile_low,\n                    tile_high,\n                    feature[4][0],\n                    feature[4][2],\n                    feature[4][3],\n                    feature[4][4]\n                );\n            } else {\n                connector = false;\n            }\n\n            // Draw right/reverse read.\n            if (feature[5][1] >= tile_low && feature[5][0] <= tile_high && feature[5][2]) {\n                this.draw_read(\n                    ctx,\n                    mode,\n                    w_scale,\n                    y_start,\n                    tile_low,\n                    tile_high,\n                    feature[5][0],\n                    feature[5][2],\n                    feature[5][3],\n                    feature[5][4]\n                );\n            } else {\n                connector = false;\n            }\n\n            // Draw connector if both reads were drawn.\n            // TODO: currently, there is no way to connect reads drawn on different tiles; to connect reads on different tiles, data manager\n            // code is needed to join mate pairs from different regions. Alternatively, requesting multiple regions of data at once would\n            // make it possible to put together more easily.\n            // -0.5 to position connector correctly between reads.\n            var b1_end = Math.ceil(\n                Math.min(width, Math.max(-0.5 * w_scale, (feature[4][1] - tile_low - 0.5) * w_scale))\n            );\n\n            var b2_start = Math.floor(Math.max(-0.5 * w_scale, (feature[5][0] - tile_low - 0.5) * w_scale));\n\n            if (connector && b2_start > b1_end) {\n                ctx.fillStyle = CONNECTOR_COLOR;\n                var line_height = y_start + 1 + (draw_height - 1) / 2;\n                dashedLine(ctx, b1_end, line_height, b2_start, line_height);\n            }\n        } else {\n            // Read is single.\n            this.draw_read(\n                ctx,\n                mode,\n                w_scale,\n                y_start,\n                tile_low,\n                tile_high,\n                feature_start,\n                feature[4],\n                feature[5],\n                feature[6]\n            );\n        }\n        if (mode === \"Pack\" && feature_start >= tile_low && feature_name !== \".\") {\n            // Draw label.\n            ctx.fillStyle = this.prefs.label_color;\n            if (tile_low === 0 && f_start - ctx.measureText(feature_name).width < 0) {\n                ctx.textAlign = \"left\";\n                ctx.fillText(feature_name, f_end + LABEL_SPACING, y_start + 9, this.max_label_length);\n            } else {\n                ctx.textAlign = \"right\";\n                ctx.fillText(feature_name, f_start - LABEL_SPACING, y_start + 9, this.max_label_length);\n            }\n        }\n\n        // FIXME: provide actual coordinates for drawn read.\n        return [0, 0];\n    }\n});\n\nvar ArcLinkedFeaturePainter = function(data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler) {\n    LinkedFeaturePainter.call(this, data, view_start, view_end, prefs, mode, alpha_scaler, height_scaler);\n    // Need to know the longest feature length for adding spacing\n    this.longest_feature_length = this.calculate_longest_feature_length();\n    this.draw_background_connector = false;\n    this.draw_individual_connectors = true;\n};\n\n_.extend(ArcLinkedFeaturePainter.prototype, FeaturePainter.prototype, LinkedFeaturePainter.prototype, {\n    calculate_longest_feature_length: function() {\n        var longest_feature_length = 0;\n        for (var i = 0, len = this.data.length; i < len; i++) {\n            var feature = this.data[i];\n            var feature_start = feature[1];\n            var feature_end = feature[2];\n            longest_feature_length = Math.max(longest_feature_length, feature_end - feature_start);\n        }\n        return longest_feature_length;\n    },\n\n    get_top_padding: function(width) {\n        var view_range = this.view_end - this.view_start;\n        var w_scale = width / view_range;\n        return Math.min(128, Math.ceil(this.longest_feature_length / 2 * w_scale));\n    },\n\n    draw_connector: function(ctx, block1_start, block1_end, block2_start, block2_end, y_start) {\n        // Arc drawing -- from closest endpoints\n        var x_center = (block1_end + block2_start) / 2;\n\n        var radius = block2_start - x_center;\n\n        // For full half circles\n        var angle1 = Math.PI;\n\n        var angle2 = 0;\n        if (radius > 0) {\n            ctx.beginPath();\n            ctx.arc(x_center, y_start, block2_start - x_center, Math.PI, 0);\n            ctx.stroke();\n        }\n    }\n});\n\n// Color stuff from less.js\n\nvar Color = function(rgb, a) {\n    /**\n     * The end goal here, is to parse the arguments\n     * into an integer triplet, such as `128, 255, 0`\n     *\n     * This facilitates operations and conversions.\n     */\n    if (Array.isArray(rgb)) {\n        this.rgb = rgb;\n    } else if (rgb.length == 6) {\n        this.rgb = rgb.match(/.{2}/g).map(c => parseInt(c, 16));\n    } else if (rgb.length == 7) {\n        this.rgb = rgb\n            .substring(1, 7)\n            .match(/.{2}/g)\n            .map(c => parseInt(c, 16));\n    } else {\n        this.rgb = rgb.split(\"\").map(c => parseInt(c + c, 16));\n    }\n    this.alpha = typeof a === \"number\" ? a : 1;\n};\nColor.prototype = {\n    eval: function() {\n        return this;\n    },\n\n    //\n    // If we have some transparency, the only way to represent it\n    // is via `rgba`. Otherwise, we use the hex representation,\n    // which has better compatibility with older browsers.\n    // Values are capped between `0` and `255`, rounded and zero-padded.\n    //\n    toCSS: function() {\n        if (this.alpha < 1.0) {\n            return `rgba(${this.rgb\n                .map(c => Math.round(c))\n                .concat(this.alpha)\n                .join(\", \")})`;\n        } else {\n            return `#${this.rgb\n                .map(i => {\n                    i = Math.round(i);\n                    i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n                    return i.length === 1 ? `0${i}` : i;\n                })\n                .join(\"\")}`;\n        }\n    },\n\n    toHSL: function() {\n        var r = this.rgb[0] / 255;\n        var g = this.rgb[1] / 255;\n        var b = this.rgb[2] / 255;\n        var a = this.alpha;\n        var max = Math.max(r, g, b);\n        var min = Math.min(r, g, b);\n        var h;\n        var s;\n        var l = (max + min) / 2;\n        var d = max - min;\n\n        if (max === min) {\n            h = s = 0;\n        } else {\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n            switch (max) {\n                case r:\n                    h = (g - b) / d + (g < b ? 6 : 0);\n                    break;\n                case g:\n                    h = (b - r) / d + 2;\n                    break;\n                case b:\n                    h = (r - g) / d + 4;\n                    break;\n            }\n            h /= 6;\n        }\n        return { h: h * 360, s: s, l: l, a: a };\n    },\n\n    toARGB: function() {\n        var argb = [Math.round(this.alpha * 255)].concat(this.rgb);\n        return `#${argb\n            .map(i => {\n                i = Math.round(i);\n                i = (i > 255 ? 255 : i < 0 ? 0 : i).toString(16);\n                return i.length === 1 ? `0${i}` : i;\n            })\n            .join(\"\")}`;\n    },\n\n    mix: function(color2, weight) {\n        var color1 = this;\n\n        var p = weight; // .value / 100.0;\n        var w = p * 2 - 1;\n        var a = color1.toHSL().a - color2.toHSL().a;\n\n        var w1 = ((w * a == -1 ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\n        var w2 = 1 - w1;\n\n        var rgb = [\n            color1.rgb[0] * w1 + color2.rgb[0] * w2,\n            color1.rgb[1] * w1 + color2.rgb[1] * w2,\n            color1.rgb[2] * w1 + color2.rgb[2] * w2\n        ];\n\n        var alpha = color1.alpha * p + color2.alpha * (1 - p);\n\n        return new Color(rgb, alpha);\n    }\n};\n\n// End colors from less.js\n\nvar LinearRamp = function(start_color, end_color, start_value, end_value) {\n    /**\n     * Simple linear gradient\n     */\n    this.start_color = new Color(start_color);\n    this.end_color = new Color(end_color);\n    this.start_value = start_value;\n    this.end_value = end_value;\n    this.value_range = end_value - start_value;\n};\n\nLinearRamp.prototype.map_value = function(value) {\n    value = Math.max(value, this.start_value);\n    value = Math.min(value, this.end_value);\n    value = (value - this.start_value) / this.value_range;\n    // HACK: just red for now\n    // return \"hsl(0,100%,\" + (value * 100) + \"%)\"\n    return this.start_color.mix(this.end_color, 1 - value).toCSS();\n};\n\nvar SplitRamp = function(start_color, middle_color, end_color, start_value, end_value) {\n    /**\n     * Two gradients split away from 0\n     */\n    this.positive_ramp = new LinearRamp(middle_color, end_color, 0, end_value);\n    this.negative_ramp = new LinearRamp(middle_color, start_color, 0, -start_value);\n    this.start_value = start_value;\n    this.end_value = end_value;\n};\n\nSplitRamp.prototype.map_value = function(value) {\n    value = Math.max(value, this.start_value);\n    value = Math.min(value, this.end_value);\n    if (value >= 0) {\n        return this.positive_ramp.map_value(value);\n    } else {\n        return this.negative_ramp.map_value(-value);\n    }\n};\n\nvar DiagonalHeatmapPainter = function(data, view_start, view_end, prefs, mode) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    var i;\n    var len;\n\n    if (this.prefs.min_value === undefined) {\n        var min_value = Infinity;\n        for (i = 0, len = this.data.length; i < len; i++) {\n            min_value = Math.min(min_value, this.data[i][6]);\n        }\n        this.prefs.min_value = min_value;\n    }\n    if (this.prefs.max_value === undefined) {\n        var max_value = -Infinity;\n        for (i = 0, len = this.data.length; i < len; i++) {\n            max_value = Math.max(max_value, this.data[i][6]);\n        }\n        this.prefs.max_value = max_value;\n    }\n};\n\nDiagonalHeatmapPainter.prototype.default_prefs = {\n    min_value: undefined,\n    max_value: undefined,\n    mode: \"Heatmap\",\n    pos_color: \"#FF8C00\",\n    neg_color: \"#4169E1\"\n};\n\nDiagonalHeatmapPainter.prototype.draw = function(ctx, width, height, w_scale) {\n    var min_value = this.prefs.min_value;\n    var max_value = this.prefs.max_value;\n    var value_range = max_value - min_value;\n    var height_px = height;\n    var view_start = this.view_start;\n    var mode = this.mode;\n    var data = this.data;\n    var invsqrt2 = 1 / Math.sqrt(2);\n\n    var ramp = new SplitRamp(this.prefs.neg_color, \"#FFFFFF\", this.prefs.pos_color, min_value, max_value);\n\n    var d;\n    var s1;\n    var e1;\n    var s2;\n    var e2;\n    var value;\n\n    var scale = p => (p - view_start) * w_scale;\n\n    ctx.save();\n\n    // Draw into triangle, then rotate and scale\n    ctx.rotate(-45 * Math.PI / 180);\n    ctx.scale(invsqrt2, invsqrt2);\n\n    // Paint track.\n    for (var i = 0, len = data.length; i < len; i++) {\n        d = data[i];\n\n        s1 = scale(d[1]);\n        e1 = scale(d[2]);\n        s2 = scale(d[4]);\n        e2 = scale(d[5]);\n        value = d[6];\n\n        ctx.fillStyle = ramp.map_value(value);\n        ctx.fillRect(s1, s2, e1 - s1, e2 - s2);\n    }\n\n    ctx.restore();\n};\n\n/**\n * Utilities for painting reads.\n */\nvar ReadPainterUtils = function(ctx, row_height, px_per_base, mode) {\n    this.ctx = ctx;\n    this.row_height = row_height;\n    this.px_per_base = px_per_base;\n    this.draw_details = (mode === \"Pack\" || mode === \"Auto\") && px_per_base >= ctx.canvas.manager.char_width_px;\n    this.delete_details_thickness = 0.2;\n};\n\n_.extend(ReadPainterUtils.prototype, {\n    /**\n     * Draw deletion of base(s).\n     * @param draw_detail if true, drawing in detail and deletion is drawn more subtly\n     */\n    draw_deletion: function(x, y, len) {\n        this.ctx.fillStyle = \"black\";\n        var thickness = (this.draw_details ? this.delete_details_thickness : 1) * this.row_height;\n        y += 0.5 * (this.row_height - thickness);\n        this.ctx.fillRect(x, y, len * this.px_per_base, thickness);\n    }\n});\n\n/**\n * Paints variant data onto canvas.\n */\nvar VariantPainter = function(data, view_start, view_end, prefs, mode, base_color_fn) {\n    Painter.call(this, data, view_start, view_end, prefs, mode);\n    this.base_color_fn = base_color_fn;\n    this.divider_height = 1;\n};\n\n_.extend(VariantPainter.prototype, Painter.prototype, {\n    /**\n     * Height of a single row, depends on mode\n     */\n    get_row_height: function() {\n        var mode = this.mode;\n        var height;\n        if (mode === \"Dense\") {\n            height = DENSE_TRACK_HEIGHT;\n        } else if (mode === \"Squish\") {\n            height = SQUISH_TRACK_HEIGHT;\n        } else {\n            // mode === \"Pack\"\n            height = PACK_TRACK_HEIGHT;\n        }\n        return height;\n    },\n\n    /**\n     * Returns required height to draw a particular number of samples in a given mode.\n     */\n    get_required_height: function(num_samples) {\n        // FIXME: for single-sample data, height should be summary_height when zoomed out and\n        // row_height when zoomed in.\n        var height = this.prefs.summary_height;\n\n        // If showing sample data, height is summary + divider + samples.\n        if (num_samples > 1 && this.prefs.show_sample_data) {\n            height += this.divider_height + num_samples * this.get_row_height();\n        }\n        return height;\n    },\n\n    /**\n     * Draw on the context using a rectangle of width x height with scale w_scale.\n     */\n    draw: function(ctx, width, height, w_scale) {\n        ctx.save();\n\n        var /**\n         * Returns dictionary of information about an indel; returns empty if there no indel. Assumes indel is left-aligned.\n         * Dict attributes:\n         *    -type: 'insertion' or 'deletion'\n         *    -start: where the deletion starts relative to reference start\n         *    -len: how long the deletion is\n         */\n        get_indel_info = (ref, alt) => {\n            var ref_len = ref.length;\n            var alt_len = alt.length;\n            var start = 0;\n            var len = 1;\n            var type = null;\n            if (alt === \"-\") {\n                type = \"deletion\";\n                len = ref.length;\n            } else if (ref.indexOf(alt) === 0 && ref_len > alt_len) {\n                type = \"deletion\";\n                len = ref_len - alt_len;\n                start = alt_len;\n            } else if (alt.indexOf(ref) === 0 && ref_len < alt_len) {\n                // Insertion.\n                type = \"insertion\";\n                len = alt_len - ref_len;\n                start = alt_len;\n            }\n\n            return type !== null ? { type: type, start: start, len: len } : {};\n        };\n\n        // Draw.\n        var locus_data;\n\n        var pos;\n        var id;\n        var ref;\n        var alt;\n        var qual;\n        var filter;\n        var sample_gts;\n        var allele_counts;\n        var variant;\n        var draw_x_start;\n        var draw_y_start;\n        var genotype;\n\n        var // Always draw variants at least 1 pixel wide.\n        base_px = Math.max(1, Math.floor(w_scale));\n\n        var // Determine number of samples.\n        num_samples = this.data.length ? this.data[0][7].split(\",\").length : 0;\n\n        var row_height = this.mode === \"Squish\" ? SQUISH_TRACK_HEIGHT : PACK_TRACK_HEIGHT;\n\n        var // If zoomed out, fill the whole row with feature to make it easier to read;\n        // when zoomed in, use feature height so that there are gaps in sample rows.\n        feature_height =\n            w_scale < 0.1 ? row_height : this.mode === \"Squish\" ? SQUISH_FEATURE_HEIGHT : PACK_FEATURE_HEIGHT;\n\n        var draw_summary = true;\n\n        var paint_utils = new ReadPainterUtils(ctx, row_height, w_scale, this.mode);\n\n        var j;\n\n        // If there's a single sample, update drawing variables.\n        if (num_samples === 1) {\n            row_height = feature_height =\n                w_scale < ctx.canvas.manager.char_width_px ? this.prefs.summary_height : row_height;\n            paint_utils.row_height = row_height;\n            // No summary when there's a single sample.\n            draw_summary = false;\n        }\n\n        // Draw divider between summary and samples.\n        if (this.prefs.show_sample_data && draw_summary) {\n            ctx.fillStyle = \"#F3F3F3\";\n            ctx.globalAlpha = 1;\n            ctx.fillRect(0, this.prefs.summary_height - this.divider_height, width, this.divider_height);\n        }\n\n        // Draw variants.\n        ctx.textAlign = \"center\";\n        for (var i = 0; i < this.data.length; i++) {\n            // Get locus data.\n            locus_data = this.data[i];\n            pos = locus_data[1];\n            ref = locus_data[3];\n            alt = [locus_data[4].split(\",\")];\n            sample_gts = locus_data[7].split(\",\");\n            allele_counts = locus_data.slice(8);\n\n            // Process alterate values to derive information about each alt.\n            alt = _.map(_.flatten(alt), a => {\n                var alt_info = {\n                    type: \"snp\",\n                    value: a,\n                    start: 0\n                };\n\n                var indel_info = get_indel_info(ref, a);\n\n                return _.extend(alt_info, indel_info);\n            });\n\n            // Only draw locus data if it's in viewing region.\n            if (pos < this.view_start || pos > this.view_end) {\n                continue;\n            }\n\n            // Draw summary for alleles.\n            if (draw_summary) {\n                ctx.fillStyle = \"#999999\";\n                ctx.globalAlpha = 1;\n                for (j = 0; j < alt.length; j++) {\n                    // Draw background for summary.\n                    draw_x_start = this.get_start_draw_pos(pos + alt[j].start, w_scale);\n                    ctx.fillRect(draw_x_start, 0, base_px, this.prefs.summary_height);\n                    draw_y_start = this.prefs.summary_height;\n                    // Draw allele fractions onto summary.\n                    for (j = 0; j < alt.length; j++) {\n                        ctx.fillStyle = alt[j].type === \"deletion\" ? \"black\" : this.base_color_fn(alt[j].value);\n                        var allele_frac = allele_counts / sample_gts.length;\n                        var draw_height = Math.ceil(this.prefs.summary_height * allele_frac);\n                        ctx.fillRect(draw_x_start, draw_y_start - draw_height, base_px, draw_height);\n                        draw_y_start -= draw_height;\n                    }\n                }\n            }\n\n            // Done drawing if not showing samples data.\n            if (!this.prefs.show_sample_data) {\n                continue;\n            }\n\n            // Draw sample genotype(s).\n            draw_y_start = draw_summary ? this.prefs.summary_height + this.divider_height : 0;\n            for (j = 0; j < sample_gts.length; j++, draw_y_start += row_height) {\n                genotype = sample_gts[j] ? sample_gts[j].split(/\\/|\\|/) : [\"0\", \"0\"];\n\n                // Get variant to draw and set drawing properties.\n                variant = null;\n                if (genotype[0] === genotype[1]) {\n                    if (genotype[0] === \".\") {\n                        // TODO: draw uncalled variant.\n                    } else if (genotype[0] !== \"0\") {\n                        // Homozygous for variant.\n                        variant = alt[parseInt(genotype[0], 10) - 1];\n                        ctx.globalAlpha = 1;\n                    }\n                    // else reference\n                } else {\n                    // Heterozygous for variant.\n                    variant = genotype[0] !== \"0\" ? genotype[0] : genotype[1];\n                    variant = alt[parseInt(variant, 10) - 1];\n                    ctx.globalAlpha = 0.5;\n                }\n\n                // If there's a variant, draw it.\n                if (variant) {\n                    draw_x_start = this.get_start_draw_pos(pos + variant.start, w_scale);\n                    if (variant.type === \"snp\") {\n                        var snp = variant.value;\n                        ctx.fillStyle = this.base_color_fn(snp);\n                        if (paint_utils.draw_details) {\n                            ctx.fillText(snp, this.get_draw_pos(pos, w_scale), draw_y_start + row_height);\n                        } else {\n                            ctx.fillRect(draw_x_start, draw_y_start + 1, base_px, feature_height);\n                        }\n                    } else if (variant.type === \"deletion\") {\n                        paint_utils.draw_deletion(draw_x_start, draw_y_start + 1, variant.len);\n                    } else {\n                        // TODO: handle insertions.\n                    }\n                }\n            }\n        }\n\n        ctx.restore();\n    }\n});\n\nexport default {\n    Scaler: Scaler,\n    LinePainter: LinePainter,\n    LinkedFeaturePainter: LinkedFeaturePainter,\n    ReadPainter: ReadPainter,\n    ArcLinkedFeaturePainter: ArcLinkedFeaturePainter,\n    DiagonalHeatmapPainter: DiagonalHeatmapPainter,\n    VariantPainter: VariantPainter\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster/painters.js","import * as _ from \"libs/underscore\";\nvar extend = _.extend;\n\n/**\n * Filters that enable users to show/hide data points dynamically.\n */\nvar Filter = function(obj_dict) {\n    this.manager = null;\n    this.name = obj_dict.name;\n    // Index into payload to filter.\n    this.index = obj_dict.index;\n    this.tool_id = obj_dict.tool_id;\n    // Name to use for filter when building expression for tool.\n    this.tool_exp_name = obj_dict.tool_exp_name;\n};\n\nextend(Filter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        return {\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        };\n    }\n});\n\n/**\n * Creates an action icon.\n */\nvar create_action_icon = (title, css_class, on_click_fn) =>\n    $(\"<a/>\")\n        .attr(\"href\", \"javascript:void(0);\")\n        .attr(\"title\", title)\n        .addClass(\"icon-button\")\n        .addClass(css_class)\n        .tooltip()\n        .click(on_click_fn);\n\n/**\n * Number filters have a min, max as well as a low, high; low and high are used\n */\nvar NumberFilter = function(obj_dict) {\n    //\n    // Attribute init.\n    //\n    Filter.call(this, obj_dict);\n    // Filter low/high. These values are used to filter elements.\n    this.low = \"low\" in obj_dict ? obj_dict.low : -Number.MAX_VALUE;\n    this.high = \"high\" in obj_dict ? obj_dict.high : Number.MAX_VALUE;\n    // Slide min/max. These values are used to set/update slider.\n    this.min = \"min\" in obj_dict ? obj_dict.min : Number.MAX_VALUE;\n    this.max = \"max\" in obj_dict ? obj_dict.max : -Number.MAX_VALUE;\n    // UI elements associated with filter.\n    this.container = null;\n    this.slider = null;\n    this.slider_label = null;\n\n    //\n    // Create HTML.\n    //\n\n    // Function that supports inline text editing of slider values.\n    // Enable users to edit parameter's value via a text box.\n    var edit_slider_values = (container, span, slider) => {\n        container.click(function() {\n            var cur_value = span.text();\n            var max = parseFloat(slider.slider(\"option\", \"max\"));\n\n            var input_size = max <= 1 ? 4 : max <= 1000000 ? max.toString().length : 6;\n\n            var multi_value = false;\n            var slider_row = $(this).parents(\".slider-row\");\n\n            // Row now has input.\n            slider_row.addClass(\"input\");\n\n            // Increase input size if there are two values.\n            if (slider.slider(\"option\", \"values\")) {\n                input_size = 2 * input_size + 1;\n                multi_value = true;\n            }\n            span.text(\"\");\n            // Temporary input for changing value.\n            $(\"<input type='text'/>\")\n                .attr(\"size\", input_size)\n                .attr(\"maxlength\", input_size)\n                .attr(\"value\", cur_value)\n                .appendTo(span)\n                .focus()\n                .select()\n                .click(e => {\n                    // Don't want click to propogate up to values_span and restart everything.\n                    e.stopPropagation();\n                })\n                .blur(function() {\n                    $(this).remove();\n                    span.text(cur_value);\n                    slider_row.removeClass(\"input\");\n                })\n                .keyup(function(e) {\n                    if (e.keyCode === 27) {\n                        // Escape key.\n                        $(this).trigger(\"blur\");\n                    } else if (e.keyCode === 13) {\n                        //\n                        // Enter/return key initiates callback. If new value(s) are in slider range,\n                        // change value (which calls slider's change() function).\n                        //\n                        var slider_min = slider.slider(\"option\", \"min\");\n\n                        var slider_max = slider.slider(\"option\", \"max\");\n\n                        var invalid = a_val => isNaN(a_val) || a_val > slider_max || a_val < slider_min;\n\n                        var new_value = $(this).val();\n                        if (!multi_value) {\n                            new_value = parseFloat(new_value);\n                            if (invalid(new_value)) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        } else {\n                            // Multi value.\n                            new_value = new_value.split(\"-\");\n                            new_value = [parseFloat(new_value[0]), parseFloat(new_value[1])];\n                            if (invalid(new_value[0]) || invalid(new_value[1])) {\n                                alert(`Parameter value must be in the range [${slider_min}-${slider_max}]`);\n                                return $(this);\n                            }\n                        }\n\n                        // Updating the slider also updates slider values and removes input.\n                        slider.slider(multi_value ? \"values\" : \"value\", new_value);\n                        slider_row.removeClass(\"input\");\n                    }\n                });\n        });\n    };\n\n    var filter = this;\n\n    filter.parent_div = $(\"<div/>\").addClass(\"filter-row slider-row\");\n\n    // Set up filter label (name, values).\n    var filter_label = $(\"<div/>\")\n        .addClass(\"elt-label\")\n        .appendTo(filter.parent_div);\n\n    var name_span = $(\"<span/>\")\n        .addClass(\"slider-name\")\n        .text(`${filter.name}  `)\n        .appendTo(filter_label);\n\n    var values_span = $(\"<span/>\").text(`${this.low}-${this.high}`);\n\n    var values_span_container = $(\"<span/>\")\n        .addClass(\"slider-value\")\n        .appendTo(filter_label)\n        .append(\"[\")\n        .append(values_span)\n        .append(\"]\");\n\n    filter.values_span = values_span;\n\n    // Set up slider for filter.\n    var slider_div = $(\"<div/>\")\n        .addClass(\"slider\")\n        .appendTo(filter.parent_div);\n    filter.control_element = $(\"<div/>\")\n        .attr(\"id\", `${filter.name}-filter-control`)\n        .appendTo(slider_div);\n    filter.control_element.slider({\n        range: true,\n        min: this.min,\n        max: this.max,\n        step: this.get_slider_step(this.min, this.max),\n        values: [this.low, this.high],\n        slide: function(event, ui) {\n            filter.slide(event, ui);\n        },\n        change: function(event, ui) {\n            filter.control_element.slider(\"option\", \"slide\").call(filter.control_element, event, ui);\n        }\n    });\n    filter.slider = filter.control_element;\n    filter.slider_label = values_span;\n\n    // Enable users to edit slider values via text box.\n    edit_slider_values(values_span_container, values_span, filter.control_element);\n\n    // Set up filter display controls.\n    var display_controls_div = $(\"<div/>\")\n        .addClass(\"display-controls\")\n        .appendTo(filter.parent_div);\n    this.transparency_icon = create_action_icon(\"Use filter for data transparency\", \"layer-transparent\", () => {\n        if (filter.manager.alpha_filter !== filter) {\n            // Setting this filter as the alpha filter.\n            filter.manager.alpha_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".layer-transparent\")\n                .removeClass(\"active\")\n                .hide();\n            filter.transparency_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.alpha_filter = null;\n            filter.transparency_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    this.height_icon = create_action_icon(\"Use filter for data height\", \"arrow-resize-090\", () => {\n        if (filter.manager.height_filter !== filter) {\n            // Setting this filter as the height filter.\n            filter.manager.height_filter = filter;\n            // Update UI for new filter.\n            filter.manager.parent_div\n                .find(\".arrow-resize-090\")\n                .removeClass(\"active\")\n                .hide();\n            filter.height_icon.addClass(\"active\").show();\n        } else {\n            // Clearing filter as alpha filter.\n            filter.manager.height_filter = null;\n            filter.height_icon.removeClass(\"active\");\n        }\n        filter.manager.track.request_draw({\n            force: true,\n            clear_after: true\n        });\n    })\n        .appendTo(display_controls_div)\n        .hide();\n    filter.parent_div.hover(\n        () => {\n            filter.transparency_icon.show();\n            filter.height_icon.show();\n        },\n        () => {\n            if (filter.manager.alpha_filter !== filter) {\n                filter.transparency_icon.hide();\n            }\n            if (filter.manager.height_filter !== filter) {\n                filter.height_icon.hide();\n            }\n        }\n    );\n\n    // Add to clear floating layout.\n    $(\"<div style='clear: both;'/>\").appendTo(filter.parent_div);\n};\nextend(NumberFilter.prototype, {\n    /**\n     * Convert filter to dictionary.\n     */\n    to_dict: function() {\n        var obj_dict = Filter.prototype.to_dict.call(this);\n        return extend(obj_dict, {\n            type: \"number\",\n            min: this.min,\n            max: this.max,\n            low: this.low,\n            high: this.high\n        });\n    },\n    /**\n     * Return a copy of filter.\n     */\n    copy: function() {\n        return new NumberFilter({\n            name: this.name,\n            index: this.index,\n            tool_id: this.tool_id,\n            tool_exp_name: this.tool_exp_name\n        });\n    },\n    /**\n     * Get step for slider.\n     */\n    // FIXME: make this a \"static\" function.\n    get_slider_step: function(min, max) {\n        var range = max - min;\n        return range <= 2 ? 0.01 : 1;\n    },\n    /**\n     * Handle slide events.\n     */\n    slide: function(event, ui) {\n        var values = ui.values;\n\n        // Set new values in UI.\n        this.values_span.text(`${values[0]}-${values[1]}`);\n\n        // Set new values in filter.\n        this.low = values[0];\n        this.high = values[1];\n\n        // Set timeout to update if filter low, high are stable.\n        var self = this;\n        setTimeout(() => {\n            if (values[0] === self.low && values[1] === self.high) {\n                self.manager.track.request_draw({\n                    force: true,\n                    clear_after: true\n                });\n            }\n        }, 25);\n    },\n    /**\n     * Returns true if filter can be applied to element.\n     */\n    applies_to: function(element) {\n        if (element.length > this.index) {\n            return true;\n        }\n        return false;\n    },\n    /**\n     * Helper function: returns true if value in in filter's [low, high] range.\n     */\n    _keep_val: function(val) {\n        return isNaN(val) || (val >= this.low && val <= this.high);\n    },\n    /**\n     * Returns true if (a) element's value(s) is in [low, high] (range is inclusive)\n     * or (b) if value is non-numeric and hence unfilterable.\n     */\n    keep: function(element) {\n        if (!this.applies_to(element)) {\n            // No element to filter on.\n            return true;\n        }\n\n        // Keep value function.\n        var filter = this;\n\n        // Do filtering.\n        var to_filter = element[this.index];\n        if (to_filter instanceof Array) {\n            var returnVal = true;\n            for (var i = 0; i < to_filter.length; i++) {\n                if (!this._keep_val(to_filter[i])) {\n                    // Exclude element.\n                    returnVal = false;\n                    break;\n                }\n            }\n            return returnVal;\n        } else {\n            return this._keep_val(element[this.index]);\n        }\n    },\n    /**\n     * Update filter's min and max values based on element's values.\n     */\n    update_attrs: function(element) {\n        var updated = false;\n        if (!this.applies_to(element)) {\n            return updated;\n        }\n\n        //\n        // Update filter's min, max based on element values.\n        //\n\n        // Make value(s) into an Array.\n        var values = element[this.index];\n        if (!(values instanceof Array)) {\n            values = [values];\n        }\n\n        // Loop through values and update min, max.\n        for (var i = 0; i < values.length; i++) {\n            var value = values[i];\n            if (value < this.min) {\n                this.min = Math.floor(value);\n                updated = true;\n            }\n            if (value > this.max) {\n                this.max = Math.ceil(value);\n                updated = true;\n            }\n        }\n        return updated;\n    },\n    /**\n     * Update filter's slider.\n     */\n    update_ui_elt: function() {\n        // Only show filter if min < max because filter is not useful otherwise. This\n        // covers all corner cases, such as when min, max have not been defined and\n        // when min == max.\n        if (this.min < this.max) {\n            this.parent_div.show();\n        } else {\n            this.parent_div.hide();\n        }\n\n        var slider_min = this.slider.slider(\"option\", \"min\");\n        var slider_max = this.slider.slider(\"option\", \"max\");\n        if (this.min < slider_min || this.max > slider_max) {\n            // Update slider min, max, step.\n            this.slider.slider(\"option\", \"min\", this.min);\n            this.slider.slider(\"option\", \"max\", this.max);\n            this.slider.slider(\"option\", \"step\", this.get_slider_step(this.min, this.max));\n            // Refresh slider:\n            // TODO: do we want to keep current values or reset to min/max?\n            // Currently we reset values:\n            this.slider.slider(\"option\", \"values\", [this.min, this.max]);\n            // To use the current values.\n            //var values = this.slider.slider( \"option\", \"values\" );\n            //this.slider.slider( \"option\", \"values\", values );\n        }\n    }\n});\n\n/**\n * Manages a set of filters.\n */\nvar FiltersManager = function(track, obj_dict) {\n    this.track = track;\n    this.alpha_filter = null;\n    this.height_filter = null;\n    this.filters = [];\n\n    //\n    // Create HTML.\n    //\n\n    //\n    // Create parent div.\n    //\n    this.parent_div = $(\"<div/>\")\n        .addClass(\"filters\")\n        .hide();\n    // Disable dragging, double clicking, keys on div so that actions on slider do not impact viz.\n    this.parent_div\n        .bind(\"drag\", e => {\n            e.stopPropagation();\n        })\n        .click(e => {\n            e.stopPropagation();\n        })\n        .bind(\"dblclick\", e => {\n            e.stopPropagation();\n        })\n        .bind(\"keydown\", e => {\n            e.stopPropagation();\n        });\n\n    //\n    // Restore state from dict.\n    //\n    if (obj_dict && \"filters\" in obj_dict) {\n        // Second condition needed for backward compatibility.\n        var alpha_filter_name = \"alpha_filter\" in obj_dict ? obj_dict.alpha_filter : null;\n\n        var height_filter_name = \"height_filter\" in obj_dict ? obj_dict.height_filter : null;\n\n        var filters_dict = obj_dict.filters;\n        var filter;\n        for (var i = 0; i < filters_dict.length; i++) {\n            if (filters_dict[i].type === \"number\") {\n                filter = new NumberFilter(filters_dict[i]);\n                this.add_filter(filter);\n                if (filter.name === alpha_filter_name) {\n                    this.alpha_filter = filter;\n                    filter.transparency_icon.addClass(\"active\").show();\n                }\n                if (filter.name === height_filter_name) {\n                    this.height_filter = filter;\n                    filter.height_icon.addClass(\"active\").show();\n                }\n            } else {\n                console.log(\"ERROR: unsupported filter: \", name, type);\n            }\n        }\n\n        if (\"visible\" in obj_dict && obj_dict.visible) {\n            this.parent_div.show();\n        }\n    }\n\n    // Add button to filter complete dataset.\n    if (this.filters.length !== 0) {\n        var run_buttons_row = $(\"<div/>\")\n            .addClass(\"param-row\")\n            .appendTo(this.parent_div);\n        var run_on_dataset_button = $(\"<input type='submit'/>\")\n            .attr(\"value\", \"Run on complete dataset\")\n            .appendTo(run_buttons_row);\n        var filter_manager = this;\n        run_on_dataset_button.click(() => {\n            filter_manager.run_on_dataset();\n        });\n    }\n};\n\nextend(FiltersManager.prototype, {\n    // HTML manipulation and inspection.\n    show: function() {\n        this.parent_div.show();\n    },\n    hide: function() {\n        this.parent_div.hide();\n    },\n    toggle: function() {\n        this.parent_div.toggle();\n    },\n    visible: function() {\n        return this.parent_div.is(\":visible\");\n    },\n    /**\n     * Returns dictionary for manager.\n     */\n    to_dict: function() {\n        var obj_dict = {};\n        var filter_dicts = [];\n        var filter;\n\n        // Include individual filter states.\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            filter_dicts.push(filter.to_dict());\n        }\n        obj_dict.filters = filter_dicts;\n\n        // Include transparency, height filters.\n        obj_dict.alpha_filter = this.alpha_filter ? this.alpha_filter.name : null;\n        obj_dict.height_filter = this.height_filter ? this.height_filter.name : null;\n\n        // Include visibility.\n        obj_dict.visible = this.parent_div.is(\":visible\");\n\n        return obj_dict;\n    },\n    /**\n     * Return a copy of the manager.\n     */\n    copy: function(new_track) {\n        var copy = new FiltersManager(new_track);\n        for (var i = 0; i < this.filters.length; i++) {\n            copy.add_filter(this.filters[i].copy());\n        }\n        return copy;\n    },\n    /**\n     * Add a filter to the manager.\n     */\n    add_filter: function(filter) {\n        filter.manager = this;\n        this.parent_div.append(filter.parent_div);\n        this.filters.push(filter);\n    },\n    /**\n     * Remove all filters from manager.\n     */\n    remove_all: function() {\n        this.filters = [];\n        this.parent_div.children().remove();\n    },\n    /**\n     * Initialize filters.\n     */\n\n    init_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.update_ui_elt();\n        }\n    },\n    /**\n     * Clear filters so that they do not impact track display.\n     */\n    clear_filters: function() {\n        for (var i = 0; i < this.filters.length; i++) {\n            var filter = this.filters[i];\n            filter.slider.slider(\"option\", \"values\", [filter.min, filter.max]);\n        }\n        this.alpha_filter = null;\n        this.height_filter = null;\n\n        // Hide icons for setting filters.\n        this.parent_div.find(\".icon-button\").hide();\n    },\n    run_on_dataset: function() {\n        // Get or create dictionary item.\n        var get_or_create_dict_item = (dict, key, new_item) => {\n            // Add new item to dict if\n            if (!(key in dict)) {\n                dict[key] = new_item;\n            }\n            return dict[key];\n        };\n\n        //\n        // Find and group active filters. Active filters are those being used to hide data.\n        // Filters with the same tool id are grouped.\n        //\n        var active_filters = {};\n\n        var filter;\n        var tool_filter_conditions;\n        for (var i = 0; i < this.filters.length; i++) {\n            filter = this.filters[i];\n            if (filter.tool_id) {\n                // Add filtering conditions if filter low/high are set.\n                if (filter.min !== filter.low) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} >= ${filter.low}`;\n                }\n                if (filter.max !== filter.high) {\n                    tool_filter_conditions = get_or_create_dict_item(active_filters, filter.tool_id, []);\n                    tool_filter_conditions[tool_filter_conditions.length] = `${filter.tool_exp_name} <= ${filter.high}`;\n                }\n            }\n        }\n\n        //\n        // Use tools to run filters.\n        //\n\n        // Create list of (tool_id, tool_filters) tuples.\n        var active_filters_list = [];\n        for (var tool_id in active_filters) {\n            active_filters_list[active_filters_list.length] = [tool_id, active_filters[tool_id]];\n        }\n\n        // Invoke recursive function to run filters; this enables chaining of filters via\n        // iteratively application.\n        (function run_filter(input_dataset_id, filters) {\n            var // Set up filtering info and params.\n            filter_tuple = filters[0];\n\n            var tool_id = filter_tuple[0];\n            var tool_filters = filter_tuple[1];\n            var tool_filter_str = `(${tool_filters.join(\") and (\")})`;\n\n            var url_params = {\n                cond: tool_filter_str,\n                input: input_dataset_id,\n                target_dataset_id: input_dataset_id,\n                tool_id: tool_id\n            };\n\n            // Remove current filter.\n            filters = filters.slice(1);\n\n            $.getJSON(run_tool_url, url_params, response => {\n                if (response.error) {\n                    // General error.\n                    Galaxy.modal.show({\n                        title: \"Filter Dataset\",\n                        body: `Error running tool ${tool_id}`,\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else if (filters.length === 0) {\n                    // No more filters to run.\n                    Galaxy.modal.show({\n                        title: \"Filtering Dataset\",\n                        body: \"Filter(s) are running on the complete dataset. Outputs are in dataset's history.\",\n                        buttons: { Close: Galaxy.modal.hide() }\n                    });\n                } else {\n                    // More filters to run.\n                    run_filter(response.dataset_id, filters);\n                }\n            });\n        })(this.track.dataset_id, active_filters_list);\n    }\n});\n\nexport default {\n    FiltersManager: FiltersManager,\n    NumberFilter: NumberFilter\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/trackster/filters.js","import visualization from \"viz/visualization\";\nimport * as bigwig from \"libs/bbi/bigwig\";\n/**\n * Data manager for BBI datasets/files, including BigWig and BigBed.\n */\nvar BBIDataManager = visualization.GenomeDataManager.extend({\n    /**\n     * Load data from server and manage data entries. Adds a Deferred to manager\n     * for region; when data becomes available, replaces Deferred with data.\n     * Returns the Deferred that resolves when data is available.\n     */\n    load_data: function(region, mode, resolution, extra_params) {\n        var deferred = $.Deferred();\n        this.set_data(region, deferred);\n\n        var url = `${Galaxy.root}datasets/${this.get(\"dataset\").id}/display`;\n\n        var self = this;\n        var promise = new $.Deferred();\n        $.when(bigwig.makeBwg(url)).then((bb, err) => {\n            $.when(bb.readWigData(region.get(\"chrom\"), region.get(\"start\"), region.get(\"end\"))).then(data => {\n                // Transform data into \"bigwig\" format for LinePainter. \"bigwig\" format is an array of 2-element arrays\n                // where each element is [position, score]; unlike real bigwig format, no gaps are allowed.\n                var result = [];\n\n                var prev = { max: Number.MIN_VALUE };\n                data.forEach(d => {\n                    // If there is a gap between prev and d, fill it with an interval with score 0.\n                    // This is necessary for LinePainter to draw correctly.\n                    if (prev.max !== d.min - 1) {\n                        // +1 to start after previous region.\n                        result.push([prev.max + 1, 0]);\n                        // -2 = -1 for converting from 1-based to 0-based coordinates,\n                        //      -1 for ending before current region.\n                        result.push([d.min - 2, 0]);\n                    }\n\n                    // Add data point for entry start. -1 to convert from wiggle\n                    // 1-based coordinates to 0-based browser coordinates.\n                    result.push([d.min - 1, d.score]);\n\n                    // Add data point for entry end:\n                    result.push([d.max, d.score]);\n\n                    prev = d;\n                });\n\n                var entry = {\n                    data: result,\n                    region: region,\n                    dataset_type: \"bigwig\"\n                };\n\n                self.set_data(region, entry);\n                deferred.resolve(entry);\n            });\n        });\n\n        return deferred;\n    }\n});\n\nexport default {\n    BBIDataManager: BBIDataManager\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/viz/bbi-data-manager.js","//\n// Author: Jeremy Goecks\n//\n// Modified from:\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// bigwig.js: indexed binary WIG (and BED) files\n//\n\n// Requirements:\n//  * jquery and ajax-native plugin for reading binary data, jquery for promises\n//  * spans for working working with genomic intervals\n//  * jszlib for decompression.\ndefine([\"libs/bbi/spans\", \"libs/bbi/jszlib\", \"libs/bbi/jquery-ajax-native\"], function(spans, jszlib) {\n    \"use strict\";\n\n    // -- Copied from das.js --\n\n    function DASFeature() {\n    }\n\n    function DASGroup(id) {\n        if (id)\n        this.id = id;\n    }\n\n    // -- End copy --\n\n    // -- Copied from bin.js --\n\n    function readInt(ba, offset) {\n        return (ba[offset + 3] << 24) | (ba[offset + 2] << 16) | (ba[offset + 1] << 8) | (ba[offset]);\n    }\n\n    // -- End copy --\n\n    // Some globals.\n    var Range = spans.Range;\n    var union = spans.union;\n    var intersection = spans.intersection;\n\n    var jszlib_inflate_buffer = jszlib.inflateBuffer;\n    var arrayCopy = jszlib.arrayCopy;\n\n    var BIG_WIG_MAGIC = 0x888FFC26;\n    var BIG_WIG_MAGIC_BE = 0x26FC8F88;\n    var BIG_BED_MAGIC = 0x8789F2EB;\n    var BIG_BED_MAGIC_BE = 0xEBF28987;\n\n\n    var BIG_WIG_TYPE_GRAPH = 1;\n    var BIG_WIG_TYPE_VSTEP = 2;\n    var BIG_WIG_TYPE_FSTEP = 3;\n\n    var M1 = 256;\n    var M2 = 256*256;\n    var M3 = 256*256*256;\n    var M4 = 256*256*256*256;\n\n    var BED_COLOR_REGEXP = new RegExp(\"^[0-9]+,[0-9]+,[0-9]+\");\n\n    /**\n     * Read binary data from a URL using HTTP Range header. Requires jQuery and ajax-native plugin.\n     */\n    function read(url, start, size) {\n        // Taken from bin.js:\n        // This may be necessary for Safari:\n        //   if ((isSafari || this.opts.salt) && url.indexOf('?') < 0) {\n        //       url = url + '?salt=' + b64_sha1('' + Date.now() + ',' + (++seed));\n        //   }\n\n        var chunkSizeLimit = Math.pow(10, 6); // 1 MB\n        if(size > chunkSizeLimit) {\n            // TODO: raise error.\n        }\n\n        // Read data from remote file.\n        return $.ajax({\n            type: 'GET',\n            dataType: 'native',\n            url: url,\n            // Potential timeout on first request to catch mixed-content errors on Chromium.\n            timeout: 5000,\n            beforeSend: function(xhrObj) {\n                // (size - 1) because range is inclusive.\n                xhrObj.setRequestHeader(\"Range\", \"bytes=\" + start + \"-\" + (start + (size - 1)));\n            },\n            xhrFields: {\n                responseType: 'arraybuffer'\n            }\n        });\n    }\n\n    function bwg_readOffset(ba, o) {\n        var offset = ba[o] + ba[o+1]*M1 + ba[o+2]*M2 + ba[o+3]*M3 + ba[o+4]*M4;\n        return offset;\n    }\n\n    function BigWig() {\n    }\n\n    /**\n     * Read the chromosome B+ tree header.\n     */\n    BigWig.prototype.readChromTree = function() {\n        var thisB = this;\n        this.chromsToIDs = {};\n        this.idsToChroms = {};\n        this.maxID = 0;\n\n        var udo = this.unzoomedDataOffset;\n        var eb = (udo - this.chromTreeOffset) & 3;\n        udo = udo + 4 - eb;\n\n        // Read and parse the chrom tree, return the promise so that subsequent actions can be taken.\n        return $.when(read(this.url, this.chromTreeOffset, udo - this.chromTreeOffset)).then(function(bpt) {\n            var ba = new Uint8Array(bpt);\n            var sa = new Int16Array(bpt);\n            var la = new Int32Array(bpt);\n            var bptMagic = la[0];\n            var blockSize = la[1];\n            var keySize = la[2];\n            var valSize = la[3];\n            var itemCount = bwg_readOffset(ba, 16);\n            var rootNodeOffset = 32;\n\n            var bptReadNode = function(offset) {\n                var nodeType = ba[offset];\n                var cnt = sa[(offset/2) + 1];\n                offset += 4;\n                for (var n = 0; n < cnt; ++n) {\n                    if (nodeType === 0) {\n                        offset += keySize;\n                        var childOffset = bwg_readOffset(ba, offset);\n                        offset += 8;\n                        childOffset -= thisB.chromTreeOffset;\n                        bptReadNode(childOffset);\n                    } else {\n                        var key = '';\n                        for (var ki = 0; ki < keySize; ++ki) {\n                            var charCode = ba[offset++];\n                            if (charCode !== 0) {\n                                key += String.fromCharCode(charCode);\n                            }\n                        }\n                        var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n                        var chromSize = (ba[offset + 7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n                        offset += 8;\n\n                        thisB.chromsToIDs[key] = chromId;\n                        if (key.indexOf('chr') === 0) {\n                            thisB.chromsToIDs[key.substr(3)] = chromId;\n                        }\n                        thisB.idsToChroms[chromId] = key;\n                        thisB.maxID = Math.max(thisB.maxID, chromId);\n                    }\n                }\n            };\n            bptReadNode(rootNodeOffset);\n        });\n    }\n\n    function BigWigView(bwg, cirTreeOffset, cirTreeLength, isSummary) {\n        this.bwg = bwg;\n        this.cirTreeOffset = cirTreeOffset;\n        this.cirTreeLength = cirTreeLength;\n        this.isSummary = isSummary;\n    }\n\n\n\n    BigWigView.prototype.readWigData = function(chrName, min, max) {\n        var chr = this.bwg.chromsToIDs[chrName],\n            rval;\n        if (chr === undefined) {\n            // Not an error because some .bwgs won't have data for all chromosomes.\n            rval = [];\n        } else {\n            rval = this.readWigDataById(chr, min, max);\n        }\n\n        return rval;\n    };\n\n    BigWigView.prototype.readWigDataById = function(chr, min, max) {\n        var thisB = this,\n            promise = $.Deferred();\n\n        // Read the R-tree index header and then read data again.\n        if (!this.cirHeader) {\n            $.when(read(thisB.bwg.url, this.cirTreeOffset, 48)).then(function(result) {\n                thisB.cirHeader = result;\n                var la = new Int32Array(thisB.cirHeader);\n                thisB.cirBlockSize = la[1];\n                $.when(thisB.readWigDataById(chr, min, max)).then(function(result) {\n                    promise.resolve(result);\n                });\n            });\n            return promise;\n        }\n\n        var blocksToFetch = [];\n        var outstanding = 0;\n\n        var beforeBWG = Date.now();\n\n        var filter = function(chromId, fmin, fmax, toks) {\n            return ((chr < 0 || chromId == chr) && fmin <= max && fmax >= min);\n        };\n\n        var cirFobRecur = function(offset, level) {\n            if (thisB.bwg.instrument)\n            console.log('level=' + level + '; offset=' + offset + '; time=' + (Date.now()|0));\n\n            outstanding += offset.length;\n\n            if (offset.length == 1 && offset[0] - thisB.cirTreeOffset == 48 && thisB.cachedCirRoot) {\n                cirFobRecur2(thisB.cachedCirRoot, 0, level);\n                --outstanding;\n                if (outstanding === 0) {\n                    $.when(thisB.fetchFeatures(filter, blocksToFetch)).then(function(result) {\n                        promise.resolve(result);\n                    });\n                }\n                return;\n            }\n\n            var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n            var spans;\n            for (var i = 0; i < offset.length; ++i) {\n                var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n                spans = spans ? union(spans, blockSpan) : blockSpan;\n            }\n\n            var fetchRanges = spans.ranges();\n            for (var r = 0; r < fetchRanges.length; ++r) {\n                var fr = fetchRanges[r];\n                cirFobStartFetch(offset, fr, level);\n            }\n        };\n\n        var cirFobStartFetch = function(offset, fr, level, attempts) {\n            var length = fr.max() - fr.min();\n            $.when(read(thisB.bwg.url, fr.min(), fr.max() - fr.min())).then(function(resultBuffer) {\n                for (var i = 0; i < offset.length; ++i) {\n                    if (fr.contains(offset[i])) {\n                        cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n\n                        if (offset[i] - thisB.cirTreeOffset == 48 && offset[i] - fr.min() === 0)\n                            thisB.cachedCirRoot = resultBuffer;\n\n                        --outstanding;\n                        if (outstanding === 0) {\n                            $.when(thisB.fetchFeatures(filter, blocksToFetch)).then(function(result) {\n                                promise.resolve(result);\n                            });\n                        }\n                    }\n                }\n            });\n        };\n\n        var cirFobRecur2 = function(cirBlockData, offset, level) {\n            var ba = new Uint8Array(cirBlockData);\n            var sa = new Int16Array(cirBlockData);\n            var la = new Int32Array(cirBlockData);\n\n            var isLeaf = ba[offset];\n            var cnt = sa[offset/2 + 1];\n            offset += 4;\n\n            if (isLeaf !== 0) {\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    var blockSize = bwg_readOffset(ba, offset+24);\n                    if (((chr < 0 || startChrom < chr) || (startChrom == chr && startBase <= max)) &&\n                    ((chr < 0 || endChrom   > chr) || (endChrom == chr && endBase >= min)))\n                    {\n                        blocksToFetch.push({offset: blockOffset, size: blockSize});\n                    }\n                    offset += 32;\n                }\n            } else {\n                var recurOffsets = [];\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    if ((chr < 0 || startChrom < chr || (startChrom == chr && startBase <= max)) &&\n                    (chr < 0 || endChrom   > chr || (endChrom == chr && endBase >= min)))\n                    {\n                        recurOffsets.push(blockOffset);\n                    }\n                    offset += 24;\n                }\n                if (recurOffsets.length > 0) {\n                    cirFobRecur(recurOffsets, level + 1);\n                }\n            }\n        };\n\n        cirFobRecur([thisB.cirTreeOffset + 48], 1);\n        return promise;\n    };\n\n    /**\n     * Fetch data for a set of blocks. Returns a promise that resolves to fetched data.\n     */\n    BigWigView.prototype.fetchFeatures = function(filter, blocksToFetch) {\n        var thisB = this,\n            promise = $.Deferred();\n\n        blocksToFetch.sort(function(b0, b1) {\n            return (b0.offset|0) - (b1.offset|0);\n        });\n\n        if (blocksToFetch.length === 0) {\n            return [];\n        } else {\n            var features = [];\n            var createFeature = function(chr, fmin, fmax, opts) {\n                if (!opts) {\n                    opts = {};\n                }\n\n                var f = new DASFeature();\n                f._chromId = chr;\n                f.segment = thisB.bwg.idsToChroms[chr];\n                f.min = fmin;\n                f.max = fmax;\n                f.type = thisB.bwg.type;\n\n                for (var k in opts) {\n                    f[k] = opts[k];\n                }\n\n                features.push(f);\n            };\n\n            // Recursive function to read blocks of data.\n            var tramp = function() {\n                if (blocksToFetch.length === 0) {\n                    var afterBWG = Date.now();\n                    // dlog('BWG fetch took ' + (afterBWG - beforeBWG) + 'ms');\n                    return promise.resolve(features);\n                }\n                else {\n                    var block = blocksToFetch[0];\n                    if (block.data) {\n                        thisB.parseFeatures(block.data, createFeature, filter);\n                        blocksToFetch.splice(0, 1);\n                        tramp();\n                    }\n                    else {\n                        var fetchStart = block.offset;\n                        var fetchSize = block.size;\n                        var bi = 1;\n                        while (bi < blocksToFetch.length && blocksToFetch[bi].offset == (fetchStart + fetchSize)) {\n                            fetchSize += blocksToFetch[bi].size;\n                            ++bi;\n                        }\n\n                        $.when(read(thisB.bwg.url, fetchStart, fetchSize)).then(function(result) {\n                            var offset = 0;\n                            var bi = 0;\n                            while (offset < fetchSize) {\n                                var fb = blocksToFetch[bi];\n\n                                var data;\n                                if (thisB.bwg.uncompressBufSize > 0) {\n                                    data = jszlib_inflate_buffer(result, offset + 2, fb.size - 2);\n                                } else {\n                                    var tmp = new Uint8Array(fb.size);    // FIXME is this really the best we can do?\n                                    arrayCopy(new Uint8Array(result, offset, fb.size), 0, tmp, 0, fb.size);\n                                    data = tmp.buffer;\n                                }\n                                fb.data = data;\n\n                                offset += fb.size;\n                                ++bi;\n                            }\n                            tramp();\n                        });\n                    }\n                }\n            };\n            tramp();\n        }\n\n        return promise;\n    };\n\n    BigWigView.prototype.parseFeatures = function(data, createFeature, filter) {\n        var ba = new Uint8Array(data);\n\n        if (this.isSummary) {\n            var sa = new Int16Array(data);\n            var la = new Int32Array(data);\n            var fa = new Float32Array(data);\n\n            var itemCount = data.byteLength/32;\n            for (var i = 0; i < itemCount; ++i) {\n                var chromId =   la[(i*8)];\n                var start =     la[(i*8)+1];\n                var end =       la[(i*8)+2];\n                var validCnt =  la[(i*8)+3];\n                var minVal    = fa[(i*8)+4];\n                var maxVal    = fa[(i*8)+5];\n                var sumData   = fa[(i*8)+6];\n                var sumSqData = fa[(i*8)+7];\n\n                if (filter(chromId, start + 1, end)) {\n                    var summaryOpts = {type: 'bigwig', score: sumData/validCnt, maxScore: maxVal};\n                    if (this.bwg.type == 'bigbed') {\n                        summaryOpts.type = 'density';\n                    }\n                    createFeature(chromId, start + 1, end, summaryOpts);\n                }\n            }\n        }\n        else if (this.bwg.type == 'bigwig') {\n            var sa = new Int16Array(data);\n            var la = new Int32Array(data);\n            var fa = new Float32Array(data);\n\n            var chromId = la[0];\n            var blockStart = la[1];\n            var blockEnd = la[2];\n            var itemStep = la[3];\n            var itemSpan = la[4];\n            var blockType = ba[20];\n            var itemCount = sa[11];\n\n            if (blockType == BIG_WIG_TYPE_FSTEP) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var score = fa[i + 6];\n                    var fmin = blockStart + (i*itemStep) + 1, fmax = blockStart + (i*itemStep) + itemSpan;\n                    if (filter(chromId, fmin, fmax))\n                    createFeature(chromId, fmin, fmax, {score: score});\n                }\n            } else if (blockType == BIG_WIG_TYPE_VSTEP) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var start = la[(i*2) + 6] + 1;\n                    var end = start + itemSpan - 1;\n                    var score = fa[(i*2) + 7];\n                    if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n                }\n            } else if (blockType == BIG_WIG_TYPE_GRAPH) {\n                for (var i = 0; i < itemCount; ++i) {\n                    var start = la[(i*3) + 6] + 1;\n                    var end   = la[(i*3) + 7];\n                    var score = fa[(i*3) + 8];\n                    if (start > end) {\n                        start = end;\n                    }\n                    if (filter(chromId, start, end))\n                    createFeature(chromId, start, end, {score: score});\n                }\n            } else {\n                console.log('Currently not handling bwgType=' + blockType);\n            }\n        } else if (this.bwg.type == 'bigbed') {\n            var offset = 0;\n            var dfc = this.bwg.definedFieldCount;\n            var schema = this.bwg.schema;\n\n            while (offset < ba.length) {\n                var chromId = (ba[offset+3]<<24) | (ba[offset+2]<<16) | (ba[offset+1]<<8) | (ba[offset+0]);\n                var start = (ba[offset+7]<<24) | (ba[offset+6]<<16) | (ba[offset+5]<<8) | (ba[offset+4]);\n                var end = (ba[offset+11]<<24) | (ba[offset+10]<<16) | (ba[offset+9]<<8) | (ba[offset+8]);\n                offset += 12;\n                var rest = '';\n                while (true) {\n                    var ch = ba[offset++];\n                    if (ch != 0) {\n                        rest += String.fromCharCode(ch);\n                    } else {\n                        break;\n                    }\n                }\n\n                var featureOpts = {};\n\n                var bedColumns;\n                if (rest.length > 0) {\n                    bedColumns = rest.split('\\t');\n                } else {\n                    bedColumns = [];\n                }\n                if (bedColumns.length > 0 && dfc > 3) {\n                    featureOpts.label = bedColumns[0];\n                }\n                if (bedColumns.length > 1 && dfc > 4) {\n                    var score = parseInt(bedColumns[1]);\n                    if (!isNaN(score))\n                    featureOpts.score = score;\n                }\n                if (bedColumns.length > 2 && dfc > 5) {\n                    featureOpts.orientation = bedColumns[2];\n                }\n                if (bedColumns.length > 5 && dfc > 8) {\n                    var color = bedColumns[5];\n                    if (BED_COLOR_REGEXP.test(color)) {\n                        featureOpts.itemRgb = 'rgb(' + color + ')';\n                    }\n                }\n\n                if (bedColumns.length > dfc-3 && schema) {\n                    for (var col = dfc - 3; col < bedColumns.length; ++col) {\n                        featureOpts[schema.fields[col+3].name] = bedColumns[col];\n                    }\n                }\n\n                if (filter(chromId, start + 1, end, bedColumns)) {\n                    if (dfc < 12) {\n                        createFeature(chromId, start + 1, end, featureOpts);\n                    } else {\n                        // TODO: add block starts, sizes, thick start, thick end to feature.\n                        var thickStart = bedColumns[3]|0;\n                        var thickEnd   = bedColumns[4]|0;\n                        var blockCount = bedColumns[6]|0;\n                        var blockSizes = bedColumns[7].split(',');\n                        var blockStarts = bedColumns[8].split(',');\n\n                        if (featureOpts.exonFrames) {\n                            var exonFrames = featureOpts.exonFrames.split(',');\n                            featureOpts.exonFrames = undefined;\n                        }\n\n                        featureOpts.type = 'transcript'\n                        var grp = new DASGroup();\n                        for (var k in featureOpts) {\n                            grp[k] = featureOpts[k];\n                        }\n                        grp.id = bedColumns[0];\n                        grp.segment = this.bwg.idsToChroms[chromId];\n                        grp.min = start + 1;\n                        grp.max = end;\n                        grp.notes = [];\n                        featureOpts.groups = [grp];\n\n                        // Moving towards using bigGenePred model, but will\n                        // still support old Dalliance-style BED12+gene-name for the\n                        // foreseeable future.\n                        if (bedColumns.length > 9) {\n                            var geneId = featureOpts.geneName || bedColumns[9];\n                            var geneName = geneId;\n                            if (bedColumns.length > 10) {\n                                geneName = bedColumns[10];\n                            }\n                            if (featureOpts.geneName2)\n                            geneName = featureOpts.geneName2;\n\n                            var gg = $.extend({}, grp);\n                            gg.id = geneId;\n                            gg.label = geneName;\n                            gg.type = 'gene';\n                            featureOpts.groups.push(gg);\n                        }\n\n                        var spanList = [];\n                        for (var b = 0; b < blockCount; ++b) {\n                            var bmin = (blockStarts[b]|0) + start;\n                            var bmax = bmin + (blockSizes[b]|0);\n                            var span = new Range(bmin, bmax);\n                            spanList.push(span);\n                        }\n                        var spans = union(spanList);\n\n                        var tsList = spans.ranges();\n                        for (var s = 0; s < tsList.length; ++s) {\n                            var ts = tsList[s];\n                            createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                        }\n\n                        if (thickEnd > thickStart) {\n                            var codingRegion = (featureOpts.orientation == '+') ?\n                            new Range(thickStart, thickEnd + 3) :\n                            new Range(thickStart - 3, thickEnd);\n                            // +/- 3 to account for stop codon\n\n                            var tl = intersection(spans, codingRegion);\n                            if (tl) {\n                                featureOpts.type = 'translation';\n                                var tlList = tl.ranges();\n                                var readingFrame = 0;\n\n                                var tlOffset = 0;\n                                while (tlList[0].min() > tsList[tlOffset].max())\n                                tlOffset++;\n\n                                for (var s = 0; s < tlList.length; ++s) {\n                                    // Record reading frame for every exon\n                                    var index = s;\n                                    if (featureOpts.orientation == '-')\n                                    index = tlList.length - s - 1;\n                                    var ts = tlList[index];\n                                    featureOpts.readframe = readingFrame;\n                                    if (exonFrames) {\n                                        var brf = parseInt(exonFrames[index + tlOffset]);\n                                        if (typeof(brf) === 'number' && brf >= 0 && brf <= 2) {\n                                            featureOpts.readframe = brf;\n                                            featureOpts.readframeExplicit = true;\n                                        }\n                                    }\n                                    var length = ts.max() - ts.min();\n                                    readingFrame = (readingFrame + length) % 3;\n                                    createFeature(chromId, ts.min() + 1, ts.max(), featureOpts);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        } else {\n            throw Error(\"Don't know what to do with \" + this.bwg.type);\n        }\n    }\n\n    //\n    // nasty cut/paste, should roll back in!\n    //\n\n    BigWigView.prototype.getFirstAdjacent = function(chrName, pos, dir, callback) {\n        var chr = this.bwg.chromsToIDs[chrName];\n        if (chr === undefined) {\n            // Not an error because some .bwgs won't have data for all chromosomes.\n            return callback([]);\n        } else {\n            this.getFirstAdjacentById(chr, pos, dir, callback);\n        }\n    }\n\n    BigWigView.prototype.getFirstAdjacentById = function(chr, pos, dir, callback) {\n        var thisB = this;\n        if (!this.cirHeader) {\n            this.bwg.data.slice(this.cirTreeOffset, 48).fetch(function(result) {\n                thisB.cirHeader = result;\n                var la = new Int32Array(thisB.cirHeader);\n                thisB.cirBlockSize = la[1];\n                thisB.getFirstAdjacentById(chr, pos, dir, callback);\n            });\n            return;\n        }\n\n        var blockToFetch = null;\n        var bestBlockChr = -1;\n        var bestBlockOffset = -1;\n\n        var outstanding = 0;\n\n        var beforeBWG = Date.now();\n\n        var cirFobRecur = function(offset, level) {\n            outstanding += offset.length;\n\n            var maxCirBlockSpan = 4 +  (thisB.cirBlockSize * 32);   // Upper bound on size, based on a completely full leaf node.\n            var spans;\n            for (var i = 0; i < offset.length; ++i) {\n                var blockSpan = new Range(offset[i], offset[i] + maxCirBlockSpan);\n                spans = spans ? union(spans, blockSpan) : blockSpan;\n            }\n\n            var fetchRanges = spans.ranges();\n            for (var r = 0; r < fetchRanges.length; ++r) {\n                var fr = fetchRanges[r];\n                cirFobStartFetch(offset, fr, level);\n            }\n        }\n\n        var cirFobStartFetch = function(offset, fr, level, attempts) {\n            var length = fr.max() - fr.min();\n            thisB.bwg.data.slice(fr.min(), fr.max() - fr.min()).fetch(function(resultBuffer) {\n                for (var i = 0; i < offset.length; ++i) {\n                    if (fr.contains(offset[i])) {\n                        cirFobRecur2(resultBuffer, offset[i] - fr.min(), level);\n                        --outstanding;\n                        if (outstanding == 0) {\n                            if (!blockToFetch) {\n                                if (dir > 0 && (chr != 0 || pos > 0)) {\n                                    return thisB.getFirstAdjacentById(0, 0, dir, callback);\n                                } else if (dir < 0 && (chr != thisB.bwg.maxID || pos < 1000000000)) {\n                                    return thisB.getFirstAdjacentById(thisB.bwg.maxID, 1000000000, dir, callback);\n                                }\n                                return callback([]);\n                            }\n\n                            thisB.fetchFeatures(function(chrx, fmin, fmax, toks) {\n                                return (dir < 0 && (chrx < chr || fmax < pos)) || (dir > 0 && (chrx > chr || fmin > pos));\n                            }, [blockToFetch], function(features) {\n                                var bestFeature = null;\n                                var bestChr = -1;\n                                var bestPos = -1;\n                                for (var fi = 0; fi < features.length; ++fi) {\n                                    var f = features[fi];\n                                    var chrx = f._chromId, fmin = f.min, fmax = f.max;\n                                    if (bestFeature == null || ((dir < 0) && (chrx > bestChr || fmax > bestPos)) || ((dir > 0) && (chrx < bestChr || fmin < bestPos))) {\n                                        bestFeature = f;\n                                        bestPos = (dir < 0) ? fmax : fmin;\n                                        bestChr = chrx;\n                                    }\n                                }\n\n                                if (bestFeature != null)\n                                return callback([bestFeature]);\n                                else\n                                return callback([]);\n                            });\n                        }\n                    }\n                }\n            });\n        }\n\n        var cirFobRecur2 = function(cirBlockData, offset, level) {\n            var ba = new Uint8Array(cirBlockData);\n            var sa = new Int16Array(cirBlockData);\n            var la = new Int32Array(cirBlockData);\n\n            var isLeaf = ba[offset];\n            var cnt = sa[offset/2 + 1];\n            offset += 4;\n\n            if (isLeaf != 0) {\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = bwg_readOffset(ba, offset+16);\n                    var blockSize = bwg_readOffset(ba, offset+24);\n                    if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)))) ||\n                    (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)))))\n                    {\n                        // console.log('Got an interesting block: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                        if (/_random/.exec(thisB.bwg.idsToChroms[startChrom])) {\n                            // dlog('skipping random: ' + thisB.bwg.idsToChroms[startChrom]);\n                        } else if (blockToFetch == null || ((dir < 0) && (endChrom > bestBlockChr || (endChrom == bestBlockChr && endBase > bestBlockOffset)) ||\n                        (dir > 0) && (startChrom < bestBlockChr || (startChrom == bestBlockChr && startBase < bestBlockOffset))))\n                        {\n                            //                        dlog('best is: startBase=' + startChrom + ':' + startBase + '; endBase=' + endChrom + ':' + endBase + '; offset=' + blockOffset + '; size=' + blockSize);\n                            blockToFetch = {offset: blockOffset, size: blockSize};\n                            bestBlockOffset = (dir < 0) ? endBase : startBase;\n                            bestBlockChr = (dir < 0) ? endChrom : startChrom;\n                        }\n                    }\n                    offset += 32;\n                }\n            } else {\n                var bestRecur = -1;\n                var bestPos = -1;\n                var bestChr = -1;\n                for (var i = 0; i < cnt; ++i) {\n                    var lo = offset/4;\n                    var startChrom = la[lo];\n                    var startBase = la[lo + 1];\n                    var endChrom = la[lo + 2];\n                    var endBase = la[lo + 3];\n                    var blockOffset = (la[lo + 4]<<32) | (la[lo + 5]);\n                    if ((dir < 0 && ((startChrom < chr || (startChrom == chr && startBase <= pos)) &&\n                    (endChrom   >= chr))) ||\n                    (dir > 0 && ((endChrom > chr || (endChrom == chr && endBase >= pos)) &&\n                    (startChrom <= chr))))\n                    {\n                        if (bestRecur < 0 || endBase > bestPos) {\n                            bestRecur = blockOffset;\n                            bestPos = (dir < 0) ? endBase : startBase;\n                            bestChr = (dir < 0) ? endChrom : startChrom;\n                        }\n                    }\n                    offset += 24;\n                }\n                if (bestRecur >= 0) {\n                    cirFobRecur([bestRecur], level + 1);\n                }\n            }\n        };\n\n\n        cirFobRecur([thisB.cirTreeOffset + 48], 1);\n    }\n\n    /**\n    * Automatically choose a zoom level and return data from that level.\n    */\n    BigWig.prototype.readWigData = function(chrName, min, max) {\n        // Maximum number of data points to return when reading a bigwig. This is used\n        // to choose the appropriate level. One data point ~= 25-65 bytes.\n        // FIXME: For targeted sequencing, data points returned is going to be much lower,\n        // so this will need to be tuned appropriately.\n        var MAX_DATA_POINTS = 25000;\n\n        var range = max - min,\n        view;\n        // If no zooming needed or available (common in bigbed), use unzoomed view.\n        if (range <= MAX_DATA_POINTS || this.zoomLevels.length === 0) {\n            view = this.getUnzoomedView();\n        }\n        else {\n            // Find reasonable zoom level. Reduction is the # of bases represented\n            // by each data point at that level.\n            for (var i = 0; i < this.zoomLevels.length; i++) {\n                if (range/this.zoomLevels[i].reduction < MAX_DATA_POINTS) {\n                    view = this.getZoomedView(i);\n                    break;\n                }\n            }\n        }\n\n        return view.readWigData(chrName, min, max);\n    }\n\n    BigWig.prototype.getUnzoomedView = function() {\n        if (!this.unzoomedView) {\n            var cirLen = 4000;\n            var nzl = this.zoomLevels[0];\n            if (nzl) {\n                cirLen = this.zoomLevels[0].dataOffset - this.unzoomedIndexOffset;\n            }\n            this.unzoomedView = new BigWigView(this, this.unzoomedIndexOffset, cirLen, false);\n        }\n        return this.unzoomedView;\n    }\n\n    BigWig.prototype.getZoomedView = function(z) {\n        var zh = this.zoomLevels[z];\n        if (!zh.view) {\n            zh.view = new BigWigView(this, zh.indexOffset, /* this.zoomLevels[z + 1].dataOffset - zh.indexOffset */ 4000, true);\n        }\n        return zh.view;\n    }\n\n    /**\n     * Create a BigWig object using a URL to a bigwig/bigbed file. Returns a promise\n     * that resolves to the object when it's available.\n     */\n    function makeBwg(url) {\n        var promise = $.Deferred(),\n        bwg = new BigWig();\n        bwg.url = url;\n\n        // Read and parse bigwig header, including chrom tree.\n        $.when(read(bwg.url, 0, 512)).then(function(result) {\n            if (!result) {\n                return promise.resolve(null, \"Couldn't fetch file\");\n            }\n\n            var header = result;\n            var ba = new Uint8Array(header);\n            var sa = new Int16Array(header);\n            var la = new Int32Array(header);\n            var magic = ba[0] + (M1 * ba[1]) + (M2 * ba[2]) + (M3 * ba[3]);\n            if (magic == BIG_WIG_MAGIC) {\n                bwg.type = 'bigwig';\n            } else if (magic == BIG_BED_MAGIC) {\n                bwg.type = 'bigbed';\n            } else if (magic == BIG_WIG_MAGIC_BE || magic == BIG_BED_MAGIC_BE) {\n                return promise.resolve(null, \"Currently don't support big-endian BBI files\");\n\n            } else {\n                return promise.resolve(null, \"Not a supported format, magic=0x\" + magic.toString(16));\n\n            }\n\n            bwg.version = sa[2];             // 4\n            bwg.numZoomLevels = sa[3];       // 6\n            bwg.chromTreeOffset = bwg_readOffset(ba, 8);\n            bwg.unzoomedDataOffset = bwg_readOffset(ba, 16);\n            bwg.unzoomedIndexOffset = bwg_readOffset(ba, 24);\n            bwg.fieldCount = sa[16];         // 32\n            bwg.definedFieldCount = sa[17];  // 34\n            bwg.asOffset = bwg_readOffset(ba, 36);\n            bwg.totalSummaryOffset = bwg_readOffset(ba, 44);\n            bwg.uncompressBufSize = la[13];  // 52\n            bwg.extHeaderOffset = bwg_readOffset(ba, 56);\n\n            bwg.zoomLevels = [];\n            for (var zl = 0; zl < bwg.numZoomLevels; ++zl) {\n                var zlReduction = la[zl*6 + 16]\n                var zlData = bwg_readOffset(ba, zl*24 + 72);\n                var zlIndex = bwg_readOffset(ba, zl*24 + 80);\n                bwg.zoomLevels.push({reduction: zlReduction, dataOffset: zlData, indexOffset: zlIndex});\n            }\n\n            $.when(bwg.readChromTree()).then(function() {\n                bwg.getAutoSQL(function(as) {\n                    bwg.schema = as;\n                    return promise.resolve(bwg);\n                });\n            });\n        });\n\n        return promise;\n    }\n\n\n    BigWig.prototype._tsFetch = function(zoom, chr, min, max, callback) {\n        var bwg = this;\n        if (zoom >= this.zoomLevels.length - 1) {\n            if (!this.topLevelReductionCache) {\n                this.getZoomedView(this.zoomLevels.length - 1).readWigDataById(-1, 0, 300000000, function(feats) {\n                    bwg.topLevelReductionCache = feats;\n                    return bwg._tsFetch(zoom, chr, min, max, callback);\n                });\n            } else {\n                var f = [];\n                var c = this.topLevelReductionCache;\n                for (var fi = 0; fi < c.length; ++fi) {\n                    if (c[fi]._chromId == chr) {\n                        f.push(c[fi]);\n                    }\n                }\n                return callback(f);\n            }\n        } else {\n            var view;\n            if (zoom < 0) {\n                view = this.getUnzoomedView();\n            } else {\n                view = this.getZoomedView(zoom);\n            }\n            return view.readWigDataById(chr, min, max, callback);\n        }\n    }\n\n    BigWig.prototype.thresholdSearch = function(chrName, referencePoint, dir, threshold, callback) {\n        dir = (dir<0) ? -1 : 1;\n        var bwg = this;\n        var initialChr = this.chromsToIDs[chrName];\n        var candidates = [{chrOrd: 0, chr: initialChr, zoom: bwg.zoomLevels.length - 4, min: 0, max: 300000000, fromRef: true}]\n        for (var i = 1; i <= this.maxID + 1; ++i) {\n            var chrId = (initialChr + (dir*i)) % (this.maxID + 1);\n            if (chrId < 0)\n            chrId += (this.maxID + 1);\n            candidates.push({chrOrd: i, chr: chrId, zoom: bwg.zoomLevels.length - 1, min: 0, max: 300000000})\n        }\n\n        function fbThresholdSearchRecur() {\n            if (candidates.length == 0) {\n                return callback(null);\n            }\n            candidates.sort(function(c1, c2) {\n                var d = c1.zoom - c2.zoom;\n                if (d != 0)\n                return d;\n\n                d = c1.chrOrd - c2.chrOrd;\n                if (d != 0)\n                return d;\n                else\n                return c1.min - c2.min * dir;\n            });\n\n            var candidate = candidates.splice(0, 1)[0];\n            bwg._tsFetch(candidate.zoom, candidate.chr, candidate.min, candidate.max, function(feats) {\n                var rp = dir > 0 ? 0 : 300000000;\n                if (candidate.fromRef)\n                rp = referencePoint;\n\n                for (var fi = 0; fi < feats.length; ++fi) {\n                    var f = feats[fi];\n                    var score;\n                    if (f.maxScore != undefined)\n                    score = f.maxScore;\n                    else\n                    score = f.score;\n\n                    if (dir > 0) {\n                        if (score > threshold) {\n                            if (candidate.zoom < 0) {\n                                if (f.min > rp)\n                                return callback(f);\n                            } else if (f.max > rp) {\n                                candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n                            }\n                        }\n                    } else {\n                        if (score > threshold) {\n                            if (candidate.zoom < 0) {\n                                if (f.max < rp)\n                                return callback(f);\n                            } else if (f.min < rp) {\n                                candidates.push({chr: candidate.chr, chrOrd: candidate.chrOrd, zoom: candidate.zoom - 2, min: f.min, max: f.max, fromRef: candidate.fromRef});\n                            }\n                        }\n                    }\n                }\n                fbThresholdSearchRecur();\n            });\n        }\n\n        fbThresholdSearchRecur();\n    }\n\n    BigWig.prototype.getAutoSQL = function(callback) {\n        var thisB = this;\n        if (!this.asOffset)\n        return callback(null);\n\n        $.when(read(this.url, this.asOffset, 2048)).then(function(result) {\n            var ba = new Uint8Array(result);\n            var s = '';\n            for (var i = 0; i < ba.length; ++i) {\n                if (ba[i] == 0)\n                break;\n                s += String.fromCharCode(ba[i]);\n            }\n\n            /*\n            * Quick'n'dirty attempt to parse autoSql format.\n            * See: http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/059/5949/5949l2.html\n            */\n\n            var header_re = /(\\w+)\\s+(\\w+)\\s+(\"([^\"]+)\")?\\s+\\(\\s*/;\n                var field_re = /([\\w\\[\\]]+)\\s+(\\w+)\\s*;\\s*(\"([^\"]+)\")?\\s*/g;\n\n            var headerMatch = header_re.exec(s);\n            if (headerMatch) {\n                var as = {\n                    declType: headerMatch[1],\n                    name: headerMatch[2],\n                    comment: headerMatch[4],\n\n                    fields: []\n                };\n\n                s = s.substring(headerMatch[0]);\n                for (var m = field_re.exec(s); m != null; m = field_re.exec(s)) {\n                    as.fields.push({type: m[1],\n                        name: m[2],\n                        comment: m[4]});\n                    }\n\n                    return callback(as);\n                }\n        });\n    };\n\n    BigWig.prototype.getExtraIndices = function(callback) {\n        var thisB = this;\n        if (this.version < 4 || this.extHeaderOffset == 0 || this.type != 'bigbed') {\n            return callback(null);\n        } else {\n            this.data.slice(this.extHeaderOffset, 64).fetch(function(result) {\n                if (!result) {\n                    return callback(null, \"Couldn't fetch extension header\");\n                }\n\n                var ba = new Uint8Array(result);\n                var sa = new Int16Array(result);\n                var la = new Int32Array(result);\n\n                var extHeaderSize = sa[0];\n                var extraIndexCount = sa[1];\n                var extraIndexListOffset = bwg_readOffset(ba, 4);\n\n                if (extraIndexCount == 0) {\n                    return callback(null);\n                }\n\n                // FIXME 20byte records only make sense for single-field indices.\n                // Right now, these seem to be the only things around, but the format\n                // is actually more general.\n                thisB.data.slice(extraIndexListOffset, extraIndexCount * 20).fetch(function(eil) {\n                    if (!eil) {\n                        return callback(null, \"Couldn't fetch index info\");\n                    }\n\n                    var ba = new Uint8Array(eil);\n                    var sa = new Int16Array(eil);\n                    var la = new Int32Array(eil);\n\n                    var indices = [];\n                    for (var ii = 0; ii < extraIndexCount; ++ii) {\n                        var eiType = sa[ii*10];\n                        var eiFieldCount = sa[ii*10 + 1];\n                        var eiOffset = bwg_readOffset(ba, ii*20 + 4);\n                        var eiField = sa[ii*10 + 8]\n                        var index = new BBIExtraIndex(thisB, eiType, eiFieldCount, eiOffset, eiField);\n                        indices.push(index);\n                    }\n                    callback(indices);\n                });\n            });\n        }\n    }\n\n    function BBIExtraIndex(bbi, type, fieldCount, offset, field) {\n        this.bbi = bbi;\n        this.type = type;\n        this.fieldCount = fieldCount;\n        this.offset = offset;\n        this.field = field;\n    }\n\n    BBIExtraIndex.prototype.lookup = function(name, callback) {\n        var thisB = this;\n\n        this.bbi.data.slice(this.offset, 32).fetch(function(bpt) {\n            var ba = new Uint8Array(bpt);\n            var sa = new Int16Array(bpt);\n            var la = new Int32Array(bpt);\n            var bptMagic = la[0];\n            var blockSize = la[1];\n            var keySize = la[2];\n            var valSize = la[3];\n            var itemCount = bwg_readOffset(ba, 16);\n            var rootNodeOffset = 32;\n\n            function bptReadNode(nodeOffset) {\n                thisB.bbi.data.slice(nodeOffset, 4 + (blockSize * (keySize + valSize))).fetch(function(node) {\n                    var ba = new Uint8Array(node);\n                    var sa = new Uint16Array(node);\n                    var la = new Uint32Array(node);\n\n                    var nodeType = ba[0];\n                    var cnt = sa[1];\n\n                    var offset = 4;\n                    if (nodeType == 0) {\n                        var lastChildOffset = null;\n                        for (var n = 0; n < cnt; ++n) {\n                            var key = '';\n                            for (var ki = 0; ki < keySize; ++ki) {\n                                var charCode = ba[offset++];\n                                if (charCode != 0) {\n                                    key += String.fromCharCode(charCode);\n                                }\n                            }\n\n                            var childOffset = bwg_readOffset(ba, offset);\n                            offset += 8;\n\n                            if (name.localeCompare(key) < 0 && lastChildOffset) {\n                                bptReadNode(lastChildOffset);\n                                return;\n                            }\n                            lastChildOffset = childOffset;\n                        }\n                        bptReadNode(lastChildOffset);\n                    } else {\n                        for (var n = 0; n < cnt; ++n) {\n                            var key = '';\n                            for (var ki = 0; ki < keySize; ++ki) {\n                                var charCode = ba[offset++];\n                                if (charCode != 0) {\n                                    key += String.fromCharCode(charCode);\n                                }\n                            }\n\n                            // Specific for EI case.\n                            if (key == name) {\n                                var start = bwg_readOffset(ba, offset);\n                                var length = readInt(ba, offset + 8);\n\n                                return thisB.bbi.getUnzoomedView().fetchFeatures(\n                                    function(chr, min, max, toks) {\n                                        if (toks && toks.length > thisB.field - 3)\n                                        return toks[thisB.field - 3] == name;\n                                    },\n                                    [{offset: start, size: length}],\n                                    callback);\n                                }\n                                offset += valSize;\n                            }\n                            return callback([]);\n                        }\n                    });\n                }\n\n                bptReadNode(thisB.offset + rootNodeOffset);\n        });\n    }\n\n    return {\n        makeBwg: makeBwg\n    };\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./galaxy/scripts/libs/bbi/bigwig.js\n// module id = 35\n// module chunks = 0 1 2 3 4","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Dalliance Genome Explorer\n// (c) Thomas Down 2006-2010\n//\n// spans.js: JavaScript Intset/Location port.\n//\n\ndefine([], function() {\n\n\"use strict\";\n\n\nfunction Range(min, max)\n{\n    if (typeof(min) != 'number' || typeof(max) != 'number')\n        throw 'Bad range ' + min + ',' + max;\n    this._min = min;\n    this._max = max;\n}\n\nRange.prototype.min = function() {\n    return this._min;\n}\n\nRange.prototype.max = function() {\n    return this._max;\n}\n\nRange.prototype.contains = function(pos) {\n    return pos >= this._min && pos <= this._max;\n}\n\nRange.prototype.isContiguous = function() {\n    return true;\n}\n\nRange.prototype.ranges = function() {\n    return [this];\n}\n\nRange.prototype._pushRanges = function(ranges) {\n    ranges.push(this);\n}\n\nRange.prototype.toString = function() {\n    return '[' + this._min + '-' + this._max + ']';\n}\n\nfunction _Compound(ranges) {\n    // given: a set of unsorted possibly overlapping ranges\n    // sort the input ranges\n    var sorted = ranges.sort(_rangeOrder);\n    // merge overlaps between adjacent ranges\n    var merged = [];\n    var current = sorted.shift();\n    sorted.forEach(function(range) {\n        if (range._min <= current._max) {\n            if (range._max > current._max) {\n                current._max = range._max;\n            }\n        }\n        else {\n            merged.push(current);\n            current = range;\n        }\n    });\n    merged.push(current);\n    this._ranges = merged;\n}\n\n_Compound.prototype.min = function() {\n    return this._ranges[0].min();\n}\n\n_Compound.prototype.max = function() {\n    return this._ranges[this._ranges.length - 1].max();\n}\n\n// returns the index of the first range that is not less than pos\n_Compound.prototype.lower_bound = function(pos) {\n    // first check if pos is out of range\n    var r = this.ranges();\n    if (pos > this.max()) return r.length;\n    if (pos < this.min()) return 0;\n    // do a binary search\n    var a=0, b=r.length - 1;\n    while (a <= b) {\n        var m = Math.floor((a+b)/2);\n        if (pos > r[m]._max) {\n            a = m+1;\n        }\n        else if (pos < r[m]._min) {\n            b = m-1;\n        }\n        else {\n            return m;\n        }\n    }\n    return a;\n}\n\n_Compound.prototype.contains = function(pos) {\n    var lb = this.lower_bound(pos);\n    if (lb < this._ranges.length && this._ranges[lb].contains(pos)) {\n        return true;\n    }\n    return false;\n}\n\n_Compound.prototype.insertRange = function(range) {\n    var lb = this.lower_bound(range._min);\n    if (lb === this._ranges.length) { // range follows this\n        this._ranges.push(range);\n        return;\n    }\n\n    var r = this.ranges();\n    if (range._max < r[lb]._min) { // range preceeds lb\n        this._ranges.splice(lb,0,range);\n        return;\n    }\n\n    // range overlaps lb (at least)\n    if (r[lb]._min < range._min) range._min = r[lb]._min;\n    var ub = lb+1;\n    while (ub < r.length && r[ub]._min <= range._max) {\n        ub++;\n    }\n    ub--;\n    // ub is the upper bound of the new range\n    if (r[ub]._max > range._max) range._max = r[ub]._max;\n\n    // splice range into this._ranges\n    this._ranges.splice(lb,ub-lb+1,range);\n    return;\n}\n\n_Compound.prototype.isContiguous = function() {\n    return this._ranges.length > 1;\n}\n\n_Compound.prototype.ranges = function() {\n    return this._ranges;\n}\n\n_Compound.prototype._pushRanges = function(ranges) {\n    for (var ri = 0; ri < this._ranges.length; ++ri)\n        ranges.push(this._ranges[ri]);\n}\n\n_Compound.prototype.toString = function() {\n    var s = '';\n    for (var r = 0; r < this._ranges.length; ++r) {\n        if (r>0) {\n            s = s + ',';\n        }\n        s = s + this._ranges[r].toString();\n    }\n    return s;\n}\n\nfunction union(s0, s1) {\n    if (! (s0 instanceof _Compound)) {\n        if (! (s0 instanceof Array))\n            s0 = [s0];\n        s0 = new _Compound(s0);\n    }\n\n    if (s1)\n        s0.insertRange(s1);\n\n    return s0;\n}\n\nfunction intersection(s0, s1) {\n    var r0 = s0.ranges();\n    var r1 = s1.ranges();\n    var l0 = r0.length, l1 = r1.length;\n    var i0 = 0, i1 = 0;\n    var or = [];\n\n    while (i0 < l0 && i1 < l1) {\n        var s0 = r0[i0], s1 = r1[i1];\n        var lapMin = Math.max(s0.min(), s1.min());\n        var lapMax = Math.min(s0.max(), s1.max());\n        if (lapMax >= lapMin) {\n            or.push(new Range(lapMin, lapMax));\n        }\n        if (s0.max() > s1.max()) {\n            ++i1;\n        } else {\n            ++i0;\n        }\n    }\n\n    if (or.length == 0) {\n        return null; // FIXME\n    } else if (or.length == 1) {\n        return or[0];\n    } else {\n        return new _Compound(or);\n    }\n}\n\nfunction coverage(s) {\n    var tot = 0;\n    var rl = s.ranges();\n    for (var ri = 0; ri < rl.length; ++ri) {\n        var r = rl[ri];\n        tot += (r.max() - r.min() + 1);\n    }\n    return tot;\n}\n\n\n\nfunction rangeOrder(a, b)\n{\n    if (a.min() < b.min()) {\n        return -1;\n    } else if (a.min() > b.min()) {\n        return 1;\n    } else if (a.max() < b.max()) {\n        return -1;\n    } else if (b.max() > a.max()) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nfunction _rangeOrder(a, b)\n{\n    if (a._min < b._min) {\n        return -1;\n    } else if (a._min > b._min) {\n        return 1;\n    } else if (a._max < b._max) {\n        return -1;\n    } else if (b._max > a._max) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\nreturn {\n        Range: Range,\n        union: union,\n        intersection: intersection,\n        coverage: coverage,\n        rangeOver: rangeOrder,\n        _rangeOrder: _rangeOrder\n};\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./galaxy/scripts/libs/bbi/spans.js\n// module id = 36\n// module chunks = 0 1 2 3 4","/* -*- mode: javascript; c-basic-offset: 4; indent-tabs-mode: nil -*- */\n\n//\n// Javascript ZLib\n// By Thomas Down 2010-2011\n//\n// Based very heavily on portions of jzlib (by ymnk@jcraft.com), who in\n// turn credits Jean-loup Gailly and Mark Adler for the original zlib code.\n//\n// inflate.js: ZLib inflate code\n//\n\n//\n// Shared constants\n//\n\ndefine([],function() {\n\nvar MAX_WBITS=15; // 32K LZ77 window\nvar DEF_WBITS=MAX_WBITS;\nvar MAX_MEM_LEVEL=9;\nvar MANY=1440;\nvar BMAX = 15;\n\n// preset dictionary flag in zlib header\nvar PRESET_DICT=0x20;\n\nvar Z_NO_FLUSH=0;\nvar Z_PARTIAL_FLUSH=1;\nvar Z_SYNC_FLUSH=2;\nvar Z_FULL_FLUSH=3;\nvar Z_FINISH=4;\n\nvar Z_DEFLATED=8;\n\nvar Z_OK=0;\nvar Z_STREAM_END=1;\nvar Z_NEED_DICT=2;\nvar Z_ERRNO=-1;\nvar Z_STREAM_ERROR=-2;\nvar Z_DATA_ERROR=-3;\nvar Z_MEM_ERROR=-4;\nvar Z_BUF_ERROR=-5;\nvar Z_VERSION_ERROR=-6;\n\nvar METHOD=0;   // waiting for method byte\nvar FLAG=1;     // waiting for flag byte\nvar DICT4=2;    // four dictionary check bytes to go\nvar DICT3=3;    // three dictionary check bytes to go\nvar DICT2=4;    // two dictionary check bytes to go\nvar DICT1=5;    // one dictionary check byte to go\nvar DICT0=6;    // waiting for inflateSetDictionary\nvar BLOCKS=7;   // decompressing blocks\nvar CHECK4=8;   // four check bytes to go\nvar CHECK3=9;   // three check bytes to go\nvar CHECK2=10;  // two check bytes to go\nvar CHECK1=11;  // one check byte to go\nvar DONE=12;    // finished check, done\nvar BAD=13;     // got an error--stay here\n\nvar inflate_mask = [0x00000000, 0x00000001, 0x00000003, 0x00000007, 0x0000000f, 0x0000001f, 0x0000003f, 0x0000007f, 0x000000ff, 0x000001ff, 0x000003ff, 0x000007ff, 0x00000fff, 0x00001fff, 0x00003fff, 0x00007fff, 0x0000ffff];\n\nvar IB_TYPE=0;  // get type bits (3, including end bit)\nvar IB_LENS=1;  // get lengths for stored\nvar IB_STORED=2;// processing stored block\nvar IB_TABLE=3; // get table lengths\nvar IB_BTREE=4; // get bit lengths tree for a dynamic block\nvar IB_DTREE=5; // get length, distance trees for a dynamic block\nvar IB_CODES=6; // processing fixed or dynamic block\nvar IB_DRY=7;   // output remaining window bytes\nvar IB_DONE=8;  // finished last block, done\nvar IB_BAD=9;   // ot a data error--stuck here\n\nvar fixed_bl = 9;\nvar fixed_bd = 5;\n\nvar fixed_tl = [\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,192,\n    80,7,10, 0,8,96, 0,8,32, 0,9,160,\n    0,8,0, 0,8,128, 0,8,64, 0,9,224,\n    80,7,6, 0,8,88, 0,8,24, 0,9,144,\n    83,7,59, 0,8,120, 0,8,56, 0,9,208,\n    81,7,17, 0,8,104, 0,8,40, 0,9,176,\n    0,8,8, 0,8,136, 0,8,72, 0,9,240,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,200,\n    81,7,13, 0,8,100, 0,8,36, 0,9,168,\n    0,8,4, 0,8,132, 0,8,68, 0,9,232,\n    80,7,8, 0,8,92, 0,8,28, 0,9,152,\n    84,7,83, 0,8,124, 0,8,60, 0,9,216,\n    82,7,23, 0,8,108, 0,8,44, 0,9,184,\n    0,8,12, 0,8,140, 0,8,76, 0,9,248,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,196,\n    81,7,11, 0,8,98, 0,8,34, 0,9,164,\n    0,8,2, 0,8,130, 0,8,66, 0,9,228,\n    80,7,7, 0,8,90, 0,8,26, 0,9,148,\n    84,7,67, 0,8,122, 0,8,58, 0,9,212,\n    82,7,19, 0,8,106, 0,8,42, 0,9,180,\n    0,8,10, 0,8,138, 0,8,74, 0,9,244,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,204,\n    81,7,15, 0,8,102, 0,8,38, 0,9,172,\n    0,8,6, 0,8,134, 0,8,70, 0,9,236,\n    80,7,9, 0,8,94, 0,8,30, 0,9,156,\n    84,7,99, 0,8,126, 0,8,62, 0,9,220,\n    82,7,27, 0,8,110, 0,8,46, 0,9,188,\n    0,8,14, 0,8,142, 0,8,78, 0,9,252,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,194,\n    80,7,10, 0,8,97, 0,8,33, 0,9,162,\n    0,8,1, 0,8,129, 0,8,65, 0,9,226,\n    80,7,6, 0,8,89, 0,8,25, 0,9,146,\n    83,7,59, 0,8,121, 0,8,57, 0,9,210,\n    81,7,17, 0,8,105, 0,8,41, 0,9,178,\n    0,8,9, 0,8,137, 0,8,73, 0,9,242,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,202,\n    81,7,13, 0,8,101, 0,8,37, 0,9,170,\n    0,8,5, 0,8,133, 0,8,69, 0,9,234,\n    80,7,8, 0,8,93, 0,8,29, 0,9,154,\n    84,7,83, 0,8,125, 0,8,61, 0,9,218,\n    82,7,23, 0,8,109, 0,8,45, 0,9,186,\n    0,8,13, 0,8,141, 0,8,77, 0,9,250,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,198,\n    81,7,11, 0,8,99, 0,8,35, 0,9,166,\n    0,8,3, 0,8,131, 0,8,67, 0,9,230,\n    80,7,7, 0,8,91, 0,8,27, 0,9,150,\n    84,7,67, 0,8,123, 0,8,59, 0,9,214,\n    82,7,19, 0,8,107, 0,8,43, 0,9,182,\n    0,8,11, 0,8,139, 0,8,75, 0,9,246,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,206,\n    81,7,15, 0,8,103, 0,8,39, 0,9,174,\n    0,8,7, 0,8,135, 0,8,71, 0,9,238,\n    80,7,9, 0,8,95, 0,8,31, 0,9,158,\n    84,7,99, 0,8,127, 0,8,63, 0,9,222,\n    82,7,27, 0,8,111, 0,8,47, 0,9,190,\n    0,8,15, 0,8,143, 0,8,79, 0,9,254,\n    96,7,256, 0,8,80, 0,8,16, 84,8,115,\n    82,7,31, 0,8,112, 0,8,48, 0,9,193,\n\n    80,7,10, 0,8,96, 0,8,32, 0,9,161,\n    0,8,0, 0,8,128, 0,8,64, 0,9,225,\n    80,7,6, 0,8,88, 0,8,24, 0,9,145,\n    83,7,59, 0,8,120, 0,8,56, 0,9,209,\n    81,7,17, 0,8,104, 0,8,40, 0,9,177,\n    0,8,8, 0,8,136, 0,8,72, 0,9,241,\n    80,7,4, 0,8,84, 0,8,20, 85,8,227,\n    83,7,43, 0,8,116, 0,8,52, 0,9,201,\n    81,7,13, 0,8,100, 0,8,36, 0,9,169,\n    0,8,4, 0,8,132, 0,8,68, 0,9,233,\n    80,7,8, 0,8,92, 0,8,28, 0,9,153,\n    84,7,83, 0,8,124, 0,8,60, 0,9,217,\n    82,7,23, 0,8,108, 0,8,44, 0,9,185,\n    0,8,12, 0,8,140, 0,8,76, 0,9,249,\n    80,7,3, 0,8,82, 0,8,18, 85,8,163,\n    83,7,35, 0,8,114, 0,8,50, 0,9,197,\n    81,7,11, 0,8,98, 0,8,34, 0,9,165,\n    0,8,2, 0,8,130, 0,8,66, 0,9,229,\n    80,7,7, 0,8,90, 0,8,26, 0,9,149,\n    84,7,67, 0,8,122, 0,8,58, 0,9,213,\n    82,7,19, 0,8,106, 0,8,42, 0,9,181,\n    0,8,10, 0,8,138, 0,8,74, 0,9,245,\n    80,7,5, 0,8,86, 0,8,22, 192,8,0,\n    83,7,51, 0,8,118, 0,8,54, 0,9,205,\n    81,7,15, 0,8,102, 0,8,38, 0,9,173,\n    0,8,6, 0,8,134, 0,8,70, 0,9,237,\n    80,7,9, 0,8,94, 0,8,30, 0,9,157,\n    84,7,99, 0,8,126, 0,8,62, 0,9,221,\n    82,7,27, 0,8,110, 0,8,46, 0,9,189,\n    0,8,14, 0,8,142, 0,8,78, 0,9,253,\n    96,7,256, 0,8,81, 0,8,17, 85,8,131,\n    82,7,31, 0,8,113, 0,8,49, 0,9,195,\n    80,7,10, 0,8,97, 0,8,33, 0,9,163,\n    0,8,1, 0,8,129, 0,8,65, 0,9,227,\n    80,7,6, 0,8,89, 0,8,25, 0,9,147,\n    83,7,59, 0,8,121, 0,8,57, 0,9,211,\n    81,7,17, 0,8,105, 0,8,41, 0,9,179,\n    0,8,9, 0,8,137, 0,8,73, 0,9,243,\n    80,7,4, 0,8,85, 0,8,21, 80,8,258,\n    83,7,43, 0,8,117, 0,8,53, 0,9,203,\n    81,7,13, 0,8,101, 0,8,37, 0,9,171,\n    0,8,5, 0,8,133, 0,8,69, 0,9,235,\n    80,7,8, 0,8,93, 0,8,29, 0,9,155,\n    84,7,83, 0,8,125, 0,8,61, 0,9,219,\n    82,7,23, 0,8,109, 0,8,45, 0,9,187,\n    0,8,13, 0,8,141, 0,8,77, 0,9,251,\n    80,7,3, 0,8,83, 0,8,19, 85,8,195,\n    83,7,35, 0,8,115, 0,8,51, 0,9,199,\n    81,7,11, 0,8,99, 0,8,35, 0,9,167,\n    0,8,3, 0,8,131, 0,8,67, 0,9,231,\n    80,7,7, 0,8,91, 0,8,27, 0,9,151,\n    84,7,67, 0,8,123, 0,8,59, 0,9,215,\n    82,7,19, 0,8,107, 0,8,43, 0,9,183,\n    0,8,11, 0,8,139, 0,8,75, 0,9,247,\n    80,7,5, 0,8,87, 0,8,23, 192,8,0,\n    83,7,51, 0,8,119, 0,8,55, 0,9,207,\n    81,7,15, 0,8,103, 0,8,39, 0,9,175,\n    0,8,7, 0,8,135, 0,8,71, 0,9,239,\n    80,7,9, 0,8,95, 0,8,31, 0,9,159,\n    84,7,99, 0,8,127, 0,8,63, 0,9,223,\n    82,7,27, 0,8,111, 0,8,47, 0,9,191,\n    0,8,15, 0,8,143, 0,8,79, 0,9,255\n];\nvar fixed_td = [\n    80,5,1, 87,5,257, 83,5,17, 91,5,4097,\n    81,5,5, 89,5,1025, 85,5,65, 93,5,16385,\n    80,5,3, 88,5,513, 84,5,33, 92,5,8193,\n    82,5,9, 90,5,2049, 86,5,129, 192,5,24577,\n    80,5,2, 87,5,385, 83,5,25, 91,5,6145,\n    81,5,7, 89,5,1537, 85,5,97, 93,5,24577,\n    80,5,4, 88,5,769, 84,5,49, 92,5,12289,\n    82,5,13, 90,5,3073, 86,5,193, 192,5,24577\n];\n\n  // Tables for deflate from PKZIP's appnote.txt.\n  var cplens = [ // Copy lengths for literal codes 257..285\n        3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n        35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n  ];\n\n  // see note #13 above about 258\n  var cplext = [ // Extra bits for literal codes 257..285\n        0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2,\n        3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 112, 112  // 112==invalid\n  ];\n\n var cpdist = [ // Copy offsets for distance codes 0..29\n        1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n        257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n        8193, 12289, 16385, 24577\n  ];\n\n  var cpdext = [ // Extra bits for distance codes\n        0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6,\n        7, 7, 8, 8, 9, 9, 10, 10, 11, 11,\n        12, 12, 13, 13];\n\n//\n// ZStream.java\n//\n\nfunction ZStream() {\n}\n\n\nZStream.prototype.inflateInit = function(w, nowrap) {\n    if (!w) {\n\tw = DEF_WBITS;\n    }\n    if (nowrap) {\n\tnowrap = false;\n    }\n    this.istate = new Inflate();\n    return this.istate.inflateInit(this, nowrap?-w:w);\n}\n\nZStream.prototype.inflate = function(f) {\n    if(this.istate==null) return Z_STREAM_ERROR;\n    return this.istate.inflate(this, f);\n}\n\nZStream.prototype.inflateEnd = function(){\n    if(this.istate==null) return Z_STREAM_ERROR;\n    var ret=istate.inflateEnd(this);\n    this.istate = null;\n    return ret;\n}\nZStream.prototype.inflateSync = function(){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSync(this);\n}\nZStream.prototype.inflateSetDictionary = function(dictionary, dictLength){\n    // if(istate == null) return Z_STREAM_ERROR;\n    return istate.inflateSetDictionary(this, dictionary, dictLength);\n}\n\n/*\n\n  public int deflateInit(int level){\n    return deflateInit(level, MAX_WBITS);\n  }\n  public int deflateInit(int level, boolean nowrap){\n    return deflateInit(level, MAX_WBITS, nowrap);\n  }\n  public int deflateInit(int level, int bits){\n    return deflateInit(level, bits, false);\n  }\n  public int deflateInit(int level, int bits, boolean nowrap){\n    dstate=new Deflate();\n    return dstate.deflateInit(this, level, nowrap?-bits:bits);\n  }\n  public int deflate(int flush){\n    if(dstate==null){\n      return Z_STREAM_ERROR;\n    }\n    return dstate.deflate(this, flush);\n  }\n  public int deflateEnd(){\n    if(dstate==null) return Z_STREAM_ERROR;\n    int ret=dstate.deflateEnd();\n    dstate=null;\n    return ret;\n  }\n  public int deflateParams(int level, int strategy){\n    if(dstate==null) return Z_STREAM_ERROR;\n    return dstate.deflateParams(this, level, strategy);\n  }\n  public int deflateSetDictionary (byte[] dictionary, int dictLength){\n    if(dstate == null)\n      return Z_STREAM_ERROR;\n    return dstate.deflateSetDictionary(this, dictionary, dictLength);\n  }\n\n*/\n\n/*\n  // Flush as much pending output as possible. All deflate() output goes\n  // through this function so some applications may wish to modify it\n  // to avoid allocating a large strm->next_out buffer and copying into it.\n  // (See also read_buf()).\n  void flush_pending(){\n    int len=dstate.pending;\n\n    if(len>avail_out) len=avail_out;\n    if(len==0) return;\n\n    if(dstate.pending_buf.length<=dstate.pending_out ||\n       next_out.length<=next_out_index ||\n       dstate.pending_buf.length<(dstate.pending_out+len) ||\n       next_out.length<(next_out_index+len)){\n      System.out.println(dstate.pending_buf.length+\", \"+dstate.pending_out+\n\t\t\t \", \"+next_out.length+\", \"+next_out_index+\", \"+len);\n      System.out.println(\"avail_out=\"+avail_out);\n    }\n\n    System.arraycopy(dstate.pending_buf, dstate.pending_out,\n\t\t     next_out, next_out_index, len);\n\n    next_out_index+=len;\n    dstate.pending_out+=len;\n    total_out+=len;\n    avail_out-=len;\n    dstate.pending-=len;\n    if(dstate.pending==0){\n      dstate.pending_out=0;\n    }\n  }\n\n  // Read a new buffer from the current input stream, update the adler32\n  // and total number of bytes read.  All deflate() input goes through\n  // this function so some applications may wish to modify it to avoid\n  // allocating a large strm->next_in buffer and copying from it.\n  // (See also flush_pending()).\n  int read_buf(byte[] buf, int start, int size) {\n    int len=avail_in;\n\n    if(len>size) len=size;\n    if(len==0) return 0;\n\n    avail_in-=len;\n\n    if(dstate.noheader==0) {\n      adler=_adler.adler32(adler, next_in, next_in_index, len);\n    }\n    System.arraycopy(next_in, next_in_index, buf, start, len);\n    next_in_index  += len;\n    total_in += len;\n    return len;\n  }\n\n  public void free(){\n    next_in=null;\n    next_out=null;\n    msg=null;\n    _adler=null;\n  }\n}\n*/\n\n\n//\n// Inflate.java\n//\n\nfunction Inflate() {\n    this.was = [0];\n}\n\nInflate.prototype.inflateReset = function(z) {\n    if(z == null || z.istate == null) return Z_STREAM_ERROR;\n\n    z.total_in = z.total_out = 0;\n    z.msg = null;\n    z.istate.mode = z.istate.nowrap!=0 ? BLOCKS : METHOD;\n    z.istate.blocks.reset(z, null);\n    return Z_OK;\n}\n\nInflate.prototype.inflateEnd = function(z){\n    if(this.blocks != null)\n      this.blocks.free(z);\n    this.blocks=null;\n    return Z_OK;\n}\n\nInflate.prototype.inflateInit = function(z, w){\n    z.msg = null;\n    this.blocks = null;\n\n    // handle undocumented nowrap option (no zlib header or check)\n    nowrap = 0;\n    if(w < 0){\n      w = - w;\n      nowrap = 1;\n    }\n\n    // set window size\n    if(w<8 ||w>15){\n      this.inflateEnd(z);\n      return Z_STREAM_ERROR;\n    }\n    this.wbits=w;\n\n    z.istate.blocks=new InfBlocks(z,\n\t\t\t\t  z.istate.nowrap!=0 ? null : this,\n\t\t\t\t  1<<w);\n\n    // reset state\n    this.inflateReset(z);\n    return Z_OK;\n  }\n\nInflate.prototype.inflate = function(z, f){\n    var r, b;\n\n    if(z == null || z.istate == null || z.next_in == null)\n      return Z_STREAM_ERROR;\n    f = f == Z_FINISH ? Z_BUF_ERROR : Z_OK;\n    r = Z_BUF_ERROR;\n    while (true){\n      switch (z.istate.mode){\n      case METHOD:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        if(((z.istate.method = z.next_in[z.next_in_index++])&0xf)!=Z_DEFLATED){\n          z.istate.mode = BAD;\n          z.msg=\"unknown compression method\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        if((z.istate.method>>4)+8>z.istate.wbits){\n          z.istate.mode = BAD;\n          z.msg=\"invalid window size\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n        z.istate.mode=FLAG;\n      case FLAG:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        b = (z.next_in[z.next_in_index++])&0xff;\n\n        if((((z.istate.method << 8)+b) % 31)!=0){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect header check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        if((b&PRESET_DICT)==0){\n          z.istate.mode = BLOCKS;\n          break;\n        }\n        z.istate.mode = DICT4;\n      case DICT4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=DICT3;\n      case DICT3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode=DICT2;\n      case DICT2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode=DICT1;\n      case DICT1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need += (z.next_in[z.next_in_index++]&0xff);\n        z.adler = z.istate.need;\n        z.istate.mode = DICT0;\n        return Z_NEED_DICT;\n      case DICT0:\n        z.istate.mode = BAD;\n        z.msg = \"need dictionary\";\n        z.istate.marker = 0;       // can try inflateSync\n        return Z_STREAM_ERROR;\n      case BLOCKS:\n\n        r = z.istate.blocks.proc(z, r);\n        if(r == Z_DATA_ERROR){\n          z.istate.mode = BAD;\n          z.istate.marker = 0;     // can try inflateSync\n          break;\n        }\n        if(r == Z_OK){\n          r = f;\n        }\n        if(r != Z_STREAM_END){\n          return r;\n        }\n        r = f;\n        z.istate.blocks.reset(z, z.istate.was);\n        if(z.istate.nowrap!=0){\n          z.istate.mode=DONE;\n          break;\n        }\n        z.istate.mode=CHECK4;\n      case CHECK4:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need=((z.next_in[z.next_in_index++]&0xff)<<24)&0xff000000;\n        z.istate.mode=CHECK3;\n      case CHECK3:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<16)&0xff0000;\n        z.istate.mode = CHECK2;\n      case CHECK2:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=((z.next_in[z.next_in_index++]&0xff)<<8)&0xff00;\n        z.istate.mode = CHECK1;\n      case CHECK1:\n\n        if(z.avail_in==0)return r;r=f;\n\n        z.avail_in--; z.total_in++;\n        z.istate.need+=(z.next_in[z.next_in_index++]&0xff);\n\n        if(((z.istate.was[0])) != ((z.istate.need))){\n          z.istate.mode = BAD;\n          z.msg = \"incorrect data check\";\n          z.istate.marker = 5;       // can't try inflateSync\n          break;\n        }\n\n        z.istate.mode = DONE;\n      case DONE:\n        return Z_STREAM_END;\n      case BAD:\n        return Z_DATA_ERROR;\n      default:\n        return Z_STREAM_ERROR;\n      }\n    }\n  }\n\n\nInflate.prototype.inflateSetDictionary = function(z,  dictionary, dictLength) {\n    var index=0;\n    var length = dictLength;\n    if(z==null || z.istate == null|| z.istate.mode != DICT0)\n      return Z_STREAM_ERROR;\n\n    if(z._adler.adler32(1, dictionary, 0, dictLength)!=z.adler){\n      return Z_DATA_ERROR;\n    }\n\n    z.adler = z._adler.adler32(0, null, 0, 0);\n\n    if(length >= (1<<z.istate.wbits)){\n      length = (1<<z.istate.wbits)-1;\n      index=dictLength - length;\n    }\n    z.istate.blocks.set_dictionary(dictionary, index, length);\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n  }\n\n//  static private byte[] mark = {(byte)0, (byte)0, (byte)0xff, (byte)0xff};\nvar mark = [0, 0, 255, 255]\n\nInflate.prototype.inflateSync = function(z){\n    var n;       // number of bytes to look at\n    var p;       // pointer to bytes\n    var m;       // number of marker bytes found in a row\n    var r, w;   // temporaries to save total_in and total_out\n\n    // set up\n    if(z == null || z.istate == null)\n      return Z_STREAM_ERROR;\n    if(z.istate.mode != BAD){\n      z.istate.mode = BAD;\n      z.istate.marker = 0;\n    }\n    if((n=z.avail_in)==0)\n      return Z_BUF_ERROR;\n    p=z.next_in_index;\n    m=z.istate.marker;\n\n    // search\n    while (n!=0 && m < 4){\n      if(z.next_in[p] == mark[m]){\n        m++;\n      }\n      else if(z.next_in[p]!=0){\n        m = 0;\n      }\n      else{\n        m = 4 - m;\n      }\n      p++; n--;\n    }\n\n    // restore\n    z.total_in += p-z.next_in_index;\n    z.next_in_index = p;\n    z.avail_in = n;\n    z.istate.marker = m;\n\n    // return no joy or set up to restart on a new block\n    if(m != 4){\n      return Z_DATA_ERROR;\n    }\n    r=z.total_in;  w=z.total_out;\n    this.inflateReset(z);\n    z.total_in=r;  z.total_out = w;\n    z.istate.mode = BLOCKS;\n    return Z_OK;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP\n  // implementation to provide an additional safety check. PPP uses Z_SYNC_FLUSH\n  // but removes the length bytes of the resulting empty stored block. When\n  // decompressing, PPP checks that at the end of input packet, inflate is\n  // waiting for these length bytes.\nInflate.prototype.inflateSyncPoint = function(z){\n    if(z == null || z.istate == null || z.istate.blocks == null)\n      return Z_STREAM_ERROR;\n    return z.istate.blocks.sync_point();\n}\n\n\n//\n// InfBlocks.java\n//\n\nvar INFBLOCKS_BORDER = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n\nfunction InfBlocks(z, checkfn, w) {\n    this.hufts=new Int32Array(MANY*3);\n    this.window=new Uint8Array(w);\n    this.end=w;\n    this.checkfn = checkfn;\n    this.mode = IB_TYPE;\n    this.reset(z, null);\n\n    this.left = 0;            // if STORED, bytes left to copy\n\n    this.table = 0;           // table lengths (14 bits)\n    this.index = 0;           // index into blens (or border)\n    this.blens = null;         // bit lengths of codes\n    this.bb=new Int32Array(1); // bit length tree depth\n    this.tb=new Int32Array(1); // bit length decoding tree\n\n    this.codes = new InfCodes();\n\n    this.last = 0;            // true if this block is the last block\n\n  // mode independent information\n    this.bitk = 0;            // bits in bit buffer\n    this.bitb = 0;            // bit buffer\n    this.read = 0;            // window read pointer\n    this.write = 0;           // window write pointer\n    this.check = 0;          // check on output\n\n    this.inftree=new InfTree();\n}\n\n\n\n\nInfBlocks.prototype.reset = function(z, c){\n    if(c) c[0]=this.check;\n    if(this.mode==IB_CODES){\n      this.codes.free(z);\n    }\n    this.mode=IB_TYPE;\n    this.bitk=0;\n    this.bitb=0;\n    this.read=this.write=0;\n\n    if(this.checkfn)\n      z.adler=this.check=z._adler.adler32(0, null, 0, 0);\n  }\n\n InfBlocks.prototype.proc = function(z, r){\n    var t;              // temporary storage\n    var b;              // bit buffer\n    var k;              // bits in bit buffer\n    var p;              // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n\n    // copy input/output information to locals (UPDATE macro restores)\n    {p=z.next_in_index;n=z.avail_in;b=this.bitb;k=this.bitk;}\n    {q=this.write;m=(q<this.read ? this.read-q-1 : this.end-q);}\n\n    // process input based on current state\n    while(true){\n      switch (this.mode){\n      case IB_TYPE:\n\n\twhile(k<(3)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\tt = (b & 7);\n\tthis.last = t & 1;\n\n\tswitch (t >>> 1){\n        case 0:                         // stored\n          {b>>>=(3);k-=(3);}\n          t = k & 7;                    // go to byte boundary\n\n          {b>>>=(t);k-=(t);}\n          this.mode = IB_LENS;                  // get length of stored block\n          break;\n        case 1:                         // fixed\n          {\n              var bl=new Int32Array(1);\n\t      var bd=new Int32Array(1);\n              var tl=[];\n\t      var td=[];\n\n\t      inflate_trees_fixed(bl, bd, tl, td, z);\n              this.codes.init(bl[0], bd[0], tl[0], 0, td[0], 0, z);\n          }\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_CODES;\n          break;\n        case 2:                         // dynamic\n\n          {b>>>=(3);k-=(3);}\n\n          this.mode = IB_TABLE;\n          break;\n        case 3:                         // illegal\n\n          {b>>>=(3);k-=(3);}\n          this.mode = BAD;\n          z.msg = \"invalid block type\";\n          r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tbreak;\n      case IB_LENS:\n\twhile(k<(32)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tif ((((~b) >>> 16) & 0xffff) != (b & 0xffff)){\n\t  this.mode = BAD;\n\t  z.msg = \"invalid stored block lengths\";\n\t  r = Z_DATA_ERROR;\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\tthis.left = (b & 0xffff);\n\tb = k = 0;                       // dump bits\n\tthis.mode = this.left!=0 ? IB_STORED : (this.last!=0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_STORED:\n\tif (n == 0){\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tif(m==0){\n\t  if(q==end&&read!=0){\n\t    q=0; m=(q<this.read ? this.read-q-1 : this.end-q);\n\t  }\n\t  if(m==0){\n\t    this.write=q;\n\t    r=this.inflate_flush(z,r);\n\t    q=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    if(q==this.end && this.read != 0){\n\t      q=0; m = (q < this.read ? this.read-q-1 : this.end-q);\n\t    }\n\t    if(m==0){\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\tt = this.left;\n\tif(t>n) t = n;\n\tif(t>m) t = m;\n\tarrayCopy(z.next_in, p, this.window, q, t);\n\tp += t;  n -= t;\n\tq += t;  m -= t;\n\tif ((this.left -= t) != 0)\n\t  break;\n\tthis.mode = (this.last != 0 ? IB_DRY : IB_TYPE);\n\tbreak;\n      case IB_TABLE:\n\n\twhile(k<(14)){\n\t  if(n!=0){\n\t    r=Z_OK;\n\t  }\n\t  else{\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;\n\t    z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  };\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.table = t = (b & 0x3fff);\n\tif ((t & 0x1f) > 29 || ((t >> 5) & 0x1f) > 29)\n\t  {\n\t    this.mode = IB_BAD;\n\t    z.msg = \"too many length or distance symbols\";\n\t    r = Z_DATA_ERROR;\n\n\t    this.bitb=b; this.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    this.write=q;\n\t    return this.inflate_flush(z,r);\n\t  }\n\tt = 258 + (t & 0x1f) + ((t >> 5) & 0x1f);\n\tif(this.blens==null || this.blens.length<t){\n\t    this.blens=new Int32Array(t);\n\t}\n\telse{\n\t  for(var i=0; i<t; i++){\n              this.blens[i]=0;\n          }\n\t}\n\n\t{b>>>=(14);k-=(14);}\n\n\tthis.index = 0;\n\tmode = IB_BTREE;\n      case IB_BTREE:\n\twhile (this.index < 4 + (this.table >>> 10)){\n\t  while(k<(3)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = b&7;\n\n\t  {b>>>=(3);k-=(3);}\n\t}\n\n\twhile(this.index < 19){\n\t  this.blens[INFBLOCKS_BORDER[this.index++]] = 0;\n\t}\n\n\tthis.bb[0] = 7;\n\tt = this.inftree.inflate_trees_bits(this.blens, this.bb, this.tb, this.hufts, z);\n\tif (t != Z_OK){\n\t  r = t;\n\t  if (r == Z_DATA_ERROR){\n\t    this.blens=null;\n\t    this.mode = IB_BAD;\n\t  }\n\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  write=q;\n\t  return this.inflate_flush(z,r);\n\t}\n\n\tthis.index = 0;\n\tthis.mode = IB_DTREE;\n      case IB_DTREE:\n\twhile (true){\n\t  t = this.table;\n\t  if(!(this.index < 258 + (t & 0x1f) + ((t >> 5) & 0x1f))){\n\t    break;\n\t  }\n\n\t  var h; //int[]\n\t  var i, j, c;\n\n\t  t = this.bb[0];\n\n\t  while(k<(t)){\n\t    if(n!=0){\n\t      r=Z_OK;\n\t    }\n\t    else{\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;\n\t      z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    };\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;\n\t    k+=8;\n\t  }\n\n//\t  if (this.tb[0]==-1){\n//            dlog(\"null...\");\n//\t  }\n\n\t  t=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+1];\n\t  c=this.hufts[(this.tb[0]+(b & inflate_mask[t]))*3+2];\n\n\t  if (c < 16){\n\t    b>>>=(t);k-=(t);\n\t    this.blens[this.index++] = c;\n\t  }\n\t  else { // c == 16..18\n\t    i = c == 18 ? 7 : c - 14;\n\t    j = c == 18 ? 11 : 3;\n\n\t    while(k<(t+i)){\n\t      if(n!=0){\n\t\tr=Z_OK;\n\t      }\n\t      else{\n\t\tthis.bitb=b; this.bitk=k;\n\t\tz.avail_in=n;\n\t\tz.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\tthis.write=q;\n\t\treturn this.inflate_flush(z,r);\n\t      };\n\t      n--;\n\t      b|=(z.next_in[p++]&0xff)<<k;\n\t      k+=8;\n\t    }\n\n\t    b>>>=(t);k-=(t);\n\n\t    j += (b & inflate_mask[i]);\n\n\t    b>>>=(i);k-=(i);\n\n\t    i = this.index;\n\t    t = this.table;\n\t    if (i + j > 258 + (t & 0x1f) + ((t >> 5) & 0x1f) ||\n\t\t(c == 16 && i < 1)){\n\t      this.blens=null;\n\t      this.mode = IB_BAD;\n\t      z.msg = \"invalid bit length repeat\";\n\t      r = Z_DATA_ERROR;\n\n\t      this.bitb=b; this.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      this.write=q;\n\t      return this.inflate_flush(z,r);\n\t    }\n\n\t    c = c == 16 ? this.blens[i-1] : 0;\n\t    do{\n\t      this.blens[i++] = c;\n\t    }\n\t    while (--j!=0);\n\t    this.index = i;\n\t  }\n\t}\n\n\tthis.tb[0]=-1;\n\t{\n\t    var bl=new Int32Array(1);\n\t    var bd=new Int32Array(1);\n\t    var tl=new Int32Array(1);\n\t    var td=new Int32Array(1);\n\t    bl[0] = 9;         // must be <= 9 for lookahead assumptions\n\t    bd[0] = 6;         // must be <= 9 for lookahead assumptions\n\n\t    t = this.table;\n\t    t = this.inftree.inflate_trees_dynamic(257 + (t & 0x1f),\n\t\t\t\t\t      1 + ((t >> 5) & 0x1f),\n\t\t\t\t\t      this.blens, bl, bd, tl, td, this.hufts, z);\n\n\t    if (t != Z_OK){\n\t        if (t == Z_DATA_ERROR){\n\t            this.blens=null;\n\t            this.mode = BAD;\n\t        }\n\t        r = t;\n\n\t        this.bitb=b; this.bitk=k;\n\t        z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t        this.write=q;\n\t        return this.inflate_flush(z,r);\n\t    }\n\t    this.codes.init(bl[0], bd[0], this.hufts, tl[0], this.hufts, td[0], z);\n\t}\n\tthis.mode = IB_CODES;\n      case IB_CODES:\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n; z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\n\tif ((r = this.codes.proc(this, z, r)) != Z_STREAM_END){\n\t  return this.inflate_flush(z, r);\n\t}\n\tr = Z_OK;\n\tthis.codes.free(z);\n\n\tp=z.next_in_index; n=z.avail_in;b=this.bitb;k=this.bitk;\n\tq=this.write;m = (q < this.read ? this.read-q-1 : this.end-q);\n\n\tif (this.last==0){\n\t  this.mode = IB_TYPE;\n\t  break;\n\t}\n\tthis.mode = IB_DRY;\n      case IB_DRY:\n\tthis.write=q;\n\tr = this.inflate_flush(z, r);\n\tq=this.write; m = (q < this.read ? this.read-q-1 : this.end-q);\n\tif (this.read != this.write){\n\t  this.bitb=b; this.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  this.write=q;\n\t  return this.inflate_flush(z, r);\n\t}\n\tmode = DONE;\n      case IB_DONE:\n\tr = Z_STREAM_END;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      case IB_BAD:\n\tr = Z_DATA_ERROR;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\tthis.bitb=b; this.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\tthis.write=q;\n\treturn this.inflate_flush(z, r);\n      }\n    }\n  }\n\nInfBlocks.prototype.free = function(z){\n    this.reset(z, null);\n    this.window=null;\n    this.hufts=null;\n}\n\nInfBlocks.prototype.set_dictionary = function(d, start, n){\n    arrayCopy(d, start, window, 0, n);\n    this.read = this.write = n;\n}\n\n  // Returns true if inflate is currently at the end of a block generated\n  // by Z_SYNC_FLUSH or Z_FULL_FLUSH.\nInfBlocks.prototype.sync_point = function(){\n    return this.mode == IB_LENS;\n}\n\n  // copy as much as possible from the sliding window to the output area\nInfBlocks.prototype.inflate_flush = function(z, r){\n    var n;\n    var p;\n    var q;\n\n    // local copies of source and destination pointers\n    p = z.next_out_index;\n    q = this.read;\n\n    // compute number of bytes to copy as far as end of window\n    n = ((q <= this.write ? this.write : this.end) - q);\n    if (n > z.avail_out) n = z.avail_out;\n    if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n    // update counters\n    z.avail_out -= n;\n    z.total_out += n;\n\n    // update check information\n    if(this.checkfn != null)\n      z.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n    // copy as far as end of window\n    arrayCopy(this.window, q, z.next_out, p, n);\n    p += n;\n    q += n;\n\n    // see if more to copy at beginning of window\n    if (q == this.end){\n      // wrap pointers\n      q = 0;\n      if (this.write == this.end)\n        this.write = 0;\n\n      // compute bytes to copy\n      n = this.write - q;\n      if (n > z.avail_out) n = z.avail_out;\n      if (n!=0 && r == Z_BUF_ERROR) r = Z_OK;\n\n      // update counters\n      z.avail_out -= n;\n      z.total_out += n;\n\n      // update check information\n      if(this.checkfn != null)\n\tz.adler=this.check=z._adler.adler32(this.check, this.window, q, n);\n\n      // copy\n      arrayCopy(this.window, q, z.next_out, p, n);\n      p += n;\n      q += n;\n    }\n\n    // update pointers\n    z.next_out_index = p;\n    this.read = q;\n\n    // done\n    return r;\n  }\n\n//\n// InfCodes.java\n//\n\nvar IC_START=0;  // x: set up for LEN\nvar IC_LEN=1;    // i: get length/literal/eob next\nvar IC_LENEXT=2; // i: getting length extra (have base)\nvar IC_DIST=3;   // i: get distance next\nvar IC_DISTEXT=4;// i: getting distance extra\nvar IC_COPY=5;   // o: copying bytes in window, waiting for space\nvar IC_LIT=6;    // o: got literal, waiting for output space\nvar IC_WASH=7;   // o: got eob, possibly still output waiting\nvar IC_END=8;    // x: got eob and all data flushed\nvar IC_BADCODE=9;// x: got error\n\nfunction InfCodes() {\n}\n\nInfCodes.prototype.init = function(bl, bd, tl, tl_index, td, td_index, z) {\n    this.mode=IC_START;\n    this.lbits=bl;\n    this.dbits=bd;\n    this.ltree=tl;\n    this.ltree_index=tl_index;\n    this.dtree = td;\n    this.dtree_index=td_index;\n    this.tree=null;\n}\n\nInfCodes.prototype.proc = function(s, z, r){\n    var j;              // temporary storage\n    var t;              // temporary pointer (int[])\n    var tindex;         // temporary pointer\n    var e;              // extra bits or operation\n    var b=0;            // bit buffer\n    var k=0;            // bits in bit buffer\n    var p=0;            // input data pointer\n    var n;              // bytes available there\n    var q;              // output window write pointer\n    var m;              // bytes to end of window or read pointer\n    var f;              // pointer to copy strings from\n\n    // copy input/output information to locals (UPDATE macro restores)\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // process input and output based on current state\n    while (true){\n      switch (this.mode){\n\t// waiting for \"i:\"=input, \"o:\"=output, \"x:\"=nothing\n      case IC_START:         // x: set up for LEN\n\tif (m >= 258 && n >= 10){\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  r = this.inflate_fast(this.lbits, this.dbits,\n\t\t\t   this.ltree, this.ltree_index,\n\t\t\t   this.dtree, this.dtree_index,\n\t\t\t   s, z);\n\n\t  p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n\t  q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t  if (r != Z_OK){\n\t    this.mode = r == Z_STREAM_END ? IC_WASH : IC_BADCODE;\n\t    break;\n\t  }\n\t}\n\tthis.need = this.lbits;\n\tthis.tree = this.ltree;\n\tthis.tree_index=this.ltree_index;\n\n\tthis.mode = IC_LEN;\n      case IC_LEN:           // i: get length/literal/eob next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--;\n\t  b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b&inflate_mask[j]))*3;\n\n\tb>>>=(this.tree[tindex+1]);\n\tk-=(this.tree[tindex+1]);\n\n\te=this.tree[tindex];\n\n\tif(e == 0){               // literal\n\t  this.lit = this.tree[tindex+2];\n\t  this.mode = IC_LIT;\n\t  break;\n\t}\n\tif((e & 16)!=0 ){          // length\n\t  this.get = e & 15;\n\t  this.len = this.tree[tindex+2];\n\t  this.mode = IC_LENEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tif ((e & 32)!=0){               // end of block\n\t  this.mode = IC_WASH;\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid literal/length code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_LENEXT:        // i: getting length extra (have base)\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.len += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.need = this.dbits;\n\tthis.tree = this.dtree;\n\tthis.tree_index = this.dtree_index;\n\tthis.mode = IC_DIST;\n      case IC_DIST:          // i: get distance next\n\tj = this.need;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\ttindex=(this.tree_index+(b & inflate_mask[j]))*3;\n\n\tb>>=this.tree[tindex+1];\n\tk-=this.tree[tindex+1];\n\n\te = (this.tree[tindex]);\n\tif((e & 16)!=0){               // distance\n\t  this.get = e & 15;\n\t  this.dist = this.tree[tindex+2];\n\t  this.mode = IC_DISTEXT;\n\t  break;\n\t}\n\tif ((e & 64) == 0){        // next table\n\t  this.need = e;\n\t  this.tree_index = tindex/3 + this.tree[tindex+2];\n\t  break;\n\t}\n\tthis.mode = IC_BADCODE;        // invalid code\n\tz.msg = \"invalid distance code\";\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_DISTEXT:       // i: getting distance extra\n\tj = this.get;\n\n\twhile(k<(j)){\n\t  if(n!=0)r=Z_OK;\n\t  else{\n\n\t    s.bitb=b;s.bitk=k;\n\t    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t    s.write=q;\n\t    return s.inflate_flush(z,r);\n\t  }\n\t  n--; b|=(z.next_in[p++]&0xff)<<k;\n\t  k+=8;\n\t}\n\n\tthis.dist += (b & inflate_mask[j]);\n\n\tb>>=j;\n\tk-=j;\n\n\tthis.mode = IC_COPY;\n      case IC_COPY:          // o: copying bytes in window, waiting for space\n        f = q - this.dist;\n        while(f < 0){     // modulo window size-\"while\" instead\n          f += s.end;     // of \"if\" handles invalid distances\n\t}\n\twhile (this.len!=0){\n\n\t  if(m==0){\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.write=q; r=s.inflate_flush(z,r);\n\t      q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t      if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\n\t      if(m==0){\n\t\ts.bitb=b;s.bitk=k;\n\t\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t\ts.write=q;\n\t\treturn s.inflate_flush(z,r);\n\t      }\n\t    }\n\t  }\n\n\t  s.window[q++]=s.window[f++]; m--;\n\n\t  if (f == s.end)\n            f = 0;\n\t  this.len--;\n\t}\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_LIT:           // o: got literal, waiting for output space\n\tif(m==0){\n\t  if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t  if(m==0){\n\t    s.write=q; r=s.inflate_flush(z,r);\n\t    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\t    if(q==s.end&&s.read!=0){q=0;m=q<s.read?s.read-q-1:s.end-q;}\n\t    if(m==0){\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\t      return s.inflate_flush(z,r);\n\t    }\n\t  }\n\t}\n\tr=Z_OK;\n\n\ts.window[q++]=this.lit; m--;\n\n\tthis.mode = IC_START;\n\tbreak;\n      case IC_WASH:           // o: got eob, possibly more output\n\tif (k > 7){        // return unused byte, if any\n\t  k -= 8;\n\t  n++;\n\t  p--;             // can always return one\n\t}\n\n\ts.write=q; r=s.inflate_flush(z,r);\n\tq=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n\tif (s.read != s.write){\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\t  return s.inflate_flush(z,r);\n\t}\n\tthis.mode = IC_END;\n      case IC_END:\n\tr = Z_STREAM_END;\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      case IC_BADCODE:       // x: got error\n\n\tr = Z_DATA_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n\n      default:\n\tr = Z_STREAM_ERROR;\n\n\ts.bitb=b;s.bitk=k;\n\tz.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\ts.write=q;\n\treturn s.inflate_flush(z,r);\n      }\n    }\n  }\n\nInfCodes.prototype.free = function(z){\n    //  ZFREE(z, c);\n}\n\n  // Called with number of bytes left to write in window at least 258\n  // (the maximum string length) and number of input bytes available\n  // at least ten.  The ten bytes are six bytes for the longest length/\n  // distance pair plus four bytes for overloading the bit buffer.\n\nInfCodes.prototype.inflate_fast = function(bl, bd, tl, tl_index, td, td_index, s, z) {\n    var t;                // temporary pointer\n    var   tp;             // temporary pointer (int[])\n    var tp_index;         // temporary pointer\n    var e;                // extra bits or operation\n    var b;                // bit buffer\n    var k;                // bits in bit buffer\n    var p;                // input data pointer\n    var n;                // bytes available there\n    var q;                // output window write pointer\n    var m;                // bytes to end of window or read pointer\n    var ml;               // mask for literal/length tree\n    var md;               // mask for distance tree\n    var c;                // bytes to copy\n    var d;                // distance back to copy from\n    var r;                // copy source pointer\n\n    var tp_index_t_3;     // (tp_index+t)*3\n\n    // load input, output, bit values\n    p=z.next_in_index;n=z.avail_in;b=s.bitb;k=s.bitk;\n    q=s.write;m=q<s.read?s.read-q-1:s.end-q;\n\n    // initialize masks\n    ml = inflate_mask[bl];\n    md = inflate_mask[bd];\n\n    // do until not enough input or output space for fast loop\n    do {                          // assume called with m >= 258 && n >= 10\n      // get literal/length code\n      while(k<(20)){              // max bits for literal/length code\n\tn--;\n\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n      }\n\n      t= b&ml;\n      tp=tl;\n      tp_index=tl_index;\n      tp_index_t_3=(tp_index+t)*3;\n      if ((e = tp[tp_index_t_3]) == 0){\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\ts.window[q++] = tp[tp_index_t_3+2];\n\tm--;\n\tcontinue;\n      }\n      do {\n\n\tb>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\tif((e&16)!=0){\n\t  e &= 15;\n\t  c = tp[tp_index_t_3+2] + (b & inflate_mask[e]);\n\n\t  b>>=e; k-=e;\n\n\t  // decode distance base of block to copy\n\t  while(k<(15)){           // max bits for distance code\n\t    n--;\n\t    b|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t  }\n\n\t  t= b&md;\n\t  tp=td;\n\t  tp_index=td_index;\n          tp_index_t_3=(tp_index+t)*3;\n\t  e = tp[tp_index_t_3];\n\n\t  do {\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    if((e&16)!=0){\n\t      // get extra bits to add to distance base\n\t      e &= 15;\n\t      while(k<(e)){         // get extra bits (up to 13)\n\t\tn--;\n\t\tb|=(z.next_in[p++]&0xff)<<k;k+=8;\n\t      }\n\n\t      d = tp[tp_index_t_3+2] + (b&inflate_mask[e]);\n\n\t      b>>=(e); k-=(e);\n\n\t      // do the copy\n\t      m -= c;\n\t      if (q >= d){                // offset before dest\n\t\t//  just copy\n\t\tr=q-d;\n\t\tif(q-r>0 && 2>(q-r)){\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t\telse{\n\t\t  s.window[q++]=s.window[r++]; // minimum count is three,\n\t\t  s.window[q++]=s.window[r++]; // so unroll loop a little\n\t\t  c-=2;\n\t\t}\n\t      }\n\t      else{                  // else offset after destination\n                r=q-d;\n                do{\n                  r+=s.end;          // force pointer in window\n                }while(r<0);         // covers invalid distances\n\t\te=s.end-r;\n\t\tif(c>e){             // if source crosses,\n\t\t  c-=e;              // wrapped copy\n\t\t  if(q-r>0 && e>(q-r)){\n\t\t    do{s.window[q++] = s.window[r++];}\n\t\t    while(--e!=0);\n\t\t  }\n\t\t  else{\n\t\t    arrayCopy(s.window, r, s.window, q, e);\n\t\t    q+=e; r+=e; e=0;\n\t\t  }\n\t\t  r = 0;                  // copy rest from start of window\n\t\t}\n\n\t      }\n\n\t      // copy all or what's left\n              do{s.window[q++] = s.window[r++];}\n\t\twhile(--c!=0);\n\t      break;\n\t    }\n\t    else if((e&64)==0){\n\t      t+=tp[tp_index_t_3+2];\n\t      t+=(b&inflate_mask[e]);\n\t      tp_index_t_3=(tp_index+t)*3;\n\t      e=tp[tp_index_t_3];\n\t    }\n\t    else{\n\t      z.msg = \"invalid distance code\";\n\n\t      c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t      s.bitb=b;s.bitk=k;\n\t      z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t      s.write=q;\n\n\t      return Z_DATA_ERROR;\n\t    }\n\t  }\n\t  while(true);\n\t  break;\n\t}\n\n\tif((e&64)==0){\n\t  t+=tp[tp_index_t_3+2];\n\t  t+=(b&inflate_mask[e]);\n\t  tp_index_t_3=(tp_index+t)*3;\n\t  if((e=tp[tp_index_t_3])==0){\n\n\t    b>>=(tp[tp_index_t_3+1]); k-=(tp[tp_index_t_3+1]);\n\n\t    s.window[q++]=tp[tp_index_t_3+2];\n\t    m--;\n\t    break;\n\t  }\n\t}\n\telse if((e&32)!=0){\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_STREAM_END;\n\t}\n\telse{\n\t  z.msg=\"invalid literal/length code\";\n\n\t  c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n\t  s.bitb=b;s.bitk=k;\n\t  z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n\t  s.write=q;\n\n\t  return Z_DATA_ERROR;\n\t}\n      }\n      while(true);\n    }\n    while(m>=258 && n>= 10);\n\n    // not enough input or output--restore pointers and return\n    c=z.avail_in-n;c=(k>>3)<c?k>>3:c;n+=c;p-=c;k-=c<<3;\n\n    s.bitb=b;s.bitk=k;\n    z.avail_in=n;z.total_in+=p-z.next_in_index;z.next_in_index=p;\n    s.write=q;\n\n    return Z_OK;\n}\n\n//\n// InfTree.java\n//\n\nfunction InfTree() {\n}\n\nInfTree.prototype.huft_build = function(b, bindex, n, s, d, e, t, m, hp, hn, v) {\n\n    // Given a list of code lengths and a maximum table size, make a set of\n    // tables to decode that set of codes.  Return Z_OK on success, Z_BUF_ERROR\n    // if the given code set is incomplete (the tables are still built in this\n    // case), Z_DATA_ERROR if the input is invalid (an over-subscribed set of\n    // lengths), or Z_MEM_ERROR if not enough memory.\n\n    var a;                       // counter for codes of length k\n    var f;                       // i repeats in table every f entries\n    var g;                       // maximum code length\n    var h;                       // table level\n    var i;                       // counter, current code\n    var j;                       // counter\n    var k;                       // number of bits in current code\n    var l;                       // bits per table (returned in m)\n    var mask;                    // (1 << w) - 1, to avoid cc -O bug on HP\n    var p;                       // pointer into c[], b[], or v[]\n    var q;                       // points to current table\n    var w;                       // bits before this table == (l * h)\n    var xp;                      // pointer into x\n    var y;                       // number of dummy codes added\n    var z;                       // number of entries in current table\n\n    // Generate counts for each bit length\n\n    p = 0; i = n;\n    do {\n      this.c[b[bindex+p]]++; p++; i--;   // assume all entries <= BMAX\n    }while(i!=0);\n\n    if(this.c[0] == n){                // null input--all zero length codes\n      t[0] = -1;\n      m[0] = 0;\n      return Z_OK;\n    }\n\n    // Find minimum and maximum length, bound *m by those\n    l = m[0];\n    for (j = 1; j <= BMAX; j++)\n      if(this.c[j]!=0) break;\n    k = j;                        // minimum code length\n    if(l < j){\n      l = j;\n    }\n    for (i = BMAX; i!=0; i--){\n      if(this.c[i]!=0) break;\n    }\n    g = i;                        // maximum code length\n    if(l > i){\n      l = i;\n    }\n    m[0] = l;\n\n    // Adjust last length count to fill out codes, if needed\n    for (y = 1 << j; j < i; j++, y <<= 1){\n      if ((y -= this.c[j]) < 0){\n        return Z_DATA_ERROR;\n      }\n    }\n    if ((y -= this.c[i]) < 0){\n      return Z_DATA_ERROR;\n    }\n    this.c[i] += y;\n\n    // Generate starting offsets into the value table for each length\n    this.x[1] = j = 0;\n    p = 1;  xp = 2;\n    while (--i!=0) {                 // note that i == g from above\n      this.x[xp] = (j += this.c[p]);\n      xp++;\n      p++;\n    }\n\n    // Make a table of values in order of bit lengths\n    i = 0; p = 0;\n    do {\n      if ((j = b[bindex+p]) != 0){\n        this.v[this.x[j]++] = i;\n      }\n      p++;\n    }\n    while (++i < n);\n    n = this.x[g];                     // set n to length of v\n\n    // Generate the Huffman codes and for each, make the table entries\n    this.x[0] = i = 0;                 // first Huffman code is zero\n    p = 0;                        // grab values in bit order\n    h = -1;                       // no tables yet--level -1\n    w = -l;                       // bits decoded == (l * h)\n    this.u[0] = 0;                     // just to keep compilers happy\n    q = 0;                        // ditto\n    z = 0;                        // ditto\n\n    // go through the bit lengths (k already is bits in shortest code)\n    for (; k <= g; k++){\n      a = this.c[k];\n      while (a--!=0){\n\t// here i is the Huffman code of length k bits for value *p\n\t// make tables up to required level\n        while (k > w + l){\n          h++;\n          w += l;                 // previous table always l bits\n\t  // compute minimum size table less than or equal to l bits\n          z = g - w;\n          z = (z > l) ? l : z;        // table size upper limit\n          if((f=1<<(j=k-w))>a+1){     // try a k-w bit table\n                                      // too few codes for k-w bit table\n            f -= a + 1;               // deduct codes from patterns left\n            xp = k;\n            if(j < z){\n              while (++j < z){        // try smaller tables up to z bits\n                if((f <<= 1) <= this.c[++xp])\n                  break;              // enough codes to use up j bits\n                f -= this.c[xp];           // else deduct codes from patterns\n              }\n\t    }\n          }\n          z = 1 << j;                 // table entries for j-bit table\n\n\t  // allocate new table\n          if (this.hn[0] + z > MANY){       // (note: doesn't matter for fixed)\n            return Z_DATA_ERROR;       // overflow of MANY\n          }\n          this.u[h] = q = /*hp+*/ this.hn[0];   // DEBUG\n          this.hn[0] += z;\n\n\t  // connect to last table, if there is one\n\t  if(h!=0){\n            this.x[h]=i;           // save pattern for backing up\n            this.r[0]=j;     // bits in this table\n            this.r[1]=l;     // bits to dump before this table\n            j=i>>>(w - l);\n            this.r[2] = (q - this.u[h-1] - j);               // offset to this table\n            arrayCopy(this.r, 0, hp, (this.u[h-1]+j)*3, 3); // connect to last table\n          }\n          else{\n            t[0] = q;               // first table is returned result\n\t  }\n        }\n\n\t// set up table entry in r\n        this.r[1] = (k - w);\n        if (p >= n){\n          this.r[0] = 128 + 64;      // out of values--invalid code\n\t}\n        else if (v[p] < s){\n          this.r[0] = (this.v[p] < 256 ? 0 : 32 + 64);  // 256 is end-of-block\n          this.r[2] = this.v[p++];          // simple code is just the value\n        }\n        else{\n          this.r[0]=(e[this.v[p]-s]+16+64); // non-simple--look up in lists\n          this.r[2]=d[this.v[p++] - s];\n        }\n\n        // fill code-like entries with r\n        f=1<<(k-w);\n        for (j=i>>>w;j<z;j+=f){\n          arrayCopy(this.r, 0, hp, (q+j)*3, 3);\n\t}\n\n\t// backwards increment the k-bit code i\n        for (j = 1 << (k - 1); (i & j)!=0; j >>>= 1){\n          i ^= j;\n\t}\n        i ^= j;\n\n\t// backup over finished tables\n        mask = (1 << w) - 1;      // needed on HP, cc -O bug\n        while ((i & mask) != this.x[h]){\n          h--;                    // don't need to update q\n          w -= l;\n          mask = (1 << w) - 1;\n        }\n      }\n    }\n    // Return Z_BUF_ERROR if we were given an incomplete table\n    return y != 0 && g != 1 ? Z_BUF_ERROR : Z_OK;\n}\n\nInfTree.prototype.inflate_trees_bits = function(c, bb, tb, hp, z) {\n    var result;\n    this.initWorkArea(19);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, 19, 19, null, null, tb, bb, hp, this.hn, this.v);\n\n    if(result == Z_DATA_ERROR){\n      z.msg = \"oversubscribed dynamic bit lengths tree\";\n    }\n    else if(result == Z_BUF_ERROR || bb[0] == 0){\n      z.msg = \"incomplete dynamic bit lengths tree\";\n      result = Z_DATA_ERROR;\n    }\n    return result;\n}\n\nInfTree.prototype.inflate_trees_dynamic = function(nl, nd, c, bl, bd, tl, td, hp, z) {\n    var result;\n\n    // build literal/length tree\n    this.initWorkArea(288);\n    this.hn[0]=0;\n    result = this.huft_build(c, 0, nl, 257, cplens, cplext, tl, bl, hp, this.hn, this.v);\n    if (result != Z_OK || bl[0] == 0){\n      if(result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed literal/length tree\";\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"incomplete literal/length tree\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    // build distance tree\n    this.initWorkArea(288);\n    result = this.huft_build(c, nl, nd, 0, cpdist, cpdext, td, bd, hp, this.hn, this.v);\n\n    if (result != Z_OK || (bd[0] == 0 && nl > 257)){\n      if (result == Z_DATA_ERROR){\n        z.msg = \"oversubscribed distance tree\";\n      }\n      else if (result == Z_BUF_ERROR) {\n        z.msg = \"incomplete distance tree\";\n        result = Z_DATA_ERROR;\n      }\n      else if (result != Z_MEM_ERROR){\n        z.msg = \"empty distance tree with lengths\";\n        result = Z_DATA_ERROR;\n      }\n      return result;\n    }\n\n    return Z_OK;\n}\n/*\n  static int inflate_trees_fixed(int[] bl,  //literal desired/actual bit depth\n                                 int[] bd,  //distance desired/actual bit depth\n                                 int[][] tl,//literal/length tree result\n                                 int[][] td,//distance tree result\n                                 ZStream z  //for memory allocation\n\t\t\t\t ){\n\n*/\n\nfunction inflate_trees_fixed(bl, bd, tl, td, z) {\n    bl[0]=fixed_bl;\n    bd[0]=fixed_bd;\n    tl[0]=fixed_tl;\n    td[0]=fixed_td;\n    return Z_OK;\n}\n\nInfTree.prototype.initWorkArea = function(vsize){\n    if(this.hn==null){\n        this.hn=new Int32Array(1);\n        this.v=new Int32Array(vsize);\n        this.c=new Int32Array(BMAX+1);\n        this.r=new Int32Array(3);\n        this.u=new Int32Array(BMAX);\n        this.x=new Int32Array(BMAX+1);\n    }\n    if(this.v.length<vsize){\n        this.v=new Int32Array(vsize);\n    }\n    for(var i=0; i<vsize; i++){this.v[i]=0;}\n    for(var i=0; i<BMAX+1; i++){this.c[i]=0;}\n    for(var i=0; i<3; i++){this.r[i]=0;}\n//  for(int i=0; i<BMAX; i++){u[i]=0;}\n    arrayCopy(this.c, 0, this.u, 0, BMAX);\n//  for(int i=0; i<BMAX+1; i++){x[i]=0;}\n    arrayCopy(this.c, 0, this.x, 0, BMAX+1);\n}\n\nvar testArray = new Uint8Array(1);\nvar hasSubarray = (typeof testArray.subarray === 'function');\nvar hasSlice = false; /* (typeof testArray.slice === 'function'); */ // Chrome slice performance is so dire that we're currently not using it...\n\nfunction arrayCopy(src, srcOffset, dest, destOffset, count) {\n    if (count == 0) {\n        return;\n    }\n    if (!src) {\n        throw \"Undef src\";\n    } else if (!dest) {\n        throw \"Undef dest\";\n    }\n\n    if (srcOffset == 0 && count == src.length) {\n        arrayCopy_fast(src, dest, destOffset);\n    } else if (hasSubarray) {\n        arrayCopy_fast(src.subarray(srcOffset, srcOffset + count), dest, destOffset);\n    } else if (src.BYTES_PER_ELEMENT == 1 && count > 100) {\n        arrayCopy_fast(new Uint8Array(src.buffer, src.byteOffset + srcOffset, count), dest, destOffset);\n    } else {\n        arrayCopy_slow(src, srcOffset, dest, destOffset, count);\n    }\n\n}\n\nfunction arrayCopy_slow(src, srcOffset, dest, destOffset, count) {\n\n    // dlog('_slow call: srcOffset=' + srcOffset + '; destOffset=' + destOffset + '; count=' + count);\n\n     for (var i = 0; i < count; ++i) {\n        dest[destOffset + i] = src[srcOffset + i];\n    }\n}\n\nfunction arrayCopy_fast(src, dest, destOffset) {\n    dest.set(src, destOffset);\n}\n\n\n  // largest prime smaller than 65536\nvar ADLER_BASE=65521;\n  // NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) <= 2^32-1\nvar ADLER_NMAX=5552;\n\nfunction adler32(adler, /* byte[] */ buf,  index, len){\n    if(buf == null){ return 1; }\n\n    var s1=adler&0xffff;\n    var s2=(adler>>16)&0xffff;\n    var k;\n\n    while(len > 0) {\n      k=len<ADLER_NMAX?len:ADLER_NMAX;\n      len-=k;\n      while(k>=16){\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        s1+=buf[index++]&0xff; s2+=s1;\n        k-=16;\n      }\n      if(k!=0){\n        do{\n          s1+=buf[index++]&0xff; s2+=s1;\n        }\n        while(--k!=0);\n      }\n      s1%=ADLER_BASE;\n      s2%=ADLER_BASE;\n    }\n    return (s2<<16)|s1;\n}\n\n\n\nfunction jszlib_inflate_buffer(buffer, start, length, afterUncOffset) {\n    if (!start) {\n        buffer = new Uint8Array(buffer);\n    } else if (!length) {\n        buffer = new Uint8Array(buffer, start, buffer.byteLength - start);\n    } else {\n        buffer = new Uint8Array(buffer, start, length);\n    }\n\n    var z = new ZStream();\n    z.inflateInit(DEF_WBITS, true);\n    z.next_in = buffer;\n    z.next_in_index = 0;\n    z.avail_in = buffer.length;\n\n    var oBlockList = [];\n    var totalSize = 0;\n    while (true) {\n        var obuf = new Uint8Array(32000);\n        z.next_out = obuf;\n        z.next_out_index = 0;\n        z.avail_out = obuf.length;\n        var status = z.inflate(Z_NO_FLUSH);\n        if (status != Z_OK && status != Z_STREAM_END && status != Z_BUF_ERROR) {\n            throw z.msg;\n        }\n        if (z.avail_out != 0) {\n            var newob = new Uint8Array(obuf.length - z.avail_out);\n            arrayCopy(obuf, 0, newob, 0, (obuf.length - z.avail_out));\n            obuf = newob;\n        }\n        oBlockList.push(obuf);\n        totalSize += obuf.length;\n        if (status == Z_STREAM_END || status == Z_BUF_ERROR) {\n            break;\n        }\n    }\n\n    if (afterUncOffset) {\n        afterUncOffset[0] = (start || 0) + z.next_in_index;\n    }\n\n    if (oBlockList.length == 1) {\n        return oBlockList[0].buffer;\n    } else {\n        var out = new Uint8Array(totalSize);\n        var cursor = 0;\n        for (var i = 0; i < oBlockList.length; ++i) {\n            var b = oBlockList[i];\n            arrayCopy(b, 0, out, cursor, b.length);\n            cursor += b.length;\n        }\n        return out.buffer;\n    }\n}\n\nreturn {\n    inflateBuffer: jszlib_inflate_buffer,\n    arrayCopy: arrayCopy\n  };\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./galaxy/scripts/libs/bbi/jszlib.js\n// module id = 37\n// module chunks = 0 1 2 3 4","//     jQuery Ajax Native Plugin\n\n//     (c) 2015 Tarik Zakaria Benmerar, Acigna Inc.\n//      jQuery Ajax Native Plugin may be freely distributed under the MIT license.\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['jquery'], factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('jquery'));\n    } else {\n        // Browser globals (root is window)\n        factory(root.jQuery);\n    }\n}(this, function ( $ ) {\n    var ajaxSettings = $.ajaxSettings;\n    ajaxSettings.responseFields.native = 'responseNative';\n    ajaxSettings.converters[ '* native' ] = true;\n    var support = {},\n        xhrId = 0,\n        xhrSuccessStatus = {\n            // file protocol always yields status code 0, assume 200\n            0: 200,\n            // Support: IE9\n            // #1450: sometimes IE returns 1223 when it should be 204\n            1223: 204\n        },\n        xhrCallbacks = {},\n        xhrSupported = jQuery.ajaxSettings.xhr();\n    // Support: IE9\n    // Open requests must be manually aborted on unload (#5280)\n    if ( window.ActiveXObject ) {\n        $( window ).on( \"unload\", function() {\n            for ( var key in xhrCallbacks ) {\n                xhrCallbacks[ key ]();\n            }\n        });\n    }\n    support.cors = !!xhrSupported && ( \"withCredentials\" in xhrSupported );\n    support.ajax = xhrSupported = !!xhrSupported;\n\n    //Native Data Type Ajax Transport\n    $.ajaxTransport('native', function ( options ) {\n        var callback;\n        // Cross domain only allowed if supported through XMLHttpRequest\n        if ( support.cors || xhrSupported && !options.crossDomain ) {\n            return {\n                send: function( headers, complete ) {\n                    var i,\n                        xhr = options.xhr(),\n                        id = ++xhrId,\n                        responses = {};\n\n                    xhr.open( options.type, options.url, options.async, options.username, options.password );\n\n                    // Apply custom fields if provided\n                    if ( options.xhrFields ) {\n                        for ( i in options.xhrFields ) {\n                            xhr[ i ] = options.xhrFields[ i ];\n                        }\n                    }\n\n                    // Override mime type if needed\n                    if ( options.mimeType && xhr.overrideMimeType ) {\n                        xhr.overrideMimeType( options.mimeType );\n                    }\n\n                    // X-Requested-With header\n                    // For cross-domain requests, seeing as conditions for a preflight are\n                    // akin to a jigsaw puzzle, we simply never set it to be sure.\n                    // (it can always be set on a per-request basis or even using ajaxSetup)\n                    // For same-domain requests, won't change header if already provided.\n                    if ( !options.crossDomain && !headers[\"X-Requested-With\"] ) {\n                        headers[\"X-Requested-With\"] = \"XMLHttpRequest\";\n                    }\n\n                    // Set headers\n                    for ( i in headers ) {\n                        xhr.setRequestHeader( i, headers[ i ] );\n                    }\n\n                    // Callback\n                    callback = function( type ) {\n                        return function() {\n                            if ( callback ) {\n                                delete xhrCallbacks[ id ];\n                                callback = xhr.onload = xhr.onerror = null;\n\n                                if ( type === \"abort\" ) {\n                                    xhr.abort();\n                                } else if ( type === \"error\" ) {\n                                    complete(\n                                        // file: protocol always yields status 0; see #8605, #14207\n                                        xhr.status,\n                                        xhr.statusText\n                                    );\n                                } else {\n                                    // The native response associated with the responseType\n                                    // Stored in the xhr.response attribute (XHR2 Spec)\n                                    if ( xhr.response ) {\n                                        responses.native = xhr.response;\n                                    }\n\n                                    complete(\n                                        xhrSuccessStatus[ xhr.status ] || xhr.status,\n                                        xhr.statusText,\n                                        responses,\n                                        xhr.getAllResponseHeaders()\n                                    );\n                                }\n                            }\n                        };\n                    };\n\n                    // Listen to events\n                    xhr.onload = callback();\n                    xhr.onerror = callback(\"error\");\n\n                    // Create the abort callback\n                    callback = xhrCallbacks[ id ] = callback(\"abort\");\n\n                    try {\n                        // Do send the request (this may raise an exception)\n                        xhr.send( options.hasContent && options.data || null );\n                    } catch ( e ) {\n                        // #14683: Only rethrow if this hasn't been notified as an error yet\n                        if ( callback ) {\n                            throw e;\n                        }\n                    }\n                },\n\n                abort: function() {\n                    if ( callback ) {\n                        callback();\n                    }\n                }\n            };\n        }\n    });\n\n\n    //$.getNative wrapper\n    $.getNative = function ( url, callback ) {\n        return $.ajax({\n            dataType: 'native',\n            url: url,\n            xhrFields: {\n                responseType: 'arraybuffer'\n            },\n            success: callback\n        });\n    }\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./galaxy/scripts/libs/bbi/jquery-ajax-native.js\n// module id = 38\n// module chunks = 0 1 2 3 4","import * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n */\nvar User = Backbone.Model.extend(baseMVC.LoggableMixin).extend(\n    /** @lends User.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** API location for this resource */\n        urlRoot: function() {\n            return `${Galaxy.root}api/users`;\n        },\n\n        /** Model defaults\n         *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n         *      a safer method is if( !user.get( 'email' ) ) -> anon user\n         */\n        defaults: /** @lends User.prototype */ {\n            id: null,\n            username: `(${_l(\"anonymous user\")})`,\n            email: \"\",\n            total_disk_usage: 0,\n            nice_total_disk_usage: \"\",\n            quota_percent: null,\n            is_admin: false\n        },\n\n        /** Set up and bind events\n         *  @param {Object} data Initial model data.\n         */\n        initialize: function(data) {\n            this.log(\"User.initialize:\", data);\n\n            this.on(\"loaded\", function(model, resp) {\n                this.log(`${this} has loaded:`, model, resp);\n            });\n            this.on(\"change\", function(model, data) {\n                this.log(`${this} has changed:`, model, data.changes);\n            });\n        },\n\n        isAnonymous: function() {\n            return !this.get(\"email\");\n        },\n\n        isAdmin: function() {\n            return this.get(\"is_admin\");\n        },\n\n        /** Load a user with the API using an id.\n         *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n         *      (e.g. 'current') and the API will return the current transaction's user data.\n         *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n         *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n         *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n         */\n        loadFromApi: function(idOrCurrent, options) {\n            idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n            options = options || {};\n            var model = this;\n            var userFn = options.success;\n\n            /** @ignore */\n            options.success = (newModel, response) => {\n                model.trigger(\"loaded\", newModel, response);\n                if (userFn) {\n                    userFn(newModel, response);\n                }\n            };\n\n            // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n            if (idOrCurrent === User.CURRENT_ID_STR) {\n                options.url = `${this.urlRoot}/${User.CURRENT_ID_STR}`;\n            }\n            return Backbone.Model.prototype.fetch.call(this, options);\n        },\n\n        /** Clears all data from the sessionStorage.\n         */\n        clearSessionStorage: function() {\n            for (var key in sessionStorage) {\n                //TODO: store these under the user key so we don't have to do this\n                // currently only history\n                if (key.indexOf(\"history:\") === 0) {\n                    sessionStorage.removeItem(key);\n                } else if (key === \"history-panel\") {\n                    sessionStorage.removeItem(key);\n                }\n            }\n        },\n\n        /** string representation */\n        toString: function() {\n            var userInfo = [this.get(\"username\")];\n            if (this.get(\"id\")) {\n                userInfo.unshift(this.get(\"id\"));\n                userInfo.push(this.get(\"email\"));\n            }\n            return `User(${userInfo.join(\":\")})`;\n        }\n    }\n);\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = \"current\";\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = options => {\n    var currentUser = new User();\n    currentUser.loadFromApi(User.CURRENT_ID_STR, options);\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\nvar UserCollection = Backbone.Collection.extend(baseMVC.LoggableMixin).extend({\n    model: User,\n    urlRoot: function() {\n        return `${Galaxy.root}api/users`;\n    }\n    //logger  : console,\n});\n\n//==============================================================================\nexport default {\n    User: User\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/user/user-model.js","import Utils from \"utils/utils\";\nimport Menu from \"layout/menu\";\nimport Scratchbook from \"layout/scratchbook\";\nimport QuotaMeter from \"mvc/user/user-quotameter\";\n/** Masthead **/\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.options = options;\n        this.setElement(this._template());\n        this.$navbarBrandLink = this.$(\".navbar-brand-link\");\n        this.$navbarBrandImage = this.$(\".navbar-brand-image\");\n        this.$navbarBrandTitle = this.$(\".navbar-brand-title\");\n        this.$navbarTabs = this.$(\".navbar-tabs\");\n        this.$quoteMeter = this.$(\".quota-meter-container\");\n\n        // build tabs\n        this.collection = new Menu.Collection();\n        this.collection\n            .on(\"add\", model => {\n                self.$navbarTabs.append(new Menu.Tab({ model: model }).render().$el);\n            })\n            .on(\"reset\", () => {\n                self.$navbarTabs.empty();\n            })\n            .on(\"dispatch\", callback => {\n                self.collection.each(m => {\n                    callback(m);\n                });\n            })\n            .fetch(this.options);\n\n        // scratchbook\n        Galaxy.frame = this.frame = new Scratchbook({\n            collection: this.collection\n        });\n\n        // set up the quota meter (And fetch the current user data from trans)\n        // add quota meter to masthead\n        Galaxy.quotaMeter = this.quotaMeter = new QuotaMeter.UserQuotaMeter({\n            model: Galaxy.user,\n            el: this.$quoteMeter\n        });\n\n        // loop through beforeunload functions if the user attempts to unload the page\n        $(window)\n            .on(\"click\", e => {\n                var $download_link = $(e.target).closest(\"a[download]\");\n                if ($download_link.length == 1) {\n                    if ($(\"iframe[id=download]\").length === 0) {\n                        $(\"body\").append(\n                            $(\"<iframe/>\")\n                                .attr(\"id\", \"download\")\n                                .hide()\n                        );\n                    }\n                    $(\"iframe[id=download]\").attr(\"src\", $download_link.attr(\"href\"));\n                    e.preventDefault();\n                }\n            })\n            .on(\"beforeunload\", () => {\n                var text = \"\";\n                self.collection.each(model => {\n                    var q = model.get(\"onbeforeunload\") && model.get(\"onbeforeunload\")();\n                    q && (text += `${q} `);\n                });\n                if (text !== \"\") {\n                    return text;\n                }\n            });\n    },\n\n    render: function() {\n        this.$navbarBrandTitle.html(`Galaxy ${(this.options.brand && `/ ${this.options.brand}`) || \"\"}`);\n        this.$navbarBrandLink.attr(\"href\", this.options.logo_url);\n        this.$navbarBrandImage.attr(\"src\", this.options.logo_src);\n        this.quotaMeter.render();\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return (\n            '<div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n            '<div class=\"navbar-header\">' +\n            '<div class=\"navbar-tabs\"/>' +\n            \"</div>\" +\n            '<div class=\"navbar-brand\">' +\n            '<a class=\"navbar-brand-link\">' +\n            '<img class=\"navbar-brand-image\"/>' +\n            '<span class=\"navbar-brand-title\"/>' +\n            \"</a>\" +\n            \"</div>\" +\n            '<div class=\"quota-meter-container\"/>' +\n            '<div class=\"navbar-icons\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/masthead.js","/** Masthead Collection **/\nimport GenericNav from \"layout/generic-nav-view\";\nimport Webhooks from \"mvc/webhooks\";\nimport _l from \"utils/localization\";\nimport Utils from \"utils/utils\";\nvar Collection = Backbone.Collection.extend({\n    model: Backbone.Model.extend({\n        defaults: {\n            visible: true,\n            target: \"_parent\"\n        }\n    }),\n    fetch: function(options) {\n        var self = this;\n        options = options || {};\n        this.reset();\n\n        //\n        // Chat server tab\n        //\n        var extendedNavItem = new GenericNav.GenericNavView();\n        this.add(extendedNavItem.render());\n\n        //\n        // Analyze data tab.\n        //\n        this.add({\n            id: \"analysis\",\n            title: _l(\"Analyze Data\"),\n            url: \"\",\n            tooltip: _l(\"Analysis home view\")\n        });\n\n        //\n        // Workflow tab.\n        //\n        this.add({\n            id: \"workflow\",\n            title: _l(\"Workflow\"),\n            tooltip: _l(\"Chain tools into workflows\"),\n            disabled: !Galaxy.user.id,\n            url: \"workflow\"\n        });\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        this.add({\n            id: \"shared\",\n            title: _l(\"Shared Data\"),\n            url: \"library/index\",\n            tooltip: _l(\"Access published resources\"),\n            menu: [\n                {\n                    title: _l(\"Data Libraries\"),\n                    url: \"library/list\"\n                },\n                {\n                    title: _l(\"Histories\"),\n                    url: \"histories/list_published\"\n                },\n                {\n                    title: _l(\"Workflows\"),\n                    url: \"workflows/list_published\"\n                },\n                {\n                    title: _l(\"Visualizations\"),\n                    url: \"visualizations/list_published\"\n                },\n                {\n                    title: _l(\"Pages\"),\n                    url: \"pages/list_published\"\n                }\n            ]\n        });\n\n        //\n        // Visualization tab.\n        //\n        this.add({\n            id: \"visualization\",\n            title: _l(\"Visualization\"),\n            url: \"visualizations/list\",\n            tooltip: _l(\"Visualize datasets\"),\n            disabled: !Galaxy.user.id,\n            menu: [\n                {\n                    title: _l(\"New Track Browser\"),\n                    url: \"visualization/trackster\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Saved Visualizations\"),\n                    url: \"visualizations/list\",\n                    target: \"_frame\"\n                },\n                {\n                    title: _l(\"Interactive Environments\"),\n                    url: \"visualization/gie_list\",\n                    target: \"galaxy_main\"\n                }\n            ]\n        });\n\n        //\n        // Webhooks\n        //\n        Webhooks.add({\n            url: \"api/webhooks/masthead/all\",\n            callback: function(webhooks) {\n                $(document).ready(() => {\n                    $.each(webhooks.models, (index, model) => {\n                        var webhook = model.toJSON();\n                        if (webhook.activate) {\n                            var obj = {\n                                id: webhook.name,\n                                icon: webhook.config.icon,\n                                url: webhook.config.url,\n                                tooltip: webhook.config.tooltip,\n                                onclick: webhook.config.function && new Function(webhook.config.function)\n                            };\n\n                            // Galaxy.page is undefined for data libraries, workflows pages\n                            if (Galaxy.page) {\n                                Galaxy.page.masthead.collection.add(obj);\n                            } else if (Galaxy.masthead) {\n                                Galaxy.masthead.collection.add(obj);\n                            }\n\n                            // Append masthead script and styles to Galaxy main\n                            Utils.appendScriptStyle(webhook);\n                        }\n                    });\n                });\n            }\n        });\n\n        //\n        // Admin.\n        //\n        Galaxy.user.get(\"is_admin\") &&\n            this.add({\n                id: \"admin\",\n                title: _l(\"Admin\"),\n                url: \"admin\",\n                tooltip: _l(\"Administer this Galaxy\"),\n                cls: \"admin-only\"\n            });\n\n        //\n        // Help tab.\n        //\n        var helpTab = {\n            id: \"help\",\n            title: _l(\"Help\"),\n            tooltip: _l(\"Support, contact, and community\"),\n            menu: [\n                {\n                    title: _l(\"Support\"),\n                    url: options.support_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Search\"),\n                    url: options.search_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Mailing Lists\"),\n                    url: options.mailing_lists,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Videos\"),\n                    url: options.screencasts_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Wiki\"),\n                    url: options.wiki_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"How to Cite Galaxy\"),\n                    url: options.citation_url,\n                    target: \"_blank\"\n                },\n                {\n                    title: _l(\"Interactive Tours\"),\n                    url: \"tours\"\n                }\n            ]\n        };\n        options.terms_url &&\n            helpTab.menu.push({\n                title: _l(\"Terms and Conditions\"),\n                url: options.terms_url,\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Ask a question\"),\n                url: \"biostar/biostar_question_redirect\",\n                target: \"_blank\"\n            });\n        options.biostar_url &&\n            helpTab.menu.unshift({\n                title: _l(\"Galaxy Biostar\"),\n                url: options.biostar_url_redirect,\n                target: \"_blank\"\n            });\n        this.add(helpTab);\n\n        //\n        // User tab.\n        //\n        var userTab = {};\n        if (!Galaxy.user.id) {\n            if (options.allow_user_creation) {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login or Register\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Account registration or login\"),\n                    menu: [\n                        {\n                            title: _l(\"Login\"),\n                            url: \"user/login\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        },\n                        {\n                            title: _l(\"Register\"),\n                            url: \"user/create\",\n                            target: \"galaxy_main\",\n                            noscratchbook: true\n                        }\n                    ]\n                };\n            } else {\n                userTab = {\n                    id: \"user\",\n                    title: _l(\"Login\"),\n                    cls: \"loggedout-only\",\n                    tooltip: _l(\"Login\"),\n                    url: \"user/login\",\n                    target: \"galaxy_main\",\n                    noscratchbook: true\n                };\n            }\n        } else {\n            userTab = {\n                id: \"user\",\n                title: _l(\"User\"),\n                cls: \"loggedin-only\",\n                tooltip: _l(\"Account and saved data\"),\n                menu: [\n                    {\n                        title: `${_l(\"Logged in as\")} ${Galaxy.user.get(\"email\")}`\n                    },\n                    {\n                        title: _l(\"Preferences\"),\n                        url: \"user\"\n                    },\n                    {\n                        title: _l(\"Custom Builds\"),\n                        url: \"custom_builds\"\n                    },\n                    {\n                        title: _l(\"Logout\"),\n                        url: `user/logout?session_csrf_token=${Galaxy.session_csrf_token}`,\n                        target: \"_top\",\n                        divider: true\n                    },\n                    {\n                        title: _l(\"Saved Histories\"),\n                        url: \"histories/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Datasets\"),\n                        url: \"datasets/list\",\n                        target: \"_top\"\n                    },\n                    {\n                        title: _l(\"Saved Pages\"),\n                        url: \"pages/list\",\n                        target: \"_top\"\n                    }\n                ]\n            };\n        }\n        this.add(userTab);\n        var activeView = this.get(options.active_view);\n        activeView && activeView.set(\"active\", true);\n        return new jQuery.Deferred().resolve().promise();\n    }\n});\n\n/** Masthead tab **/\nvar Tab = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$dropdown = this.$(\".dropdown\");\n        this.$toggle = this.$(\".dropdown-toggle\");\n        this.$menu = this.$(\".dropdown-menu\");\n        this.$note = this.$(\".dropdown-note\");\n        this.listenTo(this.model, \"change\", this.render, this);\n    },\n\n    events: {\n        \"click .dropdown-toggle\": \"_toggleClick\"\n    },\n\n    render: function() {\n        var self = this;\n        $(\".tooltip\").remove();\n        this.$el.attr(\"id\", this.model.id).css({\n            visibility: (this.model.get(\"visible\") && \"visible\") || \"hidden\"\n        });\n        this.model.set(\"url\", this._formatUrl(this.model.get(\"url\")));\n        this.$note\n            .html(this.model.get(\"note\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-note\")\n            .addClass(this.model.get(\"note_cls\"))\n            .css({\n                display: (this.model.get(\"show_note\") && \"block\") || \"none\"\n            });\n        this.$toggle\n            .html(this.model.get(\"title\") || \"\")\n            .removeClass()\n            .addClass(\"dropdown-toggle\")\n            .addClass(this.model.get(\"cls\"))\n            .addClass(this.model.get(\"icon\") && `dropdown-icon fa ${this.model.get(\"icon\")}`)\n            .addClass(this.model.get(\"toggle\") && \"toggle\")\n            .attr(\"target\", this.model.get(\"target\"))\n            .attr(\"href\", this.model.get(\"url\"))\n            .attr(\"title\", this.model.get(\"tooltip\"))\n            .tooltip(\"destroy\");\n        this.model.get(\"tooltip\") && this.$toggle.tooltip({ placement: \"bottom\" });\n        this.$dropdown\n            .removeClass()\n            .addClass(\"dropdown\")\n            .addClass(this.model.get(\"disabled\") && \"disabled\")\n            .addClass(this.model.get(\"active\") && \"active\");\n        if (this.model.get(\"menu\") && this.model.get(\"show_menu\")) {\n            this.$menu.show();\n            $(\"#dd-helper\")\n                .show()\n                .off()\n                .on(\"click\", () => {\n                    $(\"#dd-helper\").hide();\n                    self.model.set(\"show_menu\", false);\n                });\n        } else {\n            self.$menu.hide();\n            $(\"#dd-helper\").hide();\n        }\n        this.$menu.empty().removeClass(\"dropdown-menu\");\n        if (this.model.get(\"menu\")) {\n            _.each(this.model.get(\"menu\"), menuItem => {\n                self.$menu.append(self._buildMenuItem(menuItem));\n                menuItem.divider && self.$menu.append($(\"<li/>\").addClass(\"divider\"));\n            });\n            self.$menu.addClass(\"dropdown-menu\");\n            self.$toggle.append($(\"<b/>\").addClass(\"caret\"));\n        }\n        return this;\n    },\n\n    /** Add new menu item */\n    _buildMenuItem: function(options) {\n        var self = this;\n        options = _.defaults(options || {}, {\n            title: \"\",\n            url: \"\",\n            target: \"_parent\",\n            noscratchbook: false\n        });\n        options.url = self._formatUrl(options.url);\n        return $(\"<li/>\").append(\n            $(\"<a/>\")\n                .attr(\"href\", options.url)\n                .attr(\"target\", options.target)\n                .html(options.title)\n                .on(\"click\", e => {\n                    e.preventDefault();\n                    self.model.set(\"show_menu\", false);\n                    if (options.onclick) {\n                        options.onclick();\n                    } else {\n                        Galaxy.frame.add(options);\n                    }\n                })\n        );\n    },\n\n    /** Handle click event */\n    _toggleClick: function(e) {\n        var self = this;\n        var model = this.model;\n        e.preventDefault();\n        $(\".tooltip\").hide();\n        model.trigger(\"dispatch\", m => {\n            model.id !== m.id && m.get(\"menu\") && m.set(\"show_menu\", false);\n        });\n        if (!model.get(\"disabled\")) {\n            if (!model.get(\"menu\")) {\n                model.get(\"onclick\") ? model.get(\"onclick\")() : Galaxy.frame.add(model.attributes);\n            } else {\n                model.set(\"show_menu\", true);\n            }\n        } else {\n            function buildLink(label, url) {\n                return $(\"<div/>\")\n                    .append(\n                        $(\"<a/>\")\n                            .attr(\"href\", Galaxy.root + url)\n                            .html(label)\n                    )\n                    .html();\n            }\n            this.$toggle.popover && this.$toggle.popover(\"destroy\");\n            this.$toggle\n                .popover({\n                    html: true,\n                    placement: \"bottom\",\n                    content: `Please ${buildLink(\"login\", \"user/login?use_panels=True\")} or ${buildLink(\n                        \"register\",\n                        \"user/create?use_panels=True\"\n                    )} to use this feature.`\n                })\n                .popover(\"show\");\n            setTimeout(() => {\n                self.$toggle.popover(\"destroy\");\n            }, 5000);\n        }\n    },\n\n    /** Url formatting */\n    _formatUrl: function(url) {\n        return typeof url == \"string\" && url.indexOf(\"//\") === -1 && url.charAt(0) != \"/\" ? Galaxy.root + url : url;\n    },\n\n    /** body tempate */\n    _template: function() {\n        return (\n            '<ul class=\"nav navbar-nav\">' +\n            '<li class=\"dropdown\">' +\n            '<a class=\"dropdown-toggle\"/>' +\n            '<ul class=\"dropdown-menu\"/>' +\n            '<div class=\"dropdown-note\"/>' +\n            \"</li>\" +\n            \"</ul>\"\n        );\n    }\n});\n\nexport default {\n    Collection: Collection,\n    Tab: Tab\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/menu.js","/** Real-time Communication feature **/\nimport Modal from \"mvc/ui/ui-modal\";\nvar GenericNavView = Backbone.View.extend({\n    initialize: function() {\n        this.modal = null;\n    },\n\n    /** makes bootstrap modal and iframe inside it */\n    makeModalIframe: function(e) {\n        // make modal\n        var host = window.Galaxy.config.communication_server_host;\n\n        var port = window.Galaxy.config.communication_server_port;\n        var username = escape(window.Galaxy.user.attributes.username);\n\n        var persistent_communication_rooms = escape(window.Galaxy.config.persistent_communication_rooms);\n\n        var query_string = `?username=${username}&persistent_communication_rooms=${persistent_communication_rooms}`;\n\n        var src = `${host}:${port}${query_string}`;\n        var $el_chat_modal_header = null;\n        var $el_chat_modal_body = null;\n\n        var iframe_template = `<iframe class=\"f-iframe fade in communication-iframe\" src=\"${src}\"> </iframe>`;\n\n        var header_template =\n            '<i class=\"fa fa-comment\" aria-hidden=\"true\" title=\"Communicate with other users\"></i>' +\n            '<i class=\"fa fa-expand expand-compress-modal\" aria-hidden=\"true\" title=\"Maximize\"></i>' +\n            '<i class=\"fa fa-times close-modal\" aria-hidden=\"true\" title=\"Close\"></i>';\n\n        var frame_height = 350;\n        var frame_width = 600;\n        var class_names = \"ui-modal chat-modal\";\n\n        // deletes the chat modal if already present and create one\n        if ($(\".chat-modal\").length > 0) {\n            $(\".chat-modal\").remove();\n        }\n        // creates a modal\n        GenericNavView.modal = new Modal.View({\n            body: iframe_template,\n            height: frame_height,\n            width: frame_width,\n            closing_events: true,\n            title_separator: false,\n            cls: class_names\n        });\n\n        // shows modal\n        GenericNavView.modal.show();\n        $el_chat_modal_header = $(\".chat-modal .modal-header\");\n        $el_chat_modal_body = $(\".chat-modal .modal-body\");\n        // adjusts the css of bootstrap modal for chat\n        $el_chat_modal_header.addClass(\"modal-header-body\");\n        $el_chat_modal_body.addClass(\"modal-header-body\");\n        $el_chat_modal_header.find(\"h4\").remove();\n        $el_chat_modal_header.removeAttr(\"min-height padding border\");\n        $el_chat_modal_header.append(header_template);\n        // click event of the close button for chat\n        $(\".close-modal\").click(e => {\n            $(\".chat-modal\").css(\"display\", \"none\");\n        });\n        // click event of expand and compress icon\n        $(\".expand-compress-modal\").click(e => {\n            if ($(\".expand-compress-modal\").hasClass(\"fa-expand\")) {\n                $(\".chat-modal .modal-dialog\").width(\"1000px\");\n                $(\".chat-modal .modal-body\").height(\"575px\");\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-expand\")\n                    .addClass(\"fa-compress\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Minimize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"96.2%\");\n            } else {\n                $(\".chat-modal .modal-dialog\").width(`${frame_width}px`);\n                $(\".chat-modal .modal-body\").height(`${frame_height}px`);\n                $(\".expand-compress-modal\")\n                    .removeClass(\"fa-compress\")\n                    .addClass(\"fa-expand\");\n                $(\".expand-compress-modal\").attr(\"title\", \"Maximize\");\n                $(\".expand-compress-modal\").css(\"margin-left\", \"93.2%\");\n            }\n        });\n        return this;\n    },\n\n    /**renders the chat icon as a nav item*/\n    render: function() {\n        var self = this;\n        var navItem = {};\n        navItem = {\n            id: \"show-chat-online\",\n            icon: \"fa-comment-o\",\n            tooltip: \"Chat online\",\n            visible: false,\n            onclick: self.makeModalIframe\n        };\n        return navItem;\n    }\n});\n\nexport default {\n    GenericNavView: GenericNavView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/generic-nav-view.js","/** Frame manager uses the ui-frames to create the scratch book masthead icon and functionality **/\nimport Frames from \"mvc/ui/ui-frames\";\nimport DATA from \"mvc/dataset/data\";\nimport visualization from \"viz/visualization\";\nimport trackster from \"viz/trackster\";\nimport _l from \"utils/localization\";\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        options = options || {};\n        this.frames = new Frames.View({ visible: false });\n        this.setElement(this.frames.$el);\n        this.buttonActive = options.collection.add({\n            id: \"enable-scratchbook\",\n            icon: \"fa-th\",\n            tooltip: _l(\"Enable/Disable Scratchbook\"),\n            onclick: function() {\n                self.active = !self.active;\n                self.buttonActive.set({\n                    toggle: self.active,\n                    show_note: self.active,\n                    note_cls: self.active && \"fa fa-check\"\n                });\n                !self.active && self.frames.hide();\n            },\n            onbeforeunload: function() {\n                if (self.frames.length() > 0) {\n                    return `You opened ${self.frames.length()} frame(s) which will be lost.`;\n                }\n            }\n        });\n        this.buttonLoad = options.collection.add({\n            id: \"show-scratchbook\",\n            icon: \"fa-eye\",\n            tooltip: _l(\"Show/Hide Scratchbook\"),\n            show_note: true,\n            visible: false,\n            onclick: function(e) {\n                self.frames.visible ? self.frames.hide() : self.frames.show();\n            }\n        });\n        this.frames\n            .on(\"add remove\", function() {\n                this.visible && this.length() == 0 && this.hide();\n                self.buttonLoad.set({\n                    note: this.length(),\n                    visible: this.length() > 0\n                });\n            })\n            .on(\"show hide \", function() {\n                self.buttonLoad.set({\n                    toggle: this.visible,\n                    icon: (this.visible && \"fa-eye\") || \"fa-eye-slash\"\n                });\n            });\n        this.history_cache = {};\n    },\n\n    /** Add a dataset to the frames */\n    addDataset: function(dataset_id) {\n        var self = this;\n        var current_dataset = null;\n        if (Galaxy && Galaxy.currHistoryPanel) {\n            var history_id = Galaxy.currHistoryPanel.collection.historyId;\n            this.history_cache[history_id] = {\n                name: Galaxy.currHistoryPanel.model.get(\"name\"),\n                dataset_ids: []\n            };\n            Galaxy.currHistoryPanel.collection.each(model => {\n                !model.get(\"deleted\") &&\n                    model.get(\"visible\") &&\n                    self.history_cache[history_id].dataset_ids.push(model.get(\"id\"));\n            });\n        }\n        var _findDataset = (dataset, offset) => {\n            if (dataset) {\n                var history_details = self.history_cache[dataset.get(\"history_id\")];\n                if (history_details && history_details.dataset_ids) {\n                    var dataset_list = history_details.dataset_ids;\n                    var pos = dataset_list.indexOf(dataset.get(\"id\"));\n                    if (pos !== -1 && pos + offset >= 0 && pos + offset < dataset_list.length) {\n                        return dataset_list[pos + offset];\n                    }\n                }\n            }\n        };\n        var _loadDatasetOffset = (dataset, offset, frame) => {\n            var new_dataset_id = _findDataset(dataset, offset);\n            if (new_dataset_id) {\n                self._loadDataset(new_dataset_id, (new_dataset, config) => {\n                    current_dataset = new_dataset;\n                    frame.model.set(config);\n                });\n            } else {\n                frame.model.trigger(\"change\");\n            }\n        };\n        this._loadDataset(dataset_id, (dataset, config) => {\n            current_dataset = dataset;\n            self.add(\n                _.extend(\n                    {\n                        menu: [\n                            {\n                                icon: \"fa fa-chevron-circle-left\",\n                                tooltip: \"Previous in History\",\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, -1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, -1);\n                                }\n                            },\n                            {\n                                icon: \"fa fa-chevron-circle-right\",\n                                tooltip: \"Next in History\",\n                                onclick: function(frame) {\n                                    _loadDatasetOffset(current_dataset, 1, frame);\n                                },\n                                disabled: function() {\n                                    return !_findDataset(current_dataset, 1);\n                                }\n                            }\n                        ]\n                    },\n                    config\n                )\n            );\n        });\n    },\n\n    _loadDataset: function(dataset_id, callback) {\n        var self = this;\n        var dataset = new DATA.Dataset({ id: dataset_id });\n        $.when(dataset.fetch()).then(() => {\n            var is_tabular = _.find(\n                [\"tabular\", \"interval\"],\n                data_type => dataset.get(\"data_type\").indexOf(data_type) !== -1\n            );\n            var title = dataset.get(\"name\");\n            var history_details = self.history_cache[dataset.get(\"history_id\")];\n            if (history_details) {\n                title = `${history_details.name}: ${title}`;\n            }\n            callback(\n                dataset,\n                is_tabular\n                    ? {\n                          title: title,\n                          url: null,\n                          content: DATA.createTabularDatasetChunkedView({\n                              model: new DATA.TabularDataset(dataset.toJSON()),\n                              embedded: true,\n                              height: \"100%\"\n                          }).$el\n                      }\n                    : {\n                          title: title,\n                          url: `${Galaxy.root}datasets/${dataset_id}/display/?preview=True`,\n                          content: null\n                      }\n            );\n        });\n    },\n\n    /** Add a trackster visualization to the frames. */\n    addTrackster: function(viz_id) {\n        var self = this;\n        var viz = new visualization.Visualization({ id: viz_id });\n        $.when(viz.fetch()).then(() => {\n            var ui = new trackster.TracksterUI(Galaxy.root);\n\n            // Construct frame config based on dataset's type.\n            var frame_config = {\n                title: viz.get(\"name\"),\n                type: \"other\",\n                content: function(parent_elt) {\n                    // Create view config.\n                    var view_config = {\n                        container: parent_elt,\n                        name: viz.get(\"title\"),\n                        id: viz.id,\n                        // FIXME: this will not work with custom builds b/c the dbkey needed to be encoded.\n                        dbkey: viz.get(\"dbkey\"),\n                        stand_alone: false\n                    };\n\n                    var latest_revision = viz.get(\"latest_revision\");\n                    var drawables = latest_revision.config.view.drawables;\n\n                    // Set up datasets in drawables.\n                    _.each(drawables, d => {\n                        d.dataset = {\n                            hda_ldda: d.hda_ldda,\n                            id: d.dataset_id\n                        };\n                    });\n                    view = ui.create_visualization(\n                        view_config,\n                        latest_revision.config.viewport,\n                        latest_revision.config.view.drawables,\n                        latest_revision.config.bookmarks,\n                        false\n                    );\n                }\n            };\n            self.add(frame_config);\n        });\n    },\n\n    /** Add and display a new frame/window based on options. */\n    add: function(options) {\n        if (options.target == \"_blank\") {\n            window.open(options.url);\n        } else if (options.target == \"_top\" || options.target == \"_parent\" || options.target == \"_self\") {\n            window.location = options.url;\n        } else if (!this.active || options.noscratchbook) {\n            var $galaxy_main = $(window.parent.document).find(\"#galaxy_main\");\n            if (options.target == \"galaxy_main\" || options.target == \"center\") {\n                if ($galaxy_main.length === 0) {\n                    window.location = `${options.url + (options.url.indexOf(\"?\") == -1 ? \"?\" : \"&\")}use_panels=True`;\n                } else {\n                    $galaxy_main.attr(\"src\", options.url);\n                }\n            } else window.location = options.url;\n        } else {\n            this.frames.add(options);\n        }\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/scratchbook.js","import baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"user\";\n//==============================================================================\n/** @class View to display a user's disk/storage usage\n *      either as a progress bar representing the percentage of a quota used\n *      or a simple text element displaying the human readable size used.\n *  @name UserQuotaMeter\n *  @augments Backbone.View\n */\nvar UserQuotaMeter = Backbone.View.extend(baseMVC.LoggableMixin).extend(\n    /** @lends UserQuotaMeter.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** Defaults for optional settings passed to initialize */\n        options: {\n            warnAtPercent: 85,\n            errorAtPercent: 100\n        },\n\n        /** Set up, accept options, and bind events */\n        initialize: function(options) {\n            this.log(`${this}.initialize:`, options);\n            _.extend(this.options, options);\n\n            //this.bind( 'all', function( event, data ){ this.log( this + ' event:', event, data ); }, this );\n            this.listenTo(this.model, \"change:quota_percent change:total_disk_usage\", this.render);\n        },\n\n        /** Re-load user model data from the api */\n        update: function(options) {\n            this.log(`${this} updating user data...`, options);\n            this.model.loadFromApi(this.model.get(\"id\"), options);\n            return this;\n        },\n\n        /** Is the user over their quota (if there is one)?\n         * @returns {Boolean} true if over quota, false if no quota or under quota\n         */\n        isOverQuota: function() {\n            return (\n                this.model.get(\"quota_percent\") !== null &&\n                this.model.get(\"quota_percent\") >= this.options.errorAtPercent\n            );\n        },\n\n        /** Render the meter when they have an applicable quota. Will render as a progress bar\n         *      with their percentage of that quota in text over the bar.\n         *  @fires quota:over when user is over quota (>= this.errorAtPercent)\n         *  @fires quota:under when user is under quota\n         *  @fires quota:under:approaching when user is >= this.warnAtPercent of their quota\n         *  @fires quota:under:ok when user is below this.warnAtPercent\n         *  @returns {jQuery} the rendered meter\n         */\n        _render_quota: function() {\n            var modelJson = this.model.toJSON();\n\n            var //prevPercent = this.model.previous( 'quota_percent' ),\n            percent = modelJson.quota_percent;\n\n            var //meter = $( UserQuotaMeter.templates.quota( modelJson ) );\n            $meter = $(this._templateQuotaMeter(modelJson));\n\n            var $bar = $meter.find(\".progress-bar\");\n            //this.log( this + '.rendering quota, percent:', percent, 'meter:', meter );\n\n            // OVER QUOTA: color the quota bar and show the quota error message\n            if (this.isOverQuota()) {\n                //this.log( '\\t over quota' );\n                $bar.attr(\"class\", \"progress-bar progress-bar-danger\");\n                $meter.find(\".quota-meter-text\").css(\"color\", \"white\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:over\", modelJson);\n\n                // APPROACHING QUOTA: color the quota bar\n            } else if (percent >= this.options.warnAtPercent) {\n                //this.log( '\\t approaching quota' );\n                $bar.attr(\"class\", \"progress-bar progress-bar-warning\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:under quota:under:approaching\", modelJson);\n\n                // otherwise, hide/don't use the msg box\n            } else {\n                $bar.attr(\"class\", \"progress-bar progress-bar-success\");\n                //TODO: only trigger event if state has changed\n                this.trigger(\"quota:under quota:under:ok\", modelJson);\n            }\n            return $meter;\n        },\n\n        /** Render the meter when the user has NO applicable quota. Will render as text\n         *      showing the human readable sum storage their data is using.\n         *  @returns {jQuery} the rendered text\n         */\n        _render_usage: function() {\n            //var usage = $( UserQuotaMeter.templates.usage( this.model.toJSON() ) );\n            var usage = $(this._templateUsage(this.model.toJSON()));\n            this.log(`${this}.rendering usage:`, usage);\n            return usage;\n        },\n\n        /** Render either the quota percentage meter or the human readable disk usage\n         *      depending on whether the user model has quota info (quota_percent === null -> no quota)\n         *  @returns {Object} this UserQuotaMeter\n         */\n        render: function() {\n            //this.log( this + '.rendering' );\n            var meterHtml = null;\n\n            // no quota on server ('quota_percent' === null (can be valid at 0)), show usage instead\n            this.log(`${this}.model.quota_percent:`, this.model.get(\"quota_percent\"));\n            if (this.model.get(\"quota_percent\") === null || this.model.get(\"quota_percent\") === undefined) {\n                meterHtml = this._render_usage();\n\n                // otherwise, render percent of quota (and warning, error)\n            } else {\n                meterHtml = this._render_quota();\n                //TODO: add the original text for unregistered quotas\n                //tooltip = \"Your disk quota is %s.  You can increase your quota by registering a Galaxy account.\"\n            }\n\n            this.$el.html(meterHtml);\n            this.$el.find(\".quota-meter-text\").tooltip();\n            return this;\n        },\n\n        _templateQuotaMeter: function(data) {\n            return [\n                '<div id=\"quota-meter\" class=\"quota-meter progress\">',\n                '<div class=\"progress-bar\" style=\"width: ',\n                data.quota_percent,\n                '%\"></div>',\n                '<div class=\"quota-meter-text\" data-placement=\"left\" style=\"top: 6px\"',\n                data.nice_total_disk_usage\n                    ? ` title=\"Using ${data.nice_total_disk_usage}.  This value is recalculated when you log out.\">`\n                    : \">\",\n                _l(\"Using\"),\n                \" \",\n                data.quota_percent,\n                \"%\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        _templateUsage: function(data) {\n            return [\n                '<div id=\"quota-meter\" class=\"quota-meter\" style=\"background-color: transparent\">',\n                '<div class=\"quota-meter-text\" data-placement=\"left\" data-original-title=\"This value is recalculated when you log out.\" style=\"top: 6px; color: white\">',\n                data.nice_total_disk_usage ? _l(\"Using \") + data.nice_total_disk_usage : \"\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        toString: function() {\n            return `UserQuotaMeter(${this.model})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    UserQuotaMeter: UserQuotaMeter\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/user/user-quotameter.js","/**\n * Popover wrapper\n */\nimport Utils from \"utils/utils\";\nvar View = Backbone.View.extend({\n    optionsDefault: {\n        with_close: true,\n        title: null,\n        placement: \"top\",\n        container: \"body\",\n        body: null\n    },\n\n    initialize: function(options) {\n        this.setElement(this._template());\n        this.uid = Utils.uid();\n        this.options = _.defaults(options || {}, this.optionsDefault);\n        this.options.container.parent().append(this.el);\n        this.$title = this.$(\".popover-title-label\");\n        this.$close = this.$(\".popover-close\");\n        this.$body = this.$(\".popover-content\");\n\n        // add initial content\n        this.options.body && this.append(this.options.body);\n\n        // add event to hide if click is outside of popup and not on container\n        var self = this;\n        $(\"body\").on(`mousedown.${this.uid}`, e => {\n            // the 'is' for buttons that trigger popups\n            // the 'has' for icons within a button that triggers a popup\n            self.visible &&\n                !$(self.options.container).is(e.target) &&\n                !$(self.el).is(e.target) &&\n                $(self.el).has(e.target).length === 0 &&\n                self.hide();\n        });\n    },\n\n    /**\n     * Render popover\n     */\n    render: function() {\n        this.$title.html(this.options.title);\n        this.$el\n            .removeClass()\n            .addClass(\"ui-popover popover fade in\")\n            .addClass(this.options.placement);\n        this.$el.css(this._get_placement(this.options.placement));\n\n        // configure close option\n        var self = this;\n        if (this.options.with_close) {\n            this.$close\n                .on(\"click\", () => {\n                    self.hide();\n                })\n                .show();\n        } else {\n            this.$close.off().hide();\n        }\n    },\n\n    /**\n     * Set the popover title\n     * @params{ String }    newTitle    - New popover title\n     */\n    title: function(newTitle) {\n        if (newTitle !== undefined) {\n            this.options.title = newTitle;\n            this.$title.html(newTitle);\n        }\n    },\n\n    /**\n     * Show popover\n     */\n    show: function() {\n        this.render();\n        this.$el.show();\n        this.visible = true;\n    },\n\n    /**\n     * Hide popover\n     */\n    hide: function() {\n        this.$el.hide();\n        this.visible = false;\n    },\n\n    /**\n     * Append new content to the popover\n     * @params{ Object }  $el - Dom element\n     */\n    append: function($el) {\n        this.$body.append($el);\n    },\n\n    /**\n     * Remove all content\n     */\n    empty: function() {\n        this.$body.empty();\n    },\n\n    /**\n     * Remove popover\n     */\n    remove: function() {\n        $(\"body\").off(`mousedown.${this.uid}`);\n        this.$el.remove();\n    },\n\n    /**\n     * Improve popover location/placement\n     */\n    _get_placement: function(placement) {\n        // get popover dimensions\n        var width = this._get_width(this.$el);\n        var height = this.$el.height();\n\n        // get container details\n        var $container = this.options.container;\n        var container_width = this._get_width($container);\n        var container_height = this._get_height($container);\n        var container_position = $container.position();\n\n        // get position\n        var top;\n\n        var left;\n        top = left = 0;\n        if ([\"top\", \"bottom\"].indexOf(placement) != -1) {\n            left = container_position.left - width + (container_width + width) / 2;\n            switch (placement) {\n                case \"top\":\n                    top = container_position.top - height - 5;\n                    break;\n                case \"bottom\":\n                    top = container_position.top + container_height + 5;\n                    break;\n            }\n        } else {\n            top = container_position.top - height + (container_height + height) / 2;\n            switch (placement) {\n                case \"right\":\n                    left = container_position.left + container_width;\n                    break;\n            }\n        }\n        return { top: top, left: left };\n    },\n\n    /**\n     * Returns padding/margin corrected width\n     */\n    _get_width: function($el) {\n        return (\n            $el.width() +\n            parseInt($el.css(\"padding-left\")) +\n            parseInt($el.css(\"margin-left\")) +\n            parseInt($el.css(\"padding-right\")) +\n            parseInt($el.css(\"margin-right\"))\n        );\n    },\n\n    /**\n     * Returns padding corrected height\n     */\n    _get_height: function($el) {\n        return $el.height() + parseInt($el.css(\"padding-top\")) + parseInt($el.css(\"padding-bottom\"));\n    },\n\n    /**\n     * Return the popover template\n     */\n    _template: function(options) {\n        return (\n            '<div class=\"ui-popover popover fade in\">' +\n            '<div class=\"arrow\"/>' +\n            '<div class=\"popover-title\">' +\n            '<div class=\"popover-title-label\"/>' +\n            '<div class=\"popover-close fa fa-times-circle\"/>' +\n            \"</div>\" +\n            '<div class=\"popover-content\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/ui-popover.js","//==============================================================================\n/** Map of possible HDA/collection/job states to their string equivalents.\n *      A port of galaxy.model.Dataset.states.\n */\nvar STATES = {\n    // NOT ready states\n    /** is uploading and not ready */\n    UPLOAD: \"upload\",\n    /** the job that will produce the dataset queued in the runner */\n    QUEUED: \"queued\",\n    /** the job that will produce the dataset is running */\n    RUNNING: \"running\",\n    /** metadata for the dataset is being discovered/set */\n    SETTING_METADATA: \"setting_metadata\",\n\n    // ready states\n    /** was created without a tool */\n    NEW: \"new\",\n    /** has no data */\n    EMPTY: \"empty\",\n    /** has successfully completed running */\n    OK: \"ok\",\n\n    /** the job that will produce the dataset paused */\n    PAUSED: \"paused\",\n    /** metadata discovery/setting failed or errored (but otherwise ok) */\n    FAILED_METADATA: \"failed_metadata\",\n    //TODO: not in trans.app.model.Dataset.states - is in database\n    /** not accessible to the current user (i.e. due to permissions) */\n    NOT_VIEWABLE: \"noPermission\",\n    /** deleted while uploading */\n    DISCARDED: \"discarded\",\n    /** the tool producing this dataset failed */\n    ERROR: \"error\"\n};\n\nSTATES.READY_STATES = [\n    STATES.OK,\n    STATES.EMPTY,\n    STATES.PAUSED,\n    STATES.FAILED_METADATA,\n    STATES.NOT_VIEWABLE,\n    STATES.DISCARDED,\n    STATES.ERROR\n];\n\nSTATES.NOT_READY_STATES = [STATES.UPLOAD, STATES.QUEUED, STATES.RUNNING, STATES.SETTING_METADATA, STATES.NEW];\n\n//==============================================================================\nexport default STATES;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/states.js","// dependencies\nimport Utils from \"utils/utils\";\n/**\n * A plugin for initializing select2 input items.\n * Make sure the select2 library itself is loaded beforehand.\n * Also the element to which select2 will be appended has to\n * be created before select2 initialization (and passed as option).\n */\nvar View = Backbone.View.extend({\n    // options\n    optionsDefault: {\n        css: \"\",\n        placeholder: \"No data available\",\n        data: [],\n        value: null,\n        multiple: false,\n        minimumInputLength: 0,\n        // example format of initial data: \"id:name,55:anotherrole@role.com,27:role@role.com\"\n        initialData: \"\"\n    },\n\n    // initialize\n    initialize: function(options) {\n        // configure options\n        this.options = Utils.merge(options, this.optionsDefault);\n\n        // create new element\n        this.setElement(this._template(this.options));\n\n        // check if container exists\n        if (!this.options.container) {\n            console.log(\"ui-select::initialize() : container not specified.\");\n            return;\n        }\n\n        // add to dom\n        this.options.container.append(this.$el);\n\n        // link selection dictionary\n        this.select_data = this.options.data;\n\n        // refresh\n        this._refresh();\n\n        if (!this.options.multiple) {\n            // initial value\n            if (this.options.value) {\n                this._setValue(this.options.value);\n            }\n\n            // add change event\n            var self = this;\n            if (this.options.onchange) {\n                this.$el.on(\"change\", () => {\n                    self.options.onchange(self.value());\n                });\n            }\n        }\n    },\n\n    // value\n    value: function(new_value) {\n        // get current id/value\n        var before = this._getValue();\n\n        // check if new_value is defined\n        if (new_value !== undefined) {\n            this._setValue(new_value);\n        }\n\n        // get current id/value\n        var after = this._getValue();\n\n        // fire onchange\n        if (after != before && this.options.onchange) {\n            this.options.onchange(after);\n        }\n\n        // return current value\n        return after;\n    },\n\n    // label\n    text: function() {\n        return this.$el.select2(\"data\").text;\n    },\n\n    // disabled\n    disabled: function() {\n        return !this.$el.select2(\"enable\");\n    },\n\n    // enable\n    enable: function() {\n        this.$el.select2(\"enable\", true);\n    },\n\n    // disable\n    disable: function() {\n        this.$el.select2(\"enable\", false);\n    },\n\n    // add\n    add: function(options) {\n        // add options\n        this.select_data.push({\n            id: options.id,\n            text: options.text\n        });\n\n        // refresh\n        this._refresh();\n    },\n\n    // remove\n    del: function(id) {\n        // search option\n        var index = this._getIndex(id);\n\n        // check if found\n        if (index != -1) {\n            // remove options\n            this.select_data.splice(index, 1);\n\n            // refresh\n            this._refresh();\n        }\n    },\n\n    // remove\n    remove: function() {\n        this.$el.select2(\"destroy\");\n    },\n\n    // update\n    update: function(options) {\n        // copy options\n        this.select_data = [];\n        for (var key in options.data) {\n            this.select_data.push(options.data[key]);\n        }\n\n        // refresh\n        this._refresh();\n    },\n\n    // refresh\n    _refresh: function() {\n        // add select2 data based on type of input\n        if (!this.options.multiple) {\n            var selected = this._getValue();\n            var select_opt = {\n                data: this.select_data,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                dropdownAutoWidth: true\n            };\n            this.$el.select2(select_opt);\n            // select previous value (if exists)\n            this._setValue(selected);\n        } else {\n            var select_opt = {\n                multiple: this.options.multiple,\n                containerCssClass: this.options.css,\n                placeholder: this.options.placeholder,\n                minimumInputLength: this.options.minimumInputLength,\n                ajax: this.options.ajax,\n                dropdownCssClass: this.options.dropdownCssClass,\n                escapeMarkup: this.options.escapeMarkup,\n                formatResult: this.options.formatResult,\n                formatSelection: this.options.formatSelection,\n                initSelection: this.options.initSelection,\n                initialData: this.options.initialData\n            };\n            this.$el.select2(select_opt);\n        }\n    },\n\n    // get index\n    _getIndex: function(value) {\n        // returns the index of the searched value\n        _.findIndex(this.select_data, { id: value });\n    },\n\n    // get value\n    _getValue: function() {\n        return this.$el.select2(\"val\");\n    },\n\n    // set value\n    _setValue: function(new_value) {\n        var index = this._getIndex(new_value);\n        if (index == -1) {\n            if (this.select_data.length > 0) {\n                new_value = this.select_data[0].id;\n            }\n        }\n        this.$el.select2(\"val\", new_value);\n    },\n\n    // element\n    _template: function(options) {\n        return `<input type=\"hidden\" value=\"${this.options.initialData}\"/>`;\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/ui-select.js","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n//============================================================================\n/** Returns a jQuery object containing a clickable font-awesome button.\n *      options:\n *          tooltipConfig   : option map for bootstrap tool tip\n *          classes         : array of class names (will always be classed as icon-btn)\n *          disabled        : T/F - add the 'disabled' class?\n *          title           : tooltip/title string\n *          target          : optional href target\n *          href            : optional href\n *          faIcon          : which font awesome icon to use\n *          onclick         : function to call when the button is clicked\n */\nvar faIconButton = options => {\n    options = options || {};\n    options.tooltipConfig = options.tooltipConfig || {\n        placement: \"bottom\"\n    };\n\n    options.classes = [\"icon-btn\"].concat(options.classes || []);\n    if (options.disabled) {\n        options.classes.push(\"disabled\");\n    }\n\n    var html = [\n        '<a class=\"',\n        options.classes.join(\" \"),\n        '\"',\n        options.title ? ` title=\"${options.title}\"` : \"\",\n        !options.disabled && options.target ? ` target=\"${options.target}\"` : \"\",\n        ' href=\"',\n        !options.disabled && options.href ? options.href : \"javascript:void(0);\",\n        '\">',\n        // could go with something less specific here - like 'html'\n        '<span class=\"fa ',\n        options.faIcon,\n        '\"></span>',\n        \"</a>\"\n    ].join(\"\");\n    var $button = $(html).tooltip(options.tooltipConfig);\n    if (_.isFunction(options.onclick)) {\n        $button.click(options.onclick);\n    }\n    return $button;\n};\n\n//============================================================================\nexport default faIconButton;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/ui/fa-icon-button.js","import * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport userModel from \"mvc/user/user-model\";\nimport metricsLogger from \"utils/metrics-logger\";\nimport addLogging from \"utils/add-logging\";\nimport localize from \"utils/localization\";\n// TODO: move into a singleton pattern and have dependents import Galaxy\n// ============================================================================\n/** Base galaxy client-side application.\n *      Iniitializes:\n *          logger      : the logger/metrics-logger\n *          localize    : the string localizer\n *          config      : the current configuration (any k/v in\n *              galaxy.ini available from the configuration API)\n *          user        : the current user (as a mvc/user/user-model)\n */\nfunction GalaxyApp(options, bootstrapped) {\n    var self = this;\n    return self._init(options || {}, bootstrapped || {});\n}\n\n// add logging shortcuts for this object\naddLogging(GalaxyApp, \"GalaxyApp\");\n\n// a debug flag can be set via local storage and made available during script/page loading\nvar DEBUGGING_KEY = \"galaxy:debug\";\n\nvar NAMESPACE_KEY = `${DEBUGGING_KEY}:namespaces`;\nvar FLATTEN_LOG_MESSAGES_KEY = `${DEBUGGING_KEY}:flatten`;\n\nvar localDebugging = false;\ntry {\n    localDebugging = localStorage.getItem(DEBUGGING_KEY) == \"true\";\n} catch (storageErr) {\n    console.log(localize(\"localStorage not available for debug flag retrieval\"));\n}\n\n/** initalize options and sub-components */\nGalaxyApp.prototype._init = function __init(options, bootstrapped) {\n    var self = this;\n    _.extend(self, Backbone.Events);\n    if (localDebugging) {\n        self.logger = console;\n        console.debug(\"debugging galaxy:\", \"options:\", options, \"bootstrapped:\", bootstrapped);\n    }\n\n    self._processOptions(options);\n\n    // add root and url parameters\n    self.root = options.root || \"/\";\n    self.params = options.params || {};\n    self.session_csrf_token = options.session_csrf_token || null;\n\n    self._initConfig(options.config || {});\n    self._patchGalaxy(window.Galaxy);\n\n    self._initLogger(self.options.loggerOptions || {});\n    // at this point, either logging or not and namespaces are enabled - chat it up\n    self.debug(\"GalaxyApp.options: \", self.options);\n    self.debug(\"GalaxyApp.config: \", self.config);\n    self.debug(\"GalaxyApp.logger: \", self.logger);\n\n    self._initLocale();\n    self.debug(\"GalaxyApp.localize: \", self.localize);\n\n    self.config = options.config || {};\n    self.debug(\"GalaxyApp.config: \", self.config);\n\n    self._initUser(options.user || {});\n    self.debug(\"GalaxyApp.user: \", self.user);\n\n    self._setUpListeners();\n    self.trigger(\"ready\", self);\n\n    return self;\n};\n\n/** default options */\nGalaxyApp.prototype.defaultOptions = {\n    /** monkey patch attributes from existing window.Galaxy object? */\n    patchExisting: true,\n    /** root url of this app */\n    root: \"/\",\n    session_csrf_token: null\n};\n\n/** filter to options present in defaultOptions (and default to them) */\nGalaxyApp.prototype._processOptions = function _processOptions(options) {\n    var self = this;\n    var defaults = self.defaultOptions;\n\n    self.options = {};\n    for (var k in defaults) {\n        if (defaults.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : defaults[k];\n        }\n    }\n    return self;\n};\n\n/** parse the config and any extra info derived from it */\nGalaxyApp.prototype._initConfig = function _initConfig(config) {\n    var self = this;\n    self.config = config;\n\n    // give precendence to localdebugging for this setting\n    self.config.debug = localDebugging || self.config.debug;\n\n    return self;\n};\n\n/** add an option from options if the key matches an option in defaultOptions */\nGalaxyApp.prototype._patchGalaxy = function _patchGalaxy(patchWith) {\n    var self = this;\n    // in case req or plain script tag order has created a prev. version of the Galaxy obj...\n    if (self.options.patchExisting && patchWith) {\n        // self.debug( 'found existing Galaxy object:', patchWith );\n        // ...(for now) monkey patch any added attributes that the previous Galaxy may have had\n        //TODO: move those attributes to more formal assignment in GalaxyApp\n        for (var k in patchWith) {\n            if (patchWith.hasOwnProperty(k)) {\n                // self.debug( '\\t patching in ' + k + ' to Galaxy:', self[ k ] );\n                self[k] = patchWith[k];\n            }\n        }\n    }\n};\n\n/** set up the metrics logger (utils/metrics-logger) and pass loggerOptions */\nGalaxyApp.prototype._initLogger = function _initLogger(loggerOptions) {\n    var self = this;\n\n    // default to console logging at the debug level if the debug flag is set\n    if (self.config.debug) {\n        loggerOptions.consoleLogger = loggerOptions.consoleLogger || console;\n        loggerOptions.consoleLevel = loggerOptions.consoleLevel || metricsLogger.MetricsLogger.ALL;\n        // load any logging namespaces from localStorage if we can\n        try {\n            loggerOptions.consoleNamespaceWhitelist = localStorage.getItem(NAMESPACE_KEY).split(\",\");\n        } catch (storageErr) {}\n        try {\n            loggerOptions.consoleFlattenMessages = localStorage.getItem(FLATTEN_LOG_MESSAGES_KEY) == \"true\";\n        } catch (storageErr) {}\n        console.log(loggerOptions.consoleFlattenMessages);\n    }\n\n    self.logger = new metricsLogger.MetricsLogger(loggerOptions);\n    self.emit = {};\n    [\"log\", \"debug\", \"info\", \"warn\", \"error\", \"metric\"].map(i => {\n        self.emit[i] = function(data) {\n            self.logger.emit(i, arguments[0], Array.prototype.slice.call(arguments, 1));\n        };\n    });\n\n    if (self.config.debug) {\n        // add this logger to mvc's loggable mixin so that all models can use the logger\n        BASE_MVC.LoggableMixin.logger = self.logger;\n    }\n    return self;\n};\n\n/** add the localize fn to this object and the window namespace (as '_l') */\nGalaxyApp.prototype._initLocale = function _initLocale(options) {\n    var self = this;\n    self.debug(\"_initLocale:\", options);\n    self.localize = localize;\n    // add to window as global shortened alias\n    // TODO: temporary - remove when can require for plugins\n    window._l = self.localize;\n    return self;\n};\n\n/** set up the current user as a Backbone model (mvc/user/user-model) */\nGalaxyApp.prototype._initUser = function _initUser(userJSON) {\n    var self = this;\n    self.debug(\"_initUser:\", userJSON);\n    self.user = new userModel.User(userJSON);\n    self.user.logger = self.logger;\n    return self;\n};\n\n/** Set up DOM/jQuery/Backbone event listeners enabled for all pages */\nGalaxyApp.prototype._setUpListeners = function _setUpListeners() {\n    var self = this;\n\n    // hook to jq beforeSend to record the most recent ajax call and cache some data about it\n    /** cached info about the last ajax call made through jQuery */\n    self.lastAjax = {};\n    $(document).bind(\"ajaxSend\", (ev, xhr, options) => {\n        var data = options.data;\n        try {\n            data = JSON.parse(data);\n        } catch (err) {}\n\n        self.lastAjax = {\n            url: location.href.slice(0, -1) + options.url,\n            data: data\n        };\n        //TODO:?? we might somehow manage to *retry* ajax using either this hook or Backbone.sync\n    });\n    return self;\n};\n\n/** Turn debugging/console-output on/off by passing boolean. Pass nothing to get current setting. */\nGalaxyApp.prototype.debugging = function _debugging(setting) {\n    var self = this;\n    try {\n        if (setting === undefined) {\n            return localStorage.getItem(DEBUGGING_KEY) === \"true\";\n        }\n        if (setting) {\n            localStorage.setItem(DEBUGGING_KEY, true);\n            return true;\n        }\n\n        localStorage.removeItem(DEBUGGING_KEY);\n        // also remove all namespaces\n        self.debuggingNamespaces(null);\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug flag retrieval\"));\n    }\n    return false;\n};\n\n/** Add, remove, or clear namespaces from the debugging filters\n *  Pass no arguments to retrieve the existing namespaces as an array.\n *  Pass in null to clear all namespaces (all logging messages will show now).\n *  Pass in an array of strings or single string of the namespaces to filter to.\n *  Returns the new/current namespaces as an array;\n */\nGalaxyApp.prototype.debuggingNamespaces = function _debuggingNamespaces(namespaces) {\n    var self = this;\n    try {\n        if (namespaces === undefined) {\n            var csv = localStorage.getItem(NAMESPACE_KEY);\n            return typeof csv === \"string\" ? csv.split(\",\") : [];\n        } else if (namespaces === null) {\n            localStorage.removeItem(NAMESPACE_KEY);\n        } else {\n            localStorage.setItem(NAMESPACE_KEY, namespaces);\n        }\n        var newSettings = self.debuggingNamespaces();\n        if (self.logger) {\n            self.logger.options.consoleNamespaceWhitelist = newSettings;\n        }\n        return newSettings;\n    } catch (storageErr) {\n        console.log(localize(\"localStorage not available for debug namespace retrieval\"));\n    }\n};\n\n/** string rep */\nGalaxyApp.prototype.toString = function toString() {\n    var userEmail = this.user ? this.user.get(\"email\") || \"(anonymous)\" : \"uninitialized\";\n    return `GalaxyApp(${userEmail})`;\n};\n\n// ============================================================================\nexport default {\n    GalaxyApp: GalaxyApp\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/galaxy.js","/*global window, jQuery, console */\n/*=============================================================================\nTODO:\n    while anon: logs saved to 'logs-null' - this will never post\n        unless we manually do so at/after login\n        OR prepend when userId and localStorage has 'logs-null'\n    wire up _delayPost and test\n\n=============================================================================*/\n/** @class MetricsLogger\n *\n *  Object to cache, output, and post log/metric messages to the server.\n *  Meant to be attached to the Galaxy object.\n *\n *  Log from objects by either attaching logger directly:\n *      panel.logger.metric( 'user dataset deletion', panel.user.id, hda.toJSON() )\n *  or using the LoggableMixin or addLogging function:\n *      MyBackboneModel.extend( LoggableMixin ).extend({ ... })\n *      addLogging( MyBackboneModel, 'my-backbone-model' )\n *\n *  Log from templates by calling directly from Galaxy object:\n *      Galaxy.logger.metric( 'template loaded', { ownedByUser : true });\n *\n *  If you attempt to log an un-serializable object (circular reference, window, etc.),\n *  that entry will not be cached (or sent). If you set consoleLevel and consoleLogger\n *  appropriately, a warning will be shown when this happens:\n *      > panel.metric( 'something weird with window', { window : window })\n *      !'Metrics logger could not stringify logArguments: ...'\n */\nfunction MetricsLogger(options) {\n    options = options || {};\n    var self = this;\n\n    ///** get the current user's id from bootstrapped data or options */\n    self.userId = window.bootstrapped && window.bootstrapped.user ? window.bootstrapped.user.id : null;\n    self.userId = self.userId || options.userId || null;\n\n    /** the (optional) console to emit logs to */\n    self.consoleLogger = options.consoleLogger || null;\n\n    self._init(options);\n    return self;\n}\n\n//----------------------------------------------------------------------------- defaults and constants\n// see: python std lib, logging\nMetricsLogger.ALL = 0;\nMetricsLogger.LOG = 0;\nMetricsLogger.DEBUG = 10;\nMetricsLogger.INFO = 20;\nMetricsLogger.WARN = 30;\nMetricsLogger.ERROR = 40;\n// metrics levels here?\n//MetricsLogger.MinorEvent  = 45;\n//MetricsLogger.MajorEvent  = 50;\nMetricsLogger.METRIC = 50;\nMetricsLogger.NONE = 100;\n\n/** default options - override these through the constructor */\nMetricsLogger.defaultOptions = {\n    /** if an incoming message has a level >= this, it will be cached - can also be a string (e.g. 'debug') */\n    logLevel: MetricsLogger.NONE,\n    /** if an incoming message has a level >= this, it will be output to the console */\n    consoleLevel: MetricsLogger.NONE,\n    /** the default 'namespace' or label associated with an incoming message (if none is passed) */\n    defaultNamespace: \"Galaxy\",\n    /** the namespaces output to the console (all namespaces will be output if this is falsy)\n     *  note: applies only to the console (not the event/metrics log/cache)\n     */\n    consoleNamespaceWhitelist: null,\n    /** Force all messages into simple strings. */\n    consoleFlattenMessages: false,\n    /** the prefix attached to client-side logs to distinguish them in the metrics db */\n    clientPrefix: \"client.\",\n\n    /** the maximum number of messages the cache should hold; if exceeded older messages are removed first */\n    maxCacheSize: 3000,\n    /** the number of messages accumulate before posting to the server; should be <= maxCacheSize */\n    postSize: 1000,\n    /** T/F whether to add a timestamp to incoming cached messages */\n    addTime: true,\n    /** string to prefix to userid for cache web storage */\n    cacheKeyPrefix: \"logs-\",\n\n    /** the relative url to post messages to */\n    postUrl: \"/api/metrics\",\n    /** delay before trying post again after two failures */\n    delayPostInMs: 1000 * 60 * 10,\n\n    /** an (optional) function that should return an object; used to send additional data with the metrics */\n    getPingData: undefined,\n    /** an (optional) function that will handle the servers response after successfully posting messages */\n    onServerResponse: undefined\n};\n\n//----------------------------------------------------------------------------- set up\n/** initialize the logger with options, set up instance vars and cache, and add onpageunload to window */\nMetricsLogger.prototype._init = function _init(options) {\n    var self = this;\n    self.options = {};\n    for (var k in MetricsLogger.defaultOptions) {\n        if (MetricsLogger.defaultOptions.hasOwnProperty(k)) {\n            self.options[k] = options.hasOwnProperty(k) ? options[k] : MetricsLogger.defaultOptions[k];\n        }\n    }\n    self.options.logLevel = self._parseLevel(self.options.logLevel);\n    self.options.consoleLevel = self._parseLevel(self.options.consoleLevel);\n    //self._emitToConsole( 'debug', 'MetricsLogger', 'MetricsLogger.options:', self.options );\n\n    /** is the logger currently sending? */\n    self._sending = false;\n    /** the setTimeout id if the logger POST has failed more than once */\n    self._waiting = null;\n    /** the current number of entries to send in a POST */\n    self._postSize = self.options.postSize;\n\n    self._initCache();\n\n    return self;\n};\n\n/** initialize the cache */\nMetricsLogger.prototype._initCache = function _initCache() {\n    try {\n        this.cache = new LoggingCache({\n            maxSize: this.options.maxCacheSize,\n            key: this.options.cacheKeyPrefix + this.userId\n        });\n    } catch (err) {\n        this._emitToConsole(\"warn\", \"MetricsLogger\", [\"Could not intitialize logging cache:\", err]);\n        this.options.logLevel = MetricsLogger.NONE;\n    }\n};\n\n/** return the numeric log level if level in 'none, debug, log, info, warn, error' */\nMetricsLogger.prototype._parseLevel = function _parseLevel(level) {\n    var type = typeof level;\n    if (type === \"number\") {\n        return level;\n    }\n    if (type === \"string\") {\n        var upper = level.toUpperCase();\n        if (MetricsLogger.hasOwnProperty(upper)) {\n            return MetricsLogger[upper];\n        }\n    }\n    throw new Error(`Unknown log level: ${level}`);\n};\n\n//----------------------------------------------------------------------------- main entry point\n/** record a log/message's arguments to the cache and/or the console based on level and namespace */\nMetricsLogger.prototype.emit = function emit(level, namespace, logArguments) {\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ 'emit:', level, namespace, logArguments ]);\n    var self = this;\n    namespace = namespace || self.options.defaultNamespace;\n    if (!level || !logArguments) {\n        return self;\n    }\n    // add to cache if proper level\n    //TODO: respect do not track?\n    //if( !navigator.doNotTrack && level >= self.options.logLevel ){\n    level = self._parseLevel(level);\n    if (level >= self.options.logLevel) {\n        self._addToCache(level, namespace, logArguments);\n    }\n    // also emit to consoleLogger if proper level for that\n    if (self.consoleLogger && level >= self.options.consoleLevel) {\n        self._emitToConsole(level, namespace, logArguments);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- cache\n/** add a message to the cache and if messages.length is high enough post them to the server */\nMetricsLogger.prototype._addToCache = function _addToCache(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\n        \"_addToCache:\",\n        arguments,\n        this.options.addTime,\n        this.cache.length()\n    ]);\n    //this._emitToConsole( 'debug', 'MetricsLogger', [ '\\t logArguments:', logArguments ]);\n    var self = this;\n    // try add to the cache and if we've got _postSize number of entries, attempt to post them to the server\n    try {\n        var newLength = self.cache.add(self._buildEntry(level, namespace, logArguments));\n        if (newLength >= self._postSize) {\n            self._postCache();\n        }\n        // discard entry if an error occurs, but warn if level set to do so\n    } catch (err) {\n        self._emitToConsole(\"warn\", \"MetricsLogger\", [\n            \"Metrics logger could not stringify logArguments:\",\n            namespace,\n            logArguments\n        ]);\n        self._emitToConsole(\"error\", \"MetricsLogger\", [err]);\n    }\n    return self;\n};\n\n/** build a log cache entry object from the given level, namespace, and arguments (optionally adding timestamp */\nMetricsLogger.prototype._buildEntry = function _buildEntry(level, namespace, logArguments) {\n    this._emitToConsole(\"debug\", \"MetricsLogger\", [\"_buildEntry:\", arguments]);\n    var entry = {\n        level: level,\n        namespace: this.options.clientPrefix + namespace,\n        args: logArguments\n    };\n    if (this.options.addTime) {\n        entry.time = new Date().toISOString();\n    }\n    return entry;\n};\n\n/** post _postSize messages from the cache to the server, removing them if successful\n *      if the post fails, wait until maxCacheSize is accumulated instead and try again then\n *      in addition to the messages from the cache ('metrics'), any info from getPingData (if set) will be sent\n *      onServerResponse will be called (if set) with any response from the server\n */\nMetricsLogger.prototype._postCache = function _postCache(options) {\n    options = options || {};\n    this._emitToConsole(\"info\", \"MetricsLogger\", [\"_postCache\", options, this._postSize]);\n\n    // short circuit if we're already sending\n    if (!this.options.postUrl || this._sending) {\n        return jQuery.when({});\n    }\n\n    var self = this;\n    var postSize = options.count || self._postSize;\n\n    var // do not splice - remove after *successful* post\n    entries = self.cache.get(postSize);\n\n    var entriesLength = entries.length;\n\n    var // use the optional getPingData to add any extra info we may want to send\n    postData = typeof self.options.getPingData === \"function\" ? self.options.getPingData() : {};\n\n    //console.debug( postSize, entriesLength );\n\n    // add the metrics and send\n    postData.metrics = JSON.stringify(entries);\n    //console.debug( postData.metrics );\n    self._sending = true;\n    return jQuery\n        .post(self.options.postUrl, postData)\n        .always(() => {\n            self._sending = false;\n        })\n        .fail((xhr, status, message) => {\n            // if we failed the previous time, set the next post target to the max num of entries\n            self._postSize = self.options.maxCacheSize;\n            //TODO:??\n            // log this failure to explain any gap in metrics\n            self.emit(\"error\", \"MetricsLogger\", [\n                \"_postCache error:\",\n                xhr.readyState,\n                xhr.status,\n                xhr.responseJSON || xhr.responseText\n            ]);\n            //TODO: still doesn't solve the problem that when cache == max, post will be tried on every emit\n            //TODO: see _delayPost\n        })\n        .done(response => {\n            if (typeof self.options.onServerResponse === \"function\") {\n                self.options.onServerResponse(response);\n            }\n            // only remove if post successful\n            self.cache.remove(entriesLength);\n            //console.debug( 'removed entries:', entriesLength, 'size now:', self.cache.length() );\n            // if we succeeded, reset the post target to the normal num of entries\n            self._postSize = self.options.postSize;\n        });\n    // return the xhr promise\n};\n\n/** set _waiting to true and, after delayPostInMs, set it back to false */\nMetricsLogger.prototype._delayPost = function _delayPost() {\n    //TODO: this won't work between pages\n    var self = this;\n    self._waiting = setTimeout(() => {\n        self._waiting = null;\n    }, self.options.delayPostInMs);\n};\n\nfunction usefulToString(arg) {\n    var asStr = String(arg);\n    if (asStr == \"[object Object]\") {\n        asStr = JSON.stringify(arg);\n    }\n    return asStr;\n}\n\n//----------------------------------------------------------------------------- console\n/** output message to console based on level and consoleLogger type */\nMetricsLogger.prototype._emitToConsole = function _emitToConsole(level, namespace, logArguments) {\n    //console.debug( '_emitToConsole:', level, namespace, logArguments );\n    var self = this;\n\n    var whitelist = self.options.consoleNamespaceWhitelist;\n    if (!self.consoleLogger) {\n        return self;\n    }\n    // if a whitelist for namespaces is set, bail if this namespace is not in the list\n    if (whitelist && whitelist.indexOf(namespace) === -1) {\n        return self;\n    }\n\n    var args = Array.prototype.slice.call(logArguments, 0);\n    args.unshift(namespace);\n    if (self.options.consoleFlattenMessages) {\n        args = [args.map(usefulToString).join(\" \")];\n    }\n    //TODO: script location and/or source maps?\n    //TODO: branch on navigator.userAgent == AIIEEE - it only has log\n    if (level >= MetricsLogger.METRIC && typeof self.consoleLogger.info === \"function\") {\n        return self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.ERROR && typeof self.consoleLogger.error === \"function\") {\n        return self.consoleLogger.error.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.WARN && typeof self.consoleLogger.warn === \"function\") {\n        self.consoleLogger.warn.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.INFO && typeof self.consoleLogger.info === \"function\") {\n        self.consoleLogger.info.apply(self.consoleLogger, args);\n    } else if (level >= MetricsLogger.DEBUG && typeof self.consoleLogger.debug === \"function\") {\n        self.consoleLogger.debug.apply(self.consoleLogger, args);\n    } else if (typeof self.consoleLogger.log === \"function\") {\n        self.consoleLogger.log.apply(self.consoleLogger, args);\n    }\n    return self;\n};\n\n//----------------------------------------------------------------------------- shortcuts\n// generic functions when logging from non-namespaced object (e.g. templates)\n/** log to default namespace */\nMetricsLogger.prototype.log = function log() {\n    this.emit(1, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** debug to default namespace */\nMetricsLogger.prototype.debug = function debug() {\n    this.emit(MetricsLogger.DEBUG, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** info to default namespace */\nMetricsLogger.prototype.info = function info() {\n    this.emit(MetricsLogger.INFO, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** warn to default namespace */\nMetricsLogger.prototype.warn = function warn() {\n    this.emit(MetricsLogger.WARN, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** error to default namespace */\nMetricsLogger.prototype.error = function error() {\n    this.emit(MetricsLogger.ERROR, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/** metric to default namespace */\nMetricsLogger.prototype.metric = function metric() {\n    this.emit(MetricsLogger.METRIC, this.options.defaultNamespace, Array.prototype.slice.call(arguments, 0));\n};\n\n/* ============================================================================\nTODO:\n    need a performance pass - the JSON un/parsing is a bit much\n\n============================================================================ */\n/** @class LoggingCache\n *  Simple implementation of cache wrapping an array.\n *\n *  Formats an entry before it's cached and only keeps options.maxSize number\n *  of entries. Older entries are deleted first.\n */\nfunction LoggingCache(options) {\n    var self = this;\n    return self._init(options || {});\n}\n\n/** default options */\nLoggingCache.defaultOptions = {\n    /** maximum number of entries to keep before discarding oldest */\n    maxSize: 5000\n};\n\n/** initialize with options */\nLoggingCache.prototype._init = function _init(options) {\n    if (!this._hasStorage()) {\n        //TODO: fall back to jstorage\n        throw new Error(\"LoggingCache needs localStorage\");\n    }\n    if (!options.key) {\n        throw new Error(\"LoggingCache needs key for localStorage\");\n    }\n    this.key = options.key;\n    this._initStorage();\n\n    this.maxSize = options.maxSize || LoggingCache.defaultOptions.maxSize;\n    return this;\n};\n\n/** tests for localStorage fns */\nLoggingCache.prototype._hasStorage = function _hasStorage() {\n    //TODO: modernizr\n    var test = \"test\";\n    try {\n        localStorage.setItem(test, test);\n        localStorage.removeItem(test);\n        return true;\n    } catch (e) {\n        return false;\n    }\n};\n\n/** if no localStorage set for key, initialize to empty array */\nLoggingCache.prototype._initStorage = function _initStorage() {\n    if (localStorage.getItem(this.key) === null) {\n        return this.empty();\n    }\n    return this;\n};\n\n/** add an entry to the cache, removing the oldest beforehand if size >= maxSize */\nLoggingCache.prototype.add = function add(entry) {\n    var self = this;\n    var _cache = self._fetchAndParse();\n    var overage = _cache.length + 1 - self.maxSize;\n    if (overage > 0) {\n        _cache.splice(0, overage);\n    }\n    _cache.push(entry);\n    self._unparseAndStore(_cache);\n    return _cache.length;\n};\n\n/** get the entries from localStorage and parse them */\nLoggingCache.prototype._fetchAndParse = function _fetchAndParse() {\n    var self = this;\n    return JSON.parse(localStorage.getItem(self.key));\n};\n\n/** stringify the entries and put them in localStorage */\nLoggingCache.prototype._unparseAndStore = function _unparseAndStore(entries) {\n    var self = this;\n    return localStorage.setItem(self.key, JSON.stringify(entries));\n};\n\n///** process the entry before caching */\n//LoggingCache.prototype._preprocessEntry = function _preprocessEntry( entry ){\n//    return JSON.stringify( entry );\n//};\n\n/** return the length --- oh, getters where are you? */\nLoggingCache.prototype.length = function length() {\n    return this._fetchAndParse().length;\n};\n\n/** get count number of entries starting with the oldest */\nLoggingCache.prototype.get = function get(count) {\n    return this._fetchAndParse().slice(0, count);\n};\n\n/** remove count number of entries starting with the oldest */\nLoggingCache.prototype.remove = function remove(count) {\n    var _cache = this._fetchAndParse();\n    var removed = _cache.splice(0, count);\n    this._unparseAndStore(_cache);\n    return removed;\n};\n\n/** empty/clear the entire cache */\nLoggingCache.prototype.empty = function empty() {\n    localStorage.setItem(this.key, \"[]\");\n    return this;\n};\n\n/** stringify count number of entries (but do not remove) */\nLoggingCache.prototype.stringify = function stringify(count) {\n    return JSON.stringify(this.get(count));\n};\n\n/** outputs entire cache to console */\nLoggingCache.prototype.print = function print() {\n    // popup? (really, carl? a popup?) - easier to copy/paste\n    console.log(JSON.stringify(this._fetchAndParse(), null, \"  \"));\n};\n\n//=============================================================================\nexport default {\n    MetricsLogger: MetricsLogger,\n    LoggingCache: LoggingCache\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/metrics-logger.js","import Masthead from \"layout/masthead\";\nimport Panel from \"layout/panel\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Utils from \"utils/utils\";\nvar View = Backbone.View.extend({\n    el: \"body\",\n    className: \"full-content\",\n    _panelids: [\"left\", \"right\"],\n\n    initialize: function(options) {\n        var self = this;\n        this.config = _.defaults(options.config || {}, {\n            message_box_visible: false,\n            message_box_content: \"\",\n            message_box_class: \"info\",\n            show_inactivity_warning: false,\n            inactivity_box_content: \"\"\n        });\n\n        // attach global objects, build mastheads\n        Galaxy.modal = this.modal = new Modal.View();\n        Galaxy.display = this.display = view => {\n            if (view.title) {\n                Utils.setWindowTitle(view.title);\n                view.allow_title_display = false;\n            } else {\n                Utils.setWindowTitle();\n                view.allow_title_display = true;\n            }\n            self.center.display(view);\n        };\n        Galaxy.router = this.router = options.Router && new options.Router(self, options);\n        this.masthead = new Masthead.View(this.config);\n        this.center = new Panel.CenterPanel();\n\n        // build page template\n        this.$el.attr(\"scroll\", \"no\");\n        this.$el.html(this._template());\n        this.$(\"#masthead\").replaceWith(this.masthead.$el);\n        this.$(\"#center\").append(this.center.$el);\n        this.$el.append(this.masthead.frame.$el);\n        this.$el.append(this.modal.$el);\n        this.$messagebox = this.$(\"#messagebox\");\n        this.$inactivebox = this.$(\"#inactivebox\");\n\n        // build panels\n        this.panels = {};\n        _.each(this._panelids, panel_id => {\n            var panel_class_name = panel_id.charAt(0).toUpperCase() + panel_id.slice(1);\n            var panel_class = options[panel_class_name];\n            if (panel_class) {\n                var panel_instance = new panel_class(self, options);\n                self[panel_instance.toString()] = panel_instance;\n                self.panels[panel_id] = new Panel.SidePanel({\n                    id: panel_id,\n                    el: self.$(`#${panel_id}`),\n                    view: panel_instance\n                });\n            }\n        });\n        this.render();\n\n        // start the router\n        this.router &&\n            Backbone.history.start({\n                root: Galaxy.root,\n                pushState: true\n            });\n    },\n\n    render: function() {\n        // TODO: Remove this line after select2 update\n        $(\".select2-hidden-accessible\").remove();\n        this.masthead.render();\n        this.renderMessageBox();\n        this.renderInactivityBox();\n        this.renderPanels();\n        this._checkCommunicationServerOnline();\n        return this;\n    },\n\n    /** Render message box */\n    renderMessageBox: function() {\n        if (this.config.message_box_visible) {\n            var content = this.config.message_box_content || \"\";\n            var level = this.config.message_box_class || \"info\";\n            this.$el.addClass(\"has-message-box\");\n            this.$messagebox\n                .attr(\"class\", `panel-${level}-message`)\n                .html(content)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-message-box\");\n            this.$messagebox.hide();\n        }\n        return this;\n    },\n\n    /** Render inactivity warning */\n    renderInactivityBox: function() {\n        if (this.config.show_inactivity_warning) {\n            var content = this.config.inactivity_box_content || \"\";\n            var verificationLink = $(\"<a/>\")\n                .attr(\"href\", `${Galaxy.root}user/resend_verification`)\n                .text(\"Resend verification\");\n            this.$el.addClass(\"has-inactivity-box\");\n            this.$inactivebox\n                .html(`${content} `)\n                .append(verificationLink)\n                .toggle(!!content)\n                .show();\n        } else {\n            this.$el.removeClass(\"has-inactivity-box\");\n            this.$inactivebox.hide();\n        }\n        return this;\n    },\n\n    /** Render panels */\n    renderPanels: function() {\n        var self = this;\n        _.each(this._panelids, panel_id => {\n            var panel = self.panels[panel_id];\n            if (panel) {\n                panel.render();\n            } else {\n                self.$(\"#center\").css(panel_id, 0);\n                self.$(`#${panel_id}`).hide();\n            }\n        });\n        return this;\n    },\n\n    /** body template */\n    _template: function() {\n        return [\n            '<div id=\"everything\">',\n            '<div id=\"background\"/>',\n            '<div id=\"masthead\"/>',\n            '<div id=\"messagebox\"/>',\n            '<div id=\"inactivebox\" class=\"panel-warning-message\" />',\n            '<div id=\"left\" />',\n            '<div id=\"center\" />',\n            '<div id=\"right\" />',\n            \"</div>\",\n            '<div id=\"dd-helper\" />'\n        ].join(\"\");\n    },\n\n    toString: function() {\n        return \"PageLayoutView\";\n    },\n\n    /** Check if the communication server is online and show the icon otherwise hide the icon */\n    _checkCommunicationServerOnline: function() {\n        var host = window.Galaxy.config.communication_server_host;\n        var port = window.Galaxy.config.communication_server_port;\n        var preferences = window.Galaxy.user.attributes.preferences;\n        var $chat_icon_element = $(\"#show-chat-online\");\n        /** Check if the user has deactivated the communication in it's personal settings */\n        if (preferences && [\"1\", \"true\"].indexOf(preferences.communication_server) != -1) {\n            // See if the configured communication server is available\n            $.ajax({\n                url: `${host}:${port}`\n            })\n                .success(data => {\n                    // enable communication only when a user is logged in\n                    if (window.Galaxy.user.id !== null) {\n                        if ($chat_icon_element.css(\"visibility\") === \"hidden\") {\n                            $chat_icon_element.css(\"visibility\", \"visible\");\n                        }\n                    }\n                })\n                .error(data => {\n                    // hide the communication icon if the communication server is not available\n                    $chat_icon_element.css(\"visibility\", \"hidden\");\n                });\n        } else {\n            $chat_icon_element.css(\"visibility\", \"hidden\");\n        }\n    }\n});\n\nexport default { View: View };\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/page.js","var Model = Backbone.Model.extend({\n    defaults: {\n        extension: \"auto\",\n        genome: \"?\",\n        url_paste: \"\",\n        status: \"init\",\n        info: null,\n        file_name: \"\",\n        file_mode: \"\",\n        file_size: 0,\n        file_type: null,\n        file_path: \"\",\n        file_data: null,\n        percentage: 0,\n        space_to_tab: false,\n        to_posix_lines: true,\n        enabled: true\n    },\n    reset: function(attr) {\n        this.clear()\n            .set(this.defaults)\n            .set(attr);\n    }\n});\nvar Collection = Backbone.Collection.extend({ model: Model });\nexport default { Model: Model, Collection: Collection };\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-model.js","import baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n// =============================================================================\n/** A view on any model that has a 'tags' attribute (a list of tag strings)\n *      Incorporates the select2 jQuery plugin for tags display/editing:\n *      http://ivaynberg.github.io/select2/\n */\nvar TagsEditor = Backbone.View.extend(baseMVC.LoggableMixin)\n    .extend(baseMVC.HiddenUntilActivatedViewMixin)\n    .extend({\n        tagName: \"div\",\n        className: \"tags-display\",\n        select_width: \"100%\",\n        events: {},\n\n        /** Set up listeners, parse options */\n        initialize: function(options) {\n            //console.debug( this, options );\n            // only listen to the model only for changes to tags - re-render\n            this.show_editor = false;\n            if (options.usePrompt === false) {\n                this.label = \"\";\n            } else {\n                this.label = `<label class=\"prompt\">${_l(\"Tags\")}</label>`;\n            }\n            this.workflow_mode = options.workflow_mode || false;\n            if (this.workflow_mode) {\n                this.events.click = \"showEditor\";\n                this.events.keydown = \"keydownHandler\";\n            }\n            this.hiddenUntilActivated(options.$activator, options);\n        },\n\n        /** Build the DOM elements, call select to on the created input, and set up behaviors */\n        render: function() {\n            var self = this;\n            if (this.workflow_mode) {\n                this.$el.html(this._workflowTemplate());\n            } else {\n                this.$el.html(this._defaultTemplate());\n            }\n            this.$input().select2({\n                placeholder: \"Add tags\",\n                width: this.workflow_mode ? this.width : this.select_width,\n                tags: function() {\n                    // initialize possible tags in the dropdown based on all the tags the user has used so far\n                    return self._getTagsUsed();\n                }\n            });\n\n            this._setUpBehaviors();\n            return this;\n        },\n\n        _hashToName: function(tag) {\n            if (tag.startsWith(\"#\")) {\n                return `name:${tag.slice(1)}`;\n            }\n            return tag;\n        },\n\n        _nameToHash: function(tag) {\n            if (tag.startsWith(\"name:\")) {\n                tag = `#${tag.slice(5)}`;\n            }\n            return tag;\n        },\n\n        /** @returns {String} the html text used to build the view's DOM */\n        _defaultTemplate: function() {\n            return [this.label, this._renderEditor()].join(\"\");\n        },\n\n        _workflowTemplate: function() {\n            // Shows labels by default, event handler controls whether we show tags or editor\n            return [this.show_editor ? this._renderEditor() : this._renderTags()].join(\" \");\n        },\n\n        keydownHandler: function(e) {\n            switch (e.which) {\n                // esc\n                case 27:\n                    // hide the tag editor when pressing escape\n                    this.hideEditor();\n                    break;\n            }\n        },\n\n        showEditor: function() {\n            this.show_editor = true;\n            this.render();\n        },\n\n        hideEditor: function() {\n            this.show_editor = false;\n            this.render();\n        },\n\n        _renderEditor: function() {\n            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n            return `<input class=\"tags-input\" value=\"${this.tagsToCSV()}\"/>`;\n        },\n\n        _renderTags: function() {\n            var tags = this.model.get(\"tags\");\n            var addButton = \"static/images/fugue/tag--plus.png\";\n            var renderedArray = [];\n            _.each(tags, tag => {\n                tag = tag.indexOf(\"name:\") == 0 ? tag.slice(5) : tag;\n                var renderString = `<span class=\"label label-info\">${tag}</span>`;\n                renderedArray.push(renderString);\n            });\n            if (renderedArray.length === 0) {\n                // If there are no tags to render we just show the add-tag-button\n                renderedArray.push(`<img src=${addButton} class=\"add-tag-button\" title=\"Add tags\"/>`);\n            }\n            return renderedArray.join(\" \");\n        },\n\n        /** @returns {String} the sorted, comma-separated tags from the model */\n        tagsToCSV: function() {\n            var self = this;\n            var tagsArray = this.model.get(\"tags\");\n            if (!_.isArray(tagsArray) || _.isEmpty(tagsArray)) {\n                return \"\";\n            }\n            return tagsArray\n                .map(tag => _.escape(self._nameToHash(tag)))\n                .sort()\n                .join(\",\");\n        },\n\n        /** @returns {jQuery} the input for this view */\n        $input: function() {\n            return this.$el.find(\"input.tags-input\");\n        },\n\n        /** @returns {String[]} all tags used by the current user */\n        _getTagsUsed: function() {\n            //TODO: global\n            var self = this;\n            return _.map(Galaxy.user.get(\"tags_used\"), self._nameToHash);\n        },\n\n        /** set up any event listeners on the view's DOM (mostly handled by select2) */\n        _setUpBehaviors: function() {\n            var self = this;\n            this.$input().on(\"change\", event => {\n                // Modify any 'hashtag' 'nametags'\n                event.val = _.map(event.val, self._hashToName);\n                // save the model's tags in either remove or added event\n                self.model.save({ tags: event.val });\n                // if it's new, add the tag to the users tags\n                if (event.added) {\n                    //??: solve weird behavior in FF on test.galaxyproject.org where\n                    //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n                    self._addNewTagToTagsUsed(`${event.added.text}`);\n                }\n            });\n        },\n\n        /** add a new tag (if not already there) to the list of all tags used by the user\n         *  @param {String} newTag  the tag to add to the list of used\n         */\n        _addNewTagToTagsUsed: function(newTag) {\n            //TODO: global\n            var tagsUsed = Galaxy.user.get(\"tags_used\");\n            if (!_.contains(tagsUsed, newTag)) {\n                tagsUsed.push(newTag);\n                tagsUsed.sort();\n                Galaxy.user.set(\"tags_used\", tagsUsed);\n            }\n        },\n\n        /** shut down event listeners and remove this view's DOM */\n        remove: function() {\n            this.$input.off();\n            this.stopListening(this.model);\n            Backbone.View.prototype.remove.call(this);\n        },\n\n        /** string rep */\n        toString: function() {\n            return [\"TagsEditor(\", `${this.model}`, \")\"].join(\"\");\n        }\n    });\n\nexport default {\n    TagsEditor: TagsEditor\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/tag.js","import jQuery from \"jquery\";\nvar $ = jQuery;\nimport QUERY_STRING from \"utils/query-string-parsing\";\nimport Ui from \"mvc/ui/ui-misc\";\n\nvar Router = Backbone.Router.extend({\n    // TODO: not many client routes at this point - fill and remove from server.\n    // since we're at root here, this may be the last to be routed entirely on the client.\n    initialize: function(page, options) {\n        this.page = page;\n        this.options = options;\n    },\n\n    /** helper to push a new navigation state */\n    push: function(url, data) {\n        data = data || {};\n        data.__identifer = Math.random()\n            .toString(36)\n            .substr(2);\n        if (!$.isEmptyObject(data)) {\n            url += url.indexOf(\"?\") == -1 ? \"?\" : \"&\";\n            url += $.param(data, true);\n        }\n        Galaxy.params = data;\n        this.navigate(url, { trigger: true });\n    },\n\n    /** override to parse query string into obj and send to each route */\n    execute: function(callback, args, name) {\n        Galaxy.debug(\"router execute:\", callback, args, name);\n        var queryObj = QUERY_STRING.parse(args.pop());\n        args.push(queryObj);\n        if (callback) {\n            if (this.authenticate(args, name)) {\n                callback.apply(this, args);\n            } else {\n                this.access_denied();\n            }\n        }\n    },\n\n    authenticate: function(args, name) {\n        return true;\n    },\n\n    access_denied: function() {\n        this.page.display(\n            new Ui.Message({\n                status: \"danger\",\n                message: \"You must be logged in with proper credentials to make this request.\",\n                persistent: true\n            })\n        );\n    }\n});\n\nexport default Router;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/layout/router.js","/** This renders the content of the settings popup, allowing users to specify flags i.e. for space-to-tab conversion **/\nimport Utils from \"utils/utils\";\nexport default Backbone.View.extend({\n    options: {\n        class_check: \"fa-check-square-o\",\n        class_uncheck: \"fa-square-o\",\n        parameters: [\n            {\n                id: \"space_to_tab\",\n                title: \"Convert spaces to tabs\"\n            },\n            {\n                id: \"to_posix_lines\",\n                title: \"Use POSIX standard\"\n            }\n        ]\n    },\n\n    initialize: function(options) {\n        var self = this;\n        this.model = options.model;\n        this.setElement($(\"<div/>\").addClass(\"upload-settings\"));\n        this.$el.append($(\"<div/>\").addClass(\"upload-settings-cover\"));\n        this.$el.append(\n            $(\"<table/>\")\n                .addClass(\"upload-settings-table ui-table-striped\")\n                .append(\"<tbody/>\")\n        );\n        this.$cover = this.$(\".upload-settings-cover\");\n        this.$table = this.$(\".upload-settings-table > tbody\");\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.model.trigger(\"change\");\n    },\n\n    render: function() {\n        var self = this;\n        this.$table.empty();\n        _.each(this.options.parameters, parameter => {\n            var $checkbox = $(\"<div/>\")\n                .addClass(`upload-${parameter.id} upload-icon-button fa`)\n                .addClass((self.model.get(parameter.id) && self.options.class_check) || self.options.class_uncheck)\n                .on(\"click\", () => {\n                    self.model.get(\"enabled\") && self.model.set(parameter.id, !self.model.get(parameter.id));\n                });\n            self.$table.append(\n                $(\"<tr/>\")\n                    .append($(\"<td/>\").append($checkbox))\n                    .append($(\"<td/>\").append(parameter.title))\n            );\n        });\n        this.$cover[(this.model.get(\"enabled\") && \"hide\") || \"show\"]();\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-settings.js","/** This renders the content of the ftp popup **/\nimport Utils from \"utils/utils\";\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model = new Backbone.Model({\n            cls: \"upload-ftp\",\n            class_add: \"upload-icon-button fa fa-square-o\",\n            class_remove: \"upload-icon-button fa fa-check-square-o\",\n            class_partial: \"upload-icon-button fa fa-minus-square-o\",\n            help_enabled: true,\n            help_text: `This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>${\n                options.ftp_upload_site\n            }</strong> using your Galaxy credentials.`,\n            collection: null,\n            onchange: function() {},\n            onadd: function() {},\n            onremove: function() {}\n        }).set(options);\n        this.collection = this.model.get(\"collection\");\n        this.setElement(this._template());\n        this.$content = this.$(\".upload-ftp-content\");\n        this.$wait = this.$(\".upload-ftp-wait\");\n        this.$help = this.$(\".upload-ftp-help\");\n        this.$number = this.$(\".upload-ftp-number\");\n        this.$disk = this.$(\".upload-ftp-disk\");\n        this.$body = this.$(\".upload-ftp-body\");\n        this.$warning = this.$(\".upload-ftp-warning\");\n        this.$select = this.$(\".upload-ftp-select-all\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        this.$wait.show();\n        this.$content.hide();\n        this.$warning.hide();\n        this.$help.hide();\n        $.ajax({\n            url: `${Galaxy.root}api/remote_files`,\n            method: \"GET\",\n            success: function(ftp_files) {\n                self.model.set(\"ftp_files\", ftp_files);\n                self._index();\n                self._renderTable();\n            },\n            error: function() {\n                self._renderTable();\n            }\n        });\n    },\n\n    /** Fill table with ftp entries */\n    _renderTable: function() {\n        var self = this;\n        var ftp_files = this.model.get(\"ftp_files\");\n        this.rows = [];\n        if (ftp_files && ftp_files.length > 0) {\n            this.$body.empty();\n            var size = 0;\n            _.each(ftp_files, ftp_file => {\n                self.rows.push(self._renderRow(ftp_file));\n                size += ftp_file.size;\n            });\n            this.$number.html(`${ftp_files.length} files`);\n            this.$disk.html(Utils.bytesToString(size, true));\n            if (this.collection) {\n                this.$(\"._has_collection\").show();\n                this.$select\n                    .addClass(this.model.get(\"class_add\"))\n                    .off()\n                    .on(\"click\", () => {\n                        self._all();\n                    });\n                this._refresh();\n            }\n            this.$content.show();\n        } else {\n            this.$warning.show();\n        }\n        this.model.get(\"help_enabled\") && this.$help.show();\n        this.$wait.hide();\n    },\n\n    /** Add row */\n    _renderRow: function(ftp_file) {\n        var self = this;\n        var options = this.model.attributes;\n        var $it = $(this._templateRow(ftp_file));\n        var $icon = $it.find(\".icon\");\n        this.$body.append($it);\n        if (this.collection) {\n            var model_index = this.ftp_index[ftp_file.path];\n            $icon.addClass(model_index === undefined ? options.class_add : options.class_remove);\n            $it.on(\"click\", () => {\n                self._switch($icon, ftp_file);\n                self._refresh();\n            });\n        } else {\n            $it.on(\"click\", () => {\n                options.onchange(ftp_file);\n            });\n        }\n        return $icon;\n    },\n\n    /** Create ftp index */\n    _index: function() {\n        var self = this;\n        this.ftp_index = {};\n        this.collection &&\n            this.collection.each(model => {\n                if (model.get(\"file_mode\") == \"ftp\") {\n                    self.ftp_index[model.get(\"file_path\")] = model.id;\n                }\n            });\n    },\n\n    /** Select all event handler */\n    _all: function() {\n        var options = this.model.attributes;\n        var ftp_files = this.model.get(\"ftp_files\");\n        var add = this.$select.hasClass(options.class_add);\n        for (var index in ftp_files) {\n            var ftp_file = ftp_files[index];\n            var model_index = this.ftp_index[ftp_file.path];\n            if ((model_index === undefined && add) || (model_index !== undefined && !add)) {\n                this._switch(this.rows[index], ftp_file);\n            }\n        }\n        this._refresh();\n    },\n\n    /** Handle collection changes */\n    _switch: function($icon, ftp_file) {\n        $icon.removeClass();\n        var options = this.model.attributes;\n        var model_index = this.ftp_index[ftp_file.path];\n        if (model_index === undefined) {\n            var new_index = options.onadd(ftp_file);\n            $icon.addClass(options.class_remove);\n            this.ftp_index[ftp_file.path] = new_index;\n        } else {\n            options.onremove(model_index);\n            $icon.addClass(options.class_add);\n            this.ftp_index[ftp_file.path] = undefined;\n        }\n    },\n\n    /** Refresh select all button state */\n    _refresh: function() {\n        var counts = _.reduce(\n            this.ftp_index,\n            (memo, element) => {\n                element !== undefined && memo++;\n                return memo;\n            },\n            0\n        );\n        this.$select.removeClass();\n        if (counts == 0) {\n            this.$select.addClass(this.model.get(\"class_add\"));\n        } else {\n            this.$select.addClass(\n                counts == this.rows.length ? this.model.get(\"class_remove\") : this.model.get(\"class_partial\")\n            );\n        }\n    },\n\n    /** Template of row */\n    _templateRow: function(options) {\n        return `<tr class=\"upload-ftp-row\"><td class=\"_has_collection\" style=\"display: none;\"><div class=\"icon\"/></td><td class=\"ftp-name\">${_.escape(\n            options.path\n        )}</td><td class=\"ftp-size\">${Utils.bytesToString(options.size)}</td><td class=\"ftp-time\">${\n            options.ctime\n        }</td></tr>`;\n    },\n\n    /** Template of main view */\n    _template: function() {\n        return `<div class=\"${this.model.get(\n            \"cls\"\n        )}\"><div class=\"upload-ftp-wait fa fa-spinner fa-spin\"/><div class=\"upload-ftp-help\">${this.model.get(\n            \"help_text\"\n        )}</div><div class=\"upload-ftp-content\"><span style=\"whitespace: nowrap; float: left;\">Available files: </span><span style=\"whitespace: nowrap; float: right;\"><span class=\"upload-icon fa fa-file-text-o\"/><span class=\"upload-ftp-number\"/>&nbsp;&nbsp;<span class=\"upload-icon fa fa-hdd-o\"/><span class=\"upload-ftp-disk\"/></span><table class=\"grid\" style=\"float: left;\"><thead><tr><th class=\"_has_collection\" style=\"display: none;\"><div class=\"upload-ftp-select-all\"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody class=\"upload-ftp-body\"/></table></div><div class=\"upload-ftp-warning warningmessage\">Your FTP directory does not contain any files.</div>`;\n        (\"<div>\");\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-ftp.js","/** This renders a popover with extension details **/\nimport Utils from \"utils/utils\";\nimport Popover from \"mvc/ui/ui-popover\";\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        var description = _.findWhere(options.list, {\n            id: options.extension\n        });\n        this.extension_popup && this.extension_popup.remove();\n        this.extension_popup = new Popover.View({\n            placement: options.placement || \"bottom\",\n            container: options.$el\n        });\n        this.extension_popup.title(options.title);\n        this.extension_popup.empty();\n        this.extension_popup.append(this._templateDescription(description));\n        this.extension_popup.show();\n    },\n\n    /** Template for extensions description */\n    _templateDescription: function(options) {\n        if (options.description) {\n            var tmpl = options.description;\n            if (options.description_url) {\n                tmpl += `&nbsp;(<a href=\"${options.description_url}\" target=\"_blank\">read more</a>)`;\n            }\n            return tmpl;\n        } else {\n            return \"There is no description available for this file extension.\";\n        }\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-extension.js","/*\n    galaxy upload plugins - requires FormData and XMLHttpRequest\n*/\n($ => {\n    // add event properties\n    jQuery.event.props.push(\"dataTransfer\");\n\n    /**\n        Posts file data to the API\n    */\n    $.uploadpost = config => {\n        // parse options\n        var cnf = $.extend(\n            {},\n            {\n                data: {},\n                success: function() {},\n                error: function() {},\n                progress: function() {},\n                url: null,\n                maxfilesize: 2048,\n                error_filesize: \"File exceeds 2GB. Please use a FTP client.\",\n                error_default: \"Please make sure the file is available.\",\n                error_server: \"Upload request failed.\",\n                error_login: \"Uploads require you to log in.\"\n            },\n            config\n        );\n\n        // link data\n        var data = cnf.data;\n\n        // check errors\n        if (data.error_message) {\n            cnf.error(data.error_message);\n            return;\n        }\n\n        // construct form data\n        var form = new FormData();\n        for (var key in data.payload) {\n            form.append(key, data.payload[key]);\n        }\n\n        // add files to submission\n        var sizes = 0;\n        for (var key in data.files) {\n            var d = data.files[key];\n            form.append(d.name, d.file, d.file.name);\n            sizes += d.file.size;\n        }\n\n        // check file size, unless it's an ftp file\n        if (sizes > 1048576 * cnf.maxfilesize) {\n            cnf.error(cnf.error_filesize);\n            return;\n        }\n\n        // prepare request\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", cnf.url, true);\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n        xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n        // captures state changes\n        xhr.onreadystatechange = () => {\n            // check for request completed, server connection closed\n            if (xhr.readyState == xhr.DONE) {\n                // parse response\n                var response = null;\n                var extra_info = \"\";\n                if (xhr.responseText) {\n                    try {\n                        response = jQuery.parseJSON(xhr.responseText);\n                        extra_info = response.err_msg;\n                    } catch (e) {\n                        response = xhr.responseText;\n                        extra_info = response;\n                    }\n                }\n                // pass any error to the error option\n                if (xhr.status < 200 || xhr.status > 299) {\n                    var text = xhr.statusText;\n                    if (xhr.status == 403) {\n                        text = cnf.error_login;\n                    } else if (xhr.status == 0) {\n                        text = cnf.error_server;\n                    } else if (!text) {\n                        text = cnf.error_default;\n                    }\n                    cnf.error(`${text} (${xhr.status}). ${extra_info}`);\n                } else {\n                    cnf.success(response);\n                }\n            }\n        };\n\n        // prepare upload progress\n        xhr.upload.addEventListener(\n            \"progress\",\n            e => {\n                if (e.lengthComputable) {\n                    cnf.progress(Math.round(e.loaded * 100 / e.total));\n                }\n            },\n            false\n        );\n\n        // send request\n        Galaxy.emit.debug(\"uploadbox::uploadpost()\", \"Posting following data.\", cnf);\n        xhr.send(form);\n    };\n\n    /**\n        Handles the upload events drag/drop etc.\n    */\n    $.fn.uploadinput = function(options) {\n        // initialize\n        var el = this;\n        var opts = $.extend(\n            {},\n            {\n                ondragover: function() {},\n                ondragleave: function() {},\n                onchange: function() {},\n                multiple: false\n            },\n            options\n        );\n\n        // append hidden upload field\n        var $input = $(`<input type=\"file\" style=\"display: none\" ${(opts.multiple && \"multiple\") || \"\"}/>`);\n        el.append(\n            $input.change(function(e) {\n                opts.onchange(e.target.files);\n                $(this).val(\"\");\n            })\n        );\n\n        // drag/drop events\n        el.on(\"drop\", e => {\n            opts.ondragleave(e);\n            if (e.dataTransfer) {\n                opts.onchange(e.dataTransfer.files);\n                e.preventDefault();\n            }\n        });\n        el.on(\"dragover\", e => {\n            e.preventDefault();\n            opts.ondragover(e);\n        });\n        el.on(\"dragleave\", e => {\n            e.stopPropagation();\n            opts.ondragleave(e);\n        });\n\n        // exports\n        return {\n            dialog: function() {\n                $input.trigger(\"click\");\n            }\n        };\n    };\n\n    /**\n        Handles the upload queue and events such as drag/drop etc.\n    */\n    $.fn.uploadbox = function(options) {\n        // parse options\n        var opts = $.extend(\n            {},\n            {\n                dragover: function() {},\n                dragleave: function() {},\n                announce: function(d) {},\n                initialize: function(d) {},\n                progress: function(d, m) {},\n                success: function(d, m) {},\n                error: function(d, m) {\n                    alert(m);\n                },\n                complete: function() {}\n            },\n            options\n        );\n\n        // file queue\n        var queue = {};\n\n        // queue index/length counter\n        var queue_index = 0;\n        var queue_length = 0;\n\n        // indicates if queue is currently running\n        var queue_running = false;\n        var queue_stop = false;\n\n        // element\n        var uploadinput = $(this).uploadinput({\n            multiple: true,\n            onchange: function(files) {\n                add(files);\n            },\n            ondragover: options.ondragover,\n            ondragleave: options.ondragleave\n        });\n\n        // add new files to upload queue\n        function add(files) {\n            if (files && files.length && !queue_running) {\n                var index = undefined;\n                _.each(files, (file, key) => {\n                    if (\n                        file.mode !== \"new\" &&\n                        _.filter(queue, f => f.name === file.name && f.size === file.size).length\n                    ) {\n                        file.duplicate = true;\n                    }\n                });\n                _.each(files, file => {\n                    if (!file.duplicate) {\n                        index = String(queue_index++);\n                        queue[index] = file;\n                        opts.announce(index, queue[index]);\n                        queue_length++;\n                    }\n                });\n                return index;\n            }\n        }\n\n        // remove file from queue\n        function remove(index) {\n            if (queue[index]) {\n                delete queue[index];\n                queue_length--;\n            }\n        }\n\n        // process an upload, recursive\n        function process() {\n            // validate\n            if (queue_length == 0 || queue_stop) {\n                queue_stop = false;\n                queue_running = false;\n                opts.complete();\n                return;\n            } else {\n                queue_running = true;\n            }\n\n            // get an identifier from the queue\n            var index = -1;\n            for (var key in queue) {\n                index = key;\n                break;\n            }\n\n            // get current file from queue\n            var file = queue[index];\n\n            // remove from queue\n            remove(index);\n\n            // create and submit data\n            $.uploadpost({\n                url: opts.url,\n                data: opts.initialize(index),\n                success: function(message) {\n                    opts.success(index, message);\n                    process();\n                },\n                error: function(message) {\n                    opts.error(index, message);\n                    process();\n                },\n                progress: function(percentage) {\n                    opts.progress(index, percentage);\n                }\n            });\n        }\n\n        /*\n            public interface\n        */\n\n        // open file browser for selection\n        function select() {\n            uploadinput.dialog();\n        }\n\n        // remove all entries from queue\n        function reset(index) {\n            for (index in queue) {\n                remove(index);\n            }\n        }\n\n        // initiate upload process\n        function start() {\n            if (!queue_running) {\n                queue_running = true;\n                process();\n            }\n        }\n\n        // stop upload process\n        function stop() {\n            queue_stop = true;\n        }\n\n        // set options\n        function configure(options) {\n            opts = $.extend({}, opts, options);\n            return opts;\n        }\n\n        // verify browser compatibility\n        function compatible() {\n            return window.File && window.FormData && window.XMLHttpRequest && window.FileList;\n        }\n\n        // export functions\n        return {\n            select: select,\n            add: add,\n            remove: remove,\n            start: start,\n            stop: stop,\n            reset: reset,\n            configure: configure,\n            compatible: compatible\n        };\n    };\n})(jQuery);\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/uploadbox.js","import HDCA from \"mvc/history/hdca-model\";\nimport STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport baseCreator from \"mvc/collection/base-creator\";\nimport UI_MODAL from \"mvc/ui/ui-modal\";\nimport naturalSort from \"utils/natural-sort\";\nimport _l from \"utils/localization\";\nimport \"ui/hoverhighlight\";\n\nvar logNamespace = \"collections\";\n\n/*==============================================================================\nTODO:\n    use proper Element model and not just json\n    straighten out createFn, collection.createHDCA\n    possibly stop using modals for this\n    It would be neat to do a drag and drop\n\n==============================================================================*/\n/** A view for both DatasetDCEs and NestedDCDCEs\n *  (things that implement collection-model:DatasetCollectionElementMixin)\n */\nvar DatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function(attributes) {\n        this.element = attributes.element || {};\n        this.selected = attributes.selected || false;\n    },\n\n    render: function() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el\n            .attr(\"data-element-id\", this.element.id)\n            .attr(\"draggable\", true)\n            .html(this.template({ element: this.element }))\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        if (this.selected) {\n            this.$el.addClass(\"selected\");\n        }\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(\n        [\n            '<a class=\"name\" title=\"',\n            _l(\"Click to rename\"),\n            '\" href=\"javascript:void(0)\">',\n            \"<%- element.name %>\",\n            \"</a>\",\n            '<button class=\"discard btn btn-sm\" title=\"',\n            _l(\"Remove this dataset from the list\"),\n            '\">',\n            _l(\"Discard\"),\n            \"</button>\"\n        ].join(\"\")\n    ),\n\n    /** select this element and pub */\n    select: function(toggle) {\n        this.$el.toggleClass(\"selected\", toggle);\n        this.trigger(\"select\", {\n            source: this,\n            selected: this.$el.hasClass(\"selected\")\n        });\n    },\n\n    /** animate the removal of this element and pub */\n    discard: function() {\n        var view = this;\n        var parentWidth = this.$el.parent().width();\n        this.$el.animate({ \"margin-right\": parentWidth }, \"fast\", () => {\n            view.trigger(\"discard\", {\n                source: view\n            });\n            view.destroy();\n        });\n    },\n\n    /** remove the DOM and any listeners */\n    destroy: function() {\n        this.off();\n        this.$el.remove();\n    },\n\n    events: {\n        click: \"_click\",\n        \"click .name\": \"_clickName\",\n        \"click .discard\": \"_clickDiscard\",\n\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** select when the li is clicked */\n    _click: function(ev) {\n        ev.stopPropagation();\n        this.select(ev);\n    },\n\n    /** rename a pair when the name is clicked */\n    _clickName: function(ev) {\n        ev.stopPropagation();\n        ev.preventDefault();\n\n        var promptString = [\n            _l(\"Enter a new name for the element\"),\n            \":\\n(\",\n            _l(\"Note that changing the name here will not rename the dataset\"),\n            \")\"\n        ].join(\"\");\n\n        var response = prompt(`${_l(\"Enter a new name for the element\")}:`, this.element.name);\n\n        if (response) {\n            this.element.name = response;\n            this.render();\n        }\n        //TODO: cancelling with ESC leads to closure of the creator...\n    },\n\n    /** discard when the discard button is clicked */\n    _clickDiscard: function(ev) {\n        ev.stopPropagation();\n        this.discard();\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function(ev) {\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.element));\n\n        this.$el.addClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragstart\", [this]);\n    },\n\n    /** dragging for re-ordering */\n    _dragend: function(ev) {\n        this.$el.removeClass(\"dragging\");\n        this.$el.parent().trigger(\"collection-element.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\n/** An interface for building collections.\n */\nvar ListCollectionCreator = Backbone.View.extend(BASE_MVC.LoggableMixin)\n    .extend(baseCreator.CollectionCreatorMixin)\n    .extend({\n        _logNamespace: logNamespace,\n\n        /** the class used to display individual elements */\n        elementViewClass: DatasetCollectionElementView,\n        /** the class this creator will create and save */\n        collectionClass: HDCA.HistoryListDatasetCollection,\n        className: \"list-collection-creator collection-creator flex-row-container\",\n\n        /** minimum number of valid elements to start with in order to build a collection of this type */\n        minElements: 1,\n\n        defaultAttributes: {\n            //TODO: remove - use new collectionClass().save()\n            /** takes elements and creates the proper collection - returns a promise */\n            creationFn: function() {\n                throw new TypeError(\"no creation fn for creator\");\n            },\n            /** fn to call when the collection is created (scoped to this) */\n            oncreate: function() {},\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            oncancel: function() {},\n            /** distance from list edge to begin autoscrolling list */\n            autoscrollDist: 24,\n            /** Color passed to hoverhighlight */\n            highlightClr: \"rgba( 64, 255, 255, 1.0 )\"\n        },\n\n        footerSettings: {\n            \".hide-originals\": \"hideOriginals\"\n        },\n\n        /** set up initial options, instance vars, behaviors */\n        initialize: function(attributes) {\n            this.metric(\"ListCollectionCreator.initialize\", attributes);\n            var creator = this;\n            _.each(this.defaultAttributes, (value, key) => {\n                value = attributes[key] || value;\n                creator[key] = value;\n            });\n\n            /** unordered, original list - cache to allow reversal */\n            creator.initialElements = attributes.elements || [];\n\n            this._setUpCommonSettings(attributes);\n            this._instanceSetUp();\n            this._elementsSetUp();\n            this._setUpBehaviors();\n        },\n\n        /** set up instance vars */\n        _instanceSetUp: function() {\n            /** Ids of elements that have been selected by the user - to preserve over renders */\n            this.selectedIds = {};\n            /** DOM elements currently being dragged */\n            this.$dragging = null;\n            /** Used for blocking UI events during ajax/operations (don't post twice) */\n            this.blocking = false;\n        },\n\n        // ------------------------------------------------------------------------ process raw list\n        /** set up main data */\n        _elementsSetUp: function() {\n            //this.debug( '-- _dataSetUp' );\n            /** a list of invalid elements and the reasons they aren't valid */\n            this.invalidElements = [];\n            //TODO: handle fundamental problem of syncing DOM, views, and list here\n            /** data for list in progress */\n            this.workingElements = [];\n            /** views for workingElements */\n            this.elementViews = [];\n\n            // copy initial list, sort, add ids if needed\n            this.workingElements = this.initialElements.slice(0);\n            this._ensureElementIds();\n            this._validateElements();\n            this._mangleDuplicateNames();\n            this._sortElements();\n        },\n\n        /** add ids to dataset objs in initial list if none */\n        _ensureElementIds: function() {\n            this.workingElements.forEach(element => {\n                if (!element.hasOwnProperty(\"id\")) {\n                    element.id = _.uniqueId();\n                }\n            });\n            return this.workingElements;\n        },\n\n        /** separate working list into valid and invalid elements for this collection */\n        _validateElements: function() {\n            var creator = this;\n            var existingNames = {};\n            creator.invalidElements = [];\n\n            this.workingElements = this.workingElements.filter(element => {\n                var problem = creator._isElementInvalid(element);\n                if (problem) {\n                    creator.invalidElements.push({\n                        element: element,\n                        text: problem\n                    });\n                }\n                return !problem;\n            });\n            return this.workingElements;\n        },\n\n        /** describe what is wrong with a particular element if anything */\n        _isElementInvalid: function(element) {\n            if (element.history_content_type !== \"dataset\") {\n                return _l(\"is not a dataset\");\n            }\n            var validState = element.state === STATES.OK || _.contains(STATES.NOT_READY_STATES, element.state);\n            if (!validState) {\n                return _l(\"has errored, is paused, or is not accessible\");\n            }\n            if (element.deleted || element.purged) {\n                return _l(\"has been deleted or purged\");\n            }\n            return null;\n        },\n\n        /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n        _mangleDuplicateNames: function() {\n            var SAFETY = 900;\n            var counter = 1;\n            var existingNames = {};\n            this.workingElements.forEach(element => {\n                var currName = element.name;\n                while (existingNames.hasOwnProperty(currName)) {\n                    currName = `${element.name} (${counter})`;\n                    counter += 1;\n                    if (counter >= SAFETY) {\n                        throw new Error(\"Safety hit in while loop - thats impressive\");\n                    }\n                }\n                element.name = currName;\n                existingNames[element.name] = true;\n            });\n        },\n\n        /** sort a list of elements */\n        _sortElements: function(list) {\n            // // currently only natural sort by name\n            // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n            // return this.workingElements;\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        // templates : ListCollectionCreator.templates,\n        /** render the entire interface */\n        render: function(speed, callback) {\n            //this.debug( '-- _render' );\n            if (this.workingElements.length < this.minElements) {\n                return this._renderInvalid(speed, callback);\n            }\n\n            this.$el.empty().html(this.templates.main());\n            this._renderHeader(speed);\n            this._renderMiddle(speed);\n            this._renderFooter(speed);\n            this._addPluginComponents();\n            this.$(\".collection-name\").focus();\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render a simplified interface aimed at telling the user why they can't move forward */\n        _renderInvalid: function(speed, callback) {\n            //this.debug( '-- _render' );\n            this.$el.empty().html(\n                this.templates.invalidInitial({\n                    problems: this.invalidElements,\n                    elements: this.workingElements\n                })\n            );\n            if (typeof this.oncancel === \"function\") {\n                this.$(\".cancel-create.btn\").show();\n            }\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render the header section */\n        _renderHeader: function(speed, callback) {\n            var $header = this.$(\".header\")\n                .empty()\n                .html(this.templates.header())\n                .find(\".help-content\")\n                .prepend($(this.templates.helpContent()));\n            //TODO: should only show once despite calling _renderHeader again\n            if (this.invalidElements.length) {\n                this._invalidElementsAlert();\n            }\n            return $header;\n        },\n\n        /** render the middle including the elements */\n        _renderMiddle: function(speed, callback) {\n            var $middle = this.$(\".middle\")\n                .empty()\n                .html(this.templates.middle());\n            this._renderList(speed);\n            return $middle;\n        },\n\n        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n        _addPluginComponents: function() {\n            this.$(\".help-content i\").hoverhighlight(\".collection-creator\", this.highlightClr);\n        },\n\n        /** build and show an alert describing any elements that could not be included due to problems */\n        _invalidElementsAlert: function() {\n            this._showAlert(\n                this.templates.invalidElements({\n                    problems: this.invalidElements\n                }),\n                \"alert-warning\"\n            );\n        },\n\n        _disableNameAndCreate: function(disable) {\n            disable = !_.isUndefined(disable) ? disable : true;\n            if (disable) {\n                this.$(\".collection-name\").prop(\"disabled\", true);\n                this.$(\".create-collection\").toggleClass(\"disabled\", true);\n                // } else {\n                //     this.$( '.collection-name' ).prop( 'disabled', false );\n                //     this.$( '.create-collection' ).removeClass( 'disable' );\n            }\n        },\n\n        // ------------------------------------------------------------------------ rendering elements\n        /** conv. to the main list display DOM */\n        $list: function() {\n            return this.$(\".collection-elements\");\n        },\n\n        /** show or hide the clear selected control based on the num of selected elements */\n        _renderClearSelected: function() {\n            if (_.size(this.selectedIds)) {\n                this.$(\".collection-elements-controls > .clear-selected\").show();\n            } else {\n                this.$(\".collection-elements-controls > .clear-selected\").hide();\n            }\n        },\n\n        /** render the elements in order (or a warning if no elements found) */\n        _renderList: function(speed, callback) {\n            //this.debug( '-- _renderList' );\n            var creator = this;\n\n            var $tmp = jQuery(\"<div/>\");\n            var $list = creator.$list();\n\n            _.each(this.elementViews, view => {\n                view.destroy();\n                creator.removeElementView(view);\n            });\n\n            // if( !this.workingElements.length ){\n            //     this._renderNoValidElements();\n            //     return;\n            // }\n\n            creator.workingElements.forEach(element => {\n                var elementView = creator._createElementView(element);\n                $tmp.append(elementView.$el);\n            });\n\n            creator._renderClearSelected();\n            $list.empty().append($tmp.children());\n            _.invoke(creator.elementViews, \"render\");\n\n            if ($list.height() > $list.css(\"max-height\")) {\n                $list.css(\"border-width\", \"1px 0px 1px 0px\");\n            } else {\n                $list.css(\"border-width\", \"0px\");\n            }\n        },\n\n        /** create an element view, cache in elementViews, set up listeners, and return */\n        _createElementView: function(element) {\n            var elementView = new this.elementViewClass({\n                //TODO: use non-generic class or not all\n                // model : COLLECTION.DatasetDCE( element )\n                element: element,\n                selected: _.has(this.selectedIds, element.id)\n            });\n            this.elementViews.push(elementView);\n            this._listenToElementView(elementView);\n            return elementView;\n        },\n\n        /** listen to any element events */\n        _listenToElementView: function(view) {\n            var creator = this;\n            creator.listenTo(view, {\n                select: function(data) {\n                    var element = data.source.element;\n                    if (data.selected) {\n                        creator.selectedIds[element.id] = true;\n                    } else {\n                        delete creator.selectedIds[element.id];\n                    }\n                    creator.trigger(\"elements:select\", data);\n                },\n                discard: function(data) {\n                    creator.trigger(\"elements:discard\", data);\n                }\n            });\n        },\n\n        /** add a new element view based on the json in element */\n        addElementView: function(element) {\n            //TODO: workingElements is sorted, add element in appropo index\n            // add element, sort elements, find element index\n            // var view = this._createElementView( element );\n            // return view;\n        },\n\n        /** stop listening to view and remove from caches */\n        removeElementView: function(view) {\n            delete this.selectedIds[view.element.id];\n            this._renderClearSelected();\n\n            this.elementViews = _.without(this.elementViews, view);\n            this.stopListening(view);\n        },\n\n        /** render a message in the list that no elements remain to create a collection */\n        _renderNoElementsLeft: function() {\n            this._disableNameAndCreate(true);\n            this.$(\".collection-elements\").append(this.templates.noElementsLeft());\n        },\n\n        // /** render a message in the list that no valid elements were found to create a collection */\n        // _renderNoValidElements : function(){\n        //     this._disableNameAndCreate( true );\n        //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n        // },\n\n        // ------------------------------------------------------------------------ API\n        /** convert element into JSON compatible with the collections API */\n        _elementToJSON: function(element) {\n            // return element.toJSON();\n            return element;\n        },\n\n        /** create the collection via the API\n         *  @returns {jQuery.xhr Object} the jquery ajax request\n         */\n        createList: function(name) {\n            if (!this.workingElements.length) {\n                var message = `${_l(\"No valid elements for final list\")}. `;\n                message += `<a class=\"cancel-create\" href=\"javascript:void(0);\">${_l(\"Cancel\")}</a> `;\n                message += _l(\"or\");\n                message += ` <a class=\"reset\" href=\"javascript:void(0);\">${_l(\"start over\")}</a>.`;\n                this._showAlert(message);\n                return;\n            }\n\n            var creator = this;\n\n            var elements = this.workingElements.map(element => creator._elementToJSON(element));\n\n            creator.blocking = true;\n            return creator\n                .creationFn(elements, name, creator.hideOriginals)\n                .always(() => {\n                    creator.blocking = false;\n                })\n                .fail((xhr, status, message) => {\n                    creator.trigger(\"error\", {\n                        xhr: xhr,\n                        status: status,\n                        message: _l(\"An error occurred while creating this collection\")\n                    });\n                })\n                .done(function(response, message, xhr) {\n                    creator.trigger(\"collection:created\", response, message, xhr);\n                    creator.metric(\"collection:created\", response);\n                    if (typeof creator.oncreate === \"function\") {\n                        creator.oncreate.call(this, response, message, xhr);\n                    }\n                });\n        },\n\n        // ------------------------------------------------------------------------ events\n        /** set up event handlers on self */\n        _setUpBehaviors: function() {\n            this.on(\"error\", this._errorHandler);\n\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this.on(\"elements:select\", function(data) {\n                this._renderClearSelected();\n            });\n\n            this.on(\"elements:discard\", function(data) {\n                var element = data.source.element;\n                this.removeElementView(data.source);\n\n                this.workingElements = _.without(this.workingElements, element);\n                if (!this.workingElements.length) {\n                    this._renderNoElementsLeft();\n                }\n            });\n\n            //this.on( 'all', function(){\n            //    this.info( arguments );\n            //});\n            return this;\n        },\n\n        /** handle errors with feedback and details to the user (if available) */\n        _errorHandler: function(data) {\n            this.error(data);\n\n            var creator = this;\n            var content = data.message || _l(\"An error occurred\");\n            if (data.xhr) {\n                var xhr = data.xhr;\n                var message = data.message;\n                if (xhr.readyState === 0 && xhr.status === 0) {\n                    content += `: ${_l(\"Galaxy could not be reached and may be updating.\")}${_l(\n                        \" Try again in a few minutes.\"\n                    )}`;\n                } else if (xhr.responseJSON) {\n                    content += `:<br /><pre>${JSON.stringify(xhr.responseJSON)}</pre>`;\n                } else {\n                    content += `: ${message}`;\n                }\n            }\n            creator._showAlert(content, \"alert-danger\");\n        },\n\n        events: {\n            // header\n            \"click .more-help\": \"_clickMoreHelp\",\n            \"click .less-help\": \"_clickLessHelp\",\n            \"click .main-help\": \"_toggleHelp\",\n            \"click .header .alert button\": \"_hideAlert\",\n\n            \"click .reset\": \"reset\",\n            \"click .clear-selected\": \"clearSelectedElements\",\n\n            // elements - selection\n            \"click .collection-elements\": \"clearSelectedElements\",\n\n            // elements - drop target\n            // 'dragenter .collection-elements': '_dragenterElements',\n            // 'dragleave .collection-elements': '_dragleaveElements',\n            \"dragover .collection-elements\": \"_dragoverElements\",\n            \"drop .collection-elements\": \"_dropElements\",\n\n            // these bubble up from the elements as custom events\n            \"collection-element.dragstart .collection-elements\": \"_elementDragstart\",\n            \"collection-element.dragend   .collection-elements\": \"_elementDragend\",\n\n            // footer\n            \"change .collection-name\": \"_changeName\",\n            \"keydown .collection-name\": \"_nameCheckForEnter\",\n            \"change .hide-originals\": \"_changeHideOriginals\",\n            \"click .cancel-create\": \"_cancelCreate\",\n            \"click .create-collection\": \"_clickCreate\" //,\n        },\n\n        // ........................................................................ elements\n        /** reset all data to the initial state */\n        reset: function() {\n            this._instanceSetUp();\n            this._elementsSetUp();\n            this.render();\n        },\n\n        /** deselect all elements */\n        clearSelectedElements: function(ev) {\n            this.$(\".collection-elements .collection-element\").removeClass(\"selected\");\n            this.$(\".collection-elements-controls > .clear-selected\").hide();\n        },\n\n        //_dragenterElements : function( ev ){\n        //    //this.debug( '_dragenterElements:', ev );\n        //},\n        //TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n        // _dragleaveElements : function( ev ){\n        //    //this.debug( '_dragleaveElements:', ev );\n        // },\n\n        /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n        _dragoverElements: function(ev) {\n            //this.debug( '_dragoverElements:', ev );\n            ev.preventDefault();\n\n            var $list = this.$list();\n            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n            var $nearest = this._getNearestElement(ev.originalEvent.clientY);\n\n            //TODO: no need to re-create - move instead\n            this.$(\".element-drop-placeholder\").remove();\n            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n            if (!$nearest.length) {\n                $list.append($placeholder);\n            } else {\n                $nearest.before($placeholder);\n            }\n        },\n\n        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n        _checkForAutoscroll: function($element, y) {\n            var AUTOSCROLL_SPEED = 2;\n            var offset = $element.offset();\n            var scrollTop = $element.scrollTop();\n            var upperDist = y - offset.top;\n            var lowerDist = offset.top + $element.outerHeight() - y;\n            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n            }\n        },\n\n        /** get the nearest element based on the mouse's Y coordinate.\n         *  If the y is at the end of the list, return an empty jQuery object.\n         */\n        _getNearestElement: function(y) {\n            var WIGGLE = 4;\n\n            var lis = this.$(\".collection-elements li.collection-element\").toArray();\n\n            for (var i = 0; i < lis.length; i++) {\n                var $li = $(lis[i]);\n                var top = $li.offset().top;\n                var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n                if (top + halfHeight > y && top - halfHeight < y) {\n                    return $li;\n                }\n            }\n            return $();\n        },\n\n        /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n        _dropElements: function(ev) {\n            if (ev.originalEvent) {\n                ev = ev.originalEvent;\n            }\n            // both required for firefox\n            ev.preventDefault();\n            ev.dataTransfer.dropEffect = \"move\";\n\n            // insert before the nearest element or after the last.\n            var $nearest = this._getNearestElement(ev.clientY);\n            if ($nearest.length) {\n                this.$dragging.insertBefore($nearest);\n            } else {\n                // no nearest before - insert after last element\n                this.$dragging.insertAfter(this.$(\".collection-elements .collection-element\").last());\n            }\n            // resync the creator's list based on the new DOM order\n            this._syncOrderToDom();\n            return false;\n        },\n\n        /** resync the creator's list of elements based on the DOM order */\n        _syncOrderToDom: function() {\n            var creator = this;\n            var newElements = [];\n            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n            this.$(\".collection-elements .collection-element\").each(function() {\n                var id = $(this).attr(\"data-element-id\");\n\n                var element = _.findWhere(creator.workingElements, {\n                    id: id\n                });\n\n                if (element) {\n                    newElements.push(element);\n                } else {\n                    console.error(\"missing element: \", id);\n                }\n            });\n            this.workingElements = newElements;\n            this._renderList();\n        },\n\n        /** drag communication with element sub-views: dragstart */\n        _elementDragstart: function(ev, element) {\n            // auto select the element causing the event and move all selected\n            element.select(true);\n            this.$dragging = this.$(\".collection-elements .collection-element.selected\");\n        },\n\n        /** drag communication with element sub-views: dragend - remove the placeholder */\n        _elementDragend: function(ev, element) {\n            $(\".element-drop-placeholder\").remove();\n            this.$dragging = null;\n        },\n\n        // ------------------------------------------------------------------------ templates\n        //TODO: move to require text plugin and load these as text\n        //TODO: underscore currently unnecc. bc no vars are used\n        //TODO: better way of localizing text-nodes in long strings\n        /** underscore template fns attached to class */\n        templates: _.extend({}, baseCreator.CollectionCreatorMixin._creatorTemplates, {\n            /** the header (not including help text) */\n            header: _.template(\n                [\n                    '<div class=\"main-help well clear\">',\n                    '<a class=\"more-help\" href=\"javascript:void(0);\">',\n                    _l(\"More help\"),\n                    \"</a>\",\n                    '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">',\n                    _l(\"Less\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"alert alert-dismissable\">',\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ',\n                    'title=\"',\n                    _l(\"Close and show more help\"),\n                    '\" aria-hidden=\"true\">&times;</button>',\n                    '<span class=\"alert-message\"></span>',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** the middle: element list */\n            middle: _.template(\n                [\n                    '<div class=\"collection-elements-controls\">',\n                    '<a class=\"reset\" href=\"javascript:void(0);\" ',\n                    'title=\"',\n                    _l(\"Undo all reordering and discards\"),\n                    '\">',\n                    _l(\"Start over\"),\n                    \"</a>\",\n                    '<a class=\"clear-selected\" href=\"javascript:void(0);\" ',\n                    'title=\"',\n                    _l(\"De-select all selected datasets\"),\n                    '\">',\n                    _l(\"Clear selected\"),\n                    \"</a>\",\n                    \"</div>\",\n                    '<div class=\"collection-elements scroll-container flex-row\">',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** creation and cancel controls */\n            footer: _.template(\n                [\n                    '<div class=\"attributes clear\">',\n                    '<div class=\"clear\">',\n                    '<label class=\"setting-prompt pull-right\">',\n                    _l(\"Hide original elements\"),\n                    \"?\",\n                    '<input class=\"hide-originals pull-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    \"</div>\",\n                    '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control pull-right\" ',\n                    'placeholder=\"',\n                    _l(\"Enter a name for your new collection\"),\n                    '\" />',\n                    '<div class=\"collection-name-prompt pull-right\">',\n                    _l(\"Name\"),\n                    \":</div>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"Create a different kind of collection\"),\n                    ' <span class=\"caret\"></span>',\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<li><a href=\"#\">',\n                    _l(\"Create a <i>single</i> pair\"),\n                    \"</a></li>\",\n                    '<li><a href=\"#\">',\n                    _l(\"Create a list of <i>unpaired</i> datasets\"),\n                    \"</a></li>\",\n                    \"</ul>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"main-options pull-right\">',\n                    '<button class=\"create-collection btn btn-primary\">',\n                    _l(\"Create list\"),\n                    \"</button>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** help content */\n            helpContent: _.template(\n                [\n                    \"<p>\",\n                    _l(\n                        [\n                            \"Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and \",\n                            \"workflows in order to have analyses done on each member of the entire group. This interface allows \",\n                            \"you to create a collection and re-order the final collection.\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<ul>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Rename elements in the list by clicking on \",\n                            '<i data-target=\".collection-element .name\">the existing name</i>.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Discard elements from the final created list by clicking on the \",\n                            '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            \"Reorder the list by clicking and dragging elements. Select multiple elements by clicking on \",\n                            '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ',\n                            \"entire group. Deselect them by clicking them again or by clicking the \",\n                            'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        [\n                            'Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ',\n                            \"the interface.\"\n                        ].join(\"\")\n                    ),\n                    \"</li>\",\n                    \"<li>\",\n                    _l(\n                        ['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\n                            \"\"\n                        )\n                    ),\n                    \"</li>\",\n                    \"</ul><br />\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                            'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\"\n                ].join(\"\")\n            ),\n\n            /** shown in list when all elements are discarded */\n            invalidElements: _.template(\n                [\n                    _l(\"The following selections could not be included due to problems:\"),\n                    \"<ul><% _.each( problems, function( problem ){ %>\",\n                    \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                    \"<% }); %></ul>\"\n                ].join(\"\")\n            ),\n\n            /** shown in list when all elements are discarded */\n            noElementsLeft: _.template(\n                [\n                    '<li class=\"no-elements-left-message\">',\n                    _l(\"No elements left! \"),\n                    _l(\"Would you like to \"),\n                    '<a class=\"reset\" href=\"javascript:void(0)\">',\n                    _l(\"start over\"),\n                    \"</a>?\",\n                    \"</li>\"\n                ].join(\"\")\n            ),\n\n            /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n            invalidInitial: _.template(\n                [\n                    '<div class=\"header flex-row no-flex\">',\n                    '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                    \"<% if( _.size( problems ) ){ %>\",\n                    _l(\"The following selections could not be included due to problems\"),\n                    \":\",\n                    \"<ul><% _.each( problems, function( problem ){ %>\",\n                    \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                    \"<% }); %></ul>\",\n                    \"<% } else if( _.size( elements ) < 1 ){ %>\",\n                    _l(\"No datasets were selected\"),\n                    \".\",\n                    \"<% } %>\",\n                    \"<br />\",\n                    _l(\"At least one element is needed for the collection\"),\n                    \". \",\n                    _l(\"You may need to \"),\n                    '<a class=\"cancel-create\" href=\"javascript:void(0)\">',\n                    _l(\"cancel\"),\n                    \"</a> \",\n                    _l(\"and reselect new elements\"),\n                    \".\",\n                    \"</span>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"footer flex-row no-flex\">',\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    // _l( 'Create a different kind of collection' ),\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            )\n        }),\n\n        // ------------------------------------------------------------------------ misc\n        /** string rep */\n        toString: function() {\n            return \"ListCollectionCreator\";\n        }\n    });\n\n//=============================================================================\n/** Create a modal and load its body with the given CreatorClass creator type\n *  @returns {Deferred} resolved when creator has built a collection.\n */\nvar collectionCreatorModal = function _collectionCreatorModal(elements, options, CreatorClass) {\n    var deferred = jQuery.Deferred();\n    var modal = Galaxy.modal || new UI_MODAL.View();\n    var creator;\n\n    options = _.defaults(options || {}, {\n        elements: elements,\n        oncancel: function() {\n            modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function(creator, response) {\n            modal.hide();\n            deferred.resolve(response);\n        }\n    });\n\n    creator = new CreatorClass(options);\n    modal.show({\n        title: options.title || _l(\"Create a collection\"),\n        body: creator.$el,\n        width: \"80%\",\n        height: \"100%\",\n        closing_events: true\n    });\n    creator.render();\n    window._collectionCreator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n/** List collection flavor of collectionCreatorModal. */\nvar listCollectionCreatorModal = function _listCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = _l(\"Create a collection from a list of datasets\");\n    return collectionCreatorModal(elements, options, ListCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a list collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createListCollection(contents, defaultHideSourceItems) {\n    var elements = contents.toJSON();\n\n    var promise = listCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function(elements, name, hideSourceItems) {\n            elements = elements.map(element => ({\n                id: element.id,\n                name: element.name,\n\n                //TODO: this allows for list:list even if the filter above does not - reconcile\n                src: element.history_content_type === \"dataset\" ? \"hda\" : \"hdca\"\n            }));\n            return contents.createHDCA(elements, \"list\", name, hideSourceItems);\n        }\n    });\n\n    return promise;\n}\n\n//==============================================================================\nexport default {\n    DatasetCollectionElementView: DatasetCollectionElementView,\n    ListCollectionCreator: ListCollectionCreator,\n\n    collectionCreatorModal: collectionCreatorModal,\n    listCollectionCreatorModal: listCollectionCreatorModal,\n    createListCollection: createListCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/list-collection-creator.js","import DC_MODEL from \"mvc/collection/collection-model\";\nimport HISTORY_CONTENT from \"mvc/history/history-content-model\";\nimport _l from \"utils/localization\";\n\n/*==============================================================================\n\nModels for DatasetCollections contained within a history.\n\nTODO:\n    these might be compactable to one class if some duplication with\n    collection-model is used.\n\n==============================================================================*/\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n\nvar ListDC = DC_MODEL.ListDatasetCollection;\nvar PairDC = DC_MODEL.PairDatasetCollection;\nvar ListPairedDC = DC_MODEL.ListPairedDatasetCollection;\nvar ListOfListsDC = DC_MODEL.ListOfListsDatasetCollection;\n\n//==============================================================================\n/** Override to post to contents route w/o id. */\nfunction buildHDCASave(_super) {\n    return function _save(attributes, options) {\n        if (this.isNew()) {\n            options = options || {};\n            options.url = `${this.urlRoot + this.get(\"history_id\")}/contents`;\n            attributes = attributes || {};\n            attributes.type = \"dataset_collection\";\n        }\n        return _super.call(this, attributes, options);\n    };\n}\n\n//==============================================================================\n/** @class Backbone model for List Dataset Collection within a History.\n */\nvar HistoryListDatasetCollection = ListDC.extend(hcontentMixin).extend(\n    /** @lends HistoryListDatasetCollection.prototype */ {\n        defaults: _.extend(_.clone(ListDC.prototype.defaults), {\n            history_content_type: \"dataset_collection\",\n            collection_type: \"list\",\n            model_class: \"HistoryDatasetCollectionAssociation\"\n        }),\n\n        /** Override to post to contents route w/o id. */\n        save: buildHDCASave(ListDC.prototype.save),\n\n        /** String representation. */\n        toString: function() {\n            return `History${ListDC.prototype.toString.call(this)}`;\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for Pair Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryPairDatasetCollection = PairDC.extend(hcontentMixin).extend(\n    /** @lends HistoryPairDatasetCollection.prototype */ {\n        defaults: _.extend(_.clone(PairDC.prototype.defaults), {\n            history_content_type: \"dataset_collection\",\n            collection_type: \"paired\",\n            model_class: \"HistoryDatasetCollectionAssociation\"\n        }),\n\n        /** Override to post to contents route w/o id. */\n        save: buildHDCASave(PairDC.prototype.save),\n\n        /** String representation. */\n        toString: function() {\n            return `History${PairDC.prototype.toString.call(this)}`;\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for List of Pairs Dataset Collection within a History. */\nvar HistoryListPairedDatasetCollection = ListPairedDC.extend(hcontentMixin).extend({\n    defaults: _.extend(_.clone(ListPairedDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"list:paired\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(ListPairedDC.prototype.save),\n\n    /** String representation. */\n    toString: function() {\n        return `History${ListPairedDC.prototype.toString.call(this)}`;\n    }\n});\n\n//==============================================================================\n/** @class Backbone model for List of Lists Dataset Collection within a History. */\nvar HistoryListOfListsDatasetCollection = ListOfListsDC.extend(hcontentMixin).extend({\n    defaults: _.extend(_.clone(ListOfListsDC.prototype.defaults), {\n        history_content_type: \"dataset_collection\",\n        collection_type: \"list:list\",\n        model_class: \"HistoryDatasetCollectionAssociation\"\n    }),\n\n    /** Override to post to contents route w/o id. */\n    save: buildHDCASave(ListOfListsDC.prototype.save),\n\n    /** String representation. */\n    toString: function() {\n        return `HistoryListOfListsDatasetCollection(${this.get(\"name\")})`;\n    }\n});\n\n//==============================================================================\nexport default {\n    HistoryListDatasetCollection: HistoryListDatasetCollection,\n    HistoryPairDatasetCollection: HistoryPairDatasetCollection,\n    HistoryListPairedDatasetCollection: HistoryListPairedDatasetCollection,\n    HistoryListOfListsDatasetCollection: HistoryListOfListsDatasetCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hdca-model.js","import DATASET_MODEL from \"mvc/dataset/dataset-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/*\nNotes:\n\nTerminology:\n    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\n\nThis all seems too complex unfortunately:\n\n- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n    decided to merge the contained JSON with the DC element json - making the 'has a'\n    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n    DRY in both models and views, but may make tracking or tracing within these models\n    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n    or DatasetCollections (nested)). This also violates the rule of thumb about\n    favoring aggregation over inheritance.\n- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n    These each should a) be usable on their own, b) be usable in the context of\n    nesting within a collection model (at least in the case of ListPaired), and\n    c) be usable within the context of other container models (like History or\n    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n    handle those three situations, but it's proven difficult to do in a simple,\n    readable manner.\n- Ideally, histories and libraries would inherit from the same server models as\n    dataset collections do since they are (in essence) dataset collections themselves -\n    making the whole nested structure simpler. This would be a large, error-prone\n    refactoring and migration.\n\nMany of the classes and heirarchy are meant as extension points so, while the\nrelations and flow may be difficult to understand initially, they'll allow us to\nhandle the growth or flux dataset collection in the future (w/o actually implementing\nany YAGNI).\n\n*/\n//_________________________________________________________________________________________________ ELEMENTS\n/** @class mixin for Dataset collection elements.\n *      When collection elements are passed from the API, the underlying element is\n *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n *          effectively changing a DCE from a container to a subclass (has a --> is a).\n */\nvar DatasetCollectionElementMixin = {\n    /** default attributes used by elements in a dataset collection */\n    defaults: {\n        model_class: \"DatasetCollectionElement\",\n        element_identifier: null,\n        element_index: null,\n        element_type: null\n    },\n\n    /** merge the attributes of the sub-object 'object' into this model */\n    _mergeObject: function(attributes) {\n        // if we don't preserve and correct ids here, the element id becomes the object id\n        // and collision in backbone's _byId will occur and only\n        _.extend(attributes, attributes.object, {\n            element_id: attributes.id\n        });\n        delete attributes.object;\n        return attributes;\n    },\n\n    /** override to merge this.object into this */\n    constructor: function(attributes, options) {\n        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n        attributes = this._mergeObject(attributes);\n        this.idAttribute = \"element_id\";\n        Backbone.Model.apply(this, arguments);\n    },\n\n    /** when the model is fetched, merge this.object into this */\n    parse: function(response, options) {\n        var attributes = response;\n        attributes = this._mergeObject(attributes);\n        return attributes;\n    }\n};\n\n/** @class Concrete class of Generic DatasetCollectionElement */\nvar DatasetCollectionElement = Backbone.Model.extend(BASE_MVC.LoggableMixin)\n    .extend(DatasetCollectionElementMixin)\n    .extend({ _logNamespace: \"collections\" });\n\n//==============================================================================\n/** @class Base/Abstract Backbone collection for Generic DCEs. */\nvar DCECollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends DCECollection.prototype */ {\n        _logNamespace: \"collections\",\n\n        model: DatasetCollectionElement,\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetCollectionElementCollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n */\nvar DatasetDCE = DATASET_MODEL.DatasetAssociation.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends DatasetDCE.prototype */ {\n            /** url fn */\n            url: function() {\n                // won't always be an hda\n                if (!this.has(\"history_id\")) {\n                    console.warn(\"no endpoint for non-hdas within a collection yet\");\n                    // (a little silly since this api endpoint *also* points at hdas)\n                    return `${Galaxy.root}api/datasets`;\n                }\n                return `${Galaxy.root}api/histories/${this.get(\"history_id\")}/contents/${this.get(\"id\")}`;\n            },\n\n            defaults: _.extend(\n                {},\n                DATASET_MODEL.DatasetAssociation.prototype.defaults,\n                DatasetCollectionElementMixin.defaults\n            ),\n\n            _downloadQueryParameters: function() {\n                var fileExt = this.get(\"file_ext\");\n                var elementIdentifier = this.get(\"element_identifier\");\n                var parentHdcaId = this.get(\"parent_hdca_id\");\n                return `?to_ext=${fileExt}&hdca_id=${parentHdcaId}&element_identifier=${elementIdentifier}`;\n            },\n\n            // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n            //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n            //  - re-apply manually for now\n            /** call the mixin constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t DatasetDCE.constructor:\", attributes, options);\n                //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** Does this model already contain detailed data (as opposed to just summary level data)? */\n            hasDetails: function() {\n                return this.elements && this.elements.length;\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.get(\"element_identifier\");\n                return `DatasetDCE({objStr})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n */\nvar DatasetDCECollection = DCECollection.extend(\n    /** @lends DatasetDCECollection.prototype */ {\n        model: DatasetDCE,\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetDCECollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//_________________________________________________________________________________________________ COLLECTIONS\n/** @class Backbone model for Dataset Collections.\n *      The DC API returns an array of JSON objects under the attribute elements.\n *      This model:\n *          - removes that array/attribute ('elements') from the model,\n *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n *          - passes that json onto the bbone collection\n *          - caches the bbone collection in this.elements\n */\nvar DatasetCollection = Backbone.Model.extend(BASE_MVC.LoggableMixin)\n    .extend(BASE_MVC.SearchableModelMixin)\n    .extend(\n        /** @lends DatasetCollection.prototype */ {\n            _logNamespace: \"collections\",\n\n            /** default attributes for a model */\n            defaults: {\n                /* 'list', 'paired', or 'list:paired' */\n                collection_type: null,\n                //??\n                deleted: false\n            },\n\n            /** Which class to use for elements */\n            collectionClass: DCECollection,\n\n            /** set up: create elements instance var and (on changes to elements) update them  */\n            initialize: function(model, options) {\n                this.debug(`${this}(DatasetCollection).initialize:`, model, options, this);\n                this.elements = this._createElementsModel();\n                this.on(\"change:elements\", function() {\n                    this.log(\"change:elements\");\n                    //TODO: prob. better to update the collection instead of re-creating it\n                    this.elements = this._createElementsModel();\n                });\n            },\n\n            /** move elements model attribute to full collection */\n            _createElementsModel: function() {\n                this.debug(`${this}._createElementsModel`, this.collectionClass, this.get(\"elements\"), this.elements);\n                //TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n                var elements = this.get(\"elements\") || [];\n                this.unset(\"elements\", { silent: true });\n                var self = this;\n                _.each(elements, (element, index) => {\n                    _.extend(element, {\n                        parent_hdca_id: self.get(\"id\")\n                    });\n                });\n                this.elements = new this.collectionClass(elements);\n                //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n                return this.elements;\n            },\n\n            // ........................................................................ common queries\n            /** pass the elements back within the model json when this is serialized */\n            toJSON: function() {\n                var json = Backbone.Model.prototype.toJSON.call(this);\n                if (this.elements) {\n                    json.elements = this.elements.toJSON();\n                }\n                return json;\n            },\n\n            /** Is this collection in a 'ready' state no processing (for the collection) is left\n             *  to do on the server.\n             */\n            inReadyState: function() {\n                var populated = this.get(\"populated\");\n                return this.isDeletedOrPurged() || populated;\n            },\n\n            //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n            /** Does the DC contain any elements yet? Is a fetch() required? */\n            hasDetails: function() {\n                return this.elements.length !== 0;\n            },\n\n            /** Given the filters, what models in this.elements would be returned? */\n            getVisibleContents: function(filters) {\n                // filters unused for now\n                return this.elements;\n            },\n\n            // ........................................................................ ajax\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** save this dataset, _Mark_ing it as deleted (just a flag) */\n            delete: function(options) {\n                if (this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true }, options);\n            },\n            /** save this dataset, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\") || this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** Is this collection deleted or purged? */\n            isDeletedOrPurged: function() {\n                return this.get(\"deleted\") || this.get(\"purged\");\n            },\n\n            // ........................................................................ searchable\n            /** searchable attributes for collections */\n            searchAttributes: [\"name\", \"tags\"],\n\n            // ........................................................................ misc\n            /** String representation */\n            toString: function() {\n                var idAndName = [this.get(\"id\"), this.get(\"name\") || this.get(\"element_identifier\")];\n                return `DatasetCollection(${idAndName.join(\",\")})`;\n            }\n        }\n    );\n\n//==============================================================================\n/** Model for a DatasetCollection containing datasets (non-nested).\n */\nvar ListDatasetCollection = DatasetCollection.extend(\n    /** @lends ListDatasetCollection.prototype */ {\n        /** override since we know the collection will only contain datasets */\n        collectionClass: DatasetDCECollection,\n\n        /** String representation. */\n        toString: function() {\n            return `List${DatasetCollection.prototype.toString.call(this)}`;\n        }\n    }\n);\n\n//==============================================================================\n/** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n */\nvar PairDatasetCollection = ListDatasetCollection.extend(\n    /** @lends PairDatasetCollection.prototype */ {\n        /** String representation. */\n        toString: function() {\n            return `Pair${DatasetCollection.prototype.toString.call(this)}`;\n        }\n    }\n);\n\n//_________________________________________________________________________________________________ NESTED COLLECTIONS\n// this is where things get weird, man. Weird.\n//TODO: it might be possible to compact all the following...I think.\n//==============================================================================\n/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n *      (a nested collection). Currently only list:paired.\n */\nvar NestedDCDCE = DatasetCollection.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends NestedDCDCE.prototype */ {\n            // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n            //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n            //  - re-apply manually it now\n            /** call the mixin constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t NestedDCDCE.constructor:\", attributes, options);\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.object ? `${this.object}` : this.get(\"element_identifier\");\n                return [\"NestedDCDCE(\", objStr, \")\"].join(\"\");\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n */\nvar NestedDCDCECollection = DCECollection.extend(\n    /** @lends NestedDCDCECollection.prototype */ {\n        /** This is a collection of nested collections */\n        model: NestedDCDCE,\n\n        /** String representation. */\n        toString: function() {\n            return [\"NestedDCDCECollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n */\nvar NestedPairDCDCE = PairDatasetCollection.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends NestedPairDCDCE.prototype */ {\n            //TODO:?? possibly rename to NestedDatasetCollection?\n\n            // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n            //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n            //  - re-apply manually it now\n            /** This is both a collection and a collection element - call the constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t NestedPairDCDCE.constructor:\", attributes, options);\n                //DatasetCollection.constructor.call( this, attributes, options );\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.object ? `${this.object}` : this.get(\"element_identifier\");\n                return [\"NestedPairDCDCE(\", objStr, \")\"].join(\"\");\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection for a backbone collection containing paired dataset collections.\n */\nvar NestedPairDCDCECollection = NestedDCDCECollection.extend(\n    /** @lends PairDCDCECollection.prototype */ {\n        /** We know this collection is composed of only nested pair collections */\n        model: NestedPairDCDCE,\n\n        /** String representation. */\n        toString: function() {\n            return [\"NestedPairDCDCECollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n */\nvar ListPairedDatasetCollection = DatasetCollection.extend(\n    /** @lends ListPairedDatasetCollection.prototype */ {\n        /** list:paired is the only collection that itself contains collections */\n        collectionClass: NestedPairDCDCECollection,\n\n        /** String representation. */\n        toString: function() {\n            return [\"ListPairedDatasetCollection(\", this.get(\"name\"), \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\n/** @class Backbone model for a list dataset collection within a list:list dataset collection. */\nvar NestedListDCDCE = ListDatasetCollection.extend(\n    BASE_MVC.mixin(\n        DatasetCollectionElementMixin,\n        /** @lends NestedListDCDCE.prototype */ {\n            /** This is both a collection and a collection element - call the constructor */\n            constructor: function(attributes, options) {\n                this.debug(\"\\t NestedListDCDCE.constructor:\", attributes, options);\n                DatasetCollectionElementMixin.constructor.call(this, attributes, options);\n            },\n\n            /** String representation. */\n            toString: function() {\n                var objStr = this.object ? `${this.object}` : this.get(\"element_identifier\");\n                return [\"NestedListDCDCE(\", objStr, \")\"].join(\"\");\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection containing list dataset collections. */\nvar NestedListDCDCECollection = NestedDCDCECollection.extend({\n    /** We know this collection is composed of only nested pair collections */\n    model: NestedListDCDCE,\n\n    /** String representation. */\n    toString: function() {\n        return [\"NestedListDCDCECollection(\", this.length, \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains other lists. */\nvar ListOfListsDatasetCollection = DatasetCollection.extend({\n    /** list:paired is the only collection that itself contains collections */\n    collectionClass: NestedListDCDCECollection,\n\n    /** String representation. */\n    toString: function() {\n        return [\"ListOfListsDatasetCollection(\", this.get(\"name\"), \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\nexport default {\n    ListDatasetCollection: ListDatasetCollection,\n    PairDatasetCollection: PairDatasetCollection,\n    ListPairedDatasetCollection: ListPairedDatasetCollection,\n    ListOfListsDatasetCollection: ListOfListsDatasetCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/collection-model.js","export default {\n    tool: \"fa-wrench\",\n    data_input: \"fa-file-o\",\n    data_collection_input: \"fa-folder-o\",\n    subworkflow: \"fa-sitemap fa-rotate-270\",\n    pause: \"fa-pause\"\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/workflow/workflow-icons.js","import HISTORY_CONTENTS from \"mvc/history/history-contents\";\nimport HISTORY_PREFS from \"mvc/history/history-preferences\";\nimport CONTROLLED_FETCH_COLLECTION from \"mvc/base/controlled-fetch-collection\";\nimport UTILS from \"utils/utils\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/** @class Model for a Galaxy history resource - both a record of user\n *      tool use and a collection of the datasets those tools produced.\n *  @name History\n *  @augments Backbone.Model\n */\nvar History = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(\n    BASE_MVC.mixin(\n        BASE_MVC.SearchableModelMixin,\n        /** @lends History.prototype */ {\n            _logNamespace: \"history\",\n\n            /** ms between fetches when checking running jobs/datasets for updates */\n            UPDATE_DELAY: 4000,\n\n            // values from api (may need more)\n            defaults: {\n                model_class: \"History\",\n                id: null,\n                name: \"Unnamed History\",\n                state: \"new\",\n\n                deleted: false,\n                contents_active: {},\n                contents_states: {}\n            },\n\n            urlRoot: `${Galaxy.root}api/histories`,\n\n            contentsClass: HISTORY_CONTENTS.HistoryContents,\n\n            /** What model fields to search with */\n            searchAttributes: [\"name\", \"annotation\", \"tags\"],\n\n            /** Adding title and singular tag */\n            searchAliases: {\n                title: \"name\",\n                tag: \"tags\"\n            },\n\n            // ........................................................................ set up/tear down\n            /** Set up the model\n             *  @param {Object} historyJSON model data for this History\n             *  @param {Object} options     any extra settings including logger\n             */\n            initialize: function(historyJSON, options) {\n                options = options || {};\n                this.logger = options.logger || null;\n                this.log(`${this}.initialize:`, historyJSON, options);\n\n                /** HistoryContents collection of the HDAs contained in this history. */\n                this.contents = new this.contentsClass([], {\n                    history: this,\n                    historyId: this.get(\"id\"),\n                    order: options.order\n                });\n\n                this._setUpListeners();\n                this._setUpCollectionListeners();\n\n                /** cached timeout id for the dataset updater */\n                this.updateTimeoutId = null;\n            },\n\n            /** set up any event listeners for this history including those to the contained HDAs\n             *  events: error:contents  if an error occurred with the contents collection\n             */\n            _setUpListeners: function() {\n                // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n                return this.on({\n                    error: function(model, xhr, options, msg, details) {\n                        this.clearUpdateTimeout();\n                    },\n                    \"change:id\": function(model, newId) {\n                        if (this.contents) {\n                            this.contents.historyId = newId;\n                        }\n                    }\n                });\n            },\n\n            /** event handlers for the contents submodels */\n            _setUpCollectionListeners: function() {\n                if (!this.contents) {\n                    return this;\n                }\n                // bubble up errors\n                return this.listenTo(this.contents, {\n                    error: function() {\n                        this.trigger.apply(this, jQuery.makeArray(arguments));\n                    }\n                });\n            },\n\n            // ........................................................................ derived attributes\n            /**  */\n            contentsShown: function() {\n                var contentsActive = this.get(\"contents_active\");\n                var shown = contentsActive.active || 0;\n                shown += this.contents.includeDeleted ? contentsActive.deleted : 0;\n                shown += this.contents.includeHidden ? contentsActive.hidden : 0;\n                return shown;\n            },\n\n            /** convert size in bytes to a more human readable version */\n            nice_size: function() {\n                var size = this.get(\"size\");\n                return size ? UTILS.bytesToString(size, true, 2) : _l(\"(empty)\");\n            },\n\n            /** override to add nice_size */\n            toJSON: function() {\n                return _.extend(Backbone.Model.prototype.toJSON.call(this), {\n                    nice_size: this.nice_size()\n                });\n            },\n\n            /** override to allow getting nice_size */\n            get: function(key) {\n                if (key === \"nice_size\") {\n                    return this.nice_size();\n                }\n                return Backbone.Model.prototype.get.apply(this, arguments);\n            },\n\n            // ........................................................................ common queries\n            /** T/F is this history owned by the current user (Galaxy.user)\n             *      Note: that this will return false for an anon user even if the history is theirs.\n             */\n            ownedByCurrUser: function() {\n                // no currUser\n                if (!Galaxy || !Galaxy.user) {\n                    return false;\n                }\n                // user is anon or history isn't owned\n                if (Galaxy.user.isAnonymous() || Galaxy.user.id !== this.get(\"user_id\")) {\n                    return false;\n                }\n                return true;\n            },\n\n            /** Return the number of running jobs assoc with this history (note: unknown === 0) */\n            numOfUnfinishedJobs: function() {\n                var unfinishedJobIds = this.get(\"non_ready_jobs\");\n                return unfinishedJobIds ? unfinishedJobIds.length : 0;\n            },\n\n            /** Return the number of running hda/hdcas in this history (note: unknown === 0) */\n            numOfUnfinishedShownContents: function() {\n                return this.contents.runningAndActive().length || 0;\n            },\n\n            // ........................................................................ updates\n            _fetchContentRelatedAttributes: function() {\n                var contentRelatedAttrs = [\"size\", \"non_ready_jobs\", \"contents_active\", \"hid_counter\"];\n                return this.fetch({\n                    data: $.param({\n                        keys: contentRelatedAttrs.join(\",\")\n                    })\n                });\n            },\n\n            /** check for any changes since the last time we updated (or fetch all if ) */\n            refresh: function(options) {\n                // console.log( this + '.refresh' );\n                options = options || {};\n\n                // note if there was no previous update time, all summary contents will be fetched\n                var lastUpdateTime = this.lastUpdateTime;\n                // if we don't flip this, then a fully-fetched list will not be re-checked via fetch\n                this.contents.allFetched = false;\n                var fetchFn =\n                    this.contents.currentPage !== 0\n                        ? () => this.contents.fetchPage(this.contents.currentPage)\n                        : () => this.contents.fetchUpdated(lastUpdateTime);\n                // note: if there was no previous update time, all summary contents will be fetched\n                return fetchFn().done((response, status, xhr) => {\n                    var serverResponseDatetime;\n                    try {\n                        serverResponseDatetime = new Date(xhr.getResponseHeader(\"Date\"));\n                    } catch (err) {}\n                    this.lastUpdateTime = serverResponseDatetime || new Date();\n                    this.checkForUpdates(options);\n                });\n            },\n\n            /** continuously fetch updated contents every UPDATE_DELAY ms if this history's datasets or jobs are unfinished */\n            checkForUpdates: function(options) {\n                // console.log( this + '.checkForUpdates' );\n                options = options || {};\n                var delay = this.UPDATE_DELAY;\n                if (!this.id) {\n                    return;\n                }\n\n                var _delayThenUpdate = () => {\n                    // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n                    this.clearUpdateTimeout();\n                    this.updateTimeoutId = setTimeout(() => {\n                        this.refresh(options);\n                    }, delay);\n                };\n\n                // if there are still datasets in the non-ready state, recurse into this function with the new time\n                var nonReadyContentCount = this.numOfUnfinishedShownContents();\n                // console.log( 'nonReadyContentCount:', nonReadyContentCount );\n                if (nonReadyContentCount > 0) {\n                    _delayThenUpdate();\n                } else {\n                    // no datasets are running, but currently runnning jobs may still produce new datasets\n                    // see if the history has any running jobs and continue to update if so\n                    // (also update the size for the user in either case)\n                    this._fetchContentRelatedAttributes().done(historyData => {\n                        // console.log( 'non_ready_jobs:', historyData.non_ready_jobs );\n                        if (this.numOfUnfinishedJobs() > 0) {\n                            _delayThenUpdate();\n                        } else {\n                            // otherwise, let listeners know that all updates have stopped\n                            this.trigger(\"ready\");\n                        }\n                    });\n                }\n            },\n\n            /** clear the timeout and the cached timeout id */\n            clearUpdateTimeout: function() {\n                if (this.updateTimeoutId) {\n                    clearTimeout(this.updateTimeoutId);\n                    this.updateTimeoutId = null;\n                }\n            },\n\n            // ........................................................................ ajax\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** fetch this histories data (using options) then it's contents (using contentsOptions) */\n            fetchWithContents: function(options, contentsOptions) {\n                options = options || {};\n                var self = this;\n\n                // console.log( this + '.fetchWithContents' );\n                // TODO: push down to a base class\n                options.view = \"dev-detailed\";\n\n                // fetch history then use history data to fetch (paginated) contents\n                return this.fetch(options).then(function getContents(history) {\n                    self.contents.history = self;\n                    self.contents.setHistoryId(history.id);\n                    return self.fetchContents(contentsOptions);\n                });\n            },\n\n            /** fetch this histories contents, adjusting options based on the stored history preferences */\n            fetchContents: function(options) {\n                options = options || {};\n                var self = this;\n\n                // we're updating, reset the update time\n                self.lastUpdateTime = new Date();\n                return self.contents.fetchCurrentPage(options);\n            },\n\n            /** save this history, _Mark_ing it as deleted (just a flag) */\n            _delete: function(options) {\n                if (this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true }, options);\n            },\n            /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n            purge: function(options) {\n                if (this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true, purged: true }, options);\n            },\n            /** save this history, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** Make a copy of this history on the server\n             *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n             *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n             *  @fires copied               passed this history and the response JSON from the copy\n             *  @returns {xhr}\n             */\n            copy: function(current, name, allDatasets) {\n                current = current !== undefined ? current : true;\n                if (!this.id) {\n                    throw new Error(\"You must set the history ID before copying it.\");\n                }\n\n                var postData = { history_id: this.id };\n                if (current) {\n                    postData.current = true;\n                }\n                if (name) {\n                    postData.name = name;\n                }\n                if (!allDatasets) {\n                    postData.all_datasets = false;\n                }\n                postData.view = \"dev-detailed\";\n\n                var history = this;\n                var copy = jQuery.post(this.urlRoot, postData);\n                // if current - queue to setAsCurrent before firing 'copied'\n                if (current) {\n                    return copy.then(response => {\n                        var newHistory = new History(response);\n                        return newHistory.setAsCurrent().done(() => {\n                            history.trigger(\"copied\", history, response);\n                        });\n                    });\n                }\n                return copy.done(response => {\n                    history.trigger(\"copied\", history, response);\n                });\n            },\n\n            setAsCurrent: function() {\n                var history = this;\n\n                var xhr = jQuery.getJSON(`${Galaxy.root}history/set_as_current?id=${this.id}`);\n\n                xhr.done(() => {\n                    history.trigger(\"set-as-current\", history);\n                });\n                return xhr;\n            },\n\n            // ........................................................................ misc\n            toString: function() {\n                return `History(${this.get(\"id\")},${this.get(\"name\")})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\nvar _collectionSuper = CONTROLLED_FETCH_COLLECTION.InfinitelyScrollingCollection;\n/** @class A collection of histories (per user)\n *      that maintains the current history as the first in the collection.\n *  New or copied histories become the current history.\n */\nvar HistoryCollection = _collectionSuper.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    model: History,\n    /** @type {String} initial order used by collection */\n    order: \"update_time\",\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: 10,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 10,\n\n    initialize: function(models, options) {\n        options = options || {};\n        this.log(\"HistoryCollection.initialize\", models, options);\n        _collectionSuper.prototype.initialize.call(this, models, options);\n\n        /** @type {boolean} should deleted histories be included */\n        this.includeDeleted = options.includeDeleted || false;\n\n        /** @type {String} encoded id of the history that's current */\n        this.currentHistoryId = options.currentHistoryId;\n\n        this.setUpListeners();\n        // note: models are sent to reset *after* this fn ends; up to this point\n        // the collection *is empty*\n    },\n\n    urlRoot: `${Galaxy.root}api/histories`,\n    url: function() {\n        return this.urlRoot;\n    },\n\n    /** set up reflexive event handlers */\n    setUpListeners: function setUpListeners() {\n        return this.on({\n            // when a history is deleted, remove it from the collection (if optionally set to do so)\n            \"change:deleted\": function(history) {\n                // TODO: this becomes complicated when more filters are used\n                this.debug(\"change:deleted\", this.includeDeleted, history.get(\"deleted\"));\n                if (!this.includeDeleted && history.get(\"deleted\")) {\n                    this.remove(history);\n                }\n            },\n            // listen for a history copy, setting it to current\n            copied: function(original, newData) {\n                this.setCurrent(new History(newData, []));\n            },\n            // when a history is made current, track the id in the collection\n            \"set-as-current\": function(history) {\n                var oldCurrentId = this.currentHistoryId;\n                this.trigger(\"no-longer-current\", oldCurrentId);\n                this.currentHistoryId = history.id;\n            }\n        });\n    },\n\n    /** override to change view */\n    _buildFetchData: function(options) {\n        return _.extend(_collectionSuper.prototype._buildFetchData.call(this, options), {\n            view: \"dev-detailed\"\n        });\n    },\n\n    /** override to filter out deleted and purged */\n    _buildFetchFilters: function(options) {\n        var superFilters = _collectionSuper.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (!this.includeDeleted) {\n            filters.deleted = false;\n            filters.purged = false;\n        } else {\n            // force API to return both deleted and non\n            //TODO: when the API is updated, remove this\n            filters.deleted = null;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    /** override to fetch current as well (as it may be outside the first 10, etc.) */\n    fetchFirst: function(options) {\n        var self = this;\n        // TODO: batch?\n        var xhr = $.when();\n        if (this.currentHistoryId) {\n            xhr = _collectionSuper.prototype.fetchFirst.call(self, {\n                silent: true,\n                limit: 1,\n                filters: {\n                    // without these a deleted current history will return [] here and block the other xhr\n                    purged: \"\",\n                    deleted: \"\",\n                    \"encoded_id-in\": this.currentHistoryId\n                }\n            });\n        }\n        return xhr.then(() => {\n            options = options || {};\n            options.offset = 0;\n            return self.fetchMore(options);\n        });\n    },\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_collectionSuper.prototype.comparators), {\n        name: BASE_MVC.buildComparator(\"name\", {\n            ascending: true\n        }),\n        \"name-dsc\": BASE_MVC.buildComparator(\"name\", {\n            ascending: false\n        }),\n        size: BASE_MVC.buildComparator(\"size\", {\n            ascending: false\n        }),\n        \"size-asc\": BASE_MVC.buildComparator(\"size\", {\n            ascending: true\n        })\n    }),\n\n    /** override to always have the current history first */\n    sort: function(options) {\n        options = options || {};\n        var silent = options.silent;\n        var currentHistory = this.remove(this.get(this.currentHistoryId));\n        _collectionSuper.prototype.sort.call(this, _.defaults({ silent: true }, options));\n        this.unshift(currentHistory, { silent: true });\n        if (!silent) {\n            this.trigger(\"sort\", this, options);\n        }\n        return this;\n    },\n\n    /** create a new history and by default set it to be the current history */\n    create: function create(data, hdas, historyOptions, xhrOptions) {\n        //TODO: .create is actually a collection function that's overridden here\n        var collection = this;\n\n        var xhr = jQuery.getJSON(`${Galaxy.root}history/create_new_current`);\n        return xhr.done(newData => {\n            collection.setCurrent(new History(newData, [], historyOptions || {}));\n        });\n    },\n\n    /** set the current history to the given history, placing it first in the collection.\n     *  Pass standard bbone options for use in unshift.\n     *  @triggers new-current passed history and this collection\n     */\n    setCurrent: function(history, options) {\n        options = options || {};\n        // new histories go in the front\n        this.unshift(history, options);\n        this.currentHistoryId = history.get(\"id\");\n        if (!options.silent) {\n            this.trigger(\"new-current\", history, this);\n        }\n        return this;\n    },\n\n    toString: function toString() {\n        return `HistoryCollection(${this.length},current:${this.currentHistoryId})`;\n    }\n});\n\n//==============================================================================\nexport default {\n    History: History,\n    HistoryCollection: HistoryCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-model.js","import CONTROLLED_FETCH_COLLECTION from \"mvc/base/controlled-fetch-collection\";\nimport HDA_MODEL from \"mvc/history/hda-model\";\nimport HDCA_MODEL from \"mvc/history/hdca-model\";\nimport HISTORY_PREFS from \"mvc/history/history-preferences\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport AJAX_QUEUE from \"utils/ajax-queue\";\n\n//==============================================================================\nvar _super = CONTROLLED_FETCH_COLLECTION.PaginatedCollection;\n/** @class Backbone collection for history content.\n *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n *          the same level.\n *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n *          HDAs or child dataset collections on one level.\n *      This is why this does not inherit from any of the DatasetCollections (currently).\n */\nvar HistoryContents = _super.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: \"history\",\n\n    // ........................................................................ set up\n    limitPerPage: 500,\n\n    /** @type {Integer} how many contents per call to fetch when using progressivelyFetchDetails */\n    limitPerProgressiveFetch: 500,\n\n    /** @type {String} order used here and when fetching from server */\n    order: \"hid\",\n\n    /** root api url */\n    urlRoot: `${Galaxy.root}api/histories`,\n\n    /** complete api url */\n    url: function() {\n        return `${this.urlRoot}/${this.historyId}/contents`;\n    },\n\n    /** Set up */\n    initialize: function(models, options) {\n        options = options || {};\n        _super.prototype.initialize.call(this, models, options);\n\n        this.history = options.history || null;\n        this.setHistoryId(options.historyId || null);\n        /** @type {Boolean} does this collection contain and fetch deleted elements */\n        this.includeDeleted = options.includeDeleted || this.includeDeleted;\n        /** @type {Boolean} does this collection contain and fetch non-visible elements */\n        this.includeHidden = options.includeHidden || this.includeHidden;\n\n        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n        this.model.prototype.idAttribute = \"type_id\";\n    },\n\n    // ........................................................................ composite collection\n    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n    model: function(attrs, options) {\n        if (attrs.history_content_type === \"dataset\") {\n            return new HDA_MODEL.HistoryDatasetAssociation(attrs, options);\n        } else if (attrs.history_content_type === \"dataset_collection\") {\n            switch (attrs.collection_type) {\n                case \"list\":\n                    return new HDCA_MODEL.HistoryListDatasetCollection(attrs, options);\n                case \"paired\":\n                    return new HDCA_MODEL.HistoryPairDatasetCollection(attrs, options);\n                case \"list:paired\":\n                    return new HDCA_MODEL.HistoryListPairedDatasetCollection(attrs, options);\n                case \"list:list\":\n                    return new HDCA_MODEL.HistoryListOfListsDatasetCollection(attrs, options);\n            }\n            // This is a hack inside a hack:\n            // Raise a plain object with validationError to fake a model.validationError\n            // (since we don't have a model to use validate with)\n            // (the outer hack being the mixed content/model function in this collection)\n            var msg = `Unknown collection_type: ${attrs.collection_type}`;\n            console.warn(msg, attrs);\n            return { validationError: msg };\n        }\n        return {\n            validationError: `Unknown history_content_type: ${attrs.history_content_type}`\n        };\n    },\n\n    setHistoryId: function(newId) {\n        this.historyId = newId;\n        this._setUpWebStorage();\n    },\n\n    /** Set up client side storage. Currently PersistanStorage keyed under 'history:<id>' */\n    _setUpWebStorage: function(initialSettings) {\n        // TODO: use initialSettings\n        if (!this.historyId) {\n            return;\n        }\n        this.storage = new HISTORY_PREFS.HistoryPrefs({\n            id: HISTORY_PREFS.HistoryPrefs.historyStorageKey(this.historyId)\n        });\n        this.trigger(\"new-storage\", this.storage, this);\n\n        this.on({\n            \"include-deleted\": function(newVal) {\n                this.storage.includeDeleted(newVal);\n            },\n            \"include-hidden\": function(newVal) {\n                this.storage.includeHidden(newVal);\n            }\n        });\n\n        this.includeDeleted = this.storage.includeDeleted() || false;\n        this.includeHidden = this.storage.includeHidden() || false;\n        return this;\n    },\n\n    // ........................................................................ common queries\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: _.extend(_.clone(_super.prototype.comparators), {\n        name: BASE_MVC.buildComparator(\"name\", { ascending: true }),\n        \"name-dsc\": BASE_MVC.buildComparator(\"name\", {\n            ascending: false\n        }),\n        hid: BASE_MVC.buildComparator(\"hid\", { ascending: false }),\n        \"hid-asc\": BASE_MVC.buildComparator(\"hid\", { ascending: true })\n    }),\n\n    /** Get every model in this collection not in a 'ready' state (running). */\n    running: function() {\n        return this.filter(c => !c.inReadyState());\n    },\n\n    /** return contents that are not ready and not deleted/hidden */\n    runningAndActive: function() {\n        return this.filter(\n            c =>\n                !c.inReadyState() &&\n                c.get(\"visible\") &&\n                // TODO: deletedOrPurged?\n                !c.get(\"deleted\")\n        );\n    },\n\n    /** Get the model with the given hid\n     *  @param {Int} hid the hid to search for\n     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n     */\n    getByHid: function(hid) {\n        // note: there *can* be more than one content with a given hid, this finds the first based on order\n        return this.findWhere({ hid: hid });\n    },\n\n    /** return true if all contents have details */\n    haveDetails: function() {\n        return this.all(c => c.hasDetails());\n    },\n\n    // ........................................................................ hidden / deleted\n    /** return a new contents collection of only hidden items */\n    hidden: function() {\n        return this.filter(c => c.hidden());\n    },\n\n    /** return a new contents collection of only hidden items */\n    deleted: function() {\n        return this.filter(c => c.get(\"deleted\"));\n    },\n\n    /** return a new contents collection of only hidden items */\n    visibleAndUndeleted: function() {\n        return this.filter(\n            c =>\n                c.get(\"visible\") &&\n                // TODO: deletedOrPurged?\n                !c.get(\"deleted\")\n        );\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeDeleted: function(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeDeleted) {\n            this.includeDeleted = setting;\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-deleted\", setting, this);\n        }\n    },\n\n    /** create a setter in order to publish the change */\n    setIncludeHidden: function(setting, options) {\n        if (_.isBoolean(setting) && setting !== this.includeHidden) {\n            this.includeHidden = setting;\n            options = options || {};\n            if (_.result(options, \"silent\")) {\n                return;\n            }\n            this.trigger(\"include-hidden\", setting, this);\n        }\n    },\n\n    // ........................................................................ ajax\n    // ............ controlled fetch collection\n    /** override to get expanded ids from sessionStorage and pass to API as details */\n    fetch: function(options) {\n        options = options || {};\n        if (this.historyId && !options.details) {\n            var prefs = HISTORY_PREFS.HistoryPrefs.get(this.historyId).toJSON();\n            if (!_.isEmpty(prefs.expandedIds)) {\n                options.details = _.values(prefs.expandedIds).join(\",\");\n            }\n        }\n        return _super.prototype.fetch.call(this, options);\n    },\n\n    // ............. ControlledFetch stuff\n    /** override to include the API versioning flag */\n    _buildFetchData: function(options) {\n        return _.extend(_super.prototype._buildFetchData.call(this, options), {\n            v: \"dev\"\n        });\n    },\n\n    /** Extend to include details and version */\n    _fetchParams: _super.prototype._fetchParams.concat([\n        // TODO: remove (the need for) both\n        /** version */\n        \"v\",\n        /** dataset ids to get full details of */\n        \"details\"\n    ]),\n\n    /** override to add deleted/hidden filters */\n    _buildFetchFilters: function(options) {\n        var superFilters = _super.prototype._buildFetchFilters.call(this, options) || {};\n        var filters = {};\n        if (!this.includeDeleted) {\n            filters.deleted = false;\n            filters.purged = false;\n        }\n        if (!this.includeHidden) {\n            filters.visible = true;\n        }\n        return _.defaults(superFilters, filters);\n    },\n\n    // ............ paginated collection\n    getTotalItemCount: function() {\n        return this.history.contentsShown();\n    },\n\n    // ............ history contents specific ajax\n    /** override to filter requested contents to those updated after the Date 'since' */\n    fetchUpdated: function(since, options) {\n        if (since) {\n            options = options || { filters: {} };\n            options.remove = false;\n            options.filters = {\n                \"update_time-ge\": since.toISOString(),\n                // workflows will produce hidden datasets (non-output datasets) that still\n                // need to be updated in the collection or they'll update forever\n                // we can remove the default visible filter by using an 'empty' value\n                visible: \"\"\n            };\n        }\n        return this.fetch(options);\n    },\n\n    /** fetch all the deleted==true contents of this collection */\n    fetchDeleted: function(options) {\n        options = options || {};\n        options.filters = _.extend(options.filters, {\n            // all deleted, purged or not\n            deleted: true,\n            purged: undefined\n        });\n        options.remove = false;\n\n        this.trigger(\"fetching-deleted\", this);\n        return this.fetch(options).always(() => {\n            this.trigger(\"fetching-deleted-done\", this);\n        });\n    },\n\n    /** fetch all the visible==false contents of this collection */\n    fetchHidden: function(options) {\n        options = options || {};\n        var self = this;\n        options.filters = _.extend(options.filters, {\n            visible: false\n        });\n        options.remove = false;\n\n        self.trigger(\"fetching-hidden\", self);\n        return self.fetch(options).always(() => {\n            self.trigger(\"fetching-hidden-done\", self);\n        });\n    },\n\n    /** fetch detailed model data for all contents in this collection */\n    fetchAllDetails: function(options) {\n        options = options || {};\n        var detailsFlag = { details: \"all\" };\n        options.data = _.extend(options.data || {}, detailsFlag);\n        return this.fetch(options);\n    },\n\n    /** specialty fetch method for retrieving the element_counts of all hdcas in the history */\n    fetchCollectionCounts: function(options) {\n        options = options || {};\n        options.keys = [\"type_id\", \"element_count\"].join(\",\");\n        options.filters = _.extend(options.filters || {}, {\n            history_content_type: \"dataset_collection\"\n        });\n        options.remove = false;\n        return this.fetch(options);\n    },\n\n    // ............. quasi-batch ops\n    // TODO: to batch\n    /** helper that fetches using filterParams then calls save on each fetched using updateWhat as the save params */\n    _filterAndUpdate: function(filterParams, updateWhat) {\n        var self = this;\n        var idAttribute = self.model.prototype.idAttribute;\n        var updateArgs = [updateWhat];\n\n        return self.fetch({ filters: filterParams, remove: false }).then(fetched => {\n            // convert filtered json array to model array\n            fetched = fetched.reduce((modelArray, currJson, i) => {\n                var model = self.get(currJson[idAttribute]);\n                return model ? modelArray.concat(model) : modelArray;\n            }, []);\n            return self.ajaxQueue(\"save\", updateArgs, fetched);\n        });\n    },\n\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue: function(ajaxFn, args, collection) {\n        collection = collection || this.models;\n        return new AJAX_QUEUE.AjaxQueue(\n            collection\n                .slice()\n                .reverse()\n                .map((content, i) => {\n                    var fn = _.isString(ajaxFn) ? content[ajaxFn] : ajaxFn;\n                    return () => fn.apply(content, args);\n                })\n        ).deferred;\n    },\n\n    /** fetch contents' details in batches of limitPerCall - note: only get searchable details here */\n    progressivelyFetchDetails: function(options) {\n        options = options || {};\n        var deferred = jQuery.Deferred();\n        var self = this;\n        var limit = options.limitPerCall || self.limitPerProgressiveFetch;\n        // TODO: only fetch tags and annotations if specifically requested\n        var searchAttributes = HDA_MODEL.HistoryDatasetAssociation.prototype.searchAttributes;\n        var detailKeys = searchAttributes.join(\",\");\n\n        function _recursivelyFetch(offset) {\n            offset = offset || 0;\n            var _options = _.extend(_.clone(options), {\n                view: \"summary\",\n                keys: detailKeys,\n                limit: limit,\n                offset: offset,\n                reset: offset === 0,\n                remove: false\n            });\n\n            _.defer(() => {\n                self.fetch\n                    .call(self, _options)\n                    .fail(deferred.reject)\n                    .done(response => {\n                        deferred.notify(response, limit, offset);\n                        if (response.length !== limit) {\n                            self.allFetched = true;\n                            deferred.resolve(response, limit, offset);\n                        } else {\n                            _recursivelyFetch(offset + limit);\n                        }\n                    });\n            });\n        }\n        _recursivelyFetch();\n        return deferred;\n    },\n\n    /** does some bit of JSON represent something that can be copied into this contents collection */\n    isCopyable: function(contentsJSON) {\n        var copyableModelClasses = [\"HistoryDatasetAssociation\", \"HistoryDatasetCollectionAssociation\"];\n        return (\n            _.isObject(contentsJSON) && contentsJSON.id && _.contains(copyableModelClasses, contentsJSON.model_class)\n        );\n    },\n\n    /** copy an existing, accessible hda into this collection */\n    copy: function(json) {\n        // TODO: somehow showhorn all this into 'save'\n        var id;\n\n        var type;\n        var contentType;\n        if (_.isString(json)) {\n            id = json;\n            contentType = \"hda\";\n            type = \"dataset\";\n        } else {\n            id = json.id;\n            contentType =\n                {\n                    HistoryDatasetAssociation: \"hda\",\n                    LibraryDatasetDatasetAssociation: \"ldda\",\n                    HistoryDatasetCollectionAssociation: \"hdca\"\n                }[json.model_class] || \"hda\";\n            type = contentType === \"hdca\" ? \"dataset_collection\" : \"dataset\";\n        }\n        var collection = this;\n\n        var xhr = jQuery\n            .ajax(this.url(), {\n                method: \"POST\",\n                contentType: \"application/json\",\n                data: JSON.stringify({\n                    content: id,\n                    source: contentType,\n                    type: type\n                })\n            })\n            .done(response => {\n                collection.add([response], { parse: true });\n            })\n            .fail((error, status, message) => {\n                collection.trigger(\"error\", collection, xhr, {}, \"Error copying contents\", {\n                    type: type,\n                    id: id,\n                    source: contentType\n                });\n            });\n\n        return xhr;\n    },\n\n    /** create a new HDCA in this collection */\n    createHDCA: function(elementIdentifiers, collectionType, name, hideSourceItems, options) {\n        // normally collection.create returns the new model, but we need the promise from the ajax, so we fake create\n        //precondition: elementIdentifiers is an array of plain js objects\n        //  in the proper form to create the collectionType\n        var hdca = this.model({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: this.historyId,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            // should probably be able to just send in a bunch of json here and restruct per class\n            // note: element_identifiers is now (incorrectly) an attribute\n            element_identifiers: elementIdentifiers\n            // do not create the model on the client until the ajax returns\n        });\n        return hdca.save(options);\n    },\n\n    // ........................................................................ searching\n    /** return true if all contents have the searchable attributes */\n    haveSearchDetails: function() {\n        return (\n            this.allFetched &&\n            this.all((\n                content // null (which is a valid returned annotation value)\n            ) =>\n                // will return false when using content.has( 'annotation' )\n                //TODO: a bit hacky - formalize\n                _.has(content.attributes, \"annotation\")\n            )\n        );\n    },\n\n    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n    matches: function(matchesWhat) {\n        return this.filter(content => content.matches(matchesWhat));\n    },\n\n    // ........................................................................ misc\n    /** In this override, copy the historyId to the clone */\n    clone: function() {\n        var clone = Backbone.Collection.prototype.clone.call(this);\n        clone.historyId = this.historyId;\n        return clone;\n    },\n\n    /** String representation. */\n    toString: function() {\n        return [\"HistoryContents(\", [this.historyId, this.length].join(), \")\"].join(\"\");\n    }\n});\n\n//==============================================================================\nexport default {\n    HistoryContents: HistoryContents\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-contents.js","import BASE_MVC from \"mvc/base-mvc\";\n\nvar logNamespace = \"history\";\n\n// ============================================================================\n/** session storage for individual history preferences */\nvar HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n    /** @lends HistoryPrefs.prototype */ {\n        //TODO:?? move to user prefs?\n        defaults: {\n            //TODO:?? expandedIds to array?\n            expandedIds: {},\n            show_deleted: false,\n            show_hidden: false\n        },\n\n        /** add an hda id to the hash of expanded hdas */\n        addExpanded: function(model) {\n            //TODO: use type_id and not model\n            var current = this.get(\"expandedIds\");\n            current[model.id] = model.get(\"id\");\n            this.save(\"expandedIds\", current);\n        },\n\n        /** remove an hda id from the hash of expanded hdas */\n        removeExpanded: function(model) {\n            var current = this.get(\"expandedIds\");\n            delete current[model.id];\n            this.save(\"expandedIds\", current);\n        },\n\n        isExpanded: function(contentId) {\n            return _.result(this.get(\"expandedIds\"), contentId, false);\n        },\n\n        allExpanded: function() {\n            return _.values(this.get(\"expandedIds\"));\n        },\n\n        clearExpanded: function() {\n            this.set(\"expandedIds\", {});\n        },\n\n        includeDeleted: function(val) {\n            // moving the invocation here so other components don't need to know the key\n            // TODO: change this key later\n            if (!_.isUndefined(val)) {\n                this.set(\"show_deleted\", val);\n            }\n            return this.get(\"show_deleted\");\n        },\n\n        includeHidden: function(val) {\n            // TODO: change this key later\n            if (!_.isUndefined(val)) {\n                this.set(\"show_hidden\", val);\n            }\n            return this.get(\"show_hidden\");\n        },\n\n        toString: function() {\n            return `HistoryPrefs(${this.id})`;\n        }\n    },\n    {\n        // ........................................................................ class vars\n        // class lvl for access w/o instantiation\n        storageKeyPrefix: \"history:\",\n\n        /** key string to store each histories settings under */\n        historyStorageKey: function historyStorageKey(historyId) {\n            if (!historyId) {\n                throw new Error(`HistoryPrefs.historyStorageKey needs valid id: ${historyId}`);\n            }\n            // single point of change\n            return HistoryPrefs.storageKeyPrefix + historyId;\n        },\n\n        /** return the existing storage for the history with the given id (or create one if it doesn't exist) */\n        get: function get(historyId) {\n            return new HistoryPrefs({\n                id: HistoryPrefs.historyStorageKey(historyId)\n            });\n        },\n\n        /** clear all history related items in sessionStorage */\n        clearAll: function clearAll(historyId) {\n            for (var key in sessionStorage) {\n                if (key.indexOf(HistoryPrefs.storageKeyPrefix) === 0) {\n                    sessionStorage.removeItem(key);\n                }\n            }\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    HistoryPrefs: HistoryPrefs\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-preferences.js","import BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"list\";\n//==============================================================================\n/** A view which, when first rendered, shows only summary data/attributes, but\n *      can be expanded to show further details (and optionally fetch those\n *      details from the server).\n */\nvar ExpandableView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n    //PRECONDITION: model must have method hasDetails\n    //PRECONDITION: subclasses must have templates.el and templates.details\n\n    initialize: function(attributes) {\n        /** are the details of this view expanded/shown or not? */\n        this.expanded = attributes.expanded || false;\n        this.log(\"\\t expanded:\", this.expanded);\n        this.fxSpeed = attributes.fxSpeed !== undefined ? attributes.fxSpeed : this.fxSpeed;\n    },\n\n    // ........................................................................ render main\n    /** jq fx speed */\n    fxSpeed: \"fast\",\n\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render: function(speed) {\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors($newRender);\n        this._queueNewRender($newRender, speed);\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     *      If the view is already expanded, build the details as well.\n     */\n    _buildNewRender: function() {\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = $(this.templates.el(this.model.toJSON(), this));\n        if (this.expanded) {\n            this.$details($newRender).replaceWith(this._renderDetails().show());\n        }\n        return $newRender;\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender: function($newRender, speed) {\n        speed = speed === undefined ? this.fxSpeed : speed;\n        var view = this;\n\n        if (speed === 0) {\n            view._swapNewRender($newRender);\n            view.trigger(\"rendered\", view);\n        } else {\n            $(view).queue(\"fx\", [\n                next => {\n                    view.$el.fadeOut(speed, next);\n                },\n                next => {\n                    view._swapNewRender($newRender);\n                    next();\n                },\n                next => {\n                    view.$el.fadeIn(speed, next);\n                },\n                next => {\n                    view.trigger(\"rendered\", view);\n                    next();\n                }\n            ]);\n        }\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender: function($newRender) {\n        return this.$el\n            .empty()\n            .attr(\"class\", _.isFunction(this.className) ? this.className() : this.className)\n            .append($newRender.children());\n    },\n\n    /** set up js behaviors, event handlers for elements within the given container\n     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n     */\n    _setUpBehaviors: function($where) {\n        $where = $where || this.$el;\n        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n        //make_popup_menus( $where );\n        $where.find(\"[title]\").tooltip({ placement: \"bottom\" });\n    },\n\n    // ......................................................................... details\n    /** shortcut to details DOM (as jQ) */\n    $details: function($where) {\n        $where = $where || this.$el;\n        return $where.find(\"> .details\");\n    },\n\n    /** build the DOM for the details and set up behaviors on it */\n    _renderDetails: function() {\n        var $newDetails = $(this.templates.details(this.model.toJSON(), this));\n        this._setUpBehaviors($newDetails);\n        return $newDetails;\n    },\n\n    // ......................................................................... expansion/details\n    /** Show or hide the details\n     *  @param {Boolean} expand if true, expand; if false, collapse\n     */\n    toggleExpanded: function(expand) {\n        expand = expand === undefined ? !this.expanded : expand;\n        if (expand) {\n            this.expand();\n        } else {\n            this.collapse();\n        }\n        return this;\n    },\n\n    /** Render and show the full, detailed body of this view including extra data and controls.\n     *      note: if the model does not have detailed data, fetch that data before showing the body\n     *  @fires expanded when a body has been expanded\n     */\n    expand: function() {\n        var view = this;\n        return view._fetchModelDetails().always(() => {\n            view._expand();\n        });\n    },\n\n    /** Check for model details and, if none, fetch them.\n     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n     */\n    _fetchModelDetails: function() {\n        if (!this.model.hasDetails()) {\n            return this.model.fetch();\n        }\n        return jQuery.when();\n    },\n\n    /** Inner fn called when expand (public) has fetched the details */\n    _expand: function() {\n        var view = this;\n        var $newDetails = view._renderDetails();\n        view.$details().replaceWith($newDetails);\n        // needs to be set after the above or the slide will not show\n        view.expanded = true;\n        view.$details().slideDown(view.fxSpeed, () => {\n            view.trigger(\"expanded\", view);\n        });\n    },\n\n    /** Hide the body/details of an HDA.\n     *  @fires collapsed when a body has been collapsed\n     */\n    collapse: function() {\n        this.debug(`${this}(ExpandableView).collapse`);\n        var view = this;\n        view.expanded = false;\n        this.$details().slideUp(view.fxSpeed, () => {\n            view.trigger(\"collapsed\", view);\n        });\n    }\n});\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *      Inherits from Expandable, Selectable, Draggable.\n *  The DOM contains warnings, a title bar, and a series of primary action controls.\n *      Primary actions are meant to be easily accessible item functions (such as delete)\n *      that are rendered in the title bar.\n *\n *  Details are rendered when the user clicks the title bar or presses enter/space when\n *      the title bar is in focus.\n *\n *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n */\nvar ListItemView = ExpandableView.extend(\n    BASE_MVC.mixin(BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n        tagName: \"div\",\n        className: \"list-item\",\n\n        /** Set up the base class and all mixins */\n        initialize: function(attributes) {\n            ExpandableView.prototype.initialize.call(this, attributes);\n            BASE_MVC.SelectableViewMixin.initialize.call(this, attributes);\n            BASE_MVC.DraggableViewMixin.initialize.call(this, attributes);\n            this._setUpListeners();\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            // hide the primary actions in the title bar when selectable and narrow\n            this.on(\n                \"selectable\",\n                function(isSelectable) {\n                    if (isSelectable) {\n                        this.$(\".primary-actions\").hide();\n                    } else {\n                        this.$(\".primary-actions\").show();\n                    }\n                },\n                this\n            );\n            return this;\n        },\n\n        // ........................................................................ rendering\n        /** In this override, call methods to build warnings, titlebar and primary actions */\n        _buildNewRender: function() {\n            var $newRender = ExpandableView.prototype._buildNewRender.call(this);\n            $newRender.children(\".warnings\").replaceWith(this._renderWarnings());\n            $newRender.children(\".title-bar\").replaceWith(this._renderTitleBar());\n            $newRender.children(\".primary-actions\").append(this._renderPrimaryActions());\n            $newRender.find(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n            return $newRender;\n        },\n\n        /** In this override, render the selector controls and set up dragging before the swap */\n        _swapNewRender: function($newRender) {\n            ExpandableView.prototype._swapNewRender.call(this, $newRender);\n            if (this.selectable) {\n                this.showSelector(0);\n            }\n            if (this.draggable) {\n                this.draggableOn();\n            }\n            return this.$el;\n        },\n\n        /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n        _renderWarnings: function() {\n            var view = this;\n            var $warnings = $('<div class=\"warnings\"></div>');\n            var json = view.model.toJSON();\n            //TODO:! unordered (map)\n            _.each(view.templates.warnings, templateFn => {\n                $warnings.append($(templateFn(json, view)));\n            });\n            return $warnings;\n        },\n\n        /** Render the title bar (the main/exposed SUMMARY dom element) */\n        _renderTitleBar: function() {\n            return $(this.templates.titleBar(this.model.toJSON(), this));\n        },\n\n        /** Return an array of jQ objects containing common/easily-accessible item controls */\n        _renderPrimaryActions: function() {\n            // override this\n            return [];\n        },\n\n        /** Render the title bar (the main/exposed SUMMARY dom element) */\n        _renderSubtitle: function() {\n            return $(this.templates.subtitle(this.model.toJSON(), this));\n        },\n\n        // ......................................................................... events\n        /** event map */\n        events: {\n            // expand the body when the title is clicked or when in focus and space or enter is pressed\n            \"click .title-bar\": \"_clickTitleBar\",\n            \"keydown .title-bar\": \"_keyDownTitleBar\",\n            \"click .selector\": \"toggleSelect\"\n        },\n\n        /** expand when the title bar is clicked */\n        _clickTitleBar: function(event) {\n            event.stopPropagation();\n            if (event.altKey) {\n                this.toggleSelect(event);\n                if (!this.selectable) {\n                    this.showSelector();\n                }\n            } else {\n                this.toggleExpanded();\n            }\n        },\n\n        /** expand when the title bar is in focus and enter or space is pressed */\n        _keyDownTitleBar: function(event) {\n            // bail (with propagation) if keydown and not space or enter\n            var KEYCODE_SPACE = 32;\n\n            var KEYCODE_RETURN = 13;\n            if (\n                event &&\n                event.type === \"keydown\" &&\n                (event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN)\n            ) {\n                this.toggleExpanded();\n                event.stopPropagation();\n                return false;\n            }\n            return true;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `ListItemView(${modelString})`;\n        }\n    })\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListItemView.prototype.templates = (() => {\n    var elTemplato = BASE_MVC.wrapTemplate([\n        '<div class=\"list-element\">',\n        // errors, messages, etc.\n        '<div class=\"warnings\"></div>',\n\n        // multi-select checkbox\n        '<div class=\"selector\">',\n        '<span class=\"fa fa-2x fa-square-o\"></span>',\n        \"</div>\",\n        // space for title bar buttons - gen. floated to the right\n        '<div class=\"primary-actions\"></div>',\n        '<div class=\"title-bar\"></div>',\n\n        // expandable area for more details\n        '<div class=\"details\"></div>',\n        \"</div>\"\n    ]);\n\n    var warnings = {};\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            //TODO: prob. belongs in dataset-list-item\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.name %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    var subtitleTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"subtitle\"></div>'\n    ]);\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"details\"></div>'\n    ]);\n\n    return {\n        el: elTemplato,\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate,\n        details: detailsTemplate\n    };\n})();\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n *      If 'foldout': will expand vertically to show the nested list\n *      If 'drilldown': will overlay the parent list\n *\n *  Inherits from ListItemView.\n *\n *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n */\nvar FoldoutListItemView = ListItemView.extend({\n    /** If 'foldout': show the sub-panel inside the expanded item\n     *  If 'drilldown': only fire events and handle by pub-sub\n     *      (allow the panel containing this item to attach it, hide itself, etc.)\n     */\n    foldoutStyle: \"foldout\",\n    /** Panel view class to instantiate for the sub-panel */\n    foldoutPanelClass: null,\n\n    /** override to:\n     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n     *      disrespect attributes.expanded if drilldown\n     */\n    initialize: function(attributes) {\n        if (this.foldoutStyle === \"drilldown\") {\n            this.expanded = false;\n        }\n        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\n        ListItemView.prototype.initialize.call(this, attributes);\n        this.foldout = this._createFoldoutPanel();\n    },\n\n    /** in this override, attach the foldout panel when rendering details */\n    _renderDetails: function() {\n        if (this.foldoutStyle === \"drilldown\") {\n            return $();\n        }\n        var $newDetails = ListItemView.prototype._renderDetails.call(this);\n        return this._attachFoldout(this.foldout, $newDetails);\n    },\n\n    /** In this override, handle collection expansion. */\n    _createFoldoutPanel: function() {\n        var model = this.model;\n        var FoldoutClass = this._getFoldoutPanelClass(model);\n        var options = this._getFoldoutPanelOptions(model);\n\n        var foldout = new FoldoutClass(\n            _.extend(options, {\n                model: model\n            })\n        );\n\n        return foldout;\n    },\n\n    /** Stub to return proper foldout panel class */\n    _getFoldoutPanelClass: function() {\n        // override\n        return this.foldoutPanelClass;\n    },\n\n    /** Stub to return proper foldout panel options */\n    _getFoldoutPanelOptions: function() {\n        return {\n            // propagate foldout style down\n            foldoutStyle: this.foldoutStyle,\n            fxSpeed: this.fxSpeed\n        };\n    },\n\n    /** Render the foldout panel inside the view, hiding controls */\n    _attachFoldout: function(foldout, $whereTo) {\n        $whereTo = $whereTo || this.$(\"> .details\");\n        this.foldout = foldout.render(0);\n        foldout.$(\"> .controls\").hide();\n        return $whereTo.append(foldout.$el);\n    },\n\n    /** In this override, branch on foldoutStyle to show expanded */\n    expand: function() {\n        var view = this;\n        return view._fetchModelDetails().always(() => {\n            if (view.foldoutStyle === \"foldout\") {\n                view._expand();\n            } else if (view.foldoutStyle === \"drilldown\") {\n                view._expandByDrilldown();\n            }\n        });\n    },\n\n    /** For drilldown, set up close handler and fire expanded:drilldown\n     *      containing views can listen to this and handle other things\n     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n     */\n    _expandByDrilldown: function() {\n        var view = this;\n        // attachment and rendering done by listener\n        view.listenTo(view.foldout, \"close\", () => {\n            view.trigger(\"collapsed:drilldown\", view, view.foldout);\n        });\n        view.trigger(\"expanded:drilldown\", view, view.foldout);\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nFoldoutListItemView.prototype.templates = (() => {\n    var detailsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            // override with more info (that goes above the panel)\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        details: detailsTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    ExpandableView: ExpandableView,\n    ListItemView: ListItemView,\n    FoldoutListItemView: FoldoutListItemView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/list/list-item.js","import LIST_ITEM from \"mvc/list/list-item\";\nimport STATES from \"mvc/dataset/states\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"dataset\";\n/*==============================================================================\nTODO:\n    straighten out state rendering and templates used\n    inaccessible/STATES.NOT_VIEWABLE is a special case\n    simplify button rendering\n\n==============================================================================*/\nvar _super = LIST_ITEM.ListItemView;\n/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n *      Roughly, any DatasetInstance (and not a raw Dataset).\n */\nvar DatasetListItemView = _super.extend(\n    /** @lends DatasetListItemView.prototype */ {\n        _logNamespace: logNamespace,\n\n        className: `${_super.prototype.className} dataset`,\n        //TODO:?? doesn't exactly match an hda's type_id\n        id: function() {\n            return [\"dataset\", this.model.get(\"id\")].join(\"-\");\n        },\n\n        /** Set up: instance vars, options, and event handlers */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(`${this}.initialize:`, attributes);\n            _super.prototype.initialize.call(this, attributes);\n\n            /** where should pages from links be displayed? (default to new tab/window) */\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            var self = this;\n\n            // re-rendering on any model changes\n            return self.listenTo(self.model, {\n                change: function(model) {\n                    // if the model moved into the ready state and is expanded without details, fetch those details now\n                    if (\n                        self.model.changedAttributes().state &&\n                        self.model.inReadyState() &&\n                        self.expanded &&\n                        !self.model.hasDetails()\n                    ) {\n                        // normally, will render automatically (due to fetch -> change),\n                        // but! setting_metadata sometimes doesn't cause any other changes besides state\n                        // so, not rendering causes it to seem frozen in setting_metadata state\n                        self.model.fetch({ silent: true }).done(() => {\n                            self.render();\n                        });\n                    } else {\n                        if (_.has(model.changed, \"tags\") && _.keys(model.changed).length === 1) {\n                            // If only the tags have changed, rerender specifically\n                            // the titlebar region.  Otherwise default to the full\n                            // render.\n                            self.$(\".nametags\").html(self._renderNametags());\n                        } else {\n                            self.render();\n                        }\n                    }\n                }\n            });\n        },\n\n        // ......................................................................... expandable\n        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return jQuery.when();\n        },\n\n        // ......................................................................... removal\n        /** Remove this view's html from the DOM and remove all event listeners.\n         *  @param {Number or String} speed jq effect speed\n         *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n         */\n        remove: function(speed, callback) {\n            var view = this;\n            speed = speed || this.fxSpeed;\n            this.$el.fadeOut(speed, () => {\n                Backbone.View.prototype.remove.call(view);\n                if (callback) {\n                    callback.call(view);\n                }\n            });\n        },\n\n        // ......................................................................... rendering\n        /* TODO:\n        dataset states are the issue primarily making dataset rendering complex\n            each state should have it's own way of displaying/set of details\n            often with different actions that can be applied\n        throw in deleted/purged/visible and things get complicated easily\n        I've considered (a couple of times) - creating a view for each state\n            - but recreating the view during an update...seems wrong\n    */\n        /** In this override, add the dataset state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            _super.prototype._swapNewRender.call(this, $newRender);\n            if (this.model.has(\"state\")) {\n                this.$el.addClass(`state-${this.model.get(\"state\")}`);\n            }\n            return this.$el;\n        },\n\n        // ................................................................................ titlebar\n        /** In this override, add the dataset display button. */\n        _renderPrimaryActions: function() {\n            // render just the display for read-only\n            return [this._renderDisplayButton()];\n        },\n\n        /** Render icon-button to display dataset data */\n        _renderDisplayButton: function() {\n            // don't show display if not viewable or not accessible\n            var state = this.model.get(\"state\");\n            if (state === STATES.NOT_VIEWABLE || state === STATES.DISCARDED || !this.model.get(\"accessible\")) {\n                return null;\n            }\n\n            var displayBtnData = {\n                target: this.linkTarget,\n                classes: \"display-btn\"\n            };\n\n            // show a disabled display if the data's been purged\n            if (this.model.get(\"purged\")) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"Cannot display datasets removed from disk\");\n\n                // disable if still uploading\n            } else if (state === STATES.UPLOAD) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"This dataset must finish uploading before it can be viewed\");\n\n                // disable if still new\n            } else if (state === STATES.NEW) {\n                displayBtnData.disabled = true;\n                displayBtnData.title = _l(\"This dataset is not yet viewable\");\n            } else {\n                displayBtnData.title = _l(\"View data\");\n\n                // default link for dataset\n                displayBtnData.href = this.model.urls.display;\n\n                // add frame manager option onclick event\n                var self = this;\n                displayBtnData.onclick = ev => {\n                    if (Galaxy.frame && Galaxy.frame.active) {\n                        // Add dataset to frames.\n                        Galaxy.frame.addDataset(self.model.get(\"id\"));\n                        ev.preventDefault();\n                    }\n                };\n            }\n            displayBtnData.faIcon = \"fa-eye\";\n            return faIconButton(displayBtnData);\n        },\n\n        // ......................................................................... rendering details\n        /** Render the enclosing div of the hda body and, if expanded, the html in the body\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderDetails: function() {\n            //TODO: generalize to be allow different details for each state\n\n            // no access - render nothing but a message\n            if (this.model.get(\"state\") === STATES.NOT_VIEWABLE) {\n                return $(this.templates.noAccess(this.model.toJSON(), this));\n            }\n\n            var $details = _super.prototype._renderDetails.call(this);\n            $details\n                .find(\".actions .left\")\n                .empty()\n                .append(this._renderSecondaryActions());\n            $details\n                .find(\".summary\")\n                .html(this._renderSummary())\n                .prepend(this._renderDetailMessages());\n            $details.find(\".display-applications\").html(this._renderDisplayApplications());\n\n            this._setUpBehaviors($details);\n            return $details;\n        },\n\n        /** Defer to the appropo summary rendering fn based on state */\n        _renderSummary: function() {\n            var json = this.model.toJSON();\n            var summaryRenderFn = this.templates.summaries[json.state];\n            summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n            return summaryRenderFn(json, this);\n        },\n\n        /** Render messages to be displayed only when the details are shown */\n        _renderDetailMessages: function() {\n            var view = this;\n            var $warnings = $('<div class=\"detail-messages\"></div>');\n            var json = view.model.toJSON();\n            //TODO:! unordered (map)\n            _.each(view.templates.detailMessages, templateFn => {\n                $warnings.append($(templateFn(json, view)));\n            });\n            return $warnings;\n        },\n\n        /** Render the external display application links */\n        _renderDisplayApplications: function() {\n            if (this.model.isDeletedOrPurged()) {\n                return \"\";\n            }\n            // render both old and new display apps using the same template\n            return [\n                this.templates.displayApplications(this.model.get(\"display_apps\"), this),\n                this.templates.displayApplications(this.model.get(\"display_types\"), this)\n            ].join(\"\");\n        },\n\n        // ......................................................................... secondary/details actions\n        /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n        _renderSecondaryActions: function() {\n            this.debug(\"_renderSecondaryActions\");\n            switch (this.model.get(\"state\")) {\n                case STATES.NOT_VIEWABLE:\n                    return [];\n                case STATES.OK:\n                case STATES.FAILED_METADATA:\n                case STATES.ERROR:\n                    return [this._renderDownloadButton(), this._renderShowParamsButton()];\n            }\n            return [this._renderShowParamsButton()];\n        },\n\n        /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderShowParamsButton: function() {\n            // gen. safe to show in all cases\n            return faIconButton({\n                title: _l(\"View details\"),\n                classes: \"params-btn\",\n                href: this.model.urls.show_params,\n                target: this.linkTarget,\n                faIcon: \"fa-info-circle\",\n                onclick: function(ev) {\n                    if (Galaxy.frame && Galaxy.frame.active) {\n                        Galaxy.frame.add({\n                            title: \"Dataset details\",\n                            url: this.href\n                        });\n                        ev.preventDefault();\n                        ev.stopPropagation();\n                    }\n                }\n            });\n        },\n\n        /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n         *  @returns {jQuery} rendered DOM\n         */\n        _renderDownloadButton: function() {\n            // don't show anything if the data's been purged\n            if (this.model.get(\"purged\") || !this.model.hasData()) {\n                return null;\n            }\n\n            // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n            //  or a single download icon-button (if there are no meta files)\n            if (!_.isEmpty(this.model.get(\"meta_files\"))) {\n                return this._renderMetaFileDownloadButton();\n            }\n\n            return $(\n                [\n                    '<a class=\"download-btn icon-btn\" ',\n                    'href=\"',\n                    this.model.urls.download,\n                    `\" title=\"${_l(\"Download\")}\" download>`,\n                    '<span class=\"fa fa-floppy-o\"></span>',\n                    \"</a>\"\n                ].join(\"\")\n            );\n        },\n\n        /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n        _renderMetaFileDownloadButton: function() {\n            var urls = this.model.urls;\n            return $(\n                [\n                    '<div class=\"metafile-dropdown dropdown\">',\n                    '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"',\n                    ` title=\"${_l(\"Download\")}\">`,\n                    '<span class=\"fa fa-floppy-o\"></span>',\n                    \"</a>\",\n                    '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">',\n                    `<li><a href=\"${urls.download}\" download>`,\n                    _l(\"Download dataset\"),\n                    \"</a></li>\",\n                    _.map(this.model.get(\"meta_files\"), meta_file =>\n                        [\n                            '<li><a href=\"',\n                            urls.meta_download + meta_file.file_type,\n                            '\">',\n                            _l(\"Download\"),\n                            \" \",\n                            meta_file.file_type,\n                            \"</a></li>\"\n                        ].join(\"\")\n                    ).join(\"\\n\"),\n                    \"</ul>\",\n                    \"</div>\"\n                ].join(\"\\n\")\n            );\n        },\n\n        _renderNametags: function() {\n            var tpl = _.template(\n                [\n                    \"<% _.each(_.sortBy(_.uniq(tags), function(x) { return x }), function(tag){ %>\",\n                    '<% if (tag.indexOf(\"name:\") == 0){ %>',\n                    '<span class=\"label label-info\"><%- tag.slice(5) %></span>',\n                    \"<% } %>\",\n                    \"<% }); %>\"\n                ].join(\"\")\n            );\n            return tpl({ tags: this.model.get(\"tags\") });\n        },\n\n        // ......................................................................... misc\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .display-btn\": function(ev) {\n                this.trigger(\"display\", this, ev);\n            },\n            \"click .params-btn\": function(ev) {\n                this.trigger(\"params\", this, ev);\n            },\n            \"click .download-btn\": function(ev) {\n                this.trigger(\"download\", this, ev);\n            }\n        }),\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemView.prototype.templates = (() => {\n    //TODO: move to require text! plugin\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: BASE_MVC.wrapTemplate([\n            // failed metadata is rendered as a warning on an otherwise ok dataset view\n            '<% if( model.state === \"failed_metadata\" ){ %>',\n            '<div class=\"warningmessagesmall\">',\n            _l(\"An error occurred setting the metadata for this dataset\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        error: BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            \"<% if( model.error ){ %>\",\n            '<div class=\"errormessagesmall\">',\n            _l(\"There was an error getting the data for this dataset\"),\n            \": <%- model.error %>\",\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        purged: BASE_MVC.wrapTemplate([\n            \"<% if( model.purged ){ %>\",\n            '<div class=\"purged-msg warningmessagesmall\">',\n            _l(\"This dataset has been deleted and removed from disk\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        deleted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.deleted && !model.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This dataset has been deleted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n\n        //NOTE: hidden warning is only needed for HDAs\n    });\n\n    var detailsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            '<div class=\"summary\"></div>',\n\n            '<div class=\"actions clear\">',\n            '<div class=\"left\"></div>',\n            '<div class=\"right\"></div>',\n            \"</div>\",\n\n            // do not display tags, annotation, display apps, or peek when deleted\n            \"<% if( !dataset.deleted && !dataset.purged ){ %>\",\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"display-applications\"></div>',\n\n            \"<% if( dataset.peek ){ %>\",\n            '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>',\n            \"<% } %>\",\n            \"<% } %>\",\n            \"</div>\"\n        ],\n        \"dataset\"\n    );\n\n    var noAccessTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"details\">',\n            '<div class=\"summary\">',\n            _l(\"You do not have permission to view this dataset\"),\n            \"</div>\",\n            \"</div>\"\n        ],\n        \"dataset\"\n    );\n\n    //TODO: still toooooooooooooo complex - rework\n    var summaryTemplates = {};\n    summaryTemplates[STATES.OK] = summaryTemplates[STATES.FAILED_METADATA] = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( dataset.misc_blurb ){ %>\",\n            '<div class=\"blurb\">',\n            '<span class=\"value\"><%- dataset.misc_blurb %></span>',\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.file_ext ){ %>\",\n            '<div class=\"datatype\">',\n            '<label class=\"prompt\">',\n            _l(\"format\"),\n            \"</label>\",\n            '<span class=\"value\"><%- dataset.file_ext %></span>',\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.metadata_dbkey ){ %>\",\n            '<div class=\"dbkey\">',\n            '<label class=\"prompt\">',\n            _l(\"database\"),\n            \"</label>\",\n            '<span class=\"value\">',\n            \"<%- dataset.metadata_dbkey %>\",\n            \"</span>\",\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( dataset.misc_info ){ %>\",\n            '<div class=\"info\">',\n            '<span class=\"value\"><%- dataset.misc_info %></span>',\n            \"</div>\",\n            \"<% } %>\"\n        ],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.NEW] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This is a new dataset and not all of its data are available yet\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.NOT_VIEWABLE] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"You do not have permission to view this dataset\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.DISCARDED] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"The job creating this dataset was cancelled before completion\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.QUEUED] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This job is waiting to run\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.RUNNING] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This job is currently running\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.UPLOAD] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"This dataset is currently uploading\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.SETTING_METADATA] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"Metadata is being auto-detected\"), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.PAUSED] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l('This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume'), \"</div>\"],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.ERROR] = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( !dataset.purged ){ %>\",\n            \"<div><%- dataset.misc_blurb %></div>\",\n            \"<% } %>\",\n            '<span class=\"help-text\">',\n            _l(\"An error occurred with this dataset\"),\n            \":</span>\",\n            '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'\n        ],\n        \"dataset\"\n    );\n    summaryTemplates[STATES.EMPTY] = BASE_MVC.wrapTemplate(\n        [\"<div>\", _l(\"No data\"), \": <i><%- dataset.misc_blurb %></i></div>\"],\n        \"dataset\"\n    );\n    summaryTemplates.unknown = BASE_MVC.wrapTemplate(\n        ['<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'],\n        \"dataset\"\n    );\n\n    // messages to be displayed only within the details section ('below the fold')\n    var detailMessageTemplates = {\n        resubmitted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.resubmitted ){ %>\",\n            '<div class=\"resubmitted-msg infomessagesmall\">',\n            _l(\"The job creating this dataset has been resubmitted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n    };\n\n    // this is applied to both old and new style display apps\n    var displayApplicationsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% _.each( apps, function( app ){ %>\",\n            '<div class=\"display-application\">',\n            '<span class=\"display-application-location\"><%- app.label %></span> ',\n            '<span class=\"display-application-links\">',\n            \"<% _.each( app.links, function( link ){ %>\",\n            '<a target=\"<%- link.target %>\" href=\"<%- link.href %>\">',\n            \"<% print( _l( link.text ) ); %>\",\n            \"</a> \",\n            \"<% }); %>\",\n            \"</span>\",\n            \"</div>\",\n            \"<% }); %>\"\n        ],\n        \"apps\"\n    );\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        details: detailsTemplate,\n        noAccess: noAccessTemplate,\n        summaries: summaryTemplates,\n        detailMessages: detailMessageTemplates,\n        displayApplications: displayApplicationsTemplate\n    });\n})();\n\n// ============================================================================\nexport default {\n    DatasetListItemView: DatasetListItemView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/dataset-li.js","import LIST_ITEM from \"mvc/list/list-item\";\nimport DATASET_LI from \"mvc/dataset/dataset-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar FoldoutListItemView = LIST_ITEM.FoldoutListItemView;\n\nvar ListItemView = LIST_ITEM.ListItemView;\n/** @class Read only view for DatasetCollection.\n */\nvar DCListItemView = FoldoutListItemView.extend(\n    /** @lends DCListItemView.prototype */ {\n        className: `${FoldoutListItemView.prototype.className} dataset-collection`,\n        id: function() {\n            return [\"dataset_collection\", this.model.get(\"id\")].join(\"-\");\n        },\n\n        /** override to add linkTarget */\n        initialize: function(attributes) {\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n            this.hasUser = attributes.hasUser;\n            FoldoutListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        /** event listeners */\n        _setUpListeners: function() {\n            FoldoutListItemView.prototype._setUpListeners.call(this);\n            this.listenTo(this.model, \"change\", function(model, options) {\n                // if the model has changed deletion status render it entirely\n                if (_.has(model.changed, \"deleted\")) {\n                    this.render();\n\n                    // if the model has been decorated after the fact with the element count,\n                    // render the subtitle where the count is displayed\n                } else if (_.has(model.changed, \"element_count\")) {\n                    this.$(\"> .title-bar .subtitle\").replaceWith(this._renderSubtitle());\n                }\n            });\n        },\n\n        // ......................................................................... rendering\n        /** render a subtitle to show the user what sort of collection this is */\n        _renderSubtitle: function() {\n            return $(this.templates.subtitle(this.model.toJSON(), this));\n        },\n\n        // ......................................................................... foldout\n        /** override to add linktarget to sub-panel */\n        _getFoldoutPanelOptions: function() {\n            var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call(this);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                hasUser: this.hasUser\n            });\n        },\n\n        /** override to not catch sub-panel selectors */\n        $selector: function() {\n            return this.$(\"> .selector\");\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCListItemView.prototype.templates = (() => {\n    var warnings = _.extend({}, FoldoutListItemView.prototype.templates.warnings, {\n        error: BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            \"<% if( model.error ){ %>\",\n            '<div class=\"errormessagesmall\">',\n            _l(\"There was an error getting the data for this collection\"),\n            \": <%- model.error %>\",\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        purged: BASE_MVC.wrapTemplate([\n            \"<% if( model.purged ){ %>\",\n            '<div class=\"purged-msg warningmessagesmall\">',\n            _l(\"This collection has been deleted and removed from disk\"),\n            \"</div>\",\n            \"<% } %>\"\n        ]),\n        deleted: BASE_MVC.wrapTemplate([\n            // deleted not purged\n            \"<% if( model.deleted && !model.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This collection has been deleted\"),\n            \"</div>\",\n            \"<% } %>\"\n        ])\n    });\n\n    // use element identifier\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    // use element identifier\n    var subtitleTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"subtitle\">',\n            '<% var countText = collection.element_count? ( collection.element_count + \" \" ) : \"\"; %>',\n            '<%        if( collection.collection_type === \"list\" ){ %>',\n            _l(\"a list of <%- countText %>datasets\"),\n            '<% } else if( collection.collection_type === \"paired\" ){ %>',\n            _l(\"a pair of datasets\"),\n            '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n            _l(\"a list of <%- countText %>dataset pairs\"),\n            '<% } else if( collection.collection_type === \"list:list\" ){ %>',\n            _l(\"a list of <%- countText %>dataset lists\"),\n            \"<% } %>\",\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    return _.extend({}, FoldoutListItemView.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate,\n        subtitle: subtitleTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemView = ListItemView.extend(\n    /** @lends DCEListItemView.prototype */ {\n        /** add the DCE class to the list item */\n        className: `${ListItemView.prototype.className} dataset-collection-element`,\n\n        /** set up */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(\"DCEListItemView.initialize:\", attributes);\n            ListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCEListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCEListItemView.prototype.templates = (() => {\n    // use the element identifier here - since that will persist and the user will need it\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.element_identifier %></span>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    return _.extend({}, ListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemView = DATASET_LI.DatasetListItemView.extend(\n    /** @lends DatasetDCEListItemView.prototype */ {\n        className: `${DATASET_LI.DatasetListItemView.prototype.className} dataset-collection-element`,\n\n        /** set up */\n        initialize: function(attributes) {\n            if (attributes.logger) {\n                this.logger = this.model.logger = attributes.logger;\n            }\n            this.log(\"DatasetDCEListItemView.initialize:\", attributes);\n            DATASET_LI.DatasetListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        /** In this override, only get details if in the ready state.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return jQuery.when();\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetDCEListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemView.prototype.templates = (() => {\n    // use the element identifier here and not the dataset name\n    //TODO:?? can we steal the DCE titlebar?\n    var titleBarTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n            '<span class=\"name\"><%- element.element_identifier %></span>',\n            \"</div>\",\n            \"</div>\"\n        ],\n        \"element\"\n    );\n\n    return _.extend({}, DATASET_LI.DatasetListItemView.prototype.templates, {\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemView = DCListItemView.extend(\n    /** @lends NestedDCDCEListItemView.prototype */ {\n        className: `${DCListItemView.prototype.className} dataset-collection-element`,\n\n        /** In this override, add the state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            DCListItemView.prototype._swapNewRender.call(this, $newRender);\n            var state = this.model.get(\"state\") || \"ok\";\n            this.$el.addClass(`state-${state}`);\n            return this.$el;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `NestedDCDCEListItemView(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DCListItemView: DCListItemView,\n    DCEListItemView: DCEListItemView,\n    DatasetDCEListItemView: DatasetDCEListItemView,\n    NestedDCDCEListItemView: NestedDCDCEListItemView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/collection-li.js","/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(response => {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(response => {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: `Failed to load resource ${self.url}.`,\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(response => {\n                var success_message = {\n                    message: response.message,\n                    status: \"success\",\n                    persistent: false\n                };\n                if (self.redirect) {\n                    window.location = `${Galaxy.root + self.redirect}?${$.param(success_message)}`;\n                } else {\n                    form.data.matchModel(response, (input, input_id) => {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(response => {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/form/form-wrapper.js","import STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"dataset\";\n//==============================================================================\nvar searchableMixin = BASE_MVC.SearchableModelMixin;\n/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n */\nvar DatasetAssociation = Backbone.Model.extend(BASE_MVC.LoggableMixin).extend(\n    BASE_MVC.mixin(\n        searchableMixin,\n        /** @lends DatasetAssociation.prototype */ {\n            _logNamespace: logNamespace,\n\n            /** default attributes for a model */\n            defaults: {\n                state: STATES.NEW,\n                deleted: false,\n                purged: false,\n                name: \"(unnamed dataset)\",\n                accessible: true,\n                // sniffed datatype (sam, tabular, bed, etc.)\n                data_type: \"\",\n                file_ext: \"\",\n                file_size: 0,\n\n                // array of associated file types (eg. [ 'bam_index', ... ])\n                meta_files: [],\n\n                misc_blurb: \"\",\n                misc_info: \"\",\n\n                tags: []\n                // do NOT default on annotation, as this default is valid and will be passed on 'save'\n                //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n                //annotation          : ''\n            },\n\n            /** instance vars and listeners */\n            initialize: function(attributes, options) {\n                this.debug(`${this}(Dataset).initialize`, attributes, options);\n\n                //!! this state is not in trans.app.model.Dataset.states - set it here -\n                if (!this.get(\"accessible\")) {\n                    this.set(\"state\", STATES.NOT_VIEWABLE);\n                }\n\n                /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n                this.urls = this._generateUrls();\n\n                this._setUpListeners();\n            },\n\n            /** returns misc. web urls for rendering things like re-run, display, etc. */\n            _generateUrls: function() {\n                var id = this.get(\"id\");\n                if (!id) {\n                    return {};\n                }\n                var urls = {\n                    purge: `datasets/${id}/purge_async`,\n                    display: `datasets/${id}/display/?preview=True`,\n                    edit: `datasets/edit?dataset_id=${id}`,\n                    download: `datasets/${id}/display${this._downloadQueryParameters()}`,\n                    report_error: `dataset/errors?id=${id}`,\n                    rerun: `tool_runner/rerun?id=${id}`,\n                    show_params: `datasets/${id}/show_params`,\n                    visualization: \"visualization\",\n                    meta_download: `dataset/get_metadata_file?hda_id=${id}&metadata_name=`\n                };\n                _.each(urls, (value, key) => {\n                    urls[key] = Galaxy.root + value;\n                });\n                this.urls = urls;\n                return urls;\n            },\n\n            _downloadQueryParameters: function() {\n                return `?to_ext=${this.get(\"file_ext\")}`;\n            },\n\n            /** set up any event listeners\n             *  event: state:ready  fired when this DA moves into/is already in a ready state\n             */\n            _setUpListeners: function() {\n                // if the state has changed and the new state is a ready state, fire an event\n                this.on(\"change:state\", function(currModel, newState) {\n                    this.log(`${this} has changed state:`, currModel, newState);\n                    if (this.inReadyState()) {\n                        this.trigger(\"state:ready\", currModel, newState, this.previous(\"state\"));\n                    }\n                });\n                // the download url (currently) relies on having a correct file extension\n                this.on(\"change:id change:file_ext\", function(currModel) {\n                    this._generateUrls();\n                });\n            },\n\n            // ........................................................................ common queries\n            /** override to add urls */\n            toJSON: function() {\n                var json = Backbone.Model.prototype.toJSON.call(this);\n                //console.warn( 'returning json?' );\n                //return json;\n                return _.extend(json, {\n                    urls: this.urls\n                });\n            },\n\n            /** Is this dataset deleted or purged? */\n            isDeletedOrPurged: function() {\n                return this.get(\"deleted\") || this.get(\"purged\");\n            },\n\n            /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n             *      processing (for the ds) is left to do on the server.\n             */\n            inReadyState: function() {\n                var ready = _.contains(STATES.READY_STATES, this.get(\"state\"));\n                return this.isDeletedOrPurged() || ready;\n            },\n\n            /** Does this model already contain detailed data (as opposed to just summary level data)? */\n            hasDetails: function() {\n                // if it's inaccessible assume it has everything it needs\n                if (!this.get(\"accessible\")) {\n                    return true;\n                }\n                return this.has(\"annotation\");\n            },\n\n            /** Convenience function to match dataset.has_data. */\n            hasData: function() {\n                return this.get(\"file_size\") > 0;\n            },\n\n            // ........................................................................ ajax\n            fetch: function(options) {\n                var dataset = this;\n                return Backbone.Model.prototype.fetch.call(this, options).always(() => {\n                    dataset._generateUrls();\n                });\n            },\n\n            /** override to use actual Dates objects for create/update times */\n            parse: function(response, options) {\n                var parsed = Backbone.Model.prototype.parse.call(this, response, options);\n                if (parsed.create_time) {\n                    parsed.create_time = new Date(parsed.create_time);\n                }\n                if (parsed.update_time) {\n                    parsed.update_time = new Date(parsed.update_time);\n                }\n                return parsed;\n            },\n\n            /** override to wait by default */\n            save: function(attrs, options) {\n                options = options || {};\n                options.wait = _.isUndefined(options.wait) ? true : options.wait;\n                return Backbone.Model.prototype.save.call(this, attrs, options);\n            },\n\n            //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n            /** save this dataset, _Mark_ing it as deleted (just a flag) */\n            delete: function(options) {\n                if (this.get(\"deleted\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: true }, options);\n            },\n            /** save this dataset, _Mark_ing it as undeleted */\n            undelete: function(options) {\n                if (!this.get(\"deleted\") || this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                return this.save({ deleted: false }, options);\n            },\n\n            /** remove the file behind this dataset from the filesystem (if permitted) */\n            purge: function _purge(options) {\n                //TODO: use, override model.destroy, HDA.delete({ purge: true })\n                if (this.get(\"purged\")) {\n                    return jQuery.when();\n                }\n                options = options || {};\n                options.url = this.urls.purge;\n\n                //TODO: ideally this would be a DELETE call to the api\n                //  using purge async for now\n                var hda = this;\n\n                var xhr = jQuery.ajax(options);\n                xhr.done((message, status, responseObj) => {\n                    hda.set({ deleted: true, purged: true });\n                });\n                xhr.fail((xhr, status, message) => {\n                    // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n                    // unbury and re-add to xhr\n                    var error = _l(\"Unable to purge dataset\");\n                    var messageBuriedInUnfortunatelyFormattedError =\n                        \"Removal of datasets by users \" + \"is not allowed in this Galaxy instance\";\n                    if (xhr.responseJSON && xhr.responseJSON.error) {\n                        error = xhr.responseJSON.error;\n                    } else if (xhr.responseText.indexOf(messageBuriedInUnfortunatelyFormattedError) !== -1) {\n                        error = messageBuriedInUnfortunatelyFormattedError;\n                    }\n                    xhr.responseText = error;\n                    hda.trigger(\"error\", hda, xhr, options, _l(error), {\n                        error: error\n                    });\n                });\n                return xhr;\n            },\n\n            // ........................................................................ searching\n            /** what attributes of an HDA will be used in a text search */\n            searchAttributes: [\"name\", \"file_ext\", \"genome_build\", \"misc_blurb\", \"misc_info\", \"annotation\", \"tags\"],\n\n            /** our attr keys don't often match the labels we display to the user - so, when using\n             *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n             *      following attr keys.\n             */\n            searchAliases: {\n                title: \"name\",\n                format: \"file_ext\",\n                database: \"genome_build\",\n                blurb: \"misc_blurb\",\n                description: \"misc_blurb\",\n                info: \"misc_info\",\n                tag: \"tags\"\n            },\n\n            // ........................................................................ misc\n            /** String representation */\n            toString: function() {\n                var nameAndId = this.get(\"id\") || \"\";\n                if (this.get(\"name\")) {\n                    nameAndId = `\"${this.get(\"name\")}\",${nameAndId}`;\n                }\n                return `Dataset(${nameAndId})`;\n            }\n        }\n    )\n);\n\n//==============================================================================\n/** @class Backbone collection for dataset associations.\n */\nvar DatasetAssociationCollection = Backbone.Collection.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends HistoryContents.prototype */ {\n        _logNamespace: logNamespace,\n\n        model: DatasetAssociation,\n\n        /** root api url */\n        urlRoot: `${Galaxy.root}api/datasets`,\n\n        /** url fn */\n        url: function() {\n            return this.urlRoot;\n        },\n\n        // ........................................................................ common queries\n        /** Get the ids of every item in this collection\n         *  @returns array of encoded ids\n         */\n        ids: function() {\n            return this.map(item => item.get(\"id\"));\n        },\n\n        /** Get contents that are not ready\n         *  @returns array of content models\n         */\n        notReady: function() {\n            return this.filter(content => !content.inReadyState());\n        },\n\n        /** return true if any datasets don't have details */\n        haveDetails: function() {\n            return this.all(dataset => dataset.hasDetails());\n        },\n\n        // ........................................................................ ajax\n        /** using a queue, perform ajaxFn on each of the models in this collection */\n        ajaxQueue: function(ajaxFn, options) {\n            var deferred = jQuery.Deferred();\n            var startingLength = this.length;\n            var responses = [];\n\n            if (!startingLength) {\n                deferred.resolve([]);\n                return deferred;\n            }\n\n            // use reverse order (stylistic choice)\n            var ajaxFns = this.chain()\n                .reverse()\n                .map((dataset, i) => () => {\n                    var xhr = ajaxFn.call(dataset, options);\n                    // if successful, notify using the deferred to allow tracking progress\n                    xhr.done(response => {\n                        deferred.notify({\n                            curr: i,\n                            total: startingLength,\n                            response: response,\n                            model: dataset\n                        });\n                    });\n                    // (regardless of previous error or success) if not last ajax call, shift and call the next\n                    //  if last fn, resolve deferred\n                    xhr.always(response => {\n                        responses.push(response);\n                        if (ajaxFns.length) {\n                            ajaxFns.shift()();\n                        } else {\n                            deferred.resolve(responses);\n                        }\n                    });\n                })\n                .value();\n            // start the queue\n            ajaxFns.shift()();\n\n            return deferred;\n        },\n\n        // ........................................................................ sorting/filtering\n        /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n        matches: function(matchesWhat) {\n            return this.filter(dataset => dataset.matches(matchesWhat));\n        },\n\n        /** String representation. */\n        toString: function() {\n            return [\"DatasetAssociationCollection(\", this.length, \")\"].join(\"\");\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DatasetAssociation: DatasetAssociation,\n    DatasetAssociationCollection: DatasetAssociationCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/dataset-model.js","import STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n    /** default attributes for a model */\n    defaults: {\n        /** parent (containing) history */\n        history_id: null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid: null,\n        /** whether the user wants the content shown (visible) */\n        visible: true\n    },\n\n    // ........................................................................ mixed content element\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Instead, use type_id which prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute: \"type_id\",\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden: function() {\n        return !this.get(\"visible\");\n    },\n\n    //TODO: remove\n    /** based on includeDeleted, includeHidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} includeDeleted are we showing deleted hdas?\n     *  @param {Boolean} includeHidden are we showing hidden hdas?\n     */\n    isVisible: function(includeDeleted, includeHidden) {\n        var isVisible = true;\n        if (!includeDeleted && (this.get(\"deleted\") || this.get(\"purged\"))) {\n            isVisible = false;\n        }\n        if (!includeHidden && !this.get(\"visible\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n    //TODO?: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: `${Galaxy.root}api/histories/`,\n\n    /** full url spec. for this content */\n    url: function() {\n        var historyContentType = this.get(\"history_content_type\");\n        var historyId = this.get(\"history_id\");\n        var historyContentId = this.get(\"id\");\n        var url = `${this.urlRoot}${historyId}/contents/${historyContentType}s/${historyContentId}`;\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide: function(options) {\n        if (!this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: false }, options);\n    },\n    /** save this content as visible */\n    unhide: function(options) {\n        if (this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: true }, options);\n    },\n\n    // ........................................................................ misc\n    toString: function() {\n        return [this.get(\"type_id\"), this.get(\"hid\"), this.get(\"name\")].join(\":\");\n    }\n};\n\n//==============================================================================\nexport default {\n    HistoryContentMixin: HistoryContentMixin\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-content-model.js","/* For presentation-related functionality shared across collection creators.\n   Particularily overlapping functionality related to name processing and help.\n*/\nvar CollectionCreatorMixin = {\n    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n    _validationWarning: function(what, clear) {\n        var VALIDATION_CLASS = \"validation-warning\";\n        if (what === \"name\") {\n            what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n            this.$(\".collection-name\")\n                .focus()\n                .select();\n        }\n        if (clear) {\n            what = what || this.$(`.${VALIDATION_CLASS}`);\n            what.removeClass(VALIDATION_CLASS);\n        } else {\n            what.addClass(VALIDATION_CLASS);\n        }\n    },\n\n    _changeHideOriginals: function(ev) {\n        this.hideOriginals = this.$(\".hide-originals\").prop(\"checked\");\n    },\n\n    // ........................................................................ footer\n    /** handle a collection name change */\n    _changeName: function(ev) {\n        this._validationWarning(\"name\", !!this._getName());\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter: function(ev) {\n        if (ev.keyCode === 13 && !this.blocking) {\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName: function() {\n        return _.escape(this.$(\".collection-name\").val());\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").addClass(\"expanded\");\n        this.$(\".more-help\").hide();\n    },\n    /** collapse help */\n    _clickLessHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").removeClass(\"expanded\");\n        this.$(\".more-help\").show();\n    },\n    /** toggle help */\n    _toggleHelp: function(ev) {\n        ev.stopPropagation();\n        this.$(\".main-help\").toggleClass(\"expanded\");\n        this.$(\".more-help\").toggle();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n    _showAlert: function(message, alertClass) {\n        alertClass = alertClass || \"alert-danger\";\n        this.$(\".main-help\").hide();\n        this.$(\".header .alert\")\n            .attr(\"class\", \"alert alert-dismissable\")\n            .addClass(alertClass)\n            .show()\n            .find(\".alert-message\")\n            .html(message);\n    },\n    /** hide the alerts at the top */\n    _hideAlert: function(message) {\n        this.$(\".main-help\").show();\n        this.$(\".header .alert\").hide();\n    },\n\n    _cancelCreate: function(ev) {\n        if (typeof this.oncancel === \"function\") {\n            this.oncancel.call(this);\n        }\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate: function(ev) {\n        var name = this._getName();\n        if (!name) {\n            this._validationWarning(\"name\");\n        } else if (!this.blocking) {\n            this.createList(name);\n        }\n    },\n\n    _setUpCommonSettings: function(attributes) {\n        this.hideOriginals = attributes.defaultHideSourceItems || false;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter: function(speed, callback) {\n        var self = this;\n        var $footer = this.$(\".footer\")\n            .empty()\n            .html(this.templates.footer());\n        _.each(this.footerSettings, (property, selector) => {\n            self.$(selector).prop(\"checked\", self[property]);\n        });\n        if (typeof this.oncancel === \"function\") {\n            this.$(\".cancel-create.btn\").show();\n        }\n        return $footer;\n    },\n\n    _creatorTemplates: {\n        main: _.template(\n            [\n                '<div class=\"header flex-row no-flex\"></div>',\n                '<div class=\"middle flex-row flex-row-container\"></div>',\n                '<div class=\"footer flex-row no-flex\"></div>'\n            ].join(\"\")\n        )\n    }\n};\n\n//==============================================================================\nexport default {\n    CollectionCreatorMixin: CollectionCreatorMixin\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/base-creator.js","// Alphanumeric/natural sort fn\nfunction naturalSort(a, b) {\n    // setup temp-scope variables for comparison evauluation\n    var re = /(-?[0-9\\.]+)/g;\n\n    var x = a.toString().toLowerCase() || \"\";\n    var y = b.toString().toLowerCase() || \"\";\n    var nC = String.fromCharCode(0);\n    var xN = x.replace(re, `${nC}$1${nC}`).split(nC);\n    var yN = y.replace(re, `${nC}$1${nC}`).split(nC);\n    var xD = new Date(x).getTime();\n    var yD = xD ? new Date(y).getTime() : null;\n    // natural sorting of dates\n    if (yD) {\n        if (xD < yD) {\n            return -1;\n        } else if (xD > yD) {\n            return 1;\n        }\n    }\n\n    // natural sorting through split numeric strings and default strings\n    var oFxNcL;\n\n    var oFyNcL;\n    for (var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++) {\n        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n        if (oFxNcL < oFyNcL) {\n            return -1;\n        } else if (oFxNcL > oFyNcL) {\n            return 1;\n        }\n    }\n    return 0;\n}\n\nexport default naturalSort;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/natural-sort.js","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n//=============================================================================\n\njQuery.fn.extend({\n    hoverhighlight: function $hoverhighlight(scope, color) {\n        scope = scope || \"body\";\n        if (!this.length) {\n            return this;\n        }\n\n        $(this).each(function() {\n            var $this = $(this);\n            var targetSelector = $this.data(\"target\");\n\n            if (targetSelector) {\n                $this\n                    .mouseover(ev => {\n                        $(targetSelector, scope).css({\n                            background: color\n                        });\n                    })\n                    .mouseout(ev => {\n                        $(targetSelector).css({\n                            background: \"\"\n                        });\n                    });\n            }\n        });\n        return this;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/ui/hoverhighlight.js","/** This is the run workflow tool form view. */\nimport Utils from \"utils/utils\";\nimport Deferred from \"utils/deferred\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nimport FormData from \"mvc/form/form-data\";\nimport ToolFormBase from \"mvc/tool/tool-form-base\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Webhooks from \"mvc/webhooks\";\nimport WorkflowIcons from \"mvc/workflow/workflow-icons\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.modal = parent.Galaxy.modal || new Modal.View();\n        this.model = (options && options.model) || new Backbone.Model(options);\n        this.deferred = new Deferred();\n        this.setElement(\n            $(\"<div/>\")\n                .addClass(\"ui-form-composite\")\n                .append((this.$message = $(\"<div/>\")))\n                .append((this.$header = $(\"<div/>\")))\n                .append((this.$steps = $(\"<div/>\")))\n        );\n        $(\"body\").append(this.$el);\n        this._configure();\n        this.render();\n        $(window).resize(() => {\n            self._refresh();\n        });\n    },\n\n    /** Refresh height of scrollable div below header, handle scrolling by lazy loading steps */\n    _refresh: function(step_index) {\n        var margin =\n            _.reduce(this.$el.children(), (memo, child) => memo + $(child).outerHeight(), 0) -\n            this.$steps.height() +\n            90;\n        this.$steps.css(\"height\", $(window).height() - margin);\n    },\n\n    /** Configures form/step options for each workflow step */\n    _configure: function() {\n        var self = this;\n        this.forms = [];\n        this.steps = [];\n        this.links = [];\n        this.parms = [];\n        _.each(this.model.get(\"steps\"), (step, i) => {\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", `${i} : Preparing workflow step.`);\n            var icon = WorkflowIcons[step.step_type];\n            var title = `${parseInt(i + 1)}: ${step.step_label || step.step_name}`;\n            if (step.annotation) {\n                title += ` - ${step.annotation}`;\n            }\n            if (step.step_version) {\n                title += ` (Galaxy Version ${step.step_version})`;\n            }\n            step = Utils.merge(\n                {\n                    index: i,\n                    fixed_title: _.escape(title),\n                    icon: icon || \"\",\n                    help: null,\n                    citations: null,\n                    collapsible: true,\n                    collapsed: i > 0 && !self._isDataStep(step),\n                    sustain_version: true,\n                    sustain_repeats: true,\n                    sustain_conditionals: true,\n                    narrow: true,\n                    text_enable: \"Edit\",\n                    text_disable: \"Undo\",\n                    cls_enable: \"fa fa-edit\",\n                    cls_disable: \"fa fa-undo\",\n                    errors: step.messages,\n                    initial_errors: true,\n                    cls: \"ui-portlet-narrow\",\n                    hide_operations: true,\n                    needs_refresh: false,\n                    always_refresh: step.step_type != \"tool\"\n                },\n                step\n            );\n            self.steps[i] = step;\n            self.links[i] = [];\n            self.parms[i] = {};\n        });\n\n        // build linear index of step input pairs\n        _.each(this.steps, (step, i) => {\n            FormData.visitInputs(step.inputs, (input, name) => {\n                self.parms[i][name] = input;\n            });\n        });\n\n        // iterate through data input modules and collect linked sub steps\n        _.each(this.steps, (step, i) => {\n            _.each(step.output_connections, output_connection => {\n                _.each(self.steps, (sub_step, j) => {\n                    sub_step.step_index === output_connection.input_step_index && self.links[i].push(sub_step);\n                });\n            });\n        });\n\n        // convert all connected data inputs to hidden fields with proper labels,\n        // and track the linked source step\n        _.each(this.steps, (step, i) => {\n            _.each(self.steps, (sub_step, j) => {\n                var connections_by_name = {};\n                _.each(step.output_connections, connection => {\n                    sub_step.step_index === connection.input_step_index &&\n                        (connections_by_name[connection.input_name] = connection);\n                });\n                _.each(self.parms[j], (input, name) => {\n                    var connection = connections_by_name[name];\n                    if (connection) {\n                        input.type = \"hidden\";\n                        input.help = input.step_linked ? `${input.help}, ` : \"\";\n                        input.help += `Output dataset '${connection.output_name}' from step ${parseInt(i) + 1}`;\n                        input.step_linked = input.step_linked || [];\n                        input.step_linked.push(step);\n                    }\n                });\n            });\n        });\n\n        // identify and configure workflow parameters\n        var wp_count = 0;\n        this.wp_inputs = {};\n        function _handleWorkflowParameter(value, callback) {\n            var re = /\\$\\{(.+?)\\}/g;\n            var match;\n            while ((match = re.exec(String(value)))) {\n                var wp_name = match[1];\n                callback(\n                    (self.wp_inputs[wp_name] = self.wp_inputs[wp_name] || {\n                        label: wp_name,\n                        name: wp_name,\n                        type: \"text\",\n                        color: `hsl( ${++wp_count * 100}, 70%, 30% )`,\n                        style: \"ui-form-wp-source\",\n                        links: []\n                    })\n                );\n            }\n        }\n        _.each(this.steps, (step, i) => {\n            _.each(self.parms[i], (input, name) => {\n                _handleWorkflowParameter(input.value, wp_input => {\n                    wp_input.links.push(step);\n                    input.wp_linked = true;\n                    input.type = \"text\";\n                    input.backdrop = true;\n                    input.style = \"ui-form-wp-target\";\n                });\n            });\n            _.each(step.post_job_actions, pja => {\n                _.each(pja.action_arguments, arg => {\n                    _handleWorkflowParameter(arg, () => {});\n                });\n            });\n        });\n\n        // select fields are shown for dynamic fields if all putative data inputs are available,\n        // or if an explicit reference is specified as data_ref and available\n        _.each(this.steps, (step, i) => {\n            if (step.step_type == \"tool\") {\n                var data_resolved = true;\n                FormData.visitInputs(step.inputs, (input, name, context) => {\n                    var is_runtime_value = input.value && input.value.__class__ == \"RuntimeValue\";\n                    var is_data_input = [\"data\", \"data_collection\"].indexOf(input.type) != -1;\n                    var data_ref = context[input.data_ref];\n                    input.step_linked && !self._isDataStep(input.step_linked) && (data_resolved = false);\n                    input.options &&\n                        ((input.options.length == 0 && !data_resolved) || input.wp_linked) &&\n                        (input.is_workflow = true);\n                    data_ref &&\n                        (input.is_workflow =\n                            (data_ref.step_linked && !self._isDataStep(data_ref.step_linked)) || input.wp_linked);\n                    (is_data_input || (input.value && input.value.__class__ == \"RuntimeValue\" && !input.step_linked)) &&\n                        (step.collapsed = false);\n                    is_runtime_value && (input.value = input.default_value);\n                    input.flavor = \"workflow\";\n                    if (!is_runtime_value && !is_data_input && input.type !== \"hidden\" && !input.wp_linked) {\n                        if (input.optional || (!Utils.isEmpty(input.value) && input.value !== \"\")) {\n                            input.collapsible_value = input.value;\n                            input.collapsible_preview = true;\n                        }\n                    }\n                });\n            }\n        });\n    },\n\n    render: function() {\n        var self = this;\n        this.deferred.reset();\n        this._renderHeader();\n        this._renderMessage();\n        this._renderParameters();\n        this._renderHistory();\n        _.each(this.steps, step => {\n            self._renderStep(step);\n        });\n    },\n\n    /** Render header */\n    _renderHeader: function() {\n        var self = this;\n        this.execute_btn = new Ui.Button({\n            icon: \"fa-check\",\n            title: \"Run workflow\",\n            cls: \"btn btn-primary\",\n            onclick: function() {\n                self._execute();\n            }\n        });\n        this.$header\n            .addClass(\"ui-form-header\")\n            .empty()\n            .append(\n                new Ui.Label({\n                    title: `Workflow: ${this.model.get(\"name\")}`\n                }).$el\n            )\n            .append(this.execute_btn.$el);\n    },\n\n    /** Render message */\n    _renderMessage: function() {\n        this.$message.empty();\n        if (this.model.get(\"has_upgrade_messages\")) {\n            this.$message.append(\n                new Ui.Message({\n                    message:\n                        \"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.\",\n                    status: \"warning\",\n                    persistent: true,\n                    fade: false\n                }).$el\n            );\n        }\n        var step_version_changes = this.model.get(\"step_version_changes\");\n        if (step_version_changes && step_version_changes.length > 0) {\n            this.$message.append(\n                new Ui.Message({\n                    message:\n                        \"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.\",\n                    status: \"warning\",\n                    persistent: true,\n                    fade: false\n                }).$el\n            );\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderParameters: function() {\n        var self = this;\n        this.wp_form = null;\n        if (!_.isEmpty(this.wp_inputs)) {\n            this.wp_form = new Form({\n                title: \"<b>Workflow Parameters</b>\",\n                inputs: this.wp_inputs,\n                cls: \"ui-portlet-narrow\",\n                onchange: function() {\n                    _.each(self.wp_form.input_list, (input_def, i) => {\n                        _.each(input_def.links, step => {\n                            self._refreshStep(step);\n                        });\n                    });\n                }\n            });\n            this._append(this.$steps.empty(), this.wp_form.$el);\n        }\n    },\n\n    /** Render workflow parameters */\n    _renderHistory: function() {\n        this.history_form = new Form({\n            cls: \"ui-portlet-narrow\",\n            title: \"<b>History Options</b>\",\n            inputs: [\n                {\n                    type: \"conditional\",\n                    name: \"new_history\",\n                    test_param: {\n                        name: \"check\",\n                        label: \"Send results to a new history\",\n                        type: \"boolean\",\n                        value: \"false\",\n                        help: \"\"\n                    },\n                    cases: [\n                        {\n                            value: \"true\",\n                            inputs: [\n                                {\n                                    name: \"name\",\n                                    label: \"History name\",\n                                    type: \"text\",\n                                    value: this.model.get(\"name\")\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ]\n        });\n        this._append(this.$steps, this.history_form.$el);\n    },\n\n    /** Render step */\n    _renderStep: function(step) {\n        var self = this;\n        var form = null;\n        this.deferred.execute(promise => {\n            self.$steps.addClass(\"ui-steps\");\n            if (step.step_type == \"tool\") {\n                step.postchange = function(process, form) {\n                    var self = this;\n                    var current_state = {\n                        tool_id: step.id,\n                        tool_version: step.version,\n                        inputs: $.extend(true, {}, form.data.create())\n                    };\n                    form.wait(true);\n                    Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Sending current state.\", current_state);\n                    Utils.request({\n                        type: \"POST\",\n                        url: `${Galaxy.root}api/tools/${step.id}/build`,\n                        data: current_state,\n                        success: function(data) {\n                            form.update(data);\n                            form.wait(false);\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Received new model.\", data);\n                            process.resolve();\n                        },\n                        error: function(response) {\n                            Galaxy.emit.debug(\"tool-form-composite::postchange()\", \"Refresh request failed.\", response);\n                            process.reject();\n                        }\n                    });\n                };\n                form = new ToolFormBase(step);\n                if (step.post_job_actions && step.post_job_actions.length) {\n                    form.portlet.append(\n                        $(\"<div/>\")\n                            .addClass(\"ui-form-element-disabled\")\n                            .append(\n                                $(\"<div/>\")\n                                    .addClass(\"ui-form-title\")\n                                    .html(\"<b>Job Post Actions</b>\")\n                            )\n                            .append(\n                                $(\"<div/>\")\n                                    .addClass(\"ui-form-preview\")\n                                    .html(\n                                        _.reduce(\n                                            step.post_job_actions,\n                                            (memo, value) => `${memo} ${value.short_str}`,\n                                            \"\"\n                                        )\n                                    )\n                            )\n                    );\n                }\n            } else {\n                var is_simple_input = [\"data_input\", \"data_collection_input\"].indexOf(step.step_type) != -1;\n                _.each(step.inputs, input => {\n                    input.flavor = \"module\";\n                    input.hide_label = is_simple_input;\n                });\n                form = new Form(\n                    Utils.merge(\n                        {\n                            title: step.fixed_title,\n                            onchange: function() {\n                                _.each(self.links[step.index], link => {\n                                    self._refreshStep(link);\n                                });\n                            },\n                            inputs:\n                                step.inputs && step.inputs.length > 0\n                                    ? step.inputs\n                                    : [\n                                          {\n                                              type: \"hidden\",\n                                              name: \"No options available.\",\n                                              ignore: null\n                                          }\n                                      ]\n                        },\n                        step\n                    )\n                );\n            }\n            self.forms[step.index] = form;\n            self._append(self.$steps, form.$el);\n            self._refresh();\n            step.needs_refresh && self._refreshStep(step);\n            form.portlet[!self.show_progress ? \"enable\" : \"disable\"]();\n            self.show_progress &&\n                self.execute_btn.model.set({\n                    wait: true,\n                    wait_text: \"Preparing...\",\n                    percentage: (step.index + 1) * 100.0 / self.steps.length\n                });\n            Galaxy.emit.debug(\"tool-form-composite::initialize()\", `${step.index} : Workflow step state ready.`, step);\n            setTimeout(() => {\n                promise.resolve();\n            }, 0);\n        });\n    },\n\n    /** Refreshes step values from source step values */\n    _refreshStep: function(step) {\n        var self = this;\n        var form = this.forms[step.index];\n        if (form) {\n            _.each(self.parms[step.index], (input, name) => {\n                if (input.step_linked || input.wp_linked) {\n                    var field = form.field_list[form.data.match(name)];\n                    if (field) {\n                        var new_value = undefined;\n                        if (input.step_linked) {\n                            new_value = { values: [] };\n                            _.each(input.step_linked, source_step => {\n                                if (self._isDataStep(source_step)) {\n                                    var value = self.forms[source_step.index].data.create().input;\n                                    value &&\n                                        _.each(value.values, v => {\n                                            new_value.values.push(v);\n                                        });\n                                }\n                            });\n                            if (!input.multiple && new_value.values.length > 0) {\n                                new_value = {\n                                    values: [new_value.values[0]]\n                                };\n                            }\n                        } else if (input.wp_linked) {\n                            new_value = input.value;\n                            var re = /\\$\\{(.+?)\\}/g;\n                            var match;\n                            while ((match = re.exec(input.value))) {\n                                var wp_field = self.wp_form.field_list[self.wp_form.data.match(match[1])];\n                                var wp_value = wp_field && wp_field.value();\n                                if (wp_value) {\n                                    new_value = new_value.split(match[0]).join(wp_value);\n                                }\n                            }\n                        }\n                        if (new_value !== undefined) {\n                            field.value(new_value);\n                        }\n                    }\n                }\n            });\n            form.trigger(\"change\");\n        } else {\n            step.needs_refresh = true;\n        }\n    },\n\n    /** Refresh the history after job submission while form is shown */\n    _refreshHistory: function() {\n        var self = this;\n        var history = parent.Galaxy && parent.Galaxy.currHistoryPanel && parent.Galaxy.currHistoryPanel.model;\n        this._refresh_history && clearTimeout(this._refresh_history);\n        if (history) {\n            history.refresh().success(() => {\n                if (history.numOfUnfinishedShownContents() === 0) {\n                    self._refresh_history = setTimeout(() => {\n                        self._refreshHistory();\n                    }, history.UPDATE_DELAY);\n                }\n            });\n        }\n    },\n\n    /** Build remaining steps */\n    _execute: function() {\n        var self = this;\n        this.show_progress = true;\n        this._enabled(false);\n        this.deferred.execute(promise => {\n            setTimeout(() => {\n                promise.resolve();\n                self._submit();\n            }, 0);\n        });\n    },\n\n    /** Validate and submit workflow */\n    _submit: function() {\n        var self = this;\n        var history_form_data = this.history_form.data.create();\n        var job_def = {\n            new_history_name: history_form_data[\"new_history|name\"] ? history_form_data[\"new_history|name\"] : null,\n            history_id: !history_form_data[\"new_history|name\"] ? this.model.get(\"history_id\") : null,\n            replacement_params: this.wp_form ? this.wp_form.data.create() : {},\n            parameters: {},\n            // Tool form will submit flat maps for each parameter\n            // (e.g. \"repeat_0|cond|param\": \"foo\" instead of nested\n            // data structures).\n            parameters_normalized: true,\n            // Tool form always wants a list of invocations back\n            // so that inputs can be batched.\n            batch: true\n        };\n        var validated = true;\n        for (var i in this.forms) {\n            var form = this.forms[i];\n            var job_inputs = form.data.create();\n            var step = self.steps[i];\n            var step_index = step.step_index;\n            form.trigger(\"reset\");\n            for (var job_input_id in job_inputs) {\n                var input_value = job_inputs[job_input_id];\n                var input_id = form.data.match(job_input_id);\n                var input_field = form.field_list[input_id];\n                var input_def = form.input_list[input_id];\n                if (!input_def.step_linked) {\n                    if (this._isDataStep(step)) {\n                        validated = input_value && input_value.values && input_value.values.length > 0;\n                    } else {\n                        validated =\n                            input_def.optional ||\n                            (input_def.is_workflow && input_value !== \"\") ||\n                            (!input_def.is_workflow && input_value !== null);\n                    }\n                    if (!validated) {\n                        form.highlight(input_id);\n                        break;\n                    }\n                    job_def.parameters[step_index] = job_def.parameters[step_index] || {};\n                    job_def.parameters[step_index][job_input_id] = job_inputs[job_input_id];\n                }\n            }\n            if (!validated) {\n                break;\n            }\n        }\n        if (!validated) {\n            self._enabled(true);\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation failed.\", job_def);\n        } else {\n            Galaxy.emit.debug(\"tool-form-composite::submit()\", \"Validation complete.\", job_def);\n            Utils.request({\n                type: \"POST\",\n                url: `${Galaxy.root}api/workflows/${this.model.id}/invocations`,\n                data: job_def,\n                success: function(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission successful.\", response);\n                    self.$el.children().hide();\n                    self.$el.append(self._templateSuccess(response));\n\n                    // Show Webhook if job is running\n                    if ($.isArray(response) && response.length > 0) {\n                        self.$el.append($(\"<div/>\", { id: \"webhook-view\" }));\n                        var WebhookApp = new Webhooks.WebhookView({\n                            urlRoot: `${Galaxy.root}api/webhooks/workflow`,\n                            toolId: job_def.tool_id,\n                            toolVersion: job_def.tool_version\n                        });\n                    }\n\n                    self._refreshHistory();\n                },\n                error: function(response) {\n                    Galaxy.emit.debug(\"tool-form-composite::submit\", \"Submission failed.\", response);\n                    var input_found = false;\n                    if (response && response.err_data) {\n                        for (var i in self.forms) {\n                            var form = self.forms[i];\n                            var step_related_errors = response.err_data[form.model.get(\"step_index\")];\n                            if (step_related_errors) {\n                                var error_messages = form.data.matchResponse(step_related_errors);\n                                for (var input_id in error_messages) {\n                                    form.highlight(input_id, error_messages[input_id]);\n                                    input_found = true;\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                    if (!input_found) {\n                        self.modal.show({\n                            title: \"Workflow submission failed\",\n                            body: self._templateError(job_def, response && response.err_msg),\n                            buttons: {\n                                Close: function() {\n                                    self.modal.hide();\n                                }\n                            }\n                        });\n                    }\n                },\n                complete: function() {\n                    self._enabled(true);\n                }\n            });\n        }\n    },\n\n    /** Append new dom to body */\n    _append: function($container, $el) {\n        $container.append(\"<p/>\").append($el);\n    },\n\n    /** Set enabled/disabled state */\n    _enabled: function(enabled) {\n        this.execute_btn.model.set({\n            wait: !enabled,\n            wait_text: \"Sending...\",\n            percentage: -1\n        });\n        this.wp_form && this.wp_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        this.history_form && this.history_form.portlet[enabled ? \"enable\" : \"disable\"]();\n        _.each(this.forms, form => {\n            form && form.portlet[enabled ? \"enable\" : \"disable\"]();\n        });\n    },\n\n    /** Is data input module/step */\n    _isDataStep: function(steps) {\n        var lst = $.isArray(steps) ? steps : [steps];\n        for (var i = 0; i < lst.length; i++) {\n            var step = lst[i];\n            if (!step || !step.step_type || !step.step_type.startsWith(\"data\")) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    /** Templates */\n    _templateSuccess: function(response) {\n        if ($.isArray(response) && response.length > 0) {\n            return $(\"<div/>\")\n                .addClass(\"donemessagelarge\")\n                .append(\n                    $(\"<p/>\").html(\n                        `Successfully invoked workflow <b>${Utils.sanitize(this.model.get(\"name\"))}</b>${\n                            response.length > 1 ? ` <b>${response.length} times</b>` : \"\"\n                        }.`\n                    )\n                )\n                .append(\n                    $(\"<p/>\")\n                        .append(\"<b/>\")\n                        .text(\n                            \"You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.\"\n                        )\n                );\n        } else {\n            return this._templateError(response, \"Invalid success response. No invocations found.\");\n        }\n    },\n\n    _templateError: function(response, err_msg) {\n        return $(\"<div/>\")\n            .addClass(\"errormessagelarge\")\n            .append(\n                $(\"<p/>\").text(\n                    `The server could not complete the request. Please contact the Galaxy Team if this error persists. ${JSON.stringify(\n                        err_msg\n                    ) || \"\"}`\n                )\n            )\n            .append($(\"<pre/>\").text(JSON.stringify(response, null, 4)));\n    }\n});\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/tool/tool-form-composite.js","import MODAL from \"mvc/ui/ui-modal\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\n/**\n * A dialog/modal that allows copying a user history or 'importing' from user\n * another. Generally called via historyCopyDialog below.\n * @type {Object}\n */\nvar CopyDialog = {\n    // language related strings/fns\n    defaultName: _.template(\"Copy of '<%- name %>'\"),\n    title: _.template(`${_l(\"Copying history\")} \"<%- name %>\"`),\n    submitLabel: _l(\"Copy\"),\n    errorMessage: _l(\"History could not be copied.\"),\n    progressive: _l(\"Copying history\"),\n    activeLabel: _l(\"Copy only the active, non-deleted datasets\"),\n    allLabel: _l(\"Copy all datasets including deleted ones\"),\n    anonWarning:\n        _l(\"As an anonymous user, unless you login or register, you will lose your current history \") +\n        _l(\"after copying this history. \"),\n\n    // template for modal body\n    _template: _.template(\n        [\n            //TODO: remove inline styles\n            // show a warning message for losing current to anon users\n            \"<% if( isAnon ){ %>\",\n            '<div class=\"warningmessage\">',\n            \"<%- anonWarning %>\",\n            _l(\"You can\"),\n            ' <a href=\"/user/login\">',\n            _l(\"login here\"),\n            \"</a> \",\n            _l(\"or\"),\n            \" \",\n            ' <a href=\"/user/create\">',\n            _l(\"register here\"),\n            \"</a>.\",\n            \"</div>\",\n            \"<% } %>\",\n            \"<form>\",\n            '<label for=\"copy-modal-title\">',\n            _l(\"Enter a title for the new history\"),\n            \":\",\n            \"</label><br />\",\n            // TODO: could use required here and the form validators\n            // NOTE: use unescaped here if escaped in the modal function below\n            '<input id=\"copy-modal-title\" class=\"form-control\" style=\"width: 100%\" value=\"<%= name %>\" />',\n            '<p class=\"invalid-title bg-danger\" style=\"color: red; margin: 8px 0px 8px 0px; display: none\">',\n            _l(\"Please enter a valid history title\"),\n            \"</p>\",\n            // if allowAll, add the option to copy deleted datasets, too\n            \"<% if( allowAll ){ %>\",\n            \"<br />\",\n            \"<p>\",\n            _l(\"Choose which datasets from the original history to include:\"),\n            \"</p>\",\n            // copy non-deleted is the default\n            '<input name=\"copy-what\" type=\"radio\" id=\"copy-non-deleted\" value=\"copy-non-deleted\" ',\n            '<% if( copyWhat === \"copy-non-deleted\" ){ print( \"checked\" ); } %>/>',\n            '<label for=\"copy-non-deleted\"> <%- activeLabel %></label>',\n            \"<br />\",\n            '<input name=\"copy-what\" type=\"radio\" id=\"copy-all\" value=\"copy-all\" ',\n            '<% if( copyWhat === \"copy-all\" ){ print( \"checked\" ); } %>/>',\n            '<label for=\"copy-all\"> <%- allLabel %></label>',\n            \"<% } %>\",\n            \"</form>\"\n        ].join(\"\")\n    ),\n\n    // empty modal body and let the user know the copy is happening\n    _showAjaxIndicator: function _showAjaxIndicator() {\n        var indicator = `<p><span class=\"fa fa-spinner fa-spin\"></span> ${this.progressive}...</p>`;\n        this.modal\n            .$(\".modal-body\")\n            .empty()\n            .append(indicator)\n            .css({ \"margin-top\": \"8px\" });\n    },\n\n    // (sorta) public interface - display the modal, render the form, and potentially copy the history\n    // returns a jQuery.Deferred done->history copied, fail->user cancelled\n    dialog: function _dialog(modal, history, options) {\n        options = options || {};\n\n        var dialog = this;\n        var deferred = jQuery.Deferred();\n\n        var // TODO: getting a little byzantine here\n        defaultCopyNameFn = options.nameFn || this.defaultName;\n\n        var defaultCopyName = defaultCopyNameFn({\n            name: history.get(\"name\")\n        });\n\n        var // TODO: these two might be simpler as one 3 state option (all,active,no-choice)\n        defaultCopyWhat = options.allDatasets ? \"copy-all\" : \"copy-non-deleted\";\n\n        var allowAll = !_.isUndefined(options.allowAll) ? options.allowAll : true;\n\n        var autoClose = !_.isUndefined(options.autoClose) ? options.autoClose : true;\n\n        this.modal = modal;\n\n        // validate the name and copy if good\n        function checkNameAndCopy() {\n            var name = modal.$(\"#copy-modal-title\").val();\n            if (!name) {\n                modal.$(\".invalid-title\").show();\n                return;\n            }\n            // get further settings, shut down and indicate the ajax call, then hide and resolve/reject\n            var copyAllDatasets = modal.$('input[name=\"copy-what\"]:checked').val() === \"copy-all\";\n            modal.$(\"button\").prop(\"disabled\", true);\n            dialog._showAjaxIndicator();\n            history\n                .copy(true, name, copyAllDatasets)\n                .done(response => {\n                    deferred.resolve(response);\n                })\n                .fail(function(xhr, status, message) {\n                    var options = {\n                        name: name,\n                        copyAllDatasets: copyAllDatasets\n                    };\n                    ERROR_MODAL.ajaxErrorModal(history, xhr, options, dialog.errorMessage);\n                    deferred.rejectWith(deferred, arguments);\n                })\n                .done(() => {\n                    if (autoClose) {\n                        modal.hide();\n                    }\n                });\n        }\n\n        var originalClosingCallback = options.closing_callback;\n        modal.show(\n            _.extend(options, {\n                title: this.title({ name: history.get(\"name\") }),\n                body: $(\n                    dialog._template({\n                        name: defaultCopyName,\n                        isAnon: Galaxy.user.isAnonymous(),\n                        allowAll: allowAll,\n                        copyWhat: defaultCopyWhat,\n                        activeLabel: this.activeLabel,\n                        allLabel: this.allLabel,\n                        anonWarning: this.anonWarning\n                    })\n                ),\n                buttons: _.object([\n                    [\n                        _l(\"Cancel\"),\n                        () => {\n                            modal.hide();\n                        }\n                    ],\n                    [this.submitLabel, checkNameAndCopy]\n                ]),\n                height: \"auto\",\n                closing_events: true,\n                closing_callback: function _historyCopyClose(cancelled) {\n                    if (cancelled) {\n                        deferred.reject({ cancelled: true });\n                    }\n                    if (originalClosingCallback) {\n                        originalClosingCallback(cancelled);\n                    }\n                }\n            })\n        );\n\n        // set the default dataset copy, autofocus the title, and set up for a simple return\n        modal\n            .$(\"#copy-modal-title\")\n            .focus()\n            .select();\n        modal.$(\"#copy-modal-title\").on(\"keydown\", ev => {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                checkNameAndCopy();\n            }\n        });\n\n        return deferred;\n    }\n};\n\n//==============================================================================\n// maintain the (slight) distinction between copy and import\n/**\n * Subclass CopyDialog to use the import language.\n */\nvar ImportDialog = _.extend({}, CopyDialog, {\n    defaultName: _.template(\"imported: <%- name %>\"),\n    title: _.template(`${_l(\"Importing history\")} \"<%- name %>\"`),\n    submitLabel: _l(\"Import\"),\n    errorMessage: _l(\"History could not be imported.\"),\n    progressive: _l(\"Importing history\"),\n    activeLabel: _l(\"Import only the active, non-deleted datasets\"),\n    allLabel: _l(\"Import all datasets including deleted ones\"),\n    anonWarning:\n        _l(\"As an anonymous user, unless you login or register, you will lose your current history \") +\n        _l(\"after importing this history. \")\n});\n\n//==============================================================================\n/**\n * Main interface for both history import and history copy dialogs.\n * @param  {Backbone.Model} history     the history to copy\n * @param  {Object}         options     a hash\n * @return {jQuery.Deferred}            promise that fails on close and succeeds on copy\n *\n * options:\n *     (this object is also passed to the modal used to display the dialog and accepts modal options)\n *     {Function} nameFn    if defined, use this to build the default name shown to the user\n *                          (the fn is passed: {name: <original history's name>})\n *     {bool} useImport     if true, use the 'import' language (instead of Copy)\n *     {bool} allowAll      if true, allow the user to choose between copying all datasets and\n *                          only non-deleted datasets\n *     {String} allDatasets default initial checked radio button: 'copy-all' or 'copy-non-deleted',\n */\nvar historyCopyDialog = (history, options) => {\n    options = options || {};\n    // create our own modal if Galaxy doesn't have one (mako tab without use_panels)\n    var modal = window.parent.Galaxy.modal || new MODAL.View({});\n    return options.useImport\n        ? ImportDialog.dialog(modal, history, options)\n        : CopyDialog.dialog(modal, history, options);\n};\n\n//==============================================================================\nexport default historyCopyDialog;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/copy-dialog.js","import _l from \"utils/localization\";\n\n//TODO: toastr is another possibility - I didn't see where I might add details, tho\n\n/* ============================================================================\nError modals meant to replace the o-so-easy alerts.\n\nThese are currently styled as errormessages but use the Galaxy.modal\ninfrastructure to be shown/closed. They're capable of showing details in a\ntogglable dropdown and the details are formatted in a pre.\n\nExample:\n    errorModal( 'Heres a message', 'A Title', { some_details: 'here' });\n    errorModal( 'Heres a message' ); // no details, title is 'Error'\n\nThere are three specialized forms:\n    offlineErrorModal       a canned response for when there's no connection\n    badGatewayErrorModal    canned response for when Galaxy is restarting\n    ajaxErrorModal          plugable into any Backbone class as an\n        error event handler by accepting the error args: model, xhr, options\n\nExamples:\n    if( navigator.offLine ){ offlineErrorModal(); }\n    if( xhr.status === 502 ){ badGatewayErrorModal(); }\n    this.listenTo( this.model, 'error', ajaxErrorModal );\n\n============================================================================ */\n\nvar CONTACT_MSG = _l(\"Please contact a Galaxy administrator if the problem persists.\");\nvar DEFAULT_AJAX_ERR_MSG = _l(\"An error occurred while updating information with the server.\");\nvar DETAILS_MSG = _l(\"The following information can assist the developers in finding the source of the error:\");\n\n/** private helper that builds the modal and handles adding details */\nfunction _errorModal(message, title, details) {\n    // create and return the modal, adding details button only if needed\n    Galaxy.modal.show({\n        title: title,\n        body: message,\n        closing_events: true,\n        buttons: {\n            Ok: function() {\n                Galaxy.modal.hide();\n            }\n        }\n    });\n    Galaxy.modal.$el.addClass(\"error-modal\");\n\n    if (details) {\n        Galaxy.modal\n            .$(\".error-details\")\n            .add(Galaxy.modal.$('button:contains(\"Details\")'))\n            .remove();\n        $(\"<div/>\")\n            .addClass(\"error-details\")\n            .hide()\n            .appendTo(Galaxy.modal.$(\".modal-content\"))\n            .append([$(\"<p/>\").text(DETAILS_MSG), $(\"<pre/>\").text(JSON.stringify(details, null, \"  \"))]);\n\n        $(`<button id=\"button-1\" class=\"pull-left\">${_l(\"Details\")}</button>`)\n            .appendTo(Galaxy.modal.$(\".buttons\"))\n            .click(() => {\n                Galaxy.modal.$(\".error-details\").toggle();\n            });\n    }\n    return Galaxy.modal;\n}\n\n/** Display a modal showing an error message but fallback to alert if there's no modal */\nfunction errorModal(message, title, details) {\n    if (!message) {\n        return;\n    }\n\n    message = _l(message);\n    title = _l(title) || _l(\"Error:\");\n    if (window.Galaxy && Galaxy.modal) {\n        return _errorModal(message, title, details);\n    }\n\n    alert(`${title}\\n\\n${message}`);\n    console.log(\"error details:\", JSON.stringify(details));\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal when the user may be offline */\nfunction offlineErrorModal() {\n    return errorModal(_l(\"You appear to be offline. Please check your connection and try again.\"), _l(\"Offline?\"));\n}\n\n// ----------------------------------------------------------------------------\n/** 502 messages that should be displayed when galaxy is restarting */\nfunction badGatewayErrorModal() {\n    return errorModal(\n        `${_l(\"Galaxy is currently unreachable. Please try again in a few minutes.\")} ${CONTACT_MSG}`,\n        _l(\"Cannot connect to Galaxy\")\n    );\n}\n\n// ----------------------------------------------------------------------------\n/** display a modal (with details) about a failed Backbone ajax operation */\nfunction ajaxErrorModal(model, xhr, options, message, title) {\n    message = message || DEFAULT_AJAX_ERR_MSG;\n    message += ` ${CONTACT_MSG}`;\n    title = title || _l(\"An error occurred\");\n    var details = _ajaxDetails(model, xhr, options);\n    return errorModal(message, title, details);\n}\n\n/** build details which may help debugging the ajax call */\nfunction _ajaxDetails(model, xhr, options) {\n    return {\n        //TODO: still can't manage Raven id\n        raven: _.result(window.Raven, \"lastEventId\"),\n        userAgent: navigator.userAgent,\n        onLine: navigator.onLine,\n        version: _.result(Galaxy.config, \"version_major\"),\n        xhr: _.omit(xhr, _.functions(xhr)),\n        options: _.omit(options, \"xhr\"),\n        // add ajax data from Galaxy object cache\n        url: _.result(Galaxy.lastAjax, \"url\"),\n        data: _.result(Galaxy.lastAjax, \"data\"),\n        // backbone stuff (auto-redacting email for user)\n        model: _.result(model, \"toJSON\", `${model}`),\n        user: _.omit(_.result(Galaxy.user, \"toJSON\"), \"email\")\n    };\n}\n\n//=============================================================================\nexport default {\n    errorModal: errorModal,\n    offlineErrorModal: offlineErrorModal,\n    badGatewayErrorModal: badGatewayErrorModal,\n    ajaxErrorModal: ajaxErrorModal\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/ui/error-modal.js","import * as _ from \"libs/underscore\";\nimport * as Backbone from \"libs/backbone\";\nimport BASE_MVC from \"mvc/base-mvc\";\n\n//=============================================================================\n/**\n * A Collection that can be limited/offset/re-ordered/filtered.\n * @type {Backbone.Collection}\n */\nvar ControlledFetchCollection = Backbone.Collection.extend({\n    /** call setOrder on initialization to build the comparator based on options */\n    initialize: function(models, options) {\n        Backbone.Collection.prototype.initialize.call(this, models, options);\n        this.setOrder(options.order || this.order, { silent: true });\n    },\n\n    /** set up to track order changes and re-sort when changed */\n    _setUpListeners: function() {\n        return this.on({\n            \"changed-order\": this.sort\n        });\n    },\n\n    /** override to provide order and offsets based on instance vars, set limit if passed,\n     *  and set allFetched/fire 'all-fetched' when xhr returns\n     */\n    fetch: function(options) {\n        options = this._buildFetchOptions(options);\n        Galaxy.debug(\"fetch options:\", options);\n        return Backbone.Collection.prototype.fetch.call(this, options);\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function(options) {\n        // note: we normally want options passed in to override the defaults built here\n        // so most of these fns will generate defaults\n        options = _.clone(options) || {};\n        var self = this;\n\n        // jquery ajax option; allows multiple q/qv for filters (instead of 'q[]')\n        options.traditional = true;\n\n        // options.data\n        // we keep limit, offset, etc. in options *as well as move it into data* because:\n        // - it makes fetch calling convenient to add it to a single options map (instead of as mult. args)\n        // - it allows the std. event handlers (for fetch, etc.) to have access\n        //   to the pagination options too\n        //      (i.e. this.on( 'sync', function( options ){ if( options.limit ){ ... } }))\n        // however, when we send to xhr/jquery we copy them to data also so that they become API query params\n        options.data = options.data || self._buildFetchData(options);\n        Galaxy.debug(\"data:\", options.data);\n\n        // options.data.filters --> options.data.q, options.data.qv\n        var filters = this._buildFetchFilters(options);\n        Galaxy.debug(\"filters:\", filters);\n        if (!_.isEmpty(filters)) {\n            _.extend(options.data, this._fetchFiltersToAjaxData(filters));\n        }\n        Galaxy.debug(\"data:\", options.data);\n        return options;\n    },\n\n    /** Build the dictionary to send to fetch's XHR as data */\n    _buildFetchData: function(options) {\n        var defaults = {};\n        if (this.order) {\n            defaults.order = this.order;\n        }\n        return _.defaults(_.pick(options, this._fetchParams), defaults);\n    },\n\n    /** These attribute keys are valid params to fetch/API-index */\n    _fetchParams: [\n        /** model dependent string to control the order of models returned */\n        \"order\",\n        /** limit the number of models returned from a fetch */\n        \"limit\",\n        /** skip this number of models when fetching */\n        \"offset\",\n        /** what series of attributes to return (model dependent) */\n        \"view\",\n        /** individual keys to return for the models (see api/histories.index) */\n        \"keys\"\n    ],\n\n    /** add any needed filters here based on collection state */\n    _buildFetchFilters: function(options) {\n        // override\n        return _.clone(options.filters || {});\n    },\n\n    /** Convert dictionary filters to qqv style arrays */\n    _fetchFiltersToAjaxData: function(filters) {\n        // return as a map so ajax.data can extend from it\n        var filterMap = {\n            q: [],\n            qv: []\n        };\n        _.each(filters, (v, k) => {\n            // don't send if filter value is empty\n            if (v === undefined || v === \"\") {\n                return;\n            }\n            // json to python\n            if (v === true) {\n                v = \"True\";\n            }\n            if (v === false) {\n                v = \"False\";\n            }\n            if (v === null) {\n                v = \"None\";\n            }\n            // map to k/v arrays (q/qv)\n            filterMap.q.push(k);\n            filterMap.qv.push(v);\n        });\n        return filterMap;\n    },\n\n    /** override to reset allFetched flag to false */\n    reset: function(models, options) {\n        this.allFetched = false;\n        return Backbone.Collection.prototype.reset.call(this, models, options);\n    },\n\n    // ........................................................................ order\n    order: null,\n\n    /** @type {Object} map of collection available sorting orders containing comparator fns */\n    comparators: {\n        update_time: BASE_MVC.buildComparator(\"update_time\", {\n            ascending: false\n        }),\n        \"update_time-asc\": BASE_MVC.buildComparator(\"update_time\", {\n            ascending: true\n        }),\n        create_time: BASE_MVC.buildComparator(\"create_time\", {\n            ascending: false\n        }),\n        \"create_time-asc\": BASE_MVC.buildComparator(\"create_time\", {\n            ascending: true\n        })\n    },\n\n    /** set the order and comparator for this collection then sort with the new order\n     *  @event 'changed-order' passed the new order and the collection\n     */\n    setOrder: function(order, options) {\n        options = options || {};\n        var collection = this;\n        var comparator = collection.comparators[order];\n        if (_.isUndefined(comparator)) {\n            throw new Error(`unknown order: ${order}`);\n        }\n        // if( _.isUndefined( comparator ) ){ return; }\n        if (comparator === collection.comparator) {\n            return;\n        }\n\n        collection.order = order;\n        collection.comparator = comparator;\n\n        if (!options.silent) {\n            collection.trigger(\"changed-order\", options);\n        }\n        return collection;\n    }\n});\n\n//=============================================================================\n/**\n *\n */\nvar PaginatedCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for each page's fetch */\n    limitPerPage: 500,\n\n    initialize: function(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        this.currentPage = options.currentPage || 0;\n    },\n\n    getTotalItemCount: function() {\n        return this.length;\n    },\n\n    shouldPaginate: function() {\n        return this.getTotalItemCount() >= this.limitPerPage;\n    },\n\n    getLastPage: function() {\n        return Math.floor(this.getTotalItemCount() / this.limitPerPage);\n    },\n\n    getPageCount: function() {\n        return this.getLastPage() + 1;\n    },\n\n    getPageLimitOffset: function(pageNum) {\n        pageNum = this.constrainPageNum(pageNum);\n        return {\n            limit: this.limitPerPage,\n            offset: pageNum * this.limitPerPage\n        };\n    },\n\n    constrainPageNum: function(pageNum) {\n        return Math.max(0, Math.min(pageNum, this.getLastPage()));\n    },\n\n    /** fetch the next page of data */\n    fetchPage: function(pageNum, options) {\n        var self = this;\n        pageNum = self.constrainPageNum(pageNum);\n        self.currentPage = pageNum;\n        options = _.defaults(options || {}, self.getPageLimitOffset(pageNum));\n\n        self.trigger(\"fetching-more\");\n        return self.fetch(options).always(() => {\n            self.trigger(\"fetching-more-done\");\n        });\n    },\n\n    fetchCurrentPage: function(options) {\n        return this.fetchPage(this.currentPage, options);\n    },\n\n    fetchPrevPage: function(options) {\n        return this.fetchPage(this.currentPage - 1, options);\n    },\n\n    fetchNextPage: function(options) {\n        return this.fetchPage(this.currentPage + 1, options);\n    }\n});\n\n//=============================================================================\n/**\n * A Collection that will load more elements without reseting.\n */\nvar InfinitelyScrollingCollection = ControlledFetchCollection.extend({\n    /** @type {Number} limit used for the first fetch (or a reset) */\n    limitOnFirstFetch: null,\n    /** @type {Number} limit used for each subsequent fetch */\n    limitPerFetch: 100,\n\n    initialize: function(models, options) {\n        ControlledFetchCollection.prototype.initialize.call(this, models, options);\n        /** @type {Integer} number of contents to return from the first fetch */\n        this.limitOnFirstFetch = options.limitOnFirstFetch || this.limitOnFirstFetch;\n        /** @type {Integer} limit for every fetch after the first */\n        this.limitPerFetch = options.limitPerFetch || this.limitPerFetch;\n        /** @type {Boolean} are all contents fetched? */\n        this.allFetched = false;\n        /** @type {Integer} what was the offset of the last content returned */\n        this.lastFetched = options.lastFetched || 0;\n    },\n\n    /** build ajax data/parameters from options */\n    _buildFetchOptions: function(options) {\n        // options (options for backbone.fetch and jquery.ajax generally)\n        // backbone option; false here to make fetching an addititive process\n        options.remove = options.remove || false;\n        return ControlledFetchCollection.prototype._buildFetchOptions.call(this, options);\n    },\n\n    /** fetch the first 'page' of data */\n    fetchFirst: function(options) {\n        Galaxy.debug(\"ControlledFetchCollection.fetchFirst:\", options);\n        options = options ? _.clone(options) : {};\n        this.allFetched = false;\n        this.lastFetched = 0;\n        return this.fetchMore(\n            _.defaults(options, {\n                reset: true,\n                limit: this.limitOnFirstFetch\n            })\n        );\n    },\n\n    /** fetch the next page of data */\n    fetchMore: function(options) {\n        Galaxy.debug(\"ControlledFetchCollection.fetchMore:\", options);\n        options = _.clone(options || {});\n        var collection = this;\n\n        Galaxy.debug(\"fetchMore, options.reset:\", options.reset);\n        if (!options.reset && collection.allFetched) {\n            return jQuery.when();\n        }\n\n        // TODO: this fails in the edge case where\n        //  the first fetch offset === limit (limit 4, offset 4, collection.length 4)\n        if (options.reset) {\n            options.offset = 0;\n        } else if (options.offset === undefined) {\n            options.offset = collection.lastFetched;\n        }\n        var limit = (options.limit = options.limit || collection.limitPerFetch || null);\n        Galaxy.debug(\"fetchMore, limit:\", limit, \"offset:\", options.offset);\n\n        collection.trigger(\"fetching-more\");\n        return (\n            collection\n                .fetch(options)\n                .always(() => {\n                    collection.trigger(\"fetching-more-done\");\n                })\n                // maintain allFetched flag and trigger if all were fetched this time\n                .done(function _postFetchMore(fetchedData) {\n                    var numFetched = _.isArray(fetchedData) ? fetchedData.length : 0;\n                    collection.lastFetched += numFetched;\n                    Galaxy.debug(\"fetchMore, lastFetched:\", collection.lastFetched);\n                    // anything less than a full page means we got all there is to get\n                    if (!limit || numFetched < limit) {\n                        collection.allFetched = true;\n                        collection.trigger(\"all-fetched\", this);\n                    }\n                })\n        );\n    },\n\n    /** fetch all the collection */\n    fetchAll: function(options) {\n        // whitelist options to prevent allowing limit/offset/filters\n        // (use vanilla fetch instead)\n        options = options || {};\n        var self = this;\n        options = _.pick(options, \"silent\");\n        options.filters = {};\n        return self.fetch(options).done(() => {\n            self.allFetched = true;\n            self.trigger(\"all-fetched\", self);\n        });\n    }\n});\n\n//==============================================================================\nexport default {\n    ControlledFetchCollection: ControlledFetchCollection,\n    PaginatedCollection: PaginatedCollection,\n    InfinitelyScrollingCollection: InfinitelyScrollingCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/base/controlled-fetch-collection.js","import DATASET from \"mvc/dataset/dataset-model\";\nimport HISTORY_CONTENT from \"mvc/history/history-content-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET.DatasetAssociation;\n\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n */\nvar HistoryDatasetAssociation = _super.extend(\n    BASE_MVC.mixin(\n        hcontentMixin,\n        /** @lends HistoryDatasetAssociation.prototype */ {\n            /** default attributes for a model */\n            defaults: _.extend({}, _super.prototype.defaults, hcontentMixin.defaults, {\n                history_content_type: \"dataset\",\n                model_class: \"HistoryDatasetAssociation\"\n            })\n        }\n    )\n);\n\n//==============================================================================\nexport default {\n    HistoryDatasetAssociation: HistoryDatasetAssociation\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hda-model.js","import LIST_ITEM from \"mvc/list/list-item\";\nimport LoadingIndicator from \"ui/loading-indicator\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/search-input\";\n\nvar logNamespace = \"list\";\n/* ============================================================================\nTODO:\n\n============================================================================ */\n/** @class View for a list/collection of models and the sub-views of those models.\n *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n *      use ModelWithListPanel)\n *\n *  Allows for:\n *      searching collection/sub-views\n *      selecting/multi-selecting sub-views\n *\n *  Currently used:\n *      for dataset/dataset-choice\n *      as superclass of ModelListPanel\n */\nvar ListPanel = Backbone.View.extend(BASE_MVC.LoggableMixin).extend(\n    /** @lends ListPanel.prototype */ {\n        _logNamespace: logNamespace,\n\n        /** class to use for constructing the sub-views */\n        viewClass: LIST_ITEM.ListItemView,\n        /** class to used for constructing collection of sub-view models */\n        collectionClass: Backbone.Collection,\n\n        tagName: \"div\",\n        className: \"list-panel\",\n\n        /** (in ms) that jquery effects will use */\n        fxSpeed: \"fast\",\n\n        /** string to display when the collection has no contents */\n        emptyMsg: _l(\"This list is empty\"),\n        /** displayed when no items match the search terms */\n        noneFoundMsg: _l(\"No matching items found\"),\n        /** string used for search placeholder */\n        searchPlaceholder: _l(\"search\"),\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the list\n         */\n        initialize: function(attributes, options) {\n            attributes = attributes || {};\n            // set the logger if requested\n            if (attributes.logger) {\n                this.logger = attributes.logger;\n            }\n            this.log(`${this}.initialize:`, attributes);\n\n            // ---- instance vars\n            /** how quickly should jquery fx run? */\n            this.fxSpeed = _.has(attributes, \"fxSpeed\") ? attributes.fxSpeed : this.fxSpeed;\n\n            /** filters for displaying subviews */\n            this.filters = [];\n            /** current search terms */\n            this.searchFor = attributes.searchFor || \"\";\n\n            /** loading indicator */\n            // this.indicator = new LoadingIndicator( this.$el );\n\n            /** currently showing selectors on items? */\n            this.selecting = attributes.selecting !== undefined ? attributes.selecting : true;\n            //this.selecting = false;\n\n            /** cached selected item.model.ids to persist btwn renders */\n            this.selected = attributes.selected || [];\n            /** the last selected item.model.id */\n            this.lastSelected = null;\n\n            /** are sub-views draggable */\n            this.dragItems = attributes.dragItems || false;\n\n            /** list item view class (when passed models) */\n            this.viewClass = attributes.viewClass || this.viewClass;\n\n            /** list item views */\n            this.views = [];\n            /** list item models */\n            this.collection = attributes.collection || this._createDefaultCollection();\n\n            /** filter fns run over collection items to see if they should show in the list */\n            this.filters = attributes.filters || [];\n\n            /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n            this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\n            /** @type {String} generic title */\n            this.title = attributes.title || \"\";\n            /** @type {String} generic subtitle */\n            this.subtitle = attributes.subtitle || \"\";\n\n            this._setUpListeners();\n        },\n\n        // ------------------------------------------------------------------------ listeners\n        /** create any event listeners for the list */\n        _setUpListeners: function() {\n            this.off();\n\n            //TODO: move errorHandler down into list-view from history-view or\n            //  pass to global error handler (Galaxy)\n            this.on({\n                error: function(model, xhr, options, msg, details) {\n                    //this.errorHandler( model, xhr, options, msg, details );\n                    console.error(model, xhr, options, msg, details);\n                },\n                // show hide the loading indicator\n                loading: function() {\n                    this._showLoadingIndicator(\"loading...\", 40);\n                },\n                \"loading-done\": function() {\n                    this._hideLoadingIndicator(40);\n                }\n            });\n\n            // throw the first render up as a diff namespace using once (for outside consumption)\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this._setUpCollectionListeners();\n            this._setUpViewListeners();\n            return this;\n        },\n\n        /** create and return a collection for when none is initially passed */\n        _createDefaultCollection: function() {\n            // override\n            return new this.collectionClass([]);\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            this.log(`${this}._setUpCollectionListeners`, this.collection);\n            this.stopListening(this.collection);\n\n            // bubble up error events\n            this.listenTo(this.collection, {\n                error: function(model, xhr, options, msg, details) {\n                    this.trigger(\"error\", model, xhr, options, msg, details);\n                },\n                update: function(collection, options) {\n                    var changes = options.changes;\n                    // console.info( collection + ', update:', changes, '\\noptions:', options );\n                    // more than one: render everything\n                    if (options.renderAll || changes.added.length + changes.removed.length > 1) {\n                        return this.renderItems();\n                    }\n                    // otherwise, let the single add/remove handlers do it\n                    if (changes.added.length === 1) {\n                        return this.addItemView(_.first(changes.added), collection, options);\n                    }\n                    if (changes.removed.length === 1) {\n                        return this.removeItemView(_.first(changes.removed), collection, options);\n                    }\n                }\n            });\n            return this;\n        },\n\n        /** listening for sub-view events that bubble up with the 'view:' prefix */\n        _setUpViewListeners: function() {\n            this.log(`${this}._setUpViewListeners`);\n\n            // shift to select a range\n            this.on({\n                \"view:selected\": function(view, ev) {\n                    if (ev && ev.shiftKey && this.lastSelected) {\n                        var lastSelectedView = this.viewFromModelId(this.lastSelected);\n                        if (lastSelectedView) {\n                            this.selectRange(view, lastSelectedView);\n                        }\n                    } else if (ev && ev.altKey && !this.selecting) {\n                        this.showSelectors();\n                    }\n                    this.selected.push(view.model.id);\n                    this.lastSelected = view.model.id;\n                },\n\n                \"view:de-selected\": function(view, ev) {\n                    this.selected = _.without(this.selected, view.model.id);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        /** Render this content, set up ui.\n         *  @param {Number or String} speed   the speed of the render\n         */\n        render: function(speed) {\n            this.log(`${this}.render`, speed);\n            var $newRender = this._buildNewRender();\n            this._setUpBehaviors($newRender);\n            this._queueNewRender($newRender, speed);\n            return this;\n        },\n\n        /** Build a temp div containing the new children for the view's $el. */\n        _buildNewRender: function() {\n            this.debug(`${this}(ListPanel)._buildNewRender`);\n            var $newRender = $(this.templates.el({}, this));\n            this._renderControls($newRender);\n            this._renderTitle($newRender);\n            this._renderSubtitle($newRender);\n            this._renderSearch($newRender);\n            this.renderItems($newRender);\n            return $newRender;\n        },\n\n        /** Build a temp div containing the new children for the view's $el. */\n        _renderControls: function($newRender) {\n            this.debug(`${this}(ListPanel)._renderControls`);\n            var $controls = $(this.templates.controls({}, this));\n            $newRender.find(\".controls\").replaceWith($controls);\n            return $controls;\n        },\n\n        /** return a jQuery object containing the title DOM */\n        _renderTitle: function($where) {\n            //$where = $where || this.$el;\n            //$where.find( '.title' ).replaceWith( ... )\n        },\n\n        /** return a jQuery object containing the subtitle DOM (if any) */\n        _renderSubtitle: function($where) {\n            //$where = $where || this.$el;\n            //$where.find( '.title' ).replaceWith( ... )\n        },\n\n        /** Fade out the old el, swap in the new contents, then fade in.\n         *  @param {Number or String} speed   jq speed to use for rendering effects\n         *  @fires rendered when rendered\n         */\n        _queueNewRender: function($newRender, speed) {\n            speed = speed === undefined ? this.fxSpeed : speed;\n            var panel = this;\n            panel.log(\"_queueNewRender:\", $newRender, speed);\n\n            $(panel).queue(\"fx\", [\n                next => {\n                    panel.$el.fadeOut(speed, next);\n                },\n                next => {\n                    panel._swapNewRender($newRender);\n                    next();\n                },\n                next => {\n                    panel.$el.fadeIn(speed, next);\n                },\n                next => {\n                    panel.trigger(\"rendered\", panel);\n                    next();\n                }\n            ]);\n        },\n\n        /** empty out the current el, move the $newRender's children in */\n        _swapNewRender: function($newRender) {\n            this.$el\n                .empty()\n                .attr(\"class\", this.className)\n                .append($newRender.children());\n            if (this.selecting) {\n                this.showSelectors(0);\n            }\n            return this;\n        },\n\n        /** Set up any behaviors, handlers (ep. plugins) that need to be called when the entire view has been built but\n         *  not attached to the page yet.\n         */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            this.$controls($where)\n                .find(\"[title]\")\n                .tooltip();\n            // set up the pupup for actions available when multi selecting\n            this._renderMultiselectActionMenu($where);\n            return this;\n        },\n\n        /** render a menu containing the actions available to sets of selected items */\n        _renderMultiselectActionMenu: function($where) {\n            $where = $where || this.$el;\n            var $menu = $where.find(\".list-action-menu\");\n            var actions = this.multiselectActions();\n            if (!actions.length) {\n                return $menu.empty();\n            }\n\n            var $newMenu = $(\n                [\n                    '<div class=\"list-action-menu btn-group\">',\n                    '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"For all selected\"),\n                    \"...\",\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu pull-right\" role=\"menu\">',\n                    \"</ul>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n            var $actions = actions.map(action => {\n                var html = ['<li><a href=\"javascript:void(0);\">', action.html, \"</a></li>\"].join(\"\");\n                return $(html).click(ev => {\n                    ev.preventDefault();\n                    return action.func(ev);\n                });\n            });\n            $newMenu.find(\"ul\").append($actions);\n            $menu.replaceWith($newMenu);\n            return $newMenu;\n        },\n\n        /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n         *      html: an html string used as the anchor contents\n         *      func: a function called when the anchor is clicked (passed the click event)\n         */\n        multiselectActions: function() {\n            return [];\n        },\n\n        // ------------------------------------------------------------------------ sub-$element shortcuts\n        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n        $scrollContainer: function($where) {\n            // override or set via attributes.$scrollContainer\n            return ($where || this.$el).parent().parent();\n        },\n        /** convenience selector for the section that displays the list controls */\n        $controls: function($where) {\n            return ($where || this.$el).find(\"> .controls\");\n        },\n        /** list-items: where the subviews are contained in the view's dom */\n        $list: function($where) {\n            return ($where || this.$el).find(\"> .list-items\");\n        },\n        /** container where list messages are attached */\n        $messages: function($where) {\n            //TODO: controls isn't really correct here (only for ModelListPanel)\n            return ($where || this.$el).find(\"> .controls .messages\");\n        },\n        /** the message displayed when no views can be shown (no views, none matching search) */\n        $emptyMessage: function($where) {\n            return ($where || this.$el).find(\"> .empty-message\");\n        },\n\n        // ------------------------------------------------------------------------ hda sub-views\n        /** render the subviews for the list's collection */\n        renderItems: function($whereTo) {\n            $whereTo = $whereTo || this.$el;\n            var panel = this;\n            panel.log(`${this}.renderItems`, $whereTo);\n\n            var $list = panel.$list($whereTo);\n            panel.freeViews();\n            // console.log( 'views freed' );\n            //TODO:? cache and re-use views?\n            var shownModels = panel._filterCollection();\n            // console.log( 'models filtered:', shownModels );\n\n            panel.views = shownModels.map(itemModel => {\n                var view = panel._createItemView(itemModel);\n                return view;\n            });\n\n            $list.empty();\n            // console.log( 'list emptied' );\n            if (panel.views.length) {\n                panel._attachItems($whereTo);\n                // console.log( 'items attached' );\n            }\n            panel._renderEmptyMessage($whereTo).toggle(!panel.views.length);\n            panel.trigger(\"views:ready\", panel.views);\n\n            // console.log( '------------------------------------------- rendering items' );\n            return panel.views;\n        },\n\n        /** Filter the collection to only those models that should be currently viewed */\n        _filterCollection: function() {\n            // override this\n            var panel = this;\n            return panel.collection.filter(_.bind(panel._filterItem, panel));\n        },\n\n        /** Should the model be viewable in the current state?\n         *     Checks against this.filters and this.searchFor\n         */\n        _filterItem: function(model) {\n            // override this\n            var panel = this;\n            return (\n                _.every(panel.filters.map(fn => fn.call(model))) &&\n                (!panel.searchFor || model.matchesAll(panel.searchFor))\n            );\n        },\n\n        /** Create a view for a model and set up it's listeners */\n        _createItemView: function(model) {\n            var ViewClass = this._getItemViewClass(model);\n            var options = _.extend(this._getItemViewOptions(model), {\n                model: model\n            });\n            var view = new ViewClass(options);\n            this._setUpItemViewListeners(view);\n            return view;\n        },\n\n        /** Free a view for a model. Note: does not remove it from the DOM */\n        _destroyItemView: function(view) {\n            this.stopListening(view);\n            this.views = _.without(this.views, view);\n        },\n\n        _destroyItemViews: function(view) {\n            var self = this;\n            self.views.forEach(v => {\n                self.stopListening(v);\n            });\n            self.views = [];\n            return self;\n        },\n\n        /** free any sub-views the list has */\n        freeViews: function() {\n            return this._destroyItemViews();\n        },\n\n        /** Get the bbone view class based on the model */\n        _getItemViewClass: function(model) {\n            // override this\n            return this.viewClass;\n        },\n\n        /** Get the options passed to the new view based on the model */\n        _getItemViewOptions: function(model) {\n            // override this\n            return {\n                //logger      : this.logger,\n                fxSpeed: this.fxSpeed,\n                expanded: false,\n                selectable: this.selecting,\n                selected: _.contains(this.selected, model.id),\n                draggable: this.dragItems\n            };\n        },\n\n        /** Set up listeners for new models */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            // send all events to the panel, re-namspaceing them with the view prefix\n            this.listenTo(view, \"all\", function() {\n                var args = Array.prototype.slice.call(arguments, 0);\n                args[0] = `view:${args[0]}`;\n                panel.trigger.apply(panel, args);\n            });\n\n            // drag multiple - hijack ev.setData to add all selected items\n            this.listenTo(\n                view,\n                \"draggable:dragstart\",\n                function(ev, v) {\n                    //TODO: set multiple drag data here\n                    var json = {};\n\n                    var selected = this.getSelectedModels();\n                    if (selected.length) {\n                        json = selected.toJSON();\n                    } else {\n                        json = [v.model.toJSON()];\n                    }\n                    ev.dataTransfer.setData(\"text\", JSON.stringify(json));\n                    //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n                },\n                this\n            );\n\n            return panel;\n        },\n\n        /** Attach views in this.views to the model based on $whereTo */\n        _attachItems: function($whereTo) {\n            var self = this;\n            // console.log( '_attachItems:', $whereTo, this.$list( $whereTo ) );\n            //ASSUMES: $list has been emptied\n            this.$list($whereTo).append(this.views.map(view => self._renderItemView$el(view)));\n            return this;\n        },\n\n        /** get a given subview's $el (or whatever may wrap it) and return it */\n        _renderItemView$el: function(view) {\n            // useful to wrap and override\n            return view.render(0).$el;\n        },\n\n        /** render the empty/none-found message */\n        _renderEmptyMessage: function($whereTo) {\n            this.debug(\"_renderEmptyMessage\", $whereTo, this.searchFor);\n            var text = this.searchFor ? this.noneFoundMsg : this.emptyMsg;\n            return this.$emptyMessage($whereTo).text(text);\n        },\n\n        /** expand all item views */\n        expandAll: function() {\n            _.each(this.views, view => {\n                view.expand();\n            });\n        },\n\n        /** collapse all item views */\n        collapseAll: function() {\n            _.each(this.views, view => {\n                view.collapse();\n            });\n        },\n\n        // ------------------------------------------------------------------------ collection/views syncing\n        /** Add a view (if the model should be viewable) to the panel */\n        addItemView: function(model, collection, options) {\n            // console.log( this + '.addItemView:', model );\n            var panel = this;\n            // get the index of the model in the list of filtered models shown by this list\n            // in order to insert the view in the proper place\n            //TODO:? potentially expensive\n            var modelIndex = panel._filterCollection().indexOf(model);\n            if (modelIndex === -1) {\n                return undefined;\n            }\n            var view = panel._createItemView(model);\n            // console.log( 'adding and rendering:', modelIndex, view.toString() );\n\n            $(view).queue(\"fx\", [\n                next => {\n                    // hide the empty message first if only view\n                    if (panel.$emptyMessage().is(\":visible\")) {\n                        panel.$emptyMessage().fadeOut(panel.fxSpeed, next);\n                    } else {\n                        next();\n                    }\n                },\n                next => {\n                    panel._attachView(view, modelIndex);\n                    next();\n                }\n            ]);\n            return view;\n        },\n\n        /** internal fn to add view (to both panel.views and panel.$list) */\n        _attachView: function(view, modelIndex, useFx) {\n            // console.log( this + '._attachView:', view, modelIndex, useFx );\n            useFx = _.isUndefined(useFx) ? true : useFx;\n            modelIndex = modelIndex || 0;\n            var panel = this;\n\n            // use the modelIndex to splice into views and insert at the proper index in the DOM\n            panel.views.splice(modelIndex, 0, view);\n            panel._insertIntoListAt(modelIndex, panel._renderItemView$el(view).hide());\n\n            panel.trigger(\"view:attached\", view);\n            if (useFx) {\n                view.$el.slideDown(panel.fxSpeed, () => {\n                    panel.trigger(\"view:attached:rendered\");\n                });\n            } else {\n                view.$el.show();\n                panel.trigger(\"view:attached:rendered\");\n            }\n            return view;\n        },\n\n        /** insert a jq object as a child of list-items at the specified *DOM index* */\n        _insertIntoListAt: function(index, $what) {\n            // console.log( this + '._insertIntoListAt:', index, $what );\n            var $list = this.$list();\n            if (index === 0) {\n                $list.prepend($what);\n            } else {\n                $list\n                    .children()\n                    .eq(index - 1)\n                    .after($what);\n            }\n            return $what;\n        },\n\n        /** Remove a view from the panel (if found) */\n        removeItemView: function(model, collection, options) {\n            var panel = this;\n            var view = _.find(panel.views, v => v.model === model);\n            if (!view) {\n                return undefined;\n            }\n            panel.views = _.without(panel.views, view);\n            panel.trigger(\"view:removed\", view);\n\n            // potentially show the empty message if no views left\n            // use anonymous queue here - since remove can happen multiple times\n            $({}).queue(\"fx\", [\n                next => {\n                    view.$el.fadeOut(panel.fxSpeed, next);\n                },\n                next => {\n                    view.remove();\n                    panel.trigger(\"view:removed:rendered\");\n                    if (!panel.views.length) {\n                        panel._renderEmptyMessage().fadeIn(panel.fxSpeed, next);\n                    } else {\n                        next();\n                    }\n                }\n            ]);\n            return view;\n        },\n\n        /** get views based on model.id */\n        viewFromModelId: function(id) {\n            return _.find(this.views, v => v.model.id === id);\n        },\n\n        /** get views based on model */\n        viewFromModel: function(model) {\n            return model ? this.viewFromModelId(model.id) : undefined;\n        },\n\n        /** get views based on model properties */\n        viewsWhereModel: function(properties) {\n            return this.views.filter(view => _.isMatch(view.model.attributes, properties));\n        },\n\n        /** A range of views between (and including) viewA and viewB */\n        viewRange: function(viewA, viewB) {\n            if (viewA === viewB) {\n                return viewA ? [viewA] : [];\n            }\n\n            var indexA = this.views.indexOf(viewA);\n            var indexB = this.views.indexOf(viewB);\n\n            // handle not found\n            if (indexA === -1 || indexB === -1) {\n                if (indexA === indexB) {\n                    return [];\n                }\n                return indexA === -1 ? [viewB] : [viewA];\n            }\n            // reverse if indeces are\n            //note: end inclusive\n            return indexA < indexB ? this.views.slice(indexA, indexB + 1) : this.views.slice(indexB, indexA + 1);\n        },\n\n        // ------------------------------------------------------------------------ searching\n        /** render a search input for filtering datasets shown\n         *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n         *      return will start the search\n         *      esc will clear the search\n         *      clicking the clear button will clear the search\n         *      uses searchInput in ui.js\n         */\n        _renderSearch: function($where) {\n            $where.find(\".controls .search-input\").searchInput({\n                placeholder: this.searchPlaceholder,\n                initialVal: this.searchFor,\n                onfirstsearch: _.bind(this._firstSearch, this),\n                onsearch: _.bind(this.searchItems, this),\n                onclear: _.bind(this.clearSearch, this)\n            });\n            return $where;\n        },\n\n        /** What to do on the first search entered */\n        _firstSearch: function(searchFor) {\n            // override to load model details if necc.\n            this.log(\"onFirstSearch\", searchFor);\n            return this.searchItems(searchFor);\n        },\n\n        /** filter view list to those that contain the searchFor terms */\n        searchItems: function(searchFor, force) {\n            this.log(\"searchItems\", searchFor, this.searchFor, force);\n            if (!force && this.searchFor === searchFor) {\n                return this;\n            }\n            this.searchFor = searchFor;\n            this.renderItems();\n            this.trigger(\"search:searching\", searchFor, this);\n            var $search = this.$(\"> .controls .search-query\");\n            if ($search.val() !== searchFor) {\n                $search.val(searchFor);\n            }\n            return this;\n        },\n\n        /** clear the search filters and show all views that are normally shown */\n        clearSearch: function(searchFor) {\n            //this.log( 'onSearchClear', this );\n            this.searchFor = \"\";\n            this.trigger(\"search:clear\", this);\n            this.$(\"> .controls .search-query\").val(\"\");\n            this.renderItems();\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ selection\n        /** @type Integer when the number of list item views is >= to this, don't animate selectors */\n        THROTTLE_SELECTOR_FX_AT: 20,\n\n        /** show selectors on all visible itemViews and associated controls */\n        showSelectors: function(speed) {\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            this.selecting = true;\n            this.$(\".list-actions\").slideDown(speed);\n            speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n            _.each(this.views, view => {\n                view.showSelector(speed);\n            });\n            //this.selected = [];\n            //this.lastSelected = null;\n        },\n\n        /** hide selectors on all visible itemViews and associated controls */\n        hideSelectors: function(speed) {\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            this.selecting = false;\n            this.$(\".list-actions\").slideUp(speed);\n            speed = this.views.length >= this.THROTTLE_SELECTOR_FX_AT ? 0 : speed;\n            _.each(this.views, view => {\n                view.hideSelector(speed);\n            });\n            this.selected = [];\n            this.lastSelected = null;\n        },\n\n        /** show or hide selectors on all visible itemViews and associated controls */\n        toggleSelectors: function() {\n            if (!this.selecting) {\n                this.showSelectors();\n            } else {\n                this.hideSelectors();\n            }\n        },\n\n        /** select all visible items */\n        selectAll: function(event) {\n            _.each(this.views, view => {\n                view.select(event);\n            });\n        },\n\n        /** deselect all visible items */\n        deselectAll: function(event) {\n            this.lastSelected = null;\n            _.each(this.views, view => {\n                view.deselect(event);\n            });\n        },\n\n        /** select a range of datasets between A and B */\n        selectRange: function(viewA, viewB) {\n            var range = this.viewRange(viewA, viewB);\n            _.each(range, view => {\n                view.select();\n            });\n            return range;\n        },\n\n        /** return an array of all currently selected itemViews */\n        getSelectedViews: function() {\n            return _.filter(this.views, v => v.selected);\n        },\n\n        /** return a collection of the models of all currenly selected items */\n        getSelectedModels: function() {\n            // console.log( '(getSelectedModels)' );\n            return new this.collection.constructor(_.map(this.getSelectedViews(), view => view.model));\n        },\n\n        // ------------------------------------------------------------------------ loading indicator\n        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n        _showLoadingIndicator: function(msg, speed, callback) {\n            this.debug(\"_showLoadingIndicator\", this.indicator, msg, speed, callback);\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            if (!this.indicator) {\n                this.indicator = new LoadingIndicator(this.$el);\n                this.debug(\"\\t created\", this.indicator);\n            }\n            if (!this.$el.is(\":visible\")) {\n                this.indicator.show(0, callback);\n            } else {\n                this.$el.fadeOut(speed);\n                this.indicator.show(msg, speed, callback);\n            }\n        },\n\n        /** hide the loading indicator */\n        _hideLoadingIndicator: function(speed, callback) {\n            this.debug(\"_hideLoadingIndicator\", this.indicator, speed, callback);\n            speed = speed !== undefined ? speed : this.fxSpeed;\n            if (this.indicator) {\n                this.indicator.hide(speed, callback);\n            }\n        },\n\n        // ------------------------------------------------------------------------ scrolling\n        /** get the current scroll position of the panel in its parent */\n        scrollPosition: function() {\n            return this.$scrollContainer().scrollTop();\n        },\n\n        /** set the current scroll position of the panel in its parent */\n        scrollTo: function(pos, speed) {\n            speed = speed || 0;\n            this.$scrollContainer().animate({ scrollTop: pos }, speed);\n            return this;\n        },\n\n        /** Scrolls the panel to the top. */\n        scrollToTop: function(speed) {\n            return this.scrollTo(0, speed);\n        },\n\n        /** scroll to the given view in list-items */\n        scrollToItem: function(view, speed) {\n            if (!view) {\n                return this;\n            }\n            return this;\n        },\n\n        /** Scrolls the panel to show the content with the given id. */\n        scrollToId: function(id, speed) {\n            return this.scrollToItem(this.viewFromModelId(id), speed);\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: {\n            \"click .select-all\": \"selectAll\",\n            \"click .deselect-all\": \"deselectAll\"\n        },\n\n        // ------------------------------------------------------------------------ misc\n        /** Return a string rep of the panel */\n        toString: function() {\n            return `ListPanel(${this.collection})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListPanel.prototype.templates = (() => {\n    var elTemplate = BASE_MVC.wrapTemplate([\n        // temp container\n        \"<div>\",\n        '<div class=\"controls\"></div>',\n        '<div class=\"list-items\"></div>',\n        '<div class=\"empty-message infomessagesmall\"></div>',\n        \"</div>\"\n    ]);\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n        '<div class=\"title\">',\n        '<div class=\"name\"><%- view.title %></div>',\n        \"</div>\",\n        '<div class=\"subtitle\"><%- view.subtitle %></div>',\n        // buttons, controls go here\n        '<div class=\"actions\"></div>',\n        // deleted msg, etc.\n        '<div class=\"messages\"></div>',\n\n        '<div class=\"search\">',\n        '<div class=\"search-input\"></div>',\n        \"</div>\",\n\n        // show when selectors are shown\n        '<div class=\"list-actions\">',\n        '<div class=\"btn-group\">',\n        '<button class=\"select-all btn btn-default\"',\n        'data-mode=\"select\">',\n        _l(\"All\"),\n        \"</button>\",\n        '<button class=\"deselect-all btn btn-default\"',\n        'data-mode=\"select\">',\n        _l(\"None\"),\n        \"</button>\",\n        \"</div>\",\n        '<div class=\"list-action-menu btn-group\">',\n        \"</div>\",\n        \"</div>\",\n        \"</div>\"\n    ]);\n\n    return {\n        el: elTemplate,\n        controls: controlsTemplate\n    };\n})();\n\n//=============================================================================\n/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n *  Allows:\n *      the model to be reset\n *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n *\n */\nvar ModelListPanel = ListPanel.extend({\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey: \"contents\",\n\n    initialize: function(attributes) {\n        ListPanel.prototype.initialize.call(this, attributes);\n        this.selecting = attributes.selecting !== undefined ? attributes.selecting : false;\n\n        this.setModel(this.model, attributes);\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel: function(model, attributes) {\n        attributes = attributes || {};\n        this.debug(`${this}.setModel:`, model, attributes);\n\n        this.freeModel();\n        this.freeViews();\n\n        if (model) {\n            var oldModelId = this.model ? this.model.get(\"id\") : null;\n\n            // set up the new model with user, logger, storage, events\n            this.model = model;\n            if (this.logger) {\n                this.model.logger = this.logger;\n            }\n            this._setUpModelListeners();\n\n            //TODO: relation btwn model, collection becoming tangled here\n            // free the collection, and assign the new collection to either\n            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n            this.stopListening(this.collection);\n            this.collection =\n                this.model[this.modelCollectionKey] || attributes.collection || this._createDefaultCollection();\n            this._setUpCollectionListeners();\n\n            if (oldModelId && model.get(\"id\") !== oldModelId) {\n                this.trigger(\"new-model\", this);\n            }\n        }\n        return this;\n    },\n\n    /** free the current model and all listeners for it, free any views for the model */\n    freeModel: function() {\n        // stop/release the previous model, and clear cache to sub-views\n        if (this.model) {\n            this.stopListening(this.model);\n            //TODO: see base-mvc\n            //this.model.free();\n            //this.model = null;\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listening\n    /** listening for model events */\n    _setUpModelListeners: function() {\n        // override\n        this.log(`${this}._setUpModelListeners`, this.model);\n        // bounce model errors up to the panel\n        this.listenTo(\n            this.model,\n            \"error\",\n            function() {\n                var args = Array.prototype.slice.call(arguments, 0);\n                //args.unshift( 'model:error' );\n                args.unshift(\"error\");\n                this.trigger.apply(this, args);\n            },\n            this\n        );\n\n        // debugging\n        if (this.logger) {\n            this.listenTo(this.model, \"all\", function(event) {\n                this.info(`${this}(model)`, event, arguments);\n            });\n        }\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls: function($newRender) {\n        this.debug(`${this}(ModelListPanel)._renderControls`);\n        var json = this.model ? this.model.toJSON() : {};\n        var $controls = $(this.templates.controls(json, this));\n        $newRender.find(\".controls\").replaceWith($controls);\n        return $controls;\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString: function() {\n        return `ModelListPanel(${this.model})`;\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nModelListPanel.prototype.templates = (() => {\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n        '<div class=\"title\">',\n        //TODO: this is really the only difference - consider factoring titlebar out\n        '<div class=\"name\"><%- model.name %></div>',\n        \"</div>\",\n        '<div class=\"subtitle\"><%- view.subtitle %></div>',\n        '<div class=\"actions\"></div>',\n        '<div class=\"messages\"></div>',\n\n        '<div class=\"search\">',\n        '<div class=\"search-input\"></div>',\n        \"</div>\",\n\n        '<div class=\"list-actions\">',\n        '<div class=\"btn-group\">',\n        '<button class=\"select-all btn btn-default\"',\n        'data-mode=\"select\">',\n        _l(\"All\"),\n        \"</button>\",\n        '<button class=\"deselect-all btn btn-default\"',\n        'data-mode=\"select\">',\n        _l(\"None\"),\n        \"</button>\",\n        \"</div>\",\n        '<div class=\"list-action-menu btn-group\">',\n        \"</div>\",\n        \"</div>\",\n        \"</div>\"\n    ]);\n\n    return _.extend(_.clone(ListPanel.prototype.templates), {\n        controls: controlsTemplate\n    });\n})();\n\n//=============================================================================\nexport default {\n    ListPanel: ListPanel,\n    ModelListPanel: ModelListPanel\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/list/list-view.js","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\nvar _l = window._l || (s => s);\n\n//TODO: consolidate with tool menu functionality, use there\n\n/** searchInput: (jQuery plugin)\n *      Creates a search input, a clear button, and loading indicator\n *      within the selected node.\n *\n *      When the user either presses return or enters some minimal number\n *      of characters, a callback is called. Pressing ESC when the input\n *      is focused will clear the input and call a separate callback.\n */\nfunction searchInput(parentNode, options) {\n    var KEYCODE_ESC = 27;\n    var KEYCODE_RETURN = 13;\n    var $parentNode = $(parentNode);\n    var firstSearch = true;\n\n    var defaults = {\n        initialVal: \"\",\n        name: \"search\",\n        placeholder: \"search\",\n        classes: \"\",\n        onclear: function() {},\n        onfirstsearch: null,\n        onsearch: function(inputVal) {},\n        minSearchLen: 0,\n        escWillClear: true,\n        oninit: function() {}\n    };\n\n    // .................................................................... input rendering and events\n    // visually clear the search, trigger an event, and call the callback\n    function clearSearchInput(event) {\n        var $input = $(this)\n            .parent()\n            .children(\"input\");\n        $input\n            .val(\"\")\n            .trigger(\"searchInput.clear\")\n            .blur();\n        options.onclear();\n    }\n\n    // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n    function search(event, searchTerms) {\n        if (!searchTerms) {\n            return clearSearchInput();\n        }\n        $(this).trigger(\"search.search\", searchTerms);\n        if (typeof options.onfirstsearch === \"function\" && firstSearch) {\n            firstSearch = false;\n            options.onfirstsearch(searchTerms);\n        } else {\n            options.onsearch(searchTerms);\n        }\n    }\n\n    // .................................................................... input rendering and events\n    function inputTemplate() {\n        // class search-query is bootstrap 2.3 style that now lives in base.less\n        return [\n            '<input type=\"text\" name=\"',\n            options.name,\n            '\" placeholder=\"',\n            options.placeholder,\n            '\" ',\n            'class=\"search-query ',\n            options.classes,\n            '\" ',\n            \"/>\"\n        ].join(\"\");\n    }\n\n    // the search input that responds to keyboard events and displays the search value\n    function $input() {\n        return (\n            $(inputTemplate())\n                // select all text on a focus\n                .focus(function(event) {\n                    $(this).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup(function(event) {\n                    event.preventDefault();\n                    event.stopPropagation();\n\n                    // esc key will clear if desired\n                    if (event.which === KEYCODE_ESC && options.escWillClear) {\n                        clearSearchInput.call(this, event);\n                    } else {\n                        var searchTerms = $(this).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if (\n                            event.which === KEYCODE_RETURN ||\n                            (options.minSearchLen && searchTerms.length >= options.minSearchLen)\n                        ) {\n                            search.call(this, event, searchTerms);\n                        }\n                    }\n                })\n                .val(options.initialVal)\n        );\n    }\n\n    // .................................................................... clear button rendering and events\n    // a button for clearing the search bar, placed on the right hand side\n    function $clearBtn() {\n        return $(\n            ['<span class=\"search-clear fa fa-times-circle\" ', 'title=\"', _l(\"clear search (esc)\"), '\"></span>'].join(\n                \"\"\n            )\n        )\n            .tooltip({ placement: \"bottom\" })\n            .click(function(event) {\n                clearSearchInput.call(this, event);\n            });\n    }\n\n    // .................................................................... loadingIndicator rendering\n    // a button for clearing the search bar, placed on the right hand side\n    function $loadingIndicator() {\n        return $(\n            ['<span class=\"search-loading fa fa-spinner fa-spin\" ', 'title=\"', _l(\"loading...\"), '\"></span>'].join(\"\")\n        )\n            .hide()\n            .tooltip({ placement: \"bottom\" });\n    }\n\n    // .................................................................... commands\n    // visually swap the load, clear buttons\n    function toggleLoadingIndicator() {\n        $parentNode.find(\".search-loading\").toggle();\n        $parentNode.find(\".search-clear\").toggle();\n    }\n\n    // .................................................................... init\n    // string command (not constructor)\n    if (jQuery.type(options) === \"string\") {\n        if (options === \"toggle-loading\") {\n            toggleLoadingIndicator();\n        }\n        return $parentNode;\n    }\n\n    // initial render\n    if (jQuery.type(options) === \"object\") {\n        options = jQuery.extend(true, {}, defaults, options);\n    }\n    //NOTE: prepended\n    return $parentNode.addClass(\"search-input\").prepend([$input(), $clearBtn(), $loadingIndicator()]);\n}\n\n// as jq plugin\njQuery.fn.extend({\n    searchInput: function $searchInput(options) {\n        return this.each(function() {\n            return searchInput(this, options);\n        });\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/ui/search-input.js","import DATASET_LI from \"mvc/dataset/dataset-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport HISTORY_ITEM_LI from \"mvc/history/history-item-li\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Read only view for HistoryDatasetAssociation.\n *      Since there are no controls on the HDAView to hide the dataset,\n *      the primary thing this class does (currently) is override templates\n *      to render the HID.\n */\nvar HDAListItemView = _super.extend(\n    /** @lends HDAListItemView.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        initialize: function(attributes, options) {\n            _super.prototype.initialize.call(this, attributes, options);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAListItemView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemView.prototype.templates = (() => {\n    var titleBarTemplate = dataset => `\n        <div class=\"title-bar clear\" tabindex=\"0\">\n            <span class=\"state-icon\"></span>\n            <div class=\"title\">\n                <span class=\"hid\">${dataset.hid}</span>\n                <span class=\"name\">${_.escape(dataset.name)}</span>\n            </div>\n            </br>\n            ${HISTORY_ITEM_LI.nametagTemplate(dataset)}\n        </div>\n    `;\n\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: BASE_MVC.wrapTemplate(\n            [\n                // add a warning when hidden\n                \"<% if( !dataset.visible ){ %>\",\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                _l(\"This dataset has been hidden\"),\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        titleBar: titleBarTemplate,\n        warnings: warnings\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDAListItemView: HDAListItemView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hda-li.js","function _labelIfName(tag) {\n    if (tag.indexOf(\"name:\") == 0) {\n        return `<span class=\"label label-info\">${_.escape(tag.slice(5))}</span>`;\n    } else {\n        return \"\";\n    }\n}\n\nfunction nametagTemplate(historyItem) {\n    return `<span class=\"nametags\">${_.sortBy(_.uniq(historyItem.tags))\n        .map(_labelIfName)\n        .join(\"\")}</span>`;\n}\n\nexport default {\n    nametagTemplate: nametagTemplate\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-item-li.js","import STATES from \"mvc/dataset/states\";\nimport DC_LI from \"mvc/collection/collection-li\";\nimport DC_VIEW from \"mvc/collection/collection-view\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport HISTORY_ITEM_LI from \"mvc/history/history-item-li\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DC_LI.DCListItemView;\n/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n */\nvar HDCAListItemView = _super.extend(\n    /** @lends HDCAListItemView.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        /** event listeners */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            this.listenTo(this.model, {\n                \"change:tags change:populated change:visible\": function(model, options) {\n                    this.render();\n                }\n            });\n        },\n\n        /** Override to provide the proper collections panels as the foldout */\n        _getFoldoutPanelClass: function() {\n            var collectionType = this.model.get(\"collection_type\");\n            switch (collectionType) {\n                case \"list\":\n                    return DC_VIEW.ListCollectionView;\n                case \"paired\":\n                    return DC_VIEW.PairCollectionView;\n                case \"list:paired\":\n                    return DC_VIEW.ListOfPairsCollectionView;\n                case \"list:list\":\n                    return DC_VIEW.ListOfListsCollectionView;\n            }\n            throw new TypeError(`Unknown collection_type: ${collectionType}`);\n        },\n\n        /** In this override, add the state as a class for use with state-based CSS */\n        _swapNewRender: function($newRender) {\n            _super.prototype._swapNewRender.call(this, $newRender);\n            //TODO: model currently has no state\n            var state = !this.model.get(\"populated\") ? STATES.RUNNING : STATES.OK;\n            //if( this.model.has( 'state' ) ){\n            this.$el.addClass(`state-${state}`);\n            //}\n            return this.$el;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDCAListItemView(${modelString})`;\n        }\n    }\n);\n\n/** underscore templates */\nHDCAListItemView.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: collection => {\n            collection.visible\n                ? \"\"\n                : `<div class=\"hidden-msg warningmessagesmall\">${_l(\"This collection has been hidden\")}</div>`;\n        }\n    });\n\n    // could steal this from hda-base (or use mixed content)\n    var titleBarTemplate = collection => `\n        <div class=\"title-bar clear\" tabindex=\"0\">\n            <span class=\"state-icon\"></span>\n            <div class=\"title\">\n                <span class=\"hid\">${collection.hid}</span>\n                <span class=\"name\">${_.escape(collection.name)}</span>\n            </div>\n            <div class=\"subtitle\"></div>\n            ${HISTORY_ITEM_LI.nametagTemplate(collection)}\n        </div>\n    `;\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        titleBar: titleBarTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDCAListItemView: HDCAListItemView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hdca-li.js","import LIST_VIEW from \"mvc/list/list-view\";\nimport DC_MODEL from \"mvc/collection/collection-model\";\nimport DC_LI from \"mvc/collection/collection-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"collections\";\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class non-editable, read-only View/Controller for a dataset collection.\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar CollectionView = _super.extend(\n    /** @lends CollectionView.prototype */ {\n        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n        _logNamespace: logNamespace,\n\n        className: `${_super.prototype.className} dataset-collection-panel`,\n\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_LI.DatasetDCEListItemView,\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView,\n        /** key of attribute in model to assign to this.collection */\n        modelCollectionKey: \"elements\",\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n\n            this.hasUser = attributes.hasUser;\n            /** A stack of panels that currently cover or hide this panel */\n            this.panelStack = [];\n            /** The text of the link to go back to the panel containing this one */\n            this.parentName = attributes.parentName;\n            /** foldout or drilldown */\n            this.foldoutStyle = attributes.foldoutStyle || \"foldout\";\n            this.downloadUrl = `${Galaxy.root}api/dataset_collections/${this.model.attributes.id}/download`;\n        },\n\n        _queueNewRender: function($newRender, speed) {\n            speed = speed === undefined ? this.fxSpeed : speed;\n            var panel = this;\n            panel.log(\"_queueNewRender:\", $newRender, speed);\n\n            // TODO: jquery@1.12 doesn't change display when the elem has display: flex\n            // this causes display: block for those elems after the use of show/hide animations\n            // animations are removed from this view for now until fixed\n            panel._swapNewRender($newRender);\n            panel.trigger(\"rendered\", panel);\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** In this override, use model.getVisibleContents */\n        _filterCollection: function() {\n            //TODO: should *not* be model.getVisibleContents - visibility is not model related\n            return this.model.getVisibleContents();\n        },\n\n        /** override to return proper view class based on element_type */\n        _getItemViewClass: function(model) {\n            //this.debug( this + '._getItemViewClass:', model );\n            //TODO: subclasses use DCEViewClass - but are currently unused - decide\n            switch (model.get(\"element_type\")) {\n                case \"hda\":\n                    return this.DatasetDCEViewClass;\n                case \"dataset_collection\":\n                    return this.NestedDCDCEViewClass;\n            }\n            throw new TypeError(\"Unknown element type:\", model.get(\"element_type\"));\n        },\n\n        /** override to add link target and anon */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                hasUser: this.hasUser,\n                //TODO: could move to only nested: list:paired\n                foldoutStyle: this.foldoutStyle\n            });\n        },\n\n        // ------------------------------------------------------------------------ collection sub-views\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n\n            // use pub-sub to: handle drilldown expansion and collapse\n            panel.listenTo(view, {\n                \"expanded:drilldown\": function(v, drilldown) {\n                    this._expandDrilldownPanel(drilldown);\n                },\n                \"collapsed:drilldown\": function(v, drilldown) {\n                    this._collapseDrilldownPanel(drilldown);\n                }\n            });\n            return this;\n        },\n\n        /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n        _expandDrilldownPanel: function(drilldown) {\n            this.panelStack.push(drilldown);\n            // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n            this.$(\"> .controls\")\n                .add(this.$list())\n                .hide();\n            drilldown.parentName = this.model.get(\"name\");\n            this.$el.append(drilldown.render().$el);\n        },\n\n        /** Handle drilldown close by freeing the panel and re-rendering this panel */\n        _collapseDrilldownPanel: function(drilldown) {\n            this.panelStack.pop();\n            this.render();\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: {\n            \"click .navigation .back\": \"close\"\n        },\n\n        /** close/remove this collection panel */\n        close: function(event) {\n            this.remove();\n            this.trigger(\"close\");\n        },\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `CollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nCollectionView.prototype.templates = (() => {\n    var controlsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"controls\">',\n            '<div class=\"navigation\">',\n            '<a class=\"back\" href=\"javascript:void(0)\">',\n            '<span class=\"fa fa-icon fa-angle-left\"></span>',\n            _l(\"Back to \"),\n            \"<%- view.parentName %>\",\n            \"</a>\",\n            \"</div>\",\n\n            '<div class=\"title\">',\n            '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>',\n            '<div class=\"subtitle\">',\n            '<% if( collection.collection_type === \"list\" ){ %>',\n            _l(\"a list of datasets\"),\n            '<% } else if( collection.collection_type === \"paired\" ){ %>',\n            _l(\"a pair of datasets\"),\n            '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n            _l(\"a list of paired datasets\"),\n            '<% } else if( collection.collection_type === \"list:list\" ){ %>',\n            _l(\"a list of dataset lists\"),\n            \"<% } %>\",\n            \"</div>\",\n            \"</div>\",\n\n            '<div class=\"tags-display\"></div>',\n\n            '<div class=\"actions\">',\n            '<a class=\"download-btn icon-btn\" ',\n            'href=\"<%- view.downloadUrl %>',\n            '\" title=\"\" download=\"\" data-original-title=\"Download Collection\">',\n            '<span class=\"fa fa-floppy-o\"></span>',\n            \"</a>\",\n            \"</div>\",\n            \"</div>\"\n        ],\n        \"collection\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        controls: controlsTemplate\n    });\n})();\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionView = CollectionView.extend(\n    /** @lends ListCollectionView.prototype */ {\n        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_LI.DatasetDCEListItemView,\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `ListCollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionView = ListCollectionView.extend(\n    /** @lends PairCollectionView.prototype */ {\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `PairCollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionView = CollectionView.extend(\n    /** @lends ListOfPairsCollectionView.prototype */ {\n        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView.extend({\n            foldoutPanelClass: PairCollectionView\n        }),\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `ListOfPairsCollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a list of lists dataset collection. */\nvar ListOfListsCollectionView = CollectionView.extend({\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView.extend({\n        foldoutPanelClass: PairCollectionView\n    }),\n\n    /** string rep */\n    toString: function() {\n        return `ListOfListsCollectionView(${this.model ? this.model.get(\"name\") : \"\"})`;\n    }\n});\n\n//==============================================================================\nexport default {\n    CollectionView: CollectionView,\n    ListCollectionView: ListCollectionView,\n    PairCollectionView: PairCollectionView,\n    ListOfPairsCollectionView: ListOfPairsCollectionView,\n    ListOfListsCollectionView: ListOfListsCollectionView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/collection-view.js","import STATES from \"mvc/dataset/states\";\nimport DATASET_LI from \"mvc/dataset/dataset-li\";\nimport TAGS from \"mvc/tag\";\nimport ANNOTATIONS from \"mvc/annotation\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Editing view for DatasetAssociation.\n */\nvar DatasetListItemEdit = _super.extend(\n    /** @lends DatasetListItemEdit.prototype */ {\n        /** set up: options */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            this.hasUser = attributes.hasUser;\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n\n            //TODO: move to HiddenUntilActivatedViewMixin\n            /** should the tags editor be shown or hidden initially? */\n            this.tagsEditorShown = attributes.tagsEditorShown || false;\n            /** should the tags editor be shown or hidden initially? */\n            this.annotationEditorShown = attributes.annotationEditorShown || false;\n        },\n\n        // ......................................................................... titlebar actions\n        /** In this override, add the other two primary actions: edit and delete */\n        _renderPrimaryActions: function() {\n            var actions = _super.prototype._renderPrimaryActions.call(this);\n            if (this.model.get(\"state\") === STATES.NOT_VIEWABLE) {\n                return actions;\n            }\n            // render the display, edit attr and delete icon-buttons\n            return _super.prototype._renderPrimaryActions\n                .call(this)\n                .concat([this._renderEditButton(), this._renderDeleteButton()]);\n        },\n\n        //TODO: move titleButtons into state renderers, remove state checks in the buttons\n\n        /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n        _renderEditButton: function() {\n            var self = this;\n            // don't show edit while uploading, in-accessible\n            // DO show if in error (ala previous history panel)\n            if (this.model.get(\"state\") === STATES.DISCARDED || !this.model.get(\"accessible\")) {\n                return null;\n            }\n            var purged = this.model.get(\"purged\");\n            var deleted = this.model.get(\"deleted\");\n\n            var editBtnData = {\n                title: _l(\"Edit attributes\"),\n                href: `${Galaxy.root}datasets/edit?dataset_id=${this.model.attributes.id}`,\n                faIcon: \"fa-pencil\",\n                classes: \"edit-btn\",\n                onclick: function(ev) {\n                    if (Galaxy.router) {\n                        ev.preventDefault();\n                        Galaxy.router.push(\"datasets/edit\", {\n                            dataset_id: self.model.attributes.id\n                        });\n                    }\n                }\n            };\n\n            // disable if purged or deleted and explain why in the tooltip\n            if (deleted || purged) {\n                editBtnData.disabled = true;\n                if (purged) {\n                    editBtnData.title = _l(\"Cannot edit attributes of datasets removed from disk\");\n                } else if (deleted) {\n                    editBtnData.title = _l(\"Undelete dataset to edit attributes\");\n                }\n\n                // disable if still uploading or new\n            } else if (_.contains([STATES.UPLOAD, STATES.NEW], this.model.get(\"state\"))) {\n                editBtnData.disabled = true;\n                editBtnData.title = _l(\"This dataset is not yet editable\");\n            }\n            return faIconButton(editBtnData);\n        },\n\n        /** Render icon-button to delete this hda. */\n        _renderDeleteButton: function() {\n            // don't show delete if...\n            if (!this.model.get(\"accessible\")) {\n                return null;\n            }\n\n            var self = this;\n            var deletedAlready = this.model.isDeletedOrPurged();\n            return faIconButton({\n                title: !deletedAlready ? _l(\"Delete\") : _l(\"Dataset is already deleted\"),\n                disabled: deletedAlready,\n                faIcon: \"fa-times\",\n                classes: \"delete-btn\",\n                onclick: function() {\n                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                    self.$el.find(\".icon-btn.delete-btn\").trigger(\"mouseout\");\n                    self.model[\"delete\"]();\n                }\n            });\n        },\n\n        // ......................................................................... details\n        /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n        _renderDetails: function() {\n            //TODO: generalize to be allow different details for each state\n            var $details = _super.prototype._renderDetails.call(this);\n\n            var state = this.model.get(\"state\");\n\n            if (!this.model.isDeletedOrPurged() && _.contains([STATES.OK, STATES.FAILED_METADATA], state)) {\n                this._renderTags($details);\n                this._renderAnnotation($details);\n                this._makeDbkeyEditLink($details);\n            }\n\n            this._setUpBehaviors($details);\n            return $details;\n        },\n\n        /**************************************************************************\n         * Render help button to show tool help text without rerunning the tool.\n         * Issue #2100\n         */\n        _renderToolHelpButton: function() {\n            var datasetID = this.model.attributes.dataset_id;\n            var jobID = this.model.attributes.creating_job;\n            var self = this;\n\n            var parseToolBuild = data => {\n                var helpString = `<div id=\"thdiv-${datasetID}\" class=\"toolhelp\">`;\n                if (data.name && data.help) {\n                    helpString += `<strong>Tool help for ${data.name}</strong><hr/>`;\n                    helpString += data.help;\n                } else {\n                    helpString += \"<strong>Tool help is unavailable for this dataset.</strong><hr/>\";\n                }\n                helpString += \"</div>\";\n                self.$el.find(\".details\").append($.parseHTML(helpString));\n            };\n            var parseToolID = data => {\n                $.ajax({\n                    url: `${Galaxy.root}api/tools/${data.tool_id}/build`\n                })\n                    .done(data => {\n                        parseToolBuild(data);\n                    })\n                    .fail(() => {\n                        parseToolBuild({});\n                    });\n            };\n            if (Galaxy.user.id === null) {\n                return null;\n            }\n            return faIconButton({\n                title: _l(\"Tool Help\"),\n                classes: \"icon-btn\",\n                href: \"#\",\n                faIcon: \"fa-question\",\n                onclick: function() {\n                    var divString = `thdiv-${datasetID}`;\n                    if (self.$el.find(\".toolhelp\").length > 0) {\n                        self.$el.find(\".toolhelp\").toggle();\n                    } else {\n                        $.ajax({\n                            url: `${Galaxy.root}api/jobs/${jobID}`\n                        })\n                            .done(data => {\n                                parseToolID(data);\n                            })\n                            .fail(() => {\n                                console.log(\n                                    `Failed at recovering job information from the  Galaxy API for job id \"${jobID}\".`\n                                );\n                            });\n                    }\n                }\n            });\n        },\n        //*************************************************************************\n\n        /** Add less commonly used actions in the details section based on state */\n        _renderSecondaryActions: function() {\n            var actions = _super.prototype._renderSecondaryActions.call(this);\n            switch (this.model.get(\"state\")) {\n                case STATES.UPLOAD:\n                case STATES.NOT_VIEWABLE:\n                    return actions;\n                case STATES.ERROR:\n                    // error button comes first\n                    actions.unshift(this._renderErrButton());\n                    return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n                case STATES.OK:\n                case STATES.FAILED_METADATA:\n                    return actions.concat([\n                        this._renderRerunButton(),\n                        this._renderVisualizationsButton(),\n                        this._renderToolHelpButton()\n                    ]);\n            }\n            return actions.concat([this._renderRerunButton(), this._renderToolHelpButton()]);\n        },\n\n        /** Render icon-button to report an error on this dataset to the galaxy admin. */\n        _renderErrButton: function() {\n            var self = this;\n            return faIconButton({\n                title: _l(\"View or report this error\"),\n                href: `${Galaxy.root}datasets/error?dataset_id=${this.model.attributes.id}`,\n                classes: \"report-error-btn\",\n                faIcon: \"fa-bug\",\n                onclick: function(ev) {\n                    if (Galaxy.router) {\n                        ev.preventDefault();\n                        Galaxy.router.push(\"datasets/error\", {\n                            dataset_id: self.model.attributes.id\n                        });\n                    }\n                }\n            });\n        },\n\n        /** Render icon-button to re-run the job that created this dataset. */\n        _renderRerunButton: function() {\n            var creating_job = this.model.get(\"creating_job\");\n            if (this.model.get(\"rerunnable\")) {\n                return faIconButton({\n                    title: _l(\"Run this job again\"),\n                    href: this.model.urls.rerun,\n                    classes: \"rerun-btn\",\n                    target: this.linkTarget,\n                    faIcon: \"fa-refresh\",\n                    onclick: function(ev) {\n                        if (Galaxy.router) {\n                            ev.preventDefault();\n                            Galaxy.router.push(\"/\", {\n                                job_id: creating_job\n                            });\n                        }\n                    }\n                });\n            }\n        },\n\n        /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n        _renderVisualizationsButton: function() {\n            //TODO: someday - lazyload visualizations\n            var visualizations = this.model.get(\"visualizations\");\n            if (this.model.isDeletedOrPurged() || !this.hasUser || !this.model.hasData() || _.isEmpty(visualizations)) {\n                return null;\n            }\n            if (!_.isObject(visualizations[0])) {\n                this.warn(\"Visualizations have been switched off\");\n                return null;\n            }\n\n            var $visualizations = $(this.templates.visualizations(visualizations, this));\n            //HACK: need to re-write those directed at galaxy_main with linkTarget\n            $visualizations.find('[target=\"galaxy_main\"]').attr(\"target\", this.linkTarget);\n            // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n            this._addScratchBookFn($visualizations.find(\".visualization-link\").addBack(\".visualization-link\"));\n            return $visualizations;\n        },\n\n        /** add scratchbook functionality to visualization links */\n        _addScratchBookFn: function($links) {\n            var li = this;\n            $links.click(function(ev) {\n                if (Galaxy.frame && Galaxy.frame.active) {\n                    Galaxy.frame.add({\n                        title: \"Visualization\",\n                        url: $(this).attr(\"href\")\n                    });\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                }\n            });\n        },\n\n        //TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n        /** Render the tags list/control */\n        _renderTags: function($where) {\n            if (!this.hasUser) {\n                return;\n            }\n            var view = this;\n            this.tagsEditor = new TAGS.TagsEditor({\n                model: this.model,\n                el: $where.find(\".tags-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // persist state on the hda view (and not the editor) since these are currently re-created each time\n                onshow: function() {\n                    view.tagsEditorShown = true;\n                },\n                onhide: function() {\n                    view.tagsEditorShown = false;\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit dataset tags\"),\n                    classes: \"tag-btn\",\n                    faIcon: \"fa-tags\"\n                }).appendTo($where.find(\".actions .right\"))\n            });\n            if (this.tagsEditorShown) {\n                this.tagsEditor.toggle(true);\n            }\n        },\n\n        /** Render the annotation display/control */\n        _renderAnnotation: function($where) {\n            if (!this.hasUser) {\n                return;\n            }\n            var view = this;\n            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n                model: this.model,\n                el: $where.find(\".annotation-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // persist state on the hda view (and not the editor) since these are currently re-created each time\n                onshow: function() {\n                    view.annotationEditorShown = true;\n                },\n                onhide: function() {\n                    view.annotationEditorShown = false;\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit dataset annotation\"),\n                    classes: \"annotate-btn\",\n                    faIcon: \"fa-comment\"\n                }).appendTo($where.find(\".actions .right\"))\n            });\n            if (this.annotationEditorShown) {\n                this.annotationEditor.toggle(true);\n            }\n        },\n\n        /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n        _makeDbkeyEditLink: function($details) {\n            // make the dbkey a link to editing\n            if (this.model.get(\"metadata_dbkey\") === \"?\" && !this.model.isDeletedOrPurged()) {\n                var editableDbkey = $('<a class=\"value\">?</a>')\n                    .attr(\"href\", this.model.urls.edit)\n                    .attr(\"target\", \"_top\");\n                $details.find(\".dbkey .value\").replaceWith(editableDbkey);\n            }\n        },\n\n        // ......................................................................... events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .undelete-link\": \"_clickUndeleteLink\",\n            \"click .purge-link\": \"_clickPurgeLink\",\n\n            \"click .edit-btn\": function(ev) {\n                this.trigger(\"edit\", this, ev);\n            },\n            \"click .delete-btn\": function(ev) {\n                this.trigger(\"delete\", this, ev);\n            },\n            \"click .rerun-btn\": function(ev) {\n                this.trigger(\"rerun\", this, ev);\n            },\n            \"click .report-err-btn\": function(ev) {\n                this.trigger(\"report-err\", this, ev);\n            },\n            \"click .visualization-btn\": function(ev) {\n                this.trigger(\"visualize\", this, ev);\n            },\n            \"click .dbkey a\": function(ev) {\n                this.trigger(\"edit\", this, ev);\n            }\n        }),\n\n        /** listener for item undelete (in the messages section) */\n        _clickUndeleteLink: function(ev) {\n            this.model.undelete();\n            return false;\n        },\n\n        /** listener for item purge (in the messages section) */\n        _clickPurgeLink: function(ev) {\n            if (confirm(_l(\"This will permanently remove the data in your dataset. Are you sure?\"))) {\n                this.model.purge();\n            }\n            return false;\n        },\n\n        // ......................................................................... misc\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAEditView(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemEdit.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        failed_metadata: BASE_MVC.wrapTemplate(\n            [\n                // in this override, provide a link to the edit page\n                '<% if( dataset.state === \"failed_metadata\" ){ %>',\n                '<div class=\"failed_metadata-warning warningmessagesmall\">',\n                _l(\"An error occurred setting the metadata for this dataset\"),\n                '<br /><a href=\"<%- dataset.urls.edit %>\" target=\"_top\">',\n                _l(\"Set it manually or retry auto-detection\"),\n                \"</a>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        ),\n\n        deleted: BASE_MVC.wrapTemplate(\n            [\n                // in this override, provide links to undelete or purge the dataset\n                \"<% if( dataset.deleted && !dataset.purged ){ %>\",\n                // deleted not purged\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                _l(\"This dataset has been deleted\"),\n                '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">',\n                _l(\"Undelete it\"),\n                \"</a>\",\n                \"<% if( view.purgeAllowed ){ %>\",\n                '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">',\n                _l(\"Permanently remove it from disk\"),\n                \"</a>\",\n                \"<% } %>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    var visualizationsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% if( visualizations.length === 1 ){ %>\",\n            '<a class=\"visualization-link icon-btn\" href=\"<%- visualizations[0].href %>\"',\n            ' target=\"<%- visualizations[0].target %>\" title=\"',\n            _l(\"Visualize in\"),\n            ' <%- visualizations[0].html %>\">',\n            '<span class=\"fa fa-bar-chart-o\"></span>',\n            \"</a>\",\n\n            \"<% } else { %>\",\n            '<div class=\"visualizations-dropdown dropdown icon-btn\">',\n            '<a data-toggle=\"dropdown\" title=\"',\n            _l(\"Visualize\"),\n            '\">',\n            '<span class=\"fa fa-bar-chart-o\"></span>',\n            \"</a>\",\n            '<ul class=\"dropdown-menu\" role=\"menu\">',\n            \"<% _.each( visualizations, function( visualization ){ %>\",\n            '<li><a class=\"visualization-link\" href=\"<%- visualization.href %>\"',\n            ' target=\"<%- visualization.target %>\">',\n            \"<%- visualization.html %>\",\n            \"</a></li>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\",\n            \"<% } %>\"\n        ],\n        \"visualizations\"\n    );\n\n    return _.extend({}, _super.prototype.templates, {\n        warnings: warnings,\n        visualizations: visualizationsTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    DatasetListItemEdit: DatasetListItemEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/dataset-li-edit.js","import baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n// =============================================================================\n/** A view on any model that has a 'annotation' attribute\n */\nvar AnnotationEditor = Backbone.View.extend(baseMVC.LoggableMixin)\n    .extend(baseMVC.HiddenUntilActivatedViewMixin)\n    .extend({\n        tagName: \"div\",\n        className: \"annotation-display\",\n\n        /** Set up listeners, parse options */\n        initialize: function(options) {\n            options = options || {};\n            this.tooltipConfig = options.tooltipConfig || {\n                placement: \"bottom\"\n            };\n            //console.debug( this, options );\n            // only listen to the model only for changes to annotations\n            this.listenTo(this.model, \"change:annotation\", function() {\n                this.render();\n            });\n            this.hiddenUntilActivated(options.$activator, options);\n        },\n\n        /** Build the DOM elements, call select to on the created input, and set up behaviors */\n        render: function() {\n            var view = this;\n            this.$el.html(this._template());\n\n            //TODO: handle empties better\n            this.$annotation().make_text_editable({\n                use_textarea: true,\n                on_finish: function(newAnnotation) {\n                    view.$annotation().text(newAnnotation);\n                    view.model.save({ annotation: newAnnotation }, { silent: true }).fail(() => {\n                        view.$annotation().text(view.model.previous(\"annotation\"));\n                    });\n                }\n            });\n            return this;\n        },\n\n        /** @returns {String} the html text used to build the view's DOM */\n        _template: function() {\n            var annotation = this.model.get(\"annotation\");\n            return [\n                //TODO: make prompt optional\n                '<label class=\"prompt\">',\n                _l(\"Annotation\"),\n                \"</label>\",\n                // set up initial tags by adding as CSV to input vals (necc. to init select2)\n                '<div class=\"annotation\">',\n                _.escape(annotation),\n                \"</div>\"\n            ].join(\"\");\n        },\n\n        /** @returns {jQuery} the main element for this view */\n        $annotation: function() {\n            return this.$el.find(\".annotation\");\n        },\n\n        /** shut down event listeners and remove this view's DOM */\n        remove: function() {\n            this.$annotation.off();\n            this.stopListening(this.model);\n            Backbone.View.prototype.remove.call(this);\n        },\n\n        /** string rep */\n        toString: function() {\n            return [\"AnnotationEditor(\", `${this.model}`, \")\"].join(\"\");\n        }\n    });\n// =============================================================================\nexport default {\n    AnnotationEditor: AnnotationEditor\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/annotation.js","import jQuery from \"jquery\";\nvar $ = jQuery;\nimport GalaxyApp from \"galaxy\";\nimport Router from \"layout/router\";\nimport ToolPanel from \"./panels/tool-panel\";\nimport HistoryPanel from \"./panels/history-panel\";\nimport Page from \"layout/page\";\nimport ToolForm from \"mvc/tool/tool-form\";\nimport FormWrapper from \"mvc/form/form-wrapper\";\nimport UserPreferences from \"mvc/user/user-preferences\";\nimport CustomBuilds from \"mvc/user/user-custom-builds\";\nimport Tours from \"mvc/tours\";\nimport GridView from \"mvc/grid/grid-view\";\nimport GridShared from \"mvc/grid/grid-shared\";\nimport Workflows from \"mvc/workflow/workflow\";\nimport HistoryList from \"mvc/history/history-list\";\nimport ToolFormComposite from \"mvc/tool/tool-form-composite\";\nimport QueryStringParsing from \"utils/query-string-parsing\";\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport DatasetError from \"mvc/dataset/dataset-error\";\nimport DatasetEditAttributes from \"mvc/dataset/dataset-edit-attributes\";\nimport Citations from \"components/citations.vue\";\nimport Vue from \"libs/vue\";\n\n/** define the 'Analyze Data'/analysis/main/home page for Galaxy\n *  * has a masthead\n *  * a left tool menu to allow the user to load tools in the center panel\n *  * a right history menu that shows the user's current data\n *  * a center panel\n *  Both panels (generally) persist while the center panel shows any\n *  UI needed for the current step of an analysis, like:\n *      * tool forms to set tool parameters,\n *      * tables showing the contents of datasets\n *      * etc.\n */\nwindow.app = function app(options, bootstrapped) {\n    window.Galaxy = new GalaxyApp.GalaxyApp(options, bootstrapped);\n    Galaxy.debug(\"analysis app\");\n\n    /** Routes */\n    var AnalysisRouter = Router.extend({\n        routes: {\n            \"(/)\": \"home\",\n            \"(/)root*\": \"home\",\n            \"(/)tours(/)(:tour_id)\": \"show_tours\",\n            \"(/)user(/)\": \"show_user\",\n            \"(/)user(/)(:form_id)\": \"show_user_form\",\n            \"(/)workflow(/)\": \"show_workflows\",\n            \"(/)workflow/run(/)\": \"show_run\",\n            \"(/)pages(/)create(/)\": \"show_pages_create\",\n            \"(/)pages(/)edit(/)\": \"show_pages_edit\",\n            \"(/)pages(/)(:action_id)\": \"show_pages\",\n            \"(/)visualizations(/)edit(/)\": \"show_visualizations_edit\",\n            \"(/)visualizations/(:action_id)\": \"show_visualizations\",\n            \"(/)workflows/list_published(/)\": \"show_workflows_published\",\n            \"(/)histories(/)citations(/)\": \"show_history_citations\",\n            \"(/)histories(/)rename(/)\": \"show_histories_rename\",\n            \"(/)histories(/)permissions(/)\": \"show_histories_permissions\",\n            \"(/)histories(/)(:action_id)\": \"show_histories\",\n            \"(/)datasets(/)list(/)\": \"show_datasets\",\n            \"(/)workflow/import_workflow\": \"show_import_workflow\",\n            \"(/)custom_builds\": \"show_custom_builds\",\n            \"(/)datasets/edit\": \"show_dataset_edit_attributes\",\n            \"(/)datasets/error\": \"show_dataset_error\"\n        },\n\n        require_login: [\"show_user\", \"show_user_form\", \"show_workflows\"],\n\n        authenticate: function(args, name) {\n            return (Galaxy.user && Galaxy.user.id) || this.require_login.indexOf(name) == -1;\n        },\n\n        show_tours: function(tour_id) {\n            if (tour_id) {\n                Tours.giveTour(tour_id);\n            } else {\n                this.page.display(new Tours.ToursView());\n            }\n        },\n\n        show_user: function() {\n            this.page.display(new UserPreferences.View());\n        },\n\n        show_user_form: function(form_id) {\n            var model = new UserPreferences.Model({\n                user_id: Galaxy.params.id\n            });\n            this.page.display(new FormWrapper.View(model.get(form_id)));\n        },\n\n        show_visualizations: function(action_id) {\n            this.page.display(\n                new GridShared.View({\n                    action_id: action_id,\n                    plural: \"Visualizations\",\n                    item: \"visualization\"\n                })\n            );\n        },\n\n        show_visualizations_edit: function() {\n            this.page.display(\n                new FormWrapper.View({\n                    url: `visualization/edit?id=${QueryStringParsing.get(\"id\")}`,\n                    redirect: \"visualizations/list\"\n                })\n            );\n        },\n\n        show_workflows_published: function() {\n            this.page.display(\n                new GridView({\n                    url_base: `${Galaxy.root}workflow/list_published`,\n                    dict_format: true\n                })\n            );\n        },\n\n        show_histories: function(action_id) {\n            this.page.display(new HistoryList.View({ action_id: action_id }));\n        },\n\n        show_history_citations: function() {\n            var citationInstance = Vue.extend(Citations);\n            var vm = document.createElement(\"div\");\n            this.page.display(vm);\n            new citationInstance({ propsData: { id: QueryStringParsing.get(\"id\"), source: \"histories\" } }).$mount(vm);\n        },\n\n        show_histories_rename: function() {\n            this.page.display(\n                new FormWrapper.View({\n                    url: `history/rename?id=${QueryStringParsing.get(\"id\")}`,\n                    redirect: \"histories/list\"\n                })\n            );\n        },\n\n        show_histories_permissions: function() {\n            this.page.display(\n                new FormWrapper.View({\n                    url: `history/permissions?id=${QueryStringParsing.get(\"id\")}`,\n                    redirect: \"histories/list\"\n                })\n            );\n        },\n\n        show_datasets: function() {\n            this.page.display(\n                new GridView({\n                    url_base: `${Galaxy.root}dataset/list`,\n                    dict_format: true\n                })\n            );\n        },\n\n        show_pages: function(action_id) {\n            this.page.display(\n                new GridShared.View({\n                    action_id: action_id,\n                    plural: \"Pages\",\n                    item: \"page\"\n                })\n            );\n        },\n\n        show_pages_create: function() {\n            this.page.display(\n                new FormWrapper.View({\n                    url: \"page/create\",\n                    redirect: \"pages/list\"\n                })\n            );\n        },\n\n        show_pages_edit: function() {\n            this.page.display(\n                new FormWrapper.View({\n                    url: `page/edit?id=${QueryStringParsing.get(\"id\")}`,\n                    redirect: \"pages/list\"\n                })\n            );\n        },\n\n        show_workflows: function() {\n            this.page.display(new Workflows.View());\n        },\n\n        show_run: function() {\n            this._loadWorkflow();\n        },\n\n        show_import_workflow: function() {\n            this.page.display(new Workflows.ImportWorkflowView());\n        },\n\n        show_custom_builds: function() {\n            var historyPanel = this.page.historyPanel.historyView;\n            if (!historyPanel || !historyPanel.model || !historyPanel.model.id) {\n                window.setTimeout(() => {\n                    this.show_custom_builds();\n                }, 500);\n                return;\n            }\n            this.page.display(new CustomBuilds.View());\n        },\n\n        show_dataset_edit_attributes: function() {\n            this.page.display(new DatasetEditAttributes.View());\n        },\n\n        show_dataset_error: function() {\n            this.page.display(new DatasetError.View());\n        },\n\n        /**  */\n        home: function(params) {\n            // TODO: to router, remove Globals\n            // load a tool by id (tool_id) or rerun a previous tool execution (job_id)\n            if (params.tool_id || params.job_id) {\n                if (params.tool_id === \"upload1\") {\n                    this.page.toolPanel.upload.show();\n                    this._loadCenterIframe(\"welcome\");\n                } else {\n                    this._loadToolForm(params);\n                }\n            } else {\n                // show the workflow run form\n                if (params.workflow_id) {\n                    this._loadWorkflow();\n                    // load the center iframe with controller.action: galaxy.org/?m_c=history&m_a=list -> history/list\n                } else if (params.m_c) {\n                    this._loadCenterIframe(`${params.m_c}/${params.m_a}`);\n                    // show the workflow run form\n                } else {\n                    this._loadCenterIframe(\"welcome\");\n                }\n            }\n        },\n\n        /** load the center panel with a tool form described by the given params obj */\n        _loadToolForm: function(params) {\n            //TODO: load tool form code async\n            params.id = decodeURIComponent(params.tool_id);\n            this.page.display(new ToolForm.View(params));\n        },\n\n        /** load the center panel iframe using the given url */\n        _loadCenterIframe: function(url, root) {\n            root = root || Galaxy.root;\n            url = root + url;\n            this.page.$(\"#galaxy_main\").prop(\"src\", url);\n        },\n\n        /** load workflow by its url in run mode */\n        _loadWorkflow: function() {\n            Utils.get({\n                url: `${Galaxy.root}api/workflows/${Utils.getQueryString(\"id\")}/download?style=run`,\n                success: response => {\n                    this.page.display(new ToolFormComposite.View(response));\n                },\n                error: response => {\n                    var error_msg = response.err_msg || \"Error occurred while loading the resource.\";\n                    var options = {\n                        message: error_msg,\n                        status: \"danger\",\n                        persistent: true\n                    };\n                    this.page.display(new Ui.Message(options));\n                }\n            });\n        }\n    });\n\n    // render and start the router\n    $(() => {\n        Galaxy.page = new Page.View(\n            _.extend(options, {\n                Left: ToolPanel,\n                Right: HistoryPanel,\n                Router: AnalysisRouter\n            })\n        );\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/apps/analysis.js","import Tools from \"mvc/tool/tools\";\nimport Upload from \"mvc/upload/upload-view\";\nimport _l from \"utils/localization\";\nimport ToolForm from \"mvc/tool/tool-form-composite\";\n\nvar ToolPanel = Backbone.View.extend({\n    initialize: function(page, options) {\n        // access configuration options\n        var config = options.config;\n        this.root = options.root;\n\n        /** @type {Object[]} descriptions of user's workflows to be shown in the tool menu */\n        this.stored_workflow_menu_entries = config.stored_workflow_menu_entries || [];\n\n        // create tool search, tool panel, and tool panel view.\n        var tool_search = new Tools.ToolSearch({\n            hidden: false\n        });\n        var tools = new Tools.ToolCollection(config.toolbox);\n        this.tool_panel = new Tools.ToolPanel({\n            tool_search: tool_search,\n            tools: tools,\n            layout: config.toolbox_in_panel\n        });\n        this.tool_panel_view = new Tools.ToolPanelView({\n            model: this.tool_panel\n        });\n\n        // add upload modal\n        this.upload_button = new Upload({\n            nginx_upload_path: config.nginx_upload_path,\n            ftp_upload_site: config.ftp_upload_site,\n            default_genome: config.default_genome,\n            default_extension: config.default_extension\n        });\n\n        // add uploader button to Galaxy object\n        Galaxy.upload = this.upload_button;\n\n        // components for panel definition\n        this.model = new Backbone.Model({\n            title: _l(\"Tools\"),\n            buttons: [this.upload_button]\n        });\n\n        // build body template\n        this.setElement(this._template());\n    },\n\n    render: function() {\n        // if there are tools, render panel and display everything\n        var self = this;\n        if (this.tool_panel.get(\"layout\").size() > 0) {\n            this.$el.prepend(this.tool_panel_view.$el);\n            this.tool_panel_view.render();\n        }\n        // build the dom for the workflow portion of the tool menu\n        // add internal workflow list\n        self.$(\"#internal-workflows\").append(\n            self._templateAllWorkflow({\n                title: _l(\"All workflows\"),\n                href: \"workflow\"\n            })\n        );\n        _.each(this.stored_workflow_menu_entries, menu_entry => {\n            self.$(\"#internal-workflows\").append(\n                self._templateWorkflowLink({\n                    title: menu_entry.stored_workflow.name,\n                    href: `workflow/run?id=${menu_entry.encoded_stored_workflow_id}`\n                })\n            );\n        });\n    },\n\n    /** build a link to one tool */\n    _templateTool: function(tool) {\n        return [\n            '<div class=\"toolTitle\">',\n            '<a href=\"',\n            this.root,\n            tool.href,\n            '\" target=\"galaxy_main\">',\n            tool.title,\n            \"</a>\",\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    /** build a link to 'All Workflows' */\n    _templateAllWorkflow: function(tool) {\n        return [\n            '<div class=\"toolTitle\">',\n            // global\n            '<a href=\"',\n            Galaxy.root,\n            tool.href,\n            '\">',\n            tool.title,\n            \"</a>\",\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    /** build links to workflows in toolpanel */\n    _templateWorkflowLink: function(wf) {\n        return [\n            '<div class=\"toolTitle\">',\n            `<a class=\"${wf.cls} \" href=\"`,\n            Galaxy.root,\n            wf.href,\n            '\">',\n            wf.title,\n            \"</a>\",\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    /** override to include inital menu dom and workflow section */\n    _template: function() {\n        return [\n            '<div class=\"toolMenuContainer\">',\n            '<div class=\"toolMenu\" style=\"display: none\">',\n            '<div id=\"search-no-results\" style=\"display: none; padding-top: 5px\">',\n            \"<em><strong>\",\n            _l(\"Search did not match any tools.\"),\n            \"</strong></em>\",\n            \"</div>\",\n            \"</div>\",\n            '<div class=\"toolSectionPad\"/>',\n            '<div class=\"toolSectionPad\"/>',\n            '<div class=\"toolSectionTitle\" id=\"title_XXinternalXXworkflow\">',\n            \"<span>\",\n            _l(\"Workflows\"),\n            \"</span>\",\n            \"</div>\",\n            '<div id=\"internal-workflows\" class=\"toolSectionBody\">',\n            '<div class=\"toolSectionBg\"/>',\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\");\n    },\n\n    toString: function() {\n        return \"toolPanel\";\n    }\n});\n\nexport default ToolPanel;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/apps/panels/tool-panel.js","/** Upload app contains the upload progress button and upload modal, compiles model data for API request **/\nimport Utils from \"utils/utils\";\nimport Modal from \"mvc/ui/ui-modal\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport UploadButton from \"mvc/upload/upload-button\";\nimport UploadViewDefault from \"mvc/upload/default/default-view\";\nimport UploadViewComposite from \"mvc/upload/composite/composite-view\";\nimport UploadViewCollection from \"mvc/upload/collection/collection-view\";\nexport default Backbone.View.extend({\n    options: {\n        nginx_upload_path: \"\",\n        ftp_upload_site: \"n/a\",\n        default_genome: \"?\",\n        default_extension: \"auto\",\n        height: 500,\n        width: 900,\n        auto: {\n            id: \"auto\",\n            text: \"Auto-detect\",\n            description:\n                \"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed.\"\n        }\n    },\n\n    // contains all available dataset extensions/types\n    list_extensions: [],\n\n    // contains all available genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        var self = this;\n        this.options = Utils.merge(options, this.options);\n\n        // create view for upload/progress button\n        this.ui_button = new UploadButton.View({\n            onclick: function(e) {\n                e.preventDefault();\n                self.show();\n            },\n            onunload: function() {\n                var percentage = self.ui_button.model.get(\"percentage\", 0);\n                if (percentage > 0 && percentage < 100) {\n                    return \"Several uploads are queued.\";\n                }\n            }\n        });\n\n        // set element to button view\n        this.setElement(this.ui_button.$el);\n\n        // load extensions\n        var self = this;\n        Utils.get({\n            url: `${Galaxy.root}api/datatypes?extension_only=False`,\n            success: function(datatypes) {\n                for (var key in datatypes) {\n                    self.list_extensions.push({\n                        id: datatypes[key].extension,\n                        text: datatypes[key].extension,\n                        description: datatypes[key].description,\n                        description_url: datatypes[key].description_url,\n                        composite_files: datatypes[key].composite_files\n                    });\n                }\n                self.list_extensions.sort((a, b) => {\n                    var a_text = a.text && a.text.toLowerCase();\n                    var b_text = b.text && b.text.toLowerCase();\n                    return a_text > b_text ? 1 : a_text < b_text ? -1 : 0;\n                });\n                if (!self.options.datatypes_disable_auto) {\n                    self.list_extensions.unshift(self.options.auto);\n                }\n            }\n        });\n\n        // load genomes\n        Utils.get({\n            url: `${Galaxy.root}api/genomes`,\n            success: function(genomes) {\n                for (var key in genomes) {\n                    self.list_genomes.push({\n                        id: genomes[key][1],\n                        text: genomes[key][0]\n                    });\n                }\n                self.list_genomes.sort((a, b) => {\n                    if (a.id == self.options.default_genome) {\n                        return -1;\n                    }\n                    if (b.id == self.options.default_genome) {\n                        return 1;\n                    }\n                    return a.text > b.text ? 1 : a.text < b.text ? -1 : 0;\n                });\n            }\n        });\n    },\n\n    /** Show/hide upload dialog */\n    show: function() {\n        var self = this;\n        if (!Galaxy.currHistoryPanel || !Galaxy.currHistoryPanel.model) {\n            window.setTimeout(() => {\n                self.show();\n            }, 500);\n            return;\n        }\n        this.current_user = Galaxy.user.id;\n        if (!this.modal) {\n            this.tabs = new Tabs.View();\n            this.default_view = new UploadViewDefault(this);\n            this.tabs.add({\n                id: \"regular\",\n                title: \"Regular\",\n                $el: this.default_view.$el\n            });\n            this.composite_view = new UploadViewComposite(this);\n            this.tabs.add({\n                id: \"composite\",\n                title: \"Composite\",\n                $el: this.composite_view.$el\n            });\n            this.collection_view = new UploadViewCollection(this);\n            this.tabs.add({\n                id: \"collection\",\n                title: \"Collection\",\n                $el: this.collection_view.$el\n            });\n            this.modal = new Modal.View({\n                title: \"Download from web or upload from disk\",\n                body: this.tabs.$el,\n                height: this.options.height,\n                width: this.options.width,\n                closing_events: true,\n                title_separator: false\n            });\n        }\n        this.modal.show();\n    },\n\n    /** Refresh user and current history */\n    currentHistory: function() {\n        return this.current_user && Galaxy.currHistoryPanel.model.get(\"id\");\n    },\n\n    /** Get ftp configuration */\n    currentFtp: function() {\n        return this.current_user && this.options.ftp_upload_site;\n    },\n\n    /**\n     * Package API data from array of models\n     * @param{Array} items - Upload items/rows filtered from a collection\n     */\n    toData: function(items, history_id) {\n        // create dictionary for data submission\n        var data = {\n            payload: {\n                tool_id: \"upload1\",\n                history_id: history_id || this.currentHistory(),\n                inputs: {}\n            },\n            files: [],\n            error_message: null\n        };\n        // add upload tools input data\n        if (items && items.length > 0) {\n            var inputs = {\n                file_count: items.length,\n                dbkey: items[0].get(\"genome\", \"?\"),\n                file_type: items[0].get(\"extension\", \"auto\")\n            };\n            for (var index in items) {\n                var it = items[index];\n                it.set(\"status\", \"running\");\n                if (it.get(\"file_size\") > 0) {\n                    var prefix = `files_${index}|`;\n                    inputs[`${prefix}type`] = \"upload_dataset\";\n                    inputs[`${prefix}space_to_tab`] = (it.get(\"space_to_tab\") && \"Yes\") || null;\n                    inputs[`${prefix}to_posix_lines`] = (it.get(\"to_posix_lines\") && \"Yes\") || null;\n                    inputs[`${prefix}dbkey`] = it.get(\"genome\", null);\n                    inputs[`${prefix}file_type`] = it.get(\"extension\", null);\n                    switch (it.get(\"file_mode\")) {\n                        case \"new\":\n                            inputs[`${prefix}url_paste`] = it.get(\"url_paste\");\n                            break;\n                        case \"ftp\":\n                            inputs[`${prefix}ftp_files`] = it.get(\"file_path\");\n                            break;\n                        case \"local\":\n                            data.files.push({\n                                name: `${prefix}file_data`,\n                                file: it.get(\"file_data\")\n                            });\n                    }\n                } else {\n                    data.error_message = \"Upload content incomplete.\";\n                    it.set(\"status\", \"error\");\n                    it.set(\"info\", data.error_message);\n                    break;\n                }\n            }\n            data.payload.inputs = JSON.stringify(inputs);\n        }\n        return data;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-view.js","/** View for upload/progress bar button */\n\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.model =\n            (options && options.model) ||\n            new Backbone.Model({\n                icon: \"fa-upload\",\n                tooltip: \"Download from URL or upload files from disk\",\n                label: \"Load Data\",\n                percentage: 0,\n                status: \"\",\n                onunload: function() {},\n                onclick: function() {}\n            }).set(options);\n        this.setElement(this._template());\n        this.$progress = this.$(\".progress-bar\");\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.render();\n        $(window).on(\"beforeunload\", () => self.model.get(\"onunload\")());\n    },\n\n    render: function() {\n        var self = this;\n        var options = this.model.attributes;\n        this.$el\n            .off(\"click\")\n            .on(\"click\", e => {\n                options.onclick(e);\n            })\n            .tooltip({\n                title: this.model.get(\"tooltip\"),\n                placement: \"bottom\"\n            });\n        this.$progress\n            .removeClass()\n            .addClass(\"progress-bar\")\n            .addClass(\"progress-bar-notransition\")\n            .addClass(options.status != \"\" && `progress-bar-${options.status}`)\n            .css({ width: `${options.percentage}%` });\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<div class=\"upload-button\">' +\n            '<div class=\"progress\">' +\n            '<div class=\"progress-bar\"/>' +\n            '<a class=\"panel-header-button\" href=\"javascript:void(0)\" id=\"tool-panel-upload-button\">' +\n            '<span class=\"fa fa-upload\"/>' +\n            \"</a>\" +\n            \"</div>\" +\n            \"</div>\"\n        );\n    }\n});\nexport default { View: View };\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/upload-button.js","/** Renders contents of the default uploader */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadRow from \"mvc/upload/default/default-row\";\nimport UploadFtp from \"mvc/upload/upload-ftp\";\nimport UploadExtension from \"mvc/upload/upload-extension\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport LazyLimited from \"mvc/lazy/lazy-limited\";\nimport \"utils/uploadbox\";\nexport default Backbone.View.extend({\n    // current upload size in bytes\n    upload_size: 0,\n\n    // contains upload row models\n    collection: new UploadModel.Collection(),\n\n    // keeps track of the current uploader state\n    counter: {\n        announce: 0,\n        success: 0,\n        error: 0,\n        running: 0,\n        reset: function() {\n            this.announce = this.success = this.error = this.running = 0;\n        }\n    },\n\n    initialize: function(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ui_button = app.ui_button;\n        this.ftp_upload_site = app.currentFtp();\n\n        // build template\n        this.setElement(this._template());\n        this.$uploadbox = this.$(\".upload-box\");\n        this.$uploadtable = this.$(\".upload-table\");\n\n        // append buttons to dom\n        this.btnLocal = new Ui.Button({\n            id: \"btn-local\",\n            title: \"Choose local file\",\n            onclick: function() {\n                self.uploadbox.select();\n            },\n            icon: \"fa fa-laptop\"\n        });\n        this.btnFtp = new Ui.Button({\n            id: \"btn-ftp\",\n            title: \"Choose FTP file\",\n            onclick: function() {\n                self._eventFtp();\n            },\n            icon: \"fa fa-folder-open-o\"\n        });\n        this.btnCreate = new Ui.Button({\n            id: \"btn-new\",\n            title: \"Paste/Fetch data\",\n            onclick: function() {\n                self._eventCreate();\n            },\n            icon: \"fa fa-edit\"\n        });\n        this.btnStart = new Ui.Button({\n            id: \"btn-start\",\n            title: \"Start\",\n            onclick: function() {\n                self._eventStart();\n            }\n        });\n        this.btnStop = new Ui.Button({\n            id: \"btn-stop\",\n            title: \"Pause\",\n            onclick: function() {\n                self._eventStop();\n            }\n        });\n        this.btnReset = new Ui.Button({\n            id: \"btn-reset\",\n            title: \"Reset\",\n            onclick: function() {\n                self._eventReset();\n            }\n        });\n        this.btnClose = new Ui.Button({\n            id: \"btn-close\",\n            title: \"Close\",\n            onclick: function() {\n                self.app.modal.hide();\n            }\n        });\n        _.each(\n            [this.btnLocal, this.btnFtp, this.btnCreate, this.btnStop, this.btnReset, this.btnStart, this.btnClose],\n            button => {\n                self.$(\".upload-buttons\").prepend(button.$el);\n            }\n        );\n\n        // file upload\n        this.uploadbox = this.$uploadbox.uploadbox({\n            url: this.app.options.nginx_upload_path,\n            announce: function(index, file) {\n                self._eventAnnounce(index, file);\n            },\n            initialize: function(index) {\n                return self.app.toData([self.collection.get(index)], self.history_id);\n            },\n            progress: function(index, percentage) {\n                self._eventProgress(index, percentage);\n            },\n            success: function(index, message) {\n                self._eventSuccess(index, message);\n            },\n            error: function(index, message) {\n                self._eventError(index, message);\n            },\n            complete: function() {\n                self._eventComplete();\n            },\n            ondragover: function() {\n                self.$uploadbox.addClass(\"highlight\");\n            },\n            ondragleave: function() {\n                self.$uploadbox.removeClass(\"highlight\");\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title: \"FTP files\",\n            container: this.btnFtp.$el\n        });\n\n        // select extension\n        this.select_extension = new Select.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, ext => !ext.composite_files),\n            value: this.options.default_extension,\n            onchange: function(extension) {\n                self._changeExtension(extension);\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\")\n            .on(\"click\", e => {\n                new UploadExtension({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value(),\n                    list: self.list_extensions,\n                    placement: \"top\"\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // genome extension\n        this.select_genome = new Select.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome,\n            onchange: function(genome) {\n                self._changeGenome(genome);\n            }\n        });\n\n        // Lazy load helper\n        this.loader = new LazyLimited({\n            $container: this.$uploadbox,\n            collection: this.collection,\n            new_content: function(model) {\n                var upload_row = new UploadRow(self, { model: model });\n                self.$uploadtable.find(\"> tbody:first\").append(upload_row.$el);\n                upload_row.render();\n                return upload_row;\n            }\n        });\n\n        // events\n        this.collection.on(\"remove\", model => {\n            self._eventRemove(model);\n        });\n        this.render();\n    },\n\n    render: function() {\n        var message = \"\";\n        if (this.counter.announce == 0) {\n            if (this.uploadbox.compatible()) {\n                message = \"&nbsp;\";\n            } else {\n                message =\n                    \"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.\";\n            }\n        } else {\n            if (this.counter.running == 0) {\n                message = `You added ${\n                    this.counter.announce\n                } file(s) to the queue. Add more files or click 'Start' to proceed.`;\n            } else {\n                message = `Please wait...${this.counter.announce} out of ${this.counter.running} remaining.`;\n            }\n        }\n        this.$(\".upload-top-info\").html(message);\n        var enable_reset =\n            this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0;\n        var enable_start = this.counter.running == 0 && this.counter.announce > 0;\n        var enable_sources = this.counter.running == 0;\n        var show_table = this.counter.announce + this.counter.success + this.counter.error > 0;\n        this.btnReset[enable_reset ? \"enable\" : \"disable\"]();\n        this.btnStart[enable_start ? \"enable\" : \"disable\"]();\n        this.btnStart.$el[enable_start ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnStop[this.counter.running > 0 ? \"enable\" : \"disable\"]();\n        this.btnLocal[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnCreate[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp.$el[this.ftp_upload_site ? \"show\" : \"hide\"]();\n        this.$(\".upload-table\")[show_table ? \"show\" : \"hide\"]();\n        this.$(\".upload-helper\")[show_table ? \"hide\" : \"show\"]();\n    },\n\n    /** A new file has been dropped/selected through the uploadbox plugin */\n    _eventAnnounce: function(index, file) {\n        this.counter.announce++;\n        var new_model = new UploadModel.Model({\n            id: index,\n            file_name: file.name,\n            file_size: file.size,\n            file_mode: file.mode || \"local\",\n            file_path: file.path,\n            file_data: file\n        });\n        this.render();\n        this.collection.add(new_model);\n    },\n\n    /** Progress */\n    _eventProgress: function(index, percentage) {\n        var it = this.collection.get(index);\n        it.set(\"percentage\", percentage);\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(percentage, it.get(\"file_size\")));\n    },\n\n    /** Success */\n    _eventSuccess: function(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"success\" });\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(100, it.get(\"file_size\")));\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.success++;\n        this.render();\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Error */\n    _eventError: function(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"error\", info: message });\n        this.ui_button.model.set({\n            percentage: this._uploadPercentage(100, it.get(\"file_size\")),\n            status: \"danger\"\n        });\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.error++;\n        this.render();\n    },\n\n    /** Queue is done */\n    _eventComplete: function() {\n        this.collection.each(model => {\n            model.get(\"status\") == \"queued\" && model.set(\"status\", \"init\");\n        });\n        this.counter.running = 0;\n        this.render();\n    },\n\n    /** Remove model from upload list */\n    _eventRemove: function(model) {\n        var status = model.get(\"status\");\n        if (status == \"success\") {\n            this.counter.success--;\n        } else if (status == \"error\") {\n            this.counter.error--;\n        } else {\n            this.counter.announce--;\n        }\n        this.uploadbox.remove(model.id);\n        this.render();\n    },\n\n    //\n    // events triggered by this view\n    //\n\n    /** Show/hide ftp popup */\n    _eventFtp: function() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append(\n                new UploadFtp({\n                    collection: this.collection,\n                    ftp_upload_site: this.ftp_upload_site,\n                    onadd: function(ftp_file) {\n                        return self.uploadbox.add([\n                            {\n                                mode: \"ftp\",\n                                name: ftp_file.path,\n                                size: ftp_file.size,\n                                path: ftp_file.path\n                            }\n                        ]);\n                    },\n                    onremove: function(model_index) {\n                        self.collection.remove(model_index);\n                    }\n                }).$el\n            );\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Create a new file */\n    _eventCreate: function() {\n        this.uploadbox.add([{ name: \"New File\", size: 0, mode: \"new\" }]);\n    },\n\n    /** Start upload process */\n    _eventStart: function() {\n        if (this.counter.announce != 0 && this.counter.running == 0) {\n            // prepare upload process\n            var self = this;\n            this.upload_size = 0;\n            this.upload_completed = 0;\n            this.collection.each(model => {\n                if (model.get(\"status\") == \"init\") {\n                    model.set(\"status\", \"queued\");\n                    self.upload_size += model.get(\"file_size\");\n                }\n            });\n            this.ui_button.model.set({\n                percentage: 0,\n                status: \"success\"\n            });\n            this.counter.running = this.counter.announce;\n            this.history_id = this.app.currentHistory();\n\n            // package ftp files separately, and remove them from queue\n            this._uploadFtp();\n\n            // queue remaining files\n            this.uploadbox.start();\n            this.render();\n        }\n    },\n\n    /** Pause upload process */\n    _eventStop: function() {\n        if (this.counter.running > 0) {\n            this.ui_button.model.set(\"status\", \"info\");\n            $(\".upload-top-info\").html(\"Queue will pause after completing the current file...\");\n            this.uploadbox.stop();\n        }\n    },\n\n    /** Remove all */\n    _eventReset: function() {\n        if (this.counter.running == 0) {\n            var self = this;\n            this.collection.reset();\n            this.counter.reset();\n            this.uploadbox.reset();\n            this.select_extension.value(this.options.default_extension);\n            this.select_genome.value(this.options.default_genome);\n            this.ui_button.model.set(\"percentage\", 0);\n            this.render();\n        }\n    },\n\n    /** Update extension for all models */\n    _changeExtension: function(extension, defaults_only) {\n        var self = this;\n        this.collection.each(model => {\n            if (\n                model.get(\"status\") == \"init\" &&\n                (model.get(\"extension\") == self.options.default_extension || !defaults_only)\n            ) {\n                model.set(\"extension\", extension);\n            }\n        });\n    },\n\n    /** Update genome for all models */\n    _changeGenome: function(genome, defaults_only) {\n        var self = this;\n        this.collection.each(model => {\n            if (\n                model.get(\"status\") == \"init\" &&\n                (model.get(\"genome\") == self.options.default_genome || !defaults_only)\n            ) {\n                model.set(\"genome\", genome);\n            }\n        });\n    },\n\n    /** Package and upload ftp files in a single request */\n    _uploadFtp: function() {\n        var self = this;\n        var list = [];\n        this.collection.each(model => {\n            if (model.get(\"status\") == \"queued\" && model.get(\"file_mode\") == \"ftp\") {\n                self.uploadbox.remove(model.id);\n                list.push(model);\n            }\n        });\n        if (list.length > 0) {\n            $.uploadpost({\n                data: this.app.toData(list),\n                url: this.app.options.nginx_upload_path,\n                success: function(message) {\n                    _.each(list, model => {\n                        self._eventSuccess(model.id);\n                    });\n                },\n                error: function(message) {\n                    _.each(list, model => {\n                        self._eventError(model.id, message);\n                    });\n                }\n            });\n        }\n    },\n\n    /** Calculate percentage of all queued uploads */\n    _uploadPercentage: function(percentage, size) {\n        return (this.upload_completed + percentage * size) / this.upload_size;\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<div class=\"upload-view-default\">' +\n            '<div class=\"upload-top\">' +\n            '<h6 class=\"upload-top-info\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-box\">' +\n            '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' +\n            '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' +\n            \"<thead>\" +\n            \"<tr>\" +\n            \"<th>Name</th>\" +\n            \"<th>Size</th>\" +\n            \"<th>Type</th>\" +\n            \"<th>Genome</th>\" +\n            \"<th>Settings</th>\" +\n            \"<th>Status</th>\" +\n            \"<th/>\" +\n            \"</tr>\" +\n            \"</thead>\" +\n            \"<tbody/>\" +\n            \"</table>\" +\n            \"</div>\" +\n            '<div class=\"upload-footer\">' +\n            '<span class=\"upload-footer-title\">Type (set all):</span>' +\n            '<span class=\"upload-footer-extension\"/>' +\n            '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' +\n            '<span class=\"upload-footer-title\">Genome (set all):</span>' +\n            '<span class=\"upload-footer-genome\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-buttons\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/default/default-view.js","/** Renders the default uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new Select.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new Select.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", () => {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\")\n            .on(\"click\", e => {\n                self.app.showExtensionInfo({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value()\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", e => {\n                self._showSettings();\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", () => {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", () => {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: `${percentage}%` });\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return `<tr id=\"upload-row-${\n            options.id\n        }\" class=\"upload-row\"><td><div class=\"upload-text-column\"><div class=\"upload-mode\"/><div class=\"upload-title\"/><div class=\"upload-text\"><div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\"upload-text-content form-control\"/></div></div></td><td><div class=\"upload-size\"/></td><td><div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp<div class=\"upload-extension-info upload-icon-button fa fa-search\"/></td><td><div class=\"upload-genome\"/></td><td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td><td><div class=\"upload-info\"><div class=\"upload-info-text\"/><div class=\"upload-info-progress progress\"><div class=\"upload-progress-bar progress-bar progress-bar-success\"/><div class=\"upload-percentage\">0%</div></div></div></td><td><div class=\"upload-symbol ${\n            this.status_classes.init\n        }\"/></td></tr>`;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/default/default-row.js","/** Contains helpers to limit/lazy load views for backbone views */\n\nexport default Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.$container = options.$container;\n        this.collection = options.collection;\n        this.new_content = options.new_content;\n        this.max = options.max || 50;\n        this.content_list = {};\n        this.$message = $(\"<div/>\")\n            .addClass(\"ui-limitloader\")\n            .append(`...only the first ${this.max} entries are visible.`);\n        this.$container.append(this.$message);\n        this.listenTo(this.collection, \"reset\", this._reset, this);\n        this.listenTo(this.collection, \"add\", this._refresh, this);\n        this.listenTo(this.collection, \"remove\", this._remove, this);\n    },\n\n    /** Checks if the limit has been reached */\n    _done: function() {\n        var done = _.size(this.content_list) > this.max;\n        this.$message[done ? \"show\" : \"hide\"]();\n        return done;\n    },\n\n    /** Remove all content */\n    _reset: function() {\n        _.each(this.content_list, content => {\n            content.remove();\n        });\n        this.content_list = {};\n        this.$message.hide();\n    },\n\n    /** Remove content */\n    _remove: function(model) {\n        var model_id = model.id;\n        var content = this.content_list[model_id];\n        if (content) {\n            content.remove();\n            delete this.content_list[model_id];\n        }\n        this._refresh();\n    },\n\n    /** Refreshes container content by adding new views if visible */\n    _refresh: function() {\n        if (!this._done()) {\n            for (var i in this.collection.models) {\n                var model = this.collection.models[i];\n                var view = this.content_list[model.id];\n                if (!this.content_list[model.id]) {\n                    var content = this.new_content(model);\n                    this.content_list[model.id] = content;\n                    if (this._done()) {\n                        break;\n                    }\n                }\n            }\n        }\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/lazy/lazy-limited.js","/** Renders contents of the composite uploader */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadRow from \"mvc/upload/composite/composite-row\";\nimport UploadExtension from \"mvc/upload/upload-extension\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nimport Ui from \"mvc/ui/ui-misc\";\nexport default Backbone.View.extend({\n    collection: new UploadModel.Collection(),\n    initialize: function(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ftp_upload_site = app.currentFtp();\n        this.setElement(this._template());\n\n        // create button section\n        this.btnStart = new Ui.Button({\n            title: \"Start\",\n            onclick: function() {\n                self._eventStart();\n            }\n        });\n        this.btnClose = new Ui.Button({\n            title: \"Close\",\n            onclick: function() {\n                self.app.modal.hide();\n            }\n        });\n\n        // append buttons to dom\n        _.each([this.btnStart, this.btnClose], button => {\n            self.$(\".upload-buttons\").prepend(button.$el);\n        });\n\n        // select extension\n        this.select_extension = new Select.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, ext => ext.composite_files),\n            onchange: function(extension) {\n                self.collection.reset();\n                var details = _.findWhere(self.list_extensions, {\n                    id: extension\n                });\n                if (details && details.composite_files) {\n                    _.each(details.composite_files, item => {\n                        self.collection.add({\n                            id: self.collection.size(),\n                            file_desc: item.description || item.name\n                        });\n                    });\n                }\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\")\n            .on(\"click\", e => {\n                new UploadExtension({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value(),\n                    list: self.list_extensions,\n                    placement: \"top\"\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // genome extension\n        this.select_genome = new Select.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome\n        });\n\n        // listener for collection triggers on change in composite datatype and extension selection\n        this.listenTo(this.collection, \"add\", model => {\n            self._eventAnnounce(model);\n        });\n        this.listenTo(this.collection, \"change add\", () => {\n            self.render();\n        });\n        this.select_extension.options.onchange(this.select_extension.value());\n        this.render();\n    },\n\n    render: function() {\n        var model = this.collection.first();\n        if (model && model.get(\"status\") == \"running\") {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        } else {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        }\n        if (this.collection.where({ status: \"ready\" }).length == this.collection.length && this.collection.length > 0) {\n            this.btnStart.enable();\n            this.btnStart.$el.addClass(\"btn-primary\");\n        } else {\n            this.btnStart.disable();\n            this.btnStart.$el.removeClass(\"btn-primary\");\n        }\n        this.$(\".upload-table\")[this.collection.length > 0 ? \"show\" : \"hide\"]();\n    },\n\n    //\n    // upload events / process pipeline\n    //\n\n    /** Builds the basic ui with placeholder rows for each composite data type file */\n    _eventAnnounce: function(model) {\n        var upload_row = new UploadRow(this, { model: model });\n        this.$(\".upload-table > tbody:first\").append(upload_row.$el);\n        this.$(\".upload-table\")[this.collection.length > 0 ? \"show\" : \"hide\"]();\n        upload_row.render();\n    },\n\n    /** Start upload process */\n    _eventStart: function() {\n        var self = this;\n        this.collection.each(model => {\n            model.set({\n                genome: self.select_genome.value(),\n                extension: self.select_extension.value()\n            });\n        });\n        $.uploadpost({\n            url: this.app.options.nginx_upload_path,\n            data: this.app.toData(this.collection.filter()),\n            success: function(message) {\n                self._eventSuccess(message);\n            },\n            error: function(message) {\n                self._eventError(message);\n            },\n            progress: function(percentage) {\n                self._eventProgress(percentage);\n            }\n        });\n    },\n\n    /** Refresh progress state */\n    _eventProgress: function(percentage) {\n        this.collection.each(it => {\n            it.set(\"percentage\", percentage);\n        });\n    },\n\n    /** Refresh success state */\n    _eventSuccess: function(message) {\n        this.collection.each(it => {\n            it.set(\"status\", \"success\");\n        });\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Refresh error state */\n    _eventError: function(message) {\n        this.collection.each(it => {\n            it.set({ status: \"error\", info: message });\n        });\n    },\n\n    /** Load html template */\n    _template: function() {\n        return (\n            '<div class=\"upload-view-composite\">' +\n            '<div class=\"upload-top\">' +\n            '<h6 class=\"upload-top-info\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-box\">' +\n            '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' +\n            \"<thead>\" +\n            \"<tr>\" +\n            \"<th/>\" +\n            \"<th/>\" +\n            \"<th>Description</th>\" +\n            \"<th>Name</th>\" +\n            \"<th>Size</th>\" +\n            \"<th>Settings</th>\" +\n            \"<th>Status</th>\" +\n            \"</tr>\" +\n            \"</thead>\" +\n            \"<tbody/>\" +\n            \"</table>\" +\n            \"</div>\" +\n            '<div class=\"upload-footer\">' +\n            '<span class=\"upload-footer-title\">Composite Type:</span>' +\n            '<span class=\"upload-footer-extension\"/>' +\n            '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' +\n            '<span class=\"upload-footer-title\">Genome/Build:</span>' +\n            '<span class=\"upload-footer-genome\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-buttons\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/composite/composite-view.js","/** Renders the composite upload row view */\nimport Utils from \"utils/utils\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport UploadFtp from \"mvc/upload/upload-ftp\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Select from \"mvc/ui/ui-select\";\nimport \"utils/uploadbox\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-mode fa fa-exclamation text-primary\",\n        ready: \"upload-mode fa fa-check text-success\",\n        running: \"upload-mode fa fa-spinner fa-spin\",\n        success: \"upload-mode fa fa-check\",\n        error: \"upload-mode fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template());\n        this.$source = this.$(\".upload-source\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$status = this.$(\".upload-status\");\n        this.$text = this.$(\".upload-text\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$file_name = this.$(\".upload-file-name\");\n        this.$file_desc = this.$(\".upload-file-desc\");\n        this.$file_size = this.$(\".upload-file-size\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // build upload functions\n        this.uploadinput = this.$el.uploadinput({\n            ondragover: function() {\n                self.model.get(\"enabled\") && self.$el.addClass(\"warning\");\n            },\n            ondragleave: function() {\n                self.$el.removeClass(\"warning\");\n            },\n            onchange: function(files) {\n                if (self.model.get(\"status\") != \"running\" && files && files.length > 0) {\n                    self.model.reset({\n                        file_data: files[0],\n                        file_name: files[0].name,\n                        file_size: files[0].size,\n                        file_mode: files[0].mode || \"local\"\n                    });\n                    self._refreshReady();\n                }\n            }\n        });\n\n        // source selection popup\n        this.button_menu = new Ui.ButtonMenu({\n            icon: \"fa-caret-down\",\n            title: \"Select\",\n            pull: \"left\"\n        });\n        this.$source.append(this.button_menu.$el);\n        this.button_menu.addMenu({\n            icon: \"fa-laptop\",\n            title: \"Choose local file\",\n            onclick: function() {\n                self.uploadinput.dialog();\n            }\n        });\n        if (this.app.ftp_upload_site) {\n            this.button_menu.addMenu({\n                icon: \"fa-folder-open-o\",\n                title: \"Choose FTP file\",\n                onclick: function() {\n                    self._showFtp();\n                }\n            });\n        }\n        this.button_menu.addMenu({\n            icon: \"fa-edit\",\n            title: \"Paste/Fetch data\",\n            onclick: function() {\n                self.model.reset({\n                    file_mode: \"new\",\n                    file_name: \"New File\"\n                });\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title: \"Choose FTP file:\",\n            container: this.$source.find(\".ui-button-menu\"),\n            placement: \"right\"\n        });\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$settings,\n            placement: \"bottom\"\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n            self._refreshReady();\n        });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", e => {\n                self._showSettings();\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_name\", () => {\n            self._refreshFileName();\n        });\n        this.listenTo(this.model, \"change:file_mode\", () => {\n            self._refreshMode();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", () => {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", () => {\n            self.remove();\n        });\n    },\n\n    render: function() {\n        this.$el.attr(\"id\", `upload-row-${this.model.id}`);\n        this.$file_name.html(_.escape(this.model.get(\"file_name\") || \"-\"));\n        this.$file_desc.html(this.model.get(\"file_desc\") || \"Unavailable\");\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n        this.$status.removeClass().addClass(this.status_classes.init);\n    },\n\n    /** Remove view */\n    remove: function() {\n        // call the base class remove method\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    //\n    // handle model events\n    //\n\n    /** Refresh ready or not states */\n    _refreshReady: function() {\n        this.app.collection.each(model => {\n            model.set(\"status\", (model.get(\"file_size\") > 0 && \"ready\") || \"init\");\n        });\n    },\n\n    /** Refresh mode and e.g. show/hide textarea field */\n    _refreshMode: function() {\n        var file_mode = this.model.get(\"file_mode\");\n        if (file_mode == \"new\") {\n            this.height = this.$el.height();\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$text_content.val(\"\").trigger(\"keyup\");\n        } else {\n            this.$el.height(this.height);\n            this.$text.hide();\n        }\n    },\n\n    /** Refresh information */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        if (percentage != 0) {\n            this.$progress_bar.css({ width: `${percentage}%` });\n        } else {\n            this.$progress_bar.addClass(\"no-transition\");\n            this.$progress_bar.css({ width: \"0%\" });\n            this.$progress_bar[0].offsetHeight;\n            this.$progress_bar.removeClass(\"no-transition\");\n        }\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$status.removeClass().addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status != \"running\");\n        this.$text_content.attr(\"disabled\", !this.model.get(\"enabled\"));\n        this.$el.removeClass(\"success danger warning\");\n        if (status == \"running\" || status == \"ready\") {\n            this.model.set(\"percentage\", 0);\n        }\n        this.$source.find(\".button\")[status == \"running\" ? \"addClass\" : \"removeClass\"](\"disabled\");\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.model.set(\"percentage\", 100);\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.model.set(\"percentage\", 0);\n            this.$info_progress.hide();\n            this.$info_text.show();\n        } else {\n            this.$info_progress.show();\n            this.$info_text.hide();\n        }\n    },\n\n    /** File name */\n    _refreshFileName: function() {\n        this.$file_name.html(this.model.get(\"file_name\") || \"-\");\n    },\n\n    /** File size */\n    _refreshFileSize: function() {\n        this.$file_size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Show/hide ftp popup */\n    _showFtp: function() {\n        if (!this.ftp.visible) {\n            var self = this;\n            this.ftp.empty();\n            this.ftp.append(\n                new UploadFtp({\n                    ftp_upload_site: this.app.ftp_upload_site,\n                    onchange: function(ftp_file) {\n                        self.ftp.hide();\n                        if (self.model.get(\"status\") != \"running\" && ftp_file) {\n                            self.model.reset({\n                                file_mode: \"ftp\",\n                                file_name: ftp_file.path,\n                                file_size: ftp_file.size,\n                                file_path: ftp_file.path\n                            });\n                            self._refreshReady();\n                        }\n                    }\n                }).$el\n            );\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Show/hide settings popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<tr class=\"upload-row\">' +\n            \"<td>\" +\n            '<div class=\"upload-source\"/>' +\n            '<div class=\"upload-text-column\">' +\n            '<div class=\"upload-text\">' +\n            '<div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div>' +\n            '<textarea class=\"upload-text-content form-control\"/>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-status\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-desc upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-name upload-title\"/>' +\n            \"</td>\" +\n            \"<td>\" +\n            '<div class=\"upload-file-size upload-size\"/>' +\n            \"</td>\" +\n            '<td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td>' +\n            \"<td>\" +\n            '<div class=\"upload-info\">' +\n            '<div class=\"upload-info-text\"/>' +\n            '<div class=\"upload-info-progress progress\">' +\n            '<div class=\"upload-progress-bar progress-bar progress-bar-success\"/>' +\n            '<div class=\"upload-percentage\">0%</div>' +\n            \"</div>\" +\n            \"</div>\" +\n            \"</td>\" +\n            \"</tr>\"\n        );\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/composite/composite-row.js","/** Renders contents of the collection uploader */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadRow from \"mvc/upload/collection/collection-row\";\nimport UploadFtp from \"mvc/upload/upload-ftp\";\nimport UploadExtension from \"mvc/upload/upload-extension\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport LIST_COLLECTION_CREATOR from \"mvc/collection/list-collection-creator\";\nimport \"utils/uploadbox\";\nexport default Backbone.View.extend({\n    // current upload size in bytes\n    upload_size: 0,\n\n    // contains upload row models\n    collection: new UploadModel.Collection(),\n\n    // keeps track of the current uploader state\n    counter: {\n        announce: 0,\n        success: 0,\n        error: 0,\n        running: 0,\n        reset: function() {\n            this.announce = this.success = this.error = this.running = 0;\n        }\n    },\n\n    initialize: function(app) {\n        var self = this;\n        this.app = app;\n        this.options = app.options;\n        this.list_extensions = app.list_extensions;\n        this.list_genomes = app.list_genomes;\n        this.ui_button = app.ui_button;\n        this.ftp_upload_site = app.currentFtp();\n        this.setElement(this._template());\n\n        // append buttons to dom\n        this.btnLocal = new Ui.Button({\n            id: \"btn-local\",\n            title: \"Choose local files\",\n            onclick: function() {\n                self.uploadbox.select();\n            },\n            icon: \"fa fa-laptop\"\n        });\n        this.btnFtp = new Ui.Button({\n            id: \"btn-ftp\",\n            title: \"Choose FTP files\",\n            onclick: function() {\n                self._eventFtp();\n            },\n            icon: \"fa fa-folder-open-o\"\n        });\n        this.btnCreate = new Ui.Button({\n            id: \"btn-new\",\n            title: \"Paste/Fetch data\",\n            onclick: function() {\n                self._eventCreate();\n            },\n            icon: \"fa fa-edit\"\n        });\n        this.btnStart = new Ui.Button({\n            id: \"btn-start\",\n            title: \"Start\",\n            onclick: function() {\n                self._eventStart();\n            }\n        });\n        this.btnBuild = new Ui.Button({\n            id: \"btn-build\",\n            title: \"Build\",\n            onclick: function() {\n                self._eventBuild();\n            }\n        });\n        this.btnStop = new Ui.Button({\n            id: \"btn-stop\",\n            title: \"Pause\",\n            onclick: function() {\n                self._eventStop();\n            }\n        });\n        this.btnReset = new Ui.Button({\n            id: \"btn-reset\",\n            title: \"Reset\",\n            onclick: function() {\n                self._eventReset();\n            }\n        });\n        this.btnClose = new Ui.Button({\n            id: \"btn-close\",\n            title: \"Close\",\n            onclick: function() {\n                self.app.modal.hide();\n            }\n        });\n        _.each(\n            [\n                this.btnLocal,\n                this.btnFtp,\n                this.btnCreate,\n                this.btnStop,\n                this.btnReset,\n                this.btnStart,\n                this.btnBuild,\n                this.btnClose\n            ],\n            button => {\n                self.$(\".upload-buttons\").prepend(button.$el);\n            }\n        );\n\n        // file upload\n        this.uploadbox = this.$(\".upload-box\").uploadbox({\n            url: this.app.options.nginx_upload_path,\n            announce: function(index, file) {\n                self._eventAnnounce(index, file);\n            },\n            initialize: function(index) {\n                return self.app.toData([self.collection.get(index)], self.history_id);\n            },\n            progress: function(index, percentage) {\n                self._eventProgress(index, percentage);\n            },\n            success: function(index, message) {\n                self._eventSuccess(index, message);\n            },\n            error: function(index, message) {\n                self._eventError(index, message);\n            },\n            complete: function() {\n                self._eventComplete();\n            },\n            ondragover: function() {\n                self.$(\".upload-box\").addClass(\"highlight\");\n            },\n            ondragleave: function() {\n                self.$(\".upload-box\").removeClass(\"highlight\");\n            }\n        });\n\n        // add ftp file viewer\n        this.ftp = new Popover.View({\n            title: \"FTP files\",\n            container: this.btnFtp.$el\n        });\n\n        // select extension\n        this.select_extension = new Select.View({\n            css: \"upload-footer-selection-compressed\",\n            container: this.$(\".upload-footer-extension\"),\n            data: _.filter(this.list_extensions, ext => !ext.composite_files),\n            value: this.options.default_extension,\n            onchange: function(extension) {\n                self.updateExtension(extension);\n            }\n        });\n\n        this.collectionType = \"list\";\n        this.select_collection = new Select.View({\n            css: \"upload-footer-selection-compressed\",\n            container: this.$(\".upload-footer-collection-type\"),\n            data: [\n                { id: \"list\", text: \"List\" },\n                { id: \"paired\", text: \"Paired\" },\n                { id: \"list:paired\", text: \"List of Pairs\" }\n            ],\n            value: \"list\",\n            onchange: function(collectionType) {\n                self.updateCollectionType(collectionType);\n            }\n        });\n\n        // handle extension info popover\n        this.$(\".upload-footer-extension-info\")\n            .on(\"click\", e => {\n                new UploadExtension({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value(),\n                    list: self.list_extensions,\n                    placement: \"top\"\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // genome extension\n        this.select_genome = new Select.View({\n            css: \"upload-footer-selection\",\n            container: this.$(\".upload-footer-genome\"),\n            data: this.list_genomes,\n            value: this.options.default_genome,\n            onchange: function(genome) {\n                self.updateGenome(genome);\n            }\n        });\n\n        // events\n        this.collection.on(\"remove\", model => {\n            self._eventRemove(model);\n        });\n        this._updateScreen();\n    },\n\n    /** A new file has been dropped/selected through the uploadbox plugin */\n    _eventAnnounce: function(index, file) {\n        this.counter.announce++;\n        var new_model = new UploadModel.Model({\n            id: index,\n            file_name: file.name,\n            file_size: file.size,\n            file_mode: file.mode || \"local\",\n            file_path: file.path,\n            file_data: file,\n            extension: this.select_extension.value(),\n            genome: this.select_genome.value()\n        });\n        this.collection.add(new_model);\n        var upload_row = new UploadRow(this, { model: new_model });\n        this.$(\".upload-table > tbody:first\").append(upload_row.$el);\n        this._updateScreen();\n        upload_row.render();\n    },\n\n    /** Progress */\n    _eventProgress: function(index, percentage) {\n        var it = this.collection.get(index);\n        it.set(\"percentage\", percentage);\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(percentage, it.get(\"file_size\")));\n    },\n\n    /** Success */\n    _eventSuccess: function(index, message) {\n        // var hdaId = message[\"outputs\"][0][\"id\"];\n        var hids = _.pluck(message[\"outputs\"], \"hid\");\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"success\", hids: hids });\n        this.ui_button.model.set(\"percentage\", this._uploadPercentage(100, it.get(\"file_size\")));\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.success++;\n        this._updateScreen();\n        Galaxy.currHistoryPanel.refreshContents();\n    },\n\n    /** Error */\n    _eventError: function(index, message) {\n        var it = this.collection.get(index);\n        it.set({ percentage: 100, status: \"error\", info: message });\n        this.ui_button.model.set({\n            percentage: this._uploadPercentage(100, it.get(\"file_size\")),\n            status: \"danger\"\n        });\n        this.upload_completed += it.get(\"file_size\") * 100;\n        this.counter.announce--;\n        this.counter.error++;\n        this._updateScreen();\n    },\n\n    /** Queue is done */\n    _eventComplete: function() {\n        this.collection.each(model => {\n            model.get(\"status\") == \"queued\" && model.set(\"status\", \"init\");\n        });\n        this.counter.running = 0;\n        this._updateScreen();\n    },\n\n    _eventBuild: function() {\n        var allHids = [];\n        _.forEach(this.collection.models, upload => {\n            allHids.push.apply(allHids, upload.get(\"hids\"));\n        });\n        var models = _.map(allHids, hid => Galaxy.currHistoryPanel.collection.getByHid(hid));\n        var selection = new Galaxy.currHistoryPanel.collection.constructor(models);\n        // I'm building the selection wrong because I need to set this historyId directly.\n        selection.historyId = Galaxy.currHistoryPanel.collection.historyId;\n        Galaxy.currHistoryPanel.buildCollection(this.collectionType, selection, true);\n        this.counter.running = 0;\n        this._updateScreen();\n        this._eventReset();\n        this.app.modal.hide();\n    },\n\n    /** Remove model from upload list */\n    _eventRemove: function(model) {\n        var status = model.get(\"status\");\n        if (status == \"success\") {\n            this.counter.success--;\n        } else if (status == \"error\") {\n            this.counter.error--;\n        } else {\n            this.counter.announce--;\n        }\n        this.uploadbox.remove(model.id);\n        this._updateScreen();\n    },\n\n    //\n    // events triggered by this view\n    //\n\n    /** Show/hide ftp popup */\n    _eventFtp: function() {\n        if (!this.ftp.visible) {\n            this.ftp.empty();\n            var self = this;\n            this.ftp.append(\n                new UploadFtp({\n                    collection: this.collection,\n                    ftp_upload_site: this.ftp_upload_site,\n                    onadd: function(ftp_file) {\n                        return self.uploadbox.add([\n                            {\n                                mode: \"ftp\",\n                                name: ftp_file.path,\n                                size: ftp_file.size,\n                                path: ftp_file.path\n                            }\n                        ]);\n                    },\n                    onremove: function(model_index) {\n                        self.collection.remove(model_index);\n                    }\n                }).$el\n            );\n            this.ftp.show();\n        } else {\n            this.ftp.hide();\n        }\n    },\n\n    /** Create a new file */\n    _eventCreate: function() {\n        this.uploadbox.add([{ name: \"New File\", size: 0, mode: \"new\" }]);\n    },\n\n    /** Start upload process */\n    _eventStart: function() {\n        if (this.counter.announce == 0 || this.counter.running > 0) {\n            return;\n        }\n        var self = this;\n        this.upload_size = 0;\n        this.upload_completed = 0;\n        this.collection.each(model => {\n            if (model.get(\"status\") == \"init\") {\n                model.set(\"status\", \"queued\");\n                self.upload_size += model.get(\"file_size\");\n            }\n        });\n        this.ui_button.model.set({ percentage: 0, status: \"success\" });\n        this.counter.running = this.counter.announce;\n        this.history_id = this.app.currentHistory();\n        this.uploadbox.start();\n        this._updateScreen();\n    },\n\n    /** Pause upload process */\n    _eventStop: function() {\n        if (this.counter.running > 0) {\n            this.ui_button.model.set(\"status\", \"info\");\n            $(\".upload-top-info\").html(\"Queue will pause after completing the current file...\");\n            this.uploadbox.stop();\n        }\n    },\n\n    /** Remove all */\n    _eventReset: function() {\n        if (this.counter.running == 0) {\n            this.collection.reset();\n            this.counter.reset();\n            this.uploadbox.reset();\n            this.select_extension.value(this.options.default_extension);\n            this.select_genome.value(this.options.default_genome);\n            this.ui_button.model.set(\"percentage\", 0);\n            this._updateScreen();\n        }\n    },\n\n    /** Update extension for all models */\n    updateExtension: function(extension, defaults_only) {\n        var self = this;\n        this.collection.each(model => {\n            if (\n                model.get(\"status\") == \"init\" &&\n                (model.get(\"extension\") == self.options.default_extension || !defaults_only)\n            ) {\n                model.set(\"extension\", extension);\n            }\n        });\n    },\n\n    /** Update collection type */\n    updateCollectionType: function(collectionType) {\n        var self = this;\n        this.collectionType = collectionType;\n    },\n\n    /** Update genome for all models */\n    updateGenome: function(genome, defaults_only) {\n        var self = this;\n        this.collection.each(model => {\n            if (\n                model.get(\"status\") == \"init\" &&\n                (model.get(\"genome\") == self.options.default_genome || !defaults_only)\n            ) {\n                model.set(\"genome\", genome);\n            }\n        });\n    },\n\n    /** Set screen */\n    _updateScreen: function() {\n        var message = \"\";\n        if (this.counter.announce == 0) {\n            if (this.uploadbox.compatible()) {\n                message = \"&nbsp;\";\n            } else {\n                message =\n                    \"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.\";\n            }\n        } else {\n            if (this.counter.running == 0) {\n                message = `You added ${\n                    this.counter.announce\n                } file(s) to the queue. Add more files or click 'Start' to proceed.`;\n            } else {\n                message = `Please wait...${this.counter.announce} out of ${this.counter.running} remaining.`;\n            }\n        }\n        this.$(\".upload-top-info\").html(message);\n        var enable_reset =\n            this.counter.running == 0 && this.counter.announce + this.counter.success + this.counter.error > 0;\n        var enable_start = this.counter.running == 0 && this.counter.announce > 0;\n        var enable_build =\n            this.counter.running == 0 &&\n            this.counter.announce == 0 &&\n            this.counter.success > 0 &&\n            this.counter.error == 0;\n        var enable_sources = this.counter.running == 0;\n        var show_table = this.counter.announce + this.counter.success + this.counter.error > 0;\n        this.btnReset[enable_reset ? \"enable\" : \"disable\"]();\n        this.btnStart[enable_start ? \"enable\" : \"disable\"]();\n        this.btnStart.$el[enable_start ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnBuild[enable_build ? \"enable\" : \"disable\"]();\n        this.btnBuild.$el[enable_build ? \"addClass\" : \"removeClass\"](\"btn-primary\");\n        this.btnStop[this.counter.running > 0 ? \"enable\" : \"disable\"]();\n        this.btnLocal[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnCreate[enable_sources ? \"enable\" : \"disable\"]();\n        this.btnFtp.$el[this.ftp_upload_site ? \"show\" : \"hide\"]();\n        this.$(\".upload-table\")[show_table ? \"show\" : \"hide\"]();\n        this.$(\".upload-helper\")[show_table ? \"hide\" : \"show\"]();\n    },\n\n    /** Calculate percentage of all queued uploads */\n    _uploadPercentage: function(percentage, size) {\n        return (this.upload_completed + percentage * size) / this.upload_size;\n    },\n\n    /** Template */\n    _template: function() {\n        return (\n            '<div class=\"upload-view-default\">' +\n            '<div class=\"upload-top\">' +\n            '<h6 class=\"upload-top-info\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-box\">' +\n            '<div class=\"upload-helper\"><i class=\"fa fa-files-o\"/>Drop files here</div>' +\n            '<table class=\"upload-table ui-table-striped\" style=\"display: none;\">' +\n            \"<thead>\" +\n            \"<tr>\" +\n            \"<th>Name</th>\" +\n            \"<th>Size</th>\" +\n            \"<th>Status</th>\" +\n            \"<th/>\" +\n            \"</tr>\" +\n            \"</thead>\" +\n            \"<tbody/>\" +\n            \"</table>\" +\n            \"</div>\" +\n            '<div class=\"upload-footer\">' +\n            '<span class=\"upload-footer-title-compressed\">Collection Type:</span>' +\n            '<span class=\"upload-footer-collection-type\"/>' +\n            '<span class=\"upload-footer-title-compressed\">File Type:</span>' +\n            '<span class=\"upload-footer-extension\"/>' +\n            '<span class=\"upload-footer-extension-info upload-icon-button fa fa-search\"/> ' +\n            '<span class=\"upload-footer-title-compressed\">Genome (set all):</span>' +\n            '<span class=\"upload-footer-genome\"/>' +\n            \"</div>\" +\n            '<div class=\"upload-buttons\"/>' +\n            \"</div>\"\n        );\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/collection/collection-view.js","/** Renders the collection uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title-extended\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: \"Upload configuration\",\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // handle click event\n        this.$symbol.on(\"click\", () => {\n            self._removeRow();\n        });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n        this.listenTo(this.model, \"remove\", () => {\n            self.remove();\n        });\n        this.app.collection.on(\"reset\", () => {\n            self.remove();\n        });\n    },\n\n    render: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: `${percentage}%` });\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return `<tr id=\"upload-row-${\n            options.id\n        }\" class=\"upload-row\"><td><div class=\"upload-text-column\"><div class=\"upload-mode\"/><div class=\"upload-title-extended\"/><div class=\"upload-text\"><div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\"upload-text-content form-control\"/></div></div></td><td><div class=\"upload-size\"/></td><td><div class=\"upload-info\"><div class=\"upload-info-text\"/><div class=\"upload-info-progress progress\"><div class=\"upload-progress-bar progress-bar progress-bar-success\"/><div class=\"upload-percentage\">0%</div></div></div></td><td><div class=\"upload-symbol ${\n            this.status_classes.init\n        }\"/></td></tr>`;\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/upload/collection/collection-row.js","import Ui from \"mvc/ui/ui-misc\";\nimport historyOptionsMenu from \"mvc/history/options-menu\";\nimport CurrentHistoryView from \"mvc/history/history-view-edit-current\";\nimport _l from \"utils/localization\";\n\n/** the right hand panel in the analysis page that shows the current history */\nvar HistoryPanel = Backbone.View.extend({\n    initialize: function(page, options) {\n        var self = this;\n        this.userIsAnonymous = Galaxy.user.isAnonymous();\n        this.allow_user_dataset_purge = options.config.allow_user_dataset_purge;\n        this.root = options.root;\n\n        // view of the current history\n        this.historyView = new CurrentHistoryView.CurrentHistoryView({\n            className: `${CurrentHistoryView.CurrentHistoryView.prototype.className} middle`,\n            purgeAllowed: this.allow_user_dataset_purge,\n            linkTarget: \"galaxy_main\"\n        });\n\n        // add history panel to Galaxy object\n        Galaxy.currHistoryPanel = this.historyView;\n        Galaxy.currHistoryPanel.listenToGalaxy(Galaxy);\n\n        // build buttons\n        this.buttonRefresh = new Ui.ButtonLink({\n            id: \"history-refresh-button\",\n            title: \"Refresh history\",\n            cls: \"panel-header-button\",\n            icon: \"fa fa-refresh\",\n            onclick: function() {\n                self.historyView.loadCurrentHistory();\n            }\n        });\n        this.buttonOptions = new Ui.ButtonLink({\n            id: \"history-options-button\",\n            title: \"History options\",\n            cls: \"panel-header-button\",\n            target: \"galaxy_main\",\n            icon: \"fa fa-cog\",\n            href: `${this.root}root/history_options`\n        });\n        this.buttonViewMulti = new Ui.ButtonLink({\n            id: \"history-view-multi-button\",\n            title: \"View all histories\",\n            cls: \"panel-header-button\",\n            icon: \"fa fa-columns\",\n            href: `${this.root}history/view_multiple`\n        });\n\n        // define components\n        this.model = new Backbone.Model({\n            cls: \"history-right-panel\",\n            title: _l(\"History\"),\n            buttons: [this.buttonRefresh, this.buttonOptions, this.buttonViewMulti]\n        });\n\n        // build body template and connect history view\n        this.setElement(this._template());\n        this.historyView.setElement(this.$el);\n        this.historyView.connectToQuotaMeter(Galaxy.quotaMeter);\n        this.historyView.loadCurrentHistory();\n\n        // fetch to update the quota meter adding 'current' for any anon-user's id\n        Galaxy.listenTo(this.historyView, \"history-size-change\", () => {\n            Galaxy.user.fetch({\n                url: `${Galaxy.user.urlRoot()}/${Galaxy.user.id || \"current\"}`\n            });\n        });\n    },\n\n    render: function() {\n        this.optionsMenu = historyOptionsMenu(this.buttonOptions.$el, {\n            anonymous: this.userIsAnonymous,\n            purgeAllowed: this.allow_user_dataset_purge,\n            root: this.root\n        });\n        this.buttonViewMulti.$el[!this.userIsAnonymous ? \"show\" : \"hide\"]();\n    },\n\n    /** add history view div */\n    _template: function(data) {\n        return ['<div id=\"current-history-panel\" class=\"history-panel middle\"/>'].join(\"\");\n    },\n\n    toString: function() {\n        return \"historyPanel\";\n    }\n});\n\nexport default HistoryPanel;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/apps/panels/history-panel.js","import PopupMenu from \"mvc/ui/popup-menu\";\nimport historyCopyDialog from \"mvc/history/copy-dialog\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport Webhooks from \"mvc/webhooks\";\n\n// ============================================================================\nvar menu = [\n    {\n        html: _l(\"History Lists\"),\n        header: true\n    },\n    {\n        html: _l(\"Saved Histories\"),\n        href: \"histories/list\",\n        target: \"_top\"\n    },\n    {\n        html: _l(\"Histories Shared with Me\"),\n        href: \"histories/list_shared\",\n        target: \"_top\"\n    },\n    {\n        html: _l(\"Current History\"),\n        header: true,\n        anon: true\n    },\n    {\n        html: _l(\"Create New\"),\n        func: function() {\n            if (Galaxy && Galaxy.currHistoryPanel) {\n                Galaxy.currHistoryPanel.createNewHistory();\n            }\n        }\n    },\n    {\n        html: _l(\"Copy History\"),\n        func: function() {\n            historyCopyDialog(Galaxy.currHistoryPanel.model).done(() => {\n                Galaxy.currHistoryPanel.loadCurrentHistory();\n            });\n        }\n    },\n    {\n        html: _l(\"Share or Publish\"),\n        href: \"history/sharing\"\n    },\n    {\n        html: _l(\"Show Structure\"),\n        href: \"history/display_structured\",\n        anon: true\n    },\n    {\n        html: _l(\"Extract Workflow\"),\n        href: \"workflow/build_from_current_history\"\n    },\n    {\n        html: _l(\"Delete\"),\n        anon: true,\n        func: function() {\n            if (Galaxy && Galaxy.currHistoryPanel && confirm(_l(\"Really delete the current history?\"))) {\n                Galaxy.currHistoryPanel.model._delete().done(() => {\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                });\n            }\n        }\n    },\n    {\n        html: _l(\"Delete Permanently\"),\n        purge: true,\n        anon: true,\n        func: function() {\n            if (\n                Galaxy &&\n                Galaxy.currHistoryPanel &&\n                confirm(_l(\"Really delete the current history permanently? This cannot be undone.\"))\n            ) {\n                Galaxy.currHistoryPanel.model.purge().done(() => {\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                });\n            }\n        }\n    },\n\n    {\n        html: _l(\"Dataset Actions\"),\n        header: true,\n        anon: true\n    },\n    {\n        html: _l(\"Copy Datasets\"),\n        href: \"dataset/copy_datasets\"\n    },\n    {\n        html: _l(\"Dataset Security\"),\n        func: function() {\n            if (Galaxy && Galaxy.currHistoryPanel && Galaxy.router) {\n                Galaxy.router.push(`/histories/permissions?id=${Galaxy.currHistoryPanel.model.id}`);\n            }\n        }\n    },\n    {\n        html: _l(\"Resume Paused Jobs\"),\n        href: \"history/resume_paused_jobs?current=True\",\n        anon: true\n    },\n    {\n        html: _l(\"Collapse Expanded Datasets\"),\n        func: function() {\n            if (Galaxy && Galaxy.currHistoryPanel) {\n                Galaxy.currHistoryPanel.collapseAll();\n            }\n        }\n    },\n    {\n        html: _l(\"Unhide Hidden Datasets\"),\n        anon: true,\n        func: function() {\n            // TODO: Deprecate this functionality and replace with group dataset selector and action combination\n            if (Galaxy && Galaxy.currHistoryPanel && confirm(_l(\"Really unhide all hidden datasets?\"))) {\n                $.post(`${Galaxy.root}history/adjust_hidden`, { user_action: \"unhide\" }, () => {\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                });\n            }\n        }\n    },\n    {\n        html: _l(\"Delete Hidden Datasets\"),\n        anon: true,\n        func: function() {\n            // TODO: Deprecate this functionality and replace with group dataset selector and action combination\n            if (Galaxy && Galaxy.currHistoryPanel && confirm(_l(\"Really delete all hidden datasets?\"))) {\n                $.post(`${Galaxy.root}history/adjust_hidden`, { user_action: \"delete\" }, () => {\n                    Galaxy.currHistoryPanel.loadCurrentHistory();\n                });\n            }\n        }\n    },\n    {\n        html: _l(\"Purge Deleted Datasets\"),\n        confirm: _l(\"Really delete all deleted datasets permanently? This cannot be undone.\"),\n        href: \"history/purge_deleted_datasets\",\n        purge: true,\n        anon: true\n    },\n\n    {\n        html: _l(\"Downloads\"),\n        header: true\n    },\n    {\n        html: _l(\"Export Tool Citations\"),\n        anon: true,\n        func: function() {\n            if (Galaxy && Galaxy.currHistoryPanel && Galaxy.router) {\n                Galaxy.router.push(`/histories/citations?id=${Galaxy.currHistoryPanel.model.id}`);\n            }\n        }\n    },\n    {\n        html: _l(\"Export History to File\"),\n        href: \"history/export_archive?preview=True\",\n        anon: true\n    },\n\n    {\n        html: _l(\"Other Actions\"),\n        header: true\n    },\n    {\n        html: _l(\"Import from File\"),\n        href: \"history/import_archive\"\n    }\n];\n\n// Webhooks\nWebhooks.add({\n    url: \"api/webhooks/history-menu/all\",\n    async: false, // (hypothetically) slows down the performance\n    callback: function(webhooks) {\n        var webhooks_menu = [];\n\n        $.each(webhooks.models, (index, model) => {\n            var webhook = model.toJSON();\n            if (webhook.activate) {\n                webhooks_menu.push({\n                    html: _l(webhook.config.title),\n                    // func: function() {},\n                    anon: true\n                });\n            }\n        });\n\n        if (webhooks_menu.length > 0) {\n            webhooks_menu.unshift({\n                html: _l(\"Webhooks\"),\n                header: true\n            });\n            $.merge(menu, webhooks_menu);\n        }\n    }\n});\n\nfunction buildMenu(isAnon, purgeAllowed, urlRoot) {\n    return _.clone(menu).filter(menuOption => {\n        if (isAnon && !menuOption.anon) {\n            return false;\n        }\n        if (!purgeAllowed && menuOption.purge) {\n            return false;\n        }\n\n        //TODO:?? hard-coded galaxy_main\n        if (menuOption.href) {\n            menuOption.href = urlRoot + menuOption.href;\n            menuOption.target = menuOption.target || \"galaxy_main\";\n        }\n\n        if (menuOption.confirm) {\n            menuOption.func = () => {\n                if (confirm(menuOption.confirm)) {\n                    galaxy_main.location = menuOption.href;\n                }\n            };\n        }\n        return true;\n    });\n}\n\nvar create = ($button, options) => {\n    options = options || {};\n    var isAnon = options.anonymous === undefined ? true : options.anonymous;\n    var purgeAllowed = options.purgeAllowed || false;\n    var menu = buildMenu(isAnon, purgeAllowed, Galaxy.root);\n    //console.debug( 'menu:', menu );\n    return new PopupMenu($button, menu);\n};\n\n// ============================================================================\nexport default create;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/options-menu.js","import HISTORY_MODEL from \"mvc/history/history-model\";\nimport HISTORY_VIEW_EDIT from \"mvc/history/history-view-edit\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n// ============================================================================\n/** session storage for history panel preferences (and to maintain state)\n */\nvar HistoryViewPrefs = BASE_MVC.SessionStorageModel.extend(\n    /** @lends HistoryViewPrefs.prototype */ {\n        defaults: {\n            /** should the tags editor be shown or hidden initially? */\n            tagsEditorShown: false,\n            /** should the annotation editor be shown or hidden initially? */\n            annotationEditorShown: false,\n            ///** what is the currently focused content (dataset or collection) in the current history?\n            // *      (the history panel will highlight and scroll to the focused content view)\n            // */\n            //focusedContentId : null\n            /** Current scroll position */\n            scrollPosition: 0\n        },\n        toString: function() {\n            return `HistoryViewPrefs(${JSON.stringify(this.toJSON())})`;\n        }\n    }\n);\n\n/** key string to store panel prefs (made accessible on class so you can access sessionStorage directly) */\nHistoryViewPrefs.storageKey = function storageKey() {\n    return \"history-panel\";\n};\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW_EDIT.HistoryViewEdit;\n// used in root/index.mako\n/** @class View/Controller for the user's current history model as used in the history\n *      panel (current right hand panel) of the analysis page.\n *\n *  The only history panel that:\n *      will poll for updates.\n *      displays datasets in reverse hid order.\n */\nvar CurrentHistoryView = _super.extend(\n    /** @lends CurrentHistoryView.prototype */ {\n        className: `${_super.prototype.className} current-history-panel`,\n\n        /** override to use drilldown (and not foldout) for how collections are displayed */\n        HDCAViewClass: _super.prototype.HDCAViewClass.extend({\n            foldoutStyle: \"drilldown\"\n        }),\n\n        emptyMsg: [\n            _l(\"This history is empty\"),\n            \". \",\n            _l(\"You can \"),\n            '<a class=\"uploader-link\" href=\"javascript:void(0)\">',\n            _l(\"load your own data\"),\n            \"</a>\",\n            _l(\" or \"),\n            '<a class=\"get-data-link\" href=\"javascript:void(0)\">',\n            _l(\"get data from an external source\"),\n            \"</a>\"\n        ].join(\"\"),\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events */\n        initialize: function(attributes) {\n            attributes = attributes || {};\n\n            // ---- persistent preferences\n            /** maintain state / preferences over page loads */\n            this.preferences = new HistoryViewPrefs(\n                _.extend(\n                    {\n                        id: HistoryViewPrefs.storageKey()\n                    },\n                    _.pick(attributes, _.keys(HistoryViewPrefs.prototype.defaults))\n                )\n            );\n\n            _super.prototype.initialize.call(this, attributes);\n\n            /** sub-views that will overlay this panel (collections) */\n            this.panelStack = [];\n\n            /** id of currently focused content */\n            this.currentContentId = attributes.currentContentId || null;\n            //NOTE: purposely not sent to localstorage since panel recreation roughly lines up with a reset of this value\n        },\n\n        /** Override to cache the current scroll position with a listener */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n\n            var panel = this;\n            // reset scroll position when there's a new history\n            this.on(\"new-model\", () => {\n                panel.preferences.set(\"scrollPosition\", 0);\n            });\n        },\n\n        // ------------------------------------------------------------------------ loading history/item models\n        // TODO: next three more appropriate moved to the app level\n        /** (re-)loads the user's current history & contents w/ details */\n        loadCurrentHistory: function() {\n            return this.loadHistory(null, {\n                url: `${Galaxy.root}history/current_history_json`\n            });\n        },\n\n        /** loads a history & contents w/ details and makes them the current history */\n        switchToHistory: function(historyId, attributes) {\n            if (Galaxy.user.isAnonymous()) {\n                this.trigger(\"error\", _l(\"You must be logged in to switch histories\"), _l(\"Anonymous user\"));\n                return $.when();\n            }\n            return this.loadHistory(historyId, {\n                url: `${Galaxy.root}history/set_as_current?id=${historyId}`\n            });\n        },\n\n        /** creates a new history on the server and sets it as the user's current history */\n        createNewHistory: function(attributes) {\n            if (Galaxy.user.isAnonymous()) {\n                this.trigger(\"error\", _l(\"You must be logged in to create histories\"), _l(\"Anonymous user\"));\n                return $.when();\n            }\n            return this.loadHistory(null, {\n                url: `${Galaxy.root}history/create_new_current`\n            });\n        },\n\n        /** release/free/shutdown old models and set up panel for new models */\n        setModel: function(model, attributes, render) {\n            _super.prototype.setModel.call(this, model, attributes, render);\n            if (this.model && this.model.id) {\n                this.log(\"checking for updates\");\n                this.model.checkForUpdates();\n            }\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ history/content event listening\n        /** listening for history events */\n        _setUpModelListeners: function() {\n            _super.prototype._setUpModelListeners.call(this);\n            // re-broadcast any model change events so that listeners don't have to re-bind to each history\n            return this.listenTo(this.model, {\n                \"change:nice_size change:size\": function() {\n                    this.trigger(\"history-size-change\", this, this.model, arguments);\n                },\n                \"change:id\": function() {\n                    this.once(\"loading-done\", function() {\n                        this.model.checkForUpdates();\n                    });\n                }\n            });\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            // if a hidden item is created (gen. by a workflow), moves thru the updater to the ready state,\n            //  then: remove it from the collection if the panel is set to NOT show hidden datasets\n            this.listenTo(this.collection, \"state:ready\", function(model, newState, oldState) {\n                if (!model.get(\"visible\") && !this.collection.storage.includeHidden()) {\n                    this.removeItemView(model);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** override to add a handler to capture the scroll position when the parent scrolls */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            // console.log( '_setUpBehaviors', this.$scrollContainer( $where ).get(0), this.$list( $where ) );\n            // we need to call this in _setUpBehaviors which is called after render since the $el\n            // may not be attached to $el.parent and $scrollContainer() may not work\n            var panel = this;\n            _super.prototype._setUpBehaviors.call(panel, $where);\n\n            // cache the handler to remove and re-add so we don't pile up the handlers\n            if (!this._debouncedScrollCaptureHandler) {\n                this._debouncedScrollCaptureHandler = _.debounce(function scrollCapture() {\n                    // cache the scroll position (only if visible)\n                    if (panel.$el.is(\":visible\")) {\n                        panel.preferences.set(\"scrollPosition\", $(this).scrollTop());\n                    }\n                }, 40);\n            }\n\n            panel\n                .$scrollContainer($where)\n                .off(\"scroll\", this._debouncedScrollCaptureHandler)\n                .on(\"scroll\", this._debouncedScrollCaptureHandler);\n            return panel;\n        },\n\n        /** In this override, handle null models and move the search input to the top */\n        _buildNewRender: function() {\n            if (!this.model) {\n                return $();\n            }\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            $newRender.find(\".search\").prependTo($newRender.find(\"> .controls\"));\n            this._renderQuotaMessage($newRender);\n            return $newRender;\n        },\n\n        /** render the message displayed when a user is over quota and can't run jobs */\n        _renderQuotaMessage: function($whereTo) {\n            $whereTo = $whereTo || this.$el;\n            return $(this.templates.quotaMsg({}, this)).prependTo($whereTo.find(\".messages\"));\n        },\n\n        /** In this override, get and set current panel preferences when editor is used */\n        _renderTags: function($where) {\n            var panel = this;\n            // render tags and show/hide based on preferences\n            _super.prototype._renderTags.call(panel, $where);\n            if (panel.preferences.get(\"tagsEditorShown\")) {\n                panel.tagsEditor.toggle(true);\n            }\n            // store preference when shown or hidden\n            panel.listenTo(panel.tagsEditor, \"hiddenUntilActivated:shown hiddenUntilActivated:hidden\", tagsEditor => {\n                panel.preferences.set(\"tagsEditorShown\", tagsEditor.hidden);\n            });\n        },\n\n        /** In this override, get and set current panel preferences when editor is used */\n        _renderAnnotation: function($where) {\n            var panel = this;\n            // render annotation and show/hide based on preferences\n            _super.prototype._renderAnnotation.call(panel, $where);\n            if (panel.preferences.get(\"annotationEditorShown\")) {\n                panel.annotationEditor.toggle(true);\n            }\n            // store preference when shown or hidden\n            panel.listenTo(\n                panel.annotationEditor,\n                \"hiddenUntilActivated:shown hiddenUntilActivated:hidden\",\n                annotationEditor => {\n                    panel.preferences.set(\"annotationEditorShown\", annotationEditor.hidden);\n                }\n            );\n        },\n\n        /** Override to scroll to cached position (in prefs) after swapping */\n        _swapNewRender: function($newRender) {\n            _super.prototype._swapNewRender.call(this, $newRender);\n            var panel = this;\n            _.delay(() => {\n                var pos = panel.preferences.get(\"scrollPosition\");\n                if (pos) {\n                    panel.scrollTo(pos, 0);\n                }\n            }, 10);\n            //TODO: is this enough of a delay on larger histories?\n\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** Override to add the current-content highlight class to currentContentId's view */\n        _attachItems: function($whereTo) {\n            _super.prototype._attachItems.call(this, $whereTo);\n            var panel = this;\n            if (panel.currentContentId) {\n                panel._setCurrentContentById(panel.currentContentId);\n            }\n            return this;\n        },\n\n        /** Override to remove any drill down panels */\n        addItemView: function(model, collection, options) {\n            var view = _super.prototype.addItemView.call(this, model, collection, options);\n            if (!view) {\n                return view;\n            }\n            if (this.panelStack.length) {\n                return this._collapseDrilldownPanel();\n            }\n            return view;\n        },\n\n        // ------------------------------------------------------------------------ collection sub-views\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n            // use pub-sub to: handle drilldown expansion and collapse\n            return panel.listenTo(view, {\n                \"expanded:drilldown\": function(v, drilldown) {\n                    this._expandDrilldownPanel(drilldown);\n                },\n                \"collapsed:drilldown\": function(v, drilldown) {\n                    this._collapseDrilldownPanel(drilldown);\n                }\n            });\n        },\n\n        /** display 'current content': add a visible highlight and store the id of a content item */\n        setCurrentContent: function(view) {\n            this.$(\".history-content.current-content\").removeClass(\"current-content\");\n            if (view) {\n                view.$el.addClass(\"current-content\");\n                this.currentContentId = view.model.id;\n            } else {\n                this.currentContentId = null;\n            }\n        },\n\n        /** find the view with the id and then call setCurrentContent on it */\n        _setCurrentContentById: function(id) {\n            var view = this.viewFromModelId(id) || null;\n            this.setCurrentContent(view);\n        },\n\n        /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n        _expandDrilldownPanel: function(drilldown) {\n            this.panelStack.push(drilldown);\n            // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n            this.$controls()\n                .add(this.$list())\n                .hide();\n            drilldown.parentName = this.model.get(\"name\");\n            drilldown\n                .delegateEvents()\n                .render()\n                .$el.appendTo(this.$el);\n        },\n\n        /** Handle drilldown close by freeing the panel and re-rendering this panel */\n        _collapseDrilldownPanel: function(drilldown) {\n            this.panelStack.pop();\n            //TODO: MEM: free the panel\n            this.$controls()\n                .add(this.$list())\n                .show();\n        },\n\n        // ........................................................................ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            // the two links in the empty message\n            \"click .uploader-link\": function(ev) {\n                Galaxy.upload.show(ev);\n            },\n            \"click .get-data-link\": function(ev) {\n                var $toolMenu = $(\".toolMenuContainer\");\n                $toolMenu.parent().scrollTop(0);\n                $toolMenu.find('span:contains(\"Get Data\")').click();\n            }\n        }),\n\n        // ........................................................................ external objects/MVC\n        listenToGalaxy: function(galaxy) {\n            this.listenTo(galaxy, {\n                // when the galaxy_main iframe is loaded with a new page,\n                // compare the url to the following list and if there's a match\n                // pull the id from url and indicate in the history view that\n                // the dataset with that id is the 'current'ly active dataset\n                \"center-frame:load\": function(data) {\n                    var pathToMatch = data.fullpath;\n                    var hdaId = null;\n                    var useToURLRegexMap = {\n                        display: /datasets\\/([a-f0-9]+)\\/display/,\n                        edit: /datasets\\/([a-f0-9]+)\\/edit/,\n                        report_error: /dataset\\/errors\\?id=([a-f0-9]+)/,\n                        rerun: /tool_runner\\/rerun\\?id=([a-f0-9]+)/,\n                        show_params: /datasets\\/([a-f0-9]+)\\/show_params/\n                        // no great way to do this here? (leave it in the dataset event handlers above?)\n                        // 'visualization' : 'visualization',\n                    };\n                    _.find(useToURLRegexMap, (regex, use) => {\n                        // grab the more specific match result (1), save, and use it as the find flag\n                        hdaId = _.result(pathToMatch.match(regex), 1);\n                        return hdaId;\n                    });\n                    // need to type mangle to go from web route to history contents\n                    this._setCurrentContentById(hdaId ? `dataset-${hdaId}` : null);\n                },\n                // when the center panel is given a new view, clear the current indicator\n                \"center-panel:load\": function(view) {\n                    this._setCurrentContentById();\n                }\n            });\n        },\n\n        //TODO: remove quota meter from panel and remove this\n        /** add listeners to an external quota meter (mvc/user/user-quotameter.js) */\n        connectToQuotaMeter: function(quotaMeter) {\n            if (!quotaMeter) {\n                return this;\n            }\n            // show/hide the 'over quota message' in the history when the meter tells it to\n            this.listenTo(quotaMeter, \"quota:over\", this.showQuotaMessage);\n            this.listenTo(quotaMeter, \"quota:under\", this.hideQuotaMessage);\n\n            // having to add this to handle re-render of hview while overquota (the above do not fire)\n            this.on(\"rendered rendered:initial\", function() {\n                if (quotaMeter && quotaMeter.isOverQuota()) {\n                    this.showQuotaMessage();\n                }\n            });\n            return this;\n        },\n\n        /** Override to preserve the quota message */\n        clearMessages: function(ev) {\n            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n            $target = $target.not(\".quota-message\");\n            $target.fadeOut(this.fxSpeed, function() {\n                $(this).remove();\n            });\n            return this;\n        },\n\n        /** Show the over quota message (which happens to be in the history panel).\n         */\n        showQuotaMessage: function() {\n            var $msg = this.$(\".quota-message\");\n            if ($msg.is(\":hidden\")) {\n                $msg.slideDown(this.fxSpeed);\n            }\n        },\n\n        /** Hide the over quota message (which happens to be in the history panel).\n         */\n        hideQuotaMessage: function() {\n            var $msg = this.$(\".quota-message\");\n            if (!$msg.is(\":hidden\")) {\n                $msg.slideUp(this.fxSpeed);\n            }\n        },\n\n        // ........................................................................ options menu\n        //TODO: remove to batch\n        /** unhide any hidden datasets */\n        unhideHidden: function() {\n            var self = this;\n            if (confirm(_l(\"Really unhide all hidden datasets?\"))) {\n                // get all hidden, regardless of deleted/purged\n                return self.model.contents\n                    ._filterAndUpdate({ visible: false, deleted: \"\", purged: \"\" }, { visible: true })\n                    .done(() => {\n                        // TODO: would be better to render these as they're unhidden instead of all at once\n                        if (!self.model.contents.includeHidden) {\n                            self.renderItems();\n                        }\n                    });\n            }\n            return jQuery.when();\n        },\n\n        /** delete any hidden datasets */\n        deleteHidden: function() {\n            var self = this;\n            if (confirm(_l(\"Really delete all hidden datasets?\"))) {\n                return self.model.contents._filterAndUpdate(\n                    // get all hidden, regardless of deleted/purged\n                    { visible: false, deleted: \"\", purged: \"\" },\n                    // both delete *and* unhide them\n                    { deleted: true, visible: true }\n                );\n            }\n            return jQuery.when();\n        },\n\n        /** Return a string rep of the history */\n        toString: function() {\n            return `CurrentHistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nCurrentHistoryView.prototype.templates = (() => {\n    var quotaMsgTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"quota-message errormessage\">',\n            _l(\"You are over your disk quota\"),\n            \". \",\n            _l(\"Tool execution is on hold until your disk usage drops below your allocated quota\"),\n            \".\",\n            \"</div>\"\n        ],\n        \"history\"\n    );\n    return _.extend(_.clone(_super.prototype.templates), {\n        quotaMsg: quotaMsgTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    CurrentHistoryView: CurrentHistoryView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-view-edit-current.js","//ASSUMES: jquery\n//=============================================================================\n/** @class AjaxQueue\n *  Class that allows queueing functions that return jQuery promises (such\n *  as ajax calls). Each function waits for the previous to complete before\n *  being called\n *\n *  @constructor accepts a list of functions and automatically begins\n *      processing them\n */\nclass AjaxQueue {\n    constructor(initialFunctions) {\n        /** the main deferred for the entire queue - note: also sends notifications of progress */\n        this.deferred = jQuery.Deferred();\n        /** the queue array of functions */\n        this.queue = [];\n        /** cache the response from each deferred call - error or success */\n        this.responses = [];\n        /** total number of fn's to process */\n        this.numToProcess = 0;\n        /** is the queue processing/waiting for any calls to return? */\n        this.running = false;\n\n        this.init(initialFunctions || []);\n        this.start();\n    }\n\n    /** add all fns in initialFunctions (if any) to the queue */\n    init(initialFunctions) {\n        initialFunctions.forEach(fn => {\n            this.add(fn);\n        });\n    }\n\n    add(fn) {\n        var index = this.queue.length;\n        this.numToProcess += 1;\n\n        this.queue.push(() => {\n            var fnIndex = index;\n            var xhr = fn();\n            // if successful, notify using the deferred to allow tracking progress\n            xhr.done(response => {\n                this.deferred.notify({\n                    curr: fnIndex,\n                    total: this.numToProcess,\n                    response: response\n                });\n            });\n            // (regardless of previous error or success) if not last ajax call, shift and call the next\n            //  if last fn, resolve deferred\n            xhr.always(response => {\n                this.responses.push(response);\n                if (this.queue.length) {\n                    this.queue.shift()();\n                } else {\n                    this.stop();\n                }\n            });\n        });\n        return this;\n    }\n\n    start() {\n        if (this.queue.length) {\n            this.running = true;\n            this.queue.shift()();\n        }\n        return this;\n    }\n\n    /** stop the queue\n     *  @param {boolean} causeFail  cause an error/fail on the main deferred\n     *  @param {String} msg         message to send when rejecting the main deferred\n     */\n    stop(causeFail, msg) {\n        //TODO: doesn't abort current call\n        this.running = false;\n        this.queue = [];\n        if (causeFail) {\n            //TODO: spliced args instead\n            this.deferred.reject(msg);\n        } else {\n            this.deferred.resolve(this.responses);\n        }\n        this.numToProcess = 0;\n        this.deferred = jQuery.Deferred();\n        return this;\n    }\n\n    // only a handful of the deferred interface for now - possible YAGNI\n    /** implement done from the jq deferred interface */\n    done(fn) {\n        return this.deferred.done(fn);\n    }\n\n    /** implement fail from the jq deferred interface */\n    fail(fn) {\n        return this.deferred.fail(fn);\n    }\n\n    /** implement always from the jq deferred interface */\n    always(fn) {\n        return this.deferred.always(fn);\n    }\n\n    /** implement progress from the jq deferred interface */\n    progress(fn) {\n        return this.deferred.progress(fn);\n    }\n\n    /** shortcut constructor / fire and forget\n     *  @returns {Deferred} the queue's main deferred\n     */\n    static create(initialFunctions) {\n        return new AjaxQueue(initialFunctions).deferred;\n    }\n}\n\n//=============================================================================\n/** @class NamedAjaxQueue\n *  @augments AjaxQueue\n *  Allows associating a name with a deferring fn and prevents adding deferring\n *  fns if the name has already been used. Useful to prevent build up of duplicate\n *  async calls.\n *  Both the array initialFunctions sent to constructor and any added later with\n *  add() should be objects (NOT functions) of the form:\n *  { name: some unique id,\n *    fn:   the deferring fn or ajax call }\n */\nclass NamedAjaxQueue extends AjaxQueue {\n    constructor(initialFunctions) {\n        super(initialFunctions);\n        this.names = {};\n    }\n\n    /** add the obj.fn to the queue if obj.name hasn't been used before */\n    add(obj) {\n        if (!(obj.hasOwnProperty(\"name\") && obj.hasOwnProperty(\"fn\"))) {\n            throw new Error(`NamedAjaxQueue.add requires an object with both \"name\" and \"fn\": ${JSON.stringify(obj)}`);\n        }\n        if (this.names.hasOwnProperty(obj.name)) {\n            //console.warn( 'name has been used:', obj.name );\n            return;\n        }\n        this.names[obj.name] = true;\n        return super.add(obj.fn);\n    }\n\n    clear() {\n        this.names = {};\n        return this;\n    }\n\n    /** shortcut constructor / fire and forget\n     *  @returns {Deferred} the queue's main deferred\n     */\n    static create(initialFunctions) {\n        return new NamedAjaxQueue(initialFunctions).deferred;\n    }\n}\n\n//=============================================================================\nexport default {\n    AjaxQueue: AjaxQueue,\n    NamedAjaxQueue: NamedAjaxQueue\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/ajax-queue.js","import HISTORY_VIEW from \"mvc/history/history-view\";\nimport HISTORY_CONTENTS from \"mvc/history/history-contents\";\nimport STATES from \"mvc/dataset/states\";\nimport HDA_MODEL from \"mvc/history/hda-model\";\nimport HDA_LI_EDIT from \"mvc/history/hda-li-edit\";\nimport HDCA_LI_EDIT from \"mvc/history/hdca-li-edit\";\nimport TAGS from \"mvc/tag\";\nimport ANNOTATIONS from \"mvc/annotation\";\nimport LIST_COLLECTION_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_COLLECTION_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport LIST_OF_PAIRS_COLLECTION_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport PopupMenu from \"mvc/ui/popup-menu\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HISTORY_VIEW.HistoryView;\n// base class for history-view-edit-current and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryView allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryViewEdit = _super.extend(\n    /** @lends HistoryViewEdit.prototype */ {\n        /** class to use for constructing the HistoryDatasetAssociation views */\n        HDAViewClass: HDA_LI_EDIT.HDAListItemEdit,\n        /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n        HDCAViewClass: HDCA_LI_EDIT.HDCAListItemEdit,\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes\n         */\n        initialize: function(attributes) {\n            attributes = attributes || {};\n            _super.prototype.initialize.call(this, attributes);\n\n            // ---- set up instance vars\n            /** editor for tags - sub-view */\n            this.tagsEditor = null;\n\n            /** enable drag and drop - sub-view */\n            this.dragItems = true;\n\n            /** editor for annotations - sub-view */\n            this.annotationEditor = null;\n\n            /** allow user purge of dataset files? */\n            this.purgeAllowed = attributes.purgeAllowed || false;\n\n            // states/modes the panel can be in\n            /** is the panel currently showing the dataset selection controls? */\n            this.annotationEditorShown = attributes.annotationEditorShown || false;\n            this.tagsEditorShown = attributes.tagsEditorShown || false;\n        },\n\n        /** Override to handle history as drag-drop target */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            return this.on({\n                \"droptarget:drop\": function(ev, data) {\n                    // process whatever was dropped and re-hide the drop target\n                    this.dataDropped(data);\n                    this.dropTargetOff();\n                },\n                \"view:attached view:removed\": function() {\n                    this._renderCounts();\n                },\n                \"search:loading-progress\": this._renderSearchProgress,\n                \"search:searching\": this._renderSearchFindings\n            });\n        },\n\n        // ------------------------------------------------------------------------ listeners\n        /** listening for history and HDA events */\n        _setUpModelListeners: function() {\n            _super.prototype._setUpModelListeners.call(this);\n            this.listenTo(this.model, \"change:size\", this.updateHistoryDiskSize);\n            return this;\n        },\n\n        /** listening for collection events */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            this.listenTo(this.collection, {\n                \"change:deleted\": this._handleItemDeletedChange,\n                \"change:visible\": this._handleItemVisibleChange,\n                \"change:purged\": function(model) {\n                    // hafta get the new nice-size w/o the purged model\n                    this.model.fetch();\n                },\n                // loading indicators for deleted/hidden\n                \"fetching-deleted\": function(collection) {\n                    this.$(\"> .controls .deleted-count\").html(`<i>${_l(\"loading...\")}</i>`);\n                },\n                \"fetching-hidden\": function(collection) {\n                    this.$(\"> .controls .hidden-count\").html(`<i>${_l(\"loading...\")}</i>`);\n                },\n                \"fetching-deleted-done fetching-hidden-done\": this._renderCounts\n            });\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n        _buildNewRender: function() {\n            // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            if (!this.model) {\n                return $newRender;\n            }\n\n            if (Galaxy && Galaxy.user && Galaxy.user.id && Galaxy.user.id === this.model.get(\"user_id\")) {\n                this._renderTags($newRender);\n                this._renderAnnotation($newRender);\n            }\n            return $newRender;\n        },\n\n        /** Update the history size display (curr. upper right of panel). */\n        updateHistoryDiskSize: function() {\n            this.$(\".history-size\").text(this.model.get(\"nice_size\"));\n        },\n\n        /** override to render counts when the items are rendered */\n        renderItems: function($whereTo) {\n            var views = _super.prototype.renderItems.call(this, $whereTo);\n            if (!this.searchFor) {\n                this._renderCounts($whereTo);\n            } else {\n                this._renderSearchFindings($whereTo);\n            }\n            return views;\n        },\n\n        /** override to show counts, what's deleted/hidden, and links to toggle those */\n        _renderCounts: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.counts(this.model.toJSON(), this);\n            return $whereTo.find(\"> .controls .subtitle\").html(html);\n        },\n\n        /** render the tags sub-view controller */\n        _renderTags: function($where) {\n            var panel = this;\n            this.tagsEditor = new TAGS.TagsEditor({\n                model: this.model,\n                el: $where.find(\".controls .tags-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // show hide sub-view tag editors when this is shown/hidden\n                onshow: function() {\n                    panel.toggleHDATagEditors(true, panel.fxSpeed);\n                },\n                onhide: function() {\n                    panel.toggleHDATagEditors(false, panel.fxSpeed);\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit history tags\"),\n                    classes: \"history-tag-btn\",\n                    faIcon: \"fa-tags\"\n                }).appendTo($where.find(\".controls .actions\"))\n            });\n        },\n        /** render the annotation sub-view controller */\n        _renderAnnotation: function($where) {\n            var panel = this;\n            this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n                model: this.model,\n                el: $where.find(\".controls .annotation-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                // show hide sub-view view annotation editors when this is shown/hidden\n                onshow: function() {\n                    panel.toggleHDAAnnotationEditors(true, panel.fxSpeed);\n                },\n                onhide: function() {\n                    panel.toggleHDAAnnotationEditors(false, panel.fxSpeed);\n                },\n                $activator: faIconButton({\n                    title: _l(\"Edit history annotation\"),\n                    classes: \"history-annotate-btn\",\n                    faIcon: \"fa-comment\"\n                }).appendTo($where.find(\".controls .actions\"))\n            });\n        },\n\n        /** Set up HistoryViewEdit js/widget behaviours\n         *  In this override, make the name editable\n         */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            _super.prototype._setUpBehaviors.call(this, $where);\n            if (!this.model) {\n                return;\n            }\n\n            // anon users shouldn't have access to any of the following\n            if (!Galaxy.user || Galaxy.user.isAnonymous() || Galaxy.user.id !== this.model.get(\"user_id\")) {\n                return;\n            }\n\n            var panel = this;\n            var nameSelector = \"> .controls .name\";\n            $where\n                .find(nameSelector)\n                .attr(\"title\", _l(\"Click to rename history\"))\n                .tooltip({ placement: \"bottom\" })\n                .make_text_editable({\n                    on_finish: function(newName) {\n                        var previousName = panel.model.get(\"name\");\n                        if (newName && newName !== previousName) {\n                            panel.$el.find(nameSelector).text(newName);\n                            panel.model.save({ name: newName }).fail(() => {\n                                panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                            });\n                        } else {\n                            panel.$el.find(nameSelector).text(previousName);\n                        }\n                    }\n                });\n        },\n\n        /** return a new popup menu for choosing a multi selection action\n         *  ajax calls made for multiple datasets are queued\n         */\n        multiselectActions: function() {\n            var panel = this;\n\n            var actions = [\n                {\n                    html: _l(\"Hide datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Unhide datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Delete datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype[\"delete\"];\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                },\n                {\n                    html: _l(\"Undelete datasets\"),\n                    func: function() {\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n                        panel.getSelectedModels().ajaxQueue(action);\n                    }\n                }\n            ];\n\n            if (panel.purgeAllowed) {\n                actions.push({\n                    html: _l(\"Permanently delete datasets\"),\n                    func: function() {\n                        if (confirm(_l(\"This will permanently remove the data in your datasets. Are you sure?\"))) {\n                            var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n                            panel.getSelectedModels().ajaxQueue(action);\n                        }\n                    }\n                });\n            }\n            actions = actions.concat(panel._collectionActions());\n            return actions;\n        },\n\n        /**   */\n        _collectionActions: function() {\n            var panel = this;\n            return [\n                {\n                    html: _l(\"Build Dataset List\"),\n                    func: function() {\n                        panel.buildCollection(\"list\");\n                    }\n                },\n                // TODO: Only show quick pair if two things selected.\n                {\n                    html: _l(\"Build Dataset Pair\"),\n                    func: function() {\n                        panel.buildCollection(\"paired\");\n                    }\n                },\n                {\n                    html: _l(\"Build List of Dataset Pairs\"),\n                    func: function() {\n                        panel.buildCollection(\"list:paired\");\n                    }\n                }\n            ];\n        },\n\n        buildCollection: function(collectionType, selection, hideSourceItems) {\n            var panel = this;\n            var selection = selection || panel.getSelectedModels();\n            var hideSourceItems = hideSourceItems || false;\n            var createFunc;\n            if (collectionType == \"list\") {\n                createFunc = LIST_COLLECTION_CREATOR.createListCollection;\n            } else if (collectionType == \"paired\") {\n                createFunc = PAIR_COLLECTION_CREATOR.createPairCollection;\n            } else if (collectionType == \"list:paired\") {\n                createFunc = LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection;\n            } else {\n                console.warn(`Unknown collectionType encountered ${collectionType}`);\n            }\n            createFunc(selection, hideSourceItems).done(() => {\n                panel.model.refresh();\n            });\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            _.extend(options, {\n                purgeAllowed: this.purgeAllowed,\n                tagsEditorShown: this.tagsEditor && !this.tagsEditor.hidden,\n                annotationEditorShown: this.annotationEditor && !this.annotationEditor.hidden\n            });\n            return options;\n        },\n\n        /** If this item is deleted and we're not showing deleted items, remove the view\n         *  @param {Model} the item model to check\n         */\n        _handleItemDeletedChange: function(itemModel) {\n            if (itemModel.get(\"deleted\")) {\n                this._handleItemDeletion(itemModel);\n            } else {\n                this._handleItemUndeletion(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemDeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeDeleted) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUndeletion: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.deleted -= 1;\n            if (!this.model.contents.includeDeleted) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** If this item is hidden and we're not showing hidden items, remove the view\n         *  @param {Model} the item model to check\n         */\n        _handleItemVisibleChange: function(itemModel) {\n            if (itemModel.hidden()) {\n                this._handleItemHidden(itemModel);\n            } else {\n                this._handleItemUnhidden(itemModel);\n            }\n            this._renderCounts();\n        },\n\n        _handleItemHidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden += 1;\n            contentsShown.active -= 1;\n            if (!this.model.contents.includeHidden) {\n                this.removeItemView(itemModel);\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        _handleItemUnhidden: function(itemModel) {\n            var contentsShown = this.model.get(\"contents_active\");\n            contentsShown.hidden -= 1;\n            if (!this.model.contents.includeHidden) {\n                contentsShown.active -= 1;\n            }\n            this.model.set(\"contents_active\", contentsShown);\n        },\n\n        /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n        toggleHDATagEditors: function(showOrHide, speed) {\n            _.each(this.views, view => {\n                if (view.tagsEditor) {\n                    view.tagsEditor.toggle(showOrHide, speed);\n                }\n            });\n        },\n\n        /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n        toggleHDAAnnotationEditors: function(showOrHide, speed) {\n            _.each(this.views, view => {\n                if (view.annotationEditor) {\n                    view.annotationEditor.toggle(showOrHide, speed);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click .toggle-deleted-link\": function(ev) {\n                this.toggleShowDeleted();\n            },\n            \"click .toggle-hidden-link\": function(ev) {\n                this.toggleShowHidden();\n            }\n        }),\n\n        // ------------------------------------------------------------------------ search\n        _renderSearchProgress: function(limit, offset) {\n            var stop = limit + offset;\n            return this.$(\"> .controls .subtitle\").html(\n                [\"<i>\", _l(\"Searching \"), stop, \"/\", this.model.contentsShown(), \"</i>\"].join(\"\")\n            );\n        },\n\n        /** override to display number found in subtitle */\n        _renderSearchFindings: function($whereTo) {\n            $whereTo = $whereTo instanceof jQuery ? $whereTo : this.$el;\n            var html = this.templates.found(this.model.toJSON(), this);\n            $whereTo.find(\"> .controls .subtitle\").html(html);\n            return this;\n        },\n\n        // ------------------------------------------------------------------------ as drop target\n        /** turn all the drag and drop handlers on and add some help text above the drop area */\n        dropTargetOn: function() {\n            if (this.dropTarget) {\n                return this;\n            }\n            this.dropTarget = true;\n\n            //TODO: to init\n            var dropHandlers = {\n                dragenter: _.bind(this.dragenter, this),\n                dragover: _.bind(this.dragover, this),\n                dragleave: _.bind(this.dragleave, this),\n                drop: _.bind(this.drop, this)\n            };\n\n            var $dropTarget = this._renderDropTarget();\n            this.$list().before([this._renderDropTargetHelp(), $dropTarget]);\n            for (var evName in dropHandlers) {\n                if (dropHandlers.hasOwnProperty(evName)) {\n                    //console.debug( evName, dropHandlers[ evName ] );\n                    $dropTarget.on(evName, dropHandlers[evName]);\n                }\n            }\n            return this;\n        },\n\n        /** render a box to serve as a 'drop here' area on the history */\n        _renderDropTarget: function() {\n            this.$(\".history-drop-target\").remove();\n            return $(\"<div/>\").addClass(\"history-drop-target\");\n        },\n\n        /** tell the user how it works  */\n        _renderDropTargetHelp: function() {\n            this.$(\".history-drop-target-help\").remove();\n            return $(\"<div/>\")\n                .addClass(\"history-drop-target-help\")\n                .text(_l(\"Drag datasets here to copy them to the current history\"));\n        },\n\n        /** shut down drag and drop event handlers and remove drop target */\n        dropTargetOff: function() {\n            if (!this.dropTarget) {\n                return this;\n            }\n            //this.log( 'dropTargetOff' );\n            this.dropTarget = false;\n            var dropTarget = this.$(\".history-drop-target\").get(0);\n            for (var evName in this._dropHandlers) {\n                if (this._dropHandlers.hasOwnProperty(evName)) {\n                    dropTarget.off(evName, this._dropHandlers[evName]);\n                }\n            }\n            this.$(\".history-drop-target\").remove();\n            this.$(\".history-drop-target-help\").remove();\n            return this;\n        },\n        /** toggle the target on/off */\n        dropTargetToggle: function() {\n            if (this.dropTarget) {\n                this.dropTargetOff();\n            } else {\n                this.dropTargetOn();\n            }\n            return this;\n        },\n\n        dragenter: function(ev) {\n            //console.debug( 'dragenter:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"2px solid black\");\n        },\n        dragover: function(ev) {\n            ev.preventDefault();\n            ev.stopPropagation();\n        },\n        dragleave: function(ev) {\n            //console.debug( 'dragleave:', this, ev );\n            ev.preventDefault();\n            ev.stopPropagation();\n            this.$(\".history-drop-target\").css(\"border\", \"1px dashed black\");\n        },\n        /** when (text) is dropped try to parse as json and trigger an event */\n        drop: function(ev) {\n            ev.preventDefault();\n            //ev.stopPropagation();\n\n            var self = this;\n            var dataTransfer = ev.originalEvent.dataTransfer;\n            var data = dataTransfer.getData(\"text\");\n\n            dataTransfer.dropEffect = \"move\";\n            try {\n                data = JSON.parse(data);\n            } catch (err) {\n                self.warn(\"error parsing JSON from drop:\", data);\n            }\n\n            self.trigger(\"droptarget:drop\", ev, data, self);\n            return false;\n        },\n\n        /** handler that copies data into the contents */\n        dataDropped: function(data) {\n            var self = this;\n            // HDA: dropping will copy it to the history\n            if (_.isObject(data) && data.model_class === \"HistoryDatasetAssociation\" && data.id) {\n                if (self.contents.currentPage !== 0) {\n                    return self.contents.fetchPage(0).then(() => self.model.contents.copy(data.id));\n                }\n                return self.model.contents.copy(data.id);\n            }\n            return jQuery.when();\n        },\n\n        // ........................................................................ misc\n        /** Return a string rep of the history */\n        toString: function() {\n            return `HistoryViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryViewEdit.prototype.templates = (() => {\n    var countsTemplate = BASE_MVC.wrapTemplate(\n        [\n            \"<% var shown = Math.max( view.views.length, history.contents_active.active ) %>\",\n            \"<% if( shown ){ %>\",\n            '<span class=\"shown-count\">',\n            \"<%- shown %> \",\n            _l(\"shown\"),\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            '<span class=\"deleted-count\">',\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.deleted %> \",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"deleted\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            '<span class=\"hidden-count\">',\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            \"<%- history.contents_active.hidden %> \",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"</span>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    var foundTemplate = BASE_MVC.wrapTemplate(\n        [\n            _l(\"Found\"),\n            \" <%- view.views.length %>, \",\n\n            \"<% if( history.contents_active.deleted ){ %>\",\n            \"<% if( view.model.contents.includeDeleted ){ %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"hide deleted\"),\n            \"</a>, \",\n            \"<% } else { %>\",\n            '<a class=\"toggle-deleted-link\" href=\"javascript:void(0);\">',\n            _l(\"show deleted\"),\n            \"</a>, \",\n            \"<% } %>\",\n            \"<% } %>\",\n\n            \"<% if( history.contents_active.hidden ){ %>\",\n            \"<% if( view.model.contents.includeHidden ){ %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"hide hidden\"),\n            \"</a>\",\n            \"<% } else { %>\",\n            '<a class=\"toggle-hidden-link\" href=\"javascript:void(0);\">',\n            _l(\"show hidden\"),\n            \"</a>\",\n            \"<% } %>\",\n            \"<% } %>\"\n        ],\n        \"history\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        counts: countsTemplate,\n        found: foundTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HistoryViewEdit: HistoryViewEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-view-edit.js","import LIST_VIEW from \"mvc/list/list-view\";\nimport HISTORY_MODEL from \"mvc/history/history-model\";\nimport HISTORY_CONTENTS from \"mvc/history/history-contents\";\nimport HISTORY_PREFS from \"mvc/history/history-preferences\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport HDCA_LI from \"mvc/history/hdca-li\";\nimport USER from \"mvc/user/user-model\";\nimport ERROR_MODAL from \"mvc/ui/error-modal\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/search-input\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = LIST_VIEW.ModelListPanel;\nvar HistoryView = _super.extend(\n    /** @lends HistoryView.prototype */ {\n        _logNamespace: \"history\",\n\n        /** class to use for constructing the HDA views */\n        HDAViewClass: HDA_LI.HDAListItemView,\n        /** class to use for constructing the HDCA views */\n        HDCAViewClass: HDCA_LI.HDCAListItemView,\n        /** class to used for constructing collection of sub-view models */\n        collectionClass: HISTORY_CONTENTS.HistoryContents,\n        /** key of attribute in model to assign to this.collection */\n        modelCollectionKey: \"contents\",\n\n        tagName: \"div\",\n        className: `${_super.prototype.className} history-panel`,\n\n        /** string to display when the collection is empty */\n        emptyMsg: _l(\"This history is empty\"),\n        /** displayed when no items match the search terms */\n        noneFoundMsg: _l(\"No matching datasets found\"),\n        /** string used for search placeholder */\n        searchPlaceholder: _l(\"search datasets\"),\n\n        /** @type {Number} ms to wait after history load to fetch/decorate hdcas with element_count */\n        FETCH_COLLECTION_COUNTS_DELAY: 2000,\n\n        // ......................................................................... SET UP\n        /** Set up the view, bind listeners.\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n            // ---- instance vars\n            // control contents/behavior based on where (and in what context) the panel is being used\n            /** where should pages from links be displayed? (default to new tab/window) */\n            this.linkTarget = attributes.linkTarget || \"_blank\";\n\n            /** timeout id for detailed fetch of collection counts, etc... */\n            this.detailedFetchTimeoutId = null;\n        },\n\n        /** create and return a collection for when none is initially passed */\n        _createDefaultCollection: function() {\n            // override\n            return new this.collectionClass([], {\n                history: this.model\n            });\n        },\n\n        /** In this override, clear the update timer on the model */\n        freeModel: function() {\n            _super.prototype.freeModel.call(this);\n            if (this.model) {\n                this.model.clearUpdateTimeout();\n            }\n            this._clearDetailedFetchTimeout();\n            return this;\n        },\n\n        /** clear the timeout and the cached timeout id */\n        _clearDetailedFetchTimeout: function() {\n            if (this.detailedFetchTimeoutId) {\n                clearTimeout(this.detailedFetchTimeoutId);\n                this.detailedFetchTimeoutId = null;\n            }\n        },\n\n        /** create any event listeners for the panel\n         *  @fires: rendered:initial    on the first render\n         *  @fires: empty-history       when switching to a history with no contents or creating a new history\n         */\n        _setUpListeners: function() {\n            _super.prototype._setUpListeners.call(this);\n            this.on({\n                error: function(model, xhr, options, msg, details) {\n                    this.errorHandler(model, xhr, options, msg, details);\n                },\n                \"loading-done\": () => {\n                    // after the initial load, decorate with more time consuming fields (like HDCA element_counts)\n                    this.detailedFetchTimeoutId = _.delay(() => {\n                        this.detailedFetchTimeoutId = null;\n                        this.model.contents.fetchCollectionCounts();\n                    }, this.FETCH_COLLECTION_COUNTS_DELAY);\n                },\n                \"views:ready view:attached view:removed\": function(view) {\n                    this._renderSelectButton();\n                },\n                \"view:attached\": function(view) {\n                    this.scrollTo(0);\n                }\n            });\n            // this.on( 'all', function(){ console.debug( arguments ); });\n        },\n\n        // ------------------------------------------------------------------------ loading history/hda models\n        /** load the history with the given id then it's contents, sending ajax options to both */\n        loadHistory: function(historyId, options, contentsOptions) {\n            contentsOptions = _.extend(contentsOptions || { silent: true });\n            this.info(\"loadHistory:\", historyId, options, contentsOptions);\n            this.setModel(new HISTORY_MODEL.History({ id: historyId }));\n\n            contentsOptions.silent = true;\n            this.trigger(\"loading\");\n            return this.model.fetchWithContents(options, contentsOptions).always(() => {\n                this.render();\n                this.trigger(\"loading-done\");\n            });\n        },\n\n        /** convenience alias to the model. Updates the item list only (not the history) */\n        refreshContents: function(options) {\n            if (this.model) {\n                return this.model.refresh(options);\n            }\n            // may have callbacks - so return an empty promise\n            return $.when();\n        },\n\n        /** Override to reset web storage when the id changes (since it needs the id) */\n        _setUpCollectionListeners: function() {\n            _super.prototype._setUpCollectionListeners.call(this);\n            return this.listenTo(this.collection, {\n                // 'all' : function(){ console.log( this.collection + ':', arguments ); },\n                \"fetching-more\": function() {\n                    this._toggleContentsLoadingIndicator(true);\n                    this.$emptyMessage().hide();\n                },\n                \"fetching-more-done\": function() {\n                    this._toggleContentsLoadingIndicator(false);\n                }\n            });\n        },\n\n        // ------------------------------------------------------------------------ panel rendering\n        /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n        _showLoadingIndicator: function(msg, speed, callback) {\n            var $indicator = $('<div class=\"loading-indicator\"/>');\n            this.$el.html($indicator.text(msg).slideDown(!_.isUndefined(speed) ? speed : this.fxSpeed));\n        },\n\n        /** hide the loading indicator */\n        _hideLoadingIndicator: function(speed) {\n            // make speed a bit slower to compensate for slow rendering of up to 500 contents\n            this.$(\".loading-indicator\").slideUp(!_.isUndefined(speed) ? speed : this.fxSpeed + 200, function() {\n                $(this).remove();\n            });\n        },\n\n        /** In this override, add a btn to toggle the selectors */\n        _buildNewRender: function() {\n            var $newRender = _super.prototype._buildNewRender.call(this);\n            this._renderSelectButton($newRender);\n            return $newRender;\n        },\n\n        /** button for starting select mode */\n        _renderSelectButton: function($where) {\n            $where = $where || this.$el;\n            // do not render selector option if no actions\n            if (!this.multiselectActions().length) {\n                return null;\n            }\n            // do not render (and remove even) if nothing to select\n            if (!this.views.length) {\n                this.hideSelectors();\n                $where.find(\".controls .actions .show-selectors-btn\").remove();\n                return null;\n            }\n            // don't bother rendering if there's one already\n            var $existing = $where.find(\".controls .actions .show-selectors-btn\");\n            if ($existing.length) {\n                return $existing;\n            }\n\n            return faIconButton({\n                title: _l(\"Operations on multiple datasets\"),\n                classes: \"show-selectors-btn\",\n                faIcon: \"fa-check-square-o\"\n            }).prependTo($where.find(\".controls .actions\"));\n        },\n\n        /** override to avoid showing intial empty message using contents_active */\n        _renderEmptyMessage: function($whereTo) {\n            var $emptyMsg = this.$emptyMessage($whereTo);\n            var empty = this.model.get(\"contents_active\").active <= 0;\n            if (empty) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.emptyMsg)\n                    .show();\n            } else if (this.searchFor && this.model.contents.haveSearchDetails() && !this.views.length) {\n                return $emptyMsg\n                    .empty()\n                    .append(this.noneFoundMsg)\n                    .show();\n            }\n            $emptyMsg.hide();\n            return $();\n        },\n\n        /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n        $scrollContainer: function($where) {\n            // override or set via attributes.$scrollContainer\n            return this.$list($where);\n        },\n\n        // ------------------------------------------------------------------------ subviews\n        _toggleContentsLoadingIndicator: function(show) {\n            if (!show) {\n                this.$list()\n                    .find(\".contents-loading-indicator\")\n                    .remove();\n            } else {\n                this.$list().html(\n                    '<div class=\"contents-loading-indicator\">' + '<span class=\"fa fa-2x fa-spinner fa-spin\"/></div>'\n                );\n            }\n        },\n\n        /** override to render pagination also */\n        renderItems: function($whereTo) {\n            // console.log( this + '.renderItems-----------------', new Date() );\n            $whereTo = $whereTo || this.$el;\n            var $list = this.$list($whereTo);\n\n            // TODO: bootstrap hack to remove orphaned tooltips\n            $(\".tooltip\").remove();\n\n            $list.empty();\n            this.views = [];\n\n            var models = this._filterCollection();\n            if (models.length) {\n                this._renderPagination($whereTo);\n                this.views = this._renderSomeItems(models, $list);\n            } else {\n                // TODO: consolidate with _renderPagination above by (???) passing in models/length?\n                $whereTo.find(\"> .controls .list-pagination\").empty();\n            }\n            this._renderEmptyMessage($whereTo).toggle(!models.length);\n\n            this.trigger(\"views:ready\", this.views);\n            return this.views;\n        },\n\n        /** render pagination controls if not searching and contents says we're paginating */\n        _renderPagination: function($whereTo) {\n            var $paginationControls = $whereTo.find(\"> .controls .list-pagination\");\n            if (this.searchFor || !this.model.contents.shouldPaginate()) return $paginationControls.empty();\n\n            $paginationControls.html(\n                this.templates.pagination(\n                    {\n                        // pagination is 1-based for the user\n                        current: this.model.contents.currentPage + 1,\n                        last: this.model.contents.getLastPage() + 1\n                    },\n                    this\n                )\n            );\n            $paginationControls.find(\"select.pages\").tooltip();\n            return $paginationControls;\n        },\n\n        /** render a subset of the entire collection (client-side pagination) */\n        _renderSomeItems: function(models, $list) {\n            var views = [];\n            $list.append(\n                models.map(m => {\n                    var view = this._createItemView(m);\n                    views.push(view);\n                    return this._renderItemView$el(view);\n                })\n            );\n            return views;\n        },\n\n        // ------------------------------------------------------------------------ sub-views\n        /** in this override, check if the contents would also display based on includeDeleted/hidden */\n        _filterItem: function(model) {\n            var contents = this.model.contents;\n            return (\n                (contents.includeHidden || !model.hidden()) &&\n                (contents.includeDeleted || !model.isDeletedOrPurged()) &&\n                _super.prototype._filterItem.call(this, model)\n            );\n        },\n\n        /** In this override, since history contents are mixed,\n         *      get the appropo view class based on history_content_type\n         */\n        _getItemViewClass: function(model) {\n            var contentType = model.get(\"history_content_type\");\n            switch (contentType) {\n                case \"dataset\":\n                    return this.HDAViewClass;\n                case \"dataset_collection\":\n                    return this.HDCAViewClass;\n            }\n            throw new TypeError(`Unknown history_content_type: ${contentType}`);\n        },\n\n        /** in this override, add a linktarget, and expand if id is in web storage */\n        _getItemViewOptions: function(model) {\n            var options = _super.prototype._getItemViewOptions.call(this, model);\n            return _.extend(options, {\n                linkTarget: this.linkTarget,\n                expanded: this.model.contents.storage.isExpanded(model.id),\n                hasUser: this.model.ownedByCurrUser()\n            });\n        },\n\n        /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n        _setUpItemViewListeners: function(view) {\n            var panel = this;\n            _super.prototype._setUpItemViewListeners.call(panel, view);\n            //TODO: send from content view: this.model.collection.storage.addExpanded\n            // maintain a list of items whose bodies are expanded\n            return panel.listenTo(view, {\n                expanded: function(v) {\n                    panel.model.contents.storage.addExpanded(v.model);\n                },\n                collapsed: function(v) {\n                    panel.model.contents.storage.removeExpanded(v.model);\n                }\n            });\n        },\n\n        /** override to remove expandedIds from webstorage */\n        collapseAll: function() {\n            this.model.contents.storage.clearExpanded();\n            _super.prototype.collapseAll.call(this);\n        },\n\n        // ------------------------------------------------------------------------ selection\n        /** Override to correctly set the historyId of the new collection */\n        getSelectedModels: function() {\n            var collection = _super.prototype.getSelectedModels.call(this);\n            collection.historyId = this.collection.historyId;\n            return collection;\n        },\n\n        // ------------------------------------------------------------------------ panel events\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .show-selectors-btn\": \"toggleSelectors\",\n            \"click > .controls .prev\": \"_clickPrevPage\",\n            \"click > .controls .next\": \"_clickNextPage\",\n            \"change > .controls .pages\": \"_changePageSelect\",\n            // allow (error) messages to be clicked away\n            \"click .messages [class$=message]\": \"clearMessages\"\n        }),\n\n        _clickPrevPage: function(ev) {\n            this.model.clearUpdateTimeout();\n            this.model.contents.fetchPrevPage();\n        },\n\n        _clickNextPage: function(ev) {\n            this.model.clearUpdateTimeout();\n            this.model.contents.fetchNextPage();\n        },\n\n        _changePageSelect: function(ev) {\n            this.model.clearUpdateTimeout();\n            var page = $(ev.currentTarget).val();\n            this.model.contents.fetchPage(page);\n        },\n\n        /** Toggle and store the deleted visibility and re-render items\n         * @returns {Boolean} new setting\n         */\n        toggleShowDeleted: function(show, options) {\n            show = show !== undefined ? show : !this.model.contents.includeDeleted;\n            var contents = this.model.contents;\n            contents.setIncludeDeleted(show, options);\n            this.trigger(\"show-deleted\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** Toggle and store whether to render explicity hidden contents\n         * @returns {Boolean} new setting\n         */\n        toggleShowHidden: function(show, store, options) {\n            // console.log( 'toggleShowHidden', show, store );\n            show = show !== undefined ? show : !this.model.contents.includeHidden;\n            var contents = this.model.contents;\n            contents.setIncludeHidden(show, options);\n            this.trigger(\"show-hidden\", show);\n\n            contents.fetchCurrentPage({ renderAll: true });\n            return show;\n        },\n\n        /** On the first search, if there are no details - load them, then search */\n        _firstSearch: function(searchFor) {\n            var inputSelector = \"> .controls .search-input\";\n            this.log(\"onFirstSearch\", searchFor);\n\n            // if the contents already have enough details to search, search and return now\n            if (this.model.contents.haveSearchDetails()) {\n                this.searchItems(searchFor);\n                return;\n            }\n\n            // otherwise, load the details progressively here\n            this.$(inputSelector).searchInput(\"toggle-loading\");\n            // set this now so that only results will show during progress\n            this.searchFor = searchFor;\n            var xhr = this.model.contents\n                .progressivelyFetchDetails({ silent: true })\n                .progress((response, limit, offset) => {\n                    this.renderItems();\n                    this.trigger(\"search:loading-progress\", limit, offset);\n                })\n                .always(() => {\n                    this.$el.find(inputSelector).searchInput(\"toggle-loading\");\n                })\n                .done(() => {\n                    this.searchItems(searchFor, \"force\");\n                });\n        },\n\n        /** clear the search filters and show all views that are normally shown */\n        clearSearch: function(searchFor) {\n            if (!this.searchFor) return this;\n            //this.log( 'onSearchClear', this );\n            this.searchFor = \"\";\n            this.trigger(\"search:clear\", this);\n            this.$(\"> .controls .search-query\").val(\"\");\n            // NOTE: silent + render prevents collection update event with merge only\n            // - which causes an empty page due to event handler above\n            this.model.contents.fetchCurrentPage({ silent: true }).done(() => {\n                this.renderItems();\n            });\n            return this;\n        },\n\n        // ........................................................................ error handling\n        /** Event handler for errors (from the panel, the history, or the history's contents)\n         *  Alternately use two strings for model and xhr to use custom message and title (respectively)\n         *  @param {Model or View} model    the (Backbone) source of the error\n         *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n         *  @param {Object} options         the options map commonly used with bbone ajax\n         */\n        errorHandler: function(model, xhr, options) {\n            //TODO: to mixin or base model\n            // interrupted ajax or no connection\n            if (xhr && xhr.status === 0 && xhr.readyState === 0) {\n                // return ERROR_MODAL.offlineErrorModal();\n                // fail silently\n                return;\n            }\n            // otherwise, leave something to report in the console\n            this.error(model, xhr, options);\n            // and feedback to a modal\n            // if sent two strings (and possibly details as 'options'), use those as message and title\n            if (_.isString(model) && _.isString(xhr)) {\n                var message = model;\n                var title = xhr;\n                return ERROR_MODAL.errorModal(message, title, options);\n            }\n            // bad gateway\n            // TODO: possibly to global handler\n            if (xhr && xhr.status === 502) {\n                return ERROR_MODAL.badGatewayErrorModal();\n            }\n            return ERROR_MODAL.ajaxErrorModal(model, xhr, options);\n        },\n\n        /** Remove all messages from the panel. */\n        clearMessages: function(ev) {\n            var $target = !_.isUndefined(ev) ? $(ev.currentTarget) : this.$messages().children('[class$=\"message\"]');\n            $target.fadeOut(this.fxSpeed, function() {\n                $(this).remove();\n            });\n            return this;\n        },\n\n        // ........................................................................ scrolling\n        /** Scrolls the panel to show the content sub-view with the given hid.\n         *  @param {Integer} hid    the hid of item to scroll into view\n         *  @returns {HistoryView} the panel\n         */\n        scrollToHid: function(hid) {\n            return this.scrollToItem(_.first(this.viewsWhereModel({ hid: hid })));\n        },\n\n        // ........................................................................ misc\n        /** utility for adding -st, -nd, -rd, -th to numbers */\n        ordinalIndicator: function(number) {\n            var numStr = `${number}`;\n            switch (numStr.charAt(numStr.length - 1)) {\n                case \"1\":\n                    return `${numStr}st`;\n                case \"2\":\n                    return `${numStr}nd`;\n                case \"3\":\n                    return `${numStr}rd`;\n                default:\n                    return `${numStr}th`;\n            }\n        },\n\n        /** Return a string rep of the history */\n        toString: function() {\n            return `HistoryView(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryView.prototype.templates = (() => {\n    var mainTemplate = () =>\n        `<div>\n            <div class=\"controls\"></div>\n            <ul class=\"list-items\"></ul>\n            <div class=\"empty-message infomessagesmall\"></div>',\n        </div>`;\n\n    var controlsTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<div class=\"controls\">',\n            '<div class=\"title\">',\n            '<div class=\"name\"><%- history.name %></div>',\n            \"</div>\",\n            '<div class=\"subtitle\"></div>',\n            '<div class=\"history-size\"><%- history.nice_size %></div>',\n\n            '<div class=\"actions\"></div>',\n\n            '<div class=\"messages\">',\n            \"<% if( history.deleted && history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged and deleted\"),\n            \"</div>\",\n            \"<% } else if( history.deleted ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been deleted\"),\n            \"</div>\",\n            \"<% } else if( history.purged ){ %>\",\n            '<div class=\"deleted-msg warningmessagesmall\">',\n            _l(\"This history has been purged\"),\n            \"</div>\",\n            \"<% } %>\",\n\n            \"<% if( history.message ){ %>\",\n            // should already be localized\n            '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n            \"<%= history.message.text %>\",\n            \"</div>\",\n            \"<% } %>\",\n            \"</div>\",\n\n            // add tags and annotations\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"search\">',\n            '<div class=\"search-input\"></div>',\n            \"</div>\",\n\n            '<div class=\"list-actions\">',\n            '<div class=\"btn-group\">',\n            '<button class=\"select-all btn btn-default\"',\n            'data-mode=\"select\">',\n            _l(\"All\"),\n            \"</button>\",\n            '<button class=\"deselect-all btn btn-default\"',\n            'data-mode=\"select\">',\n            _l(\"None\"),\n            \"</button>\",\n            \"</div>\",\n            '<div class=\"list-action-menu btn-group\">',\n            \"</div>\",\n            \"</div>\",\n            '<div class=\"list-pagination form-inline\"></div>',\n            \"</div>\"\n        ],\n        \"history\"\n    );\n\n    var paginationTemplate = BASE_MVC.wrapTemplate(\n        [\n            '<button class=\"prev\" <%- pages.current === 1 ? \"disabled\" : \"\" %>>previous</button>',\n            '<select class=\"pages form-control\" ',\n            'title=\"',\n            _l(\"Click to open and select a page. Begin typing a page number to select it\"),\n            '\">',\n            \"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>\",\n            '<option value=\"<%- i - 1 %>\" <%- i === pages.current ? \"selected\" : \"\" %>>',\n            \"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages\",\n            \"</option>\",\n            \"<% }); %>\",\n            \"</select>\",\n            '<button class=\"next\" <%- pages.current === pages.last ? \"disabled\" : \"\" %>>next</button>'\n        ],\n        \"pages\"\n    );\n\n    return _.extend(_.clone(_super.prototype.templates), {\n        el: mainTemplate,\n        controls: controlsTemplate,\n        pagination: paginationTemplate\n    });\n})();\n\n//==============================================================================\nexport default {\n    HistoryView: HistoryView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-view.js","import jQuery from \"jquery\";\n(\"use_strict\");\n\nvar $ = jQuery;\n//TODO: too specific to history panel\nfunction LoadingIndicator($where, options) {\n    var self = this;\n    // defaults\n    options = jQuery.extend(\n        {\n            cover: false\n        },\n        options || {}\n    );\n\n    function render() {\n        var html = [\n            '<div class=\"loading-indicator\">',\n            '<div class=\"loading-indicator-text\">',\n            '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>',\n            '<span class=\"loading-indicator-message\">loading...</span>',\n            \"</div>\",\n            \"</div>\"\n        ].join(\"\\n\");\n\n        var $indicator = $(html)\n            .hide()\n            .css(\n                options.css || {\n                    position: \"fixed\"\n                }\n            );\n\n        var $text = $indicator.children(\".loading-indicator-text\");\n\n        if (options.cover) {\n            $indicator.css({\n                \"z-index\": 2,\n                top: $where.css(\"top\"),\n                bottom: $where.css(\"bottom\"),\n                left: $where.css(\"left\"),\n                right: $where.css(\"right\"),\n                opacity: 0.5,\n                \"background-color\": \"white\",\n                \"text-align\": \"center\"\n            });\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                \"margin-top\": \"20px\"\n            });\n        } else {\n            $text = $indicator.children(\".loading-indicator-text\").css({\n                margin: \"12px 0px 0px 10px\",\n                opacity: \"0.85\",\n                color: \"grey\"\n            });\n            $text.children(\".loading-indicator-message\").css({\n                margin: \"0px 8px 0px 0px\",\n                \"font-style\": \"italic\"\n            });\n        }\n        return $indicator;\n    }\n\n    self.show = (msg, speed, callback) => {\n        msg = msg || \"loading...\";\n        speed = speed || \"fast\";\n        // remove previous\n        $where\n            .parent()\n            .find(\".loading-indicator\")\n            .remove();\n        // since position is fixed - we insert as sibling\n        self.$indicator = render().insertBefore($where);\n        self.message(msg);\n        self.$indicator.fadeIn(speed, callback);\n        return self;\n    };\n\n    self.message = msg => {\n        self.$indicator.find(\"i\").text(msg);\n    };\n\n    self.hide = (speed, callback) => {\n        speed = speed || \"fast\";\n        if (self.$indicator && self.$indicator.length) {\n            self.$indicator.fadeOut(speed, () => {\n                self.$indicator.remove();\n                if (callback) {\n                    callback();\n                }\n            });\n        } else {\n            if (callback) {\n                callback();\n            }\n        }\n        return self;\n    };\n    return self;\n}\n\n//============================================================================\nexport default LoadingIndicator;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/ui/loading-indicator.js","import DATASET_LI_EDIT from \"mvc/dataset/dataset-li-edit\";\nimport HDA_LI from \"mvc/history/hda-li\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = DATASET_LI_EDIT.DatasetListItemEdit;\n/** @class Editing view for HistoryDatasetAssociation.\n */\nvar HDAListItemEdit = _super.extend(\n    /** @lends HDAListItemEdit.prototype */ {\n        className: `${_super.prototype.className} history-content`,\n\n        /** In this override, only get details if in the ready state, get rerunnable if in other states.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n\n                // special case the need for the rerunnable and creating_job attributes\n                // needed for rendering re-run button on queued, running datasets\n            } else if (!view.model.has(\"rerunnable\")) {\n                return view.model.fetch({\n                    silent: true,\n                    data: {\n                        // only fetch rerunnable and creating_job to keep overhead down\n                        keys: [\"rerunnable\", \"creating_job\"].join(\",\")\n                    }\n                });\n            }\n            return jQuery.when();\n        },\n\n        /** event map */\n        events: _.extend(_.clone(_super.prototype.events), {\n            \"click .unhide-link\": function(ev) {\n                this.model.unhide();\n                return false;\n            }\n        }),\n\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDAListItemEdit(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemEdit.prototype.templates = (() => {\n    var warnings = _.extend({}, _super.prototype.templates.warnings, {\n        hidden: BASE_MVC.wrapTemplate(\n            [\n                \"<% if( !dataset.visible ){ %>\",\n                // add a link to unhide a dataset\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                _l(\"This dataset has been hidden\"),\n                '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">',\n                _l(\"Unhide it\"),\n                \"</a>\",\n                \"</div>\",\n                \"<% } %>\"\n            ],\n            \"dataset\"\n        )\n    });\n\n    return _.extend({}, _super.prototype.templates, {\n        //NOTE: *steal* the HDAListItemView titleBar\n        titleBar: HDA_LI.HDAListItemView.prototype.templates.titleBar,\n        warnings: warnings\n    });\n})();\n\n//==============================================================================\nexport default {\n    HDAListItemEdit: HDAListItemEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hda-li-edit.js","import HDCA_LI from \"mvc/history/hdca-li\";\nimport DC_VIEW_EDIT from \"mvc/collection/collection-view-edit\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar _super = HDCA_LI.HDCAListItemView;\n/** @class Editing view for HistoryDatasetCollectionAssociation.\n */\nvar HDCAListItemEdit = _super.extend(\n    /** @lends HDCAListItemEdit.prototype */ {\n        /** logger used to record this.log messages, commonly set to console */\n        //logger              : console,\n\n        /** Override to return editable versions of the collection panels */\n        _getFoldoutPanelClass: function() {\n            var collectionType = this.model.get(\"collection_type\");\n            switch (collectionType) {\n                case \"list\":\n                    return DC_VIEW_EDIT.ListCollectionViewEdit;\n                case \"paired\":\n                    return DC_VIEW_EDIT.PairCollectionViewEdit;\n                case \"list:paired\":\n                    return DC_VIEW_EDIT.ListOfPairsCollectionViewEdit;\n                case \"list:list\":\n                    return DC_VIEW_EDIT.ListOfListsCollectionViewEdit;\n            }\n            throw new TypeError(`Unknown collection_type: ${collectionType}`);\n        },\n\n        // ......................................................................... delete\n        /** In this override, add the delete button. */\n        _renderPrimaryActions: function() {\n            this.log(`${this}._renderPrimaryActions`);\n            // render the display, edit attr and delete icon-buttons\n            return _super.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()]);\n        },\n\n        /** Render icon-button to delete this collection. */\n        _renderDeleteButton: function() {\n            var deleted = this.model.get(\"deleted\");\n            return faIconButton({\n                title: deleted ? _l(\"Dataset collection is already deleted\") : _l(\"Delete\"),\n                classes: \"delete-btn\",\n                faIcon: \"fa-times\",\n                disabled: deleted,\n                onclick: () => {\n                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                    this.$el.find(\".icon-btn.delete-btn\").trigger(\"mouseout\");\n                    this.model[\"delete\"]();\n                }\n            });\n        },\n\n        // ......................................................................... misc\n        /** string rep */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `HDCAListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    HDCAListItemEdit: HDCAListItemEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/hdca-li-edit.js","import DC_VIEW from \"mvc/collection/collection-view\";\nimport DC_MODEL from \"mvc/collection/collection-model\";\nimport DC_EDIT from \"mvc/collection/collection-li-edit\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport TAGS from \"mvc/tag\";\nimport faIconButton from \"ui/fa-icon-button\";\nimport _l from \"utils/localization\";\nimport \"ui/editable-text\";\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class editable View/Controller for a dataset collection.\n */\nvar _super = DC_VIEW.CollectionView;\nvar CollectionViewEdit = _super.extend(\n    /** @lends CollectionView.prototype */ {\n        //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n        /** logger used to record this.log messages, commonly set to console */\n        //logger              : console,\n\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_EDIT.DatasetDCEListItemEdit,\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\n        // ......................................................................... SET UP\n        /** Set up the view, set up storage, bind listeners to HistoryContents events\n         *  @param {Object} attributes optional settings for the panel\n         */\n        initialize: function(attributes) {\n            _super.prototype.initialize.call(this, attributes);\n        },\n\n        /** In this override, make the collection name editable\n         */\n        _setUpBehaviors: function($where) {\n            $where = $where || this.$el;\n            _super.prototype._setUpBehaviors.call(this, $where);\n            if (!this.model) {\n                return;\n            }\n\n            // anon users shouldn't have access to any of the following\n            if (!Galaxy.user || Galaxy.user.isAnonymous()) {\n                return;\n            }\n\n            this.tagsEditorShown = true;\n\n            //TODO: extract\n            var panel = this;\n\n            var nameSelector = \"> .controls .name\";\n            $where\n                .find(nameSelector)\n                .attr(\"title\", _l(\"Click to rename collection\"))\n                .tooltip({ placement: \"bottom\" })\n                .make_text_editable({\n                    on_finish: function(newName) {\n                        var previousName = panel.model.get(\"name\");\n                        if (newName && newName !== previousName) {\n                            panel.$el.find(nameSelector).text(newName);\n                            panel.model.save({ name: newName }).fail(() => {\n                                panel.$el.find(nameSelector).text(panel.model.previous(\"name\"));\n                            });\n                        } else {\n                            panel.$el.find(nameSelector).text(previousName);\n                        }\n                    }\n                });\n            this.tagsEditor = new TAGS.TagsEditor({\n                model: this.model,\n                el: $where.find(\".tags-display\"),\n                onshowFirstTime: function() {\n                    this.render();\n                },\n                usePrompt: false\n            });\n            this.tagsEditor.toggle(true);\n        },\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `CollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionViewEdit = CollectionViewEdit.extend(\n    /** @lends ListCollectionView.prototype */ {\n        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n        /** sub view class used for datasets */\n        DatasetDCEViewClass: DC_EDIT.DatasetDCEListItemEdit,\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `ListCollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class Editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionViewEdit = ListCollectionViewEdit.extend(\n    /** @lends PairCollectionViewEdit.prototype */ {\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `PairCollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class Editable (roughly since these collections are immutable),\n *  View/Controller for a dataset collection.\n */\nvar NestedPairCollectionViewEdit = PairCollectionViewEdit.extend(\n    /** @lends NestedPairCollectionViewEdit.prototype */ {\n        /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n        _setUpBehaviors: function($where) {\n            _super.prototype._setUpBehaviors.call(this, $where);\n        },\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `NestedPairCollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class editable, View/Controller for a list of pairs dataset collection. */\nvar ListOfPairsCollectionViewEdit = CollectionViewEdit.extend(\n    /** @lends ListOfPairsCollectionView.prototype */ {\n        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit.extend({\n            foldoutPanelClass: NestedPairCollectionViewEdit\n        }),\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `ListOfPairsCollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n// =============================================================================\n/** @class View/Controller for a list of lists dataset collection. */\nvar ListOfListsCollectionViewEdit = CollectionViewEdit.extend(\n    /** @lends ListOfListsCollectionView.prototype */ {\n        //TODO: not strictly needed - due to switch in CollectionView._getContentClass\n        /** sub view class used for nested collections */\n        NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit.extend({\n            foldoutPanelClass: NestedPairCollectionViewEdit\n        }),\n\n        // ........................................................................ misc\n        /** string rep */\n        toString: function() {\n            return `ListOfListsCollectionViewEdit(${this.model ? this.model.get(\"name\") : \"\"})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    CollectionViewEdit: CollectionViewEdit,\n    ListCollectionViewEdit: ListCollectionViewEdit,\n    PairCollectionViewEdit: PairCollectionViewEdit,\n    ListOfPairsCollectionViewEdit: ListOfPairsCollectionViewEdit,\n    ListOfListsCollectionViewEdit: ListOfListsCollectionViewEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/collection-view-edit.js","import DC_LI from \"mvc/collection/collection-li\";\nimport DATASET_LI_EDIT from \"mvc/dataset/dataset-li-edit\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\n//==============================================================================\nvar DCListItemView = DC_LI.DCListItemView;\n/** @class Edit view for DatasetCollection.\n */\nvar DCListItemEdit = DCListItemView.extend(\n    /** @lends DCListItemEdit.prototype */ {\n        /** override to add linkTarget */\n        initialize: function(attributes) {\n            DCListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nvar DCEListItemView = DC_LI.DCEListItemView;\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemEdit = DCEListItemView.extend(\n    /** @lends DCEListItemEdit.prototype */ {\n        //TODO: this might be expendable - compacted with HDAListItemView\n\n        /** set up */\n        initialize: function(attributes) {\n            DCEListItemView.prototype.initialize.call(this, attributes);\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\n// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n//TODO: but should - if we can find something simpler than using diamond\n/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n    /** @lends DatasetDCEListItemEdit.prototype */ {\n        /** set up */\n        initialize: function(attributes) {\n            DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call(this, attributes);\n        },\n\n        // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n        //TODO: fix\n        /** In this override, only get details if in the ready state.\n         *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n         */\n        _fetchModelDetails: function() {\n            var view = this;\n            if (view.model.inReadyState() && !view.model.hasDetails()) {\n                return view.model.fetch({ silent: true });\n            }\n            return jQuery.when();\n        },\n\n        /** Override to remove delete button */\n        _renderDeleteButton: function() {\n            return null;\n        },\n\n        // ......................................................................... misc\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `DatasetDCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemEdit.prototype.templates = (() =>\n    _.extend({}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n        titleBar: DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n    }))();\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n    /** @lends NestedDCDCEListItemEdit.prototype */ {\n        /** String representation */\n        toString: function() {\n            var modelString = this.model ? `${this.model}` : \"(no model)\";\n            return `NestedDCDCEListItemEdit(${modelString})`;\n        }\n    }\n);\n\n//==============================================================================\nexport default {\n    DCListItemEdit: DCListItemEdit,\n    DCEListItemEdit: DCEListItemEdit,\n    DatasetDCEListItemEdit: DatasetDCEListItemEdit,\n    NestedDCDCEListItemEdit: NestedDCDCEListItemEdit\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/collection-li-edit.js","import LIST_CREATOR from \"mvc/collection/list-collection-creator\";\nimport HDCA from \"mvc/history/hdca-model\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar logNamespace = \"collections\";\n/*==============================================================================\nTODO:\n    the paired creator doesn't really mesh with the list creator as parent\n        it may be better to make an abstract super class for both\n    composites may inherit from this (or vis-versa)\n    PairedDatasetCollectionElementView doesn't make a lot of sense\n\n==============================================================================*/\n/**  */\nvar PairedDatasetCollectionElementView = Backbone.View.extend(BASE_MVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    //TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName: \"li\",\n    className: \"collection-element\",\n\n    initialize: function(attributes) {\n        this.element = attributes.element || {};\n        this.identifier = attributes.identifier;\n    },\n\n    render: function() {\n        this.$el.attr(\"data-element-id\", this.element.id).html(\n            this.template({\n                identifier: this.identifier,\n                element: this.element\n            })\n        );\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template: _.template(\n        ['<span class=\"identifier\"><%- identifier %></span>', '<span class=\"name\"><%- element.name %></span>'].join(\"\")\n    ),\n\n    /** remove the DOM and any listeners */\n    destroy: function() {\n        this.off();\n        this.$el.remove();\n    },\n\n    /** string rep */\n    toString: function() {\n        return \"DatasetCollectionElementView()\";\n    }\n});\n\n// ============================================================================\nvar _super = LIST_CREATOR.ListCollectionCreator;\n\n/** An interface for building collections.\n */\nvar PairCollectionCreator = _super.extend({\n    /** the class used to display individual elements */\n    elementViewClass: PairedDatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass: HDCA.HistoryPairDatasetCollection,\n    className: \"pair-collection-creator collection-creator flex-row-container\",\n\n    /** override to no-op */\n    _mangleDuplicateNames: function() {},\n\n    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n    //      bad inital choices and\n    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n    /** render the entire interface */\n    render: function(speed, callback) {\n        if (this.workingElements.length === 2) {\n            return _super.prototype.render.call(this, speed, callback);\n        }\n        return this._renderInvalid(speed, callback);\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** render forward/reverse */\n    _renderList: function(speed, callback) {\n        //this.debug( '-- _renderList' );\n        //precondition: there are two valid elements in workingElements\n        var creator = this;\n\n        var $tmp = jQuery(\"<div/>\");\n        var $list = creator.$list();\n\n        // lose the original views, create the new, append all at once, then call their renders\n        _.each(this.elementViews, view => {\n            view.destroy();\n            creator.removeElementView(view);\n        });\n        $tmp.append(creator._createForwardElementView().$el);\n        $tmp.append(creator._createReverseElementView().$el);\n        $list.empty().append($tmp.children());\n        _.invoke(creator.elementViews, \"render\");\n    },\n\n    /** create the forward element view */\n    _createForwardElementView: function() {\n        return this._createElementView(this.workingElements[0], {\n            identifier: \"forward\"\n        });\n    },\n\n    /** create the forward element view */\n    _createReverseElementView: function() {\n        return this._createElementView(this.workingElements[1], {\n            identifier: \"reverse\"\n        });\n    },\n\n    /** create an element view, cache in elementViews, and return */\n    _createElementView: function(element, options) {\n        var elementView = new this.elementViewClass(\n            _.extend(options, {\n                element: element\n            })\n        );\n        this.elementViews.push(elementView);\n        return elementView;\n    },\n\n    /** swap the forward, reverse elements and re-render */\n    swap: function() {\n        this.workingElements = [this.workingElements[1], this.workingElements[0]];\n        this._renderList();\n    },\n\n    events: _.extend(_.clone(_super.prototype.events), {\n        \"click .swap\": \"swap\"\n    }),\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates: _.extend(_.clone(_super.prototype.templates), {\n        /** the middle: element list */\n        middle: _.template(\n            [\n                '<div class=\"collection-elements-controls\">',\n                '<a class=\"swap\" href=\"javascript:void(0);\" title=\"',\n                _l(\"Swap forward and reverse datasets\"),\n                '\">',\n                _l(\"Swap\"),\n                \"</a>\",\n                \"</div>\",\n                '<div class=\"collection-elements scroll-container flex-row\">',\n                \"</div>\"\n            ].join(\"\")\n        ),\n\n        /** help content */\n        helpContent: _.template(\n            [\n                \"<p>\",\n                _l(\n                    [\n                        \"Pair collections are permanent collections containing two datasets: one forward and one reverse. \",\n                        \"Often these are forward and reverse reads. The pair collections can be passed to tools and \",\n                        \"workflows in order to have analyses done on both datasets. This interface allows \",\n                        \"you to create a pair, name it, and swap which is forward and which reverse.\"\n                    ].join(\"\")\n                ),\n                \"</p>\",\n                \"<ul>\",\n                \"<li>\",\n                _l(\n                    [\n                        'Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ',\n                        \"and the reverse dataset forward.\"\n                    ].join(\"\")\n                ),\n                \"</li>\",\n                \"<li>\",\n                _l(['Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'].join(\"\")),\n                \"</li>\",\n                \"</ul><br />\",\n                \"<p>\",\n                _l(\n                    [\n                        'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                        'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n                    ].join(\"\")\n                ),\n                \"</p>\"\n            ].join(\"\")\n        ),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial: _.template(\n            [\n                '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                '<span class=\"alert-message\">',\n                \"<% if( _.size( problems ) ){ %>\",\n                _l(\"The following selections could not be included due to problems\"),\n                \"<ul><% _.each( problems, function( problem ){ %>\",\n                \"<li><b><%- problem.element.name %></b>: <%- problem.text %></li>\",\n                \"<% }); %></ul>\",\n                \"<% } else if( _.size( elements ) === 0 ){ %>\",\n                _l(\"No datasets were selected\"),\n                \".\",\n                \"<% } else if( _.size( elements ) === 1 ){ %>\",\n                _l(\"Only one dataset was selected\"),\n                \": <%- elements[0].name %>\",\n                \"<% } else if( _.size( elements ) > 2 ){ %>\",\n                _l(\"Too many datasets were selected\"),\n                ': <%- _.pluck( elements, \"name\" ).join( \", \") %>',\n                \"<% } %>\",\n                \"<br />\",\n                _l(\"Two (and only two) elements are needed for the pair\"),\n                \". \",\n                _l(\"You may need to \"),\n                '<a class=\"cancel-create\" href=\"javascript:void(0)\">',\n                _l(\"cancel\"),\n                \"</a> \",\n                _l(\"and reselect new elements\"),\n                \".\",\n                \"</span>\",\n                \"</div>\",\n                \"</div>\",\n                '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                '<div class=\"other-options pull-left\">',\n                '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                _l(\"Cancel\"),\n                \"</button>\",\n                // _l( 'Create a different kind of collection' ),\n                \"</div>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        )\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString: function() {\n        return \"PairCollectionCreator\";\n    }\n});\n\n//==============================================================================\n/** List collection flavor of collectionCreatorModal. */\nvar pairCollectionCreatorModal = function _pairCollectionCreatorModal(elements, options) {\n    options = options || {};\n    options.title = _l(\"Create a collection from a pair of datasets\");\n    return LIST_CREATOR.collectionCreatorModal(elements, options, PairCollectionCreator);\n};\n\n//==============================================================================\n/** Use a modal to create a pair collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createPairCollection(contents, defaultHideSourceItems) {\n    var elements = contents.toJSON();\n\n    var promise = pairCollectionCreatorModal(elements, {\n        defaultHideSourceItems: defaultHideSourceItems,\n        creationFn: function(elements, name, hideSourceItems) {\n            elements = [\n                { name: \"forward\", src: \"hda\", id: elements[0].id },\n                { name: \"reverse\", src: \"hda\", id: elements[1].id }\n            ];\n            return contents.createHDCA(elements, \"paired\", name, hideSourceItems);\n        }\n    });\n\n    return promise;\n}\n\n//==============================================================================\nexport default {\n    PairCollectionCreator: PairCollectionCreator,\n    pairCollectionCreatorModal: pairCollectionCreatorModal,\n    createPairCollection: createPairCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/pair-collection-creator.js","import levenshteinDistance from \"utils/levenshtein\";\nimport naturalSort from \"utils/natural-sort\";\nimport baseCreator from \"mvc/collection/base-creator\";\nimport baseMVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\nimport \"ui/hoverhighlight\";\n\nvar logNamespace = \"collections\";\n/* ============================================================================\nTODO:\n\n\nPROGRAMMATICALLY:\ncurrPanel.once( 'rendered', function(){\n    currPanel.showSelectors();\n    currPanel.selectAll();\n    _.last( currPanel.actionsPopup.options ).func();\n});\n\n============================================================================ */\n/** A view for paired datasets in the collections creator.\n */\nvar PairView = Backbone.View.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    tagName: \"li\",\n    className: \"dataset paired\",\n\n    initialize: function(attributes) {\n        this.pair = attributes.pair || {};\n    },\n\n    template: _.template(\n        [\n            '<span class=\"forward-dataset-name flex-column\"><%- pair.forward.name %></span>',\n            '<span class=\"pair-name-column flex-column\">',\n            '<span class=\"pair-name\"><%- pair.name %></span>',\n            \"</span>\",\n            '<span class=\"reverse-dataset-name flex-column\"><%- pair.reverse.name %></span>'\n        ].join(\"\")\n    ),\n\n    render: function() {\n        this.dragStartHandler = _.bind(this._dragstart, this);\n        this.dragEndHandler = _.bind(this._dragend, this);\n        var handle = this.$el\n            .attr(\"draggable\", true)\n            .data(\"pair\", this.pair)\n            .html(this.template({ pair: this.pair }))\n            .addClass(\"flex-column-container\")\n            .get(0);\n        handle.addEventListener(\"dragstart\", this.dragStartHandler, false);\n        handle.addEventListener(\"dragend\", this.dragEndHandler, false);\n        return this;\n    },\n\n    events: {\n        dragover: \"_sendToParent\",\n        drop: \"_sendToParent\"\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart: function(ev) {\n        ev.currentTarget.style.opacity = \"0.4\";\n        if (ev.originalEvent) {\n            ev = ev.originalEvent;\n        }\n\n        ev.dataTransfer.effectAllowed = \"move\";\n        ev.dataTransfer.setData(\"text/plain\", JSON.stringify(this.pair));\n\n        this.$el.parent().trigger(\"pair.dragstart\", [this]);\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragend: function(ev) {\n        ev.currentTarget.style.opacity = \"1.0\";\n        this.$el.parent().trigger(\"pair.dragend\", [this]);\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent: function(ev) {\n        this.$el.parent().trigger(ev);\n    },\n\n    /** string rep */\n    toString: function() {\n        return `PairView(${this.pair.name})`;\n    }\n});\n\n// ============================================================================\n/** returns an autopair function that uses the provided options.match function */\nfunction autoPairFnBuilder(options) {\n    options = options || {};\n    options.createPair =\n        options.createPair ||\n        function _defaultCreatePair(params) {\n            params = params || {};\n            var a = params.listA.splice(params.indexA, 1)[0];\n            var b = params.listB.splice(params.indexB, 1)[0];\n            var aInBIndex = params.listB.indexOf(a);\n            var bInAIndex = params.listA.indexOf(b);\n            if (aInBIndex !== -1) {\n                params.listB.splice(aInBIndex, 1);\n            }\n            if (bInAIndex !== -1) {\n                params.listA.splice(bInAIndex, 1);\n            }\n            return this._pair(a, b, { silent: true });\n        };\n    // compile these here outside of the loop\n    var _regexps = [];\n    function getRegExps() {\n        if (!_regexps.length) {\n            _regexps = [new RegExp(this.filters[0]), new RegExp(this.filters[1])];\n        }\n        return _regexps;\n    }\n    // mangle params as needed\n    options.preprocessMatch =\n        options.preprocessMatch ||\n        function _defaultPreprocessMatch(params) {\n            var regexps = getRegExps.call(this);\n            return _.extend(params, {\n                matchTo: params.matchTo.name.replace(regexps[0], \"\"),\n                possible: params.possible.name.replace(regexps[1], \"\")\n            });\n        };\n\n    return function _strategy(params) {\n        this.debug(\"autopair _strategy ---------------------------\");\n        params = params || {};\n        var listA = params.listA;\n        var listB = params.listB;\n        var indexA = 0;\n        var indexB;\n\n        var bestMatch = {\n            score: 0.0,\n            index: null\n        };\n\n        var paired = [];\n        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n        this.debug(\"starting list lens:\", listA.length, listB.length);\n        this.debug(\"bestMatch (starting):\", JSON.stringify(bestMatch, null, \"  \"));\n\n        while (indexA < listA.length) {\n            var matchTo = listA[indexA];\n            bestMatch.score = 0.0;\n\n            for (indexB = 0; indexB < listB.length; indexB++) {\n                var possible = listB[indexB];\n                this.debug(`${indexA}:${matchTo.name}`);\n                this.debug(`${indexB}:${possible.name}`);\n\n                // no matching with self\n                if (listA[indexA] !== listB[indexB]) {\n                    bestMatch = options.match.call(\n                        this,\n                        options.preprocessMatch.call(this, {\n                            matchTo: matchTo,\n                            possible: possible,\n                            index: indexB,\n                            bestMatch: bestMatch\n                        })\n                    );\n                    this.debug(\"bestMatch:\", JSON.stringify(bestMatch, null, \"  \"));\n                    if (bestMatch.score === 1.0) {\n                        this.debug(\"breaking early due to perfect match\");\n                        break;\n                    }\n                }\n            }\n            var scoreThreshold = options.scoreThreshold.call(this);\n            this.debug(\"scoreThreshold:\", scoreThreshold);\n            this.debug(\"bestMatch.score:\", bestMatch.score);\n\n            if (bestMatch.score >= scoreThreshold) {\n                //console.debug( 'autoPairFnBuilder.strategy', listA[ indexA ].name, listB[ bestMatch.index ].name );\n                paired.push(\n                    options.createPair.call(this, {\n                        listA: listA,\n                        indexA: indexA,\n                        listB: listB,\n                        indexB: bestMatch.index\n                    })\n                );\n                //console.debug( 'list lens now:', listA.length, listB.length );\n            } else {\n                indexA += 1;\n            }\n            if (!listA.length || !listB.length) {\n                return paired;\n            }\n        }\n        this.debug(\"paired:\", JSON.stringify(paired, null, \"  \"));\n        this.debug(\"autopair _strategy ---------------------------\");\n        return paired;\n    };\n}\n\n// ============================================================================\n/** An interface for building collections of paired datasets.\n */\nvar PairedCollectionCreator = Backbone.View.extend(baseMVC.LoggableMixin)\n    .extend(baseCreator.CollectionCreatorMixin)\n    .extend({\n        _logNamespace: logNamespace,\n\n        className: \"list-of-pairs-collection-creator collection-creator flex-row-container\",\n\n        /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n        initialize: function(attributes) {\n            this.metric(\"PairedCollectionCreator.initialize\", attributes);\n            //this.debug( '-- PairedCollectionCreator:', attributes );\n\n            attributes = _.defaults(attributes, {\n                datasets: [],\n                filters: this.DEFAULT_FILTERS,\n                automaticallyPair: true,\n                strategy: \"lcs\",\n                matchPercentage: 0.9,\n                twoPassAutopairing: true\n            });\n\n            /** unordered, original list */\n            this.initialList = attributes.datasets;\n\n            /** is this from a history? if so, what's its id? */\n            this.historyId = attributes.historyId;\n\n            /** which filters should be used initially? (String[2] or name in commonFilters) */\n            this.filters = this.commonFilters[attributes.filters] || this.commonFilters[this.DEFAULT_FILTERS];\n            if (_.isArray(attributes.filters)) {\n                this.filters = attributes.filters;\n            }\n\n            /** try to auto pair the unpaired datasets on load? */\n            this.automaticallyPair = attributes.automaticallyPair;\n\n            /** what method to use for auto pairing (will be passed aggression level) */\n            this.strategy = this.strategies[attributes.strategy] || this.strategies[this.DEFAULT_STRATEGY];\n            if (_.isFunction(attributes.strategy)) {\n                this.strategy = attributes.strategy;\n            }\n\n            /** distance/mismatch level allowed for autopairing */\n            this.matchPercentage = attributes.matchPercentage;\n\n            /** try to autopair using simple first, then this.strategy on the remainder */\n            this.twoPassAutopairing = attributes.twoPassAutopairing;\n\n            /** remove file extensions (\\.*) from created pair names? */\n            this.removeExtensions = true;\n            //this.removeExtensions = false;\n\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            this.oncancel = attributes.oncancel;\n            /** fn to call when the collection is created (scoped to this) */\n            this.oncreate = attributes.oncreate;\n\n            /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n            this.autoscrollDist = attributes.autoscrollDist || 24;\n\n            /** is the unpaired panel shown? */\n            this.unpairedPanelHidden = false;\n            /** is the paired panel shown? */\n            this.pairedPanelHidden = false;\n\n            /** DOM elements currently being dragged */\n            this.$dragging = null;\n\n            /** Used for blocking UI events during ajax/operations (don't post twice) */\n            this.blocking = false;\n\n            this._setUpCommonSettings(attributes);\n            this._setUpBehaviors();\n            this._dataSetUp();\n        },\n\n        /** map of common filter pairs by name */\n        commonFilters: {\n            illumina: [\"_1\", \"_2\"],\n            Rs: [\"_R1\", \"_R2\"]\n        },\n        /** which commonFilter to use by default */\n        DEFAULT_FILTERS: \"illumina\",\n\n        /** map of name->fn for autopairing */\n        strategies: {\n            simple: \"autopairSimple\",\n            lcs: \"autopairLCS\",\n            levenshtein: \"autopairLevenshtein\"\n        },\n        /** default autopair strategy name */\n        DEFAULT_STRATEGY: \"lcs\",\n\n        // ------------------------------------------------------------------------ process raw list\n        /** set up main data: cache initialList, sort, and autopair */\n        _dataSetUp: function() {\n            //this.debug( '-- _dataSetUp' );\n\n            this.paired = [];\n            this.unpaired = [];\n\n            this.selectedIds = [];\n\n            // sort initial list, add ids if needed, and save new working copy to unpaired\n            this._sortInitialList();\n            this._ensureIds();\n            this.unpaired = this.initialList.slice(0);\n\n            if (this.automaticallyPair) {\n                this.autoPair();\n                this.once(\"rendered:initial\", function() {\n                    this.trigger(\"autopair\");\n                });\n            }\n        },\n\n        /** sort initial list */\n        _sortInitialList: function() {\n            //this.debug( '-- _sortInitialList' );\n            this._sortDatasetList(this.initialList);\n        },\n\n        /** sort a list of datasets */\n        _sortDatasetList: function(list) {\n            // currently only natural sort by name\n            list.sort((a, b) => naturalSort(a.name, b.name));\n            return list;\n        },\n\n        /** add ids to dataset objs in initial list if none */\n        _ensureIds: function() {\n            this.initialList.forEach(dataset => {\n                if (!dataset.hasOwnProperty(\"id\")) {\n                    dataset.id = _.uniqueId();\n                }\n            });\n            return this.initialList;\n        },\n\n        /** split initial list into two lists, those that pass forward filters & those passing reverse */\n        _splitByFilters: function() {\n            var regexFilters = this.filters.map(stringFilter => new RegExp(stringFilter));\n\n            var split = [[], []];\n\n            function _filter(unpaired, filter) {\n                return filter.test(unpaired.name);\n                //return dataset.name.indexOf( filter ) >= 0;\n            }\n            this.unpaired.forEach(function _filterEach(unpaired) {\n                // 90% of the time this seems to work, but:\n                //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n                //  would need explanation in help as well\n                regexFilters.forEach((filter, i) => {\n                    if (_filter(unpaired, filter)) {\n                        split[i].push(unpaired);\n                    }\n                });\n            });\n            return split;\n        },\n\n        /** add a dataset to the unpaired list in it's proper order */\n        _addToUnpaired: function(dataset) {\n            // currently, unpaired is natural sorted by name, use binary search to find insertion point\n            var binSearchSortedIndex = (low, hi) => {\n                if (low === hi) {\n                    return low;\n                }\n\n                var mid = Math.floor((hi - low) / 2) + low;\n\n                var compared = naturalSort(dataset.name, this.unpaired[mid].name);\n\n                if (compared < 0) {\n                    return binSearchSortedIndex(low, mid);\n                } else if (compared > 0) {\n                    return binSearchSortedIndex(mid + 1, hi);\n                }\n                // walk the equal to find the last\n                while (this.unpaired[mid] && this.unpaired[mid].name === dataset.name) {\n                    mid++;\n                }\n                return mid;\n            };\n\n            this.unpaired.splice(binSearchSortedIndex(0, this.unpaired.length), 0, dataset);\n        },\n\n        // ------------------------------------------------------------------------ auto pairing\n        /** two passes to automatically create pairs:\n         *  use both simpleAutoPair, then the fn mentioned in strategy\n         */\n        autoPair: function(strategy) {\n            // split first using exact matching\n            var split = this._splitByFilters();\n\n            var paired = [];\n            if (this.twoPassAutopairing) {\n                paired = this.autopairSimple({\n                    listA: split[0],\n                    listB: split[1]\n                });\n                split = this._splitByFilters();\n            }\n\n            // uncomment to see printlns while running tests\n            //this.debug = function(){ console.log.apply( console, arguments ); };\n\n            // then try the remainder with something less strict\n            strategy = strategy || this.strategy;\n            split = this._splitByFilters();\n            paired = paired.concat(\n                this[strategy].call(this, {\n                    listA: split[0],\n                    listB: split[1]\n                })\n            );\n            return paired;\n        },\n\n        /** autopair by exact match */\n        autopairSimple: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return 0.6;\n            },\n            match: function _match(params) {\n                params = params || {};\n                if (params.matchTo === params.possible) {\n                    return {\n                        index: params.index,\n                        score: 1.0\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** autopair by levenshtein edit distance scoring */\n        autopairLevenshtein: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return this.matchPercentage;\n            },\n            match: function _matches(params) {\n                params = params || {};\n\n                var distance = levenshteinDistance(params.matchTo, params.possible);\n\n                var score = 1.0 - distance / Math.max(params.matchTo.length, params.possible.length);\n\n                if (score > params.bestMatch.score) {\n                    return {\n                        index: params.index,\n                        score: score\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** autopair by longest common substrings scoring */\n        autopairLCS: autoPairFnBuilder({\n            scoreThreshold: function() {\n                return this.matchPercentage;\n            },\n            match: function _matches(params) {\n                params = params || {};\n\n                var match = this._naiveStartingAndEndingLCS(params.matchTo, params.possible).length;\n\n                var score = match / Math.max(params.matchTo.length, params.possible.length);\n\n                if (score > params.bestMatch.score) {\n                    return {\n                        index: params.index,\n                        score: score\n                    };\n                }\n                return params.bestMatch;\n            }\n        }),\n\n        /** return the concat'd longest common prefix and suffix from two strings */\n        _naiveStartingAndEndingLCS: function(s1, s2) {\n            var fwdLCS = \"\";\n            var revLCS = \"\";\n            var i = 0;\n            var j = 0;\n            while (i < s1.length && i < s2.length) {\n                if (s1[i] !== s2[i]) {\n                    break;\n                }\n                fwdLCS += s1[i];\n                i += 1;\n            }\n            if (i === s1.length) {\n                return s1;\n            }\n            if (i === s2.length) {\n                return s2;\n            }\n\n            i = s1.length - 1;\n            j = s2.length - 1;\n            while (i >= 0 && j >= 0) {\n                if (s1[i] !== s2[j]) {\n                    break;\n                }\n                revLCS = [s1[i], revLCS].join(\"\");\n                i -= 1;\n                j -= 1;\n            }\n            return fwdLCS + revLCS;\n        },\n\n        // ------------------------------------------------------------------------ pairing / unpairing\n        /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n        _pair: function(fwd, rev, options) {\n            options = options || {};\n            this.debug(\"_pair:\", fwd, rev);\n            var pair = this._createPair(fwd, rev, options.name);\n            this.paired.push(pair);\n            this.unpaired = _.without(this.unpaired, fwd, rev);\n            if (!options.silent) {\n                this.trigger(\"pair:new\", pair);\n            }\n            return pair;\n        },\n\n        /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n        _createPair: function(fwd, rev, name) {\n            // ensure existance and don't pair something with itself\n            if (!(fwd && rev) || fwd === rev) {\n                throw new Error(`Bad pairing: ${[JSON.stringify(fwd), JSON.stringify(rev)]}`);\n            }\n            name = name || this._guessNameForPair(fwd, rev);\n            return { forward: fwd, name: name, reverse: rev };\n        },\n\n        /** try to find a good pair name for the given fwd and rev datasets */\n        _guessNameForPair: function(fwd, rev, removeExtensions) {\n            removeExtensions = removeExtensions !== undefined ? removeExtensions : this.removeExtensions;\n            var fwdName = fwd.name;\n            var revName = rev.name;\n\n            var lcs = this._naiveStartingAndEndingLCS(\n                fwdName.replace(new RegExp(this.filters[0]), \"\"),\n                revName.replace(new RegExp(this.filters[1]), \"\")\n            );\n\n            if (removeExtensions) {\n                var lastDotIndex = lcs.lastIndexOf(\".\");\n                if (lastDotIndex > 0) {\n                    var extension = lcs.slice(lastDotIndex, lcs.length);\n                    lcs = lcs.replace(extension, \"\");\n                    fwdName = fwdName.replace(extension, \"\");\n                    revName = revName.replace(extension, \"\");\n                }\n            }\n            return lcs || `${fwdName} & ${revName}`;\n        },\n\n        /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n        _unpair: function(pair, options) {\n            options = options || {};\n            if (!pair) {\n                throw new Error(`Bad pair: ${JSON.stringify(pair)}`);\n            }\n            this.paired = _.without(this.paired, pair);\n            this._addToUnpaired(pair.forward);\n            this._addToUnpaired(pair.reverse);\n\n            if (!options.silent) {\n                this.trigger(\"pair:unpair\", [pair]);\n            }\n            return pair;\n        },\n\n        /** unpair all paired datasets */\n        unpairAll: function() {\n            var pairs = [];\n            while (this.paired.length) {\n                pairs.push(this._unpair(this.paired[0], { silent: true }));\n            }\n            this.trigger(\"pair:unpair\", pairs);\n        },\n\n        // ------------------------------------------------------------------------ API\n        /** convert a pair into JSON compatible with the collections API */\n        _pairToJSON: function(pair, src) {\n            src = src || \"hda\";\n            //TODO: consider making this the pair structure when created instead\n            return {\n                collection_type: \"paired\",\n                src: \"new_collection\",\n                name: pair.name,\n                element_identifiers: [\n                    {\n                        name: \"forward\",\n                        id: pair.forward.id,\n                        src: src\n                    },\n                    {\n                        name: \"reverse\",\n                        id: pair.reverse.id,\n                        src: src\n                    }\n                ]\n            };\n        },\n\n        /** create the collection via the API\n         *  @returns {jQuery.xhr Object}    the jquery ajax request\n         */\n        createList: function(name) {\n            var self = this;\n\n            var url = `${Galaxy.root}api/histories/${this.historyId}/contents/dataset_collections`;\n\n            //TODO: use ListPairedCollection.create()\n            var ajaxData = {\n                type: \"dataset_collection\",\n                collection_type: \"list:paired\",\n                hide_source_items: self.hideOriginals || false,\n                name: _.escape(name || self.$(\".collection-name\").val()),\n                element_identifiers: self.paired.map(pair => self._pairToJSON(pair))\n            };\n            //this.debug( JSON.stringify( ajaxData ) );\n            self.blocking = true;\n            return jQuery\n                .ajax(url, {\n                    type: \"POST\",\n                    contentType: \"application/json\",\n                    dataType: \"json\",\n                    data: JSON.stringify(ajaxData)\n                })\n                .always(() => {\n                    self.blocking = false;\n                })\n                .fail((xhr, status, message) => {\n                    self._ajaxErrHandler(xhr, status, message);\n                })\n                .done(function(response, message, xhr) {\n                    //this.info( 'ok', response, message, xhr );\n                    self.trigger(\"collection:created\", response, message, xhr);\n                    self.metric(\"collection:created\", response);\n                    if (typeof self.oncreate === \"function\") {\n                        self.oncreate.call(this, response, message, xhr);\n                    }\n                });\n        },\n\n        /** handle ajax errors with feedback and details to the user (if available) */\n        _ajaxErrHandler: function(xhr, status, message) {\n            this.error(xhr, status, message);\n            var self = this;\n            var content = _l(\"An error occurred while creating this collection\");\n            if (xhr) {\n                if (xhr.readyState === 0 && xhr.status === 0) {\n                    content += `: ${_l(\"Galaxy could not be reached and may be updating.\")}${_l(\n                        \" Try again in a few minutes.\"\n                    )}`;\n                } else if (xhr.responseJSON) {\n                    content += `<br /><pre>${JSON.stringify(xhr.responseJSON)}</pre>`;\n                } else {\n                    content += `: ${message}`;\n                }\n            }\n            self._showAlert(content, \"alert-danger\");\n        },\n\n        // ------------------------------------------------------------------------ rendering\n        /** render the entire interface */\n        render: function(speed, callback) {\n            //this.debug( '-- _render' );\n            //this.$el.empty().html( this.templates.main() );\n            this.$el.empty().html(this.templates.main());\n            this._renderHeader(speed);\n            this._renderMiddle(speed);\n            this._renderFooter(speed);\n            this._addPluginComponents();\n            this.trigger(\"rendered\", this);\n            return this;\n        },\n\n        /** render the header section */\n        _renderHeader: function(speed, callback) {\n            //this.debug( '-- _renderHeader' );\n            var $header = this.$(\".header\")\n                .empty()\n                .html(this.templates.header())\n                .find(\".help-content\")\n                .prepend($(this.templates.helpContent()));\n\n            this._renderFilters();\n            return $header;\n        },\n        /** fill the filter inputs with the filter values */\n        _renderFilters: function() {\n            return this.$(\".forward-column .column-header input\")\n                .val(this.filters[0])\n                .add(this.$(\".reverse-column .column-header input\").val(this.filters[1]));\n        },\n\n        /** render the middle including unpaired and paired sections (which may be hidden) */\n        _renderMiddle: function(speed, callback) {\n            var $middle = this.$(\".middle\")\n                .empty()\n                .html(this.templates.middle());\n\n            // (re-) hide the un/paired panels based on instance vars\n            if (this.unpairedPanelHidden) {\n                this.$(\".unpaired-columns\").hide();\n            } else if (this.pairedPanelHidden) {\n                this.$(\".paired-columns\").hide();\n            }\n\n            this._renderUnpaired();\n            this._renderPaired();\n            return $middle;\n        },\n        /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n        _renderUnpaired: function(speed, callback) {\n            //this.debug( '-- _renderUnpaired' );\n            var self = this;\n\n            var $fwd;\n            var $rev;\n            var $prd = [];\n            var split = this._splitByFilters();\n            // update unpaired counts\n            this.$(\".forward-column .title\").text([split[0].length, _l(\"unpaired forward\")].join(\" \"));\n            this.$(\".forward-column .unpaired-info\").text(\n                this._renderUnpairedDisplayStr(this.unpaired.length - split[0].length)\n            );\n            this.$(\".reverse-column .title\").text([split[1].length, _l(\"unpaired reverse\")].join(\" \"));\n            this.$(\".reverse-column .unpaired-info\").text(\n                this._renderUnpairedDisplayStr(this.unpaired.length - split[1].length)\n            );\n\n            this.$(\".unpaired-columns .column-datasets\").empty();\n\n            // show/hide the auto pair button if any unpaired are left\n            this.$(\".autopair-link\").toggle(this.unpaired.length !== 0);\n            if (this.unpaired.length === 0) {\n                this._renderUnpairedEmpty();\n                return;\n            }\n\n            // create the dataset dom arrays\n            $rev = split[1].map((dataset, i) => {\n                // if there'll be a fwd dataset across the way, add a button to pair the row\n                if (split[0][i] !== undefined && split[0][i] !== dataset) {\n                    $prd.push(self._renderPairButton());\n                }\n                return self._renderUnpairedDataset(dataset);\n            });\n            $fwd = split[0].map(dataset => self._renderUnpairedDataset(dataset));\n\n            if (!$fwd.length && !$rev.length) {\n                this._renderUnpairedNotShown();\n                return;\n            }\n            // add to appropo cols\n            //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n            //  and swapping out that\n            this.$(\".unpaired-columns .forward-column .column-datasets\")\n                .append($fwd)\n                .add(this.$(\".unpaired-columns .paired-column .column-datasets\").append($prd))\n                .add(this.$(\".unpaired-columns .reverse-column .column-datasets\").append($rev));\n            this._adjUnpairedOnScrollbar();\n        },\n        /** return a string to display the count of filtered out datasets */\n        _renderUnpairedDisplayStr: function(numFiltered) {\n            return [\"(\", numFiltered, \" \", _l(\"filtered out\"), \")\"].join(\"\");\n        },\n        /** return an unattached jQuery DOM element to represent an unpaired dataset */\n        _renderUnpairedDataset: function(dataset) {\n            //TODO: to underscore template\n            return (\n                $(\"<li/>\")\n                    .attr(\"id\", `dataset-${dataset.id}`)\n                    .addClass(\"dataset unpaired\")\n                    .attr(\"draggable\", true)\n                    .addClass(dataset.selected ? \"selected\" : \"\")\n                    .append(\n                        $(\"<span/>\")\n                            .addClass(\"dataset-name\")\n                            .text(dataset.name)\n                    )\n                    //??\n                    .data(\"dataset\", dataset)\n            );\n        },\n        /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n        _renderPairButton: function() {\n            //TODO: *not* a dataset - don't pretend like it is\n            return $(\"<li/>\")\n                .addClass(\"dataset unpaired\")\n                .append(\n                    $(\"<span/>\")\n                        .addClass(\"dataset-name\")\n                        .text(_l(\"Pair these datasets\"))\n                );\n        },\n        /** a message to display when no unpaired left */\n        _renderUnpairedEmpty: function() {\n            //this.debug( '-- renderUnpairedEmpty' );\n            var $msg = $('<div class=\"empty-message\"></div>').text(`(${_l(\"no remaining unpaired datasets\")})`);\n            this.$(\".unpaired-columns .paired-column .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n        /** a message to display when no unpaired can be shown with the current filters */\n        _renderUnpairedNotShown: function() {\n            //this.debug( '-- renderUnpairedEmpty' );\n            var $msg = $('<div class=\"empty-message\"></div>').text(\n                `(${_l(\"no datasets were found matching the current filters\")})`\n            );\n            this.$(\".unpaired-columns .paired-column .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n        /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n        _adjUnpairedOnScrollbar: function() {\n            var $unpairedColumns = this.$(\".unpaired-columns\").last();\n\n            var $firstDataset = this.$(\".unpaired-columns .reverse-column .dataset\").first();\n\n            if (!$firstDataset.length) {\n                return;\n            }\n\n            var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth();\n\n            var dsRight = $firstDataset.offset().left + $firstDataset.outerWidth();\n\n            var rightDiff = Math.floor(ucRight) - Math.floor(dsRight);\n            //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n            this.$(\".unpaired-columns .forward-column\").css(\"margin-left\", rightDiff > 0 ? rightDiff : 0);\n        },\n\n        /** render the paired section and update counts of paired datasets */\n        _renderPaired: function(speed, callback) {\n            //this.debug( '-- _renderPaired' );\n            this.$(\".paired-column-title .title\").text([this.paired.length, _l(\"paired\")].join(\" \"));\n            // show/hide the unpair all link\n            this.$(\".unpair-all-link\").toggle(this.paired.length !== 0);\n            if (this.paired.length === 0) {\n                this._renderPairedEmpty();\n                return;\n                //TODO: would be best to return here (the $columns)\n            } else {\n                // show/hide 'remove extensions link' when any paired and they seem to have extensions\n                this.$(\".remove-extensions-link\").show();\n            }\n\n            this.$(\".paired-columns .column-datasets\").empty();\n            var self = this;\n            this.paired.forEach((pair, i) => {\n                //TODO: cache these?\n                var pairView = new PairView({ pair: pair });\n                self\n                    .$(\".paired-columns .column-datasets\")\n                    .append(pairView.render().$el)\n                    .append(\n                        [\n                            '<button class=\"unpair-btn\">',\n                            '<span class=\"fa fa-unlink\" title=\"',\n                            _l(\"Unpair\"),\n                            '\"></span>',\n                            \"</button>\"\n                        ].join(\"\")\n                    );\n            });\n        },\n        /** a message to display when none paired */\n        _renderPairedEmpty: function() {\n            var $msg = $('<div class=\"empty-message\"></div>').text(`(${_l(\"no paired datasets yet\")})`);\n            this.$(\".paired-columns .column-datasets\")\n                .empty()\n                .prepend($msg);\n            return $msg;\n        },\n\n        footerSettings: {\n            \".hide-originals\": \"hideOriginals\",\n            \".remove-extensions\": \"removeExtensions\"\n        },\n\n        /** add any jQuery/bootstrap/custom plugins to elements rendered */\n        _addPluginComponents: function() {\n            this._chooseFiltersPopover(\".choose-filters-link\");\n            this.$(\".help-content i\").hoverhighlight(\".collection-creator\", \"rgba( 64, 255, 255, 1.0 )\");\n        },\n\n        /** build a filter selection popover allowing selection of common filter pairs */\n        _chooseFiltersPopover: function(selector) {\n            function filterChoice(val1, val2) {\n                return [\n                    '<button class=\"filter-choice btn\" ',\n                    'data-forward=\"',\n                    val1,\n                    '\" data-reverse=\"',\n                    val2,\n                    '\">',\n                    _l(\"Forward\"),\n                    \": \",\n                    val1,\n                    \", \",\n                    _l(\"Reverse\"),\n                    \": \",\n                    val2,\n                    \"</button>\"\n                ].join(\"\");\n            }\n            var $popoverContent = $(\n                _.template(\n                    [\n                        '<div class=\"choose-filters\">',\n                        '<div class=\"help\">',\n                        _l(\"Choose from the following filters to change which unpaired reads are shown in the display\"),\n                        \":</div>\",\n                        _.values(this.commonFilters)\n                            .map(filterSet => filterChoice(filterSet[0], filterSet[1]))\n                            .join(\"\"),\n                        \"</div>\"\n                    ].join(\"\")\n                )({})\n            );\n\n            return this.$(selector).popover({\n                container: \".collection-creator\",\n                placement: \"bottom\",\n                html: true,\n                //animation   : false,\n                content: $popoverContent\n            });\n        },\n\n        /** add (or clear if clear is truthy) a validation warning to what */\n        _validationWarning: function(what, clear) {\n            var VALIDATION_CLASS = \"validation-warning\";\n            if (what === \"name\") {\n                what = this.$(\".collection-name\").add(this.$(\".collection-name-prompt\"));\n                this.$(\".collection-name\")\n                    .focus()\n                    .select();\n            }\n            if (clear) {\n                what = what || this.$(`.${VALIDATION_CLASS}`);\n                what.removeClass(VALIDATION_CLASS);\n            } else {\n                what.addClass(VALIDATION_CLASS);\n            }\n        },\n\n        // ------------------------------------------------------------------------ events\n        /** set up event handlers on self */\n        _setUpBehaviors: function() {\n            this.once(\"rendered\", function() {\n                this.trigger(\"rendered:initial\", this);\n            });\n\n            this.on(\"pair:new\", function() {\n                //TODO: ideally only re-render the columns (or even elements) involved\n                this._renderUnpaired();\n                this._renderPaired();\n\n                // scroll to bottom where new pairs are added\n                //TODO: this doesn't seem to work - innerHeight sticks at 133...\n                //  may have to do with improper flex columns\n                //var $pairedView = this.$( '.paired-columns' );\n                //$pairedView.scrollTop( $pairedView.innerHeight() );\n                //this.debug( $pairedView.height() )\n                this.$(\".paired-columns\").scrollTop(8000000);\n            });\n            this.on(\"pair:unpair\", function(pairs) {\n                //TODO: ideally only re-render the columns (or even elements) involved\n                this._renderUnpaired();\n                this._renderPaired();\n                this.splitView();\n            });\n\n            this.on(\"filter-change\", function() {\n                this.filters = [\n                    this.$(\".forward-unpaired-filter input\").val(),\n                    this.$(\".reverse-unpaired-filter input\").val()\n                ];\n                this.metric(\"filter-change\", this.filters);\n                this._renderFilters();\n                this._renderUnpaired();\n            });\n\n            this.on(\"autopair\", function() {\n                this._renderUnpaired();\n                this._renderPaired();\n\n                var message;\n                var msgClass = null;\n                if (this.paired.length) {\n                    msgClass = \"alert-success\";\n                    message = `${this.paired.length} ${_l(\"pairs created\")}`;\n                    if (!this.unpaired.length) {\n                        message += `: ${_l(\"all datasets have been successfully paired\")}`;\n                        this.hideUnpaired();\n                        this.$(\".collection-name\").focus();\n                    }\n                } else {\n                    message = _l(\n                        [\n                            \"Could not automatically create any pairs from the given dataset names.\",\n                            \"You may want to choose or enter different filters and try auto-pairing again.\",\n                            \"Close this message using the X on the right to view more help.\"\n                        ].join(\" \")\n                    );\n                }\n                this._showAlert(message, msgClass);\n            });\n\n            //this.on( 'all', function(){\n            //    this.info( arguments );\n            //});\n            return this;\n        },\n\n        events: {\n            // header\n            \"click .more-help\": \"_clickMoreHelp\",\n            \"click .less-help\": \"_clickLessHelp\",\n            \"click .main-help\": \"_toggleHelp\",\n            \"click .header .alert button\": \"_hideAlert\",\n            \"click .forward-column .column-title\": \"_clickShowOnlyUnpaired\",\n            \"click .reverse-column .column-title\": \"_clickShowOnlyUnpaired\",\n            \"click .unpair-all-link\": \"_clickUnpairAll\",\n            //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n            \"change .forward-unpaired-filter input\": function(ev) {\n                this.trigger(\"filter-change\");\n            },\n            \"focus .forward-unpaired-filter input\": function(ev) {\n                $(ev.currentTarget).select();\n            },\n            \"click .autopair-link\": \"_clickAutopair\",\n            \"click .choose-filters .filter-choice\": \"_clickFilterChoice\",\n            \"click .clear-filters-link\": \"_clearFilters\",\n            \"change .reverse-unpaired-filter input\": function(ev) {\n                this.trigger(\"filter-change\");\n            },\n            \"focus .reverse-unpaired-filter input\": function(ev) {\n                $(ev.currentTarget).select();\n            },\n            // unpaired\n            \"click .forward-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n            \"click .reverse-column .dataset.unpaired\": \"_clickUnpairedDataset\",\n            \"click .paired-column .dataset.unpaired\": \"_clickPairRow\",\n            \"click .unpaired-columns\": \"clearSelectedUnpaired\",\n            \"mousedown .unpaired-columns .dataset\": \"_mousedownUnpaired\",\n            // divider\n            \"click .paired-column-title\": \"_clickShowOnlyPaired\",\n            \"mousedown .flexible-partition-drag\": \"_startPartitionDrag\",\n            // paired\n            \"click .paired-columns .dataset.paired\": \"selectPair\",\n            \"click .paired-columns\": \"clearSelectedPaired\",\n            \"click .paired-columns .pair-name\": \"_clickPairName\",\n            \"click .unpair-btn\": \"_clickUnpair\",\n            // paired - drop target\n            //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n            //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n            \"dragover .paired-columns .column-datasets\": \"_dragoverPairedColumns\",\n            \"drop .paired-columns .column-datasets\": \"_dropPairedColumns\",\n\n            \"pair.dragstart .paired-columns .column-datasets\": \"_pairDragstart\",\n            \"pair.dragend   .paired-columns .column-datasets\": \"_pairDragend\",\n\n            // footer\n            \"change .remove-extensions\": function(ev) {\n                this.toggleExtensions();\n            },\n            \"change .collection-name\": \"_changeName\",\n            \"keydown .collection-name\": \"_nameCheckForEnter\",\n            \"change .hide-originals\": \"_changeHideOriginals\",\n            \"click .cancel-create\": \"_cancelCreate\",\n            \"click .create-collection\": \"_clickCreate\" //,\n        },\n\n        /** toggle between showing only unpaired and split view */\n        _clickShowOnlyUnpaired: function(ev) {\n            //this.debug( 'click unpaired', ev.currentTarget );\n            if (this.$(\".paired-columns\").is(\":visible\")) {\n                this.hidePaired();\n            } else {\n                this.splitView();\n            }\n        },\n        /** toggle between showing only paired and split view */\n        _clickShowOnlyPaired: function(ev) {\n            //this.debug( 'click paired' );\n            if (this.$(\".unpaired-columns\").is(\":visible\")) {\n                this.hideUnpaired();\n            } else {\n                this.splitView();\n            }\n        },\n\n        /** hide unpaired, show paired */\n        hideUnpaired: function(speed, callback) {\n            this.unpairedPanelHidden = true;\n            this.pairedPanelHidden = false;\n            this._renderMiddle(speed, callback);\n        },\n        /** hide paired, show unpaired */\n        hidePaired: function(speed, callback) {\n            this.unpairedPanelHidden = false;\n            this.pairedPanelHidden = true;\n            this._renderMiddle(speed, callback);\n        },\n        /** show both paired and unpaired (splitting evenly) */\n        splitView: function(speed, callback) {\n            this.unpairedPanelHidden = this.pairedPanelHidden = false;\n            this._renderMiddle(speed, callback);\n            return this;\n        },\n\n        /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n        _clickUnpairAll: function(ev) {\n            this.metric(\"unpairAll\");\n            this.unpairAll();\n        },\n\n        /** attempt to autopair */\n        _clickAutopair: function(ev) {\n            var paired = this.autoPair();\n            this.metric(\"autopair\", paired.length, this.unpaired.length);\n            this.trigger(\"autopair\");\n        },\n\n        /** set the filters based on the data attributes of the button click target */\n        _clickFilterChoice: function(ev) {\n            var $selected = $(ev.currentTarget);\n            this.$(\".forward-unpaired-filter input\").val($selected.data(\"forward\"));\n            this.$(\".reverse-unpaired-filter input\").val($selected.data(\"reverse\"));\n            this._hideChooseFilters();\n            this.trigger(\"filter-change\");\n        },\n\n        /** hide the choose filters popover */\n        _hideChooseFilters: function() {\n            //TODO: update bootstrap and remove the following hack\n            //  see also: https://github.com/twbs/bootstrap/issues/10260\n            this.$(\".choose-filters-link\").popover(\"hide\");\n            this.$(\".popover\").css(\"display\", \"none\");\n        },\n\n        /** clear both filters */\n        _clearFilters: function(ev) {\n            this.$(\".forward-unpaired-filter input\").val(\"\");\n            this.$(\".reverse-unpaired-filter input\").val(\"\");\n            this.trigger(\"filter-change\");\n        },\n\n        // ........................................................................ unpaired\n        /** select an unpaired dataset */\n        _clickUnpairedDataset: function(ev) {\n            ev.stopPropagation();\n            return this.toggleSelectUnpaired($(ev.currentTarget));\n        },\n\n        /** Toggle the selection of an unpaired dataset representation.\n         *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n         *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n         */\n        toggleSelectUnpaired: function($dataset, options) {\n            options = options || {};\n            var dataset = $dataset.data(\"dataset\");\n\n            var select = options.force !== undefined ? options.force : !$dataset.hasClass(\"selected\");\n\n            //this.debug( id, options.force, $dataset, dataset );\n            if (!$dataset.length || dataset === undefined) {\n                return $dataset;\n            }\n\n            if (select) {\n                $dataset.addClass(\"selected\");\n                if (!options.waitToPair) {\n                    this.pairAllSelected();\n                }\n            } else {\n                $dataset.removeClass(\"selected\");\n                //delete dataset.selected;\n            }\n            return $dataset;\n        },\n\n        /** pair all the currently selected unpaired datasets */\n        pairAllSelected: function(options) {\n            options = options || {};\n            var self = this;\n            var fwds = [];\n            var revs = [];\n            var pairs = [];\n            self.$(\".unpaired-columns .forward-column .dataset.selected\").each(function() {\n                fwds.push($(this).data(\"dataset\"));\n            });\n            self.$(\".unpaired-columns .reverse-column .dataset.selected\").each(function() {\n                revs.push($(this).data(\"dataset\"));\n            });\n            fwds.length = revs.length = Math.min(fwds.length, revs.length);\n            //this.debug( fwds );\n            //this.debug( revs );\n            fwds.forEach((fwd, i) => {\n                try {\n                    pairs.push(self._pair(fwd, revs[i], { silent: true }));\n                } catch (err) {\n                    //TODO: preserve selected state of those that couldn't be paired\n                    //TODO: warn that some could not be paired\n                    self.error(err);\n                }\n            });\n            if (pairs.length && !options.silent) {\n                this.trigger(\"pair:new\", pairs);\n            }\n            return pairs;\n        },\n\n        /** clear the selection on all unpaired datasets */\n        clearSelectedUnpaired: function() {\n            this.$(\".unpaired-columns .dataset.selected\").removeClass(\"selected\");\n        },\n\n        /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n        _mousedownUnpaired: function(ev) {\n            if (ev.shiftKey) {\n                var self = this;\n                var $startTarget = $(ev.target).addClass(\"selected\");\n\n                var moveListener = ev => {\n                    self\n                        .$(ev.target)\n                        .filter(\".dataset\")\n                        .addClass(\"selected\");\n                };\n\n                $startTarget.parent().on(\"mousemove\", moveListener);\n\n                // on any mouseup, stop listening to the move and try to pair any selected\n                $(document).one(\"mouseup\", ev => {\n                    $startTarget.parent().off(\"mousemove\", moveListener);\n                    self.pairAllSelected();\n                });\n            }\n        },\n\n        /** attempt to pair two datasets directly across from one another */\n        _clickPairRow: function(ev) {\n            //if( !ev.currentTarget ){ return true; }\n            var rowIndex = $(ev.currentTarget).index();\n\n            var fwd = $(\".unpaired-columns .forward-column .dataset\")\n                .eq(rowIndex)\n                .data(\"dataset\");\n\n            var rev = $(\".unpaired-columns .reverse-column .dataset\")\n                .eq(rowIndex)\n                .data(\"dataset\");\n\n            //this.debug( 'row:', rowIndex, fwd, rev );\n            this._pair(fwd, rev);\n        },\n\n        // ........................................................................ divider/partition\n        /** start dragging the visible divider/partition between unpaired and paired panes */\n        _startPartitionDrag: function(ev) {\n            var self = this;\n            var startingY = ev.pageY;\n            //this.debug( 'partition drag START:', ev );\n            $(\"body\").css(\"cursor\", \"ns-resize\");\n            self.$(\".flexible-partition-drag\").css(\"color\", \"black\");\n\n            function endDrag(ev) {\n                self.$(\".flexible-partition-drag\").css(\"color\", \"\");\n                $(\"body\")\n                    .css(\"cursor\", \"\")\n                    .unbind(\"mousemove\", trackMouse);\n            }\n            function trackMouse(ev) {\n                var offset = ev.pageY - startingY;\n                if (!self.adjPartition(offset)) {\n                    $(\"body\").trigger(\"mouseup\");\n                }\n                self._adjUnpairedOnScrollbar();\n                startingY += offset;\n            }\n            $(\"body\").mousemove(trackMouse);\n            $(\"body\").one(\"mouseup\", endDrag);\n        },\n\n        /** adjust the parition up/down +/-adj pixels */\n        adjPartition: function(adj) {\n            var $unpaired = this.$(\".unpaired-columns\");\n            var $paired = this.$(\".paired-columns\");\n            var unpairedHi = parseInt($unpaired.css(\"height\"), 10);\n            var pairedHi = parseInt($paired.css(\"height\"), 10);\n            //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\n            unpairedHi = Math.max(10, unpairedHi + adj);\n            pairedHi = pairedHi - adj;\n\n            var movingUpwards = adj < 0;\n            // when the divider gets close to the top - lock into hiding the unpaired section\n            if (movingUpwards) {\n                if (this.unpairedPanelHidden) {\n                    return false;\n                } else if (unpairedHi <= 10) {\n                    this.hideUnpaired();\n                    return false;\n                }\n            } else {\n                if (this.unpairedPanelHidden) {\n                    $unpaired.show();\n                    this.unpairedPanelHidden = false;\n                }\n            }\n\n            // when the divider gets close to the bottom - lock into hiding the paired section\n            if (!movingUpwards) {\n                if (this.pairedPanelHidden) {\n                    return false;\n                } else if (pairedHi <= 15) {\n                    this.hidePaired();\n                    return false;\n                }\n            } else {\n                if (this.pairedPanelHidden) {\n                    $paired.show();\n                    this.pairedPanelHidden = false;\n                }\n            }\n\n            $unpaired.css({\n                height: `${unpairedHi}px`,\n                flex: \"0 0 auto\"\n            });\n            return true;\n        },\n\n        // ........................................................................ paired\n        /** select a pair when clicked */\n        selectPair: function(ev) {\n            ev.stopPropagation();\n            $(ev.currentTarget).toggleClass(\"selected\");\n        },\n\n        /** deselect all pairs */\n        clearSelectedPaired: function(ev) {\n            this.$(\".paired-columns .dataset.selected\").removeClass(\"selected\");\n        },\n\n        /** rename a pair when the pair name is clicked */\n        _clickPairName: function(ev) {\n            ev.stopPropagation();\n            var $name = $(ev.currentTarget);\n            var $pair = $name.parent().parent();\n            var index = $pair.index(\".dataset.paired\");\n            var pair = this.paired[index];\n            var response = prompt(\"Enter a new name for the pair:\", pair.name);\n            if (response) {\n                pair.name = response;\n                // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n                //  when adding/removing extensions\n                //hackish\n                pair.customizedName = true;\n                $name.text(pair.name);\n            }\n        },\n\n        /** unpair this pair */\n        _clickUnpair: function(ev) {\n            //if( !ev.currentTarget ){ return true; }\n            var pairIndex = Math.floor($(ev.currentTarget).index(\".unpair-btn\"));\n            //this.debug( 'pair:', pairIndex );\n            this._unpair(this.paired[pairIndex]);\n        },\n\n        // ........................................................................ paired - drag and drop re-ordering\n        //_dragenterPairedColumns : function( ev ){\n        //    this.debug( '_dragenterPairedColumns:', ev );\n        //},\n        //_dragleavePairedColumns : function( ev ){\n        //    //this.debug( '_dragleavePairedColumns:', ev );\n        //},\n        /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n        _dragoverPairedColumns: function(ev) {\n            //this.debug( '_dragoverPairedColumns:', ev );\n            ev.preventDefault();\n\n            var $list = this.$(\".paired-columns .column-datasets\");\n            this._checkForAutoscroll($list, ev.originalEvent.clientY);\n            //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n\n            $(\".element-drop-placeholder\").remove();\n            var $placeholder = $('<div class=\"element-drop-placeholder\"></div>');\n            if (!$nearest.length) {\n                $list.append($placeholder);\n            } else {\n                $nearest.before($placeholder);\n            }\n        },\n\n        /** If the mouse is near enough to the list's top or bottom, scroll the list */\n        _checkForAutoscroll: function($element, y) {\n            var AUTOSCROLL_SPEED = 2;\n            var offset = $element.offset();\n            var scrollTop = $element.scrollTop();\n            var upperDist = y - offset.top;\n            var lowerDist = offset.top + $element.outerHeight() - y;\n            //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n            if (upperDist >= 0 && upperDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop - AUTOSCROLL_SPEED);\n            } else if (lowerDist >= 0 && lowerDist < this.autoscrollDist) {\n                $element.scrollTop(scrollTop + AUTOSCROLL_SPEED);\n            }\n        },\n\n        /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n         *      If the y is at the end of the list, return an empty jQuery object.\n         */\n        _getNearestPairedDatasetLi: function(y) {\n            var WIGGLE = 4;\n            var lis = this.$(\".paired-columns .column-datasets li\").toArray();\n            for (var i = 0; i < lis.length; i++) {\n                var $li = $(lis[i]);\n                var top = $li.offset().top;\n                var halfHeight = Math.floor($li.outerHeight() / 2) + WIGGLE;\n                if (top + halfHeight > y && top - halfHeight < y) {\n                    //this.debug( y, top + halfHeight, top - halfHeight )\n                    return $li;\n                }\n            }\n            return $();\n        },\n        /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n        _dropPairedColumns: function(ev) {\n            // both required for firefox\n            ev.preventDefault();\n            ev.dataTransfer.dropEffect = \"move\";\n\n            var $nearest = this._getNearestPairedDatasetLi(ev.originalEvent.clientY);\n            if ($nearest.length) {\n                this.$dragging.insertBefore($nearest);\n            } else {\n                // no nearest before - insert after last element (unpair button)\n                this.$dragging.insertAfter(this.$(\".paired-columns .unpair-btn\").last());\n            }\n            // resync the creator's list of paired based on the new DOM order\n            this._syncPairsToDom();\n            return false;\n        },\n        /** resync the creator's list of paired based on the DOM order of pairs */\n        _syncPairsToDom: function() {\n            var newPaired = [];\n            //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n            this.$(\".paired-columns .dataset.paired\").each(function() {\n                newPaired.push($(this).data(\"pair\"));\n            });\n            //this.debug( newPaired );\n            this.paired = newPaired;\n            this._renderPaired();\n        },\n        /** drag communication with pair sub-views: dragstart */\n        _pairDragstart: function(ev, pair) {\n            //this.debug( '_pairDragstart', ev, pair )\n            // auto select the pair causing the event and move all selected\n            pair.$el.addClass(\"selected\");\n            var $selected = this.$(\".paired-columns .dataset.selected\");\n            this.$dragging = $selected;\n        },\n        /** drag communication with pair sub-views: dragend - remove the placeholder */\n        _pairDragend: function(ev, pair) {\n            //this.debug( '_pairDragend', ev, pair )\n            $(\".element-drop-placeholder\").remove();\n            this.$dragging = null;\n        },\n\n        // ........................................................................ footer\n        toggleExtensions: function(force) {\n            var self = this;\n            self.removeExtensions = force !== undefined ? force : !self.removeExtensions;\n\n            _.each(self.paired, pair => {\n                // don't overwrite custom names\n                if (pair.customizedName) {\n                    return;\n                }\n                pair.name = self._guessNameForPair(pair.forward, pair.reverse);\n            });\n\n            self._renderPaired();\n            self._renderFooter();\n        },\n\n        // ------------------------------------------------------------------------ misc\n        /** debug a dataset list */\n        _printList: function(list) {\n            var self = this;\n            _.each(list, e => {\n                if (list === self.paired) {\n                    self._printPair(e);\n                } else {\n                    self.debug(e);\n                }\n            });\n        },\n\n        /** print a pair Object */\n        _printPair: function(pair) {\n            this.debug(pair.forward.name, pair.reverse.name, \": ->\", pair.name);\n        },\n\n        /** string rep */\n        toString: function() {\n            return \"PairedCollectionCreator\";\n        },\n\n        templates: _.extend({}, baseCreator.CollectionCreatorMixin._creatorTemplates, {\n            /** the header (not including help text) */\n            header: _.template(\n                [\n                    '<div class=\"main-help well clear\">',\n                    '<a class=\"more-help\" href=\"javascript:void(0);\">',\n                    _l(\"More help\"),\n                    \"</a>\",\n                    '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">',\n                    _l(\"Less\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"alert alert-dismissable\">',\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>',\n                    '<span class=\"alert-message\"></span>',\n                    \"</div>\",\n\n                    '<div class=\"column-headers vertically-spaced flex-column-container\">',\n                    '<div class=\"forward-column flex-column column\">',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                    '<span class=\"title\">',\n                    _l(\"Unpaired forward\"),\n                    \"</span>\",\n                    '<span class=\"title-info unpaired-info\"></span>',\n                    \"</div>\",\n                    '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">',\n                    '<input class=\"search-query\" placeholder=\"',\n                    _l(\"Filter this list\"),\n                    '\" />',\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"paired-column flex-column no-flex column\">',\n                    '<div class=\"column-header\">',\n                    '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">',\n                    _l(\"Choose filters\"),\n                    \"</a>\",\n                    '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">',\n                    _l(\"Clear filters\"),\n                    \"</a><br />\",\n                    '<a class=\"autopair-link\" href=\"javascript:void(0);\">',\n                    _l(\"Auto-pair\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"reverse-column flex-column column\">',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                    '<span class=\"title\">',\n                    _l(\"Unpaired reverse\"),\n                    \"</span>\",\n                    '<span class=\"title-info unpaired-info\"></span>',\n                    \"</div>\",\n                    '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">',\n                    '<input class=\"search-query\" placeholder=\"',\n                    _l(\"Filter this list\"),\n                    '\" />',\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** the middle: unpaired, divider, and paired */\n            middle: _.template(\n                [\n                    // contains two flex rows (rows that fill available space) and a divider btwn\n                    '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">',\n                    '<div class=\"forward-column flex-column column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    '<div class=\"paired-column flex-column no-flex column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    '<div class=\"reverse-column flex-column column\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"flexible-partition\">',\n                    '<div class=\"flexible-partition-drag\" title=\"',\n                    _l(\"Drag to change\"),\n                    '\"></div>',\n                    '<div class=\"column-header\">',\n                    '<div class=\"column-title paired-column-title\">',\n                    '<span class=\"title\"></span>',\n                    \"</div>\",\n                    '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">',\n                    _l(\"Unpair all\"),\n                    \"</a>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div class=\"paired-columns flex-column-container scroll-container flex-row\">',\n                    '<ol class=\"column-datasets\"></ol>',\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** creation and cancel controls */\n            footer: _.template(\n                [\n                    '<div class=\"attributes clear\">',\n                    '<div class=\"clear\">',\n                    '<label class=\"setting-prompt pull-right\">',\n                    _l(\"Hide original elements\"),\n                    \"?\",\n                    '<input class=\"hide-originals pull-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    '<label class=\"setting-prompt pull-right\">',\n                    _l(\"Remove file extensions from pair names\"),\n                    \"?\",\n                    '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />',\n                    \"</label>\",\n                    \"</div>\",\n                    '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control pull-right\" ',\n                    'placeholder=\"',\n                    _l(\"Enter a name for your new list\"),\n                    '\" />',\n                    '<div class=\"collection-name-prompt pull-right\">',\n                    _l(\"Name\"),\n                    \":</div>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">',\n                    _l(\"Cancel\"),\n                    \"</button>\",\n                    '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l(\"Create a different kind of collection\"),\n                    ' <span class=\"caret\"></span>',\n                    \"</button>\",\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<li><a href=\"#\">',\n                    _l(\"Create a <i>single</i> pair\"),\n                    \"</a></li>\",\n                    '<li><a href=\"#\">',\n                    _l(\"Create a list of <i>unpaired</i> datasets\"),\n                    \"</a></li>\",\n                    \"</ul>\",\n                    \"</div>\",\n                    \"</div>\",\n\n                    '<div class=\"main-options pull-right\">',\n                    '<button class=\"create-collection btn btn-primary\">',\n                    _l(\"Create list\"),\n                    \"</button>\",\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            ),\n\n            /** help content */\n            helpContent: _.template(\n                [\n                    \"<p>\",\n                    _l(\n                        [\n                            \"Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). \",\n                            \"These collections can be passed to tools and workflows in order to have analyses done on each member of \",\n                            \"the entire group. This interface allows you to create a collection, choose which datasets are paired, \",\n                            \"and re-order the final collection.\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ',\n                            \"(hover over the underlined words to highlight below). \",\n                            'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.',\n                            \"<ul>To pair datasets, you can:\",\n                            \"<li>Click a dataset in the \",\n                            '<i data-target=\".unpaired-columns .forward-column .column-datasets,',\n                            '.unpaired-columns .forward-column\">forward column</i> ',\n                            \"to select it then click a dataset in the \",\n                            '<i data-target=\".unpaired-columns .reverse-column .column-datasets,',\n                            '.unpaired-columns .reverse-column\">reverse column</i>.',\n                            \"</li>\",\n                            '<li>Click one of the \"Pair these datasets\" buttons in the ',\n                            '<i data-target=\".unpaired-columns .paired-column .column-datasets,',\n                            '.unpaired-columns .paired-column\">middle column</i> ',\n                            \"to pair the datasets in a particular row.\",\n                            \"</li>\",\n                            '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ',\n                            \"to have your datasets automatically paired based on name.\",\n                            \"</li>\",\n                            \"</ul>\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            \"<ul>You can filter what is shown in the unpaired sections by:\",\n                            \"<li>Entering partial dataset names in either the \",\n                            '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ',\n                            '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.',\n                            \"</li>\",\n                            \"<li>Choosing from a list of preset filters by clicking the \",\n                            '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.',\n                            \"</li>\",\n                            \"<li>Entering regular expressions to match dataset names. See: \",\n                            '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"',\n                            ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ',\n                            \"Note: forward slashes (\\\\) are not needed.\",\n                            \"</li>\",\n                            \"<li>Clearing the filters by clicking the \",\n                            '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.',\n                            \"</li>\",\n                            \"</ul>\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            \"To unpair individual dataset pairs, click the \",\n                            '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ',\n                            'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ',\n                            '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'\n                        ].join(\"\")\n                    ),\n                    \"</p>\",\n                    \"<p>\",\n                    _l(\n                        [\n                            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                            'click <i data-target=\".create-collection\">\"Create list\"</i>. ',\n                            \"(Note: you do not have to pair all unpaired datasets to finish.)\"\n                        ].join(\"\")\n                    ),\n                    \"</p>\"\n                ].join(\"\")\n            )\n        })\n    });\n\n//=============================================================================\n/** a modal version of the paired collection creator */\nvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal(datasets, options) {\n    var deferred = jQuery.Deferred();\n    var creator;\n\n    options = _.defaults(options || {}, {\n        datasets: datasets,\n        oncancel: function() {\n            Galaxy.modal.hide();\n            deferred.reject(\"cancelled\");\n        },\n        oncreate: function(creator, response) {\n            Galaxy.modal.hide();\n            deferred.resolve(response);\n        }\n    });\n\n    if (!window.Galaxy || !Galaxy.modal) {\n        throw new Error(\"Galaxy or Galaxy.modal not found\");\n    }\n\n    creator = new PairedCollectionCreator(options);\n    Galaxy.modal.show({\n        title: \"Create a collection of paired datasets\",\n        body: creator.$el,\n        width: \"80%\",\n        height: \"800px\",\n        closing_events: true\n    });\n    creator.render();\n    window.creator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n//=============================================================================\nfunction createListOfPairsCollection(collection, defaultHideSourceItems) {\n    var elements = collection.toJSON();\n    //TODO: validate elements\n    return pairedCollectionCreatorModal(elements, {\n        historyId: collection.historyId,\n        defaultHideSourceItems: defaultHideSourceItems\n    });\n}\n\n//=============================================================================\nexport default {\n    PairedCollectionCreator: PairedCollectionCreator,\n    pairedCollectionCreatorModal: pairedCollectionCreatorModal,\n    createListOfPairsCollection: createListOfPairsCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js","//=============================================================================\n/**\n(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\nCopyright (c) 2011 Andrei Mackenzie\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\nSoftware.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// Compute the edit distance between the two given strings\n//exports.getEditDistance = function(a, b){\nfunction levenshteinDistance(a, b) {\n    if (a.length === 0) {\n        return b.length;\n    }\n    if (b.length === 0) {\n        return a.length;\n    }\n\n    var matrix = [];\n\n    // increment along the first column of each row\n    var i;\n    for (i = 0; i <= b.length; i++) {\n        matrix[i] = [i];\n    }\n\n    // increment each column in the first row\n    var j;\n    for (j = 0; j <= a.length; j++) {\n        matrix[0][j] = j;\n    }\n\n    // Fill in the rest of the matrix\n    for (i = 1; i <= b.length; i++) {\n        for (j = 1; j <= a.length; j++) {\n            if (b.charAt(i - 1) === a.charAt(j - 1)) {\n                matrix[i][j] = matrix[i - 1][j - 1];\n            } else {\n                matrix[i][j] = Math.min(\n                    matrix[i - 1][j - 1] + 1, // substitution\n                    Math.min(\n                        matrix[i][j - 1] + 1, // insertion\n                        matrix[i - 1][j] + 1\n                    )\n                ); // deletion\n            }\n        }\n    }\n\n    //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n    return matrix[b.length][a.length];\n}\n\n//=============================================================================\nexport default levenshteinDistance;\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/utils/levenshtein.js","/** User Preferences view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport QueryStringParsing from \"utils/query-string-parsing\";\n/** Contains descriptive dictionaries describing user forms */\nvar Model = Backbone.Model.extend({\n    initialize: function(options) {\n        options = options || {};\n        options.user_id = options.user_id || Galaxy.user.id;\n        this.set({\n            user_id: options.user_id,\n            information: {\n                title: \"Manage information\",\n                description: \"Edit your email, addresses and custom parameters or change your username.\",\n                url: `api/users/${options.user_id}/information/inputs`,\n                icon: \"fa-user\",\n                redirect: \"user\"\n            },\n            password: {\n                title: \"Change password\",\n                description: \"Allows you to change your login credentials.\",\n                icon: \"fa-unlock-alt\",\n                url: `api/users/${options.user_id}/password/inputs`,\n                submit_title: \"Save password\",\n                redirect: \"user\"\n            },\n            communication: {\n                title: \"Change communication settings\",\n                description: \"Enable or disable the communication feature to chat with other users.\",\n                url: `api/users/${options.user_id}/communication/inputs`,\n                icon: \"fa-comments-o\",\n                redirect: \"user\"\n            },\n            permissions: {\n                title: \"Set dataset permissions for new histories\",\n                description:\n                    \"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.\",\n                url: `api/users/${options.user_id}/permissions/inputs`,\n                icon: \"fa-users\",\n                submit_title: \"Save permissions\",\n                redirect: \"user\"\n            },\n            api_key: {\n                title: \"Manage API key\",\n                description: \"Access your current API key or create a new one.\",\n                url: `api/users/${options.user_id}/api_key/inputs`,\n                icon: \"fa-key\",\n                submit_title: \"Create a new key\",\n                submit_icon: \"fa-check\"\n            },\n            toolbox_filters: {\n                title: \"Manage Toolbox filters\",\n                description: \"Customize your Toolbox by displaying or omitting sets of Tools.\",\n                url: `api/users/${options.user_id}/toolbox_filters/inputs`,\n                icon: \"fa-filter\",\n                submit_title: \"Save filters\",\n                redirect: \"user\"\n            },\n            openids: {\n                title: \"Manage OpenIDs\",\n                description: \"Associate OpenIDs with your account.\",\n                icon: \"fa-openid\",\n                onclick: function() {\n                    window.location.href = `${Galaxy.root}user/openid_manage?cntrller=user&use_panels=True`;\n                }\n            },\n            custom_builds: {\n                title: \"Manage custom builds\",\n                description: \"Add or remove custom builds using history datasets.\",\n                icon: \"fa-cubes\",\n                onclick: function() {\n                    window.location.href = `${Galaxy.root}custom_builds`;\n                }\n            },\n            logout: {\n                title: \"Sign out\",\n                description: \"Click here to sign out of all sessions.\",\n                icon: \"fa-sign-out\",\n                onclick: function() {\n                    Galaxy.modal.show({\n                        title: \"Sign out\",\n                        body: \"Do you want to continue and sign out of all active sessions?\",\n                        buttons: {\n                            Cancel: function() {\n                                Galaxy.modal.hide();\n                            },\n                            \"Sign out\": function() {\n                                window.location.href = `${Galaxy.root}user/logout?session_csrf_token=${\n                                    Galaxy.session_csrf_token\n                                }`;\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    }\n});\n\n/** View of the main user preference panel with links to individual user forms */\nvar View = Backbone.View.extend({\n    title: \"User Preferences\",\n    initialize: function() {\n        this.model = new Model();\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        var config = Galaxy.config;\n        $.getJSON(`${Galaxy.root}api/users/${Galaxy.user.id}`, data => {\n            self.$preferences = $(\"<div/>\")\n                .addClass(\"ui-panel\")\n                .append($(\"<h2/>\").append(\"User preferences\"))\n                .append($(\"<p/>\").append(`You are logged in as <strong>${_.escape(data.email)}</strong>.`))\n                .append((self.$table = $(\"<table/>\").addClass(\"ui-panel-table\")));\n            var message = QueryStringParsing.get(\"message\");\n            var status = QueryStringParsing.get(\"status\");\n            if (message && status) {\n                self.$preferences.prepend(new Ui.Message({ message: message, status: status }).$el);\n            }\n            if (!config.use_remote_user) {\n                self._addLink(\"information\");\n                self._addLink(\"password\");\n            }\n            if (config.enable_communication_server) {\n                self._addLink(\"communication\");\n            }\n            self._addLink(\"custom_builds\");\n            self._addLink(\"permissions\");\n            self._addLink(\"api_key\");\n            if (config.has_user_tool_filters) {\n                self._addLink(\"toolbox_filters\");\n            }\n            if (config.enable_openid && !config.use_remote_user) {\n                self._addLink(\"openids\");\n            }\n            if (Galaxy.session_csrf_token) {\n                self._addLink(\"logout\");\n            }\n            self.$preferences.append(self._templateFooter(data));\n            self.$el.empty().append(self.$preferences);\n        });\n    },\n\n    _addLink: function(action) {\n        var options = this.model.get(action);\n        var $row = $(this._templateLink(options));\n        var $a = $row.find(\"a\");\n        if (options.onclick) {\n            $a.on(\"click\", () => {\n                options.onclick();\n            });\n        } else {\n            $a.attr(\"href\", `${Galaxy.root}user/${action}`);\n        }\n        this.$table.append($row);\n    },\n\n    _templateLink: function(options) {\n        return `<tr><td><div class=\"ui-panel-icon fa ${\n            options.icon\n        }\"></td><td><a class=\"ui-panel-anchor\" href=\"javascript:void(0)\">${\n            options.title\n        }</a><div class=\"ui-form-info\">${options.description}</div></td></tr>`;\n    },\n\n    _templateFooter: function(options) {\n        return `<p class=\"ui-panel-footer\">You are using <strong>${\n            options.nice_total_disk_usage\n        }</strong> of disk space in this Galaxy instance. ${\n            Galaxy.config.enable_quotas ? `Your disk quota is: <strong>${options.quota}</strong>. ` : \"\"\n        }Is your usage more than expected? See the <a href=\"https://galaxyproject.org/learn/managing-datasets/\" target=\"_blank\">documentation</a> for tips on how to find all of the data in your account.</p>`;\n    }\n});\n\nexport default {\n    View: View,\n    Model: Model\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/user/user-preferences.js","/** This class renders the chart configuration form. */\nimport Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nimport Table from \"mvc/ui/ui-table\";\nvar Collection = Backbone.Collection.extend({\n    comparator: function(a, b) {\n        a = a.get(\"name\");\n        b = b.get(\"name\");\n        return a > b ? 1 : a < b ? -1 : 0;\n    }\n});\n\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        var history_id = Galaxy.currHistoryPanel && Galaxy.currHistoryPanel.model.id;\n        this.model = new Backbone.Model();\n        this.model.url = `${Galaxy.root}api/histories/${history_id}/custom_builds_metadata`;\n        this.collection = new Collection();\n        this.collection.url = `${Galaxy.root}api/users/${Galaxy.user.id}/custom_builds`;\n        this.message = new Ui.Message({});\n        this.installed_builds = new Ui.Select.View({\n            optional: true,\n            onchange: function() {\n                self.installed_builds.value(null);\n            },\n            empty_text: \"List of available builds:\",\n            error_text: \"No system installed builds available.\"\n        });\n        this.table = new Table.View({ cls: \"grid\", selectable: false });\n        this.table.addHeader(\"Name\");\n        this.table.addHeader(\"Key\");\n        this.table.addHeader(\"Number of chroms/contigs\");\n        this.table.addHeader(\"\");\n        this.table.appendHeader();\n        this.setElement(\n            $(\"<div/>\")\n                .append($(\"<h4/>\").text(\"Current Custom Builds\"))\n                .append(this.table.$el)\n                .append(\n                    (this.$installed = $(\"<div/>\")\n                        .append(\n                            $(\"<h4/>\")\n                                .text(\"System Installed Builds\")\n                                .addClass(\"ui-margin-top\")\n                        )\n                        .append(this.installed_builds.$el))\n                )\n                .append(\n                    $(\"<h4/>\")\n                        .text(\"Add a Custom Build\")\n                        .addClass(\"ui-margin-top\")\n                )\n                .append(\n                    $(\"<span/>\")\n                        .addClass(\"ui-column\")\n                        .append(\n                            $(\"<div/>\")\n                                .addClass(\"ui-column-left\")\n                                .append(this.message.$el)\n                                .append((this.$form = $(\"<div/>\").addClass(\"ui-margin-top\")))\n                        )\n                        .append((this.$help = $(\"<div/>\").addClass(\"ui-column-right\")))\n                )\n        );\n        this.listenTo(this.collection, \"add remove reset\", () => {\n            self._renderTable();\n        });\n        this.listenTo(this.model, \"change\", () => {\n            self._renderForm();\n        });\n        this.collection.fetch();\n        this.model.fetch();\n    },\n\n    render: function() {\n        this._renderTable();\n        this._renderForm();\n    },\n\n    _renderTable: function() {\n        var self = this;\n        this.table.delAll();\n        this.collection.sort();\n        this.collection.each(model => {\n            self.table.add(model.get(\"name\"));\n            self.table.add(model.id);\n            self.table.add(model.get(\"count\") !== undefined ? model.get(\"count\") : \"Processing...\");\n            self.table.add(\n                new Ui.ButtonIcon({\n                    icon: \"fa-trash-o\",\n                    cls: \"ui-button-icon-plain\",\n                    tooltip: \"Delete custom build.\",\n                    onclick: function() {\n                        model.destroy();\n                    }\n                }).$el\n            );\n            self.table.append(model.id);\n        });\n    },\n\n    _renderForm: function() {\n        var self = this;\n        var initial_type = \"fasta\";\n        var form = new Form({\n            inputs: [\n                {\n                    type: \"text\",\n                    name: \"name\",\n                    label: \"Name\",\n                    help: \"Specify a build name e.g. Hamster.\"\n                },\n                {\n                    type: \"text\",\n                    name: \"id\",\n                    label: \"Key\",\n                    help: \"Specify a build key e.g. hamster_v1.\"\n                },\n                {\n                    name: \"len\",\n                    type: \"conditional\",\n                    test_param: {\n                        name: \"type\",\n                        label: \"Definition\",\n                        help: \"Provide the data source.\",\n                        type: \"select\",\n                        value: initial_type,\n                        data: [\n                            {\n                                value: \"fasta\",\n                                label: \"FASTA-file from history\"\n                            },\n                            {\n                                value: \"file\",\n                                label: \"Len-file from disk\"\n                            },\n                            {\n                                value: \"text\",\n                                label: \"Len-file by copy/paste\"\n                            }\n                        ]\n                    },\n                    cases: [\n                        {\n                            value: \"fasta\",\n                            inputs: [\n                                {\n                                    type: \"select\",\n                                    name: \"value\",\n                                    label: \"FASTA-file\",\n                                    data: this.model.get(\"fasta_hdas\")\n                                }\n                            ]\n                        },\n                        {\n                            value: \"file\",\n                            inputs: [\n                                {\n                                    type: \"upload\",\n                                    name: \"value\",\n                                    label: \"Len-file\",\n                                    data: this.model.get(\"len_hdas\")\n                                }\n                            ]\n                        },\n                        {\n                            value: \"text\",\n                            inputs: [\n                                {\n                                    type: \"text\",\n                                    area: true,\n                                    name: \"value\",\n                                    label: \"Edit/Paste\"\n                                }\n                            ]\n                        }\n                    ]\n                }\n            ],\n            buttons: {\n                save: new Ui.Button({\n                    icon: \"fa-save\",\n                    tooltip: \"Create new Build\",\n                    title: \"Save\",\n                    cls: \"btn btn-primary ui-clear-float\",\n                    onclick: function() {\n                        var data = form.data.create();\n                        if (!data.id || !data.name) {\n                            self.message.update({\n                                message: \"All inputs are required.\",\n                                status: \"danger\"\n                            });\n                        } else {\n                            self.collection.create(data, {\n                                wait: true,\n                                success: function(response) {\n                                    if (response.get(\"message\")) {\n                                        self.message.update({\n                                            message: response.get(\"message\"),\n                                            status: \"warning\"\n                                        });\n                                    } else {\n                                        self.message.update({\n                                            message: \"Successfully added a new custom build.\",\n                                            status: \"success\"\n                                        });\n                                    }\n                                },\n                                error: function(response, err) {\n                                    var message = err && err.responseJSON && err.responseJSON.err_msg;\n                                    self.message.update({\n                                        message: message || \"Failed to create custom build.\",\n                                        status: \"danger\"\n                                    });\n                                }\n                            });\n                        }\n                    }\n                })\n            },\n            onchange: function() {\n                var input_id = form.data.match(\"len|type\");\n                if (input_id) {\n                    var input_field = form.field_list[input_id];\n                    self._renderHelp(input_field.value());\n                }\n            }\n        });\n        this.$form.empty().append(form.$el);\n        var installed_builds = this.model.get(\"installed_builds\");\n        if (installed_builds && installed_builds.length) {\n            this.$installed.show();\n            this.installed_builds.update(this.model.get(\"installed_builds\"));\n        } else {\n            this.$installed.hide();\n        }\n        this._renderHelp(initial_type);\n    },\n\n    _renderHelp: function(len_type) {\n        this.$help\n            .empty()\n            .addClass(\"alert alert-info\")\n            .html(len_type == \"fasta\" ? this._templateFasta() : this._templateLen());\n    },\n\n    _templateLen: function() {\n        return (\n            \"<h4>Length Format</h4>\" +\n            \"<p>\" +\n            \"The length format is two-column, separated by whitespace, of the form:\" +\n            \"<pre>chrom/contig   length of chrom/contig</pre>\" +\n            \"</p>\" +\n            \"<p>\" +\n            \"For example, the first few entries of <em>mm9.len</em> are as follows:\" +\n            \"<pre>\" +\n            \"chr1    197195432\\n\" +\n            \"chr2    181748087\\n\" +\n            \"chr3    159599783\\n\" +\n            \"chr4    155630120\\n\" +\n            \"chr5    152537259\" +\n            \"</pre>\" +\n            \"</p>\" +\n            \"<p>Trackster uses this information to populate the select box for chrom/contig, and\" +\n            \"to set the maximum basepair of the track browser. You may either upload a .len file\" +\n            \"of this format (Len File option), or directly enter the information into the box \" +\n            \"(Len Entry option).</p>\"\n        );\n    },\n\n    _templateFasta: function() {\n        return (\n            \"<h4>FASTA format</h4>\" +\n            \"<p>\" +\n            \"This is a multi-fasta file from your current history that provides the genome\" +\n            \"sequences for each chromosome/contig in your build.\" +\n            \"</p>\" +\n            \"<p>\" +\n            \"Here is a snippet from an example multi-fasta file:\" +\n            \"<pre>\" +\n            \">chr1\\n\" +\n            \"ATTATATATAAGACCACAGAGAGAATATTTTGCCCGG...\\n\\n\" +\n            \">chr2\\n\" +\n            \"GGCGGCCGCGGCGATATAGAACTACTCATTATATATA...\\n\\n\" +\n            \"...\" +\n            \"</pre>\" +\n            \"</p>\"\n        );\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/user/user-custom-builds.js","/** This class renders the grid list with shared section. */\nimport GridView from \"mvc/grid/grid-view\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        var self = this;\n        this.setElement($(\"<div/>\"));\n        this.model = new Backbone.Model(options);\n        this.item = this.model.get(\"item\");\n        this.title = this.model.get(\"plural\");\n        $.ajax({\n            url: `${Galaxy.root + this.item}/${this.model.get(\"action_id\")}?${$.param(Galaxy.params)}`,\n            success: function(response) {\n                response[\"dict_format\"] = true;\n                self.model.set(response);\n                self.render();\n            }\n        });\n    },\n\n    render: function() {\n        var grid = new GridView(this.model.attributes);\n        this.$el.empty().append(grid.$el);\n        this.$el.append(this._templateShared());\n    },\n\n    _templateShared: function() {\n        var self = this;\n        var $tmpl = $(`<div><h2>${this.model.get(\"plural\")} shared with you by others</h2></div>`);\n        var options = this.model.attributes;\n        if (options.shared_by_others && options.shared_by_others.length > 0) {\n            var $table = $(\n                '<table class=\"colored\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">' +\n                    '<tr class=\"header\">' +\n                    \"<th>Title</th>\" +\n                    \"<th>Owner</th>\" +\n                    \"</tr>\" +\n                    \"</table>\"\n            );\n            _.each(options.shared_by_others, (it, index) => {\n                var display_url = `${Galaxy.root + self.item}/display_by_username_and_slug?username=${\n                    it.username\n                }&slug=${it.slug}`;\n                $table.append(\n                    `<tr><td><a href=\"${display_url}\">${_.escape(it.title)}</a></td><td>${_.escape(\n                        it.username\n                    )}</td></tr>`\n                );\n            });\n            $tmpl.append($table);\n        } else {\n            $tmpl.append(`No ${this.model.get(\"plural\").toLowerCase()} have been shared with you.`);\n        }\n        return $tmpl;\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/grid/grid-shared.js","/** Workflow view */\nimport * as mod_toastr from \"libs/toastr\";\nimport TAGS from \"mvc/tag\";\nimport WORKFLOWS from \"mvc/workflow/workflow-model\";\nimport QueryStringParsing from \"utils/query-string-parsing\";\n/** View of the individual workflows */\nvar WorkflowItemView = Backbone.View.extend({\n    tagName: \"tr\", // name of (orphan) root tag in this.el\n    initialize: function() {\n        _.bindAll(\n            this,\n            \"render\",\n            \"_rowTemplate\",\n            \"renderTagEditor\",\n            \"_templateActions\",\n            \"removeWorkflow\",\n            \"copyWorkflow\"\n        ); // every function that uses 'this' as the current object should be in here\n        mod_toastr.options.timeOut = 1500;\n    },\n\n    events: {\n        \"click #show-in-tool-panel\": \"showInToolPanel\",\n        \"click #delete-workflow\": \"removeWorkflow\",\n        \"click #rename-workflow\": \"renameWorkflow\",\n        \"click #copy-workflow\": \"copyWorkflow\"\n    },\n\n    render: function() {\n        $(this.el).html(this._rowTemplate());\n        return this;\n    },\n\n    showInToolPanel: function() {\n        this.model.set(\"show_in_tool_panel\", !this.model.get(\"show_in_tool_panel\"));\n        this.model.save();\n        // This reloads the whole page, so that the workflow appears in the tool panel.\n        // Ideally we would notify only the tool panel of a change\n        window.location = `${Galaxy.root}workflow`;\n    },\n\n    removeWorkflow: function() {\n        var wfName = this.model.get(\"name\");\n        if (window.confirm(`Are you sure you want to delete workflow '${wfName}'?`)) {\n            this.model.destroy({\n                success: function() {\n                    mod_toastr.success(`Successfully deleted workflow '${wfName}'`);\n                }\n            });\n            this.remove();\n        }\n    },\n\n    renameWorkflow: function() {\n        var oldName = this.model.get(\"name\");\n        var newName = window.prompt(`Enter a new Name for workflow '${oldName}'`, oldName);\n        if (newName) {\n            this.model.save(\n                { name: newName },\n                {\n                    success: function() {\n                        mod_toastr.success(`Successfully renamed workflow '${oldName}' to '${newName}'`);\n                    }\n                }\n            );\n            this.render();\n        }\n    },\n\n    copyWorkflow: function() {\n        var self = this;\n        var oldName = this.model.get(\"name\");\n        $.getJSON(`${this.model.urlRoot}/${this.model.id}/download`, wfJson => {\n            var newName = `Copy of ${oldName}`;\n            var currentOwner = self.model.get(\"owner\");\n            if (currentOwner != Galaxy.user.attributes.username) {\n                newName += ` shared by user ${currentOwner}`;\n            }\n            wfJson.name = newName;\n            self.collection.create(wfJson, {\n                at: 0,\n                wait: true,\n                success: function() {\n                    mod_toastr.success(`Successfully copied workflow '${oldName}' to '${newName}'`);\n                },\n                error: function(model, resp, options) {\n                    // signature seems to have changed over the course of backbone dev\n                    // see https://github.com/jashkenas/backbone/issues/2606#issuecomment-19289483\n                    mod_toastr.error(options.errorThrown);\n                }\n            });\n        }).error((jqXHR, textStatus, errorThrown) => {\n            mod_toastr.error(jqXHR.responseJSON.err_msg);\n        });\n    },\n\n    _rowTemplate: function() {\n        var show = this.model.get(\"show_in_tool_panel\");\n        var wfId = this.model.id;\n        var checkboxHtml = `<input id=\"show-in-tool-panel\" type=\"checkbox\" class=\"show-in-tool-panel\" ${\n            show ? `checked=\"${show}\"` : \"\"\n        } value=\"${wfId}\">`;\n        var trHtml = `<td><div class=\"dropdown\"><button class=\"menubutton\" type=\"button\" data-toggle=\"dropdown\">${_.escape(\n            this.model.get(\"name\")\n        )}<span class=\"caret\"></span></button>${this._templateActions()}</div></td><td><span><div class=\"${\n            wfId\n        } tags-display\"></div></td><td>${\n            this.model.get(\"owner\") === Galaxy.user.attributes.username ? \"You\" : this.model.get(\"owner\")\n        }</span></td><td>${this.model.get(\"number_of_steps\")}</td><td>${\n            this.model.get(\"published\") ? \"Yes\" : \"No\"\n        }</td><td>${checkboxHtml}</td>`;\n        return trHtml;\n    },\n\n    renderTagEditor: function() {\n        var TagEditor = new TAGS.TagsEditor({\n            model: this.model,\n            el: $.find(`.${this.model.id}.tags-display`),\n            workflow_mode: true\n        });\n        TagEditor.toggle(true);\n        TagEditor.render();\n    },\n\n    /** Template for user actions for workflows */\n    _templateActions: function() {\n        if (this.model.get(\"owner\") === Galaxy.user.attributes.username) {\n            return `<ul class=\"dropdown-menu action-dpd\"><li><a href=\"${Galaxy.root}workflow/editor?id=${\n                this.model.id\n            }\">Edit</a></li><li><a href=\"${Galaxy.root}workflow/run?id=${this.model.id}\">Run</a></li><li><a href=\"${\n                Galaxy.root\n            }workflow/sharing?id=${this.model.id}\">Share</a></li><li><a href=\"${Galaxy.root}api/workflows/${\n                this.model.id\n            }/download?format=json-download\">Download</a></li><li><a id=\"copy-workflow\" style=\"cursor: pointer;\">Copy</a></li><li><a id=\"rename-workflow\" style=\"cursor: pointer;\">Rename</a></li><li><a href=\"${\n                Galaxy.root\n            }workflow/display_by_id?id=${\n                this.model.id\n            }\">View</a></li><li><a id=\"delete-workflow\" style=\"cursor: pointer;\">Delete</a></li></ul>`;\n        } else {\n            return `<ul class=\"dropdown-menu action-dpd\"><li><a href=\"${\n                Galaxy.root\n            }workflow/display_by_username_and_slug?username=${this.model.get(\"owner\")}&slug=${this.model.get(\n                \"slug\"\n            )}\">View</a></li><li><a href=\"${Galaxy.root}workflow/run?id=${\n                this.model.id\n            }\">Run</a></li><li><a id=\"copy-workflow\" style=\"cursor: pointer;\">Copy</a></li><li><a class=\"link-confirm-shared-${\n                this.model.id\n            }\" href=\"${Galaxy.root}workflow/sharing?unshare_me=True&id=${this.model.id}\">Remove</a></li></ul>`;\n        }\n    }\n});\n\n/** View of the main workflow list page */\nvar WorkflowListView = Backbone.View.extend({\n    title: \"Workflows\",\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        _.bindAll(this, \"adjustActiondropdown\");\n        this.collection = new WORKFLOWS.WorkflowCollection();\n        this.collection.fetch().done(this.render());\n        this.collection.bind(\"add\", this.appendItem);\n        this.collection.on(\"sync\", this.render, this);\n    },\n\n    events: {\n        dragleave: \"unhighlightDropZone\",\n        drop: \"drop\",\n        dragover: function(ev) {\n            $(\".hidden_description_layer\").addClass(\"dragover\");\n            $(\".menubutton\").addClass(\"background-none\");\n            ev.preventDefault();\n        }\n    },\n\n    unhighlightDropZone: function() {\n        $(\".hidden_description_layer\").removeClass(\"dragover\");\n        $(\".menubutton\").removeClass(\"background-none\");\n    },\n\n    drop: function(e) {\n        // TODO: check that file is valid galaxy workflow\n        this.unhighlightDropZone();\n        e.preventDefault();\n        var files = e.dataTransfer.files;\n        var self = this;\n        for (var i = 0, f; (f = files[i]); i++) {\n            self.readWorkflowFiles(f);\n        }\n    },\n\n    readWorkflowFiles: function(f) {\n        var self = this;\n        var reader = new FileReader();\n        reader.onload = theFile => {\n            var wf_json;\n            try {\n                wf_json = JSON.parse(reader.result);\n            } catch (e) {\n                mod_toastr.error(`Could not read file '${f.name}'. Verify it is a valid Galaxy workflow`);\n                wf_json = null;\n            }\n            if (wf_json) {\n                self.collection.create(wf_json, {\n                    at: 0,\n                    wait: true,\n                    success: function() {\n                        mod_toastr.success(`Successfully imported workflow '${wf_json.name}'`);\n                    },\n                    error: function(model, resp, options) {\n                        mod_toastr.error(options.errorThrown);\n                    }\n                });\n            }\n        };\n        reader.readAsText(f, \"utf-8\");\n    },\n\n    _showArgErrors: _.once(() => {\n        // Parse args out of params, display if there's a message.\n        var msg_text = QueryStringParsing.get(\"message\");\n        var msg_status = QueryStringParsing.get(\"status\");\n        if (msg_status === \"error\") {\n            mod_toastr.error(_.escape(msg_text || \"Unknown Error, please report this to an administrator.\"));\n        } else if (msg_text) {\n            mod_toastr.info(_.escape(msg_text));\n        }\n    }),\n\n    render: function() {\n        // Add workflow header\n        var header = this._templateHeader();\n        // Add the actions buttons\n        var templateActions = this._templateActionButtons();\n        var tableTemplate = this._templateWorkflowTable();\n        this.$el.html(header + templateActions + tableTemplate);\n        var self = this;\n        _(this.collection.models).each(item => {\n            // in case collection is not empty\n            self.appendItem(item);\n            self.confirmDelete(item);\n        }, this);\n        var minQueryLength = 3;\n        this.searchWorkflow(this.$(\".search-wf\"), this.$(\".workflow-search tr\"), minQueryLength);\n        this.adjustActiondropdown();\n        this._showArgErrors();\n        return this;\n    },\n\n    appendItem: function(item) {\n        var workflowItemView = new WorkflowItemView({\n            model: item,\n            collection: this.collection\n        });\n        $(\".workflow-search\").append(workflowItemView.render().el);\n        workflowItemView.renderTagEditor();\n    },\n\n    /** Add confirm box before removing/unsharing workflow */\n    confirmDelete: function(workflow) {\n        var $el_shared_wf_link = this.$(`.link-confirm-shared-${workflow.id}`);\n        $el_shared_wf_link.click(() =>\n            window.confirm(`Are you sure you want to remove the shared workflow '${workflow.attributes.name}'?`)\n        );\n    },\n\n    /** Implement client side workflow search/filtering */\n    searchWorkflow: function($el_searchinput, $el_tabletr, min_querylen) {\n        $el_searchinput.on(\"keyup\", function() {\n            var query = $(this).val();\n            // Filter when query is at least 3 characters\n            // otherwise show all rows\n            if (query.length >= min_querylen) {\n                // Ignore the query's case using 'i'\n                var regular_expression = new RegExp(query, \"i\");\n                $el_tabletr.hide();\n                $el_tabletr\n                    .filter(function() {\n                        // Apply regular expression on each row's text\n                        // and show when there is a match\n                        return regular_expression.test($(this).text());\n                    })\n                    .show();\n            } else {\n                $el_tabletr.show();\n            }\n        });\n    },\n\n    /** Ajust the position of dropdown with respect to table */\n    adjustActiondropdown: function() {\n        $(this.el).on(\"show.bs.dropdown\", function() {\n            $(this.el).css(\"overflow\", \"inherit\");\n        });\n        $(this.el).on(\"hide.bs.dropdown\", function() {\n            $(this.el).css(\"overflow\", \"auto\");\n        });\n    },\n\n    /** Template for no workflow */\n    _templateNoWorkflow: function() {\n        return '<div class=\"wf-nodata\"> You have no workflows. </div>';\n    },\n\n    /** Template for actions buttons */\n    _templateActionButtons: function() {\n        return `<ul class=\"manage-table-actions\"><li><input class=\"search-wf form-control\" type=\"text\" autocomplete=\"off\" placeholder=\"search for workflow...\"></li><li><a class=\"action-button fa fa-plus wf-action\" id=\"new-workflow\" title=\"Create new workflow\" href=\"${\n            Galaxy.root\n        }workflow/create\"></a></li><li><a class=\"action-button fa fa-upload wf-action\" id=\"import-workflow\" title=\"Upload or import workflow\" href=\"${\n            Galaxy.root\n        }workflow/import_workflow\"></a></li></ul>`;\n    },\n\n    /** Template for workflow table */\n    _templateWorkflowTable: function() {\n        var tableHtml =\n            '<table class=\"table colored\"><thead>' +\n            '<tr class=\"header\">' +\n            \"<th>Name</th>\" +\n            \"<th>Tags</th>\" +\n            \"<th>Owner</th>\" +\n            \"<th># of Steps</th>\" +\n            \"<th>Published</th>\" +\n            \"<th>Show in tools panel</th>\" +\n            \"</tr></thead>\";\n        return `${\n            tableHtml\n        }<tbody class=\"workflow-search \"><div class=\"hidden_description_layer\"><p>Drop workflow files here to import</p></tbody></table></div>`;\n    },\n\n    /** Main template */\n    _templateHeader: function() {\n        return (\n            '<div class=\"page-container\">' +\n            '<div class=\"user-workflows wf\">' +\n            '<div class=\"response-message\"></div>' +\n            \"<h2>Your workflows</h2>\" +\n            \"</div>\" +\n            \"</div>\"\n        );\n    }\n});\n\nvar ImportWorkflowView = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    /** Open page to import workflow */\n    render: function() {\n        var self = this;\n        $.getJSON(`${Galaxy.root}workflow/upload_import_workflow`, options => {\n            self.$el.empty().append(self._mainTemplate(options));\n        });\n    },\n\n    /** Template for the import workflow page */\n    _mainTemplate: function(options) {\n        return `<div class='toolForm'><div class='toolFormTitle'>Import Galaxy workflow</div><div class='toolFormBody'><form name='import_workflow' id='import_workflow' action='${\n            Galaxy.root\n        }workflow/upload_import_workflow' enctype='multipart/form-data' method='POST'><div class='form-row'><label>Galaxy workflow URL:</label><input type='text' name='url' class='input-url' value='${\n            options.url\n        }' size='40'><div class='toolParamHelp' style='clear: both;'>If the workflow is accessible via a URL, enter the URL above and click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><label>Galaxy workflow file:</label><div class='form-row-input'><input type='file' name='file_data' class='input-file'/></div><div class='toolParamHelp' style='clear: both;'>If the workflow is in a file on your computer, choose it and then click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><input type='submit' class='primary-button wf-import' name='import_button' value='Import'></div></form><hr/><div class='form-row'><label>Import a Galaxy workflow from myExperiment:</label><div class='form-row-input'><a href='${\n            options.myexperiment_target_url\n        }'> Visit myExperiment</a></div><div class='toolParamHelp' style='clear: both;'>Click the link above to visit myExperiment and browse for Galaxy workflows.</div><div style='clear: both'></div></div></div></div>`;\n    }\n});\n\nexport default {\n    View: WorkflowListView,\n    ImportWorkflowView: ImportWorkflowView\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/workflow/workflow.js","import baseMVC from \"mvc/base-mvc\";\n/* global Backbone */\n// workflow model\n\nvar logNamespace = \"workflow\";\n//==============================================================================\n/** @class model for a single workflow.\n *  @name WorkflowItem\n *  @augments Backbone.Model\n */\nvar WorkflowItem = Backbone.Model.extend(baseMVC.LoggableMixin).extend({\n    _logNamespace: logNamespace,\n\n    urlRoot: `${Galaxy.root}api/workflows`,\n\n    toJSON: function() {\n        // need to overwrite this as endpoint expects the 'workflow' key in payload\n        return { workflow: this.attributes };\n    }\n});\n\n//==============================================================================\n/** @class collection for workflows.\n *  @name WorkflowCollection\n *  @augments Backbone.Collection\n */\nvar WorkflowCollection = Backbone.Collection.extend({\n    model: WorkflowItem,\n    url: `${Galaxy.root}api/workflows`\n});\n\n//==============================================================================\n\nexport default {\n    WorkflowItem: WorkflowItem,\n    WorkflowCollection: WorkflowCollection\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/workflow/workflow-model.js","/** This class renders the grid list. */\nimport Utils from \"utils/utils\";\nimport GridView from \"mvc/grid/grid-view\";\nimport HistoryModel from \"mvc/history/history-model\";\nimport historyCopyDialog from \"mvc/history/copy-dialog\";\nvar View = Backbone.View.extend({\n    title: \"Histories\",\n    initialize: function(options) {\n        var self = this;\n        this.setElement($(\"<div/>\"));\n        this.model = new Backbone.Model();\n        Utils.get({\n            url: `${Galaxy.root}history/${options.action_id}?${$.param(Galaxy.params)}`,\n            success: function(response) {\n                response[\"dict_format\"] = true;\n                _.each(response[\"operations\"], operation => {\n                    if (operation.label == \"Copy\") {\n                        operation.onclick = id => {\n                            self._showCopyDialog(id);\n                        };\n                    }\n                });\n                self.model.set(response);\n                self.render();\n            }\n        });\n    },\n\n    render: function() {\n        var grid = new GridView(this.model.attributes);\n        this.$el.empty().append(grid.$el);\n    },\n\n    _showCopyDialog: function(id) {\n        var history = new HistoryModel.History({ id: id });\n        history\n            .fetch()\n            .fail(() => {\n                alert(\"History could not be fetched. Please contact an administrator\");\n            })\n            .done(() => {\n                historyCopyDialog(history, {}).done(() => {\n                    if (window.parent && window.parent.Galaxy && window.parent.Galaxy.currHistoryPanel) {\n                        window.parent.Galaxy.currHistoryPanel.loadCurrentHistory();\n                    }\n                    window.location.reload(true);\n                });\n            });\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/history/history-list.js","import Utils from \"utils/utils\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\n/** Dataset edit attributes view */\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.render();\n    },\n\n    // Fetch data for the selected dataset and\n    render: function() {\n        var data_url = `${Galaxy.root}api/datasets/${this.model.get(\"dataset_id\")}`;\n\n        var self = this;\n\n        Utils.get({\n            url: data_url,\n            success: function(dataset) {\n                var job_url = `${Galaxy.root}api/jobs/${dataset.creating_job}?full=True`;\n                Utils.get({\n                    url: job_url,\n                    success: function(job) {\n                        var job_url = `${Galaxy.root}api/jobs/${dataset.creating_job}?full=True`;\n                        self.render_error_page(self, dataset, job);\n                    },\n                    error: function(response) {\n                        var error_response = {\n                            status: \"error\",\n                            message: \"Error occured while loading the job.\",\n                            persistent: true,\n                            cls: \"errormessage\"\n                        };\n                        self.display_message(error_response, self.$(\".response-message\"));\n                    }\n                });\n            },\n            error: function(response) {\n                var error_response = {\n                    status: \"error\",\n                    message: \"Error occured while loading the dataset.\",\n                    persistent: true,\n                    cls: \"errormessage\"\n                };\n                self.display_message(error_response, self.$(\".response-message\"));\n            }\n        });\n    },\n\n    /** Render the view */\n    render_error_page: function(self, dataset, job) {\n        self.$el.empty().append(self._templateHeader());\n        self.$el.append(\"<h2>Dataset Error</h2>\");\n        self.$el.append(`<p>An error occured while running the tool <b>${job.tool_id}</b>.</p>`);\n        self.$el.append(\"<p>Tool execution generated the following messages:</p>\");\n        self.$el.append(`<pre class=\"code\">${job.stderr}</pre>`);\n        self.$el.append(\"<h2>Report This Error</pre>\");\n        self.$el.append(\n            \"<p>Usually the local Galaxy administrators regularly review errors that occur on the server. However, if you would like to provide additional information (such as what you were trying to do when the error occurred) and a contact e-mail address, we will be better able to investigate your problem and get back to you.</p>\"\n        );\n        self.$el.append(self._getBugFormTemplate(dataset, job));\n    },\n\n    /** Display actions messages */\n    display_message: function(response, $el, doNotClear, safe) {\n        if (!safe) {\n            if (doNotClear) {\n                $el.append(new Ui.Message(response).$el);\n            } else {\n                $el.empty().html(new Ui.Message(response).$el);\n            }\n        } else {\n            if (doNotClear) {\n                $el.append(new Ui.UnescapedMessage(response).$el);\n            } else {\n                $el.empty().html(new Ui.UnescapedMessage(response).$el);\n            }\n        }\n    },\n\n    /** Main template */\n    _templateHeader: function() {\n        return '<div class=\"page-container edit-attr\">' + '<div class=\"response-message\"></div>' + \"</div>\";\n    },\n\n    /** Convert tab template */\n    _getBugFormTemplate: function(dataset, job) {\n        var self = this;\n        var inputs = [\n            {\n                help: \"Your email address\",\n                options: [],\n                type: \"text\",\n                name: \"email\",\n                label: \"Your email\",\n                value: Galaxy.user.get(\"email\")\n            },\n            {\n                help: \"Any additional comments you can provide regarding what you were doing at the time of the bug.\",\n                options: [],\n                type: \"text\",\n                area: true,\n                name: \"message\",\n                label: \"Message\"\n            }\n        ];\n\n        // TODO\n        /*\n        if (false && response.any_public) {\n            inputs.push({\n                name: \"public_consent\",\n                label: \"Public Disclosure Consent\",\n                help:\n                    \"This Galaxy is configured to report to one or more error reporting backends that public to the world. By selecting 'yes', you acknowledge that this bug report will be made public.\",\n                value: String(Boolean(false)),\n                options: [],\n                type: \"boolean\"\n            });\n        }\n        */\n\n        var form = new Form({\n            title: \"Error Report\",\n            inputs: inputs,\n            buttons: {\n                save: new Ui.Button({\n                    icon: \"fa-bug\",\n                    title: \"Report\",\n                    cls: \"ui-button btn btn-primary\",\n                    floating: \"clear\",\n                    onclick: function() {\n                        var form_data = form.data.create();\n                        var url = `${Galaxy.root}api/jobs/${job.id}/error`;\n                        form_data.dataset_id = dataset.id;\n                        self.submit(form_data, url);\n                    }\n                })\n            }\n        });\n        return form.$el;\n    },\n\n    /** Make ajax request */\n    submit: function(form_data, url) {\n        var self = this;\n        // Some required metadata\n        $.ajax({\n            type: \"POST\",\n            url: url,\n            data: form_data,\n            success: function(response) {\n                // Clear out the div\n                self.$el.empty().append(self._templateHeader());\n                // And display the messages.\n                response.messages.forEach(message => {\n                    self.display_message(\n                        {\n                            status: message[1],\n                            message: message[0],\n                            persistent: true\n                        },\n                        self.$(\".response-message\"),\n                        true,\n                        true\n                    );\n                });\n            },\n            error: function(response) {\n                var error_response = {\n                    status: \"error\",\n                    message: \"Error occured while saving. Please fill all the required fields and try again.\",\n                    persistent: true,\n                    cls: \"errormessage\"\n                };\n                self.display_message(error_response, self.$(\".response-message\"));\n            }\n        });\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/dataset-error.js","/** Dataset edit attributes view */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new Ui.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el\n            .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n            .append(this.message.$el)\n            .append(\"<p/>\")\n            .append(this.tabs.$el)\n            .hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: `${Galaxy.root}dataset/get_edit?dataset_id=${self.model.get(\"dataset_id\")}`,\n            success: function(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, (form, key) => {\n                    form.model.set(\"inputs\", response[`${key}_inputs`]);\n                    form.model.set(\"hide_operations\", response[`${key}_disable`]);\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: `${Galaxy.root}dataset/set_edit`,\n            data: data,\n            success: function(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new Tabs.View();\n        tabs.add({\n            id: \"attribute\",\n            title: \"Attributes\",\n            icon: \"fa fa-bars\",\n            tooltip: \"Edit dataset attributes\",\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: \"Convert\",\n            icon: \"fa-gear\",\n            tooltip: \"Convert to new format\",\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: \"Datatypes\",\n            icon: \"fa-database\",\n            tooltip: \"Change data type\",\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: \"Permissions\",\n            icon: \"fa-user\",\n            tooltip: \"Permissions\",\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Edit attributes\",\n            operations: {\n                submit_attributes: new Ui.ButtonIcon({\n                    tooltip: \"Save attributes of the dataset.\",\n                    icon: \"fa-floppy-o\",\n                    title: \"Save\",\n                    onclick: function() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new Ui.ButtonIcon({\n                    tooltip:\n                        \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Convert to new format\",\n            operations: {\n                submit_conversion: new Ui.ButtonIcon({\n                    tooltip: \"Convert the datatype to a new format.\",\n                    title: \"Convert datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Change datatype\",\n            operations: {\n                submit_datatype: new Ui.ButtonIcon({\n                    tooltip: \"Change the datatype to a new type.\",\n                    title: \"Change datatype\",\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function() {\n        var self = this;\n        var form = new Form({\n            title: \"Manage dataset permissions\",\n            operations: {\n                submit_permission: new Ui.ButtonIcon({\n                    tooltip: \"Save permissions.\",\n                    title: \"Save permissions\",\n                    icon: \"fa-floppy-o \",\n                    onclick: function() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n\n\n\n// WEBPACK FOOTER //\n// ./galaxy/scripts/mvc/dataset/dataset-edit-attributes.js"],"sourceRoot":""}