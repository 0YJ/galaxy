{"version":3,"sources":["webpack:///history.bundled.js","webpack:///./galaxy/scripts/apps/history-app.js","webpack:///./galaxy/scripts/utils/webpack-localization.js?2b67","webpack:///./galaxy/scripts/utils/utils.js?d2e7","webpack:///./galaxy/scripts/mvc/base-mvc.js?0704","webpack:///./galaxy/scripts/mvc/dataset/states.js?1eb3","webpack:///./galaxy/scripts/ui/fa-icon-button.js?c3ea","webpack:///./galaxy/scripts/mvc/collection/collection-panel.js?bba8","webpack:///./galaxy/scripts/mvc/ui/ui-modal.js?120e","webpack:///./galaxy/scripts/mvc/collection/collection-li.js?611e","webpack:///./galaxy/scripts/mvc/collection/collection-model.js?5537","webpack:///./galaxy/scripts/mvc/collection/list-collection-creator.js?243c","webpack:///./galaxy/scripts/mvc/dataset/dataset-li.js?c435","webpack:///./galaxy/scripts/mvc/history/hdca-model.js?7bb1","webpack:///./galaxy/scripts/mvc/history/history-content-model.js?d0b3","webpack:///./galaxy/scripts/mvc/history/history-contents.js?5856","webpack:///./galaxy/scripts/mvc/list/list-item.js?6c45","webpack:///./galaxy/scripts/galaxy.masthead.js?79c7","webpack:///./galaxy/scripts/mvc/ui/popup-menu.js?a948","webpack:///./galaxy/scripts/utils/add-logging.js?71c9","webpack:///./galaxy/scripts/mvc/annotations.js?53c0","webpack:///./galaxy/scripts/mvc/dataset/dataset-li-edit.js?5209","webpack:///./galaxy/scripts/mvc/dataset/dataset-model.js?8cff","webpack:///./galaxy/scripts/mvc/history/hda-li.js?f417","webpack:///./galaxy/scripts/mvc/history/hda-model.js?1daf","webpack:///./galaxy/scripts/mvc/history/hdca-li.js?d481","webpack:///./galaxy/scripts/mvc/history/history-model.js?b2f1","webpack:///./galaxy/scripts/mvc/list/list-panel.js?f622","webpack:///./galaxy/scripts/mvc/tags.js?d22c","webpack:///./galaxy/scripts/mvc/user/user-model.js?e6b2","webpack:///./galaxy/scripts/ui/hoverhighlight.js?df1b","webpack:///./galaxy/scripts/ui/search-input.js?cccc","webpack:///./galaxy/scripts/utils/natural-sort.js?936b","webpack:///./galaxy/scripts/galaxy.menu.js?bc51","webpack:///./galaxy/scripts/mvc/collection/collection-li-edit.js?f243","webpack:///./galaxy/scripts/mvc/collection/collection-panel-edit.js?9dce","webpack:///./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js?a3a1","webpack:///./galaxy/scripts/mvc/collection/pair-collection-creator.js?1a41","webpack:///./galaxy/scripts/mvc/history/hda-li-edit.js?8ff6","webpack:///./galaxy/scripts/mvc/history/hdca-li-edit.js?a60e","webpack:///./galaxy/scripts/mvc/history/history-panel-edit.js?d50b","webpack:///./galaxy/scripts/mvc/history/history-panel.js?e4d3","webpack:///./galaxy/scripts/ui/loading-indicator.js?70c7","webpack:///./galaxy/scripts/utils/levenshtein.js?d4df"],"names":["webpackJsonp","module","exports","__webpack_require__","GalaxyMasthead","GalaxyMenu","History","HistoryPanelEdit","window","app","options","bootstrapped","Galaxy","masthead","menu","mastheadConfig","_","extend","clone","config","user","requests","currUser","get","email","valid","isAnonymous","json","toJSON","console","debug","panel","show_deleted","show_hidden","purgeAllowed","allow_user_dataset_purge","model","history","contents","$","render","$el","appendTo","panelLoc","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","localeStrings","localize","strToLocalize","cacheNonLocalized","hasOwnProperty","nonLocalized","navigator","language","apply","undefined","deepeach","dict","callback","i","d","isJSON","text","test","replace","sanitize","content","html","validate","value","Array","length","indexOf","textify","lst","toString","pos","lastIndexOf","substr","top","__utils__get__","cache","url","success","request","data","response","error","ajaxConfig","contentType","type","param","dataType","JSON","stringify","ajax","done","jQuery","parseJSON","e","fail","response_text","responseText","cssGetAttribute","classname","name","el","css","remove","cssLoadFile","galaxy_config","root","merge","optionsDefault","defaults","roundToDecimalPlaces","number","numPlaces","placesMultiplier","Math","round","bytesToString","size","normal_font","numberPlaces","unit","tb","gb","mb","kb","rounded","uid","__utils__uid__","time","Date","hours","getHours","minutes","getMinutes","datetime","getDate","getMonth","getFullYear","Backbone","addLogging","_l","mixin","mixinHash1","propsHash","args","prototype","slice","call","arguments","lastArg","pop","unshift","wrapTemplate","template","jsonNamespace","templateFn","join","view","templateVars","LoggableMixin","logger","_logNamespace","log","this","Function","bind","SessionStorageModel","Model","initialize","initialAttrs","_checkEnabledSessionStorage","id","Error","existing","isNew","_read","clear","silent","save","on","sessionStorage","err","alert","sync","method","trigger","returned","_create","_update","_delete","set","setItem","DOMException","userAgent","parse","getItem","removeItem","_log","omit","SearchableModelMixin","searchAttributes","searchAliases","searchAttribute","attrKey","searchFor","attrVal","isArray","_searchArrayAttribute","toLowerCase","array","any","elem","search","filter","key","matches","term","ATTR_SPECIFIER","split","matchesAll","terms","match","s","all","HiddenUntilActivatedViewMixin","hiddenUntilActivated","$activator","HUAVOptions","$elementShown","showFn","toggle","showSpeed","hasBeenShown","is","hidden","isHidden","ev","isFunction","onshowFirstTime","onshow","onhide","DraggableViewMixin","attributes","draggable","$dragHandle","toggleDraggable","draggableOff","draggableOn","dragStartHandler","_dragStartHandler","dragEndHandler","_dragEndHandler","handle","attr","addEventListener","removeEventListener","event","dataTransfer","effectAllowed","setData","SelectableViewMixin","selectable","selected","$selector","_renderSelected","find","toggleClass","toggleSelector","hideSelector","showSelector","speed","fxSpeed","show","hide","toggleSelect","deselect","select","STATES","UPLOAD","QUEUED","RUNNING","SETTING_METADATA","NEW","EMPTY","OK","PAUSED","FAILED_METADATA","NOT_VIEWABLE","DISCARDED","ERROR","READY_STATES","NOT_READY_STATES","__WEBPACK_AMD_DEFINE_FACTORY__","factory","faIconButton","tooltipConfig","placement","classes","concat","disabled","push","title","target","href","faIcon","$button","tooltip","onclick","click","LIST_PANEL","DC_MODEL","DC_LI","BASE_MVC","_super","ModelListPanel","CollectionPanel","className","DatasetDCEViewClass","DatasetDCEListItemView","NestedDCDCEViewClass","NestedDCDCEListItemView","modelCollectionKey","linkTarget","hasUser","panelStack","parentName","foldoutStyle","_filterCollection","getVisibleContents","_getItemViewClass","TypeError","_getItemViewOptions","_setUpItemViewListeners","v","drilldown","_expandDrilldownPanel","_collapseDrilldownPanel","add","$list","append","events","click .navigation .back","close","templates","controlsTemplate","controls","ListCollectionPanel","PairCollectionPanel","ListOfPairsCollectionPanel","foldoutPanelClass","View","elMain","body","backdrop","height","width","closing_events","closing_callback","title_separator","buttonList","$body","$dialog","visible","fadeIn","fadeOut","enableButton","button_id","$buttons","prop","disableButton","showButton","hideButton","getButton","scrollTop","self","document","off","setElement","_template","$footer","$backdrop","removeClass","buttons","counter","each","keyCode","border","padding-bottom","LIST_ITEM","DATASET_LI","FoldoutListItemView","ListItemView","DCListItemView","_setUpListeners","isEqual","keys","changed","_renderSubtitle","$subtitle","_getFoldoutPanelOptions","modelString","warnings","purged","deleted","titleBarTemplate","titleBar","DCEListItemView","DatasetListItemView","_fetchModelDetails","inReadyState","hasDetails","fetch","when","_swapNewRender","$newRender","state","addClass","DATASET_MODEL","DatasetCollectionElementMixin","model_class","element_identifier","element_index","element_type","_mergeObject","object","element_id","constructor","idAttribute","DatasetCollectionElement","DCECollection","Collection","DatasetDCE","DatasetAssociation","galaxyRoot","has","warn","objStr","DatasetDCECollection","DatasetCollection","collection_type","collectionClass","elements","_createElementsModel","unset","populated","isDeletedOrPurged","filters","delete","undelete","idAndName","ListDatasetCollection","attrs","PairDatasetCollection","NestedDCDCE","NestedDCDCECollection","NestedPairDCDCE","NestedPairDCDCECollection","ListPairedDatasetCollection","HDCA","UI_MODAL","naturalSort","createListCollection","promise","listCollectionCreatorModal","creationFn","map","element","src","history_content_type","createHDCA","DatasetCollectionElementView","tagName","source","hasClass","discard","parentWidth","parent","animate","margin-right","destroy","click .name","click .discard","dragstart","dragend","dragover","drop","_click","stopPropagation","_clickName","preventDefault","prompt","_clickDiscard","_dragstart","originalEvent","_dragend","_sendToParent","ListCollectionCreator","elementViewClass","HistoryListDatasetCollection","minElements","defaultAttributes","oncreate","oncancel","autoscrollDist","highlightClr","metric","creator","initialElements","_instanceSetUp","_elementsSetUp","_setUpBehaviors","selectedIds","$dragging","blocking","invalidElements","workingElements","elementViews","_ensureElementIds","_validateElements","_mangleDuplicateNames","_sortElements","forEach","uniqueId","problem","_isElementInvalid","contains","SAFETY","existingNames","currName","list","_renderInvalid","empty","main","_renderHeader","_renderMiddle","_renderFooter","_addPluginComponents","focus","invalidInitial","problems","$header","header","prepend","helpContent","_invalidElementsAlert","$middle","middle","_renderList","footer","hoverhighlight","_showAlert","_validationWarning","what","VALIDATION_CLASS","_disableNameAndCreate","disable","isUndefined","_renderClearSelected","$tmp","removeElementView","elementView","_createElementView","children","invoke","_listenToElementView","listenTo","addElementView","without","stopListening","_renderNoElementsLeft","noElementsLeft","_elementToJSON","createList","message","always","xhr","status","_errorHandler","once","readyState","responseJSON","click .more-help","click .less-help","click .main-help","click .header .alert button","click .reset","click .clear-selected","click .collection-elements","dragover .collection-elements","drop .collection-elements","collection-element.dragstart .collection-elements","collection-element.dragend   .collection-elements","change .collection-name","keydown .collection-name","click .cancel-create","click .create-collection","_clickMoreHelp","_clickLessHelp","_toggleHelp","alertClass","_hideAlert","reset","clearSelectedElements","_dragoverElements","_checkForAutoscroll","clientY","$nearest","_getNearestElement","$placeholder","before","$element","y","AUTOSCROLL_SPEED","offset","upperDist","lowerDist","outerHeight","WIGGLE","lis","toArray","$li","halfHeight","floor","_dropElements","dropEffect","insertBefore","insertAfter","last","_syncOrderToDom","newElements","findWhere","_elementDragstart","_elementDragend","_changeName","_getName","_nameCheckForEnter","_clickCreate","escape","val","collectionCreatorModal","CreatorClass","deferred","Deferred","modal","reject","resolve","_collectionCreator","changedAttributes","expanded","_renderPrimaryActions","_renderDisplayButton","displayBtnData","urls","display","frame","active","add_dataset","_renderDetails","noAccess","$details","_renderSecondaryActions","_renderSummary","_renderDetailMessages","_renderDisplayApplications","summaryRenderFn","summaries","unknown","$warnings","detailMessages","displayApplications","_renderDownloadButton","_renderShowParamsButton","show_params","hasData","isEmpty","download","_renderMetaFileDownloadButton","meta_file","meta_download","file_type","click .display-btn","click .params-btn","click .download-btn","failed_metadata","detailsTemplate","noAccessTemplate","summaryTemplates","detailMessageTemplates","resubmitted","displayApplicationsTemplate","details","HISTORY_CONTENT","buildHDCASave","urlRoot","hcontentMixin","HistoryContentMixin","ListDC","PairDC","ListPairedDC","HistoryPairDatasetCollection","HistoryListPairedDatasetCollection","typeIdStr","history_id","hid","type_id","_typeIdStr","_createTypeId","isVisible","unhide","nameAndId","HistoryContent","HDA_MODEL","HDCA_MODEL","HistoryContents","HistoryDatasetAssociation","validationError","models","historyId","ids","item","notReady","running","idList","isRunning","getByHid","first","getVisible","filteredHdas","filterFn","c","haveDetails","fetchAllDetails","detailsFlag","ajaxQueue","ajaxFn","startingLength","responses","ajaxFns","chain","reverse","notify","curr","total","shift","isCopyable","contentsJSON","copyableModelClasses","isObject","copy","isString","LibraryDatasetDatasetAssociation","HistoryDatasetCollectionAssociation","collection","post","matchesWhat","elementIdentifiers","collectionType","typeToModel","paired","hdca","element_identifiers","print","ExpandableView","_buildNewRender","_queueNewRender","replaceWith","queue","next","$where","$newDetails","toggleExpanded","expand","collapse","_expand","slideDown","duration","step","complete","slideUp","isSelectable","_renderWarnings","_renderTitleBar","subtitle","click .title-bar","keydown .title-bar","click .selector","_clickTitleBar","altKey","_keyDownTitleBar","KEYCODE_SPACE","KEYCODE_RETURN","elTemplato","subtitleTemplate","foldout","_createFoldoutPanel","_attachFoldout","FoldoutClass","_getFoldoutPanelClass","$whereTo","_expandByDrilldown","el_masthead","$background","onunload","q","mousedown","_add","highlight","current","$loc","location","$current","$all","closest","brand_text","brand","logo_url","GalaxyMastheadIcon","icon","with_number","visibility","new_icon","untoggle","new_number","tmpl","GalaxyMastheadTab","scratchbook","title_attribute","$menu","click .head","_attachPopover","menuOptions","divider","_templateMenu","$item","_templateMenuItem","_templateDivider","_head","$popover_element","popover","setTimeout","PopupMenu","_renderAndShow","clickEvent","_getShownPosition","_setUpCloseBehavior","position","li","option","func","_templateOptions","check","menuWidth","x","pageX","min","scrollLeft","max","pageY","left","closePopup","one","addItem","index","splice","findIndexByHtml","findItemByHtml","create","make_popupmenu","button_element","initial_options","convertedOptions","optionVal","optionKey","newOption","convertLinksToOptions","$parent","selector","$link","linkHref","confirmText","confirm","fromExistingDom","$buttonElement","$menuElement","menuElementLinkSelector","make_popup_menus","menuSelector","buttonSelectorBuildFn","popupMenusCreated","fromDom","obj","namespace","addTo","logFn","emit","baseMVC","AnnotationEditor","$annotation","make_text_editable","use_textarea","on_finish","newAnnotation","annotation","previous","TAGS","ANNOTATIONS","DatasetListItemEdit","tagsEditorShown","annotationEditorShown","actions","_renderEditButton","_renderDeleteButton","editBtnData","edit","deletedAlready","_renderTags","_renderAnnotation","_makeDbkeyEditLink","_renderErrButton","_renderRerunButton","_renderVisualizationsButton","report_error","creating_job","rerun","__WEBPACK_AMD_REQUIRE_ARRAY__","ToolsForm","form","job_id","execute","visualizations","$visualizations","_addScratchBookFn","addBack","$links","tagsEditor","TagsEditor","annotationEditor","editableDbkey","click .undelete-link","click .purge-link","click .edit-btn","click .delete-btn","click .rerun-btn","click .report-err-btn","click .visualization-btn","click .dbkey a","_clickUndeleteLink","_clickPurgeLink","purge","visualizationsTemplate","searchableMixin","accessible","data_type","file_ext","file_size","meta_files","misc_blurb","misc_info","tags","_generateUrls","visualization","currModel","newState","ready","dataset","hda","responseObj","messageBuriedInUnfortunatelyFormattedError","format","database","blurb","description","info","tag","DatasetAssociationCollection","HDAListItemView","DATASET","DC_PANEL","HDCAListItemView","change:populated change:visible","HISTORY_CONTENTS","UTILS","diskSize","historyJSON","updateTimeoutId","msg","errorHandler","makeArray","newId","clearUpdateTimeout","nice_size","ownedByCurrUser","contentsCount","reduce","values","memo","num","checkForUpdates","onReadyCallback","setUpdateTimeout","delay","UPDATE_DELAY","refresh","clearTimeout","detailIds","allDatasets","postData","all_datasets","then","newHistory","setAsCurrent","getJSON","getHistoryData","getHistory","historyData","getContents","detailIdsFn","hdcaDetailIds","dataset_details","dataset_collection_details","df","historyFn","contentsFn","historyXHR","contentsXHR","ControlledFetchMixin","_buildFetchData","traditional","_fetchOptions","fetchDefaults","_fetchDefaults","pick","_buildFetchFilters","filterMap","qv","k","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size-asc","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","change:deleted","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","sortOrder","comparator","a","b","fetchOptions","limit","fetchData","numFetched","hdas","historyOptions","xhrOptions","LoadingIndicator","ListPanel","viewClass","emptyMsg","noneFoundMsg","searchPlaceholder","indicator","selecting","lastSelected","dragItems","views","$scrollContainer","freeViews","_showLoadingIndicator","_hideLoadingIndicator","_setUpCollectionListeners","_setUpViewListeners","renderItems","addItemView","removeItemView","shiftKey","lastSelectedView","viewFromModelId","selectRange","showSelectors","_renderControls","_renderTitle","_renderSearch","$controls","_renderMultiselectActionMenu","multiselectActions","$newMenu","$actions","action","$messages","$emptyMessage","itemModel","_createItemView","_attachItems","_renderEmptyMessage","_filterItem","every","fn","ViewClass","getSelectedModels","expandAll","collapseAll","_attachView","viewFromModel","viewsWhereModel","properties","viewRange","viewA","viewB","indexA","indexB","searchInput","placeholder","initialVal","onfirstsearch","_firstSearch","onsearch","searchItems","onclear","clearSearch","hideSelectors","toggleSelectors","selectAll","deselectAll","range","getSelectedViews","scrollPosition","scrollTo","scrollToTop","scrollToItem","itemTop","scrollToId","click .select-all","click .deselect-all","elTemplate","setModel","freeModel","oldModelId","_setUpModelListeners","$input","select2","_getTagsUsed","tagsToCSV","tagsArray","added","_addNewTagToTagsUsed","newTag","tagsUsed","User","username","total_disk_usage","nice_total_disk_usage","quota_percent","is_admin","resp","changes","isAdmin","loadFromApi","idOrCurrent","CURRENT_ID_STR","userFn","newModel","clearSessionStorage","userInfo","getCurrentUserFromApi","currentUser","scope","color","$this","targetSelector","mouseover","background","mouseout","parentNode","clearSearchInput","searchTerms","firstSearch","inputTemplate","keyup","blur","which","KEYCODE_ESC","escWillClear","minSearchLen","$clearBtn","$loadingIndicator","toggleLoadingIndicator","$parentNode","inputVal","oninit","re","nC","String","fromCharCode","xN","yN","xD","getTime","yD","oFxNcL","oFyNcL","cLoc","numS","parseFloat","Masthead","tab_analysis","workflow_options","tab_workflow","tab_shared","user_requests","tab_lab","lims_doc_url","visualization_options","tab_visualization","tab_admin","extra_class","tab_help","biostar_url","biostar_url_redirect","support_url","search_url","mailing_lists","screencasts_url","wiki_url","citation_url","terms_url","tab_user","use_remote_user","allow_user_creation","active_view","DATASET_LI_EDIT","DCListItemEdit","DCEListItemEdit","DatasetDCEListItemEdit","NestedDCDCEListItemEdit","DC_EDIT","CollectionPanelEdit","nameSelector","newName","previousName","ListCollectionPanelEdit","PairCollectionPanelEdit","NestedPairCollectionPanelEdit","ListOfPairsCollectionPanelEdit","levenshteinDistance","LIST_COLLECTION_CREATOR","autoPairFnBuilder","getRegExps","_regexps","RegExp","createPair","params","listA","listB","_pair","preprocessMatch","regexps","matchTo","possible","bestMatch","score","scoreThreshold","createListOfPairsCollection","pairedCollectionCreatorModal","PairView","pair","currentTarget","style","opacity","PairedCollectionCreator","datasets","DEFAULT_FILTERS","automaticallyPair","strategy","matchPercentage","twoPassAutopairing","initialList","commonFilters","strategies","DEFAULT_STRATEGY","removeExtensions","unpairedPanelHidden","pairedPanelHidden","_dataSetUp","illumina","Rs","simple","lcs","levenshtein","unpaired","_sortInitialList","_ensureIds","autoPair","_sortDatasetList","_splitByFilters","_filter","regexFilters","stringFilter","_addToUnpaired","binSearchSortedIndex","low","hi","mid","compared","autopairSimple","autopairLevenshtein","distance","autopairLCS","_naiveStartingAndEndingLCS","s1","s2","fwdLCS","revLCS","j","fwd","rev","_createPair","_guessNameForPair","forward","fwdName","revName","lastDotIndex","extension","_unpair","unpairAll","pairs","_pairToJSON","ajaxData","_ajaxErrHandler","_renderFilters","_renderUnpaired","_renderPaired","$fwd","$rev","$prd","_renderUnpairedDisplayStr","_renderUnpairedEmpty","_renderPairButton","_renderUnpairedDataset","_adjUnpairedOnScrollbar","_renderUnpairedNotShown","numFiltered","$msg","$unpairedColumns","$firstDataset","ucRight","outerWidth","dsRight","rightDiff","_renderPairedEmpty","pairView","_chooseFiltersPopover","filterChoice","val1","val2","$popoverContent","filterSet","container","splitView","msgClass","hideUnpaired","click .forward-column .column-title","click .reverse-column .column-title","click .unpair-all-link","change .forward-unpaired-filter input","focus .forward-unpaired-filter input","click .autopair-link","click .choose-filters .filter-choice","click .clear-filters-link","change .reverse-unpaired-filter input","focus .reverse-unpaired-filter input","click .forward-column .dataset.unpaired","click .reverse-column .dataset.unpaired","click .paired-column .dataset.unpaired","click .unpaired-columns","mousedown .unpaired-columns .dataset","click .paired-column-title","mousedown .flexible-partition-drag","click .paired-columns .dataset.paired","click .paired-columns","click .paired-columns .pair-name","click .unpair-btn","dragover .paired-columns .column-datasets","drop .paired-columns .column-datasets","pair.dragstart .paired-columns .column-datasets","pair.dragend   .paired-columns .column-datasets","change .remove-extensions","toggleExtensions","_clickShowOnlyUnpaired","hidePaired","_clickShowOnlyPaired","_clickUnpairAll","_clickAutopair","_clickFilterChoice","$selected","_hideChooseFilters","_clearFilters","_clickUnpairedDataset","toggleSelectUnpaired","$dataset","force","waitToPair","pairAllSelected","fwds","revs","clearSelectedUnpaired","_mousedownUnpaired","$startTarget","moveListener","_clickPairRow","rowIndex","eq","_startPartitionDrag","endDrag","unbind","trackMouse","startingY","adjPartition","mousemove","adj","$unpaired","$paired","unpairedHi","parseInt","pairedHi","movingUpwards","flex","selectPair","clearSelectedPaired","_clickPairName","$name","$pair","customizedName","_clickUnpair","pairIndex","_dragoverPairedColumns","_getNearestPairedDatasetLi","_dropPairedColumns","_syncPairsToDom","newPaired","_pairDragstart","_pairDragend","_printList","_printPair","LIST_CREATOR","createPairCollection","pairCollectionCreatorModal","PairedDatasetCollectionElementView","identifier","PairCollectionCreator","_createForwardElementView","_createReverseElementView","swap","click .swap","HDA_LI","HDAListItemEdit","click .unhide-link","HDCA_LI","DC_PANEL_EDIT","HDCAListItemEdit","HPANEL","HDA_LI_EDIT","HDCA_LI_EDIT","PAIR_COLLECTION_CREATOR","LIST_OF_PAIRS_COLLECTION_CREATOR","HistoryPanel","HDAViewClass","HDCAViewClass","dataDropped","dropTargetOff","_renderCounts","_handleHdaDeletionChange","_handleHdaVisibleChange","updateHistoryDiskSize","toggleLink","_class","where","msgs","showDeleted","showHidden","toggleHDATagEditors","toggleHDAAnnotationEditors","_collectionActions","showOrHide","click .show-selectors-btn","click .toggle-deleted-link","toggleShowDeleted","click .toggle-hidden-link","toggleShowHidden","dropTargetOn","dropTarget","dropHandlers","dragenter","dragleave","$dropTarget","_renderDropTarget","_renderDropTargetHelp","evName","margin","border-radius","font-size","font-style","_dropHandlers","dropTargetToggle","getData","HISTORY_MODEL","COLLECTION_PANEL","USER","HistoryPrefs","expandedIds","addExpanded","removeExpanded","storageKeyPrefix","historyStorageKey","clearAll","loading-done","views:ready view:attached view:removed","_renderSelectButton","loadHistoryWithDetails","loadHistory","initiallyExpanded","_loadHistoryFromXHR","JSONToModel","refreshContents","newHistoryJSON","newHdaJSON","_setUpWebStorage","storage","isBoolean","change:show_deleted","newVal","change:show_hidden","$existing","prependTo","click .messages [class$=message]","store","inputSelector","parsed","_parseErrorMessage","displayMessage","sentryId","_bePolite","raven","Raven","lastEventId","agent","lastAjax","getAllResponseHeaders","responseHeaders","compact","$msgContainer","$detailsLink","_messageToModalOptions","functions","pre","Ok","clearMessages","$target","scrollToHid","$indicator","$text","cover","z-index","bottom","right","background-color","text-align","margin-top","matrix","charAt"],"mappings":"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ACA,SACA,+EACA,oCACA,UACAgB,KAAA,KAGAwY,OAAAzhB,EAAA8I,UACA,iCACA,sBACA,sDACAb,EAAA,8CACA,iEACA,WACA,SACA,sBACA,0DACA,gBAAAA,EAAA,yCACA,kDAAAA,EAAA,kBACA,SACA,SAEA,gDACA,wCACA,mDAAAA,EAAA,sBACA,8CACA,0EACAA,EAAA,yCACA,+BACA,YACA,yCACA,mBAAAA,EAAA,2CACA,mBAAAA,EAAA,yDACA,QACA,SACA,SAEA,wCACA,qDAAAA,EAAA,2BACA,SACA,UACAgB,KAAA,KAGAmY,YAAAphB,EAAA8I,UACA,MAAAb,GACA,wGACA,2GACA,yGACA,sCACAgB,KAAA,YACA,MAAAhB,GACA,8FACA,yDACA,wFACA,iCACA,8BACA,sEACA,yDACA,4CACA,sEACA,yDACA,QACA,6DACA,qEACA,uDACA,4CACA,QACA,6DACA,4DACA,QACA,SACAgB,KAAA,YACA,MAAAhB,GACA,gEACA,oDACA,yEACA,sEACA,QACA,8DACA,mEACA,QACA,iEACA,8FACA,uEACA,6CACA,QACA,4CACA,iEACA,QACA,SACAgB,KAAA,YACA,MAAAhB,GACA,iDACA,2FACA,0FACAgB,KAAA,YACA,MAAAhB,GACA,sGACA,qGACAgB,KAAA,YACA,MAAAhB,GACA,4FACA,gEACA,oEACAgB,KAAA,aACAA,KAAA,KAMA,IAAAmmC,GAAA,SAAAO,EAAAjwC,GAEA,GACAqf,GADAuI,EAAAriB,OAAAsiB,UAeA,IAZA7nB,EAAAM,EAAAkG,SAAAxG,OACAiwC,WACAhxB,SAAA,WACA/e,OAAA4nB,MAAAlX,OACAgX,EAAAG,OAAA,cAEA/I,SAAA,SAAAK,EAAAza,GACA1E,OAAA4nB,MAAAlX,OACAgX,EAAAI,QAAApjB,OAIA9E,OAAAI,gBAAA4nB,MACA,SAAAvd,OAAA,mCAeA,OAZA8U,GAAA,GAAA2wB,GAAAhwC,GACAE,OAAA4nB,MAAAnX,MACA6B,MAAA,yCACAmD,KAAA0J,EAAAtd,IACA+T,MAAA,MACAD,OAAA,QACAE,gBAAA,IAEAsJ,EAAAvd,SACAhC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","file":"history.bundled.js","sourcesContent":["webpackJsonp([4],[\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\n\tvar GalaxyMasthead = __webpack_require__( 23 ).GalaxyMasthead,\n\t    GalaxyMenu = __webpack_require__( 48 ).GalaxyMenu,\n\t    History = __webpack_require__( 33 ).History,\n\t    HistoryPanelEdit = __webpack_require__( 68 ).HistoryPanelEdit;\n\t\n\t//TODO: this doesn't address multiple apps per page\n\twindow.app = function app( options, bootstrapped ){\n\t    if( !( Galaxy.masthead && Galaxy.menu ) ){\n\t        // adapter to galaxy.masthead.mako config\n\t        var mastheadConfig = _.extend( _.clone( Galaxy.config ), {\n\t            user : {\n\t                requests    : Galaxy.currUser.get( 'requests' ),\n\t                email       : Galaxy.currUser.get( 'email' ),\n\t                valid       : Galaxy.currUser.isAnonymous(),\n\t                json        : Galaxy.currUser.toJSON()\n\t            }\n\t        });\n\t        Galaxy.masthead = new GalaxyMasthead( mastheadConfig );\n\t        Galaxy.menu = new GalaxyMenu({\n\t            masthead    : Galaxy.masthead,\n\t            config      : mastheadConfig\n\t        });\n\t        console.debug( Galaxy.masthead );\n\t        console.debug( Galaxy.menu );\n\t    }\n\t\n\t    bootstrapped = bootstrapped || {};\n\t    window.panel = new HistoryPanelEdit({\n\t        show_deleted    : bootstrapped.show_deleted,\n\t        show_hidden     : bootstrapped.show_deleted,\n\t        purgeAllowed    : Galaxy.config.allow_user_dataset_purge,\n\t        model           : new History( bootstrapped.history, bootstrapped.contents )\n\t    });\n\t    $(function(){\n\t        panel.render().$el.appendTo( ( options || {} ).panelLoc || 'body' );\n\t    });\n\t\n\t    return panel;\n\t};\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( localeStrings ){\n\t    localeStrings = {};\n\t// =============================================================================\n\t/** Attempt to get a localized string for strToLocalize. If not found, return\n\t *      the original strToLocalize.\n\t * @param {String} strToLocalize the string to localize\n\t * @returns either the localized string if found or strToLocalize if not found\n\t */\n\tvar localize = function( strToLocalize ){\n\t    //console.debug( this + '.localize:', strToLocalize );\n\t\n\t    // cache strings that need to be localized but haven't been?\n\t    if( localize.cacheNonLocalized && !localeStrings.hasOwnProperty( strToLocalize ) ){\n\t        //console.debug( 'localization NOT found:', strToLocalize );\n\t        // add nonCached as hash directly to this function\n\t        if( !localize.nonLocalized ){ localize.nonLocalized = {}; }\n\t        localize.nonLocalized[ strToLocalize ] = navigator.language;\n\t    }\n\t    // return the localized version from the closure if it's there, the strToLocalize if not\n\t    return localeStrings[ strToLocalize ] || strToLocalize;\n\t};\n\tlocalize.cacheNonLocalized = false;\n\t\n\t\n\t// =============================================================================\n\t    return localize;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/**\n\t * Galaxy utilities comprises small functions, which at this point\n\t * do not require their own classes/files\n\t*/\n\t\n\t// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\t\n\t/** Traverse through json\n\t*/\n\tfunction deepeach(dict, callback) {\n\t    for (var i in dict) {\n\t        var d = dict[i];\n\t        if (d && typeof(d) == \"object\") {\n\t            callback(d);\n\t            deepeach(d, callback);\n\t        }\n\t    }\n\t}\n\t\n\t/**\n\t * Check if a string is a json string\n\t * @param{String}   text - Content to be validated\n\t */\n\tfunction isJSON(text) {\n\t    return /^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').\n\t        replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').\n\t        replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''));\n\t};\n\t\n\t/**\n\t * Sanitize/escape a string\n\t * @param{String}   content - Content to be sanitized\n\t */\n\tfunction sanitize(content) {\n\t    return $('<div/>').text(content).html();\n\t};\n\t\n\t/**\n\t * Validate atomic values or list of values\n\t * usually used for selectable options\n\t * @param{String}   value - Value or list to be validated\n\t */\n\tfunction validate (value) {\n\t    if (!(value instanceof Array)) {\n\t        value = [value];\n\t    }\n\t    if (value.length === 0) {\n\t        return false;\n\t    }\n\t    for (var i in value) {\n\t        if (['__null__', '__undefined__', null, undefined].indexOf(value[i]) > -1) {\n\t            return false;\n\t        }\n\t    }\n\t    return true;\n\t};\n\t\n\t/**\n\t * Convert list to pretty string\n\t * @param{String}   lst - List of strings to be converted in human readable list sentence\n\t */\n\tfunction textify(lst) {\n\t    var lst = lst.toString();\n\t    if (lst) {\n\t        lst = lst.replace(/,/g, ', ');\n\t        var pos = lst.lastIndexOf(', ');\n\t        if (pos != -1) {\n\t            lst = lst.substr(0, pos) + ' or ' + lst.substr(pos+1);\n\t        }\n\t        return lst;\n\t    }\n\t    return '';\n\t};\n\t\n\t/**\n\t * Request handler for GET\n\t * @param{String}   url     - Url request is made to\n\t * @param{Function} success - Callback on success\n\t * @param{Function} error   - Callback on error\n\t * @param{Boolean}  cache   - Use cached data if available\n\t */\n\tfunction get (options) {\n\t    top.__utils__get__ = top.__utils__get__ || {};\n\t    if (options.cache && top.__utils__get__[options.url]) {\n\t        options.success && options.success(top.__utils__get__[options.url]);\n\t        console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n\t    } else {\n\t        request({\n\t            url     : options.url,\n\t            data    : options.data,\n\t            success : function(response) {\n\t                top.__utils__get__[options.url] = response;\n\t                options.success && options.success(response);\n\t            },\n\t            error : function(response) {\n\t                options.error && options.error(response);\n\t            }\n\t        });\n\t    }\n\t};\n\t\n\t/**\n\t * Request handler\n\t * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n\t * @param{String}   url     - Url request is made to\n\t * @param{Object}   data    - Data send to url\n\t * @param{Function} success - Callback on success\n\t * @param{Function} error   - Callback on error\n\t */\n\tfunction request (options) {\n\t    // prepare ajax\n\t    var ajaxConfig = {\n\t        contentType : 'application/json',\n\t        type        : options.type || 'GET',\n\t        data        : options.data || {},\n\t        url         : options.url\n\t    }\n\t\n\t    // encode data into url\n\t    if (ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE') {\n\t        if (ajaxConfig.url.indexOf('?') == -1) {\n\t            ajaxConfig.url += '?';\n\t        } else {\n\t            ajaxConfig.url += '&';\n\t        }\n\t        ajaxConfig.url      = ajaxConfig.url + $.param(ajaxConfig.data, true);\n\t        ajaxConfig.data     = null;\n\t    } else {\n\t        ajaxConfig.dataType = 'json';\n\t        ajaxConfig.url      = ajaxConfig.url;\n\t        ajaxConfig.data     = JSON.stringify(ajaxConfig.data);\n\t    }\n\t\n\t    // make request\n\t    $.ajax(ajaxConfig)\n\t    .done(function(response) {\n\t        if (typeof response === 'string') {\n\t            try {\n\t                response = response.replace('Infinity,', '\"Infinity\",');\n\t                response = jQuery.parseJSON(response);\n\t            } catch (e) {\n\t                console.debug(e);\n\t            }\n\t        }\n\t        options.success && options.success(response);\n\t    })\n\t    .fail(function(response) {\n\t        var response_text = null;\n\t        try {\n\t            response_text = jQuery.parseJSON(response.responseText);\n\t        } catch (e) {\n\t            response_text = response.responseText;\n\t        }\n\t        options.error && options.error(response_text, response);\n\t    });\n\t};\n\t\n\t/**\n\t * Read a property value from CSS\n\t * @param{String}   classname   - CSS class\n\t * @param{String}   name        - CSS property\n\t */\n\tfunction cssGetAttribute (classname, name) {\n\t    var el = $('<div class=\"' + classname + '\"></div>');\n\t    el.appendTo(':eq(0)');\n\t    var value = el.css(name);\n\t    el.remove();\n\t    return value;\n\t};\n\t\n\t/**\n\t * Load a CSS file\n\t * @param{String}   url - Url of CSS file\n\t */\n\tfunction cssLoadFile (url) {\n\t    if (!$('link[href^=\"' + url + '\"]').length) {\n\t        $('<link href=\"' + galaxy_config.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n\t    }\n\t};\n\t\n\t/**\n\t * Safely merge to dictionaries\n\t * @param{Object}   options         - Target dictionary\n\t * @param{Object}   optionsDefault  - Source dictionary\n\t */\n\tfunction merge (options, optionsDefault) {\n\t    if (options) {\n\t        return _.defaults(options, optionsDefault);\n\t    } else {\n\t        return optionsDefault;\n\t    }\n\t};\n\t\n\t\n\t/**\n\t * Round floaing point 'number' to 'numPlaces' number of decimal places.\n\t * @param{Object}   number      a floaing point number\n\t * @param{Object}   numPlaces   number of decimal places\n\t */\n\tfunction roundToDecimalPlaces( number, numPlaces ){\n\t    var placesMultiplier = 1;\n\t    for( var i=0; i<numPlaces; i++ ){\n\t        placesMultiplier *= 10;\n\t    }\n\t    return Math.round( number * placesMultiplier ) / placesMultiplier;\n\t}\n\t\n\t// calculate on import\n\tvar kb = 1024,\n\t    mb = kb * kb,\n\t    gb = mb * kb,\n\t    tb = gb * kb;\n\t/**\n\t * Format byte size to string with units\n\t * @param{Integer}   size           - Size in bytes\n\t * @param{Boolean}   normal_font    - Switches font between normal and bold\n\t */\n\tfunction bytesToString (size, normal_font, numberPlaces) {\n\t    numberPlaces = numberPlaces !== undefined? numberPlaces: 1;\n\t    // identify unit\n\t    var unit = \"\";\n\t    if (size >= tb){ size = size / tb; unit = 'TB'; } else\n\t    if (size >= gb){ size = size / gb; unit = 'GB'; } else\n\t    if (size >= mb){ size = size / mb; unit = 'MB'; } else\n\t    if (size >= kb){ size = size / kb; unit = 'KB'; } else\n\t    if (size >  0){ unit = 'b'; }\n\t    else { return normal_font? '0 b': '<strong>-</strong>'; }\n\t    // return formatted string\n\t    var rounded = unit == 'b'? size: roundToDecimalPlaces( size, numberPlaces );\n\t    if (normal_font) {\n\t       return  rounded + ' ' + unit;\n\t    } else {\n\t        return '<strong>' + rounded + '</strong> ' + unit;\n\t    }\n\t};\n\t\n\t/**\n\t * Create a unique id\n\t */\n\tfunction uid(){\n\t    top.__utils__uid__ = top.__utils__uid__ || 0;\n\t    return 'uid-' + top.__utils__uid__++;\n\t};\n\t\n\t/**\n\t * Create a time stamp\n\t */\n\tfunction time() {\n\t    var d = new Date();\n\t    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n\t    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes()\n\t    return datetime = d.getDate() + \"/\"\n\t                + (d.getMonth() + 1)  + \"/\"\n\t                + d.getFullYear() + \", \"\n\t                + hours + \":\"\n\t                + minutes;\n\t};\n\t\n\treturn {\n\t    cssLoadFile: cssLoadFile,\n\t    cssGetAttribute: cssGetAttribute,\n\t    get: get,\n\t    merge: merge,\n\t    bytesToString: bytesToString,\n\t    uid: uid,\n\t    time: time,\n\t    request: request,\n\t    sanitize: sanitize,\n\t    textify: textify,\n\t    validate: validate,\n\t    deepeach: deepeach,\n\t    isJSON: isJSON\n\t};\n\t\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(5),\n\t    __webpack_require__(9),\n\t    __webpack_require__(25),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( _, Backbone, addLogging, _l ){\n\t//==============================================================================\n\t/** @class Mixin to add logging capabilities to an object.\n\t *      Designed to allow switching an objects log output off/on at one central\n\t *      statement. Can be used with plain browser console (or something more\n\t *      complex like an AJAX logger).\n\t *  <br />NOTE: currently only uses the console.debug log function\n\t *  (as opposed to debug, error, warn, etc.)\n\t *  @name LoggableMixin\n\t *\n\t *  @example\n\t *  // Add to your models/views at the definition using chaining:\n\t *      var MyModel = Backbone.Model.extend( LoggableMixin ).extend({ // ... });\n\t *\n\t *  // or - more explicitly AFTER the definition:\n\t *      var MyModel = Backbone.Model.extend({\n\t *          logger  : console\n\t *          // ...\n\t *          this.log( '$#%& it! - broken already...' );\n\t *      })\n\t *      _.extend( MyModel.prototype, LoggableMixin )\n\t *\n\t */\n\tvar LoggableMixin =  /** @lends LoggableMixin# */{\n\t\n\t    /** The logging object whose log function will be used to output\n\t     *      messages. Null will supress all logging. Commonly set to console.\n\t     */\n\t    // replace null with console (if available) to see all logs\n\t    logger       : null,\n\t    _logNamespace : '?',\n\t\n\t    /** Output log messages/arguments to logger.\n\t     *  @param {Arguments} ... (this function is variadic)\n\t     *  @returns undefined if not this.logger\n\t     */\n\t    log : function(){\n\t        if( this.logger ){\n\t            var log = this.logger.log;\n\t            if( typeof this.logger.log === 'object' ){\n\t//TODO:! there has to be a way to get the lineno/file into this\n\t                log = Function.prototype.bind.call( this.logger.log, this.logger );\n\t            }\n\t            return log.apply( this.logger, arguments );\n\t        }\n\t        return undefined;\n\t    }\n\t};\n\taddLogging( LoggableMixin );\n\t\n\t\n\t//==============================================================================\n\t/** Backbone model that syncs to the browser's sessionStorage API.\n\t *      This all largely happens behind the scenes and no special calls are required.\n\t */\n\tvar SessionStorageModel = Backbone.Model.extend({\n\t    initialize : function( initialAttrs ){\n\t        // check for sessionStorage and error if no id is provided\n\t        this._checkEnabledSessionStorage();\n\t        if( !initialAttrs.id ){\n\t            throw new Error( 'SessionStorageModel requires an id in the initial attributes' );\n\t        }\n\t        this.id = initialAttrs.id;\n\t\n\t        // load existing from storage (if any), clear any attrs set by bbone before init is called,\n\t        //  layer initial over existing and defaults, and save\n\t        var existing = ( !this.isNew() )?( this._read( this ) ):( {} );\n\t        this.clear({ silent: true });\n\t        this.save( _.extend( {}, this.defaults, existing, initialAttrs ), { silent: true });\n\t\n\t        // save on any change to it immediately\n\t        this.on( 'change', function(){\n\t            this.save();\n\t        });\n\t    },\n\t\n\t    _checkEnabledSessionStorage : function(){\n\t        try {\n\t            return sessionStorage.length;\n\t        } catch( err ){\n\t            alert( 'Please enable cookies in your browser for this Galaxy site' );\n\t            return false;\n\t        }\n\t    },\n\t\n\t    /** override of bbone sync to save to sessionStorage rather than REST\n\t     *      bbone options (success, errror, etc.) should still apply\n\t     */\n\t    sync : function( method, model, options ){\n\t        if( !options.silent ){\n\t            model.trigger( 'request', model, {}, options );\n\t        }\n\t        var returned = {};\n\t        switch( method ){\n\t            case 'create'   : returned = this._create( model ); break;\n\t            case 'read'     : returned = this._read( model );   break;\n\t            case 'update'   : returned = this._update( model ); break;\n\t            case 'delete'   : returned = this._delete( model ); break;\n\t        }\n\t        if( returned !== undefined || returned !== null ){\n\t            if( options.success ){ options.success(); }\n\t        } else {\n\t            if( options.error ){ options.error(); }\n\t        }\n\t        return returned;\n\t    },\n\t\n\t    /** set storage to the stringified item */\n\t    _create : function( model ){\n\t        try {\n\t            var json = model.toJSON(),\n\t                set = sessionStorage.setItem( model.id, JSON.stringify( json ) );\n\t            return ( set === null )?( set ):( json );\n\t        // DOMException is thrown in Safari if in private browsing mode and sessionStorage is attempted:\n\t        // http://stackoverflow.com/questions/14555347\n\t        // TODO: this could probably use a more general soln - like detecting priv. mode + safari => non-ajaxing Model\n\t        } catch( err ){\n\t            if( !( ( err instanceof DOMException ) && ( navigator.userAgent.indexOf(\"Safari\") > -1 ) ) ){\n\t                throw err;\n\t            }\n\t        }\n\t        return null;\n\t    },\n\t\n\t    /** read and parse json from storage */\n\t    _read : function( model ){\n\t        return JSON.parse( sessionStorage.getItem( model.id ) );\n\t    },\n\t\n\t    /** set storage to the item (alias to create) */\n\t    _update : function( model ){\n\t        return model._create( model );\n\t    },\n\t\n\t    /** remove the item from storage */\n\t    _delete : function( model ){\n\t        return sessionStorage.removeItem( model.id );\n\t    },\n\t\n\t    /** T/F whether sessionStorage contains the model's id (data is present) */\n\t    isNew : function(){\n\t        return !sessionStorage.hasOwnProperty( this.id );\n\t    },\n\t\n\t    _log : function(){\n\t        return JSON.stringify( this.toJSON(), null, '  ' );\n\t    },\n\t    toString : function(){\n\t        return 'SessionStorageModel(' + this.id + ')';\n\t    }\n\t\n\t});\n\t(function(){\n\t    SessionStorageModel.prototype = _.omit( SessionStorageModel.prototype, 'url', 'urlRoot' );\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** Function that allows mixing of hashs into bbone MVC while showing the mixins first\n\t *      (before the more local class overrides/hash).\n\t *      Basically, a simple reversal of param order on _.defaults() - to show mixins in top of definition.\n\t *  @example:\n\t *      var NewModel = Something.extend( mixin( MyMixinA, MyMixinB, { ... myVars : ... }) );\n\t *\n\t *  NOTE: this does not combine any hashes (like events, etc.) and you're expected to handle that\n\t */\n\tfunction mixin( mixinHash1, /* mixinHash2, etc: ... variadic */ propsHash ){\n\t    var args = Array.prototype.slice.call( arguments, 0 ),\n\t        lastArg = args.pop();\n\t    args.unshift( lastArg );\n\t    return _.defaults.apply( _, args );\n\t}\n\t\n\t\n\t//==============================================================================\n\t/** A mixin for models that allow T/F/Matching to their attributes - useful when\n\t *      searching or filtering collections of models.\n\t * @example:\n\t *      see hda-model for searchAttribute and searchAliases definition examples.\n\t *      see history-contents.matches for how collections are filtered\n\t *      and see readonly-history-panel.searchHdas for how user input is connected to the filtering\n\t */\n\tvar SearchableModelMixin = {\n\t\n\t    /** what attributes of an HDA will be used in a text search */\n\t    searchAttributes : [\n\t        // override\n\t    ],\n\t\n\t    /** our attr keys don't often match the labels we display to the user - so, when using\n\t     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n\t     *      following attr keys.\n\t     */\n\t    searchAliases : {\n\t        // override\n\t    },\n\t\n\t    /** search the attribute with key attrKey for the string searchFor; T/F if found */\n\t    searchAttribute : function( attrKey, searchFor ){\n\t        var attrVal = this.get( attrKey );\n\t        //this.debug( 'searchAttribute', attrKey, attrVal, searchFor );\n\t        // bail if empty searchFor or unsearchable values\n\t        if( !searchFor\n\t        ||  ( attrVal === undefined || attrVal === null ) ){\n\t            return false;\n\t        }\n\t        // pass to sep. fn for deep search of array attributes\n\t        if( _.isArray( attrVal ) ){ return this._searchArrayAttribute( attrVal, searchFor ); }\n\t        return ( attrVal.toString().toLowerCase().indexOf( searchFor.toLowerCase() ) !== -1 );\n\t    },\n\t\n\t    /** deep(er) search for array attributes; T/F if found */\n\t    _searchArrayAttribute : function( array, searchFor ){\n\t        //this.debug( '_searchArrayAttribute', array, searchFor );\n\t        searchFor = searchFor.toLowerCase();\n\t        //precondition: searchFor has already been validated as non-empty string\n\t        //precondition: assumes only 1 level array\n\t        //TODO: could possibly break up searchFor more (CSV...)\n\t        return _.any( array, function( elem ){\n\t            return ( elem.toString().toLowerCase().indexOf( searchFor.toLowerCase() ) !== -1 );\n\t        });\n\t    },\n\t\n\t    /** search all searchAttributes for the string searchFor,\n\t     *      returning a list of keys of attributes that contain searchFor\n\t     */\n\t    search : function( searchFor ){\n\t        var model = this;\n\t        return _.filter( this.searchAttributes, function( key ){\n\t            return model.searchAttribute( key, searchFor );\n\t        });\n\t    },\n\t\n\t    /** alias of search, but returns a boolean; accepts attribute specifiers where\n\t     *      the attributes searched can be narrowed to a single attribute using\n\t     *      the form: matches( 'genome_build=hg19' )\n\t     *      (the attribute keys allowed can also be aliases to the true attribute key;\n\t     *          see searchAliases above)\n\t     *  @param {String} term   plain text or ATTR_SPECIFIER sep. key=val pair\n\t     *  @returns {Boolean} was term found in (any) attribute(s)\n\t     */\n\t    matches : function( term ){\n\t        var ATTR_SPECIFIER = '=',\n\t            split = term.split( ATTR_SPECIFIER );\n\t        // attribute is specified - search only that\n\t        if( split.length >= 2 ){\n\t            var attrKey = split[0];\n\t            attrKey = this.searchAliases[ attrKey ] || attrKey;\n\t            return this.searchAttribute( attrKey, split[1] );\n\t        }\n\t        // no attribute is specified - search all attributes in searchAttributes\n\t        return !!this.search( term ).length;\n\t    },\n\t\n\t    /** an implicit AND search for all terms; IOW, a model must match all terms given\n\t     *      where terms is a whitespace separated value string.\n\t     *      e.g. given terms of: 'blah bler database=hg19'\n\t     *          an HDA would have to have attributes containing blah AND bler AND a genome_build == hg19\n\t     *      To include whitespace in terms: wrap the term in double quotations (name=\"blah bler\").\n\t     */\n\t    matchesAll : function( terms ){\n\t        var model = this;\n\t        // break the terms up by whitespace and filter out the empty strings\n\t        terms = terms.match( /(\".*\"|\\w*=\".*\"|\\S*)/g ).filter( function( s ){ return !!s; });\n\t        return _.all( terms, function( term ){\n\t            term = term.replace( /\"/g, '' );\n\t            return model.matches( term );\n\t        });\n\t    }\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** A view that renders hidden and shows when some activator is clicked.\n\t *      options:\n\t *          showFn: the effect used to show/hide the View (defaults to jq.toggle)\n\t *          $elementShown: some jqObject (defaults to this.$el) to be shown/hidden\n\t *          onShowFirstTime: fn called the first time the view is shown\n\t *          onshow: fn called every time the view is shown\n\t *          onhide: fn called every time the view is hidden\n\t *      events:\n\t *          hiddenUntilActivated:shown (the view is passed as an arg)\n\t *          hiddenUntilActivated:hidden (the view is passed as an arg)\n\t *      instance vars:\n\t *          view.hidden {boolean} is the view in the hidden state\n\t */\n\tvar HiddenUntilActivatedViewMixin = /** @lends hiddenUntilActivatedMixin# */{\n\t//TODO: since this is a mixin, consider moving toggle, hidden into HUAVOptions\n\t\n\t    /** call this in your initialize to set up the mixin\n\t     *  @param {jQuery} $activator the 'button' that's clicked to show/hide the view\n\t     *  @param {Object} hash with mixin options\n\t     */\n\t    hiddenUntilActivated : function( $activator, options ){\n\t        // call this in your view's initialize fn\n\t        options = options || {};\n\t//TODO: flesh out options - show them all here\n\t        this.HUAVOptions = {\n\t            $elementShown   : this.$el,\n\t            showFn          : jQuery.prototype.toggle,\n\t            showSpeed       : 'fast'\n\t        };\n\t        _.extend( this.HUAVOptions, options || {});\n\t        /** has this been shown already (and onshowFirstTime called)? */\n\t        this.HUAVOptions.hasBeenShown = this.HUAVOptions.$elementShown.is( ':visible' );\n\t        this.hidden = this.isHidden();\n\t\n\t        if( $activator ){\n\t            var mixin = this;\n\t            $activator.on( 'click', function( ev ){\n\t                mixin.toggle( mixin.HUAVOptions.showSpeed );\n\t            });\n\t        }\n\t    },\n\t\n\t//TODO:?? remove? use .hidden?\n\t    /** returns T/F if the view is hidden */\n\t    isHidden : function(){\n\t        return ( this.HUAVOptions.$elementShown.is( ':hidden' ) );\n\t    },\n\t\n\t    /** toggle the hidden state, show/hide $elementShown, call onshow/hide, trigger events */\n\t    toggle : function(){\n\t//TODO: more specific name - toggle is too general\n\t        // can be called manually as well with normal toggle arguments\n\t        //TODO: better as a callback (when the show/hide is actually done)\n\t        // show\n\t        if( this.hidden ){\n\t            // fire the optional fns on the first/each showing - good for render()\n\t            if( !this.HUAVOptions.hasBeenShown ){\n\t                if( _.isFunction( this.HUAVOptions.onshowFirstTime ) ){\n\t                    this.HUAVOptions.hasBeenShown = true;\n\t                    this.HUAVOptions.onshowFirstTime.call( this );\n\t                }\n\t            }\n\t            if( _.isFunction( this.HUAVOptions.onshow ) ){\n\t                this.HUAVOptions.onshow.call( this );\n\t                this.trigger( 'hiddenUntilActivated:shown', this );\n\t            }\n\t            this.hidden = false;\n\t\n\t        // hide\n\t        } else {\n\t            if( _.isFunction( this.HUAVOptions.onhide ) ){\n\t                this.HUAVOptions.onhide.call( this );\n\t                this.trigger( 'hiddenUntilActivated:hidden', this );\n\t            }\n\t            this.hidden = true;\n\t        }\n\t        return this.HUAVOptions.showFn.apply( this.HUAVOptions.$elementShown, arguments );\n\t    }\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** Mixin for views that can be dragged and dropped\n\t *      Allows for the drag behavior to be turned on/off, setting/removing jQuery event\n\t *          handlers each time.\n\t *      dataTransfer data is set to the JSON string of the view's model.toJSON\n\t *      Override '$dragHandle' to define the draggable DOM sub-element.\n\t */\n\tvar DraggableViewMixin = {\n\t\n\t    /** set up instance vars to track whether this view is currently draggable */\n\t    initialize : function( attributes ){\n\t        /** is the body of this hda view expanded/not? */\n\t        this.draggable  = attributes.draggable || false;\n\t    },\n\t\n\t    /** what part of the view's DOM triggers the dragging */\n\t    $dragHandle : function(){\n\t//TODO: make abstract/general - move this to listItem\n\t        // override to the element you want to be your view's handle\n\t        return this.$( '.title-bar' );\n\t    },\n\t\n\t    /** toggle whether this view is draggable */\n\t    toggleDraggable : function(){\n\t        if( this.draggable ){\n\t            this.draggableOff();\n\t        } else {\n\t            this.draggableOn();\n\t        }\n\t    },\n\t\n\t    /** allow the view to be dragged, set up event handlers */\n\t    draggableOn : function(){\n\t        this.draggable = true;\n\t        this.dragStartHandler = _.bind( this._dragStartHandler, this );\n\t        this.dragEndHandler   = _.bind( this._dragEndHandler,   this );\n\t\n\t        var handle = this.$dragHandle().attr( 'draggable', true ).get(0);\n\t        handle.addEventListener( 'dragstart', this.dragStartHandler, false );\n\t        handle.addEventListener( 'dragend',   this.dragEndHandler,   false );\n\t    },\n\t\n\t    /** turn of view dragging and remove event listeners */\n\t    draggableOff : function(){\n\t        this.draggable = false;\n\t        var handle = this.$dragHandle().attr( 'draggable', false ).get(0);\n\t        handle.removeEventListener( 'dragstart', this.dragStartHandler, false );\n\t        handle.removeEventListener( 'dragend',   this.dragEndHandler,   false );\n\t    },\n\t\n\t    /** sets the dataTransfer data to the model's toJSON\n\t     *  @fires draggable:dragstart (bbone event) which is passed the event and this view\n\t     */\n\t    _dragStartHandler : function( event ){\n\t        event.dataTransfer.effectAllowed = 'move';\n\t        //ASSUMES: this.model\n\t        //TODO: all except IE: should be 'application/json', IE: must be 'text'\n\t        event.dataTransfer.setData( 'text', JSON.stringify( this.model.toJSON() ) );\n\t        this.trigger( 'draggable:dragstart', event, this );\n\t        return false;\n\t    },\n\t\n\t    /** handle the dragend\n\t     *  @fires draggable:dragend (bbone event) which is passed the event and this view\n\t     */\n\t    _dragEndHandler : function( event ){\n\t        this.trigger( 'draggable:dragend', event, this );\n\t        return false;\n\t    }\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** Mixin that allows a view to be selected (gen. from a list).\n\t *      Selection controls ($selector) may be hidden/shown/toggled.\n\t *          The bbone event 'selectable' is fired when the controls are shown/hidden (passed T/F).\n\t *      Default rendering is a font-awesome checkbox.\n\t *      Default selector is '.selector' within the view's $el.\n\t *      The bbone events 'selected' and 'de-selected' are fired when the $selector is clicked.\n\t *          Both events are passed the view and the (jQuery) event.\n\t */\n\tvar SelectableViewMixin = {\n\t\n\t    /** Set up instance state vars for whether the selector is shown and whether the view has been selected */\n\t    initialize : function( attributes ){\n\t        /** is the view currently in selection mode? */\n\t        this.selectable = attributes.selectable || false;\n\t        /** is the view currently selected? */\n\t        this.selected   = attributes.selected || false;\n\t    },\n\t\n\t    /** $el sub-element where the selector is rendered and what can be clicked to select. */\n\t    $selector : function(){\n\t        return this.$( '.selector' );\n\t    },\n\t\n\t    /** How the selector is rendered - defaults to font-awesome checkbox */\n\t    _renderSelected : function(){\n\t        // override\n\t        this.$selector().find( 'span' )\n\t            .toggleClass( 'fa-check-square-o', this.selected ).toggleClass( 'fa-square-o', !this.selected );\n\t    },\n\t\n\t    /** Toggle whether the selector is shown */\n\t    toggleSelector : function(){\n\t//TODO: use this.selectable\n\t        if( !this.$selector().is( ':visible' ) ){\n\t            this.showSelector();\n\t        } else {\n\t            this.hideSelector();\n\t        }\n\t    },\n\t\n\t    /** Display the selector control.\n\t     *  @param {Number} a jQuery fx speed\n\t     *  @fires: selectable which is passed true (IOW, the selector is shown) and the view\n\t     */\n\t    showSelector : function( speed ){\n\t        speed = speed !== undefined? speed : this.fxSpeed;\n\t        // make sure selected state is represented properly\n\t        this.selectable = true;\n\t        this.trigger( 'selectable', true, this );\n\t        this._renderSelected();\n\t        this.$selector().show( speed );\n\t    },\n\t\n\t    /** remove the selector control\n\t     *  @param {Number} a jQuery fx speed\n\t     *  @fires: selectable which is passed false (IOW, the selector is not shown) and the view\n\t     */\n\t    hideSelector : function( speed ){\n\t        speed = speed !== undefined? speed : this.fxSpeed;\n\t        // reverse the process from showSelect\n\t        this.selectable = false;\n\t        this.trigger( 'selectable', false, this );\n\t        this.$selector().hide( speed );\n\t    },\n\t\n\t    /** Toggle whether the view is selected */\n\t    toggleSelect : function( event ){\n\t        if( this.selected ){\n\t            this.deselect( event );\n\t        } else {\n\t            this.select( event );\n\t        }\n\t    },\n\t\n\t    /** Select this view and re-render the selector control to show it\n\t     *  @param {Event} a jQuery event that caused the selection\n\t     *  @fires: selected which is passed the view and the DOM event that triggered it (optionally)\n\t     */\n\t    select : function( event ){\n\t        // switch icon, set selected, and trigger event\n\t        if( !this.selected ){\n\t            this.trigger( 'selected', this, event );\n\t            this.selected = true;\n\t            this._renderSelected();\n\t        }\n\t        return false;\n\t    },\n\t\n\t    /** De-select this view and re-render the selector control to show it\n\t     *  @param {Event} a jQuery event that caused the selection\n\t     *  @fires: de-selected which is passed the view and the DOM event that triggered it (optionally)\n\t     */\n\t    deselect : function( event ){\n\t        // switch icon, set selected, and trigger event\n\t        if( this.selected ){\n\t            this.trigger( 'de-selected', this, event );\n\t            this.selected = false;\n\t            this._renderSelected();\n\t        }\n\t        return false;\n\t    }\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** Return an underscore template fn from an array of strings.\n\t *  @param {String[]} template      the template strings to compile into the underscore template fn\n\t *  @param {String} jsonNamespace   an optional namespace for the json data passed in (defaults to 'model')\n\t *  @returns {Function} the (wrapped) underscore template fn\n\t *      The function accepts:\n\t *\n\t *  The template strings can access:\n\t *      the json/model hash using model (\"<%- model.myAttr %>) using the jsonNamespace above\n\t *      _l: the localizer function\n\t *      view (if passed): ostensibly, the view using the template (handy for view instance vars)\n\t *      Because they're namespaced, undefined attributes will not throw an error.\n\t *\n\t *  @example:\n\t *      templateBler : BASE_MVC.wrapTemplate([\n\t *          '<div class=\"myclass <%- mynamespace.modelClass %>\">',\n\t *              '<span><% print( _l( mynamespace.message ) ); %>:<%= view.status %></span>'\n\t *          '</div>'\n\t *      ], 'mynamespace' )\n\t *\n\t *  Meant to be called in a View's definition in order to compile only once.\n\t *\n\t */\n\tfunction wrapTemplate( template, jsonNamespace ){\n\t    jsonNamespace = jsonNamespace || 'model';\n\t    var templateFn = _.template( template.join( '' ) );\n\t    return function( json, view ){\n\t        var templateVars = { view : view || {}, _l : _l };\n\t        templateVars[ jsonNamespace ] = json || {};\n\t        return templateFn( templateVars );\n\t    };\n\t}\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        LoggableMixin                   : LoggableMixin,\n\t        SessionStorageModel             : SessionStorageModel,\n\t        mixin                           : mixin,\n\t        SearchableModelMixin            : SearchableModelMixin,\n\t        HiddenUntilActivatedViewMixin   : HiddenUntilActivatedViewMixin,\n\t        DraggableViewMixin              : DraggableViewMixin,\n\t        SelectableViewMixin             : SelectableViewMixin,\n\t        wrapTemplate                    : wrapTemplate\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 4 */,\n/* 5 */,\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(){\n\t//==============================================================================\n\t/** Map of possible HDA/collection/job states to their string equivalents.\n\t *      A port of galaxy.model.Dataset.states.\n\t */\n\tvar STATES = {\n\t    // NOT ready states\n\t    /** is uploading and not ready */\n\t    UPLOAD              : 'upload',\n\t    /** the job that will produce the dataset queued in the runner */\n\t    QUEUED              : 'queued',\n\t    /** the job that will produce the dataset is running */\n\t    RUNNING             : 'running',\n\t    /** metadata for the dataset is being discovered/set */\n\t    SETTING_METADATA    : 'setting_metadata',\n\t\n\t    // ready states\n\t    /** was created without a tool */\n\t    NEW                 : 'new',\n\t    /** has no data */\n\t    EMPTY               : 'empty',\n\t    /** has successfully completed running */\n\t    OK                  : 'ok',\n\t\n\t    /** the job that will produce the dataset paused */\n\t    PAUSED              : 'paused',\n\t    /** metadata discovery/setting failed or errored (but otherwise ok) */\n\t    FAILED_METADATA     : 'failed_metadata',\n\t//TODO: not in trans.app.model.Dataset.states - is in database\n\t    /** not accessible to the current user (i.e. due to permissions) */\n\t    NOT_VIEWABLE        : 'noPermission',\n\t    /** deleted while uploading */\n\t    DISCARDED           : 'discarded',\n\t    /** the tool producing this dataset failed */\n\t    ERROR               : 'error'\n\t};\n\t\n\tSTATES.READY_STATES = [\n\t    STATES.OK,\n\t    STATES.EMPTY,\n\t    STATES.PAUSED,\n\t    STATES.FAILED_METADATA,\n\t    STATES.NOT_VIEWABLE,\n\t    STATES.DISCARDED,\n\t    STATES.ERROR\n\t];\n\t\n\tSTATES.NOT_READY_STATES = [\n\t    STATES.UPLOAD,\n\t    STATES.QUEUED,\n\t    STATES.RUNNING,\n\t    STATES.SETTING_METADATA,\n\t    STATES.NEW\n\t];\n\t\n\t\n\t//==============================================================================\n\t    return STATES;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory) {\n\t    if (true) {\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        root.faIconButton = factory();\n\t    }\n\t\n\t}(this, function () {\n\t//============================================================================\n\t    /** Returns a jQuery object containing a clickable font-awesome button.\n\t     *      options:\n\t     *          tooltipConfig   : option map for bootstrap tool tip\n\t     *          classes         : array of class names (will always be classed as icon-btn)\n\t     *          disabled        : T/F - add the 'disabled' class?\n\t     *          title           : tooltip/title string\n\t     *          target          : optional href target\n\t     *          href            : optional href\n\t     *          faIcon          : which font awesome icon to use\n\t     *          onclick         : function to call when the button is clicked\n\t     */\n\t    var faIconButton = function( options ){\n\t        options = options || {};\n\t        options.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\t\n\t        options.classes = [ 'icon-btn' ].concat( options.classes || [] );\n\t        if( options.disabled ){\n\t            options.classes.push( 'disabled' );\n\t        }\n\t\n\t        var html = [\n\t            '<a class=\"', options.classes.join( ' ' ), '\"',\n\t                    (( options.title )?( ' title=\"' + options.title + '\"' ):( '' )),\n\t                    (( !options.disabled && options.target )?  ( ' target=\"' + options.target + '\"' ):( '' )),\n\t                    ' href=\"', (( !options.disabled && options.href )?( options.href ):( 'javascript:void(0);' )), '\">',\n\t                // could go with something less specific here - like 'html'\n\t                '<span class=\"fa ', options.faIcon, '\"></span>',\n\t            '</a>'\n\t        ].join( '' );\n\t        var $button = $( html ).tooltip( options.tooltipConfig );\n\t        if( _.isFunction( options.onclick ) ){\n\t            $button.click( options.onclick );\n\t        }\n\t        return $button;\n\t    };\n\t\n\t//============================================================================\n\t    return faIconButton;\n\t}));\n\n\n/***/ },\n/* 8 */,\n/* 9 */,\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(34),\n\t    __webpack_require__(13),\n\t    __webpack_require__(12),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( LIST_PANEL, DC_MODEL, DC_LI, BASE_MVC, _l ){\n\t/* =============================================================================\n\tTODO:\n\t\n\t============================================================================= */\n\t/** @class non-editable, read-only View/Controller for a dataset collection.\n\t */\n\tvar _super = LIST_PANEL.ModelListPanel;\n\tvar CollectionPanel = _super.extend(\n\t/** @lends CollectionPanel.prototype */{\n\t    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    className           : _super.prototype.className + ' dataset-collection-panel',\n\t\n\t    /** sub view class used for datasets */\n\t    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n\t    /** sub view class used for nested collections */\n\t    NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView,\n\t    /** key of attribute in model to assign to this.collection */\n\t    modelCollectionKey  : 'elements',\n\t\n\t    // ......................................................................... SET UP\n\t    /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t     *  @param {Object} attributes optional settings for the panel\n\t     */\n\t    initialize : function( attributes ){\n\t        _super.prototype.initialize.call( this, attributes );\n\t        this.linkTarget = attributes.linkTarget || '_blank';\n\t\n\t        this.hasUser = attributes.hasUser;\n\t        /** A stack of panels that currently cover or hide this panel */\n\t        this.panelStack = [];\n\t        /** The text of the link to go back to the panel containing this one */\n\t        this.parentName = attributes.parentName;\n\t        /** foldout or drilldown */\n\t        this.foldoutStyle = attributes.foldoutStyle || 'foldout';\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ sub-views\n\t    /** In this override, use model.getVisibleContents */\n\t    _filterCollection : function(){\n\t//TODO: should *not* be model.getVisibleContents - visibility is not model related\n\t        return this.model.getVisibleContents();\n\t    },\n\t\n\t    /** override to return proper view class based on element_type */\n\t    _getItemViewClass : function( model ){\n\t        //this.debug( this + '._getItemViewClass:', model );\n\t//TODO: subclasses use DCEViewClass - but are currently unused - decide\n\t        switch( model.get( 'element_type' ) ){\n\t            case 'hda':\n\t                return this.DatasetDCEViewClass;\n\t            case 'dataset_collection':\n\t                return this.NestedDCDCEViewClass;\n\t        }\n\t        throw new TypeError( 'Unknown element type:', model.get( 'element_type' ) );\n\t    },\n\t\n\t    /** override to add link target and anon */\n\t    _getItemViewOptions : function( model ){\n\t        var options = _super.prototype._getItemViewOptions.call( this, model );\n\t        return _.extend( options, {\n\t            linkTarget      : this.linkTarget,\n\t            hasUser         : this.hasUser,\n\t//TODO: could move to only nested: list:paired\n\t            foldoutStyle    : this.foldoutStyle\n\t        });\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ collection sub-views\n\t    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n\t    _setUpItemViewListeners : function( view ){\n\t        var panel = this;\n\t        _super.prototype._setUpItemViewListeners.call( panel, view );\n\t\n\t        // use pub-sub to: handle drilldown expansion and collapse\n\t        view.on( 'expanded:drilldown', function( v, drilldown ){\n\t            this._expandDrilldownPanel( drilldown );\n\t        }, this );\n\t        view.on( 'collapsed:drilldown', function( v, drilldown ){\n\t            this._collapseDrilldownPanel( drilldown );\n\t        }, this );\n\t        return this;\n\t    },\n\t\n\t    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n\t    _expandDrilldownPanel : function( drilldown ){\n\t        this.panelStack.push( drilldown );\n\t        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n\t        this.$( '> .controls' ).add( this.$list() ).hide();\n\t        drilldown.parentName = this.model.get( 'name' );\n\t        this.$el.append( drilldown.render().$el );\n\t    },\n\t\n\t    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n\t    _collapseDrilldownPanel : function( drilldown ){\n\t        this.panelStack.pop();\n\t        this.render();\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel events\n\t    /** event map */\n\t    events : {\n\t        'click .navigation .back'       : 'close'\n\t    },\n\t\n\t    /** close/remove this collection panel */\n\t    close : function( event ){\n\t        this.$el.remove();\n\t        this.trigger( 'close' );\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'CollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t//------------------------------------------------------------------------------ TEMPLATES\n\tCollectionPanel.prototype.templates = (function(){\n\t\n\t    var controlsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"controls\">',\n\t            '<div class=\"navigation\">',\n\t                '<a class=\"back\" href=\"javascript:void(0)\">',\n\t                    '<span class=\"fa fa-icon fa-angle-left\"></span>',\n\t                    _l( 'Back to ' ), '<%- view.parentName %>',\n\t                '</a>',\n\t            '</div>',\n\t\n\t            '<div class=\"title\">',\n\t                '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>',\n\t                '<div class=\"subtitle\">',\n\t//TODO: remove logic from template\n\t                    '<% if( collection.collection_type === \"list\" ){ %>',\n\t                        _l( 'a list of datasets' ),\n\t                    '<% } else if( collection.collection_type === \"paired\" ){ %>',\n\t                        _l( 'a pair of datasets' ),\n\t                    '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n\t                        _l( 'a list of paired datasets' ),\n\t                    '<% } %>',\n\t                '</div>',\n\t            '</div>',\n\t        '</div>'\n\t    ], 'collection' );\n\t\n\t    return _.extend( _.clone( _super.prototype.templates ), {\n\t        controls : controlsTemplate\n\t    });\n\t}());\n\t\n\t\n\t\n\t// =============================================================================\n\t/** @class non-editable, read-only View/Controller for a dataset collection. */\n\tvar ListCollectionPanel = CollectionPanel.extend(\n\t/** @lends ListCollectionPanel.prototype */{\n\t\n\t    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n\t    /** sub view class used for datasets */\n\t    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'ListCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class non-editable, read-only View/Controller for a dataset collection. */\n\tvar PairCollectionPanel = ListCollectionPanel.extend(\n\t/** @lends PairCollectionPanel.prototype */{\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'PairCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class non-editable, read-only View/Controller for a dataset collection. */\n\tvar ListOfPairsCollectionPanel = CollectionPanel.extend(\n\t/** @lends ListOfPairsCollectionPanel.prototype */{\n\t\n\t    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n\t    /** sub view class used for nested collections */\n\t    NestedDCDCEViewClass : DC_LI.NestedDCDCEListItemView.extend({\n\t        foldoutPanelClass : PairCollectionPanel\n\t    }),\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'ListOfPairsCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        CollectionPanel             : CollectionPanel,\n\t        ListCollectionPanel         : ListCollectionPanel,\n\t        PairCollectionPanel         : PairCollectionPanel,\n\t        ListOfPairsCollectionPanel  : ListOfPairsCollectionPanel\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\t\n\tvar View = Backbone.View.extend({\n\t\n\t    // base element\n\t    elMain: 'body',\n\t    \n\t    // defaults options\n\t    optionsDefault: {\n\t        title            : 'ui-modal',\n\t        body             : '',\n\t        backdrop         : true,\n\t        height           : null,\n\t        width            : null,\n\t        closing_events   : false,\n\t        closing_callback : null,\n\t        title_separator  : true\n\t    },\n\t\n\t    // button list\n\t    buttonList: {},\n\t\n\t    // initialize\n\t    initialize : function(options) {\n\t        if (options){\n\t            this._create(options);\n\t        }\n\t    },\n\t    \n\t    // adds and displays a new frame/window\n\t    show: function(options) {\n\t        // create\n\t        this.initialize(options);\n\t        \n\t        // fix height\n\t        if (this.options.height){\n\t            this.$body.css('height', this.options.height);\n\t            this.$body.css('overflow', 'hidden');\n\t        } else {\n\t            this.$body.css('max-height', $(window).height() / 2);\n\t        }\n\t\n\t        // fix width\n\t        if (this.options.width) {\n\t            this.$dialog.css('width', this.options.width);\n\t        }\n\t\n\t        // show\n\t        if (this.visible) {\n\t            this.$el.show();\n\t        } else {\n\t            this.$el.fadeIn('fast');\n\t        }\n\t\n\t        // set visible flag\n\t        this.visible = true;\n\t    },\n\t\n\t    // hide\n\t    hide: function() {\n\t        this.visible = false;\n\t        this.$el.fadeOut('fast');\n\t        if (this.options.closing_callback){\n\t            this.options.closing_callback();\n\t        }\n\t    },\n\t\n\t    // enable buttons\n\t    enableButton: function(name) {\n\t        var button_id = this.buttonList[name];\n\t        this.$buttons.find('#' + button_id).prop('disabled', false);\n\t    },\n\t\n\t    // disable buttons\n\t    disableButton: function(name) {\n\t        var button_id = this.buttonList[name];\n\t        this.$buttons.find('#' + button_id).prop('disabled', true);\n\t    },\n\t    \n\t    // show buttons\n\t    showButton: function(name) {\n\t        var button_id = this.buttonList[name];\n\t        this.$buttons.find('#' + button_id).show();\n\t    },\n\t\n\t    // hide buttons\n\t    hideButton: function(name) {\n\t        var button_id = this.buttonList[name];\n\t        this.$buttons.find('#' + button_id).hide();\n\t    },\n\t    \n\t    // get button\n\t    getButton: function(name) {\n\t        var button_id = this.buttonList[name];\n\t        return this.$buttons.find('#' + button_id);\n\t    },\n\t    \n\t    // returns scroll top for body element\n\t    scrollTop: function() {\n\t        return this.$body.scrollTop();\n\t    },\n\t\n\t    // create\n\t    _create: function(options) {\n\t        // link this\n\t        var self = this;\n\t        \n\t        // configure options\n\t        this.options = _.defaults(options, this.optionsDefault);\n\t        \n\t        // check for progress bar request\n\t        if (this.options.body == 'progress'){\n\t            this.options.body = $('<div class=\"progress progress-striped active\"><div class=\"progress-bar progress-bar-info\" style=\"width:100%\"></div></div>');\n\t        }\n\t            \n\t        // remove former element\n\t        if (this.$el) {\n\t            // remove element\n\t            this.$el.remove();\n\t            \n\t            // remove escape event\n\t            $(document).off('keyup.ui-modal');\n\t        }\n\t        \n\t        // create new element\n\t        this.setElement(this._template(this.options.title));\n\t        \n\t        // link elements\n\t        this.$dialog = (this.$el).find('.modal-dialog');\n\t        this.$body = (this.$el).find('.modal-body');\n\t        this.$footer  = (this.$el).find('.modal-footer');\n\t        this.$buttons = (this.$el).find('.buttons');\n\t        this.$backdrop = (this.$el).find('.modal-backdrop');\n\t        \n\t        // append body\n\t        this.$body.html(this.options.body);\n\t        \n\t        // configure background\n\t        if (!this.options.backdrop){\n\t            this.$backdrop.removeClass('in');\n\t        }\n\t                        \n\t        // append buttons\n\t        if (this.options.buttons) {\n\t            // reset button list\n\t            this.buttonList = {};\n\t            var counter = 0;\n\t            $.each(this.options.buttons, function(name, value) {\n\t                var button_id = 'button-' + counter++;\n\t                self.$buttons.append($('<button id=\"' + button_id + '\"></button>').text(name).click(value)).append(\" \");\n\t                self.buttonList[name] = button_id;\n\t            });\n\t        } else {\n\t            // hide footer\n\t            this.$footer.hide();\n\t        }\n\t        \n\t        // append to main element\n\t        $(this.elMain).append($(this.el));\n\t\n\t        // bind additional closing events\n\t        if (this.options.closing_events) {\n\t            // bind the ESC key to hide() function\n\t            $(document).on('keyup.ui-modal', function(e) {\n\t                if (e.keyCode == 27) {\n\t                    self.hide();\n\t                }\n\t            });\n\t            \n\t            // hide modal if background is clicked\n\t            this.$el.find('.modal-backdrop').on('click', function() { self.hide(); });\n\t        }\n\t\n\t        // removes the default separator line\n\t        if (!this.options.title_separator) {\n\t            this.$('.modal-header').css({ 'border': 'none', 'padding-bottom': '0px' });\n\t        }\n\t    },\n\t    \n\t    // fill regular modal template\n\t    _template: function(title) {\n\t        return  '<div class=\"ui-modal modal\">' +\n\t                    '<div class=\"modal-backdrop fade in\" style=\"z-index: -1;\"></div>' +\n\t                    '<div class=\"modal-dialog\">' +\n\t                        '<div class=\"modal-content\">' +\n\t                            '<div class=\"modal-header\">' +\n\t                                '<button type=\"button\" class=\"close\" style=\"display: none;\">&times;</button>' +\n\t                                '<h4 class=\"title\">' + title + '</h4>' +\n\t                            '</div>' +\n\t                            '<div class=\"modal-body\" style=\"position: static;\"></div>' +\n\t                            '<div class=\"modal-footer\">' +\n\t                                '<div class=\"buttons\" style=\"float: right;\"></div>' +\n\t                            '</div>' +\n\t                        '</div' +\n\t                    '</div>' +\n\t                '</div>';\n\t    }\n\t});\n\t\n\treturn {\n\t    View : View\n\t}\n\t\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(19),\n\t    __webpack_require__(15),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( LIST_ITEM, DATASET_LI, BASE_MVC, _l ){\n\t/* global Backbone, LoggableMixin */\n\t//==============================================================================\n\tvar FoldoutListItemView = LIST_ITEM.FoldoutListItemView,\n\t    ListItemView = LIST_ITEM.ListItemView;\n\t/** @class Read only view for DatasetCollection.\n\t */\n\tvar DCListItemView = FoldoutListItemView.extend(\n\t/** @lends DCListItemView.prototype */{\n\t//TODO: may not be needed\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    className   : FoldoutListItemView.prototype.className + \" dataset-collection\",\n\t    id          : function(){\n\t        return [ 'dataset_collection', this.model.get( 'id' ) ].join( '-' );\n\t    },\n\t\n\t    /** override to add linkTarget */\n\t    initialize : function( attributes ){\n\t        this.linkTarget = attributes.linkTarget || '_blank';\n\t        this.hasUser = attributes.hasUser;\n\t        FoldoutListItemView.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    /** event listeners */\n\t    _setUpListeners : function(){\n\t        FoldoutListItemView.prototype._setUpListeners.call( this );\n\t        // re-rendering on deletion\n\t        this.model.on( 'change', function( model, options ){\n\t            if( _.isEqual( _.keys( model.changed ), [ 'deleted' ] ) ){\n\t                this.render();\n\t            }\n\t        }, this );\n\t    },\n\t\n\t    // ......................................................................... rendering\n\t    //TODO:?? possibly move to listItem\n\t    /** render a subtitle to show the user what sort of collection this is */\n\t    _renderSubtitle : function(){\n\t        var $subtitle = $( '<div class=\"subtitle\"></div>' );\n\t        //TODO: would be good to get this in the subtitle\n\t        //var len = this.model.elements.length;\n\t        switch( this.model.get( 'collection_type' ) ){\n\t            case 'list':\n\t                return $subtitle.text( _l( 'a list of datasets' ) );\n\t            case 'paired':\n\t                return $subtitle.text( _l( 'a pair of datasets' ) );\n\t            case 'list:paired':\n\t                return $subtitle.text( _l( 'a list of paired datasets' ) );\n\t        }\n\t        return $subtitle;\n\t    },\n\t\n\t    // ......................................................................... foldout\n\t    /** override to add linktarget to sub-panel */\n\t    _getFoldoutPanelOptions : function(){\n\t        var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call( this );\n\t        return _.extend( options, {\n\t            linkTarget  : this.linkTarget,\n\t            hasUser     : this.hasUser\n\t        });\n\t    },\n\t\n\t    /** override to not catch sub-panel selectors */\n\t    $selector : function(){\n\t        return this.$( '> .selector' );\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DCListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDCListItemView.prototype.templates = (function(){\n\t\n\t    var warnings = _.extend( {}, FoldoutListItemView.prototype.templates.warnings, {\n\t        error : BASE_MVC.wrapTemplate([\n\t            // error during index fetch - show error on dataset\n\t            '<% if( model.error ){ %>',\n\t                '<div class=\"errormessagesmall\">',\n\t                    _l( 'There was an error getting the data for this collection' ), ': <%- model.error %>',\n\t                '</div>',\n\t            '<% } %>'\n\t        ]),\n\t        purged : BASE_MVC.wrapTemplate([\n\t            '<% if( model.purged ){ %>',\n\t                '<div class=\"purged-msg warningmessagesmall\">',\n\t                    _l( 'This collection has been deleted and removed from disk' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ]),\n\t        deleted : BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.deleted && !model.purged ){ %>',\n\t                '<div class=\"deleted-msg warningmessagesmall\">',\n\t                    _l( 'This collection has been deleted' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ])\n\t    });\n\t\n\t    // use element identifier\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t            '<div class=\"title\">',\n\t                '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"></div>',\n\t        '</div>'\n\t    ], 'collection' );\n\t\n\t    return _.extend( {}, FoldoutListItemView.prototype.templates, {\n\t        warnings : warnings,\n\t        titleBar : titleBarTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** @class Read only view for DatasetCollectionElement.\n\t */\n\tvar DCEListItemView = ListItemView.extend(\n\t/** @lends DCEListItemView.prototype */{\n\t//TODO: this might be expendable - compacted with HDAListItemView\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** add the DCE class to the list item */\n\t    className   : ListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t    /** set up */\n\t    initialize  : function( attributes ){\n\t        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n\t        this.log( 'DCEListItemView.initialize:', attributes );\n\t        ListItemView.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DCEListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDCEListItemView.prototype.templates = (function(){\n\t\n\t    // use the element identifier here - since that will persist and the user will need it\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t            '<div class=\"title\">',\n\t                '<span class=\"name\"><%- element.element_identifier %></span>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"></div>',\n\t        '</div>'\n\t    ], 'element' );\n\t\n\t    return _.extend( {}, ListItemView.prototype.templates, {\n\t        titleBar : titleBarTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n\t *      (a dataset contained in a dataset collection).\n\t */\n\tvar DatasetDCEListItemView = DATASET_LI.DatasetListItemView.extend(\n\t/** @lends DatasetDCEListItemView.prototype */{\n\t\n\t    className   : DATASET_LI.DatasetListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** set up */\n\t    initialize  : function( attributes ){\n\t        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n\t        this.log( 'DatasetDCEListItemView.initialize:', attributes );\n\t        DATASET_LI.DatasetListItemView.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    /** In this override, only get details if in the ready state.\n\t     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t     */\n\t    _fetchModelDetails : function(){\n\t        var view = this;\n\t        if( view.model.inReadyState() && !view.model.hasDetails() ){\n\t            return view.model.fetch({ silent: true });\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DatasetDCEListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDatasetDCEListItemView.prototype.templates = (function(){\n\t\n\t    // use the element identifier here and not the dataset name\n\t    //TODO:?? can we steal the DCE titlebar?\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t            '<span class=\"state-icon\"></span>',\n\t            '<div class=\"title\">',\n\t                '<span class=\"name\"><%- element.element_identifier %></span>',\n\t            '</div>',\n\t        '</div>'\n\t    ], 'element' );\n\t\n\t    return _.extend( {}, DATASET_LI.DatasetListItemView.prototype.templates, {\n\t        titleBar : titleBarTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n\t *      (a nested DC).\n\t */\n\tvar NestedDCDCEListItemView = DCListItemView.extend(\n\t/** @lends NestedDCDCEListItemView.prototype */{\n\t\n\t    className   : DCListItemView.prototype.className + \" dataset-collection-element\",\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    // comment this out to suppress log output\n\t    //logger              : console,\n\t\n\t    /** In this override, add the state as a class for use with state-based CSS */\n\t    _swapNewRender : function( $newRender ){\n\t        DCListItemView.prototype._swapNewRender.call( this, $newRender );\n\t//TODO: model currently has no state\n\t        var state = this.model.get( 'state' ) || 'ok';\n\t        //if( this.model.has( 'state' ) ){\n\t        this.$el.addClass( 'state-' + state );\n\t        //}\n\t        return this.$el;\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'NestedDCDCEListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        DCListItemView          : DCListItemView,\n\t        DCEListItemView         : DCEListItemView,\n\t        DatasetDCEListItemView  : DatasetDCEListItemView,\n\t        NestedDCDCEListItemView : NestedDCDCEListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(29),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DATASET_MODEL, BASE_MVC, _l ){\n\t//==============================================================================\n\t/*\n\tNotes:\n\t\n\tTerminology:\n\t    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n\t    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n\t    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\t\n\t\n\tThis all seems too complex unfortunately:\n\t\n\t- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n\t- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n\t    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n\t    decided to merge the contained JSON with the DC element json - making the 'has a'\n\t    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n\t    DRY in both models and views, but may make tracking or tracing within these models\n\t    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n\t    or DatasetCollections (nested)). This also violates the rule of thumb about\n\t    favoring aggregation over inheritance.\n\t- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n\t    These each should a) be usable on their own, b) be usable in the context of\n\t    nesting within a collection model (at least in the case of ListPaired), and\n\t    c) be usable within the context of other container models (like History or\n\t    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n\t    handle those three situations, but it's proven difficult to do in a simple,\n\t    readable manner.\n\t- Ideally, histories and libraries would inherit from the same server models as\n\t    dataset collections do since they are (in essence) dataset collections themselves -\n\t    making the whole nested structure simpler. This would be a large, error-prone\n\t    refactoring and migration.\n\t\n\tMany of the classes and heirarchy are meant as extension points so, while the\n\trelations and flow may be difficult to understand initially, they'll allow us to\n\thandle the growth or flux dataset collection in the future (w/o actually implementing\n\tany YAGNI).\n\t\n\t*/\n\t//_________________________________________________________________________________________________ ELEMENTS\n\t/** @class mixin for Dataset collection elements.\n\t *      When collection elements are passed from the API, the underlying element is\n\t *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n\t *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n\t *          effectively changing a DCE from a container to a subclass (has a --> is a).\n\t */\n\tvar DatasetCollectionElementMixin = {\n\t\n\t    /** default attributes used by elements in a dataset collection */\n\t    defaults : {\n\t        model_class         : 'DatasetCollectionElement',\n\t        element_identifier  : null,\n\t        element_index       : null,\n\t        element_type        : null\n\t    },\n\t\n\t    /** merge the attributes of the sub-object 'object' into this model */\n\t    _mergeObject : function( attributes ){\n\t        // if we don't preserve and correct ids here, the element id becomes the object id\n\t        // and collision in backbone's _byId will occur and only\n\t        _.extend( attributes, attributes.object, { element_id: attributes.id });\n\t        delete attributes.object;\n\t        return attributes;\n\t    },\n\t\n\t    /** override to merge this.object into this */\n\t    constructor : function( attributes, options ){\n\t        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n\t        attributes = this._mergeObject( attributes );\n\t        this.idAttribute = 'element_id';\n\t        Backbone.Model.apply( this, arguments );\n\t    },\n\t\n\t    /** when the model is fetched, merge this.object into this */\n\t    parse : function( response, options ){\n\t        var attributes = response;\n\t        attributes = this._mergeObject( attributes );\n\t        return attributes;\n\t    }\n\t};\n\t\n\t//TODO: unused?\n\t/** @class Concrete class of Generic DatasetCollectionElement */\n\tvar DatasetCollectionElement = Backbone.Model\n\t    .extend( BASE_MVC.LoggableMixin )\n\t    .extend( DatasetCollectionElementMixin );\n\t\n\t\n\t//==============================================================================\n\t/** @class Base/Abstract Backbone collection for Generic DCEs. */\n\tvar DCECollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n\t/** @lends DCECollection.prototype */{\n\t    model: DatasetCollectionElement,\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t//TODO: unused?\n\t    /** Set up.\n\t     *  @see Backbone.Collection#initialize\n\t     */\n\t    initialize : function( attributes, options ){\n\t        this.debug( this + '(DCECollection).initialize:', attributes, options );\n\t        options = options || {};\n\t        //this._setUpListeners();\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'DatasetCollectionElementCollection(', this.length, ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n\t */\n\tvar DatasetDCE = DATASET_MODEL.DatasetAssociation.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n\t/** @lends DatasetDCE.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** url fn */\n\t    url : function(){\n\t        var galaxyRoot = (( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' ));\n\t        // won't always be an hda\n\t        if( !this.has( 'history_id' ) ){\n\t            console.warn( 'no endpoint for non-hdas within a collection yet' );\n\t            // (a little silly since this api endpoint *also* points at hdas)\n\t            return galaxyRoot + 'api/datasets';\n\t        }\n\t        return galaxyRoot + 'api/histories/' + this.get( 'history_id' ) + '/contents/' + this.get( 'id' );\n\t    },\n\t\n\t    defaults : _.extend( {},\n\t        DATASET_MODEL.DatasetAssociation.prototype.defaults,\n\t        DatasetCollectionElementMixin.defaults\n\t    ),\n\t\n\t    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t    //  - re-apply manually for now\n\t    /** call the mixin constructor */\n\t    constructor : function( attributes, options ){\n\t        this.debug( '\\t DatasetDCE.constructor:', attributes, options );\n\t        //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n\t        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n\t    },\n\t\n\t//TODO: unused?\n\t    /** set up */\n\t    initialize : function( attributes, options ){\n\t        this.debug( this + '(DatasetDCE).initialize:', attributes, options );\n\t        DATASET_MODEL.DatasetAssociation.prototype.initialize.call( this, attributes, options );\n\t    },\n\t\n\t    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n\t    hasDetails : function(){\n\t        // dataset collection api does return genome_build but doesn't return annotation\n\t        return _.has( this.attributes, 'annotation' );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t        var objStr = this.get( 'element_identifier' );\n\t        return ([ 'DatasetDCE(', objStr, ')' ].join( '' ));\n\t    }\n\t}));\n\t\n\t\n\t//==============================================================================\n\t/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n\t */\n\tvar DatasetDCECollection = DCECollection.extend(\n\t/** @lends DatasetDCECollection.prototype */{\n\t    model: DatasetDCE,\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t//TODO: unused?\n\t    /** set up */\n\t    initialize : function( attributes, options ){\n\t        this.debug( this + '(DatasetDCECollection).initialize:', attributes, options );\n\t        DCECollection.prototype.initialize.call( this, attributes, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'DatasetDCECollection(', this.length, ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//_________________________________________________________________________________________________ COLLECTIONS\n\t/** @class Backbone model for Dataset Collections.\n\t *      The DC API returns an array of JSON objects under the attribute elements.\n\t *      This model:\n\t *          - removes that array/attribute ('elements') from the model,\n\t *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n\t *          - passes that json onto the bbone collection\n\t *          - caches the bbone collection in this.elements\n\t */\n\tvar DatasetCollection = Backbone.Model\n\t        .extend( BASE_MVC.LoggableMixin )\n\t        .extend( BASE_MVC.SearchableModelMixin )\n\t.extend(/** @lends DatasetCollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** default attributes for a model */\n\t    defaults : {\n\t        /* 'list', 'paired', or 'list:paired' */\n\t        collection_type     : null,\n\t        //??\n\t        deleted             : false\n\t    },\n\t\n\t    /** Which class to use for elements */\n\t    collectionClass : DCECollection,\n\t\n\t    /** set up: create elements instance var and (on changes to elements) update them  */\n\t    initialize : function( model, options ){\n\t        this.debug( this + '(DatasetCollection).initialize:', model, options, this );\n\t        //historyContent.HistoryContent.prototype.initialize.call( this, attrs, options );\n\t        this.elements = this._createElementsModel();\n\t        this.on( 'change:elements', function(){\n\t            this.log( 'change:elements' );\n\t//TODO: prob. better to update the collection instead of re-creating it\n\t            this.elements = this._createElementsModel();\n\t        });\n\t    },\n\t\n\t    /** move elements model attribute to full collection */\n\t    _createElementsModel : function(){\n\t        this.debug( this + '._createElementsModel', this.collectionClass, this.get( 'elements' ), this.elements );\n\t//TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n\t        var elements = this.get( 'elements' ) || [];\n\t        this.unset( 'elements', { silent: true });\n\t        this.elements = new this.collectionClass( elements );\n\t        //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n\t        return this.elements;\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** pass the elements back within the model json when this is serialized */\n\t    toJSON : function(){\n\t        var json = Backbone.Model.prototype.toJSON.call( this );\n\t        if( this.elements ){\n\t            json.elements = this.elements.toJSON();\n\t        }\n\t        return json;\n\t    },\n\t\n\t    /** Is this collection in a 'ready' state no processing (for the collection) is left\n\t     *  to do on the server.\n\t     */\n\t    inReadyState : function(){\n\t        var populated = this.get( 'populated' );\n\t        return ( this.isDeletedOrPurged() || populated );\n\t    },\n\t\n\t    //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n\t    /** Does the DC contain any elements yet? Is a fetch() required? */\n\t    hasDetails : function(){\n\t//TODO: this is incorrect for (accidentally) empty collections\n\t        this.debug( 'hasDetails:', this.elements.length );\n\t        return this.elements.length !== 0;\n\t    },\n\t\n\t    /** Given the filters, what models in this.elements would be returned? */\n\t    getVisibleContents : function( filters ){\n\t        // filters unused for now\n\t        return this.elements;\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n\t    'delete' : function( options ){\n\t        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: true }, options );\n\t    },\n\t    /** save this dataset, _Mark_ing it as undeleted */\n\t    undelete : function( options ){\n\t        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: false }, options );\n\t    },\n\t\n\t    /** Is this collection deleted or purged? */\n\t    isDeletedOrPurged : function(){\n\t        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n\t    },\n\t\n\t    // ........................................................................ searchable\n\t    /** searchable attributes for collections */\n\t    searchAttributes : [\n\t        'name'\n\t    ],\n\t\n\t    // ........................................................................ misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var idAndName = [ this.get( 'id' ), this.get( 'name' ) || this.get( 'element_identifier' ) ];\n\t        return 'DatasetCollection(' + ( idAndName.join(',') ) + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** Model for a DatasetCollection containing datasets (non-nested).\n\t */\n\tvar ListDatasetCollection = DatasetCollection.extend(\n\t/** @lends ListDatasetCollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** override since we know the collection will only contain datasets */\n\t    collectionClass : DatasetDCECollection,\n\t\n\t//TODO: unused?\n\t    initialize : function( attrs, options ){\n\t        this.debug( this + '(ListDatasetCollection).initialize:', attrs, options );\n\t        DatasetCollection.prototype.initialize.call( this, attrs, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'ListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n\t */\n\tvar PairDatasetCollection = ListDatasetCollection.extend(\n\t/** @lends PairDatasetCollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t//TODO: unused?\n\t    /**  */\n\t    initialize : function( attrs, options ){\n\t        this.debug( this + '(PairDatasetCollection).initialize:', attrs, options );\n\t        ListDatasetCollection.prototype.initialize.call( this, attrs, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'PairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//_________________________________________________________________________________________________ NESTED COLLECTIONS\n\t// this is where things get weird, man. Weird.\n\t//TODO: it might be possible to compact all the following...I think.\n\t//==============================================================================\n\t/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n\t *      (a nested collection). Currently only list:paired.\n\t */\n\tvar NestedDCDCE = DatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n\t/** @lends NestedDCDCE.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t    //  - re-apply manually it now\n\t    /** call the mixin constructor */\n\t    constructor : function( attributes, options ){\n\t        this.debug( '\\t NestedDCDCE.constructor:', attributes, options );\n\t        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n\t        return ([ 'NestedDCDCE(', objStr, ')' ].join( '' ));\n\t    }\n\t}));\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n\t */\n\tvar NestedDCDCECollection = DCECollection.extend(\n\t/** @lends NestedDCDCECollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** This is a collection of nested collections */\n\t    model: NestedDCDCE,\n\t\n\t//TODO: unused?\n\t    /** set up */\n\t    initialize : function( attrs, options ){\n\t        this.debug( this + '(NestedDCDCECollection).initialize:', attrs, options );\n\t        DCECollection.prototype.initialize.call( this, attrs, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'NestedDCDCECollection(', this.length, ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n\t */\n\tvar NestedPairDCDCE = PairDatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n\t/** @lends NestedPairDCDCE.prototype */{\n\t//TODO:?? possibly rename to NestedDatasetCollection?\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t    //  - re-apply manually it now\n\t    /** This is both a collection and a collection element - call the constructor */\n\t    constructor : function( attributes, options ){\n\t        this.debug( '\\t NestedPairDCDCE.constructor:', attributes, options );\n\t        //DatasetCollection.constructor.call( this, attributes, options );\n\t        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n\t        return ([ 'NestedPairDCDCE(', objStr, ')' ].join( '' ));\n\t    }\n\t}));\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone collection for a backbone collection containing paired dataset collections.\n\t */\n\tvar NestedPairDCDCECollection = NestedDCDCECollection.extend(\n\t/** @lends PairDCDCECollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** We know this collection is composed of only nested pair collections */\n\t    model: NestedPairDCDCE,\n\t\n\t//TODO: unused?\n\t    /** set up */\n\t    initialize : function( attrs, options ){\n\t        this.debug( this + '(NestedPairDCDCECollection).initialize:', attrs, options );\n\t        NestedDCDCECollection.prototype.initialize.call( this, attrs, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'NestedPairDCDCECollection(', this.length, ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n\t */\n\tvar ListPairedDatasetCollection = DatasetCollection.extend(\n\t/** @lends ListPairedDatasetCollection.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** list:paired is the only collection that itself contains collections */\n\t    collectionClass : NestedPairDCDCECollection,\n\t\n\t//TODO: unused?\n\t    /** set up */\n\t    initialize : function( attributes, options ){\n\t        this.debug( this + '(ListPairedDatasetCollection).initialize:', attributes, options );\n\t        DatasetCollection.prototype.initialize.call( this, attributes, options );\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'ListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        ListDatasetCollection               : ListDatasetCollection,\n\t        PairDatasetCollection               : PairDatasetCollection,\n\t        ListPairedDatasetCollection         : ListPairedDatasetCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(16),\n\t    __webpack_require__(6),\n\t    __webpack_require__(3),\n\t    __webpack_require__(11),\n\t    __webpack_require__(42),\n\t    __webpack_require__(1),\n\t    __webpack_require__(40)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( HDCA, STATES, BASE_MVC, UI_MODAL, naturalSort, _l ){\n\t/*==============================================================================\n\tTODO:\n\t    use proper Element model and not just json\n\t    straighten out createFn, collection.createHDCA\n\t    possibly stop using modals for this\n\t    It would be neat to do a drag and drop\n\t\n\t==============================================================================*/\n\t/** A view for both DatasetDCEs and NestedDCDCEs\n\t *  (things that implement collection-model:DatasetCollectionElementMixin)\n\t */\n\tvar DatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n\t//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n\t    tagName     : 'li',\n\t    className   : 'collection-element',\n\t\n\t    initialize : function( attributes ){\n\t        this.element = attributes.element || {};\n\t        this.selected = attributes.selected || false;\n\t    },\n\t\n\t    render : function(){\n\t        this.$el\n\t            .attr( 'data-element-id', this.element.id )\n\t            .attr( 'draggable', true )\n\t            .html( this.template({ element: this.element }) );\n\t        if( this.selected ){\n\t            this.$el.addClass( 'selected' );\n\t        }\n\t        return this;\n\t    },\n\t\n\t    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n\t    template : _.template([\n\t        '<a class=\"name\" title=\"', _l( 'Click to rename' ), '\" href=\"javascript:void(0)\">',\n\t            '<%= element.name %>',\n\t        '</a>',\n\t        '<button class=\"discard btn btn-sm\" title=\"', _l( 'Remove this dataset from the list' ), '\">',\n\t            _l( 'Discard' ),\n\t        '</button>',\n\t    ].join('')),\n\t\n\t    /** select this element and pub */\n\t    select : function( toggle ){\n\t        this.$el.toggleClass( 'selected', toggle );\n\t        this.trigger( 'select', {\n\t            source   : this,\n\t            selected : this.$el.hasClass( 'selected' )\n\t        });\n\t    },\n\t\n\t    /** animate the removal of this element and pub */\n\t    discard : function(){\n\t        var view = this,\n\t            parentWidth = this.$el.parent().width();\n\t        this.$el.animate({ 'margin-right' : parentWidth }, 'fast', function(){\n\t            view.trigger( 'discard', {\n\t                source : view\n\t            });\n\t            view.destroy();\n\t        });\n\t    },\n\t\n\t    /** remove the DOM and any listeners */\n\t    destroy : function(){\n\t        this.off();\n\t        this.$el.remove();\n\t    },\n\t\n\t    events : {\n\t        'click'         : '_click',\n\t        'click .name'   : '_clickName',\n\t        'click .discard': '_clickDiscard',\n\t\n\t        'dragstart'     : '_dragstart',\n\t        'dragend'       : '_dragend',\n\t        'dragover'      : '_sendToParent',\n\t        'drop'          : '_sendToParent'\n\t    },\n\t\n\t    /** select when the li is clicked */\n\t    _click : function( ev ){\n\t        ev.stopPropagation();\n\t        this.select( ev );\n\t    },\n\t\n\t    /** rename a pair when the name is clicked */\n\t    _clickName : function( ev ){\n\t        ev.stopPropagation();\n\t        ev.preventDefault();\n\t        var promptString = [ _l( 'Enter a new name for the element' ), ':\\n(',\n\t                             _l( 'Note that changing the name here will not rename the dataset' ), ')' ].join( '' ),\n\t            response = prompt( _l( 'Enter a new name for the element' ) + ':', this.element.name );\n\t        if( response ){\n\t            this.element.name = response;\n\t            this.render();\n\t        }\n\t        //TODO: cancelling with ESC leads to closure of the creator...\n\t    },\n\t\n\t    /** discard when the discard button is clicked */\n\t    _clickDiscard : function( ev ){\n\t        ev.stopPropagation();\n\t        this.discard();\n\t    },\n\t\n\t    /** dragging pairs for re-ordering */\n\t    _dragstart : function( ev ){\n\t        if( ev.originalEvent ){ ev = ev.originalEvent; }\n\t        ev.dataTransfer.effectAllowed = 'move';\n\t        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.element ) );\n\t\n\t        this.$el.addClass( 'dragging' );\n\t        this.$el.parent().trigger( 'collection-element.dragstart', [ this ] );\n\t    },\n\t\n\t    /** dragging for re-ordering */\n\t    _dragend : function( ev ){\n\t        this.$el.removeClass( 'dragging' );\n\t        this.$el.parent().trigger( 'collection-element.dragend', [ this ] );\n\t    },\n\t\n\t    /** manually bubble up an event to the parent/container */\n\t    _sendToParent : function( ev ){\n\t        this.$el.parent().trigger( ev );\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){\n\t        return 'DatasetCollectionElementView()';\n\t    }\n\t});\n\t\n\t\n\t// ============================================================================\n\t/** An interface for building collections.\n\t */\n\tvar ListCollectionCreator = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n\t\n\t    /** the class used to display individual elements */\n\t    elementViewClass : DatasetCollectionElementView,\n\t    /** the class this creator will create and save */\n\t    collectionClass  : HDCA.HistoryListDatasetCollection,\n\t    className        : 'list-collection-creator collection-creator flex-row-container',\n\t\n\t    /** minimum number of valid elements to start with in order to build a collection of this type */\n\t    minElements      : 1,\n\t\n\t    defaultAttributes : {\n\t//TODO: remove - use new collectionClass().save()\n\t        /** takes elements and creates the proper collection - returns a promise */\n\t        creationFn : function(){ throw new TypeError( 'no creation fn for creator' ); },\n\t        /** fn to call when the collection is created (scoped to this) */\n\t        oncreate   : function(){},\n\t        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t        oncancel   : function(){},\n\t        /** distance from list edge to begin autoscrolling list */\n\t        autoscrollDist  : 24,\n\t        /** Color passed to hoverhighlight */\n\t        highlightClr    : 'rgba( 64, 255, 255, 1.0 )'\n\t    },\n\t\n\t    /** set up initial options, instance vars, behaviors */\n\t    initialize : function( attributes ){\n\t        this.metric( 'ListCollectionCreator.initialize', attributes );\n\t        var creator = this;\n\t        _.each( this.defaultAttributes, function( value, key ){\n\t            value = attributes[ key ] || value;\n\t            creator[ key ] = value;\n\t        });\n\t\n\t        /** unordered, original list - cache to allow reversal */\n\t        creator.initialElements = attributes.elements || [];\n\t\n\t        this._instanceSetUp();\n\t        this._elementsSetUp();\n\t        this._setUpBehaviors();\n\t    },\n\t\n\t    /** set up instance vars */\n\t    _instanceSetUp : function(){\n\t        /** Ids of elements that have been selected by the user - to preserve over renders */\n\t        this.selectedIds = {};\n\t        /** DOM elements currently being dragged */\n\t        this.$dragging = null;\n\t        /** Used for blocking UI events during ajax/operations (don't post twice) */\n\t        this.blocking = false;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ process raw list\n\t    /** set up main data */\n\t    _elementsSetUp : function(){\n\t        //this.debug( '-- _dataSetUp' );\n\t        /** a list of invalid elements and the reasons they aren't valid */\n\t        this.invalidElements = [];\n\t//TODO: handle fundamental problem of syncing DOM, views, and list here\n\t        /** data for list in progress */\n\t        this.workingElements = [];\n\t        /** views for workingElements */\n\t        this.elementViews = [];\n\t\n\t        // copy initial list, sort, add ids if needed\n\t        this.workingElements = this.initialElements.slice( 0 );\n\t        this._ensureElementIds();\n\t        this._validateElements();\n\t        this._mangleDuplicateNames();\n\t        this._sortElements();\n\t    },\n\t\n\t    /** add ids to dataset objs in initial list if none */\n\t    _ensureElementIds : function(){\n\t        this.workingElements.forEach( function( element ){\n\t            if( !element.hasOwnProperty( 'id' ) ){\n\t                element.id = _.uniqueId();\n\t            }\n\t        });\n\t        return this.workingElements;\n\t    },\n\t\n\t    /** separate working list into valid and invalid elements for this collection */\n\t    _validateElements : function(){\n\t        var creator = this,\n\t            existingNames = {};\n\t        creator.invalidElements = [];\n\t\n\t        this.workingElements = this.workingElements.filter( function( element ){\n\t            var problem = creator._isElementInvalid( element );\n\t            if( problem ){\n\t                creator.invalidElements.push({\n\t                    element : element,\n\t                    text    : problem\n\t                });\n\t            }\n\t            return !problem;\n\t        });\n\t        return this.workingElements;\n\t    },\n\t\n\t    /** describe what is wrong with a particular element if anything */\n\t    _isElementInvalid : function( element ){\n\t        if( element.history_content_type !== 'dataset' ){\n\t            return _l( \"is not a dataset\" );\n\t        }\n\t        if( element.state !== STATES.OK ){\n\t            if( _.contains( STATES.NOT_READY_STATES, element.state ) ){\n\t                return _l( \"hasn't finished running yet\" );\n\t            }\n\t            return _l( \"has errored, is paused, or is not accessible\" );\n\t        }\n\t        if( element.deleted || element.purged ){\n\t            return _l( \"has been deleted or purged\" );\n\t        }\n\t        return null;\n\t    },\n\t\n\t    /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n\t    _mangleDuplicateNames : function(){\n\t        var SAFETY = 900,\n\t            counter = 1,\n\t            existingNames = {};\n\t        this.workingElements.forEach( function( element ){\n\t            var currName = element.name;\n\t            while( existingNames.hasOwnProperty( currName ) ){\n\t                currName = element.name + ' (' + counter + ')';\n\t                counter += 1;\n\t                if( counter >= SAFETY ){\n\t                    throw new Error( 'Safety hit in while loop - thats impressive' );\n\t                }\n\t            }\n\t            element.name = currName;\n\t            existingNames[ element.name ] = true;\n\t        });\n\t    },\n\t\n\t    /** sort a list of elements */\n\t    _sortElements : function( list ){\n\t        // // currently only natural sort by name\n\t        // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n\t        // return this.workingElements;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ rendering\n\t    // templates : ListCollectionCreator.templates,\n\t    /** render the entire interface */\n\t    render : function( speed, callback ){\n\t        //this.debug( '-- _render' );\n\t        if( this.workingElements.length < this.minElements ){\n\t            return this._renderInvalid( speed, callback );\n\t        }\n\t\n\t        this.$el.empty().html( this.templates.main() );\n\t        this._renderHeader( speed );\n\t        this._renderMiddle( speed );\n\t        this._renderFooter( speed );\n\t        this._addPluginComponents();\n\t        this.$( '.collection-name' ).focus();\n\t        this.trigger( 'rendered', this );\n\t        return this;\n\t    },\n\t\n\t\n\t    /** render a simplified interface aimed at telling the user why they can't move forward */\n\t    _renderInvalid : function( speed, callback ){\n\t        //this.debug( '-- _render' );\n\t        this.$el.empty().html( this.templates.invalidInitial({\n\t            problems: this.invalidElements,\n\t            elements: this.workingElements,\n\t        }));\n\t        if( typeof this.oncancel === 'function' ){\n\t            this.$( '.cancel-create.btn' ).show();\n\t        }\n\t        this.trigger( 'rendered', this );\n\t        return this;\n\t    },\n\t\n\t    /** render the header section */\n\t    _renderHeader : function( speed, callback ){\n\t        var $header = this.$( '.header' ).empty().html( this.templates.header() )\n\t            .find( '.help-content' ).prepend( $( this.templates.helpContent() ) );\n\t        //TODO: should only show once despite calling _renderHeader again\n\t        if( this.invalidElements.length ){\n\t            this._invalidElementsAlert();\n\t        }\n\t        return $header;\n\t    },\n\t\n\t    /** render the middle including the elements */\n\t    _renderMiddle : function( speed, callback ){\n\t        var $middle = this.$( '.middle' ).empty().html( this.templates.middle() );\n\t        this._renderList( speed );\n\t        return $middle;\n\t    },\n\t\n\t    /** render the footer, completion controls, and cancel controls */\n\t    _renderFooter : function( speed, callback ){\n\t        var $footer = this.$( '.footer' ).empty().html( this.templates.footer() );\n\t        if( typeof this.oncancel === 'function' ){\n\t            this.$( '.cancel-create.btn' ).show();\n\t        }\n\t        return $footer;\n\t    },\n\t\n\t    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n\t    _addPluginComponents : function(){\n\t        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', this.highlightClr );\n\t    },\n\t\n\t    /** build and show an alert describing any elements that could not be included due to problems */\n\t    _invalidElementsAlert : function(){\n\t        this._showAlert( this.templates.invalidElements({ problems: this.invalidElements }), 'alert-warning' );\n\t    },\n\t\n\t    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n\t    _validationWarning : function( what, clear ){\n\t        var VALIDATION_CLASS = 'validation-warning';\n\t        if( what === 'name' ){\n\t            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n\t            this.$( '.collection-name' ).focus().select();\n\t        }\n\t        if( clear ){\n\t            what = what || this.$( '.' + VALIDATION_CLASS );\n\t            what.removeClass( VALIDATION_CLASS );\n\t        } else {\n\t            what.addClass( VALIDATION_CLASS );\n\t        }\n\t    },\n\t\n\t    _disableNameAndCreate : function( disable ){\n\t        disable = !_.isUndefined( disable )? disable : true;\n\t        if( disable ){\n\t            this.$( '.collection-name' ).prop( 'disabled', true );\n\t            this.$( '.create-collection' ).toggleClass( 'disabled', true );\n\t        // } else {\n\t        //     this.$( '.collection-name' ).prop( 'disabled', false );\n\t        //     this.$( '.create-collection' ).removeClass( 'disable' );\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ rendering elements\n\t    /** conv. to the main list display DOM */\n\t    $list : function(){\n\t        return this.$( '.collection-elements' );\n\t    },\n\t\n\t    /** show or hide the clear selected control based on the num of selected elements */\n\t    _renderClearSelected : function(){\n\t        if( _.size( this.selectedIds ) ){\n\t            this.$( '.collection-elements-controls > .clear-selected' ).show();\n\t        } else {\n\t            this.$( '.collection-elements-controls > .clear-selected' ).hide();\n\t        }\n\t    },\n\t\n\t    /** render the elements in order (or a warning if no elements found) */\n\t    _renderList : function( speed, callback ){\n\t        //this.debug( '-- _renderList' );\n\t        var creator = this,\n\t            $tmp = jQuery( '<div/>' ),\n\t            $list = creator.$list();\n\t\n\t        _.each( this.elementViews, function( view ){\n\t            view.destroy();\n\t            creator.removeElementView( view );\n\t        });\n\t\n\t        // if( !this.workingElements.length ){\n\t        //     this._renderNoValidElements();\n\t        //     return;\n\t        // }\n\t\n\t        creator.workingElements.forEach( function( element ){\n\t            var elementView = creator._createElementView( element );\n\t            $tmp.append( elementView.$el );\n\t        });\n\t\n\t        creator._renderClearSelected();\n\t        $list.empty().append( $tmp.children() );\n\t        _.invoke( creator.elementViews, 'render' );\n\t\n\t        if( $list.height() > $list.css( 'max-height' ) ){\n\t            $list.css( 'border-width', '1px 0px 1px 0px' );\n\t        } else {\n\t            $list.css( 'border-width', '0px' );\n\t        }\n\t    },\n\t\n\t    /** create an element view, cache in elementViews, set up listeners, and return */\n\t    _createElementView : function( element ){\n\t        var elementView = new this.elementViewClass({\n\t//TODO: use non-generic class or not all\n\t            // model : COLLECTION.DatasetDCE( element )\n\t            element : element,\n\t            selected: _.has( this.selectedIds, element.id )\n\t        });\n\t        this.elementViews.push( elementView );\n\t        this._listenToElementView( elementView );\n\t        return elementView;\n\t    },\n\t\n\t    /** listen to any element events */\n\t    _listenToElementView : function( view ){\n\t        var creator = this;\n\t        creator.listenTo( view, {\n\t            select : function( data ){\n\t                var element = data.source.element;\n\t                if( data.selected ){\n\t                    creator.selectedIds[ element.id ] = true;\n\t                } else {\n\t                    delete creator.selectedIds[ element.id ];\n\t                }\n\t                creator.trigger( 'elements:select', data );\n\t            },\n\t            discard : function( data ){\n\t                creator.trigger( 'elements:discard', data );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** add a new element view based on the json in element */\n\t    addElementView : function( element ){\n\t//TODO: workingElements is sorted, add element in appropo index\n\t        // add element, sort elements, find element index\n\t        // var view = this._createElementView( element );\n\t        // return view;\n\t    },\n\t\n\t    /** stop listening to view and remove from caches */\n\t    removeElementView : function( view ){\n\t        delete this.selectedIds[ view.element.id ];\n\t        this._renderClearSelected();\n\t\n\t        this.elementViews = _.without( this.elementViews, view );\n\t        this.stopListening( view );\n\t    },\n\t\n\t    /** render a message in the list that no elements remain to create a collection */\n\t    _renderNoElementsLeft : function(){\n\t        this._disableNameAndCreate( true );\n\t        this.$( '.collection-elements' ).append( this.templates.noElementsLeft() );\n\t    },\n\t\n\t    // /** render a message in the list that no valid elements were found to create a collection */\n\t    // _renderNoValidElements : function(){\n\t    //     this._disableNameAndCreate( true );\n\t    //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n\t    // },\n\t\n\t    // ------------------------------------------------------------------------ API\n\t    /** convert element into JSON compatible with the collections API */\n\t    _elementToJSON : function( element ){\n\t        // return element.toJSON();\n\t        return element;\n\t    },\n\t\n\t    /** create the collection via the API\n\t     *  @returns {jQuery.xhr Object} the jquery ajax request\n\t     */\n\t    createList : function( name ){\n\t        if( !this.workingElements.length ){\n\t            var message = _l( 'No valid elements for final list' ) + '. ';\n\t            message += '<a class=\"cancel-create\" href=\"javascript:void(0);\">' + _l( 'Cancel' ) + '</a> ';\n\t            message += _l( 'or' );\n\t            message += ' <a class=\"reset\" href=\"javascript:void(0);\">' + _l( 'start over' ) + '</a>.';\n\t            this._showAlert( message );\n\t            return;\n\t        }\n\t\n\t        var creator = this,\n\t            elements = this.workingElements.map( function( element ){\n\t                return creator._elementToJSON( element );\n\t            });\n\t\n\t        creator.blocking = true;\n\t        return creator.creationFn( elements, name )\n\t            .always( function(){\n\t                creator.blocking = false;\n\t            })\n\t            .fail( function( xhr, status, message ){\n\t                creator.trigger( 'error', {\n\t                    xhr     : xhr,\n\t                    status  : status,\n\t                    message : _l( 'An error occurred while creating this collection' )\n\t                });\n\t            })\n\t            .done( function( response, message, xhr ){\n\t                creator.trigger( 'collection:created', response, message, xhr );\n\t                creator.metric( 'collection:created', response );\n\t                if( typeof creator.oncreate === 'function' ){\n\t                    creator.oncreate.call( this, response, message, xhr );\n\t                }\n\t            });\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ events\n\t    /** set up event handlers on self */\n\t    _setUpBehaviors : function(){\n\t        this.on( 'error', this._errorHandler );\n\t\n\t        this.once( 'rendered', function(){\n\t            this.trigger( 'rendered:initial', this );\n\t        });\n\t\n\t        this.on( 'elements:select', function( data ){\n\t            this._renderClearSelected();\n\t        });\n\t\n\t        this.on( 'elements:discard', function( data ){\n\t            var element = data.source.element;\n\t            this.removeElementView( data.source );\n\t\n\t            this.workingElements = _.without( this.workingElements, element );\n\t            if( !this.workingElements.length ){\n\t                this._renderNoElementsLeft();\n\t            }\n\t        });\n\t\n\t        //this.on( 'all', function(){\n\t        //    this.info( arguments );\n\t        //});\n\t        return this;\n\t    },\n\t\n\t    /** handle errors with feedback and details to the user (if available) */\n\t    _errorHandler : function( data ){\n\t        this.error( data );\n\t\n\t        var creator = this;\n\t            content = data.message || _l( 'An error occurred' );\n\t        if( data.xhr ){\n\t            var xhr = data.xhr,\n\t                message = data.message;\n\t            if( xhr.readyState === 0 && xhr.status === 0 ){\n\t                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' ) +\n\t                    _l( ' Try again in a few minutes.' );\n\t            } else if( xhr.responseJSON ){\n\t                content += ':<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n\t            } else {\n\t                content += ': ' + message;\n\t            }\n\t        }\n\t        creator._showAlert( content, 'alert-danger' );\n\t    },\n\t\n\t    events : {\n\t        // header\n\t        'click .more-help'              : '_clickMoreHelp',\n\t        'click .less-help'              : '_clickLessHelp',\n\t        'click .main-help'              : '_toggleHelp',\n\t        'click .header .alert button'   : '_hideAlert',\n\t\n\t        'click .reset'                  : 'reset',\n\t        'click .clear-selected'         : 'clearSelectedElements',\n\t\n\t        // elements - selection\n\t        'click .collection-elements'    : 'clearSelectedElements',\n\t\n\t        // elements - drop target\n\t        // 'dragenter .collection-elements': '_dragenterElements',\n\t        // 'dragleave .collection-elements': '_dragleaveElements',\n\t        'dragover .collection-elements' : '_dragoverElements',\n\t        'drop .collection-elements'     : '_dropElements',\n\t\n\t        // these bubble up from the elements as custom events\n\t        'collection-element.dragstart .collection-elements' : '_elementDragstart',\n\t        'collection-element.dragend   .collection-elements' : '_elementDragend',\n\t\n\t        // footer\n\t        'change .collection-name'       : '_changeName',\n\t        'keydown .collection-name'      : '_nameCheckForEnter',\n\t        'click .cancel-create'          : function( ev ){\n\t            if( typeof this.oncancel === 'function' ){\n\t                this.oncancel.call( this );\n\t            }\n\t        },\n\t        'click .create-collection'      : '_clickCreate'//,\n\t    },\n\t\n\t    // ........................................................................ header\n\t    /** expand help */\n\t    _clickMoreHelp : function( ev ){\n\t        ev.stopPropagation();\n\t        this.$( '.main-help' ).addClass( 'expanded' );\n\t        this.$( '.more-help' ).hide();\n\t    },\n\t    /** collapse help */\n\t    _clickLessHelp : function( ev ){\n\t        ev.stopPropagation();\n\t        this.$( '.main-help' ).removeClass( 'expanded' );\n\t        this.$( '.more-help' ).show();\n\t    },\n\t    /** toggle help */\n\t    _toggleHelp : function( ev ){\n\t        ev.stopPropagation();\n\t        this.$( '.main-help' ).toggleClass( 'expanded' );\n\t        this.$( '.more-help' ).toggle();\n\t    },\n\t\n\t    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n\t    _showAlert : function( message, alertClass ){\n\t        alertClass = alertClass || 'alert-danger';\n\t        this.$( '.main-help' ).hide();\n\t        this.$( '.header .alert' )\n\t            .attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n\t            .find( '.alert-message' ).html( message );\n\t    },\n\t    /** hide the alerts at the top */\n\t    _hideAlert : function( message ){\n\t        this.$( '.main-help' ).show();\n\t        this.$( '.header .alert' ).hide();\n\t    },\n\t\n\t    // ........................................................................ elements\n\t    /** reset all data to the initial state */\n\t    reset : function(){\n\t        this._instanceSetUp();\n\t        this._elementsSetUp();\n\t        this.render();\n\t    },\n\t\n\t    /** deselect all elements */\n\t    clearSelectedElements : function( ev ){\n\t        this.$( '.collection-elements .collection-element' ).removeClass( 'selected' );\n\t        this.$( '.collection-elements-controls > .clear-selected' ).hide();\n\t    },\n\t\n\t    //_dragenterElements : function( ev ){\n\t    //    //this.debug( '_dragenterElements:', ev );\n\t    //},\n\t//TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n\t    // _dragleaveElements : function( ev ){\n\t    //    //this.debug( '_dragleaveElements:', ev );\n\t    // },\n\t\n\t    /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n\t    _dragoverElements : function( ev ){\n\t        //this.debug( '_dragoverElements:', ev );\n\t        ev.preventDefault();\n\t\n\t        var $list = this.$list();\n\t        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n\t        var $nearest = this._getNearestElement( ev.originalEvent.clientY );\n\t\n\t        //TODO: no need to re-create - move instead\n\t        this.$( '.element-drop-placeholder' ).remove();\n\t        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n\t        if( !$nearest.size() ){\n\t            $list.append( $placeholder );\n\t        } else {\n\t            $nearest.before( $placeholder );\n\t        }\n\t    },\n\t\n\t    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n\t    _checkForAutoscroll : function( $element, y ){\n\t        var AUTOSCROLL_SPEED = 2,\n\t            offset = $element.offset(),\n\t            scrollTop = $element.scrollTop(),\n\t            upperDist = y - offset.top,\n\t            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n\t        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n\t            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n\t        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n\t            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n\t        }\n\t    },\n\t\n\t    /** get the nearest element based on the mouse's Y coordinate.\n\t     *  If the y is at the end of the list, return an empty jQuery object.\n\t     */\n\t    _getNearestElement : function( y ){\n\t        var WIGGLE = 4,\n\t            lis = this.$( '.collection-elements li.collection-element' ).toArray();\n\t        for( var i=0; i<lis.length; i++ ){\n\t            var $li = $( lis[i] ),\n\t                top = $li.offset().top,\n\t                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n\t            if( top + halfHeight > y && top - halfHeight < y ){\n\t                return $li;\n\t            }\n\t        }\n\t        return $();\n\t    },\n\t\n\t    /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n\t    _dropElements : function( ev ){\n\t        if( ev.originalEvent ){ ev = ev.originalEvent; }\n\t        // both required for firefox\n\t        ev.preventDefault();\n\t        ev.dataTransfer.dropEffect = 'move';\n\t\n\t        // insert before the nearest element or after the last.\n\t        var $nearest = this._getNearestElement( ev.clientY );\n\t        if( $nearest.size() ){\n\t            this.$dragging.insertBefore( $nearest );\n\t        } else {\n\t            // no nearest before - insert after last element\n\t            this.$dragging.insertAfter( this.$( '.collection-elements .collection-element' ).last() );\n\t        }\n\t        // resync the creator's list based on the new DOM order\n\t        this._syncOrderToDom();\n\t        return false;\n\t    },\n\t\n\t    /** resync the creator's list of elements based on the DOM order */\n\t    _syncOrderToDom : function(){\n\t        var creator = this,\n\t            newElements = [];\n\t        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n\t        this.$( '.collection-elements .collection-element' ).each( function(){\n\t            var id = $( this ).attr( 'data-element-id' ),\n\t                element = _.findWhere( creator.workingElements, { id: id });\n\t            if( element ){\n\t                newElements.push( element );\n\t            } else {\n\t                console.error( 'missing element: ', id );\n\t            }\n\t        });\n\t        this.workingElements = newElements;\n\t        this._renderList();\n\t    },\n\t\n\t    /** drag communication with element sub-views: dragstart */\n\t    _elementDragstart : function( ev, element ){\n\t        // auto select the element causing the event and move all selected\n\t        element.select( true );\n\t        this.$dragging = this.$( '.collection-elements .collection-element.selected' );\n\t    },\n\t\n\t    /** drag communication with element sub-views: dragend - remove the placeholder */\n\t    _elementDragend : function( ev, element ){\n\t        $( '.element-drop-placeholder' ).remove();\n\t        this.$dragging = null;\n\t    },\n\t\n\t    // ........................................................................ footer\n\t    /** handle a collection name change */\n\t    _changeName : function( ev ){\n\t        this._validationWarning( 'name', !!this._getName() );\n\t    },\n\t\n\t    /** check for enter key press when in the collection name and submit */\n\t    _nameCheckForEnter : function( ev ){\n\t        if( ev.keyCode === 13 && !this.blocking ){\n\t            this._clickCreate();\n\t        }\n\t    },\n\t\n\t    /** get the current collection name */\n\t    _getName : function(){\n\t        return _.escape( this.$( '.collection-name' ).val() );\n\t    },\n\t\n\t    /** attempt to create the current collection */\n\t    _clickCreate : function( ev ){\n\t        var name = this._getName();\n\t        if( !name ){\n\t            this._validationWarning( 'name' );\n\t        } else if( !this.blocking ){\n\t            this.createList( name );\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ templates\n\t    //TODO: move to require text plugin and load these as text\n\t    //TODO: underscore currently unnecc. bc no vars are used\n\t    //TODO: better way of localizing text-nodes in long strings\n\t    /** underscore template fns attached to class */\n\t    templates : {\n\t        /** the skeleton */\n\t        main : _.template([\n\t            '<div class=\"header flex-row no-flex\"></div>',\n\t            '<div class=\"middle flex-row flex-row-container\"></div>',\n\t            '<div class=\"footer flex-row no-flex\"></div>'\n\t        ].join('')),\n\t\n\t        /** the header (not including help text) */\n\t        header : _.template([\n\t            '<div class=\"main-help well clear\">',\n\t                '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n\t                '<div class=\"help-content\">',\n\t                    '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n\t                '</div>',\n\t            '</div>',\n\t            '<div class=\"alert alert-dismissable\">',\n\t                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ',\n\t                    'title=\"', _l( 'Close and show more help' ), '\" aria-hidden=\"true\">&times;</button>',\n\t                '<span class=\"alert-message\"></span>',\n\t            '</div>',\n\t        ].join('')),\n\t\n\t        /** the middle: element list */\n\t        middle : _.template([\n\t            '<div class=\"collection-elements-controls\">',\n\t                '<a class=\"reset\" href=\"javascript:void(0);\" ',\n\t                    'title=\"', _l( 'Undo all reordering and discards' ), '\">',\n\t                    _l( 'Start over' ),\n\t                '</a>',\n\t                '<a class=\"clear-selected\" href=\"javascript:void(0);\" ',\n\t                    'title=\"', _l( 'De-select all selected datasets' ), '\">',\n\t                    _l( 'Clear selected' ),\n\t                '</a>',\n\t            '</div>',\n\t            '<div class=\"collection-elements scroll-container flex-row\">',\n\t            '</div>'\n\t        ].join('')),\n\t\n\t        /** creation and cancel controls */\n\t        footer : _.template([\n\t            '<div class=\"attributes clear\">',\n\t                '<div class=\"clear\">',\n\t                    '<input class=\"collection-name form-control pull-right\" ',\n\t                        'placeholder=\"', _l( 'Enter a name for your new collection' ), '\" />',\n\t                    '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n\t                '</div>',\n\t            '</div>',\n\t\n\t            '<div class=\"actions clear vertically-spaced\">',\n\t                '<div class=\"other-options pull-left\">',\n\t                    '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n\t                    '<div class=\"create-other btn-group dropup\">',\n\t                        '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n\t                              _l( 'Create a different kind of collection' ),\n\t                              ' <span class=\"caret\"></span>',\n\t                        '</button>',\n\t                        '<ul class=\"dropdown-menu\" role=\"menu\">',\n\t                              '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n\t                              '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n\t                        '</ul>',\n\t                    '</div>',\n\t                '</div>',\n\t\n\t                '<div class=\"main-options pull-right\">',\n\t                    '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n\t                '</div>',\n\t            '</div>'\n\t        ].join('')),\n\t\n\t        /** help content */\n\t        helpContent : _.template([\n\t            '<p>', _l([\n\t                'Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ',\n\t                'workflows in order to have analyses done on each member of the entire group. This interface allows ',\n\t                'you to create a collection and re-order the final collection.'\n\t            ].join( '' )), '</p>',\n\t            '<ul>',\n\t                '<li>', _l([\n\t                    'Rename elements in the list by clicking on ',\n\t                    '<i data-target=\".collection-element .name\">the existing name</i>.'\n\t                ].join( '' )), '</li>',\n\t                '<li>', _l([\n\t                    'Discard elements from the final created list by clicking on the ',\n\t                    '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'\n\t                ].join( '' )), '</li>',\n\t                '<li>', _l([\n\t                    'Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ',\n\t                    '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ',\n\t                    'entire group. Deselect them by clicking them again or by clicking the ',\n\t                    'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'\n\t                ].join( '' )), '</li>',\n\t                '<li>', _l([\n\t                    'Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ',\n\t                    'the interface.'\n\t                ].join( '' )), '</li>',\n\t                '<li>', _l([\n\t                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n\t                ].join( '' )), '</li>',\n\t            '</ul><br />',\n\t            '<p>', _l([\n\t                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n\t                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n\t            ].join( '' )), '</p>'\n\t        ].join('')),\n\t\n\t        /** shown in list when all elements are discarded */\n\t        invalidElements : _.template([\n\t            _l( 'The following selections could not be included due to problems:' ),\n\t            '<ul><% _.each( problems, function( problem ){ %>',\n\t                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n\t            '<% }); %></ul>'\n\t        ].join('')),\n\t\n\t        /** shown in list when all elements are discarded */\n\t        noElementsLeft : _.template([\n\t            '<li class=\"no-elements-left-message\">',\n\t                _l( 'No elements left! ' ),\n\t                _l( 'Would you like to ' ), '<a class=\"reset\" href=\"javascript:void(0)\">', _l( 'start over' ), '</a>?',\n\t            '</li>'\n\t        ].join('')),\n\t\n\t        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n\t        invalidInitial : _.template([\n\t            '<div class=\"header flex-row no-flex\">',\n\t                '<div class=\"alert alert-warning\" style=\"display: block\">',\n\t                    '<span class=\"alert-message\">',\n\t                        '<% if( _.size( problems ) ){ %>',\n\t                            _l( 'The following selections could not be included due to problems' ), ':',\n\t                            '<ul><% _.each( problems, function( problem ){ %>',\n\t                                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n\t                            '<% }); %></ul>',\n\t                        '<% } else if( _.size( elements ) < 1 ){ %>',\n\t                            _l( 'No datasets were selected' ), '.',\n\t                        '<% } %>',\n\t                        '<br />',\n\t                        _l( 'At least one element is needed for the collection' ), '. ',\n\t                        _l( 'You may need to ' ),\n\t                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n\t                        _l( 'and reselect new elements' ), '.',\n\t                    '</span>',\n\t                '</div>',\n\t            '</div>',\n\t            '<div class=\"footer flex-row no-flex\">',\n\t                '<div class=\"actions clear vertically-spaced\">',\n\t                    '<div class=\"other-options pull-left\">',\n\t                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n\t                        // _l( 'Create a different kind of collection' ),\n\t                    '</div>',\n\t                '</div>',\n\t            '</div>'\n\t        ].join('')),\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ misc\n\t    /** string rep */\n\t    toString : function(){ return 'ListCollectionCreator'; }\n\t});\n\t\n\t\n\t\n\t//=============================================================================\n\t/** Create a modal and load its body with the given CreatorClass creator type\n\t *  @returns {Deferred} resolved when creator has built a collection.\n\t */\n\tvar collectionCreatorModal = function _collectionCreatorModal( elements, options, CreatorClass ){\n\t\n\t    var deferred = jQuery.Deferred(),\n\t        modal = Galaxy.modal || ( new UI_MODAL.View() ),\n\t        creator;\n\t\n\t    options = _.defaults( options || {}, {\n\t        elements    : elements,\n\t        oncancel    : function(){\n\t            modal.hide();\n\t            deferred.reject( 'cancelled' );\n\t        },\n\t        oncreate    : function( creator, response ){\n\t            modal.hide();\n\t            deferred.resolve( response );\n\t        }\n\t    });\n\t\n\t    creator = new CreatorClass( options );\n\t    modal.show({\n\t        title   : options.title || _l( 'Create a collection' ),\n\t        body    : creator.$el,\n\t        width   : '80%',\n\t        height  : 'min-content',\n\t        closing_events: true\n\t    });\n\t    creator.render();\n\t    window._collectionCreator = creator;\n\t\n\t    //TODO: remove modal header\n\t    return deferred;\n\t};\n\t\n\t/** List collection flavor of collectionCreatorModal. */\n\tvar listCollectionCreatorModal = function _listCollectionCreatorModal( elements, options ){\n\t    options = options || {};\n\t    options.title = _l( 'Create a collection from a list of datasets' );\n\t    return collectionCreatorModal( elements, options, ListCollectionCreator );\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** Use a modal to create a list collection, then add it to the given history contents.\n\t *  @returns {Deferred} resolved when the collection is added to the history.\n\t */\n\tfunction createListCollection( contents ){\n\t    var elements = contents.toJSON(),\n\t        promise = listCollectionCreatorModal( elements, {\n\t            creationFn : function( elements, name ){\n\t                elements = elements.map( function( element ){\n\t                    return {\n\t                        id      : element.id,\n\t                        name    : element.name,\n\t                        //TODO: this allows for list:list even if the filter above does not - reconcile\n\t                        src     : ( element.history_content_type === 'dataset'? 'hda' : 'hdca' )\n\t                    };\n\t                });\n\t                return contents.createHDCA( elements, 'list', name );\n\t            }\n\t        });\n\t    return promise;\n\t}\n\t\n\t//==============================================================================\n\t    return {\n\t        DatasetCollectionElementView: DatasetCollectionElementView,\n\t        ListCollectionCreator       : ListCollectionCreator,\n\t\n\t        collectionCreatorModal      : collectionCreatorModal,\n\t        listCollectionCreatorModal  : listCollectionCreatorModal,\n\t        createListCollection        : createListCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(19),\n\t    __webpack_require__(6),\n\t    __webpack_require__(7),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( LIST_ITEM, STATES, faIconButton, BASE_MVC, _l ){\n\t/* global Backbone */\n\t/*==============================================================================\n\tTODO:\n\t    straighten out state rendering and templates used\n\t    inaccessible/STATES.NOT_VIEWABLE is a special case\n\t    simplify button rendering\n\t\n\t==============================================================================*/\n\tvar _super = LIST_ITEM.ListItemView;\n\t/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n\t *      Roughly, any DatasetInstance (and not a raw Dataset).\n\t */\n\tvar DatasetListItemView = _super.extend(\n\t/** @lends DatasetListItemView.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger      : console,\n\t\n\t    className   : _super.prototype.className + \" dataset\",\n\t    //TODO:?? doesn't exactly match an hda's type_id\n\t    id          : function(){\n\t        return [ 'dataset', this.model.get( 'id' ) ].join( '-' );\n\t    },\n\t\n\t    /** Set up: instance vars, options, and event handlers */\n\t    initialize : function( attributes ){\n\t        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n\t        this.log( this + '.initialize:', attributes );\n\t        _super.prototype.initialize.call( this, attributes );\n\t\n\t        /** where should pages from links be displayed? (default to new tab/window) */\n\t        this.linkTarget = attributes.linkTarget || '_blank';\n\t    },\n\t\n\t    /** event listeners */\n\t    _setUpListeners : function(){\n\t        _super.prototype._setUpListeners.call( this );\n\t\n\t        // re-rendering on any model changes\n\t        this.model.on( 'change', function( model, options ){\n\t            // if the model moved into the ready state and is expanded without details, fetch those details now\n\t            if( this.model.changedAttributes().state && this.model.inReadyState()\n\t            &&  this.expanded && !this.model.hasDetails() ){\n\t                // will render automatically (due to fetch -> change)\n\t                this.model.fetch();\n\t\n\t            } else {\n\t                this.render();\n\t            }\n\t        }, this );\n\t    },\n\t\n\t    // ......................................................................... expandable\n\t    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n\t     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t     */\n\t    _fetchModelDetails : function(){\n\t        var view = this;\n\t        if( view.model.inReadyState() && !view.model.hasDetails() ){\n\t            return view.model.fetch({ silent: true });\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    // ......................................................................... removal\n\t    /** Remove this view's html from the DOM and remove all event listeners.\n\t     *  @param {Number or String} speed jq effect speed\n\t     *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n\t     */\n\t    remove : function( speed, callback ){\n\t        var view = this;\n\t        speed = speed || this.fxSpeed;\n\t        this.$el.fadeOut( speed, function(){\n\t            Backbone.View.prototype.remove.call( view );\n\t            if( callback ){ callback.call( view ); }\n\t        });\n\t    },\n\t\n\t    // ......................................................................... rendering\n\t    /* TODO:\n\t        dataset states are the issue primarily making dataset rendering complex\n\t            each state should have it's own way of displaying/set of details\n\t            often with different actions that can be applied\n\t        throw in deleted/purged/visible and things get complicated easily\n\t        I've considered (a couple of times) - creating a view for each state\n\t            - but recreating the view during an update...seems wrong\n\t    */\n\t    /** Render this HDA, set up ui.\n\t     *  @param {Number or String} speed jq fx speed\n\t     *  @returns {Object} this\n\t     */\n\t    render : function( speed ){\n\t        //HACK: hover exit doesn't seem to be called on prev. tooltips when RE-rendering - so: no tooltip hide\n\t        // handle that here by removing previous view's tooltips\n\t        //this.$el.find(\"[title]\").tooltip( \"destroy\" );\n\t        return _super.prototype.render.call( this, speed );\n\t    },\n\t\n\t    /** In this override, add the dataset state as a class for use with state-based CSS */\n\t    _swapNewRender : function( $newRender ){\n\t        _super.prototype._swapNewRender.call( this, $newRender );\n\t        if( this.model.has( 'state' ) ){\n\t            this.$el.addClass( 'state-' + this.model.get( 'state' ) );\n\t        }\n\t        return this.$el;\n\t    },\n\t\n\t    // ................................................................................ titlebar\n\t    /** In this override, add the dataset display button. */\n\t    _renderPrimaryActions : function(){\n\t        // render just the display for read-only\n\t        return [ this._renderDisplayButton() ];\n\t    },\n\t\n\t    /** Render icon-button to display dataset data */\n\t    _renderDisplayButton : function(){\n\t//TODO:?? too complex - possibly move into template\n\t        // don't show display if not viewable or not accessible\n\t        var state = this.model.get( 'state' );\n\t        if( ( state === STATES.NOT_VIEWABLE )\n\t        ||  ( state === STATES.DISCARDED )\n\t        ||  ( !this.model.get( 'accessible' ) ) ){\n\t            return null;\n\t        }\n\t\n\t        var displayBtnData = {\n\t            target      : this.linkTarget,\n\t            classes     : 'display-btn'\n\t        };\n\t\n\t        // show a disabled display if the data's been purged\n\t        if( this.model.get( 'purged' ) ){\n\t            displayBtnData.disabled = true;\n\t            displayBtnData.title = _l( 'Cannot display datasets removed from disk' );\n\t\n\t        // disable if still uploading\n\t        } else if( state === STATES.UPLOAD ){\n\t            displayBtnData.disabled = true;\n\t            displayBtnData.title = _l( 'This dataset must finish uploading before it can be viewed' );\n\t\n\t        // disable if still new\n\t        } else if( state === STATES.NEW ){\n\t            displayBtnData.disabled = true;\n\t            displayBtnData.title = _l( 'This dataset is not yet viewable' );\n\t\n\t        } else {\n\t            displayBtnData.title = _l( 'View data' );\n\t\n\t            // default link for dataset\n\t            displayBtnData.href  = this.model.urls.display;\n\t\n\t            // add frame manager option onclick event\n\t            var self = this;\n\t            displayBtnData.onclick = function( ev ){\n\t                if (Galaxy.frame && Galaxy.frame.active) {\n\t                    // Add dataset to frames.\n\t                    Galaxy.frame.add_dataset(self.model.get('id'));\n\t                    ev.preventDefault();\n\t                }\n\t            };\n\t        }\n\t        displayBtnData.faIcon = 'fa-eye';\n\t        return faIconButton( displayBtnData );\n\t    },\n\t\n\t    // ......................................................................... rendering details\n\t    /** Render the enclosing div of the hda body and, if expanded, the html in the body\n\t     *  @returns {jQuery} rendered DOM\n\t     */\n\t    _renderDetails : function(){\n\t        //TODO: generalize to be allow different details for each state\n\t\n\t        // no access - render nothing but a message\n\t        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n\t            return $( this.templates.noAccess( this.model.toJSON(), this ) );\n\t        }\n\t\n\t        var $details = _super.prototype._renderDetails.call( this );\n\t        $details.find( '.actions .left' ).empty().append( this._renderSecondaryActions() );\n\t        $details.find( '.summary' ).html( this._renderSummary() )\n\t            .prepend( this._renderDetailMessages() );\n\t        $details.find( '.display-applications' ).html( this._renderDisplayApplications() );\n\t\n\t//TODO: double tap\n\t        this._setUpBehaviors( $details );\n\t        return $details;\n\t    },\n\t\n\t    /** Defer to the appropo summary rendering fn based on state */\n\t    _renderSummary : function(){\n\t        var json = this.model.toJSON(),\n\t            summaryRenderFn = this.templates.summaries[ json.state ];\n\t        summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n\t        return summaryRenderFn( json, this );\n\t    },\n\t\n\t    /** Render messages to be displayed only when the details are shown */\n\t    _renderDetailMessages : function(){\n\t        var view = this,\n\t            $warnings = $( '<div class=\"detail-messages\"></div>' ),\n\t            json = view.model.toJSON();\n\t//TODO:! unordered (map)\n\t        _.each( view.templates.detailMessages, function( templateFn ){\n\t            $warnings.append( $( templateFn( json, view ) ) );\n\t        });\n\t        return $warnings;\n\t    },\n\t\n\t    /** Render the external display application links */\n\t    _renderDisplayApplications : function(){\n\t        if( this.model.isDeletedOrPurged() ){ return ''; }\n\t        // render both old and new display apps using the same template\n\t        return [\n\t            this.templates.displayApplications( this.model.get( 'display_apps' ), this ),\n\t            this.templates.displayApplications( this.model.get( 'display_types' ), this )\n\t        ].join( '' );\n\t    },\n\t\n\t    // ......................................................................... secondary/details actions\n\t    /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n\t    _renderSecondaryActions : function(){\n\t        this.debug( '_renderSecondaryActions' );\n\t        switch( this.model.get( 'state' ) ){\n\t            case STATES.NOT_VIEWABLE:\n\t                return [];\n\t            case STATES.OK:\n\t            case STATES.FAILED_METADATA:\n\t            case STATES.ERROR:\n\t                return [ this._renderDownloadButton(), this._renderShowParamsButton() ];\n\t        }\n\t        return [ this._renderShowParamsButton() ];\n\t    },\n\t\n\t    /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n\t     *  @returns {jQuery} rendered DOM\n\t     */\n\t    _renderShowParamsButton : function(){\n\t        // gen. safe to show in all cases\n\t        return faIconButton({\n\t            title       : _l( 'View details' ),\n\t            classes     : 'params-btn',\n\t            href        : this.model.urls.show_params,\n\t            target      : this.linkTarget,\n\t            faIcon      : 'fa-info-circle'\n\t        });\n\t    },\n\t\n\t    /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n\t     *  @returns {jQuery} rendered DOM\n\t     */\n\t    _renderDownloadButton : function(){\n\t//TODO: to (its own) template fn\n\t        // don't show anything if the data's been purged\n\t        if( this.model.get( 'purged' ) || !this.model.hasData() ){ return null; }\n\t\n\t        // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n\t        //  or a single download icon-button (if there are no meta files)\n\t        if( !_.isEmpty( this.model.get( 'meta_files' ) ) ){\n\t            return this._renderMetaFileDownloadButton();\n\t        }\n\t\n\t        return $([\n\t            '<a class=\"download-btn icon-btn\" href=\"', this.model.urls.download, '\" title=\"' + _l( 'Download' ) + '\">',\n\t                '<span class=\"fa fa-floppy-o\"></span>',\n\t            '</a>'\n\t        ].join( '' ));\n\t    },\n\t\n\t    /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n\t    _renderMetaFileDownloadButton : function(){\n\t        var urls = this.model.urls;\n\t        return $([\n\t            '<div class=\"metafile-dropdown dropdown\">',\n\t                '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"',\n\t                    ' title=\"' + _l( 'Download' ) + '\">',\n\t                    '<span class=\"fa fa-floppy-o\"></span>',\n\t                '</a>',\n\t                '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">',\n\t                    '<li><a href=\"' + urls.download + '\">', _l( 'Download dataset' ), '</a></li>',\n\t                    _.map( this.model.get( 'meta_files' ), function( meta_file ){\n\t                        return [\n\t                            '<li><a href=\"', urls.meta_download + meta_file.file_type, '\">',\n\t                                _l( 'Download' ), ' ', meta_file.file_type,\n\t                            '</a></li>'\n\t                        ].join( '' );\n\t                    }).join( '\\n' ),\n\t                '</ul>',\n\t            '</div>'\n\t        ].join( '\\n' ));\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        'click .display-btn'    : function( ev ){ this.trigger( 'display', this, ev ); },\n\t        'click .params-btn'     : function( ev ){ this.trigger( 'params', this, ev ); },\n\t        'click .download-btn'   : function( ev ){ this.trigger( 'download', this, ev ); }\n\t    }),\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DatasetListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDatasetListItemView.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n\t        failed_metadata : BASE_MVC.wrapTemplate([\n\t            // failed metadata is rendered as a warning on an otherwise ok dataset view\n\t            '<% if( model.state === \"failed_metadata\" ){ %>',\n\t                '<div class=\"warningmessagesmall\">',\n\t                    _l( 'An error occurred setting the metadata for this dataset' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ]),\n\t        error : BASE_MVC.wrapTemplate([\n\t            // error during index fetch - show error on dataset\n\t            '<% if( model.error ){ %>',\n\t                '<div class=\"errormessagesmall\">',\n\t                    _l( 'There was an error getting the data for this dataset' ), ': <%- model.error %>',\n\t                '</div>',\n\t            '<% } %>'\n\t        ]),\n\t        purged : BASE_MVC.wrapTemplate([\n\t            '<% if( model.purged ){ %>',\n\t                '<div class=\"purged-msg warningmessagesmall\">',\n\t                    _l( 'This dataset has been deleted and removed from disk' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ]),\n\t        deleted : BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.deleted && !model.purged ){ %>',\n\t                '<div class=\"deleted-msg warningmessagesmall\">',\n\t                    _l( 'This dataset has been deleted' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ])\n\t\n\t        //NOTE: hidden warning is only needed for HDAs\n\t    });\n\t\n\t    var detailsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"details\">',\n\t            '<div class=\"summary\"></div>',\n\t\n\t            '<div class=\"actions clear\">',\n\t                '<div class=\"left\"></div>',\n\t                '<div class=\"right\"></div>',\n\t            '</div>',\n\t\n\t            // do not display tags, annotation, display apps, or peek when deleted\n\t            '<% if( !dataset.deleted && !dataset.purged ){ %>',\n\t                '<div class=\"tags-display\"></div>',\n\t                '<div class=\"annotation-display\"></div>',\n\t\n\t                '<div class=\"display-applications\"></div>',\n\t\n\t                '<% if( dataset.peek ){ %>',\n\t                    '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>',\n\t                '<% } %>',\n\t            '<% } %>',\n\t        '</div>'\n\t    ], 'dataset' );\n\t\n\t    var noAccessTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"details\">',\n\t            '<div class=\"summary\">',\n\t                _l( 'You do not have permission to view this dataset' ),\n\t            '</div>',\n\t        '</div>'\n\t    ], 'dataset' );\n\t\n\t//TODO: still toooooooooooooo complex - rework\n\t    var summaryTemplates = {};\n\t    summaryTemplates[ STATES.OK ] = summaryTemplates[ STATES.FAILED_METADATA ] = BASE_MVC.wrapTemplate([\n\t        '<% if( dataset.misc_blurb ){ %>',\n\t            '<div class=\"blurb\">',\n\t                '<span class=\"value\"><%- dataset.misc_blurb %></span>',\n\t            '</div>',\n\t        '<% } %>',\n\t\n\t        '<% if( dataset.file_ext ){ %>',\n\t            '<div class=\"datatype\">',\n\t                '<label class=\"prompt\">', _l( 'format' ), '</label>',\n\t                '<span class=\"value\"><%- dataset.file_ext %></span>',\n\t            '</div>',\n\t        '<% } %>',\n\t\n\t        '<% if( dataset.metadata_dbkey ){ %>',\n\t            '<div class=\"dbkey\">',\n\t                '<label class=\"prompt\">', _l( 'database' ), '</label>',\n\t                '<span class=\"value\">',\n\t                    '<%- dataset.metadata_dbkey %>',\n\t                '</span>',\n\t            '</div>',\n\t        '<% } %>',\n\t\n\t        '<% if( dataset.misc_info ){ %>',\n\t            '<div class=\"info\">',\n\t                '<span class=\"value\"><%- dataset.misc_info %></span>',\n\t            '</div>',\n\t        '<% } %>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.NEW ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'This is a new dataset and not all of its data are available yet' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.NOT_VIEWABLE ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'You do not have permission to view this dataset' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.DISCARDED ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'The job creating this dataset was cancelled before completion' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.QUEUED ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'This job is waiting to run' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.RUNNING ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'This job is currently running' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.UPLOAD ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'This dataset is currently uploading' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.SETTING_METADATA ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'Metadata is being auto-detected' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.PAUSED ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume' ), '</div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.ERROR ] = BASE_MVC.wrapTemplate([\n\t        '<% if( !dataset.purged ){ %>',\n\t            '<div><%- dataset.misc_blurb %></div>',\n\t        '<% } %>',\n\t        '<span class=\"help-text\">', _l( 'An error occurred with this dataset' ), ':</span>',\n\t        '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'\n\t    ], 'dataset' );\n\t    summaryTemplates[ STATES.EMPTY ] = BASE_MVC.wrapTemplate([\n\t        '<div>', _l( 'No data' ), ': <i><%- dataset.misc_blurb %></i></div>'\n\t    ], 'dataset' );\n\t    summaryTemplates.unknown = BASE_MVC.wrapTemplate([\n\t        '<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'\n\t    ], 'dataset' );\n\t\n\t    // messages to be displayed only within the details section ('below the fold')\n\t    var detailMessageTemplates = {\n\t        resubmitted : BASE_MVC.wrapTemplate([\n\t            // deleted not purged\n\t            '<% if( model.resubmitted ){ %>',\n\t                '<div class=\"resubmitted-msg infomessagesmall\">',\n\t                    _l( 'The job creating this dataset has been resubmitted' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ])\n\t    };\n\t\n\t    // this is applied to both old and new style display apps\n\t    var displayApplicationsTemplate = BASE_MVC.wrapTemplate([\n\t        '<% _.each( apps, function( app ){ %>',\n\t            '<div class=\"display-application\">',\n\t                '<span class=\"display-application-location\"><%- app.label %></span> ',\n\t                '<span class=\"display-application-links\">',\n\t                    '<% _.each( app.links, function( link ){ %>',\n\t                        '<a target=\"<%= link.target %>\" href=\"<%= link.href %>\">',\n\t                            '<% print( _l( link.text ) ); %>',\n\t                        '</a> ',\n\t                    '<% }); %>',\n\t                '</span>',\n\t            '</div>',\n\t        '<% }); %>'\n\t    ], 'apps' );\n\t\n\t    return _.extend( {}, _super.prototype.templates, {\n\t        warnings    : warnings,\n\t        details     : detailsTemplate,\n\t        noAccess    : noAccessTemplate,\n\t        summaries   : summaryTemplates,\n\t        detailMessages      : detailMessageTemplates,\n\t        displayApplications : displayApplicationsTemplate\n\t    });\n\t}());\n\t\n\t\n\t// ============================================================================\n\t    return {\n\t        DatasetListItemView : DatasetListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(13),\n\t    __webpack_require__(17),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DC_MODEL, HISTORY_CONTENT, _l ){\n\t/*==============================================================================\n\t\n\tModels for DatasetCollections contained within a history.\n\t\n\tTODO:\n\t    these might be compactable to one class if some duplication with\n\t    collection-model is used.\n\t\n\t==============================================================================*/\n\tvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin,\n\t    ListDC = DC_MODEL.ListDatasetCollection,\n\t    PairDC = DC_MODEL.PairDatasetCollection,\n\t    ListPairedDC = DC_MODEL.ListPairedDatasetCollection;\n\t\n\t//==============================================================================\n\t/** Override to post to contents route w/o id. */\n\tfunction buildHDCASave( _super ){\n\t    return function _save( attributes, options ){\n\t        if( this.isNew() ){\n\t            options = options || {};\n\t            options.url = this.urlRoot + this.get( 'history_id' ) + '/contents';\n\t            attributes = attributes || {};\n\t            attributes.type = 'dataset_collection';\n\t        }\n\t        return _super.call( this, attributes, options );\n\t    };\n\t}\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone model for List Dataset Collection within a History.\n\t */\n\tvar HistoryListDatasetCollection = ListDC.extend( hcontentMixin ).extend(\n\t/** @lends HistoryListDatasetCollection.prototype */{\n\t\n\t    defaults : _.extend( _.clone( ListDC.prototype.defaults ), {\n\t        history_content_type: 'dataset_collection',\n\t        collection_type     : 'list',\n\t        model_class         : 'HistoryDatasetCollectionAssociation'\n\t    }),\n\t\n\t    initialize : function( model, options ){\n\t        ListDC.prototype.initialize.call( this, model, options );\n\t        hcontentMixin.initialize.call( this, model, options );\n\t    },\n\t\n\t    /** Override to post to contents route w/o id. */\n\t    save : buildHDCASave( ListDC.prototype.save ),\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'HistoryListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone model for Pair Dataset Collection within a History.\n\t *  @constructs\n\t */\n\tvar HistoryPairDatasetCollection = PairDC.extend( hcontentMixin ).extend(\n\t/** @lends HistoryPairDatasetCollection.prototype */{\n\t\n\t    defaults : _.extend( _.clone( PairDC.prototype.defaults ), {\n\t        history_content_type: 'dataset_collection',\n\t        collection_type     : 'paired',\n\t        model_class         : 'HistoryDatasetCollectionAssociation'\n\t    }),\n\t\n\t    initialize : function( model, options ){\n\t        PairDC.prototype.initialize.call( this, model, options );\n\t        hcontentMixin.initialize.call( this, model, options );\n\t    },\n\t\n\t    /** Override to post to contents route w/o id. */\n\t    save : buildHDCASave( PairDC.prototype.save ),\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'HistoryPairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone model for List of Pairs Dataset Collection within a History.\n\t *  @constructs\n\t */\n\tvar HistoryListPairedDatasetCollection = ListPairedDC.extend( hcontentMixin ).extend(\n\t/** @lends HistoryListPairedDatasetCollection.prototype */{\n\t\n\t    defaults : _.extend( _.clone( ListPairedDC.prototype.defaults ), {\n\t        history_content_type: 'dataset_collection',\n\t        collection_type     : 'list:paired',\n\t        model_class         : 'HistoryDatasetCollectionAssociation'\n\t    }),\n\t\n\t    initialize : function( model, options ){\n\t        ListPairedDC.prototype.initialize.call( this, model, options );\n\t        hcontentMixin.initialize.call( this, model, options );\n\t    },\n\t\n\t    /** Override to post to contents route w/o id. */\n\t    save : buildHDCASave( ListPairedDC.prototype.save ),\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'HistoryListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HistoryListDatasetCollection        : HistoryListDatasetCollection,\n\t        HistoryPairDatasetCollection        : HistoryPairDatasetCollection,\n\t        HistoryListPairedDatasetCollection  : HistoryListPairedDatasetCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(6),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( STATES, BASE_MVC, _l ){\n\t//==============================================================================\n\t/** How the type_id attribute is built for the history's mixed contents collection */\n\tvar typeIdStr = function _typeIdStr( type, id ){\n\t    return [ type, id ].join( '-' );\n\t};\n\t\n\t//==============================================================================\n\t/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n\t */\n\tvar HistoryContentMixin = {\n\t//TODO:?? into true Backbone.Model?\n\t\n\t    /** default attributes for a model */\n\t    defaults : {\n\t        /** parent (containing) history */\n\t        history_id          : null,\n\t        /** some content_type (HistoryContents can contain mixed model classes) */\n\t        history_content_type: null,\n\t        /** indicating when/what order the content was generated in the context of the history */\n\t        hid                 : null,\n\t        /** whether the user wants the content shown (visible) */\n\t        visible             : true\n\t    },\n\t\n\t    // ........................................................................ mixed content element\n\t//TODO: there's got to be a way to move this into HistoryContents - if we can do that, this class might not be needed\n\t    // In order to be part of a MIXED bbone collection, we can't rely on the id\n\t    //  (which may collide btwn models of different classes)\n\t    // Build a new id (type_id) that prefixes the history_content_type so the bbone collection can differentiate\n\t    idAttribute : 'type_id',\n\t\n\t    /** override constructor to build type_id and insert into original attributes */\n\t    constructor : function( attrs, options ){\n\t        attrs.type_id = typeIdStr( attrs.history_content_type, attrs.id );\n\t        this.debug( 'HistoryContentMixin.constructor:', attrs.type_id );\n\t        Backbone.Model.apply( this, arguments );\n\t    },\n\t\n\t    /** object level fn for building the type_id string */\n\t    _typeIdStr : function(){\n\t        return typeIdStr( this.get( 'history_content_type' ), this.get( 'id' ) );\n\t    },\n\t\n\t    /** add listener to re-create type_id when the id changes */\n\t    initialize : function( attrs, options ){\n\t        this.on( 'change:id', this._createTypeId );\n\t    },\n\t\n\t    /** set the type_id in the model attributes */\n\t    _createTypeId : function(){\n\t        this.set( 'type_id', this._typeIdStr() );\n\t    },\n\t\n\t    /** override because backbone tests boolean( idAttribute ), but it's not an empty string even for new models\n\t     *  due to our use of type_id.\n\t     */\n\t    isNew : function(){\n\t        return !this.get( 'id' );\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** the more common alias of visible */\n\t    hidden : function(){\n\t        return !this.get( 'visible' );\n\t    },\n\t\n\t    /** based on show_deleted, show_hidden (gen. from the container control),\n\t     *      would this ds show in the list of ds's?\n\t     *  @param {Boolean} show_deleted are we showing deleted hdas?\n\t     *  @param {Boolean} show_hidden are we showing hidden hdas?\n\t     */\n\t    isVisible : function( show_deleted, show_hidden ){\n\t//TODO:?? Another unfortunate name collision\n\t        var isVisible = true;\n\t        if( ( !show_deleted )\n\t        &&  ( this.get( 'deleted' ) || this.get( 'purged' ) ) ){\n\t            isVisible = false;\n\t        }\n\t        if( ( !show_hidden )\n\t        &&  ( !this.get( 'visible' ) ) ){\n\t            isVisible = false;\n\t        }\n\t        return isVisible;\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t//TODO: global\n\t//TODO: these are probably better done on the leaf classes\n\t    /** history content goes through the 'api/histories' API */\n\t    urlRoot: ( window.Galaxy? Galaxy.options.root : '/' ) + 'api/histories/',\n\t\n\t    /** full url spec. for this content */\n\t    url : function(){\n\t        var url = this.urlRoot + this.get( 'history_id' ) + '/contents/'\n\t             + this.get('history_content_type') + 's/' + this.get( 'id' );\n\t        return url;\n\t    },\n\t\n\t    /** save this content as not visible */\n\t    hide : function( options ){\n\t        if( !this.get( 'visible' ) ){ return jQuery.when(); }\n\t        return this.save( { visible: false }, options );\n\t    },\n\t    /** save this content as visible */\n\t    unhide : function( options ){\n\t        if( this.get( 'visible' ) ){ return jQuery.when(); }\n\t        return this.save( { visible: true }, options );\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var nameAndId = this.get( 'id' ) || '';\n\t        if( this.get( 'name' ) ){\n\t            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n\t        }\n\t        return 'HistoryContent(' + nameAndId + ')';\n\t    }\n\t};\n\t\n\t\n\t//==============================================================================\n\t//TODO: needed?\n\t/** @class (Concrete/non-mixin) base model for content items.\n\t */\n\tvar HistoryContent = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend( HistoryContentMixin );\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        typeIdStr           : typeIdStr,\n\t        HistoryContentMixin : HistoryContentMixin,\n\t        HistoryContent      : HistoryContent\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(17),\n\t    __webpack_require__(31),\n\t    __webpack_require__(16),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( HISTORY_CONTENT, HDA_MODEL, HDCA_MODEL, BASE_MVC, _l ){\n\t//==============================================================================\n\t/** @class Backbone collection for history content.\n\t *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n\t *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n\t *          the same level.\n\t *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n\t *          HDAs or child dataset collections on one level.\n\t *      This is why this does not inherit from any of the DatasetCollections (currently).\n\t */\n\tvar HistoryContents = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n\t/** @lends HistoryContents.prototype */{\n\t//TODO:?? may want to inherit from some MixedModelCollection\n\t//TODO:?? also consider inheriting from a 'DatasetList'\n\t//TODO: can we decorate the mixed models using the model fn below (instead of having them build their own type_id)?\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n\t    model : function( attrs, options ) {\n\t//TODO: can we move the type_id stuff here?\n\t        //attrs.type_id = typeIdStr( attrs );\n\t\n\t        if( attrs.history_content_type === \"dataset\" ) {\n\t            return new HDA_MODEL.HistoryDatasetAssociation( attrs, options );\n\t\n\t        } else if( attrs.history_content_type === \"dataset_collection\" ) {\n\t            switch( attrs.collection_type ){\n\t                case 'list':\n\t                    return new HDCA_MODEL.HistoryListDatasetCollection( attrs, options );\n\t                case 'paired':\n\t                    return new HDCA_MODEL.HistoryPairDatasetCollection( attrs, options );\n\t                case 'list:paired':\n\t                    return new HDCA_MODEL.HistoryListPairedDatasetCollection( attrs, options );\n\t            }\n\t            // This is a hack inside a hack:\n\t            // Raise a plain object with validationError to fake a model.validationError\n\t            // (since we don't have a model to use validate with)\n\t            // (the outer hack being the mixed content/model function in this collection)\n\t            return { validationError : 'Unknown collection_type: ' + attrs.history_content_type };\n\t        }\n\t        return { validationError : 'Unknown history_content_type: ' + attrs.history_content_type };\n\t    },\n\t\n\t    /** Set up.\n\t     *  @see Backbone.Collection#initialize\n\t     */\n\t    initialize : function( models, options ){\n\t        options = options || {};\n\t//TODO: could probably use the contents.history_id instead\n\t        this.historyId = options.historyId;\n\t        //this._setUpListeners();\n\t\n\t        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n\t        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n\t        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n\t        this.model.prototype.idAttribute = 'type_id';\n\t\n\t        this.on( 'all', function(){\n\t            this.debug( this + '.event:', arguments );\n\t        });\n\t    },\n\t\n\t    /** root api url */\n\t    urlRoot : galaxy_config.root + 'api/histories',\n\t    /** complete api url */\n\t    url : function(){\n\t        return this.urlRoot + '/' + this.historyId + '/contents';\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** Get the ids of every item in this collection\n\t     *  @returns array of encoded ids\n\t     */\n\t    ids : function(){\n\t//TODO: is this still useful since type_id\n\t        return this.map( function( item ){ return item.get('id'); });\n\t    },\n\t\n\t    /** Get contents that are not ready\n\t     *  @returns array of content models\n\t     */\n\t    notReady : function(){\n\t        return this.filter( function( content ){\n\t            return !content.inReadyState();\n\t        });\n\t    },\n\t\n\t    /** Get the id of every model in this collection not in a 'ready' state (running).\n\t     *  @returns an array of model ids\n\t     *  @see HistoryDatasetAssociation#inReadyState\n\t     */\n\t    running : function(){\n\t        var idList = [];\n\t        this.each( function( item ){\n\t            var isRunning = !item.inReadyState();\n\t            if( isRunning ){\n\t//TODO: is this still correct since type_id\n\t                idList.push( item.get( 'id' ) );\n\t            }\n\t        });\n\t        return idList;\n\t    },\n\t\n\t    /** Get the model with the given hid\n\t     *  @param {Int} hid the hid to search for\n\t     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n\t     */\n\t    getByHid : function( hid ){\n\t        return _.first( this.filter( function( content ){ return content.get( 'hid' ) === hid; }) );\n\t    },\n\t\n\t    //TODO:?? this may belong in the containing view\n\t    /** Get every 'shown' model in this collection based on show_deleted/hidden\n\t     *  @param {Boolean} show_deleted are we showing deleted content?\n\t     *  @param {Boolean} show_hidden are we showing hidden content?\n\t     *  @returns array of content models\n\t     *  @see HistoryDatasetAssociation#isVisible\n\t     */\n\t    getVisible : function( show_deleted, show_hidden, filters ){\n\t        filters = filters || [];\n\t        //this.debug( 'filters:', filters );\n\t        // always filter by show deleted/hidden first\n\t        this.debug( 'checking isVisible' );\n\t        var filteredHdas = new HistoryContents( this.filter( function( item ){\n\t            return item.isVisible( show_deleted, show_hidden );\n\t        }));\n\t\n\t        _.each( filters, function( filterFn ){\n\t            if( !_.isFunction( filterFn ) ){ return; }\n\t            filteredHdas = new HistoryContents( filteredHdas.filter( filterFn ) );\n\t        });\n\t        return filteredHdas;\n\t    },\n\t\n\t    /** return a new contents collection of only hidden items */\n\t    hidden : function(){\n\t        function filterFn( c ){ return c.hidden(); }\n\t        return new HistoryContents( this.filter( filterFn ) );\n\t    },\n\t\n\t    /** return a new contents collection of only hidden items */\n\t    deleted : function(){\n\t        function filterFn( c ){ return c.get( 'deleted' ); }\n\t        return new HistoryContents( this.filter( filterFn ) );\n\t    },\n\t\n\t    /** return true if any contents don't have details */\n\t    haveDetails : function(){\n\t        return this.all( function( content ){ return content.hasDetails(); });\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t    /** fetch detailed model data for all contents in this collection */\n\t    fetchAllDetails : function( options ){\n\t        options = options || {};\n\t        var detailsFlag = { details: 'all' };\n\t        options.data = ( options.data )?( _.extend( options.data, detailsFlag ) ):( detailsFlag );\n\t        return this.fetch( options );\n\t    },\n\t\n\t    /** using a queue, perform ajaxFn on each of the models in this collection */\n\t    ajaxQueue : function( ajaxFn, options ){\n\t        var deferred = jQuery.Deferred(),\n\t            startingLength = this.length,\n\t            responses = [];\n\t\n\t        if( !startingLength ){\n\t            deferred.resolve([]);\n\t            return deferred;\n\t        }\n\t\n\t        // use reverse order (stylistic choice)\n\t        var ajaxFns = this.chain().reverse().map( function( content, i ){\n\t            return function(){\n\t                var xhr = ajaxFn.call( content, options );\n\t                // if successful, notify using the deferred to allow tracking progress\n\t                xhr.done( function( response ){\n\t                    deferred.notify({ curr: i, total: startingLength, response: response, model: content });\n\t                });\n\t                // (regardless of previous error or success) if not last ajax call, shift and call the next\n\t                //  if last fn, resolve deferred\n\t                xhr.always( function( response ){\n\t                    responses.push( response );\n\t                    if( ajaxFns.length ){\n\t                        ajaxFns.shift()();\n\t                    } else {\n\t                        deferred.resolve( responses );\n\t                    }\n\t                });\n\t            };\n\t        }).value();\n\t        // start the queue\n\t        ajaxFns.shift()();\n\t\n\t        return deferred;\n\t    },\n\t\n\t    isCopyable : function( contentsJSON ){\n\t        var copyableModelClasses = [\n\t            'HistoryDatasetAssociation',\n\t            'HistoryDatasetCollectionAssociation'\n\t        ];\n\t        return ( ( _.isObject( contentsJSON ) && contentsJSON.id )\n\t              && ( _.contains( copyableModelClasses, contentsJSON.model_class ) ) );\n\t    },\n\t\n\t    /** copy an existing, accessible hda into this collection */\n\t    copy : function( json ){\n\t        var id, type, contentType;\n\t        if( _.isString( json ) ){\n\t            id = json;\n\t            contentType = 'hda';\n\t            type = 'dataset';\n\t        } else {\n\t            id = json.id;\n\t            contentType = ({\n\t                'HistoryDatasetAssociation' : 'hda',\n\t                'LibraryDatasetDatasetAssociation' : 'ldda',\n\t                'HistoryDatasetCollectionAssociation' : 'hdca'\n\t            })[ json.model_class ] || 'hda';\n\t            type = ( contentType === 'hdca'? 'dataset_collection' : 'dataset' );\n\t        }\n\t        var collection = this,\n\t            xhr = jQuery.post( this.url(), {\n\t                content : id,\n\t                source  : contentType,\n\t                type    : type\n\t            })\n\t            .done( function( response ){\n\t                collection.add([ response ]);\n\t            })\n\t            .fail( function( error, status, message ){\n\t                collection.trigger( 'error', collection, xhr, {},\n\t                    'Error copying contents', { type: type, id: id, source: contentType });\n\t            });\n\t        return xhr;\n\t    },\n\t\n\t    // ........................................................................ sorting/filtering\n\t    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n\t    matches : function( matchesWhat ){\n\t        return this.filter( function( content ){\n\t            return content.matches( matchesWhat );\n\t        });\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** override to ensure type id is set */\n\t    set : function( models, options ){\n\t        models = _.isArray( models )? models : [ models ];\n\t        _.each( models, function( model ){\n\t            if( !model.type_id || !model.get || !model.get( 'type_id' ) ){\n\t                model.type_id = HISTORY_CONTENT.typeIdStr( model.history_content_type, model.id );\n\t            }\n\t        });\n\t        Backbone.Collection.prototype.set.call( this, models, options );\n\t    },\n\t\n\t    /** */\n\t    createHDCA : function( elementIdentifiers, collectionType, name, options ){\n\t        //precondition: elementIdentifiers is an array of plain js objects\n\t        //  in the proper form to create the collectionType\n\t        var contents = this,\n\t            typeToModel = {\n\t                list    : HDCA_MODEL.HistoryListDatasetCollection,\n\t                paired  : HDCA_MODEL.HistoryPairDatasetCollection\n\t            },\n\t            hdca = new (typeToModel[ collectionType ])({\n\t                history_id          : this.historyId,\n\t                name                : name,\n\t                // should probably be able to just send in a bunch of json here and restruct per class\n\t                element_identifiers : elementIdentifiers\n\t            });\n\t        // do I even need to use new above, can I just pass the attrs here\n\t        return hdca.save()\n\t            .done( function( response ){\n\t                contents.add( hdca );\n\t            })\n\t            .fail( function( xhr, status, message ){\n\t                contents.trigger( 'error', xhr, status, message );\n\t            });\n\t    },\n\t\n\t\n\t    /** In this override, copy the historyId to the clone */\n\t    clone : function(){\n\t        var clone = Backbone.Collection.prototype.clone.call( this );\n\t        clone.historyId = this.historyId;\n\t        return clone;\n\t    },\n\t\n\t    /** debugging */\n\t    print : function(){\n\t        var contents = this;\n\t        contents.each( function( c ){\n\t            contents.debug( c );\n\t            if( c.elements ){\n\t                contents.debug( '\\t elements:', c.elements );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'HistoryContents(', [ this.historyId, this.length ].join(), ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HistoryContents : HistoryContents\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( BASE_MVC, _l ){\n\t\n\t//==============================================================================\n\t/** A view which, when first rendered, shows only summary data/attributes, but\n\t *      can be expanded to show further details (and optionally fetch those\n\t *      details from the server).\n\t */\n\tvar ExpandableView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n\t//TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n\t    //PRECONDITION: model must have method hasDetails\n\t    //PRECONDITION: subclasses must have templates.el and templates.details\n\t\n\t    initialize : function( attributes ){\n\t        /** are the details of this view expanded/shown or not? */\n\t        this.expanded   = attributes.expanded || false;\n\t        this.log( '\\t expanded:', this.expanded );\n\t        this.fxSpeed = attributes.fxSpeed !== undefined? attributes.fxSpeed : this.fxSpeed;\n\t    },\n\t\n\t    // ........................................................................ render main\n\t    /** jq fx speed */\n\t    fxSpeed : 'fast',\n\t\n\t    /** Render this content, set up ui.\n\t     *  @param {Number or String} speed   the speed of the render\n\t     */\n\t    render : function( speed ){\n\t        var $newRender = this._buildNewRender();\n\t        this._setUpBehaviors( $newRender );\n\t        this._queueNewRender( $newRender, speed );\n\t        return this;\n\t    },\n\t\n\t    /** Build a temp div containing the new children for the view's $el.\n\t     *      If the view is already expanded, build the details as well.\n\t     */\n\t    _buildNewRender : function(){\n\t        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n\t        var $newRender = $( this.templates.el( this.model.toJSON(), this ) );\n\t        if( this.expanded ){\n\t            this.$details( $newRender ).replaceWith( this._renderDetails().show() );\n\t        }\n\t        return $newRender;\n\t    },\n\t\n\t    /** Fade out the old el, swap in the new contents, then fade in.\n\t     *  @param {Number or String} speed   jq speed to use for rendering effects\n\t     *  @fires rendered when rendered\n\t     */\n\t    _queueNewRender : function( $newRender, speed ) {\n\t        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n\t        var view = this;\n\t\n\t        $( view ).queue( 'fx', [\n\t            function( next ){ this.$el.fadeOut( speed, next ); },\n\t            function( next ){\n\t                view._swapNewRender( $newRender );\n\t                next();\n\t            },\n\t            function( next ){ this.$el.fadeIn( speed, next ); },\n\t            function( next ){\n\t                this.trigger( 'rendered', view );\n\t                next();\n\t            }\n\t        ]);\n\t    },\n\t\n\t    /** empty out the current el, move the $newRender's children in */\n\t    _swapNewRender : function( $newRender ){\n\t        return this.$el.empty()\n\t            .attr( 'class', _.isFunction( this.className )? this.className(): this.className )\n\t            .append( $newRender.children() );\n\t    },\n\t\n\t    /** set up js behaviors, event handlers for elements within the given container\n\t     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n\t     */\n\t    _setUpBehaviors : function( $where ){\n\t        $where = $where || this.$el;\n\t        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n\t        //make_popup_menus( $where );\n\t        $where.find( '[title]' ).tooltip({ placement : 'bottom' });\n\t    },\n\t\n\t    // ......................................................................... details\n\t    /** shortcut to details DOM (as jQ) */\n\t    $details : function( $where ){\n\t        $where = $where || this.$el;\n\t        return $where.find( '> .details' );\n\t    },\n\t\n\t    /** build the DOM for the details and set up behaviors on it */\n\t    _renderDetails : function(){\n\t        var $newDetails = $( this.templates.details( this.model.toJSON(), this ) );\n\t        this._setUpBehaviors( $newDetails );\n\t        return $newDetails;\n\t    },\n\t\n\t    // ......................................................................... expansion/details\n\t    /** Show or hide the details\n\t     *  @param {Boolean} expand if true, expand; if false, collapse\n\t     */\n\t    toggleExpanded : function( expand ){\n\t        expand = ( expand === undefined )?( !this.expanded ):( expand );\n\t        if( expand ){\n\t            this.expand();\n\t        } else {\n\t            this.collapse();\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** Render and show the full, detailed body of this view including extra data and controls.\n\t     *      note: if the model does not have detailed data, fetch that data before showing the body\n\t     *  @fires expanded when a body has been expanded\n\t     */\n\t    expand : function(){\n\t        var view = this;\n\t        return view._fetchModelDetails().always( function(){\n\t                view._expand();\n\t            });\n\t    },\n\t\n\t    /** Check for model details and, if none, fetch them.\n\t     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n\t     */\n\t    _fetchModelDetails : function(){\n\t        if( !this.model.hasDetails() ){\n\t            return this.model.fetch();\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    /** Inner fn called when expand (public) has fetched the details */\n\t    _expand : function(){\n\t        var view = this,\n\t            $newDetails = view._renderDetails();\n\t        view.$details().replaceWith( $newDetails );\n\t        // needs to be set after the above or the slide will not show\n\t        view.expanded = true;\n\t        view.$details().slideDown({\n\t            duration : view.fxSpeed,\n\t            step: function(){\n\t                view.trigger( 'expanding', view );\n\t            },\n\t            complete: function(){\n\t                view.trigger( 'expanded', view );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** Hide the body/details of an HDA.\n\t     *  @fires collapsed when a body has been collapsed\n\t     */\n\t    collapse : function(){\n\t        this.debug( this + '(ExpandableView).collapse' );\n\t        var view = this;\n\t        view.expanded = false;\n\t        this.$details().slideUp({\n\t            duration : view.fxSpeed,\n\t            step: function(){\n\t                view.trigger( 'collapsing', view );\n\t            },\n\t            complete: function(){\n\t                view.trigger( 'collapsed', view );\n\t            }\n\t        });\n\t    }\n\t\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** A view that is displayed in some larger list/grid/collection.\n\t *      Inherits from Expandable, Selectable, Draggable.\n\t *  The DOM contains warnings, a title bar, and a series of primary action controls.\n\t *      Primary actions are meant to be easily accessible item functions (such as delete)\n\t *      that are rendered in the title bar.\n\t *\n\t *  Details are rendered when the user clicks the title bar or presses enter/space when\n\t *      the title bar is in focus.\n\t *\n\t *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n\t */\n\tvar ListItemView = ExpandableView.extend(\n\t        BASE_MVC.mixin( BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n\t\n\t//TODO: that's a little contradictory\n\t    tagName     : 'div',\n\t    className   : 'list-item',\n\t\n\t    /** Set up the base class and all mixins */\n\t    initialize : function( attributes ){\n\t        ExpandableView.prototype.initialize.call( this, attributes );\n\t        BASE_MVC.SelectableViewMixin.initialize.call( this, attributes );\n\t        BASE_MVC.DraggableViewMixin.initialize.call( this, attributes );\n\t        this._setUpListeners();\n\t    },\n\t\n\t    /** event listeners */\n\t    _setUpListeners : function(){\n\t        // hide the primary actions in the title bar when selectable and narrow\n\t        this.on( 'selectable', function( isSelectable ){\n\t            if( isSelectable ){\n\t                this.$( '.primary-actions' ).hide();\n\t            } else {\n\t                this.$( '.primary-actions' ).show();\n\t            }\n\t        }, this );\n\t        //this.on( 'all', function( event ){\n\t        //    this.log( event );\n\t        //}, this );\n\t        return this;\n\t    },\n\t\n\t    // ........................................................................ rendering\n\t    /** In this override, call methods to build warnings, titlebar and primary actions */\n\t    _buildNewRender : function(){\n\t        var $newRender = ExpandableView.prototype._buildNewRender.call( this );\n\t        $newRender.children( '.warnings' ).replaceWith( this._renderWarnings() );\n\t        $newRender.children( '.title-bar' ).replaceWith( this._renderTitleBar() );\n\t        $newRender.children( '.primary-actions' ).append( this._renderPrimaryActions() );\n\t        $newRender.find( '> .title-bar .subtitle' ).replaceWith( this._renderSubtitle() );\n\t        return $newRender;\n\t    },\n\t\n\t    /** In this override, render the selector controls and set up dragging before the swap */\n\t    _swapNewRender : function( $newRender ){\n\t        ExpandableView.prototype._swapNewRender.call( this, $newRender );\n\t        if( this.selectable ){ this.showSelector( 0 ); }\n\t        if( this.draggable ){ this.draggableOn(); }\n\t        return this.$el;\n\t    },\n\t\n\t    /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n\t    _renderWarnings : function(){\n\t        var view = this,\n\t            $warnings = $( '<div class=\"warnings\"></div>' ),\n\t            json = view.model.toJSON();\n\t//TODO:! unordered (map)\n\t        _.each( view.templates.warnings, function( templateFn ){\n\t            $warnings.append( $( templateFn( json, view ) ) );\n\t        });\n\t        return $warnings;\n\t    },\n\t\n\t    /** Render the title bar (the main/exposed SUMMARY dom element) */\n\t    _renderTitleBar : function(){\n\t        return $( this.templates.titleBar( this.model.toJSON(), this ) );\n\t    },\n\t\n\t    /** Return an array of jQ objects containing common/easily-accessible item controls */\n\t    _renderPrimaryActions : function(){\n\t        // override this\n\t        return [];\n\t    },\n\t\n\t    /** Render the title bar (the main/exposed SUMMARY dom element) */\n\t    _renderSubtitle : function(){\n\t        return $( this.templates.subtitle( this.model.toJSON(), this ) );\n\t    },\n\t\n\t    // ......................................................................... events\n\t    /** event map */\n\t    events : {\n\t        // expand the body when the title is clicked or when in focus and space or enter is pressed\n\t        'click .title-bar'      : '_clickTitleBar',\n\t        'keydown .title-bar'    : '_keyDownTitleBar',\n\t\n\t        // dragging - don't work, originalEvent === null\n\t        //'dragstart .dataset-title-bar'  : 'dragStartHandler',\n\t        //'dragend .dataset-title-bar'    : 'dragEndHandler'\n\t\n\t        'click .selector'       : 'toggleSelect'\n\t    },\n\t\n\t    /** expand when the title bar is clicked */\n\t    _clickTitleBar : function( event ){\n\t        event.stopPropagation();\n\t        if( event.altKey ){\n\t            this.toggleSelect( event );\n\t            if( !this.selectable ){\n\t                this.showSelector();\n\t            }\n\t        } else {\n\t            this.toggleExpanded();\n\t        }\n\t    },\n\t\n\t    /** expand when the title bar is in focus and enter or space is pressed */\n\t    _keyDownTitleBar : function( event ){\n\t        // bail (with propagation) if keydown and not space or enter\n\t        var KEYCODE_SPACE = 32, KEYCODE_RETURN = 13;\n\t        if( event && ( event.type === 'keydown' )\n\t        &&( event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN ) ){\n\t            this.toggleExpanded();\n\t            event.stopPropagation();\n\t            return false;\n\t        }\n\t        return true;\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'ListItemView(' + modelString + ')';\n\t    }\n\t}));\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tListItemView.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var elTemplato = BASE_MVC.wrapTemplate([\n\t        '<div class=\"list-element\">',\n\t            // errors, messages, etc.\n\t            '<div class=\"warnings\"></div>',\n\t\n\t            // multi-select checkbox\n\t            '<div class=\"selector\">',\n\t                '<span class=\"fa fa-2x fa-square-o\"></span>',\n\t            '</div>',\n\t            // space for title bar buttons - gen. floated to the right\n\t            '<div class=\"primary-actions\"></div>',\n\t            '<div class=\"title-bar\"></div>',\n\t\n\t            // expandable area for more details\n\t            '<div class=\"details\"></div>',\n\t        '</div>'\n\t    ]);\n\t\n\t    var warnings = {};\n\t\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t//TODO: prob. belongs in dataset-list-item\n\t            '<span class=\"state-icon\"></span>',\n\t            '<div class=\"title\">',\n\t                '<span class=\"name\"><%- element.name %></span>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"></div>',\n\t        '</div>'\n\t    ], 'element' );\n\t\n\t    var subtitleTemplate = BASE_MVC.wrapTemplate([\n\t        // override this\n\t        '<div class=\"subtitle\"></div>'\n\t    ]);\n\t\n\t    var detailsTemplate = BASE_MVC.wrapTemplate([\n\t        // override this\n\t        '<div class=\"details\"></div>'\n\t    ]);\n\t\n\t    return {\n\t        el          : elTemplato,\n\t        warnings    : warnings,\n\t        titleBar    : titleBarTemplate,\n\t        subtitle    : subtitleTemplate,\n\t        details     : detailsTemplate\n\t    };\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** A view that is displayed in some larger list/grid/collection.\n\t *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n\t *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n\t *      If 'foldout': will expand vertically to show the nested list\n\t *      If 'drilldown': will overlay the parent list\n\t *\n\t *  Inherits from ListItemView.\n\t *\n\t *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n\t */\n\tvar FoldoutListItemView = ListItemView.extend({\n\t\n\t    /** If 'foldout': show the sub-panel inside the expanded item\n\t     *  If 'drilldown': only fire events and handle by pub-sub\n\t     *      (allow the panel containing this item to attach it, hide itself, etc.)\n\t     */\n\t    foldoutStyle        : 'foldout',\n\t    /** Panel view class to instantiate for the sub-panel */\n\t    foldoutPanelClass   : null,\n\t\n\t    /** override to:\n\t     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n\t     *      disrespect attributes.expanded if drilldown\n\t     */\n\t    initialize : function( attributes ){\n\t//TODO: hackish\n\t        if( this.foldoutStyle === 'drilldown' ){ this.expanded = false; }\n\t        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n\t        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\t\n\t        ListItemView.prototype.initialize.call( this, attributes );\n\t        this.foldout = this._createFoldoutPanel();\n\t    },\n\t\n\t//TODO:?? override to exclude foldout scope?\n\t    //$ : function( selector ){\n\t    //    var $found = ListItemView.prototype.$.call( this, selector );\n\t    //    return $found;\n\t    //},\n\t\n\t    /** in this override, attach the foldout panel when rendering details */\n\t    _renderDetails : function(){\n\t//TODO: hackish\n\t        if( this.foldoutStyle === 'drilldown' ){ return $(); }\n\t        var $newDetails = ListItemView.prototype._renderDetails.call( this );\n\t        return this._attachFoldout( this.foldout, $newDetails );\n\t    },\n\t\n\t    /** In this override, handle collection expansion. */\n\t    _createFoldoutPanel : function(){\n\t        var model = this.model;\n\t        var FoldoutClass = this._getFoldoutPanelClass( model ),\n\t            options = this._getFoldoutPanelOptions( model ),\n\t            foldout = new FoldoutClass( _.extend( options, {\n\t                model           : model\n\t            }));\n\t        return foldout;\n\t    },\n\t\n\t    /** Stub to return proper foldout panel class */\n\t    _getFoldoutPanelClass : function(){\n\t        // override\n\t        return this.foldoutPanelClass;\n\t    },\n\t\n\t    /** Stub to return proper foldout panel options */\n\t    _getFoldoutPanelOptions : function(){\n\t        return {\n\t            // propagate foldout style down\n\t            foldoutStyle : this.foldoutStyle,\n\t            fxSpeed      : this.fxSpeed\n\t        };\n\t    },\n\t\n\t    /** Render the foldout panel inside the view, hiding controls */\n\t    _attachFoldout : function( foldout, $whereTo ){\n\t        $whereTo = $whereTo || this.$( '> .details' );\n\t        this.foldout = foldout.render( 0 );\n\t//TODO: hack\n\t        foldout.$( '> .controls' ).hide();\n\t        return $whereTo.append( foldout.$el );\n\t    },\n\t\n\t    /** In this override, branch on foldoutStyle to show expanded */\n\t    expand : function(){\n\t        var view = this;\n\t        return view._fetchModelDetails()\n\t            .always(function(){\n\t                if( view.foldoutStyle === 'foldout' ){\n\t                    view._expand();\n\t                } else if( view.foldoutStyle === 'drilldown' ){\n\t                    view._expandByDrilldown();\n\t                }\n\t            });\n\t    },\n\t\n\t    /** For drilldown, set up close handler and fire expanded:drilldown\n\t     *      containing views can listen to this and handle other things\n\t     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n\t     */\n\t    _expandByDrilldown : function(){\n\t        var view = this;\n\t        // attachment and rendering done by listener\n\t        view.foldout.on( 'close', function(){\n\t            view.trigger( 'collapsed:drilldown', view, view.foldout );\n\t        });\n\t        view.trigger( 'expanded:drilldown', view, view.foldout );\n\t    }\n\t\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tFoldoutListItemView.prototype.templates = (function(){\n\t\n\t//TODO:?? unnecessary?\n\t    // use element identifier\n\t    var detailsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"details\">',\n\t            // override with more info (that goes above the panel)\n\t        '</div>'\n\t    ], 'collection' );\n\t\n\t    return _.extend( {}, ListItemView.prototype.templates, {\n\t        details : detailsTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        ExpandableView                  : ExpandableView,\n\t        ListItemView                    : ListItemView,\n\t        FoldoutListItemView             : FoldoutListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 20 */,\n/* 21 */,\n/* 22 */,\n/* 23 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\t\n\t/** Masthead **/\n\tvar GalaxyMasthead = Backbone.View.extend({\n\t    // base element\n\t    el_masthead: '#everything',\n\t    \n\t    // options\n\t    options : null,\n\t    \n\t    // background\n\t    $background: null,\n\t    \n\t    // list\n\t    list: [],\n\t    \n\t    // initialize\n\t    initialize : function(options) {\n\t        // update options\n\t        this.options = options;\n\t    \n\t        // HACK: due to body events defined in galaxy.panels.js\n\t        $(\"body\").off();\n\t    \n\t        // define this element\n\t        this.setElement($(this._template(options)));\n\t        \n\t        // append to masthead\n\t        $(this.el_masthead).append($(this.el));\n\t        \n\t        // assign background\n\t        this.$background = $(this.el).find('#masthead-background');\n\t        \n\t        // loop through unload functions if the user attempts to unload the page\n\t        var self = this;\n\t        $(window).on('beforeunload', function() {\n\t            var text = \"\";\n\t            for (key in self.list) {\n\t                if (self.list[key].options.onunload) {\n\t                    var q = self.list[key].options.onunload();\n\t                    if (q) text += q + \" \";\n\t                }\n\t            }\n\t            if (text != \"\") {\n\t                return text;\n\t            }\n\t        });\n\t    },\n\t\n\t    // configure events\n\t    events: {\n\t        'click'     : '_click',\n\t        'mousedown' : function(e) { e.preventDefault() }\n\t    },\n\t\n\t    // adds a new item to the masthead\n\t    append : function(item) {\n\t        return this._add(item, true);\n\t    },\n\t    \n\t    // adds a new item to the masthead\n\t    prepend : function(item) {\n\t        return this._add(item, false);\n\t    },\n\t    \n\t    // activate\n\t    highlight: function(id) {\n\t        var current = $(this.el).find('#' + id + '> li');\n\t        if (current) {\n\t            current.addClass('active');\n\t        }\n\t    },\n\t    \n\t    // adds a new item to the masthead\n\t    _add : function(item, append) {\n\t        var $loc = $(this.el).find('#' + item.location);\n\t        if ($loc){\n\t            // create frame for new item\n\t            var $current = $(item.el);\n\t            \n\t            // configure class in order to mark new items\n\t            $current.addClass('masthead-item');\n\t            \n\t            // append to masthead\n\t            if (append) {\n\t                $loc.append($current);\n\t            } else {\n\t                $loc.prepend($current);\n\t            }\n\t            \n\t            // add to list\n\t            this.list.push(item);\n\t        }\n\t        \n\t        // location not found\n\t        return null;\n\t    },\n\t\n\t    // handle click event\n\t    _click: function(e) {\n\t        // close all popups\n\t        var $all = $(this.el).find('.popup');\n\t        if ($all) {\n\t            $all.hide();\n\t        }\n\t        \n\t        // open current item\n\t        var $current = $(e.target).closest('.masthead-item').find('.popup');\n\t        if ($(e.target).hasClass('head')) {\n\t            $current.show();\n\t            this.$background.show();\n\t        } else {\n\t            this.$background.hide();\n\t        }\n\t    },\n\t    \n\t    /*\n\t        HTML TEMPLATES\n\t    */\n\t    \n\t    // fill template\n\t    _template: function(options) {\n\t        var brand_text = options.brand ? (\"/ \" + options.brand) : \"\" ;\n\t        return  '<div><div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n\t                    '<div style=\"position: relative; right: -50%; float: left;\">' +\n\t                        '<div id=\"navbar\" style=\"display: block; position: relative; right: 50%;\"></div>' +\n\t                    '</div>' +\n\t                   '<div class=\"navbar-brand\">' +\n\t                        '<a href=\"' + options.logo_url + '\">' +\n\t                            '<img style=\"margin-left: 0.35em;\" border=\"0\" src=\"' + galaxy_config.root + 'static/images/galaxyIcon_noText.png\">' +\n\t                            '<span id=\"brand\"> Galaxy ' + brand_text + '</span>' +\n\t                        '</a>' +\n\t                    '</div>' +\n\t                    '<div class=\"quota-meter-container\"></div>' +\n\t                    '<div id=\"iconbar\" class=\"iconbar\"></div>' +\n\t                '</div>' +\n\t                '<div id=\"masthead-background\" style=\"display: none; position: absolute; top: 33px; width: 100%; height: 100%; z-index: 1010\"></div>' +\n\t                '</div>';\n\t    }\n\t});\n\t\n\t/** Masthead icon **/\n\tvar GalaxyMastheadIcon = Backbone.View.extend({\n\t    // icon options\n\t    options:{\n\t        id              : '',\n\t        icon            : 'fa-cog',\n\t        tooltip         : '',\n\t        with_number     : false,\n\t        onclick         : function() { alert ('clicked') },\n\t        onunload        : null,\n\t        visible         : true\n\t    },\n\t    \n\t    // location identifier for masthead class\n\t    location: 'iconbar',\n\t    \n\t    // initialize\n\t    initialize: function (options){\n\t        // read in defaults\n\t        if (options)\n\t            this.options = _.defaults(options, this.options);\n\t        \n\t        // add template for icon\n\t        this.setElement($(this._template(this.options)));\n\t        \n\t        // configure icon\n\t        var self = this;\n\t        $(this.el).find('.icon').tooltip({title: this.options.tooltip, placement: 'bottom'})\n\t                                .on('mouseup', self.options.onclick);\n\t        \n\t        // visiblity\n\t        if (!this.options.visible)\n\t            this.hide();\n\t    },\n\t    \n\t    // show\n\t    show: function(){\n\t        $(this.el).css({visibility : 'visible'});\n\t    },\n\t        \n\t    // show\n\t    hide: function(){\n\t        $(this.el).css({visibility : 'hidden'});\n\t    },\n\t    \n\t    // switch icon\n\t    icon: function (new_icon){\n\t        // update icon class\n\t        $(this.el).find('.icon').removeClass(this.options.icon)\n\t                                .addClass(new_icon);\n\t                                \n\t        // update icon\n\t        this.options.icon = new_icon;\n\t    },\n\t    \n\t    // toggle\n\t    toggle: function(){\n\t        $(this.el).addClass('toggle');\n\t    },\n\t    \n\t    // untoggle\n\t    untoggle: function(){\n\t        $(this.el).removeClass('toggle');\n\t    },\n\t    \n\t    // set/get number\n\t    number: function(new_number){\n\t        $(this.el).find('.number').text(new_number);\n\t    },\n\t    \n\t    // fill template icon\n\t    _template: function (options){\n\t        var tmpl =  '<div id=\"' + options.id + '\" class=\"symbol\">' +\n\t                        '<div class=\"icon fa fa-2x ' + options.icon + '\"></div>';\n\t        if (options.with_number)\n\t            tmpl+=      '<div class=\"number\"></div>';\n\t        tmpl +=     '</div>';\n\t        \n\t        // return template\n\t        return tmpl;\n\t    }\n\t});\n\t\n\t/** Masthead tab **/\n\tvar GalaxyMastheadTab = Backbone.View.extend({\n\t    // main options\n\t    options:{\n\t        id              : '',\n\t        title           : '',\n\t        target          : '_parent',\n\t        content         : '',\n\t        type            : 'url',\n\t        scratchbook     : false,\n\t        onunload        : null,\n\t        visible         : true,\n\t        disabled        : false,\n\t        title_attribute : ''\n\t    },\n\t    \n\t    // location\n\t    location: 'navbar',\n\t    \n\t    // optional sub menu\n\t    $menu: null,\n\t    \n\t    // events\n\t    events:{\n\t        'click .head' : '_head'\n\t    },\n\t    \n\t    // initialize\n\t    initialize: function ( options ){\n\t        // read in defaults\n\t        if ( options ){\n\t            this.options = _.defaults( options, this.options );\n\t        }\n\t   \n\t        // update url\n\t        if ( this.options.content !== undefined && this.options.content.indexOf( '//' ) === -1 ){\n\t            this.options.content = galaxy_config.root + this.options.content;\n\t        } \n\t        \n\t        // add template for tab\n\t        this.setElement( $( this._template( this.options ) ) );\n\t        \n\t        // disable menu items that are not available to anonymous user\n\t        // also show title to explain why they are disabled\n\t        if ( this.options.disabled ){\n\t            $( this.el ).find( '.root' ).addClass( 'disabled' );\n\t            this._attachPopover();\n\t        }\n\t\n\t        // visiblity\n\t        if ( !this.options.visible ){\n\t            this.hide();\n\t        }\n\t    },\n\t    \n\t    // show\n\t    show: function(){\n\t        $(this.el).css({visibility : 'visible'});\n\t    },\n\t        \n\t    // show\n\t    hide: function(){\n\t        $(this.el).css({visibility : 'hidden'});\n\t    },\n\t    \n\t    // add menu item\n\t    add: function (options){\n\t        // menu option defaults\n\t        var menuOptions = {\n\t            title       : 'Title',\n\t            content     : '',\n\t            type        : 'url',\n\t            target      : '_parent',\n\t            scratchbook : false,\n\t            divider     : false\n\t        }\n\t    \n\t        // read in defaults\n\t        if (options)\n\t            menuOptions = _.defaults(options, menuOptions);\n\t        \n\t        // update url\n\t        if (menuOptions.content && menuOptions.content.indexOf('//') === -1)\n\t            menuOptions.content = galaxy_config.root + menuOptions.content;\n\t        \n\t        // check if submenu element is available\n\t        if (!this.$menu){\n\t            // insert submenu element into root\n\t            $(this.el).find('.root').append(this._templateMenu());\n\t            \n\t            // show caret\n\t            $(this.el).find('.symbol').addClass('caret');\n\t            \n\t            // update element link\n\t            this.$menu = $(this.el).find('.popup');\n\t        }\n\t        \n\t        // create\n\t        var $item = $(this._templateMenuItem(menuOptions));\n\t        \n\t        // append menu\n\t        this.$menu.append($item);\n\t        \n\t        // add events\n\t        var self = this;\n\t        $item.on('click', function(e){\n\t            // prevent default\n\t            e.preventDefault();\n\t        \n\t            // no modifications if new tab is requested\n\t            if (self.options.target === '_blank')\n\t                return true;\n\t            \n\t            // load into frame\n\t            Galaxy.frame.add(options);\n\t        });\n\t        \n\t        // append divider\n\t        if (menuOptions.divider)\n\t            this.$menu.append($(this._templateDivider()));\n\t    },\n\t    \n\t    // show menu on header click\n\t    _head: function(e){\n\t        // prevent default\n\t        e.preventDefault();\n\t        \n\t        if (this.options.disabled){\n\t            return // prevent link following if menu item is disabled\n\t        }\n\t\n\t        // check for menu options\n\t        if (!this.$menu) {\n\t            Galaxy.frame.add(this.options); \n\t        }\n\t    },\n\t\n\t    _attachPopover : function(){\n\t        var $popover_element = $(this.el).find('.head');\n\t        $popover_element.popover({\n\t            html: true,\n\t            content: 'Please <a href=\"' + galaxy_config.root + 'user/login?use_panels=True\">log in</a> or <a href=\"' + galaxy_config.root + 'user/create?use_panels=True\">register</a> to use this feature.',\n\t            placement: 'bottom'\n\t        }).on('shown.bs.popover', function() { // hooking on bootstrap event to automatically hide popovers after delay\n\t            setTimeout(function() {\n\t                $popover_element.popover('hide');\n\t            }, 5000);\n\t        });\n\t     },\n\t\n\t    // fill template header\n\t    _templateMenuItem: function (options){\n\t        return '<li><a href=\"' + options.content + '\" target=\"' + options.target + '\">' + options.title + '</a></li>';\n\t    },\n\t    \n\t    // fill template header\n\t    _templateMenu: function (){\n\t        return '<ul class=\"popup dropdown-menu\"></ul>';\n\t    },\n\t    \n\t    _templateDivider: function(){\n\t        return '<li class=\"divider\"></li>';\n\t    },\n\t    \n\t    // fill template\n\t    _template: function (options){\n\t        // start template\n\t        var tmpl =  '<ul id=\"' + options.id + '\" class=\"nav navbar-nav\" border=\"0\" cellspacing=\"0\">' +\n\t                        '<li class=\"root dropdown\" style=\"\">' +\n\t                            '<a class=\"head dropdown-toggle\" data-toggle=\"dropdown\" target=\"' + options.target + '\" href=\"' + options.content + '\" title=\"' + options.title_attribute + '\">' +\n\t                                options.title + '<b class=\"symbol\"></b>' +\n\t                            '</a>' +\n\t                        '</li>' +\n\t                    '</ul>';\n\t        \n\t        // return template\n\t        return tmpl;\n\t    }\n\t});\n\t\n\t// return\n\treturn {\n\t    GalaxyMasthead: GalaxyMasthead,\n\t    GalaxyMastheadTab: GalaxyMastheadTab,\n\t    GalaxyMastheadIcon: GalaxyMastheadIcon\n\t};\n\t\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 24 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    //jquery\n\t    //backbone\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(){\n\t// =============================================================================\n\t/**\n\t * view for a popup menu\n\t */\n\tvar PopupMenu = Backbone.View.extend({\n\t//TODO: maybe better as singleton off the Galaxy obj\n\t    /** Cache the desired button element and options, set up the button click handler\n\t     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n\t     */\n\t    initialize: function( $button, options ){\n\t        // default settings\n\t        this.$button = $button;\n\t        if( !this.$button.size() ){\n\t            this.$button = $( '<div/>' );\n\t        }\n\t        this.options = options || [];\n\t\n\t        // set up button click -> open menu behavior\n\t        var menu = this;\n\t        this.$button.click( function( event ){\n\t            // if there's already a menu open, remove it\n\t            $( '.popmenu-wrapper' ).remove();\n\t            menu._renderAndShow( event );\n\t            return false;\n\t        });\n\t    },\n\t\n\t    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n\t    _renderAndShow: function( clickEvent ){\n\t        this.render();\n\t        this.$el.appendTo( 'body' ).css( this._getShownPosition( clickEvent )).show();\n\t        this._setUpCloseBehavior();\n\t    },\n\t\n\t    // render the menu\n\t    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n\t    render: function(){\n\t        // render the menu body absolute and hidden, fill with template\n\t        this.$el.addClass( 'popmenu-wrapper' ).hide()\n\t            .css({ position : 'absolute' })\n\t            .html( this.template( this.$button.attr( 'id' ), this.options ));\n\t\n\t        // set up behavior on each link/anchor elem\n\t        if( this.options.length ){\n\t            var menu = this;\n\t            //precondition: there should be one option per li\n\t            this.$el.find( 'li' ).each( function( i, li ){\n\t                var option = menu.options[i];\n\t\n\t                // if the option has 'func', call that function when the anchor is clicked\n\t                if( option.func ){\n\t                    $( this ).children( 'a.popupmenu-option' ).click( function( event ){\n\t                        option.func.call( menu, event, option );\n\t                        // We must preventDefault otherwise clicking \"cancel\"\n\t                        // on a purge or something still navigates and causes\n\t                        // the action.\n\t                        event.preventDefault();\n\t                        // bubble up so that an option click will call the close behavior\n\t                    });\n\t                }\n\t            });\n\t        }\n\t        return this;\n\t    },\n\t\n\t    template : function( id, options ){\n\t        return [\n\t            '<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions( options ), '</ul>'\n\t        ].join( '' );\n\t    },\n\t\n\t    _templateOptions : function( options ){\n\t        if( !options.length ){\n\t            return '<li>(no options)</li>';\n\t        }\n\t        return _.map( options, function( option ){\n\t            if( option.divider ){\n\t                return '<li class=\"divider\"></li>';\n\t            } else if( option.header ){\n\t                return [ '<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, '</a></li>' ].join( '' );\n\t            }\n\t            var href   = option.href || 'javascript:void(0);',\n\t                target = ( option.target  )?( ' target=\"' + option.target + '\"' ):( '' ),\n\t                check  = ( option.checked )?( '<span class=\"fa fa-check\"></span>' ):( '' );\n\t            return [\n\t                '<li><a class=\"popupmenu-option\" href=\"', href, '\"', target, '>',\n\t                    check, option.html,\n\t                '</a></li>'\n\t            ].join( '' );\n\t        }).join( '' );\n\t    },\n\t\n\t    // get the absolute position/offset for the menu\n\t    _getShownPosition : function( clickEvent ){\n\t\n\t        // display menu horiz. centered on click...\n\t        var menuWidth = this.$el.width();\n\t        var x = clickEvent.pageX - menuWidth / 2 ;\n\t\n\t        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n\t        x = Math.min( x, $( document ).scrollLeft() + $( window ).width() - menuWidth - 5 );\n\t        x = Math.max( x, $( document ).scrollLeft() + 5 );\n\t        return {\n\t            top: clickEvent.pageY,\n\t            left: x\n\t        };\n\t    },\n\t\n\t    // bind an event handler to all available frames so that when anything is clicked\n\t    // the menu is removed from the DOM and the event handler unbinds itself\n\t    _setUpCloseBehavior: function(){\n\t        var menu = this;\n\t//TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\t\n\t        // function to close popup and unbind itself\n\t        function closePopup( event ){\n\t            $( document ).off( 'click.close_popup' );\n\t            if( window.parent !== window ){\n\t                try {\n\t                    $( window.parent.document ).off( \"click.close_popup\" );\n\t                } catch( err ){}\n\t            } else {\n\t                try {\n\t                    $( 'iframe#galaxy_main' ).contents().off( \"click.close_popup\" );\n\t                } catch( err ){}\n\t            }\n\t            menu.remove();\n\t        }\n\t\n\t        $( 'html' ).one( \"click.close_popup\", closePopup );\n\t        if( window.parent !== window ){\n\t            try {\n\t                $( window.parent.document ).find( 'html' ).one( \"click.close_popup\", closePopup );\n\t            } catch( err ){}\n\t        } else {\n\t            try {\n\t                $( 'iframe#galaxy_main' ).contents().one( \"click.close_popup\", closePopup );\n\t            } catch( err ){}\n\t        }\n\t    },\n\t\n\t    // add a menu option/item at the given index\n\t    addItem: function( item, index ){\n\t        // append to end if no index\n\t        index = ( index >= 0 ) ? index : this.options.length;\n\t        this.options.splice( index, 0, item );\n\t        return this;\n\t    },\n\t\n\t    // remove a menu option/item at the given index\n\t    removeItem: function( index ){\n\t        if( index >=0 ){\n\t            this.options.splice( index, 1 );\n\t        }\n\t        return this;\n\t    },\n\t\n\t    // search for a menu option by its html\n\t    findIndexByHtml: function( html ){\n\t        for( var i = 0; i < this.options.length; i++ ){\n\t            if( _.has( this.options[i], 'html' ) && ( this.options[i].html === html )){\n\t                return i;\n\t            }\n\t        }\n\t        return null;\n\t    },\n\t\n\t    // search for a menu option by its html\n\t    findItemByHtml: function( html ){\n\t        return this.options[( this.findIndexByHtml( html ))];\n\t    },\n\t\n\t    // string representation\n\t    toString: function(){\n\t        return 'PopupMenu';\n\t    }\n\t});\n\t/** shortcut to new for when you don't need to preserve the ref */\n\tPopupMenu.create = function _create( $button, options ){\n\t    return new PopupMenu( $button, options );\n\t};\n\t\n\t// -----------------------------------------------------------------------------\n\t// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n\t// to the newer backbone.js PopupMenu\n\t\n\t/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n\t *      Converts initial_options to object array used by PopupMenu.\n\t *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n\t *  @param {Object} initial_options map of key -> values, where\n\t *      key is option text, value is fn to call when option is clicked\n\t *  @returns {PopupMenu} the PopupMenu created\n\t */\n\tPopupMenu.make_popupmenu = function( button_element, initial_options ){\n\t    var convertedOptions = [];\n\t    _.each( initial_options, function( optionVal, optionKey ){\n\t        var newOption = { html: optionKey };\n\t\n\t        // keys with null values indicate: header\n\t        if( optionVal === null ){ // !optionVal? (null only?)\n\t            newOption.header = true;\n\t\n\t        // keys with function values indicate: a menu option\n\t        } else if( jQuery.type( optionVal ) === 'function' ){\n\t            newOption.func = optionVal;\n\t        }\n\t        //TODO:?? any other special optionVals?\n\t        // there was no divider option originally\n\t        convertedOptions.push( newOption );\n\t    });\n\t    return new PopupMenu( $( button_element ), convertedOptions );\n\t};\n\t\n\t/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n\t *  @param {jQuery} $parent the element that contains the links to convert to options\n\t *  @param {String} selector jq selector string to find links\n\t *  @returns {Object[]} the options array to initialize a PopupMenu\n\t */\n\t//TODO: lose parent and selector, pass in array of links, use map to return options\n\tPopupMenu.convertLinksToOptions = function( $parent, selector ){\n\t    $parent = $( $parent );\n\t    selector = selector || 'a';\n\t    var options = [];\n\t    $parent.find( selector ).each( function( elem, i ){\n\t        var option = {}, $link = $( elem );\n\t\n\t        // convert link text to the option text (html) and the href into the option func\n\t        option.html = $link.text();\n\t        if( $link.attr( 'href' ) ){\n\t            var linkHref    = $link.attr( 'href' ),\n\t                linkTarget  = $link.attr( 'target' ),\n\t                confirmText = $link.attr( 'confirm' );\n\t\n\t            option.func = function(){\n\t                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n\t                //  if the user cancels - do nothing\n\t                if( ( confirmText ) && ( !confirm( confirmText ) ) ){ return; }\n\t\n\t                // if there's no confirm attribute, or the user accepted the confirm dialog:\n\t                switch( linkTarget ){\n\t                    // relocate the center panel\n\t                    case '_parent':\n\t                        window.parent.location = linkHref;\n\t                        break;\n\t\n\t                    // relocate the entire window\n\t                    case '_top':\n\t                        window.top.location = linkHref;\n\t                        break;\n\t\n\t                    // relocate this panel\n\t                    default:\n\t                        window.location = linkHref;\n\t                }\n\t            };\n\t        }\n\t        options.push( option );\n\t    });\n\t    return options;\n\t};\n\t\n\t/** Create a single popupmenu from existing DOM button and anchor elements\n\t *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n\t *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n\t *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n\t *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n\t */\n\tPopupMenu.fromExistingDom = function( $buttonElement, $menuElement, menuElementLinkSelector ){\n\t    $buttonElement = $( $buttonElement );\n\t    $menuElement = $( $menuElement );\n\t    var options = PopupMenu.convertLinksToOptions( $menuElement, menuElementLinkSelector );\n\t    // we're done with the menu (having converted it to an options map)\n\t    $menuElement.remove();\n\t    return new PopupMenu( $buttonElement, options );\n\t};\n\t\n\t/** Create all popupmenus within a document or a more specific element\n\t *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n\t *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n\t *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n\t *      Will be passed $menuElement, parent.\n\t *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n\t *  @returns {PopupMenu[]} array of popupmenus created\n\t */\n\tPopupMenu.make_popup_menus = function( parent, menuSelector, buttonSelectorBuildFn ){\n\t    parent = parent || document;\n\t    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n\t    //  which contains the id of the button that activates the menu\n\t    menuSelector = menuSelector || 'div[popupmenu]';\n\t    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n\t    buttonSelectorBuildFn = buttonSelectorBuildFn || function( $menuElement, parent ){\n\t        return '#' + $menuElement.attr( 'popupmenu' );\n\t    };\n\t\n\t    // aggregate and return all PopupMenus\n\t    var popupMenusCreated = [];\n\t    $( parent ).find( menuSelector ).each( function(){\n\t        var $menuElement    = $( this ),\n\t            $buttonElement  = $( parent ).find( buttonSelectorBuildFn( $menuElement, parent ) );\n\t        popupMenusCreated.push( PopupMenu.fromDom( $buttonElement, $menuElement ) );\n\t        $buttonElement.addClass( 'popup' );\n\t    });\n\t    return popupMenusCreated;\n\t};\n\t\n\t\n\t// =============================================================================\n\t    return PopupMenu;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t\n\n\n/***/ },\n/* 25 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(){\n\t//==============================================================================\n\tfunction addLogging( obj, namespace ){\n\t    var addTo = ( obj.prototype !== undefined )?( obj.prototype ):( obj );\n\t    if( namespace !== undefined ){\n\t        addTo._logNamespace = namespace;\n\t    }\n\t\n\t    [ 'debug', 'info', 'warn', 'error', 'metric' ].forEach( function( logFn ){\n\t        addTo[ logFn ] = function(){\n\t            if( !this.logger ){ return undefined; }\n\t            if( this.logger.emit ){\n\t                return this.logger.emit( logFn, this._logNamespace, arguments );\n\t            }\n\t            if( this.logger[ logFn ] ){\n\t//TODO:! there has to be a way to get the lineno/file into this\n\t// http://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number\n\t// http://www.paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/\n\t                return this.logger[ logFn ].apply( this.logger, arguments );\n\t            }\n\t            return undefined;\n\t        };\n\t    });\n\t    return obj;\n\t}\n\t\n\t//==============================================================================\n\treturn addLogging;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 26 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( baseMVC, _l ){\n\t// =============================================================================\n\t/** A view on any model that has a 'annotation' attribute\n\t */\n\tvar AnnotationEditor = Backbone.View\n\t        .extend( baseMVC.LoggableMixin )\n\t        .extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n\t\n\t    tagName     : 'div',\n\t    className   : 'annotation-display',\n\t\n\t    /** Set up listeners, parse options */\n\t    initialize : function( options ){\n\t        options = options || {};\n\t        this.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\t        //console.debug( this, options );\n\t        // only listen to the model only for changes to annotations\n\t        this.listenTo( this.model, 'change:annotation', function(){\n\t            this.render();\n\t        });\n\t        this.hiddenUntilActivated( options.$activator, options );\n\t    },\n\t\n\t    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n\t    render : function(){\n\t        var view = this;\n\t        this.$el.html( this._template() );\n\t        this.$el.find( \"[title]\" ).tooltip( this.tooltipConfig );\n\t\n\t        //TODO: handle empties better\n\t        this.$annotation().make_text_editable({\n\t            use_textarea: true,\n\t            on_finish: function( newAnnotation ){\n\t                view.$annotation().text( newAnnotation );\n\t                view.model.save({ annotation: newAnnotation }, { silent: true })\n\t                    .fail( function(){\n\t                        view.$annotation().text( view.model.previous( 'annotation' ) );\n\t                    });\n\t            }\n\t        });\n\t        return this;\n\t    },\n\t\n\t    /** @returns {String} the html text used to build the view's DOM */\n\t    _template : function(){\n\t        var annotation = this.model.get( 'annotation' );\n\t        //if( !annotation ){\n\t        //    //annotation = [ '<em class=\"annotation-empty\">', _l( 'Click to add an annotation' ), '</em>' ].join( '' );\n\t        //    annotation = [ '<em class=\"annotation-empty\"></em>' ].join( '' );\n\t        //}\n\t        return [\n\t            //TODO: make prompt optional\n\t            '<label class=\"prompt\">', _l( 'Annotation' ), '</label>',\n\t            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n\t            '<div class=\"annotation\" title=\"', _l( 'Edit annotation' ), '\">',\n\t                _.escape( annotation ),\n\t            '</div>'\n\t        ].join( '' );\n\t    },\n\t\n\t    /** @returns {jQuery} the main element for this view */\n\t    $annotation : function(){\n\t        return this.$el.find( '.annotation' );\n\t    },\n\t\n\t    /** shut down event listeners and remove this view's DOM */\n\t    remove : function(){\n\t        this.$annotation.off();\n\t        this.stopListening( this.model );\n\t        Backbone.View.prototype.remove.call( this );\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){ return [ 'AnnotationEditor(', this.model + '', ')' ].join(''); }\n\t});\n\t// =============================================================================\n\treturn {\n\t    AnnotationEditor : AnnotationEditor\n\t};\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 27 */,\n/* 28 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(6),\n\t    __webpack_require__(15),\n\t    __webpack_require__(35),\n\t    __webpack_require__(26),\n\t    __webpack_require__(7),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( STATES, DATASET_LI, TAGS, ANNOTATIONS, faIconButton, BASE_MVC, _l ){\n\t//==============================================================================\n\tvar _super = DATASET_LI.DatasetListItemView;\n\t/** @class Editing view for DatasetAssociation.\n\t */\n\tvar DatasetListItemEdit = _super.extend(\n\t/** @lends DatasetListItemEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** set up: options */\n\t    initialize  : function( attributes ){\n\t        _super.prototype.initialize.call( this, attributes );\n\t//TODO: shouldn't this err if false?\n\t        this.hasUser = attributes.hasUser;\n\t\n\t        /** allow user purge of dataset files? */\n\t        this.purgeAllowed = attributes.purgeAllowed || false;\n\t\n\t        //TODO: move to HiddenUntilActivatedViewMixin\n\t        /** should the tags editor be shown or hidden initially? */\n\t        this.tagsEditorShown        = attributes.tagsEditorShown || false;\n\t        /** should the tags editor be shown or hidden initially? */\n\t        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n\t    },\n\t\n\t    // ......................................................................... titlebar actions\n\t    /** In this override, add the other two primary actions: edit and delete */\n\t    _renderPrimaryActions : function(){\n\t        var actions = _super.prototype._renderPrimaryActions.call( this );\n\t        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n\t            return actions;\n\t        }\n\t        // render the display, edit attr and delete icon-buttons\n\t        return _super.prototype._renderPrimaryActions.call( this ).concat([\n\t            this._renderEditButton(),\n\t            this._renderDeleteButton()\n\t        ]);\n\t    },\n\t\n\t//TODO: move titleButtons into state renderers, remove state checks in the buttons\n\t\n\t    /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n\t    _renderEditButton : function(){\n\t        // don't show edit while uploading, in-accessible\n\t        // DO show if in error (ala previous history panel)\n\t        if( ( this.model.get( 'state' ) === STATES.DISCARDED )\n\t        ||  ( !this.model.get( 'accessible' ) ) ){\n\t            return null;\n\t        }\n\t\n\t        var purged = this.model.get( 'purged' ),\n\t            deleted = this.model.get( 'deleted' ),\n\t            editBtnData = {\n\t                title       : _l( 'Edit attributes' ),\n\t                href        : this.model.urls.edit,\n\t                target      : this.linkTarget,\n\t                faIcon      : 'fa-pencil',\n\t                classes     : 'edit-btn'\n\t            };\n\t\n\t        // disable if purged or deleted and explain why in the tooltip\n\t        if( deleted || purged ){\n\t            editBtnData.disabled = true;\n\t            if( purged ){\n\t                editBtnData.title = _l( 'Cannot edit attributes of datasets removed from disk' );\n\t            } else if( deleted ){\n\t                editBtnData.title = _l( 'Undelete dataset to edit attributes' );\n\t            }\n\t\n\t        // disable if still uploading or new\n\t        } else if( _.contains( [ STATES.UPLOAD, STATES.NEW ], this.model.get( 'state' ) ) ){\n\t            editBtnData.disabled = true;\n\t            editBtnData.title = _l( 'This dataset is not yet editable' );\n\t        }\n\t        return faIconButton( editBtnData );\n\t    },\n\t\n\t    /** Render icon-button to delete this hda. */\n\t    _renderDeleteButton : function(){\n\t        // don't show delete if...\n\t        if( ( !this.model.get( 'accessible' ) ) ){\n\t            return null;\n\t        }\n\t\n\t        var self = this,\n\t            deletedAlready = this.model.isDeletedOrPurged();\n\t        return faIconButton({\n\t                title       : !deletedAlready? _l( 'Delete' ) : _l( 'Dataset is already deleted' ),\n\t                disabled    : deletedAlready,\n\t                faIcon      : 'fa-times',\n\t                classes     : 'delete-btn',\n\t                onclick     : function() {\n\t                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n\t                    self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n\t                    self.model[ 'delete' ]();\n\t                }\n\t        });\n\t    },\n\t\n\t    // ......................................................................... details\n\t    /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n\t    _renderDetails : function(){\n\t        //TODO: generalize to be allow different details for each state\n\t        var $details = _super.prototype._renderDetails.call( this ),\n\t            state = this.model.get( 'state' );\n\t\n\t        if( !this.model.isDeletedOrPurged() && _.contains([ STATES.OK, STATES.FAILED_METADATA ], state ) ){\n\t            this._renderTags( $details );\n\t            this._renderAnnotation( $details );\n\t            this._makeDbkeyEditLink( $details );\n\t        }\n\t\n\t//TODO: TRIPLE tap, ugh.\n\t        this._setUpBehaviors( $details );\n\t        return $details;\n\t    },\n\t\n\t    /** Add less commonly used actions in the details section based on state */\n\t    _renderSecondaryActions : function(){\n\t        var actions = _super.prototype._renderSecondaryActions.call( this );\n\t        switch( this.model.get( 'state' ) ){\n\t            case STATES.UPLOAD:\n\t            case STATES.NEW:\n\t            case STATES.NOT_VIEWABLE:\n\t                return actions;\n\t            case STATES.ERROR:\n\t                // error button comes first\n\t                actions.unshift( this._renderErrButton() );\n\t                return actions.concat([ this._renderRerunButton() ]);\n\t            case STATES.OK:\n\t            case STATES.FAILED_METADATA:\n\t                return actions.concat([ this._renderRerunButton(), this._renderVisualizationsButton() ]);\n\t        }\n\t        return actions.concat([ this._renderRerunButton() ]);\n\t    },\n\t\n\t    /** Render icon-button to report an error on this dataset to the galaxy admin. */\n\t    _renderErrButton : function(){\n\t        return faIconButton({\n\t            title       : _l( 'View or report this error' ),\n\t            href        : this.model.urls.report_error,\n\t            classes     : 'report-error-btn',\n\t            target      : this.linkTarget,\n\t            faIcon      : 'fa-bug'\n\t        });\n\t    },\n\t\n\t    /** Render icon-button to re-run the job that created this dataset. */\n\t    _renderRerunButton : function(){\n\t        var creating_job = this.model.get('creating_job');\n\t        if (this.model.get('rerunnable')){\n\t            return faIconButton({\n\t                title       : _l( 'Run this job again' ),\n\t                href        : this.model.urls.rerun,\n\t                classes     : 'rerun-btn',\n\t                target      : this.linkTarget,\n\t                faIcon      : 'fa-refresh',\n\t                onclick     : function(ev) {\n\t                    ev.preventDefault();\n\t                    // create webpack split point in order to load the tool form async\n\t                    // TODO: split not working (tool loads fine)\n\t                    __webpack_require__.e/* require */(0, function(__webpack_require__) { var __WEBPACK_AMD_REQUIRE_ARRAY__ = [ __webpack_require__(36)]; (function( ToolsForm ){\n\t                        var form = new ToolsForm.View({'job_id' : creating_job});\n\t                        form.deferred.execute(function(){\n\t                            Galaxy.app && Galaxy.app.display(form.$el);\n\t                        });\n\t                    }.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));});\n\t                }\n\t            });\n\t        }\n\t    },\n\t\n\t    /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n\t    _renderVisualizationsButton : function(){\n\t        //TODO: someday - lazyload visualizations\n\t        var visualizations = this.model.get( 'visualizations' );\n\t        if( ( this.model.isDeletedOrPurged() )\n\t        ||  ( !this.hasUser )\n\t        ||  ( !this.model.hasData() )\n\t        ||  ( _.isEmpty( visualizations ) ) ){\n\t            return null;\n\t        }\n\t        if( !_.isObject( visualizations[0] ) ){\n\t            this.warn( 'Visualizations have been switched off' );\n\t            return null;\n\t        }\n\t\n\t        var $visualizations = $( this.templates.visualizations( visualizations, this ) );\n\t        //HACK: need to re-write those directed at galaxy_main with linkTarget\n\t        $visualizations.find( '[target=\"galaxy_main\"]').attr( 'target', this.linkTarget );\n\t        // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n\t        this._addScratchBookFn( $visualizations.find( '.visualization-link' ).addBack( '.visualization-link' ) );\n\t        return $visualizations;\n\t    },\n\t\n\t    /** add scratchbook functionality to visualization links */\n\t    _addScratchBookFn : function( $links ){\n\t        var li = this;\n\t        $links.click( function( ev ){\n\t            if( Galaxy.frame && Galaxy.frame.active ){\n\t                Galaxy.frame.add({\n\t                    title       : \"Visualization\",\n\t                    type        : \"url\",\n\t                    content     : $( this ).attr( 'href' )\n\t                });\n\t                ev.preventDefault();\n\t                ev.stopPropagation();\n\t            }\n\t        });\n\t    },\n\t\n\t//TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n\t    /** Render the tags list/control */\n\t    _renderTags : function( $where ){\n\t        if( !this.hasUser ){ return; }\n\t        var view = this;\n\t        this.tagsEditor = new TAGS.TagsEditor({\n\t            model           : this.model,\n\t            el              : $where.find( '.tags-display' ),\n\t            onshowFirstTime : function(){ this.render(); },\n\t            // persist state on the hda view (and not the editor) since these are currently re-created each time\n\t            onshow          : function(){ view.tagsEditorShown = true; },\n\t            onhide          : function(){ view.tagsEditorShown = false; },\n\t            $activator      : faIconButton({\n\t                title   : _l( 'Edit dataset tags' ),\n\t                classes : 'tag-btn',\n\t                faIcon  : 'fa-tags'\n\t            }).appendTo( $where.find( '.actions .right' ) )\n\t        });\n\t        if( this.tagsEditorShown ){ this.tagsEditor.toggle( true ); }\n\t    },\n\t\n\t    /** Render the annotation display/control */\n\t    _renderAnnotation : function( $where ){\n\t        if( !this.hasUser ){ return; }\n\t        var view = this;\n\t        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n\t            model           : this.model,\n\t            el              : $where.find( '.annotation-display' ),\n\t            onshowFirstTime : function(){ this.render(); },\n\t            // persist state on the hda view (and not the editor) since these are currently re-created each time\n\t            onshow          : function(){ view.annotationEditorShown = true; },\n\t            onhide          : function(){ view.annotationEditorShown = false; },\n\t            $activator      : faIconButton({\n\t                title   : _l( 'Edit dataset annotation' ),\n\t                classes : 'annotate-btn',\n\t                faIcon  : 'fa-comment'\n\t            }).appendTo( $where.find( '.actions .right' ) )\n\t        });\n\t        if( this.annotationEditorShown ){ this.annotationEditor.toggle( true ); }\n\t    },\n\t\n\t    /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n\t    _makeDbkeyEditLink : function( $details ){\n\t        // make the dbkey a link to editing\n\t        if( this.model.get( 'metadata_dbkey' ) === '?'\n\t        &&  !this.model.isDeletedOrPurged() ){\n\t            var editableDbkey = $( '<a class=\"value\">?</a>' )\n\t                .attr( 'href', this.model.urls.edit )\n\t                .attr( 'target', this.linkTarget );\n\t            $details.find( '.dbkey .value' ).replaceWith( editableDbkey );\n\t        }\n\t    },\n\t\n\t    // ......................................................................... events\n\t    /** event map */\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        'click .undelete-link'  : '_clickUndeleteLink',\n\t        'click .purge-link'     : '_clickPurgeLink',\n\t\n\t        'click .edit-btn'       : function( ev ){ this.trigger( 'edit', this, ev ); },\n\t        'click .delete-btn'     : function( ev ){ this.trigger( 'delete', this, ev ); },\n\t        'click .rerun-btn'      : function( ev ){ this.trigger( 'rerun', this, ev ); },\n\t        'click .report-err-btn' : function( ev ){ this.trigger( 'report-err', this, ev ); },\n\t        'click .visualization-btn' : function( ev ){ this.trigger( 'visualize', this, ev ); },\n\t        'click .dbkey a'        : function( ev ){ this.trigger( 'edit', this, ev ); }\n\t    }),\n\t\n\t\n\t    /** listener for item undelete (in the messages section) */\n\t    _clickUndeleteLink : function( ev ){\n\t        this.model.undelete();\n\t        return false;\n\t    },\n\t\n\t    /** listener for item purge (in the messages section) */\n\t    _clickPurgeLink : function( ev ){\n\t//TODO: confirm dialog\n\t        this.model.purge();\n\t        return false;\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** string rep */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'HDAEditView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDatasetListItemEdit.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n\t        failed_metadata : BASE_MVC.wrapTemplate([\n\t            // in this override, provide a link to the edit page\n\t            '<% if( dataset.state === \"failed_metadata\" ){ %>',\n\t                '<div class=\"failed_metadata-warning warningmessagesmall\">',\n\t                    _l( 'An error occurred setting the metadata for this dataset' ),\n\t                    '<br /><a href=\"<%= dataset.urls.edit %>\" target=\"<%= view.linkTarget %>\">',\n\t                        _l( 'Set it manually or retry auto-detection' ),\n\t                    '</a>',\n\t                '</div>',\n\t            '<% } %>'\n\t        ], 'dataset' ),\n\t\n\t        deleted : BASE_MVC.wrapTemplate([\n\t            // in this override, provide links to undelete or purge the dataset\n\t            '<% if( dataset.deleted && !dataset.purged ){ %>',\n\t                // deleted not purged\n\t                '<div class=\"deleted-msg warningmessagesmall\">',\n\t                    _l( 'This dataset has been deleted' ),\n\t                    '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">', _l( 'Undelete it' ), '</a>',\n\t                    '<% if( view.purgeAllowed ){ %>',\n\t                        '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">',\n\t                            _l( 'Permanently remove it from disk' ),\n\t                        '</a>',\n\t                    '<% } %>',\n\t                '</div>',\n\t            '<% } %>'\n\t        ], 'dataset' )\n\t    });\n\t\n\t    var visualizationsTemplate = BASE_MVC.wrapTemplate([\n\t        '<% if( visualizations.length === 1 ){ %>',\n\t            '<a class=\"visualization-btn visualization-link icon-btn\" href=\"<%= visualizations[0].href %>\"',\n\t                    ' target=\"<%= visualizations[0].target %>\" title=\"', _l( 'Visualize in' ),\n\t                    ' <%= visualizations[0].html %>\">',\n\t                '<span class=\"fa fa-bar-chart-o\"></span>',\n\t            '</a>',\n\t\n\t        '<% } else { %>',\n\t            '<div class=\"visualizations-dropdown dropdown\">',\n\t                '<a class=\"visualization-btn icon-btn\" data-toggle=\"dropdown\" title=\"', _l( 'Visualize' ), '\">',\n\t                    '<span class=\"fa fa-bar-chart-o\"></span>',\n\t                '</a>',\n\t                '<ul class=\"dropdown-menu\" role=\"menu\">',\n\t                    '<% _.each( visualizations, function( visualization ){ %>',\n\t                        '<li><a class=\"visualization-link\" href=\"<%= visualization.href %>\"',\n\t                                ' target=\"<%= visualization.target %>\">',\n\t                            '<%= visualization.html %>',\n\t                        '</a></li>',\n\t                    '<% }); %>',\n\t                '</ul>',\n\t            '</div>',\n\t        '<% } %>'\n\t    ], 'visualizations' );\n\t\n\t    return _.extend( {}, _super.prototype.templates, {\n\t        warnings : warnings,\n\t        visualizations : visualizationsTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        DatasetListItemEdit : DatasetListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 29 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(6),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( STATES, BASE_MVC, _l ){\n\t//==============================================================================\n\tvar searchableMixin = BASE_MVC.SearchableModelMixin;\n\t/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n\t *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n\t *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n\t */\n\tvar DatasetAssociation = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend(\n\t        BASE_MVC.mixin( searchableMixin, /** @lends DatasetAssociation.prototype */{\n\t\n\t    /** default attributes for a model */\n\t    defaults : {\n\t        state               : STATES.NEW,\n\t        deleted             : false,\n\t        purged              : false,\n\t\n\t        // unreliable attribute\n\t        name                : '(unnamed dataset)',\n\t\n\t//TODO: update to false when this is correctly passed from the API (when we have a security model for this)\n\t        accessible          : true,\n\t\n\t        // sniffed datatype (sam, tabular, bed, etc.)\n\t        data_type           : '',\n\t        file_ext            : '',\n\t\n\t        // size in bytes\n\t        file_size           : 0,\n\t\n\t        // array of associated file types (eg. [ 'bam_index', ... ])\n\t        meta_files          : [],\n\t\n\t        misc_blurb          : '',\n\t        misc_info           : '',\n\t\n\t        tags                : []\n\t        // do NOT default on annotation, as this default is valid and will be passed on 'save'\n\t        //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n\t        //annotation          : ''\n\t    },\n\t\n\t    /** instance vars and listeners */\n\t    initialize : function( attributes, options ){\n\t        this.debug( this + '(Dataset).initialize', attributes, options );\n\t\n\t        //!! this state is not in trans.app.model.Dataset.states - set it here -\n\t        if( !this.get( 'accessible' ) ){\n\t            this.set( 'state', STATES.NOT_VIEWABLE );\n\t        }\n\t\n\t        /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n\t        this.urls = this._generateUrls();\n\t\n\t        this._setUpListeners();\n\t    },\n\t\n\t    /** returns misc. web urls for rendering things like re-run, display, etc. */\n\t    _generateUrls : function(){\n\t//TODO: would be nice if the API did this\n\t        var id = this.get( 'id' );\n\t        if( !id ){ return {}; }\n\t        var urls = {\n\t            'purge'         : 'datasets/' + id + '/purge_async',\n\t            'display'       : 'datasets/' + id + '/display/?preview=True',\n\t            'edit'          : 'datasets/' + id + '/edit',\n\t            'download'      : 'datasets/' + id + '/display?to_ext=' + this.get( 'file_ext' ),\n\t            'report_error'  : 'dataset/errors?id=' + id,\n\t            'rerun'         : 'tool_runner/rerun?id=' + id,\n\t            'show_params'   : 'datasets/' + id + '/show_params',\n\t            'visualization' : 'visualization',\n\t            'meta_download' : 'dataset/get_metadata_file?hda_id=' + id + '&metadata_name='\n\t        };\n\t//TODO: global\n\t        var root = ( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' );\n\t        _.each( urls, function( value, key ){\n\t            urls[ key ] = root + value;\n\t        });\n\t        this.urls = urls;\n\t        return urls;\n\t    },\n\t\n\t    /** set up any event listeners\n\t     *  event: state:ready  fired when this DA moves into/is already in a ready state\n\t     */\n\t    _setUpListeners : function(){\n\t        // if the state has changed and the new state is a ready state, fire an event\n\t        this.on( 'change:state', function( currModel, newState ){\n\t            this.log( this + ' has changed state:', currModel, newState );\n\t            if( this.inReadyState() ){\n\t                this.trigger( 'state:ready', currModel, newState, this.previous( 'state' ) );\n\t            }\n\t        });\n\t        // the download url (currently) relies on having a correct file extension\n\t        this.on( 'change:id change:file_ext', function( currModel ){\n\t            this._generateUrls();\n\t        });\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** override to add urls */\n\t    toJSON : function(){\n\t        var json = Backbone.Model.prototype.toJSON.call( this );\n\t        //console.warn( 'returning json?' );\n\t        //return json;\n\t        return _.extend( json, {\n\t            urls : this.urls\n\t        });\n\t    },\n\t\n\t    /** Is this dataset deleted or purged? */\n\t    isDeletedOrPurged : function(){\n\t        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n\t    },\n\t\n\t    /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n\t     *      processing (for the ds) is left to do on the server.\n\t     */\n\t    inReadyState : function(){\n\t        var ready = _.contains( STATES.READY_STATES, this.get( 'state' ) );\n\t        return ( this.isDeletedOrPurged() || ready );\n\t    },\n\t\n\t    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n\t    hasDetails : function(){\n\t        //?? this may not be reliable\n\t        return _.has( this.attributes, 'genome_build' );\n\t    },\n\t\n\t    /** Convenience function to match dataset.has_data. */\n\t    hasData : function(){\n\t        return ( this.get( 'file_size' ) > 0 );\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t    fetch : function( options ){\n\t        var dataset = this;\n\t        return Backbone.Model.prototype.fetch.call( this, options )\n\t            .always( function(){\n\t                dataset._generateUrls();\n\t            });\n\t    },\n\t\n\t    //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n\t    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n\t    'delete' : function( options ){\n\t        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: true }, options );\n\t    },\n\t    /** save this dataset, _Mark_ing it as undeleted */\n\t    undelete : function( options ){\n\t        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: false }, options );\n\t    },\n\t\n\t    /** remove the file behind this dataset from the filesystem (if permitted) */\n\t    purge : function _purge( options ){\n\t//TODO: use, override model.destroy, HDA.delete({ purge: true })\n\t        if( this.get( 'purged' ) ){ return jQuery.when(); }\n\t        options = options || {};\n\t        //var hda = this,\n\t        //    //xhr = jQuery.ajax( this.url() + '?' + jQuery.param({ purge: true }), _.extend({\n\t        //    xhr = jQuery.ajax( this.url(), _.extend({\n\t        //        type : 'DELETE',\n\t        //        data : {\n\t        //            purge : true\n\t        //        }\n\t        //    }, options ));\n\t        //\n\t        //xhr.done( function( response ){\n\t        //    hda.debug( 'response', response );\n\t        //    //hda.set({ deleted: true, purged: true });\n\t        //    hda.set( response );\n\t        //});\n\t        //return xhr;\n\t\n\t        options.url = this.urls.purge;\n\t\n\t        //TODO: ideally this would be a DELETE call to the api\n\t        //  using purge async for now\n\t        var hda = this,\n\t            xhr = jQuery.ajax( options );\n\t        xhr.done( function( message, status, responseObj ){\n\t            hda.set({ deleted: true, purged: true });\n\t        });\n\t        xhr.fail( function( xhr, status, message ){\n\t            // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n\t            // unbury and re-add to xhr\n\t            var error = _l( \"Unable to purge dataset\" );\n\t            var messageBuriedInUnfortunatelyFormattedError = ( 'Removal of datasets by users '\n\t                + 'is not allowed in this Galaxy instance' );\n\t            if( xhr.responseJSON && xhr.responseJSON.error ){\n\t                error = xhr.responseJSON.error;\n\t            } else if( xhr.responseText.indexOf( messageBuriedInUnfortunatelyFormattedError ) !== -1 ){\n\t                error = messageBuriedInUnfortunatelyFormattedError;\n\t            }\n\t            xhr.responseText = error;\n\t            hda.trigger( 'error', hda, xhr, options, _l( error ), { error: error } );\n\t        });\n\t        return xhr;\n\t    },\n\t\n\t    // ........................................................................ searching\n\t    // see base-mvc, SearchableModelMixin\n\t\n\t    /** what attributes of an HDA will be used in a text search */\n\t    searchAttributes : [\n\t        'name', 'file_ext', 'genome_build', 'misc_blurb', 'misc_info', 'annotation', 'tags'\n\t    ],\n\t\n\t    /** our attr keys don't often match the labels we display to the user - so, when using\n\t     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n\t     *      following attr keys.\n\t     */\n\t    searchAliases : {\n\t        title       : 'name',\n\t        format      : 'file_ext',\n\t        database    : 'genome_build',\n\t        blurb       : 'misc_blurb',\n\t        description : 'misc_blurb',\n\t        info        : 'misc_info',\n\t        tag         : 'tags'\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var nameAndId = this.get( 'id' ) || '';\n\t        if( this.get( 'name' ) ){\n\t            nameAndId = '\"' + this.get( 'name' ) + '\",' + nameAndId;\n\t        }\n\t        return 'Dataset(' + nameAndId + ')';\n\t    }\n\t}));\n\t\n\t\n\t//==============================================================================\n\t/** @class Backbone collection for dataset associations.\n\t */\n\tvar DatasetAssociationCollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n\t/** @lends HistoryContents.prototype */{\n\t    model : DatasetAssociation,\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** root api url */\n\t    urlRoot : (( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' ))\n\t        + 'api/datasets',\n\t\n\t    /** url fn */\n\t    url : function(){\n\t        return this.urlRoot\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** Get the ids of every item in this collection\n\t     *  @returns array of encoded ids\n\t     */\n\t    ids : function(){\n\t        return this.map( function( item ){ return item.get('id'); });\n\t    },\n\t\n\t    /** Get contents that are not ready\n\t     *  @returns array of content models\n\t     */\n\t    notReady : function(){\n\t        return this.filter( function( content ){\n\t            return !content.inReadyState();\n\t        });\n\t    },\n\t\n\t    /** return true if any datasets don't have details */\n\t    haveDetails : function(){\n\t        return this.all( function( dataset ){ return dataset.hasDetails(); });\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t    /** using a queue, perform ajaxFn on each of the models in this collection */\n\t    ajaxQueue : function( ajaxFn, options ){\n\t        var deferred = jQuery.Deferred(),\n\t            startingLength = this.length,\n\t            responses = [];\n\t\n\t        if( !startingLength ){\n\t            deferred.resolve([]);\n\t            return deferred;\n\t        }\n\t\n\t        // use reverse order (stylistic choice)\n\t        var ajaxFns = this.chain().reverse().map( function( dataset, i ){\n\t            return function(){\n\t                var xhr = ajaxFn.call( dataset, options );\n\t                // if successful, notify using the deferred to allow tracking progress\n\t                xhr.done( function( response ){\n\t                    deferred.notify({ curr: i, total: startingLength, response: response, model: dataset });\n\t                });\n\t                // (regardless of previous error or success) if not last ajax call, shift and call the next\n\t                //  if last fn, resolve deferred\n\t                xhr.always( function( response ){\n\t                    responses.push( response );\n\t                    if( ajaxFns.length ){\n\t                        ajaxFns.shift()();\n\t                    } else {\n\t                        deferred.resolve( responses );\n\t                    }\n\t                });\n\t            };\n\t        }).value();\n\t        // start the queue\n\t        ajaxFns.shift()();\n\t\n\t        return deferred;\n\t    },\n\t\n\t    // ........................................................................ sorting/filtering\n\t    /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n\t    matches : function( matchesWhat ){\n\t        return this.filter( function( dataset ){\n\t            return dataset.matches( matchesWhat );\n\t        });\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    ///** Convert this ad-hoc collection of hdas to a formal collection tracked\n\t    //    by the server.\n\t    //**/\n\t    //promoteToHistoryDatasetCollection : function _promote( history, collection_type, options ){\n\t    //},\n\t\n\t    /** String representation. */\n\t    toString : function(){\n\t         return ([ 'DatasetAssociationCollection(', this.length, ')' ].join( '' ));\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        DatasetAssociation              : DatasetAssociation,\n\t        DatasetAssociationCollection    : DatasetAssociationCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 30 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(15),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DATASET_LI, BASE_MVC, _l ){\n\t/* global Backbone */\n\t//==============================================================================\n\tvar _super = DATASET_LI.DatasetListItemView;\n\t/** @class Read only view for HistoryDatasetAssociation.\n\t *      Since there are no controls on the HDAView to hide the dataset,\n\t *      the primary thing this class does (currently) is override templates\n\t *      to render the HID.\n\t */\n\tvar HDAListItemView = _super.extend(\n\t/** @lends HDAListItemView.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    className   : _super.prototype.className + \" history-content\",\n\t\n\t    initialize : function( attributes, options ){\n\t        _super.prototype.initialize.call( this, attributes, options );\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'HDAListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tHDAListItemView.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding the hid display to the title\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t            '<span class=\"state-icon\"></span>',\n\t            '<div class=\"title\">',\n\t                //TODO: remove whitespace and use margin-right\n\t                '<span class=\"hid\"><%- dataset.hid %></span> ',\n\t                '<span class=\"name\"><%- dataset.name %></span>',\n\t            '</div>',\n\t        '</div>'\n\t    ], 'dataset' );\n\t\n\t    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n\t        hidden : BASE_MVC.wrapTemplate([\n\t            // add a warning when hidden\n\t            '<% if( !dataset.visible ){ %>',\n\t                '<div class=\"hidden-msg warningmessagesmall\">',\n\t                    _l( 'This dataset has been hidden' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ], 'dataset' )\n\t    });\n\t\n\t    return _.extend( {}, _super.prototype.templates, {\n\t        titleBar : titleBarTemplate,\n\t        warnings : warnings\n\t    });\n\t}());\n\t\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HDAListItemView  : HDAListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 31 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(29),\n\t    __webpack_require__(17),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DATASET, HISTORY_CONTENT, BASE_MVC, _l ){\n\t//==============================================================================\n\tvar _super = DATASET.DatasetAssociation,\n\t    hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n\t/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n\t */\n\tvar HistoryDatasetAssociation = _super.extend( BASE_MVC.mixin( hcontentMixin,\n\t/** @lends HistoryDatasetAssociation.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n\t    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n\t    //  - re-apply manually it now\n\t    /** call the mixin constructor */\n\t    constructor : function( attrs, options ){\n\t        hcontentMixin.constructor.call( this, attrs, options );\n\t    },\n\t    \n\t    /** default attributes for a model */\n\t    defaults : _.extend( {}, _super.prototype.defaults, hcontentMixin.defaults, {\n\t        model_class         : 'HistoryDatasetAssociation'\n\t    }),\n\t\n\t    /** Set up the model, determine if accessible, bind listeners\n\t     */\n\t    initialize : function( attributes, options ){\n\t        _super.prototype.initialize.call( this, attributes, options );\n\t        hcontentMixin.initialize.call( this, attributes, options );\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var nameAndId = this.get( 'id' ) || '';\n\t        if( this.get( 'name' ) ){\n\t            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n\t        }\n\t        return 'HDA(' + nameAndId + ')';\n\t    }\n\t}));\n\t\n\t//==============================================================================\n\t    return {\n\t        HistoryDatasetAssociation   : HistoryDatasetAssociation\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 32 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(6),\n\t    __webpack_require__(12),\n\t    __webpack_require__(10),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( STATES, DC_LI, DC_PANEL, BASE_MVC, _l ){\n\t/* global Backbone */\n\t//==============================================================================\n\tvar _super = DC_LI.DCListItemView;\n\t/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n\t */\n\tvar HDCAListItemView = _super.extend(\n\t/** @lends HDCAListItemView.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    className   : _super.prototype.className + \" history-content\",\n\t\n\t    /** event listeners */\n\t    _setUpListeners : function(){\n\t        _super.prototype._setUpListeners.call( this );\n\t\n\t        this.model.on({\n\t            'change:populated change:visible' : function( model, options ){ this.render(); },\n\t        }, this );\n\t    },\n\t\n\t    /** Override to provide the proper collections panels as the foldout */\n\t    _getFoldoutPanelClass : function(){\n\t        switch( this.model.get( 'collection_type' ) ){\n\t            case 'list':\n\t                return DC_PANEL.ListCollectionPanel;\n\t            case 'paired':\n\t                return DC_PANEL.PairCollectionPanel;\n\t            case 'list:paired':\n\t                return DC_PANEL.ListOfPairsCollectionPanel;\n\t        }\n\t        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n\t    },\n\t\n\t    /** In this override, add the state as a class for use with state-based CSS */\n\t    _swapNewRender : function( $newRender ){\n\t        _super.prototype._swapNewRender.call( this, $newRender );\n\t//TODO: model currently has no state\n\t        var state = !this.model.get( 'populated' ) ? STATES.RUNNING : STATES.OK;\n\t        //if( this.model.has( 'state' ) ){\n\t        this.$el.addClass( 'state-' + state );\n\t        //}\n\t        return this.$el;\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'HDCAListItemView(' + modelString + ')';\n\t    }\n\t});\n\t\n\t/** underscore templates */\n\tHDCAListItemView.prototype.templates = (function(){\n\t\n\t    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n\t        hidden : BASE_MVC.wrapTemplate([\n\t            // add a warning when hidden\n\t            '<% if( !collection.visible ){ %>',\n\t                '<div class=\"hidden-msg warningmessagesmall\">',\n\t                    _l( 'This collection has been hidden' ),\n\t                '</div>',\n\t            '<% } %>'\n\t        ], 'collection' )\n\t    });\n\t\n\t// could steal this from hda-base (or use mixed content)\n\t    var titleBarTemplate = BASE_MVC.wrapTemplate([\n\t        // adding the hid display to the title\n\t        '<div class=\"title-bar clear\" tabindex=\"0\">',\n\t            '<span class=\"state-icon\"></span>',\n\t            '<div class=\"title\">',\n\t                //TODO: remove whitespace and use margin-right\n\t                '<span class=\"hid\"><%- collection.hid %></span> ',\n\t                '<span class=\"name\"><%- collection.name %></span>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"></div>',\n\t        '</div>'\n\t    ], 'collection' );\n\t\n\t    return _.extend( {}, _super.prototype.templates, {\n\t        warnings : warnings,\n\t        titleBar : titleBarTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HDCAListItemView : HDCAListItemView\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 33 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(18),\n\t    __webpack_require__(2),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( HISTORY_CONTENTS, UTILS, BASE_MVC, _l ){\n\t//==============================================================================\n\t/** @class Model for a Galaxy history resource - both a record of user\n\t *      tool use and a collection of the datasets those tools produced.\n\t *  @name History\n\t *\n\t *  @augments Backbone.Model\n\t *  @borrows LoggableMixin#logger as #logger\n\t *  @borrows LoggableMixin#log as #log\n\t *  @constructs\n\t */\n\tvar History = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend(\n\t        BASE_MVC.mixin( BASE_MVC.SearchableModelMixin, /** @lends History.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    // values from api (may need more)\n\t    defaults : {\n\t        model_class     : 'History',\n\t        id              : null,\n\t        name            : 'Unnamed History',\n\t        state           : 'new',\n\t\n\t        diskSize        : 0,\n\t        deleted         : false\n\t    },\n\t\n\t    // ........................................................................ urls\n\t    urlRoot: galaxy_config.root + 'api/histories',\n\t\n\t    // ........................................................................ set up/tear down\n\t    /** Set up the model\n\t     *  @param {Object} historyJSON model data for this History\n\t     *  @param {Object[]} contentsJSON   array of model data for this History's contents (hdas or collections)\n\t     *  @param {Object} options     any extra settings including logger\n\t     */\n\t    initialize : function( historyJSON, contentsJSON, options ){\n\t        options = options || {};\n\t        this.logger = options.logger || null;\n\t        this.log( this + \".initialize:\", historyJSON, contentsJSON, options );\n\t\n\t        /** HistoryContents collection of the HDAs contained in this history. */\n\t        this.log( 'creating history contents:', contentsJSON );\n\t        this.contents = new HISTORY_CONTENTS.HistoryContents( contentsJSON || [], { historyId: this.get( 'id' )});\n\t        //// if we've got hdas passed in the constructor, load them\n\t        //if( contentsJSON && _.isArray( contentsJSON ) ){\n\t        //    this.log( 'resetting history contents:', contentsJSON );\n\t        //    this.contents.reset( contentsJSON );\n\t        //}\n\t\n\t        this._setUpListeners();\n\t\n\t        /** cached timeout id for the dataset updater */\n\t        this.updateTimeoutId = null;\n\t        // set up update timeout if needed\n\t        //this.checkForUpdates();\n\t    },\n\t\n\t    /** set up any event listeners for this history including those to the contained HDAs\n\t     *  events: error:contents  if an error occurred with the contents collection\n\t     */\n\t    _setUpListeners : function(){\n\t        this.on( 'error', function( model, xhr, options, msg, details ){\n\t            this.errorHandler( model, xhr, options, msg, details );\n\t        });\n\t\n\t        // hda collection listening\n\t        if( this.contents ){\n\t            this.listenTo( this.contents, 'error', function(){\n\t                this.trigger.apply( this, [ 'error:contents' ].concat( jQuery.makeArray( arguments ) ) );\n\t            });\n\t        }\n\t        // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n\t        this.on( 'change:id', function( model, newId ){\n\t            if( this.contents ){\n\t                this.contents.historyId = newId;\n\t            }\n\t        }, this );\n\t    },\n\t\n\t    //TODO: see base-mvc\n\t    //onFree : function(){\n\t    //    if( this.contents ){\n\t    //        this.contents.free();\n\t    //    }\n\t    //},\n\t\n\t    /** event listener for errors. Generally errors are handled outside this model */\n\t    errorHandler : function( model, xhr, options, msg, details ){\n\t        // clear update timeout on model err\n\t        this.clearUpdateTimeout();\n\t    },\n\t\n\t    /** convert size in bytes to a more human readable version */\n\t    nice_size : function(){\n\t        return UTILS.bytesToString( this.get( 'size' ), true, 2 );\n\t    },\n\t\n\t    /** override to add nice_size */\n\t    toJSON : function(){\n\t        return _.extend( Backbone.Model.prototype.toJSON.call( this ), {\n\t            nice_size : this.nice_size()\n\t        });\n\t    },\n\t\n\t    /** override to allow getting nice_size */\n\t    get : function( key ){\n\t        if( key === 'nice_size' ){\n\t            return this.nice_size();\n\t        }\n\t        return Backbone.Model.prototype.get.apply( this, arguments );\n\t    },\n\t\n\t    // ........................................................................ common queries\n\t    /** T/F is this history owned by the current user (Galaxy.currUser)\n\t     *      Note: that this will return false for an anon user even if the history is theirs.\n\t     */\n\t    ownedByCurrUser : function(){\n\t        // no currUser\n\t        if( !Galaxy || !Galaxy.currUser ){\n\t            return false;\n\t        }\n\t        // user is anon or history isn't owned\n\t        if( Galaxy.currUser.isAnonymous() || Galaxy.currUser.id !== this.get( 'user_id' ) ){\n\t            return false;\n\t        }\n\t        return true;\n\t    },\n\t\n\t    /**  */\n\t    contentsCount : function(){\n\t        return _.reduce( _.values( this.get( 'state_details' ) ), function( memo, num ){ return memo + num; }, 0 );\n\t    },\n\t\n\t    // ........................................................................ search\n\t    /** What model fields to search with */\n\t    searchAttributes : [\n\t        'name', 'annotation', 'tags'\n\t    ],\n\t\n\t    /** Adding title and singular tag */\n\t    searchAliases : {\n\t        title       : 'name',\n\t        tag         : 'tags'\n\t    },\n\t\n\t    // ........................................................................ updates\n\t    /** does the contents collection indicate they're still running and need to be updated later?\n\t     *      delay + update if needed\n\t     *  @param {Function} onReadyCallback   function to run when all contents are in the ready state\n\t     *  events: ready\n\t     */\n\t    checkForUpdates : function( onReadyCallback ){\n\t        //this.info( 'checkForUpdates' )\n\t\n\t        // get overall History state from collection, run updater if History has running/queued contents\n\t        //  boiling it down on the client to running/not\n\t        if( this.contents.running().length ){\n\t            this.setUpdateTimeout();\n\t\n\t        } else {\n\t            this.trigger( 'ready' );\n\t            if( _.isFunction( onReadyCallback ) ){\n\t                onReadyCallback.call( this );\n\t            }\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** create a timeout (after UPDATE_DELAY or delay ms) to refetch the contents. Clear any prev. timeout */\n\t    setUpdateTimeout : function( delay ){\n\t        delay = delay || History.UPDATE_DELAY;\n\t        var history = this;\n\t\n\t        // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n\t        this.clearUpdateTimeout();\n\t        this.updateTimeoutId = setTimeout( function(){\n\t            history.refresh();\n\t        }, delay );\n\t        return this.updateTimeoutId;\n\t    },\n\t\n\t    /** clear the timeout and the cached timeout id */\n\t    clearUpdateTimeout : function(){\n\t        if( this.updateTimeoutId ){\n\t            clearTimeout( this.updateTimeoutId );\n\t            this.updateTimeoutId = null;\n\t        }\n\t    },\n\t\n\t    /* update the contents, getting full detailed model data for any whose id is in detailIds\n\t     *  set up to run this again in some interval of time\n\t     *  @param {String[]} detailIds list of content ids to get detailed model data for\n\t     *  @param {Object} options     std. backbone fetch options map\n\t     */\n\t    refresh : function( detailIds, options ){\n\t        //this.info( 'refresh:', detailIds, this.contents );\n\t        detailIds = detailIds || [];\n\t        options = options || {};\n\t        var history = this;\n\t\n\t        // add detailIds to options as CSV string\n\t        options.data = options.data || {};\n\t        if( detailIds.length ){\n\t            options.data.details = detailIds.join( ',' );\n\t        }\n\t        var xhr = this.contents.fetch( options );\n\t        xhr.done( function( models ){\n\t            history.checkForUpdates( function(){\n\t                // fetch the history inside onReadyCallback in order to recalc history size\n\t                this.fetch();\n\t            });\n\t        });\n\t        return xhr;\n\t    },\n\t\n\t    // ........................................................................ ajax\n\t    /** save this history, _Mark_ing it as deleted (just a flag) */\n\t    _delete : function( options ){\n\t        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: true }, options );\n\t    },\n\t    /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n\t    purge : function( options ){\n\t        if( this.get( 'purged' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: true, purged: true }, options );\n\t    },\n\t    /** save this history, _Mark_ing it as undeleted */\n\t    undelete : function( options ){\n\t        if( !this.get( 'deleted' ) ){ return jQuery.when(); }\n\t        return this.save( { deleted: false }, options );\n\t    },\n\t\n\t    /** Make a copy of this history on the server\n\t     *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n\t     *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n\t     *  @fires copied               passed this history and the response JSON from the copy\n\t     *  @returns {xhr}\n\t     */\n\t    copy : function( current, name, allDatasets ){\n\t        current = ( current !== undefined )?( current ):( true );\n\t        if( !this.id ){\n\t            throw new Error( 'You must set the history ID before copying it.' );\n\t        }\n\t\n\t        var postData = { history_id  : this.id };\n\t        if( current ){\n\t            postData.current = true;\n\t        }\n\t        if( name ){\n\t            postData.name = name;\n\t        }\n\t        if( !allDatasets ){\n\t            postData.all_datasets = false;\n\t        }\n\t\n\t        var history = this,\n\t            copy = jQuery.post( this.urlRoot, postData );\n\t        // if current - queue to setAsCurrent before firing 'copied'\n\t        if( current ){\n\t            return copy.then( function( response ){\n\t                var newHistory = new History( response );\n\t                return newHistory.setAsCurrent()\n\t                    .done( function(){\n\t                        history.trigger( 'copied', history, response );\n\t                    });\n\t            });\n\t        }\n\t        return copy.done( function( response ){\n\t            history.trigger( 'copied', history, response );\n\t        });\n\t    },\n\t\n\t    setAsCurrent : function(){\n\t        var history = this,\n\t            xhr = jQuery.getJSON( galaxy_config.root + 'history/set_as_current?id=' + this.id );\n\t\n\t        xhr.done( function(){\n\t            history.trigger( 'set-as-current', history );\n\t        });\n\t        return xhr;\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    toString : function(){\n\t        return 'History(' + this.get( 'id' ) + ',' + this.get( 'name' ) + ')';\n\t    }\n\t}));\n\t\n\t//------------------------------------------------------------------------------ CLASS VARS\n\t/** When the history has running hdas,\n\t *  this is the amount of time between update checks from the server\n\t */\n\tHistory.UPDATE_DELAY = 4000;\n\t\n\t/** Get data for a history then its hdas using a sequential ajax call, return a deferred to receive both */\n\tHistory.getHistoryData = function getHistoryData( historyId, options ){\n\t    options = options || {};\n\t    var detailIdsFn = options.detailIdsFn || [];\n\t    var hdcaDetailIds = options.hdcaDetailIds || [];\n\t    //console.debug( 'getHistoryData:', historyId, options );\n\t\n\t    var df = jQuery.Deferred(),\n\t        historyJSON = null;\n\t\n\t    function getHistory( id ){\n\t        // get the history data\n\t        if( historyId === 'current' ){\n\t            return jQuery.getJSON( galaxy_config.root + 'history/current_history_json' );\n\t        }\n\t        return jQuery.ajax( galaxy_config.root + 'api/histories/' + historyId );\n\t    }\n\t    function isEmpty( historyData ){\n\t        // get the number of hdas accrd. to the history\n\t        return historyData && historyData.empty;\n\t    }\n\t    function getContents( historyData ){\n\t        // get the hda data\n\t        // if no hdas accrd. to history: return empty immed.\n\t        if( isEmpty( historyData ) ){ return []; }\n\t        // if there are hdas accrd. to history: get those as well\n\t        if( _.isFunction( detailIdsFn ) ){\n\t            detailIdsFn = detailIdsFn( historyData );\n\t        }\n\t        if( _.isFunction( hdcaDetailIds ) ){\n\t            hdcaDetailIds = hdcaDetailIds( historyData );\n\t        }\n\t        var data = {};\n\t        if( detailIdsFn.length ) {\n\t            data.dataset_details = detailIdsFn.join( ',' );\n\t        }\n\t        if( hdcaDetailIds.length ) {\n\t            // for symmetry, not actually used by backend of consumed\n\t            // by frontend.\n\t            data.dataset_collection_details = hdcaDetailIds.join( ',' );\n\t        }\n\t        return jQuery.ajax( galaxy_config.root + 'api/histories/' + historyData.id + '/contents', { data: data });\n\t    }\n\t\n\t    // getting these concurrently is 400% slower (sqlite, local, vanilla) - so:\n\t    //  chain the api calls - getting history first then contents\n\t\n\t    var historyFn = options.historyFn || getHistory,\n\t        contentsFn = options.contentsFn || getContents;\n\t\n\t    // chain ajax calls: get history first, then hdas\n\t    var historyXHR = historyFn( historyId );\n\t    historyXHR.done( function( json ){\n\t        // set outer scope var here for use below\n\t        historyJSON = json;\n\t        df.notify({ status: 'history data retrieved', historyJSON: historyJSON });\n\t    });\n\t    historyXHR.fail( function( xhr, status, message ){\n\t        // call reject on the outer deferred to allow its fail callback to run\n\t        df.reject( xhr, 'loading the history' );\n\t    });\n\t\n\t    var contentsXHR = historyXHR.then( contentsFn );\n\t    contentsXHR.then( function( contentsJSON ){\n\t        df.notify({ status: 'contents data retrieved', historyJSON: historyJSON, contentsJSON: contentsJSON });\n\t        // we've got both: resolve the outer scope deferred\n\t        df.resolve( historyJSON, contentsJSON );\n\t    });\n\t    contentsXHR.fail( function( xhr, status, message ){\n\t        // call reject on the outer deferred to allow its fail callback to run\n\t        df.reject( xhr, 'loading the contents', { history: historyJSON } );\n\t    });\n\t\n\t    return df;\n\t};\n\t\n\t\n\t//==============================================================================\n\tvar ControlledFetchMixin = {\n\t\n\t    /** Override to convert certain options keys into API index parameters */\n\t    fetch : function( options ){\n\t        options = options || {};\n\t        options.data = options.data || this._buildFetchData( options );\n\t        // use repeated params for arrays, e.g. q=1&qv=1&q=2&qv=2\n\t        options.traditional = true;\n\t        return Backbone.Collection.prototype.fetch.call( this, options );\n\t    },\n\t\n\t    /** These attribute keys are valid params to fetch/API-index */\n\t    _fetchOptions : [\n\t        /** model dependent string to control the order of models returned */\n\t        'order',\n\t        /** limit the number of models returned from a fetch */\n\t        'limit',\n\t        /** skip this number of models when fetching */\n\t        'offset',\n\t        /** what series of attributes to return (model dependent) */\n\t        'view',\n\t        /** individual keys to return for the models (see api/histories.index) */\n\t        'keys'\n\t    ],\n\t\n\t    /** Build the data dictionary to send to fetch's XHR as data */\n\t    _buildFetchData : function( options ){\n\t        var data = {},\n\t            fetchDefaults = this._fetchDefaults();\n\t        options = _.defaults( options || {}, fetchDefaults );\n\t        data = _.pick( options, this._fetchOptions );\n\t\n\t        var filters = _.has( options, 'filters' )? options.filters : ( fetchDefaults.filters || {} );\n\t        if( !_.isEmpty( filters ) ){\n\t            _.extend( data, this._buildFetchFilters( filters ) );\n\t        }\n\t        return data;\n\t    },\n\t\n\t    /** Override to have defaults for fetch options and filters */\n\t    _fetchDefaults : function(){\n\t        // to be overridden\n\t        return {};\n\t    },\n\t\n\t    /** Convert dictionary filters to qqv style arrays */\n\t    _buildFetchFilters : function( filters ){\n\t        var filterMap = {\n\t            q  : [],\n\t            qv : []\n\t        };\n\t        _.each( filters, function( v, k ){\n\t            if( v === true ){ v = 'True'; }\n\t            if( v === false ){ v = 'False'; }\n\t            filterMap.q.push( k );\n\t            filterMap.qv.push( v );\n\t        });\n\t        return filterMap;\n\t    },\n\t};\n\t\n\t//==============================================================================\n\t/** @class A collection of histories (per user).\n\t *      (stub) currently unused.\n\t */\n\tvar HistoryCollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend( ControlledFetchMixin ).extend(\n\t/** @lends HistoryCollection.prototype */{\n\t    model   : History,\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** @type {String} the default sortOrders key for sorting */\n\t    DEFAULT_ORDER : 'update_time',\n\t\n\t    /** @type {Object} map of collection sorting orders generally containing a getter to return the attribute\n\t     *      sorted by and asc T/F if it is an ascending sort.\n\t     */\n\t    sortOrders : {\n\t        'update_time' : {\n\t            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n\t            asc : false\n\t        },\n\t        'update_time-asc' : {\n\t            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n\t            asc : true\n\t        },\n\t        'name' : {\n\t            getter : function( h ){ return h.get( 'name' ); },\n\t            asc : true\n\t        },\n\t        'name-dsc' : {\n\t            getter : function( h ){ return h.get( 'name' ); },\n\t            asc : false\n\t        },\n\t        'size' : {\n\t            getter : function( h ){ return h.get( 'size' ); },\n\t            asc : false\n\t        },\n\t        'size-asc' : {\n\t            getter : function( h ){ return h.get( 'size' ); },\n\t            asc : true\n\t        }\n\t    },\n\t\n\t    initialize : function( models, options ){\n\t        options = options || {};\n\t        this.log( 'HistoryCollection.initialize', arguments );\n\t\n\t        // instance vars\n\t        /** @type {boolean} should deleted histories be included */\n\t        this.includeDeleted = options.includeDeleted || false;\n\t        // set the sort order\n\t        this.setOrder( options.order || this.DEFAULT_ORDER );\n\t        /** @type {String} encoded id of the history that's current */\n\t        this.currentHistoryId = options.currentHistoryId;\n\t        /** @type {boolean} have all histories been fetched and in the collection? */\n\t        this.allFetched = options.allFetched || false;\n\t\n\t        // this.on( 'all', function(){\n\t        //    console.info( 'event:', arguments );\n\t        // });\n\t        this.setUpListeners();\n\t    },\n\t\n\t    urlRoot : ( window.galaxy_config? galaxy_config.root : '/' ) + 'api/histories',\n\t    url     : function(){ return this.urlRoot; },\n\t\n\t    /** returns map of default filters and settings for fetching from the API */\n\t    _fetchDefaults : function(){\n\t        // to be overridden\n\t        var defaults = {\n\t            order   : this.order,\n\t            view    : 'detailed'\n\t        };\n\t        if( !this.includeDeleted ){\n\t            defaults.filters = {\n\t                deleted : false,\n\t                purged  : false,\n\t            };\n\t        }\n\t        return defaults;\n\t    },\n\t\n\t    /** set up reflexive event handlers */\n\t    setUpListeners : function setUpListeners(){\n\t        this.on({\n\t            // when a history is deleted, remove it from the collection (if optionally set to do so)\n\t            'change:deleted' : function( history ){\n\t                // TODO: this becomes complicated when more filters are used\n\t                this.debug( 'change:deleted', this.includeDeleted, history.get( 'deleted' ) );\n\t                if( !this.includeDeleted && history.get( 'deleted' ) ){\n\t                    this.remove( history );\n\t                }\n\t            },\n\t            // listen for a history copy, setting it to current\n\t            'copied' : function( original, newData ){\n\t                this.setCurrent( new History( newData, [] ) );\n\t            },\n\t            // when a history is made current, track the id in the collection\n\t            'set-as-current' : function( history ){\n\t                var oldCurrentId = this.currentHistoryId;\n\t                this.trigger( 'no-longer-current', oldCurrentId );\n\t                this.currentHistoryId = history.id;\n\t            }\n\t        }, this );\n\t    },\n\t\n\t    /** override to allow passing options.order and setting the sort order to one of sortOrders */\n\t    sort : function( options ){\n\t        options = options || {};\n\t        this.setOrder( options.order );\n\t        return Backbone.Collection.prototype.sort.call( this, options );\n\t    },\n\t\n\t    /** build the comparator used to sort this collection using the sortOrder map and the given order key\n\t     *  @event 'changed-order' passed the new order and the collection\n\t     */\n\t    setOrder : function( order ){\n\t        var collection = this,\n\t            sortOrder = this.sortOrders[ order ];\n\t        if( _.isUndefined( sortOrder ) ){ return; }\n\t\n\t        collection.order = order;\n\t        collection.comparator = function comparator( a, b ){\n\t            var currentHistoryId = collection.currentHistoryId;\n\t            // current always first\n\t            if( a.id === currentHistoryId ){ return -1; }\n\t            if( b.id === currentHistoryId ){ return 1; }\n\t            // then compare by an attribute\n\t            a = sortOrder.getter( a );\n\t            b = sortOrder.getter( b );\n\t            return sortOrder.asc?\n\t                ( ( a === b )?( 0 ):( a > b ?  1 : -1 ) ):\n\t                ( ( a === b )?( 0 ):( a > b ? -1 :  1 ) );\n\t        };\n\t        collection.trigger( 'changed-order', collection.order, collection );\n\t        return collection;\n\t    },\n\t\n\t    /** override to provide order and offsets based on instance vars, set limit if passed,\n\t     *  and set allFetched/fire 'all-fetched' when xhr returns\n\t     */\n\t    fetch : function( options ){\n\t        options = options || {};\n\t        if( this.allFetched ){ return jQuery.when({}); }\n\t        var collection = this,\n\t            fetchOptions = _.defaults( options, {\n\t                remove : false,\n\t                offset : collection.length >= 1? ( collection.length - 1 ) : 0,\n\t                order  : collection.order\n\t            }),\n\t            limit = options.limit;\n\t        if( !_.isUndefined( limit ) ){\n\t            fetchOptions.limit = limit;\n\t        }\n\t\n\t        return ControlledFetchMixin.fetch.call( this, fetchOptions )\n\t            .done( function _postFetchMore( fetchData ){\n\t                var numFetched = _.isArray( fetchData )? fetchData.length : 0;\n\t                // anything less than a full page means we got all there is to get\n\t                if( !limit || numFetched < limit ){\n\t                    collection.allFetched = true;\n\t                    collection.trigger( 'all-fetched', collection );\n\t                }\n\t            }\n\t        );\n\t    },\n\t\n\t    /** create a new history and by default set it to be the current history */\n\t    create : function create( data, hdas, historyOptions, xhrOptions ){\n\t        //TODO: .create is actually a collection function that's overridden here\n\t        var collection = this,\n\t            xhr = jQuery.getJSON( galaxy_config.root + 'history/create_new_current'  );\n\t        return xhr.done( function( newData ){\n\t            collection.setCurrent( new History( newData, [], historyOptions || {} ) );\n\t        });\n\t    },\n\t\n\t    /** set the current history to the given history, placing it first in the collection.\n\t     *  Pass standard bbone options for use in unshift.\n\t     *  @triggers new-current passed history and this collection\n\t     */\n\t    setCurrent : function( history, options ){\n\t        options = options || {};\n\t        // new histories go in the front\n\t        this.unshift( history, options );\n\t        this.currentHistoryId = history.get( 'id' );\n\t        if( !options.silent ){\n\t            this.trigger( 'new-current', history, this );\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** override to reset allFetched flag to false */\n\t    reset : function( models, options ){\n\t        this.allFetched = false;\n\t        return Backbone.Collection.prototype.reset.call( this, models, options );\n\t    },\n\t\n\t    toString: function toString(){\n\t        return 'HistoryCollection(' + this.length + ')';\n\t    }\n\t});\n\t\n\t//==============================================================================\n\treturn {\n\t    History           : History,\n\t    HistoryCollection : HistoryCollection\n\t};}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 34 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(19),\n\t    __webpack_require__(79),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1),\n\t    __webpack_require__(41)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( LIST_ITEM, LoadingIndicator, BASE_MVC, _l ){\n\t/* ============================================================================\n\tTODO:\n\t\n\t============================================================================ */\n\t/** @class View for a list/collection of models and the sub-views of those models.\n\t *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n\t *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n\t *      use ModelWithListPanel)\n\t *\n\t *  Allows for:\n\t *      searching collection/sub-views\n\t *      selecting/multi-selecting sub-views\n\t *\n\t *  Currently used:\n\t *      for dataset/dataset-choice\n\t *      as superclass of ModelListPanel\n\t */\n\tvar ListPanel = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend(\n\t/** @lends ReadOnlyHistoryPanel.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** class to use for constructing the sub-views */\n\t    viewClass           : LIST_ITEM.ListItemView,\n\t    /** class to used for constructing collection of sub-view models */\n\t    collectionClass     : Backbone.Collection,\n\t\n\t    tagName             : 'div',\n\t    className           : 'list-panel',\n\t\n\t    /** (in ms) that jquery effects will use */\n\t    fxSpeed             : 'fast',\n\t\n\t    /** string to display when the collection has no contents */\n\t    emptyMsg            : _l( 'This list is empty' ),\n\t    /** displayed when no items match the search terms */\n\t    noneFoundMsg        : _l( 'No matching items found' ),\n\t    /** string used for search placeholder */\n\t    searchPlaceholder   : _l( 'search' ),\n\t\n\t    // ......................................................................... SET UP\n\t    /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t     *  @param {Object} attributes optional settings for the list\n\t     */\n\t    initialize : function( attributes, options ){\n\t        attributes = attributes || {};\n\t        // set the logger if requested\n\t        if( attributes.logger ){\n\t            this.logger = attributes.logger;\n\t        }\n\t        this.log( this + '.initialize:', attributes );\n\t\n\t        // ---- instance vars\n\t        /** how quickly should jquery fx run? */\n\t        this.fxSpeed = _.has( attributes, 'fxSpeed' )?( attributes.fxSpeed ):( this.fxSpeed );\n\t\n\t        /** filters for displaying subviews */\n\t        this.filters = [];\n\t        /** current search terms */\n\t        this.searchFor = attributes.searchFor || '';\n\t\n\t        /** loading indicator */\n\t        this.indicator = new LoadingIndicator( this.$el );\n\t\n\t        /** currently showing selectors on items? */\n\t        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : true;\n\t        //this.selecting = false;\n\t\n\t        /** cached selected item.model.ids to persist btwn renders */\n\t        this.selected = attributes.selected || [];\n\t        /** the last selected item.model.id */\n\t        this.lastSelected = null;\n\t\n\t        /** are sub-views draggable */\n\t        this.dragItems = attributes.dragItems || false;\n\t\n\t        /** list item view class (when passed models) */\n\t        this.viewClass = attributes.viewClass || this.viewClass;\n\t\n\t        /** list item views */\n\t        this.views = [];\n\t        /** list item models */\n\t        this.collection = attributes.collection || ( new this.collectionClass([]) );\n\t\n\t        /** filter fns run over collection items to see if they should show in the list */\n\t        this.filters = attributes.filters || [];\n\t\n\t        /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n\t        this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\t\n\t//TODO: remove\n\t        this.title = attributes.title || '';\n\t        this.subtitle = attributes.subtitle || '';\n\t\n\t        this._setUpListeners();\n\t    },\n\t\n\t    /** free any sub-views the list has */\n\t    freeViews : function(){\n\t//TODO: stopListening? remove?\n\t        _.each( this.views, function( view ){\n\t            view.off();\n\t        });\n\t        this.views = [];\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ listeners\n\t    /** create any event listeners for the list\n\t     */\n\t    _setUpListeners : function(){\n\t        this.off();\n\t\n\t        //TODO: move errorHandler down into list-panel from history-panel or\n\t        //  pass to global error handler (Galaxy)\n\t        this.on( 'error', function( model, xhr, options, msg, details ){\n\t            //this.errorHandler( model, xhr, options, msg, details );\n\t            console.error( model, xhr, options, msg, details );\n\t        }, this );\n\t\n\t        // show hide the loading indicator\n\t        this.on( 'loading', function(){\n\t            this._showLoadingIndicator( 'loading...', 40 );\n\t        }, this );\n\t        this.on( 'loading-done', function(){\n\t            this._hideLoadingIndicator( 40 );\n\t        }, this );\n\t\n\t        // throw the first render up as a diff namespace using once (for outside consumption)\n\t        this.once( 'rendered', function(){\n\t            this.trigger( 'rendered:initial', this );\n\t        }, this );\n\t\n\t        // debugging\n\t        if( this.logger ){\n\t            this.on( 'all', function( event ){\n\t                this.log( this + '', arguments );\n\t            }, this );\n\t        }\n\t\n\t        this._setUpCollectionListeners();\n\t        this._setUpViewListeners();\n\t        return this;\n\t    },\n\t\n\t    /** listening for collection events */\n\t    _setUpCollectionListeners : function(){\n\t        this.log( this + '._setUpCollectionListeners', this.collection );\n\t        this.collection.off();\n\t\n\t        // bubble up error events\n\t        this.collection.on( 'error', function( model, xhr, options, msg, details ){\n\t            this.trigger( 'error', model, xhr, options, msg, details );\n\t        }, this );\n\t\n\t        this.collection.on( 'reset', function(){\n\t            this.renderItems();\n\t        }, this );\n\t        this.collection.on( 'add', this.addItemView, this );\n\t        this.collection.on( 'remove', this.removeItemView, this );\n\t\n\t        // debugging\n\t        if( this.logger ){\n\t            this.collection.on( 'all', function( event ){\n\t                this.info( this + '(collection)', arguments );\n\t            }, this );\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** listening for sub-view events that bubble up with the 'view:' prefix */\n\t    _setUpViewListeners : function(){\n\t        this.log( this + '._setUpViewListeners' );\n\t\n\t        // shift to select a range\n\t        this.on( 'view:selected', function( view, ev ){\n\t            if( ev && ev.shiftKey && this.lastSelected ){\n\t                var lastSelectedView = this.viewFromModelId( this.lastSelected );\n\t                if( lastSelectedView ){\n\t                    this.selectRange( view, lastSelectedView );\n\t                }\n\t            } else if( ev && ev.altKey && !this.selecting ){\n\t                this.showSelectors();\n\t            }\n\t            this.selected.push( view.model.id );\n\t            this.lastSelected = view.model.id;\n\t        }, this );\n\t\n\t        this.on( 'view:de-selected', function( view, ev ){\n\t            this.selected = _.without( this.selected, view.model.id );\n\t            //this.lastSelected = view.model.id;\n\t        }, this );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ rendering\n\t    /** Render this content, set up ui.\n\t     *  @param {Number or String} speed   the speed of the render\n\t     */\n\t    render : function( speed ){\n\t        this.log( this + '.render', speed );\n\t        var $newRender = this._buildNewRender();\n\t        this._setUpBehaviors( $newRender );\n\t        this._queueNewRender( $newRender, speed );\n\t        return this;\n\t    },\n\t\n\t    /** Build a temp div containing the new children for the view's $el.\n\t     */\n\t    _buildNewRender : function(){\n\t        this.debug( this + '(ListPanel)._buildNewRender' );\n\t        var $newRender = $( this.templates.el( {}, this ) );\n\t        this._renderControls( $newRender );\n\t        this._renderTitle( $newRender );\n\t        this._renderSubtitle( $newRender );\n\t        this._renderSearch( $newRender );\n\t        this.renderItems( $newRender );\n\t        return $newRender;\n\t    },\n\t\n\t    /** Build a temp div containing the new children for the view's $el.\n\t     */\n\t    _renderControls : function( $newRender ){\n\t        this.debug( this + '(ListPanel)._renderControls' );\n\t        var $controls = $( this.templates.controls( {}, this ) );\n\t        $newRender.find( '.controls' ).replaceWith( $controls );\n\t        return $controls;\n\t    },\n\t\n\t    /**\n\t     */\n\t    _renderTitle : function( $where ){\n\t        //$where = $where || this.$el;\n\t        //$where.find( '.title' ).replaceWith( ... )\n\t    },\n\t\n\t    /**\n\t     */\n\t    _renderSubtitle : function( $where ){\n\t        //$where = $where || this.$el;\n\t        //$where.find( '.title' ).replaceWith( ... )\n\t    },\n\t\n\t    /** Fade out the old el, swap in the new contents, then fade in.\n\t     *  @param {Number or String} speed   jq speed to use for rendering effects\n\t     *  @fires rendered when rendered\n\t     */\n\t    _queueNewRender : function( $newRender, speed ) {\n\t        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n\t        var panel = this;\n\t        panel.log( '_queueNewRender:', $newRender, speed );\n\t\n\t        $( panel ).queue( 'fx', [\n\t            function( next ){ this.$el.fadeOut( speed, next ); },\n\t            function( next ){\n\t                panel._swapNewRender( $newRender );\n\t                next();\n\t            },\n\t            function( next ){ this.$el.fadeIn( speed, next ); },\n\t            function( next ){\n\t                panel.trigger( 'rendered', panel );\n\t                next();\n\t            }\n\t        ]);\n\t    },\n\t\n\t    /** empty out the current el, move the $newRender's children in */\n\t    _swapNewRender : function( $newRender ){\n\t        this.$el.empty().attr( 'class', this.className ).append( $newRender.children() );\n\t        if( this.selecting ){ this.showSelectors( 0 ); }\n\t        return this;\n\t    },\n\t\n\t    /**  */\n\t    _setUpBehaviors : function( $where ){\n\t        $where = $where || this.$el;\n\t        $where.find( '.controls [title]' ).tooltip({ placement: 'bottom' });\n\t        // set up the pupup for actions available when multi selecting\n\t        this._renderMultiselectActionMenu( $where );\n\t        return this;\n\t    },\n\t\n\t    /** render a menu containing the actions available to sets of selected items */\n\t    _renderMultiselectActionMenu : function( $where ){\n\t        $where = $where || this.$el;\n\t        var $menu = $where.find( '.list-action-menu' ),\n\t            actions = this.multiselectActions();\n\t        if( !actions.length ){\n\t            return $menu.empty();\n\t        }\n\t\n\t        var $newMenu = $([\n\t            '<div class=\"list-action-menu btn-group\">',\n\t                '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n\t                    _l( 'For all selected' ), '...',\n\t                '</button>',\n\t                '<ul class=\"dropdown-menu pull-right\" role=\"menu\">', '</ul>',\n\t            '</div>'\n\t        ].join(''));\n\t        var $actions = actions.map( function( action ){\n\t            var html = [ '<li><a href=\"javascript:void(0);\">', action.html, '</a></li>' ].join( '' );\n\t            return $( html ).click( function( ev ){\n\t                ev.preventDefault();\n\t                return action.func( ev );\n\t            });\n\t        });\n\t        $newMenu.find( 'ul' ).append( $actions );\n\t        $menu.replaceWith( $newMenu );\n\t        return $newMenu;\n\t    },\n\t\n\t    /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n\t     *      html: an html string used as the anchor contents\n\t     *      func: a function called when the anchor is clicked (passed the click event)\n\t     */\n\t    multiselectActions : function(){\n\t        return [];\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ sub-$element shortcuts\n\t    /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n\t    $scrollContainer : function(){\n\t        // override or set via attributes.$scrollContainer\n\t        return this.$el.parent().parent();\n\t    },\n\t    /**  */\n\t    $list : function( $where ){\n\t        return ( $where || this.$el ).find( '> .list-items' );\n\t    },\n\t    /** container where list messages are attached */\n\t    $messages : function( $where ){\n\t        return ( $where || this.$el ).find( '> .controls .messages' );\n\t    },\n\t    /** the message displayed when no views can be shown (no views, none matching search) */\n\t    $emptyMessage : function( $where ){\n\t        return ( $where || this.$el ).find( '> .empty-message' );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ hda sub-views\n\t    /**\n\t     *  @param {jQuery} $whereTo what dom element to prepend the sub-views to\n\t     *  @returns the visible item views\n\t     */\n\t    renderItems : function( $whereTo ){\n\t        $whereTo = $whereTo || this.$el;\n\t        var panel = this;\n\t        panel.log( this + '.renderItems', $whereTo );\n\t\n\t        var $list = panel.$list( $whereTo );\n\t//TODO: free prev. views?\n\t        panel.views = panel._filterCollection().map( function( itemModel ){\n\t//TODO: creates views each time - not neccessarily good\n\t//TODO: pass speed here\n\t                return panel._createItemView( itemModel ).render( 0 );\n\t            });\n\t        //panel.debug( item$els );\n\t        //panel.debug( newViews );\n\t\n\t        $list.empty();\n\t        if( panel.views.length ){\n\t            panel._attachItems( $whereTo );\n\t            panel.$emptyMessage( $whereTo ).hide();\n\t\n\t        } else {\n\t            panel._renderEmptyMessage( $whereTo ).show();\n\t        }\n\t        panel.trigger( 'views:ready', panel.views );\n\t\n\t        return panel.views;\n\t    },\n\t\n\t    /** Filter the collection to only those models that should be currently viewed */\n\t    _filterCollection : function(){\n\t        // override this\n\t        var panel = this;\n\t        return panel.collection.filter( _.bind( panel._filterItem, panel ) );\n\t    },\n\t\n\t    /** Should the model be viewable in the current state?\n\t     *     Checks against this.filters and this.searchFor\n\t     */\n\t    _filterItem : function( model ){\n\t        // override this\n\t        var panel = this;\n\t        return ( _.every( panel.filters.map( function( fn ){ return fn.call( model ); }) ) )\n\t            && ( !panel.searchFor || model.matchesAll( panel.searchFor ) );\n\t    },\n\t\n\t    /** Create a view for a model and set up it's listeners */\n\t    _createItemView : function( model ){\n\t        var ViewClass = this._getItemViewClass( model ),\n\t            options = _.extend( this._getItemViewOptions( model ), {\n\t                    model : model\n\t                }),\n\t            view = new ViewClass( options );\n\t        this._setUpItemViewListeners( view );\n\t        return view;\n\t    },\n\t\n\t    /** Get the bbone view class based on the model */\n\t    _getItemViewClass : function( model ){\n\t        // override this\n\t        return this.viewClass;\n\t    },\n\t\n\t    /** Get the options passed to the new view based on the model */\n\t    _getItemViewOptions : function( model ){\n\t        // override this\n\t        return {\n\t            //logger      : this.logger,\n\t            fxSpeed     : this.fxSpeed,\n\t            expanded    : false,\n\t            selectable  : this.selecting,\n\t            selected    : _.contains( this.selected, model.id ),\n\t            draggable   : this.dragItems\n\t        };\n\t    },\n\t\n\t    /** Set up listeners for new models */\n\t    _setUpItemViewListeners : function( view ){\n\t        var panel = this;\n\t        // send all events to the panel, re-namspaceing them with the view prefix\n\t        view.on( 'all', function(){\n\t            var args = Array.prototype.slice.call( arguments, 0 );\n\t            args[0] = 'view:' + args[0];\n\t            panel.trigger.apply( panel, args );\n\t        });\n\t\n\t        // drag multiple - hijack ev.setData to add all selected items\n\t        view.on( 'draggable:dragstart', function( ev, v ){\n\t            //TODO: set multiple drag data here\n\t            var json = {},\n\t                selected = this.getSelectedModels();\n\t            if( selected.length ){\n\t                json = selected.toJSON();\n\t            } else {\n\t                json = [ v.model.toJSON() ];\n\t            }\n\t            ev.dataTransfer.setData( 'text', JSON.stringify( json ) );\n\t            //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n\t        }, this );\n\t\n\t        // debugging\n\t        //if( this.logger ){\n\t        //    view.on( 'all', function( event ){\n\t        //        this.log( this + '(view)', arguments );\n\t        //    }, this );\n\t        //}\n\t        return panel;\n\t    },\n\t\n\t    /** Attach views in this.views to the model based on $whereTo */\n\t    _attachItems : function( $whereTo ){\n\t        //ASSUMES: $list has been emptied\n\t        this.$list( $whereTo ).append( this.views.map( function( view ){\n\t            return view.$el;\n\t        }));\n\t        return this;\n\t    },\n\t\n\t    /** render the empty/none-found message */\n\t    _renderEmptyMessage : function( $whereTo ){\n\t        this.debug( '_renderEmptyMessage', $whereTo, this.searchFor );\n\t        var text = this.searchFor? this.noneFoundMsg : this.emptyMsg;\n\t        return this.$emptyMessage( $whereTo ).text( text );\n\t    },\n\t\n\t    /** collapse all item views */\n\t    expandAll : function(){\n\t        _.each( this.views, function( view ){\n\t            view.expand();\n\t        });\n\t    },\n\t\n\t    /** collapse all item views */\n\t    collapseAll : function(){\n\t        _.each( this.views, function( view ){\n\t            view.collapse();\n\t        });\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ collection/views syncing\n\t    /** Add a view (if the model should be viewable) to the panel */\n\t    addItemView : function( model, collection, options ){\n\t        this.log( this + '.addItemView:', model );\n\t        var panel = this;\n\t        if( !panel._filterItem( model ) ){ return undefined; }\n\t\n\t        var view = panel._createItemView( model );\n\t        // hide the empty message if only view\n\t        $( view ).queue( 'fx', [\n\t            //TODO:? could poss. pubsub this\n\t            function( next ){ panel.$emptyMessage().fadeOut( panel.fxSpeed, next ); },\n\t            function( next ){\n\t                panel._attachView( view );\n\t                next();\n\t            }\n\t        ]);\n\t        return view;\n\t    },\n\t\n\t    /** internal fn to add view (to both panel.views and panel.$list) */\n\t    _attachView : function( view ){\n\t        var panel = this;\n\t        // override to control where the view is added, how/whether it's rendered\n\t        panel.views.push( view );\n\t        panel.$list().append( view.render( 0 ).$el.hide() );\n\t        panel.trigger( 'view:attached', view );\n\t        view.$el.slideDown( panel.fxSpeed, function(){\n\t            panel.trigger( 'view:attached:rendered' );\n\t        });\n\t    },\n\t\n\t    /** Remove a view from the panel (if found) */\n\t    removeItemView : function( model, collection, options ){\n\t        this.log( this + '.removeItemView:', model );\n\t        var panel = this,\n\t            view = panel.viewFromModel( model );\n\t        if( !view ){ return undefined; }\n\t        panel.views = _.without( panel.views, view );\n\t        panel.trigger( 'view:removed', view );\n\t\n\t        // potentially show the empty message if no views left\n\t        // use anonymous queue here - since remove can happen multiple times\n\t        $({}).queue( 'fx', [\n\t            function( next ){ view.$el.fadeOut( panel.fxSpeed, next ); },\n\t            function( next ){\n\t                view.remove();\n\t                panel.trigger( 'view:removed:rendered' );\n\t                if( !panel.views.length ){\n\t                    panel._renderEmptyMessage().fadeIn( panel.fxSpeed, next );\n\t                } else {\n\t                    next();\n\t                }\n\t            }\n\t        ]);\n\t        return view;\n\t    },\n\t\n\t    /** get views based on model.id */\n\t    viewFromModelId : function( id ){\n\t        for( var i = 0; i < this.views.length; i++ ){\n\t            if( this.views[i].model.id === id ){\n\t                return this.views[i];\n\t            }\n\t        }\n\t        return undefined;\n\t    },\n\t\n\t    /** get views based on model */\n\t    viewFromModel : function( model ){\n\t        if( !model ){ return undefined; }\n\t        return this.viewFromModelId( model.id );\n\t    },\n\t\n\t    /** get views based on model properties */\n\t    viewsWhereModel : function( properties ){\n\t        return this.views.filter( function( view ){\n\t            //return view.model.matches( properties );\n\t//TODO: replace with _.matches (underscore 1.6.0)\n\t            var json = view.model.toJSON();\n\t            for( var key in properties ){\n\t                if( properties.hasOwnProperty( key ) ){\n\t                    if( json[ key ] !== view.model.get( key ) ){\n\t                        return false;\n\t                    }\n\t                }\n\t            }\n\t            return true;\n\t        });\n\t    },\n\t\n\t    /** A range of views between (and including) viewA and viewB */\n\t    viewRange : function( viewA, viewB ){\n\t        if( viewA === viewB ){ return ( viewA )?( [ viewA ] ):( [] ); }\n\t\n\t        var indexA = this.views.indexOf( viewA ),\n\t            indexB = this.views.indexOf( viewB );\n\t\n\t        // handle not found\n\t        if( indexA === -1 || indexB === -1 ){\n\t            if( indexA === indexB ){ return []; }\n\t            return ( indexA === -1 )?( [ viewB ] ):( [ viewA ] );\n\t        }\n\t        // reverse if indeces are\n\t        //note: end inclusive\n\t        return ( indexA < indexB )?\n\t            this.views.slice( indexA, indexB + 1 ) :\n\t            this.views.slice( indexB, indexA + 1 );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ searching\n\t    /** render a search input for filtering datasets shown\n\t     *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n\t     *      return will start the search\n\t     *      esc will clear the search\n\t     *      clicking the clear button will clear the search\n\t     *      uses searchInput in ui.js\n\t     */\n\t    _renderSearch : function( $where ){\n\t        $where.find( '.controls .search-input' ).searchInput({\n\t            placeholder     : this.searchPlaceholder,\n\t            initialVal      : this.searchFor,\n\t            onfirstsearch   : _.bind( this._firstSearch, this ),\n\t            onsearch        : _.bind( this.searchItems, this ),\n\t            onclear         : _.bind( this.clearSearch, this )\n\t        });\n\t        return $where;\n\t    },\n\t\n\t    /** What to do on the first search entered */\n\t    _firstSearch : function( searchFor ){\n\t        // override to load model details if necc.\n\t        this.log( 'onFirstSearch', searchFor );\n\t        return this.searchItems( searchFor );\n\t    },\n\t\n\t    /** filter view list to those that contain the searchFor terms */\n\t    searchItems : function( searchFor ){\n\t        this.searchFor = searchFor;\n\t        this.trigger( 'search:searching', searchFor, this );\n\t        this.renderItems();\n\t        this.$( '> .controls .search-query' ).val( searchFor );\n\t        return this;\n\t    },\n\t\n\t    /** clear the search filters and show all views that are normally shown */\n\t    clearSearch : function( searchFor ){\n\t        //this.log( 'onSearchClear', this );\n\t        this.searchFor = '';\n\t        this.trigger( 'search:clear', this );\n\t        this.$( '> .controls .search-query' ).val( '' );\n\t        this.renderItems();\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ selection\n\t    /** show selectors on all visible itemViews and associated controls */\n\t    showSelectors : function( speed ){\n\t        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n\t        this.selecting = true;\n\t        this.$( '.list-actions' ).slideDown( speed );\n\t        _.each( this.views, function( view ){\n\t            view.showSelector( speed );\n\t        });\n\t        //this.selected = [];\n\t        //this.lastSelected = null;\n\t    },\n\t\n\t    /** hide selectors on all visible itemViews and associated controls */\n\t    hideSelectors : function( speed ){\n\t        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n\t        this.selecting = false;\n\t        this.$( '.list-actions' ).slideUp( speed );\n\t        _.each( this.views, function( view ){\n\t            view.hideSelector( speed );\n\t        });\n\t        this.selected = [];\n\t        this.lastSelected = null;\n\t    },\n\t\n\t    /** show or hide selectors on all visible itemViews and associated controls */\n\t    toggleSelectors : function(){\n\t        if( !this.selecting ){\n\t            this.showSelectors();\n\t        } else {\n\t            this.hideSelectors();\n\t        }\n\t    },\n\t\n\t    /** select all visible items */\n\t    selectAll : function( event ){\n\t        _.each( this.views, function( view ){\n\t            view.select( event );\n\t        });\n\t    },\n\t\n\t    /** deselect all visible items */\n\t    deselectAll : function( event ){\n\t        this.lastSelected = null;\n\t        _.each( this.views, function( view ){\n\t            view.deselect( event );\n\t        });\n\t    },\n\t\n\t    /** select a range of datasets between A and B */\n\t    selectRange : function( viewA, viewB ){\n\t        var range = this.viewRange( viewA, viewB );\n\t        _.each( range, function( view ){\n\t            view.select();\n\t        });\n\t        return range;\n\t    },\n\t\n\t    /** return an array of all currently selected itemViews */\n\t    getSelectedViews : function(){\n\t        return _.filter( this.views, function( v ){\n\t            return v.selected;\n\t        });\n\t    },\n\t\n\t    /** return a collection of the models of all currenly selected items */\n\t    getSelectedModels : function(){\n\t        return new this.collection.constructor( _.map( this.getSelectedViews(), function( view ){\n\t            return view.model;\n\t        }));\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ loading indicator\n\t//TODO: questionable\n\t    /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n\t    _showLoadingIndicator : function( msg, speed, callback ){\n\t        this.debug( '_showLoadingIndicator', this.indicator, msg, speed, callback );\n\t        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n\t        if( !this.indicator ){\n\t            this.indicator = new LoadingIndicator( this.$el, this.$el.parent() );\n\t            this.debug( '\\t created', this.indicator );\n\t        }\n\t        if( !this.$el.is( ':visible' ) ){\n\t            this.indicator.show( 0, callback );\n\t        } else {\n\t            this.$el.fadeOut( speed );\n\t            this.indicator.show( msg, speed, callback );\n\t        }\n\t    },\n\t\n\t    /** hide the loading indicator */\n\t    _hideLoadingIndicator : function( speed, callback ){\n\t        this.debug( '_hideLoadingIndicator', this.indicator, speed, callback );\n\t        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n\t        if( this.indicator ){\n\t            this.indicator.hide( speed, callback );\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ scrolling\n\t    /** get the current scroll position of the panel in its parent */\n\t    scrollPosition : function(){\n\t        return this.$scrollContainer().scrollTop();\n\t    },\n\t\n\t    /** set the current scroll position of the panel in its parent */\n\t    scrollTo : function( pos, speed ){\n\t        speed = speed || 0;\n\t        this.$scrollContainer().animate({ scrollTop: pos }, speed );\n\t        return this;\n\t    },\n\t\n\t    /** Scrolls the panel to the top. */\n\t    scrollToTop : function( speed ){\n\t        return this.scrollTo( 0, speed );\n\t    },\n\t\n\t    /**  */\n\t    scrollToItem : function( view, speed ){\n\t        if( !view ){ return this; }\n\t        //var itemTop = view.$el.offset().top;\n\t        var itemTop = view.$el.position().top;\n\t        return this.scrollTo( itemTop, speed );\n\t    },\n\t\n\t    /** Scrolls the panel to show the content with the given id. */\n\t    scrollToId : function( id, speed ){\n\t        return this.scrollToItem( this.viewFromModelId( id ), speed );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel events\n\t    /** event map */\n\t    events : {\n\t        'click .select-all'     : 'selectAll',\n\t        'click .deselect-all'   : 'deselectAll'\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ misc\n\t    /** Return a string rep of the panel */\n\t    toString : function(){\n\t        return 'ListPanel(' + this.collection + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tListPanel.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var elTemplate = BASE_MVC.wrapTemplate([\n\t        // temp container\n\t        '<div>',\n\t            '<div class=\"controls\"></div>',\n\t            '<div class=\"list-items\"></div>',\n\t            '<div class=\"empty-message infomessagesmall\"></div>',\n\t        '</div>'\n\t    ]);\n\t\n\t    var controlsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"controls\">',\n\t            '<div class=\"title\">',\n\t                '<div class=\"name\"><%= view.title %></div>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"><%= view.subtitle %></div>',\n\t            // buttons, controls go here\n\t            '<div class=\"actions\"></div>',\n\t            // deleted msg, etc.\n\t            '<div class=\"messages\"></div>',\n\t\n\t            '<div class=\"search\">',\n\t                '<div class=\"search-input\"></div>',\n\t            '</div>',\n\t\n\t            // show when selectors are shown\n\t            '<div class=\"list-actions\">',\n\t                '<div class=\"btn-group\">',\n\t                    '<button class=\"select-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n\t                    '<button class=\"deselect-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n\t                '</div>',\n\t                '<div class=\"list-action-menu btn-group\">',\n\t                '</div>',\n\t            '</div>',\n\t        '</div>'\n\t    ]);\n\t\n\t    return {\n\t        el          : elTemplate,\n\t        controls    : controlsTemplate\n\t    };\n\t}());\n\t\n\t\n\t//=============================================================================\n\t/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n\t *  Allows:\n\t *      the model to be reset\n\t *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n\t *\n\t */\n\tvar ModelListPanel = ListPanel.extend({\n\t\n\t    /** key of attribute in model to assign to this.collection */\n\t    modelCollectionKey : 'contents',\n\t\n\t    initialize : function( attributes ){\n\t        ListPanel.prototype.initialize.call( this, attributes );\n\t        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : false;\n\t\n\t        this.setModel( this.model, attributes );\n\t    },\n\t\n\t    /** release/free/shutdown old models and set up panel for new models\n\t     *  @fires new-model with the panel as parameter\n\t     */\n\t    setModel : function( model, attributes ){\n\t        attributes = attributes || {};\n\t        this.debug( this + '.setModel:', model, attributes );\n\t\n\t        this.freeModel();\n\t        this.freeViews();\n\t\n\t        if( model ){\n\t            var oldModelId = this.model? this.model.get( 'id' ): null;\n\t\n\t            // set up the new model with user, logger, storage, events\n\t            this.model = model;\n\t            if( this.logger ){\n\t                this.model.logger = this.logger;\n\t            }\n\t            this._setUpModelListeners();\n\t\n\t//TODO: relation btwn model, collection becoming tangled here\n\t            // free the collection, and assign the new collection to either\n\t            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n\t            this.collection.off();\n\t            this.collection = ( this.model[ this.modelCollectionKey ] )?\n\t                this.model[ this.modelCollectionKey ]:\n\t                ( attributes.collection || ( new this.collectionClass([]) ) );\n\t            this._setUpCollectionListeners();\n\t\n\t            if( oldModelId && model.get( 'id' ) !== oldModelId  ){\n\t                this.trigger( 'new-model', this );\n\t            }\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** free the current model and all listeners for it, free any views for the model */\n\t    freeModel : function(){\n\t        // stop/release the previous model, and clear cache to sub-views\n\t        if( this.model ){\n\t            this.stopListening( this.model );\n\t            //TODO: see base-mvc\n\t            //this.model.free();\n\t            //this.model = null;\n\t        }\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ listening\n\t    /** listening for model events */\n\t    _setUpModelListeners : function(){\n\t        // override\n\t        this.log( this + '._setUpModelListeners', this.model );\n\t        // bounce model errors up to the panel\n\t        this.model.on( 'error', function(){\n\t            var args = Array.prototype.slice.call( arguments, 0 );\n\t            //args.unshift( 'model:error' );\n\t            args.unshift( 'error' );\n\t            this.trigger.apply( this, args );\n\t        }, this );\n\t        return this;\n\t    },\n\t\n\t    /** Build a temp div containing the new children for the view's $el.\n\t     */\n\t    _renderControls : function( $newRender ){\n\t        this.debug( this + '(ListPanel)._renderControls' );\n\t        var json = this.model? this.model.toJSON() : {},\n\t            $controls = $( this.templates.controls( json, this ) );\n\t        $newRender.find( '.controls' ).replaceWith( $controls );\n\t        return $controls;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ misc\n\t    /** Return a string rep of the panel */\n\t    toString : function(){\n\t        return 'ModelListPanel(' + this.model + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tModelListPanel.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var controlsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"controls\">',\n\t            '<div class=\"title\">',\n\t//TODO: this is really the only difference - consider factoring titlebar out\n\t                '<div class=\"name\"><%= model.name %></div>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"><%= view.subtitle %></div>',\n\t            '<div class=\"actions\"></div>',\n\t            '<div class=\"messages\"></div>',\n\t\n\t            '<div class=\"search\">',\n\t                '<div class=\"search-input\"></div>',\n\t            '</div>',\n\t\n\t            '<div class=\"list-actions\">',\n\t                '<div class=\"btn-group\">',\n\t                    '<button class=\"select-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n\t                    '<button class=\"deselect-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n\t                '</div>',\n\t                '<div class=\"list-action-menu btn-group\">',\n\t                '</div>',\n\t            '</div>',\n\t        '</div>'\n\t    ]);\n\t\n\t    return _.extend( _.clone( ListPanel.prototype.templates ), {\n\t        controls : controlsTemplate\n\t    });\n\t}());\n\t\n\t\n\t//=============================================================================\n\t    return {\n\t        ListPanel      : ListPanel,\n\t        ModelListPanel : ModelListPanel\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 35 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( baseMVC, _l ){\n\t// =============================================================================\n\t/** A view on any model that has a 'tags' attribute (a list of tag strings)\n\t *      Incorporates the select2 jQuery plugin for tags display/editing:\n\t *      http://ivaynberg.github.io/select2/\n\t */\n\tvar TagsEditor = Backbone.View.extend( baseMVC.LoggableMixin ).extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n\t    \n\t    tagName     : 'div',\n\t    className   : 'tags-display',\n\t\n\t    /** Set up listeners, parse options */\n\t    initialize : function( options ){\n\t        //console.debug( this, options );\n\t        // only listen to the model only for changes to tags - re-render\n\t        this.listenTo( this.model, 'change:tags', function(){\n\t            this.render();\n\t        });\n\t        this.hiddenUntilActivated( options.$activator, options );\n\t    },\n\t\n\t    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n\t    render : function(){\n\t        var view = this;\n\t        this.$el.html( this._template() );\n\t\n\t        this.$input().select2({\n\t            placeholder : 'Add tags',\n\t            width       : '100%',\n\t            tags : function(){\n\t                // initialize possible tags in the dropdown based on all the tags the user has used so far\n\t                return view._getTagsUsed();\n\t            }\n\t        });\n\t\n\t        this._setUpBehaviors();\n\t        return this;\n\t    },\n\t\n\t    /** @returns {String} the html text used to build the view's DOM */\n\t    _template : function(){\n\t        return [\n\t            //TODO: make prompt optional\n\t            '<label class=\"prompt\">', _l( 'Tags' ), '</label>',\n\t            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n\t            '<input class=\"tags-input\" value=\"', this.tagsToCSV(), '\" />'\n\t        ].join( '' );\n\t    },\n\t\n\t    /** @returns {String} the sorted, comma-separated tags from the model */\n\t    tagsToCSV : function(){\n\t        var tagsArray = this.model.get( 'tags' );\n\t        if( !_.isArray( tagsArray ) || _.isEmpty( tagsArray ) ){\n\t            return '';\n\t        }\n\t        return tagsArray.map( function( tag ){\n\t            return _.escape( tag );\n\t        }).sort().join( ',' );\n\t    },\n\t\n\t    /** @returns {jQuery} the input for this view */\n\t    $input : function(){\n\t        return this.$el.find( 'input.tags-input' );\n\t    },\n\t\n\t    /** @returns {String[]} all tags used by the current user */\n\t    _getTagsUsed : function(){\n\t//TODO: global\n\t        return Galaxy.currUser.get( 'tags_used' );\n\t    },\n\t\n\t    /** set up any event listeners on the view's DOM (mostly handled by select2) */\n\t    _setUpBehaviors : function(){\n\t        var view = this;\n\t        this.$input().on( 'change', function( event ){\n\t            // save the model's tags in either remove or added event\n\t            view.model.save({ tags: event.val }, { silent: true });\n\t            // if it's new, add the tag to the users tags\n\t            if( event.added ){\n\t                //??: solve weird behavior in FF on test.galaxyproject.org where\n\t                //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n\t                view._addNewTagToTagsUsed( event.added.text + '' );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** add a new tag (if not already there) to the list of all tags used by the user\n\t     *  @param {String} newTag  the tag to add to the list of used\n\t     */\n\t    _addNewTagToTagsUsed : function( newTag ){\n\t//TODO: global\n\t        var tagsUsed = Galaxy.currUser.get( 'tags_used' );\n\t        if( !_.contains( tagsUsed, newTag ) ){\n\t            tagsUsed.push( newTag );\n\t            tagsUsed.sort();\n\t            Galaxy.currUser.set( 'tags_used', tagsUsed );\n\t        }\n\t    },\n\t\n\t    /** shut down event listeners and remove this view's DOM */\n\t    remove : function(){\n\t        this.$input.off();\n\t        this.stopListening( this.model );\n\t        Backbone.View.prototype.remove.call( this );\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){ return [ 'TagsEditor(', this.model + '', ')' ].join(''); }\n\t});\n\t\n\t// =============================================================================\n\treturn {\n\t    TagsEditor : TagsEditor\n\t};\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 36 */,\n/* 37 */,\n/* 38 */,\n/* 39 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(5),\n\t    __webpack_require__(9),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( _, Backbone, baseMVC, _l ){\n\t//==============================================================================\n\t/** @class Model for a Galaxy user (including anonymous users).\n\t *  @name User\n\t *\n\t *  @augments Backbone.Model\n\t *  @borrows LoggableMixin#logger as #logger\n\t *  @borrows LoggableMixin#log as #log\n\t *  @constructs\n\t */\n\tvar User = Backbone.Model.extend( baseMVC.LoggableMixin ).extend(\n\t/** @lends User.prototype */{\n\t\n\t    ///** logger used to record this.log messages, commonly set to console */\n\t    //// comment this out to suppress log output\n\t    //logger              : console,\n\t\n\t    /** API location for this resource */\n\t    urlRoot : function(){ return Galaxy.options.root + 'api/users'; },\n\t\n\t    /** Model defaults\n\t     *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n\t     *      a safer method is if( !user.get( 'email' ) ) -> anon user\n\t     */\n\t    defaults : /** @lends User.prototype */{\n\t        id                      : null,\n\t        username                : '(' + _l( \"anonymous user\" ) + ')',\n\t        email                   : \"\",\n\t        total_disk_usage        : 0,\n\t        nice_total_disk_usage   : \"\",\n\t        quota_percent           : null,\n\t        is_admin                : false\n\t    },\n\t\n\t    /** Set up and bind events\n\t     *  @param {Object} data Initial model data.\n\t     */\n\t    initialize : function( data ){\n\t        this.log( 'User.initialize:', data );\n\t\n\t        this.on( 'loaded', function( model, resp ){ this.log( this + ' has loaded:', model, resp ); });\n\t        this.on( 'change', function( model, data ){ this.log( this + ' has changed:', model, data.changes ); });\n\t    },\n\t\n\t    isAnonymous : function(){\n\t        return ( !this.get( 'email' ) );\n\t    },\n\t\n\t    isAdmin : function(){\n\t        return ( this.get( 'is_admin' ) );\n\t    },\n\t\n\t    /** Load a user with the API using an id.\n\t     *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n\t     *      (e.g. 'current') and the API will return the current transaction's user data.\n\t     *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n\t     *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n\t     *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n\t     */\n\t    loadFromApi : function( idOrCurrent, options ){\n\t        idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\t\n\t        options = options || {};\n\t        var model = this,\n\t            userFn = options.success;\n\t\n\t        /** @ignore */\n\t        options.success = function( newModel, response ){\n\t            model.trigger( 'loaded', newModel, response );\n\t            if( userFn ){ userFn( newModel, response ); }\n\t        };\n\t\n\t        // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n\t        if( idOrCurrent === User.CURRENT_ID_STR ){\n\t            options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n\t        }\n\t        return Backbone.Model.prototype.fetch.call( this, options );\n\t    },\n\t\n\t    /** Clears all data from the sessionStorage.\n\t     */\n\t    clearSessionStorage : function(){\n\t        for( var key in sessionStorage ){\n\t            //TODO: store these under the user key so we don't have to do this\n\t            // currently only history\n\t            if( key.indexOf( 'history:' ) === 0 ){\n\t                sessionStorage.removeItem( key );\n\t\n\t            } else if( key === 'history-panel' ){\n\t                sessionStorage.removeItem( key );\n\t            }\n\t        }\n\t    },\n\t\n\t    /** string representation */\n\t    toString : function(){\n\t        var userInfo = [ this.get( 'username' ) ];\n\t        if( this.get( 'id' ) ){\n\t            userInfo.unshift( this.get( 'id' ) );\n\t            userInfo.push( this.get( 'email' ) );\n\t        }\n\t        return 'User(' + userInfo.join( ':' ) + ')';\n\t    }\n\t});\n\t\n\t// string to send to tell server to return this transaction's user (see api/users.py)\n\tUser.CURRENT_ID_STR = 'current';\n\t\n\t// class method to load the current user via the api and return that model\n\tUser.getCurrentUserFromApi = function( options ){\n\t    var currentUser = new User();\n\t    currentUser.loadFromApi( User.CURRENT_ID_STR, options );\n\t    return currentUser;\n\t};\n\t\n\t// (stub) collection for users (shouldn't be common unless admin UI)\n\tvar UserCollection = Backbone.Collection.extend( baseMVC.LoggableMixin ).extend({\n\t    model   : User,\n\t    urlRoot : function(){ return Galaxy.options.root + 'api/users'; },\n\t    //logger  : console,\n\t});\n\t\n\t\n\t//==============================================================================\n\treturn {\n\t    User : User\n\t};}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 40 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (factory) {\n\t    if (true) {\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        factory(jQuery);\n\t    }\n\t\n\t}(function () {\n\t//=============================================================================\n\t\n\t    jQuery.fn.extend({\n\t        hoverhighlight : function $hoverhighlight( scope, color ){\n\t            scope = scope || 'body';\n\t            if( !this.size() ){ return this; }\n\t\n\t            $( this ).each( function(){\n\t                var $this = $( this ),\n\t                    targetSelector = $this.data( 'target' );\n\t\n\t                if( targetSelector ){\n\t                    $this.mouseover( function( ev ){\n\t                        $( targetSelector, scope ).css({\n\t                            background: color\n\t                        });\n\t                    })\n\t                    .mouseout( function( ev ){\n\t                        $( targetSelector ).css({\n\t                            background: ''\n\t                        });\n\t                    });\n\t                }\n\t            });\n\t            return this;\n\t        }\n\t    });\n\t}));\n\n\n/***/ },\n/* 41 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n\t// Uses AMD or browser globals to create a jQuery plugin.\n\t(function (factory) {\n\t    if (true) {\n\t        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n\t        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n\t        //  relying on jquery being loaded globally* in order to preserve plugins.\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        factory(jQuery);\n\t    }\n\t\n\t}(function () {\n\t    var _l = window._l || function( s ){ return s; };\n\t\n\t    /** searchInput: (jQuery plugin)\n\t     *      Creates a search input, a clear button, and loading indicator\n\t     *      within the selected node.\n\t     *\n\t     *      When the user either presses return or enters some minimal number\n\t     *      of characters, a callback is called. Pressing ESC when the input\n\t     *      is focused will clear the input and call a separate callback.\n\t     */\n\t    function searchInput( parentNode, options ){\n\t//TODO: consolidate with tool menu functionality, use there\n\t        var KEYCODE_ESC     = 27,\n\t            KEYCODE_RETURN  = 13,\n\t            $parentNode     = $( parentNode ),\n\t            firstSearch     = true,\n\t            defaults = {\n\t                initialVal      : '',\n\t                name            : 'search',\n\t                placeholder     : 'search',\n\t                classes         : '',\n\t                onclear         : function(){},\n\t                onfirstsearch   : null,\n\t                onsearch        : function( inputVal ){},\n\t                minSearchLen    : 0,\n\t                escWillClear    : true,\n\t                oninit          : function(){}\n\t            };\n\t\n\t        // .................................................................... input rendering and events\n\t        // visually clear the search, trigger an event, and call the callback\n\t        function clearSearchInput( event ){\n\t            var $input = $( this ).parent().children( 'input' );\n\t            //console.debug( this, 'clear', $input );\n\t            $input.focus().val( '' ).trigger( 'clear:searchInput' );\n\t            options.onclear();\n\t        }\n\t\n\t        // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n\t        function search( event, searchTerms ){\n\t            //console.debug( this, 'searching', searchTerms );\n\t            //TODO: I don't think this is classic jq custom event form? search.searchInput?\n\t            $( this ).trigger( 'search:searchInput', searchTerms );\n\t            if( typeof options.onfirstsearch === 'function' && firstSearch ){\n\t                firstSearch = false;\n\t                options.onfirstsearch( searchTerms );\n\t            } else {\n\t                options.onsearch( searchTerms );\n\t            }\n\t        }\n\t\n\t        // .................................................................... input rendering and events\n\t        function inputTemplate(){\n\t            // class search-query is bootstrap 2.3 style that now lives in base.less\n\t            return [ '<input type=\"text\" name=\"', options.name, '\" placeholder=\"', options.placeholder, '\" ',\n\t                            'class=\"search-query ', options.classes, '\" ', '/>' ].join( '' );\n\t        }\n\t\n\t        // the search input that responds to keyboard events and displays the search value\n\t        function $input(){\n\t            return $( inputTemplate() )\n\t                // select all text on a focus\n\t                .focus( function( event ){\n\t                    $( this ).select();\n\t                })\n\t                // attach behaviors to esc, return if desired, search on some min len string\n\t                .keyup( function( event ){\n\t                    event.preventDefault();\n\t                    event.stopPropagation();\n\t//TODO: doesn't work\n\t                    if( !$( this ).val() ){ $( this ).blur(); }\n\t\n\t                    // esc key will clear if desired\n\t                    if( event.which === KEYCODE_ESC && options.escWillClear ){\n\t                        clearSearchInput.call( this, event );\n\t\n\t                    } else {\n\t                        var searchTerms = $( this ).val();\n\t                        // return key or the search string len > minSearchLen (if not 0) triggers search\n\t                        if( ( event.which === KEYCODE_RETURN )\n\t                        ||  ( options.minSearchLen && searchTerms.length >= options.minSearchLen ) ){\n\t                            search.call( this, event, searchTerms );\n\t                        } else if( !searchTerms.length ){\n\t                            clearSearchInput.call( this, event );\n\t                        }\n\t                    }\n\t                })\n\t                .on( 'change', function( event ){\n\t                    search.call( this, event, $( this ).val() );\n\t                })\n\t                .val( options.initialVal );\n\t        }\n\t\n\t        // .................................................................... clear button rendering and events\n\t        // a button for clearing the search bar, placed on the right hand side\n\t        function $clearBtn(){\n\t            return $([ '<span class=\"search-clear fa fa-times-circle\" ',\n\t                             'title=\"', _l( 'clear search (esc)' ), '\"></span>' ].join('') )\n\t            .tooltip({ placement: 'bottom' })\n\t            .click( function( event ){\n\t                clearSearchInput.call( this, event );\n\t            });\n\t        }\n\t\n\t        // .................................................................... loadingIndicator rendering\n\t        // a button for clearing the search bar, placed on the right hand side\n\t        function $loadingIndicator(){\n\t            return $([ '<span class=\"search-loading fa fa-spinner fa-spin\" ',\n\t                             'title=\"', _l( 'loading...' ), '\"></span>' ].join('') )\n\t                .hide().tooltip({ placement: 'bottom' });\n\t        }\n\t\n\t        // .................................................................... commands\n\t        // visually swap the load, clear buttons\n\t        function toggleLoadingIndicator(){\n\t            $parentNode.find( '.search-loading' ).toggle();\n\t            $parentNode.find( '.search-clear' ).toggle();\n\t        }\n\t\n\t        // .................................................................... init\n\t        // string command (not constructor)\n\t        if( jQuery.type( options ) === 'string' ){\n\t            if( options === 'toggle-loading' ){\n\t                toggleLoadingIndicator();\n\t            }\n\t            return $parentNode;\n\t        }\n\t\n\t        // initial render\n\t        if( jQuery.type( options ) === 'object' ){\n\t            options = jQuery.extend( true, {}, defaults, options );\n\t        }\n\t        //NOTE: prepended\n\t        return $parentNode.addClass( 'search-input' ).prepend([ $input(), $clearBtn(), $loadingIndicator() ]);\n\t    }\n\t\n\t    // as jq plugin\n\t    jQuery.fn.extend({\n\t        searchInput : function $searchInput( options ){\n\t            return this.each( function(){\n\t                return searchInput( this, options );\n\t            });\n\t        }\n\t    });\n\t}));\n\n\n/***/ },\n/* 42 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function(){\n\t// Alphanumeric/natural sort fn\n\tfunction naturalSort(a, b) {\n\t    // setup temp-scope variables for comparison evauluation\n\t    var re = /(-?[0-9\\.]+)/g,\n\t        x = a.toString().toLowerCase() || '',\n\t        y = b.toString().toLowerCase() || '',\n\t        nC = String.fromCharCode(0),\n\t        xN = x.replace( re, nC + '$1' + nC ).split(nC),\n\t        yN = y.replace( re, nC + '$1' + nC ).split(nC),\n\t        xD = (new Date(x)).getTime(),\n\t        yD = xD ? (new Date(y)).getTime() : null;\n\t    // natural sorting of dates\n\t    if ( yD ) {\n\t        if ( xD < yD ) { return -1; }\n\t        else if ( xD > yD ) { return 1; }\n\t    }\n\t    // natural sorting through split numeric strings and default strings\n\t    var oFxNcL, oFyNcL;\n\t    for ( var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++ ) {\n\t        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n\t        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n\t        if (oFxNcL < oFyNcL) { return -1; }\n\t        else if (oFxNcL > oFyNcL) { return 1; }\n\t    }\n\t    return 0;\n\t}\n\t\n\treturn naturalSort;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))\n\n\n/***/ },\n/* 43 */,\n/* 44 */,\n/* 45 */,\n/* 46 */,\n/* 47 */,\n/* 48 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;// dependencies\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(23)], __WEBPACK_AMD_DEFINE_RESULT__ = function( Masthead ) {\n\t\n\t/** GalaxyMenu uses the GalaxyMasthead class in order to add menu items and icons to the Masthead **/\n\tvar GalaxyMenu = Backbone.Model.extend({\n\t    initialize: function( options ) {\n\t        this.options = options.config;\n\t        this.masthead  = options.masthead;\n\t        this.create();\n\t    },\n\t\n\t    // default menu\n\t    create: function() {\n\t        //\n\t        // Analyze data tab.\n\t        //\n\t        var tab_analysis = new Masthead.GalaxyMastheadTab({\n\t            id              : 'analysis',\n\t            title           : 'Analyze Data',\n\t            content         : '',\n\t            title_attribute : 'Analysis home view'\n\t        });\n\t        this.masthead.append( tab_analysis );\n\t\n\t        //\n\t        // Workflow tab.\n\t        //\n\t\n\t        var workflow_options = {\n\t            id              : 'workflow',\n\t            title           : 'Workflow',\n\t            content         : 'workflow',\n\t            title_attribute : 'Chain tools into workflows'\n\t        }\n\t        if ( !Galaxy.user.id ) {\n\t            workflow_options.disabled = true; // disable workflows for anonymous users\n\t        }\n\t\n\t        var tab_workflow = new Masthead.GalaxyMastheadTab( workflow_options );\n\t        this.masthead.append( tab_workflow );\n\t\n\t        //\n\t        // 'Shared Items' or Libraries tab.\n\t        //\n\t        var tab_shared = new Masthead.GalaxyMastheadTab({\n\t            id              : 'shared',\n\t            title           : 'Shared Data',\n\t            content         : 'library/index',\n\t            title_attribute : 'Access published resources'\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Data Libraries',\n\t            content : 'library/index'\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Data Libraries Beta',\n\t            content : 'library/list',\n\t            divider : true\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Published Histories',\n\t            content : 'history/list_published'\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Published Workflows',\n\t            content : 'workflow/list_published'\n\t\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Published Visualizations',\n\t            content : 'visualization/list_published'\n\t        });\n\t\n\t        tab_shared.add({\n\t            title   : 'Published Pages',\n\t            content : 'page/list_published'\n\t        });\n\t\n\t        this.masthead.append(tab_shared);\n\t\n\t        //\n\t        // Lab menu.\n\t        //\n\t        if ( this.options.user_requests ) {\n\t            var tab_lab = new Masthead.GalaxyMastheadTab({\n\t                id      : 'lab',\n\t                title   : 'Lab'\n\t            });\n\t            tab_lab.add({\n\t                title   : 'Sequencing Requests',\n\t                content : 'requests/index'\n\t            });\n\t            tab_lab.add({\n\t                title   : 'Find Samples',\n\t                content : 'requests/find_samples_index'\n\t            });\n\t            tab_lab.add({\n\t                title   : 'Help',\n\t                content : this.options.lims_doc_url\n\t            });\n\t            this.masthead.append( tab_lab );\n\t        }\n\t\n\t        //\n\t        // Visualization tab.\n\t        //\n\t\n\t        var visualization_options = {\n\t            id              : 'visualization',\n\t            title           : 'Visualization',\n\t            content         : 'visualization/list',\n\t            title_attribute : 'Visualize datasets'\n\t        }\n\t\n\t        // disable visualizations for anonymous users\n\t        if ( !Galaxy.user.id ) {\n\t            visualization_options.disabled = true;\n\t        }\n\t        var tab_visualization = new Masthead.GalaxyMastheadTab( visualization_options );\n\t\n\t        // add submenu only when user is logged in\n\t        if ( Galaxy.user.id ) {\n\t            tab_visualization.add({\n\t                title   : 'New Track Browser',\n\t                content : 'visualization/trackster',\n\t                target  : '_frame'\n\t            });\n\t            tab_visualization.add({\n\t                title   : 'Saved Visualizations',\n\t                content : 'visualization/list',\n\t                target  : '_frame'\n\t            });\n\t        }\n\t        this.masthead.append( tab_visualization );\n\t\n\t        //\n\t        // Admin.\n\t        //\n\t        if ( Galaxy.user.get( 'is_admin' ) ) {\n\t            var tab_admin = new Masthead.GalaxyMastheadTab({\n\t                id              : 'admin',\n\t                title           : 'Admin',\n\t                content         : 'admin',\n\t                extra_class     : 'admin-only',\n\t                title_attribute : 'Administer this Galaxy'\n\t            });\n\t            this.masthead.append( tab_admin );\n\t        }\n\t\n\t        //\n\t        // Help tab.\n\t        //\n\t        var tab_help = new Masthead.GalaxyMastheadTab({\n\t            id              : 'help',\n\t            title           : 'Help',\n\t            title_attribute : 'Support, contact, and community hubs'\n\t        });\n\t        if ( this.options.biostar_url ){\n\t            tab_help.add({\n\t                title   : 'Galaxy Biostar',\n\t                content : this.options.biostar_url_redirect,\n\t                target  : '_blank'\n\t            });\n\t            tab_help.add({\n\t                title   : 'Ask a question',\n\t                content : 'biostar/biostar_question_redirect',\n\t                target  : '_blank'\n\t            });\n\t        }\n\t        tab_help.add({\n\t            title   : 'Support',\n\t            content : this.options.support_url,\n\t            target  : '_blank'\n\t        });\n\t        tab_help.add({\n\t            title   : 'Search',\n\t            content : this.options.search_url,\n\t            target  : '_blank'\n\t        });\n\t        tab_help.add({\n\t            title   : 'Mailing Lists',\n\t            content : this.options.mailing_lists,\n\t            target  : '_blank'\n\t        });\n\t        tab_help.add({\n\t            title   : 'Videos',\n\t            content : this.options.screencasts_url,\n\t            target  : '_blank'\n\t        });\n\t        tab_help.add({\n\t            title   : 'Wiki',\n\t            content : this.options.wiki_url,\n\t            target  : '_blank'\n\t        });\n\t        tab_help.add({\n\t            title   : 'How to Cite Galaxy',\n\t            content : this.options.citation_url,\n\t            target  : '_blank'\n\t        });\n\t        if (this.options.terms_url){\n\t            tab_help.add({\n\t                title   : 'Terms and Conditions',\n\t                content : this.options.terms_url,\n\t                target  : '_blank'\n\t            });\n\t        }\n\t        this.masthead.append( tab_help );\n\t\n\t        //\n\t        // User tab.\n\t        //\n\t        if ( !Galaxy.user.id ){\n\t            var tab_user = new Masthead.GalaxyMastheadTab({\n\t                id              : 'user',\n\t                title           : 'User',\n\t                extra_class     : 'loggedout-only',\n\t                title_attribute : 'Account registration or login'\n\t            });\n\t\n\t            // login\n\t            tab_user.add({\n\t                title   : 'Login',\n\t                content : 'user/login',\n\t                target  : 'galaxy_main'\n\t            });\n\t\n\t            // register\n\t            if ( this.options.allow_user_creation ){\n\t                tab_user.add({\n\t                    title   : 'Register',\n\t                    content : 'user/create',\n\t                    target  : 'galaxy_main'\n\t                });\n\t            }\n\t\n\t            // add to masthead\n\t            this.masthead.append( tab_user );\n\t        } else {\n\t            var tab_user = new Masthead.GalaxyMastheadTab({\n\t                id              : 'user',\n\t                title           : 'User',\n\t                extra_class     : 'loggedin-only',\n\t                title_attribute : 'Account preferences and saved data'\n\t            });\n\t\n\t            // show user logged in info\n\t            tab_user.add({\n\t                title   : 'Logged in as ' + Galaxy.user.get( 'email' )\n\t            });\n\t\n\t            tab_user.add({\n\t                title   : 'Preferences',\n\t                content : 'user?cntrller=user',\n\t                target  : 'galaxy_main'\n\t            });\n\t\n\t            tab_user.add({\n\t                title   : 'Custom Builds',\n\t                content : 'user/dbkeys',\n\t                target  : 'galaxy_main'\n\t            });\n\t\n\t            tab_user.add({\n\t                title   : 'Logout',\n\t                content : 'user/logout',\n\t                target  : '_top',\n\t                divider : true\n\t            });\n\t\n\t            // default tabs\n\t            tab_user.add({\n\t                title   : 'Saved Histories',\n\t                content : 'history/list',\n\t                target  : 'galaxy_main'\n\t            });\n\t            tab_user.add({\n\t                title   : 'Saved Datasets',\n\t                content : 'dataset/list',\n\t                target  : 'galaxy_main'\n\t            });\n\t            tab_user.add({\n\t                title   : 'Saved Pages',\n\t                content : 'page/list',\n\t                target  : '_top'\n\t            });\n\t\n\t            tab_user.add({\n\t                title   : 'API Keys',\n\t                content : 'user/api_keys?cntrller=user',\n\t                target  : 'galaxy_main'\n\t            });\n\t\n\t            if ( this.options.use_remote_user ){\n\t                tab_user.add({\n\t                    title   : 'Public Name',\n\t                    content : 'user/edit_username?cntrller=user',\n\t                    target  : 'galaxy_main'\n\t                });\n\t            }\n\t\n\t            // add to masthead\n\t            this.masthead.append( tab_user );\n\t        }\n\t\n\t        // identify active tab\n\t        if ( this.options.active_view ) {\n\t            this.masthead.highlight( this.options.active_view );\n\t        }\n\t    }\n\t});\n\t\n\t// return\n\treturn {\n\t    GalaxyMenu: GalaxyMenu\n\t};\n\t\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 49 */,\n/* 50 */,\n/* 51 */,\n/* 52 */,\n/* 53 */,\n/* 54 */,\n/* 55 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(12),\n\t    __webpack_require__(28),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DC_LI, DATASET_LI_EDIT, BASE_MVC, _l ){\n\t/* global Backbone, LoggableMixin */\n\t//==============================================================================\n\tvar DCListItemView = DC_LI.DCListItemView;\n\t/** @class Edit view for DatasetCollection.\n\t */\n\tvar DCListItemEdit = DCListItemView.extend(\n\t/** @lends DCListItemEdit.prototype */{\n\t//TODO: may not be needed\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** override to add linkTarget */\n\t    initialize : function( attributes ){\n\t        DCListItemView.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DCListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\tvar DCEListItemView = DC_LI.DCEListItemView;\n\t/** @class Read only view for DatasetCollectionElement.\n\t */\n\tvar DCEListItemEdit = DCEListItemView.extend(\n\t/** @lends DCEListItemEdit.prototype */{\n\t//TODO: this might be expendable - compacted with HDAListItemView\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** set up */\n\t    initialize  : function( attributes ){\n\t        DCEListItemView.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DCEListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n\t//TODO: but should - if we can find something simpler than using diamond\n\t/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n\t *      (a dataset contained in a dataset collection).\n\t */\n\tvar DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n\t/** @lends DatasetDCEListItemEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** set up */\n\t    initialize  : function( attributes ){\n\t        DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n\t    //TODO: fix\n\t    /** In this override, only get details if in the ready state.\n\t     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t     */\n\t    _fetchModelDetails : function(){\n\t        var view = this;\n\t        if( view.model.inReadyState() && !view.model.hasDetails() ){\n\t            return view.model.fetch({ silent: true });\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    /** Override to remove delete button */\n\t    _renderDeleteButton : function(){\n\t        return null;\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'DatasetDCEListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tDatasetDCEListItemEdit.prototype.templates = (function(){\n\t\n\t    return _.extend( {}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n\t        titleBar : DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n\t *      (a nested DC).\n\t */\n\tvar NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n\t/** @lends NestedDCDCEListItemEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    // comment this out to suppress log output\n\t    //logger              : console,\n\t\n\t    // ......................................................................... misc\n\t    /** String representation */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'NestedDCDCEListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        DCListItemEdit          : DCListItemEdit,\n\t        DCEListItemEdit         : DCEListItemEdit,\n\t        DatasetDCEListItemEdit  : DatasetDCEListItemEdit,\n\t        NestedDCDCEListItemEdit : NestedDCDCEListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 56 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(10),\n\t    __webpack_require__(13),\n\t    __webpack_require__(55),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DC_PANEL, DC_MODEL, DC_EDIT, BASE_MVC, _l ){\n\t/* =============================================================================\n\tTODO:\n\t\n\t============================================================================= */\n\t/** @class editable View/Controller for a dataset collection.\n\t */\n\tvar _super = DC_PANEL.CollectionPanel;\n\tvar CollectionPanelEdit = _super.extend(\n\t/** @lends CollectionPanel.prototype */{\n\t    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** sub view class used for datasets */\n\t    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n\t    /** sub view class used for nested collections */\n\t    NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\t\n\t    // ......................................................................... SET UP\n\t    /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t     *  @param {Object} attributes optional settings for the panel\n\t     */\n\t    initialize : function( attributes ){\n\t        _super.prototype.initialize.call( this, attributes );\n\t    },\n\t\n\t    /** In this override, make the collection name editable\n\t     */\n\t    _setUpBehaviors : function( $where ){\n\t        $where = $where || this.$el;\n\t        _super.prototype._setUpBehaviors.call( this, $where );\n\t        if( !this.model ){ return; }\n\t\n\t        // anon users shouldn't have access to any of the following\n\t        if( !Galaxy.currUser || Galaxy.currUser.isAnonymous() ){\n\t            return;\n\t        }\n\t\n\t        //TODO: extract\n\t        var panel = this,\n\t            nameSelector = '> .controls .name';\n\t        $where.find( nameSelector )\n\t            .attr( 'title', _l( 'Click to rename collection' ) )\n\t            .tooltip({ placement: 'bottom' })\n\t            .make_text_editable({\n\t                on_finish: function( newName ){\n\t                    var previousName = panel.model.get( 'name' );\n\t                    if( newName && newName !== previousName ){\n\t                        panel.$el.find( nameSelector ).text( newName );\n\t                        panel.model.save({ name: newName })\n\t                            .fail( function(){\n\t                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n\t                            });\n\t                    } else {\n\t                        panel.$el.find( nameSelector ).text( previousName );\n\t                    }\n\t                }\n\t            });\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'CollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class non-editable, read-only View/Controller for a dataset collection. */\n\tvar ListCollectionPanelEdit = CollectionPanelEdit.extend(\n\t/** @lends ListCollectionPanel.prototype */{\n\t\n\t    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n\t    /** sub view class used for datasets */\n\t    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'ListCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class Editable, read-only View/Controller for a dataset collection. */\n\tvar PairCollectionPanelEdit = ListCollectionPanelEdit.extend(\n\t/** @lends PairCollectionPanelEdit.prototype */{\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'PairCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class Editable (roughly since these collections are immutable),\n\t *  View/Controller for a dataset collection.\n\t */\n\tvar NestedPairCollectionPanelEdit = PairCollectionPanelEdit.extend(\n\t/** @lends NestedPairCollectionPanelEdit.prototype */{\n\t\n\t    /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n\t    _setUpBehaviors : function( $where ){\n\t        _super.prototype._setUpBehaviors.call( this, $where );\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'NestedPairCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t// =============================================================================\n\t/** @class non-editable, read-only View/Controller for a dataset collection. */\n\tvar ListOfPairsCollectionPanelEdit = CollectionPanelEdit.extend(\n\t/** @lends ListOfPairsCollectionPanel.prototype */{\n\t\n\t    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n\t    /** sub view class used for nested collections */\n\t    NestedDCDCEViewClass : DC_EDIT.NestedDCDCEListItemEdit.extend({\n\t        foldoutPanelClass : NestedPairCollectionPanelEdit\n\t    }),\n\t\n\t    // ........................................................................ misc\n\t    /** string rep */\n\t    toString    : function(){\n\t        return 'ListOfPairsCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        CollectionPanelEdit             : CollectionPanelEdit,\n\t        ListCollectionPanelEdit         : ListCollectionPanelEdit,\n\t        PairCollectionPanelEdit         : PairCollectionPanelEdit,\n\t        ListOfPairsCollectionPanelEdit  : ListOfPairsCollectionPanelEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 57 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(82),\n\t    __webpack_require__(42),\n\t    __webpack_require__(14),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1),\n\t    __webpack_require__(40)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( levenshteinDistance, naturalSort, LIST_COLLECTION_CREATOR, baseMVC, _l ){\n\t/* ============================================================================\n\tTODO:\n\t\n\t\n\tPROGRAMMATICALLY:\n\tcurrPanel.once( 'rendered', function(){\n\t    currPanel.showSelectors();\n\t    currPanel.selectAll();\n\t    _.last( currPanel.actionsPopup.options ).func();\n\t});\n\t\n\t============================================================================ */\n\t/** A view for paired datasets in the collections creator.\n\t */\n\tvar PairView = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n\t\n\t    tagName     : 'li',\n\t    className   : 'dataset paired',\n\t\n\t    initialize : function( attributes ){\n\t        this.pair = attributes.pair || {};\n\t    },\n\t\n\t    template : _.template([\n\t        '<span class=\"forward-dataset-name flex-column\"><%= pair.forward.name %></span>',\n\t        '<span class=\"pair-name-column flex-column\">',\n\t            '<span class=\"pair-name\"><%= pair.name %></span>',\n\t        '</span>',\n\t        '<span class=\"reverse-dataset-name flex-column\"><%= pair.reverse.name %></span>'\n\t    ].join('')),\n\t\n\t    render : function(){\n\t        this.$el\n\t            .attr( 'draggable', true )\n\t            .data( 'pair', this.pair )\n\t            .html( this.template({ pair: this.pair }) )\n\t            .addClass( 'flex-column-container' );\n\t        return this;\n\t    },\n\t\n\t    events : {\n\t        'dragstart'         : '_dragstart',\n\t        'dragend'           : '_dragend',\n\t        'dragover'          : '_sendToParent',\n\t        'drop'              : '_sendToParent'\n\t    },\n\t\n\t    /** dragging pairs for re-ordering */\n\t    _dragstart : function( ev ){\n\t        ev.currentTarget.style.opacity = '0.4';\n\t        if( ev.originalEvent ){ ev = ev.originalEvent; }\n\t\n\t        ev.dataTransfer.effectAllowed = 'move';\n\t        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.pair ) );\n\t\n\t        this.$el.parent().trigger( 'pair.dragstart', [ this ] );\n\t    },\n\t\n\t    /** dragging pairs for re-ordering */\n\t    _dragend : function( ev ){\n\t        ev.currentTarget.style.opacity = '1.0';\n\t        this.$el.parent().trigger( 'pair.dragend', [ this ] );\n\t    },\n\t\n\t    /** manually bubble up an event to the parent/container */\n\t    _sendToParent : function( ev ){\n\t        this.$el.parent().trigger( ev );\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){\n\t        return 'PairView(' + this.pair.name + ')';\n\t    }\n\t});\n\t\n\t\n\t// ============================================================================\n\t/** returns an autopair function that uses the provided options.match function */\n\tfunction autoPairFnBuilder( options ){\n\t    options = options || {};\n\t    options.createPair = options.createPair || function _defaultCreatePair( params ){\n\t        this.debug( 'creating pair:', params.listA[ params.indexA ].name, params.listB[ params.indexB ].name );\n\t        params = params || {};\n\t        return this._pair(\n\t            params.listA.splice( params.indexA, 1 )[0],\n\t            params.listB.splice( params.indexB, 1 )[0],\n\t            { silent: true }\n\t        );\n\t    };\n\t    // compile these here outside of the loop\n\t    var _regexps = [];\n\t    function getRegExps(){\n\t        if( !_regexps.length ){\n\t            _regexps = [\n\t                new RegExp( this.filters[0] ),\n\t                new RegExp( this.filters[1] )\n\t            ];\n\t        }\n\t        return _regexps;\n\t    }\n\t    // mangle params as needed\n\t    options.preprocessMatch = options.preprocessMatch || function _defaultPreprocessMatch( params ){\n\t        var regexps = getRegExps.call( this );\n\t        return _.extend( params, {\n\t            matchTo     : params.matchTo.name.replace( regexps[0], '' ),\n\t            possible    : params.possible.name.replace( regexps[1], '' )\n\t        });\n\t    };\n\t\n\t    return function _strategy( params ){\n\t        this.debug( 'autopair _strategy ---------------------------' );\n\t        params = params || {};\n\t        var listA = params.listA,\n\t            listB = params.listB,\n\t            indexA = 0, indexB,\n\t            bestMatch = {\n\t                score : 0.0,\n\t                index : null\n\t            },\n\t            paired = [];\n\t        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n\t        this.debug( 'starting list lens:', listA.length, listB.length );\n\t        this.debug( 'bestMatch (starting):', JSON.stringify( bestMatch, null, '  ' ) );\n\t\n\t        while( indexA < listA.length ){\n\t            var matchTo = listA[ indexA ];\n\t            bestMatch.score = 0.0;\n\t\n\t            for( indexB=0; indexB<listB.length; indexB++ ){\n\t                var possible = listB[ indexB ];\n\t                this.debug( indexA + ':' + matchTo.name );\n\t                this.debug( indexB + ':' + possible.name );\n\t\n\t                // no matching with self\n\t                if( listA[ indexA ] !== listB[ indexB ] ){\n\t                    bestMatch = options.match.call( this, options.preprocessMatch.call( this, {\n\t                        matchTo : matchTo,\n\t                        possible: possible,\n\t                        index   : indexB,\n\t                        bestMatch : bestMatch\n\t                    }));\n\t                    this.debug( 'bestMatch:', JSON.stringify( bestMatch, null, '  ' ) );\n\t                    if( bestMatch.score === 1.0 ){\n\t                        this.debug( 'breaking early due to perfect match' );\n\t                        break;\n\t                    }\n\t                }\n\t            }\n\t            var scoreThreshold = options.scoreThreshold.call( this );\n\t            this.debug( 'scoreThreshold:', scoreThreshold );\n\t            this.debug( 'bestMatch.score:', bestMatch.score );\n\t\n\t            if( bestMatch.score >= scoreThreshold ){\n\t                this.debug( 'creating pair' );\n\t                paired.push( options.createPair.call( this, {\n\t                    listA   : listA,\n\t                    indexA  : indexA,\n\t                    listB   : listB,\n\t                    indexB  : bestMatch.index\n\t                }));\n\t                this.debug( 'list lens now:', listA.length, listB.length );\n\t            } else {\n\t                indexA += 1;\n\t            }\n\t            if( !listA.length || !listB.length ){\n\t                return paired;\n\t            }\n\t        }\n\t        this.debug( 'paired:', JSON.stringify( paired, null, '  ' ) );\n\t        this.debug( 'autopair _strategy ---------------------------' );\n\t        return paired;\n\t    };\n\t}\n\t\n\t\n\t// ============================================================================\n\t/** An interface for building collections of paired datasets.\n\t */\n\tvar PairedCollectionCreator = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n\t\n\t    className: 'list-of-pairs-collection-creator collection-creator flex-row-container',\n\t\n\t    /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n\t    initialize : function( attributes ){\n\t        this.metric( 'PairedCollectionCreator.initialize', attributes );\n\t        //this.debug( '-- PairedCollectionCreator:', attributes );\n\t\n\t        attributes = _.defaults( attributes, {\n\t            datasets            : [],\n\t            filters             : this.DEFAULT_FILTERS,\n\t            automaticallyPair   : true,\n\t            strategy            : 'lcs',\n\t            matchPercentage     : 0.9,\n\t            twoPassAutopairing  : true\n\t        });\n\t\n\t        /** unordered, original list */\n\t        this.initialList = attributes.datasets;\n\t\n\t        /** is this from a history? if so, what's its id? */\n\t        this.historyId = attributes.historyId;\n\t\n\t        /** which filters should be used initially? (String[2] or name in commonFilters) */\n\t        this.filters = this.commonFilters[ attributes.filters ] || this.commonFilters[ this.DEFAULT_FILTERS ];\n\t        if( _.isArray( attributes.filters ) ){\n\t            this.filters = attributes.filters;\n\t        }\n\t\n\t        /** try to auto pair the unpaired datasets on load? */\n\t        this.automaticallyPair = attributes.automaticallyPair;\n\t\n\t        /** what method to use for auto pairing (will be passed aggression level) */\n\t        this.strategy = this.strategies[ attributes.strategy ] || this.strategies[ this.DEFAULT_STRATEGY ];\n\t        if( _.isFunction( attributes.strategy ) ){\n\t            this.strategy = attributes.strategy;\n\t        }\n\t\n\t        /** distance/mismatch level allowed for autopairing */\n\t        this.matchPercentage = attributes.matchPercentage;\n\t\n\t        /** try to autopair using simple first, then this.strategy on the remainder */\n\t        this.twoPassAutopairing = attributes.twoPassAutopairing;\n\t\n\t        /** remove file extensions (\\.*) from created pair names? */\n\t        this.removeExtensions = true;\n\t        //this.removeExtensions = false;\n\t\n\t        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t        this.oncancel = attributes.oncancel;\n\t        /** fn to call when the collection is created (scoped to this) */\n\t        this.oncreate = attributes.oncreate;\n\t\n\t        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n\t        this.autoscrollDist = attributes.autoscrollDist || 24;\n\t\n\t        /** is the unpaired panel shown? */\n\t        this.unpairedPanelHidden = false;\n\t        /** is the paired panel shown? */\n\t        this.pairedPanelHidden = false;\n\t\n\t        /** DOM elements currently being dragged */\n\t        this.$dragging = null;\n\t\n\t        /** Used for blocking UI events during ajax/operations (don't post twice) */\n\t        this.blocking = false;\n\t\n\t        this._setUpBehaviors();\n\t        this._dataSetUp();\n\t    },\n\t\n\t    /** map of common filter pairs by name */\n\t    commonFilters : {\n\t        illumina        : [ '_1', '_2' ],\n\t        Rs              : [ '_R1', '_R2' ]\n\t    },\n\t    /** which commonFilter to use by default */\n\t    DEFAULT_FILTERS : 'illumina',\n\t\n\t    /** map of name->fn for autopairing */\n\t    strategies : {\n\t        'simple'        : 'autopairSimple',\n\t        'lcs'           : 'autopairLCS',\n\t        'levenshtein'   : 'autopairLevenshtein'\n\t    },\n\t    /** default autopair strategy name */\n\t    DEFAULT_STRATEGY : 'lcs',\n\t\n\t    // ------------------------------------------------------------------------ process raw list\n\t    /** set up main data: cache initialList, sort, and autopair */\n\t    _dataSetUp : function(){\n\t        //this.debug( '-- _dataSetUp' );\n\t\n\t        this.paired = [];\n\t        this.unpaired = [];\n\t\n\t        this.selectedIds = [];\n\t\n\t        // sort initial list, add ids if needed, and save new working copy to unpaired\n\t        this._sortInitialList();\n\t        this._ensureIds();\n\t        this.unpaired = this.initialList.slice( 0 );\n\t\n\t        if( this.automaticallyPair ){\n\t            this.autoPair();\n\t            this.once( 'rendered:initial', function(){\n\t                this.trigger( 'autopair' );\n\t            });\n\t        }\n\t    },\n\t\n\t    /** sort initial list */\n\t    _sortInitialList : function(){\n\t        //this.debug( '-- _sortInitialList' );\n\t        this._sortDatasetList( this.initialList );\n\t    },\n\t\n\t    /** sort a list of datasets */\n\t    _sortDatasetList : function( list ){\n\t        // currently only natural sort by name\n\t        list.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n\t        return list;\n\t    },\n\t\n\t    /** add ids to dataset objs in initial list if none */\n\t    _ensureIds : function(){\n\t        this.initialList.forEach( function( dataset ){\n\t            if( !dataset.hasOwnProperty( 'id' ) ){\n\t                dataset.id = _.uniqueId();\n\t            }\n\t        });\n\t        return this.initialList;\n\t    },\n\t\n\t    /** split initial list into two lists, those that pass forward filters & those passing reverse */\n\t    _splitByFilters : function(){\n\t        var regexFilters = this.filters.map( function( stringFilter ){\n\t                return new RegExp( stringFilter );\n\t            }),\n\t            split = [ [], [] ];\n\t\n\t        function _filter( unpaired, filter ){\n\t            return filter.test( unpaired.name );\n\t            //return dataset.name.indexOf( filter ) >= 0;\n\t        }\n\t        this.unpaired.forEach( function _filterEach( unpaired ){\n\t            // 90% of the time this seems to work, but:\n\t            //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n\t            //  would need explanation in help as well\n\t            regexFilters.forEach( function( filter, i ){\n\t                if( _filter( unpaired, filter ) ){\n\t                    split[i].push( unpaired );\n\t                }\n\t            });\n\t        });\n\t        return split;\n\t    },\n\t\n\t    /** add a dataset to the unpaired list in it's proper order */\n\t    _addToUnpaired : function( dataset ){\n\t        // currently, unpaired is natural sorted by name, use binary search to find insertion point\n\t        var binSearchSortedIndex = function( low, hi ){\n\t            if( low === hi ){ return low; }\n\t\n\t            var mid = Math.floor( ( hi - low ) / 2 ) + low,\n\t                compared = naturalSort( dataset.name, this.unpaired[ mid ].name );\n\t\n\t            if( compared < 0 ){\n\t                return binSearchSortedIndex( low, mid );\n\t            } else if( compared > 0 ){\n\t                return binSearchSortedIndex( mid + 1, hi );\n\t            }\n\t            // walk the equal to find the last\n\t            while( this.unpaired[ mid ] && this.unpaired[ mid ].name === dataset.name ){ mid++; }\n\t            return mid;\n\t\n\t        }.bind( this );\n\t\n\t        this.unpaired.splice( binSearchSortedIndex( 0, this.unpaired.length ), 0, dataset );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ auto pairing\n\t    /** two passes to automatically create pairs:\n\t     *  use both simpleAutoPair, then the fn mentioned in strategy\n\t     */\n\t    autoPair : function( strategy ){\n\t        // split first using exact matching\n\t        var split = this._splitByFilters(),\n\t            paired = [];\n\t        if( this.twoPassAutopairing ){\n\t            paired = this.autopairSimple({\n\t                listA : split[0],\n\t                listB : split[1]\n\t            });\n\t            split = this._splitByFilters();\n\t        }\n\t\n\t        // uncomment to see printlns while running tests\n\t        //this.debug = function(){ console.log.apply( console, arguments ); };\n\t\n\t        // then try the remainder with something less strict\n\t        strategy = strategy || this.strategy;\n\t        split = this._splitByFilters();\n\t        paired = paired.concat( this[ strategy ].call( this, {\n\t                listA : split[0],\n\t                listB : split[1]\n\t        }));\n\t        return paired;\n\t    },\n\t\n\t    /** autopair by exact match */\n\t    autopairSimple : autoPairFnBuilder({\n\t        scoreThreshold: function(){ return 1.0; },\n\t        match : function _match( params ){\n\t            params = params || {};\n\t            if( params.matchTo === params.possible ){\n\t                return {\n\t                    index: params.index,\n\t                    score: 1.0\n\t                };\n\t            }\n\t            return params.bestMatch;\n\t        }\n\t    }),\n\t\n\t    /** autopair by levenshtein edit distance scoring */\n\t    autopairLevenshtein : autoPairFnBuilder({\n\t        scoreThreshold: function(){ return this.matchPercentage; },\n\t        match : function _matches( params ){\n\t            params = params || {};\n\t            var distance = levenshteinDistance( params.matchTo, params.possible ),\n\t                score = 1.0 - ( distance / ( Math.max( params.matchTo.length, params.possible.length ) ) );\n\t            if( score > params.bestMatch.score ){\n\t                return {\n\t                    index: params.index,\n\t                    score: score\n\t                };\n\t            }\n\t            return params.bestMatch;\n\t        }\n\t    }),\n\t\n\t    /** autopair by longest common substrings scoring */\n\t    autopairLCS : autoPairFnBuilder({\n\t        scoreThreshold: function(){ return this.matchPercentage; },\n\t        match : function _matches( params ){\n\t            params = params || {};\n\t            var match = this._naiveStartingAndEndingLCS( params.matchTo, params.possible ).length,\n\t                score = match / ( Math.max( params.matchTo.length, params.possible.length ) );\n\t            if( score > params.bestMatch.score ){\n\t                return {\n\t                    index: params.index,\n\t                    score: score\n\t                };\n\t            }\n\t            return params.bestMatch;\n\t        }\n\t    }),\n\t\n\t    /** return the concat'd longest common prefix and suffix from two strings */\n\t    _naiveStartingAndEndingLCS : function( s1, s2 ){\n\t        var fwdLCS = '',\n\t            revLCS = '',\n\t            i = 0, j = 0;\n\t        while( i < s1.length && i < s2.length ){\n\t            if( s1[ i ] !== s2[ i ] ){\n\t                break;\n\t            }\n\t            fwdLCS += s1[ i ];\n\t            i += 1;\n\t        }\n\t        if( i === s1.length ){ return s1; }\n\t        if( i === s2.length ){ return s2; }\n\t\n\t        i = ( s1.length - 1 );\n\t        j = ( s2.length - 1 );\n\t        while( i >= 0 && j >= 0 ){\n\t            if( s1[ i ] !== s2[ j ] ){\n\t                break;\n\t            }\n\t            revLCS = [ s1[ i ], revLCS ].join( '' );\n\t            i -= 1;\n\t            j -= 1;\n\t        }\n\t        return fwdLCS + revLCS;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ pairing / unpairing\n\t    /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n\t    _pair : function( fwd, rev, options ){\n\t        options = options || {};\n\t        //this.debug( '_pair:', fwd, rev );\n\t        var pair = this._createPair( fwd, rev, options.name );\n\t        this.paired.push( pair );\n\t        this.unpaired = _.without( this.unpaired, fwd, rev );\n\t        if( !options.silent ){\n\t            this.trigger( 'pair:new', pair );\n\t        }\n\t        return pair;\n\t    },\n\t\n\t    /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n\t    _createPair : function( fwd, rev, name ){\n\t        // ensure existance and don't pair something with itself\n\t        if( !( fwd && rev ) || ( fwd === rev ) ){\n\t            throw new Error( 'Bad pairing: ' + [ JSON.stringify( fwd ), JSON.stringify( rev ) ] );\n\t        }\n\t        name = name || this._guessNameForPair( fwd, rev );\n\t        return { forward : fwd, name : name, reverse : rev };\n\t    },\n\t\n\t    /** try to find a good pair name for the given fwd and rev datasets */\n\t    _guessNameForPair : function( fwd, rev, removeExtensions ){\n\t        removeExtensions = ( removeExtensions !== undefined )?( removeExtensions ):( this.removeExtensions );\n\t        var fwdName = fwd.name,\n\t            revName = rev.name,\n\t            lcs = this._naiveStartingAndEndingLCS(\n\t                fwdName.replace( this.filters[0], '' ),\n\t                revName.replace( this.filters[1], '' )\n\t            );\n\t        if( removeExtensions ){\n\t            var lastDotIndex = lcs.lastIndexOf( '.' );\n\t            if( lastDotIndex > 0 ){\n\t                var extension = lcs.slice( lastDotIndex, lcs.length );\n\t                lcs = lcs.replace( extension, '' );\n\t                fwdName = fwdName.replace( extension, '' );\n\t                revName = revName.replace( extension, '' );\n\t            }\n\t        }\n\t        return lcs || ( fwdName + ' & ' + revName );\n\t    },\n\t\n\t    /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n\t    _unpair : function( pair, options ){\n\t        options = options || {};\n\t        if( !pair ){\n\t            throw new Error( 'Bad pair: ' + JSON.stringify( pair ) );\n\t        }\n\t        this.paired = _.without( this.paired, pair );\n\t        this._addToUnpaired( pair.forward );\n\t        this._addToUnpaired( pair.reverse );\n\t\n\t        if( !options.silent ){\n\t            this.trigger( 'pair:unpair', [ pair ] );\n\t        }\n\t        return pair;\n\t    },\n\t\n\t    /** unpair all paired datasets */\n\t    unpairAll : function(){\n\t        var pairs = [];\n\t        while( this.paired.length ){\n\t            pairs.push( this._unpair( this.paired[ 0 ], { silent: true }) );\n\t        }\n\t        this.trigger( 'pair:unpair', pairs );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ API\n\t    /** convert a pair into JSON compatible with the collections API */\n\t    _pairToJSON : function( pair, src ){\n\t        src = src || 'hda';\n\t        //TODO: consider making this the pair structure when created instead\n\t        return {\n\t            collection_type : 'paired',\n\t            src             : 'new_collection',\n\t            name            : pair.name,\n\t            element_identifiers : [{\n\t                name    : 'forward',\n\t                id      : pair.forward.id,\n\t                src     : src\n\t            }, {\n\t                name    : 'reverse',\n\t                id      : pair.reverse.id,\n\t                src     : src\n\t            }]\n\t        };\n\t    },\n\t\n\t    /** create the collection via the API\n\t     *  @returns {jQuery.xhr Object}    the jquery ajax request\n\t     */\n\t    createList : function( name ){\n\t        var creator = this,\n\t            root = ( window.Galaxy && Galaxy.options.root )? Galaxy.options.root : '/',\n\t            url = root + 'api/histories/' + this.historyId + '/contents/dataset_collections';\n\t\n\t        //TODO: use ListPairedCollection.create()\n\t        var ajaxData = {\n\t            type            : 'dataset_collection',\n\t            collection_type : 'list:paired',\n\t            name            : _.escape( name || creator.$( '.collection-name' ).val() ),\n\t            element_identifiers : creator.paired.map( function( pair ){\n\t                return creator._pairToJSON( pair );\n\t            })\n\t\n\t        };\n\t        //this.debug( JSON.stringify( ajaxData ) );\n\t        creator.blocking = true;\n\t        return jQuery.ajax( url, {\n\t            type        : 'POST',\n\t            contentType : 'application/json',\n\t            dataType    : 'json',\n\t            data        : JSON.stringify( ajaxData )\n\t        })\n\t        .always( function(){\n\t            creator.blocking = false;\n\t        })\n\t        .fail( function( xhr, status, message ){\n\t            creator._ajaxErrHandler( xhr, status, message );\n\t        })\n\t        .done( function( response, message, xhr ){\n\t            //this.info( 'ok', response, message, xhr );\n\t            creator.trigger( 'collection:created', response, message, xhr );\n\t            creator.metric( 'collection:created', response );\n\t            if( typeof creator.oncreate === 'function' ){\n\t                creator.oncreate.call( this, response, message, xhr );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** handle ajax errors with feedback and details to the user (if available) */\n\t    _ajaxErrHandler : function( xhr, status, message ){\n\t        this.error( xhr, status, message );\n\t        var content = _l( 'An error occurred while creating this collection' );\n\t        if( xhr ){\n\t            if( xhr.readyState === 0 && xhr.status === 0 ){\n\t                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' )\n\t                    + _l( ' Try again in a few minutes.' );\n\t            } else if( xhr.responseJSON ){\n\t                content += '<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n\t            } else {\n\t                content += ': ' + message;\n\t            }\n\t        }\n\t        creator._showAlert( content, 'alert-danger' );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ rendering\n\t    /** render the entire interface */\n\t    render : function( speed, callback ){\n\t        //this.debug( '-- _render' );\n\t        //this.$el.empty().html( PairedCollectionCreator.templates.main() );\n\t        this.$el.empty().html( PairedCollectionCreator.templates.main() );\n\t        this._renderHeader( speed );\n\t        this._renderMiddle( speed );\n\t        this._renderFooter( speed );\n\t        this._addPluginComponents();\n\t        this.trigger( 'rendered', this );\n\t        return this;\n\t    },\n\t\n\t    /** render the header section */\n\t    _renderHeader : function( speed, callback ){\n\t        //this.debug( '-- _renderHeader' );\n\t        var $header = this.$( '.header' ).empty().html( PairedCollectionCreator.templates.header() )\n\t            .find( '.help-content' ).prepend( $( PairedCollectionCreator.templates.helpContent() ) );\n\t\n\t        this._renderFilters();\n\t        return $header;\n\t    },\n\t    /** fill the filter inputs with the filter values */\n\t    _renderFilters : function(){\n\t        return    this.$( '.forward-column .column-header input' ).val( this.filters[0] )\n\t            .add( this.$( '.reverse-column .column-header input' ).val( this.filters[1] ) );\n\t    },\n\t\n\t    /** render the middle including unpaired and paired sections (which may be hidden) */\n\t    _renderMiddle : function( speed, callback ){\n\t        var $middle = this.$( '.middle' ).empty().html( PairedCollectionCreator.templates.middle() );\n\t\n\t        // (re-) hide the un/paired panels based on instance vars\n\t        if( this.unpairedPanelHidden ){\n\t            this.$( '.unpaired-columns' ).hide();\n\t        } else if( this.pairedPanelHidden ){\n\t            this.$( '.paired-columns' ).hide();\n\t        }\n\t\n\t        this._renderUnpaired();\n\t        this._renderPaired();\n\t        return $middle;\n\t    },\n\t    /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n\t    _renderUnpaired : function( speed, callback ){\n\t        //this.debug( '-- _renderUnpaired' );\n\t        var creator = this,\n\t            $fwd, $rev, $prd = [],\n\t            split = this._splitByFilters();\n\t        // update unpaired counts\n\t        this.$( '.forward-column .title' )\n\t            .text([ split[0].length, _l( 'unpaired forward' ) ].join( ' ' ));\n\t        this.$( '.forward-column .unpaired-info' )\n\t            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[0].length ) );\n\t        this.$( '.reverse-column .title' )\n\t            .text([ split[1].length, _l( 'unpaired reverse' ) ].join( ' ' ));\n\t        this.$( '.reverse-column .unpaired-info' )\n\t            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[1].length ) );\n\t\n\t        this.$( '.unpaired-columns .column-datasets' ).empty();\n\t\n\t        // show/hide the auto pair button if any unpaired are left\n\t        this.$( '.autopair-link' ).toggle( this.unpaired.length !== 0 );\n\t        if( this.unpaired.length === 0 ){\n\t            this._renderUnpairedEmpty();\n\t            return;\n\t        }\n\t\n\t        // create the dataset dom arrays\n\t        $rev = split[1].map( function( dataset, i ){\n\t            // if there'll be a fwd dataset across the way, add a button to pair the row\n\t            if( ( split[0][ i ] !== undefined )\n\t            &&  ( split[0][ i ] !== dataset ) ){\n\t                $prd.push( creator._renderPairButton() );\n\t            }\n\t            return creator._renderUnpairedDataset( dataset );\n\t        });\n\t        $fwd = split[0].map( function( dataset ){\n\t            return creator._renderUnpairedDataset( dataset );\n\t        });\n\t\n\t        if( !$fwd.length && !$rev.length ){\n\t            this._renderUnpairedNotShown();\n\t            return;\n\t        }\n\t        // add to appropo cols\n\t        //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n\t        //  and swapping out that\n\t        this.$( '.unpaired-columns .forward-column .column-datasets' ).append( $fwd )\n\t            .add( this.$( '.unpaired-columns .paired-column .column-datasets' ).append( $prd ) )\n\t            .add( this.$( '.unpaired-columns .reverse-column .column-datasets' ).append( $rev ) );\n\t        this._adjUnpairedOnScrollbar();\n\t    },\n\t    /** return a string to display the count of filtered out datasets */\n\t    _renderUnpairedDisplayStr : function( numFiltered ){\n\t        return [ '(', numFiltered, ' ', _l( 'filtered out' ), ')' ].join('');\n\t    },\n\t    /** return an unattached jQuery DOM element to represent an unpaired dataset */\n\t    _renderUnpairedDataset : function( dataset ){\n\t        //TODO: to underscore template\n\t        return $( '<li/>')\n\t            .attr( 'id', 'dataset-' + dataset.id )\n\t            .addClass( 'dataset unpaired' )\n\t            .attr( 'draggable', true )\n\t            .addClass( dataset.selected? 'selected': '' )\n\t            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( dataset.name ) )\n\t            //??\n\t            .data( 'dataset', dataset );\n\t    },\n\t    /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n\t    _renderPairButton : function(){\n\t        //TODO: *not* a dataset - don't pretend like it is\n\t        return $( '<li/>').addClass( 'dataset unpaired' )\n\t            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( _l( 'Pair these datasets' ) ) );\n\t    },\n\t    /** a message to display when no unpaired left */\n\t    _renderUnpairedEmpty : function(){\n\t        //this.debug( '-- renderUnpairedEmpty' );\n\t        var $msg = $( '<div class=\"empty-message\"></div>' )\n\t            .text( '(' + _l( 'no remaining unpaired datasets' ) + ')' );\n\t        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n\t        return $msg;\n\t    },\n\t    /** a message to display when no unpaired can be shown with the current filters */\n\t    _renderUnpairedNotShown : function(){\n\t        //this.debug( '-- renderUnpairedEmpty' );\n\t        var $msg = $( '<div class=\"empty-message\"></div>' )\n\t            .text( '(' + _l( 'no datasets were found matching the current filters' ) + ')' );\n\t        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n\t        return $msg;\n\t    },\n\t    /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n\t    _adjUnpairedOnScrollbar : function(){\n\t        var $unpairedColumns = this.$( '.unpaired-columns' ).last(),\n\t            $firstDataset = this.$( '.unpaired-columns .reverse-column .dataset' ).first();\n\t        if( !$firstDataset.size() ){ return; }\n\t        var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth(),\n\t            dsRight = $firstDataset.offset().left + $firstDataset.outerWidth(),\n\t            rightDiff = Math.floor( ucRight ) - Math.floor( dsRight );\n\t        //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n\t        this.$( '.unpaired-columns .forward-column' )\n\t            .css( 'margin-left', ( rightDiff > 0 )? rightDiff: 0 );\n\t    },\n\t\n\t    /** render the paired section and update counts of paired datasets */\n\t    _renderPaired : function( speed, callback ){\n\t        //this.debug( '-- _renderPaired' );\n\t        this.$( '.paired-column-title .title' ).text([ this.paired.length, _l( 'paired' ) ].join( ' ' ) );\n\t        // show/hide the unpair all link\n\t        this.$( '.unpair-all-link' ).toggle( this.paired.length !== 0 );\n\t        if( this.paired.length === 0 ){\n\t            this._renderPairedEmpty();\n\t            return;\n\t            //TODO: would be best to return here (the $columns)\n\t        } else {\n\t            // show/hide 'remove extensions link' when any paired and they seem to have extensions\n\t            this.$( '.remove-extensions-link' ).show();\n\t        }\n\t\n\t        this.$( '.paired-columns .column-datasets' ).empty();\n\t        var creator = this;\n\t        this.paired.forEach( function( pair, i ){\n\t            //TODO: cache these?\n\t            var pairView = new PairView({ pair: pair });\n\t            creator.$( '.paired-columns .column-datasets' )\n\t                .append( pairView.render().$el )\n\t                .append([\n\t                    '<button class=\"unpair-btn\">',\n\t                        '<span class=\"fa fa-unlink\" title=\"', _l( 'Unpair' ), '\"></span>',\n\t                    '</button>'\n\t                ].join( '' ));\n\t        });\n\t    },\n\t    /** a message to display when none paired */\n\t    _renderPairedEmpty : function(){\n\t        var $msg = $( '<div class=\"empty-message\"></div>' )\n\t            .text( '(' + _l( 'no paired datasets yet' ) + ')' );\n\t        this.$( '.paired-columns .column-datasets' ).empty().prepend( $msg );\n\t        return $msg;\n\t    },\n\t\n\t    /** render the footer, completion controls, and cancel controls */\n\t    _renderFooter : function( speed, callback ){\n\t        var $footer = this.$( '.footer' ).empty().html( PairedCollectionCreator.templates.footer() );\n\t        this.$( '.remove-extensions' ).prop( 'checked', this.removeExtensions );\n\t        if( typeof this.oncancel === 'function' ){\n\t            this.$( '.cancel-create.btn' ).show();\n\t        }\n\t        return $footer;\n\t    },\n\t\n\t    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n\t    _addPluginComponents : function(){\n\t        this._chooseFiltersPopover( '.choose-filters-link' );\n\t        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', 'rgba( 64, 255, 255, 1.0 )' );\n\t    },\n\t\n\t    /** build a filter selection popover allowing selection of common filter pairs */\n\t    _chooseFiltersPopover : function( selector ){\n\t        function filterChoice( val1, val2 ){\n\t            return [\n\t                '<button class=\"filter-choice btn\" ',\n\t                        'data-forward=\"', val1, '\" data-reverse=\"', val2, '\">',\n\t                    _l( 'Forward' ), ': ', val1, ', ',\n\t                    _l( 'Reverse' ), ': ', val2,\n\t                '</button>'\n\t            ].join('');\n\t        }\n\t        var $popoverContent = $( _.template([\n\t            '<div class=\"choose-filters\">',\n\t                '<div class=\"help\">',\n\t                    _l( 'Choose from the following filters to change which unpaired reads are shown in the display' ),\n\t                ':</div>',\n\t                _.values( this.commonFilters ).map( function( filterSet ){\n\t                    return filterChoice( filterSet[0], filterSet[1] );\n\t                }).join( '' ),\n\t            '</div>'\n\t        ].join(''))({}));\n\t\n\t        return this.$( selector ).popover({\n\t            container   : '.collection-creator',\n\t            placement   : 'bottom',\n\t            html        : true,\n\t            //animation   : false,\n\t            content     : $popoverContent\n\t        });\n\t    },\n\t\n\t    /** add (or clear if clear is truthy) a validation warning to what */\n\t    _validationWarning : function( what, clear ){\n\t        var VALIDATION_CLASS = 'validation-warning';\n\t        if( what === 'name' ){\n\t            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n\t            this.$( '.collection-name' ).focus().select();\n\t        }\n\t        if( clear ){\n\t            what = what || this.$( '.' + VALIDATION_CLASS );\n\t            what.removeClass( VALIDATION_CLASS );\n\t        } else {\n\t            what.addClass( VALIDATION_CLASS );\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ events\n\t    /** set up event handlers on self */\n\t    _setUpBehaviors : function(){\n\t        this.once( 'rendered', function(){\n\t            this.trigger( 'rendered:initial', this );\n\t        });\n\t\n\t        this.on( 'pair:new', function(){\n\t            //TODO: ideally only re-render the columns (or even elements) involved\n\t            this._renderUnpaired();\n\t            this._renderPaired();\n\t\n\t            // scroll to bottom where new pairs are added\n\t            //TODO: this doesn't seem to work - innerHeight sticks at 133...\n\t            //  may have to do with improper flex columns\n\t            //var $pairedView = this.$( '.paired-columns' );\n\t            //$pairedView.scrollTop( $pairedView.innerHeight() );\n\t            //this.debug( $pairedView.height() )\n\t            this.$( '.paired-columns' ).scrollTop( 8000000 );\n\t        });\n\t        this.on( 'pair:unpair', function( pairs ){\n\t            //TODO: ideally only re-render the columns (or even elements) involved\n\t            this._renderUnpaired();\n\t            this._renderPaired();\n\t            this.splitView();\n\t        });\n\t\n\t        this.on( 'filter-change', function(){\n\t            this.filters = [\n\t                this.$( '.forward-unpaired-filter input' ).val(),\n\t                this.$( '.reverse-unpaired-filter input' ).val()\n\t            ];\n\t            this.metric( 'filter-change', this.filters );\n\t            this._renderFilters();\n\t            this._renderUnpaired();\n\t        });\n\t\n\t        this.on( 'autopair', function(){\n\t            this._renderUnpaired();\n\t            this._renderPaired();\n\t\n\t            var message, msgClass = null;\n\t            if( this.paired.length ){\n\t                msgClass = 'alert-success';\n\t                message = this.paired.length + ' ' + _l( 'pairs created' );\n\t                if( !this.unpaired.length ){\n\t                    message += ': ' + _l( 'all datasets have been successfully paired' );\n\t                    this.hideUnpaired();\n\t                    this.$( '.collection-name' ).focus();\n\t                }\n\t            } else {\n\t                message = _l( 'Could not automatically create any pairs from the given dataset names' );\n\t            }\n\t            this._showAlert( message, msgClass );\n\t        });\n\t\n\t        //this.on( 'all', function(){\n\t        //    this.info( arguments );\n\t        //});\n\t        return this;\n\t    },\n\t\n\t    events : {\n\t        // header\n\t        'click .more-help'                          : '_clickMoreHelp',\n\t        'click .less-help'                          : '_clickLessHelp',\n\t        'click .header .alert button'               : '_hideAlert',\n\t        'click .forward-column .column-title'       : '_clickShowOnlyUnpaired',\n\t        'click .reverse-column .column-title'       : '_clickShowOnlyUnpaired',\n\t        'click .unpair-all-link'                    : '_clickUnpairAll',\n\t        //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n\t        'change .forward-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n\t        'focus .forward-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n\t        'click .autopair-link'                      : '_clickAutopair',\n\t        'click .choose-filters .filter-choice'      : '_clickFilterChoice',\n\t        'click .clear-filters-link'                 : '_clearFilters',\n\t        'change .reverse-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n\t        'focus .reverse-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n\t        // unpaired\n\t        'click .forward-column .dataset.unpaired'   : '_clickUnpairedDataset',\n\t        'click .reverse-column .dataset.unpaired'   : '_clickUnpairedDataset',\n\t        'click .paired-column .dataset.unpaired'    : '_clickPairRow',\n\t        'click .unpaired-columns'                   : 'clearSelectedUnpaired',\n\t        'mousedown .unpaired-columns .dataset'      : '_mousedownUnpaired',\n\t        // divider\n\t        'click .paired-column-title'                : '_clickShowOnlyPaired',\n\t        'mousedown .flexible-partition-drag'        : '_startPartitionDrag',\n\t        // paired\n\t        'click .paired-columns .dataset.paired'     : 'selectPair',\n\t        'click .paired-columns'                     : 'clearSelectedPaired',\n\t        'click .paired-columns .pair-name'          : '_clickPairName',\n\t        'click .unpair-btn'                         : '_clickUnpair',\n\t        // paired - drop target\n\t        //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n\t        //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n\t        'dragover .paired-columns .column-datasets' : '_dragoverPairedColumns',\n\t        'drop .paired-columns .column-datasets'     : '_dropPairedColumns',\n\t\n\t        'pair.dragstart .paired-columns .column-datasets' : '_pairDragstart',\n\t        'pair.dragend   .paired-columns .column-datasets' : '_pairDragend',\n\t\n\t        // footer\n\t        'change .remove-extensions'                 : function( ev ){ this.toggleExtensions(); },\n\t        'change .collection-name'                   : '_changeName',\n\t        'keydown .collection-name'                  : '_nameCheckForEnter',\n\t        'click .cancel-create'                      : function( ev ){\n\t            if( typeof this.oncancel === 'function' ){\n\t                this.oncancel.call( this );\n\t            }\n\t        },\n\t        'click .create-collection'                  : '_clickCreate'//,\n\t    },\n\t\n\t    // ........................................................................ header\n\t    /** expand help */\n\t    _clickMoreHelp : function( ev ){\n\t        this.$( '.main-help' ).addClass( 'expanded' );\n\t        this.$( '.more-help' ).hide();\n\t    },\n\t    /** collapse help */\n\t    _clickLessHelp : function( ev ){\n\t        this.$( '.main-help' ).removeClass( 'expanded' );\n\t        this.$( '.more-help' ).show();\n\t    },\n\t\n\t    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*)*/\n\t    _showAlert : function( message, alertClass ){\n\t        alertClass = alertClass || 'alert-danger';\n\t        this.$( '.main-help' ).hide();\n\t        this.$( '.header .alert' ).attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n\t            .find( '.alert-message' ).html( message );\n\t    },\n\t    /** hide the alerts at the top */\n\t    _hideAlert : function( message ){\n\t        this.$( '.main-help' ).show();\n\t        this.$( '.header .alert' ).hide();\n\t    },\n\t\n\t    /** toggle between showing only unpaired and split view */\n\t    _clickShowOnlyUnpaired : function( ev ){\n\t        //this.debug( 'click unpaired', ev.currentTarget );\n\t        if( this.$( '.paired-columns' ).is( ':visible' ) ){\n\t            this.hidePaired();\n\t        } else {\n\t            this.splitView();\n\t        }\n\t    },\n\t    /** toggle between showing only paired and split view */\n\t    _clickShowOnlyPaired : function( ev ){\n\t        //this.debug( 'click paired' );\n\t        if( this.$( '.unpaired-columns' ).is( ':visible' ) ){\n\t            this.hideUnpaired();\n\t        } else {\n\t            this.splitView();\n\t        }\n\t    },\n\t\n\t    /** hide unpaired, show paired */\n\t    hideUnpaired : function( speed, callback ){\n\t        this.unpairedPanelHidden = true;\n\t        this.pairedPanelHidden = false;\n\t        this._renderMiddle( speed, callback );\n\t    },\n\t    /** hide paired, show unpaired */\n\t    hidePaired : function( speed, callback ){\n\t        this.unpairedPanelHidden = false;\n\t        this.pairedPanelHidden = true;\n\t        this._renderMiddle( speed, callback );\n\t    },\n\t    /** show both paired and unpaired (splitting evenly) */\n\t    splitView : function( speed, callback ){\n\t        this.unpairedPanelHidden = this.pairedPanelHidden = false;\n\t        this._renderMiddle( speed, callback );\n\t        return this;\n\t    },\n\t\n\t    /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n\t    _clickUnpairAll : function( ev ){\n\t        this.metric( 'unpairAll' );\n\t        this.unpairAll();\n\t    },\n\t\n\t    /** attempt to autopair */\n\t    _clickAutopair : function( ev ){\n\t        var paired = this.autoPair();\n\t        this.metric( 'autopair', paired.length, this.unpaired.length );\n\t        this.trigger( 'autopair' );\n\t    },\n\t\n\t    /** set the filters based on the data attributes of the button click target */\n\t    _clickFilterChoice : function( ev ){\n\t        var $selected = $( ev.currentTarget );\n\t        this.$( '.forward-unpaired-filter input' ).val( $selected.data( 'forward' ) );\n\t        this.$( '.reverse-unpaired-filter input' ).val( $selected.data( 'reverse' ) );\n\t        this._hideChooseFilters();\n\t        this.trigger( 'filter-change' );\n\t    },\n\t\n\t    /** hide the choose filters popover */\n\t    _hideChooseFilters : function(){\n\t        //TODO: update bootstrap and remove the following hack\n\t        //  see also: https://github.com/twbs/bootstrap/issues/10260\n\t        this.$( '.choose-filters-link' ).popover( 'hide' );\n\t        this.$( '.popover' ).css( 'display', 'none' );\n\t    },\n\t\n\t    /** clear both filters */\n\t    _clearFilters : function( ev ){\n\t        this.$( '.forward-unpaired-filter input' ).val( '' );\n\t        this.$( '.reverse-unpaired-filter input' ).val( '' );\n\t        this.trigger( 'filter-change' );\n\t    },\n\t\n\t    // ........................................................................ unpaired\n\t    /** select an unpaired dataset */\n\t    _clickUnpairedDataset : function( ev ){\n\t        ev.stopPropagation();\n\t        return this.toggleSelectUnpaired( $( ev.currentTarget ) );\n\t    },\n\t\n\t    /** Toggle the selection of an unpaired dataset representation.\n\t     *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n\t     *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n\t     */\n\t    toggleSelectUnpaired : function( $dataset, options ){\n\t        options = options || {};\n\t        var dataset = $dataset.data( 'dataset' ),\n\t            select = options.force !== undefined? options.force: !$dataset.hasClass( 'selected' );\n\t        //this.debug( id, options.force, $dataset, dataset );\n\t        if( !$dataset.size() || dataset === undefined ){ return $dataset; }\n\t\n\t        if( select ){\n\t            $dataset.addClass( 'selected' );\n\t            if( !options.waitToPair ){\n\t                this.pairAllSelected();\n\t            }\n\t\n\t        } else {\n\t            $dataset.removeClass( 'selected' );\n\t            //delete dataset.selected;\n\t        }\n\t        return $dataset;\n\t    },\n\t\n\t    /** pair all the currently selected unpaired datasets */\n\t    pairAllSelected : function( options ){\n\t        options = options || {};\n\t        var creator = this,\n\t            fwds = [],\n\t            revs = [],\n\t            pairs = [];\n\t        creator.$( '.unpaired-columns .forward-column .dataset.selected' ).each( function(){\n\t            fwds.push( $( this ).data( 'dataset' ) );\n\t        });\n\t        creator.$( '.unpaired-columns .reverse-column .dataset.selected' ).each( function(){\n\t            revs.push( $( this ).data( 'dataset' ) );\n\t        });\n\t        fwds.length = revs.length = Math.min( fwds.length, revs.length );\n\t        //this.debug( fwds );\n\t        //this.debug( revs );\n\t        fwds.forEach( function( fwd, i ){\n\t            try {\n\t                pairs.push( creator._pair( fwd, revs[i], { silent: true }) );\n\t\n\t            } catch( err ){\n\t                //TODO: preserve selected state of those that couldn't be paired\n\t                //TODO: warn that some could not be paired\n\t                creator.error( err );\n\t            }\n\t        });\n\t        if( pairs.length && !options.silent ){\n\t            this.trigger( 'pair:new', pairs );\n\t        }\n\t        return pairs;\n\t    },\n\t\n\t    /** clear the selection on all unpaired datasets */\n\t    clearSelectedUnpaired : function(){\n\t        this.$( '.unpaired-columns .dataset.selected' ).removeClass( 'selected' );\n\t    },\n\t\n\t    /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n\t    _mousedownUnpaired : function( ev ){\n\t        if( ev.shiftKey ){\n\t            var creator = this,\n\t                $startTarget = $( ev.target ).addClass( 'selected' ),\n\t                moveListener = function( ev ){\n\t                    creator.$( ev.target ).filter( '.dataset' ).addClass( 'selected' );\n\t                };\n\t            $startTarget.parent().on( 'mousemove', moveListener );\n\t\n\t            // on any mouseup, stop listening to the move and try to pair any selected\n\t            $( document ).one( 'mouseup', function( ev ){\n\t                $startTarget.parent().off( 'mousemove', moveListener );\n\t                creator.pairAllSelected();\n\t            });\n\t        }\n\t    },\n\t\n\t    /** attempt to pair two datasets directly across from one another */\n\t    _clickPairRow : function( ev ){\n\t        //if( !ev.currentTarget ){ return true; }\n\t        var rowIndex = $( ev.currentTarget ).index(),\n\t            fwd = $( '.unpaired-columns .forward-column .dataset' ).eq( rowIndex ).data( 'dataset' ),\n\t            rev = $( '.unpaired-columns .reverse-column .dataset' ).eq( rowIndex ).data( 'dataset' );\n\t        //this.debug( 'row:', rowIndex, fwd, rev );\n\t        this._pair( fwd, rev );\n\t    },\n\t\n\t    // ........................................................................ divider/partition\n\t    /** start dragging the visible divider/partition between unpaired and paired panes */\n\t    _startPartitionDrag : function( ev ){\n\t        var creator = this,\n\t            startingY = ev.pageY;\n\t        //this.debug( 'partition drag START:', ev );\n\t        $( 'body' ).css( 'cursor', 'ns-resize' );\n\t        creator.$( '.flexible-partition-drag' ).css( 'color', 'black' );\n\t\n\t        function endDrag( ev ){\n\t            //creator.debug( 'partition drag STOP:', ev );\n\t            // doing this by an added class didn't really work well - kept flashing still\n\t            creator.$( '.flexible-partition-drag' ).css( 'color', '' );\n\t            $( 'body' ).css( 'cursor', '' ).unbind( 'mousemove', trackMouse );\n\t        }\n\t        function trackMouse( ev ){\n\t            var offset = ev.pageY - startingY;\n\t            //creator.debug( 'partition:', startingY, offset );\n\t            if( !creator.adjPartition( offset ) ){\n\t                //creator.debug( 'mouseup triggered' );\n\t                $( 'body' ).trigger( 'mouseup' );\n\t            }\n\t            creator._adjUnpairedOnScrollbar();\n\t            startingY += offset;\n\t        }\n\t        $( 'body' ).mousemove( trackMouse );\n\t        $( 'body' ).one( 'mouseup', endDrag );\n\t    },\n\t\n\t    /** adjust the parition up/down +/-adj pixels */\n\t    adjPartition : function( adj ){\n\t        var $unpaired = this.$( '.unpaired-columns' ),\n\t            $paired = this.$( '.paired-columns' ),\n\t            unpairedHi = parseInt( $unpaired.css( 'height' ), 10 ),\n\t            pairedHi = parseInt( $paired.css( 'height' ), 10 );\n\t        //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\t\n\t        unpairedHi = Math.max( 10, unpairedHi + adj );\n\t        pairedHi = pairedHi - adj;\n\t\n\t        var movingUpwards = adj < 0;\n\t        // when the divider gets close to the top - lock into hiding the unpaired section\n\t        if( movingUpwards ){\n\t            if( this.unpairedPanelHidden ){\n\t                return false;\n\t            } else if( unpairedHi <= 10 ){\n\t                this.hideUnpaired();\n\t                return false;\n\t            }\n\t        } else {\n\t            if( this.unpairedPanelHidden ){\n\t                $unpaired.show();\n\t                this.unpairedPanelHidden = false;\n\t            }\n\t        }\n\t\n\t        // when the divider gets close to the bottom - lock into hiding the paired section\n\t        if( !movingUpwards ){\n\t            if( this.pairedPanelHidden ){\n\t                return false;\n\t            } else if( pairedHi <= 15 ){\n\t                this.hidePaired();\n\t                return false;\n\t            }\n\t\n\t        } else {\n\t            if( this.pairedPanelHidden ){\n\t                $paired.show();\n\t                this.pairedPanelHidden = false;\n\t            }\n\t        }\n\t\n\t        $unpaired.css({\n\t            height  : unpairedHi + 'px',\n\t            flex    : '0 0 auto'\n\t        });\n\t        return true;\n\t    },\n\t\n\t    // ........................................................................ paired\n\t    /** select a pair when clicked */\n\t    selectPair : function( ev ){\n\t        ev.stopPropagation();\n\t        $( ev.currentTarget ).toggleClass( 'selected' );\n\t    },\n\t\n\t    /** deselect all pairs */\n\t    clearSelectedPaired : function( ev ){\n\t        this.$( '.paired-columns .dataset.selected' ).removeClass( 'selected' );\n\t    },\n\t\n\t    /** rename a pair when the pair name is clicked */\n\t    _clickPairName : function( ev ){\n\t        ev.stopPropagation();\n\t        var $name = $( ev.currentTarget ),\n\t            $pair = $name.parent().parent(),\n\t            index = $pair.index( '.dataset.paired' ),\n\t            pair = this.paired[ index ],\n\t            response = prompt( 'Enter a new name for the pair:', pair.name );\n\t        if( response ){\n\t            pair.name = response;\n\t            // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n\t            //  when adding/removing extensions\n\t            //hackish\n\t            pair.customizedName = true;\n\t            $name.text( pair.name );\n\t        }\n\t    },\n\t\n\t    /** unpair this pair */\n\t    _clickUnpair : function( ev ){\n\t        //if( !ev.currentTarget ){ return true; }\n\t        var pairIndex = Math.floor( $( ev.currentTarget ).index( '.unpair-btn' ) );\n\t        //this.debug( 'pair:', pairIndex );\n\t        this._unpair( this.paired[ pairIndex ] );\n\t    },\n\t\n\t    // ........................................................................ paired - drag and drop re-ordering\n\t    //_dragenterPairedColumns : function( ev ){\n\t    //    this.debug( '_dragenterPairedColumns:', ev );\n\t    //},\n\t    //_dragleavePairedColumns : function( ev ){\n\t    //    //this.debug( '_dragleavePairedColumns:', ev );\n\t    //},\n\t    /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n\t    _dragoverPairedColumns : function( ev ){\n\t        //this.debug( '_dragoverPairedColumns:', ev );\n\t        ev.preventDefault();\n\t\n\t        var $list = this.$( '.paired-columns .column-datasets' );\n\t        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n\t        //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n\t        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n\t\n\t        $( '.element-drop-placeholder' ).remove();\n\t        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n\t        if( !$nearest.size() ){\n\t            $list.append( $placeholder );\n\t        } else {\n\t            $nearest.before( $placeholder );\n\t        }\n\t    },\n\t\n\t    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n\t    _checkForAutoscroll : function( $element, y ){\n\t        var AUTOSCROLL_SPEED = 2;\n\t        var offset = $element.offset(),\n\t            scrollTop = $element.scrollTop(),\n\t            upperDist = y - offset.top,\n\t            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n\t        //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n\t        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n\t            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n\t        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n\t            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n\t        }\n\t    },\n\t\n\t    /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n\t     *      If the y is at the end of the list, return an empty jQuery object.\n\t     */\n\t    _getNearestPairedDatasetLi : function( y ){\n\t        var WIGGLE = 4,\n\t            lis = this.$( '.paired-columns .column-datasets li' ).toArray();\n\t        for( var i=0; i<lis.length; i++ ){\n\t            var $li = $( lis[i] ),\n\t                top = $li.offset().top,\n\t                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n\t            if( top + halfHeight > y && top - halfHeight < y ){\n\t                //this.debug( y, top + halfHeight, top - halfHeight )\n\t                return $li;\n\t            }\n\t        }\n\t        return $();\n\t    },\n\t    /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n\t    _dropPairedColumns : function( ev ){\n\t        // both required for firefox\n\t        ev.preventDefault();\n\t        ev.dataTransfer.dropEffect = 'move';\n\t\n\t        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n\t        if( $nearest.size() ){\n\t            this.$dragging.insertBefore( $nearest );\n\t\n\t        } else {\n\t            // no nearest before - insert after last element (unpair button)\n\t            this.$dragging.insertAfter( this.$( '.paired-columns .unpair-btn' ).last() );\n\t        }\n\t        // resync the creator's list of paired based on the new DOM order\n\t        this._syncPairsToDom();\n\t        return false;\n\t    },\n\t    /** resync the creator's list of paired based on the DOM order of pairs */\n\t    _syncPairsToDom : function(){\n\t        var newPaired = [];\n\t        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n\t        this.$( '.paired-columns .dataset.paired' ).each( function(){\n\t            newPaired.push( $( this ).data( 'pair' ) );\n\t        });\n\t        //this.debug( newPaired );\n\t        this.paired = newPaired;\n\t        this._renderPaired();\n\t    },\n\t    /** drag communication with pair sub-views: dragstart */\n\t    _pairDragstart : function( ev, pair ){\n\t        //this.debug( '_pairDragstart', ev, pair )\n\t        // auto select the pair causing the event and move all selected\n\t        pair.$el.addClass( 'selected' );\n\t        var $selected = this.$( '.paired-columns .dataset.selected' );\n\t        this.$dragging = $selected;\n\t    },\n\t    /** drag communication with pair sub-views: dragend - remove the placeholder */\n\t    _pairDragend : function( ev, pair ){\n\t        //this.debug( '_pairDragend', ev, pair )\n\t        $( '.element-drop-placeholder' ).remove();\n\t        this.$dragging = null;\n\t    },\n\t\n\t    // ........................................................................ footer\n\t    toggleExtensions : function( force ){\n\t        var creator = this;\n\t        creator.removeExtensions = ( force !== undefined )?( force ):( !creator.removeExtensions );\n\t\n\t        _.each( creator.paired, function( pair ){\n\t            // don't overwrite custom names\n\t            if( pair.customizedName ){ return; }\n\t            pair.name = creator._guessNameForPair( pair.forward, pair.reverse );\n\t        });\n\t\n\t        creator._renderPaired();\n\t        creator._renderFooter();\n\t    },\n\t\n\t    /** handle a collection name change */\n\t    _changeName : function( ev ){\n\t        this._validationWarning( 'name', !!this._getName() );\n\t    },\n\t\n\t    /** check for enter key press when in the collection name and submit */\n\t    _nameCheckForEnter : function( ev ){\n\t        if( ev.keyCode === 13 && !this.blocking ){\n\t            this._clickCreate();\n\t        }\n\t    },\n\t\n\t    /** get the current collection name */\n\t    _getName : function(){\n\t        return _.escape( this.$( '.collection-name' ).val() );\n\t    },\n\t\n\t    /** attempt to create the current collection */\n\t    _clickCreate : function( ev ){\n\t        var name = this._getName();\n\t        if( !name ){\n\t            this._validationWarning( 'name' );\n\t        } else if( !this.blocking ){\n\t            this.createList();\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ misc\n\t    /** debug a dataset list */\n\t    _printList : function( list ){\n\t        var creator = this;\n\t        _.each( list, function( e ){\n\t            if( list === creator.paired ){\n\t                creator._printPair( e );\n\t            } else {\n\t                //creator.debug( e );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** print a pair Object */\n\t    _printPair : function( pair ){\n\t        this.debug( pair.forward.name, pair.reverse.name, ': ->', pair.name );\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){ return 'PairedCollectionCreator'; }\n\t});\n\t\n\t\n\t//TODO: move to require text plugin and load these as text\n\t//TODO: underscore currently unnecc. bc no vars are used\n\t//TODO: better way of localizing text-nodes in long strings\n\t/** underscore template fns attached to class */\n\tPairedCollectionCreator.templates = PairedCollectionCreator.templates || {\n\t\n\t    /** the skeleton */\n\t    main : _.template([\n\t        '<div class=\"header flex-row no-flex\"></div>',\n\t        '<div class=\"middle flex-row flex-row-container\"></div>',\n\t        '<div class=\"footer flex-row no-flex\">'\n\t    ].join('')),\n\t\n\t    /** the header (not including help text) */\n\t    header : _.template([\n\t        '<div class=\"main-help well clear\">',\n\t            '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n\t            '<div class=\"help-content\">',\n\t                '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n\t            '</div>',\n\t        '</div>',\n\t        '<div class=\"alert alert-dismissable\">',\n\t            '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>',\n\t            '<span class=\"alert-message\"></span>',\n\t        '</div>',\n\t\n\t        '<div class=\"column-headers vertically-spaced flex-column-container\">',\n\t            '<div class=\"forward-column flex-column column\">',\n\t                '<div class=\"column-header\">',\n\t                    '<div class=\"column-title\">',\n\t                        '<span class=\"title\">', _l( 'Unpaired forward' ), '</span>',\n\t                        '<span class=\"title-info unpaired-info\"></span>',\n\t                    '</div>',\n\t                    '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">',\n\t                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n\t                    '</div>',\n\t                '</div>',\n\t            '</div>',\n\t            '<div class=\"paired-column flex-column no-flex column\">',\n\t                '<div class=\"column-header\">',\n\t                    '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">',\n\t                        _l( 'Choose filters' ),\n\t                    '</a>',\n\t                    '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">',\n\t                        _l( 'Clear filters' ),\n\t                    '</a><br />',\n\t                    '<a class=\"autopair-link\" href=\"javascript:void(0);\">',\n\t                        _l( 'Auto-pair' ),\n\t                    '</a>',\n\t                '</div>',\n\t            '</div>',\n\t            '<div class=\"reverse-column flex-column column\">',\n\t                '<div class=\"column-header\">',\n\t                    '<div class=\"column-title\">',\n\t                        '<span class=\"title\">', _l( 'Unpaired reverse' ), '</span>',\n\t                        '<span class=\"title-info unpaired-info\"></span>',\n\t                    '</div>',\n\t                    '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">',\n\t                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n\t                    '</div>',\n\t                '</div>',\n\t            '</div>',\n\t        '</div>'\n\t    ].join('')),\n\t\n\t    /** the middle: unpaired, divider, and paired */\n\t    middle : _.template([\n\t        // contains two flex rows (rows that fill available space) and a divider btwn\n\t        '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">',\n\t            '<div class=\"forward-column flex-column column\">',\n\t                '<ol class=\"column-datasets\"></ol>',\n\t            '</div>',\n\t            '<div class=\"paired-column flex-column no-flex column\">',\n\t                '<ol class=\"column-datasets\"></ol>',\n\t            '</div>',\n\t            '<div class=\"reverse-column flex-column column\">',\n\t                '<ol class=\"column-datasets\"></ol>',\n\t            '</div>',\n\t        '</div>',\n\t        '<div class=\"flexible-partition\">',\n\t            '<div class=\"flexible-partition-drag\" title=\"', _l( 'Drag to change' ), '\"></div>',\n\t            '<div class=\"column-header\">',\n\t                '<div class=\"column-title paired-column-title\">',\n\t                    '<span class=\"title\"></span>',\n\t                '</div>',\n\t                '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">',\n\t                    _l( 'Unpair all' ),\n\t                '</a>',\n\t            '</div>',\n\t        '</div>',\n\t        '<div class=\"paired-columns flex-column-container scroll-container flex-row\">',\n\t            '<ol class=\"column-datasets\"></ol>',\n\t        '</div>'\n\t    ].join('')),\n\t\n\t    /** creation and cancel controls */\n\t    footer : _.template([\n\t        '<div class=\"attributes clear\">',\n\t            '<div class=\"clear\">',\n\t                '<label class=\"remove-extensions-prompt pull-right\">',\n\t                    _l( 'Remove file extensions from pair names' ), '?',\n\t                    '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />',\n\t                '</label>',\n\t            '</div>',\n\t            '<div class=\"clear\">',\n\t                '<input class=\"collection-name form-control pull-right\" ',\n\t                    'placeholder=\"', _l( 'Enter a name for your new list' ), '\" />',\n\t                '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n\t            '</div>',\n\t        '</div>',\n\t\n\t        '<div class=\"actions clear vertically-spaced\">',\n\t            '<div class=\"other-options pull-left\">',\n\t                '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n\t                '<div class=\"create-other btn-group dropup\">',\n\t                    '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n\t                          _l( 'Create a different kind of collection' ),\n\t                          ' <span class=\"caret\"></span>',\n\t                    '</button>',\n\t                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n\t                          '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n\t                          '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n\t                    '</ul>',\n\t                '</div>',\n\t            '</div>',\n\t\n\t            '<div class=\"main-options pull-right\">',\n\t                '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n\t            '</div>',\n\t        '</div>'\n\t    ].join('')),\n\t\n\t    /** help content */\n\t    helpContent : _.template([\n\t        '<p>', _l([\n\t            'Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ',\n\t            'These collections can be passed to tools and workflows in order to have analyses done on each member of ',\n\t            'the entire group. This interface allows you to create a collection, choose which datasets are paired, ',\n\t            'and re-order the final collection.'\n\t        ].join( '' )), '</p>',\n\t        '<p>', _l([\n\t            'Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ',\n\t            '(hover over the underlined words to highlight below). ',\n\t            'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.',\n\t            '<ul>To pair datasets, you can:',\n\t                '<li>Click a dataset in the ',\n\t                    '<i data-target=\".unpaired-columns .forward-column .column-datasets,',\n\t                                    '.unpaired-columns .forward-column\">forward column</i> ',\n\t                    'to select it then click a dataset in the ',\n\t                    '<i data-target=\".unpaired-columns .reverse-column .column-datasets,',\n\t                                    '.unpaired-columns .reverse-column\">reverse column</i>.',\n\t                '</li>',\n\t                '<li>Click one of the \"Pair these datasets\" buttons in the ',\n\t                    '<i data-target=\".unpaired-columns .paired-column .column-datasets,',\n\t                                    '.unpaired-columns .paired-column\">middle column</i> ',\n\t                    'to pair the datasets in a particular row.',\n\t                '</li>',\n\t                '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ',\n\t                    'to have your datasets automatically paired based on name.',\n\t                '</li>',\n\t            '</ul>'\n\t        ].join( '' )), '</p>',\n\t        '<p>', _l([\n\t            '<ul>You can filter what is shown in the unpaired sections by:',\n\t                '<li>Entering partial dataset names in either the ',\n\t                    '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ',\n\t                    '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.',\n\t                '</li>',\n\t                '<li>Choosing from a list of preset filters by clicking the ',\n\t                    '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.',\n\t                '</li>',\n\t                '<li>Entering regular expressions to match dataset names. See: ',\n\t                    '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"',\n\t                        ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ',\n\t                    'Note: forward slashes (\\\\) are not needed.',\n\t                '</li>',\n\t                '<li>Clearing the filters by clicking the ',\n\t                    '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.',\n\t                '</li>',\n\t            '</ul>'\n\t        ].join( '' )), '</p>',\n\t        '<p>', _l([\n\t            'To unpair individual dataset pairs, click the ',\n\t                '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ',\n\t            'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'\n\t        ].join( '' )), '</p>',\n\t        '<p>', _l([\n\t            'You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ',\n\t                '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'\n\t        ].join( '' )), '</p>',\n\t        '<p>', _l([\n\t            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n\t            'click <i data-target=\".create-collection\">\"Create list\"</i>. ',\n\t            '(Note: you do not have to pair all unpaired datasets to finish.)'\n\t        ].join( '' )), '</p>'\n\t    ].join(''))\n\t};\n\t\n\t\n\t//=============================================================================\n\t/** a modal version of the paired collection creator */\n\tvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal( datasets, options ){\n\t\n\t    var deferred = jQuery.Deferred(),\n\t        creator;\n\t\n\t    options = _.defaults( options || {}, {\n\t        datasets    : datasets,\n\t        oncancel    : function(){\n\t            Galaxy.modal.hide();\n\t            deferred.reject( 'cancelled' );\n\t        },\n\t        oncreate    : function( creator, response ){\n\t            Galaxy.modal.hide();\n\t            deferred.resolve( response );\n\t        }\n\t    });\n\t\n\t    if( !window.Galaxy || !Galaxy.modal ){\n\t        throw new Error( 'Galaxy or Galaxy.modal not found' );\n\t    }\n\t\n\t    creator = new PairedCollectionCreator( options );\n\t    Galaxy.modal.show({\n\t        title   : 'Create a collection of paired datasets',\n\t        body    : creator.$el,\n\t        width   : '80%',\n\t        height  : '800px',\n\t        closing_events: true\n\t    });\n\t    creator.render();\n\t    window.creator = creator;\n\t\n\t    //TODO: remove modal header\n\t    return deferred;\n\t};\n\t\n\t\n\t//=============================================================================\n\tfunction createListOfPairsCollection( collection ){\n\t    var elements = collection.toJSON();\n\t//TODO: validate elements\n\t    return pairedCollectionCreatorModal( elements, {\n\t        historyId : collection.historyId\n\t    });\n\t}\n\t\n\t\n\t//=============================================================================\n\t    return {\n\t        PairedCollectionCreator : PairedCollectionCreator,\n\t        pairedCollectionCreatorModal : pairedCollectionCreatorModal,\n\t        createListOfPairsCollection : createListOfPairsCollection\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 58 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(14),\n\t    __webpack_require__(16),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( LIST_CREATOR, HDCA, BASE_MVC, _l ){\n\t/*==============================================================================\n\tTODO:\n\t    the paired creator doesn't really mesh with the list creator as parent\n\t        it may be better to make an abstract super class for both\n\t    composites may inherit from this (or vis-versa)\n\t    PairedDatasetCollectionElementView doesn't make a lot of sense\n\t\n\t==============================================================================*/\n\t/**  */\n\tvar PairedDatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n\t//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n\t    tagName     : 'li',\n\t    className   : 'collection-element',\n\t\n\t    initialize : function( attributes ){\n\t        this.element = attributes.element || {};\n\t        this.identifier = attributes.identifier;\n\t    },\n\t\n\t    render : function(){\n\t        this.$el\n\t            .attr( 'data-element-id', this.element.id )\n\t            .html( this.template({ identifier: this.identifier, element: this.element }) );\n\t        return this;\n\t    },\n\t\n\t    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n\t    template : _.template([\n\t        '<span class=\"identifier\"><%= identifier %></span>',\n\t        '<span class=\"name\"><%= element.name %></span>',\n\t    ].join('')),\n\t\n\t    /** remove the DOM and any listeners */\n\t    destroy : function(){\n\t        this.off();\n\t        this.$el.remove();\n\t    },\n\t\n\t    /** string rep */\n\t    toString : function(){\n\t        return 'DatasetCollectionElementView()';\n\t    }\n\t});\n\t\n\t\n\t// ============================================================================\n\tvar _super = LIST_CREATOR.ListCollectionCreator;\n\t\n\t/** An interface for building collections.\n\t */\n\tvar PairCollectionCreator = _super.extend({\n\t\n\t    /** the class used to display individual elements */\n\t    elementViewClass : PairedDatasetCollectionElementView,\n\t    /** the class this creator will create and save */\n\t    collectionClass : HDCA.HistoryPairDatasetCollection,\n\t    className : 'pair-collection-creator collection-creator flex-row-container',\n\t\n\t    /** override to no-op */\n\t    _mangleDuplicateNames : function(){},\n\t\n\t    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n\t    //      bad inital choices and\n\t    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n\t    /** render the entire interface */\n\t    render : function( speed, callback ){\n\t        if( this.workingElements.length === 2 ){\n\t            return _super.prototype.render.call( this, speed, callback );\n\t        }\n\t        return this._renderInvalid( speed, callback );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ rendering elements\n\t    /** render forward/reverse */\n\t    _renderList : function( speed, callback ){\n\t        //this.debug( '-- _renderList' );\n\t        //precondition: there are two valid elements in workingElements\n\t        var creator = this,\n\t            $tmp = jQuery( '<div/>' ),\n\t            $list = creator.$list();\n\t\n\t        // lose the original views, create the new, append all at once, then call their renders\n\t        _.each( this.elementViews, function( view ){\n\t            view.destroy();\n\t            creator.removeElementView( view );\n\t        });\n\t        $tmp.append( creator._createForwardElementView().$el );\n\t        $tmp.append( creator._createReverseElementView().$el );\n\t        $list.empty().append( $tmp.children() );\n\t        _.invoke( creator.elementViews, 'render' );\n\t    },\n\t\n\t    /** create the forward element view */\n\t    _createForwardElementView : function(){\n\t        return this._createElementView( this.workingElements[0], { identifier: 'forward' } );\n\t    },\n\t\n\t    /** create the forward element view */\n\t    _createReverseElementView : function(){\n\t        return this._createElementView( this.workingElements[1], { identifier: 'reverse' } );\n\t    },\n\t\n\t    /** create an element view, cache in elementViews, and return */\n\t    _createElementView : function( element, options ){\n\t        var elementView = new this.elementViewClass( _.extend( options, {\n\t            element : element,\n\t        }));\n\t        this.elementViews.push( elementView );\n\t        return elementView;\n\t    },\n\t\n\t    /** swap the forward, reverse elements and re-render */\n\t    swap : function(){\n\t        this.workingElements = [\n\t            this.workingElements[1],\n\t            this.workingElements[0],\n\t        ];\n\t        this._renderList();\n\t    },\n\t\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        'click .swap' : 'swap',\n\t    }),\n\t\n\t    // ------------------------------------------------------------------------ templates\n\t    //TODO: move to require text plugin and load these as text\n\t    //TODO: underscore currently unnecc. bc no vars are used\n\t    //TODO: better way of localizing text-nodes in long strings\n\t    /** underscore template fns attached to class */\n\t    templates : _.extend( _.clone( _super.prototype.templates ), {\n\t        /** the middle: element list */\n\t        middle : _.template([\n\t            '<div class=\"collection-elements-controls\">',\n\t                '<a class=\"swap\" href=\"javascript:void(0);\" title=\"', _l( 'Swap forward and reverse datasets' ), '\">',\n\t                    _l( 'Swap' ),\n\t                '</a>',\n\t            '</div>',\n\t            '<div class=\"collection-elements scroll-container flex-row\">',\n\t            '</div>'\n\t        ].join('')),\n\t\n\t        /** help content */\n\t        helpContent : _.template([\n\t            '<p>', _l([\n\t                'Pair collections are permanent collections containing two datasets: one forward and one reverse. ',\n\t                'Often these are forward and reverse reads. The pair collections can be passed to tools and ',\n\t                'workflows in order to have analyses done on both datasets. This interface allows ',\n\t                'you to create a pair, name it, and swap which is forward and which reverse.'\n\t            ].join( '' )), '</p>',\n\t            '<ul>',\n\t                '<li>', _l([\n\t                    'Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ',\n\t                    'and the reverse dataset forward.'\n\t                ].join( '' )), '</li>',\n\t                '<li>', _l([\n\t                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n\t                ].join( '' )), '</li>',\n\t            '</ul><br />',\n\t            '<p>', _l([\n\t                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n\t                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n\t            ].join( '' )), '</p>'\n\t        ].join('')),\n\t\n\t        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n\t        invalidInitial : _.template([\n\t            '<div class=\"header flex-row no-flex\">',\n\t                '<div class=\"alert alert-warning\" style=\"display: block\">',\n\t                    '<span class=\"alert-message\">',\n\t                        '<% if( _.size( problems ) ){ %>',\n\t                            _l( 'The following selections could not be included due to problems' ),\n\t                            '<ul><% _.each( problems, function( problem ){ %>',\n\t                                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n\t                            '<% }); %></ul>',\n\t                        '<% } else if( _.size( elements ) === 0 ){ %>',\n\t                            _l( 'No datasets were selected' ), '.',\n\t                        '<% } else if( _.size( elements ) === 1 ){ %>',\n\t                            _l( 'Only one dataset was selected' ), ': <%= elements[0].name %>',\n\t                        '<% } else if( _.size( elements ) > 2 ){ %>',\n\t                            _l( 'Too many datasets were selected' ),\n\t                            ': <%= _.pluck( elements, \"name\" ).join( \", \") %>',\n\t                        '<% } %>',\n\t                        '<br />',\n\t                        _l( 'Two (and only two) elements are needed for the pair' ), '. ',\n\t                        _l( 'You may need to ' ),\n\t                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n\t                        _l( 'and reselect new elements' ), '.',\n\t                    '</span>',\n\t                '</div>',\n\t            '</div>',\n\t            '<div class=\"footer flex-row no-flex\">',\n\t                '<div class=\"actions clear vertically-spaced\">',\n\t                    '<div class=\"other-options pull-left\">',\n\t                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n\t                        // _l( 'Create a different kind of collection' ),\n\t                    '</div>',\n\t                '</div>',\n\t            '</div>'\n\t        ].join('')),\n\t    }),\n\t\n\t    // ------------------------------------------------------------------------ misc\n\t    /** string rep */\n\t    toString : function(){ return 'PairCollectionCreator'; }\n\t});\n\t\n\t\n\t//==============================================================================\n\t/** List collection flavor of collectionCreatorModal. */\n\tvar pairCollectionCreatorModal = function _pairCollectionCreatorModal( elements, options ){\n\t    options = options || {};\n\t    options.title = _l( 'Create a collection from a pair of datasets' );\n\t    return LIST_CREATOR.collectionCreatorModal( elements, options, PairCollectionCreator );\n\t};\n\t\n\t\n\t//==============================================================================\n\t/** Use a modal to create a pair collection, then add it to the given history contents.\n\t *  @returns {Deferred} resolved when the collection is added to the history.\n\t */\n\tfunction createPairCollection( contents ){\n\t    var elements = contents.toJSON(),\n\t        promise = pairCollectionCreatorModal( elements, {\n\t            creationFn : function( elements, name ){\n\t                elements = [\n\t                    { name: \"forward\", src: \"hda\", id: elements[0].id },\n\t                    { name: \"reverse\", src: \"hda\", id: elements[1].id }\n\t                ];\n\t                return contents.createHDCA( elements, 'paired', name );\n\t            }\n\t        });\n\t    return promise;\n\t}\n\t\n\t//==============================================================================\n\t    return {\n\t        PairCollectionCreator       : PairCollectionCreator,\n\t        pairCollectionCreatorModal  : pairCollectionCreatorModal,\n\t        createPairCollection        : createPairCollection,\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 59 */,\n/* 60 */,\n/* 61 */,\n/* 62 */,\n/* 63 */,\n/* 64 */,\n/* 65 */,\n/* 66 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(28),\n\t    __webpack_require__(30),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( DATASET_LI_EDIT, HDA_LI, BASE_MVC, _l ){\n\t//==============================================================================\n\tvar _super = DATASET_LI_EDIT.DatasetListItemEdit;\n\t/** @class Editing view for HistoryDatasetAssociation.\n\t */\n\tvar HDAListItemEdit = _super.extend(\n\t/** @lends HDAListItemEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    className   : _super.prototype.className + \" history-content\",\n\t\n\t    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n\t     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n\t     */\n\t    _fetchModelDetails : function(){\n\t        var view = this;\n\t        if( view.model.inReadyState() && !view.model.hasDetails() ){\n\t            return view.model.fetch({ silent: true });\n\t\n\t        // special case the need for the rerunnable and creating_job attributes\n\t        // needed for rendering re-run button on queued, running datasets\n\t        } else if( !view.model.has( 'rerunnable' ) ){\n\t            return view.model.fetch({ silent: true, data: {\n\t                // only fetch rerunnable and creating_job to keep overhead down\n\t                keys: [ 'rerunnable', 'creating_job' ].join(',')\n\t            }});\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    /** event map */\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        'click .unhide-link' : function( ev ){ this.model.unhide(); return false; }\n\t    }),\n\t\n\t    /** string rep */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'HDAListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t\n\t// ............................................................................ TEMPLATES\n\t/** underscore templates */\n\tHDAListItemEdit.prototype.templates = (function(){\n\t//TODO: move to require text! plugin\n\t\n\t    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n\t        hidden : BASE_MVC.wrapTemplate([\n\t            '<% if( !dataset.visible ){ %>',\n\t                // add a link to unhide a dataset\n\t                '<div class=\"hidden-msg warningmessagesmall\">',\n\t                    _l( 'This dataset has been hidden' ),\n\t                    '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">', _l( 'Unhide it' ), '</a>',\n\t                '</div>',\n\t            '<% } %>'\n\t        ], 'dataset' )\n\t    });\n\t\n\t    return _.extend( {}, _super.prototype.templates, {\n\t        //NOTE: *steal* the HDAListItemView titleBar\n\t        titleBar : HDA_LI.HDAListItemView.prototype.templates.titleBar,\n\t        warnings : warnings\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HDAListItemEdit  : HDAListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 67 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(32),\n\t    __webpack_require__(56),\n\t    __webpack_require__(7),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function( HDCA_LI, DC_PANEL_EDIT, faIconButton, _l ){\n\t//==============================================================================\n\tvar _super = HDCA_LI.HDCAListItemView;\n\t/** @class Editing view for HistoryDatasetCollectionAssociation.\n\t */\n\tvar HDCAListItemEdit = _super.extend(\n\t/** @lends HDCAListItemEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** Override to return editable versions of the collection panels */\n\t    _getFoldoutPanelClass : function(){\n\t        switch( this.model.get( 'collection_type' ) ){\n\t            case 'list':\n\t                return DC_PANEL_EDIT.ListCollectionPanelEdit;\n\t            case 'paired':\n\t                return DC_PANEL_EDIT.PairCollectionPanelEdit;\n\t            case 'list:paired':\n\t                return DC_PANEL_EDIT.ListOfPairsCollectionPanelEdit;\n\t        }\n\t        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n\t    },\n\t\n\t    // ......................................................................... delete\n\t    /** In this override, add the delete button. */\n\t    _renderPrimaryActions : function(){\n\t        this.log( this + '._renderPrimaryActions' );\n\t        // render the display, edit attr and delete icon-buttons\n\t        return _super.prototype._renderPrimaryActions.call( this )\n\t            .concat([\n\t                this._renderDeleteButton()\n\t            ]);\n\t    },\n\t\n\t    /** Render icon-button to delete this collection. */\n\t    _renderDeleteButton : function(){\n\t        var self = this,\n\t            deleted = this.model.get( 'deleted' );\n\t        return faIconButton({\n\t            title       : deleted? _l( 'Dataset collection is already deleted' ): _l( 'Delete' ),\n\t            classes     : 'delete-btn',\n\t            faIcon      : 'fa-times',\n\t            disabled    : deleted,\n\t            onclick     : function() {\n\t                // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n\t                self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n\t                self.model[ 'delete' ]();\n\t            }\n\t        });\n\t    },\n\t\n\t    // ......................................................................... misc\n\t    /** string rep */\n\t    toString : function(){\n\t        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n\t        return 'HDCAListItemEdit(' + modelString + ')';\n\t    }\n\t});\n\t\n\t//==============================================================================\n\t    return {\n\t        HDCAListItemEdit : HDCAListItemEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 68 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(69),\n\t    __webpack_require__(18),\n\t    __webpack_require__(6),\n\t    __webpack_require__(31),\n\t    __webpack_require__(66),\n\t    __webpack_require__(67),\n\t    __webpack_require__(35),\n\t    __webpack_require__(26),\n\t    __webpack_require__(14),\n\t    __webpack_require__(58),\n\t    __webpack_require__(57),\n\t    __webpack_require__(7),\n\t    __webpack_require__(24),\n\t    __webpack_require__(1)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(\n\t    HPANEL,\n\t    HISTORY_CONTENTS,\n\t    STATES,\n\t    HDA_MODEL,\n\t    HDA_LI_EDIT,\n\t    HDCA_LI_EDIT,\n\t    TAGS,\n\t    ANNOTATIONS,\n\t    LIST_COLLECTION_CREATOR,\n\t    PAIR_COLLECTION_CREATOR,\n\t    LIST_OF_PAIRS_COLLECTION_CREATOR,\n\t    faIconButton,\n\t    PopupMenu,\n\t    _l\n\t){\n\t/* =============================================================================\n\tTODO:\n\t\n\t============================================================================= */\n\tvar _super = HPANEL.HistoryPanel;\n\t// base class for current-history-panel and used as-is in history/view.mako\n\t/** @class Editable View/Controller for the history model.\n\t *\n\t *  Allows:\n\t *      (everything HistoryPanel allows)\n\t *      changing the name\n\t *      displaying and editing tags and annotations\n\t *      multi-selection and operations on mulitple content items\n\t */\n\tvar HistoryPanelEdit = _super.extend(\n\t/** @lends HistoryPanelEdit.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** class to use for constructing the HistoryDatasetAssociation views */\n\t    HDAViewClass    : HDA_LI_EDIT.HDAListItemEdit,\n\t    /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n\t    HDCAViewClass   : HDCA_LI_EDIT.HDCAListItemEdit,\n\t\n\t    // ......................................................................... SET UP\n\t    /** Set up the view, set up storage, bind listeners to HistoryContents events\n\t     *  @param {Object} attributes\n\t     */\n\t    initialize : function( attributes ){\n\t        attributes = attributes || {};\n\t        _super.prototype.initialize.call( this, attributes );\n\t\n\t        // ---- set up instance vars\n\t        /** editor for tags - sub-view */\n\t        this.tagsEditor = null;\n\t        /** editor for annotations - sub-view */\n\t        this.annotationEditor = null;\n\t\n\t        /** allow user purge of dataset files? */\n\t        this.purgeAllowed = attributes.purgeAllowed || false;\n\t\n\t        // states/modes the panel can be in\n\t        /** is the panel currently showing the dataset selection controls? */\n\t        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n\t        this.tagsEditorShown  = attributes.tagsEditorShown || false;\n\t    },\n\t\n\t    /** Override to handle history as drag-drop target */\n\t    _setUpListeners : function(){\n\t        var panel = this;\n\t        _super.prototype._setUpListeners.call( panel );\n\t\n\t        panel.on( 'drop', function( ev, data ){\n\t            panel.dataDropped( data );\n\t            // remove the drop target\n\t            panel.dropTargetOff();\n\t        });\n\t        panel.on( 'view:attached view:removed', function(){\n\t            panel._renderCounts();\n\t        }, panel );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ listeners\n\t    /** listening for collection events */\n\t    _setUpCollectionListeners : function(){\n\t        _super.prototype._setUpCollectionListeners.call( this );\n\t\n\t        this.collection.on( 'change:deleted', this._handleHdaDeletionChange, this );\n\t        this.collection.on( 'change:visible', this._handleHdaVisibleChange, this );\n\t        this.collection.on( 'change:purged', function( model ){\n\t            // hafta get the new nice-size w/o the purged model\n\t            this.model.fetch();\n\t        }, this );\n\t        return this;\n\t    },\n\t\n\t    /** listening for history and HDA events */\n\t    _setUpModelListeners : function(){\n\t        _super.prototype._setUpModelListeners.call( this );\n\t        this.model.on( 'change:size', this.updateHistoryDiskSize, this );\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel rendering\n\t    /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n\t    _buildNewRender : function(){\n\t        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n\t        var $newRender = _super.prototype._buildNewRender.call( this );\n\t        if( !this.model ){ return $newRender; }\n\t\n\t        if( Galaxy && Galaxy.currUser && Galaxy.currUser.id && Galaxy.currUser.id === this.model.get( 'user_id' ) ){\n\t            this._renderTags( $newRender );\n\t            this._renderAnnotation( $newRender );\n\t        }\n\t        return $newRender;\n\t    },\n\t\n\t    /** override to render counts when the items are rendered */\n\t    renderItems : function( $whereTo ){\n\t        var views = _super.prototype.renderItems.call( this, $whereTo );\n\t        this._renderCounts( $whereTo );\n\t        return views;\n\t    },\n\t\n\t    /** override to show counts, what's deleted/hidden, and links to toggle those */\n\t    _renderCounts : function( $whereTo ){\n\t//TODO: too complicated\n\t        function toggleLink( _class, text ){\n\t            return [ '<a class=\"', _class, '\" href=\"javascript:void(0);\">', text, '</a>' ].join( '' );\n\t        }\n\t        $whereTo = $whereTo || this.$el;\n\t        var deleted  = this.collection.where({ deleted: true }),\n\t            hidden   = this.collection.where({ visible: false }),\n\t            msgs = [];\n\t\n\t        if( this.views.length ){\n\t            msgs.push( [ this.views.length, _l( 'shown' ) ].join( ' ' ) );\n\t        }\n\t        if( deleted.length ){\n\t            msgs.push( ( !this.showDeleted )?\n\t                 ([ deleted.length, toggleLink( 'toggle-deleted-link', _l( 'deleted' ) ) ].join( ' ' ))\n\t                :( toggleLink( 'toggle-deleted-link', _l( 'hide deleted' ) ) )\n\t            );\n\t        }\n\t        if( hidden.length ){\n\t            msgs.push( ( !this.showHidden )?\n\t                 ([ hidden.length, toggleLink( 'toggle-hidden-link', _l( 'hidden' ) ) ].join( ' ' ))\n\t                :( toggleLink( 'toggle-hidden-link', _l( 'hide hidden' ) ) )\n\t            );\n\t        }\n\t        return $whereTo.find( '> .controls .subtitle' ).html( msgs.join( ', ' ) );\n\t    },\n\t\n\t    /** render the tags sub-view controller */\n\t    _renderTags : function( $where ){\n\t        var panel = this;\n\t        this.tagsEditor = new TAGS.TagsEditor({\n\t            model           : this.model,\n\t            el              : $where.find( '.controls .tags-display' ),\n\t            onshowFirstTime : function(){ this.render(); },\n\t            // show hide sub-view tag editors when this is shown/hidden\n\t            onshow          : function(){\n\t                panel.toggleHDATagEditors( true,  panel.fxSpeed );\n\t            },\n\t            onhide          : function(){\n\t                panel.toggleHDATagEditors( false, panel.fxSpeed );\n\t            },\n\t            $activator      : faIconButton({\n\t                title   : _l( 'Edit history tags' ),\n\t                classes : 'history-tag-btn',\n\t                faIcon  : 'fa-tags'\n\t            }).appendTo( $where.find( '.controls .actions' ) )\n\t        });\n\t    },\n\t    /** render the annotation sub-view controller */\n\t    _renderAnnotation : function( $where ){\n\t        var panel = this;\n\t        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n\t            model           : this.model,\n\t            el              : $where.find( '.controls .annotation-display' ),\n\t            onshowFirstTime : function(){ this.render(); },\n\t            // show hide sub-view view annotation editors when this is shown/hidden\n\t            onshow          : function(){\n\t                panel.toggleHDAAnnotationEditors( true,  panel.fxSpeed );\n\t            },\n\t            onhide          : function(){\n\t                panel.toggleHDAAnnotationEditors( false, panel.fxSpeed );\n\t            },\n\t            $activator      : faIconButton({\n\t                title   : _l( 'Edit history annotation' ),\n\t                classes : 'history-annotate-btn',\n\t                faIcon  : 'fa-comment'\n\t            }).appendTo( $where.find( '.controls .actions' ) )\n\t        });\n\t    },\n\t\n\t    /** Set up HistoryPanelEdit js/widget behaviours\n\t     *  In this override, make the name editable\n\t     */\n\t    _setUpBehaviors : function( $where ){\n\t        $where = $where || this.$el;\n\t        _super.prototype._setUpBehaviors.call( this, $where );\n\t        if( !this.model ){ return; }\n\t\n\t        // anon users shouldn't have access to any of the following\n\t        if( ( !Galaxy.currUser || Galaxy.currUser.isAnonymous() )\n\t        ||  ( Galaxy.currUser.id !== this.model.get( 'user_id' ) ) ){\n\t            return;\n\t        }\n\t\n\t        var panel = this,\n\t            nameSelector = '> .controls .name';\n\t        $where.find( nameSelector )\n\t            .attr( 'title', _l( 'Click to rename history' ) )\n\t            .tooltip({ placement: 'bottom' })\n\t            .make_text_editable({\n\t                on_finish: function( newName ){\n\t                    var previousName = panel.model.get( 'name' );\n\t                    if( newName && newName !== previousName ){\n\t                        panel.$el.find( nameSelector ).text( newName );\n\t                        panel.model.save({ name: newName })\n\t                            .fail( function(){\n\t                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n\t                            });\n\t                    } else {\n\t                        panel.$el.find( nameSelector ).text( previousName );\n\t                    }\n\t                }\n\t            });\n\t    },\n\t\n\t    /** return a new popup menu for choosing a multi selection action\n\t     *  ajax calls made for multiple datasets are queued\n\t     */\n\t    multiselectActions : function(){\n\t        var panel = this,\n\t            actions = [\n\t                {   html: _l( 'Hide datasets' ), func: function(){\n\t                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n\t                        panel.getSelectedModels().ajaxQueue( action );\n\t                    }\n\t                },\n\t                {   html: _l( 'Unhide datasets' ), func: function(){\n\t                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n\t                        panel.getSelectedModels().ajaxQueue( action );\n\t                    }\n\t                },\n\t                {   html: _l( 'Delete datasets' ), func: function(){\n\t                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype['delete'];\n\t                        panel.getSelectedModels().ajaxQueue( action );\n\t                    }\n\t                },\n\t                {   html: _l( 'Undelete datasets' ), func: function(){\n\t                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n\t                        panel.getSelectedModels().ajaxQueue( action );\n\t                    }\n\t                }\n\t            ];\n\t        if( panel.purgeAllowed ){\n\t            actions.push({\n\t                html: _l( 'Permanently delete datasets' ), func: function(){\n\t                    if( confirm( _l( 'This will permanently remove the data in your datasets. Are you sure?' ) ) ){\n\t                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n\t                        panel.getSelectedModels().ajaxQueue( action );\n\t                    }\n\t                }\n\t            });\n\t        }\n\t        actions = actions.concat( panel._collectionActions() );\n\t        return actions;\n\t    },\n\t\n\t    /**   */\n\t    _collectionActions : function(){\n\t        var panel = this;\n\t        return [\n\t            {   html: _l( 'Build Dataset List' ), func: function() {\n\t                    LIST_COLLECTION_CREATOR.createListCollection( panel.getSelectedModels() )\n\t                        .done( function(){ panel.model.refresh() });\n\t                }\n\t            },\n\t            // TODO: Only show quick pair if two things selected.\n\t            {   html: _l( 'Build Dataset Pair' ), func: function() {\n\t                    PAIR_COLLECTION_CREATOR.createPairCollection( panel.getSelectedModels() )\n\t                        .done( function(){ panel.model.refresh() });\n\t                }\n\t            },\n\t            {   html: _l( 'Build List of Dataset Pairs' ), func: function() {\n\t                    LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection( panel.getSelectedModels() )\n\t                        .done( function(){ panel.model.refresh() });\n\t                }\n\t            },\n\t        ];\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ sub-views\n\t    // reverse HID order\n\t    /** Override to reverse order of views - newest contents on top */\n\t    _attachItems : function( $whereTo ){\n\t        this.$list( $whereTo ).append( this.views.reverse().map( function( view ){\n\t            return view.$el;\n\t        }));\n\t        return this;\n\t    },\n\t\n\t    /** Override to add new contents at the top */\n\t    _attachView : function( view ){\n\t        var panel = this;\n\t        // override to control where the view is added, how/whether it's rendered\n\t        panel.views.unshift( view );\n\t        panel.$list().prepend( view.render( 0 ).$el.hide() );\n\t        panel.trigger( 'view:attached', view );\n\t        view.$el.slideDown( panel.fxSpeed, function(){\n\t            panel.trigger( 'view:attached:rendered' );\n\t        });\n\t    },\n\t\n\t    /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n\t    _getItemViewOptions : function( model ){\n\t        var options = _super.prototype._getItemViewOptions.call( this, model );\n\t        _.extend( options, {\n\t            purgeAllowed            : this.purgeAllowed,\n\t//TODO: not working\n\t            tagsEditorShown         : ( this.tagsEditor && !this.tagsEditor.hidden ),\n\t            annotationEditorShown   : ( this.annotationEditor && !this.annotationEditor.hidden )\n\t        });\n\t        return options;\n\t    },\n\t\n\t    ///** Override to alter data in drag based on multiselection */\n\t    //_setUpItemViewListeners : function( view ){\n\t    //    var panel = this;\n\t    //    _super.prototype._setUpItemViewListeners.call( panel, view );\n\t    //\n\t    //},\n\t\n\t    /** If this item is deleted and we're not showing deleted items, remove the view\n\t     *  @param {Model} the item model to check\n\t     */\n\t    _handleHdaDeletionChange : function( itemModel ){\n\t        if( itemModel.get( 'deleted' ) && !this.showDeleted ){\n\t            this.removeItemView( itemModel );\n\t        }\n\t        this._renderCounts();\n\t    },\n\t\n\t    /** If this item is hidden and we're not showing hidden items, remove the view\n\t     *  @param {Model} the item model to check\n\t     */\n\t    _handleHdaVisibleChange : function( itemModel ){\n\t        if( itemModel.hidden() && !this.showHidden ){\n\t            this.removeItemView( itemModel );\n\t        }\n\t        this._renderCounts();\n\t    },\n\t\n\t    /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n\t    toggleHDATagEditors : function( showOrHide ){\n\t        var args = Array.prototype.slice.call( arguments, 1 );\n\t        _.each( this.views, function( view ){\n\t            if( view.tagsEditor ){\n\t                view.tagsEditor.toggle.apply( view.tagsEditor, args );\n\t            }\n\t        });\n\t    },\n\t\n\t    /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n\t    toggleHDAAnnotationEditors : function( showOrHide ){\n\t        var args = Array.prototype.slice.call( arguments, 1 );\n\t        _.each( this.views, function( view ){\n\t            if( view.annotationEditor ){\n\t                view.annotationEditor.toggle.apply( view.annotationEditor, args );\n\t            }\n\t        });\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel events\n\t    /** event map */\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        'click .show-selectors-btn'                 : 'toggleSelectors',\n\t        'click .toggle-deleted-link'                : function( ev ){ this.toggleShowDeleted(); },\n\t        'click .toggle-hidden-link'                 : function( ev ){ this.toggleShowHidden(); }\n\t    }),\n\t\n\t    /** Update the history size display (curr. upper right of panel).\n\t     */\n\t    updateHistoryDiskSize : function(){\n\t        this.$el.find( '.history-size' ).text( this.model.get( 'nice_size' ) );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ as drop target\n\t    /**  */\n\t    dropTargetOn : function(){\n\t        if( this.dropTarget ){ return this; }\n\t        this.dropTarget = true;\n\t\n\t        //TODO: to init\n\t        var dropHandlers = {\n\t            'dragenter' : _.bind( this.dragenter, this ),\n\t            'dragover'  : _.bind( this.dragover,  this ),\n\t            'dragleave' : _.bind( this.dragleave, this ),\n\t            'drop'      : _.bind( this.drop, this )\n\t        };\n\t//TODO: scroll to top\n\t        var $dropTarget = this._renderDropTarget();\n\t        this.$list().before([ this._renderDropTargetHelp(), $dropTarget ]);\n\t        for( var evName in dropHandlers ){\n\t            if( dropHandlers.hasOwnProperty( evName ) ){\n\t                //console.debug( evName, dropHandlers[ evName ] );\n\t                $dropTarget.on( evName, dropHandlers[ evName ] );\n\t            }\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /**  */\n\t    _renderDropTarget : function(){\n\t        this.$( '.history-drop-target' ).remove();\n\t        return $( '<div/>' ).addClass( 'history-drop-target' )\n\t            .css({\n\t                'height': '64px',\n\t                'margin': '0px 10px 10px 10px',\n\t                'border': '1px dashed black',\n\t                'border-radius' : '3px'\n\t            });\n\t    },\n\t\n\t    /**  */\n\t    _renderDropTargetHelp : function(){\n\t        this.$( '.history-drop-target-help' ).remove();\n\t        return $( '<div/>' ).addClass( 'history-drop-target-help' )\n\t            .css({\n\t                'margin'        : '10px 10px 4px 10px',\n\t                'color'         : 'grey',\n\t                'font-size'     : '80%',\n\t                'font-style'    : 'italic'\n\t            })\n\t            .text( _l( 'Drag datasets here to copy them to the current history' ) );\n\t    },\n\t\n\t    /**  */\n\t    dropTargetOff : function(){\n\t        if( !this.dropTarget ){ return this; }\n\t        //this.log( 'dropTargetOff' );\n\t        this.dropTarget = false;\n\t        var dropTarget = this.$( '.history-drop-target' ).get(0);\n\t        for( var evName in this._dropHandlers ){\n\t            if( this._dropHandlers.hasOwnProperty( evName ) ){\n\t                dropTarget.off( evName, this._dropHandlers[ evName ] );\n\t            }\n\t        }\n\t        this.$( '.history-drop-target' ).remove();\n\t        this.$( '.history-drop-target-help' ).remove();\n\t        return this;\n\t    },\n\t    /**  */\n\t    dropTargetToggle : function(){\n\t        if( this.dropTarget ){\n\t            this.dropTargetOff();\n\t        } else {\n\t            this.dropTargetOn();\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /**  */\n\t    dragenter : function( ev ){\n\t        //console.debug( 'dragenter:', this, ev );\n\t        ev.preventDefault();\n\t        ev.stopPropagation();\n\t        this.$( '.history-drop-target' ).css( 'border', '2px solid black' );\n\t    },\n\t    /**  */\n\t    dragover : function( ev ){\n\t        ev.preventDefault();\n\t        ev.stopPropagation();\n\t    },\n\t    /**  */\n\t    dragleave : function( ev ){\n\t        //console.debug( 'dragleave:', this, ev );\n\t        ev.preventDefault();\n\t        ev.stopPropagation();\n\t        this.$( '.history-drop-target' ).css( 'border', '1px dashed black' );\n\t    },\n\t    /**  */\n\t    drop : function( ev ){\n\t        //console.warn( 'dataTransfer:', ev.dataTransfer.getData( 'text' ) );\n\t        //console.warn( 'dataTransfer:', ev.originalEvent.dataTransfer.getData( 'text' ) );\n\t        ev.preventDefault();\n\t        //ev.stopPropagation();\n\t        ev.dataTransfer.dropEffect = 'move';\n\t\n\t        //console.debug( 'ev.dataTransfer:', ev.dataTransfer );\n\t\n\t        var panel = this,\n\t            data = ev.dataTransfer.getData( \"text\" );\n\t        try {\n\t            data = JSON.parse( data );\n\t\n\t        } catch( err ){\n\t            this.warn( 'error parsing JSON from drop:', data );\n\t        }\n\t        this.trigger( 'droptarget:drop', ev, data, panel );\n\t        return false;\n\t    },\n\t\n\t    /**  */\n\t    dataDropped : function( data ){\n\t        var panel = this;\n\t        // HDA: dropping will copy it to the history\n\t        if( _.isObject( data ) && data.model_class === 'HistoryDatasetAssociation' && data.id ){\n\t            return panel.model.contents.copy( data.id );\n\t        }\n\t        return jQuery.when();\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** Return a string rep of the history */\n\t    toString    : function(){\n\t        return 'HistoryPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t//==============================================================================\n\t    return {\n\t        HistoryPanelEdit : HistoryPanelEdit\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 69 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t    __webpack_require__(34),\n\t    __webpack_require__(33),\n\t    __webpack_require__(18),\n\t    __webpack_require__(30),\n\t    __webpack_require__(32),\n\t    __webpack_require__(10),\n\t    __webpack_require__(39),\n\t    __webpack_require__(7),\n\t    __webpack_require__(24),\n\t    __webpack_require__(3),\n\t    __webpack_require__(1),\n\t    __webpack_require__(41)\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(\n\t    LIST_PANEL,\n\t    HISTORY_MODEL,\n\t    HISTORY_CONTENTS,\n\t    HDA_LI,\n\t    HDCA_LI,\n\t    COLLECTION_PANEL,\n\t    USER,\n\t    faIconButton,\n\t    PopupMenu,\n\t    BASE_MVC,\n\t    _l\n\t){\n\t// ============================================================================\n\t/** session storage for individual history preferences */\n\tvar HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n\t/** @lends HistoryPrefs.prototype */{\n\t//TODO:?? possibly mark as current T/F - have History.currId() (a class method) return that value\n\t    defaults : {\n\t//TODO:?? expandedIds to array?\n\t        expandedIds : {},\n\t        //TODO:?? move to user?\n\t        show_deleted : false,\n\t        show_hidden  : false\n\t        //TODO: add scroll position?\n\t    },\n\t    /** add an hda id to the hash of expanded hdas */\n\t    addExpanded : function( model ){\n\t        var key = 'expandedIds';\n\t//TODO:?? is this right anymore?\n\t        this.save( key, _.extend( this.get( key ), _.object([ model.id ], [ model.get( 'id' ) ]) ) );\n\t    },\n\t    /** remove an hda id from the hash of expanded hdas */\n\t    removeExpanded : function( model ){\n\t        var key = 'expandedIds';\n\t        this.save( key, _.omit( this.get( key ), model.id ) );\n\t    },\n\t    toString : function(){\n\t        return 'HistoryPrefs(' + this.id + ')';\n\t    }\n\t});\n\t// class lvl for access w/o instantiation\n\tHistoryPrefs.storageKeyPrefix = 'history:';\n\t\n\t/** key string to store each histories settings under */\n\tHistoryPrefs.historyStorageKey = function historyStorageKey( historyId ){\n\t    if( !historyId ){\n\t        throw new Error( 'HistoryPrefs.historyStorageKey needs valid id: ' + historyId );\n\t    }\n\t    // single point of change\n\t    return ( HistoryPrefs.storageKeyPrefix + historyId );\n\t};\n\t/** return the existing storage for the history with the given id (or create one if it doesn't exist) */\n\tHistoryPrefs.get = function get( historyId ){\n\t    return new HistoryPrefs({ id: HistoryPrefs.historyStorageKey( historyId ) });\n\t};\n\t/** clear all history related items in sessionStorage */\n\tHistoryPrefs.clearAll = function clearAll( historyId ){\n\t    for( var key in sessionStorage ){\n\t        if( key.indexOf( HistoryPrefs.storageKeyPrefix ) === 0 ){\n\t            sessionStorage.removeItem( key );\n\t        }\n\t    }\n\t};\n\t\n\t\n\t/* =============================================================================\n\tTODO:\n\t\n\t============================================================================= */\n\t/** @class  non-editable, read-only View/Controller for a history model.\n\t *  Allows:\n\t *      changing the loaded history\n\t *      displaying data, info, and download\n\t *      tracking history attrs: size, tags, annotations, name, etc.\n\t *  Does not allow:\n\t *      changing the name\n\t */\n\tvar _super = LIST_PANEL.ModelListPanel;\n\tvar HistoryPanel = _super.extend(\n\t/** @lends HistoryPanel.prototype */{\n\t\n\t    /** logger used to record this.log messages, commonly set to console */\n\t    //logger              : console,\n\t\n\t    /** class to use for constructing the HDA views */\n\t    HDAViewClass        : HDA_LI.HDAListItemView,\n\t    /** class to use for constructing the HDCA views */\n\t    HDCAViewClass       : HDCA_LI.HDCAListItemView,\n\t    /** class to used for constructing collection of sub-view models */\n\t    collectionClass     : HISTORY_CONTENTS.HistoryContents,\n\t    /** key of attribute in model to assign to this.collection */\n\t    modelCollectionKey  : 'contents',\n\t\n\t    tagName             : 'div',\n\t    className           : _super.prototype.className + ' history-panel',\n\t\n\t    /** string to display when the collection is empty */\n\t    emptyMsg            : _l( 'This history is empty' ),\n\t    /** displayed when no items match the search terms */\n\t    noneFoundMsg        : _l( 'No matching datasets found' ),\n\t    /** string used for search placeholder */\n\t    searchPlaceholder   : _l( 'search datasets' ),\n\t\n\t    // ......................................................................... SET UP\n\t    /** Set up the view, bind listeners.\n\t     *  @param {Object} attributes optional settings for the panel\n\t     */\n\t    initialize : function( attributes ){\n\t        _super.prototype.initialize.call( this, attributes );\n\t        // ---- instance vars\n\t        // control contents/behavior based on where (and in what context) the panel is being used\n\t        /** where should pages from links be displayed? (default to new tab/window) */\n\t        this.linkTarget = attributes.linkTarget || '_blank';\n\t    },\n\t\n\t    /** In this override, clear the update timer on the model */\n\t    freeModel : function(){\n\t        _super.prototype.freeModel.call( this );\n\t//TODO: move to History.free()\n\t        if( this.model ){\n\t            this.model.clearUpdateTimeout();\n\t        }\n\t        return this;\n\t    },\n\t\n\t    /** create any event listeners for the panel\n\t     *  @fires: rendered:initial    on the first render\n\t     *  @fires: empty-history       when switching to a history with no contents or creating a new history\n\t     */\n\t    _setUpListeners : function(){\n\t        _super.prototype._setUpListeners.call( this );\n\t        this.on({\n\t            error : function( model, xhr, options, msg, details ){\n\t                this.errorHandler( model, xhr, options, msg, details );\n\t            },\n\t            'loading-done' : function(){\n\t                //TODO:?? if( this.collection.length ){\n\t                if( !this.views.length ){\n\t                    this.trigger( 'empty-history', this );\n\t                }\n\t            },\n\t            'views:ready view:attached view:removed' : function( view ){\n\t                this._renderSelectButton();\n\t            }\n\t        });\n\t        // this.on( 'all', function(){ console.debug( arguments ); });\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ loading history/hda models\n\t    //NOTE: all the following fns replace the existing history model with a new model\n\t    // (in the following 'details' refers to the full set of contents api data (urls, display_apps, misc_info, etc.)\n\t    //  - contents w/o details will have summary data only (name, hid, deleted, visible, state, etc.))\n\t//TODO: too tangled...\n\t\n\t    /** loads a history & contents, getting details of any contents whose ids are stored in sessionStorage\n\t     *      (but does not make them the current history)\n\t     */\n\t    loadHistoryWithDetails : function( historyId, attributes, historyFn, contentsFn ){\n\t        this.info( 'loadHistoryWithDetails:', historyId, attributes, historyFn, contentsFn );\n\t        var detailIdsFn = function( historyData ){\n\t                // will be called to get content ids that need details from the api\n\t//TODO:! non-visible contents are getting details loaded... either stop loading them at all or filter ids thru isVisible\n\t                return _.values( HistoryPrefs.get( historyData.id ).get( 'expandedIds' ) );\n\t            };\n\t        return this.loadHistory( historyId, attributes, historyFn, contentsFn, detailIdsFn );\n\t    },\n\t\n\t    /** loads a history & contents (but does not make them the current history) */\n\t    loadHistory : function( historyId, attributes, historyFn, contentsFn, detailIdsFn ){\n\t        this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n\t        var panel = this;\n\t        attributes = attributes || {};\n\t\n\t        panel.trigger( 'loading', panel );\n\t        //this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n\t        var xhr = HISTORY_MODEL.History.getHistoryData( historyId, {\n\t                historyFn       : historyFn,\n\t                contentsFn      : contentsFn,\n\t                detailIdsFn     : attributes.initiallyExpanded || detailIdsFn\n\t            });\n\t\n\t        return panel._loadHistoryFromXHR( xhr, attributes )\n\t            .fail( function( xhr, where, history ){\n\t                // throw an error up for the error handler\n\t                panel.trigger( 'error', panel, xhr, attributes, _l( 'An error was encountered while ' + where ),\n\t                    { historyId: historyId, history: history || {} });\n\t            })\n\t            .always( function(){\n\t                // bc _hideLoadingIndicator relies on this firing\n\t                panel.trigger( 'loading-done', panel );\n\t            });\n\t    },\n\t\n\t    /** given an xhr that will provide both history and contents data, pass data to set model or handle xhr errors */\n\t    _loadHistoryFromXHR : function( xhr, attributes ){\n\t        var panel = this;\n\t        xhr.then( function( historyJSON, contentsJSON ){\n\t            panel.JSONToModel( historyJSON, contentsJSON, attributes );\n\t            panel.render();\n\t        });\n\t        xhr.fail( function( xhr, where ){\n\t            // render anyways - whether we get a model or not\n\t            panel.render();\n\t        });\n\t        return xhr;\n\t    },\n\t\n\t    /** convenience alias to the model. Updates the item list only (not the history) */\n\t    refreshContents : function( detailIds, options ){\n\t        if( this.model ){\n\t            return this.model.refresh( detailIds, options );\n\t        }\n\t        // may have callbacks - so return an empty promise\n\t        return $.when();\n\t    },\n\t\n\t//TODO:?? seems unneccesary\n\t//TODO: Maybe better in History?\n\t    /** create a new history model from JSON and call setModel on it */\n\t    JSONToModel : function( newHistoryJSON, newHdaJSON, attributes ){\n\t        this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON, attributes );\n\t        attributes = attributes || {};\n\t        //this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON.length, attributes );\n\t\n\t        var model = new HISTORY_MODEL.History( newHistoryJSON, newHdaJSON, attributes );\n\t//TODO:?? here?\n\t        this.setModel( model );\n\t        return model;\n\t    },\n\t\n\t    /** release/free/shutdown old models and set up panel for new models\n\t     *  @fires new-model with the panel as parameter\n\t     */\n\t    setModel : function( model, attributes ){\n\t        attributes = attributes || {};\n\t        _super.prototype.setModel.call( this, model, attributes );\n\t        if( this.model ){\n\t            this._setUpWebStorage( attributes.initiallyExpanded, attributes.show_deleted, attributes.show_hidden );\n\t        }\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ browser stored prefs\n\t    /** Set up client side storage. Currently PersistanStorage keyed under 'HistoryPanel.<id>'\n\t     *  @param {Object} initiallyExpanded\n\t     *  @param {Boolean} show_deleted whether to show deleted contents (overrides stored)\n\t     *  @param {Boolean} show_hidden\n\t     *  @see PersistentStorage\n\t     */\n\t    _setUpWebStorage : function( initiallyExpanded, show_deleted, show_hidden ){\n\t        //if( !this.model ){ return this; }\n\t        //this.log( '_setUpWebStorage', initiallyExpanded, show_deleted, show_hidden );\n\t        if( this.storage ){\n\t            this.stopListening( this.storage );\n\t        }\n\t\n\t        this.storage = new HistoryPrefs({\n\t            id: HistoryPrefs.historyStorageKey( this.model.get( 'id' ) )\n\t        });\n\t\n\t        // expandedIds is a map of content.ids -> a boolean repr'ing whether that item's body is already expanded\n\t        // store any pre-expanded ids passed in\n\t        if( _.isObject( initiallyExpanded ) ){\n\t            this.storage.set( 'expandedIds', initiallyExpanded );\n\t        }\n\t\n\t        // get the show_deleted/hidden settings giving priority to values passed in, using web storage otherwise\n\t        // if the page has specifically requested show_deleted/hidden, these will be either true or false\n\t        //  (as opposed to undefined, null) - and we give priority to that setting\n\t        if( _.isBoolean( show_deleted ) ){\n\t            this.storage.set( 'show_deleted', show_deleted );\n\t        }\n\t        if( _.isBoolean( show_hidden ) ){\n\t            this.storage.set( 'show_hidden', show_hidden );\n\t        }\n\t\n\t        this.trigger( 'new-storage', this.storage, this );\n\t        this.log( this + ' (init\\'d) storage:', this.storage.get() );\n\t\n\t        this.listenTo( this.storage, {\n\t            'change:show_deleted' : function( view, newVal ){\n\t                this.showDeleted = newVal;\n\t            },\n\t            'change:show_hidden' : function( view, newVal ){\n\t                this.showHidden = newVal;\n\t            }\n\t        }, this );\n\t        this.showDeleted = ( show_deleted !== undefined )? show_deleted : this.storage.get( 'show_deleted' );\n\t        this.showHidden  = ( show_hidden  !== undefined )? show_hidden  : this.storage.get( 'show_hidden' );\n\t\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel rendering\n\t    /** In this override, add a btn to toggle the selectors */\n\t    _buildNewRender : function(){\n\t        var $newRender = _super.prototype._buildNewRender.call( this );\n\t        this._renderSelectButton( $newRender );\n\t        return $newRender;\n\t    },\n\t\n\t    /** button for starting select mode */\n\t    _renderSelectButton : function( $where ){\n\t        $where = $where || this.$el;\n\t        // do not render selector option if no actions\n\t        if( !this.multiselectActions().length ){\n\t            return null;\n\t        }\n\t        // do not render (and remove even) if nothing to select\n\t        if( !this.views.length ){\n\t            this.hideSelectors();\n\t            $where.find( '.controls .actions .show-selectors-btn' ).remove();\n\t            return null;\n\t        }\n\t        // don't bother rendering if there's one already\n\t        var $existing = $where.find( '.controls .actions .show-selectors-btn' );\n\t        if( $existing.size() ){\n\t            return $existing;\n\t        }\n\t\n\t        return faIconButton({\n\t            title   : _l( 'Operations on multiple datasets' ),\n\t            classes : 'show-selectors-btn',\n\t            faIcon  : 'fa-check-square-o'\n\t        }).prependTo( $where.find( '.controls .actions' ) );\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ sub-views\n\t    /** In this override, since history contents are mixed,\n\t     *      get the appropo view class based on history_content_type\n\t     */\n\t    _getItemViewClass : function( model ){\n\t        var contentType = model.get( \"history_content_type\" );\n\t        switch( contentType ){\n\t            case 'dataset':\n\t                return this.HDAViewClass;\n\t            case 'dataset_collection':\n\t                return this.HDCAViewClass;\n\t        }\n\t        throw new TypeError( 'Unknown history_content_type: ' + contentType );\n\t    },\n\t\n\t    /** in this override, check if the contents would also display based on show_deleted/hidden */\n\t    _filterItem : function( model ){\n\t        var panel = this;\n\t        return ( _super.prototype._filterItem.call( panel, model )\n\t            && ( !model.hidden() || panel.showHidden )\n\t            && ( !model.isDeletedOrPurged() || panel.showDeleted ) );\n\t    },\n\t\n\t    /** in this override, add a linktarget, and expand if id is in web storage */\n\t    _getItemViewOptions : function( model ){\n\t        var options = _super.prototype._getItemViewOptions.call( this, model );\n\t        return _.extend( options, {\n\t            linkTarget      : this.linkTarget,\n\t            expanded        : !!this.storage.get( 'expandedIds' )[ model.id ],\n\t            hasUser         : this.model.ownedByCurrUser()\n\t        });\n\t    },\n\t\n\t    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n\t    _setUpItemViewListeners : function( view ){\n\t        var panel = this;\n\t        _super.prototype._setUpItemViewListeners.call( panel, view );\n\t\n\t        //TODO:?? could use 'view:expanded' here?\n\t        // maintain a list of items whose bodies are expanded\n\t        view.on( 'expanded', function( v ){\n\t            panel.storage.addExpanded( v.model );\n\t        });\n\t        view.on( 'collapsed', function( v ){\n\t            panel.storage.removeExpanded( v.model );\n\t        });\n\t        return this;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ selection\n\t    /** Override to correctly set the historyId of the new collection */\n\t    getSelectedModels : function(){\n\t        var collection = _super.prototype.getSelectedModels.call( this );\n\t        collection.historyId = this.collection.historyId;\n\t        return collection;\n\t    },\n\t\n\t    // ------------------------------------------------------------------------ panel events\n\t    /** event map */\n\t    events : _.extend( _.clone( _super.prototype.events ), {\n\t        // toggle list item selectors\n\t        'click .show-selectors-btn'         : 'toggleSelectors',\n\t        // allow (error) messages to be clicked away\n\t        'click .messages [class$=message]'  : 'clearMessages'\n\t    }),\n\t\n\t    /** Handle the user toggling the deleted visibility by:\n\t     *      (1) storing the new value in the persistent storage\n\t     *      (2) re-rendering the history\n\t     * @returns {Boolean} new show_deleted setting\n\t     */\n\t    toggleShowDeleted : function( show, store ){\n\t        show = ( show !== undefined )?( show ):( !this.showDeleted );\n\t        store = ( store !== undefined )?( store ):( true );\n\t        this.showDeleted = show;\n\t        if( store ){\n\t            this.storage.set( 'show_deleted', show );\n\t        }\n\t        //TODO:?? to events on storage('change:show_deleted')\n\t        this.renderItems();\n\t        this.trigger( 'show-deleted', show );\n\t        return this.showDeleted;\n\t    },\n\t\n\t    /** Handle the user toggling the hidden visibility by:\n\t     *      (1) storing the new value in the persistent storage\n\t     *      (2) re-rendering the history\n\t     * @returns {Boolean} new show_hidden setting\n\t     */\n\t    toggleShowHidden : function( show, store ){\n\t        show = ( show !== undefined )?( show ):( !this.showHidden );\n\t        store = ( store !== undefined )?( store ):( true );\n\t        this.showHidden = show;\n\t        if( store ){\n\t            this.storage.set( 'show_hidden', show );\n\t        }\n\t        //TODO:?? to events on storage('change:show_deleted')\n\t        this.renderItems();\n\t        this.trigger( 'show-hidden', show );\n\t        return this.showHidden;\n\t    },\n\t\n\t    /** On the first search, if there are no details - load them, then search */\n\t    _firstSearch : function( searchFor ){\n\t        var panel = this,\n\t            inputSelector = '.history-search-input';\n\t        this.log( 'onFirstSearch', searchFor );\n\t\n\t        if( panel.model.contents.haveDetails() ){\n\t            panel.searchItems( searchFor );\n\t            return;\n\t        }\n\t\n\t        panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n\t        panel.model.contents.fetchAllDetails({ silent: true })\n\t            .always( function(){\n\t                panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n\t            })\n\t            .done( function(){\n\t                panel.searchItems( panel.searchFor );\n\t            });\n\t    },\n\t\n\t//TODO: break this out\n\t    // ........................................................................ error handling\n\t    /** Event handler for errors (from the panel, the history, or the history's contents)\n\t     *  @param {Model or View} model    the (Backbone) source of the error\n\t     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n\t     *  @param {Object} options         the options map commonly used with bbone ajax\n\t     *  @param {String} msg             optional message passed to ease error location\n\t     *  @param {Object} msg             optional object containing error details\n\t     */\n\t    errorHandler : function( model, xhr, options, msg, details ){\n\t        this.error( model, xhr, options, msg, details );\n\t\n\t        // interrupted ajax\n\t        if( xhr && xhr.status === 0 && xhr.readyState === 0 ){\n\t            //TODO: gmail style 'retrying in Ns'\n\t\n\t        // bad gateway\n\t        } else if( xhr && xhr.status === 502 ){\n\t            //TODO: gmail style 'retrying in Ns'\n\t\n\t        // otherwise, show an error message inside the panel\n\t        } else {\n\t            // if sentry is available, attempt to get the event id\n\t            var parsed = this._parseErrorMessage( model, xhr, options, msg, details );\n\t            // it's possible to have a triggered error before the message container is rendered - wait for it to show\n\t            if( !this.$messages().is( ':visible' ) ){\n\t                this.once( 'rendered', function(){\n\t                    this.displayMessage( 'error', parsed.message, parsed.details );\n\t                });\n\t            } else {\n\t                this.displayMessage( 'error', parsed.message, parsed.details );\n\t            }\n\t        }\n\t    },\n\t\n\t    /** Parse an error event into an Object usable by displayMessage based on the parameters\n\t     *      note: see errorHandler for more info on params\n\t     */\n\t    _parseErrorMessage : function( model, xhr, options, msg, details, sentryId ){\n\t        //if( xhr.responseText ){\n\t        //    xhr.responseText = _.escape( xhr.responseText );\n\t        //}\n\t        var user = Galaxy.currUser,\n\t            // add the args (w/ some extra info) into an obj\n\t            parsed = {\n\t                message : this._bePolite( msg ),\n\t                details : {\n\t                    message : msg,\n\t                    raven   : ( window.Raven && _.isFunction( Raven.lastEventId) )?\n\t                                    ( Raven.lastEventId() ):( undefined ),\n\t                    agent   : navigator.userAgent,\n\t                    // add ajax data from Galaxy object cache\n\t                    url     : ( window.Galaxy )?( Galaxy.lastAjax.url ):( undefined ),\n\t                    data    : ( window.Galaxy )?( Galaxy.lastAjax.data ):( undefined ),\n\t                    options : ( xhr )?( _.omit( options, 'xhr' ) ):( options ),\n\t                    xhr     : xhr,\n\t                    source  : ( _.isFunction( model.toJSON ) )?( model.toJSON() ):( model + '' ),\n\t                    user    : ( user instanceof USER.User )?( user.toJSON() ):( user + '' )\n\t                }\n\t            };\n\t\n\t        // add any extra details passed in\n\t        _.extend( parsed.details, details || {} );\n\t        // fancy xhr.header parsing (--> obj)\n\t        if( xhr &&  _.isFunction( xhr.getAllResponseHeaders ) ){\n\t            var responseHeaders = xhr.getAllResponseHeaders();\n\t            responseHeaders = _.compact( responseHeaders.split( '\\n' ) );\n\t            responseHeaders = _.map( responseHeaders, function( header ){\n\t                return header.split( ': ' );\n\t            });\n\t            parsed.details.xhr.responseHeaders = _.object( responseHeaders );\n\t        }\n\t        return parsed;\n\t    },\n\t\n\t    /** Modify an error message to be fancy and wear a monocle. */\n\t    _bePolite : function( msg ){\n\t        msg = msg || _l( 'An error occurred while getting updates from the server' );\n\t        return msg + '. ' + _l( 'Please contact a Galaxy administrator if the problem persists' ) + '.';\n\t    },\n\t\n\t    // ........................................................................ (error) messages\n\t    /** Display a message in the top of the panel.\n\t     *  @param {String} type    type of message ('done', 'error', 'warning')\n\t     *  @param {String} msg     the message to display\n\t     *  @param {Object or HTML} modal contents displayed when the user clicks 'details' in the message\n\t     */\n\t    displayMessage : function( type, msg, details ){\n\t        //precondition: msgContainer must have been rendered even if there's no model\n\t        var panel = this;\n\t        //this.log( 'displayMessage', type, msg, details );\n\t\n\t        this.scrollToTop();\n\t        var $msgContainer = this.$messages(),\n\t            $msg = $( '<div/>' ).addClass( type + 'message' ).html( msg );\n\t        //this.log( '  ', $msgContainer );\n\t\n\t        if( !_.isEmpty( details ) ){\n\t            var $detailsLink = $( '<a href=\"javascript:void(0)\">Details</a>' )\n\t                .click( function(){\n\t                    Galaxy.modal.show( panel._messageToModalOptions( type, msg, details ) );\n\t                    return false;\n\t                });\n\t            $msg.append( ' ', $detailsLink );\n\t        }\n\t        return $msgContainer.append( $msg );\n\t    },\n\t\n\t    /** convert msg and details into modal options usable by Galaxy.modal */\n\t    _messageToModalOptions : function( type, msg, details ){\n\t        // only error is fleshed out here\n\t        var panel = this,\n\t            options = { title: 'Details' };\n\t        if( _.isObject( details ) ){\n\t\n\t            details = _.omit( details, _.functions( details ) );\n\t            var text = JSON.stringify( details, null, '  ' ),\n\t                pre = $( '<pre/>' ).text( text );\n\t            options.body = $( '<div/>' ).append( pre );\n\t\n\t        } else {\n\t            options.body = $( '<div/>' ).html( details );\n\t        }\n\t\n\t        options.buttons = {\n\t            'Ok': function(){\n\t                Galaxy.modal.hide();\n\t                panel.clearMessages();\n\t            }\n\t            //TODO: if( type === 'error' ){ options.buttons[ 'Report this error' ] = function(){} }\n\t        };\n\t        return options;\n\t    },\n\t\n\t    /** Remove all messages from the panel. */\n\t    clearMessages : function( ev ){\n\t        var $target = !_.isUndefined( ev )?\n\t            $( ev.currentTarget )\n\t            :this.$messages().children( '[class$=\"message\"]' );\n\t        $target.fadeOut( this.fxSpeed, function(){\n\t            $( this ).remove();\n\t        });\n\t        return this;\n\t    },\n\t\n\t    // ........................................................................ scrolling\n\t    /** Scrolls the panel to show the content sub-view with the given hid.\n\t     *  @param {Integer} hid    the hid of item to scroll into view\n\t     *  @returns {HistoryPanel} the panel\n\t     */\n\t    scrollToHid : function( hid ){\n\t        return this.scrollToItem( _.first( this.viewsWhereModel({ hid: hid }) ) );\n\t    },\n\t\n\t    // ........................................................................ misc\n\t    /** Return a string rep of the history */\n\t    toString : function(){\n\t        return 'HistoryPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n\t    }\n\t});\n\t\n\t\n\t//------------------------------------------------------------------------------ TEMPLATES\n\tHistoryPanel.prototype.templates = (function(){\n\t\n\t    var controlsTemplate = BASE_MVC.wrapTemplate([\n\t        '<div class=\"controls\">',\n\t            '<div class=\"title\">',\n\t                '<div class=\"name\"><%= history.name %></div>',\n\t            '</div>',\n\t            '<div class=\"subtitle\"></div>',\n\t            '<div class=\"history-size\"><%= history.nice_size %></div>',\n\t\n\t            '<div class=\"actions\"></div>',\n\t\n\t            '<div class=\"messages\">',\n\t                '<% if( history.deleted && history.purged ){ %>',\n\t                    '<div class=\"deleted-msg warningmessagesmall\">',\n\t                        _l( 'This history has been purged and deleted' ),\n\t                    '</div>',\n\t                '<% } else if( history.deleted ){ %>',\n\t                    '<div class=\"deleted-msg warningmessagesmall\">',\n\t                        _l( 'This history has been deleted' ),\n\t                    '</div>',\n\t                '<% } else if( history.purged ){ %>',\n\t                    '<div class=\"deleted-msg warningmessagesmall\">',\n\t                        _l( 'This history has been purged' ),\n\t                    '</div>',\n\t                '<% } %>',\n\t\n\t                '<% if( history.message ){ %>',\n\t                    // should already be localized\n\t                    '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n\t                        '<%= history.message.text %>',\n\t                    '</div>',\n\t                '<% } %>',\n\t            '</div>',\n\t\n\t            // add tags and annotations\n\t            '<div class=\"tags-display\"></div>',\n\t            '<div class=\"annotation-display\"></div>',\n\t\n\t            '<div class=\"search\">',\n\t                '<div class=\"search-input\"></div>',\n\t            '</div>',\n\t\n\t            '<div class=\"list-actions\">',\n\t                '<div class=\"btn-group\">',\n\t                    '<button class=\"select-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n\t                    '<button class=\"deselect-all btn btn-default\"',\n\t                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n\t                '</div>',\n\t                '<div class=\"list-action-menu btn-group\">',\n\t                '</div>',\n\t            '</div>',\n\t        '</div>'\n\t    ], 'history' );\n\t\n\t    return _.extend( _.clone( _super.prototype.templates ), {\n\t        controls : controlsTemplate\n\t    });\n\t}());\n\t\n\t\n\t//==============================================================================\n\t    return {\n\t        HistoryPanel: HistoryPanel\n\t    };\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ },\n/* 70 */,\n/* 71 */,\n/* 72 */,\n/* 73 */,\n/* 74 */,\n/* 75 */,\n/* 76 */,\n/* 77 */,\n/* 78 */,\n/* 79 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory) {\n\t    if (true) {\n\t        // AMD. Register as an anonymous module.\n\t        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t    } else {\n\t        // Browser globals\n\t        root.LoadingIndicator = factory();\n\t    }\n\t\n\t//============================================================================\n\t}(this, function () {\n\t    //TODO: too specific to history panel\n\t    function LoadingIndicator( $where, options ){\n\t\n\t        var self = this;\n\t        // defaults\n\t        options = jQuery.extend({\n\t            cover       : false\n\t        }, options || {} );\n\t\n\t        function render(){\n\t            var html = [\n\t                '<div class=\"loading-indicator\">',\n\t                    '<div class=\"loading-indicator-text\">',\n\t                        '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>',\n\t                        '<span class=\"loading-indicator-message\">loading...</span>',\n\t                    '</div>',\n\t                '</div>'\n\t            ].join( '\\n' );\n\t\n\t            var $indicator = $( html ).hide().css( options.css || {\n\t                    position    : 'fixed'\n\t                }),\n\t                $text = $indicator.children( '.loading-indicator-text' );\n\t\n\t            if( options.cover ){\n\t                $indicator.css({\n\t                    'z-index'   : 2,\n\t                    top         : $where.css( 'top' ),\n\t                    bottom      : $where.css( 'bottom' ),\n\t                    left        : $where.css( 'left' ),\n\t                    right       : $where.css( 'right' ),\n\t                    opacity     : 0.5,\n\t                    'background-color': 'white',\n\t                    'text-align': 'center'\n\t                });\n\t                $text = $indicator.children( '.loading-indicator-text' ).css({\n\t                    'margin-top'        : '20px'\n\t                });\n\t\n\t            } else {\n\t                $text = $indicator.children( '.loading-indicator-text' ).css({\n\t                    margin              : '12px 0px 0px 10px',\n\t                    opacity             : '0.85',\n\t                    color               : 'grey'\n\t                });\n\t                $text.children( '.loading-indicator-message' ).css({\n\t                    margin          : '0px 8px 0px 0px',\n\t                    'font-style'    : 'italic'\n\t                });\n\t            }\n\t            return $indicator;\n\t        }\n\t\n\t        self.show = function( msg, speed, callback ){\n\t            msg = msg || 'loading...';\n\t            speed = speed || 'fast';\n\t            // remove previous\n\t            $where.parent().find( '.loading-indicator' ).remove();\n\t            // since position is fixed - we insert as sibling\n\t            self.$indicator = render().insertBefore( $where );\n\t            self.message( msg );\n\t            self.$indicator.fadeIn( speed, callback );\n\t            return self;\n\t        };\n\t\n\t        self.message = function( msg ){\n\t            self.$indicator.find( 'i' ).text( msg );\n\t        };\n\t\n\t        self.hide = function( speed, callback ){\n\t            speed = speed || 'fast';\n\t            if( self.$indicator && self.$indicator.size() ){\n\t                self.$indicator.fadeOut( speed, function(){\n\t                    self.$indicator.remove();\n\t                    if( callback ){ callback(); }\n\t                });\n\t            } else {\n\t                if( callback ){ callback(); }\n\t            }\n\t            return self;\n\t        };\n\t        return self;\n\t    }\n\t\n\t//============================================================================\n\t    return LoadingIndicator;\n\t}));\n\n\n/***/ },\n/* 80 */,\n/* 81 */,\n/* 82 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n\t], __WEBPACK_AMD_DEFINE_RESULT__ = function(){\n\t//=============================================================================\n\t/**\n\t(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\n\tCopyright (c) 2011 Andrei Mackenzie\n\t\n\tPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\n\tdocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\n\trights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\n\tpersons to whom the Software is furnished to do so, subject to the following conditions:\n\t\n\tThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\n\tSoftware.\n\t\n\tTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\n\tWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n\tCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n\tOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\t*/\n\t// Compute the edit distance between the two given strings\n\t//exports.getEditDistance = function(a, b){\n\tfunction levenshteinDistance(a, b){\n\t  if(a.length === 0){ return b.length; }\n\t  if(b.length === 0){ return a.length; }\n\t\n\t  var matrix = [];\n\t\n\t  // increment along the first column of each row\n\t  var i;\n\t  for(i = 0; i <= b.length; i++){\n\t    matrix[i] = [i];\n\t  }\n\t\n\t  // increment each column in the first row\n\t  var j;\n\t  for(j = 0; j <= a.length; j++){\n\t    matrix[0][j] = j;\n\t  }\n\t\n\t  // Fill in the rest of the matrix\n\t  for(i = 1; i <= b.length; i++){\n\t    for(j = 1; j <= a.length; j++){\n\t      if(b.charAt(i-1) === a.charAt(j-1)){\n\t        matrix[i][j] = matrix[i-1][j-1];\n\t      } else {\n\t        matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution\n\t                                Math.min(matrix[i][j-1] + 1, // insertion\n\t                                         matrix[i-1][j] + 1)); // deletion\n\t      }\n\t    }\n\t  }\n\t\n\t  //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n\t  return matrix[b.length][a.length];\n\t}\n\t\n\t//=============================================================================\n\t    return levenshteinDistance;\n\t}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** history.bundled.js\n **/","\nvar GalaxyMasthead = require( '../galaxy.masthead' ).GalaxyMasthead,\n    GalaxyMenu = require( '../galaxy.menu' ).GalaxyMenu,\n    History = require( '../mvc/history/history-model' ).History,\n    HistoryPanelEdit = require( '../mvc/history/history-panel-edit' ).HistoryPanelEdit;\n\n//TODO: this doesn't address multiple apps per page\nwindow.app = function app( options, bootstrapped ){\n    if( !( Galaxy.masthead && Galaxy.menu ) ){\n        // adapter to galaxy.masthead.mako config\n        var mastheadConfig = _.extend( _.clone( Galaxy.config ), {\n            user : {\n                requests    : Galaxy.currUser.get( 'requests' ),\n                email       : Galaxy.currUser.get( 'email' ),\n                valid       : Galaxy.currUser.isAnonymous(),\n                json        : Galaxy.currUser.toJSON()\n            }\n        });\n        Galaxy.masthead = new GalaxyMasthead( mastheadConfig );\n        Galaxy.menu = new GalaxyMenu({\n            masthead    : Galaxy.masthead,\n            config      : mastheadConfig\n        });\n        console.debug( Galaxy.masthead );\n        console.debug( Galaxy.menu );\n    }\n\n    bootstrapped = bootstrapped || {};\n    window.panel = new HistoryPanelEdit({\n        show_deleted    : bootstrapped.show_deleted,\n        show_hidden     : bootstrapped.show_deleted,\n        purgeAllowed    : Galaxy.config.allow_user_dataset_purge,\n        model           : new History( bootstrapped.history, bootstrapped.contents )\n    });\n    $(function(){\n        panel.render().$el.appendTo( ( options || {} ).panelLoc || 'body' );\n    });\n\n    return panel;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/apps/history-app.js\n ** module id = 0\n ** module chunks = 4\n **/","define([\n], function( localeStrings ){\n    localeStrings = {};\n// =============================================================================\n/** Attempt to get a localized string for strToLocalize. If not found, return\n *      the original strToLocalize.\n * @param {String} strToLocalize the string to localize\n * @returns either the localized string if found or strToLocalize if not found\n */\nvar localize = function( strToLocalize ){\n    //console.debug( this + '.localize:', strToLocalize );\n\n    // cache strings that need to be localized but haven't been?\n    if( localize.cacheNonLocalized && !localeStrings.hasOwnProperty( strToLocalize ) ){\n        //console.debug( 'localization NOT found:', strToLocalize );\n        // add nonCached as hash directly to this function\n        if( !localize.nonLocalized ){ localize.nonLocalized = {}; }\n        localize.nonLocalized[ strToLocalize ] = navigator.language;\n    }\n    // return the localized version from the closure if it's there, the strToLocalize if not\n    return localeStrings[ strToLocalize ] || strToLocalize;\n};\nlocalize.cacheNonLocalized = false;\n\n\n// =============================================================================\n    return localize;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/utils/webpack-localization.js\n ** module id = 1\n ** module chunks = 3 4 6\n **/","/**\n * Galaxy utilities comprises small functions, which at this point\n * do not require their own classes/files\n*/\n\n// dependencies\ndefine([], function() {\n\n/** Traverse through json\n*/\nfunction deepeach(dict, callback) {\n    for (var i in dict) {\n        var d = dict[i];\n        if (d && typeof(d) == \"object\") {\n            callback(d);\n            deepeach(d, callback);\n        }\n    }\n}\n\n/**\n * Check if a string is a json string\n * @param{String}   text - Content to be validated\n */\nfunction isJSON(text) {\n    return /^[\\],:{}\\s]*$/.test(text.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').\n        replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').\n        replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''));\n};\n\n/**\n * Sanitize/escape a string\n * @param{String}   content - Content to be sanitized\n */\nfunction sanitize(content) {\n    return $('<div/>').text(content).html();\n};\n\n/**\n * Validate atomic values or list of values\n * usually used for selectable options\n * @param{String}   value - Value or list to be validated\n */\nfunction validate (value) {\n    if (!(value instanceof Array)) {\n        value = [value];\n    }\n    if (value.length === 0) {\n        return false;\n    }\n    for (var i in value) {\n        if (['__null__', '__undefined__', null, undefined].indexOf(value[i]) > -1) {\n            return false;\n        }\n    }\n    return true;\n};\n\n/**\n * Convert list to pretty string\n * @param{String}   lst - List of strings to be converted in human readable list sentence\n */\nfunction textify(lst) {\n    var lst = lst.toString();\n    if (lst) {\n        lst = lst.replace(/,/g, ', ');\n        var pos = lst.lastIndexOf(', ');\n        if (pos != -1) {\n            lst = lst.substr(0, pos) + ' or ' + lst.substr(pos+1);\n        }\n        return lst;\n    }\n    return '';\n};\n\n/**\n * Request handler for GET\n * @param{String}   url     - Url request is made to\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n * @param{Boolean}  cache   - Use cached data if available\n */\nfunction get (options) {\n    top.__utils__get__ = top.__utils__get__ || {};\n    if (options.cache && top.__utils__get__[options.url]) {\n        options.success && options.success(top.__utils__get__[options.url]);\n        console.debug('utils.js::get() - Fetching from cache [' + options.url + '].');\n    } else {\n        request({\n            url     : options.url,\n            data    : options.data,\n            success : function(response) {\n                top.__utils__get__[options.url] = response;\n                options.success && options.success(response);\n            },\n            error : function(response) {\n                options.error && options.error(response);\n            }\n        });\n    }\n};\n\n/**\n * Request handler\n * @param{String}   method  - Request method ['GET', 'POST', 'DELETE', 'PUT']\n * @param{String}   url     - Url request is made to\n * @param{Object}   data    - Data send to url\n * @param{Function} success - Callback on success\n * @param{Function} error   - Callback on error\n */\nfunction request (options) {\n    // prepare ajax\n    var ajaxConfig = {\n        contentType : 'application/json',\n        type        : options.type || 'GET',\n        data        : options.data || {},\n        url         : options.url\n    }\n\n    // encode data into url\n    if (ajaxConfig.type == 'GET' || ajaxConfig.type == 'DELETE') {\n        if (ajaxConfig.url.indexOf('?') == -1) {\n            ajaxConfig.url += '?';\n        } else {\n            ajaxConfig.url += '&';\n        }\n        ajaxConfig.url      = ajaxConfig.url + $.param(ajaxConfig.data, true);\n        ajaxConfig.data     = null;\n    } else {\n        ajaxConfig.dataType = 'json';\n        ajaxConfig.url      = ajaxConfig.url;\n        ajaxConfig.data     = JSON.stringify(ajaxConfig.data);\n    }\n\n    // make request\n    $.ajax(ajaxConfig)\n    .done(function(response) {\n        if (typeof response === 'string') {\n            try {\n                response = response.replace('Infinity,', '\"Infinity\",');\n                response = jQuery.parseJSON(response);\n            } catch (e) {\n                console.debug(e);\n            }\n        }\n        options.success && options.success(response);\n    })\n    .fail(function(response) {\n        var response_text = null;\n        try {\n            response_text = jQuery.parseJSON(response.responseText);\n        } catch (e) {\n            response_text = response.responseText;\n        }\n        options.error && options.error(response_text, response);\n    });\n};\n\n/**\n * Read a property value from CSS\n * @param{String}   classname   - CSS class\n * @param{String}   name        - CSS property\n */\nfunction cssGetAttribute (classname, name) {\n    var el = $('<div class=\"' + classname + '\"></div>');\n    el.appendTo(':eq(0)');\n    var value = el.css(name);\n    el.remove();\n    return value;\n};\n\n/**\n * Load a CSS file\n * @param{String}   url - Url of CSS file\n */\nfunction cssLoadFile (url) {\n    if (!$('link[href^=\"' + url + '\"]').length) {\n        $('<link href=\"' + galaxy_config.root + url + '\" rel=\"stylesheet\">').appendTo('head');\n    }\n};\n\n/**\n * Safely merge to dictionaries\n * @param{Object}   options         - Target dictionary\n * @param{Object}   optionsDefault  - Source dictionary\n */\nfunction merge (options, optionsDefault) {\n    if (options) {\n        return _.defaults(options, optionsDefault);\n    } else {\n        return optionsDefault;\n    }\n};\n\n\n/**\n * Round floaing point 'number' to 'numPlaces' number of decimal places.\n * @param{Object}   number      a floaing point number\n * @param{Object}   numPlaces   number of decimal places\n */\nfunction roundToDecimalPlaces( number, numPlaces ){\n    var placesMultiplier = 1;\n    for( var i=0; i<numPlaces; i++ ){\n        placesMultiplier *= 10;\n    }\n    return Math.round( number * placesMultiplier ) / placesMultiplier;\n}\n\n// calculate on import\nvar kb = 1024,\n    mb = kb * kb,\n    gb = mb * kb,\n    tb = gb * kb;\n/**\n * Format byte size to string with units\n * @param{Integer}   size           - Size in bytes\n * @param{Boolean}   normal_font    - Switches font between normal and bold\n */\nfunction bytesToString (size, normal_font, numberPlaces) {\n    numberPlaces = numberPlaces !== undefined? numberPlaces: 1;\n    // identify unit\n    var unit = \"\";\n    if (size >= tb){ size = size / tb; unit = 'TB'; } else\n    if (size >= gb){ size = size / gb; unit = 'GB'; } else\n    if (size >= mb){ size = size / mb; unit = 'MB'; } else\n    if (size >= kb){ size = size / kb; unit = 'KB'; } else\n    if (size >  0){ unit = 'b'; }\n    else { return normal_font? '0 b': '<strong>-</strong>'; }\n    // return formatted string\n    var rounded = unit == 'b'? size: roundToDecimalPlaces( size, numberPlaces );\n    if (normal_font) {\n       return  rounded + ' ' + unit;\n    } else {\n        return '<strong>' + rounded + '</strong> ' + unit;\n    }\n};\n\n/**\n * Create a unique id\n */\nfunction uid(){\n    top.__utils__uid__ = top.__utils__uid__ || 0;\n    return 'uid-' + top.__utils__uid__++;\n};\n\n/**\n * Create a time stamp\n */\nfunction time() {\n    var d = new Date();\n    var hours = (d.getHours() < 10 ? \"0\" : \"\") + d.getHours();\n    var minutes = (d.getMinutes() < 10 ? \"0\" : \"\") + d.getMinutes()\n    return datetime = d.getDate() + \"/\"\n                + (d.getMonth() + 1)  + \"/\"\n                + d.getFullYear() + \", \"\n                + hours + \":\"\n                + minutes;\n};\n\nreturn {\n    cssLoadFile: cssLoadFile,\n    cssGetAttribute: cssGetAttribute,\n    get: get,\n    merge: merge,\n    bytesToString: bytesToString,\n    uid: uid,\n    time: time,\n    request: request,\n    sanitize: sanitize,\n    textify: textify,\n    validate: validate,\n    deepeach: deepeach,\n    isJSON: isJSON\n};\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/utils/utils.js\n ** module id = 2\n ** module chunks = 3 4\n **/","define([\n    'libs/underscore',\n    'libs/backbone/backbone',\n    'utils/add-logging',\n    'utils/localization'\n], function( _, Backbone, addLogging, _l ){\n//==============================================================================\n/** @class Mixin to add logging capabilities to an object.\n *      Designed to allow switching an objects log output off/on at one central\n *      statement. Can be used with plain browser console (or something more\n *      complex like an AJAX logger).\n *  <br />NOTE: currently only uses the console.debug log function\n *  (as opposed to debug, error, warn, etc.)\n *  @name LoggableMixin\n *\n *  @example\n *  // Add to your models/views at the definition using chaining:\n *      var MyModel = Backbone.Model.extend( LoggableMixin ).extend({ // ... });\n *\n *  // or - more explicitly AFTER the definition:\n *      var MyModel = Backbone.Model.extend({\n *          logger  : console\n *          // ...\n *          this.log( '$#%& it! - broken already...' );\n *      })\n *      _.extend( MyModel.prototype, LoggableMixin )\n *\n */\nvar LoggableMixin =  /** @lends LoggableMixin# */{\n\n    /** The logging object whose log function will be used to output\n     *      messages. Null will supress all logging. Commonly set to console.\n     */\n    // replace null with console (if available) to see all logs\n    logger       : null,\n    _logNamespace : '?',\n\n    /** Output log messages/arguments to logger.\n     *  @param {Arguments} ... (this function is variadic)\n     *  @returns undefined if not this.logger\n     */\n    log : function(){\n        if( this.logger ){\n            var log = this.logger.log;\n            if( typeof this.logger.log === 'object' ){\n//TODO:! there has to be a way to get the lineno/file into this\n                log = Function.prototype.bind.call( this.logger.log, this.logger );\n            }\n            return log.apply( this.logger, arguments );\n        }\n        return undefined;\n    }\n};\naddLogging( LoggableMixin );\n\n\n//==============================================================================\n/** Backbone model that syncs to the browser's sessionStorage API.\n *      This all largely happens behind the scenes and no special calls are required.\n */\nvar SessionStorageModel = Backbone.Model.extend({\n    initialize : function( initialAttrs ){\n        // check for sessionStorage and error if no id is provided\n        this._checkEnabledSessionStorage();\n        if( !initialAttrs.id ){\n            throw new Error( 'SessionStorageModel requires an id in the initial attributes' );\n        }\n        this.id = initialAttrs.id;\n\n        // load existing from storage (if any), clear any attrs set by bbone before init is called,\n        //  layer initial over existing and defaults, and save\n        var existing = ( !this.isNew() )?( this._read( this ) ):( {} );\n        this.clear({ silent: true });\n        this.save( _.extend( {}, this.defaults, existing, initialAttrs ), { silent: true });\n\n        // save on any change to it immediately\n        this.on( 'change', function(){\n            this.save();\n        });\n    },\n\n    _checkEnabledSessionStorage : function(){\n        try {\n            return sessionStorage.length;\n        } catch( err ){\n            alert( 'Please enable cookies in your browser for this Galaxy site' );\n            return false;\n        }\n    },\n\n    /** override of bbone sync to save to sessionStorage rather than REST\n     *      bbone options (success, errror, etc.) should still apply\n     */\n    sync : function( method, model, options ){\n        if( !options.silent ){\n            model.trigger( 'request', model, {}, options );\n        }\n        var returned = {};\n        switch( method ){\n            case 'create'   : returned = this._create( model ); break;\n            case 'read'     : returned = this._read( model );   break;\n            case 'update'   : returned = this._update( model ); break;\n            case 'delete'   : returned = this._delete( model ); break;\n        }\n        if( returned !== undefined || returned !== null ){\n            if( options.success ){ options.success(); }\n        } else {\n            if( options.error ){ options.error(); }\n        }\n        return returned;\n    },\n\n    /** set storage to the stringified item */\n    _create : function( model ){\n        try {\n            var json = model.toJSON(),\n                set = sessionStorage.setItem( model.id, JSON.stringify( json ) );\n            return ( set === null )?( set ):( json );\n        // DOMException is thrown in Safari if in private browsing mode and sessionStorage is attempted:\n        // http://stackoverflow.com/questions/14555347\n        // TODO: this could probably use a more general soln - like detecting priv. mode + safari => non-ajaxing Model\n        } catch( err ){\n            if( !( ( err instanceof DOMException ) && ( navigator.userAgent.indexOf(\"Safari\") > -1 ) ) ){\n                throw err;\n            }\n        }\n        return null;\n    },\n\n    /** read and parse json from storage */\n    _read : function( model ){\n        return JSON.parse( sessionStorage.getItem( model.id ) );\n    },\n\n    /** set storage to the item (alias to create) */\n    _update : function( model ){\n        return model._create( model );\n    },\n\n    /** remove the item from storage */\n    _delete : function( model ){\n        return sessionStorage.removeItem( model.id );\n    },\n\n    /** T/F whether sessionStorage contains the model's id (data is present) */\n    isNew : function(){\n        return !sessionStorage.hasOwnProperty( this.id );\n    },\n\n    _log : function(){\n        return JSON.stringify( this.toJSON(), null, '  ' );\n    },\n    toString : function(){\n        return 'SessionStorageModel(' + this.id + ')';\n    }\n\n});\n(function(){\n    SessionStorageModel.prototype = _.omit( SessionStorageModel.prototype, 'url', 'urlRoot' );\n}());\n\n\n//==============================================================================\n/** Function that allows mixing of hashs into bbone MVC while showing the mixins first\n *      (before the more local class overrides/hash).\n *      Basically, a simple reversal of param order on _.defaults() - to show mixins in top of definition.\n *  @example:\n *      var NewModel = Something.extend( mixin( MyMixinA, MyMixinB, { ... myVars : ... }) );\n *\n *  NOTE: this does not combine any hashes (like events, etc.) and you're expected to handle that\n */\nfunction mixin( mixinHash1, /* mixinHash2, etc: ... variadic */ propsHash ){\n    var args = Array.prototype.slice.call( arguments, 0 ),\n        lastArg = args.pop();\n    args.unshift( lastArg );\n    return _.defaults.apply( _, args );\n}\n\n\n//==============================================================================\n/** A mixin for models that allow T/F/Matching to their attributes - useful when\n *      searching or filtering collections of models.\n * @example:\n *      see hda-model for searchAttribute and searchAliases definition examples.\n *      see history-contents.matches for how collections are filtered\n *      and see readonly-history-panel.searchHdas for how user input is connected to the filtering\n */\nvar SearchableModelMixin = {\n\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes : [\n        // override\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases : {\n        // override\n    },\n\n    /** search the attribute with key attrKey for the string searchFor; T/F if found */\n    searchAttribute : function( attrKey, searchFor ){\n        var attrVal = this.get( attrKey );\n        //this.debug( 'searchAttribute', attrKey, attrVal, searchFor );\n        // bail if empty searchFor or unsearchable values\n        if( !searchFor\n        ||  ( attrVal === undefined || attrVal === null ) ){\n            return false;\n        }\n        // pass to sep. fn for deep search of array attributes\n        if( _.isArray( attrVal ) ){ return this._searchArrayAttribute( attrVal, searchFor ); }\n        return ( attrVal.toString().toLowerCase().indexOf( searchFor.toLowerCase() ) !== -1 );\n    },\n\n    /** deep(er) search for array attributes; T/F if found */\n    _searchArrayAttribute : function( array, searchFor ){\n        //this.debug( '_searchArrayAttribute', array, searchFor );\n        searchFor = searchFor.toLowerCase();\n        //precondition: searchFor has already been validated as non-empty string\n        //precondition: assumes only 1 level array\n        //TODO: could possibly break up searchFor more (CSV...)\n        return _.any( array, function( elem ){\n            return ( elem.toString().toLowerCase().indexOf( searchFor.toLowerCase() ) !== -1 );\n        });\n    },\n\n    /** search all searchAttributes for the string searchFor,\n     *      returning a list of keys of attributes that contain searchFor\n     */\n    search : function( searchFor ){\n        var model = this;\n        return _.filter( this.searchAttributes, function( key ){\n            return model.searchAttribute( key, searchFor );\n        });\n    },\n\n    /** alias of search, but returns a boolean; accepts attribute specifiers where\n     *      the attributes searched can be narrowed to a single attribute using\n     *      the form: matches( 'genome_build=hg19' )\n     *      (the attribute keys allowed can also be aliases to the true attribute key;\n     *          see searchAliases above)\n     *  @param {String} term   plain text or ATTR_SPECIFIER sep. key=val pair\n     *  @returns {Boolean} was term found in (any) attribute(s)\n     */\n    matches : function( term ){\n        var ATTR_SPECIFIER = '=',\n            split = term.split( ATTR_SPECIFIER );\n        // attribute is specified - search only that\n        if( split.length >= 2 ){\n            var attrKey = split[0];\n            attrKey = this.searchAliases[ attrKey ] || attrKey;\n            return this.searchAttribute( attrKey, split[1] );\n        }\n        // no attribute is specified - search all attributes in searchAttributes\n        return !!this.search( term ).length;\n    },\n\n    /** an implicit AND search for all terms; IOW, a model must match all terms given\n     *      where terms is a whitespace separated value string.\n     *      e.g. given terms of: 'blah bler database=hg19'\n     *          an HDA would have to have attributes containing blah AND bler AND a genome_build == hg19\n     *      To include whitespace in terms: wrap the term in double quotations (name=\"blah bler\").\n     */\n    matchesAll : function( terms ){\n        var model = this;\n        // break the terms up by whitespace and filter out the empty strings\n        terms = terms.match( /(\".*\"|\\w*=\".*\"|\\S*)/g ).filter( function( s ){ return !!s; });\n        return _.all( terms, function( term ){\n            term = term.replace( /\"/g, '' );\n            return model.matches( term );\n        });\n    }\n};\n\n\n//==============================================================================\n/** A view that renders hidden and shows when some activator is clicked.\n *      options:\n *          showFn: the effect used to show/hide the View (defaults to jq.toggle)\n *          $elementShown: some jqObject (defaults to this.$el) to be shown/hidden\n *          onShowFirstTime: fn called the first time the view is shown\n *          onshow: fn called every time the view is shown\n *          onhide: fn called every time the view is hidden\n *      events:\n *          hiddenUntilActivated:shown (the view is passed as an arg)\n *          hiddenUntilActivated:hidden (the view is passed as an arg)\n *      instance vars:\n *          view.hidden {boolean} is the view in the hidden state\n */\nvar HiddenUntilActivatedViewMixin = /** @lends hiddenUntilActivatedMixin# */{\n//TODO: since this is a mixin, consider moving toggle, hidden into HUAVOptions\n\n    /** call this in your initialize to set up the mixin\n     *  @param {jQuery} $activator the 'button' that's clicked to show/hide the view\n     *  @param {Object} hash with mixin options\n     */\n    hiddenUntilActivated : function( $activator, options ){\n        // call this in your view's initialize fn\n        options = options || {};\n//TODO: flesh out options - show them all here\n        this.HUAVOptions = {\n            $elementShown   : this.$el,\n            showFn          : jQuery.prototype.toggle,\n            showSpeed       : 'fast'\n        };\n        _.extend( this.HUAVOptions, options || {});\n        /** has this been shown already (and onshowFirstTime called)? */\n        this.HUAVOptions.hasBeenShown = this.HUAVOptions.$elementShown.is( ':visible' );\n        this.hidden = this.isHidden();\n\n        if( $activator ){\n            var mixin = this;\n            $activator.on( 'click', function( ev ){\n                mixin.toggle( mixin.HUAVOptions.showSpeed );\n            });\n        }\n    },\n\n//TODO:?? remove? use .hidden?\n    /** returns T/F if the view is hidden */\n    isHidden : function(){\n        return ( this.HUAVOptions.$elementShown.is( ':hidden' ) );\n    },\n\n    /** toggle the hidden state, show/hide $elementShown, call onshow/hide, trigger events */\n    toggle : function(){\n//TODO: more specific name - toggle is too general\n        // can be called manually as well with normal toggle arguments\n        //TODO: better as a callback (when the show/hide is actually done)\n        // show\n        if( this.hidden ){\n            // fire the optional fns on the first/each showing - good for render()\n            if( !this.HUAVOptions.hasBeenShown ){\n                if( _.isFunction( this.HUAVOptions.onshowFirstTime ) ){\n                    this.HUAVOptions.hasBeenShown = true;\n                    this.HUAVOptions.onshowFirstTime.call( this );\n                }\n            }\n            if( _.isFunction( this.HUAVOptions.onshow ) ){\n                this.HUAVOptions.onshow.call( this );\n                this.trigger( 'hiddenUntilActivated:shown', this );\n            }\n            this.hidden = false;\n\n        // hide\n        } else {\n            if( _.isFunction( this.HUAVOptions.onhide ) ){\n                this.HUAVOptions.onhide.call( this );\n                this.trigger( 'hiddenUntilActivated:hidden', this );\n            }\n            this.hidden = true;\n        }\n        return this.HUAVOptions.showFn.apply( this.HUAVOptions.$elementShown, arguments );\n    }\n};\n\n\n//==============================================================================\n/** Mixin for views that can be dragged and dropped\n *      Allows for the drag behavior to be turned on/off, setting/removing jQuery event\n *          handlers each time.\n *      dataTransfer data is set to the JSON string of the view's model.toJSON\n *      Override '$dragHandle' to define the draggable DOM sub-element.\n */\nvar DraggableViewMixin = {\n\n    /** set up instance vars to track whether this view is currently draggable */\n    initialize : function( attributes ){\n        /** is the body of this hda view expanded/not? */\n        this.draggable  = attributes.draggable || false;\n    },\n\n    /** what part of the view's DOM triggers the dragging */\n    $dragHandle : function(){\n//TODO: make abstract/general - move this to listItem\n        // override to the element you want to be your view's handle\n        return this.$( '.title-bar' );\n    },\n\n    /** toggle whether this view is draggable */\n    toggleDraggable : function(){\n        if( this.draggable ){\n            this.draggableOff();\n        } else {\n            this.draggableOn();\n        }\n    },\n\n    /** allow the view to be dragged, set up event handlers */\n    draggableOn : function(){\n        this.draggable = true;\n        this.dragStartHandler = _.bind( this._dragStartHandler, this );\n        this.dragEndHandler   = _.bind( this._dragEndHandler,   this );\n\n        var handle = this.$dragHandle().attr( 'draggable', true ).get(0);\n        handle.addEventListener( 'dragstart', this.dragStartHandler, false );\n        handle.addEventListener( 'dragend',   this.dragEndHandler,   false );\n    },\n\n    /** turn of view dragging and remove event listeners */\n    draggableOff : function(){\n        this.draggable = false;\n        var handle = this.$dragHandle().attr( 'draggable', false ).get(0);\n        handle.removeEventListener( 'dragstart', this.dragStartHandler, false );\n        handle.removeEventListener( 'dragend',   this.dragEndHandler,   false );\n    },\n\n    /** sets the dataTransfer data to the model's toJSON\n     *  @fires draggable:dragstart (bbone event) which is passed the event and this view\n     */\n    _dragStartHandler : function( event ){\n        event.dataTransfer.effectAllowed = 'move';\n        //ASSUMES: this.model\n        //TODO: all except IE: should be 'application/json', IE: must be 'text'\n        event.dataTransfer.setData( 'text', JSON.stringify( this.model.toJSON() ) );\n        this.trigger( 'draggable:dragstart', event, this );\n        return false;\n    },\n\n    /** handle the dragend\n     *  @fires draggable:dragend (bbone event) which is passed the event and this view\n     */\n    _dragEndHandler : function( event ){\n        this.trigger( 'draggable:dragend', event, this );\n        return false;\n    }\n};\n\n\n//==============================================================================\n/** Mixin that allows a view to be selected (gen. from a list).\n *      Selection controls ($selector) may be hidden/shown/toggled.\n *          The bbone event 'selectable' is fired when the controls are shown/hidden (passed T/F).\n *      Default rendering is a font-awesome checkbox.\n *      Default selector is '.selector' within the view's $el.\n *      The bbone events 'selected' and 'de-selected' are fired when the $selector is clicked.\n *          Both events are passed the view and the (jQuery) event.\n */\nvar SelectableViewMixin = {\n\n    /** Set up instance state vars for whether the selector is shown and whether the view has been selected */\n    initialize : function( attributes ){\n        /** is the view currently in selection mode? */\n        this.selectable = attributes.selectable || false;\n        /** is the view currently selected? */\n        this.selected   = attributes.selected || false;\n    },\n\n    /** $el sub-element where the selector is rendered and what can be clicked to select. */\n    $selector : function(){\n        return this.$( '.selector' );\n    },\n\n    /** How the selector is rendered - defaults to font-awesome checkbox */\n    _renderSelected : function(){\n        // override\n        this.$selector().find( 'span' )\n            .toggleClass( 'fa-check-square-o', this.selected ).toggleClass( 'fa-square-o', !this.selected );\n    },\n\n    /** Toggle whether the selector is shown */\n    toggleSelector : function(){\n//TODO: use this.selectable\n        if( !this.$selector().is( ':visible' ) ){\n            this.showSelector();\n        } else {\n            this.hideSelector();\n        }\n    },\n\n    /** Display the selector control.\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed true (IOW, the selector is shown) and the view\n     */\n    showSelector : function( speed ){\n        speed = speed !== undefined? speed : this.fxSpeed;\n        // make sure selected state is represented properly\n        this.selectable = true;\n        this.trigger( 'selectable', true, this );\n        this._renderSelected();\n        this.$selector().show( speed );\n    },\n\n    /** remove the selector control\n     *  @param {Number} a jQuery fx speed\n     *  @fires: selectable which is passed false (IOW, the selector is not shown) and the view\n     */\n    hideSelector : function( speed ){\n        speed = speed !== undefined? speed : this.fxSpeed;\n        // reverse the process from showSelect\n        this.selectable = false;\n        this.trigger( 'selectable', false, this );\n        this.$selector().hide( speed );\n    },\n\n    /** Toggle whether the view is selected */\n    toggleSelect : function( event ){\n        if( this.selected ){\n            this.deselect( event );\n        } else {\n            this.select( event );\n        }\n    },\n\n    /** Select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    select : function( event ){\n        // switch icon, set selected, and trigger event\n        if( !this.selected ){\n            this.trigger( 'selected', this, event );\n            this.selected = true;\n            this._renderSelected();\n        }\n        return false;\n    },\n\n    /** De-select this view and re-render the selector control to show it\n     *  @param {Event} a jQuery event that caused the selection\n     *  @fires: de-selected which is passed the view and the DOM event that triggered it (optionally)\n     */\n    deselect : function( event ){\n        // switch icon, set selected, and trigger event\n        if( this.selected ){\n            this.trigger( 'de-selected', this, event );\n            this.selected = false;\n            this._renderSelected();\n        }\n        return false;\n    }\n};\n\n\n//==============================================================================\n/** Return an underscore template fn from an array of strings.\n *  @param {String[]} template      the template strings to compile into the underscore template fn\n *  @param {String} jsonNamespace   an optional namespace for the json data passed in (defaults to 'model')\n *  @returns {Function} the (wrapped) underscore template fn\n *      The function accepts:\n *\n *  The template strings can access:\n *      the json/model hash using model (\"<%- model.myAttr %>) using the jsonNamespace above\n *      _l: the localizer function\n *      view (if passed): ostensibly, the view using the template (handy for view instance vars)\n *      Because they're namespaced, undefined attributes will not throw an error.\n *\n *  @example:\n *      templateBler : BASE_MVC.wrapTemplate([\n *          '<div class=\"myclass <%- mynamespace.modelClass %>\">',\n *              '<span><% print( _l( mynamespace.message ) ); %>:<%= view.status %></span>'\n *          '</div>'\n *      ], 'mynamespace' )\n *\n *  Meant to be called in a View's definition in order to compile only once.\n *\n */\nfunction wrapTemplate( template, jsonNamespace ){\n    jsonNamespace = jsonNamespace || 'model';\n    var templateFn = _.template( template.join( '' ) );\n    return function( json, view ){\n        var templateVars = { view : view || {}, _l : _l };\n        templateVars[ jsonNamespace ] = json || {};\n        return templateFn( templateVars );\n    };\n}\n\n\n//==============================================================================\n    return {\n        LoggableMixin                   : LoggableMixin,\n        SessionStorageModel             : SessionStorageModel,\n        mixin                           : mixin,\n        SearchableModelMixin            : SearchableModelMixin,\n        HiddenUntilActivatedViewMixin   : HiddenUntilActivatedViewMixin,\n        DraggableViewMixin              : DraggableViewMixin,\n        SelectableViewMixin             : SelectableViewMixin,\n        wrapTemplate                    : wrapTemplate\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/base-mvc.js\n ** module id = 3\n ** module chunks = 3 4 6\n **/","define([\n], function(){\n//==============================================================================\n/** Map of possible HDA/collection/job states to their string equivalents.\n *      A port of galaxy.model.Dataset.states.\n */\nvar STATES = {\n    // NOT ready states\n    /** is uploading and not ready */\n    UPLOAD              : 'upload',\n    /** the job that will produce the dataset queued in the runner */\n    QUEUED              : 'queued',\n    /** the job that will produce the dataset is running */\n    RUNNING             : 'running',\n    /** metadata for the dataset is being discovered/set */\n    SETTING_METADATA    : 'setting_metadata',\n\n    // ready states\n    /** was created without a tool */\n    NEW                 : 'new',\n    /** has no data */\n    EMPTY               : 'empty',\n    /** has successfully completed running */\n    OK                  : 'ok',\n\n    /** the job that will produce the dataset paused */\n    PAUSED              : 'paused',\n    /** metadata discovery/setting failed or errored (but otherwise ok) */\n    FAILED_METADATA     : 'failed_metadata',\n//TODO: not in trans.app.model.Dataset.states - is in database\n    /** not accessible to the current user (i.e. due to permissions) */\n    NOT_VIEWABLE        : 'noPermission',\n    /** deleted while uploading */\n    DISCARDED           : 'discarded',\n    /** the tool producing this dataset failed */\n    ERROR               : 'error'\n};\n\nSTATES.READY_STATES = [\n    STATES.OK,\n    STATES.EMPTY,\n    STATES.PAUSED,\n    STATES.FAILED_METADATA,\n    STATES.NOT_VIEWABLE,\n    STATES.DISCARDED,\n    STATES.ERROR\n];\n\nSTATES.NOT_READY_STATES = [\n    STATES.UPLOAD,\n    STATES.QUEUED,\n    STATES.RUNNING,\n    STATES.SETTING_METADATA,\n    STATES.NEW\n];\n\n\n//==============================================================================\n    return STATES;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/dataset/states.js\n ** module id = 6\n ** module chunks = 3 4\n **/","(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        root.faIconButton = factory();\n    }\n\n}(this, function () {\n//============================================================================\n    /** Returns a jQuery object containing a clickable font-awesome button.\n     *      options:\n     *          tooltipConfig   : option map for bootstrap tool tip\n     *          classes         : array of class names (will always be classed as icon-btn)\n     *          disabled        : T/F - add the 'disabled' class?\n     *          title           : tooltip/title string\n     *          target          : optional href target\n     *          href            : optional href\n     *          faIcon          : which font awesome icon to use\n     *          onclick         : function to call when the button is clicked\n     */\n    var faIconButton = function( options ){\n        options = options || {};\n        options.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n\n        options.classes = [ 'icon-btn' ].concat( options.classes || [] );\n        if( options.disabled ){\n            options.classes.push( 'disabled' );\n        }\n\n        var html = [\n            '<a class=\"', options.classes.join( ' ' ), '\"',\n                    (( options.title )?( ' title=\"' + options.title + '\"' ):( '' )),\n                    (( !options.disabled && options.target )?  ( ' target=\"' + options.target + '\"' ):( '' )),\n                    ' href=\"', (( !options.disabled && options.href )?( options.href ):( 'javascript:void(0);' )), '\">',\n                // could go with something less specific here - like 'html'\n                '<span class=\"fa ', options.faIcon, '\"></span>',\n            '</a>'\n        ].join( '' );\n        var $button = $( html ).tooltip( options.tooltipConfig );\n        if( _.isFunction( options.onclick ) ){\n            $button.click( options.onclick );\n        }\n        return $button;\n    };\n\n//============================================================================\n    return faIconButton;\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/ui/fa-icon-button.js\n ** module id = 7\n ** module chunks = 3 4\n **/","define([\n    \"mvc/list/list-panel\",\n    \"mvc/collection/collection-model\",\n    \"mvc/collection/collection-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_PANEL, DC_MODEL, DC_LI, BASE_MVC, _l ){\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class non-editable, read-only View/Controller for a dataset collection.\n */\nvar _super = LIST_PANEL.ModelListPanel;\nvar CollectionPanel = _super.extend(\n/** @lends CollectionPanel.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className           : _super.prototype.className + ' dataset-collection-panel',\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: DC_LI.NestedDCDCEListItemView,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey  : 'elements',\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n        this.linkTarget = attributes.linkTarget || '_blank';\n\n        this.hasUser = attributes.hasUser;\n        /** A stack of panels that currently cover or hide this panel */\n        this.panelStack = [];\n        /** The text of the link to go back to the panel containing this one */\n        this.parentName = attributes.parentName;\n        /** foldout or drilldown */\n        this.foldoutStyle = attributes.foldoutStyle || 'foldout';\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, use model.getVisibleContents */\n    _filterCollection : function(){\n//TODO: should *not* be model.getVisibleContents - visibility is not model related\n        return this.model.getVisibleContents();\n    },\n\n    /** override to return proper view class based on element_type */\n    _getItemViewClass : function( model ){\n        //this.debug( this + '._getItemViewClass:', model );\n//TODO: subclasses use DCEViewClass - but are currently unused - decide\n        switch( model.get( 'element_type' ) ){\n            case 'hda':\n                return this.DatasetDCEViewClass;\n            case 'dataset_collection':\n                return this.NestedDCDCEViewClass;\n        }\n        throw new TypeError( 'Unknown element type:', model.get( 'element_type' ) );\n    },\n\n    /** override to add link target and anon */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        return _.extend( options, {\n            linkTarget      : this.linkTarget,\n            hasUser         : this.hasUser,\n//TODO: could move to only nested: list:paired\n            foldoutStyle    : this.foldoutStyle\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection sub-views\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call( panel, view );\n\n        // use pub-sub to: handle drilldown expansion and collapse\n        view.on( 'expanded:drilldown', function( v, drilldown ){\n            this._expandDrilldownPanel( drilldown );\n        }, this );\n        view.on( 'collapsed:drilldown', function( v, drilldown ){\n            this._collapseDrilldownPanel( drilldown );\n        }, this );\n        return this;\n    },\n\n    /** Handle drill down by hiding this panels list and controls and showing the sub-panel */\n    _expandDrilldownPanel : function( drilldown ){\n        this.panelStack.push( drilldown );\n        // hide this panel's controls and list, set the name for back navigation, and attach to the $el\n        this.$( '> .controls' ).add( this.$list() ).hide();\n        drilldown.parentName = this.model.get( 'name' );\n        this.$el.append( drilldown.render().$el );\n    },\n\n    /** Handle drilldown close by freeing the panel and re-rendering this panel */\n    _collapseDrilldownPanel : function( drilldown ){\n        this.panelStack.pop();\n        this.render();\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : {\n        'click .navigation .back'       : 'close'\n    },\n\n    /** close/remove this collection panel */\n    close : function( event ){\n        this.$el.remove();\n        this.trigger( 'close' );\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'CollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//------------------------------------------------------------------------------ TEMPLATES\nCollectionPanel.prototype.templates = (function(){\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"navigation\">',\n                '<a class=\"back\" href=\"javascript:void(0)\">',\n                    '<span class=\"fa fa-icon fa-angle-left\"></span>',\n                    _l( 'Back to ' ), '<%- view.parentName %>',\n                '</a>',\n            '</div>',\n\n            '<div class=\"title\">',\n                '<div class=\"name\"><%- collection.name || collection.element_identifier %></div>',\n                '<div class=\"subtitle\">',\n//TODO: remove logic from template\n                    '<% if( collection.collection_type === \"list\" ){ %>',\n                        _l( 'a list of datasets' ),\n                    '<% } else if( collection.collection_type === \"paired\" ){ %>',\n                        _l( 'a pair of datasets' ),\n                    '<% } else if( collection.collection_type === \"list:paired\" ){ %>',\n                        _l( 'a list of paired datasets' ),\n                    '<% } %>',\n                '</div>',\n            '</div>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( _.clone( _super.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionPanel = CollectionPanel.extend(\n/** @lends ListCollectionPanel.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_LI.DatasetDCEListItemView,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionPanel = ListCollectionPanel.extend(\n/** @lends PairCollectionPanel.prototype */{\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'PairCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionPanel = CollectionPanel.extend(\n/** @lends ListOfPairsCollectionPanel.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass : DC_LI.NestedDCDCEListItemView.extend({\n        foldoutPanelClass : PairCollectionPanel\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListOfPairsCollectionPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        CollectionPanel             : CollectionPanel,\n        ListCollectionPanel         : ListCollectionPanel,\n        PairCollectionPanel         : PairCollectionPanel,\n        ListOfPairsCollectionPanel  : ListOfPairsCollectionPanel\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/collection-panel.js\n ** module id = 10\n ** module chunks = 3 4\n **/","define([], function() {\n\nvar View = Backbone.View.extend({\n\n    // base element\n    elMain: 'body',\n    \n    // defaults options\n    optionsDefault: {\n        title            : 'ui-modal',\n        body             : '',\n        backdrop         : true,\n        height           : null,\n        width            : null,\n        closing_events   : false,\n        closing_callback : null,\n        title_separator  : true\n    },\n\n    // button list\n    buttonList: {},\n\n    // initialize\n    initialize : function(options) {\n        if (options){\n            this._create(options);\n        }\n    },\n    \n    // adds and displays a new frame/window\n    show: function(options) {\n        // create\n        this.initialize(options);\n        \n        // fix height\n        if (this.options.height){\n            this.$body.css('height', this.options.height);\n            this.$body.css('overflow', 'hidden');\n        } else {\n            this.$body.css('max-height', $(window).height() / 2);\n        }\n\n        // fix width\n        if (this.options.width) {\n            this.$dialog.css('width', this.options.width);\n        }\n\n        // show\n        if (this.visible) {\n            this.$el.show();\n        } else {\n            this.$el.fadeIn('fast');\n        }\n\n        // set visible flag\n        this.visible = true;\n    },\n\n    // hide\n    hide: function() {\n        this.visible = false;\n        this.$el.fadeOut('fast');\n        if (this.options.closing_callback){\n            this.options.closing_callback();\n        }\n    },\n\n    // enable buttons\n    enableButton: function(name) {\n        var button_id = this.buttonList[name];\n        this.$buttons.find('#' + button_id).prop('disabled', false);\n    },\n\n    // disable buttons\n    disableButton: function(name) {\n        var button_id = this.buttonList[name];\n        this.$buttons.find('#' + button_id).prop('disabled', true);\n    },\n    \n    // show buttons\n    showButton: function(name) {\n        var button_id = this.buttonList[name];\n        this.$buttons.find('#' + button_id).show();\n    },\n\n    // hide buttons\n    hideButton: function(name) {\n        var button_id = this.buttonList[name];\n        this.$buttons.find('#' + button_id).hide();\n    },\n    \n    // get button\n    getButton: function(name) {\n        var button_id = this.buttonList[name];\n        return this.$buttons.find('#' + button_id);\n    },\n    \n    // returns scroll top for body element\n    scrollTop: function() {\n        return this.$body.scrollTop();\n    },\n\n    // create\n    _create: function(options) {\n        // link this\n        var self = this;\n        \n        // configure options\n        this.options = _.defaults(options, this.optionsDefault);\n        \n        // check for progress bar request\n        if (this.options.body == 'progress'){\n            this.options.body = $('<div class=\"progress progress-striped active\"><div class=\"progress-bar progress-bar-info\" style=\"width:100%\"></div></div>');\n        }\n            \n        // remove former element\n        if (this.$el) {\n            // remove element\n            this.$el.remove();\n            \n            // remove escape event\n            $(document).off('keyup.ui-modal');\n        }\n        \n        // create new element\n        this.setElement(this._template(this.options.title));\n        \n        // link elements\n        this.$dialog = (this.$el).find('.modal-dialog');\n        this.$body = (this.$el).find('.modal-body');\n        this.$footer  = (this.$el).find('.modal-footer');\n        this.$buttons = (this.$el).find('.buttons');\n        this.$backdrop = (this.$el).find('.modal-backdrop');\n        \n        // append body\n        this.$body.html(this.options.body);\n        \n        // configure background\n        if (!this.options.backdrop){\n            this.$backdrop.removeClass('in');\n        }\n                        \n        // append buttons\n        if (this.options.buttons) {\n            // reset button list\n            this.buttonList = {};\n            var counter = 0;\n            $.each(this.options.buttons, function(name, value) {\n                var button_id = 'button-' + counter++;\n                self.$buttons.append($('<button id=\"' + button_id + '\"></button>').text(name).click(value)).append(\" \");\n                self.buttonList[name] = button_id;\n            });\n        } else {\n            // hide footer\n            this.$footer.hide();\n        }\n        \n        // append to main element\n        $(this.elMain).append($(this.el));\n\n        // bind additional closing events\n        if (this.options.closing_events) {\n            // bind the ESC key to hide() function\n            $(document).on('keyup.ui-modal', function(e) {\n                if (e.keyCode == 27) {\n                    self.hide();\n                }\n            });\n            \n            // hide modal if background is clicked\n            this.$el.find('.modal-backdrop').on('click', function() { self.hide(); });\n        }\n\n        // removes the default separator line\n        if (!this.options.title_separator) {\n            this.$('.modal-header').css({ 'border': 'none', 'padding-bottom': '0px' });\n        }\n    },\n    \n    // fill regular modal template\n    _template: function(title) {\n        return  '<div class=\"ui-modal modal\">' +\n                    '<div class=\"modal-backdrop fade in\" style=\"z-index: -1;\"></div>' +\n                    '<div class=\"modal-dialog\">' +\n                        '<div class=\"modal-content\">' +\n                            '<div class=\"modal-header\">' +\n                                '<button type=\"button\" class=\"close\" style=\"display: none;\">&times;</button>' +\n                                '<h4 class=\"title\">' + title + '</h4>' +\n                            '</div>' +\n                            '<div class=\"modal-body\" style=\"position: static;\"></div>' +\n                            '<div class=\"modal-footer\">' +\n                                '<div class=\"buttons\" style=\"float: right;\"></div>' +\n                            '</div>' +\n                        '</div' +\n                    '</div>' +\n                '</div>';\n    }\n});\n\nreturn {\n    View : View\n}\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/ui/ui-modal.js\n ** module id = 11\n ** module chunks = 3 4\n **/","define([\n    \"mvc/list/list-item\",\n    \"mvc/dataset/dataset-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_ITEM, DATASET_LI, BASE_MVC, _l ){\n/* global Backbone, LoggableMixin */\n//==============================================================================\nvar FoldoutListItemView = LIST_ITEM.FoldoutListItemView,\n    ListItemView = LIST_ITEM.ListItemView;\n/** @class Read only view for DatasetCollection.\n */\nvar DCListItemView = FoldoutListItemView.extend(\n/** @lends DCListItemView.prototype */{\n//TODO: may not be needed\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : FoldoutListItemView.prototype.className + \" dataset-collection\",\n    id          : function(){\n        return [ 'dataset_collection', this.model.get( 'id' ) ].join( '-' );\n    },\n\n    /** override to add linkTarget */\n    initialize : function( attributes ){\n        this.linkTarget = attributes.linkTarget || '_blank';\n        this.hasUser = attributes.hasUser;\n        FoldoutListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        FoldoutListItemView.prototype._setUpListeners.call( this );\n        // re-rendering on deletion\n        this.model.on( 'change', function( model, options ){\n            if( _.isEqual( _.keys( model.changed ), [ 'deleted' ] ) ){\n                this.render();\n            }\n        }, this );\n    },\n\n    // ......................................................................... rendering\n    //TODO:?? possibly move to listItem\n    /** render a subtitle to show the user what sort of collection this is */\n    _renderSubtitle : function(){\n        var $subtitle = $( '<div class=\"subtitle\"></div>' );\n        //TODO: would be good to get this in the subtitle\n        //var len = this.model.elements.length;\n        switch( this.model.get( 'collection_type' ) ){\n            case 'list':\n                return $subtitle.text( _l( 'a list of datasets' ) );\n            case 'paired':\n                return $subtitle.text( _l( 'a pair of datasets' ) );\n            case 'list:paired':\n                return $subtitle.text( _l( 'a list of paired datasets' ) );\n        }\n        return $subtitle;\n    },\n\n    // ......................................................................... foldout\n    /** override to add linktarget to sub-panel */\n    _getFoldoutPanelOptions : function(){\n        var options = FoldoutListItemView.prototype._getFoldoutPanelOptions.call( this );\n        return _.extend( options, {\n            linkTarget  : this.linkTarget,\n            hasUser     : this.hasUser\n        });\n    },\n\n    /** override to not catch sub-panel selectors */\n    $selector : function(){\n        return this.$( '> .selector' );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCListItemView.prototype.templates = (function(){\n\n    var warnings = _.extend( {}, FoldoutListItemView.prototype.templates.warnings, {\n        error : BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            '<% if( model.error ){ %>',\n                '<div class=\"errormessagesmall\">',\n                    _l( 'There was an error getting the data for this collection' ), ': <%- model.error %>',\n                '</div>',\n            '<% } %>'\n        ]),\n        purged : BASE_MVC.wrapTemplate([\n            '<% if( model.purged ){ %>',\n                '<div class=\"purged-msg warningmessagesmall\">',\n                    _l( 'This collection has been deleted and removed from disk' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        deleted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.deleted && !model.purged ){ %>',\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This collection has been deleted' ),\n                '</div>',\n            '<% } %>'\n        ])\n    });\n\n    // use element identifier\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- collection.element_identifier || collection.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, FoldoutListItemView.prototype.templates, {\n        warnings : warnings,\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemView = ListItemView.extend(\n/** @lends DCEListItemView.prototype */{\n//TODO: this might be expendable - compacted with HDAListItemView\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** add the DCE class to the list item */\n    className   : ListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** set up */\n    initialize  : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( 'DCEListItemView.initialize:', attributes );\n        ListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCEListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDCEListItemView.prototype.templates = (function(){\n\n    // use the element identifier here - since that will persist and the user will need it\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.element_identifier %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'element' );\n\n    return _.extend( {}, ListItemView.prototype.templates, {\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemView = DATASET_LI.DatasetListItemView.extend(\n/** @lends DatasetDCEListItemView.prototype */{\n\n    className   : DATASET_LI.DatasetListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( 'DatasetDCEListItemView.initialize:', attributes );\n        DATASET_LI.DatasetListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetDCEListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemView.prototype.templates = (function(){\n\n    // use the element identifier here and not the dataset name\n    //TODO:?? can we steal the DCE titlebar?\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.element_identifier %></span>',\n            '</div>',\n        '</div>'\n    ], 'element' );\n\n    return _.extend( {}, DATASET_LI.DatasetListItemView.prototype.templates, {\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemView = DCListItemView.extend(\n/** @lends NestedDCDCEListItemView.prototype */{\n\n    className   : DCListItemView.prototype.className + \" dataset-collection-element\",\n\n    /** logger used to record this.log messages, commonly set to console */\n    // comment this out to suppress log output\n    //logger              : console,\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        DCListItemView.prototype._swapNewRender.call( this, $newRender );\n//TODO: model currently has no state\n        var state = this.model.get( 'state' ) || 'ok';\n        //if( this.model.has( 'state' ) ){\n        this.$el.addClass( 'state-' + state );\n        //}\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'NestedDCDCEListItemView(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        DCListItemView          : DCListItemView,\n        DCEListItemView         : DCEListItemView,\n        DatasetDCEListItemView  : DatasetDCEListItemView,\n        NestedDCDCEListItemView : NestedDCDCEListItemView\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/collection-li.js\n ** module id = 12\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/dataset-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_MODEL, BASE_MVC, _l ){\n//==============================================================================\n/*\nNotes:\n\nTerminology:\n    DatasetCollection/DC : a container of datasets or nested DatasetCollections\n    Element/DatasetCollectionElement/DCE : an item contained in a DatasetCollection\n    HistoryDatasetCollectionAssociation/HDCA: a DatasetCollection contained in a history\n\n\nThis all seems too complex unfortunately:\n\n- Terminology collision between DatasetCollections (DCs) and Backbone Collections.\n- In the DatasetCollections API JSON, DC Elements use a 'Has A' stucture to *contain*\n    either a dataset or a nested DC. This would make the hierarchy much taller. I've\n    decided to merge the contained JSON with the DC element json - making the 'has a'\n    relation into an 'is a' relation. This seems simpler to me and allowed a lot of\n    DRY in both models and views, but may make tracking or tracing within these models\n    more difficult (since DatasetCollectionElements are now *also* DatasetAssociations\n    or DatasetCollections (nested)). This also violates the rule of thumb about\n    favoring aggregation over inheritance.\n- Currently, there are three DatasetCollection subclasses: List, Pair, and ListPaired.\n    These each should a) be usable on their own, b) be usable in the context of\n    nesting within a collection model (at least in the case of ListPaired), and\n    c) be usable within the context of other container models (like History or\n    LibraryFolder, etc.). I've tried to separate/extract classes in order to\n    handle those three situations, but it's proven difficult to do in a simple,\n    readable manner.\n- Ideally, histories and libraries would inherit from the same server models as\n    dataset collections do since they are (in essence) dataset collections themselves -\n    making the whole nested structure simpler. This would be a large, error-prone\n    refactoring and migration.\n\nMany of the classes and heirarchy are meant as extension points so, while the\nrelations and flow may be difficult to understand initially, they'll allow us to\nhandle the growth or flux dataset collection in the future (w/o actually implementing\nany YAGNI).\n\n*/\n//_________________________________________________________________________________________________ ELEMENTS\n/** @class mixin for Dataset collection elements.\n *      When collection elements are passed from the API, the underlying element is\n *          in a sub-object 'object' (IOW, a DCE representing an HDA will have HDA json in element.object).\n *      This mixin uses the constructor and parse methods to merge that JSON with the DCE attribtues\n *          effectively changing a DCE from a container to a subclass (has a --> is a).\n */\nvar DatasetCollectionElementMixin = {\n\n    /** default attributes used by elements in a dataset collection */\n    defaults : {\n        model_class         : 'DatasetCollectionElement',\n        element_identifier  : null,\n        element_index       : null,\n        element_type        : null\n    },\n\n    /** merge the attributes of the sub-object 'object' into this model */\n    _mergeObject : function( attributes ){\n        // if we don't preserve and correct ids here, the element id becomes the object id\n        // and collision in backbone's _byId will occur and only\n        _.extend( attributes, attributes.object, { element_id: attributes.id });\n        delete attributes.object;\n        return attributes;\n    },\n\n    /** override to merge this.object into this */\n    constructor : function( attributes, options ){\n        // console.debug( '\\t DatasetCollectionElement.constructor:', attributes, options );\n        attributes = this._mergeObject( attributes );\n        this.idAttribute = 'element_id';\n        Backbone.Model.apply( this, arguments );\n    },\n\n    /** when the model is fetched, merge this.object into this */\n    parse : function( response, options ){\n        var attributes = response;\n        attributes = this._mergeObject( attributes );\n        return attributes;\n    }\n};\n\n//TODO: unused?\n/** @class Concrete class of Generic DatasetCollectionElement */\nvar DatasetCollectionElement = Backbone.Model\n    .extend( BASE_MVC.LoggableMixin )\n    .extend( DatasetCollectionElementMixin );\n\n\n//==============================================================================\n/** @class Base/Abstract Backbone collection for Generic DCEs. */\nvar DCECollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends DCECollection.prototype */{\n    model: DatasetCollectionElement,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /** Set up.\n     *  @see Backbone.Collection#initialize\n     */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DCECollection).initialize:', attributes, options );\n        options = options || {};\n        //this._setUpListeners();\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetCollectionElementCollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for a dataset collection element that is a dataset (HDA).\n */\nvar DatasetDCE = DATASET_MODEL.DatasetAssociation.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends DatasetDCE.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** url fn */\n    url : function(){\n        var galaxyRoot = (( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' ));\n        // won't always be an hda\n        if( !this.has( 'history_id' ) ){\n            console.warn( 'no endpoint for non-hdas within a collection yet' );\n            // (a little silly since this api endpoint *also* points at hdas)\n            return galaxyRoot + 'api/datasets';\n        }\n        return galaxyRoot + 'api/histories/' + this.get( 'history_id' ) + '/contents/' + this.get( 'id' );\n    },\n\n    defaults : _.extend( {},\n        DATASET_MODEL.DatasetAssociation.prototype.defaults,\n        DatasetCollectionElementMixin.defaults\n    ),\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually for now\n    /** call the mixin constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t DatasetDCE.constructor:', attributes, options );\n        //DATASET_MODEL.DatasetAssociation.prototype.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DatasetDCE).initialize:', attributes, options );\n        DATASET_MODEL.DatasetAssociation.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails : function(){\n        // dataset collection api does return genome_build but doesn't return annotation\n        return _.has( this.attributes, 'annotation' );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = this.get( 'element_identifier' );\n        return ([ 'DatasetDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class DCECollection of DatasetDCE's (a list of datasets, a pair of datasets).\n */\nvar DatasetDCECollection = DCECollection.extend(\n/** @lends DatasetDCECollection.prototype */{\n    model: DatasetDCE,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(DatasetDCECollection).initialize:', attributes, options );\n        DCECollection.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//_________________________________________________________________________________________________ COLLECTIONS\n/** @class Backbone model for Dataset Collections.\n *      The DC API returns an array of JSON objects under the attribute elements.\n *      This model:\n *          - removes that array/attribute ('elements') from the model,\n *          - creates a bbone collection (of the class defined in the 'collectionClass' attribute),\n *          - passes that json onto the bbone collection\n *          - caches the bbone collection in this.elements\n */\nvar DatasetCollection = Backbone.Model\n        .extend( BASE_MVC.LoggableMixin )\n        .extend( BASE_MVC.SearchableModelMixin )\n.extend(/** @lends DatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** default attributes for a model */\n    defaults : {\n        /* 'list', 'paired', or 'list:paired' */\n        collection_type     : null,\n        //??\n        deleted             : false\n    },\n\n    /** Which class to use for elements */\n    collectionClass : DCECollection,\n\n    /** set up: create elements instance var and (on changes to elements) update them  */\n    initialize : function( model, options ){\n        this.debug( this + '(DatasetCollection).initialize:', model, options, this );\n        //historyContent.HistoryContent.prototype.initialize.call( this, attrs, options );\n        this.elements = this._createElementsModel();\n        this.on( 'change:elements', function(){\n            this.log( 'change:elements' );\n//TODO: prob. better to update the collection instead of re-creating it\n            this.elements = this._createElementsModel();\n        });\n    },\n\n    /** move elements model attribute to full collection */\n    _createElementsModel : function(){\n        this.debug( this + '._createElementsModel', this.collectionClass, this.get( 'elements' ), this.elements );\n//TODO: same patterns as DatasetCollectionElement _createObjectModel - refactor to BASE_MVC.hasSubModel?\n        var elements = this.get( 'elements' ) || [];\n        this.unset( 'elements', { silent: true });\n        this.elements = new this.collectionClass( elements );\n        //this.debug( 'collectionClass:', this.collectionClass + '', this.elements );\n        return this.elements;\n    },\n\n    // ........................................................................ common queries\n    /** pass the elements back within the model json when this is serialized */\n    toJSON : function(){\n        var json = Backbone.Model.prototype.toJSON.call( this );\n        if( this.elements ){\n            json.elements = this.elements.toJSON();\n        }\n        return json;\n    },\n\n    /** Is this collection in a 'ready' state no processing (for the collection) is left\n     *  to do on the server.\n     */\n    inReadyState : function(){\n        var populated = this.get( 'populated' );\n        return ( this.isDeletedOrPurged() || populated );\n    },\n\n    //TODO:?? the following are the same interface as DatasetAssociation - can we combine?\n    /** Does the DC contain any elements yet? Is a fetch() required? */\n    hasDetails : function(){\n//TODO: this is incorrect for (accidentally) empty collections\n        this.debug( 'hasDetails:', this.elements.length );\n        return this.elements.length !== 0;\n    },\n\n    /** Given the filters, what models in this.elements would be returned? */\n    getVisibleContents : function( filters ){\n        // filters unused for now\n        return this.elements;\n    },\n\n    // ........................................................................ ajax\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    'delete' : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** Is this collection deleted or purged? */\n    isDeletedOrPurged : function(){\n        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n    },\n\n    // ........................................................................ searchable\n    /** searchable attributes for collections */\n    searchAttributes : [\n        'name'\n    ],\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var idAndName = [ this.get( 'id' ), this.get( 'name' ) || this.get( 'element_identifier' ) ];\n        return 'DatasetCollection(' + ( idAndName.join(',') ) + ')';\n    }\n});\n\n\n//==============================================================================\n/** Model for a DatasetCollection containing datasets (non-nested).\n */\nvar ListDatasetCollection = DatasetCollection.extend(\n/** @lends ListDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** override since we know the collection will only contain datasets */\n    collectionClass : DatasetDCECollection,\n\n//TODO: unused?\n    initialize : function( attrs, options ){\n        this.debug( this + '(ListDatasetCollection).initialize:', attrs, options );\n        DatasetCollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'ListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** Model for a DatasetCollection containing fwd/rev datasets (a list of 2).\n */\nvar PairDatasetCollection = ListDatasetCollection.extend(\n/** @lends PairDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n//TODO: unused?\n    /**  */\n    initialize : function( attrs, options ){\n        this.debug( this + '(PairDatasetCollection).initialize:', attrs, options );\n        ListDatasetCollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'PairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//_________________________________________________________________________________________________ NESTED COLLECTIONS\n// this is where things get weird, man. Weird.\n//TODO: it might be possible to compact all the following...I think.\n//==============================================================================\n/** @class Backbone model for a Generic DatasetCollectionElement that is also a DatasetCollection\n *      (a nested collection). Currently only list:paired.\n */\nvar NestedDCDCE = DatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends NestedDCDCE.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** call the mixin constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t NestedDCDCE.constructor:', attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n        return ([ 'NestedDCDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection containing Generic NestedDCDCE's (nested dataset collections).\n */\nvar NestedDCDCECollection = DCECollection.extend(\n/** @lends NestedDCDCECollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** This is a collection of nested collections */\n    model: NestedDCDCE,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attrs, options ){\n        this.debug( this + '(NestedDCDCECollection).initialize:', attrs, options );\n        DCECollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'NestedDCDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for a paired dataset collection within a list:paired dataset collection.\n */\nvar NestedPairDCDCE = PairDatasetCollection.extend( BASE_MVC.mixin( DatasetCollectionElementMixin,\n/** @lends NestedPairDCDCE.prototype */{\n//TODO:?? possibly rename to NestedDatasetCollection?\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** This is both a collection and a collection element - call the constructor */\n    constructor : function( attributes, options ){\n        this.debug( '\\t NestedPairDCDCE.constructor:', attributes, options );\n        //DatasetCollection.constructor.call( this, attributes, options );\n        DatasetCollectionElementMixin.constructor.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n        var objStr = ( this.object )?( '' + this.object ):( this.get( 'element_identifier' ) );\n        return ([ 'NestedPairDCDCE(', objStr, ')' ].join( '' ));\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection for a backbone collection containing paired dataset collections.\n */\nvar NestedPairDCDCECollection = NestedDCDCECollection.extend(\n/** @lends PairDCDCECollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** We know this collection is composed of only nested pair collections */\n    model: NestedPairDCDCE,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attrs, options ){\n        this.debug( this + '(NestedPairDCDCECollection).initialize:', attrs, options );\n        NestedDCDCECollection.prototype.initialize.call( this, attrs, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'NestedPairDCDCECollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone Model for a DatasetCollection (list) that contains DatasetCollections (pairs).\n */\nvar ListPairedDatasetCollection = DatasetCollection.extend(\n/** @lends ListPairedDatasetCollection.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** list:paired is the only collection that itself contains collections */\n    collectionClass : NestedPairDCDCECollection,\n\n//TODO: unused?\n    /** set up */\n    initialize : function( attributes, options ){\n        this.debug( this + '(ListPairedDatasetCollection).initialize:', attributes, options );\n        DatasetCollection.prototype.initialize.call( this, attributes, options );\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'ListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        ListDatasetCollection               : ListDatasetCollection,\n        PairDatasetCollection               : PairDatasetCollection,\n        ListPairedDatasetCollection         : ListPairedDatasetCollection\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/collection-model.js\n ** module id = 13\n ** module chunks = 3 4\n **/","\ndefine([\n    \"mvc/history/hdca-model\",\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"mvc/ui/ui-modal\",\n    \"utils/natural-sort\",\n    \"utils/localization\",\n    \"ui/hoverhighlight\"\n], function( HDCA, STATES, BASE_MVC, UI_MODAL, naturalSort, _l ){\n/*==============================================================================\nTODO:\n    use proper Element model and not just json\n    straighten out createFn, collection.createHDCA\n    possibly stop using modals for this\n    It would be neat to do a drag and drop\n\n==============================================================================*/\n/** A view for both DatasetDCEs and NestedDCDCEs\n *  (things that implement collection-model:DatasetCollectionElementMixin)\n */\nvar DatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName     : 'li',\n    className   : 'collection-element',\n\n    initialize : function( attributes ){\n        this.element = attributes.element || {};\n        this.selected = attributes.selected || false;\n    },\n\n    render : function(){\n        this.$el\n            .attr( 'data-element-id', this.element.id )\n            .attr( 'draggable', true )\n            .html( this.template({ element: this.element }) );\n        if( this.selected ){\n            this.$el.addClass( 'selected' );\n        }\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template : _.template([\n        '<a class=\"name\" title=\"', _l( 'Click to rename' ), '\" href=\"javascript:void(0)\">',\n            '<%= element.name %>',\n        '</a>',\n        '<button class=\"discard btn btn-sm\" title=\"', _l( 'Remove this dataset from the list' ), '\">',\n            _l( 'Discard' ),\n        '</button>',\n    ].join('')),\n\n    /** select this element and pub */\n    select : function( toggle ){\n        this.$el.toggleClass( 'selected', toggle );\n        this.trigger( 'select', {\n            source   : this,\n            selected : this.$el.hasClass( 'selected' )\n        });\n    },\n\n    /** animate the removal of this element and pub */\n    discard : function(){\n        var view = this,\n            parentWidth = this.$el.parent().width();\n        this.$el.animate({ 'margin-right' : parentWidth }, 'fast', function(){\n            view.trigger( 'discard', {\n                source : view\n            });\n            view.destroy();\n        });\n    },\n\n    /** remove the DOM and any listeners */\n    destroy : function(){\n        this.off();\n        this.$el.remove();\n    },\n\n    events : {\n        'click'         : '_click',\n        'click .name'   : '_clickName',\n        'click .discard': '_clickDiscard',\n\n        'dragstart'     : '_dragstart',\n        'dragend'       : '_dragend',\n        'dragover'      : '_sendToParent',\n        'drop'          : '_sendToParent'\n    },\n\n    /** select when the li is clicked */\n    _click : function( ev ){\n        ev.stopPropagation();\n        this.select( ev );\n    },\n\n    /** rename a pair when the name is clicked */\n    _clickName : function( ev ){\n        ev.stopPropagation();\n        ev.preventDefault();\n        var promptString = [ _l( 'Enter a new name for the element' ), ':\\n(',\n                             _l( 'Note that changing the name here will not rename the dataset' ), ')' ].join( '' ),\n            response = prompt( _l( 'Enter a new name for the element' ) + ':', this.element.name );\n        if( response ){\n            this.element.name = response;\n            this.render();\n        }\n        //TODO: cancelling with ESC leads to closure of the creator...\n    },\n\n    /** discard when the discard button is clicked */\n    _clickDiscard : function( ev ){\n        ev.stopPropagation();\n        this.discard();\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart : function( ev ){\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n        ev.dataTransfer.effectAllowed = 'move';\n        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.element ) );\n\n        this.$el.addClass( 'dragging' );\n        this.$el.parent().trigger( 'collection-element.dragstart', [ this ] );\n    },\n\n    /** dragging for re-ordering */\n    _dragend : function( ev ){\n        this.$el.removeClass( 'dragging' );\n        this.$el.parent().trigger( 'collection-element.dragend', [ this ] );\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent : function( ev ){\n        this.$el.parent().trigger( ev );\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'DatasetCollectionElementView()';\n    }\n});\n\n\n// ============================================================================\n/** An interface for building collections.\n */\nvar ListCollectionCreator = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n\n    /** the class used to display individual elements */\n    elementViewClass : DatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass  : HDCA.HistoryListDatasetCollection,\n    className        : 'list-collection-creator collection-creator flex-row-container',\n\n    /** minimum number of valid elements to start with in order to build a collection of this type */\n    minElements      : 1,\n\n    defaultAttributes : {\n//TODO: remove - use new collectionClass().save()\n        /** takes elements and creates the proper collection - returns a promise */\n        creationFn : function(){ throw new TypeError( 'no creation fn for creator' ); },\n        /** fn to call when the collection is created (scoped to this) */\n        oncreate   : function(){},\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        oncancel   : function(){},\n        /** distance from list edge to begin autoscrolling list */\n        autoscrollDist  : 24,\n        /** Color passed to hoverhighlight */\n        highlightClr    : 'rgba( 64, 255, 255, 1.0 )'\n    },\n\n    /** set up initial options, instance vars, behaviors */\n    initialize : function( attributes ){\n        this.metric( 'ListCollectionCreator.initialize', attributes );\n        var creator = this;\n        _.each( this.defaultAttributes, function( value, key ){\n            value = attributes[ key ] || value;\n            creator[ key ] = value;\n        });\n\n        /** unordered, original list - cache to allow reversal */\n        creator.initialElements = attributes.elements || [];\n\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this._setUpBehaviors();\n    },\n\n    /** set up instance vars */\n    _instanceSetUp : function(){\n        /** Ids of elements that have been selected by the user - to preserve over renders */\n        this.selectedIds = {};\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n    },\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data */\n    _elementsSetUp : function(){\n        //this.debug( '-- _dataSetUp' );\n        /** a list of invalid elements and the reasons they aren't valid */\n        this.invalidElements = [];\n//TODO: handle fundamental problem of syncing DOM, views, and list here\n        /** data for list in progress */\n        this.workingElements = [];\n        /** views for workingElements */\n        this.elementViews = [];\n\n        // copy initial list, sort, add ids if needed\n        this.workingElements = this.initialElements.slice( 0 );\n        this._ensureElementIds();\n        this._validateElements();\n        this._mangleDuplicateNames();\n        this._sortElements();\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureElementIds : function(){\n        this.workingElements.forEach( function( element ){\n            if( !element.hasOwnProperty( 'id' ) ){\n                element.id = _.uniqueId();\n            }\n        });\n        return this.workingElements;\n    },\n\n    /** separate working list into valid and invalid elements for this collection */\n    _validateElements : function(){\n        var creator = this,\n            existingNames = {};\n        creator.invalidElements = [];\n\n        this.workingElements = this.workingElements.filter( function( element ){\n            var problem = creator._isElementInvalid( element );\n            if( problem ){\n                creator.invalidElements.push({\n                    element : element,\n                    text    : problem\n                });\n            }\n            return !problem;\n        });\n        return this.workingElements;\n    },\n\n    /** describe what is wrong with a particular element if anything */\n    _isElementInvalid : function( element ){\n        if( element.history_content_type !== 'dataset' ){\n            return _l( \"is not a dataset\" );\n        }\n        if( element.state !== STATES.OK ){\n            if( _.contains( STATES.NOT_READY_STATES, element.state ) ){\n                return _l( \"hasn't finished running yet\" );\n            }\n            return _l( \"has errored, is paused, or is not accessible\" );\n        }\n        if( element.deleted || element.purged ){\n            return _l( \"has been deleted or purged\" );\n        }\n        return null;\n    },\n\n    /** mangle duplicate names using a mac-like '(counter)' addition to any duplicates */\n    _mangleDuplicateNames : function(){\n        var SAFETY = 900,\n            counter = 1,\n            existingNames = {};\n        this.workingElements.forEach( function( element ){\n            var currName = element.name;\n            while( existingNames.hasOwnProperty( currName ) ){\n                currName = element.name + ' (' + counter + ')';\n                counter += 1;\n                if( counter >= SAFETY ){\n                    throw new Error( 'Safety hit in while loop - thats impressive' );\n                }\n            }\n            element.name = currName;\n            existingNames[ element.name ] = true;\n        });\n    },\n\n    /** sort a list of elements */\n    _sortElements : function( list ){\n        // // currently only natural sort by name\n        // this.workingElements.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n        // return this.workingElements;\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    // templates : ListCollectionCreator.templates,\n    /** render the entire interface */\n    render : function( speed, callback ){\n        //this.debug( '-- _render' );\n        if( this.workingElements.length < this.minElements ){\n            return this._renderInvalid( speed, callback );\n        }\n\n        this.$el.empty().html( this.templates.main() );\n        this._renderHeader( speed );\n        this._renderMiddle( speed );\n        this._renderFooter( speed );\n        this._addPluginComponents();\n        this.$( '.collection-name' ).focus();\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n\n    /** render a simplified interface aimed at telling the user why they can't move forward */\n    _renderInvalid : function( speed, callback ){\n        //this.debug( '-- _render' );\n        this.$el.empty().html( this.templates.invalidInitial({\n            problems: this.invalidElements,\n            elements: this.workingElements,\n        }));\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader : function( speed, callback ){\n        var $header = this.$( '.header' ).empty().html( this.templates.header() )\n            .find( '.help-content' ).prepend( $( this.templates.helpContent() ) );\n        //TODO: should only show once despite calling _renderHeader again\n        if( this.invalidElements.length ){\n            this._invalidElementsAlert();\n        }\n        return $header;\n    },\n\n    /** render the middle including the elements */\n    _renderMiddle : function( speed, callback ){\n        var $middle = this.$( '.middle' ).empty().html( this.templates.middle() );\n        this._renderList( speed );\n        return $middle;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter : function( speed, callback ){\n        var $footer = this.$( '.footer' ).empty().html( this.templates.footer() );\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        return $footer;\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents : function(){\n        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', this.highlightClr );\n    },\n\n    /** build and show an alert describing any elements that could not be included due to problems */\n    _invalidElementsAlert : function(){\n        this._showAlert( this.templates.invalidElements({ problems: this.invalidElements }), 'alert-warning' );\n    },\n\n    /** add (or clear if clear is truthy) a validation warning to the DOM element described in what */\n    _validationWarning : function( what, clear ){\n        var VALIDATION_CLASS = 'validation-warning';\n        if( what === 'name' ){\n            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n            this.$( '.collection-name' ).focus().select();\n        }\n        if( clear ){\n            what = what || this.$( '.' + VALIDATION_CLASS );\n            what.removeClass( VALIDATION_CLASS );\n        } else {\n            what.addClass( VALIDATION_CLASS );\n        }\n    },\n\n    _disableNameAndCreate : function( disable ){\n        disable = !_.isUndefined( disable )? disable : true;\n        if( disable ){\n            this.$( '.collection-name' ).prop( 'disabled', true );\n            this.$( '.create-collection' ).toggleClass( 'disabled', true );\n        // } else {\n        //     this.$( '.collection-name' ).prop( 'disabled', false );\n        //     this.$( '.create-collection' ).removeClass( 'disable' );\n        }\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** conv. to the main list display DOM */\n    $list : function(){\n        return this.$( '.collection-elements' );\n    },\n\n    /** show or hide the clear selected control based on the num of selected elements */\n    _renderClearSelected : function(){\n        if( _.size( this.selectedIds ) ){\n            this.$( '.collection-elements-controls > .clear-selected' ).show();\n        } else {\n            this.$( '.collection-elements-controls > .clear-selected' ).hide();\n        }\n    },\n\n    /** render the elements in order (or a warning if no elements found) */\n    _renderList : function( speed, callback ){\n        //this.debug( '-- _renderList' );\n        var creator = this,\n            $tmp = jQuery( '<div/>' ),\n            $list = creator.$list();\n\n        _.each( this.elementViews, function( view ){\n            view.destroy();\n            creator.removeElementView( view );\n        });\n\n        // if( !this.workingElements.length ){\n        //     this._renderNoValidElements();\n        //     return;\n        // }\n\n        creator.workingElements.forEach( function( element ){\n            var elementView = creator._createElementView( element );\n            $tmp.append( elementView.$el );\n        });\n\n        creator._renderClearSelected();\n        $list.empty().append( $tmp.children() );\n        _.invoke( creator.elementViews, 'render' );\n\n        if( $list.height() > $list.css( 'max-height' ) ){\n            $list.css( 'border-width', '1px 0px 1px 0px' );\n        } else {\n            $list.css( 'border-width', '0px' );\n        }\n    },\n\n    /** create an element view, cache in elementViews, set up listeners, and return */\n    _createElementView : function( element ){\n        var elementView = new this.elementViewClass({\n//TODO: use non-generic class or not all\n            // model : COLLECTION.DatasetDCE( element )\n            element : element,\n            selected: _.has( this.selectedIds, element.id )\n        });\n        this.elementViews.push( elementView );\n        this._listenToElementView( elementView );\n        return elementView;\n    },\n\n    /** listen to any element events */\n    _listenToElementView : function( view ){\n        var creator = this;\n        creator.listenTo( view, {\n            select : function( data ){\n                var element = data.source.element;\n                if( data.selected ){\n                    creator.selectedIds[ element.id ] = true;\n                } else {\n                    delete creator.selectedIds[ element.id ];\n                }\n                creator.trigger( 'elements:select', data );\n            },\n            discard : function( data ){\n                creator.trigger( 'elements:discard', data );\n            }\n        });\n    },\n\n    /** add a new element view based on the json in element */\n    addElementView : function( element ){\n//TODO: workingElements is sorted, add element in appropo index\n        // add element, sort elements, find element index\n        // var view = this._createElementView( element );\n        // return view;\n    },\n\n    /** stop listening to view and remove from caches */\n    removeElementView : function( view ){\n        delete this.selectedIds[ view.element.id ];\n        this._renderClearSelected();\n\n        this.elementViews = _.without( this.elementViews, view );\n        this.stopListening( view );\n    },\n\n    /** render a message in the list that no elements remain to create a collection */\n    _renderNoElementsLeft : function(){\n        this._disableNameAndCreate( true );\n        this.$( '.collection-elements' ).append( this.templates.noElementsLeft() );\n    },\n\n    // /** render a message in the list that no valid elements were found to create a collection */\n    // _renderNoValidElements : function(){\n    //     this._disableNameAndCreate( true );\n    //     this.$( '.collection-elements' ).append( this.templates.noValidElements() );\n    // },\n\n    // ------------------------------------------------------------------------ API\n    /** convert element into JSON compatible with the collections API */\n    _elementToJSON : function( element ){\n        // return element.toJSON();\n        return element;\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object} the jquery ajax request\n     */\n    createList : function( name ){\n        if( !this.workingElements.length ){\n            var message = _l( 'No valid elements for final list' ) + '. ';\n            message += '<a class=\"cancel-create\" href=\"javascript:void(0);\">' + _l( 'Cancel' ) + '</a> ';\n            message += _l( 'or' );\n            message += ' <a class=\"reset\" href=\"javascript:void(0);\">' + _l( 'start over' ) + '</a>.';\n            this._showAlert( message );\n            return;\n        }\n\n        var creator = this,\n            elements = this.workingElements.map( function( element ){\n                return creator._elementToJSON( element );\n            });\n\n        creator.blocking = true;\n        return creator.creationFn( elements, name )\n            .always( function(){\n                creator.blocking = false;\n            })\n            .fail( function( xhr, status, message ){\n                creator.trigger( 'error', {\n                    xhr     : xhr,\n                    status  : status,\n                    message : _l( 'An error occurred while creating this collection' )\n                });\n            })\n            .done( function( response, message, xhr ){\n                creator.trigger( 'collection:created', response, message, xhr );\n                creator.metric( 'collection:created', response );\n                if( typeof creator.oncreate === 'function' ){\n                    creator.oncreate.call( this, response, message, xhr );\n                }\n            });\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors : function(){\n        this.on( 'error', this._errorHandler );\n\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        });\n\n        this.on( 'elements:select', function( data ){\n            this._renderClearSelected();\n        });\n\n        this.on( 'elements:discard', function( data ){\n            var element = data.source.element;\n            this.removeElementView( data.source );\n\n            this.workingElements = _.without( this.workingElements, element );\n            if( !this.workingElements.length ){\n                this._renderNoElementsLeft();\n            }\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    /** handle errors with feedback and details to the user (if available) */\n    _errorHandler : function( data ){\n        this.error( data );\n\n        var creator = this;\n            content = data.message || _l( 'An error occurred' );\n        if( data.xhr ){\n            var xhr = data.xhr,\n                message = data.message;\n            if( xhr.readyState === 0 && xhr.status === 0 ){\n                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' ) +\n                    _l( ' Try again in a few minutes.' );\n            } else if( xhr.responseJSON ){\n                content += ':<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n            } else {\n                content += ': ' + message;\n            }\n        }\n        creator._showAlert( content, 'alert-danger' );\n    },\n\n    events : {\n        // header\n        'click .more-help'              : '_clickMoreHelp',\n        'click .less-help'              : '_clickLessHelp',\n        'click .main-help'              : '_toggleHelp',\n        'click .header .alert button'   : '_hideAlert',\n\n        'click .reset'                  : 'reset',\n        'click .clear-selected'         : 'clearSelectedElements',\n\n        // elements - selection\n        'click .collection-elements'    : 'clearSelectedElements',\n\n        // elements - drop target\n        // 'dragenter .collection-elements': '_dragenterElements',\n        // 'dragleave .collection-elements': '_dragleaveElements',\n        'dragover .collection-elements' : '_dragoverElements',\n        'drop .collection-elements'     : '_dropElements',\n\n        // these bubble up from the elements as custom events\n        'collection-element.dragstart .collection-elements' : '_elementDragstart',\n        'collection-element.dragend   .collection-elements' : '_elementDragend',\n\n        // footer\n        'change .collection-name'       : '_changeName',\n        'keydown .collection-name'      : '_nameCheckForEnter',\n        'click .cancel-create'          : function( ev ){\n            if( typeof this.oncancel === 'function' ){\n                this.oncancel.call( this );\n            }\n        },\n        'click .create-collection'      : '_clickCreate'//,\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).addClass( 'expanded' );\n        this.$( '.more-help' ).hide();\n    },\n    /** collapse help */\n    _clickLessHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).removeClass( 'expanded' );\n        this.$( '.more-help' ).show();\n    },\n    /** toggle help */\n    _toggleHelp : function( ev ){\n        ev.stopPropagation();\n        this.$( '.main-help' ).toggleClass( 'expanded' );\n        this.$( '.more-help' ).toggle();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*) */\n    _showAlert : function( message, alertClass ){\n        alertClass = alertClass || 'alert-danger';\n        this.$( '.main-help' ).hide();\n        this.$( '.header .alert' )\n            .attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n            .find( '.alert-message' ).html( message );\n    },\n    /** hide the alerts at the top */\n    _hideAlert : function( message ){\n        this.$( '.main-help' ).show();\n        this.$( '.header .alert' ).hide();\n    },\n\n    // ........................................................................ elements\n    /** reset all data to the initial state */\n    reset : function(){\n        this._instanceSetUp();\n        this._elementsSetUp();\n        this.render();\n    },\n\n    /** deselect all elements */\n    clearSelectedElements : function( ev ){\n        this.$( '.collection-elements .collection-element' ).removeClass( 'selected' );\n        this.$( '.collection-elements-controls > .clear-selected' ).hide();\n    },\n\n    //_dragenterElements : function( ev ){\n    //    //this.debug( '_dragenterElements:', ev );\n    //},\n//TODO: if selected are dragged out of the list area - remove the placeholder - cuz it won't work anyway\n    // _dragleaveElements : function( ev ){\n    //    //this.debug( '_dragleaveElements:', ev );\n    // },\n\n    /** track the mouse drag over the list adding a placeholder to show where the drop would occur */\n    _dragoverElements : function( ev ){\n        //this.debug( '_dragoverElements:', ev );\n        ev.preventDefault();\n\n        var $list = this.$list();\n        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n        var $nearest = this._getNearestElement( ev.originalEvent.clientY );\n\n        //TODO: no need to re-create - move instead\n        this.$( '.element-drop-placeholder' ).remove();\n        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n        if( !$nearest.size() ){\n            $list.append( $placeholder );\n        } else {\n            $nearest.before( $placeholder );\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll : function( $element, y ){\n        var AUTOSCROLL_SPEED = 2,\n            offset = $element.offset(),\n            scrollTop = $element.scrollTop(),\n            upperDist = y - offset.top,\n            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n        }\n    },\n\n    /** get the nearest element based on the mouse's Y coordinate.\n     *  If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestElement : function( y ){\n        var WIGGLE = 4,\n            lis = this.$( '.collection-elements li.collection-element' ).toArray();\n        for( var i=0; i<lis.length; i++ ){\n            var $li = $( lis[i] ),\n                top = $li.offset().top,\n                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n            if( top + halfHeight > y && top - halfHeight < y ){\n                return $li;\n            }\n        }\n        return $();\n    },\n\n    /** drop (dragged/selected elements) onto the list, re-ordering the internal list */\n    _dropElements : function( ev ){\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = 'move';\n\n        // insert before the nearest element or after the last.\n        var $nearest = this._getNearestElement( ev.clientY );\n        if( $nearest.size() ){\n            this.$dragging.insertBefore( $nearest );\n        } else {\n            // no nearest before - insert after last element\n            this.$dragging.insertAfter( this.$( '.collection-elements .collection-element' ).last() );\n        }\n        // resync the creator's list based on the new DOM order\n        this._syncOrderToDom();\n        return false;\n    },\n\n    /** resync the creator's list of elements based on the DOM order */\n    _syncOrderToDom : function(){\n        var creator = this,\n            newElements = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$( '.collection-elements .collection-element' ).each( function(){\n            var id = $( this ).attr( 'data-element-id' ),\n                element = _.findWhere( creator.workingElements, { id: id });\n            if( element ){\n                newElements.push( element );\n            } else {\n                console.error( 'missing element: ', id );\n            }\n        });\n        this.workingElements = newElements;\n        this._renderList();\n    },\n\n    /** drag communication with element sub-views: dragstart */\n    _elementDragstart : function( ev, element ){\n        // auto select the element causing the event and move all selected\n        element.select( true );\n        this.$dragging = this.$( '.collection-elements .collection-element.selected' );\n    },\n\n    /** drag communication with element sub-views: dragend - remove the placeholder */\n    _elementDragend : function( ev, element ){\n        $( '.element-drop-placeholder' ).remove();\n        this.$dragging = null;\n    },\n\n    // ........................................................................ footer\n    /** handle a collection name change */\n    _changeName : function( ev ){\n        this._validationWarning( 'name', !!this._getName() );\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter : function( ev ){\n        if( ev.keyCode === 13 && !this.blocking ){\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName : function(){\n        return _.escape( this.$( '.collection-name' ).val() );\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate : function( ev ){\n        var name = this._getName();\n        if( !name ){\n            this._validationWarning( 'name' );\n        } else if( !this.blocking ){\n            this.createList( name );\n        }\n    },\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates : {\n        /** the skeleton */\n        main : _.template([\n            '<div class=\"header flex-row no-flex\"></div>',\n            '<div class=\"middle flex-row flex-row-container\"></div>',\n            '<div class=\"footer flex-row no-flex\"></div>'\n        ].join('')),\n\n        /** the header (not including help text) */\n        header : _.template([\n            '<div class=\"main-help well clear\">',\n                '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n                '<div class=\"help-content\">',\n                    '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n                '</div>',\n            '</div>',\n            '<div class=\"alert alert-dismissable\">',\n                '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" ',\n                    'title=\"', _l( 'Close and show more help' ), '\" aria-hidden=\"true\">&times;</button>',\n                '<span class=\"alert-message\"></span>',\n            '</div>',\n        ].join('')),\n\n        /** the middle: element list */\n        middle : _.template([\n            '<div class=\"collection-elements-controls\">',\n                '<a class=\"reset\" href=\"javascript:void(0);\" ',\n                    'title=\"', _l( 'Undo all reordering and discards' ), '\">',\n                    _l( 'Start over' ),\n                '</a>',\n                '<a class=\"clear-selected\" href=\"javascript:void(0);\" ',\n                    'title=\"', _l( 'De-select all selected datasets' ), '\">',\n                    _l( 'Clear selected' ),\n                '</a>',\n            '</div>',\n            '<div class=\"collection-elements scroll-container flex-row\">',\n            '</div>'\n        ].join('')),\n\n        /** creation and cancel controls */\n        footer : _.template([\n            '<div class=\"attributes clear\">',\n                '<div class=\"clear\">',\n                    '<input class=\"collection-name form-control pull-right\" ',\n                        'placeholder=\"', _l( 'Enter a name for your new collection' ), '\" />',\n                    '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n                '</div>',\n            '</div>',\n\n            '<div class=\"actions clear vertically-spaced\">',\n                '<div class=\"other-options pull-left\">',\n                    '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                    '<div class=\"create-other btn-group dropup\">',\n                        '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                              _l( 'Create a different kind of collection' ),\n                              ' <span class=\"caret\"></span>',\n                        '</button>',\n                        '<ul class=\"dropdown-menu\" role=\"menu\">',\n                              '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n                              '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n                        '</ul>',\n                    '</div>',\n                '</div>',\n\n                '<div class=\"main-options pull-right\">',\n                    '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n                '</div>',\n            '</div>'\n        ].join('')),\n\n        /** help content */\n        helpContent : _.template([\n            '<p>', _l([\n                'Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ',\n                'workflows in order to have analyses done on each member of the entire group. This interface allows ',\n                'you to create a collection and re-order the final collection.'\n            ].join( '' )), '</p>',\n            '<ul>',\n                '<li>', _l([\n                    'Rename elements in the list by clicking on ',\n                    '<i data-target=\".collection-element .name\">the existing name</i>.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Discard elements from the final created list by clicking on the ',\n                    '<i data-target=\".collection-element .discard\">\"Discard\"</i> button.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ',\n                    '<i data-target=\".collection-element\">them</i> and you can then move those selected by dragging the ',\n                    'entire group. Deselect them by clicking them again or by clicking the ',\n                    'the <i data-target=\".clear-selected\">\"Clear selected\"</i> link.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".reset\">\"Start over\"</i> link to begin again as if you had just opened ',\n                    'the interface.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n                ].join( '' )), '</li>',\n            '</ul><br />',\n            '<p>', _l([\n                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n            ].join( '' )), '</p>'\n        ].join('')),\n\n        /** shown in list when all elements are discarded */\n        invalidElements : _.template([\n            _l( 'The following selections could not be included due to problems:' ),\n            '<ul><% _.each( problems, function( problem ){ %>',\n                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n            '<% }); %></ul>'\n        ].join('')),\n\n        /** shown in list when all elements are discarded */\n        noElementsLeft : _.template([\n            '<li class=\"no-elements-left-message\">',\n                _l( 'No elements left! ' ),\n                _l( 'Would you like to ' ), '<a class=\"reset\" href=\"javascript:void(0)\">', _l( 'start over' ), '</a>?',\n            '</li>'\n        ].join('')),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial : _.template([\n            '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                        '<% if( _.size( problems ) ){ %>',\n                            _l( 'The following selections could not be included due to problems' ), ':',\n                            '<ul><% _.each( problems, function( problem ){ %>',\n                                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n                            '<% }); %></ul>',\n                        '<% } else if( _.size( elements ) < 1 ){ %>',\n                            _l( 'No datasets were selected' ), '.',\n                        '<% } %>',\n                        '<br />',\n                        _l( 'At least one element is needed for the collection' ), '. ',\n                        _l( 'You may need to ' ),\n                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n                        _l( 'and reselect new elements' ), '.',\n                    '</span>',\n                '</div>',\n            '</div>',\n            '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                        // _l( 'Create a different kind of collection' ),\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('')),\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString : function(){ return 'ListCollectionCreator'; }\n});\n\n\n\n//=============================================================================\n/** Create a modal and load its body with the given CreatorClass creator type\n *  @returns {Deferred} resolved when creator has built a collection.\n */\nvar collectionCreatorModal = function _collectionCreatorModal( elements, options, CreatorClass ){\n\n    var deferred = jQuery.Deferred(),\n        modal = Galaxy.modal || ( new UI_MODAL.View() ),\n        creator;\n\n    options = _.defaults( options || {}, {\n        elements    : elements,\n        oncancel    : function(){\n            modal.hide();\n            deferred.reject( 'cancelled' );\n        },\n        oncreate    : function( creator, response ){\n            modal.hide();\n            deferred.resolve( response );\n        }\n    });\n\n    creator = new CreatorClass( options );\n    modal.show({\n        title   : options.title || _l( 'Create a collection' ),\n        body    : creator.$el,\n        width   : '80%',\n        height  : 'min-content',\n        closing_events: true\n    });\n    creator.render();\n    window._collectionCreator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n/** List collection flavor of collectionCreatorModal. */\nvar listCollectionCreatorModal = function _listCollectionCreatorModal( elements, options ){\n    options = options || {};\n    options.title = _l( 'Create a collection from a list of datasets' );\n    return collectionCreatorModal( elements, options, ListCollectionCreator );\n};\n\n\n//==============================================================================\n/** Use a modal to create a list collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createListCollection( contents ){\n    var elements = contents.toJSON(),\n        promise = listCollectionCreatorModal( elements, {\n            creationFn : function( elements, name ){\n                elements = elements.map( function( element ){\n                    return {\n                        id      : element.id,\n                        name    : element.name,\n                        //TODO: this allows for list:list even if the filter above does not - reconcile\n                        src     : ( element.history_content_type === 'dataset'? 'hda' : 'hdca' )\n                    };\n                });\n                return contents.createHDCA( elements, 'list', name );\n            }\n        });\n    return promise;\n}\n\n//==============================================================================\n    return {\n        DatasetCollectionElementView: DatasetCollectionElementView,\n        ListCollectionCreator       : ListCollectionCreator,\n\n        collectionCreatorModal      : collectionCreatorModal,\n        listCollectionCreatorModal  : listCollectionCreatorModal,\n        createListCollection        : createListCollection\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/list-collection-creator.js\n ** module id = 14\n ** module chunks = 3 4\n **/","define([\n    \"mvc/list/list-item\",\n    \"mvc/dataset/states\",\n    \"ui/fa-icon-button\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_ITEM, STATES, faIconButton, BASE_MVC, _l ){\n/* global Backbone */\n/*==============================================================================\nTODO:\n    straighten out state rendering and templates used\n    inaccessible/STATES.NOT_VIEWABLE is a special case\n    simplify button rendering\n\n==============================================================================*/\nvar _super = LIST_ITEM.ListItemView;\n/** @class Read only list view for either LDDAs, HDAs, or HDADCEs.\n *      Roughly, any DatasetInstance (and not a raw Dataset).\n */\nvar DatasetListItemView = _super.extend(\n/** @lends DatasetListItemView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger      : console,\n\n    className   : _super.prototype.className + \" dataset\",\n    //TODO:?? doesn't exactly match an hda's type_id\n    id          : function(){\n        return [ 'dataset', this.model.get( 'id' ) ].join( '-' );\n    },\n\n    /** Set up: instance vars, options, and event handlers */\n    initialize : function( attributes ){\n        if( attributes.logger ){ this.logger = this.model.logger = attributes.logger; }\n        this.log( this + '.initialize:', attributes );\n        _super.prototype.initialize.call( this, attributes );\n\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || '_blank';\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n\n        // re-rendering on any model changes\n        this.model.on( 'change', function( model, options ){\n            // if the model moved into the ready state and is expanded without details, fetch those details now\n            if( this.model.changedAttributes().state && this.model.inReadyState()\n            &&  this.expanded && !this.model.hasDetails() ){\n                // will render automatically (due to fetch -> change)\n                this.model.fetch();\n\n            } else {\n                this.render();\n            }\n        }, this );\n    },\n\n    // ......................................................................... expandable\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    // ......................................................................... removal\n    /** Remove this view's html from the DOM and remove all event listeners.\n     *  @param {Number or String} speed jq effect speed\n     *  @param {Function} callback      an optional function called when removal is done (scoped to this view)\n     */\n    remove : function( speed, callback ){\n        var view = this;\n        speed = speed || this.fxSpeed;\n        this.$el.fadeOut( speed, function(){\n            Backbone.View.prototype.remove.call( view );\n            if( callback ){ callback.call( view ); }\n        });\n    },\n\n    // ......................................................................... rendering\n    /* TODO:\n        dataset states are the issue primarily making dataset rendering complex\n            each state should have it's own way of displaying/set of details\n            often with different actions that can be applied\n        throw in deleted/purged/visible and things get complicated easily\n        I've considered (a couple of times) - creating a view for each state\n            - but recreating the view during an update...seems wrong\n    */\n    /** Render this HDA, set up ui.\n     *  @param {Number or String} speed jq fx speed\n     *  @returns {Object} this\n     */\n    render : function( speed ){\n        //HACK: hover exit doesn't seem to be called on prev. tooltips when RE-rendering - so: no tooltip hide\n        // handle that here by removing previous view's tooltips\n        //this.$el.find(\"[title]\").tooltip( \"destroy\" );\n        return _super.prototype.render.call( this, speed );\n    },\n\n    /** In this override, add the dataset state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        _super.prototype._swapNewRender.call( this, $newRender );\n        if( this.model.has( 'state' ) ){\n            this.$el.addClass( 'state-' + this.model.get( 'state' ) );\n        }\n        return this.$el;\n    },\n\n    // ................................................................................ titlebar\n    /** In this override, add the dataset display button. */\n    _renderPrimaryActions : function(){\n        // render just the display for read-only\n        return [ this._renderDisplayButton() ];\n    },\n\n    /** Render icon-button to display dataset data */\n    _renderDisplayButton : function(){\n//TODO:?? too complex - possibly move into template\n        // don't show display if not viewable or not accessible\n        var state = this.model.get( 'state' );\n        if( ( state === STATES.NOT_VIEWABLE )\n        ||  ( state === STATES.DISCARDED )\n        ||  ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var displayBtnData = {\n            target      : this.linkTarget,\n            classes     : 'display-btn'\n        };\n\n        // show a disabled display if the data's been purged\n        if( this.model.get( 'purged' ) ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'Cannot display datasets removed from disk' );\n\n        // disable if still uploading\n        } else if( state === STATES.UPLOAD ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'This dataset must finish uploading before it can be viewed' );\n\n        // disable if still new\n        } else if( state === STATES.NEW ){\n            displayBtnData.disabled = true;\n            displayBtnData.title = _l( 'This dataset is not yet viewable' );\n\n        } else {\n            displayBtnData.title = _l( 'View data' );\n\n            // default link for dataset\n            displayBtnData.href  = this.model.urls.display;\n\n            // add frame manager option onclick event\n            var self = this;\n            displayBtnData.onclick = function( ev ){\n                if (Galaxy.frame && Galaxy.frame.active) {\n                    // Add dataset to frames.\n                    Galaxy.frame.add_dataset(self.model.get('id'));\n                    ev.preventDefault();\n                }\n            };\n        }\n        displayBtnData.faIcon = 'fa-eye';\n        return faIconButton( displayBtnData );\n    },\n\n    // ......................................................................... rendering details\n    /** Render the enclosing div of the hda body and, if expanded, the html in the body\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDetails : function(){\n        //TODO: generalize to be allow different details for each state\n\n        // no access - render nothing but a message\n        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n            return $( this.templates.noAccess( this.model.toJSON(), this ) );\n        }\n\n        var $details = _super.prototype._renderDetails.call( this );\n        $details.find( '.actions .left' ).empty().append( this._renderSecondaryActions() );\n        $details.find( '.summary' ).html( this._renderSummary() )\n            .prepend( this._renderDetailMessages() );\n        $details.find( '.display-applications' ).html( this._renderDisplayApplications() );\n\n//TODO: double tap\n        this._setUpBehaviors( $details );\n        return $details;\n    },\n\n    /** Defer to the appropo summary rendering fn based on state */\n    _renderSummary : function(){\n        var json = this.model.toJSON(),\n            summaryRenderFn = this.templates.summaries[ json.state ];\n        summaryRenderFn = summaryRenderFn || this.templates.summaries.unknown;\n        return summaryRenderFn( json, this );\n    },\n\n    /** Render messages to be displayed only when the details are shown */\n    _renderDetailMessages : function(){\n        var view = this,\n            $warnings = $( '<div class=\"detail-messages\"></div>' ),\n            json = view.model.toJSON();\n//TODO:! unordered (map)\n        _.each( view.templates.detailMessages, function( templateFn ){\n            $warnings.append( $( templateFn( json, view ) ) );\n        });\n        return $warnings;\n    },\n\n    /** Render the external display application links */\n    _renderDisplayApplications : function(){\n        if( this.model.isDeletedOrPurged() ){ return ''; }\n        // render both old and new display apps using the same template\n        return [\n            this.templates.displayApplications( this.model.get( 'display_apps' ), this ),\n            this.templates.displayApplications( this.model.get( 'display_types' ), this )\n        ].join( '' );\n    },\n\n    // ......................................................................... secondary/details actions\n    /** A series of links/buttons for less commonly used actions: re-run, info, etc. */\n    _renderSecondaryActions : function(){\n        this.debug( '_renderSecondaryActions' );\n        switch( this.model.get( 'state' ) ){\n            case STATES.NOT_VIEWABLE:\n                return [];\n            case STATES.OK:\n            case STATES.FAILED_METADATA:\n            case STATES.ERROR:\n                return [ this._renderDownloadButton(), this._renderShowParamsButton() ];\n        }\n        return [ this._renderShowParamsButton() ];\n    },\n\n    /** Render icon-button to show the input and output (stdout/err) for the job that created this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderShowParamsButton : function(){\n        // gen. safe to show in all cases\n        return faIconButton({\n            title       : _l( 'View details' ),\n            classes     : 'params-btn',\n            href        : this.model.urls.show_params,\n            target      : this.linkTarget,\n            faIcon      : 'fa-info-circle'\n        });\n    },\n\n    /** Render icon-button/popupmenu to download the data (and/or the associated meta files (bai, etc.)) for this.\n     *  @returns {jQuery} rendered DOM\n     */\n    _renderDownloadButton : function(){\n//TODO: to (its own) template fn\n        // don't show anything if the data's been purged\n        if( this.model.get( 'purged' ) || !this.model.hasData() ){ return null; }\n\n        // return either: a popupmenu with links to download assoc. meta files (if there are meta files)\n        //  or a single download icon-button (if there are no meta files)\n        if( !_.isEmpty( this.model.get( 'meta_files' ) ) ){\n            return this._renderMetaFileDownloadButton();\n        }\n\n        return $([\n            '<a class=\"download-btn icon-btn\" href=\"', this.model.urls.download, '\" title=\"' + _l( 'Download' ) + '\">',\n                '<span class=\"fa fa-floppy-o\"></span>',\n            '</a>'\n        ].join( '' ));\n    },\n\n    /** Render the download button which opens a dropdown with links to download assoc. meta files (indeces, etc.) */\n    _renderMetaFileDownloadButton : function(){\n        var urls = this.model.urls;\n        return $([\n            '<div class=\"metafile-dropdown dropdown\">',\n                '<a class=\"download-btn icon-btn\" href=\"javascript:void(0)\" data-toggle=\"dropdown\"',\n                    ' title=\"' + _l( 'Download' ) + '\">',\n                    '<span class=\"fa fa-floppy-o\"></span>',\n                '</a>',\n                '<ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">',\n                    '<li><a href=\"' + urls.download + '\">', _l( 'Download dataset' ), '</a></li>',\n                    _.map( this.model.get( 'meta_files' ), function( meta_file ){\n                        return [\n                            '<li><a href=\"', urls.meta_download + meta_file.file_type, '\">',\n                                _l( 'Download' ), ' ', meta_file.file_type,\n                            '</a></li>'\n                        ].join( '' );\n                    }).join( '\\n' ),\n                '</ul>',\n            '</div>'\n        ].join( '\\n' ));\n    },\n\n    // ......................................................................... misc\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .display-btn'    : function( ev ){ this.trigger( 'display', this, ev ); },\n        'click .params-btn'     : function( ev ){ this.trigger( 'params', this, ev ); },\n        'click .download-btn'   : function( ev ){ this.trigger( 'download', this, ev ); }\n    }),\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        failed_metadata : BASE_MVC.wrapTemplate([\n            // failed metadata is rendered as a warning on an otherwise ok dataset view\n            '<% if( model.state === \"failed_metadata\" ){ %>',\n                '<div class=\"warningmessagesmall\">',\n                    _l( 'An error occurred setting the metadata for this dataset' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        error : BASE_MVC.wrapTemplate([\n            // error during index fetch - show error on dataset\n            '<% if( model.error ){ %>',\n                '<div class=\"errormessagesmall\">',\n                    _l( 'There was an error getting the data for this dataset' ), ': <%- model.error %>',\n                '</div>',\n            '<% } %>'\n        ]),\n        purged : BASE_MVC.wrapTemplate([\n            '<% if( model.purged ){ %>',\n                '<div class=\"purged-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted and removed from disk' ),\n                '</div>',\n            '<% } %>'\n        ]),\n        deleted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.deleted && !model.purged ){ %>',\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted' ),\n                '</div>',\n            '<% } %>'\n        ])\n\n        //NOTE: hidden warning is only needed for HDAs\n    });\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            '<div class=\"summary\"></div>',\n\n            '<div class=\"actions clear\">',\n                '<div class=\"left\"></div>',\n                '<div class=\"right\"></div>',\n            '</div>',\n\n            // do not display tags, annotation, display apps, or peek when deleted\n            '<% if( !dataset.deleted && !dataset.purged ){ %>',\n                '<div class=\"tags-display\"></div>',\n                '<div class=\"annotation-display\"></div>',\n\n                '<div class=\"display-applications\"></div>',\n\n                '<% if( dataset.peek ){ %>',\n                    '<pre class=\"dataset-peek\"><%= dataset.peek %></pre>',\n                '<% } %>',\n            '<% } %>',\n        '</div>'\n    ], 'dataset' );\n\n    var noAccessTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            '<div class=\"summary\">',\n                _l( 'You do not have permission to view this dataset' ),\n            '</div>',\n        '</div>'\n    ], 'dataset' );\n\n//TODO: still toooooooooooooo complex - rework\n    var summaryTemplates = {};\n    summaryTemplates[ STATES.OK ] = summaryTemplates[ STATES.FAILED_METADATA ] = BASE_MVC.wrapTemplate([\n        '<% if( dataset.misc_blurb ){ %>',\n            '<div class=\"blurb\">',\n                '<span class=\"value\"><%- dataset.misc_blurb %></span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.file_ext ){ %>',\n            '<div class=\"datatype\">',\n                '<label class=\"prompt\">', _l( 'format' ), '</label>',\n                '<span class=\"value\"><%- dataset.file_ext %></span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.metadata_dbkey ){ %>',\n            '<div class=\"dbkey\">',\n                '<label class=\"prompt\">', _l( 'database' ), '</label>',\n                '<span class=\"value\">',\n                    '<%- dataset.metadata_dbkey %>',\n                '</span>',\n            '</div>',\n        '<% } %>',\n\n        '<% if( dataset.misc_info ){ %>',\n            '<div class=\"info\">',\n                '<span class=\"value\"><%- dataset.misc_info %></span>',\n            '</div>',\n        '<% } %>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.NEW ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This is a new dataset and not all of its data are available yet' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.NOT_VIEWABLE ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'You do not have permission to view this dataset' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.DISCARDED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'The job creating this dataset was cancelled before completion' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.QUEUED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is waiting to run' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.RUNNING ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is currently running' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.UPLOAD ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This dataset is currently uploading' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.SETTING_METADATA ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'Metadata is being auto-detected' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.PAUSED ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'This job is paused. Use the \"Resume Paused Jobs\" in the history menu to resume' ), '</div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.ERROR ] = BASE_MVC.wrapTemplate([\n        '<% if( !dataset.purged ){ %>',\n            '<div><%- dataset.misc_blurb %></div>',\n        '<% } %>',\n        '<span class=\"help-text\">', _l( 'An error occurred with this dataset' ), ':</span>',\n        '<div class=\"job-error-text\"><%- dataset.misc_info %></div>'\n    ], 'dataset' );\n    summaryTemplates[ STATES.EMPTY ] = BASE_MVC.wrapTemplate([\n        '<div>', _l( 'No data' ), ': <i><%- dataset.misc_blurb %></i></div>'\n    ], 'dataset' );\n    summaryTemplates.unknown = BASE_MVC.wrapTemplate([\n        '<div>Error: unknown dataset state: \"<%- dataset.state %>\"</div>'\n    ], 'dataset' );\n\n    // messages to be displayed only within the details section ('below the fold')\n    var detailMessageTemplates = {\n        resubmitted : BASE_MVC.wrapTemplate([\n            // deleted not purged\n            '<% if( model.resubmitted ){ %>',\n                '<div class=\"resubmitted-msg infomessagesmall\">',\n                    _l( 'The job creating this dataset has been resubmitted' ),\n                '</div>',\n            '<% } %>'\n        ])\n    };\n\n    // this is applied to both old and new style display apps\n    var displayApplicationsTemplate = BASE_MVC.wrapTemplate([\n        '<% _.each( apps, function( app ){ %>',\n            '<div class=\"display-application\">',\n                '<span class=\"display-application-location\"><%- app.label %></span> ',\n                '<span class=\"display-application-links\">',\n                    '<% _.each( app.links, function( link ){ %>',\n                        '<a target=\"<%= link.target %>\" href=\"<%= link.href %>\">',\n                            '<% print( _l( link.text ) ); %>',\n                        '</a> ',\n                    '<% }); %>',\n                '</span>',\n            '</div>',\n        '<% }); %>'\n    ], 'apps' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings    : warnings,\n        details     : detailsTemplate,\n        noAccess    : noAccessTemplate,\n        summaries   : summaryTemplates,\n        detailMessages      : detailMessageTemplates,\n        displayApplications : displayApplicationsTemplate\n    });\n}());\n\n\n// ============================================================================\n    return {\n        DatasetListItemView : DatasetListItemView\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/dataset/dataset-li.js\n ** module id = 15\n ** module chunks = 3 4\n **/","define([\n    \"mvc/collection/collection-model\",\n    \"mvc/history/history-content-model\",\n    \"utils/localization\"\n], function( DC_MODEL, HISTORY_CONTENT, _l ){\n/*==============================================================================\n\nModels for DatasetCollections contained within a history.\n\nTODO:\n    these might be compactable to one class if some duplication with\n    collection-model is used.\n\n==============================================================================*/\nvar hcontentMixin = HISTORY_CONTENT.HistoryContentMixin,\n    ListDC = DC_MODEL.ListDatasetCollection,\n    PairDC = DC_MODEL.PairDatasetCollection,\n    ListPairedDC = DC_MODEL.ListPairedDatasetCollection;\n\n//==============================================================================\n/** Override to post to contents route w/o id. */\nfunction buildHDCASave( _super ){\n    return function _save( attributes, options ){\n        if( this.isNew() ){\n            options = options || {};\n            options.url = this.urlRoot + this.get( 'history_id' ) + '/contents';\n            attributes = attributes || {};\n            attributes.type = 'dataset_collection';\n        }\n        return _super.call( this, attributes, options );\n    };\n}\n\n\n//==============================================================================\n/** @class Backbone model for List Dataset Collection within a History.\n */\nvar HistoryListDatasetCollection = ListDC.extend( hcontentMixin ).extend(\n/** @lends HistoryListDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( ListDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'list',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        ListDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( ListDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryListDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for Pair Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryPairDatasetCollection = PairDC.extend( hcontentMixin ).extend(\n/** @lends HistoryPairDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( PairDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'paired',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        PairDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( PairDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryPairDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n/** @class Backbone model for List of Pairs Dataset Collection within a History.\n *  @constructs\n */\nvar HistoryListPairedDatasetCollection = ListPairedDC.extend( hcontentMixin ).extend(\n/** @lends HistoryListPairedDatasetCollection.prototype */{\n\n    defaults : _.extend( _.clone( ListPairedDC.prototype.defaults ), {\n        history_content_type: 'dataset_collection',\n        collection_type     : 'list:paired',\n        model_class         : 'HistoryDatasetCollectionAssociation'\n    }),\n\n    initialize : function( model, options ){\n        ListPairedDC.prototype.initialize.call( this, model, options );\n        hcontentMixin.initialize.call( this, model, options );\n    },\n\n    /** Override to post to contents route w/o id. */\n    save : buildHDCASave( ListPairedDC.prototype.save ),\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryListPairedDatasetCollection(', this.get( 'name' ), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        HistoryListDatasetCollection        : HistoryListDatasetCollection,\n        HistoryPairDatasetCollection        : HistoryPairDatasetCollection,\n        HistoryListPairedDatasetCollection  : HistoryListPairedDatasetCollection\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hdca-model.js\n ** module id = 16\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, BASE_MVC, _l ){\n//==============================================================================\n/** How the type_id attribute is built for the history's mixed contents collection */\nvar typeIdStr = function _typeIdStr( type, id ){\n    return [ type, id ].join( '-' );\n};\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n//TODO:?? into true Backbone.Model?\n\n    /** default attributes for a model */\n    defaults : {\n        /** parent (containing) history */\n        history_id          : null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid                 : null,\n        /** whether the user wants the content shown (visible) */\n        visible             : true\n    },\n\n    // ........................................................................ mixed content element\n//TODO: there's got to be a way to move this into HistoryContents - if we can do that, this class might not be needed\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Build a new id (type_id) that prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute : 'type_id',\n\n    /** override constructor to build type_id and insert into original attributes */\n    constructor : function( attrs, options ){\n        attrs.type_id = typeIdStr( attrs.history_content_type, attrs.id );\n        this.debug( 'HistoryContentMixin.constructor:', attrs.type_id );\n        Backbone.Model.apply( this, arguments );\n    },\n\n    /** object level fn for building the type_id string */\n    _typeIdStr : function(){\n        return typeIdStr( this.get( 'history_content_type' ), this.get( 'id' ) );\n    },\n\n    /** add listener to re-create type_id when the id changes */\n    initialize : function( attrs, options ){\n        this.on( 'change:id', this._createTypeId );\n    },\n\n    /** set the type_id in the model attributes */\n    _createTypeId : function(){\n        this.set( 'type_id', this._typeIdStr() );\n    },\n\n    /** override because backbone tests boolean( idAttribute ), but it's not an empty string even for new models\n     *  due to our use of type_id.\n     */\n    isNew : function(){\n        return !this.get( 'id' );\n    },\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden : function(){\n        return !this.get( 'visible' );\n    },\n\n    /** based on show_deleted, show_hidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} show_deleted are we showing deleted hdas?\n     *  @param {Boolean} show_hidden are we showing hidden hdas?\n     */\n    isVisible : function( show_deleted, show_hidden ){\n//TODO:?? Another unfortunate name collision\n        var isVisible = true;\n        if( ( !show_deleted )\n        &&  ( this.get( 'deleted' ) || this.get( 'purged' ) ) ){\n            isVisible = false;\n        }\n        if( ( !show_hidden )\n        &&  ( !this.get( 'visible' ) ) ){\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n//TODO: global\n//TODO: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: ( window.Galaxy? Galaxy.options.root : '/' ) + 'api/histories/',\n\n    /** full url spec. for this content */\n    url : function(){\n        var url = this.urlRoot + this.get( 'history_id' ) + '/contents/'\n             + this.get('history_content_type') + 's/' + this.get( 'id' );\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide : function( options ){\n        if( !this.get( 'visible' ) ){ return jQuery.when(); }\n        return this.save( { visible: false }, options );\n    },\n    /** save this content as visible */\n    unhide : function( options ){\n        if( this.get( 'visible' ) ){ return jQuery.when(); }\n        return this.save( { visible: true }, options );\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'HistoryContent(' + nameAndId + ')';\n    }\n};\n\n\n//==============================================================================\n//TODO: needed?\n/** @class (Concrete/non-mixin) base model for content items.\n */\nvar HistoryContent = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend( HistoryContentMixin );\n\n\n//==============================================================================\n    return {\n        typeIdStr           : typeIdStr,\n        HistoryContentMixin : HistoryContentMixin,\n        HistoryContent      : HistoryContent\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/history-content-model.js\n ** module id = 17\n ** module chunks = 3 4\n **/","define([\n    \"mvc/history/history-content-model\",\n    \"mvc/history/hda-model\",\n    \"mvc/history/hdca-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_CONTENT, HDA_MODEL, HDCA_MODEL, BASE_MVC, _l ){\n//==============================================================================\n/** @class Backbone collection for history content.\n *      NOTE: history content seems like a dataset collection, but differs in that it is mixed:\n *          each element can be either an HDA (dataset) or a DatasetCollection and co-exist on\n *          the same level.\n *      Dataset collections on the other hand are not mixed and (so far) can only contain either\n *          HDAs or child dataset collections on one level.\n *      This is why this does not inherit from any of the DatasetCollections (currently).\n */\nvar HistoryContents = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends HistoryContents.prototype */{\n//TODO:?? may want to inherit from some MixedModelCollection\n//TODO:?? also consider inheriting from a 'DatasetList'\n//TODO: can we decorate the mixed models using the model fn below (instead of having them build their own type_id)?\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** since history content is a mix, override model fn into a factory, creating based on history_content_type */\n    model : function( attrs, options ) {\n//TODO: can we move the type_id stuff here?\n        //attrs.type_id = typeIdStr( attrs );\n\n        if( attrs.history_content_type === \"dataset\" ) {\n            return new HDA_MODEL.HistoryDatasetAssociation( attrs, options );\n\n        } else if( attrs.history_content_type === \"dataset_collection\" ) {\n            switch( attrs.collection_type ){\n                case 'list':\n                    return new HDCA_MODEL.HistoryListDatasetCollection( attrs, options );\n                case 'paired':\n                    return new HDCA_MODEL.HistoryPairDatasetCollection( attrs, options );\n                case 'list:paired':\n                    return new HDCA_MODEL.HistoryListPairedDatasetCollection( attrs, options );\n            }\n            // This is a hack inside a hack:\n            // Raise a plain object with validationError to fake a model.validationError\n            // (since we don't have a model to use validate with)\n            // (the outer hack being the mixed content/model function in this collection)\n            return { validationError : 'Unknown collection_type: ' + attrs.history_content_type };\n        }\n        return { validationError : 'Unknown history_content_type: ' + attrs.history_content_type };\n    },\n\n    /** Set up.\n     *  @see Backbone.Collection#initialize\n     */\n    initialize : function( models, options ){\n        options = options || {};\n//TODO: could probably use the contents.history_id instead\n        this.historyId = options.historyId;\n        //this._setUpListeners();\n\n        // backbonejs uses collection.model.prototype.idAttribute to determine if a model is *already* in a collection\n        //  and either merged or replaced. In this case, our 'model' is a function so we need to add idAttribute\n        //  manually here - if we don't, contents will not merge but be replaced/swapped.\n        this.model.prototype.idAttribute = 'type_id';\n\n        this.on( 'all', function(){\n            this.debug( this + '.event:', arguments );\n        });\n    },\n\n    /** root api url */\n    urlRoot : galaxy_config.root + 'api/histories',\n    /** complete api url */\n    url : function(){\n        return this.urlRoot + '/' + this.historyId + '/contents';\n    },\n\n    // ........................................................................ common queries\n    /** Get the ids of every item in this collection\n     *  @returns array of encoded ids\n     */\n    ids : function(){\n//TODO: is this still useful since type_id\n        return this.map( function( item ){ return item.get('id'); });\n    },\n\n    /** Get contents that are not ready\n     *  @returns array of content models\n     */\n    notReady : function(){\n        return this.filter( function( content ){\n            return !content.inReadyState();\n        });\n    },\n\n    /** Get the id of every model in this collection not in a 'ready' state (running).\n     *  @returns an array of model ids\n     *  @see HistoryDatasetAssociation#inReadyState\n     */\n    running : function(){\n        var idList = [];\n        this.each( function( item ){\n            var isRunning = !item.inReadyState();\n            if( isRunning ){\n//TODO: is this still correct since type_id\n                idList.push( item.get( 'id' ) );\n            }\n        });\n        return idList;\n    },\n\n    /** Get the model with the given hid\n     *  @param {Int} hid the hid to search for\n     *  @returns {HistoryDatasetAssociation} the model with the given hid or undefined if not found\n     */\n    getByHid : function( hid ){\n        return _.first( this.filter( function( content ){ return content.get( 'hid' ) === hid; }) );\n    },\n\n    //TODO:?? this may belong in the containing view\n    /** Get every 'shown' model in this collection based on show_deleted/hidden\n     *  @param {Boolean} show_deleted are we showing deleted content?\n     *  @param {Boolean} show_hidden are we showing hidden content?\n     *  @returns array of content models\n     *  @see HistoryDatasetAssociation#isVisible\n     */\n    getVisible : function( show_deleted, show_hidden, filters ){\n        filters = filters || [];\n        //this.debug( 'filters:', filters );\n        // always filter by show deleted/hidden first\n        this.debug( 'checking isVisible' );\n        var filteredHdas = new HistoryContents( this.filter( function( item ){\n            return item.isVisible( show_deleted, show_hidden );\n        }));\n\n        _.each( filters, function( filterFn ){\n            if( !_.isFunction( filterFn ) ){ return; }\n            filteredHdas = new HistoryContents( filteredHdas.filter( filterFn ) );\n        });\n        return filteredHdas;\n    },\n\n    /** return a new contents collection of only hidden items */\n    hidden : function(){\n        function filterFn( c ){ return c.hidden(); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** return a new contents collection of only hidden items */\n    deleted : function(){\n        function filterFn( c ){ return c.get( 'deleted' ); }\n        return new HistoryContents( this.filter( filterFn ) );\n    },\n\n    /** return true if any contents don't have details */\n    haveDetails : function(){\n        return this.all( function( content ){ return content.hasDetails(); });\n    },\n\n    // ........................................................................ ajax\n    /** fetch detailed model data for all contents in this collection */\n    fetchAllDetails : function( options ){\n        options = options || {};\n        var detailsFlag = { details: 'all' };\n        options.data = ( options.data )?( _.extend( options.data, detailsFlag ) ):( detailsFlag );\n        return this.fetch( options );\n    },\n\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue : function( ajaxFn, options ){\n        var deferred = jQuery.Deferred(),\n            startingLength = this.length,\n            responses = [];\n\n        if( !startingLength ){\n            deferred.resolve([]);\n            return deferred;\n        }\n\n        // use reverse order (stylistic choice)\n        var ajaxFns = this.chain().reverse().map( function( content, i ){\n            return function(){\n                var xhr = ajaxFn.call( content, options );\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done( function( response ){\n                    deferred.notify({ curr: i, total: startingLength, response: response, model: content });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always( function( response ){\n                    responses.push( response );\n                    if( ajaxFns.length ){\n                        ajaxFns.shift()();\n                    } else {\n                        deferred.resolve( responses );\n                    }\n                });\n            };\n        }).value();\n        // start the queue\n        ajaxFns.shift()();\n\n        return deferred;\n    },\n\n    isCopyable : function( contentsJSON ){\n        var copyableModelClasses = [\n            'HistoryDatasetAssociation',\n            'HistoryDatasetCollectionAssociation'\n        ];\n        return ( ( _.isObject( contentsJSON ) && contentsJSON.id )\n              && ( _.contains( copyableModelClasses, contentsJSON.model_class ) ) );\n    },\n\n    /** copy an existing, accessible hda into this collection */\n    copy : function( json ){\n        var id, type, contentType;\n        if( _.isString( json ) ){\n            id = json;\n            contentType = 'hda';\n            type = 'dataset';\n        } else {\n            id = json.id;\n            contentType = ({\n                'HistoryDatasetAssociation' : 'hda',\n                'LibraryDatasetDatasetAssociation' : 'ldda',\n                'HistoryDatasetCollectionAssociation' : 'hdca'\n            })[ json.model_class ] || 'hda';\n            type = ( contentType === 'hdca'? 'dataset_collection' : 'dataset' );\n        }\n        var collection = this,\n            xhr = jQuery.post( this.url(), {\n                content : id,\n                source  : contentType,\n                type    : type\n            })\n            .done( function( response ){\n                collection.add([ response ]);\n            })\n            .fail( function( error, status, message ){\n                collection.trigger( 'error', collection, xhr, {},\n                    'Error copying contents', { type: type, id: id, source: contentType });\n            });\n        return xhr;\n    },\n\n    // ........................................................................ sorting/filtering\n    /** return a new collection of contents whose attributes contain the substring matchesWhat */\n    matches : function( matchesWhat ){\n        return this.filter( function( content ){\n            return content.matches( matchesWhat );\n        });\n    },\n\n    // ........................................................................ misc\n    /** override to ensure type id is set */\n    set : function( models, options ){\n        models = _.isArray( models )? models : [ models ];\n        _.each( models, function( model ){\n            if( !model.type_id || !model.get || !model.get( 'type_id' ) ){\n                model.type_id = HISTORY_CONTENT.typeIdStr( model.history_content_type, model.id );\n            }\n        });\n        Backbone.Collection.prototype.set.call( this, models, options );\n    },\n\n    /** */\n    createHDCA : function( elementIdentifiers, collectionType, name, options ){\n        //precondition: elementIdentifiers is an array of plain js objects\n        //  in the proper form to create the collectionType\n        var contents = this,\n            typeToModel = {\n                list    : HDCA_MODEL.HistoryListDatasetCollection,\n                paired  : HDCA_MODEL.HistoryPairDatasetCollection\n            },\n            hdca = new (typeToModel[ collectionType ])({\n                history_id          : this.historyId,\n                name                : name,\n                // should probably be able to just send in a bunch of json here and restruct per class\n                element_identifiers : elementIdentifiers\n            });\n        // do I even need to use new above, can I just pass the attrs here\n        return hdca.save()\n            .done( function( response ){\n                contents.add( hdca );\n            })\n            .fail( function( xhr, status, message ){\n                contents.trigger( 'error', xhr, status, message );\n            });\n    },\n\n\n    /** In this override, copy the historyId to the clone */\n    clone : function(){\n        var clone = Backbone.Collection.prototype.clone.call( this );\n        clone.historyId = this.historyId;\n        return clone;\n    },\n\n    /** debugging */\n    print : function(){\n        var contents = this;\n        contents.each( function( c ){\n            contents.debug( c );\n            if( c.elements ){\n                contents.debug( '\\t elements:', c.elements );\n            }\n        });\n    },\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'HistoryContents(', [ this.historyId, this.length ].join(), ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        HistoryContents : HistoryContents\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/history-contents.js\n ** module id = 18\n ** module chunks = 3 4\n **/","define([\n    'mvc/base-mvc',\n    'utils/localization'\n], function( BASE_MVC, _l ){\n\n//==============================================================================\n/** A view which, when first rendered, shows only summary data/attributes, but\n *      can be expanded to show further details (and optionally fetch those\n *      details from the server).\n */\nvar ExpandableView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n//TODO: Although the reasoning behind them is different, this shares a lot with HiddenUntilActivated above: combine them\n    //PRECONDITION: model must have method hasDetails\n    //PRECONDITION: subclasses must have templates.el and templates.details\n\n    initialize : function( attributes ){\n        /** are the details of this view expanded/shown or not? */\n        this.expanded   = attributes.expanded || false;\n        this.log( '\\t expanded:', this.expanded );\n        this.fxSpeed = attributes.fxSpeed !== undefined? attributes.fxSpeed : this.fxSpeed;\n    },\n\n    // ........................................................................ render main\n    /** jq fx speed */\n    fxSpeed : 'fast',\n\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render : function( speed ){\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors( $newRender );\n        this._queueNewRender( $newRender, speed );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     *      If the view is already expanded, build the details as well.\n     */\n    _buildNewRender : function(){\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = $( this.templates.el( this.model.toJSON(), this ) );\n        if( this.expanded ){\n            this.$details( $newRender ).replaceWith( this._renderDetails().show() );\n        }\n        return $newRender;\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender : function( $newRender, speed ) {\n        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n        var view = this;\n\n        $( view ).queue( 'fx', [\n            function( next ){ this.$el.fadeOut( speed, next ); },\n            function( next ){\n                view._swapNewRender( $newRender );\n                next();\n            },\n            function( next ){ this.$el.fadeIn( speed, next ); },\n            function( next ){\n                this.trigger( 'rendered', view );\n                next();\n            }\n        ]);\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender : function( $newRender ){\n        return this.$el.empty()\n            .attr( 'class', _.isFunction( this.className )? this.className(): this.className )\n            .append( $newRender.children() );\n    },\n\n    /** set up js behaviors, event handlers for elements within the given container\n     *  @param {jQuery} $container jq object that contains the elements to process (defaults to this.$el)\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        // set up canned behavior on children (bootstrap, popupmenus, editable_text, etc.)\n        //make_popup_menus( $where );\n        $where.find( '[title]' ).tooltip({ placement : 'bottom' });\n    },\n\n    // ......................................................................... details\n    /** shortcut to details DOM (as jQ) */\n    $details : function( $where ){\n        $where = $where || this.$el;\n        return $where.find( '> .details' );\n    },\n\n    /** build the DOM for the details and set up behaviors on it */\n    _renderDetails : function(){\n        var $newDetails = $( this.templates.details( this.model.toJSON(), this ) );\n        this._setUpBehaviors( $newDetails );\n        return $newDetails;\n    },\n\n    // ......................................................................... expansion/details\n    /** Show or hide the details\n     *  @param {Boolean} expand if true, expand; if false, collapse\n     */\n    toggleExpanded : function( expand ){\n        expand = ( expand === undefined )?( !this.expanded ):( expand );\n        if( expand ){\n            this.expand();\n        } else {\n            this.collapse();\n        }\n        return this;\n    },\n\n    /** Render and show the full, detailed body of this view including extra data and controls.\n     *      note: if the model does not have detailed data, fetch that data before showing the body\n     *  @fires expanded when a body has been expanded\n     */\n    expand : function(){\n        var view = this;\n        return view._fetchModelDetails().always( function(){\n                view._expand();\n            });\n    },\n\n    /** Check for model details and, if none, fetch them.\n     *  @returns {jQuery.promise} the model.fetch.xhr if details are being fetched, an empty promise if not\n     */\n    _fetchModelDetails : function(){\n        if( !this.model.hasDetails() ){\n            return this.model.fetch();\n        }\n        return jQuery.when();\n    },\n\n    /** Inner fn called when expand (public) has fetched the details */\n    _expand : function(){\n        var view = this,\n            $newDetails = view._renderDetails();\n        view.$details().replaceWith( $newDetails );\n        // needs to be set after the above or the slide will not show\n        view.expanded = true;\n        view.$details().slideDown({\n            duration : view.fxSpeed,\n            step: function(){\n                view.trigger( 'expanding', view );\n            },\n            complete: function(){\n                view.trigger( 'expanded', view );\n            }\n        });\n    },\n\n    /** Hide the body/details of an HDA.\n     *  @fires collapsed when a body has been collapsed\n     */\n    collapse : function(){\n        this.debug( this + '(ExpandableView).collapse' );\n        var view = this;\n        view.expanded = false;\n        this.$details().slideUp({\n            duration : view.fxSpeed,\n            step: function(){\n                view.trigger( 'collapsing', view );\n            },\n            complete: function(){\n                view.trigger( 'collapsed', view );\n            }\n        });\n    }\n\n});\n\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *      Inherits from Expandable, Selectable, Draggable.\n *  The DOM contains warnings, a title bar, and a series of primary action controls.\n *      Primary actions are meant to be easily accessible item functions (such as delete)\n *      that are rendered in the title bar.\n *\n *  Details are rendered when the user clicks the title bar or presses enter/space when\n *      the title bar is in focus.\n *\n *  Designed as a base class for history panel contents - but usable elsewhere (I hope).\n */\nvar ListItemView = ExpandableView.extend(\n        BASE_MVC.mixin( BASE_MVC.SelectableViewMixin, BASE_MVC.DraggableViewMixin, {\n\n//TODO: that's a little contradictory\n    tagName     : 'div',\n    className   : 'list-item',\n\n    /** Set up the base class and all mixins */\n    initialize : function( attributes ){\n        ExpandableView.prototype.initialize.call( this, attributes );\n        BASE_MVC.SelectableViewMixin.initialize.call( this, attributes );\n        BASE_MVC.DraggableViewMixin.initialize.call( this, attributes );\n        this._setUpListeners();\n    },\n\n    /** event listeners */\n    _setUpListeners : function(){\n        // hide the primary actions in the title bar when selectable and narrow\n        this.on( 'selectable', function( isSelectable ){\n            if( isSelectable ){\n                this.$( '.primary-actions' ).hide();\n            } else {\n                this.$( '.primary-actions' ).show();\n            }\n        }, this );\n        //this.on( 'all', function( event ){\n        //    this.log( event );\n        //}, this );\n        return this;\n    },\n\n    // ........................................................................ rendering\n    /** In this override, call methods to build warnings, titlebar and primary actions */\n    _buildNewRender : function(){\n        var $newRender = ExpandableView.prototype._buildNewRender.call( this );\n        $newRender.children( '.warnings' ).replaceWith( this._renderWarnings() );\n        $newRender.children( '.title-bar' ).replaceWith( this._renderTitleBar() );\n        $newRender.children( '.primary-actions' ).append( this._renderPrimaryActions() );\n        $newRender.find( '> .title-bar .subtitle' ).replaceWith( this._renderSubtitle() );\n        return $newRender;\n    },\n\n    /** In this override, render the selector controls and set up dragging before the swap */\n    _swapNewRender : function( $newRender ){\n        ExpandableView.prototype._swapNewRender.call( this, $newRender );\n        if( this.selectable ){ this.showSelector( 0 ); }\n        if( this.draggable ){ this.draggableOn(); }\n        return this.$el;\n    },\n\n    /** Render any warnings the item may need to show (e.g. \"I'm deleted\") */\n    _renderWarnings : function(){\n        var view = this,\n            $warnings = $( '<div class=\"warnings\"></div>' ),\n            json = view.model.toJSON();\n//TODO:! unordered (map)\n        _.each( view.templates.warnings, function( templateFn ){\n            $warnings.append( $( templateFn( json, view ) ) );\n        });\n        return $warnings;\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderTitleBar : function(){\n        return $( this.templates.titleBar( this.model.toJSON(), this ) );\n    },\n\n    /** Return an array of jQ objects containing common/easily-accessible item controls */\n    _renderPrimaryActions : function(){\n        // override this\n        return [];\n    },\n\n    /** Render the title bar (the main/exposed SUMMARY dom element) */\n    _renderSubtitle : function(){\n        return $( this.templates.subtitle( this.model.toJSON(), this ) );\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events : {\n        // expand the body when the title is clicked or when in focus and space or enter is pressed\n        'click .title-bar'      : '_clickTitleBar',\n        'keydown .title-bar'    : '_keyDownTitleBar',\n\n        // dragging - don't work, originalEvent === null\n        //'dragstart .dataset-title-bar'  : 'dragStartHandler',\n        //'dragend .dataset-title-bar'    : 'dragEndHandler'\n\n        'click .selector'       : 'toggleSelect'\n    },\n\n    /** expand when the title bar is clicked */\n    _clickTitleBar : function( event ){\n        event.stopPropagation();\n        if( event.altKey ){\n            this.toggleSelect( event );\n            if( !this.selectable ){\n                this.showSelector();\n            }\n        } else {\n            this.toggleExpanded();\n        }\n    },\n\n    /** expand when the title bar is in focus and enter or space is pressed */\n    _keyDownTitleBar : function( event ){\n        // bail (with propagation) if keydown and not space or enter\n        var KEYCODE_SPACE = 32, KEYCODE_RETURN = 13;\n        if( event && ( event.type === 'keydown' )\n        &&( event.keyCode === KEYCODE_SPACE || event.keyCode === KEYCODE_RETURN ) ){\n            this.toggleExpanded();\n            event.stopPropagation();\n            return false;\n        }\n        return true;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'ListItemView(' + modelString + ')';\n    }\n}));\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var elTemplato = BASE_MVC.wrapTemplate([\n        '<div class=\"list-element\">',\n            // errors, messages, etc.\n            '<div class=\"warnings\"></div>',\n\n            // multi-select checkbox\n            '<div class=\"selector\">',\n                '<span class=\"fa fa-2x fa-square-o\"></span>',\n            '</div>',\n            // space for title bar buttons - gen. floated to the right\n            '<div class=\"primary-actions\"></div>',\n            '<div class=\"title-bar\"></div>',\n\n            // expandable area for more details\n            '<div class=\"details\"></div>',\n        '</div>'\n    ]);\n\n    var warnings = {};\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding a tabindex here allows focusing the title bar and the use of keydown to expand the dataset display\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n//TODO: prob. belongs in dataset-list-item\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                '<span class=\"name\"><%- element.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'element' );\n\n    var subtitleTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"subtitle\"></div>'\n    ]);\n\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        // override this\n        '<div class=\"details\"></div>'\n    ]);\n\n    return {\n        el          : elTemplato,\n        warnings    : warnings,\n        titleBar    : titleBarTemplate,\n        subtitle    : subtitleTemplate,\n        details     : detailsTemplate\n    };\n}());\n\n\n//==============================================================================\n/** A view that is displayed in some larger list/grid/collection.\n *  *AND* can display some sub-list of it's own when expanded (e.g. dataset collections).\n *  This list will 'foldout' when the item is expanded depending on this.foldoutStyle:\n *      If 'foldout': will expand vertically to show the nested list\n *      If 'drilldown': will overlay the parent list\n *\n *  Inherits from ListItemView.\n *\n *  _renderDetails does the work of creating this.details: a sub-view that shows the nested list\n */\nvar FoldoutListItemView = ListItemView.extend({\n\n    /** If 'foldout': show the sub-panel inside the expanded item\n     *  If 'drilldown': only fire events and handle by pub-sub\n     *      (allow the panel containing this item to attach it, hide itself, etc.)\n     */\n    foldoutStyle        : 'foldout',\n    /** Panel view class to instantiate for the sub-panel */\n    foldoutPanelClass   : null,\n\n    /** override to:\n     *      add attributes foldoutStyle and foldoutPanelClass for config poly\n     *      disrespect attributes.expanded if drilldown\n     */\n    initialize : function( attributes ){\n//TODO: hackish\n        if( this.foldoutStyle === 'drilldown' ){ this.expanded = false; }\n        this.foldoutStyle = attributes.foldoutStyle || this.foldoutStyle;\n        this.foldoutPanelClass = attributes.foldoutPanelClass || this.foldoutPanelClass;\n\n        ListItemView.prototype.initialize.call( this, attributes );\n        this.foldout = this._createFoldoutPanel();\n    },\n\n//TODO:?? override to exclude foldout scope?\n    //$ : function( selector ){\n    //    var $found = ListItemView.prototype.$.call( this, selector );\n    //    return $found;\n    //},\n\n    /** in this override, attach the foldout panel when rendering details */\n    _renderDetails : function(){\n//TODO: hackish\n        if( this.foldoutStyle === 'drilldown' ){ return $(); }\n        var $newDetails = ListItemView.prototype._renderDetails.call( this );\n        return this._attachFoldout( this.foldout, $newDetails );\n    },\n\n    /** In this override, handle collection expansion. */\n    _createFoldoutPanel : function(){\n        var model = this.model;\n        var FoldoutClass = this._getFoldoutPanelClass( model ),\n            options = this._getFoldoutPanelOptions( model ),\n            foldout = new FoldoutClass( _.extend( options, {\n                model           : model\n            }));\n        return foldout;\n    },\n\n    /** Stub to return proper foldout panel class */\n    _getFoldoutPanelClass : function(){\n        // override\n        return this.foldoutPanelClass;\n    },\n\n    /** Stub to return proper foldout panel options */\n    _getFoldoutPanelOptions : function(){\n        return {\n            // propagate foldout style down\n            foldoutStyle : this.foldoutStyle,\n            fxSpeed      : this.fxSpeed\n        };\n    },\n\n    /** Render the foldout panel inside the view, hiding controls */\n    _attachFoldout : function( foldout, $whereTo ){\n        $whereTo = $whereTo || this.$( '> .details' );\n        this.foldout = foldout.render( 0 );\n//TODO: hack\n        foldout.$( '> .controls' ).hide();\n        return $whereTo.append( foldout.$el );\n    },\n\n    /** In this override, branch on foldoutStyle to show expanded */\n    expand : function(){\n        var view = this;\n        return view._fetchModelDetails()\n            .always(function(){\n                if( view.foldoutStyle === 'foldout' ){\n                    view._expand();\n                } else if( view.foldoutStyle === 'drilldown' ){\n                    view._expandByDrilldown();\n                }\n            });\n    },\n\n    /** For drilldown, set up close handler and fire expanded:drilldown\n     *      containing views can listen to this and handle other things\n     *      (like hiding themselves) by listening for expanded/collapsed:drilldown\n     */\n    _expandByDrilldown : function(){\n        var view = this;\n        // attachment and rendering done by listener\n        view.foldout.on( 'close', function(){\n            view.trigger( 'collapsed:drilldown', view, view.foldout );\n        });\n        view.trigger( 'expanded:drilldown', view, view.foldout );\n    }\n\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nFoldoutListItemView.prototype.templates = (function(){\n\n//TODO:?? unnecessary?\n    // use element identifier\n    var detailsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"details\">',\n            // override with more info (that goes above the panel)\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, ListItemView.prototype.templates, {\n        details : detailsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        ExpandableView                  : ExpandableView,\n        ListItemView                    : ListItemView,\n        FoldoutListItemView             : FoldoutListItemView\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/list/list-item.js\n ** module id = 19\n ** module chunks = 3 4\n **/","// dependencies\ndefine([], function() {\n\n/** Masthead **/\nvar GalaxyMasthead = Backbone.View.extend({\n    // base element\n    el_masthead: '#everything',\n    \n    // options\n    options : null,\n    \n    // background\n    $background: null,\n    \n    // list\n    list: [],\n    \n    // initialize\n    initialize : function(options) {\n        // update options\n        this.options = options;\n    \n        // HACK: due to body events defined in galaxy.panels.js\n        $(\"body\").off();\n    \n        // define this element\n        this.setElement($(this._template(options)));\n        \n        // append to masthead\n        $(this.el_masthead).append($(this.el));\n        \n        // assign background\n        this.$background = $(this.el).find('#masthead-background');\n        \n        // loop through unload functions if the user attempts to unload the page\n        var self = this;\n        $(window).on('beforeunload', function() {\n            var text = \"\";\n            for (key in self.list) {\n                if (self.list[key].options.onunload) {\n                    var q = self.list[key].options.onunload();\n                    if (q) text += q + \" \";\n                }\n            }\n            if (text != \"\") {\n                return text;\n            }\n        });\n    },\n\n    // configure events\n    events: {\n        'click'     : '_click',\n        'mousedown' : function(e) { e.preventDefault() }\n    },\n\n    // adds a new item to the masthead\n    append : function(item) {\n        return this._add(item, true);\n    },\n    \n    // adds a new item to the masthead\n    prepend : function(item) {\n        return this._add(item, false);\n    },\n    \n    // activate\n    highlight: function(id) {\n        var current = $(this.el).find('#' + id + '> li');\n        if (current) {\n            current.addClass('active');\n        }\n    },\n    \n    // adds a new item to the masthead\n    _add : function(item, append) {\n        var $loc = $(this.el).find('#' + item.location);\n        if ($loc){\n            // create frame for new item\n            var $current = $(item.el);\n            \n            // configure class in order to mark new items\n            $current.addClass('masthead-item');\n            \n            // append to masthead\n            if (append) {\n                $loc.append($current);\n            } else {\n                $loc.prepend($current);\n            }\n            \n            // add to list\n            this.list.push(item);\n        }\n        \n        // location not found\n        return null;\n    },\n\n    // handle click event\n    _click: function(e) {\n        // close all popups\n        var $all = $(this.el).find('.popup');\n        if ($all) {\n            $all.hide();\n        }\n        \n        // open current item\n        var $current = $(e.target).closest('.masthead-item').find('.popup');\n        if ($(e.target).hasClass('head')) {\n            $current.show();\n            this.$background.show();\n        } else {\n            this.$background.hide();\n        }\n    },\n    \n    /*\n        HTML TEMPLATES\n    */\n    \n    // fill template\n    _template: function(options) {\n        var brand_text = options.brand ? (\"/ \" + options.brand) : \"\" ;\n        return  '<div><div id=\"masthead\" class=\"navbar navbar-fixed-top navbar-inverse\">' +\n                    '<div style=\"position: relative; right: -50%; float: left;\">' +\n                        '<div id=\"navbar\" style=\"display: block; position: relative; right: 50%;\"></div>' +\n                    '</div>' +\n                   '<div class=\"navbar-brand\">' +\n                        '<a href=\"' + options.logo_url + '\">' +\n                            '<img style=\"margin-left: 0.35em;\" border=\"0\" src=\"' + galaxy_config.root + 'static/images/galaxyIcon_noText.png\">' +\n                            '<span id=\"brand\"> Galaxy ' + brand_text + '</span>' +\n                        '</a>' +\n                    '</div>' +\n                    '<div class=\"quota-meter-container\"></div>' +\n                    '<div id=\"iconbar\" class=\"iconbar\"></div>' +\n                '</div>' +\n                '<div id=\"masthead-background\" style=\"display: none; position: absolute; top: 33px; width: 100%; height: 100%; z-index: 1010\"></div>' +\n                '</div>';\n    }\n});\n\n/** Masthead icon **/\nvar GalaxyMastheadIcon = Backbone.View.extend({\n    // icon options\n    options:{\n        id              : '',\n        icon            : 'fa-cog',\n        tooltip         : '',\n        with_number     : false,\n        onclick         : function() { alert ('clicked') },\n        onunload        : null,\n        visible         : true\n    },\n    \n    // location identifier for masthead class\n    location: 'iconbar',\n    \n    // initialize\n    initialize: function (options){\n        // read in defaults\n        if (options)\n            this.options = _.defaults(options, this.options);\n        \n        // add template for icon\n        this.setElement($(this._template(this.options)));\n        \n        // configure icon\n        var self = this;\n        $(this.el).find('.icon').tooltip({title: this.options.tooltip, placement: 'bottom'})\n                                .on('mouseup', self.options.onclick);\n        \n        // visiblity\n        if (!this.options.visible)\n            this.hide();\n    },\n    \n    // show\n    show: function(){\n        $(this.el).css({visibility : 'visible'});\n    },\n        \n    // show\n    hide: function(){\n        $(this.el).css({visibility : 'hidden'});\n    },\n    \n    // switch icon\n    icon: function (new_icon){\n        // update icon class\n        $(this.el).find('.icon').removeClass(this.options.icon)\n                                .addClass(new_icon);\n                                \n        // update icon\n        this.options.icon = new_icon;\n    },\n    \n    // toggle\n    toggle: function(){\n        $(this.el).addClass('toggle');\n    },\n    \n    // untoggle\n    untoggle: function(){\n        $(this.el).removeClass('toggle');\n    },\n    \n    // set/get number\n    number: function(new_number){\n        $(this.el).find('.number').text(new_number);\n    },\n    \n    // fill template icon\n    _template: function (options){\n        var tmpl =  '<div id=\"' + options.id + '\" class=\"symbol\">' +\n                        '<div class=\"icon fa fa-2x ' + options.icon + '\"></div>';\n        if (options.with_number)\n            tmpl+=      '<div class=\"number\"></div>';\n        tmpl +=     '</div>';\n        \n        // return template\n        return tmpl;\n    }\n});\n\n/** Masthead tab **/\nvar GalaxyMastheadTab = Backbone.View.extend({\n    // main options\n    options:{\n        id              : '',\n        title           : '',\n        target          : '_parent',\n        content         : '',\n        type            : 'url',\n        scratchbook     : false,\n        onunload        : null,\n        visible         : true,\n        disabled        : false,\n        title_attribute : ''\n    },\n    \n    // location\n    location: 'navbar',\n    \n    // optional sub menu\n    $menu: null,\n    \n    // events\n    events:{\n        'click .head' : '_head'\n    },\n    \n    // initialize\n    initialize: function ( options ){\n        // read in defaults\n        if ( options ){\n            this.options = _.defaults( options, this.options );\n        }\n   \n        // update url\n        if ( this.options.content !== undefined && this.options.content.indexOf( '//' ) === -1 ){\n            this.options.content = galaxy_config.root + this.options.content;\n        } \n        \n        // add template for tab\n        this.setElement( $( this._template( this.options ) ) );\n        \n        // disable menu items that are not available to anonymous user\n        // also show title to explain why they are disabled\n        if ( this.options.disabled ){\n            $( this.el ).find( '.root' ).addClass( 'disabled' );\n            this._attachPopover();\n        }\n\n        // visiblity\n        if ( !this.options.visible ){\n            this.hide();\n        }\n    },\n    \n    // show\n    show: function(){\n        $(this.el).css({visibility : 'visible'});\n    },\n        \n    // show\n    hide: function(){\n        $(this.el).css({visibility : 'hidden'});\n    },\n    \n    // add menu item\n    add: function (options){\n        // menu option defaults\n        var menuOptions = {\n            title       : 'Title',\n            content     : '',\n            type        : 'url',\n            target      : '_parent',\n            scratchbook : false,\n            divider     : false\n        }\n    \n        // read in defaults\n        if (options)\n            menuOptions = _.defaults(options, menuOptions);\n        \n        // update url\n        if (menuOptions.content && menuOptions.content.indexOf('//') === -1)\n            menuOptions.content = galaxy_config.root + menuOptions.content;\n        \n        // check if submenu element is available\n        if (!this.$menu){\n            // insert submenu element into root\n            $(this.el).find('.root').append(this._templateMenu());\n            \n            // show caret\n            $(this.el).find('.symbol').addClass('caret');\n            \n            // update element link\n            this.$menu = $(this.el).find('.popup');\n        }\n        \n        // create\n        var $item = $(this._templateMenuItem(menuOptions));\n        \n        // append menu\n        this.$menu.append($item);\n        \n        // add events\n        var self = this;\n        $item.on('click', function(e){\n            // prevent default\n            e.preventDefault();\n        \n            // no modifications if new tab is requested\n            if (self.options.target === '_blank')\n                return true;\n            \n            // load into frame\n            Galaxy.frame.add(options);\n        });\n        \n        // append divider\n        if (menuOptions.divider)\n            this.$menu.append($(this._templateDivider()));\n    },\n    \n    // show menu on header click\n    _head: function(e){\n        // prevent default\n        e.preventDefault();\n        \n        if (this.options.disabled){\n            return // prevent link following if menu item is disabled\n        }\n\n        // check for menu options\n        if (!this.$menu) {\n            Galaxy.frame.add(this.options); \n        }\n    },\n\n    _attachPopover : function(){\n        var $popover_element = $(this.el).find('.head');\n        $popover_element.popover({\n            html: true,\n            content: 'Please <a href=\"' + galaxy_config.root + 'user/login?use_panels=True\">log in</a> or <a href=\"' + galaxy_config.root + 'user/create?use_panels=True\">register</a> to use this feature.',\n            placement: 'bottom'\n        }).on('shown.bs.popover', function() { // hooking on bootstrap event to automatically hide popovers after delay\n            setTimeout(function() {\n                $popover_element.popover('hide');\n            }, 5000);\n        });\n     },\n\n    // fill template header\n    _templateMenuItem: function (options){\n        return '<li><a href=\"' + options.content + '\" target=\"' + options.target + '\">' + options.title + '</a></li>';\n    },\n    \n    // fill template header\n    _templateMenu: function (){\n        return '<ul class=\"popup dropdown-menu\"></ul>';\n    },\n    \n    _templateDivider: function(){\n        return '<li class=\"divider\"></li>';\n    },\n    \n    // fill template\n    _template: function (options){\n        // start template\n        var tmpl =  '<ul id=\"' + options.id + '\" class=\"nav navbar-nav\" border=\"0\" cellspacing=\"0\">' +\n                        '<li class=\"root dropdown\" style=\"\">' +\n                            '<a class=\"head dropdown-toggle\" data-toggle=\"dropdown\" target=\"' + options.target + '\" href=\"' + options.content + '\" title=\"' + options.title_attribute + '\">' +\n                                options.title + '<b class=\"symbol\"></b>' +\n                            '</a>' +\n                        '</li>' +\n                    '</ul>';\n        \n        // return template\n        return tmpl;\n    }\n});\n\n// return\nreturn {\n    GalaxyMasthead: GalaxyMasthead,\n    GalaxyMastheadTab: GalaxyMastheadTab,\n    GalaxyMastheadIcon: GalaxyMastheadIcon\n};\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/galaxy.masthead.js\n ** module id = 23\n ** module chunks = 3 4\n **/","define([\n    //jquery\n    //backbone\n], function(){\n// =============================================================================\n/**\n * view for a popup menu\n */\nvar PopupMenu = Backbone.View.extend({\n//TODO: maybe better as singleton off the Galaxy obj\n    /** Cache the desired button element and options, set up the button click handler\n     *  NOTE: attaches this view as HTML/jQ data on the button for later use.\n     */\n    initialize: function( $button, options ){\n        // default settings\n        this.$button = $button;\n        if( !this.$button.size() ){\n            this.$button = $( '<div/>' );\n        }\n        this.options = options || [];\n\n        // set up button click -> open menu behavior\n        var menu = this;\n        this.$button.click( function( event ){\n            // if there's already a menu open, remove it\n            $( '.popmenu-wrapper' ).remove();\n            menu._renderAndShow( event );\n            return false;\n        });\n    },\n\n    // render the menu, append to the page body at the click position, and set up the 'click-away' handlers, show\n    _renderAndShow: function( clickEvent ){\n        this.render();\n        this.$el.appendTo( 'body' ).css( this._getShownPosition( clickEvent )).show();\n        this._setUpCloseBehavior();\n    },\n\n    // render the menu\n    // this menu doesn't attach itself to the DOM ( see _renderAndShow )\n    render: function(){\n        // render the menu body absolute and hidden, fill with template\n        this.$el.addClass( 'popmenu-wrapper' ).hide()\n            .css({ position : 'absolute' })\n            .html( this.template( this.$button.attr( 'id' ), this.options ));\n\n        // set up behavior on each link/anchor elem\n        if( this.options.length ){\n            var menu = this;\n            //precondition: there should be one option per li\n            this.$el.find( 'li' ).each( function( i, li ){\n                var option = menu.options[i];\n\n                // if the option has 'func', call that function when the anchor is clicked\n                if( option.func ){\n                    $( this ).children( 'a.popupmenu-option' ).click( function( event ){\n                        option.func.call( menu, event, option );\n                        // We must preventDefault otherwise clicking \"cancel\"\n                        // on a purge or something still navigates and causes\n                        // the action.\n                        event.preventDefault();\n                        // bubble up so that an option click will call the close behavior\n                    });\n                }\n            });\n        }\n        return this;\n    },\n\n    template : function( id, options ){\n        return [\n            '<ul id=\"', id, '-menu\" class=\"dropdown-menu\">', this._templateOptions( options ), '</ul>'\n        ].join( '' );\n    },\n\n    _templateOptions : function( options ){\n        if( !options.length ){\n            return '<li>(no options)</li>';\n        }\n        return _.map( options, function( option ){\n            if( option.divider ){\n                return '<li class=\"divider\"></li>';\n            } else if( option.header ){\n                return [ '<li class=\"head\"><a href=\"javascript:void(0);\">', option.html, '</a></li>' ].join( '' );\n            }\n            var href   = option.href || 'javascript:void(0);',\n                target = ( option.target  )?( ' target=\"' + option.target + '\"' ):( '' ),\n                check  = ( option.checked )?( '<span class=\"fa fa-check\"></span>' ):( '' );\n            return [\n                '<li><a class=\"popupmenu-option\" href=\"', href, '\"', target, '>',\n                    check, option.html,\n                '</a></li>'\n            ].join( '' );\n        }).join( '' );\n    },\n\n    // get the absolute position/offset for the menu\n    _getShownPosition : function( clickEvent ){\n\n        // display menu horiz. centered on click...\n        var menuWidth = this.$el.width();\n        var x = clickEvent.pageX - menuWidth / 2 ;\n\n        // adjust to handle horiz. scroll and window dimensions ( draw entirely on visible screen area )\n        x = Math.min( x, $( document ).scrollLeft() + $( window ).width() - menuWidth - 5 );\n        x = Math.max( x, $( document ).scrollLeft() + 5 );\n        return {\n            top: clickEvent.pageY,\n            left: x\n        };\n    },\n\n    // bind an event handler to all available frames so that when anything is clicked\n    // the menu is removed from the DOM and the event handler unbinds itself\n    _setUpCloseBehavior: function(){\n        var menu = this;\n//TODO: alternately: focus hack, blocking overlay, jquery.blockui\n\n        // function to close popup and unbind itself\n        function closePopup( event ){\n            $( document ).off( 'click.close_popup' );\n            if( window.parent !== window ){\n                try {\n                    $( window.parent.document ).off( \"click.close_popup\" );\n                } catch( err ){}\n            } else {\n                try {\n                    $( 'iframe#galaxy_main' ).contents().off( \"click.close_popup\" );\n                } catch( err ){}\n            }\n            menu.remove();\n        }\n\n        $( 'html' ).one( \"click.close_popup\", closePopup );\n        if( window.parent !== window ){\n            try {\n                $( window.parent.document ).find( 'html' ).one( \"click.close_popup\", closePopup );\n            } catch( err ){}\n        } else {\n            try {\n                $( 'iframe#galaxy_main' ).contents().one( \"click.close_popup\", closePopup );\n            } catch( err ){}\n        }\n    },\n\n    // add a menu option/item at the given index\n    addItem: function( item, index ){\n        // append to end if no index\n        index = ( index >= 0 ) ? index : this.options.length;\n        this.options.splice( index, 0, item );\n        return this;\n    },\n\n    // remove a menu option/item at the given index\n    removeItem: function( index ){\n        if( index >=0 ){\n            this.options.splice( index, 1 );\n        }\n        return this;\n    },\n\n    // search for a menu option by its html\n    findIndexByHtml: function( html ){\n        for( var i = 0; i < this.options.length; i++ ){\n            if( _.has( this.options[i], 'html' ) && ( this.options[i].html === html )){\n                return i;\n            }\n        }\n        return null;\n    },\n\n    // search for a menu option by its html\n    findItemByHtml: function( html ){\n        return this.options[( this.findIndexByHtml( html ))];\n    },\n\n    // string representation\n    toString: function(){\n        return 'PopupMenu';\n    }\n});\n/** shortcut to new for when you don't need to preserve the ref */\nPopupMenu.create = function _create( $button, options ){\n    return new PopupMenu( $button, options );\n};\n\n// -----------------------------------------------------------------------------\n// the following class functions are bridges from the original make_popupmenu and make_popup_menus\n// to the newer backbone.js PopupMenu\n\n/** Create a PopupMenu from simple map initial_options activated by clicking button_element.\n *      Converts initial_options to object array used by PopupMenu.\n *  @param {jQuery|DOMElement} button_element element which, when clicked, activates menu\n *  @param {Object} initial_options map of key -> values, where\n *      key is option text, value is fn to call when option is clicked\n *  @returns {PopupMenu} the PopupMenu created\n */\nPopupMenu.make_popupmenu = function( button_element, initial_options ){\n    var convertedOptions = [];\n    _.each( initial_options, function( optionVal, optionKey ){\n        var newOption = { html: optionKey };\n\n        // keys with null values indicate: header\n        if( optionVal === null ){ // !optionVal? (null only?)\n            newOption.header = true;\n\n        // keys with function values indicate: a menu option\n        } else if( jQuery.type( optionVal ) === 'function' ){\n            newOption.func = optionVal;\n        }\n        //TODO:?? any other special optionVals?\n        // there was no divider option originally\n        convertedOptions.push( newOption );\n    });\n    return new PopupMenu( $( button_element ), convertedOptions );\n};\n\n/** Find all anchors in $parent (using selector) and covert anchors into a PopupMenu options map.\n *  @param {jQuery} $parent the element that contains the links to convert to options\n *  @param {String} selector jq selector string to find links\n *  @returns {Object[]} the options array to initialize a PopupMenu\n */\n//TODO: lose parent and selector, pass in array of links, use map to return options\nPopupMenu.convertLinksToOptions = function( $parent, selector ){\n    $parent = $( $parent );\n    selector = selector || 'a';\n    var options = [];\n    $parent.find( selector ).each( function( elem, i ){\n        var option = {}, $link = $( elem );\n\n        // convert link text to the option text (html) and the href into the option func\n        option.html = $link.text();\n        if( $link.attr( 'href' ) ){\n            var linkHref    = $link.attr( 'href' ),\n                linkTarget  = $link.attr( 'target' ),\n                confirmText = $link.attr( 'confirm' );\n\n            option.func = function(){\n                // if there's a \"confirm\" attribute, throw up a confirmation dialog, and\n                //  if the user cancels - do nothing\n                if( ( confirmText ) && ( !confirm( confirmText ) ) ){ return; }\n\n                // if there's no confirm attribute, or the user accepted the confirm dialog:\n                switch( linkTarget ){\n                    // relocate the center panel\n                    case '_parent':\n                        window.parent.location = linkHref;\n                        break;\n\n                    // relocate the entire window\n                    case '_top':\n                        window.top.location = linkHref;\n                        break;\n\n                    // relocate this panel\n                    default:\n                        window.location = linkHref;\n                }\n            };\n        }\n        options.push( option );\n    });\n    return options;\n};\n\n/** Create a single popupmenu from existing DOM button and anchor elements\n *  @param {jQuery} $buttonElement the element that when clicked will open the menu\n *  @param {jQuery} $menuElement the element that contains the anchors to convert into a menu\n *  @param {String} menuElementLinkSelector jq selector string used to find anchors to be made into menu options\n *  @returns {PopupMenu} the PopupMenu (Backbone View) that can render, control the menu\n */\nPopupMenu.fromExistingDom = function( $buttonElement, $menuElement, menuElementLinkSelector ){\n    $buttonElement = $( $buttonElement );\n    $menuElement = $( $menuElement );\n    var options = PopupMenu.convertLinksToOptions( $menuElement, menuElementLinkSelector );\n    // we're done with the menu (having converted it to an options map)\n    $menuElement.remove();\n    return new PopupMenu( $buttonElement, options );\n};\n\n/** Create all popupmenus within a document or a more specific element\n *  @param {DOMElement} parent the DOM element in which to search for popupmenus to build (defaults to document)\n *  @param {String} menuSelector jq selector string to find popupmenu menu elements (defaults to \"div[popupmenu]\")\n *  @param {Function} buttonSelectorBuildFn the function to build the jq button selector.\n *      Will be passed $menuElement, parent.\n *      (Defaults to return '#' + $menuElement.attr( 'popupmenu' ); )\n *  @returns {PopupMenu[]} array of popupmenus created\n */\nPopupMenu.make_popup_menus = function( parent, menuSelector, buttonSelectorBuildFn ){\n    parent = parent || document;\n    // orig. Glx popupmenu menus have a (non-std) attribute 'popupmenu'\n    //  which contains the id of the button that activates the menu\n    menuSelector = menuSelector || 'div[popupmenu]';\n    // default to (orig. Glx) matching button to menu by using the popupmenu attr of the menu as the id of the button\n    buttonSelectorBuildFn = buttonSelectorBuildFn || function( $menuElement, parent ){\n        return '#' + $menuElement.attr( 'popupmenu' );\n    };\n\n    // aggregate and return all PopupMenus\n    var popupMenusCreated = [];\n    $( parent ).find( menuSelector ).each( function(){\n        var $menuElement    = $( this ),\n            $buttonElement  = $( parent ).find( buttonSelectorBuildFn( $menuElement, parent ) );\n        popupMenusCreated.push( PopupMenu.fromDom( $buttonElement, $menuElement ) );\n        $buttonElement.addClass( 'popup' );\n    });\n    return popupMenusCreated;\n};\n\n\n// =============================================================================\n    return PopupMenu;\n});\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/ui/popup-menu.js\n ** module id = 24\n ** module chunks = 3 4\n **/","define([\n], function(){\n//==============================================================================\nfunction addLogging( obj, namespace ){\n    var addTo = ( obj.prototype !== undefined )?( obj.prototype ):( obj );\n    if( namespace !== undefined ){\n        addTo._logNamespace = namespace;\n    }\n\n    [ 'debug', 'info', 'warn', 'error', 'metric' ].forEach( function( logFn ){\n        addTo[ logFn ] = function(){\n            if( !this.logger ){ return undefined; }\n            if( this.logger.emit ){\n                return this.logger.emit( logFn, this._logNamespace, arguments );\n            }\n            if( this.logger[ logFn ] ){\n//TODO:! there has to be a way to get the lineno/file into this\n// http://stackoverflow.com/questions/13815640/a-proper-wrapper-for-console-log-with-correct-line-number\n// http://www.paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/\n                return this.logger[ logFn ].apply( this.logger, arguments );\n            }\n            return undefined;\n        };\n    });\n    return obj;\n}\n\n//==============================================================================\nreturn addLogging;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/utils/add-logging.js\n ** module id = 25\n ** module chunks = 3 4 6\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( baseMVC, _l ){\n// =============================================================================\n/** A view on any model that has a 'annotation' attribute\n */\nvar AnnotationEditor = Backbone.View\n        .extend( baseMVC.LoggableMixin )\n        .extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n\n    tagName     : 'div',\n    className   : 'annotation-display',\n\n    /** Set up listeners, parse options */\n    initialize : function( options ){\n        options = options || {};\n        this.tooltipConfig = options.tooltipConfig || { placement: 'bottom' };\n        //console.debug( this, options );\n        // only listen to the model only for changes to annotations\n        this.listenTo( this.model, 'change:annotation', function(){\n            this.render();\n        });\n        this.hiddenUntilActivated( options.$activator, options );\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render : function(){\n        var view = this;\n        this.$el.html( this._template() );\n        this.$el.find( \"[title]\" ).tooltip( this.tooltipConfig );\n\n        //TODO: handle empties better\n        this.$annotation().make_text_editable({\n            use_textarea: true,\n            on_finish: function( newAnnotation ){\n                view.$annotation().text( newAnnotation );\n                view.model.save({ annotation: newAnnotation }, { silent: true })\n                    .fail( function(){\n                        view.$annotation().text( view.model.previous( 'annotation' ) );\n                    });\n            }\n        });\n        return this;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _template : function(){\n        var annotation = this.model.get( 'annotation' );\n        //if( !annotation ){\n        //    //annotation = [ '<em class=\"annotation-empty\">', _l( 'Click to add an annotation' ), '</em>' ].join( '' );\n        //    annotation = [ '<em class=\"annotation-empty\"></em>' ].join( '' );\n        //}\n        return [\n            //TODO: make prompt optional\n            '<label class=\"prompt\">', _l( 'Annotation' ), '</label>',\n            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n            '<div class=\"annotation\" title=\"', _l( 'Edit annotation' ), '\">',\n                _.escape( annotation ),\n            '</div>'\n        ].join( '' );\n    },\n\n    /** @returns {jQuery} the main element for this view */\n    $annotation : function(){\n        return this.$el.find( '.annotation' );\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove : function(){\n        this.$annotation.off();\n        this.stopListening( this.model );\n        Backbone.View.prototype.remove.call( this );\n    },\n\n    /** string rep */\n    toString : function(){ return [ 'AnnotationEditor(', this.model + '', ')' ].join(''); }\n});\n// =============================================================================\nreturn {\n    AnnotationEditor : AnnotationEditor\n};\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/annotations.js\n ** module id = 26\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/dataset/dataset-li\",\n    \"mvc/tags\",\n    \"mvc/annotations\",\n    \"ui/fa-icon-button\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, DATASET_LI, TAGS, ANNOTATIONS, faIconButton, BASE_MVC, _l ){\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Editing view for DatasetAssociation.\n */\nvar DatasetListItemEdit = _super.extend(\n/** @lends DatasetListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up: options */\n    initialize  : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n//TODO: shouldn't this err if false?\n        this.hasUser = attributes.hasUser;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        //TODO: move to HiddenUntilActivatedViewMixin\n        /** should the tags editor be shown or hidden initially? */\n        this.tagsEditorShown        = attributes.tagsEditorShown || false;\n        /** should the tags editor be shown or hidden initially? */\n        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n    },\n\n    // ......................................................................... titlebar actions\n    /** In this override, add the other two primary actions: edit and delete */\n    _renderPrimaryActions : function(){\n        var actions = _super.prototype._renderPrimaryActions.call( this );\n        if( this.model.get( 'state' ) === STATES.NOT_VIEWABLE ){\n            return actions;\n        }\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call( this ).concat([\n            this._renderEditButton(),\n            this._renderDeleteButton()\n        ]);\n    },\n\n//TODO: move titleButtons into state renderers, remove state checks in the buttons\n\n    /** Render icon-button to edit the attributes (format, permissions, etc.) this dataset. */\n    _renderEditButton : function(){\n        // don't show edit while uploading, in-accessible\n        // DO show if in error (ala previous history panel)\n        if( ( this.model.get( 'state' ) === STATES.DISCARDED )\n        ||  ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var purged = this.model.get( 'purged' ),\n            deleted = this.model.get( 'deleted' ),\n            editBtnData = {\n                title       : _l( 'Edit attributes' ),\n                href        : this.model.urls.edit,\n                target      : this.linkTarget,\n                faIcon      : 'fa-pencil',\n                classes     : 'edit-btn'\n            };\n\n        // disable if purged or deleted and explain why in the tooltip\n        if( deleted || purged ){\n            editBtnData.disabled = true;\n            if( purged ){\n                editBtnData.title = _l( 'Cannot edit attributes of datasets removed from disk' );\n            } else if( deleted ){\n                editBtnData.title = _l( 'Undelete dataset to edit attributes' );\n            }\n\n        // disable if still uploading or new\n        } else if( _.contains( [ STATES.UPLOAD, STATES.NEW ], this.model.get( 'state' ) ) ){\n            editBtnData.disabled = true;\n            editBtnData.title = _l( 'This dataset is not yet editable' );\n        }\n        return faIconButton( editBtnData );\n    },\n\n    /** Render icon-button to delete this hda. */\n    _renderDeleteButton : function(){\n        // don't show delete if...\n        if( ( !this.model.get( 'accessible' ) ) ){\n            return null;\n        }\n\n        var self = this,\n            deletedAlready = this.model.isDeletedOrPurged();\n        return faIconButton({\n                title       : !deletedAlready? _l( 'Delete' ) : _l( 'Dataset is already deleted' ),\n                disabled    : deletedAlready,\n                faIcon      : 'fa-times',\n                classes     : 'delete-btn',\n                onclick     : function() {\n                    // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                    self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n                    self.model[ 'delete' ]();\n                }\n        });\n    },\n\n    // ......................................................................... details\n    /** In this override, add tags and annotations controls, make the ? dbkey a link to editing page */\n    _renderDetails : function(){\n        //TODO: generalize to be allow different details for each state\n        var $details = _super.prototype._renderDetails.call( this ),\n            state = this.model.get( 'state' );\n\n        if( !this.model.isDeletedOrPurged() && _.contains([ STATES.OK, STATES.FAILED_METADATA ], state ) ){\n            this._renderTags( $details );\n            this._renderAnnotation( $details );\n            this._makeDbkeyEditLink( $details );\n        }\n\n//TODO: TRIPLE tap, ugh.\n        this._setUpBehaviors( $details );\n        return $details;\n    },\n\n    /** Add less commonly used actions in the details section based on state */\n    _renderSecondaryActions : function(){\n        var actions = _super.prototype._renderSecondaryActions.call( this );\n        switch( this.model.get( 'state' ) ){\n            case STATES.UPLOAD:\n            case STATES.NEW:\n            case STATES.NOT_VIEWABLE:\n                return actions;\n            case STATES.ERROR:\n                // error button comes first\n                actions.unshift( this._renderErrButton() );\n                return actions.concat([ this._renderRerunButton() ]);\n            case STATES.OK:\n            case STATES.FAILED_METADATA:\n                return actions.concat([ this._renderRerunButton(), this._renderVisualizationsButton() ]);\n        }\n        return actions.concat([ this._renderRerunButton() ]);\n    },\n\n    /** Render icon-button to report an error on this dataset to the galaxy admin. */\n    _renderErrButton : function(){\n        return faIconButton({\n            title       : _l( 'View or report this error' ),\n            href        : this.model.urls.report_error,\n            classes     : 'report-error-btn',\n            target      : this.linkTarget,\n            faIcon      : 'fa-bug'\n        });\n    },\n\n    /** Render icon-button to re-run the job that created this dataset. */\n    _renderRerunButton : function(){\n        var creating_job = this.model.get('creating_job');\n        if (this.model.get('rerunnable')){\n            return faIconButton({\n                title       : _l( 'Run this job again' ),\n                href        : this.model.urls.rerun,\n                classes     : 'rerun-btn',\n                target      : this.linkTarget,\n                faIcon      : 'fa-refresh',\n                onclick     : function(ev) {\n                    ev.preventDefault();\n                    // create webpack split point in order to load the tool form async\n                    // TODO: split not working (tool loads fine)\n                    require([ 'mvc/tools/tools-form'], function( ToolsForm ){\n                        var form = new ToolsForm.View({'job_id' : creating_job});\n                        form.deferred.execute(function(){\n                            Galaxy.app && Galaxy.app.display(form.$el);\n                        });\n                    });\n                }\n            });\n        }\n    },\n\n    /** Render an icon-button or popupmenu of links based on the applicable visualizations */\n    _renderVisualizationsButton : function(){\n        //TODO: someday - lazyload visualizations\n        var visualizations = this.model.get( 'visualizations' );\n        if( ( this.model.isDeletedOrPurged() )\n        ||  ( !this.hasUser )\n        ||  ( !this.model.hasData() )\n        ||  ( _.isEmpty( visualizations ) ) ){\n            return null;\n        }\n        if( !_.isObject( visualizations[0] ) ){\n            this.warn( 'Visualizations have been switched off' );\n            return null;\n        }\n\n        var $visualizations = $( this.templates.visualizations( visualizations, this ) );\n        //HACK: need to re-write those directed at galaxy_main with linkTarget\n        $visualizations.find( '[target=\"galaxy_main\"]').attr( 'target', this.linkTarget );\n        // use addBack here to include the root $visualizations elem (for the case of 1 visualization)\n        this._addScratchBookFn( $visualizations.find( '.visualization-link' ).addBack( '.visualization-link' ) );\n        return $visualizations;\n    },\n\n    /** add scratchbook functionality to visualization links */\n    _addScratchBookFn : function( $links ){\n        var li = this;\n        $links.click( function( ev ){\n            if( Galaxy.frame && Galaxy.frame.active ){\n                Galaxy.frame.add({\n                    title       : \"Visualization\",\n                    type        : \"url\",\n                    content     : $( this ).attr( 'href' )\n                });\n                ev.preventDefault();\n                ev.stopPropagation();\n            }\n        });\n    },\n\n//TODO: if possible move these to readonly view - but display the owner's tags/annotation (no edit)\n    /** Render the tags list/control */\n    _renderTags : function( $where ){\n        if( !this.hasUser ){ return; }\n        var view = this;\n        this.tagsEditor = new TAGS.TagsEditor({\n            model           : this.model,\n            el              : $where.find( '.tags-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow          : function(){ view.tagsEditorShown = true; },\n            onhide          : function(){ view.tagsEditorShown = false; },\n            $activator      : faIconButton({\n                title   : _l( 'Edit dataset tags' ),\n                classes : 'tag-btn',\n                faIcon  : 'fa-tags'\n            }).appendTo( $where.find( '.actions .right' ) )\n        });\n        if( this.tagsEditorShown ){ this.tagsEditor.toggle( true ); }\n    },\n\n    /** Render the annotation display/control */\n    _renderAnnotation : function( $where ){\n        if( !this.hasUser ){ return; }\n        var view = this;\n        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n            model           : this.model,\n            el              : $where.find( '.annotation-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // persist state on the hda view (and not the editor) since these are currently re-created each time\n            onshow          : function(){ view.annotationEditorShown = true; },\n            onhide          : function(){ view.annotationEditorShown = false; },\n            $activator      : faIconButton({\n                title   : _l( 'Edit dataset annotation' ),\n                classes : 'annotate-btn',\n                faIcon  : 'fa-comment'\n            }).appendTo( $where.find( '.actions .right' ) )\n        });\n        if( this.annotationEditorShown ){ this.annotationEditor.toggle( true ); }\n    },\n\n    /** If the format/dbkey/genome_build isn't set, make the display a link to the edit page */\n    _makeDbkeyEditLink : function( $details ){\n        // make the dbkey a link to editing\n        if( this.model.get( 'metadata_dbkey' ) === '?'\n        &&  !this.model.isDeletedOrPurged() ){\n            var editableDbkey = $( '<a class=\"value\">?</a>' )\n                .attr( 'href', this.model.urls.edit )\n                .attr( 'target', this.linkTarget );\n            $details.find( '.dbkey .value' ).replaceWith( editableDbkey );\n        }\n    },\n\n    // ......................................................................... events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .undelete-link'  : '_clickUndeleteLink',\n        'click .purge-link'     : '_clickPurgeLink',\n\n        'click .edit-btn'       : function( ev ){ this.trigger( 'edit', this, ev ); },\n        'click .delete-btn'     : function( ev ){ this.trigger( 'delete', this, ev ); },\n        'click .rerun-btn'      : function( ev ){ this.trigger( 'rerun', this, ev ); },\n        'click .report-err-btn' : function( ev ){ this.trigger( 'report-err', this, ev ); },\n        'click .visualization-btn' : function( ev ){ this.trigger( 'visualize', this, ev ); },\n        'click .dbkey a'        : function( ev ){ this.trigger( 'edit', this, ev ); }\n    }),\n\n\n    /** listener for item undelete (in the messages section) */\n    _clickUndeleteLink : function( ev ){\n        this.model.undelete();\n        return false;\n    },\n\n    /** listener for item purge (in the messages section) */\n    _clickPurgeLink : function( ev ){\n//TODO: confirm dialog\n        this.model.purge();\n        return false;\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAEditView(' + modelString + ')';\n    }\n});\n\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetListItemEdit.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        failed_metadata : BASE_MVC.wrapTemplate([\n            // in this override, provide a link to the edit page\n            '<% if( dataset.state === \"failed_metadata\" ){ %>',\n                '<div class=\"failed_metadata-warning warningmessagesmall\">',\n                    _l( 'An error occurred setting the metadata for this dataset' ),\n                    '<br /><a href=\"<%= dataset.urls.edit %>\" target=\"<%= view.linkTarget %>\">',\n                        _l( 'Set it manually or retry auto-detection' ),\n                    '</a>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' ),\n\n        deleted : BASE_MVC.wrapTemplate([\n            // in this override, provide links to undelete or purge the dataset\n            '<% if( dataset.deleted && !dataset.purged ){ %>',\n                // deleted not purged\n                '<div class=\"deleted-msg warningmessagesmall\">',\n                    _l( 'This dataset has been deleted' ),\n                    '<br /><a class=\"undelete-link\" href=\"javascript:void(0);\">', _l( 'Undelete it' ), '</a>',\n                    '<% if( view.purgeAllowed ){ %>',\n                        '<br /><a class=\"purge-link\" href=\"javascript:void(0);\">',\n                            _l( 'Permanently remove it from disk' ),\n                        '</a>',\n                    '<% } %>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    var visualizationsTemplate = BASE_MVC.wrapTemplate([\n        '<% if( visualizations.length === 1 ){ %>',\n            '<a class=\"visualization-btn visualization-link icon-btn\" href=\"<%= visualizations[0].href %>\"',\n                    ' target=\"<%= visualizations[0].target %>\" title=\"', _l( 'Visualize in' ),\n                    ' <%= visualizations[0].html %>\">',\n                '<span class=\"fa fa-bar-chart-o\"></span>',\n            '</a>',\n\n        '<% } else { %>',\n            '<div class=\"visualizations-dropdown dropdown\">',\n                '<a class=\"visualization-btn icon-btn\" data-toggle=\"dropdown\" title=\"', _l( 'Visualize' ), '\">',\n                    '<span class=\"fa fa-bar-chart-o\"></span>',\n                '</a>',\n                '<ul class=\"dropdown-menu\" role=\"menu\">',\n                    '<% _.each( visualizations, function( visualization ){ %>',\n                        '<li><a class=\"visualization-link\" href=\"<%= visualization.href %>\"',\n                                ' target=\"<%= visualization.target %>\">',\n                            '<%= visualization.html %>',\n                        '</a></li>',\n                    '<% }); %>',\n                '</ul>',\n            '</div>',\n        '<% } %>'\n    ], 'visualizations' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings : warnings,\n        visualizations : visualizationsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        DatasetListItemEdit : DatasetListItemEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/dataset/dataset-li-edit.js\n ** module id = 28\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, BASE_MVC, _l ){\n//==============================================================================\nvar searchableMixin = BASE_MVC.SearchableModelMixin;\n/** @class base model for any DatasetAssociation (HDAs, LDDAs, DatasetCollectionDAs).\n *      No knowledge of what type (HDA/LDDA/DCDA) should be needed here.\n *  The DA's are made searchable (by attribute) by mixing in SearchableModelMixin.\n */\nvar DatasetAssociation = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend(\n        BASE_MVC.mixin( searchableMixin, /** @lends DatasetAssociation.prototype */{\n\n    /** default attributes for a model */\n    defaults : {\n        state               : STATES.NEW,\n        deleted             : false,\n        purged              : false,\n\n        // unreliable attribute\n        name                : '(unnamed dataset)',\n\n//TODO: update to false when this is correctly passed from the API (when we have a security model for this)\n        accessible          : true,\n\n        // sniffed datatype (sam, tabular, bed, etc.)\n        data_type           : '',\n        file_ext            : '',\n\n        // size in bytes\n        file_size           : 0,\n\n        // array of associated file types (eg. [ 'bam_index', ... ])\n        meta_files          : [],\n\n        misc_blurb          : '',\n        misc_info           : '',\n\n        tags                : []\n        // do NOT default on annotation, as this default is valid and will be passed on 'save'\n        //  which is incorrect behavior when the model is only partially fetched (annos are not passed in summary data)\n        //annotation          : ''\n    },\n\n    /** instance vars and listeners */\n    initialize : function( attributes, options ){\n        this.debug( this + '(Dataset).initialize', attributes, options );\n\n        //!! this state is not in trans.app.model.Dataset.states - set it here -\n        if( !this.get( 'accessible' ) ){\n            this.set( 'state', STATES.NOT_VIEWABLE );\n        }\n\n        /** Datasets rely/use some web controllers - have the model generate those URLs on startup */\n        this.urls = this._generateUrls();\n\n        this._setUpListeners();\n    },\n\n    /** returns misc. web urls for rendering things like re-run, display, etc. */\n    _generateUrls : function(){\n//TODO: would be nice if the API did this\n        var id = this.get( 'id' );\n        if( !id ){ return {}; }\n        var urls = {\n            'purge'         : 'datasets/' + id + '/purge_async',\n            'display'       : 'datasets/' + id + '/display/?preview=True',\n            'edit'          : 'datasets/' + id + '/edit',\n            'download'      : 'datasets/' + id + '/display?to_ext=' + this.get( 'file_ext' ),\n            'report_error'  : 'dataset/errors?id=' + id,\n            'rerun'         : 'tool_runner/rerun?id=' + id,\n            'show_params'   : 'datasets/' + id + '/show_params',\n            'visualization' : 'visualization',\n            'meta_download' : 'dataset/get_metadata_file?hda_id=' + id + '&metadata_name='\n        };\n//TODO: global\n        var root = ( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' );\n        _.each( urls, function( value, key ){\n            urls[ key ] = root + value;\n        });\n        this.urls = urls;\n        return urls;\n    },\n\n    /** set up any event listeners\n     *  event: state:ready  fired when this DA moves into/is already in a ready state\n     */\n    _setUpListeners : function(){\n        // if the state has changed and the new state is a ready state, fire an event\n        this.on( 'change:state', function( currModel, newState ){\n            this.log( this + ' has changed state:', currModel, newState );\n            if( this.inReadyState() ){\n                this.trigger( 'state:ready', currModel, newState, this.previous( 'state' ) );\n            }\n        });\n        // the download url (currently) relies on having a correct file extension\n        this.on( 'change:id change:file_ext', function( currModel ){\n            this._generateUrls();\n        });\n    },\n\n    // ........................................................................ common queries\n    /** override to add urls */\n    toJSON : function(){\n        var json = Backbone.Model.prototype.toJSON.call( this );\n        //console.warn( 'returning json?' );\n        //return json;\n        return _.extend( json, {\n            urls : this.urls\n        });\n    },\n\n    /** Is this dataset deleted or purged? */\n    isDeletedOrPurged : function(){\n        return ( this.get( 'deleted' ) || this.get( 'purged' ) );\n    },\n\n    /** Is this dataset in a 'ready' state; where 'Ready' states are states where no\n     *      processing (for the ds) is left to do on the server.\n     */\n    inReadyState : function(){\n        var ready = _.contains( STATES.READY_STATES, this.get( 'state' ) );\n        return ( this.isDeletedOrPurged() || ready );\n    },\n\n    /** Does this model already contain detailed data (as opposed to just summary level data)? */\n    hasDetails : function(){\n        //?? this may not be reliable\n        return _.has( this.attributes, 'genome_build' );\n    },\n\n    /** Convenience function to match dataset.has_data. */\n    hasData : function(){\n        return ( this.get( 'file_size' ) > 0 );\n    },\n\n    // ........................................................................ ajax\n    fetch : function( options ){\n        var dataset = this;\n        return Backbone.Model.prototype.fetch.call( this, options )\n            .always( function(){\n                dataset._generateUrls();\n            });\n    },\n\n    //NOTE: subclasses of DA's will need to implement url and urlRoot in order to have these work properly\n    /** save this dataset, _Mark_ing it as deleted (just a flag) */\n    'delete' : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** save this dataset, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) || this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** remove the file behind this dataset from the filesystem (if permitted) */\n    purge : function _purge( options ){\n//TODO: use, override model.destroy, HDA.delete({ purge: true })\n        if( this.get( 'purged' ) ){ return jQuery.when(); }\n        options = options || {};\n        //var hda = this,\n        //    //xhr = jQuery.ajax( this.url() + '?' + jQuery.param({ purge: true }), _.extend({\n        //    xhr = jQuery.ajax( this.url(), _.extend({\n        //        type : 'DELETE',\n        //        data : {\n        //            purge : true\n        //        }\n        //    }, options ));\n        //\n        //xhr.done( function( response ){\n        //    hda.debug( 'response', response );\n        //    //hda.set({ deleted: true, purged: true });\n        //    hda.set( response );\n        //});\n        //return xhr;\n\n        options.url = this.urls.purge;\n\n        //TODO: ideally this would be a DELETE call to the api\n        //  using purge async for now\n        var hda = this,\n            xhr = jQuery.ajax( options );\n        xhr.done( function( message, status, responseObj ){\n            hda.set({ deleted: true, purged: true });\n        });\n        xhr.fail( function( xhr, status, message ){\n            // Exception messages are hidden within error page including:  '...not allowed in this Galaxy instance.'\n            // unbury and re-add to xhr\n            var error = _l( \"Unable to purge dataset\" );\n            var messageBuriedInUnfortunatelyFormattedError = ( 'Removal of datasets by users '\n                + 'is not allowed in this Galaxy instance' );\n            if( xhr.responseJSON && xhr.responseJSON.error ){\n                error = xhr.responseJSON.error;\n            } else if( xhr.responseText.indexOf( messageBuriedInUnfortunatelyFormattedError ) !== -1 ){\n                error = messageBuriedInUnfortunatelyFormattedError;\n            }\n            xhr.responseText = error;\n            hda.trigger( 'error', hda, xhr, options, _l( error ), { error: error } );\n        });\n        return xhr;\n    },\n\n    // ........................................................................ searching\n    // see base-mvc, SearchableModelMixin\n\n    /** what attributes of an HDA will be used in a text search */\n    searchAttributes : [\n        'name', 'file_ext', 'genome_build', 'misc_blurb', 'misc_info', 'annotation', 'tags'\n    ],\n\n    /** our attr keys don't often match the labels we display to the user - so, when using\n     *      attribute specifiers ('name=\"bler\"') in a term, allow passing in aliases for the\n     *      following attr keys.\n     */\n    searchAliases : {\n        title       : 'name',\n        format      : 'file_ext',\n        database    : 'genome_build',\n        blurb       : 'misc_blurb',\n        description : 'misc_blurb',\n        info        : 'misc_info',\n        tag         : 'tags'\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = '\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'Dataset(' + nameAndId + ')';\n    }\n}));\n\n\n//==============================================================================\n/** @class Backbone collection for dataset associations.\n */\nvar DatasetAssociationCollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends HistoryContents.prototype */{\n    model : DatasetAssociation,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** root api url */\n    urlRoot : (( window.galaxy_config && galaxy_config.root )?( galaxy_config.root ):( '/' ))\n        + 'api/datasets',\n\n    /** url fn */\n    url : function(){\n        return this.urlRoot\n    },\n\n    // ........................................................................ common queries\n    /** Get the ids of every item in this collection\n     *  @returns array of encoded ids\n     */\n    ids : function(){\n        return this.map( function( item ){ return item.get('id'); });\n    },\n\n    /** Get contents that are not ready\n     *  @returns array of content models\n     */\n    notReady : function(){\n        return this.filter( function( content ){\n            return !content.inReadyState();\n        });\n    },\n\n    /** return true if any datasets don't have details */\n    haveDetails : function(){\n        return this.all( function( dataset ){ return dataset.hasDetails(); });\n    },\n\n    // ........................................................................ ajax\n    /** using a queue, perform ajaxFn on each of the models in this collection */\n    ajaxQueue : function( ajaxFn, options ){\n        var deferred = jQuery.Deferred(),\n            startingLength = this.length,\n            responses = [];\n\n        if( !startingLength ){\n            deferred.resolve([]);\n            return deferred;\n        }\n\n        // use reverse order (stylistic choice)\n        var ajaxFns = this.chain().reverse().map( function( dataset, i ){\n            return function(){\n                var xhr = ajaxFn.call( dataset, options );\n                // if successful, notify using the deferred to allow tracking progress\n                xhr.done( function( response ){\n                    deferred.notify({ curr: i, total: startingLength, response: response, model: dataset });\n                });\n                // (regardless of previous error or success) if not last ajax call, shift and call the next\n                //  if last fn, resolve deferred\n                xhr.always( function( response ){\n                    responses.push( response );\n                    if( ajaxFns.length ){\n                        ajaxFns.shift()();\n                    } else {\n                        deferred.resolve( responses );\n                    }\n                });\n            };\n        }).value();\n        // start the queue\n        ajaxFns.shift()();\n\n        return deferred;\n    },\n\n    // ........................................................................ sorting/filtering\n    /** return a new collection of datasets whose attributes contain the substring matchesWhat */\n    matches : function( matchesWhat ){\n        return this.filter( function( dataset ){\n            return dataset.matches( matchesWhat );\n        });\n    },\n\n    // ........................................................................ misc\n    ///** Convert this ad-hoc collection of hdas to a formal collection tracked\n    //    by the server.\n    //**/\n    //promoteToHistoryDatasetCollection : function _promote( history, collection_type, options ){\n    //},\n\n    /** String representation. */\n    toString : function(){\n         return ([ 'DatasetAssociationCollection(', this.length, ')' ].join( '' ));\n    }\n});\n\n\n//==============================================================================\n    return {\n        DatasetAssociation              : DatasetAssociation,\n        DatasetAssociationCollection    : DatasetAssociationCollection\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/dataset/dataset-model.js\n ** module id = 29\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/dataset-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_LI, BASE_MVC, _l ){\n/* global Backbone */\n//==============================================================================\nvar _super = DATASET_LI.DatasetListItemView;\n/** @class Read only view for HistoryDatasetAssociation.\n *      Since there are no controls on the HDAView to hide the dataset,\n *      the primary thing this class does (currently) is override templates\n *      to render the HID.\n */\nvar HDAListItemView = _super.extend(\n/** @lends HDAListItemView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    initialize : function( attributes, options ){\n        _super.prototype.initialize.call( this, attributes, options );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAListItemView(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemView.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding the hid display to the title\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                //TODO: remove whitespace and use margin-right\n                '<span class=\"hid\"><%- dataset.hid %></span> ',\n                '<span class=\"name\"><%- dataset.name %></span>',\n            '</div>',\n        '</div>'\n    ], 'dataset' );\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            // add a warning when hidden\n            '<% if( !dataset.visible ){ %>',\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This dataset has been hidden' ),\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    return _.extend( {}, _super.prototype.templates, {\n        titleBar : titleBarTemplate,\n        warnings : warnings\n    });\n}());\n\n\n\n//==============================================================================\n    return {\n        HDAListItemView  : HDAListItemView\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hda-li.js\n ** module id = 30\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/dataset-model\",\n    \"mvc/history/history-content-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET, HISTORY_CONTENT, BASE_MVC, _l ){\n//==============================================================================\nvar _super = DATASET.DatasetAssociation,\n    hcontentMixin = HISTORY_CONTENT.HistoryContentMixin;\n/** @class (HDA) model for a Galaxy dataset contained in and related to a history.\n */\nvar HistoryDatasetAssociation = _super.extend( BASE_MVC.mixin( hcontentMixin,\n/** @lends HistoryDatasetAssociation.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // because all objects have constructors (as this hashmap would even if this next line wasn't present)\n    //  the constructor in hcontentMixin won't be attached by BASE_MVC.mixin to this model\n    //  - re-apply manually it now\n    /** call the mixin constructor */\n    constructor : function( attrs, options ){\n        hcontentMixin.constructor.call( this, attrs, options );\n    },\n    \n    /** default attributes for a model */\n    defaults : _.extend( {}, _super.prototype.defaults, hcontentMixin.defaults, {\n        model_class         : 'HistoryDatasetAssociation'\n    }),\n\n    /** Set up the model, determine if accessible, bind listeners\n     */\n    initialize : function( attributes, options ){\n        _super.prototype.initialize.call( this, attributes, options );\n        hcontentMixin.initialize.call( this, attributes, options );\n    },\n\n    // ........................................................................ misc\n    /** String representation */\n    toString : function(){\n        var nameAndId = this.get( 'id' ) || '';\n        if( this.get( 'name' ) ){\n            nameAndId = this.get( 'hid' ) + ' :\"' + this.get( 'name' ) + '\",' + nameAndId;\n        }\n        return 'HDA(' + nameAndId + ')';\n    }\n}));\n\n//==============================================================================\n    return {\n        HistoryDatasetAssociation   : HistoryDatasetAssociation\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hda-model.js\n ** module id = 31\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/states\",\n    \"mvc/collection/collection-li\",\n    \"mvc/collection/collection-panel\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( STATES, DC_LI, DC_PANEL, BASE_MVC, _l ){\n/* global Backbone */\n//==============================================================================\nvar _super = DC_LI.DCListItemView;\n/** @class Read only view for HistoryDatasetCollectionAssociation (a dataset collection inside a history).\n */\nvar HDCAListItemView = _super.extend(\n/** @lends HDCAListItemView.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    /** event listeners */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n\n        this.model.on({\n            'change:populated change:visible' : function( model, options ){ this.render(); },\n        }, this );\n    },\n\n    /** Override to provide the proper collections panels as the foldout */\n    _getFoldoutPanelClass : function(){\n        switch( this.model.get( 'collection_type' ) ){\n            case 'list':\n                return DC_PANEL.ListCollectionPanel;\n            case 'paired':\n                return DC_PANEL.PairCollectionPanel;\n            case 'list:paired':\n                return DC_PANEL.ListOfPairsCollectionPanel;\n        }\n        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n    },\n\n    /** In this override, add the state as a class for use with state-based CSS */\n    _swapNewRender : function( $newRender ){\n        _super.prototype._swapNewRender.call( this, $newRender );\n//TODO: model currently has no state\n        var state = !this.model.get( 'populated' ) ? STATES.RUNNING : STATES.OK;\n        //if( this.model.has( 'state' ) ){\n        this.$el.addClass( 'state-' + state );\n        //}\n        return this.$el;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDCAListItemView(' + modelString + ')';\n    }\n});\n\n/** underscore templates */\nHDCAListItemView.prototype.templates = (function(){\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            // add a warning when hidden\n            '<% if( !collection.visible ){ %>',\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This collection has been hidden' ),\n                '</div>',\n            '<% } %>'\n        ], 'collection' )\n    });\n\n// could steal this from hda-base (or use mixed content)\n    var titleBarTemplate = BASE_MVC.wrapTemplate([\n        // adding the hid display to the title\n        '<div class=\"title-bar clear\" tabindex=\"0\">',\n            '<span class=\"state-icon\"></span>',\n            '<div class=\"title\">',\n                //TODO: remove whitespace and use margin-right\n                '<span class=\"hid\"><%- collection.hid %></span> ',\n                '<span class=\"name\"><%- collection.name %></span>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n        '</div>'\n    ], 'collection' );\n\n    return _.extend( {}, _super.prototype.templates, {\n        warnings : warnings,\n        titleBar : titleBarTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HDCAListItemView : HDCAListItemView\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hdca-li.js\n ** module id = 32\n ** module chunks = 3 4\n **/","\ndefine([\n    \"mvc/history/history-contents\",\n    \"utils/utils\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( HISTORY_CONTENTS, UTILS, BASE_MVC, _l ){\n//==============================================================================\n/** @class Model for a Galaxy history resource - both a record of user\n *      tool use and a collection of the datasets those tools produced.\n *  @name History\n *\n *  @augments Backbone.Model\n *  @borrows LoggableMixin#logger as #logger\n *  @borrows LoggableMixin#log as #log\n *  @constructs\n */\nvar History = Backbone.Model.extend( BASE_MVC.LoggableMixin ).extend(\n        BASE_MVC.mixin( BASE_MVC.SearchableModelMixin, /** @lends History.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    // values from api (may need more)\n    defaults : {\n        model_class     : 'History',\n        id              : null,\n        name            : 'Unnamed History',\n        state           : 'new',\n\n        diskSize        : 0,\n        deleted         : false\n    },\n\n    // ........................................................................ urls\n    urlRoot: galaxy_config.root + 'api/histories',\n\n    // ........................................................................ set up/tear down\n    /** Set up the model\n     *  @param {Object} historyJSON model data for this History\n     *  @param {Object[]} contentsJSON   array of model data for this History's contents (hdas or collections)\n     *  @param {Object} options     any extra settings including logger\n     */\n    initialize : function( historyJSON, contentsJSON, options ){\n        options = options || {};\n        this.logger = options.logger || null;\n        this.log( this + \".initialize:\", historyJSON, contentsJSON, options );\n\n        /** HistoryContents collection of the HDAs contained in this history. */\n        this.log( 'creating history contents:', contentsJSON );\n        this.contents = new HISTORY_CONTENTS.HistoryContents( contentsJSON || [], { historyId: this.get( 'id' )});\n        //// if we've got hdas passed in the constructor, load them\n        //if( contentsJSON && _.isArray( contentsJSON ) ){\n        //    this.log( 'resetting history contents:', contentsJSON );\n        //    this.contents.reset( contentsJSON );\n        //}\n\n        this._setUpListeners();\n\n        /** cached timeout id for the dataset updater */\n        this.updateTimeoutId = null;\n        // set up update timeout if needed\n        //this.checkForUpdates();\n    },\n\n    /** set up any event listeners for this history including those to the contained HDAs\n     *  events: error:contents  if an error occurred with the contents collection\n     */\n    _setUpListeners : function(){\n        this.on( 'error', function( model, xhr, options, msg, details ){\n            this.errorHandler( model, xhr, options, msg, details );\n        });\n\n        // hda collection listening\n        if( this.contents ){\n            this.listenTo( this.contents, 'error', function(){\n                this.trigger.apply( this, [ 'error:contents' ].concat( jQuery.makeArray( arguments ) ) );\n            });\n        }\n        // if the model's id changes ('current' or null -> an actual id), update the contents history_id\n        this.on( 'change:id', function( model, newId ){\n            if( this.contents ){\n                this.contents.historyId = newId;\n            }\n        }, this );\n    },\n\n    //TODO: see base-mvc\n    //onFree : function(){\n    //    if( this.contents ){\n    //        this.contents.free();\n    //    }\n    //},\n\n    /** event listener for errors. Generally errors are handled outside this model */\n    errorHandler : function( model, xhr, options, msg, details ){\n        // clear update timeout on model err\n        this.clearUpdateTimeout();\n    },\n\n    /** convert size in bytes to a more human readable version */\n    nice_size : function(){\n        return UTILS.bytesToString( this.get( 'size' ), true, 2 );\n    },\n\n    /** override to add nice_size */\n    toJSON : function(){\n        return _.extend( Backbone.Model.prototype.toJSON.call( this ), {\n            nice_size : this.nice_size()\n        });\n    },\n\n    /** override to allow getting nice_size */\n    get : function( key ){\n        if( key === 'nice_size' ){\n            return this.nice_size();\n        }\n        return Backbone.Model.prototype.get.apply( this, arguments );\n    },\n\n    // ........................................................................ common queries\n    /** T/F is this history owned by the current user (Galaxy.currUser)\n     *      Note: that this will return false for an anon user even if the history is theirs.\n     */\n    ownedByCurrUser : function(){\n        // no currUser\n        if( !Galaxy || !Galaxy.currUser ){\n            return false;\n        }\n        // user is anon or history isn't owned\n        if( Galaxy.currUser.isAnonymous() || Galaxy.currUser.id !== this.get( 'user_id' ) ){\n            return false;\n        }\n        return true;\n    },\n\n    /**  */\n    contentsCount : function(){\n        return _.reduce( _.values( this.get( 'state_details' ) ), function( memo, num ){ return memo + num; }, 0 );\n    },\n\n    // ........................................................................ search\n    /** What model fields to search with */\n    searchAttributes : [\n        'name', 'annotation', 'tags'\n    ],\n\n    /** Adding title and singular tag */\n    searchAliases : {\n        title       : 'name',\n        tag         : 'tags'\n    },\n\n    // ........................................................................ updates\n    /** does the contents collection indicate they're still running and need to be updated later?\n     *      delay + update if needed\n     *  @param {Function} onReadyCallback   function to run when all contents are in the ready state\n     *  events: ready\n     */\n    checkForUpdates : function( onReadyCallback ){\n        //this.info( 'checkForUpdates' )\n\n        // get overall History state from collection, run updater if History has running/queued contents\n        //  boiling it down on the client to running/not\n        if( this.contents.running().length ){\n            this.setUpdateTimeout();\n\n        } else {\n            this.trigger( 'ready' );\n            if( _.isFunction( onReadyCallback ) ){\n                onReadyCallback.call( this );\n            }\n        }\n        return this;\n    },\n\n    /** create a timeout (after UPDATE_DELAY or delay ms) to refetch the contents. Clear any prev. timeout */\n    setUpdateTimeout : function( delay ){\n        delay = delay || History.UPDATE_DELAY;\n        var history = this;\n\n        // prevent buildup of updater timeouts by clearing previous if any, then set new and cache id\n        this.clearUpdateTimeout();\n        this.updateTimeoutId = setTimeout( function(){\n            history.refresh();\n        }, delay );\n        return this.updateTimeoutId;\n    },\n\n    /** clear the timeout and the cached timeout id */\n    clearUpdateTimeout : function(){\n        if( this.updateTimeoutId ){\n            clearTimeout( this.updateTimeoutId );\n            this.updateTimeoutId = null;\n        }\n    },\n\n    /* update the contents, getting full detailed model data for any whose id is in detailIds\n     *  set up to run this again in some interval of time\n     *  @param {String[]} detailIds list of content ids to get detailed model data for\n     *  @param {Object} options     std. backbone fetch options map\n     */\n    refresh : function( detailIds, options ){\n        //this.info( 'refresh:', detailIds, this.contents );\n        detailIds = detailIds || [];\n        options = options || {};\n        var history = this;\n\n        // add detailIds to options as CSV string\n        options.data = options.data || {};\n        if( detailIds.length ){\n            options.data.details = detailIds.join( ',' );\n        }\n        var xhr = this.contents.fetch( options );\n        xhr.done( function( models ){\n            history.checkForUpdates( function(){\n                // fetch the history inside onReadyCallback in order to recalc history size\n                this.fetch();\n            });\n        });\n        return xhr;\n    },\n\n    // ........................................................................ ajax\n    /** save this history, _Mark_ing it as deleted (just a flag) */\n    _delete : function( options ){\n        if( this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true }, options );\n    },\n    /** purge this history, _Mark_ing it as purged and removing all dataset data from the server */\n    purge : function( options ){\n        if( this.get( 'purged' ) ){ return jQuery.when(); }\n        return this.save( { deleted: true, purged: true }, options );\n    },\n    /** save this history, _Mark_ing it as undeleted */\n    undelete : function( options ){\n        if( !this.get( 'deleted' ) ){ return jQuery.when(); }\n        return this.save( { deleted: false }, options );\n    },\n\n    /** Make a copy of this history on the server\n     *  @param {Boolean} current    if true, set the copy as the new current history (default: true)\n     *  @param {String} name        name of new history (default: none - server sets to: Copy of <current name>)\n     *  @fires copied               passed this history and the response JSON from the copy\n     *  @returns {xhr}\n     */\n    copy : function( current, name, allDatasets ){\n        current = ( current !== undefined )?( current ):( true );\n        if( !this.id ){\n            throw new Error( 'You must set the history ID before copying it.' );\n        }\n\n        var postData = { history_id  : this.id };\n        if( current ){\n            postData.current = true;\n        }\n        if( name ){\n            postData.name = name;\n        }\n        if( !allDatasets ){\n            postData.all_datasets = false;\n        }\n\n        var history = this,\n            copy = jQuery.post( this.urlRoot, postData );\n        // if current - queue to setAsCurrent before firing 'copied'\n        if( current ){\n            return copy.then( function( response ){\n                var newHistory = new History( response );\n                return newHistory.setAsCurrent()\n                    .done( function(){\n                        history.trigger( 'copied', history, response );\n                    });\n            });\n        }\n        return copy.done( function( response ){\n            history.trigger( 'copied', history, response );\n        });\n    },\n\n    setAsCurrent : function(){\n        var history = this,\n            xhr = jQuery.getJSON( galaxy_config.root + 'history/set_as_current?id=' + this.id );\n\n        xhr.done( function(){\n            history.trigger( 'set-as-current', history );\n        });\n        return xhr;\n    },\n\n    // ........................................................................ misc\n    toString : function(){\n        return 'History(' + this.get( 'id' ) + ',' + this.get( 'name' ) + ')';\n    }\n}));\n\n//------------------------------------------------------------------------------ CLASS VARS\n/** When the history has running hdas,\n *  this is the amount of time between update checks from the server\n */\nHistory.UPDATE_DELAY = 4000;\n\n/** Get data for a history then its hdas using a sequential ajax call, return a deferred to receive both */\nHistory.getHistoryData = function getHistoryData( historyId, options ){\n    options = options || {};\n    var detailIdsFn = options.detailIdsFn || [];\n    var hdcaDetailIds = options.hdcaDetailIds || [];\n    //console.debug( 'getHistoryData:', historyId, options );\n\n    var df = jQuery.Deferred(),\n        historyJSON = null;\n\n    function getHistory( id ){\n        // get the history data\n        if( historyId === 'current' ){\n            return jQuery.getJSON( galaxy_config.root + 'history/current_history_json' );\n        }\n        return jQuery.ajax( galaxy_config.root + 'api/histories/' + historyId );\n    }\n    function isEmpty( historyData ){\n        // get the number of hdas accrd. to the history\n        return historyData && historyData.empty;\n    }\n    function getContents( historyData ){\n        // get the hda data\n        // if no hdas accrd. to history: return empty immed.\n        if( isEmpty( historyData ) ){ return []; }\n        // if there are hdas accrd. to history: get those as well\n        if( _.isFunction( detailIdsFn ) ){\n            detailIdsFn = detailIdsFn( historyData );\n        }\n        if( _.isFunction( hdcaDetailIds ) ){\n            hdcaDetailIds = hdcaDetailIds( historyData );\n        }\n        var data = {};\n        if( detailIdsFn.length ) {\n            data.dataset_details = detailIdsFn.join( ',' );\n        }\n        if( hdcaDetailIds.length ) {\n            // for symmetry, not actually used by backend of consumed\n            // by frontend.\n            data.dataset_collection_details = hdcaDetailIds.join( ',' );\n        }\n        return jQuery.ajax( galaxy_config.root + 'api/histories/' + historyData.id + '/contents', { data: data });\n    }\n\n    // getting these concurrently is 400% slower (sqlite, local, vanilla) - so:\n    //  chain the api calls - getting history first then contents\n\n    var historyFn = options.historyFn || getHistory,\n        contentsFn = options.contentsFn || getContents;\n\n    // chain ajax calls: get history first, then hdas\n    var historyXHR = historyFn( historyId );\n    historyXHR.done( function( json ){\n        // set outer scope var here for use below\n        historyJSON = json;\n        df.notify({ status: 'history data retrieved', historyJSON: historyJSON });\n    });\n    historyXHR.fail( function( xhr, status, message ){\n        // call reject on the outer deferred to allow its fail callback to run\n        df.reject( xhr, 'loading the history' );\n    });\n\n    var contentsXHR = historyXHR.then( contentsFn );\n    contentsXHR.then( function( contentsJSON ){\n        df.notify({ status: 'contents data retrieved', historyJSON: historyJSON, contentsJSON: contentsJSON });\n        // we've got both: resolve the outer scope deferred\n        df.resolve( historyJSON, contentsJSON );\n    });\n    contentsXHR.fail( function( xhr, status, message ){\n        // call reject on the outer deferred to allow its fail callback to run\n        df.reject( xhr, 'loading the contents', { history: historyJSON } );\n    });\n\n    return df;\n};\n\n\n//==============================================================================\nvar ControlledFetchMixin = {\n\n    /** Override to convert certain options keys into API index parameters */\n    fetch : function( options ){\n        options = options || {};\n        options.data = options.data || this._buildFetchData( options );\n        // use repeated params for arrays, e.g. q=1&qv=1&q=2&qv=2\n        options.traditional = true;\n        return Backbone.Collection.prototype.fetch.call( this, options );\n    },\n\n    /** These attribute keys are valid params to fetch/API-index */\n    _fetchOptions : [\n        /** model dependent string to control the order of models returned */\n        'order',\n        /** limit the number of models returned from a fetch */\n        'limit',\n        /** skip this number of models when fetching */\n        'offset',\n        /** what series of attributes to return (model dependent) */\n        'view',\n        /** individual keys to return for the models (see api/histories.index) */\n        'keys'\n    ],\n\n    /** Build the data dictionary to send to fetch's XHR as data */\n    _buildFetchData : function( options ){\n        var data = {},\n            fetchDefaults = this._fetchDefaults();\n        options = _.defaults( options || {}, fetchDefaults );\n        data = _.pick( options, this._fetchOptions );\n\n        var filters = _.has( options, 'filters' )? options.filters : ( fetchDefaults.filters || {} );\n        if( !_.isEmpty( filters ) ){\n            _.extend( data, this._buildFetchFilters( filters ) );\n        }\n        return data;\n    },\n\n    /** Override to have defaults for fetch options and filters */\n    _fetchDefaults : function(){\n        // to be overridden\n        return {};\n    },\n\n    /** Convert dictionary filters to qqv style arrays */\n    _buildFetchFilters : function( filters ){\n        var filterMap = {\n            q  : [],\n            qv : []\n        };\n        _.each( filters, function( v, k ){\n            if( v === true ){ v = 'True'; }\n            if( v === false ){ v = 'False'; }\n            filterMap.q.push( k );\n            filterMap.qv.push( v );\n        });\n        return filterMap;\n    },\n};\n\n//==============================================================================\n/** @class A collection of histories (per user).\n *      (stub) currently unused.\n */\nvar HistoryCollection = Backbone.Collection.extend( BASE_MVC.LoggableMixin ).extend( ControlledFetchMixin ).extend(\n/** @lends HistoryCollection.prototype */{\n    model   : History,\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** @type {String} the default sortOrders key for sorting */\n    DEFAULT_ORDER : 'update_time',\n\n    /** @type {Object} map of collection sorting orders generally containing a getter to return the attribute\n     *      sorted by and asc T/F if it is an ascending sort.\n     */\n    sortOrders : {\n        'update_time' : {\n            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n            asc : false\n        },\n        'update_time-asc' : {\n            getter : function( h ){ return new Date( h.get( 'update_time' ) ); },\n            asc : true\n        },\n        'name' : {\n            getter : function( h ){ return h.get( 'name' ); },\n            asc : true\n        },\n        'name-dsc' : {\n            getter : function( h ){ return h.get( 'name' ); },\n            asc : false\n        },\n        'size' : {\n            getter : function( h ){ return h.get( 'size' ); },\n            asc : false\n        },\n        'size-asc' : {\n            getter : function( h ){ return h.get( 'size' ); },\n            asc : true\n        }\n    },\n\n    initialize : function( models, options ){\n        options = options || {};\n        this.log( 'HistoryCollection.initialize', arguments );\n\n        // instance vars\n        /** @type {boolean} should deleted histories be included */\n        this.includeDeleted = options.includeDeleted || false;\n        // set the sort order\n        this.setOrder( options.order || this.DEFAULT_ORDER );\n        /** @type {String} encoded id of the history that's current */\n        this.currentHistoryId = options.currentHistoryId;\n        /** @type {boolean} have all histories been fetched and in the collection? */\n        this.allFetched = options.allFetched || false;\n\n        // this.on( 'all', function(){\n        //    console.info( 'event:', arguments );\n        // });\n        this.setUpListeners();\n    },\n\n    urlRoot : ( window.galaxy_config? galaxy_config.root : '/' ) + 'api/histories',\n    url     : function(){ return this.urlRoot; },\n\n    /** returns map of default filters and settings for fetching from the API */\n    _fetchDefaults : function(){\n        // to be overridden\n        var defaults = {\n            order   : this.order,\n            view    : 'detailed'\n        };\n        if( !this.includeDeleted ){\n            defaults.filters = {\n                deleted : false,\n                purged  : false,\n            };\n        }\n        return defaults;\n    },\n\n    /** set up reflexive event handlers */\n    setUpListeners : function setUpListeners(){\n        this.on({\n            // when a history is deleted, remove it from the collection (if optionally set to do so)\n            'change:deleted' : function( history ){\n                // TODO: this becomes complicated when more filters are used\n                this.debug( 'change:deleted', this.includeDeleted, history.get( 'deleted' ) );\n                if( !this.includeDeleted && history.get( 'deleted' ) ){\n                    this.remove( history );\n                }\n            },\n            // listen for a history copy, setting it to current\n            'copied' : function( original, newData ){\n                this.setCurrent( new History( newData, [] ) );\n            },\n            // when a history is made current, track the id in the collection\n            'set-as-current' : function( history ){\n                var oldCurrentId = this.currentHistoryId;\n                this.trigger( 'no-longer-current', oldCurrentId );\n                this.currentHistoryId = history.id;\n            }\n        }, this );\n    },\n\n    /** override to allow passing options.order and setting the sort order to one of sortOrders */\n    sort : function( options ){\n        options = options || {};\n        this.setOrder( options.order );\n        return Backbone.Collection.prototype.sort.call( this, options );\n    },\n\n    /** build the comparator used to sort this collection using the sortOrder map and the given order key\n     *  @event 'changed-order' passed the new order and the collection\n     */\n    setOrder : function( order ){\n        var collection = this,\n            sortOrder = this.sortOrders[ order ];\n        if( _.isUndefined( sortOrder ) ){ return; }\n\n        collection.order = order;\n        collection.comparator = function comparator( a, b ){\n            var currentHistoryId = collection.currentHistoryId;\n            // current always first\n            if( a.id === currentHistoryId ){ return -1; }\n            if( b.id === currentHistoryId ){ return 1; }\n            // then compare by an attribute\n            a = sortOrder.getter( a );\n            b = sortOrder.getter( b );\n            return sortOrder.asc?\n                ( ( a === b )?( 0 ):( a > b ?  1 : -1 ) ):\n                ( ( a === b )?( 0 ):( a > b ? -1 :  1 ) );\n        };\n        collection.trigger( 'changed-order', collection.order, collection );\n        return collection;\n    },\n\n    /** override to provide order and offsets based on instance vars, set limit if passed,\n     *  and set allFetched/fire 'all-fetched' when xhr returns\n     */\n    fetch : function( options ){\n        options = options || {};\n        if( this.allFetched ){ return jQuery.when({}); }\n        var collection = this,\n            fetchOptions = _.defaults( options, {\n                remove : false,\n                offset : collection.length >= 1? ( collection.length - 1 ) : 0,\n                order  : collection.order\n            }),\n            limit = options.limit;\n        if( !_.isUndefined( limit ) ){\n            fetchOptions.limit = limit;\n        }\n\n        return ControlledFetchMixin.fetch.call( this, fetchOptions )\n            .done( function _postFetchMore( fetchData ){\n                var numFetched = _.isArray( fetchData )? fetchData.length : 0;\n                // anything less than a full page means we got all there is to get\n                if( !limit || numFetched < limit ){\n                    collection.allFetched = true;\n                    collection.trigger( 'all-fetched', collection );\n                }\n            }\n        );\n    },\n\n    /** create a new history and by default set it to be the current history */\n    create : function create( data, hdas, historyOptions, xhrOptions ){\n        //TODO: .create is actually a collection function that's overridden here\n        var collection = this,\n            xhr = jQuery.getJSON( galaxy_config.root + 'history/create_new_current'  );\n        return xhr.done( function( newData ){\n            collection.setCurrent( new History( newData, [], historyOptions || {} ) );\n        });\n    },\n\n    /** set the current history to the given history, placing it first in the collection.\n     *  Pass standard bbone options for use in unshift.\n     *  @triggers new-current passed history and this collection\n     */\n    setCurrent : function( history, options ){\n        options = options || {};\n        // new histories go in the front\n        this.unshift( history, options );\n        this.currentHistoryId = history.get( 'id' );\n        if( !options.silent ){\n            this.trigger( 'new-current', history, this );\n        }\n        return this;\n    },\n\n    /** override to reset allFetched flag to false */\n    reset : function( models, options ){\n        this.allFetched = false;\n        return Backbone.Collection.prototype.reset.call( this, models, options );\n    },\n\n    toString: function toString(){\n        return 'HistoryCollection(' + this.length + ')';\n    }\n});\n\n//==============================================================================\nreturn {\n    History           : History,\n    HistoryCollection : HistoryCollection\n};});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/history-model.js\n ** module id = 33\n ** module chunks = 3 4\n **/","define([\n    \"mvc/list/list-item\",\n    \"ui/loading-indicator\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/search-input\"\n], function( LIST_ITEM, LoadingIndicator, BASE_MVC, _l ){\n/* ============================================================================\nTODO:\n\n============================================================================ */\n/** @class View for a list/collection of models and the sub-views of those models.\n *      Sub-views must (at least have the interface if not) inherit from ListItemView.\n *      (For a list panel that also includes some 'container' model (History->HistoryContents)\n *      use ModelWithListPanel)\n *\n *  Allows for:\n *      searching collection/sub-views\n *      selecting/multi-selecting sub-views\n *\n *  Currently used:\n *      for dataset/dataset-choice\n *      as superclass of ModelListPanel\n */\nvar ListPanel = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend(\n/** @lends ReadOnlyHistoryPanel.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** class to use for constructing the sub-views */\n    viewClass           : LIST_ITEM.ListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass     : Backbone.Collection,\n\n    tagName             : 'div',\n    className           : 'list-panel',\n\n    /** (in ms) that jquery effects will use */\n    fxSpeed             : 'fast',\n\n    /** string to display when the collection has no contents */\n    emptyMsg            : _l( 'This list is empty' ),\n    /** displayed when no items match the search terms */\n    noneFoundMsg        : _l( 'No matching items found' ),\n    /** string used for search placeholder */\n    searchPlaceholder   : _l( 'search' ),\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the list\n     */\n    initialize : function( attributes, options ){\n        attributes = attributes || {};\n        // set the logger if requested\n        if( attributes.logger ){\n            this.logger = attributes.logger;\n        }\n        this.log( this + '.initialize:', attributes );\n\n        // ---- instance vars\n        /** how quickly should jquery fx run? */\n        this.fxSpeed = _.has( attributes, 'fxSpeed' )?( attributes.fxSpeed ):( this.fxSpeed );\n\n        /** filters for displaying subviews */\n        this.filters = [];\n        /** current search terms */\n        this.searchFor = attributes.searchFor || '';\n\n        /** loading indicator */\n        this.indicator = new LoadingIndicator( this.$el );\n\n        /** currently showing selectors on items? */\n        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : true;\n        //this.selecting = false;\n\n        /** cached selected item.model.ids to persist btwn renders */\n        this.selected = attributes.selected || [];\n        /** the last selected item.model.id */\n        this.lastSelected = null;\n\n        /** are sub-views draggable */\n        this.dragItems = attributes.dragItems || false;\n\n        /** list item view class (when passed models) */\n        this.viewClass = attributes.viewClass || this.viewClass;\n\n        /** list item views */\n        this.views = [];\n        /** list item models */\n        this.collection = attributes.collection || ( new this.collectionClass([]) );\n\n        /** filter fns run over collection items to see if they should show in the list */\n        this.filters = attributes.filters || [];\n\n        /** override $scrollContainer fn via attributes - fn should return jq for elem to call scrollTo on */\n        this.$scrollContainer = attributes.$scrollContainer || this.$scrollContainer;\n\n//TODO: remove\n        this.title = attributes.title || '';\n        this.subtitle = attributes.subtitle || '';\n\n        this._setUpListeners();\n    },\n\n    /** free any sub-views the list has */\n    freeViews : function(){\n//TODO: stopListening? remove?\n        _.each( this.views, function( view ){\n            view.off();\n        });\n        this.views = [];\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** create any event listeners for the list\n     */\n    _setUpListeners : function(){\n        this.off();\n\n        //TODO: move errorHandler down into list-panel from history-panel or\n        //  pass to global error handler (Galaxy)\n        this.on( 'error', function( model, xhr, options, msg, details ){\n            //this.errorHandler( model, xhr, options, msg, details );\n            console.error( model, xhr, options, msg, details );\n        }, this );\n\n        // show hide the loading indicator\n        this.on( 'loading', function(){\n            this._showLoadingIndicator( 'loading...', 40 );\n        }, this );\n        this.on( 'loading-done', function(){\n            this._hideLoadingIndicator( 40 );\n        }, this );\n\n        // throw the first render up as a diff namespace using once (for outside consumption)\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        }, this );\n\n        // debugging\n        if( this.logger ){\n            this.on( 'all', function( event ){\n                this.log( this + '', arguments );\n            }, this );\n        }\n\n        this._setUpCollectionListeners();\n        this._setUpViewListeners();\n        return this;\n    },\n\n    /** listening for collection events */\n    _setUpCollectionListeners : function(){\n        this.log( this + '._setUpCollectionListeners', this.collection );\n        this.collection.off();\n\n        // bubble up error events\n        this.collection.on( 'error', function( model, xhr, options, msg, details ){\n            this.trigger( 'error', model, xhr, options, msg, details );\n        }, this );\n\n        this.collection.on( 'reset', function(){\n            this.renderItems();\n        }, this );\n        this.collection.on( 'add', this.addItemView, this );\n        this.collection.on( 'remove', this.removeItemView, this );\n\n        // debugging\n        if( this.logger ){\n            this.collection.on( 'all', function( event ){\n                this.info( this + '(collection)', arguments );\n            }, this );\n        }\n        return this;\n    },\n\n    /** listening for sub-view events that bubble up with the 'view:' prefix */\n    _setUpViewListeners : function(){\n        this.log( this + '._setUpViewListeners' );\n\n        // shift to select a range\n        this.on( 'view:selected', function( view, ev ){\n            if( ev && ev.shiftKey && this.lastSelected ){\n                var lastSelectedView = this.viewFromModelId( this.lastSelected );\n                if( lastSelectedView ){\n                    this.selectRange( view, lastSelectedView );\n                }\n            } else if( ev && ev.altKey && !this.selecting ){\n                this.showSelectors();\n            }\n            this.selected.push( view.model.id );\n            this.lastSelected = view.model.id;\n        }, this );\n\n        this.on( 'view:de-selected', function( view, ev ){\n            this.selected = _.without( this.selected, view.model.id );\n            //this.lastSelected = view.model.id;\n        }, this );\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** Render this content, set up ui.\n     *  @param {Number or String} speed   the speed of the render\n     */\n    render : function( speed ){\n        this.log( this + '.render', speed );\n        var $newRender = this._buildNewRender();\n        this._setUpBehaviors( $newRender );\n        this._queueNewRender( $newRender, speed );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _buildNewRender : function(){\n        this.debug( this + '(ListPanel)._buildNewRender' );\n        var $newRender = $( this.templates.el( {}, this ) );\n        this._renderControls( $newRender );\n        this._renderTitle( $newRender );\n        this._renderSubtitle( $newRender );\n        this._renderSearch( $newRender );\n        this.renderItems( $newRender );\n        return $newRender;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls : function( $newRender ){\n        this.debug( this + '(ListPanel)._renderControls' );\n        var $controls = $( this.templates.controls( {}, this ) );\n        $newRender.find( '.controls' ).replaceWith( $controls );\n        return $controls;\n    },\n\n    /**\n     */\n    _renderTitle : function( $where ){\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /**\n     */\n    _renderSubtitle : function( $where ){\n        //$where = $where || this.$el;\n        //$where.find( '.title' ).replaceWith( ... )\n    },\n\n    /** Fade out the old el, swap in the new contents, then fade in.\n     *  @param {Number or String} speed   jq speed to use for rendering effects\n     *  @fires rendered when rendered\n     */\n    _queueNewRender : function( $newRender, speed ) {\n        speed = ( speed === undefined )?( this.fxSpeed ):( speed );\n        var panel = this;\n        panel.log( '_queueNewRender:', $newRender, speed );\n\n        $( panel ).queue( 'fx', [\n            function( next ){ this.$el.fadeOut( speed, next ); },\n            function( next ){\n                panel._swapNewRender( $newRender );\n                next();\n            },\n            function( next ){ this.$el.fadeIn( speed, next ); },\n            function( next ){\n                panel.trigger( 'rendered', panel );\n                next();\n            }\n        ]);\n    },\n\n    /** empty out the current el, move the $newRender's children in */\n    _swapNewRender : function( $newRender ){\n        this.$el.empty().attr( 'class', this.className ).append( $newRender.children() );\n        if( this.selecting ){ this.showSelectors( 0 ); }\n        return this;\n    },\n\n    /**  */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        $where.find( '.controls [title]' ).tooltip({ placement: 'bottom' });\n        // set up the pupup for actions available when multi selecting\n        this._renderMultiselectActionMenu( $where );\n        return this;\n    },\n\n    /** render a menu containing the actions available to sets of selected items */\n    _renderMultiselectActionMenu : function( $where ){\n        $where = $where || this.$el;\n        var $menu = $where.find( '.list-action-menu' ),\n            actions = this.multiselectActions();\n        if( !actions.length ){\n            return $menu.empty();\n        }\n\n        var $newMenu = $([\n            '<div class=\"list-action-menu btn-group\">',\n                '<button class=\"list-action-menu-btn btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                    _l( 'For all selected' ), '...',\n                '</button>',\n                '<ul class=\"dropdown-menu pull-right\" role=\"menu\">', '</ul>',\n            '</div>'\n        ].join(''));\n        var $actions = actions.map( function( action ){\n            var html = [ '<li><a href=\"javascript:void(0);\">', action.html, '</a></li>' ].join( '' );\n            return $( html ).click( function( ev ){\n                ev.preventDefault();\n                return action.func( ev );\n            });\n        });\n        $newMenu.find( 'ul' ).append( $actions );\n        $menu.replaceWith( $newMenu );\n        return $newMenu;\n    },\n\n    /** return a list of plain objects used to render multiselect actions menu. Each object should have:\n     *      html: an html string used as the anchor contents\n     *      func: a function called when the anchor is clicked (passed the click event)\n     */\n    multiselectActions : function(){\n        return [];\n    },\n\n    // ------------------------------------------------------------------------ sub-$element shortcuts\n    /** the scroll container for this panel - can be $el, $el.parent(), or grandparent depending on context */\n    $scrollContainer : function(){\n        // override or set via attributes.$scrollContainer\n        return this.$el.parent().parent();\n    },\n    /**  */\n    $list : function( $where ){\n        return ( $where || this.$el ).find( '> .list-items' );\n    },\n    /** container where list messages are attached */\n    $messages : function( $where ){\n        return ( $where || this.$el ).find( '> .controls .messages' );\n    },\n    /** the message displayed when no views can be shown (no views, none matching search) */\n    $emptyMessage : function( $where ){\n        return ( $where || this.$el ).find( '> .empty-message' );\n    },\n\n    // ------------------------------------------------------------------------ hda sub-views\n    /**\n     *  @param {jQuery} $whereTo what dom element to prepend the sub-views to\n     *  @returns the visible item views\n     */\n    renderItems : function( $whereTo ){\n        $whereTo = $whereTo || this.$el;\n        var panel = this;\n        panel.log( this + '.renderItems', $whereTo );\n\n        var $list = panel.$list( $whereTo );\n//TODO: free prev. views?\n        panel.views = panel._filterCollection().map( function( itemModel ){\n//TODO: creates views each time - not neccessarily good\n//TODO: pass speed here\n                return panel._createItemView( itemModel ).render( 0 );\n            });\n        //panel.debug( item$els );\n        //panel.debug( newViews );\n\n        $list.empty();\n        if( panel.views.length ){\n            panel._attachItems( $whereTo );\n            panel.$emptyMessage( $whereTo ).hide();\n\n        } else {\n            panel._renderEmptyMessage( $whereTo ).show();\n        }\n        panel.trigger( 'views:ready', panel.views );\n\n        return panel.views;\n    },\n\n    /** Filter the collection to only those models that should be currently viewed */\n    _filterCollection : function(){\n        // override this\n        var panel = this;\n        return panel.collection.filter( _.bind( panel._filterItem, panel ) );\n    },\n\n    /** Should the model be viewable in the current state?\n     *     Checks against this.filters and this.searchFor\n     */\n    _filterItem : function( model ){\n        // override this\n        var panel = this;\n        return ( _.every( panel.filters.map( function( fn ){ return fn.call( model ); }) ) )\n            && ( !panel.searchFor || model.matchesAll( panel.searchFor ) );\n    },\n\n    /** Create a view for a model and set up it's listeners */\n    _createItemView : function( model ){\n        var ViewClass = this._getItemViewClass( model ),\n            options = _.extend( this._getItemViewOptions( model ), {\n                    model : model\n                }),\n            view = new ViewClass( options );\n        this._setUpItemViewListeners( view );\n        return view;\n    },\n\n    /** Get the bbone view class based on the model */\n    _getItemViewClass : function( model ){\n        // override this\n        return this.viewClass;\n    },\n\n    /** Get the options passed to the new view based on the model */\n    _getItemViewOptions : function( model ){\n        // override this\n        return {\n            //logger      : this.logger,\n            fxSpeed     : this.fxSpeed,\n            expanded    : false,\n            selectable  : this.selecting,\n            selected    : _.contains( this.selected, model.id ),\n            draggable   : this.dragItems\n        };\n    },\n\n    /** Set up listeners for new models */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        // send all events to the panel, re-namspaceing them with the view prefix\n        view.on( 'all', function(){\n            var args = Array.prototype.slice.call( arguments, 0 );\n            args[0] = 'view:' + args[0];\n            panel.trigger.apply( panel, args );\n        });\n\n        // drag multiple - hijack ev.setData to add all selected items\n        view.on( 'draggable:dragstart', function( ev, v ){\n            //TODO: set multiple drag data here\n            var json = {},\n                selected = this.getSelectedModels();\n            if( selected.length ){\n                json = selected.toJSON();\n            } else {\n                json = [ v.model.toJSON() ];\n            }\n            ev.dataTransfer.setData( 'text', JSON.stringify( json ) );\n            //ev.dataTransfer.setDragImage( v.el, 60, 60 );\n        }, this );\n\n        // debugging\n        //if( this.logger ){\n        //    view.on( 'all', function( event ){\n        //        this.log( this + '(view)', arguments );\n        //    }, this );\n        //}\n        return panel;\n    },\n\n    /** Attach views in this.views to the model based on $whereTo */\n    _attachItems : function( $whereTo ){\n        //ASSUMES: $list has been emptied\n        this.$list( $whereTo ).append( this.views.map( function( view ){\n            return view.$el;\n        }));\n        return this;\n    },\n\n    /** render the empty/none-found message */\n    _renderEmptyMessage : function( $whereTo ){\n        this.debug( '_renderEmptyMessage', $whereTo, this.searchFor );\n        var text = this.searchFor? this.noneFoundMsg : this.emptyMsg;\n        return this.$emptyMessage( $whereTo ).text( text );\n    },\n\n    /** collapse all item views */\n    expandAll : function(){\n        _.each( this.views, function( view ){\n            view.expand();\n        });\n    },\n\n    /** collapse all item views */\n    collapseAll : function(){\n        _.each( this.views, function( view ){\n            view.collapse();\n        });\n    },\n\n    // ------------------------------------------------------------------------ collection/views syncing\n    /** Add a view (if the model should be viewable) to the panel */\n    addItemView : function( model, collection, options ){\n        this.log( this + '.addItemView:', model );\n        var panel = this;\n        if( !panel._filterItem( model ) ){ return undefined; }\n\n        var view = panel._createItemView( model );\n        // hide the empty message if only view\n        $( view ).queue( 'fx', [\n            //TODO:? could poss. pubsub this\n            function( next ){ panel.$emptyMessage().fadeOut( panel.fxSpeed, next ); },\n            function( next ){\n                panel._attachView( view );\n                next();\n            }\n        ]);\n        return view;\n    },\n\n    /** internal fn to add view (to both panel.views and panel.$list) */\n    _attachView : function( view ){\n        var panel = this;\n        // override to control where the view is added, how/whether it's rendered\n        panel.views.push( view );\n        panel.$list().append( view.render( 0 ).$el.hide() );\n        panel.trigger( 'view:attached', view );\n        view.$el.slideDown( panel.fxSpeed, function(){\n            panel.trigger( 'view:attached:rendered' );\n        });\n    },\n\n    /** Remove a view from the panel (if found) */\n    removeItemView : function( model, collection, options ){\n        this.log( this + '.removeItemView:', model );\n        var panel = this,\n            view = panel.viewFromModel( model );\n        if( !view ){ return undefined; }\n        panel.views = _.without( panel.views, view );\n        panel.trigger( 'view:removed', view );\n\n        // potentially show the empty message if no views left\n        // use anonymous queue here - since remove can happen multiple times\n        $({}).queue( 'fx', [\n            function( next ){ view.$el.fadeOut( panel.fxSpeed, next ); },\n            function( next ){\n                view.remove();\n                panel.trigger( 'view:removed:rendered' );\n                if( !panel.views.length ){\n                    panel._renderEmptyMessage().fadeIn( panel.fxSpeed, next );\n                } else {\n                    next();\n                }\n            }\n        ]);\n        return view;\n    },\n\n    /** get views based on model.id */\n    viewFromModelId : function( id ){\n        for( var i = 0; i < this.views.length; i++ ){\n            if( this.views[i].model.id === id ){\n                return this.views[i];\n            }\n        }\n        return undefined;\n    },\n\n    /** get views based on model */\n    viewFromModel : function( model ){\n        if( !model ){ return undefined; }\n        return this.viewFromModelId( model.id );\n    },\n\n    /** get views based on model properties */\n    viewsWhereModel : function( properties ){\n        return this.views.filter( function( view ){\n            //return view.model.matches( properties );\n//TODO: replace with _.matches (underscore 1.6.0)\n            var json = view.model.toJSON();\n            for( var key in properties ){\n                if( properties.hasOwnProperty( key ) ){\n                    if( json[ key ] !== view.model.get( key ) ){\n                        return false;\n                    }\n                }\n            }\n            return true;\n        });\n    },\n\n    /** A range of views between (and including) viewA and viewB */\n    viewRange : function( viewA, viewB ){\n        if( viewA === viewB ){ return ( viewA )?( [ viewA ] ):( [] ); }\n\n        var indexA = this.views.indexOf( viewA ),\n            indexB = this.views.indexOf( viewB );\n\n        // handle not found\n        if( indexA === -1 || indexB === -1 ){\n            if( indexA === indexB ){ return []; }\n            return ( indexA === -1 )?( [ viewB ] ):( [ viewA ] );\n        }\n        // reverse if indeces are\n        //note: end inclusive\n        return ( indexA < indexB )?\n            this.views.slice( indexA, indexB + 1 ) :\n            this.views.slice( indexB, indexA + 1 );\n    },\n\n    // ------------------------------------------------------------------------ searching\n    /** render a search input for filtering datasets shown\n     *      (see SearchableMixin in base-mvc for implementation of the actual searching)\n     *      return will start the search\n     *      esc will clear the search\n     *      clicking the clear button will clear the search\n     *      uses searchInput in ui.js\n     */\n    _renderSearch : function( $where ){\n        $where.find( '.controls .search-input' ).searchInput({\n            placeholder     : this.searchPlaceholder,\n            initialVal      : this.searchFor,\n            onfirstsearch   : _.bind( this._firstSearch, this ),\n            onsearch        : _.bind( this.searchItems, this ),\n            onclear         : _.bind( this.clearSearch, this )\n        });\n        return $where;\n    },\n\n    /** What to do on the first search entered */\n    _firstSearch : function( searchFor ){\n        // override to load model details if necc.\n        this.log( 'onFirstSearch', searchFor );\n        return this.searchItems( searchFor );\n    },\n\n    /** filter view list to those that contain the searchFor terms */\n    searchItems : function( searchFor ){\n        this.searchFor = searchFor;\n        this.trigger( 'search:searching', searchFor, this );\n        this.renderItems();\n        this.$( '> .controls .search-query' ).val( searchFor );\n        return this;\n    },\n\n    /** clear the search filters and show all views that are normally shown */\n    clearSearch : function( searchFor ){\n        //this.log( 'onSearchClear', this );\n        this.searchFor = '';\n        this.trigger( 'search:clear', this );\n        this.$( '> .controls .search-query' ).val( '' );\n        this.renderItems();\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** show selectors on all visible itemViews and associated controls */\n    showSelectors : function( speed ){\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        this.selecting = true;\n        this.$( '.list-actions' ).slideDown( speed );\n        _.each( this.views, function( view ){\n            view.showSelector( speed );\n        });\n        //this.selected = [];\n        //this.lastSelected = null;\n    },\n\n    /** hide selectors on all visible itemViews and associated controls */\n    hideSelectors : function( speed ){\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        this.selecting = false;\n        this.$( '.list-actions' ).slideUp( speed );\n        _.each( this.views, function( view ){\n            view.hideSelector( speed );\n        });\n        this.selected = [];\n        this.lastSelected = null;\n    },\n\n    /** show or hide selectors on all visible itemViews and associated controls */\n    toggleSelectors : function(){\n        if( !this.selecting ){\n            this.showSelectors();\n        } else {\n            this.hideSelectors();\n        }\n    },\n\n    /** select all visible items */\n    selectAll : function( event ){\n        _.each( this.views, function( view ){\n            view.select( event );\n        });\n    },\n\n    /** deselect all visible items */\n    deselectAll : function( event ){\n        this.lastSelected = null;\n        _.each( this.views, function( view ){\n            view.deselect( event );\n        });\n    },\n\n    /** select a range of datasets between A and B */\n    selectRange : function( viewA, viewB ){\n        var range = this.viewRange( viewA, viewB );\n        _.each( range, function( view ){\n            view.select();\n        });\n        return range;\n    },\n\n    /** return an array of all currently selected itemViews */\n    getSelectedViews : function(){\n        return _.filter( this.views, function( v ){\n            return v.selected;\n        });\n    },\n\n    /** return a collection of the models of all currenly selected items */\n    getSelectedModels : function(){\n        return new this.collection.constructor( _.map( this.getSelectedViews(), function( view ){\n            return view.model;\n        }));\n    },\n\n    // ------------------------------------------------------------------------ loading indicator\n//TODO: questionable\n    /** hide the $el and display a loading indicator (in the $el's parent) when loading new data */\n    _showLoadingIndicator : function( msg, speed, callback ){\n        this.debug( '_showLoadingIndicator', this.indicator, msg, speed, callback );\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        if( !this.indicator ){\n            this.indicator = new LoadingIndicator( this.$el, this.$el.parent() );\n            this.debug( '\\t created', this.indicator );\n        }\n        if( !this.$el.is( ':visible' ) ){\n            this.indicator.show( 0, callback );\n        } else {\n            this.$el.fadeOut( speed );\n            this.indicator.show( msg, speed, callback );\n        }\n    },\n\n    /** hide the loading indicator */\n    _hideLoadingIndicator : function( speed, callback ){\n        this.debug( '_hideLoadingIndicator', this.indicator, speed, callback );\n        speed = ( speed !== undefined )?( speed ):( this.fxSpeed );\n        if( this.indicator ){\n            this.indicator.hide( speed, callback );\n        }\n    },\n\n    // ------------------------------------------------------------------------ scrolling\n    /** get the current scroll position of the panel in its parent */\n    scrollPosition : function(){\n        return this.$scrollContainer().scrollTop();\n    },\n\n    /** set the current scroll position of the panel in its parent */\n    scrollTo : function( pos, speed ){\n        speed = speed || 0;\n        this.$scrollContainer().animate({ scrollTop: pos }, speed );\n        return this;\n    },\n\n    /** Scrolls the panel to the top. */\n    scrollToTop : function( speed ){\n        return this.scrollTo( 0, speed );\n    },\n\n    /**  */\n    scrollToItem : function( view, speed ){\n        if( !view ){ return this; }\n        //var itemTop = view.$el.offset().top;\n        var itemTop = view.$el.position().top;\n        return this.scrollTo( itemTop, speed );\n    },\n\n    /** Scrolls the panel to show the content with the given id. */\n    scrollToId : function( id, speed ){\n        return this.scrollToItem( this.viewFromModelId( id ), speed );\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : {\n        'click .select-all'     : 'selectAll',\n        'click .deselect-all'   : 'deselectAll'\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString : function(){\n        return 'ListPanel(' + this.collection + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nListPanel.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var elTemplate = BASE_MVC.wrapTemplate([\n        // temp container\n        '<div>',\n            '<div class=\"controls\"></div>',\n            '<div class=\"list-items\"></div>',\n            '<div class=\"empty-message infomessagesmall\"></div>',\n        '</div>'\n    ]);\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n                '<div class=\"name\"><%= view.title %></div>',\n            '</div>',\n            '<div class=\"subtitle\"><%= view.subtitle %></div>',\n            // buttons, controls go here\n            '<div class=\"actions\"></div>',\n            // deleted msg, etc.\n            '<div class=\"messages\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            // show when selectors are shown\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ]);\n\n    return {\n        el          : elTemplate,\n        controls    : controlsTemplate\n    };\n}());\n\n\n//=============================================================================\n/** View for a model that has a sub-collection (e.g. History, DatasetCollection)\n *  Allows:\n *      the model to be reset\n *      auto assign panel.collection to panel.model[ panel.modelCollectionKey ]\n *\n */\nvar ModelListPanel = ListPanel.extend({\n\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey : 'contents',\n\n    initialize : function( attributes ){\n        ListPanel.prototype.initialize.call( this, attributes );\n        this.selecting = ( attributes.selecting !== undefined )? attributes.selecting : false;\n\n        this.setModel( this.model, attributes );\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel : function( model, attributes ){\n        attributes = attributes || {};\n        this.debug( this + '.setModel:', model, attributes );\n\n        this.freeModel();\n        this.freeViews();\n\n        if( model ){\n            var oldModelId = this.model? this.model.get( 'id' ): null;\n\n            // set up the new model with user, logger, storage, events\n            this.model = model;\n            if( this.logger ){\n                this.model.logger = this.logger;\n            }\n            this._setUpModelListeners();\n\n//TODO: relation btwn model, collection becoming tangled here\n            // free the collection, and assign the new collection to either\n            //  the model[ modelCollectionKey ], attributes.collection, or an empty vanilla collection\n            this.collection.off();\n            this.collection = ( this.model[ this.modelCollectionKey ] )?\n                this.model[ this.modelCollectionKey ]:\n                ( attributes.collection || ( new this.collectionClass([]) ) );\n            this._setUpCollectionListeners();\n\n            if( oldModelId && model.get( 'id' ) !== oldModelId  ){\n                this.trigger( 'new-model', this );\n            }\n        }\n        return this;\n    },\n\n    /** free the current model and all listeners for it, free any views for the model */\n    freeModel : function(){\n        // stop/release the previous model, and clear cache to sub-views\n        if( this.model ){\n            this.stopListening( this.model );\n            //TODO: see base-mvc\n            //this.model.free();\n            //this.model = null;\n        }\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ listening\n    /** listening for model events */\n    _setUpModelListeners : function(){\n        // override\n        this.log( this + '._setUpModelListeners', this.model );\n        // bounce model errors up to the panel\n        this.model.on( 'error', function(){\n            var args = Array.prototype.slice.call( arguments, 0 );\n            //args.unshift( 'model:error' );\n            args.unshift( 'error' );\n            this.trigger.apply( this, args );\n        }, this );\n        return this;\n    },\n\n    /** Build a temp div containing the new children for the view's $el.\n     */\n    _renderControls : function( $newRender ){\n        this.debug( this + '(ListPanel)._renderControls' );\n        var json = this.model? this.model.toJSON() : {},\n            $controls = $( this.templates.controls( json, this ) );\n        $newRender.find( '.controls' ).replaceWith( $controls );\n        return $controls;\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** Return a string rep of the panel */\n    toString : function(){\n        return 'ModelListPanel(' + this.model + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nModelListPanel.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n//TODO: this is really the only difference - consider factoring titlebar out\n                '<div class=\"name\"><%= model.name %></div>',\n            '</div>',\n            '<div class=\"subtitle\"><%= view.subtitle %></div>',\n            '<div class=\"actions\"></div>',\n            '<div class=\"messages\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ]);\n\n    return _.extend( _.clone( ListPanel.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n//=============================================================================\n    return {\n        ListPanel      : ListPanel,\n        ModelListPanel : ModelListPanel\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/list/list-panel.js\n ** module id = 34\n ** module chunks = 3 4\n **/","define([\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( baseMVC, _l ){\n// =============================================================================\n/** A view on any model that has a 'tags' attribute (a list of tag strings)\n *      Incorporates the select2 jQuery plugin for tags display/editing:\n *      http://ivaynberg.github.io/select2/\n */\nvar TagsEditor = Backbone.View.extend( baseMVC.LoggableMixin ).extend( baseMVC.HiddenUntilActivatedViewMixin ).extend({\n    \n    tagName     : 'div',\n    className   : 'tags-display',\n\n    /** Set up listeners, parse options */\n    initialize : function( options ){\n        //console.debug( this, options );\n        // only listen to the model only for changes to tags - re-render\n        this.listenTo( this.model, 'change:tags', function(){\n            this.render();\n        });\n        this.hiddenUntilActivated( options.$activator, options );\n    },\n\n    /** Build the DOM elements, call select to on the created input, and set up behaviors */\n    render : function(){\n        var view = this;\n        this.$el.html( this._template() );\n\n        this.$input().select2({\n            placeholder : 'Add tags',\n            width       : '100%',\n            tags : function(){\n                // initialize possible tags in the dropdown based on all the tags the user has used so far\n                return view._getTagsUsed();\n            }\n        });\n\n        this._setUpBehaviors();\n        return this;\n    },\n\n    /** @returns {String} the html text used to build the view's DOM */\n    _template : function(){\n        return [\n            //TODO: make prompt optional\n            '<label class=\"prompt\">', _l( 'Tags' ), '</label>',\n            // set up initial tags by adding as CSV to input vals (necc. to init select2)\n            '<input class=\"tags-input\" value=\"', this.tagsToCSV(), '\" />'\n        ].join( '' );\n    },\n\n    /** @returns {String} the sorted, comma-separated tags from the model */\n    tagsToCSV : function(){\n        var tagsArray = this.model.get( 'tags' );\n        if( !_.isArray( tagsArray ) || _.isEmpty( tagsArray ) ){\n            return '';\n        }\n        return tagsArray.map( function( tag ){\n            return _.escape( tag );\n        }).sort().join( ',' );\n    },\n\n    /** @returns {jQuery} the input for this view */\n    $input : function(){\n        return this.$el.find( 'input.tags-input' );\n    },\n\n    /** @returns {String[]} all tags used by the current user */\n    _getTagsUsed : function(){\n//TODO: global\n        return Galaxy.currUser.get( 'tags_used' );\n    },\n\n    /** set up any event listeners on the view's DOM (mostly handled by select2) */\n    _setUpBehaviors : function(){\n        var view = this;\n        this.$input().on( 'change', function( event ){\n            // save the model's tags in either remove or added event\n            view.model.save({ tags: event.val }, { silent: true });\n            // if it's new, add the tag to the users tags\n            if( event.added ){\n                //??: solve weird behavior in FF on test.galaxyproject.org where\n                //  event.added.text is string object: 'String{ 0=\"o\", 1=\"n\", 2=\"e\" }'\n                view._addNewTagToTagsUsed( event.added.text + '' );\n            }\n        });\n    },\n\n    /** add a new tag (if not already there) to the list of all tags used by the user\n     *  @param {String} newTag  the tag to add to the list of used\n     */\n    _addNewTagToTagsUsed : function( newTag ){\n//TODO: global\n        var tagsUsed = Galaxy.currUser.get( 'tags_used' );\n        if( !_.contains( tagsUsed, newTag ) ){\n            tagsUsed.push( newTag );\n            tagsUsed.sort();\n            Galaxy.currUser.set( 'tags_used', tagsUsed );\n        }\n    },\n\n    /** shut down event listeners and remove this view's DOM */\n    remove : function(){\n        this.$input.off();\n        this.stopListening( this.model );\n        Backbone.View.prototype.remove.call( this );\n    },\n\n    /** string rep */\n    toString : function(){ return [ 'TagsEditor(', this.model + '', ')' ].join(''); }\n});\n\n// =============================================================================\nreturn {\n    TagsEditor : TagsEditor\n};\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/tags.js\n ** module id = 35\n ** module chunks = 3 4\n **/","define([\n    'libs/underscore',\n    'libs/backbone/backbone',\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( _, Backbone, baseMVC, _l ){\n//==============================================================================\n/** @class Model for a Galaxy user (including anonymous users).\n *  @name User\n *\n *  @augments Backbone.Model\n *  @borrows LoggableMixin#logger as #logger\n *  @borrows LoggableMixin#log as #log\n *  @constructs\n */\nvar User = Backbone.Model.extend( baseMVC.LoggableMixin ).extend(\n/** @lends User.prototype */{\n\n    ///** logger used to record this.log messages, commonly set to console */\n    //// comment this out to suppress log output\n    //logger              : console,\n\n    /** API location for this resource */\n    urlRoot : function(){ return Galaxy.options.root + 'api/users'; },\n\n    /** Model defaults\n     *  Note: don't check for anon-users with the username as the default is '(anonymous user)'\n     *      a safer method is if( !user.get( 'email' ) ) -> anon user\n     */\n    defaults : /** @lends User.prototype */{\n        id                      : null,\n        username                : '(' + _l( \"anonymous user\" ) + ')',\n        email                   : \"\",\n        total_disk_usage        : 0,\n        nice_total_disk_usage   : \"\",\n        quota_percent           : null,\n        is_admin                : false\n    },\n\n    /** Set up and bind events\n     *  @param {Object} data Initial model data.\n     */\n    initialize : function( data ){\n        this.log( 'User.initialize:', data );\n\n        this.on( 'loaded', function( model, resp ){ this.log( this + ' has loaded:', model, resp ); });\n        this.on( 'change', function( model, data ){ this.log( this + ' has changed:', model, data.changes ); });\n    },\n\n    isAnonymous : function(){\n        return ( !this.get( 'email' ) );\n    },\n\n    isAdmin : function(){\n        return ( this.get( 'is_admin' ) );\n    },\n\n    /** Load a user with the API using an id.\n     *      If getting an anonymous user or no access to a user id, pass the User.CURRENT_ID_STR\n     *      (e.g. 'current') and the API will return the current transaction's user data.\n     *  @param {String} idOrCurrent encoded user id or the User.CURRENT_ID_STR\n     *  @param {Object} options hash to pass to Backbone.Model.fetch. Can contain success, error fns.\n     *  @fires loaded when the model has been loaded from the API, passing the newModel and AJAX response.\n     */\n    loadFromApi : function( idOrCurrent, options ){\n        idOrCurrent = idOrCurrent || User.CURRENT_ID_STR;\n\n        options = options || {};\n        var model = this,\n            userFn = options.success;\n\n        /** @ignore */\n        options.success = function( newModel, response ){\n            model.trigger( 'loaded', newModel, response );\n            if( userFn ){ userFn( newModel, response ); }\n        };\n\n        // requests for the current user must have a sep. constructed url (fetch don't work, ma)\n        if( idOrCurrent === User.CURRENT_ID_STR ){\n            options.url = this.urlRoot + '/' + User.CURRENT_ID_STR;\n        }\n        return Backbone.Model.prototype.fetch.call( this, options );\n    },\n\n    /** Clears all data from the sessionStorage.\n     */\n    clearSessionStorage : function(){\n        for( var key in sessionStorage ){\n            //TODO: store these under the user key so we don't have to do this\n            // currently only history\n            if( key.indexOf( 'history:' ) === 0 ){\n                sessionStorage.removeItem( key );\n\n            } else if( key === 'history-panel' ){\n                sessionStorage.removeItem( key );\n            }\n        }\n    },\n\n    /** string representation */\n    toString : function(){\n        var userInfo = [ this.get( 'username' ) ];\n        if( this.get( 'id' ) ){\n            userInfo.unshift( this.get( 'id' ) );\n            userInfo.push( this.get( 'email' ) );\n        }\n        return 'User(' + userInfo.join( ':' ) + ')';\n    }\n});\n\n// string to send to tell server to return this transaction's user (see api/users.py)\nUser.CURRENT_ID_STR = 'current';\n\n// class method to load the current user via the api and return that model\nUser.getCurrentUserFromApi = function( options ){\n    var currentUser = new User();\n    currentUser.loadFromApi( User.CURRENT_ID_STR, options );\n    return currentUser;\n};\n\n// (stub) collection for users (shouldn't be common unless admin UI)\nvar UserCollection = Backbone.Collection.extend( baseMVC.LoggableMixin ).extend({\n    model   : User,\n    urlRoot : function(){ return Galaxy.options.root + 'api/users'; },\n    //logger  : console,\n});\n\n\n//==============================================================================\nreturn {\n    User : User\n};});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/user/user-model.js\n ** module id = 39\n ** module chunks = 3 4 6\n **/","(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function () {\n//=============================================================================\n\n    jQuery.fn.extend({\n        hoverhighlight : function $hoverhighlight( scope, color ){\n            scope = scope || 'body';\n            if( !this.size() ){ return this; }\n\n            $( this ).each( function(){\n                var $this = $( this ),\n                    targetSelector = $this.data( 'target' );\n\n                if( targetSelector ){\n                    $this.mouseover( function( ev ){\n                        $( targetSelector, scope ).css({\n                            background: color\n                        });\n                    })\n                    .mouseout( function( ev ){\n                        $( targetSelector ).css({\n                            background: ''\n                        });\n                    });\n                }\n            });\n            return this;\n        }\n    });\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/ui/hoverhighlight.js\n ** module id = 40\n ** module chunks = 3 4\n **/","// from: https://raw.githubusercontent.com/umdjs/umd/master/jqueryPlugin.js\n// Uses AMD or browser globals to create a jQuery plugin.\n(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        //TODO: So...this turns out to be an all or nothing thing. If I load jQuery in the define below, it will\n        //  (of course) wipe the old jquery *and all the plugins loaded into it*. So the define below *is still\n        //  relying on jquery being loaded globally* in order to preserve plugins.\n        define([], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n\n}(function () {\n    var _l = window._l || function( s ){ return s; };\n\n    /** searchInput: (jQuery plugin)\n     *      Creates a search input, a clear button, and loading indicator\n     *      within the selected node.\n     *\n     *      When the user either presses return or enters some minimal number\n     *      of characters, a callback is called. Pressing ESC when the input\n     *      is focused will clear the input and call a separate callback.\n     */\n    function searchInput( parentNode, options ){\n//TODO: consolidate with tool menu functionality, use there\n        var KEYCODE_ESC     = 27,\n            KEYCODE_RETURN  = 13,\n            $parentNode     = $( parentNode ),\n            firstSearch     = true,\n            defaults = {\n                initialVal      : '',\n                name            : 'search',\n                placeholder     : 'search',\n                classes         : '',\n                onclear         : function(){},\n                onfirstsearch   : null,\n                onsearch        : function( inputVal ){},\n                minSearchLen    : 0,\n                escWillClear    : true,\n                oninit          : function(){}\n            };\n\n        // .................................................................... input rendering and events\n        // visually clear the search, trigger an event, and call the callback\n        function clearSearchInput( event ){\n            var $input = $( this ).parent().children( 'input' );\n            //console.debug( this, 'clear', $input );\n            $input.focus().val( '' ).trigger( 'clear:searchInput' );\n            options.onclear();\n        }\n\n        // search for searchTerms, trigger an event, call the appropo callback (based on whether this is the first)\n        function search( event, searchTerms ){\n            //console.debug( this, 'searching', searchTerms );\n            //TODO: I don't think this is classic jq custom event form? search.searchInput?\n            $( this ).trigger( 'search:searchInput', searchTerms );\n            if( typeof options.onfirstsearch === 'function' && firstSearch ){\n                firstSearch = false;\n                options.onfirstsearch( searchTerms );\n            } else {\n                options.onsearch( searchTerms );\n            }\n        }\n\n        // .................................................................... input rendering and events\n        function inputTemplate(){\n            // class search-query is bootstrap 2.3 style that now lives in base.less\n            return [ '<input type=\"text\" name=\"', options.name, '\" placeholder=\"', options.placeholder, '\" ',\n                            'class=\"search-query ', options.classes, '\" ', '/>' ].join( '' );\n        }\n\n        // the search input that responds to keyboard events and displays the search value\n        function $input(){\n            return $( inputTemplate() )\n                // select all text on a focus\n                .focus( function( event ){\n                    $( this ).select();\n                })\n                // attach behaviors to esc, return if desired, search on some min len string\n                .keyup( function( event ){\n                    event.preventDefault();\n                    event.stopPropagation();\n//TODO: doesn't work\n                    if( !$( this ).val() ){ $( this ).blur(); }\n\n                    // esc key will clear if desired\n                    if( event.which === KEYCODE_ESC && options.escWillClear ){\n                        clearSearchInput.call( this, event );\n\n                    } else {\n                        var searchTerms = $( this ).val();\n                        // return key or the search string len > minSearchLen (if not 0) triggers search\n                        if( ( event.which === KEYCODE_RETURN )\n                        ||  ( options.minSearchLen && searchTerms.length >= options.minSearchLen ) ){\n                            search.call( this, event, searchTerms );\n                        } else if( !searchTerms.length ){\n                            clearSearchInput.call( this, event );\n                        }\n                    }\n                })\n                .on( 'change', function( event ){\n                    search.call( this, event, $( this ).val() );\n                })\n                .val( options.initialVal );\n        }\n\n        // .................................................................... clear button rendering and events\n        // a button for clearing the search bar, placed on the right hand side\n        function $clearBtn(){\n            return $([ '<span class=\"search-clear fa fa-times-circle\" ',\n                             'title=\"', _l( 'clear search (esc)' ), '\"></span>' ].join('') )\n            .tooltip({ placement: 'bottom' })\n            .click( function( event ){\n                clearSearchInput.call( this, event );\n            });\n        }\n\n        // .................................................................... loadingIndicator rendering\n        // a button for clearing the search bar, placed on the right hand side\n        function $loadingIndicator(){\n            return $([ '<span class=\"search-loading fa fa-spinner fa-spin\" ',\n                             'title=\"', _l( 'loading...' ), '\"></span>' ].join('') )\n                .hide().tooltip({ placement: 'bottom' });\n        }\n\n        // .................................................................... commands\n        // visually swap the load, clear buttons\n        function toggleLoadingIndicator(){\n            $parentNode.find( '.search-loading' ).toggle();\n            $parentNode.find( '.search-clear' ).toggle();\n        }\n\n        // .................................................................... init\n        // string command (not constructor)\n        if( jQuery.type( options ) === 'string' ){\n            if( options === 'toggle-loading' ){\n                toggleLoadingIndicator();\n            }\n            return $parentNode;\n        }\n\n        // initial render\n        if( jQuery.type( options ) === 'object' ){\n            options = jQuery.extend( true, {}, defaults, options );\n        }\n        //NOTE: prepended\n        return $parentNode.addClass( 'search-input' ).prepend([ $input(), $clearBtn(), $loadingIndicator() ]);\n    }\n\n    // as jq plugin\n    jQuery.fn.extend({\n        searchInput : function $searchInput( options ){\n            return this.each( function(){\n                return searchInput( this, options );\n            });\n        }\n    });\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/ui/search-input.js\n ** module id = 41\n ** module chunks = 3 4\n **/","define([], function(){\n// Alphanumeric/natural sort fn\nfunction naturalSort(a, b) {\n    // setup temp-scope variables for comparison evauluation\n    var re = /(-?[0-9\\.]+)/g,\n        x = a.toString().toLowerCase() || '',\n        y = b.toString().toLowerCase() || '',\n        nC = String.fromCharCode(0),\n        xN = x.replace( re, nC + '$1' + nC ).split(nC),\n        yN = y.replace( re, nC + '$1' + nC ).split(nC),\n        xD = (new Date(x)).getTime(),\n        yD = xD ? (new Date(y)).getTime() : null;\n    // natural sorting of dates\n    if ( yD ) {\n        if ( xD < yD ) { return -1; }\n        else if ( xD > yD ) { return 1; }\n    }\n    // natural sorting through split numeric strings and default strings\n    var oFxNcL, oFyNcL;\n    for ( var cLoc = 0, numS = Math.max(xN.length, yN.length); cLoc < numS; cLoc++ ) {\n        oFxNcL = parseFloat(xN[cLoc]) || xN[cLoc];\n        oFyNcL = parseFloat(yN[cLoc]) || yN[cLoc];\n        if (oFxNcL < oFyNcL) { return -1; }\n        else if (oFxNcL > oFyNcL) { return 1; }\n    }\n    return 0;\n}\n\nreturn naturalSort;\n})\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/utils/natural-sort.js\n ** module id = 42\n ** module chunks = 3 4\n **/","// dependencies\ndefine(['galaxy.masthead'], function( Masthead ) {\n\n/** GalaxyMenu uses the GalaxyMasthead class in order to add menu items and icons to the Masthead **/\nvar GalaxyMenu = Backbone.Model.extend({\n    initialize: function( options ) {\n        this.options = options.config;\n        this.masthead  = options.masthead;\n        this.create();\n    },\n\n    // default menu\n    create: function() {\n        //\n        // Analyze data tab.\n        //\n        var tab_analysis = new Masthead.GalaxyMastheadTab({\n            id              : 'analysis',\n            title           : 'Analyze Data',\n            content         : '',\n            title_attribute : 'Analysis home view'\n        });\n        this.masthead.append( tab_analysis );\n\n        //\n        // Workflow tab.\n        //\n\n        var workflow_options = {\n            id              : 'workflow',\n            title           : 'Workflow',\n            content         : 'workflow',\n            title_attribute : 'Chain tools into workflows'\n        }\n        if ( !Galaxy.user.id ) {\n            workflow_options.disabled = true; // disable workflows for anonymous users\n        }\n\n        var tab_workflow = new Masthead.GalaxyMastheadTab( workflow_options );\n        this.masthead.append( tab_workflow );\n\n        //\n        // 'Shared Items' or Libraries tab.\n        //\n        var tab_shared = new Masthead.GalaxyMastheadTab({\n            id              : 'shared',\n            title           : 'Shared Data',\n            content         : 'library/index',\n            title_attribute : 'Access published resources'\n        });\n\n        tab_shared.add({\n            title   : 'Data Libraries',\n            content : 'library/index'\n        });\n\n        tab_shared.add({\n            title   : 'Data Libraries Beta',\n            content : 'library/list',\n            divider : true\n        });\n\n        tab_shared.add({\n            title   : 'Published Histories',\n            content : 'history/list_published'\n        });\n\n        tab_shared.add({\n            title   : 'Published Workflows',\n            content : 'workflow/list_published'\n\n        });\n\n        tab_shared.add({\n            title   : 'Published Visualizations',\n            content : 'visualization/list_published'\n        });\n\n        tab_shared.add({\n            title   : 'Published Pages',\n            content : 'page/list_published'\n        });\n\n        this.masthead.append(tab_shared);\n\n        //\n        // Lab menu.\n        //\n        if ( this.options.user_requests ) {\n            var tab_lab = new Masthead.GalaxyMastheadTab({\n                id      : 'lab',\n                title   : 'Lab'\n            });\n            tab_lab.add({\n                title   : 'Sequencing Requests',\n                content : 'requests/index'\n            });\n            tab_lab.add({\n                title   : 'Find Samples',\n                content : 'requests/find_samples_index'\n            });\n            tab_lab.add({\n                title   : 'Help',\n                content : this.options.lims_doc_url\n            });\n            this.masthead.append( tab_lab );\n        }\n\n        //\n        // Visualization tab.\n        //\n\n        var visualization_options = {\n            id              : 'visualization',\n            title           : 'Visualization',\n            content         : 'visualization/list',\n            title_attribute : 'Visualize datasets'\n        }\n\n        // disable visualizations for anonymous users\n        if ( !Galaxy.user.id ) {\n            visualization_options.disabled = true;\n        }\n        var tab_visualization = new Masthead.GalaxyMastheadTab( visualization_options );\n\n        // add submenu only when user is logged in\n        if ( Galaxy.user.id ) {\n            tab_visualization.add({\n                title   : 'New Track Browser',\n                content : 'visualization/trackster',\n                target  : '_frame'\n            });\n            tab_visualization.add({\n                title   : 'Saved Visualizations',\n                content : 'visualization/list',\n                target  : '_frame'\n            });\n        }\n        this.masthead.append( tab_visualization );\n\n        //\n        // Admin.\n        //\n        if ( Galaxy.user.get( 'is_admin' ) ) {\n            var tab_admin = new Masthead.GalaxyMastheadTab({\n                id              : 'admin',\n                title           : 'Admin',\n                content         : 'admin',\n                extra_class     : 'admin-only',\n                title_attribute : 'Administer this Galaxy'\n            });\n            this.masthead.append( tab_admin );\n        }\n\n        //\n        // Help tab.\n        //\n        var tab_help = new Masthead.GalaxyMastheadTab({\n            id              : 'help',\n            title           : 'Help',\n            title_attribute : 'Support, contact, and community hubs'\n        });\n        if ( this.options.biostar_url ){\n            tab_help.add({\n                title   : 'Galaxy Biostar',\n                content : this.options.biostar_url_redirect,\n                target  : '_blank'\n            });\n            tab_help.add({\n                title   : 'Ask a question',\n                content : 'biostar/biostar_question_redirect',\n                target  : '_blank'\n            });\n        }\n        tab_help.add({\n            title   : 'Support',\n            content : this.options.support_url,\n            target  : '_blank'\n        });\n        tab_help.add({\n            title   : 'Search',\n            content : this.options.search_url,\n            target  : '_blank'\n        });\n        tab_help.add({\n            title   : 'Mailing Lists',\n            content : this.options.mailing_lists,\n            target  : '_blank'\n        });\n        tab_help.add({\n            title   : 'Videos',\n            content : this.options.screencasts_url,\n            target  : '_blank'\n        });\n        tab_help.add({\n            title   : 'Wiki',\n            content : this.options.wiki_url,\n            target  : '_blank'\n        });\n        tab_help.add({\n            title   : 'How to Cite Galaxy',\n            content : this.options.citation_url,\n            target  : '_blank'\n        });\n        if (this.options.terms_url){\n            tab_help.add({\n                title   : 'Terms and Conditions',\n                content : this.options.terms_url,\n                target  : '_blank'\n            });\n        }\n        this.masthead.append( tab_help );\n\n        //\n        // User tab.\n        //\n        if ( !Galaxy.user.id ){\n            var tab_user = new Masthead.GalaxyMastheadTab({\n                id              : 'user',\n                title           : 'User',\n                extra_class     : 'loggedout-only',\n                title_attribute : 'Account registration or login'\n            });\n\n            // login\n            tab_user.add({\n                title   : 'Login',\n                content : 'user/login',\n                target  : 'galaxy_main'\n            });\n\n            // register\n            if ( this.options.allow_user_creation ){\n                tab_user.add({\n                    title   : 'Register',\n                    content : 'user/create',\n                    target  : 'galaxy_main'\n                });\n            }\n\n            // add to masthead\n            this.masthead.append( tab_user );\n        } else {\n            var tab_user = new Masthead.GalaxyMastheadTab({\n                id              : 'user',\n                title           : 'User',\n                extra_class     : 'loggedin-only',\n                title_attribute : 'Account preferences and saved data'\n            });\n\n            // show user logged in info\n            tab_user.add({\n                title   : 'Logged in as ' + Galaxy.user.get( 'email' )\n            });\n\n            tab_user.add({\n                title   : 'Preferences',\n                content : 'user?cntrller=user',\n                target  : 'galaxy_main'\n            });\n\n            tab_user.add({\n                title   : 'Custom Builds',\n                content : 'user/dbkeys',\n                target  : 'galaxy_main'\n            });\n\n            tab_user.add({\n                title   : 'Logout',\n                content : 'user/logout',\n                target  : '_top',\n                divider : true\n            });\n\n            // default tabs\n            tab_user.add({\n                title   : 'Saved Histories',\n                content : 'history/list',\n                target  : 'galaxy_main'\n            });\n            tab_user.add({\n                title   : 'Saved Datasets',\n                content : 'dataset/list',\n                target  : 'galaxy_main'\n            });\n            tab_user.add({\n                title   : 'Saved Pages',\n                content : 'page/list',\n                target  : '_top'\n            });\n\n            tab_user.add({\n                title   : 'API Keys',\n                content : 'user/api_keys?cntrller=user',\n                target  : 'galaxy_main'\n            });\n\n            if ( this.options.use_remote_user ){\n                tab_user.add({\n                    title   : 'Public Name',\n                    content : 'user/edit_username?cntrller=user',\n                    target  : 'galaxy_main'\n                });\n            }\n\n            // add to masthead\n            this.masthead.append( tab_user );\n        }\n\n        // identify active tab\n        if ( this.options.active_view ) {\n            this.masthead.highlight( this.options.active_view );\n        }\n    }\n});\n\n// return\nreturn {\n    GalaxyMenu: GalaxyMenu\n};\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/galaxy.menu.js\n ** module id = 48\n ** module chunks = 3 4\n **/","define([\n    \"mvc/collection/collection-li\",\n    \"mvc/dataset/dataset-li-edit\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DC_LI, DATASET_LI_EDIT, BASE_MVC, _l ){\n/* global Backbone, LoggableMixin */\n//==============================================================================\nvar DCListItemView = DC_LI.DCListItemView;\n/** @class Edit view for DatasetCollection.\n */\nvar DCListItemEdit = DCListItemView.extend(\n/** @lends DCListItemEdit.prototype */{\n//TODO: may not be needed\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** override to add linkTarget */\n    initialize : function( attributes ){\n        DCListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\nvar DCEListItemView = DC_LI.DCEListItemView;\n/** @class Read only view for DatasetCollectionElement.\n */\nvar DCEListItemEdit = DCEListItemView.extend(\n/** @lends DCEListItemEdit.prototype */{\n//TODO: this might be expendable - compacted with HDAListItemView\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        DCEListItemView.prototype.initialize.call( this, attributes );\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DCEListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n// NOTE: this does not inherit from DatasetDCEListItemView as you would expect\n//TODO: but should - if we can find something simpler than using diamond\n/** @class Editable view for a DatasetCollectionElement that is also an DatasetAssociation\n *      (a dataset contained in a dataset collection).\n */\nvar DatasetDCEListItemEdit = DATASET_LI_EDIT.DatasetListItemEdit.extend(\n/** @lends DatasetDCEListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** set up */\n    initialize  : function( attributes ){\n        DATASET_LI_EDIT.DatasetListItemEdit.prototype.initialize.call( this, attributes );\n    },\n\n    // NOTE: this does not inherit from DatasetDCEListItemView - so we duplicate this here\n    //TODO: fix\n    /** In this override, only get details if in the ready state.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n        }\n        return jQuery.when();\n    },\n\n    /** Override to remove delete button */\n    _renderDeleteButton : function(){\n        return null;\n    },\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'DatasetDCEListItemEdit(' + modelString + ')';\n    }\n});\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nDatasetDCEListItemEdit.prototype.templates = (function(){\n\n    return _.extend( {}, DATASET_LI_EDIT.DatasetListItemEdit.prototype.templates, {\n        titleBar : DC_LI.DatasetDCEListItemView.prototype.templates.titleBar\n    });\n}());\n\n\n//==============================================================================\n/** @class Read only view for a DatasetCollectionElement that is also a DatasetCollection\n *      (a nested DC).\n */\nvar NestedDCDCEListItemEdit = DC_LI.NestedDCDCEListItemView.extend(\n/** @lends NestedDCDCEListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    // comment this out to suppress log output\n    //logger              : console,\n\n    // ......................................................................... misc\n    /** String representation */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'NestedDCDCEListItemEdit(' + modelString + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        DCListItemEdit          : DCListItemEdit,\n        DCEListItemEdit         : DCEListItemEdit,\n        DatasetDCEListItemEdit  : DatasetDCEListItemEdit,\n        NestedDCDCEListItemEdit : NestedDCDCEListItemEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/collection-li-edit.js\n ** module id = 55\n ** module chunks = 3 4\n **/","define([\n    \"mvc/collection/collection-panel\",\n    \"mvc/collection/collection-model\",\n    \"mvc/collection/collection-li-edit\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DC_PANEL, DC_MODEL, DC_EDIT, BASE_MVC, _l ){\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class editable View/Controller for a dataset collection.\n */\nvar _super = DC_PANEL.CollectionPanel;\nvar CollectionPanelEdit = _super.extend(\n/** @lends CollectionPanel.prototype */{\n    //MODEL is either a DatasetCollection (or subclass) or a DatasetCollectionElement (list of pairs)\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass: DC_EDIT.NestedDCDCEListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n    },\n\n    /** In this override, make the collection name editable\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call( this, $where );\n        if( !this.model ){ return; }\n\n        // anon users shouldn't have access to any of the following\n        if( !Galaxy.currUser || Galaxy.currUser.isAnonymous() ){\n            return;\n        }\n\n        //TODO: extract\n        var panel = this,\n            nameSelector = '> .controls .name';\n        $where.find( nameSelector )\n            .attr( 'title', _l( 'Click to rename collection' ) )\n            .tooltip({ placement: 'bottom' })\n            .make_text_editable({\n                on_finish: function( newName ){\n                    var previousName = panel.model.get( 'name' );\n                    if( newName && newName !== previousName ){\n                        panel.$el.find( nameSelector ).text( newName );\n                        panel.model.save({ name: newName })\n                            .fail( function(){\n                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n                            });\n                    } else {\n                        panel.$el.find( nameSelector ).text( previousName );\n                    }\n                }\n            });\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'CollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListCollectionPanelEdit = CollectionPanelEdit.extend(\n/** @lends ListCollectionPanel.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n    /** sub view class used for datasets */\n    DatasetDCEViewClass : DC_EDIT.DatasetDCEListItemEdit,\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class Editable, read-only View/Controller for a dataset collection. */\nvar PairCollectionPanelEdit = ListCollectionPanelEdit.extend(\n/** @lends PairCollectionPanelEdit.prototype */{\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'PairCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class Editable (roughly since these collections are immutable),\n *  View/Controller for a dataset collection.\n */\nvar NestedPairCollectionPanelEdit = PairCollectionPanelEdit.extend(\n/** @lends NestedPairCollectionPanelEdit.prototype */{\n\n    /** Override to remove the editable text from the name/identifier - these collections are considered immutable */\n    _setUpBehaviors : function( $where ){\n        _super.prototype._setUpBehaviors.call( this, $where );\n    },\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'NestedPairCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n// =============================================================================\n/** @class non-editable, read-only View/Controller for a dataset collection. */\nvar ListOfPairsCollectionPanelEdit = CollectionPanelEdit.extend(\n/** @lends ListOfPairsCollectionPanel.prototype */{\n\n    //TODO: not strictly needed - due to switch in CollectionPanel._getContentClass\n    /** sub view class used for nested collections */\n    NestedDCDCEViewClass : DC_EDIT.NestedDCDCEListItemEdit.extend({\n        foldoutPanelClass : NestedPairCollectionPanelEdit\n    }),\n\n    // ........................................................................ misc\n    /** string rep */\n    toString    : function(){\n        return 'ListOfPairsCollectionPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//==============================================================================\n    return {\n        CollectionPanelEdit             : CollectionPanelEdit,\n        ListCollectionPanelEdit         : ListCollectionPanelEdit,\n        PairCollectionPanelEdit         : PairCollectionPanelEdit,\n        ListOfPairsCollectionPanelEdit  : ListOfPairsCollectionPanelEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/collection-panel-edit.js\n ** module id = 56\n ** module chunks = 3 4\n **/","define([\n    \"utils/levenshtein\",\n    \"utils/natural-sort\",\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/hoverhighlight\"\n], function( levenshteinDistance, naturalSort, LIST_COLLECTION_CREATOR, baseMVC, _l ){\n/* ============================================================================\nTODO:\n\n\nPROGRAMMATICALLY:\ncurrPanel.once( 'rendered', function(){\n    currPanel.showSelectors();\n    currPanel.selectAll();\n    _.last( currPanel.actionsPopup.options ).func();\n});\n\n============================================================================ */\n/** A view for paired datasets in the collections creator.\n */\nvar PairView = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n\n    tagName     : 'li',\n    className   : 'dataset paired',\n\n    initialize : function( attributes ){\n        this.pair = attributes.pair || {};\n    },\n\n    template : _.template([\n        '<span class=\"forward-dataset-name flex-column\"><%= pair.forward.name %></span>',\n        '<span class=\"pair-name-column flex-column\">',\n            '<span class=\"pair-name\"><%= pair.name %></span>',\n        '</span>',\n        '<span class=\"reverse-dataset-name flex-column\"><%= pair.reverse.name %></span>'\n    ].join('')),\n\n    render : function(){\n        this.$el\n            .attr( 'draggable', true )\n            .data( 'pair', this.pair )\n            .html( this.template({ pair: this.pair }) )\n            .addClass( 'flex-column-container' );\n        return this;\n    },\n\n    events : {\n        'dragstart'         : '_dragstart',\n        'dragend'           : '_dragend',\n        'dragover'          : '_sendToParent',\n        'drop'              : '_sendToParent'\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragstart : function( ev ){\n        ev.currentTarget.style.opacity = '0.4';\n        if( ev.originalEvent ){ ev = ev.originalEvent; }\n\n        ev.dataTransfer.effectAllowed = 'move';\n        ev.dataTransfer.setData( 'text/plain', JSON.stringify( this.pair ) );\n\n        this.$el.parent().trigger( 'pair.dragstart', [ this ] );\n    },\n\n    /** dragging pairs for re-ordering */\n    _dragend : function( ev ){\n        ev.currentTarget.style.opacity = '1.0';\n        this.$el.parent().trigger( 'pair.dragend', [ this ] );\n    },\n\n    /** manually bubble up an event to the parent/container */\n    _sendToParent : function( ev ){\n        this.$el.parent().trigger( ev );\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'PairView(' + this.pair.name + ')';\n    }\n});\n\n\n// ============================================================================\n/** returns an autopair function that uses the provided options.match function */\nfunction autoPairFnBuilder( options ){\n    options = options || {};\n    options.createPair = options.createPair || function _defaultCreatePair( params ){\n        this.debug( 'creating pair:', params.listA[ params.indexA ].name, params.listB[ params.indexB ].name );\n        params = params || {};\n        return this._pair(\n            params.listA.splice( params.indexA, 1 )[0],\n            params.listB.splice( params.indexB, 1 )[0],\n            { silent: true }\n        );\n    };\n    // compile these here outside of the loop\n    var _regexps = [];\n    function getRegExps(){\n        if( !_regexps.length ){\n            _regexps = [\n                new RegExp( this.filters[0] ),\n                new RegExp( this.filters[1] )\n            ];\n        }\n        return _regexps;\n    }\n    // mangle params as needed\n    options.preprocessMatch = options.preprocessMatch || function _defaultPreprocessMatch( params ){\n        var regexps = getRegExps.call( this );\n        return _.extend( params, {\n            matchTo     : params.matchTo.name.replace( regexps[0], '' ),\n            possible    : params.possible.name.replace( regexps[1], '' )\n        });\n    };\n\n    return function _strategy( params ){\n        this.debug( 'autopair _strategy ---------------------------' );\n        params = params || {};\n        var listA = params.listA,\n            listB = params.listB,\n            indexA = 0, indexB,\n            bestMatch = {\n                score : 0.0,\n                index : null\n            },\n            paired = [];\n        //console.debug( 'params:', JSON.stringify( params, null, '  ' ) );\n        this.debug( 'starting list lens:', listA.length, listB.length );\n        this.debug( 'bestMatch (starting):', JSON.stringify( bestMatch, null, '  ' ) );\n\n        while( indexA < listA.length ){\n            var matchTo = listA[ indexA ];\n            bestMatch.score = 0.0;\n\n            for( indexB=0; indexB<listB.length; indexB++ ){\n                var possible = listB[ indexB ];\n                this.debug( indexA + ':' + matchTo.name );\n                this.debug( indexB + ':' + possible.name );\n\n                // no matching with self\n                if( listA[ indexA ] !== listB[ indexB ] ){\n                    bestMatch = options.match.call( this, options.preprocessMatch.call( this, {\n                        matchTo : matchTo,\n                        possible: possible,\n                        index   : indexB,\n                        bestMatch : bestMatch\n                    }));\n                    this.debug( 'bestMatch:', JSON.stringify( bestMatch, null, '  ' ) );\n                    if( bestMatch.score === 1.0 ){\n                        this.debug( 'breaking early due to perfect match' );\n                        break;\n                    }\n                }\n            }\n            var scoreThreshold = options.scoreThreshold.call( this );\n            this.debug( 'scoreThreshold:', scoreThreshold );\n            this.debug( 'bestMatch.score:', bestMatch.score );\n\n            if( bestMatch.score >= scoreThreshold ){\n                this.debug( 'creating pair' );\n                paired.push( options.createPair.call( this, {\n                    listA   : listA,\n                    indexA  : indexA,\n                    listB   : listB,\n                    indexB  : bestMatch.index\n                }));\n                this.debug( 'list lens now:', listA.length, listB.length );\n            } else {\n                indexA += 1;\n            }\n            if( !listA.length || !listB.length ){\n                return paired;\n            }\n        }\n        this.debug( 'paired:', JSON.stringify( paired, null, '  ' ) );\n        this.debug( 'autopair _strategy ---------------------------' );\n        return paired;\n    };\n}\n\n\n// ============================================================================\n/** An interface for building collections of paired datasets.\n */\nvar PairedCollectionCreator = Backbone.View.extend( baseMVC.LoggableMixin ).extend({\n\n    className: 'list-of-pairs-collection-creator collection-creator flex-row-container',\n\n    /** set up initial options, instance vars, behaviors, and autopair (if set to do so) */\n    initialize : function( attributes ){\n        this.metric( 'PairedCollectionCreator.initialize', attributes );\n        //this.debug( '-- PairedCollectionCreator:', attributes );\n\n        attributes = _.defaults( attributes, {\n            datasets            : [],\n            filters             : this.DEFAULT_FILTERS,\n            automaticallyPair   : true,\n            strategy            : 'lcs',\n            matchPercentage     : 0.9,\n            twoPassAutopairing  : true\n        });\n\n        /** unordered, original list */\n        this.initialList = attributes.datasets;\n\n        /** is this from a history? if so, what's its id? */\n        this.historyId = attributes.historyId;\n\n        /** which filters should be used initially? (String[2] or name in commonFilters) */\n        this.filters = this.commonFilters[ attributes.filters ] || this.commonFilters[ this.DEFAULT_FILTERS ];\n        if( _.isArray( attributes.filters ) ){\n            this.filters = attributes.filters;\n        }\n\n        /** try to auto pair the unpaired datasets on load? */\n        this.automaticallyPair = attributes.automaticallyPair;\n\n        /** what method to use for auto pairing (will be passed aggression level) */\n        this.strategy = this.strategies[ attributes.strategy ] || this.strategies[ this.DEFAULT_STRATEGY ];\n        if( _.isFunction( attributes.strategy ) ){\n            this.strategy = attributes.strategy;\n        }\n\n        /** distance/mismatch level allowed for autopairing */\n        this.matchPercentage = attributes.matchPercentage;\n\n        /** try to autopair using simple first, then this.strategy on the remainder */\n        this.twoPassAutopairing = attributes.twoPassAutopairing;\n\n        /** remove file extensions (\\.*) from created pair names? */\n        this.removeExtensions = true;\n        //this.removeExtensions = false;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.oncancel = attributes.oncancel;\n        /** fn to call when the collection is created (scoped to this) */\n        this.oncreate = attributes.oncreate;\n\n        /** fn to call when the cancel button is clicked (scoped to this) - if falsy, no btn is displayed */\n        this.autoscrollDist = attributes.autoscrollDist || 24;\n\n        /** is the unpaired panel shown? */\n        this.unpairedPanelHidden = false;\n        /** is the paired panel shown? */\n        this.pairedPanelHidden = false;\n\n        /** DOM elements currently being dragged */\n        this.$dragging = null;\n\n        /** Used for blocking UI events during ajax/operations (don't post twice) */\n        this.blocking = false;\n\n        this._setUpBehaviors();\n        this._dataSetUp();\n    },\n\n    /** map of common filter pairs by name */\n    commonFilters : {\n        illumina        : [ '_1', '_2' ],\n        Rs              : [ '_R1', '_R2' ]\n    },\n    /** which commonFilter to use by default */\n    DEFAULT_FILTERS : 'illumina',\n\n    /** map of name->fn for autopairing */\n    strategies : {\n        'simple'        : 'autopairSimple',\n        'lcs'           : 'autopairLCS',\n        'levenshtein'   : 'autopairLevenshtein'\n    },\n    /** default autopair strategy name */\n    DEFAULT_STRATEGY : 'lcs',\n\n    // ------------------------------------------------------------------------ process raw list\n    /** set up main data: cache initialList, sort, and autopair */\n    _dataSetUp : function(){\n        //this.debug( '-- _dataSetUp' );\n\n        this.paired = [];\n        this.unpaired = [];\n\n        this.selectedIds = [];\n\n        // sort initial list, add ids if needed, and save new working copy to unpaired\n        this._sortInitialList();\n        this._ensureIds();\n        this.unpaired = this.initialList.slice( 0 );\n\n        if( this.automaticallyPair ){\n            this.autoPair();\n            this.once( 'rendered:initial', function(){\n                this.trigger( 'autopair' );\n            });\n        }\n    },\n\n    /** sort initial list */\n    _sortInitialList : function(){\n        //this.debug( '-- _sortInitialList' );\n        this._sortDatasetList( this.initialList );\n    },\n\n    /** sort a list of datasets */\n    _sortDatasetList : function( list ){\n        // currently only natural sort by name\n        list.sort( function( a, b ){ return naturalSort( a.name, b.name ); });\n        return list;\n    },\n\n    /** add ids to dataset objs in initial list if none */\n    _ensureIds : function(){\n        this.initialList.forEach( function( dataset ){\n            if( !dataset.hasOwnProperty( 'id' ) ){\n                dataset.id = _.uniqueId();\n            }\n        });\n        return this.initialList;\n    },\n\n    /** split initial list into two lists, those that pass forward filters & those passing reverse */\n    _splitByFilters : function(){\n        var regexFilters = this.filters.map( function( stringFilter ){\n                return new RegExp( stringFilter );\n            }),\n            split = [ [], [] ];\n\n        function _filter( unpaired, filter ){\n            return filter.test( unpaired.name );\n            //return dataset.name.indexOf( filter ) >= 0;\n        }\n        this.unpaired.forEach( function _filterEach( unpaired ){\n            // 90% of the time this seems to work, but:\n            //TODO: this treats *all* strings as regex which may confuse people - possibly check for // surrounding?\n            //  would need explanation in help as well\n            regexFilters.forEach( function( filter, i ){\n                if( _filter( unpaired, filter ) ){\n                    split[i].push( unpaired );\n                }\n            });\n        });\n        return split;\n    },\n\n    /** add a dataset to the unpaired list in it's proper order */\n    _addToUnpaired : function( dataset ){\n        // currently, unpaired is natural sorted by name, use binary search to find insertion point\n        var binSearchSortedIndex = function( low, hi ){\n            if( low === hi ){ return low; }\n\n            var mid = Math.floor( ( hi - low ) / 2 ) + low,\n                compared = naturalSort( dataset.name, this.unpaired[ mid ].name );\n\n            if( compared < 0 ){\n                return binSearchSortedIndex( low, mid );\n            } else if( compared > 0 ){\n                return binSearchSortedIndex( mid + 1, hi );\n            }\n            // walk the equal to find the last\n            while( this.unpaired[ mid ] && this.unpaired[ mid ].name === dataset.name ){ mid++; }\n            return mid;\n\n        }.bind( this );\n\n        this.unpaired.splice( binSearchSortedIndex( 0, this.unpaired.length ), 0, dataset );\n    },\n\n    // ------------------------------------------------------------------------ auto pairing\n    /** two passes to automatically create pairs:\n     *  use both simpleAutoPair, then the fn mentioned in strategy\n     */\n    autoPair : function( strategy ){\n        // split first using exact matching\n        var split = this._splitByFilters(),\n            paired = [];\n        if( this.twoPassAutopairing ){\n            paired = this.autopairSimple({\n                listA : split[0],\n                listB : split[1]\n            });\n            split = this._splitByFilters();\n        }\n\n        // uncomment to see printlns while running tests\n        //this.debug = function(){ console.log.apply( console, arguments ); };\n\n        // then try the remainder with something less strict\n        strategy = strategy || this.strategy;\n        split = this._splitByFilters();\n        paired = paired.concat( this[ strategy ].call( this, {\n                listA : split[0],\n                listB : split[1]\n        }));\n        return paired;\n    },\n\n    /** autopair by exact match */\n    autopairSimple : autoPairFnBuilder({\n        scoreThreshold: function(){ return 1.0; },\n        match : function _match( params ){\n            params = params || {};\n            if( params.matchTo === params.possible ){\n                return {\n                    index: params.index,\n                    score: 1.0\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by levenshtein edit distance scoring */\n    autopairLevenshtein : autoPairFnBuilder({\n        scoreThreshold: function(){ return this.matchPercentage; },\n        match : function _matches( params ){\n            params = params || {};\n            var distance = levenshteinDistance( params.matchTo, params.possible ),\n                score = 1.0 - ( distance / ( Math.max( params.matchTo.length, params.possible.length ) ) );\n            if( score > params.bestMatch.score ){\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** autopair by longest common substrings scoring */\n    autopairLCS : autoPairFnBuilder({\n        scoreThreshold: function(){ return this.matchPercentage; },\n        match : function _matches( params ){\n            params = params || {};\n            var match = this._naiveStartingAndEndingLCS( params.matchTo, params.possible ).length,\n                score = match / ( Math.max( params.matchTo.length, params.possible.length ) );\n            if( score > params.bestMatch.score ){\n                return {\n                    index: params.index,\n                    score: score\n                };\n            }\n            return params.bestMatch;\n        }\n    }),\n\n    /** return the concat'd longest common prefix and suffix from two strings */\n    _naiveStartingAndEndingLCS : function( s1, s2 ){\n        var fwdLCS = '',\n            revLCS = '',\n            i = 0, j = 0;\n        while( i < s1.length && i < s2.length ){\n            if( s1[ i ] !== s2[ i ] ){\n                break;\n            }\n            fwdLCS += s1[ i ];\n            i += 1;\n        }\n        if( i === s1.length ){ return s1; }\n        if( i === s2.length ){ return s2; }\n\n        i = ( s1.length - 1 );\n        j = ( s2.length - 1 );\n        while( i >= 0 && j >= 0 ){\n            if( s1[ i ] !== s2[ j ] ){\n                break;\n            }\n            revLCS = [ s1[ i ], revLCS ].join( '' );\n            i -= 1;\n            j -= 1;\n        }\n        return fwdLCS + revLCS;\n    },\n\n    // ------------------------------------------------------------------------ pairing / unpairing\n    /** create a pair from fwd and rev, removing them from unpaired, and placing the new pair in paired */\n    _pair : function( fwd, rev, options ){\n        options = options || {};\n        //this.debug( '_pair:', fwd, rev );\n        var pair = this._createPair( fwd, rev, options.name );\n        this.paired.push( pair );\n        this.unpaired = _.without( this.unpaired, fwd, rev );\n        if( !options.silent ){\n            this.trigger( 'pair:new', pair );\n        }\n        return pair;\n    },\n\n    /** create a pair Object from fwd and rev, adding the name attribute (will guess if not given) */\n    _createPair : function( fwd, rev, name ){\n        // ensure existance and don't pair something with itself\n        if( !( fwd && rev ) || ( fwd === rev ) ){\n            throw new Error( 'Bad pairing: ' + [ JSON.stringify( fwd ), JSON.stringify( rev ) ] );\n        }\n        name = name || this._guessNameForPair( fwd, rev );\n        return { forward : fwd, name : name, reverse : rev };\n    },\n\n    /** try to find a good pair name for the given fwd and rev datasets */\n    _guessNameForPair : function( fwd, rev, removeExtensions ){\n        removeExtensions = ( removeExtensions !== undefined )?( removeExtensions ):( this.removeExtensions );\n        var fwdName = fwd.name,\n            revName = rev.name,\n            lcs = this._naiveStartingAndEndingLCS(\n                fwdName.replace( this.filters[0], '' ),\n                revName.replace( this.filters[1], '' )\n            );\n        if( removeExtensions ){\n            var lastDotIndex = lcs.lastIndexOf( '.' );\n            if( lastDotIndex > 0 ){\n                var extension = lcs.slice( lastDotIndex, lcs.length );\n                lcs = lcs.replace( extension, '' );\n                fwdName = fwdName.replace( extension, '' );\n                revName = revName.replace( extension, '' );\n            }\n        }\n        return lcs || ( fwdName + ' & ' + revName );\n    },\n\n    /** unpair a pair, removing it from paired, and adding the fwd,rev datasets back into unpaired */\n    _unpair : function( pair, options ){\n        options = options || {};\n        if( !pair ){\n            throw new Error( 'Bad pair: ' + JSON.stringify( pair ) );\n        }\n        this.paired = _.without( this.paired, pair );\n        this._addToUnpaired( pair.forward );\n        this._addToUnpaired( pair.reverse );\n\n        if( !options.silent ){\n            this.trigger( 'pair:unpair', [ pair ] );\n        }\n        return pair;\n    },\n\n    /** unpair all paired datasets */\n    unpairAll : function(){\n        var pairs = [];\n        while( this.paired.length ){\n            pairs.push( this._unpair( this.paired[ 0 ], { silent: true }) );\n        }\n        this.trigger( 'pair:unpair', pairs );\n    },\n\n    // ------------------------------------------------------------------------ API\n    /** convert a pair into JSON compatible with the collections API */\n    _pairToJSON : function( pair, src ){\n        src = src || 'hda';\n        //TODO: consider making this the pair structure when created instead\n        return {\n            collection_type : 'paired',\n            src             : 'new_collection',\n            name            : pair.name,\n            element_identifiers : [{\n                name    : 'forward',\n                id      : pair.forward.id,\n                src     : src\n            }, {\n                name    : 'reverse',\n                id      : pair.reverse.id,\n                src     : src\n            }]\n        };\n    },\n\n    /** create the collection via the API\n     *  @returns {jQuery.xhr Object}    the jquery ajax request\n     */\n    createList : function( name ){\n        var creator = this,\n            root = ( window.Galaxy && Galaxy.options.root )? Galaxy.options.root : '/',\n            url = root + 'api/histories/' + this.historyId + '/contents/dataset_collections';\n\n        //TODO: use ListPairedCollection.create()\n        var ajaxData = {\n            type            : 'dataset_collection',\n            collection_type : 'list:paired',\n            name            : _.escape( name || creator.$( '.collection-name' ).val() ),\n            element_identifiers : creator.paired.map( function( pair ){\n                return creator._pairToJSON( pair );\n            })\n\n        };\n        //this.debug( JSON.stringify( ajaxData ) );\n        creator.blocking = true;\n        return jQuery.ajax( url, {\n            type        : 'POST',\n            contentType : 'application/json',\n            dataType    : 'json',\n            data        : JSON.stringify( ajaxData )\n        })\n        .always( function(){\n            creator.blocking = false;\n        })\n        .fail( function( xhr, status, message ){\n            creator._ajaxErrHandler( xhr, status, message );\n        })\n        .done( function( response, message, xhr ){\n            //this.info( 'ok', response, message, xhr );\n            creator.trigger( 'collection:created', response, message, xhr );\n            creator.metric( 'collection:created', response );\n            if( typeof creator.oncreate === 'function' ){\n                creator.oncreate.call( this, response, message, xhr );\n            }\n        });\n    },\n\n    /** handle ajax errors with feedback and details to the user (if available) */\n    _ajaxErrHandler : function( xhr, status, message ){\n        this.error( xhr, status, message );\n        var content = _l( 'An error occurred while creating this collection' );\n        if( xhr ){\n            if( xhr.readyState === 0 && xhr.status === 0 ){\n                content += ': ' + _l( 'Galaxy could not be reached and may be updating.' )\n                    + _l( ' Try again in a few minutes.' );\n            } else if( xhr.responseJSON ){\n                content += '<br /><pre>' + JSON.stringify( xhr.responseJSON ) + '</pre>';\n            } else {\n                content += ': ' + message;\n            }\n        }\n        creator._showAlert( content, 'alert-danger' );\n    },\n\n    // ------------------------------------------------------------------------ rendering\n    /** render the entire interface */\n    render : function( speed, callback ){\n        //this.debug( '-- _render' );\n        //this.$el.empty().html( PairedCollectionCreator.templates.main() );\n        this.$el.empty().html( PairedCollectionCreator.templates.main() );\n        this._renderHeader( speed );\n        this._renderMiddle( speed );\n        this._renderFooter( speed );\n        this._addPluginComponents();\n        this.trigger( 'rendered', this );\n        return this;\n    },\n\n    /** render the header section */\n    _renderHeader : function( speed, callback ){\n        //this.debug( '-- _renderHeader' );\n        var $header = this.$( '.header' ).empty().html( PairedCollectionCreator.templates.header() )\n            .find( '.help-content' ).prepend( $( PairedCollectionCreator.templates.helpContent() ) );\n\n        this._renderFilters();\n        return $header;\n    },\n    /** fill the filter inputs with the filter values */\n    _renderFilters : function(){\n        return    this.$( '.forward-column .column-header input' ).val( this.filters[0] )\n            .add( this.$( '.reverse-column .column-header input' ).val( this.filters[1] ) );\n    },\n\n    /** render the middle including unpaired and paired sections (which may be hidden) */\n    _renderMiddle : function( speed, callback ){\n        var $middle = this.$( '.middle' ).empty().html( PairedCollectionCreator.templates.middle() );\n\n        // (re-) hide the un/paired panels based on instance vars\n        if( this.unpairedPanelHidden ){\n            this.$( '.unpaired-columns' ).hide();\n        } else if( this.pairedPanelHidden ){\n            this.$( '.paired-columns' ).hide();\n        }\n\n        this._renderUnpaired();\n        this._renderPaired();\n        return $middle;\n    },\n    /** render the unpaired section, showing datasets accrd. to filters, update the unpaired counts */\n    _renderUnpaired : function( speed, callback ){\n        //this.debug( '-- _renderUnpaired' );\n        var creator = this,\n            $fwd, $rev, $prd = [],\n            split = this._splitByFilters();\n        // update unpaired counts\n        this.$( '.forward-column .title' )\n            .text([ split[0].length, _l( 'unpaired forward' ) ].join( ' ' ));\n        this.$( '.forward-column .unpaired-info' )\n            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[0].length ) );\n        this.$( '.reverse-column .title' )\n            .text([ split[1].length, _l( 'unpaired reverse' ) ].join( ' ' ));\n        this.$( '.reverse-column .unpaired-info' )\n            .text( this._renderUnpairedDisplayStr( this.unpaired.length - split[1].length ) );\n\n        this.$( '.unpaired-columns .column-datasets' ).empty();\n\n        // show/hide the auto pair button if any unpaired are left\n        this.$( '.autopair-link' ).toggle( this.unpaired.length !== 0 );\n        if( this.unpaired.length === 0 ){\n            this._renderUnpairedEmpty();\n            return;\n        }\n\n        // create the dataset dom arrays\n        $rev = split[1].map( function( dataset, i ){\n            // if there'll be a fwd dataset across the way, add a button to pair the row\n            if( ( split[0][ i ] !== undefined )\n            &&  ( split[0][ i ] !== dataset ) ){\n                $prd.push( creator._renderPairButton() );\n            }\n            return creator._renderUnpairedDataset( dataset );\n        });\n        $fwd = split[0].map( function( dataset ){\n            return creator._renderUnpairedDataset( dataset );\n        });\n\n        if( !$fwd.length && !$rev.length ){\n            this._renderUnpairedNotShown();\n            return;\n        }\n        // add to appropo cols\n        //TODO: not the best way to render - consider rendering the entire unpaired-columns section in a fragment\n        //  and swapping out that\n        this.$( '.unpaired-columns .forward-column .column-datasets' ).append( $fwd )\n            .add( this.$( '.unpaired-columns .paired-column .column-datasets' ).append( $prd ) )\n            .add( this.$( '.unpaired-columns .reverse-column .column-datasets' ).append( $rev ) );\n        this._adjUnpairedOnScrollbar();\n    },\n    /** return a string to display the count of filtered out datasets */\n    _renderUnpairedDisplayStr : function( numFiltered ){\n        return [ '(', numFiltered, ' ', _l( 'filtered out' ), ')' ].join('');\n    },\n    /** return an unattached jQuery DOM element to represent an unpaired dataset */\n    _renderUnpairedDataset : function( dataset ){\n        //TODO: to underscore template\n        return $( '<li/>')\n            .attr( 'id', 'dataset-' + dataset.id )\n            .addClass( 'dataset unpaired' )\n            .attr( 'draggable', true )\n            .addClass( dataset.selected? 'selected': '' )\n            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( dataset.name ) )\n            //??\n            .data( 'dataset', dataset );\n    },\n    /** render the button that may go between unpaired datasets, allowing the user to pair a row */\n    _renderPairButton : function(){\n        //TODO: *not* a dataset - don't pretend like it is\n        return $( '<li/>').addClass( 'dataset unpaired' )\n            .append( $( '<span/>' ).addClass( 'dataset-name' ).text( _l( 'Pair these datasets' ) ) );\n    },\n    /** a message to display when no unpaired left */\n    _renderUnpairedEmpty : function(){\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no remaining unpaired datasets' ) + ')' );\n        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n    /** a message to display when no unpaired can be shown with the current filters */\n    _renderUnpairedNotShown : function(){\n        //this.debug( '-- renderUnpairedEmpty' );\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no datasets were found matching the current filters' ) + ')' );\n        this.$( '.unpaired-columns .paired-column .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n    /** try to detect if the unpaired section has a scrollbar and adjust left column for better centering of all */\n    _adjUnpairedOnScrollbar : function(){\n        var $unpairedColumns = this.$( '.unpaired-columns' ).last(),\n            $firstDataset = this.$( '.unpaired-columns .reverse-column .dataset' ).first();\n        if( !$firstDataset.size() ){ return; }\n        var ucRight = $unpairedColumns.offset().left + $unpairedColumns.outerWidth(),\n            dsRight = $firstDataset.offset().left + $firstDataset.outerWidth(),\n            rightDiff = Math.floor( ucRight ) - Math.floor( dsRight );\n        //this.debug( 'rightDiff:', ucRight, '-', dsRight, '=', rightDiff );\n        this.$( '.unpaired-columns .forward-column' )\n            .css( 'margin-left', ( rightDiff > 0 )? rightDiff: 0 );\n    },\n\n    /** render the paired section and update counts of paired datasets */\n    _renderPaired : function( speed, callback ){\n        //this.debug( '-- _renderPaired' );\n        this.$( '.paired-column-title .title' ).text([ this.paired.length, _l( 'paired' ) ].join( ' ' ) );\n        // show/hide the unpair all link\n        this.$( '.unpair-all-link' ).toggle( this.paired.length !== 0 );\n        if( this.paired.length === 0 ){\n            this._renderPairedEmpty();\n            return;\n            //TODO: would be best to return here (the $columns)\n        } else {\n            // show/hide 'remove extensions link' when any paired and they seem to have extensions\n            this.$( '.remove-extensions-link' ).show();\n        }\n\n        this.$( '.paired-columns .column-datasets' ).empty();\n        var creator = this;\n        this.paired.forEach( function( pair, i ){\n            //TODO: cache these?\n            var pairView = new PairView({ pair: pair });\n            creator.$( '.paired-columns .column-datasets' )\n                .append( pairView.render().$el )\n                .append([\n                    '<button class=\"unpair-btn\">',\n                        '<span class=\"fa fa-unlink\" title=\"', _l( 'Unpair' ), '\"></span>',\n                    '</button>'\n                ].join( '' ));\n        });\n    },\n    /** a message to display when none paired */\n    _renderPairedEmpty : function(){\n        var $msg = $( '<div class=\"empty-message\"></div>' )\n            .text( '(' + _l( 'no paired datasets yet' ) + ')' );\n        this.$( '.paired-columns .column-datasets' ).empty().prepend( $msg );\n        return $msg;\n    },\n\n    /** render the footer, completion controls, and cancel controls */\n    _renderFooter : function( speed, callback ){\n        var $footer = this.$( '.footer' ).empty().html( PairedCollectionCreator.templates.footer() );\n        this.$( '.remove-extensions' ).prop( 'checked', this.removeExtensions );\n        if( typeof this.oncancel === 'function' ){\n            this.$( '.cancel-create.btn' ).show();\n        }\n        return $footer;\n    },\n\n    /** add any jQuery/bootstrap/custom plugins to elements rendered */\n    _addPluginComponents : function(){\n        this._chooseFiltersPopover( '.choose-filters-link' );\n        this.$( '.help-content i' ).hoverhighlight( '.collection-creator', 'rgba( 64, 255, 255, 1.0 )' );\n    },\n\n    /** build a filter selection popover allowing selection of common filter pairs */\n    _chooseFiltersPopover : function( selector ){\n        function filterChoice( val1, val2 ){\n            return [\n                '<button class=\"filter-choice btn\" ',\n                        'data-forward=\"', val1, '\" data-reverse=\"', val2, '\">',\n                    _l( 'Forward' ), ': ', val1, ', ',\n                    _l( 'Reverse' ), ': ', val2,\n                '</button>'\n            ].join('');\n        }\n        var $popoverContent = $( _.template([\n            '<div class=\"choose-filters\">',\n                '<div class=\"help\">',\n                    _l( 'Choose from the following filters to change which unpaired reads are shown in the display' ),\n                ':</div>',\n                _.values( this.commonFilters ).map( function( filterSet ){\n                    return filterChoice( filterSet[0], filterSet[1] );\n                }).join( '' ),\n            '</div>'\n        ].join(''))({}));\n\n        return this.$( selector ).popover({\n            container   : '.collection-creator',\n            placement   : 'bottom',\n            html        : true,\n            //animation   : false,\n            content     : $popoverContent\n        });\n    },\n\n    /** add (or clear if clear is truthy) a validation warning to what */\n    _validationWarning : function( what, clear ){\n        var VALIDATION_CLASS = 'validation-warning';\n        if( what === 'name' ){\n            what = this.$( '.collection-name' ).add( this.$( '.collection-name-prompt' ) );\n            this.$( '.collection-name' ).focus().select();\n        }\n        if( clear ){\n            what = what || this.$( '.' + VALIDATION_CLASS );\n            what.removeClass( VALIDATION_CLASS );\n        } else {\n            what.addClass( VALIDATION_CLASS );\n        }\n    },\n\n    // ------------------------------------------------------------------------ events\n    /** set up event handlers on self */\n    _setUpBehaviors : function(){\n        this.once( 'rendered', function(){\n            this.trigger( 'rendered:initial', this );\n        });\n\n        this.on( 'pair:new', function(){\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n\n            // scroll to bottom where new pairs are added\n            //TODO: this doesn't seem to work - innerHeight sticks at 133...\n            //  may have to do with improper flex columns\n            //var $pairedView = this.$( '.paired-columns' );\n            //$pairedView.scrollTop( $pairedView.innerHeight() );\n            //this.debug( $pairedView.height() )\n            this.$( '.paired-columns' ).scrollTop( 8000000 );\n        });\n        this.on( 'pair:unpair', function( pairs ){\n            //TODO: ideally only re-render the columns (or even elements) involved\n            this._renderUnpaired();\n            this._renderPaired();\n            this.splitView();\n        });\n\n        this.on( 'filter-change', function(){\n            this.filters = [\n                this.$( '.forward-unpaired-filter input' ).val(),\n                this.$( '.reverse-unpaired-filter input' ).val()\n            ];\n            this.metric( 'filter-change', this.filters );\n            this._renderFilters();\n            this._renderUnpaired();\n        });\n\n        this.on( 'autopair', function(){\n            this._renderUnpaired();\n            this._renderPaired();\n\n            var message, msgClass = null;\n            if( this.paired.length ){\n                msgClass = 'alert-success';\n                message = this.paired.length + ' ' + _l( 'pairs created' );\n                if( !this.unpaired.length ){\n                    message += ': ' + _l( 'all datasets have been successfully paired' );\n                    this.hideUnpaired();\n                    this.$( '.collection-name' ).focus();\n                }\n            } else {\n                message = _l( 'Could not automatically create any pairs from the given dataset names' );\n            }\n            this._showAlert( message, msgClass );\n        });\n\n        //this.on( 'all', function(){\n        //    this.info( arguments );\n        //});\n        return this;\n    },\n\n    events : {\n        // header\n        'click .more-help'                          : '_clickMoreHelp',\n        'click .less-help'                          : '_clickLessHelp',\n        'click .header .alert button'               : '_hideAlert',\n        'click .forward-column .column-title'       : '_clickShowOnlyUnpaired',\n        'click .reverse-column .column-title'       : '_clickShowOnlyUnpaired',\n        'click .unpair-all-link'                    : '_clickUnpairAll',\n        //TODO: this seems kinda backasswards - re-sending jq event as a backbone event, can we listen directly?\n        'change .forward-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n        'focus .forward-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n        'click .autopair-link'                      : '_clickAutopair',\n        'click .choose-filters .filter-choice'      : '_clickFilterChoice',\n        'click .clear-filters-link'                 : '_clearFilters',\n        'change .reverse-unpaired-filter input'     : function( ev ){ this.trigger( 'filter-change' ); },\n        'focus .reverse-unpaired-filter input'      : function( ev ){ $( ev.currentTarget ).select(); },\n        // unpaired\n        'click .forward-column .dataset.unpaired'   : '_clickUnpairedDataset',\n        'click .reverse-column .dataset.unpaired'   : '_clickUnpairedDataset',\n        'click .paired-column .dataset.unpaired'    : '_clickPairRow',\n        'click .unpaired-columns'                   : 'clearSelectedUnpaired',\n        'mousedown .unpaired-columns .dataset'      : '_mousedownUnpaired',\n        // divider\n        'click .paired-column-title'                : '_clickShowOnlyPaired',\n        'mousedown .flexible-partition-drag'        : '_startPartitionDrag',\n        // paired\n        'click .paired-columns .dataset.paired'     : 'selectPair',\n        'click .paired-columns'                     : 'clearSelectedPaired',\n        'click .paired-columns .pair-name'          : '_clickPairName',\n        'click .unpair-btn'                         : '_clickUnpair',\n        // paired - drop target\n        //'dragenter .paired-columns'                 : '_dragenterPairedColumns',\n        //'dragleave .paired-columns .column-datasets': '_dragleavePairedColumns',\n        'dragover .paired-columns .column-datasets' : '_dragoverPairedColumns',\n        'drop .paired-columns .column-datasets'     : '_dropPairedColumns',\n\n        'pair.dragstart .paired-columns .column-datasets' : '_pairDragstart',\n        'pair.dragend   .paired-columns .column-datasets' : '_pairDragend',\n\n        // footer\n        'change .remove-extensions'                 : function( ev ){ this.toggleExtensions(); },\n        'change .collection-name'                   : '_changeName',\n        'keydown .collection-name'                  : '_nameCheckForEnter',\n        'click .cancel-create'                      : function( ev ){\n            if( typeof this.oncancel === 'function' ){\n                this.oncancel.call( this );\n            }\n        },\n        'click .create-collection'                  : '_clickCreate'//,\n    },\n\n    // ........................................................................ header\n    /** expand help */\n    _clickMoreHelp : function( ev ){\n        this.$( '.main-help' ).addClass( 'expanded' );\n        this.$( '.more-help' ).hide();\n    },\n    /** collapse help */\n    _clickLessHelp : function( ev ){\n        this.$( '.main-help' ).removeClass( 'expanded' );\n        this.$( '.more-help' ).show();\n    },\n\n    /** show an alert on the top of the interface containing message (alertClass is bootstrap's alert-*)*/\n    _showAlert : function( message, alertClass ){\n        alertClass = alertClass || 'alert-danger';\n        this.$( '.main-help' ).hide();\n        this.$( '.header .alert' ).attr( 'class', 'alert alert-dismissable' ).addClass( alertClass ).show()\n            .find( '.alert-message' ).html( message );\n    },\n    /** hide the alerts at the top */\n    _hideAlert : function( message ){\n        this.$( '.main-help' ).show();\n        this.$( '.header .alert' ).hide();\n    },\n\n    /** toggle between showing only unpaired and split view */\n    _clickShowOnlyUnpaired : function( ev ){\n        //this.debug( 'click unpaired', ev.currentTarget );\n        if( this.$( '.paired-columns' ).is( ':visible' ) ){\n            this.hidePaired();\n        } else {\n            this.splitView();\n        }\n    },\n    /** toggle between showing only paired and split view */\n    _clickShowOnlyPaired : function( ev ){\n        //this.debug( 'click paired' );\n        if( this.$( '.unpaired-columns' ).is( ':visible' ) ){\n            this.hideUnpaired();\n        } else {\n            this.splitView();\n        }\n    },\n\n    /** hide unpaired, show paired */\n    hideUnpaired : function( speed, callback ){\n        this.unpairedPanelHidden = true;\n        this.pairedPanelHidden = false;\n        this._renderMiddle( speed, callback );\n    },\n    /** hide paired, show unpaired */\n    hidePaired : function( speed, callback ){\n        this.unpairedPanelHidden = false;\n        this.pairedPanelHidden = true;\n        this._renderMiddle( speed, callback );\n    },\n    /** show both paired and unpaired (splitting evenly) */\n    splitView : function( speed, callback ){\n        this.unpairedPanelHidden = this.pairedPanelHidden = false;\n        this._renderMiddle( speed, callback );\n        return this;\n    },\n\n    /** unpair all paired and do other super neat stuff which I'm not really sure about yet... */\n    _clickUnpairAll : function( ev ){\n        this.metric( 'unpairAll' );\n        this.unpairAll();\n    },\n\n    /** attempt to autopair */\n    _clickAutopair : function( ev ){\n        var paired = this.autoPair();\n        this.metric( 'autopair', paired.length, this.unpaired.length );\n        this.trigger( 'autopair' );\n    },\n\n    /** set the filters based on the data attributes of the button click target */\n    _clickFilterChoice : function( ev ){\n        var $selected = $( ev.currentTarget );\n        this.$( '.forward-unpaired-filter input' ).val( $selected.data( 'forward' ) );\n        this.$( '.reverse-unpaired-filter input' ).val( $selected.data( 'reverse' ) );\n        this._hideChooseFilters();\n        this.trigger( 'filter-change' );\n    },\n\n    /** hide the choose filters popover */\n    _hideChooseFilters : function(){\n        //TODO: update bootstrap and remove the following hack\n        //  see also: https://github.com/twbs/bootstrap/issues/10260\n        this.$( '.choose-filters-link' ).popover( 'hide' );\n        this.$( '.popover' ).css( 'display', 'none' );\n    },\n\n    /** clear both filters */\n    _clearFilters : function( ev ){\n        this.$( '.forward-unpaired-filter input' ).val( '' );\n        this.$( '.reverse-unpaired-filter input' ).val( '' );\n        this.trigger( 'filter-change' );\n    },\n\n    // ........................................................................ unpaired\n    /** select an unpaired dataset */\n    _clickUnpairedDataset : function( ev ){\n        ev.stopPropagation();\n        return this.toggleSelectUnpaired( $( ev.currentTarget ) );\n    },\n\n    /** Toggle the selection of an unpaired dataset representation.\n     *  @param [jQuery] $dataset        the unpaired dataset dom rep to select\n     *  @param [Boolean] options.force  if defined, force selection based on T/F; otherwise, toggle\n     */\n    toggleSelectUnpaired : function( $dataset, options ){\n        options = options || {};\n        var dataset = $dataset.data( 'dataset' ),\n            select = options.force !== undefined? options.force: !$dataset.hasClass( 'selected' );\n        //this.debug( id, options.force, $dataset, dataset );\n        if( !$dataset.size() || dataset === undefined ){ return $dataset; }\n\n        if( select ){\n            $dataset.addClass( 'selected' );\n            if( !options.waitToPair ){\n                this.pairAllSelected();\n            }\n\n        } else {\n            $dataset.removeClass( 'selected' );\n            //delete dataset.selected;\n        }\n        return $dataset;\n    },\n\n    /** pair all the currently selected unpaired datasets */\n    pairAllSelected : function( options ){\n        options = options || {};\n        var creator = this,\n            fwds = [],\n            revs = [],\n            pairs = [];\n        creator.$( '.unpaired-columns .forward-column .dataset.selected' ).each( function(){\n            fwds.push( $( this ).data( 'dataset' ) );\n        });\n        creator.$( '.unpaired-columns .reverse-column .dataset.selected' ).each( function(){\n            revs.push( $( this ).data( 'dataset' ) );\n        });\n        fwds.length = revs.length = Math.min( fwds.length, revs.length );\n        //this.debug( fwds );\n        //this.debug( revs );\n        fwds.forEach( function( fwd, i ){\n            try {\n                pairs.push( creator._pair( fwd, revs[i], { silent: true }) );\n\n            } catch( err ){\n                //TODO: preserve selected state of those that couldn't be paired\n                //TODO: warn that some could not be paired\n                creator.error( err );\n            }\n        });\n        if( pairs.length && !options.silent ){\n            this.trigger( 'pair:new', pairs );\n        }\n        return pairs;\n    },\n\n    /** clear the selection on all unpaired datasets */\n    clearSelectedUnpaired : function(){\n        this.$( '.unpaired-columns .dataset.selected' ).removeClass( 'selected' );\n    },\n\n    /** when holding down the shift key on a click, 'paint' the moused over datasets as selected */\n    _mousedownUnpaired : function( ev ){\n        if( ev.shiftKey ){\n            var creator = this,\n                $startTarget = $( ev.target ).addClass( 'selected' ),\n                moveListener = function( ev ){\n                    creator.$( ev.target ).filter( '.dataset' ).addClass( 'selected' );\n                };\n            $startTarget.parent().on( 'mousemove', moveListener );\n\n            // on any mouseup, stop listening to the move and try to pair any selected\n            $( document ).one( 'mouseup', function( ev ){\n                $startTarget.parent().off( 'mousemove', moveListener );\n                creator.pairAllSelected();\n            });\n        }\n    },\n\n    /** attempt to pair two datasets directly across from one another */\n    _clickPairRow : function( ev ){\n        //if( !ev.currentTarget ){ return true; }\n        var rowIndex = $( ev.currentTarget ).index(),\n            fwd = $( '.unpaired-columns .forward-column .dataset' ).eq( rowIndex ).data( 'dataset' ),\n            rev = $( '.unpaired-columns .reverse-column .dataset' ).eq( rowIndex ).data( 'dataset' );\n        //this.debug( 'row:', rowIndex, fwd, rev );\n        this._pair( fwd, rev );\n    },\n\n    // ........................................................................ divider/partition\n    /** start dragging the visible divider/partition between unpaired and paired panes */\n    _startPartitionDrag : function( ev ){\n        var creator = this,\n            startingY = ev.pageY;\n        //this.debug( 'partition drag START:', ev );\n        $( 'body' ).css( 'cursor', 'ns-resize' );\n        creator.$( '.flexible-partition-drag' ).css( 'color', 'black' );\n\n        function endDrag( ev ){\n            //creator.debug( 'partition drag STOP:', ev );\n            // doing this by an added class didn't really work well - kept flashing still\n            creator.$( '.flexible-partition-drag' ).css( 'color', '' );\n            $( 'body' ).css( 'cursor', '' ).unbind( 'mousemove', trackMouse );\n        }\n        function trackMouse( ev ){\n            var offset = ev.pageY - startingY;\n            //creator.debug( 'partition:', startingY, offset );\n            if( !creator.adjPartition( offset ) ){\n                //creator.debug( 'mouseup triggered' );\n                $( 'body' ).trigger( 'mouseup' );\n            }\n            creator._adjUnpairedOnScrollbar();\n            startingY += offset;\n        }\n        $( 'body' ).mousemove( trackMouse );\n        $( 'body' ).one( 'mouseup', endDrag );\n    },\n\n    /** adjust the parition up/down +/-adj pixels */\n    adjPartition : function( adj ){\n        var $unpaired = this.$( '.unpaired-columns' ),\n            $paired = this.$( '.paired-columns' ),\n            unpairedHi = parseInt( $unpaired.css( 'height' ), 10 ),\n            pairedHi = parseInt( $paired.css( 'height' ), 10 );\n        //this.debug( adj, 'hi\\'s:', unpairedHi, pairedHi, unpairedHi + adj, pairedHi - adj );\n\n        unpairedHi = Math.max( 10, unpairedHi + adj );\n        pairedHi = pairedHi - adj;\n\n        var movingUpwards = adj < 0;\n        // when the divider gets close to the top - lock into hiding the unpaired section\n        if( movingUpwards ){\n            if( this.unpairedPanelHidden ){\n                return false;\n            } else if( unpairedHi <= 10 ){\n                this.hideUnpaired();\n                return false;\n            }\n        } else {\n            if( this.unpairedPanelHidden ){\n                $unpaired.show();\n                this.unpairedPanelHidden = false;\n            }\n        }\n\n        // when the divider gets close to the bottom - lock into hiding the paired section\n        if( !movingUpwards ){\n            if( this.pairedPanelHidden ){\n                return false;\n            } else if( pairedHi <= 15 ){\n                this.hidePaired();\n                return false;\n            }\n\n        } else {\n            if( this.pairedPanelHidden ){\n                $paired.show();\n                this.pairedPanelHidden = false;\n            }\n        }\n\n        $unpaired.css({\n            height  : unpairedHi + 'px',\n            flex    : '0 0 auto'\n        });\n        return true;\n    },\n\n    // ........................................................................ paired\n    /** select a pair when clicked */\n    selectPair : function( ev ){\n        ev.stopPropagation();\n        $( ev.currentTarget ).toggleClass( 'selected' );\n    },\n\n    /** deselect all pairs */\n    clearSelectedPaired : function( ev ){\n        this.$( '.paired-columns .dataset.selected' ).removeClass( 'selected' );\n    },\n\n    /** rename a pair when the pair name is clicked */\n    _clickPairName : function( ev ){\n        ev.stopPropagation();\n        var $name = $( ev.currentTarget ),\n            $pair = $name.parent().parent(),\n            index = $pair.index( '.dataset.paired' ),\n            pair = this.paired[ index ],\n            response = prompt( 'Enter a new name for the pair:', pair.name );\n        if( response ){\n            pair.name = response;\n            // set a flag (which won't be passed in json creation) for manual naming so we don't overwrite these\n            //  when adding/removing extensions\n            //hackish\n            pair.customizedName = true;\n            $name.text( pair.name );\n        }\n    },\n\n    /** unpair this pair */\n    _clickUnpair : function( ev ){\n        //if( !ev.currentTarget ){ return true; }\n        var pairIndex = Math.floor( $( ev.currentTarget ).index( '.unpair-btn' ) );\n        //this.debug( 'pair:', pairIndex );\n        this._unpair( this.paired[ pairIndex ] );\n    },\n\n    // ........................................................................ paired - drag and drop re-ordering\n    //_dragenterPairedColumns : function( ev ){\n    //    this.debug( '_dragenterPairedColumns:', ev );\n    //},\n    //_dragleavePairedColumns : function( ev ){\n    //    //this.debug( '_dragleavePairedColumns:', ev );\n    //},\n    /** track the mouse drag over the paired list adding a placeholder to show where the drop would occur */\n    _dragoverPairedColumns : function( ev ){\n        //this.debug( '_dragoverPairedColumns:', ev );\n        ev.preventDefault();\n\n        var $list = this.$( '.paired-columns .column-datasets' );\n        this._checkForAutoscroll( $list, ev.originalEvent.clientY );\n        //this.debug( ev.originalEvent.clientX, ev.originalEvent.clientY );\n        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n\n        $( '.element-drop-placeholder' ).remove();\n        var $placeholder = $( '<div class=\"element-drop-placeholder\"></div>' );\n        if( !$nearest.size() ){\n            $list.append( $placeholder );\n        } else {\n            $nearest.before( $placeholder );\n        }\n    },\n\n    /** If the mouse is near enough to the list's top or bottom, scroll the list */\n    _checkForAutoscroll : function( $element, y ){\n        var AUTOSCROLL_SPEED = 2;\n        var offset = $element.offset(),\n            scrollTop = $element.scrollTop(),\n            upperDist = y - offset.top,\n            lowerDist = ( offset.top + $element.outerHeight() ) - y;\n        //this.debug( '_checkForAutoscroll:', scrollTop, upperDist, lowerDist );\n        if( upperDist >= 0 && upperDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop - AUTOSCROLL_SPEED );\n        } else if( lowerDist >= 0 && lowerDist < this.autoscrollDist ){\n            $element.scrollTop( scrollTop + AUTOSCROLL_SPEED );\n        }\n    },\n\n    /** get the nearest *previous* paired dataset PairView based on the mouse's Y coordinate.\n     *      If the y is at the end of the list, return an empty jQuery object.\n     */\n    _getNearestPairedDatasetLi : function( y ){\n        var WIGGLE = 4,\n            lis = this.$( '.paired-columns .column-datasets li' ).toArray();\n        for( var i=0; i<lis.length; i++ ){\n            var $li = $( lis[i] ),\n                top = $li.offset().top,\n                halfHeight = Math.floor( $li.outerHeight() / 2 ) + WIGGLE;\n            if( top + halfHeight > y && top - halfHeight < y ){\n                //this.debug( y, top + halfHeight, top - halfHeight )\n                return $li;\n            }\n        }\n        return $();\n    },\n    /** drop (dragged/selected PairViews) onto the list, re-ordering both the DOM and the internal array of pairs */\n    _dropPairedColumns : function( ev ){\n        // both required for firefox\n        ev.preventDefault();\n        ev.dataTransfer.dropEffect = 'move';\n\n        var $nearest = this._getNearestPairedDatasetLi( ev.originalEvent.clientY );\n        if( $nearest.size() ){\n            this.$dragging.insertBefore( $nearest );\n\n        } else {\n            // no nearest before - insert after last element (unpair button)\n            this.$dragging.insertAfter( this.$( '.paired-columns .unpair-btn' ).last() );\n        }\n        // resync the creator's list of paired based on the new DOM order\n        this._syncPairsToDom();\n        return false;\n    },\n    /** resync the creator's list of paired based on the DOM order of pairs */\n    _syncPairsToDom : function(){\n        var newPaired = [];\n        //TODO: doesn't seem wise to use the dom to store these - can't we sync another way?\n        this.$( '.paired-columns .dataset.paired' ).each( function(){\n            newPaired.push( $( this ).data( 'pair' ) );\n        });\n        //this.debug( newPaired );\n        this.paired = newPaired;\n        this._renderPaired();\n    },\n    /** drag communication with pair sub-views: dragstart */\n    _pairDragstart : function( ev, pair ){\n        //this.debug( '_pairDragstart', ev, pair )\n        // auto select the pair causing the event and move all selected\n        pair.$el.addClass( 'selected' );\n        var $selected = this.$( '.paired-columns .dataset.selected' );\n        this.$dragging = $selected;\n    },\n    /** drag communication with pair sub-views: dragend - remove the placeholder */\n    _pairDragend : function( ev, pair ){\n        //this.debug( '_pairDragend', ev, pair )\n        $( '.element-drop-placeholder' ).remove();\n        this.$dragging = null;\n    },\n\n    // ........................................................................ footer\n    toggleExtensions : function( force ){\n        var creator = this;\n        creator.removeExtensions = ( force !== undefined )?( force ):( !creator.removeExtensions );\n\n        _.each( creator.paired, function( pair ){\n            // don't overwrite custom names\n            if( pair.customizedName ){ return; }\n            pair.name = creator._guessNameForPair( pair.forward, pair.reverse );\n        });\n\n        creator._renderPaired();\n        creator._renderFooter();\n    },\n\n    /** handle a collection name change */\n    _changeName : function( ev ){\n        this._validationWarning( 'name', !!this._getName() );\n    },\n\n    /** check for enter key press when in the collection name and submit */\n    _nameCheckForEnter : function( ev ){\n        if( ev.keyCode === 13 && !this.blocking ){\n            this._clickCreate();\n        }\n    },\n\n    /** get the current collection name */\n    _getName : function(){\n        return _.escape( this.$( '.collection-name' ).val() );\n    },\n\n    /** attempt to create the current collection */\n    _clickCreate : function( ev ){\n        var name = this._getName();\n        if( !name ){\n            this._validationWarning( 'name' );\n        } else if( !this.blocking ){\n            this.createList();\n        }\n    },\n\n    // ------------------------------------------------------------------------ misc\n    /** debug a dataset list */\n    _printList : function( list ){\n        var creator = this;\n        _.each( list, function( e ){\n            if( list === creator.paired ){\n                creator._printPair( e );\n            } else {\n                //creator.debug( e );\n            }\n        });\n    },\n\n    /** print a pair Object */\n    _printPair : function( pair ){\n        this.debug( pair.forward.name, pair.reverse.name, ': ->', pair.name );\n    },\n\n    /** string rep */\n    toString : function(){ return 'PairedCollectionCreator'; }\n});\n\n\n//TODO: move to require text plugin and load these as text\n//TODO: underscore currently unnecc. bc no vars are used\n//TODO: better way of localizing text-nodes in long strings\n/** underscore template fns attached to class */\nPairedCollectionCreator.templates = PairedCollectionCreator.templates || {\n\n    /** the skeleton */\n    main : _.template([\n        '<div class=\"header flex-row no-flex\"></div>',\n        '<div class=\"middle flex-row flex-row-container\"></div>',\n        '<div class=\"footer flex-row no-flex\">'\n    ].join('')),\n\n    /** the header (not including help text) */\n    header : _.template([\n        '<div class=\"main-help well clear\">',\n            '<a class=\"more-help\" href=\"javascript:void(0);\">', _l( 'More help' ), '</a>',\n            '<div class=\"help-content\">',\n                '<a class=\"less-help\" href=\"javascript:void(0);\">', _l( 'Less' ), '</a>',\n            '</div>',\n        '</div>',\n        '<div class=\"alert alert-dismissable\">',\n            '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-hidden=\"true\">&times;</button>',\n            '<span class=\"alert-message\"></span>',\n        '</div>',\n\n        '<div class=\"column-headers vertically-spaced flex-column-container\">',\n            '<div class=\"forward-column flex-column column\">',\n                '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                        '<span class=\"title\">', _l( 'Unpaired forward' ), '</span>',\n                        '<span class=\"title-info unpaired-info\"></span>',\n                    '</div>',\n                    '<div class=\"unpaired-filter forward-unpaired-filter pull-left\">',\n                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n                    '</div>',\n                '</div>',\n            '</div>',\n            '<div class=\"paired-column flex-column no-flex column\">',\n                '<div class=\"column-header\">',\n                    '<a class=\"choose-filters-link\" href=\"javascript:void(0)\">',\n                        _l( 'Choose filters' ),\n                    '</a>',\n                    '<a class=\"clear-filters-link\" href=\"javascript:void(0);\">',\n                        _l( 'Clear filters' ),\n                    '</a><br />',\n                    '<a class=\"autopair-link\" href=\"javascript:void(0);\">',\n                        _l( 'Auto-pair' ),\n                    '</a>',\n                '</div>',\n            '</div>',\n            '<div class=\"reverse-column flex-column column\">',\n                '<div class=\"column-header\">',\n                    '<div class=\"column-title\">',\n                        '<span class=\"title\">', _l( 'Unpaired reverse' ), '</span>',\n                        '<span class=\"title-info unpaired-info\"></span>',\n                    '</div>',\n                    '<div class=\"unpaired-filter reverse-unpaired-filter pull-left\">',\n                        '<input class=\"search-query\" placeholder=\"', _l( 'Filter this list' ), '\" />',\n                    '</div>',\n                '</div>',\n            '</div>',\n        '</div>'\n    ].join('')),\n\n    /** the middle: unpaired, divider, and paired */\n    middle : _.template([\n        // contains two flex rows (rows that fill available space) and a divider btwn\n        '<div class=\"unpaired-columns flex-column-container scroll-container flex-row\">',\n            '<div class=\"forward-column flex-column column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n            '<div class=\"paired-column flex-column no-flex column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n            '<div class=\"reverse-column flex-column column\">',\n                '<ol class=\"column-datasets\"></ol>',\n            '</div>',\n        '</div>',\n        '<div class=\"flexible-partition\">',\n            '<div class=\"flexible-partition-drag\" title=\"', _l( 'Drag to change' ), '\"></div>',\n            '<div class=\"column-header\">',\n                '<div class=\"column-title paired-column-title\">',\n                    '<span class=\"title\"></span>',\n                '</div>',\n                '<a class=\"unpair-all-link\" href=\"javascript:void(0);\">',\n                    _l( 'Unpair all' ),\n                '</a>',\n            '</div>',\n        '</div>',\n        '<div class=\"paired-columns flex-column-container scroll-container flex-row\">',\n            '<ol class=\"column-datasets\"></ol>',\n        '</div>'\n    ].join('')),\n\n    /** creation and cancel controls */\n    footer : _.template([\n        '<div class=\"attributes clear\">',\n            '<div class=\"clear\">',\n                '<label class=\"remove-extensions-prompt pull-right\">',\n                    _l( 'Remove file extensions from pair names' ), '?',\n                    '<input class=\"remove-extensions pull-right\" type=\"checkbox\" />',\n                '</label>',\n            '</div>',\n            '<div class=\"clear\">',\n                '<input class=\"collection-name form-control pull-right\" ',\n                    'placeholder=\"', _l( 'Enter a name for your new list' ), '\" />',\n                '<div class=\"collection-name-prompt pull-right\">', _l( 'Name' ), ':</div>',\n            '</div>',\n        '</div>',\n\n        '<div class=\"actions clear vertically-spaced\">',\n            '<div class=\"other-options pull-left\">',\n                '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                '<div class=\"create-other btn-group dropup\">',\n                    '<button class=\"btn btn-default dropdown-toggle\" data-toggle=\"dropdown\">',\n                          _l( 'Create a different kind of collection' ),\n                          ' <span class=\"caret\"></span>',\n                    '</button>',\n                    '<ul class=\"dropdown-menu\" role=\"menu\">',\n                          '<li><a href=\"#\">', _l( 'Create a <i>single</i> pair' ), '</a></li>',\n                          '<li><a href=\"#\">', _l( 'Create a list of <i>unpaired</i> datasets' ), '</a></li>',\n                    '</ul>',\n                '</div>',\n            '</div>',\n\n            '<div class=\"main-options pull-right\">',\n                '<button class=\"create-collection btn btn-primary\">', _l( 'Create list' ), '</button>',\n            '</div>',\n        '</div>'\n    ].join('')),\n\n    /** help content */\n    helpContent : _.template([\n        '<p>', _l([\n            'Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ',\n            'These collections can be passed to tools and workflows in order to have analyses done on each member of ',\n            'the entire group. This interface allows you to create a collection, choose which datasets are paired, ',\n            'and re-order the final collection.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'Unpaired datasets are shown in the <i data-target=\".unpaired-columns\">unpaired section</i> ',\n            '(hover over the underlined words to highlight below). ',\n            'Paired datasets are shown in the <i data-target=\".paired-columns\">paired section</i>.',\n            '<ul>To pair datasets, you can:',\n                '<li>Click a dataset in the ',\n                    '<i data-target=\".unpaired-columns .forward-column .column-datasets,',\n                                    '.unpaired-columns .forward-column\">forward column</i> ',\n                    'to select it then click a dataset in the ',\n                    '<i data-target=\".unpaired-columns .reverse-column .column-datasets,',\n                                    '.unpaired-columns .reverse-column\">reverse column</i>.',\n                '</li>',\n                '<li>Click one of the \"Pair these datasets\" buttons in the ',\n                    '<i data-target=\".unpaired-columns .paired-column .column-datasets,',\n                                    '.unpaired-columns .paired-column\">middle column</i> ',\n                    'to pair the datasets in a particular row.',\n                '</li>',\n                '<li>Click <i data-target=\".autopair-link\">\"Auto-pair\"</i> ',\n                    'to have your datasets automatically paired based on name.',\n                '</li>',\n            '</ul>'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            '<ul>You can filter what is shown in the unpaired sections by:',\n                '<li>Entering partial dataset names in either the ',\n                    '<i data-target=\".forward-unpaired-filter input\">forward filter</i> or ',\n                    '<i data-target=\".reverse-unpaired-filter input\">reverse filter</i>.',\n                '</li>',\n                '<li>Choosing from a list of preset filters by clicking the ',\n                    '<i data-target=\".choose-filters-link\">\"Choose filters\" link</i>.',\n                '</li>',\n                '<li>Entering regular expressions to match dataset names. See: ',\n                    '<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\"',\n                        ' target=\"_blank\">MDN\\'s JavaScript Regular Expression Tutorial</a>. ',\n                    'Note: forward slashes (\\\\) are not needed.',\n                '</li>',\n                '<li>Clearing the filters by clicking the ',\n                    '<i data-target=\".clear-filters-link\">\"Clear filters\" link</i>.',\n                '</li>',\n            '</ul>'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'To unpair individual dataset pairs, click the ',\n                '<i data-target=\".unpair-btn\">unpair buttons ( <span class=\"fa fa-unlink\"></span> )</i>. ',\n            'Click the <i data-target=\".unpair-all-link\">\"Unpair all\" link</i> to unpair all pairs.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'You can include or remove the file extensions (e.g. \".fastq\") from your pair names by toggling the ',\n                '<i data-target=\".remove-extensions-prompt\">\"Remove file extensions from pair names?\"</i> control.'\n        ].join( '' )), '</p>',\n        '<p>', _l([\n            'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n            'click <i data-target=\".create-collection\">\"Create list\"</i>. ',\n            '(Note: you do not have to pair all unpaired datasets to finish.)'\n        ].join( '' )), '</p>'\n    ].join(''))\n};\n\n\n//=============================================================================\n/** a modal version of the paired collection creator */\nvar pairedCollectionCreatorModal = function _pairedCollectionCreatorModal( datasets, options ){\n\n    var deferred = jQuery.Deferred(),\n        creator;\n\n    options = _.defaults( options || {}, {\n        datasets    : datasets,\n        oncancel    : function(){\n            Galaxy.modal.hide();\n            deferred.reject( 'cancelled' );\n        },\n        oncreate    : function( creator, response ){\n            Galaxy.modal.hide();\n            deferred.resolve( response );\n        }\n    });\n\n    if( !window.Galaxy || !Galaxy.modal ){\n        throw new Error( 'Galaxy or Galaxy.modal not found' );\n    }\n\n    creator = new PairedCollectionCreator( options );\n    Galaxy.modal.show({\n        title   : 'Create a collection of paired datasets',\n        body    : creator.$el,\n        width   : '80%',\n        height  : '800px',\n        closing_events: true\n    });\n    creator.render();\n    window.creator = creator;\n\n    //TODO: remove modal header\n    return deferred;\n};\n\n\n//=============================================================================\nfunction createListOfPairsCollection( collection ){\n    var elements = collection.toJSON();\n//TODO: validate elements\n    return pairedCollectionCreatorModal( elements, {\n        historyId : collection.historyId\n    });\n}\n\n\n//=============================================================================\n    return {\n        PairedCollectionCreator : PairedCollectionCreator,\n        pairedCollectionCreatorModal : pairedCollectionCreatorModal,\n        createListOfPairsCollection : createListOfPairsCollection\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/list-of-pairs-collection-creator.js\n ** module id = 57\n ** module chunks = 3 4\n **/","define([\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/history/hdca-model\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( LIST_CREATOR, HDCA, BASE_MVC, _l ){\n/*==============================================================================\nTODO:\n    the paired creator doesn't really mesh with the list creator as parent\n        it may be better to make an abstract super class for both\n    composites may inherit from this (or vis-versa)\n    PairedDatasetCollectionElementView doesn't make a lot of sense\n\n==============================================================================*/\n/**  */\nvar PairedDatasetCollectionElementView = Backbone.View.extend( BASE_MVC.LoggableMixin ).extend({\n//TODO: use proper class (DatasetDCE or NestedDCDCE (or the union of both))\n    tagName     : 'li',\n    className   : 'collection-element',\n\n    initialize : function( attributes ){\n        this.element = attributes.element || {};\n        this.identifier = attributes.identifier;\n    },\n\n    render : function(){\n        this.$el\n            .attr( 'data-element-id', this.element.id )\n            .html( this.template({ identifier: this.identifier, element: this.element }) );\n        return this;\n    },\n\n    //TODO: lots of unused space in the element - possibly load details and display them horiz.\n    template : _.template([\n        '<span class=\"identifier\"><%= identifier %></span>',\n        '<span class=\"name\"><%= element.name %></span>',\n    ].join('')),\n\n    /** remove the DOM and any listeners */\n    destroy : function(){\n        this.off();\n        this.$el.remove();\n    },\n\n    /** string rep */\n    toString : function(){\n        return 'DatasetCollectionElementView()';\n    }\n});\n\n\n// ============================================================================\nvar _super = LIST_CREATOR.ListCollectionCreator;\n\n/** An interface for building collections.\n */\nvar PairCollectionCreator = _super.extend({\n\n    /** the class used to display individual elements */\n    elementViewClass : PairedDatasetCollectionElementView,\n    /** the class this creator will create and save */\n    collectionClass : HDCA.HistoryPairDatasetCollection,\n    className : 'pair-collection-creator collection-creator flex-row-container',\n\n    /** override to no-op */\n    _mangleDuplicateNames : function(){},\n\n    // TODO: this whole pattern sucks. There needs to be two classes of problem area:\n    //      bad inital choices and\n    //      when the user has painted his/her self into a corner during creation/use-of-the-creator\n    /** render the entire interface */\n    render : function( speed, callback ){\n        if( this.workingElements.length === 2 ){\n            return _super.prototype.render.call( this, speed, callback );\n        }\n        return this._renderInvalid( speed, callback );\n    },\n\n    // ------------------------------------------------------------------------ rendering elements\n    /** render forward/reverse */\n    _renderList : function( speed, callback ){\n        //this.debug( '-- _renderList' );\n        //precondition: there are two valid elements in workingElements\n        var creator = this,\n            $tmp = jQuery( '<div/>' ),\n            $list = creator.$list();\n\n        // lose the original views, create the new, append all at once, then call their renders\n        _.each( this.elementViews, function( view ){\n            view.destroy();\n            creator.removeElementView( view );\n        });\n        $tmp.append( creator._createForwardElementView().$el );\n        $tmp.append( creator._createReverseElementView().$el );\n        $list.empty().append( $tmp.children() );\n        _.invoke( creator.elementViews, 'render' );\n    },\n\n    /** create the forward element view */\n    _createForwardElementView : function(){\n        return this._createElementView( this.workingElements[0], { identifier: 'forward' } );\n    },\n\n    /** create the forward element view */\n    _createReverseElementView : function(){\n        return this._createElementView( this.workingElements[1], { identifier: 'reverse' } );\n    },\n\n    /** create an element view, cache in elementViews, and return */\n    _createElementView : function( element, options ){\n        var elementView = new this.elementViewClass( _.extend( options, {\n            element : element,\n        }));\n        this.elementViews.push( elementView );\n        return elementView;\n    },\n\n    /** swap the forward, reverse elements and re-render */\n    swap : function(){\n        this.workingElements = [\n            this.workingElements[1],\n            this.workingElements[0],\n        ];\n        this._renderList();\n    },\n\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .swap' : 'swap',\n    }),\n\n    // ------------------------------------------------------------------------ templates\n    //TODO: move to require text plugin and load these as text\n    //TODO: underscore currently unnecc. bc no vars are used\n    //TODO: better way of localizing text-nodes in long strings\n    /** underscore template fns attached to class */\n    templates : _.extend( _.clone( _super.prototype.templates ), {\n        /** the middle: element list */\n        middle : _.template([\n            '<div class=\"collection-elements-controls\">',\n                '<a class=\"swap\" href=\"javascript:void(0);\" title=\"', _l( 'Swap forward and reverse datasets' ), '\">',\n                    _l( 'Swap' ),\n                '</a>',\n            '</div>',\n            '<div class=\"collection-elements scroll-container flex-row\">',\n            '</div>'\n        ].join('')),\n\n        /** help content */\n        helpContent : _.template([\n            '<p>', _l([\n                'Pair collections are permanent collections containing two datasets: one forward and one reverse. ',\n                'Often these are forward and reverse reads. The pair collections can be passed to tools and ',\n                'workflows in order to have analyses done on both datasets. This interface allows ',\n                'you to create a pair, name it, and swap which is forward and which reverse.'\n            ].join( '' )), '</p>',\n            '<ul>',\n                '<li>', _l([\n                    'Click the <i data-target=\".swap\">\"Swap\"</i> link to make your forward dataset the reverse ',\n                    'and the reverse dataset forward.'\n                ].join( '' )), '</li>',\n                '<li>', _l([\n                    'Click the <i data-target=\".cancel-create\">\"Cancel\"</i> button to exit the interface.'\n                ].join( '' )), '</li>',\n            '</ul><br />',\n            '<p>', _l([\n                'Once your collection is complete, enter a <i data-target=\".collection-name\">name</i> and ',\n                'click <i data-target=\".create-collection\">\"Create list\"</i>.'\n            ].join( '' )), '</p>'\n        ].join('')),\n\n        /** a simplified page communicating what went wrong and why the user needs to reselect something else */\n        invalidInitial : _.template([\n            '<div class=\"header flex-row no-flex\">',\n                '<div class=\"alert alert-warning\" style=\"display: block\">',\n                    '<span class=\"alert-message\">',\n                        '<% if( _.size( problems ) ){ %>',\n                            _l( 'The following selections could not be included due to problems' ),\n                            '<ul><% _.each( problems, function( problem ){ %>',\n                                '<li><b><%= problem.element.name %></b>: <%= problem.text %></li>',\n                            '<% }); %></ul>',\n                        '<% } else if( _.size( elements ) === 0 ){ %>',\n                            _l( 'No datasets were selected' ), '.',\n                        '<% } else if( _.size( elements ) === 1 ){ %>',\n                            _l( 'Only one dataset was selected' ), ': <%= elements[0].name %>',\n                        '<% } else if( _.size( elements ) > 2 ){ %>',\n                            _l( 'Too many datasets were selected' ),\n                            ': <%= _.pluck( elements, \"name\" ).join( \", \") %>',\n                        '<% } %>',\n                        '<br />',\n                        _l( 'Two (and only two) elements are needed for the pair' ), '. ',\n                        _l( 'You may need to ' ),\n                        '<a class=\"cancel-create\" href=\"javascript:void(0)\">', _l( 'cancel' ), '</a> ',\n                        _l( 'and reselect new elements' ), '.',\n                    '</span>',\n                '</div>',\n            '</div>',\n            '<div class=\"footer flex-row no-flex\">',\n                '<div class=\"actions clear vertically-spaced\">',\n                    '<div class=\"other-options pull-left\">',\n                        '<button class=\"cancel-create btn\" tabindex=\"-1\">', _l( 'Cancel' ), '</button>',\n                        // _l( 'Create a different kind of collection' ),\n                    '</div>',\n                '</div>',\n            '</div>'\n        ].join('')),\n    }),\n\n    // ------------------------------------------------------------------------ misc\n    /** string rep */\n    toString : function(){ return 'PairCollectionCreator'; }\n});\n\n\n//==============================================================================\n/** List collection flavor of collectionCreatorModal. */\nvar pairCollectionCreatorModal = function _pairCollectionCreatorModal( elements, options ){\n    options = options || {};\n    options.title = _l( 'Create a collection from a pair of datasets' );\n    return LIST_CREATOR.collectionCreatorModal( elements, options, PairCollectionCreator );\n};\n\n\n//==============================================================================\n/** Use a modal to create a pair collection, then add it to the given history contents.\n *  @returns {Deferred} resolved when the collection is added to the history.\n */\nfunction createPairCollection( contents ){\n    var elements = contents.toJSON(),\n        promise = pairCollectionCreatorModal( elements, {\n            creationFn : function( elements, name ){\n                elements = [\n                    { name: \"forward\", src: \"hda\", id: elements[0].id },\n                    { name: \"reverse\", src: \"hda\", id: elements[1].id }\n                ];\n                return contents.createHDCA( elements, 'paired', name );\n            }\n        });\n    return promise;\n}\n\n//==============================================================================\n    return {\n        PairCollectionCreator       : PairCollectionCreator,\n        pairCollectionCreatorModal  : pairCollectionCreatorModal,\n        createPairCollection        : createPairCollection,\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/collection/pair-collection-creator.js\n ** module id = 58\n ** module chunks = 3 4\n **/","define([\n    \"mvc/dataset/dataset-li-edit\",\n    \"mvc/history/hda-li\",\n    \"mvc/base-mvc\",\n    \"utils/localization\"\n], function( DATASET_LI_EDIT, HDA_LI, BASE_MVC, _l ){\n//==============================================================================\nvar _super = DATASET_LI_EDIT.DatasetListItemEdit;\n/** @class Editing view for HistoryDatasetAssociation.\n */\nvar HDAListItemEdit = _super.extend(\n/** @lends HDAListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    className   : _super.prototype.className + \" history-content\",\n\n    /** In this override, only get details if in the ready state, get rerunnable if in other states.\n     *  Note: fetch with no 'change' event triggering to prevent automatic rendering.\n     */\n    _fetchModelDetails : function(){\n        var view = this;\n        if( view.model.inReadyState() && !view.model.hasDetails() ){\n            return view.model.fetch({ silent: true });\n\n        // special case the need for the rerunnable and creating_job attributes\n        // needed for rendering re-run button on queued, running datasets\n        } else if( !view.model.has( 'rerunnable' ) ){\n            return view.model.fetch({ silent: true, data: {\n                // only fetch rerunnable and creating_job to keep overhead down\n                keys: [ 'rerunnable', 'creating_job' ].join(',')\n            }});\n        }\n        return jQuery.when();\n    },\n\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .unhide-link' : function( ev ){ this.model.unhide(); return false; }\n    }),\n\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDAListItemEdit(' + modelString + ')';\n    }\n});\n\n\n// ............................................................................ TEMPLATES\n/** underscore templates */\nHDAListItemEdit.prototype.templates = (function(){\n//TODO: move to require text! plugin\n\n    var warnings = _.extend( {}, _super.prototype.templates.warnings, {\n        hidden : BASE_MVC.wrapTemplate([\n            '<% if( !dataset.visible ){ %>',\n                // add a link to unhide a dataset\n                '<div class=\"hidden-msg warningmessagesmall\">',\n                    _l( 'This dataset has been hidden' ),\n                    '<br /><a class=\"unhide-link\" a href=\"javascript:void(0);\">', _l( 'Unhide it' ), '</a>',\n                '</div>',\n            '<% } %>'\n        ], 'dataset' )\n    });\n\n    return _.extend( {}, _super.prototype.templates, {\n        //NOTE: *steal* the HDAListItemView titleBar\n        titleBar : HDA_LI.HDAListItemView.prototype.templates.titleBar,\n        warnings : warnings\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HDAListItemEdit  : HDAListItemEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hda-li-edit.js\n ** module id = 66\n ** module chunks = 3 4\n **/","define([\n    \"mvc/history/hdca-li\",\n    \"mvc/collection/collection-panel-edit\",\n    \"ui/fa-icon-button\",\n    \"utils/localization\"\n], function( HDCA_LI, DC_PANEL_EDIT, faIconButton, _l ){\n//==============================================================================\nvar _super = HDCA_LI.HDCAListItemView;\n/** @class Editing view for HistoryDatasetCollectionAssociation.\n */\nvar HDCAListItemEdit = _super.extend(\n/** @lends HDCAListItemEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** Override to return editable versions of the collection panels */\n    _getFoldoutPanelClass : function(){\n        switch( this.model.get( 'collection_type' ) ){\n            case 'list':\n                return DC_PANEL_EDIT.ListCollectionPanelEdit;\n            case 'paired':\n                return DC_PANEL_EDIT.PairCollectionPanelEdit;\n            case 'list:paired':\n                return DC_PANEL_EDIT.ListOfPairsCollectionPanelEdit;\n        }\n        throw new TypeError( 'Uknown collection_type: ' + this.model.get( 'collection_type' ) );\n    },\n\n    // ......................................................................... delete\n    /** In this override, add the delete button. */\n    _renderPrimaryActions : function(){\n        this.log( this + '._renderPrimaryActions' );\n        // render the display, edit attr and delete icon-buttons\n        return _super.prototype._renderPrimaryActions.call( this )\n            .concat([\n                this._renderDeleteButton()\n            ]);\n    },\n\n    /** Render icon-button to delete this collection. */\n    _renderDeleteButton : function(){\n        var self = this,\n            deleted = this.model.get( 'deleted' );\n        return faIconButton({\n            title       : deleted? _l( 'Dataset collection is already deleted' ): _l( 'Delete' ),\n            classes     : 'delete-btn',\n            faIcon      : 'fa-times',\n            disabled    : deleted,\n            onclick     : function() {\n                // ...bler... tooltips being left behind in DOM (hover out never called on deletion)\n                self.$el.find( '.icon-btn.delete-btn' ).trigger( 'mouseout' );\n                self.model[ 'delete' ]();\n            }\n        });\n    },\n\n    // ......................................................................... misc\n    /** string rep */\n    toString : function(){\n        var modelString = ( this.model )?( this.model + '' ):( '(no model)' );\n        return 'HDCAListItemEdit(' + modelString + ')';\n    }\n});\n\n//==============================================================================\n    return {\n        HDCAListItemEdit : HDCAListItemEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/hdca-li-edit.js\n ** module id = 67\n ** module chunks = 3 4\n **/","define([\n    \"mvc/history/history-panel\",\n    \"mvc/history/history-contents\",\n    \"mvc/dataset/states\",\n    \"mvc/history/hda-model\",\n    \"mvc/history/hda-li-edit\",\n    \"mvc/history/hdca-li-edit\",\n    \"mvc/tags\",\n    \"mvc/annotations\",\n    \"mvc/collection/list-collection-creator\",\n    \"mvc/collection/pair-collection-creator\",\n    \"mvc/collection/list-of-pairs-collection-creator\",\n    \"ui/fa-icon-button\",\n    \"mvc/ui/popup-menu\",\n    \"utils/localization\"\n], function(\n    HPANEL,\n    HISTORY_CONTENTS,\n    STATES,\n    HDA_MODEL,\n    HDA_LI_EDIT,\n    HDCA_LI_EDIT,\n    TAGS,\n    ANNOTATIONS,\n    LIST_COLLECTION_CREATOR,\n    PAIR_COLLECTION_CREATOR,\n    LIST_OF_PAIRS_COLLECTION_CREATOR,\n    faIconButton,\n    PopupMenu,\n    _l\n){\n/* =============================================================================\nTODO:\n\n============================================================================= */\nvar _super = HPANEL.HistoryPanel;\n// base class for current-history-panel and used as-is in history/view.mako\n/** @class Editable View/Controller for the history model.\n *\n *  Allows:\n *      (everything HistoryPanel allows)\n *      changing the name\n *      displaying and editing tags and annotations\n *      multi-selection and operations on mulitple content items\n */\nvar HistoryPanelEdit = _super.extend(\n/** @lends HistoryPanelEdit.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** class to use for constructing the HistoryDatasetAssociation views */\n    HDAViewClass    : HDA_LI_EDIT.HDAListItemEdit,\n    /** class to use for constructing the HistoryDatasetCollectionAssociation views */\n    HDCAViewClass   : HDCA_LI_EDIT.HDCAListItemEdit,\n\n    // ......................................................................... SET UP\n    /** Set up the view, set up storage, bind listeners to HistoryContents events\n     *  @param {Object} attributes\n     */\n    initialize : function( attributes ){\n        attributes = attributes || {};\n        _super.prototype.initialize.call( this, attributes );\n\n        // ---- set up instance vars\n        /** editor for tags - sub-view */\n        this.tagsEditor = null;\n        /** editor for annotations - sub-view */\n        this.annotationEditor = null;\n\n        /** allow user purge of dataset files? */\n        this.purgeAllowed = attributes.purgeAllowed || false;\n\n        // states/modes the panel can be in\n        /** is the panel currently showing the dataset selection controls? */\n        this.annotationEditorShown  = attributes.annotationEditorShown || false;\n        this.tagsEditorShown  = attributes.tagsEditorShown || false;\n    },\n\n    /** Override to handle history as drag-drop target */\n    _setUpListeners : function(){\n        var panel = this;\n        _super.prototype._setUpListeners.call( panel );\n\n        panel.on( 'drop', function( ev, data ){\n            panel.dataDropped( data );\n            // remove the drop target\n            panel.dropTargetOff();\n        });\n        panel.on( 'view:attached view:removed', function(){\n            panel._renderCounts();\n        }, panel );\n    },\n\n    // ------------------------------------------------------------------------ listeners\n    /** listening for collection events */\n    _setUpCollectionListeners : function(){\n        _super.prototype._setUpCollectionListeners.call( this );\n\n        this.collection.on( 'change:deleted', this._handleHdaDeletionChange, this );\n        this.collection.on( 'change:visible', this._handleHdaVisibleChange, this );\n        this.collection.on( 'change:purged', function( model ){\n            // hafta get the new nice-size w/o the purged model\n            this.model.fetch();\n        }, this );\n        return this;\n    },\n\n    /** listening for history and HDA events */\n    _setUpModelListeners : function(){\n        _super.prototype._setUpModelListeners.call( this );\n        this.model.on( 'change:size', this.updateHistoryDiskSize, this );\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add tag and annotation editors and a btn to toggle the selectors */\n    _buildNewRender : function(){\n        // create a new render using a skeleton template, render title buttons, render body, and set up events, etc.\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        if( !this.model ){ return $newRender; }\n\n        if( Galaxy && Galaxy.currUser && Galaxy.currUser.id && Galaxy.currUser.id === this.model.get( 'user_id' ) ){\n            this._renderTags( $newRender );\n            this._renderAnnotation( $newRender );\n        }\n        return $newRender;\n    },\n\n    /** override to render counts when the items are rendered */\n    renderItems : function( $whereTo ){\n        var views = _super.prototype.renderItems.call( this, $whereTo );\n        this._renderCounts( $whereTo );\n        return views;\n    },\n\n    /** override to show counts, what's deleted/hidden, and links to toggle those */\n    _renderCounts : function( $whereTo ){\n//TODO: too complicated\n        function toggleLink( _class, text ){\n            return [ '<a class=\"', _class, '\" href=\"javascript:void(0);\">', text, '</a>' ].join( '' );\n        }\n        $whereTo = $whereTo || this.$el;\n        var deleted  = this.collection.where({ deleted: true }),\n            hidden   = this.collection.where({ visible: false }),\n            msgs = [];\n\n        if( this.views.length ){\n            msgs.push( [ this.views.length, _l( 'shown' ) ].join( ' ' ) );\n        }\n        if( deleted.length ){\n            msgs.push( ( !this.showDeleted )?\n                 ([ deleted.length, toggleLink( 'toggle-deleted-link', _l( 'deleted' ) ) ].join( ' ' ))\n                :( toggleLink( 'toggle-deleted-link', _l( 'hide deleted' ) ) )\n            );\n        }\n        if( hidden.length ){\n            msgs.push( ( !this.showHidden )?\n                 ([ hidden.length, toggleLink( 'toggle-hidden-link', _l( 'hidden' ) ) ].join( ' ' ))\n                :( toggleLink( 'toggle-hidden-link', _l( 'hide hidden' ) ) )\n            );\n        }\n        return $whereTo.find( '> .controls .subtitle' ).html( msgs.join( ', ' ) );\n    },\n\n    /** render the tags sub-view controller */\n    _renderTags : function( $where ){\n        var panel = this;\n        this.tagsEditor = new TAGS.TagsEditor({\n            model           : this.model,\n            el              : $where.find( '.controls .tags-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // show hide sub-view tag editors when this is shown/hidden\n            onshow          : function(){\n                panel.toggleHDATagEditors( true,  panel.fxSpeed );\n            },\n            onhide          : function(){\n                panel.toggleHDATagEditors( false, panel.fxSpeed );\n            },\n            $activator      : faIconButton({\n                title   : _l( 'Edit history tags' ),\n                classes : 'history-tag-btn',\n                faIcon  : 'fa-tags'\n            }).appendTo( $where.find( '.controls .actions' ) )\n        });\n    },\n    /** render the annotation sub-view controller */\n    _renderAnnotation : function( $where ){\n        var panel = this;\n        this.annotationEditor = new ANNOTATIONS.AnnotationEditor({\n            model           : this.model,\n            el              : $where.find( '.controls .annotation-display' ),\n            onshowFirstTime : function(){ this.render(); },\n            // show hide sub-view view annotation editors when this is shown/hidden\n            onshow          : function(){\n                panel.toggleHDAAnnotationEditors( true,  panel.fxSpeed );\n            },\n            onhide          : function(){\n                panel.toggleHDAAnnotationEditors( false, panel.fxSpeed );\n            },\n            $activator      : faIconButton({\n                title   : _l( 'Edit history annotation' ),\n                classes : 'history-annotate-btn',\n                faIcon  : 'fa-comment'\n            }).appendTo( $where.find( '.controls .actions' ) )\n        });\n    },\n\n    /** Set up HistoryPanelEdit js/widget behaviours\n     *  In this override, make the name editable\n     */\n    _setUpBehaviors : function( $where ){\n        $where = $where || this.$el;\n        _super.prototype._setUpBehaviors.call( this, $where );\n        if( !this.model ){ return; }\n\n        // anon users shouldn't have access to any of the following\n        if( ( !Galaxy.currUser || Galaxy.currUser.isAnonymous() )\n        ||  ( Galaxy.currUser.id !== this.model.get( 'user_id' ) ) ){\n            return;\n        }\n\n        var panel = this,\n            nameSelector = '> .controls .name';\n        $where.find( nameSelector )\n            .attr( 'title', _l( 'Click to rename history' ) )\n            .tooltip({ placement: 'bottom' })\n            .make_text_editable({\n                on_finish: function( newName ){\n                    var previousName = panel.model.get( 'name' );\n                    if( newName && newName !== previousName ){\n                        panel.$el.find( nameSelector ).text( newName );\n                        panel.model.save({ name: newName })\n                            .fail( function(){\n                                panel.$el.find( nameSelector ).text( panel.model.previous( 'name' ) );\n                            });\n                    } else {\n                        panel.$el.find( nameSelector ).text( previousName );\n                    }\n                }\n            });\n    },\n\n    /** return a new popup menu for choosing a multi selection action\n     *  ajax calls made for multiple datasets are queued\n     */\n    multiselectActions : function(){\n        var panel = this,\n            actions = [\n                {   html: _l( 'Hide datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.hide;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Unhide datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.unhide;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Delete datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype['delete'];\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                },\n                {   html: _l( 'Undelete datasets' ), func: function(){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.undelete;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                }\n            ];\n        if( panel.purgeAllowed ){\n            actions.push({\n                html: _l( 'Permanently delete datasets' ), func: function(){\n                    if( confirm( _l( 'This will permanently remove the data in your datasets. Are you sure?' ) ) ){\n                        var action = HDA_MODEL.HistoryDatasetAssociation.prototype.purge;\n                        panel.getSelectedModels().ajaxQueue( action );\n                    }\n                }\n            });\n        }\n        actions = actions.concat( panel._collectionActions() );\n        return actions;\n    },\n\n    /**   */\n    _collectionActions : function(){\n        var panel = this;\n        return [\n            {   html: _l( 'Build Dataset List' ), func: function() {\n                    LIST_COLLECTION_CREATOR.createListCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n            // TODO: Only show quick pair if two things selected.\n            {   html: _l( 'Build Dataset Pair' ), func: function() {\n                    PAIR_COLLECTION_CREATOR.createPairCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n            {   html: _l( 'Build List of Dataset Pairs' ), func: function() {\n                    LIST_OF_PAIRS_COLLECTION_CREATOR.createListOfPairsCollection( panel.getSelectedModels() )\n                        .done( function(){ panel.model.refresh() });\n                }\n            },\n        ];\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    // reverse HID order\n    /** Override to reverse order of views - newest contents on top */\n    _attachItems : function( $whereTo ){\n        this.$list( $whereTo ).append( this.views.reverse().map( function( view ){\n            return view.$el;\n        }));\n        return this;\n    },\n\n    /** Override to add new contents at the top */\n    _attachView : function( view ){\n        var panel = this;\n        // override to control where the view is added, how/whether it's rendered\n        panel.views.unshift( view );\n        panel.$list().prepend( view.render( 0 ).$el.hide() );\n        panel.trigger( 'view:attached', view );\n        view.$el.slideDown( panel.fxSpeed, function(){\n            panel.trigger( 'view:attached:rendered' );\n        });\n    },\n\n    /** In this override, add purgeAllowed and whether tags/annotation editors should be shown */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        _.extend( options, {\n            purgeAllowed            : this.purgeAllowed,\n//TODO: not working\n            tagsEditorShown         : ( this.tagsEditor && !this.tagsEditor.hidden ),\n            annotationEditorShown   : ( this.annotationEditor && !this.annotationEditor.hidden )\n        });\n        return options;\n    },\n\n    ///** Override to alter data in drag based on multiselection */\n    //_setUpItemViewListeners : function( view ){\n    //    var panel = this;\n    //    _super.prototype._setUpItemViewListeners.call( panel, view );\n    //\n    //},\n\n    /** If this item is deleted and we're not showing deleted items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleHdaDeletionChange : function( itemModel ){\n        if( itemModel.get( 'deleted' ) && !this.showDeleted ){\n            this.removeItemView( itemModel );\n        }\n        this._renderCounts();\n    },\n\n    /** If this item is hidden and we're not showing hidden items, remove the view\n     *  @param {Model} the item model to check\n     */\n    _handleHdaVisibleChange : function( itemModel ){\n        if( itemModel.hidden() && !this.showHidden ){\n            this.removeItemView( itemModel );\n        }\n        this._renderCounts();\n    },\n\n    /** toggle the visibility of each content's tagsEditor applying all the args sent to this function */\n    toggleHDATagEditors : function( showOrHide ){\n        var args = Array.prototype.slice.call( arguments, 1 );\n        _.each( this.views, function( view ){\n            if( view.tagsEditor ){\n                view.tagsEditor.toggle.apply( view.tagsEditor, args );\n            }\n        });\n    },\n\n    /** toggle the visibility of each content's annotationEditor applying all the args sent to this function */\n    toggleHDAAnnotationEditors : function( showOrHide ){\n        var args = Array.prototype.slice.call( arguments, 1 );\n        _.each( this.views, function( view ){\n            if( view.annotationEditor ){\n                view.annotationEditor.toggle.apply( view.annotationEditor, args );\n            }\n        });\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        'click .show-selectors-btn'                 : 'toggleSelectors',\n        'click .toggle-deleted-link'                : function( ev ){ this.toggleShowDeleted(); },\n        'click .toggle-hidden-link'                 : function( ev ){ this.toggleShowHidden(); }\n    }),\n\n    /** Update the history size display (curr. upper right of panel).\n     */\n    updateHistoryDiskSize : function(){\n        this.$el.find( '.history-size' ).text( this.model.get( 'nice_size' ) );\n    },\n\n    // ------------------------------------------------------------------------ as drop target\n    /**  */\n    dropTargetOn : function(){\n        if( this.dropTarget ){ return this; }\n        this.dropTarget = true;\n\n        //TODO: to init\n        var dropHandlers = {\n            'dragenter' : _.bind( this.dragenter, this ),\n            'dragover'  : _.bind( this.dragover,  this ),\n            'dragleave' : _.bind( this.dragleave, this ),\n            'drop'      : _.bind( this.drop, this )\n        };\n//TODO: scroll to top\n        var $dropTarget = this._renderDropTarget();\n        this.$list().before([ this._renderDropTargetHelp(), $dropTarget ]);\n        for( var evName in dropHandlers ){\n            if( dropHandlers.hasOwnProperty( evName ) ){\n                //console.debug( evName, dropHandlers[ evName ] );\n                $dropTarget.on( evName, dropHandlers[ evName ] );\n            }\n        }\n        return this;\n    },\n\n    /**  */\n    _renderDropTarget : function(){\n        this.$( '.history-drop-target' ).remove();\n        return $( '<div/>' ).addClass( 'history-drop-target' )\n            .css({\n                'height': '64px',\n                'margin': '0px 10px 10px 10px',\n                'border': '1px dashed black',\n                'border-radius' : '3px'\n            });\n    },\n\n    /**  */\n    _renderDropTargetHelp : function(){\n        this.$( '.history-drop-target-help' ).remove();\n        return $( '<div/>' ).addClass( 'history-drop-target-help' )\n            .css({\n                'margin'        : '10px 10px 4px 10px',\n                'color'         : 'grey',\n                'font-size'     : '80%',\n                'font-style'    : 'italic'\n            })\n            .text( _l( 'Drag datasets here to copy them to the current history' ) );\n    },\n\n    /**  */\n    dropTargetOff : function(){\n        if( !this.dropTarget ){ return this; }\n        //this.log( 'dropTargetOff' );\n        this.dropTarget = false;\n        var dropTarget = this.$( '.history-drop-target' ).get(0);\n        for( var evName in this._dropHandlers ){\n            if( this._dropHandlers.hasOwnProperty( evName ) ){\n                dropTarget.off( evName, this._dropHandlers[ evName ] );\n            }\n        }\n        this.$( '.history-drop-target' ).remove();\n        this.$( '.history-drop-target-help' ).remove();\n        return this;\n    },\n    /**  */\n    dropTargetToggle : function(){\n        if( this.dropTarget ){\n            this.dropTargetOff();\n        } else {\n            this.dropTargetOn();\n        }\n        return this;\n    },\n\n    /**  */\n    dragenter : function( ev ){\n        //console.debug( 'dragenter:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$( '.history-drop-target' ).css( 'border', '2px solid black' );\n    },\n    /**  */\n    dragover : function( ev ){\n        ev.preventDefault();\n        ev.stopPropagation();\n    },\n    /**  */\n    dragleave : function( ev ){\n        //console.debug( 'dragleave:', this, ev );\n        ev.preventDefault();\n        ev.stopPropagation();\n        this.$( '.history-drop-target' ).css( 'border', '1px dashed black' );\n    },\n    /**  */\n    drop : function( ev ){\n        //console.warn( 'dataTransfer:', ev.dataTransfer.getData( 'text' ) );\n        //console.warn( 'dataTransfer:', ev.originalEvent.dataTransfer.getData( 'text' ) );\n        ev.preventDefault();\n        //ev.stopPropagation();\n        ev.dataTransfer.dropEffect = 'move';\n\n        //console.debug( 'ev.dataTransfer:', ev.dataTransfer );\n\n        var panel = this,\n            data = ev.dataTransfer.getData( \"text\" );\n        try {\n            data = JSON.parse( data );\n\n        } catch( err ){\n            this.warn( 'error parsing JSON from drop:', data );\n        }\n        this.trigger( 'droptarget:drop', ev, data, panel );\n        return false;\n    },\n\n    /**  */\n    dataDropped : function( data ){\n        var panel = this;\n        // HDA: dropping will copy it to the history\n        if( _.isObject( data ) && data.model_class === 'HistoryDatasetAssociation' && data.id ){\n            return panel.model.contents.copy( data.id );\n        }\n        return jQuery.when();\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString    : function(){\n        return 'HistoryPanelEdit(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n//==============================================================================\n    return {\n        HistoryPanelEdit : HistoryPanelEdit\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/history-panel-edit.js\n ** module id = 68\n ** module chunks = 3 4\n **/","define([\n    \"mvc/list/list-panel\",\n    \"mvc/history/history-model\",\n    \"mvc/history/history-contents\",\n    \"mvc/history/hda-li\",\n    \"mvc/history/hdca-li\",\n    \"mvc/collection/collection-panel\",\n    \"mvc/user/user-model\",\n    \"ui/fa-icon-button\",\n    \"mvc/ui/popup-menu\",\n    \"mvc/base-mvc\",\n    \"utils/localization\",\n    \"ui/search-input\"\n], function(\n    LIST_PANEL,\n    HISTORY_MODEL,\n    HISTORY_CONTENTS,\n    HDA_LI,\n    HDCA_LI,\n    COLLECTION_PANEL,\n    USER,\n    faIconButton,\n    PopupMenu,\n    BASE_MVC,\n    _l\n){\n// ============================================================================\n/** session storage for individual history preferences */\nvar HistoryPrefs = BASE_MVC.SessionStorageModel.extend(\n/** @lends HistoryPrefs.prototype */{\n//TODO:?? possibly mark as current T/F - have History.currId() (a class method) return that value\n    defaults : {\n//TODO:?? expandedIds to array?\n        expandedIds : {},\n        //TODO:?? move to user?\n        show_deleted : false,\n        show_hidden  : false\n        //TODO: add scroll position?\n    },\n    /** add an hda id to the hash of expanded hdas */\n    addExpanded : function( model ){\n        var key = 'expandedIds';\n//TODO:?? is this right anymore?\n        this.save( key, _.extend( this.get( key ), _.object([ model.id ], [ model.get( 'id' ) ]) ) );\n    },\n    /** remove an hda id from the hash of expanded hdas */\n    removeExpanded : function( model ){\n        var key = 'expandedIds';\n        this.save( key, _.omit( this.get( key ), model.id ) );\n    },\n    toString : function(){\n        return 'HistoryPrefs(' + this.id + ')';\n    }\n});\n// class lvl for access w/o instantiation\nHistoryPrefs.storageKeyPrefix = 'history:';\n\n/** key string to store each histories settings under */\nHistoryPrefs.historyStorageKey = function historyStorageKey( historyId ){\n    if( !historyId ){\n        throw new Error( 'HistoryPrefs.historyStorageKey needs valid id: ' + historyId );\n    }\n    // single point of change\n    return ( HistoryPrefs.storageKeyPrefix + historyId );\n};\n/** return the existing storage for the history with the given id (or create one if it doesn't exist) */\nHistoryPrefs.get = function get( historyId ){\n    return new HistoryPrefs({ id: HistoryPrefs.historyStorageKey( historyId ) });\n};\n/** clear all history related items in sessionStorage */\nHistoryPrefs.clearAll = function clearAll( historyId ){\n    for( var key in sessionStorage ){\n        if( key.indexOf( HistoryPrefs.storageKeyPrefix ) === 0 ){\n            sessionStorage.removeItem( key );\n        }\n    }\n};\n\n\n/* =============================================================================\nTODO:\n\n============================================================================= */\n/** @class  non-editable, read-only View/Controller for a history model.\n *  Allows:\n *      changing the loaded history\n *      displaying data, info, and download\n *      tracking history attrs: size, tags, annotations, name, etc.\n *  Does not allow:\n *      changing the name\n */\nvar _super = LIST_PANEL.ModelListPanel;\nvar HistoryPanel = _super.extend(\n/** @lends HistoryPanel.prototype */{\n\n    /** logger used to record this.log messages, commonly set to console */\n    //logger              : console,\n\n    /** class to use for constructing the HDA views */\n    HDAViewClass        : HDA_LI.HDAListItemView,\n    /** class to use for constructing the HDCA views */\n    HDCAViewClass       : HDCA_LI.HDCAListItemView,\n    /** class to used for constructing collection of sub-view models */\n    collectionClass     : HISTORY_CONTENTS.HistoryContents,\n    /** key of attribute in model to assign to this.collection */\n    modelCollectionKey  : 'contents',\n\n    tagName             : 'div',\n    className           : _super.prototype.className + ' history-panel',\n\n    /** string to display when the collection is empty */\n    emptyMsg            : _l( 'This history is empty' ),\n    /** displayed when no items match the search terms */\n    noneFoundMsg        : _l( 'No matching datasets found' ),\n    /** string used for search placeholder */\n    searchPlaceholder   : _l( 'search datasets' ),\n\n    // ......................................................................... SET UP\n    /** Set up the view, bind listeners.\n     *  @param {Object} attributes optional settings for the panel\n     */\n    initialize : function( attributes ){\n        _super.prototype.initialize.call( this, attributes );\n        // ---- instance vars\n        // control contents/behavior based on where (and in what context) the panel is being used\n        /** where should pages from links be displayed? (default to new tab/window) */\n        this.linkTarget = attributes.linkTarget || '_blank';\n    },\n\n    /** In this override, clear the update timer on the model */\n    freeModel : function(){\n        _super.prototype.freeModel.call( this );\n//TODO: move to History.free()\n        if( this.model ){\n            this.model.clearUpdateTimeout();\n        }\n        return this;\n    },\n\n    /** create any event listeners for the panel\n     *  @fires: rendered:initial    on the first render\n     *  @fires: empty-history       when switching to a history with no contents or creating a new history\n     */\n    _setUpListeners : function(){\n        _super.prototype._setUpListeners.call( this );\n        this.on({\n            error : function( model, xhr, options, msg, details ){\n                this.errorHandler( model, xhr, options, msg, details );\n            },\n            'loading-done' : function(){\n                //TODO:?? if( this.collection.length ){\n                if( !this.views.length ){\n                    this.trigger( 'empty-history', this );\n                }\n            },\n            'views:ready view:attached view:removed' : function( view ){\n                this._renderSelectButton();\n            }\n        });\n        // this.on( 'all', function(){ console.debug( arguments ); });\n    },\n\n    // ------------------------------------------------------------------------ loading history/hda models\n    //NOTE: all the following fns replace the existing history model with a new model\n    // (in the following 'details' refers to the full set of contents api data (urls, display_apps, misc_info, etc.)\n    //  - contents w/o details will have summary data only (name, hid, deleted, visible, state, etc.))\n//TODO: too tangled...\n\n    /** loads a history & contents, getting details of any contents whose ids are stored in sessionStorage\n     *      (but does not make them the current history)\n     */\n    loadHistoryWithDetails : function( historyId, attributes, historyFn, contentsFn ){\n        this.info( 'loadHistoryWithDetails:', historyId, attributes, historyFn, contentsFn );\n        var detailIdsFn = function( historyData ){\n                // will be called to get content ids that need details from the api\n//TODO:! non-visible contents are getting details loaded... either stop loading them at all or filter ids thru isVisible\n                return _.values( HistoryPrefs.get( historyData.id ).get( 'expandedIds' ) );\n            };\n        return this.loadHistory( historyId, attributes, historyFn, contentsFn, detailIdsFn );\n    },\n\n    /** loads a history & contents (but does not make them the current history) */\n    loadHistory : function( historyId, attributes, historyFn, contentsFn, detailIdsFn ){\n        this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n        var panel = this;\n        attributes = attributes || {};\n\n        panel.trigger( 'loading', panel );\n        //this.info( 'loadHistory:', historyId, attributes, historyFn, contentsFn, detailIdsFn );\n        var xhr = HISTORY_MODEL.History.getHistoryData( historyId, {\n                historyFn       : historyFn,\n                contentsFn      : contentsFn,\n                detailIdsFn     : attributes.initiallyExpanded || detailIdsFn\n            });\n\n        return panel._loadHistoryFromXHR( xhr, attributes )\n            .fail( function( xhr, where, history ){\n                // throw an error up for the error handler\n                panel.trigger( 'error', panel, xhr, attributes, _l( 'An error was encountered while ' + where ),\n                    { historyId: historyId, history: history || {} });\n            })\n            .always( function(){\n                // bc _hideLoadingIndicator relies on this firing\n                panel.trigger( 'loading-done', panel );\n            });\n    },\n\n    /** given an xhr that will provide both history and contents data, pass data to set model or handle xhr errors */\n    _loadHistoryFromXHR : function( xhr, attributes ){\n        var panel = this;\n        xhr.then( function( historyJSON, contentsJSON ){\n            panel.JSONToModel( historyJSON, contentsJSON, attributes );\n            panel.render();\n        });\n        xhr.fail( function( xhr, where ){\n            // render anyways - whether we get a model or not\n            panel.render();\n        });\n        return xhr;\n    },\n\n    /** convenience alias to the model. Updates the item list only (not the history) */\n    refreshContents : function( detailIds, options ){\n        if( this.model ){\n            return this.model.refresh( detailIds, options );\n        }\n        // may have callbacks - so return an empty promise\n        return $.when();\n    },\n\n//TODO:?? seems unneccesary\n//TODO: Maybe better in History?\n    /** create a new history model from JSON and call setModel on it */\n    JSONToModel : function( newHistoryJSON, newHdaJSON, attributes ){\n        this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON, attributes );\n        attributes = attributes || {};\n        //this.log( 'JSONToModel:', newHistoryJSON, newHdaJSON.length, attributes );\n\n        var model = new HISTORY_MODEL.History( newHistoryJSON, newHdaJSON, attributes );\n//TODO:?? here?\n        this.setModel( model );\n        return model;\n    },\n\n    /** release/free/shutdown old models and set up panel for new models\n     *  @fires new-model with the panel as parameter\n     */\n    setModel : function( model, attributes ){\n        attributes = attributes || {};\n        _super.prototype.setModel.call( this, model, attributes );\n        if( this.model ){\n            this._setUpWebStorage( attributes.initiallyExpanded, attributes.show_deleted, attributes.show_hidden );\n        }\n    },\n\n    // ------------------------------------------------------------------------ browser stored prefs\n    /** Set up client side storage. Currently PersistanStorage keyed under 'HistoryPanel.<id>'\n     *  @param {Object} initiallyExpanded\n     *  @param {Boolean} show_deleted whether to show deleted contents (overrides stored)\n     *  @param {Boolean} show_hidden\n     *  @see PersistentStorage\n     */\n    _setUpWebStorage : function( initiallyExpanded, show_deleted, show_hidden ){\n        //if( !this.model ){ return this; }\n        //this.log( '_setUpWebStorage', initiallyExpanded, show_deleted, show_hidden );\n        if( this.storage ){\n            this.stopListening( this.storage );\n        }\n\n        this.storage = new HistoryPrefs({\n            id: HistoryPrefs.historyStorageKey( this.model.get( 'id' ) )\n        });\n\n        // expandedIds is a map of content.ids -> a boolean repr'ing whether that item's body is already expanded\n        // store any pre-expanded ids passed in\n        if( _.isObject( initiallyExpanded ) ){\n            this.storage.set( 'expandedIds', initiallyExpanded );\n        }\n\n        // get the show_deleted/hidden settings giving priority to values passed in, using web storage otherwise\n        // if the page has specifically requested show_deleted/hidden, these will be either true or false\n        //  (as opposed to undefined, null) - and we give priority to that setting\n        if( _.isBoolean( show_deleted ) ){\n            this.storage.set( 'show_deleted', show_deleted );\n        }\n        if( _.isBoolean( show_hidden ) ){\n            this.storage.set( 'show_hidden', show_hidden );\n        }\n\n        this.trigger( 'new-storage', this.storage, this );\n        this.log( this + ' (init\\'d) storage:', this.storage.get() );\n\n        this.listenTo( this.storage, {\n            'change:show_deleted' : function( view, newVal ){\n                this.showDeleted = newVal;\n            },\n            'change:show_hidden' : function( view, newVal ){\n                this.showHidden = newVal;\n            }\n        }, this );\n        this.showDeleted = ( show_deleted !== undefined )? show_deleted : this.storage.get( 'show_deleted' );\n        this.showHidden  = ( show_hidden  !== undefined )? show_hidden  : this.storage.get( 'show_hidden' );\n\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ panel rendering\n    /** In this override, add a btn to toggle the selectors */\n    _buildNewRender : function(){\n        var $newRender = _super.prototype._buildNewRender.call( this );\n        this._renderSelectButton( $newRender );\n        return $newRender;\n    },\n\n    /** button for starting select mode */\n    _renderSelectButton : function( $where ){\n        $where = $where || this.$el;\n        // do not render selector option if no actions\n        if( !this.multiselectActions().length ){\n            return null;\n        }\n        // do not render (and remove even) if nothing to select\n        if( !this.views.length ){\n            this.hideSelectors();\n            $where.find( '.controls .actions .show-selectors-btn' ).remove();\n            return null;\n        }\n        // don't bother rendering if there's one already\n        var $existing = $where.find( '.controls .actions .show-selectors-btn' );\n        if( $existing.size() ){\n            return $existing;\n        }\n\n        return faIconButton({\n            title   : _l( 'Operations on multiple datasets' ),\n            classes : 'show-selectors-btn',\n            faIcon  : 'fa-check-square-o'\n        }).prependTo( $where.find( '.controls .actions' ) );\n    },\n\n    // ------------------------------------------------------------------------ sub-views\n    /** In this override, since history contents are mixed,\n     *      get the appropo view class based on history_content_type\n     */\n    _getItemViewClass : function( model ){\n        var contentType = model.get( \"history_content_type\" );\n        switch( contentType ){\n            case 'dataset':\n                return this.HDAViewClass;\n            case 'dataset_collection':\n                return this.HDCAViewClass;\n        }\n        throw new TypeError( 'Unknown history_content_type: ' + contentType );\n    },\n\n    /** in this override, check if the contents would also display based on show_deleted/hidden */\n    _filterItem : function( model ){\n        var panel = this;\n        return ( _super.prototype._filterItem.call( panel, model )\n            && ( !model.hidden() || panel.showHidden )\n            && ( !model.isDeletedOrPurged() || panel.showDeleted ) );\n    },\n\n    /** in this override, add a linktarget, and expand if id is in web storage */\n    _getItemViewOptions : function( model ){\n        var options = _super.prototype._getItemViewOptions.call( this, model );\n        return _.extend( options, {\n            linkTarget      : this.linkTarget,\n            expanded        : !!this.storage.get( 'expandedIds' )[ model.id ],\n            hasUser         : this.model.ownedByCurrUser()\n        });\n    },\n\n    /** In this override, add/remove expanded/collapsed model ids to/from web storage */\n    _setUpItemViewListeners : function( view ){\n        var panel = this;\n        _super.prototype._setUpItemViewListeners.call( panel, view );\n\n        //TODO:?? could use 'view:expanded' here?\n        // maintain a list of items whose bodies are expanded\n        view.on( 'expanded', function( v ){\n            panel.storage.addExpanded( v.model );\n        });\n        view.on( 'collapsed', function( v ){\n            panel.storage.removeExpanded( v.model );\n        });\n        return this;\n    },\n\n    // ------------------------------------------------------------------------ selection\n    /** Override to correctly set the historyId of the new collection */\n    getSelectedModels : function(){\n        var collection = _super.prototype.getSelectedModels.call( this );\n        collection.historyId = this.collection.historyId;\n        return collection;\n    },\n\n    // ------------------------------------------------------------------------ panel events\n    /** event map */\n    events : _.extend( _.clone( _super.prototype.events ), {\n        // toggle list item selectors\n        'click .show-selectors-btn'         : 'toggleSelectors',\n        // allow (error) messages to be clicked away\n        'click .messages [class$=message]'  : 'clearMessages'\n    }),\n\n    /** Handle the user toggling the deleted visibility by:\n     *      (1) storing the new value in the persistent storage\n     *      (2) re-rendering the history\n     * @returns {Boolean} new show_deleted setting\n     */\n    toggleShowDeleted : function( show, store ){\n        show = ( show !== undefined )?( show ):( !this.showDeleted );\n        store = ( store !== undefined )?( store ):( true );\n        this.showDeleted = show;\n        if( store ){\n            this.storage.set( 'show_deleted', show );\n        }\n        //TODO:?? to events on storage('change:show_deleted')\n        this.renderItems();\n        this.trigger( 'show-deleted', show );\n        return this.showDeleted;\n    },\n\n    /** Handle the user toggling the hidden visibility by:\n     *      (1) storing the new value in the persistent storage\n     *      (2) re-rendering the history\n     * @returns {Boolean} new show_hidden setting\n     */\n    toggleShowHidden : function( show, store ){\n        show = ( show !== undefined )?( show ):( !this.showHidden );\n        store = ( store !== undefined )?( store ):( true );\n        this.showHidden = show;\n        if( store ){\n            this.storage.set( 'show_hidden', show );\n        }\n        //TODO:?? to events on storage('change:show_deleted')\n        this.renderItems();\n        this.trigger( 'show-hidden', show );\n        return this.showHidden;\n    },\n\n    /** On the first search, if there are no details - load them, then search */\n    _firstSearch : function( searchFor ){\n        var panel = this,\n            inputSelector = '.history-search-input';\n        this.log( 'onFirstSearch', searchFor );\n\n        if( panel.model.contents.haveDetails() ){\n            panel.searchItems( searchFor );\n            return;\n        }\n\n        panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n        panel.model.contents.fetchAllDetails({ silent: true })\n            .always( function(){\n                panel.$el.find( inputSelector ).searchInput( 'toggle-loading' );\n            })\n            .done( function(){\n                panel.searchItems( panel.searchFor );\n            });\n    },\n\n//TODO: break this out\n    // ........................................................................ error handling\n    /** Event handler for errors (from the panel, the history, or the history's contents)\n     *  @param {Model or View} model    the (Backbone) source of the error\n     *  @param {XMLHTTPRequest} xhr     any ajax obj. assoc. with the error\n     *  @param {Object} options         the options map commonly used with bbone ajax\n     *  @param {String} msg             optional message passed to ease error location\n     *  @param {Object} msg             optional object containing error details\n     */\n    errorHandler : function( model, xhr, options, msg, details ){\n        this.error( model, xhr, options, msg, details );\n\n        // interrupted ajax\n        if( xhr && xhr.status === 0 && xhr.readyState === 0 ){\n            //TODO: gmail style 'retrying in Ns'\n\n        // bad gateway\n        } else if( xhr && xhr.status === 502 ){\n            //TODO: gmail style 'retrying in Ns'\n\n        // otherwise, show an error message inside the panel\n        } else {\n            // if sentry is available, attempt to get the event id\n            var parsed = this._parseErrorMessage( model, xhr, options, msg, details );\n            // it's possible to have a triggered error before the message container is rendered - wait for it to show\n            if( !this.$messages().is( ':visible' ) ){\n                this.once( 'rendered', function(){\n                    this.displayMessage( 'error', parsed.message, parsed.details );\n                });\n            } else {\n                this.displayMessage( 'error', parsed.message, parsed.details );\n            }\n        }\n    },\n\n    /** Parse an error event into an Object usable by displayMessage based on the parameters\n     *      note: see errorHandler for more info on params\n     */\n    _parseErrorMessage : function( model, xhr, options, msg, details, sentryId ){\n        //if( xhr.responseText ){\n        //    xhr.responseText = _.escape( xhr.responseText );\n        //}\n        var user = Galaxy.currUser,\n            // add the args (w/ some extra info) into an obj\n            parsed = {\n                message : this._bePolite( msg ),\n                details : {\n                    message : msg,\n                    raven   : ( window.Raven && _.isFunction( Raven.lastEventId) )?\n                                    ( Raven.lastEventId() ):( undefined ),\n                    agent   : navigator.userAgent,\n                    // add ajax data from Galaxy object cache\n                    url     : ( window.Galaxy )?( Galaxy.lastAjax.url ):( undefined ),\n                    data    : ( window.Galaxy )?( Galaxy.lastAjax.data ):( undefined ),\n                    options : ( xhr )?( _.omit( options, 'xhr' ) ):( options ),\n                    xhr     : xhr,\n                    source  : ( _.isFunction( model.toJSON ) )?( model.toJSON() ):( model + '' ),\n                    user    : ( user instanceof USER.User )?( user.toJSON() ):( user + '' )\n                }\n            };\n\n        // add any extra details passed in\n        _.extend( parsed.details, details || {} );\n        // fancy xhr.header parsing (--> obj)\n        if( xhr &&  _.isFunction( xhr.getAllResponseHeaders ) ){\n            var responseHeaders = xhr.getAllResponseHeaders();\n            responseHeaders = _.compact( responseHeaders.split( '\\n' ) );\n            responseHeaders = _.map( responseHeaders, function( header ){\n                return header.split( ': ' );\n            });\n            parsed.details.xhr.responseHeaders = _.object( responseHeaders );\n        }\n        return parsed;\n    },\n\n    /** Modify an error message to be fancy and wear a monocle. */\n    _bePolite : function( msg ){\n        msg = msg || _l( 'An error occurred while getting updates from the server' );\n        return msg + '. ' + _l( 'Please contact a Galaxy administrator if the problem persists' ) + '.';\n    },\n\n    // ........................................................................ (error) messages\n    /** Display a message in the top of the panel.\n     *  @param {String} type    type of message ('done', 'error', 'warning')\n     *  @param {String} msg     the message to display\n     *  @param {Object or HTML} modal contents displayed when the user clicks 'details' in the message\n     */\n    displayMessage : function( type, msg, details ){\n        //precondition: msgContainer must have been rendered even if there's no model\n        var panel = this;\n        //this.log( 'displayMessage', type, msg, details );\n\n        this.scrollToTop();\n        var $msgContainer = this.$messages(),\n            $msg = $( '<div/>' ).addClass( type + 'message' ).html( msg );\n        //this.log( '  ', $msgContainer );\n\n        if( !_.isEmpty( details ) ){\n            var $detailsLink = $( '<a href=\"javascript:void(0)\">Details</a>' )\n                .click( function(){\n                    Galaxy.modal.show( panel._messageToModalOptions( type, msg, details ) );\n                    return false;\n                });\n            $msg.append( ' ', $detailsLink );\n        }\n        return $msgContainer.append( $msg );\n    },\n\n    /** convert msg and details into modal options usable by Galaxy.modal */\n    _messageToModalOptions : function( type, msg, details ){\n        // only error is fleshed out here\n        var panel = this,\n            options = { title: 'Details' };\n        if( _.isObject( details ) ){\n\n            details = _.omit( details, _.functions( details ) );\n            var text = JSON.stringify( details, null, '  ' ),\n                pre = $( '<pre/>' ).text( text );\n            options.body = $( '<div/>' ).append( pre );\n\n        } else {\n            options.body = $( '<div/>' ).html( details );\n        }\n\n        options.buttons = {\n            'Ok': function(){\n                Galaxy.modal.hide();\n                panel.clearMessages();\n            }\n            //TODO: if( type === 'error' ){ options.buttons[ 'Report this error' ] = function(){} }\n        };\n        return options;\n    },\n\n    /** Remove all messages from the panel. */\n    clearMessages : function( ev ){\n        var $target = !_.isUndefined( ev )?\n            $( ev.currentTarget )\n            :this.$messages().children( '[class$=\"message\"]' );\n        $target.fadeOut( this.fxSpeed, function(){\n            $( this ).remove();\n        });\n        return this;\n    },\n\n    // ........................................................................ scrolling\n    /** Scrolls the panel to show the content sub-view with the given hid.\n     *  @param {Integer} hid    the hid of item to scroll into view\n     *  @returns {HistoryPanel} the panel\n     */\n    scrollToHid : function( hid ){\n        return this.scrollToItem( _.first( this.viewsWhereModel({ hid: hid }) ) );\n    },\n\n    // ........................................................................ misc\n    /** Return a string rep of the history */\n    toString : function(){\n        return 'HistoryPanel(' + (( this.model )?( this.model.get( 'name' )):( '' )) + ')';\n    }\n});\n\n\n//------------------------------------------------------------------------------ TEMPLATES\nHistoryPanel.prototype.templates = (function(){\n\n    var controlsTemplate = BASE_MVC.wrapTemplate([\n        '<div class=\"controls\">',\n            '<div class=\"title\">',\n                '<div class=\"name\"><%= history.name %></div>',\n            '</div>',\n            '<div class=\"subtitle\"></div>',\n            '<div class=\"history-size\"><%= history.nice_size %></div>',\n\n            '<div class=\"actions\"></div>',\n\n            '<div class=\"messages\">',\n                '<% if( history.deleted && history.purged ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been purged and deleted' ),\n                    '</div>',\n                '<% } else if( history.deleted ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been deleted' ),\n                    '</div>',\n                '<% } else if( history.purged ){ %>',\n                    '<div class=\"deleted-msg warningmessagesmall\">',\n                        _l( 'This history has been purged' ),\n                    '</div>',\n                '<% } %>',\n\n                '<% if( history.message ){ %>',\n                    // should already be localized\n                    '<div class=\"<%= history.message.level || \"info\" %>messagesmall\">',\n                        '<%= history.message.text %>',\n                    '</div>',\n                '<% } %>',\n            '</div>',\n\n            // add tags and annotations\n            '<div class=\"tags-display\"></div>',\n            '<div class=\"annotation-display\"></div>',\n\n            '<div class=\"search\">',\n                '<div class=\"search-input\"></div>',\n            '</div>',\n\n            '<div class=\"list-actions\">',\n                '<div class=\"btn-group\">',\n                    '<button class=\"select-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'All' ), '</button>',\n                    '<button class=\"deselect-all btn btn-default\"',\n                            'data-mode=\"select\">', _l( 'None' ), '</button>',\n                '</div>',\n                '<div class=\"list-action-menu btn-group\">',\n                '</div>',\n            '</div>',\n        '</div>'\n    ], 'history' );\n\n    return _.extend( _.clone( _super.prototype.templates ), {\n        controls : controlsTemplate\n    });\n}());\n\n\n//==============================================================================\n    return {\n        HistoryPanel: HistoryPanel\n    };\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/mvc/history/history-panel.js\n ** module id = 69\n ** module chunks = 3 4\n **/","(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else {\n        // Browser globals\n        root.LoadingIndicator = factory();\n    }\n\n//============================================================================\n}(this, function () {\n    //TODO: too specific to history panel\n    function LoadingIndicator( $where, options ){\n\n        var self = this;\n        // defaults\n        options = jQuery.extend({\n            cover       : false\n        }, options || {} );\n\n        function render(){\n            var html = [\n                '<div class=\"loading-indicator\">',\n                    '<div class=\"loading-indicator-text\">',\n                        '<span class=\"fa fa-spinner fa-spin fa-lg\"></span>',\n                        '<span class=\"loading-indicator-message\">loading...</span>',\n                    '</div>',\n                '</div>'\n            ].join( '\\n' );\n\n            var $indicator = $( html ).hide().css( options.css || {\n                    position    : 'fixed'\n                }),\n                $text = $indicator.children( '.loading-indicator-text' );\n\n            if( options.cover ){\n                $indicator.css({\n                    'z-index'   : 2,\n                    top         : $where.css( 'top' ),\n                    bottom      : $where.css( 'bottom' ),\n                    left        : $where.css( 'left' ),\n                    right       : $where.css( 'right' ),\n                    opacity     : 0.5,\n                    'background-color': 'white',\n                    'text-align': 'center'\n                });\n                $text = $indicator.children( '.loading-indicator-text' ).css({\n                    'margin-top'        : '20px'\n                });\n\n            } else {\n                $text = $indicator.children( '.loading-indicator-text' ).css({\n                    margin              : '12px 0px 0px 10px',\n                    opacity             : '0.85',\n                    color               : 'grey'\n                });\n                $text.children( '.loading-indicator-message' ).css({\n                    margin          : '0px 8px 0px 0px',\n                    'font-style'    : 'italic'\n                });\n            }\n            return $indicator;\n        }\n\n        self.show = function( msg, speed, callback ){\n            msg = msg || 'loading...';\n            speed = speed || 'fast';\n            // remove previous\n            $where.parent().find( '.loading-indicator' ).remove();\n            // since position is fixed - we insert as sibling\n            self.$indicator = render().insertBefore( $where );\n            self.message( msg );\n            self.$indicator.fadeIn( speed, callback );\n            return self;\n        };\n\n        self.message = function( msg ){\n            self.$indicator.find( 'i' ).text( msg );\n        };\n\n        self.hide = function( speed, callback ){\n            speed = speed || 'fast';\n            if( self.$indicator && self.$indicator.size() ){\n                self.$indicator.fadeOut( speed, function(){\n                    self.$indicator.remove();\n                    if( callback ){ callback(); }\n                });\n            } else {\n                if( callback ){ callback(); }\n            }\n            return self;\n        };\n        return self;\n    }\n\n//============================================================================\n    return LoadingIndicator;\n}));\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/ui/loading-indicator.js\n ** module id = 79\n ** module chunks = 3 4\n **/","define([\n], function(){\n//=============================================================================\n/**\n(Imported for edit distance algorith. From: https://gist.github.com/andrei-m/982927)\nCopyright (c) 2011 Andrei Mackenzie\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the\nrights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit\npersons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the\nSoftware.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// Compute the edit distance between the two given strings\n//exports.getEditDistance = function(a, b){\nfunction levenshteinDistance(a, b){\n  if(a.length === 0){ return b.length; }\n  if(b.length === 0){ return a.length; }\n\n  var matrix = [];\n\n  // increment along the first column of each row\n  var i;\n  for(i = 0; i <= b.length; i++){\n    matrix[i] = [i];\n  }\n\n  // increment each column in the first row\n  var j;\n  for(j = 0; j <= a.length; j++){\n    matrix[0][j] = j;\n  }\n\n  // Fill in the rest of the matrix\n  for(i = 1; i <= b.length; i++){\n    for(j = 1; j <= a.length; j++){\n      if(b.charAt(i-1) === a.charAt(j-1)){\n        matrix[i][j] = matrix[i-1][j-1];\n      } else {\n        matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, // substitution\n                                Math.min(matrix[i][j-1] + 1, // insertion\n                                         matrix[i-1][j] + 1)); // deletion\n      }\n    }\n  }\n\n  //console.debug( '\\t\\t levenshteinDistance', a, b, matrix[b.length][a.length] );\n  return matrix[b.length][a.length];\n}\n\n//=============================================================================\n    return levenshteinDistance;\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./galaxy/scripts/utils/levenshtein.js\n ** module id = 82\n ** module chunks = 3 4\n **/"],"sourceRoot":""}