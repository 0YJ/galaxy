webpackJsonp([1],[function(e,t,i){var n=i(33).GalaxyApp,r=i(47).HistoryPanelEdit,s=i(24).History,o=i(14).GalaxyMasthead,a=i(35).GalaxyMenu;window.app=function(e,t){if(window.Galaxy||(window.Galaxy=new n(e,t)),!Galaxy.masthead||!Galaxy.menu){var i=_.extend(_.clone(Galaxy.config),{user:{requests:Galaxy.currUser.get("requests"),email:Galaxy.currUser.get("email"),valid:Galaxy.currUser.isAnonymous(),json:Galaxy.currUser.toJSON()}});Galaxy.masthead=new o(i),Galaxy.menu=new a({masthead:Galaxy.masthead,config:i}),console.debug(Galaxy.masthead),console.debug(Galaxy.menu)}return t=t||{},window.panel=new r({show_deleted:t.show_deleted,show_hidden:t.show_deleted,purgeAllowed:Galaxy.config.allow_user_dataset_purge,model:new s(t.history,t.contents)}),$(function(){panel.render().$el.appendTo((e||{}).panelLoc||"body")}),panel}},function(e,t,i){var n,r;n=[],r=function(e){e={};var t=function(i){return t.cacheNonLocalized&&!e.hasOwnProperty(i)&&(t.nonLocalized||(t.nonLocalized={}),t.nonLocalized[i]=navigator.language),e[i]||i};return t.cacheNonLocalized=!1,t}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(31),i(1)],r=function(e,t){function i(e,t){var i=Array.prototype.slice.call(arguments,0),n=i.pop();return i.unshift(n),_.defaults.apply(_,i)}function n(e,i){i=i||"model";var n=_.template(e.join(""));return function(e,r){var s={view:r||{},_l:t};return s[i]=e||{},n(s)}}var r={logger:null,_logNamespace:"?",log:function(){if(this.logger){var e=this.logger.log;return"object"==typeof this.logger.log&&(e=Function.prototype.bind.call(this.logger.log,this.logger)),e.apply(this.logger,arguments)}return void 0}};e(r);var s=Backbone.Model.extend({initialize:function(e){if(this._checkEnabledSessionStorage(),!e.id)throw new Error("SessionStorageModel requires an id in the initial attributes");this.id=e.id;var t=this.isNew()?{}:this._read(this);this.clear({silent:!0}),this.save(_.extend({},this.defaults,t,e),{silent:!0}),this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return sessionStorage.length}catch(e){return alert("Please enable cookies in your browser for this Galaxy site"),!1}},sync:function(e,t,i){i.silent||t.trigger("request",t,{},i);var n={};switch(e){case"create":n=this._create(t);break;case"read":n=this._read(t);break;case"update":n=this._update(t);break;case"delete":n=this._delete(t)}return void 0!==n||null!==n?i.success&&i.success():i.error&&i.error(),n},_create:function(e){try{var t=e.toJSON(),i=sessionStorage.setItem(e.id,JSON.stringify(t));return null===i?i:t}catch(n){if(!(n instanceof DOMException&&navigator.userAgent.indexOf("Safari")>-1))throw n}return null},_read:function(e){return JSON.parse(sessionStorage.getItem(e.id))},_update:function(e){return e._create(e)},_delete:function(e){return sessionStorage.removeItem(e.id)},isNew:function(){return!sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel("+this.id+")"}});!function(){s.prototype=_.omit(s.prototype,"url","urlRoot")}();var o={searchAttributes:[],searchAliases:{},searchAttribute:function(e,t){var i=this.get(e);return t&&void 0!==i&&null!==i?_.isArray(i)?this._searchArrayAttribute(i,t):-1!==i.toString().toLowerCase().indexOf(t.toLowerCase()):!1},_searchArrayAttribute:function(e,t){return t=t.toLowerCase(),_.any(e,function(e){return-1!==e.toString().toLowerCase().indexOf(t.toLowerCase())})},search:function(e){var t=this;return _.filter(this.searchAttributes,function(i){return t.searchAttribute(i,e)})},matches:function(e){var t="=",i=e.split(t);if(i.length>=2){var n=i[0];return n=this.searchAliases[n]||n,this.searchAttribute(n,i[1])}return!!this.search(e).length},matchesAll:function(e){var t=this;return e=e.match(/(".*"|\w*=".*"|\S*)/g).filter(function(e){return!!e}),_.all(e,function(e){return e=e.replace(/"/g,""),t.matches(e)})}},a={hiddenUntilActivated:function(e,t){if(t=t||{},this.HUAVOptions={$elementShown:this.$el,showFn:jQuery.prototype.toggle,showSpeed:"fast"},_.extend(this.HUAVOptions,t||{}),this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible"),this.hidden=this.isHidden(),e){var i=this;e.on("click",function(e){i.toggle(i.HUAVOptions.showSpeed)})}},isHidden:function(){return this.HUAVOptions.$elementShown.is(":hidden")},toggle:function(){return this.hidden?(this.HUAVOptions.hasBeenShown||_.isFunction(this.HUAVOptions.onshowFirstTime)&&(this.HUAVOptions.hasBeenShown=!0,this.HUAVOptions.onshowFirstTime.call(this)),_.isFunction(this.HUAVOptions.onshow)&&(this.HUAVOptions.onshow.call(this),this.trigger("hiddenUntilActivated:shown",this)),this.hidden=!1):(_.isFunction(this.HUAVOptions.onhide)&&(this.HUAVOptions.onhide.call(this),this.trigger("hiddenUntilActivated:hidden",this)),this.hidden=!0),this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}},l={initialize:function(e){this.draggable=e.draggable||!1},$dragHandle:function(){return this.$(".title-bar")},toggleDraggable:function(){this.draggable?this.draggableOff():this.draggableOn()},draggableOn:function(){this.draggable=!0,this.dragStartHandler=_.bind(this._dragStartHandler,this),this.dragEndHandler=_.bind(this._dragEndHandler,this);var e=this.$dragHandle().attr("draggable",!0).get(0);e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1)},draggableOff:function(){this.draggable=!1;var e=this.$dragHandle().attr("draggable",!1).get(0);e.removeEventListener("dragstart",this.dragStartHandler,!1),e.removeEventListener("dragend",this.dragEndHandler,!1)},_dragStartHandler:function(e){return e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",JSON.stringify(this.model.toJSON())),this.trigger("draggable:dragstart",e,this),!1},_dragEndHandler:function(e){return this.trigger("draggable:dragend",e,this),!1}},c={initialize:function(e){this.selectable=e.selectable||!1,this.selected=e.selected||!1},$selector:function(){return this.$(".selector")},_renderSelected:function(){this.$selector().find("span").toggleClass("fa-check-square-o",this.selected).toggleClass("fa-square-o",!this.selected)},toggleSelector:function(){this.$selector().is(":visible")?this.hideSelector():this.showSelector()},showSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!0,this.trigger("selectable",!0,this),this._renderSelected(),this.$selector().show(e)},hideSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!1,this.trigger("selectable",!1,this),this.$selector().hide(e)},toggleSelect:function(e){this.selected?this.deselect(e):this.select(e)},select:function(e){return this.selected||(this.trigger("selected",this,e),this.selected=!0,this._renderSelected()),!1},deselect:function(e){return this.selected&&(this.trigger("de-selected",this,e),this.selected=!1,this._renderSelected()),!1}};return{LoggableMixin:r,SessionStorageModel:s,mixin:i,SearchableModelMixin:o,HiddenUntilActivatedViewMixin:a,DraggableViewMixin:l,SelectableViewMixin:c,wrapTemplate:n}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){var e={UPLOAD:"upload",QUEUED:"queued",RUNNING:"running",SETTING_METADATA:"setting_metadata",NEW:"new",EMPTY:"empty",OK:"ok",PAUSED:"paused",FAILED_METADATA:"failed_metadata",NOT_VIEWABLE:"noPermission",DISCARDED:"discarded",ERROR:"error"};return e.READY_STATES=[e.OK,e.EMPTY,e.PAUSED,e.FAILED_METADATA,e.NOT_VIEWABLE,e.DISCARDED,e.ERROR],e.NOT_READY_STATES=[e.UPLOAD,e.QUEUED,e.RUNNING,e.SETTING_METADATA,e.NEW],e}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r,s;!function(i,o){r=[],n=o,s="function"==typeof n?n.apply(t,r):n,!(void 0!==s&&(e.exports=s))}(this,function(){var e=function(e){e=e||{},e.tooltipConfig=e.tooltipConfig||{placement:"bottom"},e.classes=["icon-btn"].concat(e.classes||[]),e.disabled&&e.classes.push("disabled");var t=['<a class="',e.classes.join(" "),'"',e.title?' title="'+e.title+'"':"",!e.disabled&&e.target?' target="'+e.target+'"':"",' href="',!e.disabled&&e.href?e.href:"javascript:void(0);",'">','<span class="fa ',e.faIcon,'"></span>',"</a>"].join(""),i=$(t).tooltip(e.tooltipConfig);return _.isFunction(e.onclick)&&i.click(e.onclick),i};return e})},function(e,t,i){var n,r;n=[i(13),i(9),i(2),i(1)],r=function(e,t,i,n){var r=e.FoldoutListItemView,s=e.ListItemView,o=r.extend({className:r.prototype.className+" dataset-collection",id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(e){this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,r.prototype.initialize.call(this,e)},_setUpListeners:function(){r.prototype._setUpListeners.call(this),this.model.on("change",function(e,t){_.isEqual(_.keys(e.changed),["deleted"])&&this.render()},this)},_renderSubtitle:function(){var e=$('<div class="subtitle"></div>');switch(this.model.get("collection_type")){case"list":return e.text(n("a list of datasets"));case"paired":return e.text(n("a pair of datasets"));case"list:paired":return e.text(n("a list of paired datasets"))}return e},_getFoldoutPanelOptions:function(){var e=r.prototype._getFoldoutPanelOptions.call(this);return _.extend(e,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCListItemView("+e+")"}});o.prototype.templates=function(){var e=_.extend({},r.prototype.templates.warnings,{error:i.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',n("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:i.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',n("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:i.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',n("This collection has been deleted"),"</div>","<% } %>"])}),t=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection");return _.extend({},r.prototype.templates,{warnings:e,titleBar:t})}();var a=s.extend({className:s.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DCEListItemView.initialize:",e),s.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCEListItemView("+e+")"}});a.prototype.templates=function(){var e=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return _.extend({},s.prototype.templates,{titleBar:e})}();var l=t.DatasetListItemView.extend({className:t.DatasetListItemView.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DatasetDCEListItemView.initialize:",e),t.DatasetListItemView.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetDCEListItemView("+e+")"}});l.prototype.templates=function(){var e=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return _.extend({},t.DatasetListItemView.prototype.templates,{titleBar:e})}();var c=o.extend({className:o.prototype.className+" dataset-collection-element",_swapNewRender:function(e){o.prototype._swapNewRender.call(this,e);var t=this.model.get("state")||"ok";return this.$el.addClass("state-"+t),this.$el},toString:function(){var e=this.model?this.model+"":"(no model)";return"NestedDCDCEListItemView("+e+")"}});return{DCListItemView:o,DCEListItemView:a,DatasetDCEListItemView:l,NestedDCDCEListItemView:c}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(20),i(2),i(1)],r=function(e,t,i){var n={defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(e){return _.extend(e,e.object,{element_id:e.id}),delete e.object,e},constructor:function(e,t){e=this._mergeObject(e),this.idAttribute="element_id",Backbone.Model.apply(this,arguments)},parse:function(e,t){var i=e;return i=this._mergeObject(i)}},r=Backbone.Model.extend(t.LoggableMixin).extend(n),s=Backbone.Collection.extend(t.LoggableMixin).extend({model:r,initialize:function(e,t){this.debug(this+"(DCECollection).initialize:",e,t),t=t||{}},toString:function(){return["DatasetCollectionElementCollection(",this.length,")"].join("")}}),o=e.DatasetAssociation.extend(t.mixin(n,{defaults:_.extend({},e.DatasetAssociation.prototype.defaults,n.defaults),constructor:function(e,t){this.debug("	 DatasetDCE.constructor:",e,t),n.constructor.call(this,e,t)},initialize:function(t,i){this.debug(this+"(DatasetDCE).initialize:",t,i),e.DatasetAssociation.prototype.initialize.call(this,t,i)},toString:function(){var e=this.get("element_identifier");return["DatasetDCE(",e,")"].join("")}})),a=s.extend({model:o,initialize:function(e,t){this.debug(this+"(DatasetDCECollection).initialize:",e,t),s.prototype.initialize.call(this,e,t)},toString:function(){return["DatasetDCECollection(",this.length,")"].join("")}}),l=Backbone.Model.extend(t.LoggableMixin).extend(t.SearchableModelMixin).extend({defaults:{collection_type:null,deleted:!1},collectionClass:s,initialize:function(e,t){this.debug(this+"(DatasetCollection).initialize:",e,t,this),this.elements=this._createElementsModel(),this.on("change:elements",function(){this.log("change:elements"),this.elements=this._createElementsModel()})},_createElementsModel:function(){this.debug(this+"._createElementsModel",this.collectionClass,this.get("elements"),this.elements);var e=this.get("elements")||[];return this.unset("elements",{silent:!0}),this.elements=new this.collectionClass(e),this.elements},toJSON:function(){var e=Backbone.Model.prototype.toJSON.call(this);return this.elements&&(e.elements=this.elements.toJSON()),e},inReadyState:function(){return!0},hasDetails:function(){return this.debug("hasDetails:",this.elements.length),0!==this.elements.length},getVisibleContents:function(e){return this.elements},"delete":function(e){return this.get("deleted")?jQuery.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?jQuery.when():this.save({deleted:!1},e)},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},searchAttributes:["name"],toString:function(){var e=[this.get("id"),this.get("name")||this.get("element_identifier")];return"DatasetCollection("+e.join(",")+")"}}),c=l.extend({collectionClass:a,initialize:function(e,t){this.debug(this+"(ListDatasetCollection).initialize:",e,t),l.prototype.initialize.call(this,e,t)},toString:function(){return["ListDatasetCollection(",this.get("name"),")"].join("")}}),d=c.extend({initialize:function(e,t){this.debug(this+"(PairDatasetCollection).initialize:",e,t),c.prototype.initialize.call(this,e,t)},toString:function(){return["PairDatasetCollection(",this.get("name"),")"].join("")}}),u=l.extend(t.mixin(n,{constructor:function(e,t){this.debug("	 NestedDCDCE.constructor:",e,t),n.constructor.call(this,e,t)},toString:function(){var e=this.object?""+this.object:this.get("element_identifier");return["NestedDCDCE(",e,")"].join("")}})),h=s.extend({model:u,initialize:function(e,t){this.debug(this+"(NestedDCDCECollection).initialize:",e,t),s.prototype.initialize.call(this,e,t)},toString:function(){return["NestedDCDCECollection(",this.length,")"].join("")}}),p=d.extend(t.mixin(n,{constructor:function(e,t){this.debug("	 NestedPairDCDCE.constructor:",e,t),n.constructor.call(this,e,t)},toString:function(){var e=this.object?""+this.object:this.get("element_identifier");return["NestedPairDCDCE(",e,")"].join("")}})),f=h.extend({model:p,initialize:function(e,t){this.debug(this+"(NestedPairDCDCECollection).initialize:",e,t),h.prototype.initialize.call(this,e,t)},toString:function(){return["NestedPairDCDCECollection(",this.length,")"].join("")}}),g=l.extend({collectionClass:f,initialize:function(e,t){this.debug(this+"(ListPairedDatasetCollection).initialize:",e,t),l.prototype.initialize.call(this,e,t)},toString:function(){return["ListPairedDatasetCollection(",this.get("name"),")"].join("")}});return{ListDatasetCollection:c,PairDatasetCollection:d,ListPairedDatasetCollection:g}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(25),i(6),i(5),i(2),i(1)],r=function(e,t,i,n,r){var s=e.ModelListPanel,o=s.extend({className:s.prototype.className+" dataset-collection-panel",DatasetDCEViewClass:i.DatasetDCEListItemView,NestedDCDCEViewClass:i.NestedDCDCEListItemView,modelCollectionKey:"elements",initialize:function(e){s.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,this.panelStack=[],this.parentName=e.parentName,this.foldoutStyle=e.foldoutStyle||"foldout"},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(e){switch(e.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.NestedDCDCEViewClass}throw new TypeError("Unknown element type:",e.get("element_type"))},_getItemViewOptions:function(e){var t=s.prototype._getItemViewOptions.call(this,e);return _.extend(t,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(e){var t=this;return s.prototype._setUpItemViewListeners.call(t,e),e.on("expanded:drilldown",function(e,t){this._expandDrilldownPanel(t)},this),e.on("collapsed:drilldown",function(e,t){this._collapseDrilldownPanel(t)},this),this},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$("> .controls").add(this.$list()).hide(),e.parentName=this.model.get("name"),this.$el.append(e.render().$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(e){this.$el.remove(),this.trigger("close")},toString:function(){return"CollectionPanel("+(this.model?this.model.get("name"):"")+")"}});o.prototype.templates=function(){var e=n.wrapTemplate(['<div class="controls">','<div class="navigation">','<a class="back" href="javascript:void(0)">','<span class="fa fa-icon fa-angle-left"></span>',r("Back to "),"<%- view.parentName %>","</a>","</div>",'<div class="title">','<div class="name"><%- collection.name || collection.element_identifier %></div>','<div class="subtitle">','<% if( collection.collection_type === "list" ){ %>',r("a list of datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',r("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',r("a list of paired datasets"),"<% } %>","</div>","</div>","</div>"],"collection");return _.extend(_.clone(s.prototype.templates),{controls:e})}();var a=o.extend({DatasetDCEViewClass:i.DatasetDCEListItemView,toString:function(){return"ListCollectionPanel("+(this.model?this.model.get("name"):"")+")"}}),l=a.extend({toString:function(){return"PairCollectionPanel("+(this.model?this.model.get("name"):"")+")"}}),c=o.extend({NestedDCDCEViewClass:i.NestedDCDCEListItemView.extend({foldoutPanelClass:l}),toString:function(){return"ListOfPairsCollectionPanel("+(this.model?this.model.get("name"):"")+")"}});return{CollectionPanel:o,ListCollectionPanel:a,PairCollectionPanel:l,ListOfPairsCollectionPanel:c}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(10),i(3),i(2),i(49),i(32),i(1),i(29)],r=function(e,t,i,n,r,s){function o(e){var t=e.toJSON(),i=d(t,{creationFn:function(t,i){return t=t.map(function(e){return{id:e.id,name:e.name,src:"dataset"===e.history_content_type?"hda":"hdca"}}),e.createHDCA(t,"list",i)}});return i}var a=Backbone.View.extend(i.LoggableMixin).extend({tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.selected=e.selected||!1},render:function(){return this.$el.attr("data-element-id",this.element.id).attr("draggable",!0).html(this.template({element:this.element})),this.selected&&this.$el.addClass("selected"),this},template:_.template(['<a class="name" title="',s("Click to rename"),'" href="javascript:void(0)">',"<%= element.name %>","</a>",'<button class="discard btn btn-sm" title="',s("Remove this dataset from the list"),'">',s("Discard"),"</button>"].join("")),select:function(e){this.$el.toggleClass("selected",e),this.trigger("select",{source:this,selected:this.$el.hasClass("selected")})},discard:function(){var e=this,t=this.$el.parent().width();this.$el.animate({"margin-right":t},"fast",function(){e.trigger("discard",{source:e}),e.destroy()})},destroy:function(){this.off(),this.$el.remove()},events:{click:"_click","click .name":"_clickName","click .discard":"_clickDiscard",dragstart:"_dragstart",dragend:"_dragend",dragover:"_sendToParent",drop:"_sendToParent"},_click:function(e){e.stopPropagation(),this.select(e)},_clickName:function(e){e.stopPropagation(),e.preventDefault();var t=([s("Enter a new name for the element"),":\n(",s("Note that changing the name here will not rename the dataset"),")"].join(""),prompt(s("Enter a new name for the element")+":",this.element.name));t&&(this.element.name=t,this.render())},_clickDiscard:function(e){e.stopPropagation(),this.discard()},_dragstart:function(e){e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.element)),this.$el.addClass("dragging"),this.$el.parent().trigger("collection-element.dragstart",[this])},_dragend:function(e){this.$el.removeClass("dragging"),this.$el.parent().trigger("collection-element.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"DatasetCollectionElementView()"}}),l=Backbone.View.extend(i.LoggableMixin).extend({elementViewClass:a,collectionClass:e.HistoryListDatasetCollection,className:"list-collection-creator collection-creator flex-row-container",minElements:1,defaultAttributes:{creationFn:function(){throw new TypeError("no creation fn for creator")},oncreate:function(){},oncancel:function(){},autoscrollDist:24,highlightClr:"rgba( 64, 255, 255, 1.0 )"},initialize:function(e){this.metric("ListCollectionCreator.initialize",e);var t=this;_.each(this.defaultAttributes,function(i,n){i=e[n]||i,t[n]=i}),t.initialElements=e.elements||[],this._instanceSetUp(),this._elementsSetUp(),this._setUpBehaviors()},_instanceSetUp:function(){this.selectedIds={},this.$dragging=null,this.blocking=!1},_elementsSetUp:function(){this.invalidElements=[],this.workingElements=[],this.elementViews=[],this.workingElements=this.initialElements.slice(0),this._ensureElementIds(),this._validateElements(),this._mangleDuplicateNames(),this._sortElements()},_ensureElementIds:function(){return this.workingElements.forEach(function(e){e.hasOwnProperty("id")||(e.id=_.uniqueId())}),this.workingElements},_validateElements:function(){var e=this;return e.invalidElements=[],this.workingElements=this.workingElements.filter(function(t){var i=e._isElementInvalid(t);return i&&e.invalidElements.push({element:t,text:i}),!i}),this.workingElements},_isElementInvalid:function(e){return"dataset"!==e.history_content_type?s("is not a dataset"):e.state!==t.OK?s(_.contains(t.NOT_READY_STATES,e.state)?"hasn't finished running yet":"has errored, is paused, or is not accessible"):e.deleted||e.purged?s("has been deleted or purged"):null},_mangleDuplicateNames:function(){var e=900,t=1,i={};this.workingElements.forEach(function(n){for(var r=n.name;i.hasOwnProperty(r);)if(r=n.name+" ("+t+")",t+=1,t>=e)throw new Error("Safety hit in while loop - thats impressive");n.name=r,i[n.name]=!0})},_sortElements:function(e){},render:function(e,t){return this.workingElements.length<this.minElements?this._renderInvalid(e,t):(this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.$(".collection-name").focus(),this.trigger("rendered",this),this)},_renderInvalid:function(e,t){return this.$el.empty().html(this.templates.invalidInitial({problems:this.invalidElements,elements:this.workingElements})),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend($(this.templates.helpContent()));return this.invalidElements.length&&this._invalidElementsAlert(),i},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(this.templates.middle());return this._renderList(e),i},_renderFooter:function(e,t){var i=this.$(".footer").empty().html(this.templates.footer());return"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),i},_addPluginComponents:function(){this.$(".help-content i").hoverhighlight(".collection-creator",this.highlightClr)},_invalidElementsAlert:function(){this._showAlert(this.templates.invalidElements({problems:this.invalidElements}),"alert-warning")},_validationWarning:function(e,t){var i="validation-warning";"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$("."+i),e.removeClass(i)):e.addClass(i)},_disableNameAndCreate:function(e){e=_.isUndefined(e)?!0:e,e&&(this.$(".collection-name").prop("disabled",!0),this.$(".create-collection").toggleClass("disabled",!0))},$list:function(){return this.$(".collection-elements")},_renderClearSelected:function(){_.size(this.selectedIds)?this.$(".collection-elements-controls > .clear-selected").show():this.$(".collection-elements-controls > .clear-selected").hide()},_renderList:function(e,t){var i=this,n=jQuery("<div/>"),r=i.$list();_.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),i.workingElements.forEach(function(e){var t=i._createElementView(e);n.append(t.$el)}),i._renderClearSelected(),r.empty().append(n.children()),_.invoke(i.elementViews,"render"),r.height()>r.css("max-height")?r.css("border-width","1px 0px 1px 0px"):r.css("border-width","0px")},_createElementView:function(e){var t=new this.elementViewClass({element:e,selected:_.has(this.selectedIds,e.id)});return this.elementViews.push(t),this._listenToElementView(t),t},_listenToElementView:function(e){var t=this;t.listenTo(e,{select:function(e){var i=e.source.element;e.selected?t.selectedIds[i.id]=!0:delete t.selectedIds[i.id],t.trigger("elements:select",e)},discard:function(e){t.trigger("elements:discard",e)}})},addElementView:function(e){},removeElementView:function(e){delete this.selectedIds[e.element.id],this._renderClearSelected(),this.elementViews=_.without(this.elementViews,e),this.stopListening(e)},_renderNoElementsLeft:function(){this._disableNameAndCreate(!0),this.$(".collection-elements").append(this.templates.noElementsLeft())},_elementToJSON:function(e){return e},createList:function(e){if(!this.workingElements.length){var t=s("No valid elements for final list")+". ";return t+='<a class="cancel-create" href="javascript:void(0);">'+s("Cancel")+"</a> ",t+=s("or"),t+=' <a class="reset" href="javascript:void(0);">'+s("start over")+"</a>.",void this._showAlert(t)}var i=this,n=this.workingElements.map(function(e){return i._elementToJSON(e)});return i.blocking=!0,i.creationFn(n,e).always(function(){i.blocking=!1}).fail(function(e,t,n){i.trigger("error",{xhr:e,status:t,message:s("An error occurred while creating this collection")})}).done(function(e,t,n){i.trigger("collection:created",e,t,n),i.metric("collection:created",e),"function"==typeof i.oncreate&&i.oncreate.call(this,e,t,n)})},_setUpBehaviors:function(){return this.on("error",this._errorHandler),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("elements:select",function(e){this._renderClearSelected()}),this.on("elements:discard",function(e){var t=e.source.element;this.removeElementView(e.source),this.workingElements=_.without(this.workingElements,t),this.workingElements.length||this._renderNoElementsLeft()}),this},_errorHandler:function(e){this.error(e);var t=this;if(content=e.message||s("An error occurred"),e.xhr){var i=e.xhr,n=e.message;0===i.readyState&&0===i.status?content+=": "+s("Galaxy could not be reached and may be updating.")+s(" Try again in a few minutes."):i.responseJSON?content+=":<br /><pre>"+JSON.stringify(i.responseJSON)+"</pre>":content+=": "+n}t._showAlert(content,"alert-danger")},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .reset":"reset","click .clear-selected":"clearSelectedElements","click .collection-elements":"clearSelectedElements","dragover .collection-elements":"_dragoverElements","drop .collection-elements":"_dropElements","collection-element.dragstart .collection-elements":"_elementDragstart","collection-element.dragend   .collection-elements":"_elementDragend","change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","click .cancel-create":function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},"click .create-collection":"_clickCreate"},_clickMoreHelp:function(e){e.stopPropagation(),this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){e.stopPropagation(),this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_toggleHelp:function(e){e.stopPropagation(),this.$(".main-help").toggleClass("expanded"),this.$(".more-help").toggle()},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},reset:function(){this._instanceSetUp(),this._elementsSetUp(),this.render()},clearSelectedElements:function(e){this.$(".collection-elements .collection-element").removeClass("selected"),this.$(".collection-elements-controls > .clear-selected").hide()},_dragoverElements:function(e){e.preventDefault();var t=this.$list();this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestElement(e.originalEvent.clientY);this.$(".element-drop-placeholder").remove();var n=$('<div class="element-drop-placeholder"></div>');i.size()?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=2,n=e.offset(),r=e.scrollTop(),s=t-n.top,o=n.top+e.outerHeight()-t;s>=0&&s<this.autoscrollDist?e.scrollTop(r-i):o>=0&&o<this.autoscrollDist&&e.scrollTop(r+i)},_getNearestElement:function(e){for(var t=4,i=this.$(".collection-elements li.collection-element").toArray(),n=0;n<i.length;n++){var r=$(i[n]),s=r.offset().top,o=Math.floor(r.outerHeight()/2)+t;if(s+o>e&&e>s-o)return r}return $()},_dropElements:function(e){e.originalEvent&&(e=e.originalEvent),e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestElement(e.clientY);return t.size()?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".collection-elements .collection-element").last()),this._syncOrderToDom(),!1},_syncOrderToDom:function(){var e=this,t=[];this.$(".collection-elements .collection-element").each(function(){var i=$(this).attr("data-element-id"),n=_.findWhere(e.workingElements,{id:i});n?t.push(n):console.error("missing element: ",i)}),this.workingElements=t,this._renderList()},_elementDragstart:function(e,t){t.select(!0),this.$dragging=this.$(".collection-elements .collection-element.selected")},_elementDragend:function(e,t){$(".element-drop-placeholder").remove(),this.$dragging=null},_changeName:function(e){this._validationWarning("name",!!this._getName());
},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return _.escape(this.$(".collection-name").val())},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList(t):this._validationWarning("name")},templates:{main:_.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex"></div>'].join("")),header:_.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',s("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',s("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" ','title="',s("Close and show more help"),'" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>"].join("")),middle:_.template(['<div class="collection-elements-controls">','<a class="reset" href="javascript:void(0);" ','title="',s("Undo all reordering and discards"),'">',s("Start over"),"</a>",'<a class="clear-selected" href="javascript:void(0);" ','title="',s("De-select all selected datasets"),'">',s("Clear selected"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),footer:_.template(['<div class="attributes clear">','<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',s("Enter a name for your new collection"),'" />','<div class="collection-name-prompt pull-right">',s("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',s("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',s("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',s("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',s("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',s("Create list"),"</button>","</div>","</div>"].join("")),helpContent:_.template(["<p>",s(["Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ","workflows in order to have analyses done on each member of the entire group. This interface allows ","you to create a collection and re-order the final collection."].join("")),"</p>","<ul>","<li>",s(["Rename elements in the list by clicking on ",'<i data-target=".collection-element .name">the existing name</i>.'].join("")),"</li>","<li>",s(["Discard elements from the final created list by clicking on the ",'<i data-target=".collection-element .discard">"Discard"</i> button.'].join("")),"</li>","<li>",s(["Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ",'<i data-target=".collection-element">them</i> and you can then move those selected by dragging the ',"entire group. Deselect them by clicking them again or by clicking the ",'the <i data-target=".clear-selected">"Clear selected"</i> link.'].join("")),"</li>","<li>",s(['Click the <i data-target=".reset">"Start over"</i> link to begin again as if you had just opened ',"the interface."].join("")),"</li>","<li>",s(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",s(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidElements:_.template([s("The following selections could not be included due to problems:"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%= problem.element.name %></b>: <%= problem.text %></li>","<% }); %></ul>"].join("")),noElementsLeft:_.template(['<li class="no-elements-left-message">',s("No elements left! "),s("Would you like to "),'<a class="reset" href="javascript:void(0)">',s("start over"),"</a>?","</li>"].join("")),invalidInitial:_.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",s("The following selections could not be included due to problems"),":","<ul><% _.each( problems, function( problem ){ %>","<li><b><%= problem.element.name %></b>: <%= problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) < 1 ){ %>",s("No datasets were selected"),".","<% } %>","<br />",s("At least one element is needed for the collection"),". ",s("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',s("cancel"),"</a> ",s("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',s("Cancel"),"</button>","</div>","</div>","</div>"].join(""))},toString:function(){return"ListCollectionCreator"}}),c=function(e,t,i){var r,o=jQuery.Deferred(),a=Galaxy.modal||new n.View;return t=_.defaults(t||{},{elements:e,oncancel:function(){a.hide(),o.reject("cancelled")},oncreate:function(e,t){a.hide(),o.resolve(t)}}),r=new i(t),a.show({title:t.title||s("Create a collection"),body:r.$el,width:"80%",height:"min-content",closing_events:!0}),r.render(),window._collectionCreator=r,o},d=function(e,t){return t=t||{},t.title=s("Create a collection from a list of datasets"),c(e,t,l)};return{DatasetCollectionElementView:a,ListCollectionCreator:l,collectionCreatorModal:c,listCollectionCreatorModal:d,createListCollection:o}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(13),i(3),i(4),i(2),i(1)],r=function(e,t,i,n,r){var s=e.ListItemView,o=s.extend({className:s.prototype.className+" dataset",id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log(this+".initialize:",e),s.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank",this._setUpListeners()},_setUpListeners:function(){s.prototype._setUpListeners.call(this),this.model.on("change",function(e,t){this.model.changedAttributes().state&&this.model.inReadyState()&&this.expanded&&!this.model.hasDetails()?this.model.fetch():this.render()},this)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):jQuery.when()},remove:function(e,t){var i=this;e=e||this.fxSpeed,this.$el.fadeOut(e,function(){Backbone.View.prototype.remove.call(i),t&&t.call(i)})},render:function(e){return s.prototype.render.call(this,e)},_swapNewRender:function(e){return s.prototype._swapNewRender.call(this,e),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var e=this.model.get("state");if(e===t.NOT_VIEWABLE||e===t.DISCARDED||!this.model.get("accessible"))return null;var n={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))n.disabled=!0,n.title=r("Cannot display datasets removed from disk");else if(e===t.UPLOAD)n.disabled=!0,n.title=r("This dataset must finish uploading before it can be viewed");else if(e===t.NEW)n.disabled=!0,n.title=r("This dataset is not yet viewable");else{n.title=r("View data"),n.href=this.model.urls.display;var s=this;n.onclick=function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add_dataset(s.model.get("id")),e.preventDefault())}}return n.faIcon="fa-eye",i(n)},_renderDetails:function(){if(this.model.get("state")===t.NOT_VIEWABLE)return $(this.templates.noAccess(this.model.toJSON(),this));var e=s.prototype._renderDetails.call(this);return e.find(".actions .left").empty().append(this._renderSecondaryActions()),e.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),e.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(e),e},_renderSummary:function(){var e=this.model.toJSON(),t=this.templates.summaries[e.state];return(t=t||this.templates.summaries.unknown)(e,this)},_renderDetailMessages:function(){var e=this,t=$('<div class="detail-messages"></div>'),i=e.model.toJSON();return _.each(e.templates.detailMessages,function(n){t.append($(n(i,e)))}),t},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case t.NOT_VIEWABLE:return[];case t.OK:case t.FAILED_METADATA:case t.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return i({title:r("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle"})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:_.isEmpty(this.model.get("meta_files"))?$(['<a class="download-btn icon-btn" href="',this.model.urls.download,'" title="'+r("Download")+'">','<span class="fa fa-floppy-o"></span>',"</a>"].join("")):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var e=this.model.urls;return $(['<div class="metafile-dropdown dropdown">','<a class="download-btn icon-btn" href="javascript:void(0)" data-toggle="dropdown"',' title="'+r("Download")+'">','<span class="fa fa-floppy-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">','<li><a href="'+e.download+'">',r("Download dataset"),"</a></li>",_.map(this.model.get("meta_files"),function(t){return['<li><a href="',e.meta_download+t.file_type,'">',r("Download")," ",t.file_type,"</a></li>"].join("")}).join("\n"),"</ul>","</div>"].join("\n"))},events:_.extend(_.clone(s.prototype.events),{"click .display-btn":function(e){this.trigger("display",this,e)},"click .params-btn":function(e){this.trigger("params",this,e)},"click .download-btn":function(e){this.trigger("download",this,e)}}),toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetListItemView("+e+")"}});return o.prototype.templates=function(){var e=_.extend({},s.prototype.templates.warnings,{failed_metadata:n.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',r("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:n.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',r("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:n.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',r("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:n.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',r("This dataset has been deleted"),"</div>","<% } %>"])}),i=n.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),o=n.wrapTemplate(['<div class="details">','<div class="summary">',r("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),a={};a[t.OK]=a[t.FAILED_METADATA]=n.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',r("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',r("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),a[t.NEW]=n.wrapTemplate(["<div>",r("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),a[t.NOT_VIEWABLE]=n.wrapTemplate(["<div>",r("You do not have permission to view this dataset"),"</div>"],"dataset"),a[t.DISCARDED]=n.wrapTemplate(["<div>",r("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),a[t.QUEUED]=n.wrapTemplate(["<div>",r("This job is waiting to run"),"</div>"],"dataset"),a[t.RUNNING]=n.wrapTemplate(["<div>",r("This job is currently running"),"</div>"],"dataset"),a[t.UPLOAD]=n.wrapTemplate(["<div>",r("This dataset is currently uploading"),"</div>"],"dataset"),a[t.SETTING_METADATA]=n.wrapTemplate(["<div>",r("Metadata is being auto-detected"),"</div>"],"dataset"),a[t.PAUSED]=n.wrapTemplate(["<div>",r('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>"],"dataset"),a[t.ERROR]=n.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',r("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),a[t.EMPTY]=n.wrapTemplate(["<div>",r("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),a.unknown=n.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var l={resubmitted:n.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',r("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},c=n.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%= link.target %>" href="<%= link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return _.extend({},s.prototype.templates,{warnings:e,details:i,noAccess:o,summaries:a,detailMessages:l,displayApplications:c})}(),{DatasetListItemView:o}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(6),i(11),i(1)],r=function(e,t,i){function n(e){return function(t,i){return this.isNew()&&(i=i||{},i.url=this.urlRoot+this.get("history_id")+"/contents",t=t||{},t.type="dataset_collection"),e.call(this,t,i)}}var r=t.HistoryContentMixin,s=e.ListDatasetCollection,o=e.PairDatasetCollection,a=e.ListPairedDatasetCollection,l=s.extend(r).extend({defaults:_.extend(_.clone(s.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){s.prototype.initialize.call(this,e,t),r.initialize.call(this,e,t)},save:n(s.prototype.save),toString:function(){return["HistoryListDatasetCollection(",this.get("name"),")"].join("")}}),c=o.extend(r).extend({defaults:_.extend(_.clone(o.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"paired",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){o.prototype.initialize.call(this,e,t),r.initialize.call(this,e,t)},save:n(o.prototype.save),toString:function(){return["HistoryPairDatasetCollection(",this.get("name"),")"].join("")}}),d=a.extend(r).extend({defaults:_.extend(_.clone(a.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list:paired",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){a.prototype.initialize.call(this,e,t),r.initialize.call(this,e,t)},save:n(a.prototype.save),toString:function(){return["HistoryListPairedDatasetCollection(",this.get("name"),")"].join("")}});return{HistoryListDatasetCollection:l,HistoryPairDatasetCollection:c,HistoryListPairedDatasetCollection:d}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(3),i(2),i(1)],r=function(e,t,i){var n=function(e,t){return[e,t].join("-")},r={defaults:{history_id:null,history_content_type:null,hid:null,visible:!0},idAttribute:"type_id",constructor:function(e,t){e.type_id=n(e.history_content_type,e.id),this.debug("HistoryContentMixin.constructor:",e.type_id),Backbone.Model.apply(this,arguments)},_typeIdStr:function(){return n(this.get("history_content_type"),this.get("id"))},initialize:function(e,t){this.on("change:id",this._createTypeId)},_createTypeId:function(){this.set("type_id",this._typeIdStr())},isNew:function(){return!this.get("id")},hidden:function(){return!this.get("visible")},isVisible:function(e,t){var i=!0;return e||!this.get("deleted")&&!this.get("purged")||(i=!1),t||this.get("visible")||(i=!1),i},urlRoot:(window.Galaxy?Galaxy.options.root:"/")+"api/histories/",url:function(){var e=this.urlRoot+this.get("history_id")+"/contents/"+this.get("history_content_type")+"s/"+this.get("id");return e},hide:function(e){return this.get("visible")?this.save({visible:!1},e):jQuery.when()},unhide:function(e){return this.get("visible")?jQuery.when():this.save({visible:!0},e)},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e=this.get("hid")+' :"'+this.get("name")+'",'+e),"HistoryContent("+e+")"}},s=Backbone.Model.extend(t.LoggableMixin).extend(r);return{typeIdStr:n,HistoryContentMixin:r,HistoryContent:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(11),i(22),i(10),i(2),i(1)],r=function(e,t,i,n,r){var s=Backbone.Collection.extend(n.LoggableMixin).extend({model:function(e,n){if("dataset"===e.history_content_type)return new t.HistoryDatasetAssociation(e,n);if("dataset_collection"===e.history_content_type){switch(e.collection_type){case"list":return new i.HistoryListDatasetCollection(e,n);case"paired":return new i.HistoryPairDatasetCollection(e,n);case"list:paired":return new i.HistoryListPairedDatasetCollection(e,n)}return{validationError:"Unknown collection_type: "+e.history_content_type}}return{validationError:"Unknown history_content_type: "+e.history_content_type}},initialize:function(e,t){t=t||{},this.historyId=t.historyId,this.model.prototype.idAttribute="type_id",this.on("all",function(){this.debug(this+".event:",arguments)})},urlRoot:galaxy_config.root+"api/histories",url:function(){return this.urlRoot+"/"+this.historyId+"/contents"},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},running:function(){var e=[];return this.each(function(t){var i=!t.inReadyState();i&&e.push(t.get("id"))}),e},getByHid:function(e){return _.first(this.filter(function(t){return t.get("hid")===e}))},getVisible:function(e,t,i){i=i||[],this.debug("checking isVisible");var n=new s(this.filter(function(i){return i.isVisible(e,t)}));return _.each(i,function(e){_.isFunction(e)&&(n=new s(n.filter(e)))}),n},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},fetchAllDetails:function(e){e=e||{};var t={details:"all"};return e.data=e.data?_.extend(e.data,t):t,this.fetch(e)},ajaxQueue:function(e,t){var i=jQuery.Deferred(),n=this.length,r=[];if(!n)return i.resolve([]),i;var s=this.chain().reverse().map(function(o,a){return function(){var l=e.call(o,t);l.done(function(e){i.notify({curr:a,total:n,response:e,model:o})}),l.always(function(e){r.push(e),s.length?s.shift()():i.resolve(r)})}}).value();return s.shift()(),i},isCopyable:function(e){var t=["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"];return _.isObject(e)&&e.id&&_.contains(t,e.model_class)},copy:function(e){var t,i,n;_.isString(e)?(t=e,n="hda",i="dataset"):(t=e.id,n={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[e.model_class]||"hda",i="hdca"===n?"dataset_collection":"dataset");var r=this,s=jQuery.post(this.url(),{content:t,source:n,type:i}).done(function(e){r.add([e])}).fail(function(e,o,a){r.trigger("error",r,s,{},"Error copying contents",{type:i,id:t,source:n})});return s},matches:function(e){return this.filter(function(t){return t.matches(e)})},set:function(t,i){_.each(t,function(t){t.type_id&&t.get&&t.get("type_id")||(t.type_id=e.typeIdStr(t.history_content_type,t.id))}),Backbone.Collection.prototype.set.call(this,t,i)},createHDCA:function(e,t,n,r){var s=this,o={list:i.HistoryListDatasetCollection,paired:i.HistoryPairDatasetCollection},a=new o[t]({history_id:this.historyId,name:n,element_identifiers:e});return a.save().done(function(e){s.add(a)}).fail(function(e,t,i){s.trigger("error",e,t,i)})},clone:function(){var e=Backbone.Collection.prototype.clone.call(this);return e.historyId=this.historyId,e},print:function(){var e=this;e.each(function(t){e.debug(t),t.elements&&e.debug("	 elements:",t.elements)})},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}});return{HistoryContents:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(2),i(1)],r=function(e,t){var i=Backbone.View.extend(e.LoggableMixin).extend({initialize:function(e){this.expanded=e.expanded||!1,this.log("	 expanded:",this.expanded),this.fxSpeed=void 0!==e.fxSpeed?e.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(e){var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){var e=$(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(e).replaceWith(this._renderDetails().show()),e},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;$(i).queue("fx",[function(e){this.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){this.$el.fadeIn(t,e)},function(e){this.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",_.isFunction(this.className)?this.className():this.className).append(e.children())},_setUpBehaviors:function(e){e=e||this.$el,e.find("[title]").tooltip({placement:"bottom"})},$details:function(e){return e=e||this.$el,e.find("> .details")},_renderDetails:function(){var e=$(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(e),e},toggleExpanded:function(e){return e=void 0===e?!this.expanded:e,e?this.expand():this.collapse(),this},expand:function(){var e=this;return e._fetchModelDetails().always(function(){e._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?jQuery.when():this.model.fetch()},_expand:function(){var e=this,t=e._renderDetails();e.$details().replaceWith(t),e.expanded=!0,e.$details().slideDown({duration:e.fxSpeed,step:function(){e.trigger("expanding",e)},complete:function(){e.trigger("expanded",e)}})},collapse:function(){this.debug(this+"(ExpandableView).collapse");var e=this;e.expanded=!1,this.$details().slideUp({duration:e.fxSpeed,step:function(){e.trigger("collapsing",e)},complete:function(){e.trigger("collapsed",e)}})}}),n=i.extend(e.mixin(e.SelectableViewMixin,e.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(t){i.prototype.initialize.call(this,t),e.SelectableViewMixin.initialize.call(this,t),e.DraggableViewMixin.initialize.call(this,t),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(e){e?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var e=i.prototype._buildNewRender.call(this);return e.children(".warnings").replaceWith(this._renderWarnings()),e.children(".title-bar").replaceWith(this._renderTitleBar()),e.children(".primary-actions").append(this._renderPrimaryActions()),e.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),e},_swapNewRender:function(e){return i.prototype._swapNewRender.call(this,e),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var e=this,t=$('<div class="warnings"></div>'),i=e.model.toJSON();return _.each(e.templates.warnings,function(n){t.append($(n(i,e)))}),t},_renderTitleBar:function(){return $(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return $(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation(),e.altKey?(this.toggleSelect(e),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(e){var t=32,i=13;return!e||"keydown"!==e.type||e.keyCode!==t&&e.keyCode!==i?!0:(this.toggleExpanded(),e.stopPropagation(),!1)},toString:function(){var e=this.model?this.model+"":"(no model)";return"ListItemView("+e+")"}}));n.prototype.templates=function(){var t=e.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),i={},n=e.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),r=e.wrapTemplate(['<div class="subtitle"></div>']),s=e.wrapTemplate(['<div class="details"></div>']);return{el:t,warnings:i,titleBar:n,subtitle:r,details:s}}();var r=n.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(e){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=e.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=e.foldoutPanelClass||this.foldoutPanelClass,n.prototype.initialize.call(this,e),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return $();var e=n.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,e)},_createFoldoutPanel:function(){var e=this.model,t=this._getFoldoutPanelClass(e),i=this._getFoldoutPanelOptions(e),n=new t(_.extend(i,{model:e}));return n},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(e,t){return t=t||this.$("> .details"),this.foldout=e.render(0),e.$("> .controls").hide(),t.append(e.$el)},expand:function(){var e=this;return e._fetchModelDetails().always(function(){"foldout"===e.foldoutStyle?e._expand():"drilldown"===e.foldoutStyle&&e._expandByDrilldown()})},_expandByDrilldown:function(){var e=this;e.foldout.on("close",function(){e.trigger("collapsed:drilldown",e,e.foldout)}),e.trigger("expanded:drilldown",e,e.foldout)}});return r.prototype.templates=function(){var t=e.wrapTemplate(['<div class="details">',"</div>"],"collection");return _.extend({},n.prototype.templates,{details:t})}(),{ExpandableView:i,ListItemView:n,FoldoutListItemView:r}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){var e=Backbone.View.extend({el_masthead:"#everything",options:null,$background:null,list:[],initialize:function(e){this.options=e,$("body").off(),this.setElement($(this._template(e))),$(this.el_masthead).append($(this.el)),this.$background=$(this.el).find("#masthead-background");var t=this;$(window).on("beforeunload",function(){var e="";for(key in t.list)if(t.list[key].options.onunload){var i=t.list[key].options.onunload();i&&(e+=i+" ")}return""!=e?e:void 0})},events:{click:"_click",mousedown:function(e){e.preventDefault()}},append:function(e){return this._add(e,!0)},prepend:function(e){return this._add(e,!1)},highlight:function(e){var t=$(this.el).find("#"+e+"> li");t&&t.addClass("active")},_add:function(e,t){var i=$(this.el).find("#"+e.location);if(i){var n=$(e.el);n.addClass("masthead-item"),t?i.append(n):i.prepend(n),this.list.push(e)}return null},_click:function(e){var t=$(this.el).find(".popup");t&&t.hide();var i=$(e.target).closest(".masthead-item").find(".popup");$(e.target).hasClass("head")?(i.show(),this.$background.show()):this.$background.hide()},_template:function(e){var t=e.brand?"/ "+e.brand:"";return'<div><div id="masthead" class="navbar navbar-fixed-top navbar-inverse"><div style="position: relative; right: -50%; float: left;"><div id="navbar" style="display: block; position: relative; right: 50%;"></div></div><div class="navbar-brand"><a href="'+e.logo_url+'"><img style="margin-left: 0.35em;" border="0" src="'+galaxy_config.root+'static/images/galaxyIcon_noText.png"><span id="brand"> Galaxy '+t+'</span></a></div><div class="quota-meter-container"></div><div id="iconbar" class="iconbar"></div></div><div id="masthead-background" style="display: none; position: absolute; top: 33px; width: 100%; height: 100%; z-index: 1010"></div></div>'}}),t=Backbone.View.extend({options:{id:"",icon:"fa-cog",tooltip:"",with_number:!1,onclick:function(){alert("clicked")},onunload:null,visible:!0},location:"iconbar",initialize:function(e){e&&(this.options=_.defaults(e,this.options)),this.setElement($(this._template(this.options)));var t=this;$(this.el).find(".icon").tooltip({title:this.options.tooltip,placement:"bottom"}).on("mouseup",t.options.onclick),this.options.visible||this.hide()},show:function(){$(this.el).css({visibility:"visible"})},hide:function(){$(this.el).css({visibility:"hidden"})},icon:function(e){$(this.el).find(".icon").removeClass(this.options.icon).addClass(e),this.options.icon=e},toggle:function(){$(this.el).addClass("toggle")},untoggle:function(){$(this.el).removeClass("toggle")},number:function(e){$(this.el).find(".number").text(e)},_template:function(e){var t='<div id="'+e.id+'" class="symbol"><div class="icon fa fa-2x '+e.icon+'"></div>';return e.with_number&&(t+='<div class="number"></div>'),t+="</div>"}}),i=Backbone.View.extend({options:{id:"",title:"",target:"_parent",content:"",type:"url",scratchbook:!1,onunload:null,visible:!0,disabled:!1,title_attribute:""},location:"navbar",$menu:null,events:{"click .head":"_head"},initialize:function(e){e&&(this.options=_.defaults(e,this.options)),void 0!==this.options.content&&-1===this.options.content.indexOf("//")&&(this.options.content=galaxy_config.root+this.options.content),this.setElement($(this._template(this.options))),this.options.disabled&&($(this.el).find(".root").addClass("disabled"),this._attachPopover()),this.options.visible||this.hide()},show:function(){$(this.el).css({visibility:"visible"})},hide:function(){$(this.el).css({visibility:"hidden"})},add:function(e){var t={title:"Title",content:"",type:"url",target:"_parent",scratchbook:!1,divider:!1};e&&(t=_.defaults(e,t)),t.content&&-1===t.content.indexOf("//")&&(t.content=galaxy_config.root+t.content),this.$menu||($(this.el).find(".root").append(this._templateMenu()),$(this.el).find(".symbol").addClass("caret"),this.$menu=$(this.el).find(".popup"));var i=$(this._templateMenuItem(t));this.$menu.append(i);var n=this;i.on("click",function(t){return t.preventDefault(),"_blank"===n.options.target?!0:void Galaxy.frame.add(e)}),t.divider&&this.$menu.append($(this._templateDivider()))},_head:function(e){e.preventDefault(),this.options.disabled||this.$menu||Galaxy.frame.add(this.options)},_attachPopover:function(){var e=$(this.el).find(".head");e.popover({html:!0,content:'Please <a href="'+galaxy_config.root+'user/login?use_panels=True">log in</a> or <a href="'+galaxy_config.root+'user/create?use_panels=True">register</a> to use this feature.',
placement:"bottom"}).on("shown.bs.popover",function(){setTimeout(function(){e.popover("hide")},5e3)})},_templateMenuItem:function(e){return'<li><a href="'+e.content+'" target="'+e.target+'">'+e.title+"</a></li>"},_templateMenu:function(){return'<ul class="popup dropdown-menu"></ul>'},_templateDivider:function(){return'<li class="divider"></li>'},_template:function(e){var t='<ul id="'+e.id+'" class="nav navbar-nav" border="0" cellspacing="0"><li class="root dropdown" style=""><a class="head dropdown-toggle" data-toggle="dropdown" target="'+e.target+'" href="'+e.content+'" title="'+e.title_attribute+'">'+e.title+'<b class="symbol"></b></a></li></ul>';return t}});return{GalaxyMasthead:e,GalaxyMastheadTab:i,GalaxyMastheadIcon:t}}.apply(t,n),!(void 0!==r&&(e.exports=r))},,,,function(e,t,i){var n,r;n=[i(2),i(1)],r=function(e,t){var i=Backbone.View.extend(e.LoggableMixin).extend(e.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(e){e=e||{},this.tooltipConfig=e.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$el.find("[title]").tooltip(this.tooltipConfig),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(t){e.$annotation().text(t),e.model.save({annotation:t},{silent:!0}).fail(function(){e.$annotation().text(e.model.previous("annotation"))})}}),this},_template:function(){var e=this.model.get("annotation");return['<label class="prompt">',t("Annotation"),"</label>",'<div class="annotation" title="',t("Edit annotation"),'">',_.escape(e),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),Backbone.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(",this.model+"",")"].join("")}});return{AnnotationEditor:i}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(3),i(9),i(26),i(18),i(4),i(2),i(1)],r=function(e,t,i,n,r,s,o){var a=t.DatasetListItemView,l=a.extend({initialize:function(e){a.prototype.initialize.call(this,e),this.hasUser=e.hasUser,this.purgeAllowed=e.purgeAllowed||!1,this.tagsEditorShown=e.tagsEditorShown||!1,this.annotationEditorShown=e.annotationEditorShown||!1},_renderPrimaryActions:function(){var t=a.prototype._renderPrimaryActions.call(this);return this.model.get("state")===e.NOT_VIEWABLE?t:a.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){if(this.model.get("state")===e.DISCARDED||!this.model.get("accessible"))return null;var t=this.model.get("purged"),i=this.model.get("deleted"),n={title:o("Edit attributes"),href:this.model.urls.edit,target:this.linkTarget,faIcon:"fa-pencil",classes:"edit-btn"};return i||t?(n.disabled=!0,t?n.title=o("Cannot edit attributes of datasets removed from disk"):i&&(n.title=o("Undelete dataset to edit attributes"))):_.contains([e.UPLOAD,e.NEW],this.model.get("state"))&&(n.disabled=!0,n.title=o("This dataset is not yet editable")),r(n)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var e=this,t=this.model.isDeletedOrPurged();return r({title:o(t?"Dataset is already deleted":"Delete"),disabled:t,faIcon:"fa-times",classes:"delete-btn",onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model["delete"]()}})},_renderDetails:function(){var t=a.prototype._renderDetails.call(this),i=this.model.get("state");return!this.model.isDeletedOrPurged()&&_.contains([e.OK,e.FAILED_METADATA],i)&&(this._renderTags(t),this._renderAnnotation(t),this._makeDbkeyEditLink(t)),this._setUpBehaviors(t),t},_renderSecondaryActions:function(){var t=a.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case e.UPLOAD:case e.NEW:case e.NOT_VIEWABLE:return t;case e.ERROR:return t.unshift(this._renderErrButton()),t.concat([this._renderRerunButton()]);case e.OK:case e.FAILED_METADATA:return t.concat([this._renderRerunButton(),this._renderVisualizationsButton()])}return t.concat([this._renderRerunButton()])},_renderErrButton:function(){return r({title:o("View or report this error"),href:this.model.urls.report_error,classes:"report-error-btn",target:this.linkTarget,faIcon:"fa-bug"})},_renderRerunButton:function(){return r({title:o("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh"})},_renderVisualizationsButton:function(){var e=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||_.isEmpty(e))return null;if(!_.isObject(e[0]))return this.warn("Visualizations have been switched off"),null;var t=$(this.templates.visualizations(e,this));return t.find('[target="galaxy_main"]').attr("target",this.linkTarget),this._addScratchBookFn(t.find(".visualization-link").addBack(".visualization-link")),t},_addScratchBookFn:function(e){e.click(function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:"Visualization",type:"url",content:$(this).attr("href")}),e.preventDefault(),e.stopPropagation())})},_renderTags:function(e){if(this.hasUser){var t=this;this.tagsEditor=new i.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.tagsEditorShown=!0},onhide:function(){t.tagsEditorShown=!1},$activator:r({title:o("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".actions .right"))}),this.tagsEditorShown&&this.tagsEditor.toggle(!0)}},_renderAnnotation:function(e){if(this.hasUser){var t=this;this.annotationEditor=new n.AnnotationEditor({model:this.model,el:e.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.annotationEditorShown=!0},onhide:function(){t.annotationEditorShown=!1},$activator:r({title:o("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(e){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var t=$('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target",this.linkTarget);e.find(".dbkey .value").replaceWith(t)}},events:_.extend(_.clone(a.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(e){this.trigger("edit",this,e)},"click .delete-btn":function(e){this.trigger("delete",this,e)},"click .rerun-btn":function(e){this.trigger("rerun",this,e)},"click .report-err-btn":function(e){this.trigger("report-err",this,e)},"click .visualization-btn":function(e){this.trigger("visualize",this,e)},"click .dbkey a":function(e){this.trigger("edit",this,e)}}),_clickUndeleteLink:function(e){return this.model.undelete(),!1},_clickPurgeLink:function(e){return this.model.purge(),!1},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAEditView("+e+")"}});return l.prototype.templates=function(){var e=_.extend({},a.prototype.templates.warnings,{failed_metadata:s.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',o("An error occurred setting the metadata for this dataset"),'<br /><a href="<%= dataset.urls.edit %>" target="<%= view.linkTarget %>">',o("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:s.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',o("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',o("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',o("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")}),t=s.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-btn visualization-link icon-btn" href="<%= visualizations[0].href %>"',' target="<%= visualizations[0].target %>" title="',o("Visualize in"),' <%= visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown">','<a class="visualization-btn icon-btn" data-toggle="dropdown" title="',o("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%= visualization.href %>"',' target="<%= visualization.target %>">',"<%= visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations");return _.extend({},a.prototype.templates,{warnings:e,visualizations:t})}(),{DatasetListItemEdit:l}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(3),i(2),i(1)],r=function(e,t,i){var n=t.SearchableModelMixin,r=Backbone.Model.extend(t.LoggableMixin).extend(t.mixin(n,{defaults:{state:e.NEW,deleted:!1,purged:!1,name:"(unnamed dataset)",accessible:!0,data_type:"",file_ext:"",file_size:0,meta_files:[],misc_blurb:"",misc_info:"",tags:[]},initialize:function(t,i){this.debug(this+"(Dataset).initialize",t,i),
//!! this state is not in trans.app.model.Dataset.states - set it here -
this.get("accessible")||this.set("state",e.NOT_VIEWABLE),this.urls=this._generateUrls(),this._setUpListeners()},_generateUrls:function(){var e=this.get("id");if(!e)return{};var t={purge:"datasets/"+e+"/purge_async",display:"datasets/"+e+"/display/?preview=True",edit:"datasets/"+e+"/edit",download:"datasets/"+e+"/display?to_ext="+this.get("file_ext"),report_error:"dataset/errors?id="+e,rerun:"tool_runner/rerun?id="+e,show_params:"datasets/"+e+"/show_params",visualization:"visualization",meta_download:"dataset/get_metadata_file?hda_id="+e+"&metadata_name="},i=window.galaxy_config&&galaxy_config.root?galaxy_config.root:"/";return _.each(t,function(e,n){t[n]=i+e}),this.urls=t,t},_setUpListeners:function(){this.on("change:state",function(e,t){this.log(this+" has changed state:",e,t),this.inReadyState()&&this.trigger("state:ready",e,t,this.previous("state"))}),this.on("change:id change:file_ext",function(e){this._generateUrls()})},toJSON:function(){var e=Backbone.Model.prototype.toJSON.call(this);return _.extend(e,{urls:this.urls})},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},inReadyState:function(){var t=_.contains(e.READY_STATES,this.get("state"));return this.isDeletedOrPurged()||t},hasDetails:function(){return _.has(this.attributes,"genome_build")},hasData:function(){return this.get("file_size")>0},fetch:function(e){var t=this;return Backbone.Model.prototype.fetch.call(this,e).always(function(){t._generateUrls()})},"delete":function(e){return this.get("deleted")?jQuery.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?jQuery.when():this.save({deleted:!1},e)},purge:function(e){if(this.get("purged"))return jQuery.when();e=e||{},e.url=this.urls.purge;var t=this,n=jQuery.ajax(e);return n.done(function(e,i,n){t.set({deleted:!0,purged:!0})}),n.fail(function(n,r,s){var o=i("Unable to purge dataset"),a="Removal of datasets by users is not allowed in this Galaxy instance";n.responseJSON&&n.responseJSON.error?o=n.responseJSON.error:-1!==n.responseText.indexOf(a)&&(o=a),n.responseText=o,t.trigger("error",t,n,e,i(o),{error:o})}),n},searchAttributes:["name","file_ext","genome_build","misc_blurb","misc_info","annotation","tags"],searchAliases:{title:"name",format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e='"'+this.get("name")+'",'+e),"Dataset("+e+")"}})),s=Backbone.Collection.extend(t.LoggableMixin).extend({model:r,urlRoot:(window.galaxy_config&&galaxy_config.root?galaxy_config.root:"/")+"api/datasets",url:function(){return this.urlRoot},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},ajaxQueue:function(e,t){var i=jQuery.Deferred(),n=this.length,r=[];if(!n)return i.resolve([]),i;var s=this.chain().reverse().map(function(o,a){return function(){var l=e.call(o,t);l.done(function(e){i.notify({curr:a,total:n,response:e,model:o})}),l.always(function(e){r.push(e),s.length?s.shift()():i.resolve(r)})}}).value();return s.shift()(),i},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["DatasetAssociationCollection(",this.length,")"].join("")}});return{DatasetAssociation:r,DatasetAssociationCollection:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(9),i(2),i(1)],r=function(e,t,i){var n=e.DatasetListItemView,r=n.extend({className:n.prototype.className+" history-content",initialize:function(e,t){n.prototype.initialize.call(this,e,t)},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAListItemView("+e+")"}});return r.prototype.templates=function(){var e=t.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="hid"><%- dataset.hid %></span> ','<span class="name"><%- dataset.name %></span>',"</div>","</div>"],"dataset"),r=_.extend({},n.prototype.templates.warnings,{hidden:t.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',i("This dataset has been hidden"),"</div>","<% } %>"],"dataset")});return _.extend({},n.prototype.templates,{titleBar:e,warnings:r})}(),{HDAListItemView:r}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(20),i(11),i(2),i(1)],r=function(e,t,i,n){var r=e.DatasetAssociation,s=t.HistoryContentMixin,o=r.extend(i.mixin(s,{constructor:function(e,t){s.constructor.call(this,e,t)},defaults:_.extend({},r.prototype.defaults,s.defaults,{model_class:"HistoryDatasetAssociation"}),initialize:function(e,t){r.prototype.initialize.call(this,e,t),s.initialize.call(this,e,t)},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e=this.get("hid")+' :"'+this.get("name")+'",'+e),"HDA("+e+")"}}));return{HistoryDatasetAssociation:o}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(3),i(5),i(7),i(2),i(1)],r=function(e,t,i,n,r){var s=t.DCListItemView,o=s.extend({className:s.prototype.className+" history-content",_setUpListeners:function(){s.prototype._setUpListeners.call(this),this.model.on("change",function(e,t){_.isEqual(_.keys(e.changed),["visible"])&&this.render()},this)},_getFoldoutPanelClass:function(){switch(this.model.get("collection_type")){case"list":return i.ListCollectionPanel;case"paired":return i.PairCollectionPanel;case"list:paired":return i.ListOfPairsCollectionPanel}throw new TypeError("Uknown collection_type: "+this.model.get("collection_type"))},_swapNewRender:function(t){s.prototype._swapNewRender.call(this,t);var i=this.model.get("state")||e.OK;return this.$el.addClass("state-"+i),this.$el},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDCAListItemView("+e+")"}});return o.prototype.templates=function(){var e=_.extend({},s.prototype.templates.warnings,{hidden:n.wrapTemplate(["<% if( !collection.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',r("This collection has been hidden"),"</div>","<% } %>"],"collection")}),t=n.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="hid"><%- collection.hid %></span> ','<span class="name"><%- collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection");return _.extend({},s.prototype.templates,{warnings:e,titleBar:t})}(),{HDCAListItemView:o}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(12),i(2),i(1)],r=function(e,t,i){var n=Backbone.Model.extend(t.LoggableMixin).extend(t.mixin(t.SearchableModelMixin,{defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",diskSize:0,deleted:!1},urlRoot:galaxy_config.root+"api/histories",initialize:function(t,i,n){n=n||{},this.logger=n.logger||null,this.log(this+".initialize:",t,i,n),this.log("creating history contents:",i),this.contents=new e.HistoryContents(i||[],{historyId:this.get("id")}),this._setUpListeners(),this.updateTimeoutId=null},_setUpListeners:function(){this.on("error",function(e,t,i,n,r){this.errorHandler(e,t,i,n,r)}),this.contents&&this.listenTo(this.contents,"error",function(){this.trigger.apply(this,["error:contents"].concat(jQuery.makeArray(arguments)))}),this.on("change:id",function(e,t){this.contents&&(this.contents.historyId=t)},this)},errorHandler:function(e,t,i,n,r){this.clearUpdateTimeout()},ownedByCurrUser:function(){return Galaxy&&Galaxy.currUser?Galaxy.currUser.isAnonymous()||Galaxy.currUser.id!==this.get("user_id")?!1:!0:!1},contentsCount:function(){return _.reduce(_.values(this.get("state_details")),function(e,t){return e+t},0)},searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},checkForUpdates:function(e){return this.contents.running().length?this.setUpdateTimeout():(this.trigger("ready"),_.isFunction(e)&&e.call(this)),this},setUpdateTimeout:function(e){e=e||n.UPDATE_DELAY;var t=this;return this.clearUpdateTimeout(),this.updateTimeoutId=setTimeout(function(){t.refresh()},e),this.updateTimeoutId},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},refresh:function(e,t){e=e||[],t=t||{};var i=this;t.data=t.data||{},e.length&&(t.data.details=e.join(","));var n=this.contents.fetch(t);return n.done(function(e){i.checkForUpdates(function(){this.fetch()})}),n},_delete:function(e){return this.get("deleted")?jQuery.when():this.save({deleted:!0},e)},purge:function(e){return this.get("purged")?jQuery.when():this.save({deleted:!0,purged:!0},e)},undelete:function(e){return this.get("deleted")?this.save({deleted:!1},e):jQuery.when()},copy:function(e,t){if(e=void 0!==e?e:!0,!this.id)throw new Error("You must set the history ID before copying it.");var i={history_id:this.id};e&&(i.current=!0),t&&(i.name=t);var r=this,s=jQuery.post(this.urlRoot,i);return e?s.then(function(e){var t=new n(e);return t.setAsCurrent().done(function(){r.trigger("copied",r,e)})}):s.done(function(e){r.trigger("copied",r,e)})},setAsCurrent:function(){var e=this,t=jQuery.getJSON(galaxy_config.root+"history/set_as_current?id="+this.id);return t.done(function(){e.trigger("set-as-current",e)}),t},toString:function(){return"History("+this.get("id")+","+this.get("name")+")"}}));n.UPDATE_DELAY=4e3,n.getHistoryData=function(e,t){function i(t){return"current"===e?jQuery.getJSON(galaxy_config.root+"history/current_history_json"):jQuery.ajax(galaxy_config.root+"api/histories/"+e)}function n(e){return e&&e.empty}function r(e){if(n(e))return[];_.isFunction(s)&&(s=s(e)),_.isFunction(o)&&(o=o(e));var t={};return s.length&&(t.dataset_details=s.join(",")),o.length&&(t.dataset_collection_details=o.join(",")),jQuery.ajax(galaxy_config.root+"api/histories/"+e.id+"/contents",{data:t})}t=t||{};var s=t.detailIdsFn||[],o=t.hdcaDetailIds||[],a=jQuery.Deferred(),l=null,c=t.historyFn||i,d=t.contentsFn||r,u=c(e);u.done(function(e){l=e,a.notify({status:"history data retrieved",historyJSON:l})}),u.fail(function(e,t,i){a.reject(e,"loading the history")});var h=u.then(d);return h.then(function(e){a.notify({status:"contents data retrieved",historyJSON:l,contentsJSON:e}),a.resolve(l,e)}),h.fail(function(e,t,i){a.reject(e,"loading the contents",{history:l})}),a};var r=Backbone.Collection.extend(t.LoggableMixin).extend({model:n,urlRoot:(window.galaxy_config?galaxy_config.root:"/")+"api/histories",initialize:function(e,t){t=t||{},this.log("HistoryCollection.initialize",arguments),this.includeDeleted=t.includeDeleted||!1,this.setUpListeners()},setUpListeners:function(){var e=this;this.on("change:deleted",function(t){this.debug("change:deleted",e.includeDeleted,t.get("deleted")),!e.includeDeleted&&t.get("deleted")&&e.remove(t)}),this.on("copied",function(e,t){this.unshift(new n(t,[]))})},create:function(e,t,i,r){var s=this,o=jQuery.getJSON(galaxy_config.root+"history/create_new_current");return o.done(function(e){var t=new n(e,[],i||{});s.unshift(t),s.trigger("new-current")})},toString:function(){return"HistoryCollection("+this.length+")"}});return{History:n,HistoryCollection:r}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(13),i(50),i(2),i(1),i(30)],r=function(e,t,i,n){var r=Backbone.View.extend(i.LoggableMixin).extend({viewClass:e.ListItemView,collectionClass:Backbone.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:n("This list is empty"),noneFoundMsg:n("No matching items found"),searchPlaceholder:n("search"),initialize:function(e,i){e=e||{},e.logger&&(this.logger=e.logger),this.log(this+".initialize:",e),this.fxSpeed=_.has(e,"fxSpeed")?e.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=e.searchFor||"",this.indicator=new t(this.$el),this.selecting=void 0!==e.selecting?e.selecting:!0,this.selected=e.selected||[],this.lastSelected=null,this.dragItems=e.dragItems||!1,this.viewClass=e.viewClass||this.viewClass,this.views=[],this.collection=e.collection||new this.collectionClass([]),this.filters=e.filters||[],this.$scrollContainer=e.$scrollContainer||this.$scrollContainer,this.title=e.title||"",this.subtitle=e.subtitle||"",this._setUpListeners()},freeViews:function(){return _.each(this.views,function(e){e.off()}),this.views=[],this},_setUpListeners:function(){return this.off(),this.on("error",function(e,t,i,n,r){console.error(e,t,i,n,r)},this),this.on("loading",function(){this._showLoadingIndicator("loading...",40)},this),this.on("loading-done",function(){this._hideLoadingIndicator(40)},this),this.once("rendered",function(){this.trigger("rendered:initial",this)},this),this.logger&&this.on("all",function(e){this.log(this+"",arguments)},this),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_setUpCollectionListeners:function(){return this.log(this+"._setUpCollectionListeners",this.collection),this.collection.off(),this.collection.on("error",function(e,t,i,n,r){this.trigger("error",e,t,i,n,r)},this),this.collection.on("reset",function(){this.renderItems()},this),this.collection.on("add",this.addItemView,this),this.collection.on("remove",this.removeItemView,this),this.logger&&this.collection.on("all",function(e){this.info(this+"(collection)",arguments)},this),this},_setUpViewListeners:function(){this.log(this+"._setUpViewListeners"),this.on("view:selected",function(e,t){if(t&&t.shiftKey&&this.lastSelected){var i=this.viewFromModelId(this.lastSelected);i&&this.selectRange(e,i)}else t&&t.altKey&&!this.selecting&&this.showSelectors();this.selected.push(e.model.id),this.lastSelected=e.model.id},this),this.on("view:de-selected",function(e,t){this.selected=_.without(this.selected,e.model.id)},this)},render:function(e){this.log(this+".render",e);var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){this.debug(this+"(ListPanel)._buildNewRender");var e=$(this.templates.el({},this));return this._renderControls(e),this._renderTitle(e),this._renderSubtitle(e),this._renderSearch(e),this.renderItems(e),e},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=$(this.templates.controls({},this));return e.find(".controls").replaceWith(t),t},_renderTitle:function(e){},_renderSubtitle:function(e){},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;i.log("_queueNewRender:",e,t),$(i).queue("fx",[function(e){this.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){this.$el.fadeIn(t,e)},function(e){i.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",this.className).append(e.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(e){return e=e||this.$el,e.find(".controls [title]").tooltip({placement:"bottom"}),this._renderMultiselectActionMenu(e),this},_renderMultiselectActionMenu:function(e){e=e||this.$el;var t=e.find(".list-action-menu"),i=this.multiselectActions();if(!i.length)return t.empty();var r=$(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-default dropdown-toggle" data-toggle="dropdown">',n("For all selected"),"...","</button>",'<ul class="dropdown-menu pull-right" role="menu">',"</ul>","</div>"].join("")),s=i.map(function(e){var t=['<li><a href="javascript:void(0);">',e.html,"</a></li>"].join("");return $(t).click(function(t){return t.preventDefault(),e.func(t)})});return r.find("ul").append(s),t.replaceWith(r),r},multiselectActions:function(){return[]},$scrollContainer:function(){return this.$el.parent().parent()},$list:function(e){return(e||this.$el).find("> .list-items")},$messages:function(e){return(e||this.$el).find("> .controls .messages")},$emptyMessage:function(e){return(e||this.$el).find("> .empty-message")},renderItems:function(e){e=e||this.$el;var t=this;t.log(this+".renderItems",e);var i=t.$list(e);return t.views=t._filterCollection().map(function(e){return t._createItemView(e).render(0)}),i.empty(),t.views.length?(t._attachItems(e),t.$emptyMessage(e).hide()):t._renderEmptyMessage(e).show(),t.views},_filterCollection:function(){var e=this;return e.collection.filter(_.bind(e._filterItem,e))},_filterItem:function(e){var t=this;return _.every(t.filters.map(function(t){return t.call(e)}))&&(!t.searchFor||e.matchesAll(t.searchFor))},_createItemView:function(e){var t=this._getItemViewClass(e),i=_.extend(this._getItemViewOptions(e),{model:e}),n=new t(i);return this._setUpItemViewListeners(n),n},_getItemViewClass:function(e){return this.viewClass},_getItemViewOptions:function(e){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:_.contains(this.selected,e.id),draggable:this.dragItems}},_setUpItemViewListeners:function(e){var t=this;return e.on("all",function(){var e=Array.prototype.slice.call(arguments,0);e[0]="view:"+e[0],t.trigger.apply(t,e)}),e.on("draggable:dragstart",function(e,t){var i={},n=this.getSelectedModels();i=n.length?n.toJSON():[t.model.toJSON()],e.dataTransfer.setData("text",JSON.stringify(i))},this),t},_attachItems:function(e){return this.$list(e).append(this.views.map(function(e){return e.$el})),this},_renderEmptyMessage:function(e){this.debug("_renderEmptyMessage",e,this.searchFor);var t=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(e).text(t)},expandAll:function(){_.each(this.views,function(e){e.expand()})},collapseAll:function(){_.each(this.views,function(e){e.collapse()})},addItemView:function(e,t,i){this.log(this+".addItemView:",e);var n=this;if(!n._filterItem(e))return void 0;var r=n._createItemView(e);return $(r).queue("fx",[function(e){n.$emptyMessage().fadeOut(n.fxSpeed,e)},function(e){n._attachView(r),e()}]),r},_attachView:function(e){var t=this;t.views.push(e),t.$list().append(e.render(0).$el.hide()),t.trigger("view:attached",e),e.$el.slideDown(t.fxSpeed,function(){t.trigger("view:attached:rendered")})},removeItemView:function(e,t,i){this.log(this+".removeItemView:",e);var n=this,r=n.viewFromModel(e);return r?(n.views=_.without(n.views,r),n.trigger("view:removed",r),$({}).queue("fx",[function(e){r.$el.fadeOut(n.fxSpeed,e)},function(e){r.remove(),n.trigger("view:removed:rendered"),n.views.length?e():n._renderEmptyMessage().fadeIn(n.fxSpeed,e)}]),r):void 0},viewFromModelId:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].model.id===e)return this.views[t];return void 0},viewFromModel:function(e){return e?this.viewFromModelId(e.id):void 0},viewsWhereModel:function(e){return this.views.filter(function(t){var i=t.model.toJSON();for(var n in e)if(e.hasOwnProperty(n)&&i[n]!==t.model.get(n))return!1;return!0})},viewRange:function(e,t){if(e===t)return e?[e]:[];var i=this.views.indexOf(e),n=this.views.indexOf(t);return-1===i||-1===n?i===n?[]:-1===i?[t]:[e]:n>i?this.views.slice(i,n+1):this.views.slice(n,i+1)},_renderSearch:function(e){return e.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:_.bind(this._firstSearch,this),onsearch:_.bind(this.searchItems,this),onclear:_.bind(this.clearSearch,this)}),e},_firstSearch:function(e){return this.log("onFirstSearch",e),this.searchItems(e)},searchItems:function(e){return this.searchFor=e,this.trigger("search:searching",e,this),this.renderItems(),this.$("> .controls .search-query").val(e),this},clearSearch:function(e){return this.searchFor="",this.trigger("search:clear",this),this.renderItems(),this.$("> .controls .search-query").val(""),this},showSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(e),_.each(this.views,function(t){t.showSelector(e)})},hideSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(e),_.each(this.views,function(t){t.hideSelector(e)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(e){_.each(this.views,function(t){t.select(e)})},deselectAll:function(e){this.lastSelected=null,_.each(this.views,function(t){t.deselect(e)})},selectRange:function(e,t){var i=this.viewRange(e,t);return _.each(i,function(e){e.select()}),i},getSelectedViews:function(){return _.filter(this.views,function(e){return e.selected})},getSelectedModels:function(){return new this.collection.constructor(_.map(this.getSelectedViews(),function(e){return e.model}))},_showLoadingIndicator:function(e,i,n){this.debug("_showLoadingIndicator",this.indicator,e,i,n),i=void 0!==i?i:this.fxSpeed,this.indicator||(this.indicator=new t(this.$el,this.$el.parent()),this.debug("	 created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(i),this.indicator.show(e,i,n)):this.indicator.show(0,n)},_hideLoadingIndicator:function(e,t){this.debug("_hideLoadingIndicator",this.indicator,e,t),e=void 0!==e?e:this.fxSpeed,this.indicator&&this.indicator.hide(e,t)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(e,t){return t=t||0,this.$scrollContainer().animate({scrollTop:e},t),this},scrollToTop:function(e){return this.scrollTo(0,e)},scrollToItem:function(e,t){if(!e)return this;var i=e.$el.position().top;return this.scrollTo(i,t)},scrollToId:function(e,t){return this.scrollToItem(this.viewFromModelId(e),t)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel("+this.collection+")"}});r.prototype.templates=function(){var e=i.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),t=i.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%= view.title %></div>',"</div>",'<div class="subtitle"><%= view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',n("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',n("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return{el:e,controls:t}}();var s=r.extend({modelCollectionKey:"contents",initialize:function(e){r.prototype.initialize.call(this,e),this.selecting=void 0!==e.selecting?e.selecting:!1,this.setModel(this.model,e)},setModel:function(e,t){if(t=t||{},this.debug(this+".setModel:",e,t),this.freeModel(),this.freeViews(),e){var i=this.model?this.model.get("id"):null;this.model=e,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.collection.off(),this.collection=this.model[this.modelCollectionKey]?this.model[this.modelCollectionKey]:t.collection||new this.collectionClass([]),this._setUpCollectionListeners(),i&&e.get("id")!==i&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log(this+"._setUpModelListeners",this.model),this.model.on("error",function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("error"),this.trigger.apply(this,e)},this),this},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=this.model?this.model.toJSON():{},i=$(this.templates.controls(t,this));return e.find(".controls").replaceWith(i),i},toString:function(){return"ModelListPanel("+this.model+")"}});return s.prototype.templates=function(){var e=i.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%= model.name %></div>',"</div>",'<div class="subtitle"><%= view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',n("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',n("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return _.extend(_.clone(r.prototype.templates),{controls:e})}(),{ListPanel:r,ModelListPanel:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(2),i(1)],r=function(e,t){var i=Backbone.View.extend(e.LoggableMixin).extend(e.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",initialize:function(e){this.listenTo(this.model,"change:tags",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$input().select2({placeholder:"Add tags",width:"100%",tags:function(){return e._getTagsUsed()}}),this._setUpBehaviors(),this},_template:function(){return['<label class="prompt">',t("Tags"),"</label>",'<input class="tags-input" value="',this.tagsToCSV(),'" />'].join("")},tagsToCSV:function(){var e=this.model.get("tags");return!_.isArray(e)||_.isEmpty(e)?"":e.map(function(e){return _.escape(e)}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){return Galaxy.currUser.get("tags_used")},_setUpBehaviors:function(){var e=this;this.$input().on("change",function(t){e.model.save({tags:t.val},{silent:!0}),t.added&&e._addNewTagToTagsUsed(t.added.text+"")})},_addNewTagToTagsUsed:function(e){var t=Galaxy.currUser.get("tags_used");_.contains(t,e)||(t.push(e),t.sort(),Galaxy.currUser.set("tags_used",t))},remove:function(){this.$input.off(),this.stopListening(this.model),Backbone.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",this.model+"",")"].join("")}});return{TagsEditor:i}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){var e=Backbone.View.extend({initialize:function(e,t){this.$button=e,this.$button.size()||(this.$button=$("<div/>")),this.options=t||[];var i=this;this.$button.click(function(e){return $(".popmenu-wrapper").remove(),i._renderAndShow(e),!1})},_renderAndShow:function(e){this.render(),this.$el.appendTo("body").css(this._getShownPosition(e)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var e=this;this.$el.find("li").each(function(t,i){var n=e.options[t];n.func&&$(this).children("a.popupmenu-option").click(function(t){n.func.call(e,t,n),t.preventDefault()})})}return this},template:function(e,t){return['<ul id="',e,'-menu" class="dropdown-menu">',this._templateOptions(t),"</ul>"].join("")},_templateOptions:function(e){return e.length?_.map(e,function(e){if(e.divider)return'<li class="divider"></li>';if(e.header)return['<li class="head"><a href="javascript:void(0);">',e.html,"</a></li>"].join("");var t=e.href||"javascript:void(0);",i=e.target?' target="'+e.target+'"':"",n=e.checked?'<span class="fa fa-check"></span>':"";return['<li><a class="popupmenu-option" href="',t,'"',i,">",n,e.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(e){var t=this.$el.width(),i=e.pageX-t/2;return i=Math.min(i,$(document).scrollLeft()+$(window).width()-t-5),i=Math.max(i,$(document).scrollLeft()+5),{top:e.pageY,left:i}},_setUpCloseBehavior:function(){function e(e){if($(document).off("click.close_popup"),window.parent!==window)try{$(window.parent.document).off("click.close_popup")}catch(i){}else try{$("iframe#galaxy_main").contents().off("click.close_popup")}catch(i){}t.remove()}var t=this;if($("html").one("click.close_popup",e),window.parent!==window)try{$(window.parent.document).find("html").one("click.close_popup",e)}catch(i){}else try{$("iframe#galaxy_main").contents().one("click.close_popup",e)}catch(i){}},addItem:function(e,t){return t=t>=0?t:this.options.length,this.options.splice(t,0,e),this},removeItem:function(e){return e>=0&&this.options.splice(e,1),this},findIndexByHtml:function(e){for(var t=0;t<this.options.length;t++)if(_.has(this.options[t],"html")&&this.options[t].html===e)return t;return null},findItemByHtml:function(e){return this.options[this.findIndexByHtml(e)]},toString:function(){return"PopupMenu"}});return e.create=function(t,i){return new e(t,i)},e.make_popupmenu=function(t,i){var n=[];return _.each(i,function(e,t){var i={html:t};null===e?i.header=!0:"function"===jQuery.type(e)&&(i.func=e),n.push(i)}),new e($(t),n)},e.convertLinksToOptions=function(e,t){e=$(e),t=t||"a";var i=[];return e.find(t).each(function(e,t){var n={},r=$(e);if(n.html=r.text(),r.attr("href")){var s=r.attr("href"),o=r.attr("target"),a=r.attr("confirm");n.func=function(){if(!a||confirm(a))switch(o){case"_parent":window.parent.location=s;break;case"_top":window.top.location=s;break;default:window.location=s}}}i.push(n)}),i},e.fromExistingDom=function(t,i,n){t=$(t),i=$(i);var r=e.convertLinksToOptions(i,n);return i.remove(),new e(t,r)},e.make_popup_menus=function(t,i,n){t=t||document,i=i||"div[popupmenu]",n=n||function(e,t){return"#"+e.attr("popupmenu")};var r=[];return $(t).find(i).each(function(){var i=$(this),s=$(t).find(n(i,t));r.push(e.fromDom(s,i)),s.addClass("popup")}),r},e}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(2),i(1)],r=function(e,t){var i=Backbone.Model.extend(e.LoggableMixin).extend({urlRoot:galaxy_config.root+"api/users",defaults:{id:null,username:"("+t("anonymous user")+")",email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1},initialize:function(e){this.log("User.initialize:",e),this.on("loaded",function(e,t){this.log(this+" has loaded:",e,t)}),this.on("change",function(e,t){this.log(this+" has changed:",e,t.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},loadFromApi:function(e,t){e=e||i.CURRENT_ID_STR,t=t||{};var n=this,r=t.success;return t.success=function(e,t){n.trigger("loaded",e,t),r&&r(e,t)},e===i.CURRENT_ID_STR&&(t.url=this.urlRoot+"/"+i.CURRENT_ID_STR),Backbone.Model.prototype.fetch.call(this,t)},clearSessionStorage:function(){for(var e in sessionStorage)0===e.indexOf("history:")?sessionStorage.removeItem(e):"history-panel"===e&&sessionStorage.removeItem(e)},toString:function(){var e=[this.get("username")];return this.get("id")&&(e.unshift(this.get("id")),e.push(this.get("email"))),"User("+e.join(":")+")"}});i.CURRENT_ID_STR="current",i.getCurrentUserFromApi=function(e){var t=new i;return t.loadFromApi(i.CURRENT_ID_STR,e),t};Backbone.Collection.extend(e.LoggableMixin).extend({model:i,urlRoot:galaxy_config.root+"api/users"});return{User:i}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r,s;!function(i){r=[],n=i,s="function"==typeof n?n.apply(t,r):n,!(void 0!==s&&(e.exports=s))}(function(){jQuery.fn.extend({hoverhighlight:function(e,t){return e=e||"body",this.size()?($(this).each(function(){var i=$(this),n=i.data("target");n&&i.mouseover(function(i){$(n,e).css({background:t})}).mouseout(function(e){$(n).css({background:""})})}),this):this}})})},function(e,t,i){var n,r,s;!function(i){r=[],n=i,s="function"==typeof n?n.apply(t,r):n,!(void 0!==s&&(e.exports=s))}(function(){function e(e,i){function n(e){var t=$(this).parent().children("input");t.focus().val("").trigger("clear:searchInput"),i.onclear()}function r(e,t){$(this).trigger("search:searchInput",t),"function"==typeof i.onfirstsearch&&p?(p=!1,i.onfirstsearch(t)):i.onsearch(t)}function s(){return['<input type="text" name="',i.name,'" placeholder="',i.placeholder,'" ','class="search-query ',i.classes,'" ',"/>"].join("")}function o(){return $(s()).focus(function(e){$(this).select()}).keyup(function(e){if(e.preventDefault(),e.stopPropagation(),$(this).val()||$(this).blur(),e.which===d&&i.escWillClear)n.call(this,e);else{var t=$(this).val();e.which===u||i.minSearchLen&&t.length>=i.minSearchLen?r.call(this,e,t):t.length||n.call(this,e)}}).on("change",function(e){r.call(this,e,$(this).val());
}).val(i.initialVal)}function a(){return $(['<span class="search-clear fa fa-times-circle" ','title="',t("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(e){n.call(this,e)})}function l(){return $(['<span class="search-loading fa fa-spinner fa-spin" ','title="',t("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})}function c(){h.find(".search-loading").toggle(),h.find(".search-clear").toggle()}var d=27,u=13,h=$(e),p=!0,f={initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(e){},minSearchLen:0,escWillClear:!0,oninit:function(){}};return"string"===jQuery.type(i)?("toggle-loading"===i&&c(),h):("object"===jQuery.type(i)&&(i=jQuery.extend(!0,{},f,i)),h.addClass("search-input").prepend([o(),a(),l()]))}var t=window._l||function(e){return e};jQuery.fn.extend({searchInput:function(t){return this.each(function(){return e(this,t)})}})})},function(e,t,i){var n,r;n=[],r=function(){function e(e,t){var i=void 0!==e.prototype?e.prototype:e;return void 0!==t&&(i._logNamespace=t),["debug","info","warn","error","metric"].forEach(function(e){i[e]=function(){return this.logger?this.logger.emit?this.logger.emit(e,this._logNamespace,arguments):this.logger[e]?this.logger[e].apply(this.logger,arguments):void 0:void 0}}),e}return e}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){function e(e,t){var i=/(-?[0-9\.]+)/g,n=e.toString().toLowerCase()||"",r=t.toString().toLowerCase()||"",s=String.fromCharCode(0),o=n.replace(i,s+"$1"+s).split(s),a=r.replace(i,s+"$1"+s).split(s),l=new Date(n).getTime(),c=l?new Date(r).getTime():null;if(c){if(c>l)return-1;if(l>c)return 1}for(var d,u,h=0,p=Math.max(o.length,a.length);p>h;h++){if(d=parseFloat(o[h])||o[h],u=parseFloat(a[h])||a[h],u>d)return-1;if(d>u)return 1}return 0}return e}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;i(15),n=[i(28),i(52),i(31),i(1)],r=function(e,t,i,n){function r(e,t){var i=this;return i._init(e||{},t||{})}return i(r,"GalaxyApp"),r.prototype.defaultOptions={patchExisting:!0,root:"/"},r.prototype._init=function(e,t){var i=this;return console.debug("bootstrapped:",t),_.extend(i,Backbone.Events),i._processOptions(e),i.debug("GalaxyApp.options: ",i.options),i._patchGalaxy(window.Galaxy),i._initLogger(e.loggerOptions||{}),i.debug("GalaxyApp.logger: ",i.logger),i._initLocale(),i.debug("GalaxyApp.localize: ",i.localize),i.config=e.config||t.config||{},i.debug("GalaxyApp.config: ",i.config),i._initUser(e.user||t.user||{}),i.debug("GalaxyApp.user: ",i.user),i._setUpListeners(),i.trigger("ready",i),i},r.prototype._processOptions=function(e){var t=this,i=t.defaultOptions;t.debug("_processOptions: ",e),t.options={};for(var n in i)i.hasOwnProperty(n)&&(t.options[n]=e.hasOwnProperty(n)?e[n]:i[n]);return t},r.prototype._patchGalaxy=function(e){var t=this;if(t.options.patchExisting&&e){t.debug("found existing Galaxy object:",e);for(var i in e)e.hasOwnProperty(i)&&(t.debug("	 patching in "+i+" to Galaxy"),t[i]=e[i])}},r.prototype._initLogger=function(e){var i=this;return i.debug("_initLogger:",e),i.logger=new t.MetricsLogger(e),i},r.prototype._initLocale=function(e){var t=this;return t.debug("_initLocale:",e),t.localize=n,window._l=t.localize,t},r.prototype._initUser=function(t){var i=this;return i.debug("_initUser:",t),i.user=new e.User(t),i.currUser=i.user,i},r.prototype._setUpListeners=function(){var e=this;return e.lastAjax={},$(document).bind("ajaxSend",function(t,i,n){var r=n.data;try{r=JSON.parse(r)}catch(s){}e.lastAjax={url:location.href.slice(0,-1)+n.url,data:r}}),e._listenToGalaxyMain(),e},r.prototype._listenToGalaxyMain=function(){var e=this,t="iframe#galaxy_main",i=$(t);if(i=i.size()?i.get(0).contentWindow:void 0){var n=function(i){try{var n=$(t).get(0).contentWindow,r=n.location.pathname+n.location.search+n.location.hash;e.trigger("galaxy_main:load",{fullpath:r,pathname:n.location.pathname,search:n.location.search,hash:n.location.hash})}catch(s){e.debug("Error handling main frame load:",s)}};$(t).on("load",n)}else e.debug("No galaxy_main found")},r.prototype.toString=function(){var e=this.user.get("email")||"(anonymous)";return"GalaxyApp("+e+")"},{GalaxyApp:r}}.apply(t,n),!(void 0!==r&&(e.exports=r))},,function(e,t,i){var n,r;n=[i(14)],r=function(e){var t=Backbone.Model.extend({options:null,masthead:null,initialize:function(e){this.options=e.config,this.masthead=e.masthead,this.create()},create:function(){var t=new e.GalaxyMastheadTab({id:"analysis",title:"Analyze Data",content:"",title_attribute:"Analysis home view"});this.masthead.append(t);var i={id:"workflow",title:"Workflow",content:"workflow",title_attribute:"Chain tools into workflows"};this.options.user.valid||(i.disabled=!0);var n=new e.GalaxyMastheadTab(i);this.masthead.append(n);var r=new e.GalaxyMastheadTab({id:"shared",title:"Shared Data",content:"library/index",title_attribute:"Access published resources"});if(r.add({title:"Data Libraries",content:"library/index"}),r.add({title:"Data Libraries Beta",content:"library/list",divider:!0}),r.add({title:"Published Histories",content:"history/list_published"}),r.add({title:"Published Workflows",content:"workflow/list_published"}),r.add({title:"Published Visualizations",content:"visualization/list_published"}),r.add({title:"Published Pages",content:"page/list_published"}),this.masthead.append(r),this.options.user.requests){var s=new e.GalaxyMastheadTab({id:"lab",title:"Lab"});s.add({title:"Sequencing Requests",content:"requests/index"}),s.add({title:"Find Samples",content:"requests/find_samples_index"}),s.add({title:"Help",content:this.options.lims_doc_url}),this.masthead.append(s)}var o={id:"visualization",title:"Visualization",content:"visualization/list",title_attribute:"Visualize datasets"};this.options.user.valid||(o.disabled=!0);var a=new e.GalaxyMastheadTab(o);if(this.options.user.valid&&(a.add({title:"New Track Browser",content:"visualization/trackster",target:"_frame"}),a.add({title:"Saved Visualizations",content:"visualization/list",target:"_frame"})),this.masthead.append(a),this.options.enable_cloud_launch){var l=new e.GalaxyMastheadTab({id:"cloud",title:"Cloud",content:"cloudlaunch/index"});l.add({title:"New Cloud Cluster",content:"cloudlaunch/index"}),this.masthead.append(l)}if(this.options.is_admin_user){var c=new e.GalaxyMastheadTab({id:"admin",title:"Admin",content:"admin",extra_class:"admin-only",title_attribute:"Administer this Galaxy"});this.masthead.append(c)}var d=new e.GalaxyMastheadTab({id:"help",title:"Help",title_attribute:"Support, contact, and community hubs"});if(this.options.biostar_url&&(d.add({title:"Galaxy Biostar",content:this.options.biostar_url_redirect,target:"_blank"}),d.add({title:"Ask a question",content:"biostar/biostar_question_redirect",target:"_blank"})),d.add({title:"Support",content:this.options.support_url,target:"_blank"}),d.add({title:"Search",content:this.options.search_url,target:"_blank"}),d.add({title:"Mailing Lists",content:this.options.mailing_lists,target:"_blank"}),d.add({title:"Videos",content:this.options.screencasts_url,target:"_blank"}),d.add({title:"Wiki",content:this.options.wiki_url,target:"_blank"}),d.add({title:"How to Cite Galaxy",content:this.options.citation_url,target:"_blank"}),this.options.terms_url&&d.add({title:"Terms and Conditions",content:this.options.terms_url,target:"_blank"}),this.masthead.append(d),this.options.user.valid){var u=new e.GalaxyMastheadTab({id:"user",title:"User",extra_class:"loggedin-only",title_attribute:"Account preferences and saved data"});u.add({title:"Logged in as "+this.options.user.email}),u.add({title:"Preferences",content:"user?cntrller=user",target:"galaxy_main"}),u.add({title:"Custom Builds",content:"user/dbkeys",target:"galaxy_main"}),u.add({title:"Logout",content:"user/logout",target:"_top",divider:!0}),u.add({title:"Saved Histories",content:"history/list",target:"galaxy_main"}),u.add({title:"Saved Datasets",content:"dataset/list",target:"galaxy_main"}),u.add({title:"Saved Pages",content:"page/list",target:"_top"}),u.add({title:"API Keys",content:"user/api_keys?cntrller=user",target:"galaxy_main"}),this.options.use_remote_user&&u.add({title:"Public Name",content:"user/edit_username?cntrller=user",target:"galaxy_main"}),this.masthead.append(u)}else{var u=new e.GalaxyMastheadTab({id:"user",title:"User",extra_class:"loggedout-only",title_attribute:"Account registration or login"});u.add({title:"Login",content:"user/login",target:"galaxy_main"}),this.options.allow_user_creation&&u.add({title:"Register",content:"user/create",target:"galaxy_main"}),this.masthead.append(u)}this.options.active_view&&this.masthead.highlight(this.options.active_view)}});return{GalaxyMenu:t}}.apply(t,n),!(void 0!==r&&(e.exports=r))},,,,,,function(e,t,i){var n,r;n=[i(5),i(19),i(2),i(1)],r=function(e,t,i,n){var r=e.DCListItemView,s=r.extend({initialize:function(e){r.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCListItemEdit("+e+")"}}),o=e.DCEListItemView,a=o.extend({initialize:function(e){o.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCEListItemEdit("+e+")"}}),l=t.DatasetListItemEdit.extend({initialize:function(e){t.DatasetListItemEdit.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetDCEListItemEdit("+e+")"}});l.prototype.templates=function(){return _.extend({},t.DatasetListItemEdit.prototype.templates,{titleBar:e.DatasetDCEListItemView.prototype.templates.titleBar})}();var c=e.NestedDCDCEListItemView.extend({toString:function(){var e=this.model?this.model+"":"(no model)";return"NestedDCDCEListItemEdit("+e+")"}});return{DCListItemEdit:s,DCEListItemEdit:a,DatasetDCEListItemEdit:l,NestedDCDCEListItemEdit:c}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(7),i(6),i(41),i(2),i(1)],r=function(e,t,i,n,r){var s=e.CollectionPanel,o=s.extend({DatasetDCEViewClass:i.DatasetDCEListItemEdit,NestedDCDCEViewClass:i.NestedDCDCEListItemEdit,initialize:function(e){s.prototype.initialize.call(this,e)},_setUpBehaviors:function(e){if(e=e||this.$el,s.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.currUser&&!Galaxy.currUser.isAnonymous()){var t=this,i="> .controls .name";e.find(i).attr("title",r("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find(i).text(e),t.model.save({name:e}).fail(function(){t.$el.find(i).text(t.model.previous("name"))})):t.$el.find(i).text(n)}})}},toString:function(){return"CollectionPanelEdit("+(this.model?this.model.get("name"):"")+")"}}),a=o.extend({DatasetDCEViewClass:i.DatasetDCEListItemEdit,toString:function(){return"ListCollectionPanelEdit("+(this.model?this.model.get("name"):"")+")"}}),l=a.extend({toString:function(){return"PairCollectionPanelEdit("+(this.model?this.model.get("name"):"")+")"}}),c=l.extend({_setUpBehaviors:function(e){s.prototype._setUpBehaviors.call(this,e)},toString:function(){return"NestedPairCollectionPanelEdit("+(this.model?this.model.get("name"):"")+")"}}),d=o.extend({NestedDCDCEViewClass:i.NestedDCDCEListItemEdit.extend({foldoutPanelClass:c}),toString:function(){return"ListOfPairsCollectionPanelEdit("+(this.model?this.model.get("name"):"")+")"}});return{CollectionPanelEdit:o,ListCollectionPanelEdit:a,PairCollectionPanelEdit:l,ListOfPairsCollectionPanelEdit:d}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(51),i(32),i(8),i(2),i(1),i(29)],r=function(e,t,i,n,r){function s(e){function t(){return i.length||(i=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),i}e=e||{},e.createPair=e.createPair||function(e){return this.debug("creating pair:",e.listA[e.indexA].name,e.listB[e.indexB].name),e=e||{},this._pair(e.listA.splice(e.indexA,1)[0],e.listB.splice(e.indexB,1)[0],{silent:!0})};var i=[];return e.preprocessMatch=e.preprocessMatch||function(e){var i=t.call(this);return _.extend(e,{matchTo:e.matchTo.name.replace(i[0],""),possible:e.possible.name.replace(i[1],"")})},function(t){this.debug("autopair _strategy ---------------------------"),t=t||{};var i,n=t.listA,r=t.listB,s=0,o={score:0,index:null},a=[];for(this.debug("starting list lens:",n.length,r.length),this.debug("bestMatch (starting):",JSON.stringify(o,null,"  "));s<n.length;){var l=n[s];for(o.score=0,i=0;i<r.length;i++){var c=r[i];if(this.debug(s+":"+l.name),this.debug(i+":"+c.name),n[s]!==r[i]&&(o=e.match.call(this,e.preprocessMatch.call(this,{matchTo:l,possible:c,index:i,bestMatch:o})),this.debug("bestMatch:",JSON.stringify(o,null,"  ")),1===o.score)){this.debug("breaking early due to perfect match");break}}var d=e.scoreThreshold.call(this);if(this.debug("scoreThreshold:",d),this.debug("bestMatch.score:",o.score),o.score>=d?(this.debug("creating pair"),a.push(e.createPair.call(this,{listA:n,indexA:s,listB:r,indexB:o.index})),this.debug("list lens now:",n.length,r.length)):s+=1,!n.length||!r.length)return a}return this.debug("paired:",JSON.stringify(a,null,"  ")),this.debug("autopair _strategy ---------------------------"),a}}function o(e){var t=e.toJSON();return c(t,{historyId:e.historyId})}var a=Backbone.View.extend(n.LoggableMixin).extend({tagName:"li",className:"dataset paired",initialize:function(e){this.pair=e.pair||{}},template:_.template(['<span class="forward-dataset-name flex-column"><%= pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%= pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%= pair.reverse.name %></span>'].join("")),render:function(){return this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container"),this},events:{dragstart:"_dragstart",dragend:"_dragend",dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(e){e.currentTarget.style.opacity="0.4",e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(e){e.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"PairView("+this.pair.name+")"}}),l=Backbone.View.extend(n.LoggableMixin).extend({className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(e){this.metric("PairedCollectionCreator.initialize",e),e=_.defaults(e,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=e.datasets,this.historyId=e.historyId,this.filters=this.commonFilters[e.filters]||this.commonFilters[this.DEFAULT_FILTERS],_.isArray(e.filters)&&(this.filters=e.filters),this.automaticallyPair=e.automaticallyPair,this.strategy=this.strategies[e.strategy]||this.strategies[this.DEFAULT_STRATEGY],_.isFunction(e.strategy)&&(this.strategy=e.strategy),this.matchPercentage=e.matchPercentage,this.twoPassAutopairing=e.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=e.oncancel,this.oncreate=e.oncreate,this.autoscrollDist=e.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(e){return e.sort(function(e,i){return t(e.name,i.name)}),e},_ensureIds:function(){return this.initialList.forEach(function(e){e.hasOwnProperty("id")||(e.id=_.uniqueId())}),this.initialList},_splitByFilters:function(){function e(e,t){return t.test(e.name)}var t=this.filters.map(function(e){return new RegExp(e)}),i=[[],[]];return this.unpaired.forEach(function(n){t.forEach(function(t,r){e(n,t)&&i[r].push(n)})}),i},_addToUnpaired:function(e){var i=function(n,r){if(n===r)return n;var s=Math.floor((r-n)/2)+n,o=t(e.name,this.unpaired[s].name);if(0>o)return i(n,s);if(o>0)return i(s+1,r);for(;this.unpaired[s]&&this.unpaired[s].name===e.name;)s++;return s}.bind(this);this.unpaired.splice(i(0,this.unpaired.length),0,e)},autoPair:function(e){var t=this._splitByFilters(),i=[];return this.twoPassAutopairing&&(i=this.autopairSimple({listA:t[0],listB:t[1]}),t=this._splitByFilters()),e=e||this.strategy,t=this._splitByFilters(),i=i.concat(this[e].call(this,{listA:t[0],listB:t[1]}))},autopairSimple:s({scoreThreshold:function(){return 1},match:function(e){return e=e||{},e.matchTo===e.possible?{index:e.index,score:1}:e.bestMatch}}),autopairLevenshtein:s({scoreThreshold:function(){return this.matchPercentage},match:function(t){t=t||{};var i=e(t.matchTo,t.possible),n=1-i/Math.max(t.matchTo.length,t.possible.length);return n>t.bestMatch.score?{index:t.index,score:n}:t.bestMatch}}),autopairLCS:s({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=this._naiveStartingAndEndingLCS(e.matchTo,e.possible).length,i=t/Math.max(e.matchTo.length,e.possible.length);return i>e.bestMatch.score?{index:e.index,score:i}:e.bestMatch}}),_naiveStartingAndEndingLCS:function(e,t){for(var i="",n="",r=0,s=0;r<e.length&&r<t.length&&e[r]===t[r];)i+=e[r],r+=1;if(r===e.length)return e;if(r===t.length)return t;for(r=e.length-1,s=t.length-1;r>=0&&s>=0&&e[r]===t[s];)n=[e[r],n].join(""),r-=1,s-=1;return i+n},_pair:function(e,t,i){i=i||{};var n=this._createPair(e,t,i.name);return this.paired.push(n),this.unpaired=_.without(this.unpaired,e,t),i.silent||this.trigger("pair:new",n),n},_createPair:function(e,t,i){if(!e||!t||e===t)throw new Error("Bad pairing: "+[JSON.stringify(e),JSON.stringify(t)]);return i=i||this._guessNameForPair(e,t),{forward:e,name:i,reverse:t}},_guessNameForPair:function(e,t,i){i=void 0!==i?i:this.removeExtensions;var n=e.name,r=t.name,s=this._naiveStartingAndEndingLCS(n.replace(this.filters[0],""),r.replace(this.filters[1],""));if(i){var o=s.lastIndexOf(".");if(o>0){var a=s.slice(o,s.length);s=s.replace(a,""),n=n.replace(a,""),r=r.replace(a,"")}}return s||n+" & "+r},_unpair:function(e,t){if(t=t||{},!e)throw new Error("Bad pair: "+JSON.stringify(e));return this.paired=_.without(this.paired,e),this._addToUnpaired(e.forward),this._addToUnpaired(e.reverse),t.silent||this.trigger("pair:unpair",[e]),e},unpairAll:function(){for(var e=[];this.paired.length;)e.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",e)},_pairToJSON:function(e,t){return t=t||"hda",{collection_type:"paired",src:"new_collection",name:e.name,element_identifiers:[{name:"forward",id:e.forward.id,src:t},{name:"reverse",id:e.reverse.id,src:t}]}},createList:function(e){var t=this,i="/api/histories/"+this.historyId+"/contents/dataset_collections",n={type:"dataset_collection",collection_type:"list:paired",name:_.escape(e||t.$(".collection-name").val()),element_identifiers:t.paired.map(function(e){return t._pairToJSON(e)})};return t.blocking=!0,jQuery.ajax(i,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(n)}).always(function(){t.blocking=!1}).fail(function(e,i,n){t._ajaxErrHandler(e,i,n)}).done(function(e,i,n){t.trigger("collection:created",e,i,n),t.metric("collection:created",e),"function"==typeof t.oncreate&&t.oncreate.call(this,e,i,n)})},_ajaxErrHandler:function(e,t,i){this.error(e,t,i);var n=r("An error occurred while creating this collection");e&&(n+=0===e.readyState&&0===e.status?": "+r("Galaxy could not be reached and may be updating.")+r(" Try again in a few minutes."):e.responseJSON?"<br /><pre>"+JSON.stringify(e.responseJSON)+"</pre>":": "+i),creator._showAlert(n,"alert-danger")},render:function(e,t){return this.$el.empty().html(l.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(l.templates.header()).find(".help-content").prepend($(l.templates.helpContent()));return this._renderFilters(),i},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(l.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),i},_renderUnpaired:function(e,t){var i,n,s=this,o=[],a=this._splitByFilters();return this.$(".forward-column .title").text([a[0].length,r("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-a[0].length)),this.$(".reverse-column .title").text([a[1].length,r("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-a[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0===this.unpaired.length?void this._renderUnpairedEmpty():(n=a[1].map(function(e,t){return void 0!==a[0][t]&&a[0][t]!==e&&o.push(s._renderPairButton()),s._renderUnpairedDataset(e)}),i=a[0].map(function(e){return s._renderUnpairedDataset(e)}),i.length||n.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(i).add(this.$(".unpaired-columns .paired-column .column-datasets").append(o)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(n)),void this._adjUnpairedOnScrollbar()):void this._renderUnpairedNotShown())},_renderUnpairedDisplayStr:function(e){return["(",e," ",r("filtered out"),")"].join("")},_renderUnpairedDataset:function(e){return $("<li/>").attr("id","dataset-"+e.id).addClass("dataset unpaired").attr("draggable",!0).addClass(e.selected?"selected":"").append($("<span/>").addClass("dataset-name").text(e.name)).data("dataset",e)},_renderPairButton:function(){return $("<li/>").addClass("dataset unpaired").append($("<span/>").addClass("dataset-name").text(r("Pair these datasets")))},_renderUnpairedEmpty:function(){var e=$('<div class="empty-message"></div>').text("("+r("no remaining unpaired datasets")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_renderUnpairedNotShown:function(){var e=$('<div class="empty-message"></div>').text("("+r("no datasets were found matching the current filters")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_adjUnpairedOnScrollbar:function(){var e=this.$(".unpaired-columns").last(),t=this.$(".unpaired-columns .reverse-column .dataset").first();if(t.size()){var i=e.offset().left+e.outerWidth(),n=t.offset().left+t.outerWidth(),r=Math.floor(i)-Math.floor(n);this.$(".unpaired-columns .forward-column").css("margin-left",r>0?r:0)}},_renderPaired:function(e,t){if(this.$(".paired-column-title .title").text([this.paired.length,r("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0===this.paired.length)return void this._renderPairedEmpty();this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var i=this;this.paired.forEach(function(e,t){var n=new a({pair:e});i.$(".paired-columns .column-datasets").append(n.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',r("Unpair"),'"></span>',"</button>"].join(""))})},_renderPairedEmpty:function(){var e=$('<div class="empty-message"></div>').text("("+r("no paired datasets yet")+")");return this.$(".paired-columns .column-datasets").empty().prepend(e),e},_renderFooter:function(e,t){var i=this.$(".footer").empty().html(l.templates.footer());return this.$(".remove-extensions").prop("checked",this.removeExtensions),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),i},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(e){function t(e,t){return['<button class="filter-choice btn" ','data-forward="',e,'" data-reverse="',t,'">',r("Forward"),": ",e,", ",r("Reverse"),": ",t,"</button>"].join("")}var i=$(_.template(['<div class="choose-filters">','<div class="help">',r("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",_.values(this.commonFilters).map(function(e){return t(e[0],e[1])}).join(""),"</div>"].join(""))({}));return this.$(e).popover({container:".collection-creator",placement:"bottom",html:!0,content:i})},_validationWarning:function(e,t){var i="validation-warning";"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$("."+i),e.removeClass(i)):e.addClass(i)},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(e){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){this._renderUnpaired(),this._renderPaired();var e,t=null;this.paired.length?(t="alert-success",e=this.paired.length+" "+r("pairs created"),this.unpaired.length||(e+=": "+r("all datasets have been successfully paired"),this.hideUnpaired(),this.$(".collection-name").focus())):e=r("Could not automatically create any pairs from the given dataset names"),this._showAlert(e,t)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(e){$(e.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(e){$(e.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(e){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","click .cancel-create":function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},"click .create-collection":"_clickCreate"},_clickMoreHelp:function(e){this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},_clickShowOnlyUnpaired:function(e){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(e){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(e,t){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(e,t)},hidePaired:function(e,t){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(e,t)},splitView:function(e,t){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(e,t),this},_clickUnpairAll:function(e){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(e){var t=this.autoPair();this.metric("autopair",t.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(e){var t=$(e.currentTarget);this.$(".forward-unpaired-filter input").val(t.data("forward")),this.$(".reverse-unpaired-filter input").val(t.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(e){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(e){return e.stopPropagation(),this.toggleSelectUnpaired($(e.currentTarget))},toggleSelectUnpaired:function(e,t){t=t||{};var i=e.data("dataset"),n=void 0!==t.force?t.force:!e.hasClass("selected");return e.size()&&void 0!==i?(n?(e.addClass("selected"),t.waitToPair||this.pairAllSelected()):e.removeClass("selected"),e):e},pairAllSelected:function(e){e=e||{};var t=this,i=[],n=[],r=[];return t.$(".unpaired-columns .forward-column .dataset.selected").each(function(){i.push($(this).data("dataset"))}),t.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){n.push($(this).data("dataset"))}),i.length=n.length=Math.min(i.length,n.length),i.forEach(function(e,i){try{r.push(t._pair(e,n[i],{silent:!0}))}catch(s){t.error(s)}}),r.length&&!e.silent&&this.trigger("pair:new",r),r},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(e){if(e.shiftKey){var t=this,i=$(e.target).addClass("selected"),n=function(e){t.$(e.target).filter(".dataset").addClass("selected")};i.parent().on("mousemove",n),$(document).one("mouseup",function(e){i.parent().off("mousemove",n),t.pairAllSelected()})}},_clickPairRow:function(e){var t=$(e.currentTarget).index(),i=$(".unpaired-columns .forward-column .dataset").eq(t).data("dataset"),n=$(".unpaired-columns .reverse-column .dataset").eq(t).data("dataset");this._pair(i,n)},_startPartitionDrag:function(e){function t(e){n.$(".flexible-partition-drag").css("color",""),$("body").css("cursor","").unbind("mousemove",i)}function i(e){var t=e.pageY-r;n.adjPartition(t)||$("body").trigger("mouseup"),n._adjUnpairedOnScrollbar(),r+=t}var n=this,r=e.pageY;$("body").css("cursor","ns-resize"),n.$(".flexible-partition-drag").css("color","black"),$("body").mousemove(i),$("body").one("mouseup",t)},adjPartition:function(e){var t=this.$(".unpaired-columns"),i=this.$(".paired-columns"),n=parseInt(t.css("height"),10),r=parseInt(i.css("height"),10);
n=Math.max(10,n+e),r-=e;var s=0>e;if(s){if(this.unpairedPanelHidden)return!1;if(10>=n)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(t.show(),this.unpairedPanelHidden=!1);if(s)this.pairedPanelHidden&&(i.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(15>=r)return this.hidePaired(),!1}return t.css({height:n+"px",flex:"0 0 auto"}),!0},selectPair:function(e){e.stopPropagation(),$(e.currentTarget).toggleClass("selected")},clearSelectedPaired:function(e){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.parent().parent(),n=i.index(".dataset.paired"),r=this.paired[n],s=prompt("Enter a new name for the pair:",r.name);s&&(r.name=s,r.customizedName=!0,t.text(r.name))},_clickUnpair:function(e){var t=Math.floor($(e.currentTarget).index(".unpair-btn"));this._unpair(this.paired[t])},_dragoverPairedColumns:function(e){e.preventDefault();var t=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestPairedDatasetLi(e.originalEvent.clientY);$(".element-drop-placeholder").remove();var n=$('<div class="element-drop-placeholder"></div>');i.size()?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=2,n=e.offset(),r=e.scrollTop(),s=t-n.top,o=n.top+e.outerHeight()-t;s>=0&&s<this.autoscrollDist?e.scrollTop(r-i):o>=0&&o<this.autoscrollDist&&e.scrollTop(r+i)},_getNearestPairedDatasetLi:function(e){for(var t=4,i=this.$(".paired-columns .column-datasets li").toArray(),n=0;n<i.length;n++){var r=$(i[n]),s=r.offset().top,o=Math.floor(r.outerHeight()/2)+t;if(s+o>e&&e>s-o)return r}return $()},_dropPairedColumns:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestPairedDatasetLi(e.originalEvent.clientY);return t.size()?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var e=[];this.$(".paired-columns .dataset.paired").each(function(){e.push($(this).data("pair"))}),this.paired=e,this._renderPaired()},_pairDragstart:function(e,t){t.$el.addClass("selected");var i=this.$(".paired-columns .dataset.selected");this.$dragging=i},_pairDragend:function(e,t){$(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(e){var t=this;t.removeExtensions=void 0!==e?e:!t.removeExtensions,_.each(t.paired,function(e){e.customizedName||(e.name=t._guessNameForPair(e.forward,e.reverse))}),t._renderPaired(),t._renderFooter()},_changeName:function(e){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return _.escape(this.$(".collection-name").val())},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList():this._validationWarning("name")},_printList:function(e){var t=this;_.each(e,function(i){e===t.paired&&t._printPair(i)})},_printPair:function(e){this.debug(e.forward.name,e.reverse.name,": ->",e.name)},toString:function(){return"PairedCollectionCreator"}});l.templates=l.templates||{main:_.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex">'].join("")),header:_.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',r("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',r("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',r("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter pull-left">','<input class="search-query" placeholder="',r("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',r("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',r("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',r("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',r("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter pull-left">','<input class="search-query" placeholder="',r("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:_.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',r("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',r("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:_.template(['<div class="attributes clear">','<div class="clear">','<label class="remove-extensions-prompt pull-right">',r("Remove file extensions from pair names"),"?",'<input class="remove-extensions pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',r("Enter a name for your new list"),'" />','<div class="collection-name-prompt pull-right">',r("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',r("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',r("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',r("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',r("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',r("Create list"),"</button>","</div>","</div>"].join("")),helpContent:_.template(["<p>",r(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",r(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",r(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",r(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",r(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",r(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))};var c=function(e,t){var i,n=jQuery.Deferred();if(t=_.defaults(t||{},{datasets:e,oncancel:function(){Galaxy.modal.hide(),n.reject("cancelled")},oncreate:function(e,t){Galaxy.modal.hide(),n.resolve(t)}}),!window.Galaxy||!Galaxy.modal)throw new Error("Galaxy or Galaxy.modal not found");return i=new l(t),Galaxy.modal.show({title:"Create a collection of paired datasets",body:i.$el,width:"80%",height:"800px",closing_events:!0}),i.render(),window.creator=i,n};return{PairedCollectionCreator:l,pairedCollectionCreatorModal:c,createListOfPairsCollection:o}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(8),i(10),i(2),i(1)],r=function(e,t,i,n){function r(e){var t=e.toJSON(),i=l(t,{creationFn:function(t,i){return t=[{name:"forward",src:"hda",id:t[0].id},{name:"reverse",src:"hda",id:t[1].id}],e.createHDCA(t,"paired",i)}});return i}var s=Backbone.View.extend(i.LoggableMixin).extend({tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.identifier=e.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:_.template(['<span class="identifier"><%= identifier %></span>','<span class="name"><%= element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),o=e.ListCollectionCreator,a=o.extend({elementViewClass:s,collectionClass:t.HistoryPairDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(e,t){return 2===this.workingElements.length?o.prototype.render.call(this,e,t):this._renderInvalid(e,t)},_renderList:function(e,t){var i=this,n=jQuery("<div/>"),r=i.$list();_.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),n.append(i._createForwardElementView().$el),n.append(i._createReverseElementView().$el),r.empty().append(n.children()),_.invoke(i.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(e,t){var i=new this.elementViewClass(_.extend(t,{element:e}));return this.elementViews.push(i),i},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:_.extend(_.clone(o.prototype.events),{"click .swap":"swap"}),templates:_.extend(_.clone(o.prototype.templates),{middle:_.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',n("Swap forward and reverse datasets"),'">',n("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:_.template(["<p>",n(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",n(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",n(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",n(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:_.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",n("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%= problem.element.name %></b>: <%= problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",n("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",n("Only one dataset was selected"),": <%= elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",n("Too many datasets were selected"),': <%= _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",n("Two (and only two) elements are needed for the pair"),". ",n("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',n("cancel"),"</a> ",n("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',n("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),l=function(t,i){return i=i||{},i.title=n("Create a collection from a pair of datasets"),e.collectionCreatorModal(t,i,a)};return{PairCollectionCreator:a,pairCollectionCreatorModal:l,createPairCollection:r}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(19),i(21),i(2),i(1)],r=function(e,t,i,n){var r=e.DatasetListItemEdit,s=r.extend({className:r.prototype.className+" history-content",events:_.extend(_.clone(r.prototype.events),{"click .unhide-link":function(e){return this.model.unhide(),!1}}),toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAListItemEdit("+e+")"}});return s.prototype.templates=function(){var e=_.extend({},r.prototype.templates.warnings,{hidden:i.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',n("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',n("Unhide it"),"</a>","</div>","<% } %>"],"dataset")});return _.extend({},r.prototype.templates,{titleBar:t.HDAListItemView.prototype.templates.titleBar,warnings:e})}(),{HDAListItemEdit:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(23),i(42),i(4),i(1)],r=function(e,t,i,n){var r=e.HDCAListItemView,s=r.extend({_getFoldoutPanelClass:function(){switch(this.model.get("collection_type")){case"list":return t.ListCollectionPanelEdit;case"paired":return t.PairCollectionPanelEdit;case"list:paired":return t.ListOfPairsCollectionPanelEdit}throw new TypeError("Uknown collection_type: "+this.model.get("collection_type"))},_renderPrimaryActions:function(){return this.log(this+"._renderPrimaryActions"),r.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){var e=this,t=this.model.get("deleted");return i({title:n(t?"Dataset collection is already deleted":"Delete"),classes:"delete-btn",faIcon:"fa-times",disabled:t,onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model["delete"]()}})},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDCAListItemEdit("+e+")"}});return{HDCAListItemEdit:s}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(48),i(12),i(3),i(22),i(45),i(46),i(26),i(18),i(8),i(44),i(43),i(4),i(27),i(1)],r=function(e,t,i,n,r,s,o,a,l,c,d,u,h,p){var f=e.HistoryPanel,g=f.extend({HDAViewClass:r.HDAListItemEdit,HDCAViewClass:s.HDCAListItemEdit,initialize:function(e){e=e||{},f.prototype.initialize.call(this,e),this.tagsEditor=null,this.annotationEditor=null,this.purgeAllowed=e.purgeAllowed||!1,this.annotationEditorShown=e.annotationEditorShown||!1,this.tagsEditorShown=e.tagsEditorShown||!1},_setUpListeners:function(){var e=this;f.prototype._setUpListeners.call(e),e.on("drop",function(t,i){e.dataDropped(i),e.dropTargetOff()}),e.on("view:attached view:removed",function(){e._renderCounts()},e)},_setUpCollectionListeners:function(){return f.prototype._setUpCollectionListeners.call(this),this.collection.on("change:deleted",this._handleHdaDeletionChange,this),this.collection.on("change:visible",this._handleHdaVisibleChange,this),this.collection.on("change:purged",function(e){this.model.fetch()},this),this},_setUpModelListeners:function(){return f.prototype._setUpModelListeners.call(this),this.model.on("change:nice_size",this.updateHistoryDiskSize,this),this},_buildNewRender:function(){var e=f.prototype._buildNewRender.call(this);return this.model?(Galaxy&&Galaxy.currUser&&Galaxy.currUser.id&&Galaxy.currUser.id===this.model.get("user_id")&&(this._renderTags(e),this._renderAnnotation(e)),e):e},renderItems:function(e){var t=f.prototype.renderItems.call(this,e);return this._renderCounts(e),t},_renderCounts:function(e){function t(e,t){return['<a class="',e,'" href="javascript:void(0);">',t,"</a>"].join("")}e=e||this.$el;var i=this.collection.where({deleted:!0}),n=this.collection.where({visible:!1}),r=[];return this.views.length&&r.push([this.views.length,p("shown")].join(" ")),i.length&&r.push(this.showDeleted?t("toggle-deleted-link",p("hide deleted")):[i.length,t("toggle-deleted-link",p("deleted"))].join(" ")),n.length&&r.push(this.showHidden?t("toggle-hidden-link",p("hide hidden")):[n.length,t("toggle-hidden-link",p("hidden"))].join(" ")),e.find("> .controls .subtitle").html(r.join(", "))},_renderTags:function(e){var t=this;this.tagsEditor=new o.TagsEditor({model:this.model,el:e.find(".controls .tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDATagEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDATagEditors(!1,t.fxSpeed)},$activator:u({title:p("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".controls .actions"))})},_renderAnnotation:function(e){var t=this;this.annotationEditor=new a.AnnotationEditor({model:this.model,el:e.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDAAnnotationEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDAAnnotationEditors(!1,t.fxSpeed)},$activator:u({title:p("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".controls .actions"))})},_setUpBehaviors:function(e){if(e=e||this.$el,f.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.currUser&&!Galaxy.currUser.isAnonymous()&&Galaxy.currUser.id===this.model.get("user_id")){var t=this,i="> .controls .name";e.find(i).attr("title",p("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find(i).text(e),t.model.save({name:e}).fail(function(){t.$el.find(i).text(t.model.previous("name"))})):t.$el.find(i).text(n)}})}},multiselectActions:function(){var e=this,t=[{html:p("Hide datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.hide;e.getSelectedModels().ajaxQueue(t)}},{html:p("Unhide datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.unhide;e.getSelectedModels().ajaxQueue(t)}},{html:p("Delete datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype["delete"];e.getSelectedModels().ajaxQueue(t)}},{html:p("Undelete datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.undelete;e.getSelectedModels().ajaxQueue(t)}}];return e.purgeAllowed&&t.push({html:p("Permanently delete datasets"),func:function(){if(confirm(p("This will permanently remove the data in your datasets. Are you sure?"))){var t=n.HistoryDatasetAssociation.prototype.purge;e.getSelectedModels().ajaxQueue(t)}}}),t=t.concat(e._collectionActions())},_collectionActions:function(){var e=this;return[{html:p("Build Dataset List"),func:function(){l.createListCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}},{html:p("Build Dataset Pair"),func:function(){c.createPairCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}},{html:p("Build List of Dataset Pairs"),func:function(){d.createListOfPairsCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}}]},_attachItems:function(e){return this.$list(e).append(this.views.reverse().map(function(e){return e.$el})),this},_attachView:function(e){var t=this;t.views.unshift(e),t.$list().prepend(e.render(0).$el.hide()),t.trigger("view:attached",e),e.$el.slideDown(t.fxSpeed,function(){t.trigger("view:attached:rendered")})},_getItemViewOptions:function(e){var t=f.prototype._getItemViewOptions.call(this,e);return _.extend(t,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),t},_handleHdaDeletionChange:function(e){e.get("deleted")&&!this.showDeleted&&this.removeItemView(e),this._renderCounts()},_handleHdaVisibleChange:function(e){e.hidden()&&!this.showHidden&&this.removeItemView(e),this._renderCounts()},toggleHDATagEditors:function(e){var t=Array.prototype.slice.call(arguments,1);_.each(this.views,function(e){e.tagsEditor&&e.tagsEditor.toggle.apply(e.tagsEditor,t)})},toggleHDAAnnotationEditors:function(e){var t=Array.prototype.slice.call(arguments,1);_.each(this.views,function(e){e.annotationEditor&&e.annotationEditor.toggle.apply(e.annotationEditor,t)})},events:_.extend(_.clone(f.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(e){this.toggleShowDeleted()},"click .toggle-hidden-link":function(e){this.toggleShowHidden()}}),updateHistoryDiskSize:function(){this.$el.find(".history-size").text(this.model.get("nice_size"))},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var e={dragenter:_.bind(this.dragenter,this),dragover:_.bind(this.dragover,this),dragleave:_.bind(this.dragleave,this),drop:_.bind(this.drop,this)},t=this._renderDropTarget();this.$list().before([this._renderDropTargetHelp(),t]);for(var i in e)e.hasOwnProperty(i)&&t.on(i,e[i]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),$("<div/>").addClass("history-drop-target").css({height:"64px",margin:"0px 10px 10px 10px",border:"1px dashed black","border-radius":"3px"})},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),$("<div/>").addClass("history-drop-target-help").css({margin:"10px 10px 4px 10px",color:"grey","font-size":"80%","font-style":"italic"}).text(p("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var e=this.$(".history-drop-target").get(0);for(var t in this._dropHandlers)this._dropHandlers.hasOwnProperty(t)&&e.off(t,this._dropHandlers[t]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(e){e.preventDefault(),e.stopPropagation()},dragleave:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this,i=e.dataTransfer.getData("text");try{i=JSON.parse(i)}catch(n){this.warn("error parsing JSON from drop:",i)}return this.trigger("droptarget:drop",e,i,t),!1},dataDropped:function(e){var t=this;return _.isObject(e)&&"HistoryDatasetAssociation"===e.model_class&&e.id?t.model.contents.copy(e.id):jQuery.when()},toString:function(){return"HistoryPanelEdit("+(this.model?this.model.get("name"):"")+")"}});return{HistoryPanelEdit:g}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[i(25),i(24),i(12),i(21),i(23),i(7),i(28),i(4),i(27),i(2),i(1),i(30)],r=function(e,t,i,n,r,s,o,a,l,c,d){var u=c.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(e){var t="expandedIds";this.save(t,_.extend(this.get(t),_.object([e.id],[e.get("id")])))},removeExpanded:function(e){var t="expandedIds";this.save(t,_.omit(this.get(t),e.id))},toString:function(){return"HistoryPrefs("+this.id+")"}});u.storageKeyPrefix="history:",u.historyStorageKey=function(e){if(!e)throw new Error("HistoryPrefs.historyStorageKey needs valid id: "+e);return u.storageKeyPrefix+e},u.get=function(e){return new u({id:u.historyStorageKey(e)})},u.clearAll=function(e){for(var t in sessionStorage)0===t.indexOf(u.storageKeyPrefix)&&sessionStorage.removeItem(t)};var h=e.ModelListPanel,p=h.extend({HDAViewClass:n.HDAListItemView,HDCAViewClass:r.HDCAListItemView,collectionClass:i.HistoryContents,modelCollectionKey:"contents",tagName:"div",className:h.prototype.className+" history-panel",emptyMsg:d("This history is empty"),noneFoundMsg:d("No matching datasets found"),searchPlaceholder:d("search datasets"),initialize:function(e){h.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},freeModel:function(){return h.prototype.freeModel.call(this),this.model&&this.model.clearUpdateTimeout(),this},_setUpListeners:function(){h.prototype._setUpListeners.call(this),this.on("error",function(e,t,i,n,r){this.errorHandler(e,t,i,n,r)}),this.on("loading-done",function(){this.views.length||this.trigger("empty-history",this)})},loadHistoryWithDetails:function(e,t,i,n){this.info("loadHistoryWithDetails:",e,t,i,n);var r=function(e){return _.values(u.get(e.id).get("expandedIds"))};return this.loadHistory(e,t,i,n,r)},loadHistory:function(e,i,n,r,s){this.info("loadHistory:",e,i,n,r,s);var o=this;i=i||{},o.trigger("loading",o);var a=t.History.getHistoryData(e,{historyFn:n,contentsFn:r,detailIdsFn:i.initiallyExpanded||s});return o._loadHistoryFromXHR(a,i).fail(function(t,n,r){o.trigger("error",o,t,i,d("An error was encountered while "+n),{historyId:e,history:r||{}})}).always(function(){o.trigger("loading-done",o)})},_loadHistoryFromXHR:function(e,t){var i=this;return e.then(function(e,n){i.JSONToModel(e,n,t),i.render()}),e.fail(function(e,t){i.render()}),e},refreshContents:function(e,t){return this.model?this.model.refresh(e,t):$.when()},JSONToModel:function(e,i,n){this.log("JSONToModel:",e,i,n),n=n||{};var r=new t.History(e,i,n);return this.setModel(r),r},setModel:function(e,t){t=t||{},h.prototype.setModel.call(this,e,t),this.model&&this._setUpWebStorage(t.initiallyExpanded,t.show_deleted,t.show_hidden)},_setUpWebStorage:function(e,t,i){return this.storage&&this.stopListening(this.storage),this.storage=new u({id:u.historyStorageKey(this.model.get("id"))}),_.isObject(e)&&this.storage.set("expandedIds",e),_.isBoolean(t)&&this.storage.set("show_deleted",t),_.isBoolean(i)&&this.storage.set("show_hidden",i),this.trigger("new-storage",this.storage,this),this.log(this+" (init'd) storage:",this.storage.get()),this.listenTo(this.storage,{"change:show_deleted":function(e,t){this.showDeleted=t},"change:show_hidden":function(e,t){this.showHidden=t}},this),this.showDeleted=void 0!==t?t:this.storage.get("show_deleted"),this.showHidden=void 0!==i?i:this.storage.get("show_hidden"),this},_buildNewRender:function(){var e=h.prototype._buildNewRender.call(this);return this.multiselectActions().length&&e.find(".controls .actions").prepend(this._renderSelectButton()),e},_renderSelectButton:function(e){return a({title:d("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o"})},_getItemViewClass:function(e){var t=e.get("history_content_type");switch(t){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: "+t)},_filterItem:function(e){var t=this;return h.prototype._filterItem.call(t,e)&&(!e.hidden()||t.showHidden)&&(!e.isDeletedOrPurged()||t.showDeleted)},_getItemViewOptions:function(e){var t=h.prototype._getItemViewOptions.call(this,e);return _.extend(t,{linkTarget:this.linkTarget,expanded:!!this.storage.get("expandedIds")[e.id],hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(e){var t=this;return h.prototype._setUpItemViewListeners.call(t,e),e.on("expanded",function(e){t.storage.addExpanded(e.model)}),e.on("collapsed",function(e){t.storage.removeExpanded(e.model)}),this},getSelectedModels:function(){var e=h.prototype.getSelectedModels.call(this);return e.historyId=this.collection.historyId,e},events:_.extend(_.clone(h.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .messages [class$=message]":"clearMessages"}),toggleShowDeleted:function(e,t){return e=void 0!==e?e:!this.showDeleted,t=void 0!==t?t:!0,this.showDeleted=e,t&&this.storage.set("show_deleted",e),this.trigger("show-hidden",e),this.renderItems(),this.showDeleted},toggleShowHidden:function(e,t){return e=void 0!==e?e:!this.showHidden,t=void 0!==t?t:!0,this.showHidden=e,t&&this.storage.set("show_hidden",e),this.trigger("show-hidden",e),this.renderItems(),this.showHidden},_firstSearch:function(e){var t=this,i=".history-search-input";return this.log("onFirstSearch",e),t.model.contents.haveDetails()?void t.searchItems(e):(t.$el.find(i).searchInput("toggle-loading"),void t.model.contents.fetchAllDetails({silent:!0}).always(function(){t.$el.find(i).searchInput("toggle-loading")}).done(function(){t.searchItems(e)}))},errorHandler:function(e,t,i,n,r){if(this.error(e,t,i,n,r),t&&0===t.status&&0===t.readyState);else if(t&&502===t.status);else{var s=this._parseErrorMessage(e,t,i,n,r);this.$messages().is(":visible")?this.displayMessage("error",s.message,s.details):this.once("rendered",function(){this.displayMessage("error",s.message,s.details)})}},_parseErrorMessage:function(e,t,i,n,r,s){var a=Galaxy.currUser,l={message:this._bePolite(n),details:{message:n,raven:window.Raven&&_.isFunction(Raven.lastEventId)?Raven.lastEventId():void 0,agent:navigator.userAgent,url:window.Galaxy?Galaxy.lastAjax.url:void 0,data:window.Galaxy?Galaxy.lastAjax.data:void 0,options:t?_.omit(i,"xhr"):i,
xhr:t,source:_.isFunction(e.toJSON)?e.toJSON():e+"",user:a instanceof o.User?a.toJSON():a+""}};if(_.extend(l.details,r||{}),t&&_.isFunction(t.getAllResponseHeaders)){var c=t.getAllResponseHeaders();c=_.compact(c.split("\n")),c=_.map(c,function(e){return e.split(": ")}),l.details.xhr.responseHeaders=_.object(c)}return l},_bePolite:function(e){return e=e||d("An error occurred while getting updates from the server"),e+". "+d("Please contact a Galaxy administrator if the problem persists")+"."},displayMessage:function(e,t,i){var n=this;this.scrollToTop();var r=this.$messages(),s=$("<div/>").addClass(e+"message").html(t);if(!_.isEmpty(i)){var o=$('<a href="javascript:void(0)">Details</a>').click(function(){return Galaxy.modal.show(n._messageToModalOptions(e,t,i)),!1});s.append(" ",o)}return r.append(s)},_messageToModalOptions:function(e,t,i){var n=this,r={title:"Details"};if(_.isObject(i)){i=_.omit(i,_.functions(i));var s=JSON.stringify(i,null,"  "),o=$("<pre/>").text(s);r.body=$("<div/>").append(o)}else r.body=$("<div/>").html(i);return r.buttons={Ok:function(){Galaxy.modal.hide(),n.clearMessages()}},r},clearMessages:function(e){var t=_.isUndefined(e)?this.$messages().children('[class$="message"]'):$(e.currentTarget);return t.fadeOut(this.fxSpeed,function(){$(this).remove()}),this},scrollToHid:function(e){return this.scrollToItem(_.first(this.viewsWhereModel({hid:e})))},toString:function(){return"HistoryPanel("+(this.model?this.model.get("name"):"")+")"}});return p.prototype.templates=function(){var e=c.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%= history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%= history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',d("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',d("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',d("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',d("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',d("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"],"history");return _.extend(_.clone(h.prototype.templates),{controls:e})}(),{HistoryPanel:p}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){var e=Backbone.View.extend({elMain:"body",optionsDefault:{title:"ui-modal",body:"",backdrop:!0,height:null,width:null,closing_events:!1,closing_callback:null},buttonList:{},initialize:function(e){e&&this._create(e)},show:function(e){this.initialize(e),this.options.height?(this.$body.css("height",this.options.height),this.$body.css("overflow","hidden")):this.$body.css("max-height",$(window).height()/2),this.options.width&&this.$dialog.css("width",this.options.width),this.visible?this.$el.show():this.$el.fadeIn("fast"),this.visible=!0},hide:function(){this.visible=!1,this.$el.fadeOut("fast"),this.options.closing_callback&&this.options.closing_callback()},enableButton:function(e){var t=this.buttonList[e];this.$buttons.find("#"+t).prop("disabled",!1)},disableButton:function(e){var t=this.buttonList[e];this.$buttons.find("#"+t).prop("disabled",!0)},showButton:function(e){var t=this.buttonList[e];this.$buttons.find("#"+t).show()},hideButton:function(e){var t=this.buttonList[e];this.$buttons.find("#"+t).hide()},getButton:function(e){var t=this.buttonList[e];return this.$buttons.find("#"+t)},scrollTop:function(){return this.$body.scrollTop()},_create:function(e){var t=this;if(this.options=_.defaults(e,this.optionsDefault),"progress"==this.options.body&&(this.options.body=$('<div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width:100%"></div></div>')),this.$el&&(this.$el.remove(),$(document).off("keyup.ui-modal")),this.setElement(this._template(this.options.title)),this.$dialog=this.$el.find(".modal-dialog"),this.$body=this.$el.find(".modal-body"),this.$footer=this.$el.find(".modal-footer"),this.$buttons=this.$el.find(".buttons"),this.$backdrop=this.$el.find(".modal-backdrop"),this.$body.html(this.options.body),this.options.backdrop||this.$backdrop.removeClass("in"),this.options.buttons){this.buttonList={};var i=0;$.each(this.options.buttons,function(e,n){var r="button-"+i++;t.$buttons.append($('<button id="'+r+'"></button>').text(e).click(n)).append(" "),t.buttonList[e]=r})}else this.$footer.hide();$(this.elMain).append($(this.el)),this.options.closing_events&&($(document).on("keyup.ui-modal",function(e){27==e.keyCode&&t.hide()}),this.$el.find(".modal-backdrop").on("click",function(){t.hide()}))},_template:function(e){return'<div class="ui-modal modal"><div class="modal-backdrop fade in" style="z-index: -1;"></div><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" style="display: none;">&times;</button><h4 class="title">'+e+'</h4></div><div class="modal-body" style="position: static;"></div><div class="modal-footer"><div class="buttons" style="float: right;"></div></div></div</div></div>'}});return{View:e}}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r,s;!function(i,o){r=[],n=o,s="function"==typeof n?n.apply(t,r):n,!(void 0!==s&&(e.exports=s))}(this,function(){function e(e,t){function i(){var i=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),n=$(i).hide().css(t.css||{position:"fixed"}),r=n.children(".loading-indicator-text");return t.cover?(n.css({"z-index":2,top:e.css("top"),bottom:e.css("bottom"),left:e.css("left"),right:e.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),r=n.children(".loading-indicator-text").css({"margin-top":"20px"})):(r=n.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}),r.children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"})),n}var n=this;return t=jQuery.extend({cover:!1},t||{}),n.show=function(t,r,s){return t=t||"loading...",r=r||"fast",e.parent().find(".loading-indicator").remove(),n.$indicator=i().insertBefore(e),n.message(t),n.$indicator.fadeIn(r,s),n},n.message=function(e){n.$indicator.find("i").text(e)},n.hide=function(e,t){return e=e||"fast",n.$indicator&&n.$indicator.size()?n.$indicator.fadeOut(e,function(){n.$indicator.remove(),t&&t()}):t&&t(),n},n}return e})},function(e,t,i){var n,r;n=[],r=function(){function e(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var i,n=[];for(i=0;i<=t.length;i++)n[i]=[i];var r;for(r=0;r<=e.length;r++)n[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=e.length;r++)t.charAt(i-1)===e.charAt(r-1)?n[i][r]=n[i-1][r-1]:n[i][r]=Math.min(n[i-1][r-1]+1,Math.min(n[i][r-1]+1,n[i-1][r]+1));return n[t.length][e.length]}return e}.apply(t,n),!(void 0!==r&&(e.exports=r))},function(e,t,i){var n,r;n=[],r=function(){function e(e){e=e||{};var t=this;return t.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,t.userId=t.userId||e.userId||null,t.consoleLogger=e.consoleLogger||null,t._init(e),t}function t(e){var t=this;return t._init(e||{})}return e.ALL=0,e.DEBUG=10,e.INFO=20,e.WARN=30,e.ERROR=40,e.METRIC=50,e.NONE=100,e.defaultOptions={logLevel:e.NONE,consoleLevel:e.NONE,defaultNamespace:"Galaxy",clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},e.prototype._init=function(t){var i=this;i.options={};for(var n in e.defaultOptions)e.defaultOptions.hasOwnProperty(n)&&(i.options[n]=t.hasOwnProperty(n)?t[n]:e.defaultOptions[n]);return i.options.logLevel=i._parseLevel(i.options.logLevel),i.options.consoleLevel=i._parseLevel(i.options.consoleLevel),i._sending=!1,i._waiting=null,i._postSize=i.options.postSize,i._initCache(),i},e.prototype._initCache=function(){try{this.cache=new t({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(i){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",i]),this.options.logLevel=e.NONE}},e.prototype._parseLevel=function(t){var i=typeof t;if("number"===i)return t;if("string"===i){var n=t.toUpperCase();if(e.hasOwnProperty(n))return e[n]}throw new Error("Unknown log level: "+t)},e.prototype.emit=function(e,t,i){var n=this;return t=t||n.options.defaultNamespace,e&&i?(e=n._parseLevel(e),e>=n.options.logLevel&&n._addToCache(e,t,i),n.consoleLogger&&e>=n.options.consoleLevel&&n._emitToConsole(e,t,i),n):n},e.prototype._addToCache=function(e,t,i){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var n=this;try{var r=n.cache.add(n._buildEntry(e,t,i));r>=n._postSize&&n._postCache()}catch(s){n._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",t,i]),n._emitToConsole("error","MetricsLogger",[s])}return n},e.prototype._buildEntry=function(e,t,i){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:e,namespace:this.options.clientPrefix+t,args:i};return this.options.addTime&&(n.time=(new Date).toISOString()),n},e.prototype._postCache=function(e){if(e=e||{},this._emitToConsole("info","MetricsLogger",["_postCache",e,this._postSize]),!this.options.postUrl||this._sending)return jQuery.when({});var t=this,i=e.count||t._postSize,n=t.cache.get(i),r=n.length,s="function"==typeof t.options.getPingData?t.options.getPingData():{};return s.metrics=JSON.stringify(n),t._sending=!0,jQuery.post(t.options.postUrl,s).always(function(){t._sending=!1}).fail(function(e,i,n){t._postSize=t.options.maxCacheSize,this.emit("error","MetricsLogger",["_postCache error:",e.readyState,e.status,e.responseJSON||e.responseText])}).done(function(e){"function"==typeof t.options.onServerResponse&&t.options.onServerResponse(e),t.cache.remove(r),t._postSize=t.options.postSize})},e.prototype._delayPost=function(){var e=this;e._waiting=setTimeout(function(){e._waiting=null},e.options.delayPostInMs)},e.prototype._emitToConsole=function(t,i,n){var r=this;if(!r.consoleLogger)return r;var s=Array.prototype.slice.call(n,0);return s.unshift(i),t>=e.METRIC&&"function"==typeof r.consoleLogger.info?r.consoleLogger.info.apply(r.consoleLogger,s):t>=e.ERROR&&"function"==typeof r.consoleLogger.error?r.consoleLogger.error.apply(r.consoleLogger,s):(t>=e.WARN&&"function"==typeof r.consoleLogger.warn?r.consoleLogger.warn.apply(r.consoleLogger,s):t>=e.INFO&&"function"==typeof r.consoleLogger.info?r.consoleLogger.info.apply(r.consoleLogger,s):t>=e.DEBUG&&"function"==typeof r.consoleLogger.debug?r.consoleLogger.debug.apply(r.consoleLogger,s):"function"==typeof r.consoleLogger.log&&r.consoleLogger.log.apply(r.consoleLogger,s),r)},e.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.debug=function(){this.emit(e.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.info=function(){this.emit(e.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.warn=function(){this.emit(e.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.error=function(){this.emit(e.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.metric=function(){this.emit(e.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.defaultOptions={maxSize:5e3},t.prototype._init=function(e){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!e.key)throw new Error("LoggingCache needs key for localStorage");return this.key=e.key,this._initStorage(),this.maxSize=e.maxSize||t.defaultOptions.maxSize,this},t.prototype._hasStorage=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}},t.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},t.prototype.add=function(e){var t=this,i=t._fetchAndParse(),n=i.length+1-t.maxSize;return n>0&&i.splice(0,n),i.push(e),t._unparseAndStore(i),i.length},t.prototype._fetchAndParse=function(){var e=this;return JSON.parse(localStorage.getItem(e.key))},t.prototype._unparseAndStore=function(e){var t=this;return localStorage.setItem(t.key,JSON.stringify(e))},t.prototype.length=function(){return this._fetchAndParse().length},t.prototype.get=function(e){return this._fetchAndParse().slice(0,e)},t.prototype.remove=function(e){var t=this._fetchAndParse(),i=t.splice(0,e);return this._unparseAndStore(t),i},t.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},t.prototype.stringify=function(e){return JSON.stringify(this.get(e))},t.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},{MetricsLogger:e,LoggingCache:t}}.apply(t,n),!(void 0!==r&&(e.exports=r))}]);