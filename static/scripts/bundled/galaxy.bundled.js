webpackJsonp([3],{0:function(t,e,i){var n=i(68).GalaxyApp;window.GalaxyApp=n,console.debug("galaxy.js, GalaxyApp is now in window"),e=n},68:function(t,e,i){var n,a;(function(s){n=[i(3),i(2),i(6),i(60),i(125),i(64),i(5)],a=function(t,e,i,n,a,o,r){function l(t,e){console.debug("GalaxyApp:",t,e);var i=this;return i._init(t||{},e||{})}o(l,"GalaxyApp");var c="galaxy:debug",h=c+":namespaces",d=!1;try{d="true"==localStorage.getItem(c)}catch(u){console.log(r("localStorage not available for debug flag retrieval"))}return l.prototype._init=function(i,n){var a=this;return t.extend(a,e.Events),d&&(a.logger=console),a._processOptions(i),a.debug("GalaxyApp.options: ",a.options),a.root=i.root||"/",a._initConfig(i.config||n.config||{}),a.debug("GalaxyApp.config: ",a.config),a._patchGalaxy(window.Galaxy),a._initLogger(a.options.loggerOptions||{}),a.debug("GalaxyApp.logger: ",a.logger),a._initLocale(),a.debug("GalaxyApp.localize: ",a.localize),a.config=i.config||{},a.debug("GalaxyApp.config: ",a.config),a._initUser(i.user||{}),a.debug("GalaxyApp.user: ",a.user),a._setUpListeners(),a.trigger("ready",a),a},l.prototype.defaultOptions={patchExisting:!0,root:"/"},l.prototype._processOptions=function(t){var e=this,i=e.defaultOptions;e.debug("_processOptions: ",t),e.options={};for(var n in i)i.hasOwnProperty(n)&&(e.options[n]=t.hasOwnProperty(n)?t[n]:i[n]);return e},l.prototype._initConfig=function(t){var e=this;return e.debug("_initConfig: ",t),e.config=t,e.config.debug=d||e.config.debug,e},l.prototype._patchGalaxy=function(t){var e=this;if(e.options.patchExisting&&t){e.debug("found existing Galaxy object:",t);for(var i in t)t.hasOwnProperty(i)&&(e.debug("	 patching in "+i+" to Galaxy"),e[i]=t[i])}},l.prototype._initLogger=function(t){var e=this;if(e.config.debug){t.consoleLogger=t.consoleLogger||console,t.consoleLevel=t.consoleLevel||a.MetricsLogger.ALL;try{t.consoleNamespaceWhitelist=localStorage.getItem(h).split(",")}catch(n){}}return e.debug("_initLogger:",t),e.logger=new a.MetricsLogger(t),e.config.debug&&(i.LoggableMixin.logger=e.logger),e},l.prototype._initLocale=function(t){var e=this;return e.debug("_initLocale:",t),e.localize=r,window._l=e.localize,e},l.prototype._initUser=function(t){var e=this;return e.debug("_initUser:",t),e.user=new n.User(t),e.user.logger=e.logger,e.currUser=e.user,e},l.prototype._setUpListeners=function(){var t=this;return t.lastAjax={},s(document).bind("ajaxSend",function(e,i,n){var a=n.data;try{a=JSON.parse(a)}catch(s){}t.lastAjax={url:location.href.slice(0,-1)+n.url,data:a}}),t},l.prototype.debugging=function(t){var e=this;try{if(void 0===t)return"true"===localStorage.getItem(c);if(t)return localStorage.setItem(c,!0),!0;localStorage.removeItem(c),e.debuggingNamespaces(null)}catch(i){console.log(r("localStorage not available for debug flag retrieval"))}return!1},l.prototype.debuggingNamespaces=function(t){var e=this;try{if(void 0===t){var i=localStorage.getItem(h);return"string"==typeof i?i.split(","):[]}null===t?localStorage.removeItem(h):localStorage.setItem(h,t);var n=e.debuggingNamespaces();return e.logger&&(e.logger.options.consoleNamespaceWhitelist=n),n}catch(a){console.log(r("localStorage not available for debug namespace retrieval"))}},l.prototype.toString=function(){var t=this.user?this.user.get("email")||"(anonymous)":"uninitialized";return"GalaxyApp("+t+")"},{GalaxyApp:l}}.apply(e,n),!(void 0!==a&&(t.exports=a))}).call(e,i(1))},125:function(t,e,i){var n,a;(function(i){n=[],a=function(){function t(t){t=t||{};var e=this;return e.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,e.userId=e.userId||t.userId||null,e.consoleLogger=t.consoleLogger||null,e._init(t),e}function e(t){var e=this;return e._init(t||{})}return t.ALL=0,t.LOG=0,t.DEBUG=10,t.INFO=20,t.WARN=30,t.ERROR=40,t.METRIC=50,t.NONE=100,t.defaultOptions={logLevel:t.NONE,consoleLevel:t.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},t.prototype._init=function(e){var i=this;i.options={};for(var n in t.defaultOptions)t.defaultOptions.hasOwnProperty(n)&&(i.options[n]=e.hasOwnProperty(n)?e[n]:t.defaultOptions[n]);return i.options.logLevel=i._parseLevel(i.options.logLevel),i.options.consoleLevel=i._parseLevel(i.options.consoleLevel),i._sending=!1,i._waiting=null,i._postSize=i.options.postSize,i._initCache(),i},t.prototype._initCache=function(){try{this.cache=new e({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(i){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",i]),this.options.logLevel=t.NONE}},t.prototype._parseLevel=function(e){var i=typeof e;if("number"===i)return e;if("string"===i){var n=e.toUpperCase();if(t.hasOwnProperty(n))return t[n]}throw new Error("Unknown log level: "+e)},t.prototype.emit=function(t,e,i){var n=this;return e=e||n.options.defaultNamespace,t&&i?(t=n._parseLevel(t),t>=n.options.logLevel&&n._addToCache(t,e,i),n.consoleLogger&&t>=n.options.consoleLevel&&n._emitToConsole(t,e,i),n):n},t.prototype._addToCache=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var n=this;try{var a=n.cache.add(n._buildEntry(t,e,i));a>=n._postSize&&n._postCache()}catch(s){n._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",e,i]),n._emitToConsole("error","MetricsLogger",[s])}return n},t.prototype._buildEntry=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:t,namespace:this.options.clientPrefix+e,args:i};return this.options.addTime&&(n.time=(new Date).toISOString()),n},t.prototype._postCache=function(t){if(t=t||{},this._emitToConsole("info","MetricsLogger",["_postCache",t,this._postSize]),!this.options.postUrl||this._sending)return i.when({});var e=this,n=t.count||e._postSize,a=e.cache.get(n),s=a.length,o="function"==typeof e.options.getPingData?e.options.getPingData():{};return o.metrics=JSON.stringify(a),e._sending=!0,i.post(e.options.postUrl,o).always(function(){e._sending=!1}).fail(function(t,i,n){e._postSize=e.options.maxCacheSize,this.emit("error","MetricsLogger",["_postCache error:",t.readyState,t.status,t.responseJSON||t.responseText])}).done(function(t){"function"==typeof e.options.onServerResponse&&e.options.onServerResponse(t),e.cache.remove(s),e._postSize=e.options.postSize})},t.prototype._delayPost=function(){var t=this;t._waiting=setTimeout(function(){t._waiting=null},t.options.delayPostInMs)},t.prototype._emitToConsole=function(e,i,n){var a=this,s=a.options.consoleNamespaceWhitelist;if(!a.consoleLogger)return a;if(s&&-1===s.indexOf(i))return a;var o=Array.prototype.slice.call(n,0);return o.unshift(i),e>=t.METRIC&&"function"==typeof a.consoleLogger.info?a.consoleLogger.info.apply(a.consoleLogger,o):e>=t.ERROR&&"function"==typeof a.consoleLogger.error?a.consoleLogger.error.apply(a.consoleLogger,o):(e>=t.WARN&&"function"==typeof a.consoleLogger.warn?a.consoleLogger.warn.apply(a.consoleLogger,o):e>=t.INFO&&"function"==typeof a.consoleLogger.info?a.consoleLogger.info.apply(a.consoleLogger,o):e>=t.DEBUG&&"function"==typeof a.consoleLogger.debug?a.consoleLogger.debug.apply(a.consoleLogger,o):"function"==typeof a.consoleLogger.log&&a.consoleLogger.log.apply(a.consoleLogger,o),a)},t.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.prototype.debug=function(){this.emit(t.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.prototype.info=function(){this.emit(t.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.prototype.warn=function(){this.emit(t.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.prototype.error=function(){this.emit(t.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.prototype.metric=function(){this.emit(t.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.defaultOptions={maxSize:5e3},e.prototype._init=function(t){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!t.key)throw new Error("LoggingCache needs key for localStorage");return this.key=t.key,this._initStorage(),this.maxSize=t.maxSize||e.defaultOptions.maxSize,this},e.prototype._hasStorage=function(){var t="test";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}},e.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},e.prototype.add=function(t){var e=this,i=e._fetchAndParse(),n=i.length+1-e.maxSize;return n>0&&i.splice(0,n),i.push(t),e._unparseAndStore(i),i.length},e.prototype._fetchAndParse=function(){var t=this;return JSON.parse(localStorage.getItem(t.key))},e.prototype._unparseAndStore=function(t){var e=this;return localStorage.setItem(e.key,JSON.stringify(t))},e.prototype.length=function(){return this._fetchAndParse().length},e.prototype.get=function(t){return this._fetchAndParse().slice(0,t)},e.prototype.remove=function(t){var e=this._fetchAndParse(),i=e.splice(0,t);return this._unparseAndStore(e),i},e.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},e.prototype.stringify=function(t){return JSON.stringify(this.get(t))},e.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},{MetricsLogger:t,LoggingCache:e}}.apply(e,n),!(void 0!==a&&(t.exports=a))}).call(e,i(1))}});
//# sourceMappingURL=galaxy.bundled.js.map