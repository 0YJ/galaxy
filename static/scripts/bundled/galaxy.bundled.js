webpackJsonp([5],{0:function(e,t,o){var n=o(117).GalaxyApp;window.GalaxyApp=n,t=n},65:function(e,t,o){var n,i;n=[o(3),o(2),o(6),o(5)],i=function(e,t,o,n){var i="user",r=t.Model.extend(o.LoggableMixin).extend({_logNamespace:i,urlRoot:function(){return Galaxy.root+"api/users"},defaults:{id:null,username:"("+n("anonymous user")+")",email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1},initialize:function(e){this.log("User.initialize:",e),this.on("loaded",function(e,t){this.log(this+" has loaded:",e,t)}),this.on("change",function(e,t){this.log(this+" has changed:",e,t.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},loadFromApi:function(e,o){e=e||r.CURRENT_ID_STR,o=o||{};var n=this,i=o.success;return o.success=function(e,t){n.trigger("loaded",e,t),i&&i(e,t)},e===r.CURRENT_ID_STR&&(o.url=this.urlRoot+"/"+r.CURRENT_ID_STR),t.Model.prototype.fetch.call(this,o)},clearSessionStorage:function(){for(var e in sessionStorage)0===e.indexOf("history:")?sessionStorage.removeItem(e):"history-panel"===e&&sessionStorage.removeItem(e)},toString:function(){var e=[this.get("username")];return this.get("id")&&(e.unshift(this.get("id")),e.push(this.get("email"))),"User("+e.join(":")+")"}});r.CURRENT_ID_STR="current",r.getCurrentUserFromApi=function(e){var t=new r;return t.loadFromApi(r.CURRENT_ID_STR,e),t};t.Collection.extend(o.LoggableMixin).extend({model:r,urlRoot:function(){return Galaxy.root+"api/users"}});return{User:r}}.apply(t,n),!(void 0!==i&&(e.exports=i))},117:function(e,t,o){var n,i;(function(r){n=[o(3),o(2),o(6),o(65),o(146),o(111),o(5)],i=function(e,t,o,n,i,s,a){function l(e,t){var o=this;return o._init(e||{},t||{})}s(l,"GalaxyApp");var c="galaxy:debug",p=c+":namespaces",g=!1;try{g="true"==localStorage.getItem(c)}catch(u){console.log(a("localStorage not available for debug flag retrieval"))}return l.prototype._init=function(o,n){var i=this;return e.extend(i,t.Events),g&&(i.logger=console,console.debug("debugging galaxy:","options:",o,"bootstrapped:",n)),i._processOptions(o),i.root=o.root||"/",i._initConfig(o.config||n.config||{}),i._patchGalaxy(window.Galaxy),i._initLogger(i.options.loggerOptions||{}),i.debug("GalaxyApp.options: ",i.options),i.debug("GalaxyApp.config: ",i.config),i.debug("GalaxyApp.logger: ",i.logger),i._initLocale(),i.debug("GalaxyApp.localize: ",i.localize),i.config=o.config||{},i.debug("GalaxyApp.config: ",i.config),i._initUser(o.user||{}),i.debug("GalaxyApp.user: ",i.user),i._setUpListeners(),i.trigger("ready",i),i},l.prototype.defaultOptions={patchExisting:!0,root:"/"},l.prototype._processOptions=function(e){var t=this,o=t.defaultOptions;t.options={};for(var n in o)o.hasOwnProperty(n)&&(t.options[n]=e.hasOwnProperty(n)?e[n]:o[n]);return t},l.prototype._initConfig=function(e){var t=this;return t.config=e,t.config.debug=g||t.config.debug,t},l.prototype._patchGalaxy=function(e){var t=this;if(t.options.patchExisting&&e)for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},l.prototype._initLogger=function(e){var t=this;if(t.config.debug){e.consoleLogger=e.consoleLogger||console,e.consoleLevel=e.consoleLevel||i.MetricsLogger.ALL;try{e.consoleNamespaceWhitelist=localStorage.getItem(p).split(",")}catch(n){}}return t.logger=new i.MetricsLogger(e),t.emit={},["log","debug","info","warn","error","metric"].map(function(e){t.emit[e]=function(o){t.logger.emit(e,arguments[0],Array.prototype.slice.call(arguments,1))}}),t.config.debug&&(o.LoggableMixin.logger=t.logger),t},l.prototype._initLocale=function(e){var t=this;return t.debug("_initLocale:",e),t.localize=a,window._l=t.localize,t},l.prototype._initUser=function(e){var t=this;return t.debug("_initUser:",e),t.user=new n.User(e),t.user.logger=t.logger,t},l.prototype._setUpListeners=function(){var e=this;return e.lastAjax={},r(document).bind("ajaxSend",function(t,o,n){var i=n.data;try{i=JSON.parse(i)}catch(r){}e.lastAjax={url:location.href.slice(0,-1)+n.url,data:i}}),e},l.prototype.debugging=function(e){var t=this;try{if(void 0===e)return"true"===localStorage.getItem(c);if(e)return localStorage.setItem(c,!0),!0;localStorage.removeItem(c),t.debuggingNamespaces(null)}catch(o){console.log(a("localStorage not available for debug flag retrieval"))}return!1},l.prototype.debuggingNamespaces=function(e){var t=this;try{if(void 0===e){var o=localStorage.getItem(p);return"string"==typeof o?o.split(","):[]}null===e?localStorage.removeItem(p):localStorage.setItem(p,e);var n=t.debuggingNamespaces();return t.logger&&(t.logger.options.consoleNamespaceWhitelist=n),n}catch(i){console.log(a("localStorage not available for debug namespace retrieval"))}},l.prototype.toString=function(){var e=this.user?this.user.get("email")||"(anonymous)":"uninitialized";return"GalaxyApp("+e+")"},{GalaxyApp:l}}.apply(t,n),!(void 0!==i&&(e.exports=i))}).call(t,o(1))},146:function(e,t,o){var n,i;(function(o){n=[],i=function(){function e(e){e=e||{};var t=this;return t.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,t.userId=t.userId||e.userId||null,t.consoleLogger=e.consoleLogger||null,t._init(e),t}function t(e){var t=this;return t._init(e||{})}return e.ALL=0,e.LOG=0,e.DEBUG=10,e.INFO=20,e.WARN=30,e.ERROR=40,e.METRIC=50,e.NONE=100,e.defaultOptions={logLevel:e.NONE,consoleLevel:e.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},e.prototype._init=function(t){var o=this;o.options={};for(var n in e.defaultOptions)e.defaultOptions.hasOwnProperty(n)&&(o.options[n]=t.hasOwnProperty(n)?t[n]:e.defaultOptions[n]);return o.options.logLevel=o._parseLevel(o.options.logLevel),o.options.consoleLevel=o._parseLevel(o.options.consoleLevel),o._sending=!1,o._waiting=null,o._postSize=o.options.postSize,o._initCache(),o},e.prototype._initCache=function(){try{this.cache=new t({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(o){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",o]),this.options.logLevel=e.NONE}},e.prototype._parseLevel=function(t){var o=typeof t;if("number"===o)return t;if("string"===o){var n=t.toUpperCase();if(e.hasOwnProperty(n))return e[n]}throw new Error("Unknown log level: "+t)},e.prototype.emit=function(e,t,o){var n=this;return t=t||n.options.defaultNamespace,e&&o?(e=n._parseLevel(e),e>=n.options.logLevel&&n._addToCache(e,t,o),n.consoleLogger&&e>=n.options.consoleLevel&&n._emitToConsole(e,t,o),n):n},e.prototype._addToCache=function(e,t,o){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var n=this;try{var i=n.cache.add(n._buildEntry(e,t,o));i>=n._postSize&&n._postCache()}catch(r){n._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",t,o]),n._emitToConsole("error","MetricsLogger",[r])}return n},e.prototype._buildEntry=function(e,t,o){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:e,namespace:this.options.clientPrefix+t,args:o};return this.options.addTime&&(n.time=(new Date).toISOString()),n},e.prototype._postCache=function(e){if(e=e||{},this._emitToConsole("info","MetricsLogger",["_postCache",e,this._postSize]),!this.options.postUrl||this._sending)return o.when({});var t=this,n=e.count||t._postSize,i=t.cache.get(n),r=i.length,s="function"==typeof t.options.getPingData?t.options.getPingData():{};return s.metrics=JSON.stringify(i),t._sending=!0,o.post(t.options.postUrl,s).always(function(){t._sending=!1}).fail(function(e,o,n){t._postSize=t.options.maxCacheSize,this.emit("error","MetricsLogger",["_postCache error:",e.readyState,e.status,e.responseJSON||e.responseText])}).done(function(e){"function"==typeof t.options.onServerResponse&&t.options.onServerResponse(e),t.cache.remove(r),t._postSize=t.options.postSize})},e.prototype._delayPost=function(){var e=this;e._waiting=setTimeout(function(){e._waiting=null},e.options.delayPostInMs)},e.prototype._emitToConsole=function(t,o,n){var i=this,r=i.options.consoleNamespaceWhitelist;if(!i.consoleLogger)return i;if(r&&-1===r.indexOf(o))return i;var s=Array.prototype.slice.call(n,0);return s.unshift(o),t>=e.METRIC&&"function"==typeof i.consoleLogger.info?i.consoleLogger.info.apply(i.consoleLogger,s):t>=e.ERROR&&"function"==typeof i.consoleLogger.error?i.consoleLogger.error.apply(i.consoleLogger,s):(t>=e.WARN&&"function"==typeof i.consoleLogger.warn?i.consoleLogger.warn.apply(i.consoleLogger,s):t>=e.INFO&&"function"==typeof i.consoleLogger.info?i.consoleLogger.info.apply(i.consoleLogger,s):t>=e.DEBUG&&"function"==typeof i.consoleLogger.debug?i.consoleLogger.debug.apply(i.consoleLogger,s):"function"==typeof i.consoleLogger.log&&i.consoleLogger.log.apply(i.consoleLogger,s),i)},e.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.debug=function(){this.emit(e.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.info=function(){this.emit(e.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.warn=function(){this.emit(e.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.error=function(){this.emit(e.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},e.prototype.metric=function(){this.emit(e.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},t.defaultOptions={maxSize:5e3},t.prototype._init=function(e){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!e.key)throw new Error("LoggingCache needs key for localStorage");return this.key=e.key,this._initStorage(),this.maxSize=e.maxSize||t.defaultOptions.maxSize,this},t.prototype._hasStorage=function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}},t.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},t.prototype.add=function(e){var t=this,o=t._fetchAndParse(),n=o.length+1-t.maxSize;return n>0&&o.splice(0,n),o.push(e),t._unparseAndStore(o),o.length},t.prototype._fetchAndParse=function(){var e=this;return JSON.parse(localStorage.getItem(e.key))},t.prototype._unparseAndStore=function(e){var t=this;return localStorage.setItem(t.key,JSON.stringify(e))},t.prototype.length=function(){return this._fetchAndParse().length},t.prototype.get=function(e){return this._fetchAndParse().slice(0,e)},t.prototype.remove=function(e){var t=this._fetchAndParse(),o=t.splice(0,e);return this._unparseAndStore(t),o},t.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},t.prototype.stringify=function(e){return JSON.stringify(this.get(e))},t.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},{MetricsLogger:e,LoggingCache:t}}.apply(t,n),!(void 0!==i&&(e.exports=i))}).call(t,o(1))}});
//# sourceMappingURL=galaxy.bundled.js.map