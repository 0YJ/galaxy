define(["libs/underscore"],function(t){var s=t.extend,e=function(t,s){this.slot=t,this.feature=s},r=function(t,s,e,r){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=s,this.include_label="Pack"===s,this.max_rows=e,this.measureText=r};return s(r.prototype,{_get_draw_coords:function(t){var s=Math.floor(t[1]*this.w_scale),e=Math.ceil(t[2]*this.w_scale),r=t[3];if(void 0!==r&&this.include_label){var i=this.measureText(r).width+7;s-i>=0?(s-=i,"left"):(e+=i,"right")}return[s,e]},_find_slot:function(t){for(var s=t[0],e=t[1],r=0;r<=this.max_rows;r++){var i=!1,a=this.start_end_dct[r];if(void 0!==a)for(var o=0,h=a.length;o<h;o++){var n=a[o];if(e>n[0]&&s<n[1]){i=!0;break}}if(!i)return r}return-1},slot_features:function(t){for(var s,r,i=this.start_end_dct,a=[],o=0,h=0,n=t.length;h<n;h++){s=t[h],r=s[0];var _=this.slots[r];if(_){if(s[1]<_.feature[1]||_.feature[2]<s[2])for(var l=this._get_draw_coords(_.feature),d=this._get_draw_coords(s),f=this.start_end_dct[_.slot],u=0;u<f.length;u++){var c=f[u];c[0]===l[0]&&c[1]===l[1]&&(f[u]=d)}o=Math.max(o,this.slots[r].slot)}else a.push(h)}for(var h=0,n=a.length;h<n;h++){s=t[a[h]],r=s[0];var v=this._get_draw_coords(s),w=this._find_slot(v);w>=0&&(void 0===i[w]&&(i[w]=[]),i[w].push(v),this.slots[r]=new e(w,s),o=Math.max(o,w))}return o+1}}),{FeatureSlotter:r}});
//# sourceMappingURL=../../../maps/viz/trackster/slotting.js.map
