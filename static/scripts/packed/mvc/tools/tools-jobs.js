define(["utils/utils","mvc/tools/tools-template"],function(b,a){return{submit:function(f,d,g){var c=this;var e={tool_id:d.id,tool_version:d.version,inputs:f.data.create()};f.trigger("reset");if(!this._validation(f,e)){console.debug("tools-jobs::submit - Submission canceled. Validation failed.");g&&g();return}console.debug(e);b.request({type:"POST",url:galaxy_config.root+"api/tools",data:e,success:function(h){g&&g();f.reciept(a.success(h));c._refreshHdas()},error:function(h,j){g&&g();if(h&&h.message&&h.message.data){var k=f.data.matchResponse(h.message.data);for(var i in k){f.highlight(i,k[i]);break}}else{console.debug(h);h&&f.modal.show({title:"Job submission failed",body:a.error(e),buttons:{Close:function(){f.modal.hide()}}})}}})},_validation:function(e,i){var f=i.inputs;var o=-1;var j=null;for(var l in f){var g=f[l];var m=e.data.match(l);var d=e.field_list[m];var k=e.input_list[m];if(!m||!k||!d){console.debug("tools-jobs::_validation - Retrieving input objects failed.");continue}if(!k.optional&&g==null){e.highlight(m);return false}if(g&&g.batch){var h=g.values.length;var c=null;if(h>0){c=g.values[0]&&g.values[0].src}if(c){if(j===null){j=c}else{if(j!==c){e.highlight(m,"Please select either dataset or dataset list fields for all batch mode fields.");return false}}}if(o===-1){o=h}else{if(o!==h){e.highlight(m,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+h+"</b> selection(s) while a previous field contains <b>"+o+"</b>.");return false}}}}return true},_refreshHdas:function(){if(parent.Galaxy&&parent.Galaxy.currHistoryPanel){parent.Galaxy.currHistoryPanel.refreshContents()}}}});