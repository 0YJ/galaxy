define(["utils/utils"],function(a){return Backbone.Model.extend({initialize:function(b){this.app=b},checksum:function(){var c="";for(var b in this.app.field_list){var d=this.app.field_list[b];c+=JSON.stringify(d.value&&d.value())}return c},create:function(){var b=this;var f={};this._iterate(this.app.section.$el,f);var e={};this.map_dict={};function d(i,h,g){b.map_dict[i]=h;e[i]=g}function c(o,r){for(var m in r){var j=r[m];if(j.input){var t=j.input;var n=o;if(o!=""){n+="|"}n+=t.name;switch(t.type){case"repeat":var h="section-";var w=[];var q=null;for(var v in j){var p=v.indexOf(h);if(p!=-1){p+=h.length;w.push(parseInt(v.substr(p)));if(!q){q=v.substr(0,p)}}}w.sort(function(x,i){return x-i});var m=0;for(var k in w){c(n+"_"+m++,j[q+w[k]])}break;case"conditional":var u=b.app.field_list[t.id].value();d(n+"|"+t.test_param.name,t.id,u);var g=b.matchCase(t,u);if(g!=-1){c(n,r[t.id+"-section-"+g])}break;case"section":c("",j);break;default:var s=b.app.field_list[t.id];if(s&&s.value){var u=s.value();if(t.ignore===undefined||t.ignore!=u){d(n,t.id,u);if(t.payload){for(var l in t.payload){d(l,t.id,t.payload[l])}}}}}}}}c("",f);return e},match:function(b){return this.map_dict&&this.map_dict[b]},matchCase:function(b,d){if(b.test_param.type=="boolean"){if(d=="true"){d=b.test_param.truevalue||"true"}else{d=b.test_param.falsevalue||"false"}}for(var c in b.cases){if(b.cases[c].value==d){return c}}return -1},matchModel:function(d,f){var b={};var c=this;function e(g,p){for(var m in p){var k=p[m];var n=k.name;if(g!=""){n=g+"|"+n}switch(k.type){case"repeat":for(var l in k.cache){e(n+"_"+l,k.cache[l])}break;case"conditional":var q=k.test_param&&k.test_param.value;var h=c.matchCase(k,q);if(h!=-1){e(n,k.cases[h].inputs)}break;default:var o=c.map_dict[n];if(o){f(o,k)}}}}e("",d.inputs);return b},matchResponse:function(d){var b={};var c=this;function e(l,j){if(typeof j==="string"){var g=c.map_dict[l];if(g){b[g]=j}}else{for(var h in j){var f=h;if(l!==""){var k="|";if(j instanceof Array){k="_"}f=l+k+f}e(f,j[h])}}}e("",d);return b},_iterate:function(d,e){var b=this;var c=$(d).children();c.each(function(){var h=this;var g=$(h).attr("id");if($(h).hasClass("section-row")){e[g]={};var f=b.app.input_list[g];if(f){e[g]={input:f}}b._iterate(h,e[g])}else{b._iterate(h,e)}})}})});