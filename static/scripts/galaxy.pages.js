"use strict";function init_galaxy_elts(e){$(".annotation",e._doc.body).each(function(){$(this).click(function(){var t=e._doc.createRange();t.selectNodeContents(this);var a=window.getSelection();a.removeAllRanges(),a.addRange(t)})})}function get_item_info(e){var t,a,i;switch(e){case CONTROLS.ITEM_HISTORY:t="History",a="Histories",i="history",item_class="History";break;case CONTROLS.ITEM_DATASET:t="Dataset",a="Datasets",i="dataset",item_class="HistoryDatasetAssociation";break;case CONTROLS.ITEM_WORKFLOW:t="Workflow",a="Workflows",i="workflow",item_class="StoredWorkflow";break;case CONTROLS.ITEM_PAGE:t="Page",a="Pages",i="page",item_class="Page";break;case CONTROLS.ITEM_VISUALIZATION:t="Visualization",a="Visualizations",i="visualization",item_class="Visualization"}var o="list_"+a.toLowerCase()+"_for_selection",l=list_objects_url.replace("LIST_ACTION",o);return{singular:t,plural:a,controller:i,iclass:item_class,list_ajax_url:l}}function make_item_importable(e,t,a){ajax_url=set_accessible_url.replace("ITEM_CONTROLLER",e),$.ajax({type:"POST",url:ajax_url,data:{id:t,accessible:"True"},error:function(){alert("Making "+a+" accessible failed")}})}var CONTROLS={ITEM_HISTORY:"item_history",ITEM_DATASET:"item_dataset",ITEM_WORKFLOW:"item_workflow",ITEM_PAGE:"item_page",ITEM_VISUALIZATION:"item_visualization",DIALOG_HISTORY_LINK:"link_history",DIALOG_DATASET_LINK:"link_dataset",DIALOG_WORKFLOW_LINK:"link_workflow",DIALOG_PAGE_LINK:"link_page",DIALOG_VISUALIZATION_LINK:"link_visualization",DIALOG_EMBED_HISTORY:"embed_history",DIALOG_EMBED_DATASET:"embed_dataset",DIALOG_EMBED_WORKFLOW:"embed_workflow",DIALOG_EMBED_PAGE:"embed_page",DIALOG_EMBED_VISUALIZATION:"embed_visualization"};WYMeditor.editor.prototype.dialog=function(e,t,a){function i(){$("#set_link_id").click(function(){$("#link_attribute_label").text("ID/Name");var e=$(".wym_href");e.addClass("wym_id").removeClass("wym_href"),r&&e.val($(r).attr("id")),$(this).remove()})}var o=this,l=o.uniqueStamp(),r=o.selected();if(e==WYMeditor.DIALOG_LINK){r&&($(o._options.hrefSelector).val($(r).attr(WYMeditor.HREF)),$(o._options.srcSelector).val($(r).attr(WYMeditor.SRC)),$(o._options.titleSelector).val($(r).attr(WYMeditor.TITLE)),$(o._options.altSelector).val($(r).attr(WYMeditor.ALT)));var s,n;r&&(s=$(r).attr("href"),void 0==s&&(s=""),void 0==(n=$(r).attr("title"))&&(n="")),show_modal("Create Link","<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='"+s+"' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='"+n+"' size='40' /></div><div>",{"Make link":function(){var e=$(o._options.hrefSelector).val()||"",t=$(".wym_id").val()||"",a=$(o._options.titleSelector).val()||"";if(e||t){o._exec(WYMeditor.CREATE_LINK,l);var i=$("a[href="+l+"]",o._doc.body);i.attr(WYMeditor.HREF,e).attr(WYMeditor.TITLE,a).attr("id",t),0===i.text().indexOf("wym-")&&i.text(a)}hide_modal()},Cancel:function(){hide_modal()}},{},i)}if(e==WYMeditor.DIALOG_IMAGE)return o._selected_image&&($(o._options.dialogImageSelector+" "+o._options.srcSelector).val($(o._selected_image).attr(WYMeditor.SRC)),$(o._options.dialogImageSelector+" "+o._options.titleSelector).val($(o._selected_image).attr(WYMeditor.TITLE)),$(o._options.dialogImageSelector+" "+o._options.altSelector).val($(o._selected_image).attr(WYMeditor.ALT))),void show_modal("Image","<div class='row'><label>URL</label><br><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>Alt text</label><br><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>Title</label><br><input type='text' class='wym_title' value='' size='40' /></div>",{Insert:function(){var e=$(o._options.srcSelector).val();e.length>0&&(o._exec(WYMeditor.INSERT_IMAGE,l),$("img[src$="+l+"]",o._doc.body).attr(WYMeditor.SRC,e).attr(WYMeditor.TITLE,$(o._options.titleSelector).val()).attr(WYMeditor.ALT,$(o._options.altSelector).val())),hide_modal()},Cancel:function(){hide_modal()}});if(e==WYMeditor.DIALOG_TABLE&&show_modal("Table","<div class='row'><label>Caption</label><br><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>Summary</label><br><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>Number Of Rows<br></label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>Number Of Cols<br></label><input type='text' class='wym_cols' value='2' size='3' /></div>",{Insert:function(){var e=$(o._options.rowsSelector).val(),t=$(o._options.colsSelector).val();if(e>0&&t>0){var a=o._doc.createElement(WYMeditor.TABLE),i=null,l=$(o._options.captionSelector).val(),r=a.createCaption();for(r.innerHTML=l,x=0;x<e;x++)for(i=a.insertRow(x),y=0;y<t;y++)i.insertCell(y);$(a).attr("summary",$(o._options.summarySelector).val());var s=$(o.findUp(o.container(),WYMeditor.MAIN_CONTAINERS)).get(0);s&&s.parentNode?$(s).after(a):$(o._doc.body).append(a)}hide_modal()},Cancel:function(){hide_modal()}}),e==CONTROLS.DIALOG_HISTORY_LINK||e==CONTROLS.DIALOG_DATASET_LINK||e==CONTROLS.DIALOG_WORKFLOW_LINK||e==CONTROLS.DIALOG_PAGE_LINK||e==CONTROLS.DIALOG_VISUALIZATION_LINK){var _;switch(e){case CONTROLS.DIALOG_HISTORY_LINK:_=get_item_info(CONTROLS.ITEM_HISTORY);break;case CONTROLS.DIALOG_DATASET_LINK:_=get_item_info(CONTROLS.ITEM_DATASET);break;case CONTROLS.DIALOG_WORKFLOW_LINK:_=get_item_info(CONTROLS.ITEM_WORKFLOW);break;case CONTROLS.DIALOG_PAGE_LINK:_=get_item_info(CONTROLS.ITEM_PAGE);break;case CONTROLS.DIALOG_VISUALIZATION_LINK:_=get_item_info(CONTROLS.ITEM_VISUALIZATION)}$.ajax({url:_.list_ajax_url,data:{},error:function(){alert("Failed to list "+_.plural.toLowerCase()+" for selection")},success:function(e){show_modal("Insert Link to "+_.singular,e+"<div><input id='make-importable' type='checkbox' checked/>Make the selected "+_.plural.toLowerCase()+" accessible so that they can viewed by everyone.</div>",{Insert:function(){var e=!1;null!==$("#make-importable:checked").val()&&(e=!0);new Array;$("input[name=id]:checked").each(function(){var t=$(this).val();e&&make_item_importable(_.controller,t,_.singular),url_template=get_name_and_link_url+t,ajax_url=url_template.replace("ITEM_CONTROLLER",_.controller),$.getJSON(ajax_url,function(e){o._exec(WYMeditor.CREATE_LINK,l);var a=$("a[href="+l+"]",o._doc.body).text();""==a||a==l?o.insert("<a href='"+e.link+"'>"+_.singular+" '"+e.name+"'</a>"):$("a[href="+l+"]",o._doc.body).attr(WYMeditor.HREF,e.link).attr(WYMeditor.TITLE,_.singular+t)})}),hide_modal()},Cancel:function(){hide_modal()}})}})}if(e==CONTROLS.DIALOG_EMBED_HISTORY||e==CONTROLS.DIALOG_EMBED_DATASET||e==CONTROLS.DIALOG_EMBED_WORKFLOW||e==CONTROLS.DIALOG_EMBED_PAGE||e==CONTROLS.DIALOG_EMBED_VISUALIZATION){var _;switch(e){case CONTROLS.DIALOG_EMBED_HISTORY:_=get_item_info(CONTROLS.ITEM_HISTORY);break;case CONTROLS.DIALOG_EMBED_DATASET:_=get_item_info(CONTROLS.ITEM_DATASET);break;case CONTROLS.DIALOG_EMBED_WORKFLOW:_=get_item_info(CONTROLS.ITEM_WORKFLOW);break;case CONTROLS.DIALOG_EMBED_PAGE:_=get_item_info(CONTROLS.ITEM_PAGE);break;case CONTROLS.DIALOG_EMBED_VISUALIZATION:_=get_item_info(CONTROLS.ITEM_VISUALIZATION)}$.ajax({url:_.list_ajax_url,data:{},error:function(){alert("Failed to list "+_.plural.toLowerCase()+" for selection")},success:function(t){e!=CONTROLS.DIALOG_EMBED_HISTORY&&e!=CONTROLS.DIALOG_EMBED_WORKFLOW&&e!=CONTROLS.DIALOG_EMBED_VISUALIZATION||(t=t+"<div><input id='make-importable' type='checkbox' checked/>Make the selected "+_.plural.toLowerCase()+" accessible so that they can viewed by everyone.</div>"),show_modal("Embed "+_.plural,t,{Embed:function(){var e=!1;null!=$("#make-importable:checked").val()&&(e=!0),$("input[name=id]:checked").each(function(){var t=$(this).val(),a=$("label[for='"+t+"']:first").text();e&&make_item_importable(_.controller,t,_.singular);var i=_.iclass+"-"+t,l=["<div id='",i,"' class='embedded-item ",_.singular.toLowerCase()," placeholder'>","<p class='title'>","Embedded Galaxy ",_.singular," '",a,"'","</p>","<p class='content'>","[Do not edit this block; Galaxy will fill it in with the annotated ",_.singular.toLowerCase()," when it is displayed.]","</p>","</div>"].join("");o.insert(l)}),hide_modal()},Cancel:function(){hide_modal()}})}})}},$(function(){$(document).ajaxError(function(e,t){var a=t.responseText||t.statusText||"Could not connect to server";return show_modal("Server error",a,{"Ignore error":hide_modal}),!1}),$("[name=page_content]").wymeditor({skin:"galaxy",basePath:editor_base_path,iframeBasePath:iframe_base_path,boxHtml:"<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>"+WYMeditor.IFRAME+WYMeditor.STATUS+"</div></div></td></tr></table>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"}]});var e=$.wymeditors(0),t=function(t){show_modal("Saving page","progress"),$.ajax({url:save_url,type:"POST",data:{id:page_id,content:e.xhtml(),annotations:JSON.stringify(new Object),_:"true"},success:function(){t()}})};$("#save-button").click(function(){t(function(){hide_modal()})}),$("#close-button").click(function(){window.document.location=page_list_url});var a=$("<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>");$(".wym_area_top").append(a);var i={};$.each(e._options.containersItems,function(t,a){var o=a.name;i[a.title.replace("_"," ")]=function(){e.container(o)}}),make_popupmenu(a,i);var o=$("<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>").addClass("galaxy-page-editor-button");$(".wym_area_top").append(o),make_popupmenu(o,{"Insert History Link":function(){e.dialog(CONTROLS.DIALOG_HISTORY_LINK)},"Insert Dataset Link":function(){e.dialog(CONTROLS.DIALOG_DATASET_LINK)},"Insert Workflow Link":function(){e.dialog(CONTROLS.DIALOG_WORKFLOW_LINK)},"Insert Page Link":function(){e.dialog(CONTROLS.DIALOG_PAGE_LINK)},"Insert Visualization Link":function(){e.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK)}});var l=$("<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>").addClass("galaxy-page-editor-button");$(".wym_area_top").append(l),make_popupmenu(l,{"Embed History":function(){e.dialog(CONTROLS.DIALOG_EMBED_HISTORY)},"Embed Dataset":function(){e.dialog(CONTROLS.DIALOG_EMBED_DATASET)},"Embed Workflow":function(){e.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW)},"Embed Visualization":function(){e.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION)}})});
//# sourceMappingURL=../maps/galaxy.pages.js.map
