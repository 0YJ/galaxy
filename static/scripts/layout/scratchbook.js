define(["mvc/ui/ui-frames"],function(a){return Backbone.View.extend({initialize:function(b){var c=this;b=b||{},this.frames=new a.View({visible:!1}),this.setElement(this.frames.$el),this.buttonActive=b.collection.add({id:"enable-scratchbook",icon:"fa-th",tooltip:"Enable/Disable Scratchbook",onclick:function(){c.active=!c.active,c.buttonActive.set({toggle:c.active,show_note:c.active,note_cls:c.active&&"fa fa-check"}),!c.active&&c.frames.hide()},onbeforeunload:function(){return c.frames.length()>0?"You opened "+c.frames.length()+" frame(s) which will be lost.":void 0}}),this.buttonLoad=b.collection.add({id:"show-scratchbook",icon:"fa-eye",tooltip:"Show/Hide Scratchbook",show_note:!0,visible:!1,onclick:function(){c.frames.visible?c.frames.hide():c.frames.show()}}),this.frames.on("add remove",function(){this.visible&&0==this.length()&&this.hide(),c.buttonLoad.set({note:this.length(),visible:this.length()>0})}).on("show hide ",function(){c.buttonLoad.set({toggle:this.visible,icon:this.visible&&"fa-eye"||"fa-eye-slash"})})},addDataset:function(a){var b=this;this.dataset_list=[],Galaxy.currHistoryPanel.collection.find(function(a){!a.get("deleted")&&b.dataset_list.push(a.get("id"))});var c=function(c,d){var e=b.dataset_list.indexOf(a);-1!==e&&b.dataset_list[e+d]&&b._loadDataset(a=b.dataset_list[e+d],function(a){c.model.set(a)})};this._loadDataset(a,function(d){b.add(_.extend({menu:[{icon:"fa fa-chevron-circle-left",tooltip:"Previous in History",onclick:function(a){c(a,-1)},disabled:function(){return 0===b.dataset_list.indexOf(a)}},{icon:"fa fa-chevron-circle-right",tooltip:"Next in History",onclick:function(a){c(a,1)},disabled:function(){return b.dataset_list.indexOf(a)+1>=b.dataset_list.length}}]},d))})},_loadDataset:function(a,b){require(["mvc/dataset/data"],function(c){var d=new c.Dataset({id:a});$.when(d.fetch()).then(function(){var a=_.find(["tabular","interval"],function(a){return-1!==d.get("data_type").indexOf(a)});b(a?{title:d.get("name"),url:null,content:c.createTabularDatasetChunkedView({model:new c.TabularDataset(d.toJSON()),embedded:!0,height:"100%"}).$el}:{title:d.get("name"),url:Galaxy.root+"datasets/"+d.id+"/display/?preview=True",content:null})})})},addTrackster:function(a){var b=this;require(["viz/visualization","viz/trackster"],function(c,d){var e=new c.Visualization({id:a});$.when(e.fetch()).then(function(){var a=new d.TracksterUI(Galaxy.root),c={title:e.get("name"),type:"other",content:function(b){var c={container:b,name:e.get("title"),id:e.id,dbkey:e.get("dbkey"),stand_alone:!1},d=e.get("latest_revision"),f=d.config.view.drawables;_.each(f,function(a){a.dataset={hda_ldda:a.hda_ldda,id:a.dataset_id}}),view=a.create_visualization(c,d.config.viewport,d.config.view.drawables,d.config.bookmarks,!1)}};b.add(c)})})},add:function(a){if("_blank"==a.target)window.open(a.url);else if("_top"==a.target||"_parent"==a.target||"_self"==a.target)window.location=a.url;else if(this.active)this.frames.add(a);else{var b=$(window.parent.document).find("#galaxy_main");"galaxy_main"==a.target||"center"==a.target?0===b.length?window.location=a.url+(-1==href.indexOf("?")?"?":"&")+"use_panels=True":b.attr("src",a.url):window.location=a.url}}})});
//# sourceMappingURL=../../maps/layout/scratchbook.js.map