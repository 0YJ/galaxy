"use strict";define(["libs/underscore","viz/trackster/util","utils/config"],function(e,t,l){var o=Backbone.Model.extend({initialize:function(l){var i=this.get("key");this.set("id",i);var a=e.find(o.known_settings_defaults,function(e){return e.key===i});a&&this.set(e.extend({},a,l)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",t.get_random_color()))},set_value:function(e,t){var l=this.get("type");"float"===l?e=parseFloat(e):"int"===l&&(e=parseInt(e,10)),this.set({value:e},t)}},{known_settings_defaults:[{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0}]}),i=Backbone.Collection.extend({model:o,to_key_value_dict:function(){var e={};return this.each(function(t){e[t.get("key")]=t.get("value")}),e},get_value:function(e){var t=this.get(e);if(t)return t.get("value")},set_value:function(e,t,l){var o=this.get(e);if(o)return o.set_value(t,l)},set_default_value:function(e,t){var l=this.get(e);if(l)return l.set("default_value",t)}},{from_models_and_saved_values:function(t,l){return l&&(t=e.map(t,function(t){return e.extend({},t,{value:l[t.key]})})),new i(t)}}),a=Backbone.View.extend({className:"config-settings-view",render:function(){var l=this.$el;return this.collection.each(function(o,i){if(!o.get("hidden")){var a="param_"+i,n=o.get("type"),s=o.get("value"),r=$("<div class='form-row' />").appendTo(l);if(r.append($("<label />").attr("for",a).text(o.get("label")+":")),"bool"===n)r.append($('<input type="checkbox" />').attr("id",a).attr("name",a).attr("checked",s));else if("text"===n)r.append($('<input type="text"/>').attr("id",a).val(s).click(function(){$(this).select()}));else if("select"===n){var c=$("<select />").attr("id",a);e.each(o.get("options"),function(e){$("<option/>").text(e.label).attr("value",e.value).appendTo(c)}),c.val(s),r.append(c)}else if("color"===n){var d=$("<div/>").appendTo(r),u=$("<input />").attr("id",a).attr("name",a).val(s).css("float","left").appendTo(d).click(function(e){$(".tooltip").removeClass("in");var t=$(this).siblings(".tooltip").addClass("in");t.css({left:$(this).position().left+$(this).width()+5,top:$(this).position().top-$(t).height()/2+$(this).height()/2}).show(),t.click(function(e){e.stopPropagation()}),$(document).bind("click.color-picker",function(){t.hide(),$(document).unbind("click.color-picker")}),e.stopPropagation()}),p=$("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(d).attr("title","Set new random color").tooltip(),f=$("<div class='tooltip right' style='position: absolute;' />").appendTo(d).hide(),h=$("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(f),v=($("<div class='tooltip-arrow'></div>").appendTo(f),$.farbtastic(h,{width:100,height:100,callback:u,color:s}));d.append($("<div/>").css("clear","both")),function(e){p.click(function(){e.setColor(t.get_random_color())})}(v)}else r.append($("<input />").attr("id",a).attr("name",a).val(s));o.help&&r.append($("<div class='help'/>").text(o.help))}}),this},render_in_modal:function(e){var t=this,l=function(){Galaxy.modal.hide(),$(window).unbind("keypress.check_enter_esc")},o=function(){Galaxy.modal.hide(),$(window).unbind("keypress.check_enter_esc"),t.update_from_form()};$(window).bind("keypress.check_enter_esc",function(e){27===(e.keyCode||e.which)?l():13===(e.keyCode||e.which)&&o()}),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:e||"Configure",body:this.$el,buttons:{Cancel:l,OK:o}})},update_from_form:function(){var e=this;this.collection.each(function(t,l){if(!t.get("hidden")){var o="param_"+l,i=e.$el.find("#"+o).val();"bool"===t.get("type")&&(i=e.$el.find("#"+o).is(":checked")),t.set_value(i)}})}});return{ConfigSetting:o,ConfigSettingCollection:i,ConfigSettingCollectionView:a}});
//# sourceMappingURL=../../maps/utils/config.js.map
