!function(a){jQuery.event.props.push("dataTransfer"),a.fn.uploadinput=function(b){var c=this,d=a.extend({},{ondragover:function(){},ondragleave:function(){},onchange:function(){},multiple:!1},b),e=a('<input type="file" style="display: none" '+(d.multiple&&"multiple"||"")+"/>");return c.append(e).change(function(b){d.onchange(b.target.files),a(this).val("")}),c.on("drop",function(a){d.ondragleave(a),a.dataTransfer&&(d.onchange(a.dataTransfer.files),a.preventDefault())}),c.on("dragover",function(a){a.preventDefault(),d.ondragover(a)}),c.on("dragleave",function(a){a.stopPropagation(),d.ondragleave(a)}),{dialog:function(){e.trigger("click")}}},a.fn.uploadbox=function(b){function c(a){if(a&&a.length&&!t){for(var b=r,c=0;c<a.length;c++){var d=String(r++);q[d]=a[c],p.announce({index:d,file:q[d]}),s++}return b}}function d(a){q[a]&&(delete q[a],s--)}function e(){if(0==s||u)return u=!1,t=!1,void p.complete();t=!0;var a=-1;for(var b in q){a=b;break}var c=q[a];d(a);var e={index:a,file:c},j=p.initialize(e);j.error?i(e,j.error):f({url:p.url,data:j,success:function(a){h(e,a)},error:function(a){i(e,a)},progress:function(a){g(e,a)}})}function f(b){var c=a.extend({},{data:{},success:function(){},error:function(){},progress:function(){},url:null,maxfilesize:2048,error_filesize:"File exceeds 2GB. Please use an FTP client.",error_default:"Please make sure the file is available.",error_server:"Upload request failed.",error_login:"Uploads require you to log in."},b),d=c.data,e=new FormData;for(var f in d.payload)e.append(f,d.payload[f]);var g=0;for(var f in d.files){var h=d.files[f];e.append(h.name,h.file,h.file.name),g+=h.file.size}return g>1048576*c.maxfilesize?void c.error(c.error_filesize):(xhr=new XMLHttpRequest,xhr.open("POST",c.url,!0),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.onreadystatechange=function(){if(xhr.readyState==xhr.DONE){var a=null;if(xhr.responseText)try{a=jQuery.parseJSON(xhr.responseText)}catch(b){a=xhr.responseText}if(xhr.status<200||xhr.status>299){var d=xhr.statusText;403==xhr.status?d=c.error_login:0==xhr.status?d=c.error_server:d||(d=c.error_default),c.error(d+" ("+xhr.status+")")}else c.success(a)}},xhr.upload.addEventListener("progress",function(a){a.lengthComputable&&c.progress(Math.round(100*a.loaded/a.total))},!1),void xhr.send(e))}function g(a,b){p.progress(a,b)}function h(a,b){p.success(a,b),e()}function i(a,b){p.error(a,b),e()}function j(){v.dialog()}function k(a){for(a in q)d(a)}function l(){t||(t=!0,e())}function m(){u=!0}function n(b){return p=a.extend({},p,b)}function o(){return window.File&&window.FormData&&window.XMLHttpRequest&&window.FileList}var p=a.extend({},{dragover:function(){},dragleave:function(){},announce:function(){},initialize:function(){},progress:function(){},success:function(){},error:function(a,b){alert(b)},complete:function(){}},b),q={},r=0,s=0,t=!1,u=!1,v=a(this).uploadinput({multiple:!0,onchange:function(a){c(a)},ondragover:b.ondragover,ondragleave:b.ondragleave});return{select:j,add:c,remove:d,start:l,stop:m,reset:k,configure:n,compatible:o}}}(jQuery);
//# sourceMappingURL=../../maps/utils/uploadbox.js.map