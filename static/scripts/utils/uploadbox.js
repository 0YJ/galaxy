!function(a){jQuery.event.props.push("dataTransfer"),a.fn.uploadinput=function(b){var c=this,d=a.extend({},{ondragover:function(){},ondragleave:function(){},onchange:function(){},multiple:!1},b),e=a('<input type="file" style="display: none" '+(d.multiple&&"multiple"||"")+"/>");return c.append(e).change(function(b){d.onchange(b.target.files),a(this).val("")}),c.on("drop",function(a){return a.dataTransfer&&(d.onchange(a.dataTransfer.files),a.preventDefault()),!1}),c.on("dragover",function(a){a.preventDefault(),d.ondragover(a)}),c.on("dragleave",function(a){a.stopPropagation(),d.ondragleave(a)}),{dialog:function(){e.trigger("click")}}},a.fn.uploadbox=function(b){function c(a){a.lengthComputable&&w.progress(this.index,this.file,Math.round(100*a.loaded/a.total))}function d(a){if(!t){for(var b=r,c=0;c<a.length;c++){var d=String(r++);q[d]=a[c],w.announce(d,q[d],""),s++}return b}}function e(a){q[a]&&(delete q[a],s--)}function f(){if(0==s||u)return u=!1,t=!1,void w.complete();t=!0;var a=-1;for(var b in q){a=b;break}var c=q[a];e(a);var d=c.size,f=(c.mode,1048576*w.maxfilesize);if(f>d||"ftp"==c.mode){var h=w.initialize(a,c);h?g(a,c,h):i(a,c,w.error_missing)}else i(a,c,w.error_filesize)}function g(a,b,d){var e=new FormData;for(var f in d)e.append(f,d[f]);b.size>0&&w.paramname&&e.append(w.paramname,b,b.name),v=new XMLHttpRequest,v.open("POST",w.url,!0),v.setRequestHeader("Accept","application/json"),v.setRequestHeader("Cache-Control","no-cache"),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.onreadystatechange=function(){if(v.readyState==v.DONE){var c=null;if(v.responseText)try{c=jQuery.parseJSON(v.responseText)}catch(d){c=v.responseText}if(v.status<200||v.status>299){var e=v.statusText;403==v.status?e=w.error_login:0==v.status?e=w.error_server:e||(e=w.error_default),i(a,b,e+" ("+v.status+")")}else h(a,b,c)}},v.upload.index=a,v.upload.file=b,v.upload.addEventListener("progress",c,!1),v.send(e)}function h(a,b,c){w.success(a,b,c),f()}function i(a,b,c){w.error(a,b,c),f()}function j(){x.dialog()}function k(a){for(a in q)e(a)}function l(){t||(t=!0,f())}function m(){u=!0}function n(b){return w=a.extend({},w,b)}function o(){return window.File&&window.FormData&&window.XMLHttpRequest&&window.FileList}var p={url:"",paramname:"content",maxfilesize:2048,dragover:function(){},dragleave:function(){},announce:function(){},initialize:function(){},progress:function(){},success:function(){},error:function(a,b,c){alert(c)},complete:function(){},error_filesize:"File exceeds 2GB. Please use an FTP client.",error_default:"Please make sure the file is available.",error_server:"Upload request failed.",error_login:"Uploads require you to log in.",error_missing:"No upload content available."},q={},r=0,s=0,t=!1,u=!1,v=null,w=a.extend({},p,b),x=a(this).uploadinput({multiple:!0,onchange:function(a){d(a)}});return{select:j,add:d,remove:e,start:l,stop:m,reset:k,configure:n,compatible:o}}}(jQuery);
//# sourceMappingURL=../../maps/utils/uploadbox.js.map