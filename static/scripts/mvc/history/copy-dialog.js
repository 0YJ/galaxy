"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _uiModal=require("mvc/ui/ui-modal"),_uiModal2=_interopRequireDefault(_uiModal),_errorModal=require("mvc/ui/error-modal"),_errorModal2=_interopRequireDefault(_errorModal),_localization=require("utils/localization"),_localization2=_interopRequireDefault(_localization),CopyDialog={defaultName:_.template("Copy of '<%- name %>'"),title:_.template((0,_localization2.default)("Copying history")+' "<%- name %>"'),submitLabel:(0,_localization2.default)("Copy"),errorMessage:(0,_localization2.default)("History could not be copied."),progressive:(0,_localization2.default)("Copying history"),activeLabel:(0,_localization2.default)("Copy only the active, non-deleted datasets"),allLabel:(0,_localization2.default)("Copy all datasets including deleted ones"),anonWarning:(0,_localization2.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,_localization2.default)("after copying this history. "),_template:_.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,_localization2.default)("You can"),' <a href="/user/login">',(0,_localization2.default)("login here"),"</a> ",(0,_localization2.default)("or")," ",' <a href="/user/create">',(0,_localization2.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,_localization2.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,_localization2.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,_localization2.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(e,a,l){function o(){var l=e.$("#copy-modal-title").val();if(l){var o="copy-all"===e.$('input[name="copy-what"]:checked').val();e.$("button").prop("disabled",!0),t._showAjaxIndicator(),a.copy(!0,l,o).done(function(e){i.resolve(e)}).fail(function(e,n,r){var d={name:l,copyAllDatasets:o};_errorModal2.default.ajaxErrorModal(a,e,d,t.errorMessage),i.rejectWith(i,arguments)}).done(function(){s&&e.hide()})}else e.$(".invalid-title").show()}l=l||{};var t=this,i=jQuery.Deferred(),n=(l.nameFn||this.defaultName)({name:a.get("name")}),r=l.allDatasets?"copy-all":"copy-non-deleted",d=!!_.isUndefined(l.allowAll)||l.allowAll,s=!!_.isUndefined(l.autoClose)||l.autoClose;this.modal=e;var c=l.closing_callback;return e.show(_.extend(l,{title:this.title({name:a.get("name")}),body:$(t._template({name:n,isAnon:Galaxy.user.isAnonymous(),allowAll:d,copyWhat:r,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:_.object([[(0,_localization2.default)("Cancel"),function(){e.hide()}],[this.submitLabel,o]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&i.reject({cancelled:!0}),c&&c(e)}})),e.$("#copy-modal-title").focus().select(),e.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),o())}),i}},ImportDialog=_.extend({},CopyDialog,{defaultName:_.template("imported: <%- name %>"),title:_.template((0,_localization2.default)("Importing history")+' "<%- name %>"'),submitLabel:(0,_localization2.default)("Import"),errorMessage:(0,_localization2.default)("History could not be imported."),progressive:(0,_localization2.default)("Importing history"),activeLabel:(0,_localization2.default)("Import only the active, non-deleted datasets"),allLabel:(0,_localization2.default)("Import all datasets including deleted ones"),anonWarning:(0,_localization2.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,_localization2.default)("after importing this history. ")}),historyCopyDialog=function(e,a){a=a||{};var l=window.parent.Galaxy.modal||new _uiModal2.default.View({});return a.useImport?ImportDialog.dialog(l,e,a):CopyDialog.dialog(l,e,a)};exports.default=historyCopyDialog;
//# sourceMappingURL=../../../maps/mvc/history/copy-dialog.js.map
