"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function buildMenu(a,e,t){return _.clone(menu).filter(function(o){return!(a&&!o.anon)&&(!(!e&&o.purge)&&(o.href&&(o.href=t+o.href,o.target=o.target||"galaxy_main"),o.confirm&&(o.func=function(){confirm(o.confirm)&&(galaxy_main.location=o.href)}),!0))})}Object.defineProperty(exports,"__esModule",{value:!0});var _popupMenu=require("mvc/ui/popup-menu"),_popupMenu2=_interopRequireDefault(_popupMenu),_copyDialog=require("mvc/history/copy-dialog"),_copyDialog2=_interopRequireDefault(_copyDialog),_baseMvc=require("mvc/base-mvc"),_baseMvc2=_interopRequireDefault(_baseMvc),_localization=require("utils/localization"),_localization2=_interopRequireDefault(_localization),_webhooks=require("mvc/webhooks"),_webhooks2=_interopRequireDefault(_webhooks),menu=[{html:(0,_localization2.default)("History Lists"),header:!0},{html:(0,_localization2.default)("Saved Histories"),href:"histories/list",target:"_top"},{html:(0,_localization2.default)("Histories Shared with Me"),href:"histories/list_shared",target:"_top"},{html:(0,_localization2.default)("Current History"),header:!0,anon:!0},{html:(0,_localization2.default)("Create New"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.createNewHistory()}},{html:(0,_localization2.default)("Copy History"),func:function(){(0,_copyDialog2.default)(Galaxy.currHistoryPanel.model).done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,_localization2.default)("Share or Publish"),href:"history/sharing"},{html:(0,_localization2.default)("Show Structure"),href:"history/display_structured",anon:!0},{html:(0,_localization2.default)("Extract Workflow"),href:"workflow/build_from_current_history"},{html:(0,_localization2.default)("Delete"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,_localization2.default)("Really delete the current history?"))&&Galaxy.currHistoryPanel.model._delete().done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,_localization2.default)("Delete Permanently"),purge:!0,anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,_localization2.default)("Really delete the current history permanently? This cannot be undone."))&&Galaxy.currHistoryPanel.model.purge().done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,_localization2.default)("Dataset Actions"),header:!0,anon:!0},{html:(0,_localization2.default)("Copy Datasets"),href:"dataset/copy_datasets"},{html:(0,_localization2.default)("Dataset Security"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.router&&Galaxy.router.push("/histories/permissions?id="+Galaxy.currHistoryPanel.model.id)}},{html:(0,_localization2.default)("Resume Paused Jobs"),href:"history/resume_paused_jobs?current=True",anon:!0},{html:(0,_localization2.default)("Collapse Expanded Datasets"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.collapseAll()}},{html:(0,_localization2.default)("Unhide Hidden Datasets"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,_localization2.default)("Really unhide all hidden datasets?"))&&$.post(Galaxy.root+"history/adjust_hidden",{user_action:"unhide"},function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,_localization2.default)("Delete Hidden Datasets"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,_localization2.default)("Really delete all hidden datasets?"))&&$.post(Galaxy.root+"history/adjust_hidden",{user_action:"delete"},function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,_localization2.default)("Purge Deleted Datasets"),confirm:(0,_localization2.default)("Really delete all deleted datasets permanently? This cannot be undone."),href:"history/purge_deleted_datasets",purge:!0,anon:!0},{html:(0,_localization2.default)("Downloads"),header:!0},{html:(0,_localization2.default)("Export Tool Citations"),href:"history/citations",anon:!0},{html:(0,_localization2.default)("Export History to File"),href:"history/export_archive?preview=True",anon:!0},{html:(0,_localization2.default)("Other Actions"),header:!0},{html:(0,_localization2.default)("Import from File"),href:"history/import_archive"}];_webhooks2.default.add({url:"api/webhooks/history-menu/all",async:!1,callback:function(a){var e=[];$.each(a.models,function(a,t){var o=t.toJSON();o.activate&&e.push({html:(0,_localization2.default)(o.config.title),anon:!0})}),e.length>0&&(e.unshift({html:(0,_localization2.default)("Webhooks"),header:!0}),$.merge(menu,e))}});var create=function(a,e){var t=buildMenu(void 0===(e=e||{}).anonymous||e.anonymous,e.purgeAllowed||!1,Galaxy.root);return new _popupMenu2.default(a,t)};exports.default=create;
//# sourceMappingURL=../../../maps/mvc/history/options-menu.js.map
