define(["mvc/user/manage-user-information"],function(a){var b=Backbone.View.extend({initialize:function(a){this.render(a)},renderMessage:function(a,b){return'<div class="'+(""===b?"done":b)+"message"+("error"===b?" validate":"")+'">'+a+"</div>"},renderJS:function(){$(".role_add_button").click(function(){var a=this.id.substring(0,this.id.lastIndexOf("_add_button")),b="#"+a+"_in_select",c="#"+a+"_out_select";return!$(c+" option:selected").remove().appendTo(b)}),$(".role_remove_button").click(function(){var a=this.id.substring(0,this.id.lastIndexOf("_remove_button")),b="#"+a+"_in_select",c="#"+a+"_out_select";return!$(b+" option:selected").remove().appendTo(c)}),$(".update-roles-button").click(function(){$(".in_select option").each(function(){$(this).attr("selected","selected")})}),$("#edit_role_associations select").select2("destroy")},renderSelect:function(a,b,c,d,e,f,g){var h="";h=h+"<p><b>"+c+":</b> "+d,c===g&&(h+="<br/> NOTE: Users must have every role associated with this dataset in order to access it"),h+="</p>",h=h+'<div style="width: 100%; white-space: nowrap;"><div style="float: left; width: 50%;">Roles associated:<br /><select name="'+b+'_in" id="'+b+'_in_select" class="in_select" style="max-width:  98%; width: 98%; height: 150px; font-size: 100%;" multiple>';for(var i in e)h=h+'<option value="'+e[i].id+'">'+e[i].name+"</option>";h+="</select> <br />",h=h+'<div style="width: 98%; text-align: right"><input type="submit" id="'+b+'_remove_button" class="role_remove_button" value=">>"/></div></div>',h=h+'<div style="width: 50%;">Roles not associated:<br /><select name="'+b+'_out" id="'+b+'_out_select" style="max-width:  98%; width: 98%; height: 150px; font-size: 100%;" multiple>';for(var i in f)h=h+'<option value="'+f[i].id+'">'+f[i].name+"</option>";return h+="</select> <br />",h=h+'<input type="submit" id="'+b+'_add_button" class="role_add_button" value="<<"/></div></div>'},render:function(b){var c="",d=this;if(a.ManageUserInformation.prototype.hideErrorDoneMessage(),b.message&&b.message.length>0&&(c=this.renderMessage(b.message,b.status)),c+='<div class="change-permissions-section"> <h2>Change default permissions</h2>',c+='<ul class="manage-table-actions"><li><a class="action-button back-user-info" target="galaxy_main">User preferences</a></li></ul>',null!==b.userid){c=c+'<div class="toolForm"><div class="toolFormTitle">Manage '+b.obj_type+" permissions on "+b.obj_str+'</div><div class="toolFormBody"><form name="edit_role_associations" id="edit_role_associations"><div class="form-row"></div>';for(var e in b.permitted_actions){var f=b.permitted_actions[e];c+='<div class="form-row">',c+=this.renderSelect(b.current_actions,f.action_key,f.action,f.description,f.in_roles,f.out_roles,b.data_access),c+="</div>"}c+='<div class="form-row"><input type="button" class="update-roles-button action-button" name="update_roles_button" value="Save"/></div>',c+="</form></div></div>"}c+="</div>",$(".user-preferences-all").append(c),d.renderJS(),$(".back-user-info").on("click",function(b){b.preventDefault(),$(".user-pref").show(),$(".change-permissions-section").remove(),a.ManageUserInformation.prototype.hideErrorDoneMessage()}),$(".update-roles-button").on("click",function(a){d.savePermission(d,a)})},savePermission:function(){var b=Galaxy.root+"api/user_preferences/set_default_permissions",c={},d=a.ManageUserInformation.prototype,e=$(".in_select");c={update_roles_button:!0};for(var f=0;f<e.length;f++)if($(e[f]).find("option").length>0){var g=$(e[f]).attr("name"),h=$(e[f]).find("option").attr("value");c[g]=h}$.getJSON(b,c,function(a){"error"===a.status?d.renderError(a.message):($(".change-permissions-section").remove(),d.renderDone(a.message),$(".user-pref").show())})}});return{ChangePermissions:b}});
//# sourceMappingURL=../../../maps/mvc/user/change-permissions.js.map