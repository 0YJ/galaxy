define(["mvc/form/form-view","mvc/ui/ui-misc"],function(a,b){var c=Backbone.View.extend({initialize:function(){this.defs={information:{title:"Manage information",description:"Edit your email, addresses and custom parameters or change your username.",url:"api/user_preferences/"+Galaxy.user.id+"/information",icon:"fa-info-circle"},password:{title:"Change password",description:"Allows you to change your login credentials.",icon:"fa-unlock-alt",url:"api/user_preferences/"+Galaxy.user.id+"/password",submit_title:"Save password"},communication:{title:"Change communication settings",description:"Enable or disable the communication feature to chat with other users.",url:"api/user_preferences/"+Galaxy.user.id+"/communication",icon:"fa-child"},permissions:{title:"Change default permissions",description:"Grant others default access to newly created histories.",url:"api/user_preferences/"+Galaxy.user.id+"/permissions",icon:"fa-users",submit_title:"Save permissions"},api_key:{title:"Manage API key",description:"Access your current API key or create a new one.",url:"api/user_preferences/"+Galaxy.user.id+"/api_key",icon:"fa-key",submit_title:"Create a new key",submit_icon:"fa-check"},toolbox_filters:{title:"Manage Toolbox filters",description:"Customize your Toolbox by displaying or omitting sets of Tools.",url:"api/user_preferences/"+Galaxy.user.id+"/toolbox_filters",icon:"fa-filter",submit_title:"Save filters"},openids:{title:"Manage OpenIDs",description:"Associate OpenIDs with your account.",icon:"fa-openid",onclick:function(){$("#galaxy_main").attr("src",Galaxy.root+"user/openid_manage?cntrller=user")}},logout:{title:"Sign out",description:"Click here to sign out of all sessions.",icon:"fa-sign-out",onclick:function(){Galaxy.modal.show({title:"Sign out",body:"Do you want to continue and sign out of all active sessions?",buttons:{Cancel:function(){Galaxy.modal.hide()},"Sign out":function(){$.ajax({url:"api/users/"+Galaxy.user.id+"/logout",method:"POST",data:{all:!0}}).done(function(a){window.location.href=a.redirect_url||Galaxy.root})}}})}}},this.message=new b.Message,this.setElement("<div/>"),this.render()},render:function(){var a=this;$.getJSON(Galaxy.root+"api/user_preferences",function(b){a.$preferences=$("<div/>").addClass("ui-panel").append(a.message.$el).append($("<h2/>").append("User preferences")).append($("<p/>").append("You are logged in as <strong>"+_.escape(b.email)+"</strong>.")).append(a.$table=$("<table/>").addClass("ui-panel-table")),b.remote_user||(a._link(a.defs.information),a._link(a.defs.password)),"galaxy"==b.webapp?(a._link(a.defs.communication),a._link(a.defs.permissions),a._link(a.defs.api_key),a._link(a.defs.toolbox_filters),b.openid&&!b.remote_user&&a._link(a.defs.openids),a._link(a.defs.logout),a.$preferences.append(a._templateFooter(b))):(a._link(a.defs.api_key),a._link({title:"Manage your email alerts"})),a.$el.empty().append(a.$preferences)})},_link:function(c){var d=this,e=$(this._templateRow(c));this.$table.append(e),e.find("a").on("click",function(){c.url?$.ajax({url:Galaxy.root+c.url,type:"GET"}).always(function(e){var f=$.extend({},c,e),g=new a({title:f.title,icon:f.icon,inputs:f.inputs,operations:{submit:new b.ButtonIcon({tooltip:f.submit_tooltip||"Store user preferences",title:f.submit_title||"Save settings",icon:f.submit_icon||"fa-save",onclick:function(){d._submit(g,f)}}),back:new b.ButtonIcon({icon:"fa-caret-left",tooltip:"Return to user preferences",title:"Preferences",onclick:function(){g.remove(),d.$preferences.show()}})}});d.$preferences.hide(),d.$el.append(g.$el)}):c.onclick()})},_submit:function(a,b){var c=this;$.ajax({url:b.url,data:JSON.stringify(a.data.create()),type:"PUT",contentType:"application/json"}).done(function(b){var d=!1;a.data.matchModel(b,function(b,c){a.field_list[c].value(b.value),d=!0}),d?a.message.update({message:b.message,status:"success"}):(a.remove(),c.$preferences.show(),c.message.update({message:b.message,status:"success"}))}).fail(function(b){a.message.update({message:b.responseJSON.err_msg,status:"danger"})})},_templateRow:function(a){return'<tr><td><div class="ui-panel-icon fa '+a.icon+'"></td><td><a class="ui-panel-anchor" href="javascript:void(0)">'+a.title+'</a><div class="ui-form-info">'+a.description+"</div></td></tr>"},_templateFooter:function(a){return'<p class="ui-panel-footer">You are using <strong>'+a.disk_usage+"</strong> of disk space in this Galaxy instance. "+(a.enable_quotas?"Your disk quota is: <strong>"+a.quota+"</strong>. ":"")+'Is your usage more than expected? See the <a href="https://wiki.galaxyproject.org/Learn/ManagingDatasets" target="_blank">documentation</a> for tips on how to find all of the data in your account.</p>'}});return{UserPreferences:c}});
//# sourceMappingURL=../../../maps/mvc/user/user-preferences.js.map