"use strict";define(["mvc/form/form-view","mvc/ui/ui-misc"],function(e,i){var t=Backbone.Model.extend({initialize:function(e){e=e||{},e.user_id=e.user_id||Galaxy.user.id,this.set({user_id:e.user_id,information:{title:"Manage information",description:"Edit your email, addresses and custom parameters or change your username.",url:"api/users/"+e.user_id+"/information/inputs",icon:"fa-user"},password:{title:"Change password",description:"Allows you to change your login credentials.",icon:"fa-unlock-alt",url:"api/users/"+e.user_id+"/password/inputs",submit_title:"Save password"},communication:{title:"Change communication settings",description:"Enable or disable the communication feature to chat with other users.",url:"api/users/"+e.user_id+"/communication/inputs",icon:"fa-comments-o"},permissions:{title:"Set dataset permissions for new histories",description:"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.",url:"api/users/"+e.user_id+"/permissions/inputs",icon:"fa-users",submit_title:"Save permissions"},api_key:{title:"Manage API key",description:"Access your current API key or create a new one.",url:"api/users/"+e.user_id+"/api_key/inputs",icon:"fa-key",submit_title:"Create a new key",submit_icon:"fa-check"},toolbox_filters:{title:"Manage Toolbox filters",description:"Customize your Toolbox by displaying or omitting sets of Tools.",url:"api/users/"+e.user_id+"/toolbox_filters/inputs",icon:"fa-filter",submit_title:"Save filters"},openids:{title:"Manage OpenIDs",description:"Associate OpenIDs with your account.",icon:"fa-openid",onclick:function(){window.location.href=Galaxy.root+"user/openid_manage?cntrller=user&use_panels=True"}},custom_builds:{title:"Manage custom builds",description:"Add or remove custom builds using history datasets.",icon:"fa-cubes",onclick:function(){window.location.href=Galaxy.root+"custom_builds"}},configure_menu:{title:"Configure workflow menu",description:"Configure your workflow items which appear in the Tool panel.",icon:"fa-cog",onclick:function(){window.location.href=Galaxy.root+"workflow/configure_menu"}},logout:{title:"Sign out",description:"Click here to sign out of all sessions.",icon:"fa-sign-out",onclick:function(){Galaxy.modal.show({title:"Sign out",body:"Do you want to continue and sign out of all active sessions?",buttons:{Cancel:function(){Galaxy.modal.hide()},"Sign out":function(){window.location.href=Galaxy.root+"user/logout"}}})}}})}});return{View:Backbone.View.extend({initialize:function(){this.model=new t,this.message=new i.Message,this.setElement("<div/>"),this.render()},render:function(){var e=this,i=Galaxy.config;$.getJSON(Galaxy.root+"api/users/"+Galaxy.user.id,function(t){e.$preferences=$("<div/>").addClass("ui-panel").append(e.message.$el).append($("<h2/>").append("User preferences")).append($("<p/>").append("You are logged in as <strong>"+_.escape(t.email)+"</strong>.")).append(e.$table=$("<table/>").addClass("ui-panel-table")),i.use_remote_user||(e._addLink("information"),e._addLink("password")),i.enable_communication_server&&e._addLink("communication"),e._addLink("custom_builds"),e._addLink("permissions"),e._addLink("api_key"),i.has_user_tool_filters&&e._addLink("toolbox_filters"),i.enable_openid&&!i.use_remote_user&&e._addLink("openids"),e._addLink("configure_menu"),e._addLink("logout"),e.$preferences.append(e._templateFooter(t)),e.$el.empty().append(e.$preferences)})},_addLink:function(e){var i=this.model.get(e),t=$(this._templateLink(i)),n=t.find("a");i.onclick?n.on("click",function(){i.onclick()}):n.attr("href",Galaxy.root+"user/"+e),this.$table.append(t)},_templateLink:function(e){return'<tr><td><div class="ui-panel-icon fa '+e.icon+'"></td><td><a class="ui-panel-anchor" href="javascript:void(0)">'+e.title+'</a><div class="ui-form-info">'+e.description+"</div></td></tr>"},_templateFooter:function(e){return'<p class="ui-panel-footer">You are using <strong>'+e.nice_total_disk_usage+"</strong> of disk space in this Galaxy instance. "+(Galaxy.config.enable_quotas?"Your disk quota is: <strong>"+e.quota+"</strong>. ":"")+'Is your usage more than expected? See the <a href="https://galaxyproject.org/learn/managing-datasets/" target="_blank">documentation</a> for tips on how to find all of the data in your account.</p>'}}),Forms:Backbone.View.extend({initialize:function(e){this.model=new t(e),this.page=this.model.get(e.form_id),this.setElement("<div/>"),this.render()},render:function(){var t=this;$.ajax({url:Galaxy.root+this.page.url,type:"GET"}).done(function(n){var o=$.extend({},t.page,n),s=new e({title:o.title,icon:o.icon,inputs:o.inputs,operations:{submit:new i.ButtonIcon({tooltip:o.submit_tooltip,title:o.submit_title||"Save settings",icon:o.submit_icon||"fa-save",onclick:function(){t._submit(s,o)}})}});t.$el.empty().append(s.$el)}).fail(function(e){t.$el.empty().append(new i.Message({message:"Failed to load resource "+t.page.url+".",status:"danger",persistent:!0}).$el)})},_submit:function(e,i){$.ajax({url:Galaxy.root+i.url,data:JSON.stringify(e.data.create()),type:"PUT",contentType:"application/json"}).done(function(i){e.data.matchModel(i,function(i,t){e.field_list[t].value(i.value)}),e.message.update({message:i.message,status:"success"})}).fail(function(i){e.message.update({message:i.responseJSON.err_msg,status:"danger"})})}})}});
//# sourceMappingURL=../../../maps/mvc/user/user-preferences.js.map
