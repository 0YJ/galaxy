define(["mvc/form/form-view","mvc/ui/ui-misc","mvc/ui/ui-select"],function(a,b,c){var d=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.render()},render:function(){var a=this,b=[],c=[],d=Galaxy.root+"api/workflows/";$.getJSON(d,function(d){a.$el.empty().append(a._templateHeader()),a.build_messages(a),a.$el.find(".user-workflows").append(a._templateActionButtons());var e=a.build_workflows(d);b=e.workflows,c=e.shared_workflows,a.build_selectlist(a,b,"user-workflows","workflow","wf-user","You have no workflows."),a.build_selectlist(a,c,"shared-workflows","shared","wf-shared","No workflows have been shared with you.")})},build_workflows:function(a){var b=[],c=[],d=Galaxy.user.attributes.username;return _.each(a,function(a){var e={};e.id=a.id,e.text=a.name,e.workflow_steps=a.latest_workflow_steps,a.owner===d?b.push(e):(e.email=a.user_email,c.push(e))}),{workflows:b,shared_workflows:c}},build_messages:function(a){var b=$(".response-message"),c=a.getQueryStringValue("status"),d=a.getQueryStringValue("message");d&&null!==d&&""!==d?(b.addClass(c+"message"),b.html("<p>"+d+"</p>")):b.html("")},build_selectlist:function(a,b,d,e,f,g){b.length>0?(a.selectWorkflows=new c.View({css:"workflow-list",container:a.$("."+d),data:b,value:b[0].id,onchange:function(c){a.select_workflow(a,c,b,d,e)}}),a.$el.append(a.selectWorkflows.$el),a.select_workflow(a,b[0].id,b,d,e)):(a.$el.find("."+f).remove(),a.$el.find("."+d).append('<div class="wf-nodata">'+g+"</div>"))},select_workflow:function(a,b,c,d,e){_.each(c,function(c){if(b.toString()===c.id.toString()){var f=$("."+d);f.find(".manage-table").remove(),f.append("workflow"===e?a._templateWorkflowInfoTable(c):a._templateSharedWorkflowInfoTable(c)),a.confirm_delete(c)}})},confirm_delete:function(a){$(".link-confirm-"+a.id).click(function(){return confirm("Are you sure you want to delete workflow '"+a.text+"'?")}),$(".link-confirm-shared-"+a.id).click(function(){return confirm("Are you sure you want to remove the shared workflow '"+a.text+"'?")})},getQueryStringValue:function(a){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(a).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},_templateActionButtons:function(){return'<ul class="manage-table-actions"><li><a class="action-button fa fa-plus wf-action" id="new-workflow" href="/workflow/create"><span>Create new workflow</span></a></li><li><a class="action-button fa fa-upload wf-action" id="import-workflow" href="/workflow/import_workflow"><span>Upload or import workflow</span></a></li></ul>'},_templateWorkflowInfoTable:function(a){return'<table class="manage-table colored"><tr class="header"><th>Name</th><th># of Steps</th></tr><tr><td class="wf-td wf-dpd"><div class="dropdown"><button class="menubutton" type="button" data-toggle="dropdown">'+_.escape(a.text)+'<span class="caret"></span></button><ul class="dropdown-menu action-dpd"><li><a href="/workflow/editor?id='+a.id+'">Edit</a></li><li><a href="/root?workflow_id='+a.id+'">Run</a></li><li><a href="/workflow/sharing?id='+a.id+'">Share or Download</a></li><li><a href="/workflow/copy?id='+a.id+'">Copy</a></li><li><a href="/workflow/rename?id='+a.id+'">Rename</a></li><li><a href="/workflow/display_by_id?id='+a.id+'">View</a></li><li><a class="link-confirm-'+a.id+'" href="/workflow/delete?id='+a.id+'">Delete</a></li></ul></div></td><td class="wf-td">'+a.workflow_steps+"</td></tr></table>"},_templateSharedWorkflowInfoTable:function(a){return'<table class="manage-table colored"><tr class="header"><th>Name</th><th>Owner</th><th># of Steps</th></tr><tr><td class="shared-wf-td wf-dpd"><div class="dropdown"><button class="menubutton" type="button" data-toggle="dropdown">'+_.escape(a.text)+'<span class="caret"></span></button><ul class="dropdown-menu action-dpd"><li><a href="">View</a></li><li><a href="/workflow/run?id='+a.id+'">Run</a></li><li><a href="/workflow/copy?id='+a.id+'">Copy</a></li><li><a class="link-confirm-shared-'+a.id+'" href="/workflow/sharing?unshare_me=True&id='+a.id+'">Remove</a></li></ul></div></td><td class="shared-wf-td">'+_.escape(a.email)+'</td><td class="shared-wf-td">'+a.workflow_steps+"</td></tr></table>"},_templateHeader:function(){return'<div class="page-container"><div class="user-workflows wf"><div class="response-message"></div><h2>Your workflows</h2></div><hr class="wf-table-bottom wf-user"><div class="shared-workflows wf"><h2>Workflows shared with you by others</h2></div><hr class="wf-table-bottom wf-shared"><div class="other-options wf"><h2>Other options</h2><a class="action-button fa fa-cog wf-action" href="/workflow/configure_menu"><span>Configure your workflow menu</span></a></div></div>'}});return{View:d}});
//# sourceMappingURL=../../../maps/mvc/workflow/workflow.js.map