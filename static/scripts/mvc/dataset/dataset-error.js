"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _utils=require("utils/utils"),_utils2=_interopRequireDefault(_utils),_uiMisc=require("mvc/ui/ui-misc"),_uiMisc2=_interopRequireDefault(_uiMisc),_formView=require("mvc/form/form-view"),_formView2=_interopRequireDefault(_formView),View=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.model=new Backbone.Model({dataset_id:Galaxy.params.dataset_id}),this.render()},render:function(){var e=Galaxy.root+"api/datasets/"+this.model.get("dataset_id"),t=this;_utils2.default.get({url:e,success:function(e){var r=Galaxy.root+"api/jobs/"+e.creating_job+"?full=True";_utils2.default.get({url:r,success:function(r){Galaxy.root,e.creating_job;t.render_error_page(t,e,r)},error:function(e){var r={status:"error",message:"Error occured while loading the job.",persistent:!0,cls:"errormessage"};t.display_message(r,t.$(".response-message"))}})},error:function(e){var r={status:"error",message:"Error occured while loading the dataset.",persistent:!0,cls:"errormessage"};t.display_message(r,t.$(".response-message"))}})},render_error_page:function(e,t,r){e.$el.empty().append(e._templateHeader()),e.$el.append("<h2>Dataset Error</h2>"),e.$el.append("<p>An error occured while running the tool <b>"+r.tool_id+"</b>.</p>"),e.$el.append("<p>Tool execution generated the following messages:</p>"),e.$el.append('<pre class="code">'+r.stderr+"</pre>"),e.$el.append("<h2>Report This Error</pre>"),e.$el.append("<p>Usually the local Galaxy administrators regularly review errors that occur on the server. However, if you would like to provide additional information (such as what you were trying to do when the error occurred) and a contact e-mail address, we will be better able to investigate your problem and get back to you.</p>"),e.$el.append(e._getBugFormTemplate(t,r))},display_message:function(e,t,r,a){a?r?t.append(new _uiMisc2.default.UnescapedMessage(e).$el):t.empty().html(new _uiMisc2.default.UnescapedMessage(e).$el):r?t.append(new _uiMisc2.default.Message(e).$el):t.empty().html(new _uiMisc2.default.Message(e).$el)},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div></div>'},_getBugFormTemplate:function(e,t){var r=this,a=[{help:"Your email address",options:[],type:"text",name:"email",label:"Your email",value:Galaxy.user.get("email")},{help:"Any additional comments you can provide regarding what you were doing at the time of the bug.",options:[],type:"text",area:!0,name:"message",label:"Message"}],s=new _formView2.default({title:"Error Report",inputs:a,buttons:{save:new _uiMisc2.default.Button({icon:"fa-bug",title:"Report",cls:"ui-button btn btn-primary",floating:"clear",onclick:function(){var a=s.data.create(),i=Galaxy.root+"api/jobs/"+t.id+"/error";a.dataset_id=e.id,r.submit(a,i)}})}});return s.$el},submit:function(e,t){var r=this;$.ajax({type:"POST",url:t,data:e,success:function(e){r.$el.empty().append(r._templateHeader()),e.messages.forEach(function(e){r.display_message({status:e[1],message:e[0],persistent:!0},r.$(".response-message"),!0,!0)})},error:function(e){var t={status:"error",message:"Error occured while saving. Please fill all the required fields and try again.",persistent:!0,cls:"errormessage"};r.display_message(t,r.$(".response-message"))}})}});exports.default={View:View};
//# sourceMappingURL=../../../maps/mvc/dataset/dataset-error.js.map
