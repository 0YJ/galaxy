define(["utils/utils","mvc/ui/ui-tabs","mvc/ui/ui-misc"],function(a,b,c){var d=Backbone.View.extend({initialize:function(a){this.setElement("<div/>"),this.render(a)},render:function(b){var d=Galaxy.root+"dataset/edit",e=this;a.get({url:d,data:{dataset_id:b},success:function(a){e.render_attribute_page(e,a)},error:function(){e.page.display(new c.Message({message:"Error occured",status:"error",persistent:!0,cls:"errormessage"}))}})},render_attribute_page:function(a,b){var c=null;a.$el.empty().append(a._templateHeader()),c=a.$el.find(".edit-attr"),a.display_message(a,b,c),a.create_tabs(a,b,c),a.register_attr_events(a,b.dataset_id,c)},register_attr_events:function(a,b,c){var d=Galaxy.root+"dataset/edit";c.find(".btn-submit-attributes").click(function(){c.find("#formeditattr").submit(function(b){b.preventDefault();var e=$(this).serializeArray(),f={},g=[];return _.each(e,function(a){a.name in f?g.push(a.name):f[a.name]=a.value}),_.each(g,function(a){var b=0;f[a]=[],_.each(e,function(c){c.name===a&&(f[a][b]=c.value,b+=1)})}),""!==f.name&&null!==f.name&&f.name?void a.call_ajax(a,d,f):void a.display_message(a,{message:"Please give a name to the dataset",status:"error"},c)})}),c.find(".btn-auto-detect").click(function(c){c.preventDefault(),a.call_ajax(a,d,{dataset_id:b,detect:"Auto-detect"})}),c.find(".btn-convert-dataset").click(function(b){b.preventDefault();var e=c.find("#convertdata").serializeArray(),f={};e.push({name:"convert_data",value:"Convert"}),_.each(e,function(a){a.name in f||(f[a.name]=a.value)}),a.call_ajax(a,d,f)})},call_ajax:function(a,b,d){$.ajax({type:"POST",url:b,data:d,success:function(b){a.render_attribute_page(a,b)},error:function(){a.page.display(new c.Message({message:"Error occured",status:"error",persistent:!0,cls:"errormessage"}))}})},display_message:function(a,b,c){$el_message=c.find(".response-message"),$el_message.removeClass("errormessage donemessage warningmessage"),b.message&&null!==b.message&&""!==b.message?($el_message.addClass(b.status+"message"),$el_message.html("<p>"+_.escape(b.message)+"</p>")):$el_message.html("")},create_tabs:function(a,c,d){a.tabs=new b.View,a.tabs.add({id:"attributes",title:"Attributes",icon:"fa fa-bars",tooltip:"Edit dataset attributes",$el:$(a._attributesTabTemplate(a,c))}),a.tabs.add({id:"convert",title:"Convert",icon:"fa-gear",tooltip:"Convert to new format",$el:$(a._convertTabTemplate(a,c))}),a.tabs.add({id:"datatype",title:"Datatypes",icon:"fa-database",tooltip:"Change data type"}),a.tabs.add({id:"permissions",title:"View Permissions",icon:"fa-user",tooltip:"View permissions"}),d.append(a.tabs.$el),a.tabs.showTab("attributes")},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div><h3>Edit Dataset Attributes and Permissions</h3></div>'},_attributesTabTemplate:function(a,b){var c="<div class='toolFormTitle'>Edit Attributes</div><div class='toolFormBody'><form name='edit_attributes' id='formeditattr'><div class='form-row'><label>Name:</label><div style='float: left; width: 250px; margin-right: 10px;'><input type='text' name='name' value="+b.display_name+" size='40'/><input type='hidden' name='dataset_id' value='"+b.dataset_id+"'><input type='hidden' name='save' value='Save'></div><div style='clear: both'></div></div><div class='form-row'><label>Info:</label><div style='float: left; width: 250px; margin-right: 10px;'><textarea name='info' cols='40' rows='2'>"+b.data_info+"</textarea></div><div style='clear: both'></div></div>";return user&&(c=c+"<div class='form-row'><label>Annotation / Notes:</label><div style='float: left; width: 250px; margin-right: 10px;'><textarea name='annotation' cols='40' rows='2'>"+(null===b.data_annotation?"":b.data_annotation)+"</textarea></div><div style='clear: both'></div><div class='toolParamHelp'>Add an annotation or notes to a dataset; annotations are available when a history is viewed.</div></div>"),_.each(b.data_metadata,function(a){a[1]&&(c=c+"<div class='form-row'><label>"+a[2]+"</label><div style='float: left; width: 250px; margin-right: 10px;'>"+b.metadata_html[a[0]]+"</div><div style='clear: both'></div></div>")}),c+="<div class='form-row'><input class='btn-submit-attributes' type='submit' name='save' value='Save'/></div>",c+="</form>",c+="<form name='auto_detect'><div class='form-row'><div style='float: left; width: 250px; margin-right: 10px;'><input class='btn-auto-detect' type='submit' name='detect' value='Auto-detect' /></div><div class='toolParamHelp' style='clear: both;'>This will inspect the dataset and attempt to correct the above column values if they are not accurate.</div></div></form>",b.data_missing_meta&&(c+="<div class='form-row'><div class='errormessagesmall'> Required metadata values are missing. Some of these values may not be editable by the user. Selecting 'Auto-detect' will attempt to fix these values. </div></div>"),c+="</div></div>"},_convertTabTemplate:function(a,b){var c="<div class='toolFormTitle'>Convert to new format</div><div class='toolFormBody'>";return b.converters_collection.length>0?(c=c+"<form name='convert_data' id='convertdata'><div class='form-row'><label>Name:</label><input type='hidden' name='dataset_id' value='"+b.dataset_id+"'><div style='float: left; width: 250px; margin-right: 10px;'>",c+="<select name='target_type'>",_.each(b.converters_collection,function(a){c=c+"<option value='"+a[0]+"'>"+a[1]+"</option>"}),c+="</select></div>",c+="<div class='toolParamHelp' style='clear: both;'>This will create a new dataset with the contents of this dataset converted to a new format.</div><div style='clear: both'></div></div>",c+="<div class='form-row'><input class='btn-convert-dataset' type='submit' name='convert_data' value='Convert'/></div></form>"):c+="<div>No conversions available</div>",c+="</div></div>"}});return{View:d}});
//# sourceMappingURL=../../../maps/mvc/dataset/dataset-edit-attributes.js.map