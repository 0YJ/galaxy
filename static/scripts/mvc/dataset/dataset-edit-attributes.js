define(["utils/utils","mvc/ui/ui-tabs","mvc/ui/ui-misc","mvc/form/form-view"],function(a,b,c,d){var e=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.model=new Backbone.Model({dataset_id:Galaxy.params.dataset_id}),this.message=new c.Message({persistent:!0}),this.render()},render:function(){var a=this;$.ajax({url:Galaxy.root+"dataset/get_edit?dataset_id="+a.model.get("dataset_id"),success:function(b){a._renderPage(a,b)},error:function(b){var c=b.responseJSON&&b.responseJSON.err_msg;a.message.update({status:"danger",message:c||"Error occured while loading the dataset.",persistent:!0})}})},_renderPage:function(a,b){this.$el.empty().append(this.message.$el).append(this._getAttributesFormTemplate(b)).append(this._getConvertFormTemplate(b)).append(this._getChangeDataTypeFormTemplate(b)).append(this._getPermissionsFormTemplate(b)),this.message.update(b)},call_ajax:function(a,b){var c=Galaxy.root+"dataset/set_edit";$.ajax({type:"PUT",url:c,data:b,success:function(){a.reload_history()},error:function(){var b={status:"error",message:"Error occured while saving. Please fill all the required fields and try again.",persistent:!0,cls:"errormessage"};a.display_message(b,a.$(".response-message"))}})},display_message:function(a,b){b.empty().html(new c.Message(a).$el)},create_tabs:function(a){this.$el.append(this._getAttributesFormTemplate(a))},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div><h3>Edit Dataset Attributes</h3></div>'},_getAttributesFormTemplate:function(a){var b=this,e=new d({title:"Edit attributes",inputs:a.attribute_inputs,operations:{submit_editattr:new c.ButtonIcon({tooltip:"Save attributes of the dataset.",icon:"fa-floppy-o ",title:"Save attributes",onclick:function(){b._submit(b,e,a,"edit_attributes")}}),submit_autocorrect:new c.ButtonIcon({tooltip:"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.",icon:"fa-undo ",title:"Auto-detect",onclick:function(){b._submit(b,e,a,"auto-detect")}})}});return e.$el},_getConvertFormTemplate:function(a){var b=this,e=new d({title:"Convert to new format",inputs:a.datatype_inputs,operations:{submit:new c.ButtonIcon({tooltip:"Convert the datatype to a new format.",title:"Convert datatype",icon:"fa-exchange ",onclick:function(){b._submit(b,e,a,"convert")}})}});return e.$el},_getChangeDataTypeFormTemplate:function(a){var b=this,e=new d({title:"Change datatype",inputs:a.conversion_inputs,operations:{submit:new c.ButtonIcon({tooltip:"Change the datatype to a new type.",title:"Change datatype",icon:"fa-exchange ",onclick:function(){b._submit(b,e,a,"change")}})}});return e.$el},_getPermissionsFormTemplate:function(a){var b=this;if(a.can_manage_dataset){var e=new d({title:"Manage dataset permissions on "+a.display_name,inputs:a.permission_inputs,operations:{submit:new c.ButtonIcon({tooltip:"Save permissions.",title:"Save permissions",icon:"fa-floppy-o ",onclick:function(){b._submit(b,e,a,"permissions")}})}});return e.$el}var e=new d({title:"View permissions",inputs:a.permission_inputs});return e.$el},_submit:function(a,b,c,d){var e=b.data.create();switch(e.dataset_id=c.dataset_id,d){case"edit_attributes":e.save="Save";break;case"auto-detect":e.detect="Auto-detect";break;case"convert":null!==e.target_type&&e.target_type&&(e.dataset_id=c.dataset_id,e.convert_data="Convert");break;case"change":e.change="Save";break;case"permissions":var f={};f.permissions=JSON.stringify(e),f.update_roles_button="Save",f.dataset_id=c.dataset_id,e=f}a.call_ajax(a,e)},reload_history:function(){window.Galaxy&&window.Galaxy.currHistoryPanel.loadCurrentHistory()}});return{View:e}});
//# sourceMappingURL=../../../maps/mvc/dataset/dataset-edit-attributes.js.map