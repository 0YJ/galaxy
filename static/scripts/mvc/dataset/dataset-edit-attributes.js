define(["utils/utils","mvc/ui/ui-tabs","mvc/ui/ui-misc"],function(a,b,c){var d=Backbone.View.extend({initialize:function(a){this.setElement("<div/>"),this.render(a)},render:function(b){var d=Galaxy.root+"dataset/edit",e=this;a.get({url:d,data:{dataset_id:b},success:function(a){e.render_attribute_page(e,a)},error:function(){e.page.display(new c.Message({message:"Error occured",status:"error",persistent:!0,cls:"errormessage"}))}})},render_attribute_page:function(a,b){var c=null;a.$el.empty().append(a._templateHeader()),c=a.$el.find(".edit-attr"),a.display_message(a,b,c),a.create_tabs(a,b,c),a.register_events(a,b.dataset_id,c)},convert_to_object:function(a){var b={};return _.each(a,function(a){b[a.name]=a.value}),b},register_events:function(a,b,c){var d=Galaxy.root+"dataset/edit";c.find(".btn-submit-attributes").click(function(b){b.preventDefault();var e=c.find("input[name='name']").val();if(""===e||null===e||!e)return void a.display_message(a,{message:"Please give a name to the dataset",status:"error"},c);var f=c.find("form[name='edit_attributes']").serializeArray();a.call_ajax(a,d,a.convert_to_object(f))}),c.find(".btn-auto-detect").click(function(c){c.preventDefault(),a.call_ajax(a,d,{dataset_id:b,detect:"Auto-detect"})})},call_ajax:function(a,b,c){$.ajax({type:"POST",url:b,data:c,success:function(b){a.render_attribute_page(a,b)}})},display_message:function(a,b,c){$el_message=c.find(".response-message"),$el_message.removeClass("errormessage donemessage warningmessage"),b.message&&null!==b.message&&""!==b.message?($el_message.addClass(b.status+"message"),$el_message.html("<p>"+_.escape(b.message)+"</p>")):$el_message.html("")},create_tabs:function(a,c,d){a.tabs=new b.View,a.tabs.add({id:"attributes",title:"Attributes",icon:"fa fa-bars",tooltip:"Edit dataset attributes",$el:$(a._attributesTabTemplate(a,c))}),a.tabs.add({id:"convert",title:"Convert",icon:"fa-gear",tooltip:"Convert to new format"}),a.tabs.add({id:"datatype",title:"Datatypes",icon:"fa-database",tooltip:"Change data type"}),a.tabs.add({id:"permissions",title:"View Permissions",icon:"fa-user",tooltip:"View permissions"}),d.append(a.tabs.$el),a.tabs.showTab("attributes")},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div><h3>Edit Dataset Attributes and Permissions</h3></div>'},_attributesTabTemplate:function(a,b){var c="<div class='toolFormTitle'>Edit Attributes</div><div class='toolFormBody'><form name='edit_attributes'><div class='form-row'><label>Name:</label><div style='float: left; width: 250px; margin-right: 10px;'><input type='text' name='name' value="+b.display_name+" size='40'/><input type='hidden' name='dataset_id' value='"+b.dataset_id+"'><input type='hidden' name='save' value='Save'></div><div style='clear: both'></div></div><div class='form-row'><label>Info:</label><div style='float: left; width: 250px; margin-right: 10px;'><textarea name='info' cols='40' rows='2'>"+b.data_info+"</textarea></div><div style='clear: both'></div></div>";return user&&(c=c+"<div class='form-row'><label>Annotation / Notes:</label><div style='float: left; width: 250px; margin-right: 10px;'><textarea name='annotation' cols='40' rows='2'>"+(null===b.data_annotation?"":b.data_annotation)+"</textarea></div><div style='clear: both'></div><div class='toolParamHelp'>Add an annotation or notes to a dataset; annotations are available when a history is viewed.</div></div>"),_.each(b.data_metadata,function(a){a[1]&&(c=c+"<div class='form-row'><label>"+a[2]+"</label><div style='float: left; width: 250px; margin-right: 10px;'>"+b.metadata_html[a[0]]+"</div><div style='clear: both'></div></div>")}),c+="<div class='form-row'><input class='btn-submit-attributes' type='submit' name='save' value='Save'/></div>",c+="</form>",c+="<form name='auto_detect'><div class='form-row'><div style='float: left; width: 250px; margin-right: 10px;'><input class='btn-auto-detect' type='submit' name='detect' value='Auto-detect' /></div><div class='toolParamHelp' style='clear: both;'>This will inspect the dataset and attempt to correct the above column values if they are not accurate.</div></div></form>",b.data_missing_meta&&(c+="<div class='form-row'><div class='errormessagesmall'> Required metadata values are missing. Some of these values may not be editable by the user. Selecting 'Auto-detect' will attempt to fix these values. </div></div>"),c+="</div></div>"}});return{View:d}});
//# sourceMappingURL=../../../maps/mvc/dataset/dataset-edit-attributes.js.map