"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(exports,"__esModule",{value:!0});var _historyContents=require("mvc/history/history-contents"),_historyContents2=_interopRequireDefault(_historyContents),_states=require("mvc/dataset/states"),_states2=_interopRequireDefault(_states),_ajaxQueue=require("utils/ajax-queue"),_ajaxQueue2=_interopRequireDefault(_ajaxQueue),_baseMvc=require("mvc/base-mvc"),_baseMvc2=_interopRequireDefault(_baseMvc),_localization=require("utils/localization"),_localization2=_interopRequireDefault(_localization),logNamespace="jobs",searchableMixin=_baseMvc2.default.SearchableModelMixin,Job=Backbone.Model.extend(_baseMvc2.default.LoggableMixin).extend(_baseMvc2.default.mixin(searchableMixin,{_logNamespace:logNamespace,defaults:{model_class:"Job",tool_id:null,exit_code:null,inputs:{},outputs:{},params:{},create_time:null,update_time:null,state:_states2.default.NEW},parse:function(t,e){return t.params=this.parseParams(t.params),t},parseParams:function(t){var e={};return _.each(t,function(t,i){e[i]=JSON.parse(t)}),e},initialize:function(t,e){this.debug(this+"(Job).initialize",t,e),this.set("params",this.parseParams(this.get("params")),{silent:!0}),this.outputCollection=t.outputCollection||new _historyContents2.default.HistoryContents([]),this._setUpListeners()},_setUpListeners:function(){this.on("change:state",function(t,e){this.log(this+" has changed state:",t,e),this.inReadyState()&&this.trigger("state:ready",t,e,this.previous("state"))})},inReadyState:function(){return _.contains(_states2.default.READY_STATES,this.get("state"))},hasDetails:function(){return!_.isEmpty(this.get("outputs"))},urlRoot:Galaxy.root+"api/jobs",toString:function(){return["Job(",this.get("id"),":",this.get("tool_id"),")"].join("")}})),JobCollection=Backbone.Collection.extend(_baseMvc2.default.LoggableMixin).extend({_logNamespace:logNamespace,model:Job,urlRoot:Galaxy.root+"api/jobs",url:function(){return this.urlRoot},intialize:function(t,e){console.debug(t,e)},ids:function(){return this.map(function(t){return t.get("id")})},notReady:function(){return this.filter(function(t){return!t.inReadyState()})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},queueDetailFetching:function(){var t=this,e=new _ajaxQueue2.default.AjaxQueue(this.map(function(t){return function(){return t.fetch({silent:!0})}}));return e.done(function(){t.trigger("details-loaded")}),e},matches:function(t){return this.filter(function(e){return e.matches(t)})},toString:function(){return["JobCollection(",this.length,")"].join("")}},{fromHistory:function(t){console.debug(this);var e=new this([]);return e.fetch({data:{history_id:t}}).done(function(){window.queue=e.queueDetailFetching()}),e}});exports.default={Job:Job,JobCollection:JobCollection};
//# sourceMappingURL=../../../maps/mvc/job/job-model.js.map
