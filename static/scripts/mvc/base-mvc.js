"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function mixin(e,t){var i=Array.prototype.slice.call(arguments,0),r=i.pop();return i.unshift(r),_underscore2.default.defaults.apply(_underscore2.default,i)}function wrapTemplate(e,t){t=t||"model";var i=_underscore2.default.template(e.join(""));return function(e,r){var n={view:r||{},_l:_localization2.default};return n[t]=e||{},i(n)}}function buildComparator(e,t){var i=(t=t||{}).ascending?1:-1;return function(t,r){return t=t.get(e),r=r.get(e),(t<r?-1:t>r?1:0)*i}}Object.defineProperty(exports,"__esModule",{value:!0});var _underscore=require("libs/underscore"),_underscore2=_interopRequireDefault(_underscore),_backbone=require("libs/backbone"),_backbone2=_interopRequireDefault(_backbone),_addLogging=require("utils/add-logging"),_addLogging2=_interopRequireDefault(_addLogging),_localization=require("utils/localization"),_localization2=_interopRequireDefault(_localization),LoggableMixin={logger:null,_logNamespace:"."};(0,_addLogging2.default)(LoggableMixin);var SessionStorageModel=_backbone2.default.Model.extend({initialize:function(e){if(this._checkEnabledSessionStorage(),!e.id)throw new Error("SessionStorageModel requires an id in the initial attributes");this.id=e.id;var t=this.isNew()?{}:this._read(this);this.clear({silent:!0}),this.save(_underscore2.default.extend({},this.defaults,t,e),{silent:!0}),this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return window.sessionStorage.length>=0}catch(e){return alert("Please enable cookies in your browser for this Galaxy site"),!1}},sync:function(e,t,i){i.silent||t.trigger("request",t,{},i);var r={};switch(e){case"create":r=this._create(t);break;case"read":r=this._read(t);break;case"update":r=this._update(t);break;case"delete":r=this._delete(t)}return void 0!==r||null!==r?i.success&&i.success():i.error&&i.error(),r},_create:function(e){try{var t=e.toJSON(),i=sessionStorage.setItem(e.id,JSON.stringify(t));return null===i?i:t}catch(e){if(!(e instanceof DOMException&&navigator.userAgent.indexOf("Safari")>-1))throw e}return null},_read:function(e){return JSON.parse(sessionStorage.getItem(e.id))},_update:function(e){return e._create(e)},_delete:function(e){return sessionStorage.removeItem(e.id)},isNew:function(){return!sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel("+this.id+")"}});SessionStorageModel.prototype=_underscore2.default.omit(SessionStorageModel.prototype,"url","urlRoot");var SearchableModelMixin={searchAttributes:[],searchAliases:{},searchAttribute:function(e,t){var i=this.get(e);return!(!t||void 0===i||null===i)&&(_underscore2.default.isArray(i)?this._searchArrayAttribute(i,t):-1!==i.toString().toLowerCase().indexOf(t.toLowerCase()))},_searchArrayAttribute:function(e,t){return t=t.toLowerCase(),_underscore2.default.any(e,function(e){return-1!==e.toString().toLowerCase().indexOf(t.toLowerCase())})},search:function(e){var t=this;return _underscore2.default.filter(this.searchAttributes,function(i){return t.searchAttribute(i,e)})},matches:function(e){var t=e.split("=");if(t.length>=2){var i=t[0];return i=this.searchAliases[i]||i,this.searchAttribute(i,t[1])}return!!this.search(e).length},matchesAll:function(e){var t=this;return e=e.match(/(".*"|\w*=".*"|\S*)/g).filter(function(e){return!!e}),_underscore2.default.all(e,function(e){return e=e.replace(/"/g,""),t.matches(e)})}},HiddenUntilActivatedViewMixin={hiddenUntilActivated:function(e,t){if(t=t||{},this.HUAVOptions={$elementShown:this.$el,showFn:jQuery.prototype.toggle,showSpeed:"fast"},_underscore2.default.extend(this.HUAVOptions,t||{}),this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible"),this.hidden=this.isHidden(),e){var i=this;e.on("click",function(e){i.toggle(i.HUAVOptions.showSpeed)})}},isHidden:function(){return this.HUAVOptions.$elementShown.is(":hidden")},toggle:function(){return this.hidden?(this.HUAVOptions.hasBeenShown||_underscore2.default.isFunction(this.HUAVOptions.onshowFirstTime)&&(this.HUAVOptions.hasBeenShown=!0,this.HUAVOptions.onshowFirstTime.call(this)),_underscore2.default.isFunction(this.HUAVOptions.onshow)&&(this.HUAVOptions.onshow.call(this),this.trigger("hiddenUntilActivated:shown",this)),this.hidden=!1):(_underscore2.default.isFunction(this.HUAVOptions.onhide)&&(this.HUAVOptions.onhide.call(this),this.trigger("hiddenUntilActivated:hidden",this)),this.hidden=!0),this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}},DraggableViewMixin={initialize:function(e){this.draggable=e.draggable||!1},$dragHandle:function(){return this.$(".title-bar")},toggleDraggable:function(){this.draggable?this.draggableOff():this.draggableOn()},draggableOn:function(){this.draggable=!0,this.dragStartHandler=_underscore2.default.bind(this._dragStartHandler,this),this.dragEndHandler=_underscore2.default.bind(this._dragEndHandler,this);var e=this.$dragHandle().attr("draggable",!0).get(0);e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1)},draggableOff:function(){this.draggable=!1;var e=this.$dragHandle().attr("draggable",!1).get(0);e.removeEventListener("dragstart",this.dragStartHandler,!1),e.removeEventListener("dragend",this.dragEndHandler,!1)},_dragStartHandler:function(e){return e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",JSON.stringify(this.model.toJSON())),this.trigger("draggable:dragstart",e,this),!1},_dragEndHandler:function(e){return this.trigger("draggable:dragend",e,this),!1}},SelectableViewMixin={initialize:function(e){this.selectable=e.selectable||!1,this.selected=e.selected||!1},$selector:function(){return this.$(".selector")},_renderSelected:function(){this.$selector().find("span").toggleClass("fa-check-square-o",this.selected).toggleClass("fa-square-o",!this.selected)},toggleSelector:function(){this.$selector().is(":visible")?this.hideSelector():this.showSelector()},showSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!0,this.trigger("selectable",!0,this),this._renderSelected(),e?this.$selector().show(e):this.$selector().show()},hideSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!1,this.trigger("selectable",!1,this),e?this.$selector().hide(e):this.$selector().hide()},toggleSelect:function(e){this.selected?this.deselect(e):this.select(e)},select:function(e){return this.selected||(this.trigger("selected",this,e),this.selected=!0,this._renderSelected()),!1},deselect:function(e){return this.selected&&(this.trigger("de-selected",this,e),this.selected=!1,this._renderSelected()),!1}};exports.default={LoggableMixin:LoggableMixin,SessionStorageModel:SessionStorageModel,mixin:mixin,SearchableModelMixin:SearchableModelMixin,HiddenUntilActivatedViewMixin:HiddenUntilActivatedViewMixin,DraggableViewMixin:DraggableViewMixin,SelectableViewMixin:SelectableViewMixin,wrapTemplate:wrapTemplate,buildComparator:buildComparator};
//# sourceMappingURL=../../maps/mvc/base-mvc.js.map
