"use strict";define(["utils/utils"],function(t){return Backbone.View.extend({initialize:function(s){var a=this;this.options=t.merge(s,{class_add:"upload-icon-button fa fa-square-o",class_remove:"upload-icon-button fa fa-check-square-o",class_partial:"upload-icon-button fa fa-minus-square-o",collection:null,onchange:function(){},onadd:function(){},onremove:function(){}}),this.collection=this.options.collection,this.setElement(this._template()),this.rows=[],t.get({url:Galaxy.root+"api/remote_files",success:function(t){a._fill(t)},error:function(){a._fill()}})},_fill:function(s){if(s&&s.length>0){this.$(".upload-ftp-content").html($(this._templateTable()));var a=0;for(var e in s)this.rows.push(this._add(s[e])),a+=s[e].size;if(this.$(".upload-ftp-number").html(s.length+" files"),this.$(".upload-ftp-disk").html(t.bytesToString(a,!0)),this.collection){var l=this;this.$("._has_collection").show(),this.$select_all=this.$(".upload-selectall").addClass(this.options.class_add),this.$select_all.on("click",function(){var t=l.$select_all.hasClass(l.options.class_add);for(var a in s){var e=s[a],i=l._find(e);(!i&&t||i&&!t)&&l.rows[a].trigger("click")}}),this._refresh()}}else this.$(".upload-ftp-content").html($(this._templateInfo()));this.$(".upload-ftp-wait").hide()},_add:function(t){var s=this,a=$(this._templateRow(t)),e=a.find(".icon");return this.$("tbody").append(a),this.collection?(e.addClass(this._find(t)?this.options.class_remove:this.options.class_add),a.on("click",function(){var a=s._find(t);e.removeClass(),a?(s.options.onremove(a),e.addClass(s.options.class_add)):(s.options.onadd(t),e.addClass(s.options.class_remove)),s._refresh()})):a.on("click",function(){s.options.onchange(t)}),a},_refresh:function(){var t=this.collection.where({file_mode:"ftp",enabled:!0});this.$select_all.removeClass(),0==t.length?this.$select_all.addClass(this.options.class_add):this.$select_all.addClass(t.length==this.rows.length?this.options.class_remove:this.options.class_partial)},_find:function(t){var s=this.collection.findWhere({file_path:t.path,file_mode:"ftp",enabled:!0});return s&&s.get("id")},_templateRow:function(s){return'<tr class="upload-ftp-row"><td class="_has_collection" style="display: none;"><div class="icon"/></td><td class="ftp-name">'+_.escape(s.path)+'</td><td class="ftp-size">'+t.bytesToString(s.size)+'</td><td class="ftp-time">'+s.ctime+"</td></tr>"},_templateTable:function(){return'<span style="whitespace: nowrap; float: left;">Available files: </span><span style="whitespace: nowrap; float: right;"><span class="upload-icon fa fa-file-text-o"/><span class="upload-ftp-number"/>&nbsp;&nbsp;<span class="upload-icon fa fa-hdd-o"/><span class="upload-ftp-disk"/></span><table class="grid" style="float: left;"><thead><tr><th class="_has_collection" style="display: none;"><div class="upload-selectall"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody/></table>'},_templateInfo:function(){return'<div class="upload-ftp-warning warningmessage">Your FTP directory does not contain any files.</div>'},_template:function(){return'<div class="upload-ftp"><div class="upload-ftp-wait fa fa-spinner fa-spin"/><div class="upload-ftp-help">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>'+this.options.ftp_upload_site+'</strong> using your Galaxy credentials (email address and password).</div><div class="upload-ftp-content"/><div>'}})});
//# sourceMappingURL=../../../maps/mvc/upload/upload-ftp.js.map
