define(["utils/utils","mvc/ui/ui-select","mvc/ui/ui-misc","mvc/upload/upload-model","mvc/upload/upload-ftp","mvc/upload/upload-extension","utils/uploadbox"],function(a,b,c,d,e,f){return Backbone.View.extend({collection:new d.Collection,initialize:function(d){var g=this;this.app=d,this.options=d.options,this.list_extensions=d.list_extensions,this.list_genomes=d.list_genomes,this.ftp_upload_site=d.currentFtp(),this.setElement(this._template()),this.$info=this.$(".upload-top-info"),this.ftp_list=new e({cls:"upload-ftp-full",collection:this.collection,ftp_upload_site:this.ftp_upload_site,help_enabled:!1,onadd:function(b){var c=a.uid();return g.collection.add({id:c,file_mode:"ftp",file_size:b.size,file_path:b.path,enabled:!0}),c},onremove:function(a){g.collection.remove(a)}}),this.$(".upload-box").append(this.ftp_list.$el),this.btnStart=new c.Button({id:"btn-start",title:"Start",wait_cls:"btn btn-info",onclick:function(){g._eventStart()}}),this.btnRefresh=new c.Button({id:"btn-refresh",title:"Reset",onclick:function(){g._eventReset()}}),this.btnClose=new c.Button({id:"btn-close",title:"Close",onclick:function(){g.app.modal.hide()}}),_.each([this.btnRefresh,this.btnStart,this.btnClose],function(a){g.$(".upload-buttons").prepend(a.$el)}),this.select_extension=new b.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:_.filter(this.list_extensions,function(a){return!a.composite_files}),value:this.options.default_extension,onchange:function(a){g.model.set("extension",a)}}),this.select_genome=new b.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(a){g.model.set("genome",a)}}),this.$(".upload-footer-extension-info").on("click",function(a){new f({$el:$(a.target),title:g.select_extension.text(),extension:g.select_extension.value(),list:g.list_extensions,placement:"top"})}).on("mousedown",function(a){a.preventDefault()}),this.listenTo(this.collection,"add remove",this.render,this),this.render()},_eventStart:function(){var a=this;this.btnStart.wait();var b={payload:{tool_id:"upload1",history_id:this.app.currentHistory(),inputs:{}}},c={};c.dbkey=this.select_genome.value(),c.file_type=this.select_extension.value(),c["files_0|type"]="upload_dataset",c["files_0|space_to_tab"]=null,c["files_0|to_posix_lines"]=null,c["files_0|ftp_files"]=[],this.collection.each(function(a){a.set("status","running"),a.get("file_size")>0&&c["files_0|ftp_files"].push(a.get("file_path"))}),b.payload.inputs=JSON.stringify(c),$.uploadpost({data:b,url:this.app.options.nginx_upload_path,success:function(){a._eventSuccess()},error:function(){a._eventError()}})},_eventReset:function(){this.collection.reset(),this.ftp_list.render(),this.render()},_eventSuccess:function(){Galaxy.currHistoryPanel.refreshContents(),this._eventReset(),this.btnStart.unwait()},_eventError:function(){this.$info.html("Some of the selected files have already been queued...please unselect them and try again."),this.btnStart.unwait()},render:function(){this.collection.length>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary"),this.$info.html("You added "+this.collection.length+" file(s) to the queue. Add more files or click 'Start' to proceed.")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary"),this.$info.html(this.ftp_list.model.get("help_text")))},_template:function(){return'<div class="upload-view-default"><div class="upload-top"><h6 class="upload-top-info"/></div><div class="upload-box upload-box-solid"/><div class="upload-footer"><span class="upload-footer-title">Type (for all):</span><span class="upload-footer-extension"/><span class="upload-footer-extension-info upload-icon-button fa fa-search"/> <span class="upload-footer-title">Genome (for all):</span><span class="upload-footer-genome"/></div><div class="upload-buttons"/></div>'}})});
//# sourceMappingURL=../../../../maps/mvc/upload/ftp/ftp-view.js.map