"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _utils=require("utils/utils"),_utils2=_interopRequireDefault(_utils),_uploadModel=require("mvc/upload/upload-model"),_uploadModel2=_interopRequireDefault(_uploadModel),_compositeRow=require("mvc/upload/composite/composite-row"),_compositeRow2=_interopRequireDefault(_compositeRow),_uploadExtension=require("mvc/upload/upload-extension"),_uploadExtension2=_interopRequireDefault(_uploadExtension),_uiPopover=require("mvc/ui/ui-popover"),_uiPopover2=_interopRequireDefault(_uiPopover),_uiSelect=require("mvc/ui/ui-select"),_uiSelect2=_interopRequireDefault(_uiSelect),_uiMisc=require("mvc/ui/ui-misc"),_uiMisc2=_interopRequireDefault(_uiMisc);exports.default=Backbone.View.extend({collection:new _uploadModel2.default.Collection,initialize:function(e){var t=this;this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ftp_upload_site=e.currentFtp(),this.setElement(this._template()),this.btnStart=new _uiMisc2.default.Button({title:"Start",onclick:function(){t._eventStart()}}),this.btnClose=new _uiMisc2.default.Button({title:"Close",onclick:function(){t.app.modal.hide()}}),_.each([this.btnStart,this.btnClose],function(e){t.$(".upload-buttons").prepend(e.$el)}),this.select_extension=new _uiSelect2.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:_.filter(this.list_extensions,function(e){return e.composite_files}),onchange:function(e){t.collection.reset();var o=_.findWhere(t.list_extensions,{id:e});o&&o.composite_files&&_.each(o.composite_files,function(e){t.collection.add({id:t.collection.size(),file_desc:e.description||e.name})})}}),this.$(".upload-footer-extension-info").on("click",function(e){new _uploadExtension2.default({$el:$(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),list:t.list_extensions,placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new _uiSelect2.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome}),this.listenTo(this.collection,"add",function(e){t._eventAnnounce(e)}),this.listenTo(this.collection,"change add",function(){t.render()}),this.select_extension.options.onchange(this.select_extension.value()),this.render()},render:function(){var e=this.collection.first();e&&"running"==e.get("status")?(this.select_genome.disable(),this.select_extension.disable()):(this.select_genome.enable(),this.select_extension.enable()),this.collection.where({status:"ready"}).length==this.collection.length&&this.collection.length>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary")),this.$(".upload-table")[this.collection.length>0?"show":"hide"]()},_eventAnnounce:function(e){var t=new _compositeRow2.default(this,{model:e});this.$(".upload-table > tbody:first").append(t.$el),this.$(".upload-table")[this.collection.length>0?"show":"hide"](),t.render()},_eventStart:function(){var e=this;this.collection.each(function(t){t.set({genome:e.select_genome.value(),extension:e.select_extension.value()})}),$.uploadpost({url:this.app.options.nginx_upload_path,data:this.app.toData(this.collection.filter()),success:function(t){e._eventSuccess(t)},error:function(t){e._eventError(t)},progress:function(t){e._eventProgress(t)}})},_eventProgress:function(e){this.collection.each(function(t){t.set("percentage",e)})},_eventSuccess:function(e){this.collection.each(function(e){e.set("status","success")}),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e){this.collection.each(function(t){t.set({status:"error",info:e})})},_template:function(){return'<div class="upload-view-composite"><div class="upload-top"><h6 class="upload-top-info"/></div><div class="upload-box"><table class="upload-table ui-table-striped" style="display: none;"><thead><tr><th/><th/><th>Description</th><th>Name</th><th>Size</th><th>Settings</th><th>Status</th></tr></thead><tbody/></table></div><div class="upload-footer"><span class="upload-footer-title">Composite Type:</span><span class="upload-footer-extension"/><span class="upload-footer-extension-info upload-icon-button fa fa-search"/> <span class="upload-footer-title">Genome/Build:</span><span class="upload-footer-genome"/></div><div class="upload-buttons"/></div>'}});
//# sourceMappingURL=../../../../maps/mvc/upload/composite/composite-view.js.map
