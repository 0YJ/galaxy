"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(exports,"__esModule",{value:!0});var _utils=require("utils/utils"),_utils2=_interopRequireDefault(_utils),Manager=Backbone.Model.extend({initialize:function(t){this.app=t},checksum:function(){var t="",a=this;return this.app.section.$el.find(".section-row").each(function(){var e=$(this).attr("id"),i=a.app.field_list[e];i&&(t+=e+":"+JSON.stringify(i.value&&i.value())+":"+i.collapsed+";")}),t},create:function(){function t(t,a,i){e.flat_dict[t]=a,n[t]=i,e.app.element_list[a]&&e.app.element_list[a].$el.attr("tour_id",t)}function a(i,n){for(var r in n){var s=n[r];if(s.input){var u=s.input,l=i;switch(""!=i&&(l+="|"),l+=u.name,u.type){case"repeat":var c=[],o=null;for(var f in s){var p=f.indexOf("section-");-1!=p&&(p+="section-".length,c.push(parseInt(f.substr(p))),o||(o=f.substr(0,p)))}c.sort(function(t,a){return t-a});r=0;for(var v in c)a(l+"_"+r++,s[o+c[v]]);break;case"conditional":h=e.app.field_list[u.id].value();t(l+"|"+u.test_param.name,u.id,h);var d=_matchCase(u,h);-1!=d&&a(l,n[u.id+"-section-"+d]);break;case"section":a(!u.flat&&l||"",s);break;default:var _=e.app.field_list[u.id];if(_&&_.value){var h=_.value();if((void 0===u.ignore||u.ignore!=h)&&(_.collapsed&&u.collapsible_value&&(h=u.collapsible_value),t(l,u.id,h),u.payload))for(var m in u.payload)t(m,u.id,u.payload[m])}}}}}var e=this,i={};this._iterate(this.app.section.$el,i);var n={};return this.flat_dict={},a("",i),n},match:function(t){return this.flat_dict&&this.flat_dict[t]},matchCase:function(t,a){return _matchCase(t,a)},matchModel:function(t,a){var e=this;visitInputs(t.inputs,function(t,i){e.flat_dict[i]&&a(t,e.flat_dict[i])})},matchResponse:function(t){function a(t,n){if("string"==typeof n){var r=i.flat_dict[t];r&&(e[r]=n)}else for(var s in n){var u=s;if(""!==t){var l="|";n instanceof Array&&(l="_"),u=t+l+u}a(u,n[s])}}var e={},i=this;return a("",t),e},_iterate:function(t,a){var e=this;$(t).children().each(function(){var t=this,i=$(t).attr("id");if($(t).hasClass("section-row")){var n=e.app.input_list[i];a[i]=n&&{input:n}||{},e._iterate(t,a[i])}else e._iterate(t,a)})}}),_matchCase=function(t,a){"boolean"==t.test_param.type&&(a="true"==a?t.test_param.truevalue||"true":t.test_param.falsevalue||"false");for(var e in t.cases)if(t.cases[e].value==a)return e;return-1},visitInputs=function t(a,e,i,n){n=$.extend(!0,{},n),_.each(a,function(t){t&&t.type&&t.name&&(n[t.name]=t)});for(var r in a){var s=a[r];s.name=s.name||r;var u=i?i+"|"+s.name:s.name;switch(s.type){case"repeat":_.each(s.cache,function(a,i){t(a,e,u+"_"+i,n)});break;case"conditional":if(s.test_param){e(s.test_param,u+"|"+s.test_param.name,n);var l=_matchCase(s,s.test_param.value);-1!=l?t(s.cases[l].inputs,e,u,n):Galaxy.emit.debug("form-data::visitInputs() - Invalid case for "+u+".")}else Galaxy.emit.debug("form-data::visitInputs() - Conditional test parameter missing for "+u+".");break;case"section":t(s.inputs,e,u,n);break;default:e(s,u,n)}}};exports.default={Manager:Manager,visitInputs:visitInputs};
//# sourceMappingURL=../../../maps/mvc/form/form-data.js.map
